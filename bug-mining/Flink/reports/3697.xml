<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-13689] Rest High Level Client for Elasticsearch6.x connector leaks threads if no connection could be established</title>
                <link>https://issues.apache.org/jira/browse/FLINK-13689</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;If the created Elastic Search Rest High Level Client(rhlClient) is unreachable, Current code throws RuntimeException. But, it doesn&apos;t close the client which causes thread leak.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Current Code&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;if (!rhlClient.ping()) {&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160;&lt;b&gt;throw new RuntimeException(&quot;There are no reachable Elasticsearch nodes!&quot;);&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;}&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Change Needed&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;rhlClient needs to be closed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Steps&#160;to Reproduce&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;1. Add the ElasticSearch Sink to the stream. Start the Flink program without starting the ElasticSearch.&#160;&lt;/p&gt;

&lt;p&gt;2. Program will give error: &quot;&lt;b&gt;Too many open files&lt;/b&gt;&quot; and it doesn&apos;t write even though you start the Elastic Search later.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13250201">FLINK-13689</key>
            <summary>Rest High Level Client for Elasticsearch6.x connector leaks threads if no connection could be established</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="melmoth">static-max</assignee>
                                    <reporter username="rishi55">Rishindra Kumar</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 12 Aug 2019 07:24:13 +0000</created>
                <updated>Fri, 7 Aug 2020 06:47:41 +0000</updated>
                            <resolved>Fri, 31 Jan 2020 12:14:39 +0000</resolved>
                                    <version>1.8.1</version>
                                    <fixVersion>1.10.2</fixVersion>
                    <fixVersion>1.11.0</fixVersion>
                                    <component>Connectors / ElasticSearch</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16906191" author="rishi55" created="Tue, 13 Aug 2019 13:22:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I figured out the bug when I was running my streaming application which pulls data from kafka and puts it in Elasticsearch. I used &lt;b&gt;Elasticsearch6 connector&lt;/b&gt;. When the application is unable to connect to ElasticSearch it keeps on retrying and leaving all those unestablished clients open which is resulting in &quot;TOO MANY OPEN FILES&quot; error.&lt;/p&gt;

&lt;p&gt;The close statement is added in previous Elasticsearch connectors(2,5) where Transport client is used. But in ES6 connector, RestHighLevel client is&#160;used.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Plan to fix:&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Add IOUtils.closeQuietly(rhlClient)&#160;statement before throwing the runtime exception in above mentioned code.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Plan to test:&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Start the streaming application and stop the ElasticSearch service. Make sure that client is getting closed and the TOO many files error is not being observed.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16909313" author="rishi55" created="Fri, 16 Aug 2019 18:19:12 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I created pull request with the mentioned change.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/pull/9468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9468&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16921962" author="jark" created="Wed, 4 Sep 2019 05:30:33 +0000"  >&lt;p&gt;I changed the fix version to 1.8.3 because of releasing 1.8.2. Please let me know if you want it in 1.8.2.&lt;/p&gt;</comment>
                            <comment id="17021282" author="melmoth" created="Wed, 22 Jan 2020 17:03:44 +0000"  >&lt;p&gt;Hi there, I would like to contribute the changes proposed by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;&#160;at&#160;&lt;a href=&quot;https://github.com/apache/flink/pull/9468&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9468&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I already started working on a fix and testing it at the moment.&#160;&lt;/p&gt;</comment>
                            <comment id="17027442" author="aljoscha" created="Fri, 31 Jan 2020 12:14:39 +0000"  >&lt;p&gt;master: 79f2f04ecba3e37e0b761f50348382fa08d7db9d&lt;/p&gt;</comment>
                            <comment id="17172937" author="rmetzger" created="Fri, 7 Aug 2020 06:47:34 +0000"  >&lt;p&gt;release-1.10: &lt;a href=&quot;https://github.com/apache/flink/commit/b717877f69d90b3081bb6a79e8d78196831256a7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/b717877f69d90b3081bb6a79e8d78196831256a7&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z05k68:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>