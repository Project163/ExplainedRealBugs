<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:03:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24162] PartiallyFinishedSourcesITCase fails due to assertion error in DrainingValidator.validateOperatorLifecycle</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24162</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23526&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23526&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4639&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Sep 03 23:17:11 [ERROR] Tests run: 6, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 19.233 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.runtime.operators.lifecycle.PartiallyFinishedSourcesITCase
Sep 03 23:17:11 [ERROR] test[simple graph SINGLE_SUBTASK, failover: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;]  Time elapsed: 2.27 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
Sep 03 23:17:11 java.lang.AssertionError
Sep 03 23:17:11 	at org.junit.Assert.fail(Assert.java:87)
Sep 03 23:17:11 	at org.junit.Assert.assertTrue(Assert.java:42)
Sep 03 23:17:11 	at org.junit.Assert.assertFalse(Assert.java:65)
Sep 03 23:17:11 	at org.junit.Assert.assertFalse(Assert.java:75)
Sep 03 23:17:11 	at org.apache.flink.runtime.operators.lifecycle.validation.DrainingValidator.validateOperatorLifecycle(DrainingValidator.java:56)
Sep 03 23:17:11 	at org.apache.flink.runtime.operators.lifecycle.validation.TestOperatorLifecycleValidator.lambda$checkOperatorsLifecycle$1(TestOperatorLifecycleValidator.java:52)
Sep 03 23:17:11 	at java.util.HashMap.forEach(HashMap.java:1289)
Sep 03 23:17:11 	at org.apache.flink.runtime.operators.lifecycle.validation.TestOperatorLifecycleValidator.checkOperatorsLifecycle(TestOperatorLifecycleValidator.java:47)
Sep 03 23:17:11 	at org.apache.flink.runtime.operators.lifecycle.PartiallyFinishedSourcesITCase.test(PartiallyFinishedSourcesITCase.java:94)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13399496">FLINK-24162</key>
            <summary>PartiallyFinishedSourcesITCase fails due to assertion error in DrainingValidator.validateOperatorLifecycle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="xtsong">Xintong Song</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Mon, 6 Sep 2021 03:03:09 +0000</created>
                <updated>Tue, 7 Sep 2021 13:48:58 +0000</updated>
                            <resolved>Tue, 7 Sep 2021 13:48:33 +0000</resolved>
                                    <version>1.14.0</version>
                    <version>1.15.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17410320" author="xintongsong" created="Mon, 6 Sep 2021 03:03:38 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17410326" author="xintongsong" created="Mon, 6 Sep 2021 03:11:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23529&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23529&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4594&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17410342" author="xintongsong" created="Mon, 6 Sep 2021 03:34:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23544&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23544&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4594&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17410347" author="xintongsong" created="Mon, 6 Sep 2021 03:37:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23547&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23547&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4594&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17410355" author="xintongsong" created="Mon, 6 Sep 2021 03:44:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23557&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23557&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4594&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17410707" author="gaoyunhaii" created="Mon, 6 Sep 2021 16:06:13 +0000"  >&lt;p&gt;I should roughly get the reason: it is due to that the test verifies for each operator, it should only received max watermark and EndOfData once for all the attempts. However, this is in fact not ensured:  if a task get finished first, then get restarted due to some downstream tasks failed, it would still re-emit max watermark and EndOfData. This is required for the downstream tasks to align.&lt;/p&gt;

&lt;p&gt;This only happen with adaptive scheduler since now the test is in fact using region failover, with the default scheduler the finish task would not restart in failover. Sorry I do not fully got why with adaptive scheduler the whole job is restarted, but from the log this should indeed happen.&lt;/p&gt;

&lt;p&gt;I&apos;ll open a PR to fix the issue~&lt;/p&gt;</comment>
                            <comment id="17410725" author="roman_khachatryan" created="Mon, 6 Sep 2021 16:33:30 +0000"  >&lt;p&gt;Thanks for looking into it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&#160;.&lt;/p&gt;

&lt;p&gt;I can confirm that the task transitions to FINISHED twice: before and after a failure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
23:16:57,760 INFO org.apache.flink.runtime.taskmanager.Task [] - Source: Custom Source -&amp;gt; Timestamps/Watermarks -&amp;gt; transform-1-forward -&amp;gt; Sink: Unnamed (1/4)#0 (4a3e2cd18c9e79b42dc8d6624fcbcde8) switched from RUNNING to FINISHED.
...
23:16:57,837 [    Checkpoint Timer] INFO  org.apache.flink.runtime.checkpoint.CheckpointCoordinator    [] - Triggering checkpoint 3 (type=CHECKPOI NT) @ 1630711017835 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 3d9486075a07c60f7d6927cff31ab0db.
23:16:57,840 [jobmanager-io-thread-18] INFO  org.apache.flink.runtime.checkpoint.CheckpointCoordinator    [] - Completed checkpoint 3 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job 3d94 86075a07c60f7d6927cff31ab0db (0 bytes, checkpointDuration=5 ms, finalizationTime=0 ms).
23:16:57,849 [Source: Custom Source -&amp;gt; Timestamps/Watermarks -&amp;gt; transform-1-forward -&amp;gt; Sink: Unnamed (3/4)#0] WARN  org.apache.flink.runtime.taskm anager.Task                    [] - Source: Custom Source -&amp;gt; Timestamps/Watermarks -&amp;gt; transform-1-forward -&amp;gt; Sink: Unnamed (3/4)#0 (f8498b498d21de 0ce1edd1175a20e5a6) switched from RUNNING to FAILED with failure cause: java.lang.RuntimeException: requested to fail
     at org.apache.flink.runtime.operators.lifecycle.graph.TestEventSource.run(TestEventSource.java:82)
     at org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:116)
     at org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:73)
     at org.apache.flink.streaming.runtime.tasks.SourceStreamTask$LegacySourceFunctionThread.run(SourceStreamTask.java:323)
...
23:16:58,357 INFO  org.apache.flink.runtime.taskmanager.Task [] - Source: Custom Source -&amp;gt; Timestamps/Watermarks -&amp;gt; transform-1-forward -&amp;gt; Sink: Unnamed (1/4)#1 (4c131c07267e65d0365a4f2db71f41dc) switched from RUNNING to FINISHED.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is a checkpoint (3) that is completed after finishing and is used for recovery.&lt;/p&gt;

&lt;p&gt;You&apos;re right that the whole job is restarted. However, shouldn&apos;t it be always the case because?&lt;/p&gt;

&lt;p&gt;TestJobBuilders#prepareEnv sets:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
configuration.set(EXECUTION_FAILOVER_STRATEGY, &lt;span class=&quot;code-quote&quot;&gt;&quot;full&quot;&lt;/span&gt;); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17410738" author="gaoyunhaii" created="Mon, 6 Sep 2021 17:03:33 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt;~ I have also noticed the configuration ~ but it did not take effective since it is seemed to be filtered in and not pass to the JM. If we instead set the configuration directly to the minicluster, the test would fail deterministically~  I&apos;m still checking if it is due to we are using TestStreamEnvironment or it is in fact common for all the StreamExecutionEnvironmennt~ &lt;/p&gt;</comment>
                            <comment id="17410880" author="xintongsong" created="Tue, 7 Sep 2021 02:09:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23560&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23560&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4639&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17410930" author="xintongsong" created="Tue, 7 Sep 2021 05:58:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23626&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23626&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4639&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17410934" author="xintongsong" created="Tue, 7 Sep 2021 06:02:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23629&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23629&amp;amp;view=logs&amp;amp;j=8fd9202e-fd17-5b26-353c-ac1ff76c8f28&amp;amp;t=ea7cf968-e585-52cb-e0fc-f48de023a7ca&amp;amp;l=4639&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17411252" author="roman_khachatryan" created="Tue, 7 Sep 2021 13:48:58 +0000"  >&lt;p&gt;The fix merged as &lt;br/&gt;
ba749b79ead87e827a48eff95631a148ba7bf291..3c204392e7914822e319323513936f5a053db518 into 1.14&lt;br/&gt;
and c9282cf44ef7fb048771427b306cc7b0d84566be..10eecacac1c6362e7dcf9707ae37ff40173f5f95 into master.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0umvs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>