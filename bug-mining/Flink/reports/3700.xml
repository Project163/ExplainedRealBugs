<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15010] Temp directories flink-netty-shuffle-* are not cleaned up</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15010</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Starting a Flink cluster with 2 TMs and stopping it again will leave 2 temporary directories (and not delete them): flink-netty-shuffle-&amp;lt;uid&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13271697">FLINK-15010</key>
            <summary>Temp directories flink-netty-shuffle-* are not cleaned up</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gaoyunhaii">Yun Gao</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 2 Dec 2019 12:44:40 +0000</created>
                <updated>Thu, 6 Feb 2020 12:57:38 +0000</updated>
                            <resolved>Tue, 4 Feb 2020 04:07:38 +0000</resolved>
                                    <version>1.9.0</version>
                    <version>1.9.1</version>
                    <version>1.9.2</version>
                                    <fixVersion>1.9.3</fixVersion>
                    <fixVersion>1.10.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="16997108" author="zjwang" created="Mon, 16 Dec 2019 09:18:09 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=NicoK&quot; class=&quot;user-hover&quot; rel=&quot;NicoK&quot;&gt;NicoK&lt;/a&gt;, thanks for reporting this. I want to further confirm that what &apos;s the mode for flink cluster, standalone / session ? &#160;Or how can I re-produce this issue?&lt;/p&gt;</comment>
                            <comment id="16998148" author="nicok" created="Tue, 17 Dec 2019 12:37:54 +0000"  >&lt;p&gt;I used &lt;tt&gt;start-cluster.sh&lt;/tt&gt; and added &lt;tt&gt;localhost&lt;/tt&gt; twice into &lt;tt&gt;conf/slaves&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="16998822" author="zjwang" created="Wed, 18 Dec 2019 05:26:45 +0000"  >&lt;p&gt;Thanks for the information and it is easy to re-produce this issue. I would assign to gaoyun for solving it.&lt;/p&gt;</comment>
                            <comment id="17006448" author="gaoyunhaii" created="Wed, 1 Jan 2020 16:34:15 +0000"  >&lt;p&gt;The reason for this issue should be in standalone mode TaskManagers are shutdown by SIG_TERM signal, and the cleanup of directories rely on shutdown hooks, however, there are no shutdown hook registered for netty shuffle environment.&#160;&lt;/p&gt;

&lt;p&gt;An intuitive thought is to add shutdown hook directly for &lt;em&gt;NettyShuffleEnvironment&lt;/em&gt;, however, it cannot ensure the directories get cleaned up in all cases, since the directories are created in the constructor of &lt;em&gt;FileChannelManagerImpl&lt;/em&gt;, which comes before registering&#160; shutdown hook in&#160;&lt;em&gt;NettyShuffleEnvironment&apos;s&lt;/em&gt; constructor_._ If&#160;_&lt;em&gt;&#160;task&#160;&lt;/em&gt;&lt;em&gt;&#160;managers receive SIG_TERM between the two actions, the directories will not be cleaned.&#160;Therefore, the current PR enhance&#160;_FileChannelManagerImpl&lt;/em&gt;&#160;by allowing the callers to specify whether to register a shutdown hook for the manager, and the hook is registered before creating the directories.&#160;&lt;/p&gt;

&lt;p&gt;Besides, The above issue also exist for the existing &lt;em&gt;FileChannelManagerImpl&lt;/em&gt;&#160;usage in &lt;em&gt;IOManager&lt;/em&gt;. If the current fix is acceptable, we might also fix the &lt;em&gt;IOManager&lt;/em&gt; case in similar way.&lt;/p&gt;</comment>
                            <comment id="17029552" author="zjwang" created="Tue, 4 Feb 2020 04:07:38 +0000"  >&lt;p&gt;Merged in master:&#160;5036334ca00405cd4cdd5a798dca012bb3cc7bbf&lt;/p&gt;

&lt;p&gt;Merged in release-1.10:&#160;57da4589e89672bcb042c8656b269e4faace1664&lt;/p&gt;

&lt;p&gt;Merged in release-1.9:&#160;b8221b0758a2e0946f9ddd6ca537ce2a6e6a133a&lt;/p&gt;</comment>
                            <comment id="17030716" author="gjy" created="Wed, 5 Feb 2020 14:56:04 +0000"  >&lt;p&gt;Is this an improvement or bug?&lt;/p&gt;</comment>
                            <comment id="17030846" author="gaoyunhaii" created="Wed, 5 Feb 2020 17:31:20 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjy&quot; class=&quot;user-hover&quot; rel=&quot;gjy&quot;&gt;gjy&lt;/a&gt;,&#160;I think this issue should be a bug, since the impact is that there may be directories leakage after starting and stoping standalone cluster.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z096xk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>