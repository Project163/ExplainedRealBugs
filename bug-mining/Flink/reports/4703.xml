<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19779] Remove the &quot;record_&quot; field name prefix for Confluent Avro format deserialization</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19779</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Reported by Maciej Bry&#324;ski :&lt;/p&gt;

&lt;p&gt;Problem is this is not compatible. I&apos;m unable to read anything from Kafka using Confluent Registry. Example:&lt;br/&gt;
I have data in Kafka with following value schema:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;myrecord&quot;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;: [
    {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;
    }
  ]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m creating table using this avro-confluent format:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; `test` (
	`f1` &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;
) &lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;, 
  &lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;, 
  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;localhost:9092&apos;&lt;/span&gt;, 
  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.&lt;span class=&quot;code-keyword&quot;&gt;group&lt;/span&gt;.id&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;test1234&apos;&lt;/span&gt;, 
   &lt;span class=&quot;code-quote&quot;&gt;&apos;scan.startup.&lt;span class=&quot;code-keyword&quot;&gt;mode&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;earliest-&lt;span class=&quot;code-keyword&quot;&gt;offset&lt;/span&gt;&apos;&lt;/span&gt;, 
  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;avro-confluent&apos;&lt;/span&gt;
  &lt;span class=&quot;code-quote&quot;&gt;&apos;avro-confluent.&lt;span class=&quot;code-keyword&quot;&gt;schema&lt;/span&gt;-registry.url&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;http://localhost:8081&apos;&lt;/span&gt;
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When trying to select data I&apos;m getting error:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unable to find source-code formatter for language: noformat.&lt;/span&gt; Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yaml&lt;/div&gt;&lt;pre&gt;
SELECT * FROM test;
[ERROR] Could not execute SQL statement. Reason:
org.apache.avro.AvroTypeException: Found myrecord, expecting record, missing required field record_f1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13336864">FLINK-19779</key>
            <summary>Remove the &quot;record_&quot; field name prefix for Confluent Avro format deserialization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="danny0405">Danny Chen</assignee>
                                    <reporter username="danny0405">Danny Chen</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 23 Oct 2020 07:04:50 +0000</created>
                <updated>Thu, 29 Oct 2020 15:54:54 +0000</updated>
                            <resolved>Thu, 29 Oct 2020 15:54:54 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Formats (JSON, Avro, Parquet, ORC, SequenceFile)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17219507" author="maver1ck" created="Fri, 23 Oct 2020 07:07:51 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny0405&quot; class=&quot;user-hover&quot; rel=&quot;danny0405&quot;&gt;danny0405&lt;/a&gt;&#160;for putting this bug here.&lt;/p&gt;

&lt;p&gt;I was using flink from master branch. Commit:&#160;&lt;br/&gt;
78b3f2e7d5d0a5a4d341587951b2dc54a5ef427b&lt;/p&gt;</comment>
                            <comment id="17219512" author="jark" created="Fri, 23 Oct 2020 07:12:47 +0000"  >&lt;p&gt;Not compatible with what? &lt;/p&gt;</comment>
                            <comment id="17219539" author="maver1ck" created="Fri, 23 Oct 2020 08:03:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;br/&gt;
This was an answer to this comment:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/pull/12919#issuecomment-714889392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/12919#issuecomment-714889392&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17219588" author="xiaozilong" created="Fri, 23 Oct 2020 09:52:50 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny0405&quot; class=&quot;user-hover&quot; rel=&quot;danny0405&quot;&gt;danny0405&lt;/a&gt; , I think there is still existed a bug in PR. The code what cause the problem like:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RowType rowType = (RowType) TableSchema.builder()
   .field(&lt;span class=&quot;code-quote&quot;&gt;&quot;row1&quot;&lt;/span&gt;, DataTypes.ROW(DataTypes.FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, DataTypes.STRING())))
   .field(&lt;span class=&quot;code-quote&quot;&gt;&quot;row2&quot;&lt;/span&gt;, DataTypes.ROW(DataTypes.FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;, DataTypes.STRING())))
   .field(&lt;span class=&quot;code-quote&quot;&gt;&quot;row3&quot;&lt;/span&gt;, DataTypes.ROW(
      DataTypes.FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;row2&quot;&lt;/span&gt;, DataTypes.ROW(DataTypes.FIELD(&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;, DataTypes.STRING())))))
   .build().toRowDataType().getLogicalType();
Schema schema = AvroSchemaConverter.convertToSchema(rowType);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(schema.toString(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it will throw:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.avro.SchemaParseException: Can&apos;t redefine: row2&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think we can use a special string as the top name to replace `record_`? Thanks.&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17219601" author="jark" created="Fri, 23 Oct 2020 10:02:51 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maver1ck&quot; class=&quot;user-hover&quot; rel=&quot;maver1ck&quot;&gt;maver1ck&lt;/a&gt; for the link and reporting this problem. Let&apos;s keep discussion in this JIRA issue, because the notification of pull request is rather rarely received. &lt;/p&gt;

&lt;p&gt;Regarding to the problem and the fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny0405&quot; class=&quot;user-hover&quot; rel=&quot;danny0405&quot;&gt;danny0405&lt;/a&gt; provided, I&apos;m still confused what&apos;s the root cause of &lt;tt&gt;org.apache.avro.AvroTypeException: Found myrecord, expecting record, missing required field record_f1&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;I guess you have written avro data using Flink SQL into Kafka days ago (maybe Flink 1.11.x?), and upgrade Flink to the latest master version, and using the new Flink SQL to consume the avro data in Kafka, the exception is thrown. Is that the &quot;compatible&quot; problem you mentioned? As the Avro schema are not compatible now. &lt;/p&gt;</comment>
                            <comment id="17219633" author="maver1ck" created="Fri, 23 Oct 2020 10:52:50 +0000"  >&lt;p&gt;No.&lt;/p&gt;

&lt;p&gt;I&apos;ve written data to Kafka manually.&lt;/p&gt;

&lt;p&gt;I wasn&apos;t able to read it without this patch as Flink was expecting record_ prefix for all fields. With this patch I&apos;m able to read data.&lt;/p&gt;

&lt;p&gt;&#160;I&apos;m using following command line to write data to Kafka&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
kafka-avro-console-producer --broker-list localhost:9092 --topic test --property value.schema=&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;record&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;myrecord&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;fields&quot;&lt;/span&gt;:[{&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;string&quot;&lt;/span&gt;}]}&apos;&lt;/span&gt; --property schema.registry.url=http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8081&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then I&apos;m sending following record&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;xyz&quot;&lt;/span&gt;}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From the error message only this part is important:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;missing required field record_f1&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17219699" author="jark" created="Fri, 23 Oct 2020 14:11:01 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maver1ck&quot; class=&quot;user-hover&quot; rel=&quot;maver1ck&quot;&gt;maver1ck&lt;/a&gt;, will dig into the issue. &lt;/p&gt;</comment>
                            <comment id="17220547" author="danny0405" created="Mon, 26 Oct 2020 07:50:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaozilong&quot; class=&quot;user-hover&quot; rel=&quot;xiaozilong&quot;&gt;xiaozilong&lt;/a&gt; Yes, the avro schema builder does not allow same name field names, even if they are in different scope (different layer).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maver1ck&quot; class=&quot;user-hover&quot; rel=&quot;maver1ck&quot;&gt;maver1ck&lt;/a&gt; I have fixed the nullability and precision problem, please check.&lt;/p&gt;</comment>
                            <comment id="17220568" author="xiaozilong" created="Mon, 26 Oct 2020 08:45:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny0405&quot; class=&quot;user-hover&quot; rel=&quot;danny0405&quot;&gt;danny0405&lt;/a&gt;&#160;So, we should update the code?&#160;I think the code that I report should be allowed in practice, but it doesn&apos;t work in &lt;a href=&quot;https://github.com/apache/flink/pull/13763&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this PR&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17222980" author="dawidwys" created="Thu, 29 Oct 2020 15:54:54 +0000"  >&lt;p&gt;Fixed in f570d04885aa1c63c9b9c0d1ad702f49aa0b75a3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jy2o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>