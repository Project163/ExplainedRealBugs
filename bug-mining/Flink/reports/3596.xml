<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14613] Add validation check when applying UDF to  tempral table key in  Temporal Table Join condition </title>
                <link>https://issues.apache.org/jira/browse/FLINK-14613</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In&#160;Temporal Table Join, We don&apos;t support using&#160; UDF in&#160;tempral table join key. For we can&apos;t analyze LookupKeys&#160; when call is an expression. When users use like this, the program run&#160;normally,&#160; and the result will be wrong. So we should add&#160;validation to prevent it.&lt;/p&gt;

&lt;p&gt;The SQL as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INSERT INTO A
SELECT B.amount, B.currency, C.amount, C.product 
FROM B join C FOR SYSTEM_TIME AS OF B.proctime 
on B.amount = cancat(C.amount, &lt;span class=&quot;code-quote&quot;&gt;&apos;r&apos;&lt;/span&gt;) and C.product = &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13266316">FLINK-14613</key>
            <summary>Add validation check when applying UDF to  tempral table key in  Temporal Table Join condition </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hailong wang">hailong wang</assignee>
                                    <reporter username="hailong wang">hailong wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 5 Nov 2019 11:49:51 +0000</created>
                <updated>Fri, 3 Jan 2020 02:51:12 +0000</updated>
                            <resolved>Fri, 3 Jan 2020 02:02:47 +0000</resolved>
                                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16967456" author="hailong wang" created="Tue, 5 Nov 2019 11:53:38 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;. What do you think,&#160; Can I go ahead on it. Thanks&lt;/p&gt;</comment>
                            <comment id="16968142" author="jark" created="Wed, 6 Nov 2019 07:45:50 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hailong+wang&quot; class=&quot;user-hover&quot; rel=&quot;hailong wang&quot;&gt;hailong wang&lt;/a&gt;, I don&apos;t fully understand it. The above exmaple doesn&apos;t contain UDF in join key. &lt;/p&gt;</comment>
                            <comment id="16968164" author="hailong wang" created="Wed, 6 Nov 2019 08:25:58 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, I sorry for giving a wrong example. I have updated. In short, when using UDF in&#160;tempral table join key, the result is error. For the join condition of &apos;&#160;B.amount = cancat(C.amount, &apos;r&apos;)&apos; is ignored, and the final condition is &apos;C.product = &apos;1&apos;.&lt;/p&gt;

&lt;p&gt;So when used like this, we should throw error when validation?&lt;/p&gt;</comment>
                            <comment id="16968204" author="jark" created="Wed, 6 Nov 2019 09:15:10 +0000"  >&lt;p&gt;For temporary solution, adding an exception is fine. However, even there is an UDF in the join key, if we still have other equi-conditions on field reference (above example), it should still work because we have lookup key.&lt;/p&gt;

&lt;p&gt;I think if the proper fixing is not a big job, we should fix the root problem. &lt;/p&gt;</comment>
                            <comment id="16969194" author="hailong wang" created="Thu, 7 Nov 2019 11:50:35 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, you are right. I have some misunderstanding before. There are two&#160;situation:&lt;/p&gt;

&lt;p&gt;(1) Join condition has&#160; an UDF in&#160;temporal join key and other&#160;equi-conditions. Example as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INSERT INTO A
SELECT B.amount, B.currency, C.amount, C.product 
FROM B join C FOR SYSTEM_TIME AS OF B.proctime 
on B.amount = cancat(C.amount, &lt;span class=&quot;code-quote&quot;&gt;&apos;r&apos;&lt;/span&gt;) and C.product = &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For now, the program runs&#160;normally. But the join condition of &apos;&#160;B.amount = cancat(C.amount, &apos;r&apos;)&apos; is ignored, and the final condition is &apos;C.product = &apos;1&apos;. So the result is error.&#160;So we should add &apos;B.amount = cancat(C.amount, &apos;r&apos;)&apos;&#160; to&#160;remainingJoinCondition.&lt;/p&gt;

&lt;p&gt;(2)&#160;Join condition only has&#160; an UDF in&#160;temporal join key.&#160;Example as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INSERT INTO A SELECT B.amount, B.currency, C.amount, C.product FROM B join C FOR SYSTEM_TIME AS OF B.proctime on B.amount = cancat(C.amount, &lt;span class=&quot;code-quote&quot;&gt;&apos;r&apos;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It will throw error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 Temporal table join requires an equality condition on fields of table &#8230;&#8230;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think it&apos;s reasonable. &lt;/p&gt;

&lt;p&gt;If we want to fix this, I think we should lookup the all rows from&#160;Temporal Table, and add&#160;remainingJoinCondition in JoinCollector.&lt;/p&gt;

&lt;p&gt;In conclusion, we should fix the first situation by adding &apos;B.amount = cancat(C.amount, &apos;r&apos;)&apos; to&#160;remainingJoinCondition.&lt;/p&gt;

&lt;p&gt;Thanks you.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16969944" author="jark" created="Fri, 8 Nov 2019 08:32:57 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hailong+wang&quot; class=&quot;user-hover&quot; rel=&quot;hailong wang&quot;&gt;hailong wang&lt;/a&gt;, you are right. I assigned this issue to you. Feel free to open pull request. &lt;/p&gt;</comment>
                            <comment id="17007171" author="jark" created="Fri, 3 Jan 2020 02:02:47 +0000"  >&lt;p&gt;1.11.0: 9637af38b415e08888e45dde06a220507c4f53ae&lt;br/&gt;
1.10.0: 33cd82238cdd0a590aa83a8b9afcdb4f639da5d6&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13270879">FLINK-14961</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13270879">FLINK-14961</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 45 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z089q8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>