<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4437] Lock evasion around lastTriggeredCheckpoint may lead to lost updates to related fields</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4437</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In CheckpointCoordinator#triggerCheckpoint():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// make sure the minimum interval between checkpoints has passed
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastTriggeredCheckpoint + minPauseBetweenCheckpoints &amp;gt; timestamp) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If two threads evaluate &apos;lastTriggeredCheckpoint + minPauseBetweenCheckpoints &amp;gt; timestamp&apos; in close proximity before lastTriggeredCheckpoint is updated, the two threads may have an inconsistent view of &quot;lastTriggeredCheckpoint&quot; and updates to fields correlated with &quot;lastTriggeredCheckpoint&quot; may be lost.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12998638">FLINK-4437</key>
            <summary>Lock evasion around lastTriggeredCheckpoint may lead to lost updates to related fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Aug 2016 00:19:02 +0000</created>
                <updated>Thu, 25 Aug 2016 17:07:00 +0000</updated>
                            <resolved>Thu, 25 Aug 2016 16:14:39 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15433216" author="stephanewen" created="Tue, 23 Aug 2016 17:13:01 +0000"  >&lt;p&gt;Actually, there are a few more things that can happen, for example one thread overtaking the other and checkpoint &lt;tt&gt;n+1&lt;/tt&gt; being triggered before checkpoint &lt;tt&gt;n&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I wonder whether we should just simply guard the entire method with a lock, and not release it in-between. Would be much simpler, and probably okay as well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;tedyu&lt;/a&gt; Do you want to take this issue?&lt;/p&gt;</comment>
                            <comment id="15433273" author="ram_krish" created="Tue, 23 Aug 2016 17:43:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;I wonder whether we should just simply guard the entire method with a lock, and not release it in-between. Would be much simpler, and probably okay as well.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1. I was actually planning to raise this.  Is there any minimum duration that we need to set for the interval between two checkpoints?  &lt;/p&gt;</comment>
                            <comment id="15433417" author="githubbot" created="Tue, 23 Aug 2016 19:12:15 +0000"  >&lt;p&gt;GitHub user tedyu opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4437&quot; title=&quot;Lock evasion around lastTriggeredCheckpoint may lead to lost updates to related fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4437&quot;&gt;&lt;del&gt;FLINK-4437&lt;/del&gt;&lt;/a&gt; Lock evasion around lastTriggeredCheckpoint may lead to lost updates to related fields&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Documentation&lt;/li&gt;
	&lt;li&gt;Documentation has been added for new functionality&lt;/li&gt;
	&lt;li&gt;Old documentation affected by the pull request has been updated&lt;/li&gt;
	&lt;li&gt;JavaDoc for public methods has been added&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tedyu/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tedyu/flink&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2409&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 682bf10a70789c76317d460a9c994ebf00f5a516&lt;br/&gt;
Author: tedyu &amp;lt;yuzhihong@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-08-23T19:10:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4437&quot; title=&quot;Lock evasion around lastTriggeredCheckpoint may lead to lost updates to related fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4437&quot;&gt;&lt;del&gt;FLINK-4437&lt;/del&gt;&lt;/a&gt; Lock evasion around lastTriggeredCheckpoint may lead to lost updates to related fields&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15434205" author="githubbot" created="Wed, 24 Aug 2016 05:30:27 +0000"  >&lt;p&gt;Github user ramkrish86 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    If the lock scope is going to be moved for the entire triggerCheckpoint() method then &lt;/p&gt;

&lt;p&gt;    `// since we released the lock in the meantime, we need to re-check&lt;br/&gt;
    				// that the conditions still hold. this is clumsy, but it allows us to&lt;br/&gt;
    				// release the lock in the meantime while calls to external services are&lt;br/&gt;
    				// blocking progress, and still gives us early checks that skip work&lt;br/&gt;
    				// if no checkpoint can happen anyways`&lt;/p&gt;

&lt;p&gt;    Then the above comment and the checks that we perform below it can also be removed since we don&apos;t release and acquire the lock again.&lt;/p&gt;</comment>
                            <comment id="15434624" author="githubbot" created="Wed, 24 Aug 2016 09:54:52 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Will merge this and remove redundant comments/code...&lt;/p&gt;</comment>
                            <comment id="15434634" author="githubbot" created="Wed, 24 Aug 2016 10:04:32 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Have to step back. This pull request is completely broken: It does not compile and after fixing this the build fails with checkstyle errors.&lt;/p&gt;

&lt;p&gt;    I would suggest to close it, I have actually reproduced this fix in the meantime.&lt;/p&gt;</comment>
                            <comment id="15434822" author="githubbot" created="Wed, 24 Aug 2016 12:23:45 +0000"  >&lt;p&gt;Github user tedyu commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Pardon.&lt;/p&gt;

&lt;p&gt;    See if the current formation is the same as your reproduction.&lt;/p&gt;</comment>
                            <comment id="15435027" author="githubbot" created="Wed, 24 Aug 2016 14:36:16 +0000"  >&lt;p&gt;Github user tedyu commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    What&apos;s the command line for running EventTimeWindowCheckpointingITCase alone ?&lt;/p&gt;

&lt;p&gt;    I tried &apos;mvn test -Dtest=EventTimeWindowCheckpointingITCase&apos; which didn&apos;t work.&lt;/p&gt;

&lt;p&gt;    Thanks&lt;/p&gt;</comment>
                            <comment id="15435172" author="githubbot" created="Wed, 24 Aug 2016 16:00:08 +0000"  >&lt;p&gt;Github user tedyu commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    Executing Maven:  -B -f /home/jenkins/jenkins-slave/workspace/flink-github-ci/pom.xml -Dmaven.repo.local=/home/jenkins/jenkins-slave/maven-repositories/1 clean install -Dflink.forkCount=1C&lt;br/&gt;
    ```&lt;br/&gt;
    I don&apos;t see flink-github-ci in the source tree.&lt;/p&gt;</comment>
                            <comment id="15435319" author="githubbot" created="Wed, 24 Aug 2016 17:15:48 +0000"  >&lt;p&gt;Github user tedyu commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I ran test suite which patch which failed here:&lt;br/&gt;
    ```&lt;br/&gt;
    Tests run: 2, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 201.106 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.runtime.jobmanager.TaskManagerFailsWithSlotSharingITCase&lt;br/&gt;
    The JobManager should handle gracefully failing task manager with slot sharing(org.apache.flink.runtime.jobmanager.TaskManagerFailsWithSlotSharingITCase)  Time elapsed: 200.43 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
    java.util.concurrent.TimeoutException: Futures timed out after &lt;span class=&quot;error&quot;&gt;&amp;#91;200000 milliseconds&amp;#93;&lt;/span&gt;&lt;br/&gt;
            at scala.concurrent.impl.Promise$DefaultPromise.ready(Promise.scala:219)&lt;br/&gt;
            at scala.concurrent.impl.Promise$DefaultPromise.ready(Promise.scala:153)&lt;br/&gt;
            at scala.concurrent.Await$$anonfun$ready$1.apply(package.scala:86)&lt;br/&gt;
            at scala.concurrent.Await$$anonfun$ready$1.apply(package.scala:86)&lt;br/&gt;
            at scala.concurrent.BlockContext$DefaultBlockContext$.blockOn(BlockContext.scala:53)&lt;br/&gt;
            at scala.concurrent.Await$.ready(package.scala:86)&lt;br/&gt;
            at org.apache.flink.runtime.minicluster.FlinkMiniCluster.waitForTaskManagersToBeRegistered(FlinkMiniCluster.scala:455)&lt;br/&gt;
            at org.apache.flink.runtime.minicluster.FlinkMiniCluster.waitForTaskManagersToBeRegistered(FlinkMiniCluster.scala:439)&lt;br/&gt;
            at org.apache.flink.runtime.minicluster.FlinkMiniCluster.start(FlinkMiniCluster.scala:330)&lt;br/&gt;
            at org.apache.flink.runtime.minicluster.FlinkMiniCluster.start(FlinkMiniCluster.scala:269)&lt;br/&gt;
            at org.apache.flink.runtime.testingUtils.TestingUtils$.startTestingCluster(TestingUtils.scala:86)&lt;br/&gt;
            at org.apache.flink.runtime.jobmanager.TaskManagerFailsWithSlotSharingITCase$$anonfun$1$$anonfun$apply$mcV$sp$1.apply$mcV$sp(TaskManagerFailsWithSlotSharingITCase.scala:73)&lt;br/&gt;
            at org.apache.flink.runtime.jobmanager.TaskManagerFailsWithSlotSharingITCase$$anonfun$1$$anonfun$apply$mcV$sp$1.apply(TaskManagerFailsWithSlotSharingITCase.scala:53)&lt;br/&gt;
            at org.apache.flink.runtime.jobmanager.TaskManagerFailsWithSlotSharingITCase$$anonfun$1$$anonfun$apply$mcV$sp$1.apply(TaskManagerFailsWithSlotSharingITCase.scala:53)&lt;br/&gt;
            at org.scalatest.Transformer$$anonfun$apply$1.apply$mcV$sp(Transformer.scala:22)&lt;br/&gt;
            at org.scalatest.OutcomeOf$class.outcomeOf(OutcomeOf.scala:85)&lt;br/&gt;
            at org.scalatest.OutcomeOf$.outcomeOf(OutcomeOf.scala:104)&lt;br/&gt;
            at org.scalatest.Transformer.apply(Transformer.scala:22)&lt;br/&gt;
            at org.scalatest.Transformer.apply(Transformer.scala:20)&lt;br/&gt;
            at org.scalatest.WordSpecLike$$anon$1.apply(WordSpecLike.scala:953)&lt;br/&gt;
            at org.scalatest.Suite$class.withFixture(Suite.scala:1122)&lt;br/&gt;
            at org.apache.flink.runtime.jobmanager.TaskManagerFailsWithSlotSharingITCase.withFixture(TaskManagerFailsWithSlotSharingITCase.scala:38)&lt;br/&gt;
    ```&lt;br/&gt;
    Doesn&apos;t seem to be related to patch.&lt;/p&gt;</comment>
                            <comment id="15435730" author="githubbot" created="Wed, 24 Aug 2016 21:22:12 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tedyu No problem, happens to everyone.&lt;/p&gt;

&lt;p&gt;    I actually took your code and extended it a bit. Merged in 4da40bcb9ea01cb0c5e6fd0d7472dc09397f648e&lt;/p&gt;</comment>
                            <comment id="15435731" author="stephanewen" created="Wed, 24 Aug 2016 21:23:13 +0000"  >&lt;p&gt;Fixed via 4da40bcb9ea01cb0c5e6fd0d7472dc09397f648e&lt;/p&gt;</comment>
                            <comment id="15437223" author="githubbot" created="Thu, 25 Aug 2016 17:00:43 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tedyu Should we close this pull request?&lt;/p&gt;</comment>
                            <comment id="15437238" author="githubbot" created="Thu, 25 Aug 2016 17:07:00 +0000"  >&lt;p&gt;Github user tedyu closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2409&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2409&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32jsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>