<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:32:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9027] Web UI does not cleanup temporary files</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9027</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The web UI creates two directories in &lt;tt&gt;java.io.tmp&lt;/tt&gt;, namely &lt;tt&gt;flink-web-&amp;lt;uuid&amp;gt;&lt;/tt&gt; and &lt;tt&gt;flink-web-upload-&amp;lt;uuid&amp;gt;&lt;/tt&gt; and both are not cleaned up (running &lt;tt&gt;start-cluster.sh&lt;/tt&gt; and &lt;tt&gt;stop-cluster.sh&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13146322">FLINK-9027</key>
            <summary>Web UI does not cleanup temporary files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Mar 2018 17:47:24 +0000</created>
                <updated>Fri, 23 Mar 2018 11:42:14 +0000</updated>
                            <resolved>Fri, 23 Mar 2018 11:42:14 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Runtime / Web Frontend</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16408528" author="githubbot" created="Wed, 21 Mar 2018 20:20:48 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5740&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;     &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9027&quot; title=&quot;Web UI does not cleanup temporary files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9027&quot;&gt;&lt;del&gt;FLINK-9027&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;web&amp;#93;&lt;/span&gt; Clean up web UI resources by installing shut down hook&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    The RestServerEndpoint creates temp directories to upload files and store the web ui.&lt;br/&gt;
    In case of a hard shut down, as it happens with bin/stop-cluster.sh we should still&lt;br/&gt;
    delete these files. We do this by installing a shut down hook.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Manually tested&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; cleanupWebUI&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5740.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5740.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5740&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 719abe3766f406e5b0cac4afc3597a084061769c&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@...&amp;gt;&lt;br/&gt;
Date:   2018-03-21T20:04:40Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9027&quot; title=&quot;Web UI does not cleanup temporary files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9027&quot;&gt;&lt;del&gt;FLINK-9027&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;web&amp;#93;&lt;/span&gt; Clean up web UI resources by installing shut down hook&lt;/p&gt;

&lt;p&gt;    The RestServerEndpoint creates temp directories to upload files and store the web ui.&lt;br/&gt;
    In case of a hard shut down, as it happens with bin/stop-cluster.sh we should still&lt;br/&gt;
    delete these files. We do this by installing a shut down hook.&lt;/p&gt;

&lt;p&gt;commit 659479f6d67b97bf63b66df57eeaf5c11195af73&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@...&amp;gt;&lt;br/&gt;
Date:   2018-03-21T20:08:13Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Make RestServerEndpoint#uploadDir protected&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16409220" author="githubbot" created="Thu, 22 Mar 2018 08:38:48 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5740&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The TaskManagers have one (or more) root directories for all temp files. They only have one shutdown hook that removes them at the very end. No separate hooks in the separate components.&lt;/p&gt;

&lt;p&gt;    Should we try and have the same in the JobManager?&lt;/p&gt;

&lt;p&gt;    Aside form that, I think previously users liked that the jar upload directory was not cleaned by default when they explicitly configured it. Does this change preserve the behavior?&lt;/p&gt;</comment>
                            <comment id="16409515" author="githubbot" created="Thu, 22 Mar 2018 13:30:45 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5740&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I agree that having a single shut down hook for cleaning up the temp directory is the best solution. I think that the `TaskManager` does not properly do it like you&apos;ve described. The `TaskExecutorLocalStateStoresManager` registers its own shut down hooks and most of the `TaskManager` components like `BlobCache`, `FileCache` and `IOManager` do so likewise.&lt;/p&gt;

&lt;p&gt;    The upload directory is a good point. With my changes it will always be deleted. If this is not the intended behaviour, then I will adapt it accordingly.&lt;/p&gt;

&lt;p&gt;    In order to not widen the scope of this task too much I would suggest the following: &lt;br/&gt;
    1. Addressing the general problem of reducing the number of shut down hooks in a separate issue&lt;br/&gt;
    2. Creating a a sub directory in `WebOptions#TMP_DIR` which is set up and cleaned up by the `ClusterEntrypoint` and its shut down hook&lt;/p&gt;

&lt;p&gt;    What do you think @StephanEwen.&lt;/p&gt;</comment>
                            <comment id="16409557" author="githubbot" created="Thu, 22 Mar 2018 13:59:39 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5740&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Okay, seems like the TaskManager design diverged from the &quot;single temp dir&quot; assumption we had originally.&lt;/p&gt;

&lt;p&gt;    How about creating the upload dir inside the web temp dir by default (then it is deleted), but not delete it explicitly (in which case it stays if users explicitly configure it to a different location)?&lt;/p&gt;</comment>
                            <comment id="16409587" author="githubbot" created="Thu, 22 Mar 2018 14:18:16 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5740&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sounds like a good idea.&lt;/p&gt;</comment>
                            <comment id="16411040" author="githubbot" created="Fri, 23 Mar 2018 09:06:42 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5740&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the feedback @StephanEwen. Merging this PR.&lt;/p&gt;</comment>
                            <comment id="16411264" author="githubbot" created="Fri, 23 Mar 2018 11:40:16 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5740&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16411267" author="till.rohrmann" created="Fri, 23 Mar 2018 11:42:14 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
master: e1805583b75ab7d31726cd605241e6faee793efb&lt;br/&gt;
1.5.0: 4fa4e8cb364c35ea1807a051929b4604b9d31c2e&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ri9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>