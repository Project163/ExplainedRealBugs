<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5007] Retain externalized checkpoint on suspension</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5007</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Externalized checkpoints are cleaned up when the job is suspended. Suspensions happen on graceful shut down (non-HA) or loss of leadership (HA).&lt;/p&gt;

&lt;p&gt;In case of HA, the checkpoint store does not clean up any checkpoints as they might be recovered by a new leader. The only way to stop a HA job is to actually cancel it. Therefore the configured clean up behaviour doesn&apos;t matter.&lt;/p&gt;

&lt;p&gt;In case of non-HA, suspensions happen because of graceful shut down (for example stopping a YARN session). In this case I would treat the clean up behaviour similar to cancelling the job.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ExternalizedCheckpointCleanup.DELETE_ON_CANCELLATION =&amp;gt; delete on suspension

ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION =&amp;gt; retain on suspension
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13017662">FLINK-5007</key>
            <summary>Retain externalized checkpoint on suspension</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uce">Ufuk Celebi</assignee>
                                    <reporter username="uce">Ufuk Celebi</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Nov 2016 14:46:41 +0000</created>
                <updated>Tue, 13 Dec 2016 08:40:51 +0000</updated>
                            <resolved>Tue, 13 Dec 2016 08:40:50 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15632974" author="githubbot" created="Thu, 3 Nov 2016 14:54:50 +0000"  >&lt;p&gt;GitHub user uce opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2750&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5007&quot; title=&quot;Retain externalized checkpoint on suspension&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5007&quot;&gt;&lt;del&gt;FLINK-5007&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;checkpointing&amp;#93;&lt;/span&gt; Retain externalized checkpoint on suspension&lt;/p&gt;

&lt;p&gt;    Handles graceful cluster shut down (non-HA) like cancellation and respects the configured clean up behaviour.&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    ExternalizedCheckpointCleanup.DELETE_ON_CANCELLATION =&amp;gt; delete on suspension&lt;/p&gt;

&lt;p&gt;    ExternalizedCheckpointCleanup.RETAIN_ON_CANCELLATION =&amp;gt; retain on suspension&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/uce/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/uce/flink&lt;/a&gt; 5007-suspend_external&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2750.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2750.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2750&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9f422c23c0e99259f39c84c292d034d70d8078cb&lt;br/&gt;
Author: Ufuk Celebi &amp;lt;uce@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-03T14:52:24Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5007&quot; title=&quot;Retain externalized checkpoint on suspension&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5007&quot;&gt;&lt;del&gt;FLINK-5007&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;checkpointing&amp;#93;&lt;/span&gt; Retain externalized checkpoint on suspension&lt;/p&gt;

&lt;p&gt;    Handles graceful cluster shut down (non-HA) like cancellation.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15701881" author="githubbot" created="Mon, 28 Nov 2016 12:45:25 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2750&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StephanEwen Do you have time to look at this? Currently, when externalized checkpoints are configured and the cluster shuts down via suspending all jobs, the externalized checkpoints are cleaned up. This PR proposes to handle suspension like a cancellation and respect the corresponding cleanup configuration, e.g. retain if `RETAIN_ON_CANCELLATION` and delete if `DELETE_ON_CANCELLATION`.&lt;/p&gt;</comment>
                            <comment id="15725895" author="githubbot" created="Tue, 6 Dec 2016 16:00:25 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2750&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    A suspension is usually a master failure or loss of leadership. Suspending a job does not delete/remove any HA checkpoints.&lt;/p&gt;

&lt;p&gt;    The same should be the case for externalized checkpoints, in my opinion. Why should an externalized checkpoint be deleted in suspend, when a regular one is not?&lt;/p&gt;</comment>
                            <comment id="15726235" author="githubbot" created="Tue, 6 Dec 2016 18:01:52 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2750&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In HA mode, checkpoints are not deleted on suspension. This PR won&apos;t change that behaviour. It only affects non-HA behaviour.&lt;/p&gt;

&lt;p&gt;    Currently, the behaviour is to remove checkpoints on suspension, which is definitely a problem. But in non-HA mode suspension happens also for graceful shut down (for example when terminating a YARN session). Never deleting on suspend means that users who have `DELETE_ON_CANCELLATION` configured, will have externalized checkpoints lingering around when they shut down their non-HA cluster. That&apos;s why I thought it might be better to treat this the same as the retain/delete on cancellation configuration.&lt;/p&gt;

&lt;p&gt;    Does this make sense? For HA, these setting do not apply during suspension.&lt;/p&gt;</comment>
                            <comment id="15742409" author="githubbot" created="Mon, 12 Dec 2016 16:42:43 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2750&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Okay, understood, that makes sense.&lt;/p&gt;

&lt;p&gt;    +1 from my side&lt;/p&gt;</comment>
                            <comment id="15744571" author="githubbot" created="Tue, 13 Dec 2016 08:40:01 +0000"  >&lt;p&gt;Github user uce closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2750&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15744575" author="uce" created="Tue, 13 Dec 2016 08:40:51 +0000"  >&lt;p&gt;Fixed in 38ab716 (master).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35sxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>