<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:20:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2462] Wrong exception reporting in streaming jobs</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2462</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When streaming tasks are fail and are canceled, they report a plethora of followup exceptions.&lt;/p&gt;

&lt;p&gt;The batch operators have a clear model that makes sure that root causes are reported, and followup exceptions are not reported. That makes debugging much easier.&lt;/p&gt;

&lt;p&gt;A big part of that is to have a single consistent place that logs exceptions, and that has a view of whether the operation is still running, or whether it has been canceled.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12850969">FLINK-2462</key>
            <summary>Wrong exception reporting in streaming jobs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sewen">Stephan Ewen</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                    </labels>
                <created>Sun, 2 Aug 2015 15:12:59 +0000</created>
                <updated>Thu, 28 Feb 2019 11:15:15 +0000</updated>
                            <resolved>Mon, 17 Aug 2015 12:15:49 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14697827" author="githubbot" created="Fri, 14 Aug 2015 21:49:10 +0000"  >&lt;p&gt;GitHub user StephanEwen opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2462&quot; title=&quot;Wrong exception reporting in streaming jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2462&quot;&gt;&lt;del&gt;FLINK-2462&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; Major cleanup of streaming task structure&lt;/p&gt;

&lt;p&gt;    This pull request addresses exception handling, code duplication, and missed resource cleanups in the streaming operators.&lt;/p&gt;

&lt;p&gt;    I mixed multiple issues in this pull request, which would have been better separated, but many were recognized in the rework, and it was tricky to pull the fixes apart.&lt;/p&gt;

&lt;p&gt;    *&lt;b&gt;NOTE&lt;/b&gt;* I have not managed to adjust all tests, yet, but I wanted to open this early for feedback.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Exception handling&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    The exceptions are no longer logged by the operators themselves. Operators perform only cleanup in reaction to exceptions.&lt;/p&gt;

&lt;p&gt;    Exceptions are reported only the the root Task object, which knows whether this is the first failure-causing exception (root cause), or is a subsequent exception, or whether the task was actually canceled already. In the later case, exceptions are ignored, because many cancellations lead to meaningless exceptions.&lt;/p&gt;

&lt;p&gt;    Added more exception in signatures, less exception wrapping where not needed&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Unified setup / teardown structure in streaming tasks&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Core resource acquisition/release logic is in `StreamTask`, reducing code duplication.&lt;br/&gt;
    Subtasks (e.g., `OneInputStreamTask`, `IterationTailStreamTask`) implement slim methods for certain parts of the life cycle. The `OneInputStreamTask` becomes as simple as this&lt;/p&gt;

&lt;p&gt;    ```java&lt;br/&gt;
    public void init() throws Exception &lt;/p&gt;
{
    	TypeSerializer&amp;lt;IN&amp;gt; inSerializer = configuration.getTypeSerializerIn1(getUserCodeClassLoader());
    	InputGate[] inputGates = getEnvironment().getAllInputGates();
    	inputProcessor = new StreamInputProcessor&amp;lt;IN&amp;gt;(inputGates, inSerializer,
    			getCheckpointBarrierListener(), 
    			configuration.getCheckpointMode(),
    			getEnvironment().getIOManager(),
    			getExecutionConfig().areTimestampsEnabled());
    
    	// make sure that stream tasks report their I/O statistics
    	AccumulatorRegistry registry = getEnvironment().getAccumulatorRegistry();
    	AccumulatorRegistry.Reporter reporter = registry.getReadWriteReporter();
    	inputProcessor.setReporter(reporter);
    }

&lt;p&gt;    protected void run() throws Exception &lt;/p&gt;
{
    	while (running &amp;amp;&amp;amp; inputProcessor.processInput(streamOperator));
    }

&lt;p&gt;    protected void cleanup() throws Exception &lt;/p&gt;
{
    	inputProcessor.cleanup();
    }

&lt;p&gt;    protected void cancelTask() &lt;/p&gt;
{
    	running = false;
    }
&lt;p&gt;    ```&lt;br/&gt;
    Guaranteed cleanup of output buffer and input buffer resources (formerly missed when other exceptions where encountered).&lt;/p&gt;

&lt;p&gt;    Unified `StreamRecordWriter` and `RecordWriter` usage.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Cleanup in the StreamSource&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Fix mixup in instantiation of source contexts in the stream source task&lt;/p&gt;

&lt;p&gt;    Auto watermark generators correctly shut down their interval scheduler&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;General&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Improve use of generics, got rid of many raw types&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StephanEwen/incubator-flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StephanEwen/incubator-flink&lt;/a&gt; stream_cleanup&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1017&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 68efed0a3b4184980de956bd57ba301569adac86&lt;br/&gt;
Author: Stephan Ewen &amp;lt;sewen@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-08-14T21:32:35Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2462&quot; title=&quot;Wrong exception reporting in streaming jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2462&quot;&gt;&lt;del&gt;FLINK-2462&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; Major cleanup of operator structure for exception handling and code simplication&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The exceptions are no longer logged by the operators themselves.&lt;br/&gt;
        Operators perform only cleanup in reaction to exceptions.&lt;br/&gt;
        Exceptions are reported only the the root Task object, which knows whether this is the first&lt;br/&gt;
        failure-causing exception (root cause), or is a subsequent exception, or whether the task was&lt;br/&gt;
        actually canceled already. In the later case, exceptions are ignored, because many&lt;br/&gt;
        cancellations lead to meaningless exceptions.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;more exception in signatures, less wrapping where not needed&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Core resource acquisition/release logic is in one streaming task, reducing code duplication&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Guaranteed cleanup of output buffer and input buffer resources (formerly missed when other exceptions where encountered)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Fix mixup in instantiation of source contexts in the stream source task&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Auto watermark generators correctly shut down their interval scheduler&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Improve use of generics, got rid of many raw types&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="14698413" author="githubbot" created="Sat, 15 Aug 2015 19:30:37 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#issuecomment-131431977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#issuecomment-131431977&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fixed the issues with the tests. Builds locally, waiting for Travis to confirm.&lt;/p&gt;</comment>
                            <comment id="14698554" author="githubbot" created="Sun, 16 Aug 2015 06:41:59 +0000"  >&lt;p&gt;Github user ffbin commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37142604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37142604&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -27,114 +26,65 @@&lt;br/&gt;
     import org.apache.flink.streaming.api.graph.StreamEdge;&lt;br/&gt;
     import org.apache.flink.streaming.api.operators.TwoInputStreamOperator;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor;&lt;br/&gt;
    -import org.slf4j.Logger;&lt;br/&gt;
    -import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;     public class TwoInputStreamTask&amp;lt;IN1, IN2, OUT&amp;gt; extends StreamTask&amp;lt;OUT, TwoInputStreamOperator&amp;lt;IN1, IN2, OUT&amp;gt;&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final Logger LOG = LoggerFactory.getLogger(TwoInputStreamTask.class);&lt;br/&gt;
    -&lt;br/&gt;
     	private StreamTwoInputProcessor&amp;lt;IN1, IN2&amp;gt; inputProcessor;&lt;br/&gt;
    +	&lt;br/&gt;
    +	private volatile boolean running = true;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void registerInputOutput() {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;super.registerInputOutput();&lt;br/&gt;
    +	public void init() throws Exception {&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;/li&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;br/&gt;
    +		int numberOfInputs = configuration.getNumberOfInputs();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int numberOfInputs = configuration.getNumberOfInputs();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;/li&gt;
	&lt;li&gt;int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;/li&gt;
	&lt;li&gt;InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;/li&gt;
	&lt;li&gt;switch (inputType) 
{
    -					case 1:
    -						inputList1.add(reader);
    -						break;
    -					case 2:
    -						inputList2.add(reader);
    -						break;
    -					default:
    -						throw new RuntimeException(&quot;Invalid input type number: &quot; + inputType);
    -				}
&lt;p&gt;    +		for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;br/&gt;
    +			int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;br/&gt;
    +			InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
    +			switch (inputType) {&lt;br/&gt;
    +				case 1:&lt;br/&gt;
    +					inputList1.add(reader);&lt;br/&gt;
    +					break;&lt;br/&gt;
    +				case 2:&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    what about use a enum to instead of 2, it will be easier to understand it.&lt;/p&gt;</comment>
                            <comment id="14698566" author="githubbot" created="Sun, 16 Aug 2015 07:41:34 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37143081&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37143081&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -27,114 +26,65 @@&lt;br/&gt;
     import org.apache.flink.streaming.api.graph.StreamEdge;&lt;br/&gt;
     import org.apache.flink.streaming.api.operators.TwoInputStreamOperator;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor;&lt;br/&gt;
    -import org.slf4j.Logger;&lt;br/&gt;
    -import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;     public class TwoInputStreamTask&amp;lt;IN1, IN2, OUT&amp;gt; extends StreamTask&amp;lt;OUT, TwoInputStreamOperator&amp;lt;IN1, IN2, OUT&amp;gt;&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final Logger LOG = LoggerFactory.getLogger(TwoInputStreamTask.class);&lt;br/&gt;
    -&lt;br/&gt;
     	private StreamTwoInputProcessor&amp;lt;IN1, IN2&amp;gt; inputProcessor;&lt;br/&gt;
    +	&lt;br/&gt;
    +	private volatile boolean running = true;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void registerInputOutput() {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;super.registerInputOutput();&lt;br/&gt;
    +	public void init() throws Exception {&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;/li&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;br/&gt;
    +		int numberOfInputs = configuration.getNumberOfInputs();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int numberOfInputs = configuration.getNumberOfInputs();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;/li&gt;
	&lt;li&gt;int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;/li&gt;
	&lt;li&gt;InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;/li&gt;
	&lt;li&gt;switch (inputType) 
{
    -					case 1:
    -						inputList1.add(reader);
    -						break;
    -					case 2:
    -						inputList2.add(reader);
    -						break;
    -					default:
    -						throw new RuntimeException(&quot;Invalid input type number: &quot; + inputType);
    -				}
&lt;p&gt;    +		for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;br/&gt;
    +			int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;br/&gt;
    +			InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
    +			switch (inputType) {&lt;br/&gt;
    +				case 1:&lt;br/&gt;
    +					inputList1.add(reader);&lt;br/&gt;
    +					break;&lt;br/&gt;
    +				case 2:&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    i don&apos;t think that&apos;s necessary as it is just an index starting at 1. The possible values 1 and 2 are clearly related to which inputList the reader is added to.&lt;/p&gt;</comment>
                            <comment id="14698612" author="githubbot" created="Sun, 16 Aug 2015 10:00:43 +0000"  >&lt;p&gt;Github user gyfora commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37144298&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37144298&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamIterationTail.java &amp;#8212;&lt;br/&gt;
    @@ -25,65 +25,68 @@&lt;br/&gt;
     import org.apache.flink.streaming.api.watermark.Watermark;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.io.BlockingQueueBroker;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.streamrecord.StreamRecord;&lt;br/&gt;
    -import org.apache.flink.util.StringUtils;&lt;br/&gt;
     import org.slf4j.Logger;&lt;br/&gt;
     import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;     public class StreamIterationTail&amp;lt;IN&amp;gt; extends OneInputStreamTask&amp;lt;IN, IN&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final Logger LOG = LoggerFactory.getLogger(StreamIterationTail.class);&lt;br/&gt;
    +	private static final Logger LOG = LoggerFactory.getLogger(StreamIterationHead.class);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This is probably a copy-paste error -&amp;gt; StreamIterationTail.class&lt;/p&gt;</comment>
                            <comment id="14698717" author="githubbot" created="Sun, 16 Aug 2015 15:13:20 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37146789&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37146789&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamIterationTail.java &amp;#8212;&lt;br/&gt;
    @@ -25,65 +25,68 @@&lt;br/&gt;
     import org.apache.flink.streaming.api.watermark.Watermark;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.io.BlockingQueueBroker;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.streamrecord.StreamRecord;&lt;br/&gt;
    -import org.apache.flink.util.StringUtils;&lt;br/&gt;
     import org.slf4j.Logger;&lt;br/&gt;
     import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;     public class StreamIterationTail&amp;lt;IN&amp;gt; extends OneInputStreamTask&amp;lt;IN, IN&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final Logger LOG = LoggerFactory.getLogger(StreamIterationTail.class);&lt;br/&gt;
    +	private static final Logger LOG = LoggerFactory.getLogger(StreamIterationHead.class);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yep, it is. Good catch!&lt;/p&gt;</comment>
                            <comment id="14698718" author="githubbot" created="Sun, 16 Aug 2015 15:15:56 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37146808&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37146808&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -27,114 +26,65 @@&lt;br/&gt;
     import org.apache.flink.streaming.api.graph.StreamEdge;&lt;br/&gt;
     import org.apache.flink.streaming.api.operators.TwoInputStreamOperator;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor;&lt;br/&gt;
    -import org.slf4j.Logger;&lt;br/&gt;
    -import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;     public class TwoInputStreamTask&amp;lt;IN1, IN2, OUT&amp;gt; extends StreamTask&amp;lt;OUT, TwoInputStreamOperator&amp;lt;IN1, IN2, OUT&amp;gt;&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final Logger LOG = LoggerFactory.getLogger(TwoInputStreamTask.class);&lt;br/&gt;
    -&lt;br/&gt;
     	private StreamTwoInputProcessor&amp;lt;IN1, IN2&amp;gt; inputProcessor;&lt;br/&gt;
    +	&lt;br/&gt;
    +	private volatile boolean running = true;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void registerInputOutput() {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;super.registerInputOutput();&lt;br/&gt;
    +	public void init() throws Exception {&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;/li&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;br/&gt;
    +		int numberOfInputs = configuration.getNumberOfInputs();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int numberOfInputs = configuration.getNumberOfInputs();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;/li&gt;
	&lt;li&gt;int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;/li&gt;
	&lt;li&gt;InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;/li&gt;
	&lt;li&gt;switch (inputType) 
{
    -					case 1:
    -						inputList1.add(reader);
    -						break;
    -					case 2:
    -						inputList2.add(reader);
    -						break;
    -					default:
    -						throw new RuntimeException(&quot;Invalid input type number: &quot; + inputType);
    -				}
&lt;p&gt;    +		for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;br/&gt;
    +			int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;br/&gt;
    +			InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
    +			switch (inputType) {&lt;br/&gt;
    +				case 1:&lt;br/&gt;
    +					inputList1.add(reader);&lt;br/&gt;
    +					break;&lt;br/&gt;
    +				case 2:&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This was actually part of the original code - I did not modify it as part of this pull request.&lt;br/&gt;
    As far as I see it, the `StreamEdge` code is part of the API, not the runtime. It may be adjusted as part of  #988 &lt;/p&gt;</comment>
                            <comment id="14699171" author="githubbot" created="Mon, 17 Aug 2015 08:26:16 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37166759&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37166759&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -27,114 +26,65 @@&lt;br/&gt;
     import org.apache.flink.streaming.api.graph.StreamEdge;&lt;br/&gt;
     import org.apache.flink.streaming.api.operators.TwoInputStreamOperator;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor;&lt;br/&gt;
    -import org.slf4j.Logger;&lt;br/&gt;
    -import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;     public class TwoInputStreamTask&amp;lt;IN1, IN2, OUT&amp;gt; extends StreamTask&amp;lt;OUT, TwoInputStreamOperator&amp;lt;IN1, IN2, OUT&amp;gt;&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final Logger LOG = LoggerFactory.getLogger(TwoInputStreamTask.class);&lt;br/&gt;
    -&lt;br/&gt;
     	private StreamTwoInputProcessor&amp;lt;IN1, IN2&amp;gt; inputProcessor;&lt;br/&gt;
    +	&lt;br/&gt;
    +	private volatile boolean running = true;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void registerInputOutput() {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;super.registerInputOutput();&lt;br/&gt;
    +	public void init() throws Exception {&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;/li&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;br/&gt;
    +		int numberOfInputs = configuration.getNumberOfInputs();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int numberOfInputs = configuration.getNumberOfInputs();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;/li&gt;
	&lt;li&gt;int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;/li&gt;
	&lt;li&gt;InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;/li&gt;
	&lt;li&gt;switch (inputType) 
{
    -					case 1:
    -						inputList1.add(reader);
    -						break;
    -					case 2:
    -						inputList2.add(reader);
    -						break;
    -					default:
    -						throw new RuntimeException(&quot;Invalid input type number: &quot; + inputType);
    -				}
&lt;p&gt;    +		for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;br/&gt;
    +			int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;br/&gt;
    +			InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
    +			switch (inputType) {&lt;br/&gt;
    +				case 1:&lt;br/&gt;
    +					inputList1.add(reader);&lt;br/&gt;
    +					break;&lt;br/&gt;
    +				case 2:&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The StreamEdge (and StreamNode) stuff is both part of the API and the runtime, the separation is not very clear. This is not changed in #988 but would have to be addressed in a follow-up PR.&lt;/p&gt;</comment>
                            <comment id="14699182" author="githubbot" created="Mon, 17 Aug 2015 08:32:45 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37167205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37167205&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/operators/Output.java &amp;#8212;&lt;br/&gt;
    @@ -33,9 +33,8 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Emits a 
{@link Watermark}
&lt;p&gt; from an operator. This watermark is broadcast to all downstream&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;operators.&lt;br/&gt;
     	 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* &amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;* A watermark specifies that no element with a timestamp older or equal to the watermark&lt;/li&gt;
	&lt;li&gt;* timestamp will be emitted in the future.&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;A watermark specifies that no element with a timestamp older or equal to the watermark
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why did you change this? The oracle Javadoc literature (&lt;a href=&quot;http://www.oracle.com/technetwork/articles/java/index-137868.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.oracle.com/technetwork/articles/java/index-137868.html&lt;/a&gt;) and style guides (&lt;a href=&quot;http://blog.joda.org/2012/11/javadoc-coding-standards.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://blog.joda.org/2012/11/javadoc-coding-standards.html&lt;/a&gt;) have it like it was. Javadoc is not HTML so tags like &amp;lt;li&amp;gt; &amp;lt;p&amp;gt; and so on are not closed.&lt;/p&gt;</comment>
                            <comment id="14699218" author="githubbot" created="Mon, 17 Aug 2015 08:55:41 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37168797&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37168797&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/SourceStreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -39,61 +37,40 @@&lt;br/&gt;
      */&lt;br/&gt;
     public class SourceStreamTask&amp;lt;OUT&amp;gt; extends StreamTask&amp;lt;OUT, StreamSource&amp;lt;OUT&amp;gt;&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final Logger LOG = LoggerFactory.getLogger(SourceStreamTask.class);&lt;br/&gt;
    -&lt;br/&gt;
     	@Override&lt;/li&gt;
	&lt;li&gt;public void invoke() throws Exception {&lt;/li&gt;
	&lt;li&gt;final SourceOutput&amp;lt;StreamRecord&amp;lt;OUT&amp;gt;&amp;gt; output = new SourceOutput&amp;lt;StreamRecord&amp;lt;OUT&amp;gt;&amp;gt;(outputHandler.getOutput(), checkpointLock);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;boolean operatorOpen = false;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;if (LOG.isDebugEnabled()) {&lt;/li&gt;
	&lt;li&gt;LOG.debug(&quot;Task {} invoked&quot;, getName());&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;openOperator();&lt;/li&gt;
	&lt;li&gt;operatorOpen = true;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;streamOperator.run(checkpointLock, output);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;closeOperator();&lt;/li&gt;
	&lt;li&gt;operatorOpen = false;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;if (LOG.isDebugEnabled()) {&lt;/li&gt;
	&lt;li&gt;LOG.debug(&quot;Task {} invocation finished&quot;, getName());&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;catch (Exception e) {&lt;/li&gt;
	&lt;li&gt;LOG.error(getEnvironment().getTaskNameWithSubtasks() + &quot; failed&quot;, e);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;if (operatorOpen) {&lt;/li&gt;
	&lt;li&gt;try 
{
    -					closeOperator();
    -				}&lt;/li&gt;
	&lt;li&gt;catch (Throwable t) 
{
    -					LOG.warn(&quot;Exception while closing operator.&quot;, t);
    -				}&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;throw e;&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;finally 
{
    -			this.isRunning = false;
    -			// Cleanup
    -			outputHandler.flushOutputs();
    -			clearBuffers();
    -		}
&lt;p&gt;    +	protected void init() &lt;/p&gt;
{
    +		// does not hold any resources, so no initialization needed
    +	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	@Override&lt;br/&gt;
    +	protected void cleanup() &lt;/p&gt;
{
    +		// does not hold any resources, so no cleanup needed
     	}
&lt;p&gt;    +	&lt;/p&gt;

&lt;p&gt;     	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void cancel() {&lt;/li&gt;
	&lt;li&gt;super.cancel();&lt;br/&gt;
    +	protected void run() throws Exception 
{
    +		final Object checkpointLock = getCheckpointLock();
    +		
    +		final SourceOutput&amp;lt;StreamRecord&amp;lt;OUT&amp;gt;&amp;gt; output = 
    +				new SourceOutput&amp;lt;StreamRecord&amp;lt;OUT&amp;gt;&amp;gt;(outputHandler.getOutput(), checkpointLock);
    +		
    +		streamOperator.run(checkpointLock, output);
    +	}
&lt;p&gt;    +	&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	protected void cancelTask() throws Exception &lt;/p&gt;
{
     		streamOperator.cancel();
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	// ------------------------------------------------------------------------&lt;br/&gt;
    +	&lt;br/&gt;
    +	// TODO:&lt;br/&gt;
    +	// does this help with anything? The losk should be already held by the source function that&lt;br/&gt;
    +	// emits. If that one does not hold the lock, then this does not help either.&lt;br/&gt;
    +	&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This is for the case where the source does not actually acquire the lock (because it is not participating in checkpointing). This might be a degenerate case, however, and not really necessary.&lt;/p&gt;</comment>
                            <comment id="14699220" author="githubbot" created="Mon, 17 Aug 2015 08:56:18 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#issuecomment-131735854&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#issuecomment-131735854&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This looks like a very nice continuation of the cleanup work. I&apos;d suggest to merge it rather sooner than later.&lt;/p&gt;</comment>
                            <comment id="14699335" author="githubbot" created="Mon, 17 Aug 2015 10:21:26 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37174502&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37174502&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/runtime/tasks/TwoInputStreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -27,114 +26,65 @@&lt;br/&gt;
     import org.apache.flink.streaming.api.graph.StreamEdge;&lt;br/&gt;
     import org.apache.flink.streaming.api.operators.TwoInputStreamOperator;&lt;br/&gt;
     import org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor;&lt;br/&gt;
    -import org.slf4j.Logger;&lt;br/&gt;
    -import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;     public class TwoInputStreamTask&amp;lt;IN1, IN2, OUT&amp;gt; extends StreamTask&amp;lt;OUT, TwoInputStreamOperator&amp;lt;IN1, IN2, OUT&amp;gt;&amp;gt; {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final Logger LOG = LoggerFactory.getLogger(TwoInputStreamTask.class);&lt;br/&gt;
    -&lt;br/&gt;
     	private StreamTwoInputProcessor&amp;lt;IN1, IN2&amp;gt; inputProcessor;&lt;br/&gt;
    +	&lt;br/&gt;
    +	private volatile boolean running = true;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void registerInputOutput() {&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;super.registerInputOutput();&lt;br/&gt;
    +	public void init() throws Exception {&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;br/&gt;
    +		TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN1&amp;gt; inputDeserializer1 = configuration.getTypeSerializerIn1(userClassLoader);&lt;/li&gt;
	&lt;li&gt;TypeSerializer&amp;lt;IN2&amp;gt; inputDeserializer2 = configuration.getTypeSerializerIn2(userClassLoader);&lt;br/&gt;
    +		int numberOfInputs = configuration.getNumberOfInputs();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int numberOfInputs = configuration.getNumberOfInputs();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList1 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;/li&gt;
	&lt;li&gt;ArrayList&amp;lt;InputGate&amp;gt; inputList2 = new ArrayList&amp;lt;InputGate&amp;gt;();&lt;br/&gt;
    +		List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;List&amp;lt;StreamEdge&amp;gt; inEdges = configuration.getInPhysicalEdges(userClassLoader);&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;/li&gt;
	&lt;li&gt;int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;/li&gt;
	&lt;li&gt;InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;/li&gt;
	&lt;li&gt;switch (inputType) 
{
    -					case 1:
    -						inputList1.add(reader);
    -						break;
    -					case 2:
    -						inputList2.add(reader);
    -						break;
    -					default:
    -						throw new RuntimeException(&quot;Invalid input type number: &quot; + inputType);
    -				}
&lt;p&gt;    +		for (int i = 0; i &amp;lt; numberOfInputs; i++) {&lt;br/&gt;
    +			int inputType = inEdges.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.getTypeNumber();&lt;br/&gt;
    +			InputGate reader = getEnvironment().getInputGate&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;;&lt;br/&gt;
    +			switch (inputType) {&lt;br/&gt;
    +				case 1:&lt;br/&gt;
    +					inputList1.add(reader);&lt;br/&gt;
    +					break;&lt;br/&gt;
    +				case 2:&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I would like to address that in a followup, as this creates conflicts with #988 otherwise.&lt;/p&gt;</comment>
                            <comment id="14699340" author="githubbot" created="Mon, 17 Aug 2015 10:24:25 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#discussion_r37174684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#discussion_r37174684&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-core/src/main/java/org/apache/flink/streaming/api/operators/Output.java &amp;#8212;&lt;br/&gt;
    @@ -33,9 +33,8 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Emits a 
{@link Watermark}
&lt;p&gt; from an operator. This watermark is broadcast to all downstream&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;operators.&lt;br/&gt;
     	 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* &amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;* A watermark specifies that no element with a timestamp older or equal to the watermark&lt;/li&gt;
	&lt;li&gt;* timestamp will be emitted in the future.&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;A watermark specifies that no element with a timestamp older or equal to the watermark
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    You are right. I think I saw it differently in some of Sun&apos;s classes, and copied the style.&lt;/p&gt;

&lt;p&gt;    It seems the changes to not hurt (JavaDocs interpret the HTML properly), but I&apos;ll stick with the official style in the future. Thanks for pointing that out.&lt;/p&gt;</comment>
                            <comment id="14699351" author="githubbot" created="Mon, 17 Aug 2015 10:33:15 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017#issuecomment-131772364&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017#issuecomment-131772364&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Allright, if there are no further comments, I&apos;ll merge this...&lt;/p&gt;</comment>
                            <comment id="14699439" author="githubbot" created="Mon, 17 Aug 2015 12:15:13 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1017&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1017&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14699442" author="stephanewen" created="Mon, 17 Aug 2015 12:15:49 +0000"  >&lt;p&gt;Fixed via 92b1e471d4762545637817c74f9396765984b39a&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i8tb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>