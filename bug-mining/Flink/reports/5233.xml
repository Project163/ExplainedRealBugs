<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:55:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22105] SubtaskCheckpointCoordinatorTest.testForceAlignedCheckpointResultingInPriorityEvents unstable</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22105</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/rmetzger/Flink/_build/results?buildId=9021&amp;amp;view=logs&amp;amp;j=9dc1b5dc-bcfa-5f83-eaa7-0cb181ddc267&amp;amp;t=ab910030-93db-52a7-74a3-34a0addb481b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/rmetzger/Flink/_build/results?buildId=9021&amp;amp;view=logs&amp;amp;j=9dc1b5dc-bcfa-5f83-eaa7-0cb181ddc267&amp;amp;t=ab910030-93db-52a7-74a3-34a0addb481b&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2021-04-01T19:29:55.2392858Z [ERROR] Tests run: 10, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1.921 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.streaming.runtime.tasks.SubtaskCheckpointCoordinatorTest
2021-04-01T19:29:55.2396751Z [ERROR] testForceAlignedCheckpointResultingInPriorityEvents(org.apache.flink.streaming.runtime.tasks.SubtaskCheckpointCoordinatorTest)  Time elapsed: 0.02 s  &amp;lt;&amp;lt;&amp;lt; ERROR!
2021-04-01T19:29:55.2397415Z java.lang.RuntimeException: unable to send request to worker
2021-04-01T19:29:55.2397956Z 	at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriterImpl.enqueue(ChannelStateWriterImpl.java:228)
2021-04-01T19:29:55.2398603Z 	at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriterImpl.finishOutput(ChannelStateWriterImpl.java:183)
2021-04-01T19:29:55.2399310Z 	at org.apache.flink.streaming.runtime.tasks.SubtaskCheckpointCoordinatorImpl.checkpointState(SubtaskCheckpointCoordinatorImpl.java:298)
2021-04-01T19:29:55.2400104Z 	at org.apache.flink.streaming.runtime.tasks.SubtaskCheckpointCoordinatorTest.testForceAlignedCheckpointResultingInPriorityEvents(SubtaskCheckpointCoordinatorTest.java:215)
2021-04-01T19:29:55.2400746Z 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
2021-04-01T19:29:55.2401202Z 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
2021-04-01T19:29:55.2401746Z 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
2021-04-01T19:29:55.2402237Z 	at java.lang.reflect.Method.invoke(Method.java:498)
2021-04-01T19:29:55.2402722Z 	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
2021-04-01T19:29:55.2403270Z 	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
2021-04-01T19:29:55.2403818Z 	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
2021-04-01T19:29:55.2404354Z 	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
2021-04-01T19:29:55.2404854Z 	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
2021-04-01T19:29:55.2405359Z 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
2021-04-01T19:29:55.2405896Z 	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
2021-04-01T19:29:55.2406393Z 	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
2021-04-01T19:29:55.2406855Z 	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
2021-04-01T19:29:55.2407331Z 	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
2021-04-01T19:29:55.2407806Z 	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
2021-04-01T19:29:55.2408279Z 	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
2021-04-01T19:29:55.2408907Z 	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
2021-04-01T19:29:55.2409403Z 	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
2021-04-01T19:29:55.2409954Z 	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
2021-04-01T19:29:55.2410524Z 	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
2021-04-01T19:29:55.2411318Z 	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
2021-04-01T19:29:55.2411880Z 	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
2021-04-01T19:29:55.2412467Z 	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
2021-04-01T19:29:55.2413006Z 	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
2021-04-01T19:29:55.2413519Z 	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
2021-04-01T19:29:55.2414082Z Caused by: java.lang.IllegalArgumentException: writer not found &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing request: writeOutput 0
2021-04-01T19:29:55.2414726Z 	at org.apache.flink.runtime.checkpoint.channel.CheckpointInProgressRequest.onWriterMissing(ChannelStateWriteRequest.java:223)
2021-04-01T19:29:55.2415463Z 	at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestDispatcherImpl.dispatchInternal(ChannelStateWriteRequestDispatcherImpl.java:80)
2021-04-01T19:29:55.2416331Z 	at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestDispatcherImpl.dispatch(ChannelStateWriteRequestDispatcherImpl.java:59)
2021-04-01T19:29:55.2417066Z 	at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestExecutorImpl.loop(ChannelStateWriteRequestExecutorImpl.java:96)
2021-04-01T19:29:55.2417782Z 	at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestExecutorImpl.run(ChannelStateWriteRequestExecutorImpl.java:75)
2021-04-01T19:29:55.2418329Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2021-04-01T19:29:55.2418741Z 	Suppressed: java.lang.IllegalStateException: not running
2021-04-01T19:29:55.2419343Z 		at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestExecutorImpl.ensureRunning(ChannelStateWriteRequestExecutorImpl.java:152)
2021-04-01T19:29:55.2420249Z 		at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestExecutorImpl.submitInternal(ChannelStateWriteRequestExecutorImpl.java:144)
2021-04-01T19:29:55.2421010Z 		at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriteRequestExecutorImpl.submit(ChannelStateWriteRequestExecutorImpl.java:128)
2021-04-01T19:29:55.2421694Z 		at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriterImpl.enqueue(ChannelStateWriterImpl.java:225)
2021-04-01T19:29:55.2422333Z 		at org.apache.flink.runtime.checkpoint.channel.ChannelStateWriterImpl.finishOutput(ChannelStateWriterImpl.java:183)
2021-04-01T19:29:55.2423029Z 		at org.apache.flink.streaming.runtime.tasks.SubtaskCheckpointCoordinatorImpl.checkpointState(SubtaskCheckpointCoordinatorImpl.java:298)
2021-04-01T19:29:55.2423820Z 		at org.apache.flink.streaming.runtime.tasks.SubtaskCheckpointCoordinatorTest.testForceAlignedCheckpointResultingInPriorityEvents(SubtaskCheckpointCoordinatorTest.java:215)
2021-04-01T19:29:55.2425923Z 		at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
2021-04-01T19:29:55.2426529Z 		at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
2021-04-01T19:29:55.2427162Z 		at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
2021-04-01T19:29:55.2427727Z 		at java.lang.reflect.Method.invoke(Method.java:498)
2021-04-01T19:29:55.2428283Z 		at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
2021-04-01T19:29:55.2429008Z 		at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
2021-04-01T19:29:55.2429611Z 		at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
2021-04-01T19:29:55.2430357Z 		at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
2021-04-01T19:29:55.2430921Z 		at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
2021-04-01T19:29:55.2431809Z 		at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
2021-04-01T19:29:55.2432459Z 		at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
2021-04-01T19:29:55.2433013Z 		at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
2021-04-01T19:29:55.2433513Z 		at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
2021-04-01T19:29:55.2434043Z 		at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
2021-04-01T19:29:55.2434568Z 		at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
2021-04-01T19:29:55.2435093Z 		at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
2021-04-01T19:29:55.2435609Z 		at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
2021-04-01T19:29:55.2436161Z 		at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
2021-04-01T19:29:55.2436772Z 		at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
2021-04-01T19:29:55.2437399Z 		at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
2021-04-01T19:29:55.2438127Z 		at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
2021-04-01T19:29:55.2438881Z 		at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
2021-04-01T19:29:55.2439509Z 		at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
2021-04-01T19:29:55.2440088Z 		at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
2021-04-01T19:29:55.2440642Z 		at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
2021-04-01T19:29:55.2440899Z 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13369255">FLINK-22105</key>
            <summary>SubtaskCheckpointCoordinatorTest.testForceAlignedCheckpointResultingInPriorityEvents unstable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Fri, 2 Apr 2021 07:43:42 +0000</created>
                <updated>Tue, 6 Jul 2021 20:46:11 +0000</updated>
                            <resolved>Tue, 6 Jul 2021 20:46:11 +0000</resolved>
                                    <version>1.13.0</version>
                    <version>1.12.4</version>
                                    <fixVersion>1.13.0</fixVersion>
                    <fixVersion>1.12.5</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17316160" author="roman_khachatryan" created="Wed, 7 Apr 2021 09:22:47 +0000"  >&lt;p&gt;The immediate cause is that the test writes channel state but doesn&apos;t register a checkpoint with the writer.&lt;/p&gt;

&lt;p&gt;The reason why it is unstable is that writer is async and it isn&apos;t closed in the test (which would fail).&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
 edit: production code path handles this case correctly (by calling channelStateWriter.start from SubtaskCheckpointCoordinatorImpl.initInputsCheckpoint)&lt;/p&gt;

&lt;p&gt;&lt;del&gt;IIUC, this can also happen in production, for example given DAG:&lt;/del&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
src ---pointwise--&amp;gt; op1&#160;---hash--&amp;gt; op2 ---&amp;gt; sink&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ol&gt;
	&lt;li&gt;src will convert the barrier before sending to op1 to force aligned&lt;/li&gt;
	&lt;li&gt;op1 will NOT start writing channel state (because&#160;alignmentType != UNALIGNED)&lt;/li&gt;
	&lt;li&gt;op1 will convert the barrier back to unaligned before broadcasting it&lt;/li&gt;
	&lt;li&gt;op1 will call&#160;finishOutput as barrier is now UNALIGNED&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&lt;del&gt;The fix is pretty simple though: in (4) check the alignment type of the original barrier (as it was received).&lt;/del&gt;&lt;/p&gt;


&lt;p&gt;cc: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17316443" author="roman_khachatryan" created="Wed, 7 Apr 2021 15:54:09 +0000"  >&lt;p&gt;Merged into master 3cf8597cf3bcccc847519fa12925a2b984e80304&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17374458" author="xintongsong" created="Mon, 5 Jul 2021 02:46:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;By any chance this issue also affects release-1.12?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=19856&amp;amp;view=logs&amp;amp;j=77a9d8e1-d610-59b3-fc2a-4766541e0e33&amp;amp;t=7c61167f-30b3-5893-cc38-a9e3d057e392&amp;amp;l=8723&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=19856&amp;amp;view=logs&amp;amp;j=77a9d8e1-d610-59b3-fc2a-4766541e0e33&amp;amp;t=7c61167f-30b3-5893-cc38-a9e3d057e392&amp;amp;l=8723&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17374460" author="xintongsong" created="Mon, 5 Jul 2021 02:49:07 +0000"  >&lt;p&gt;I&apos;m reopening the ticket and adding 1.12 as affected version for now. Feel free to change it back if I&apos;m wrong.&lt;/p&gt;</comment>
                            <comment id="17375780" author="roman_khachatryan" created="Tue, 6 Jul 2021 15:08:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt; &lt;br/&gt;
 Yes, it&apos;s also present in 1.12 (I think it was &quot;backported&quot; by&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22815&quot; title=&quot;Disable unaligned checkpoints for broadcast partitioning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22815&quot;&gt;&lt;del&gt;FLINK-22815&lt;/del&gt;&lt;/a&gt; after this issue was closed).&lt;br/&gt;
 I&apos;ll open a backport PR.&lt;/p&gt;</comment>
                            <comment id="17376015" author="roman_khachatryan" created="Tue, 6 Jul 2021 20:46:11 +0000"  >&lt;p&gt;Merged into 1.12 as&#160;ae24c979a2a5754de41dba9f0b336d14a181a03c..4ef1427b1f0b5882ade6f3fc776763ab6ade1674.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ph6o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>