<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5626] Improve resource release in RocksDBKeyedStateBackend</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5626</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I found some minor cases in which some resources in `RocksDBKeyedStateBackend` might not get properly released in case of an exception, because their ownership is not completely transferred to the closing entity.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13037312">FLINK-5626</key>
            <summary>Improve resource release in RocksDBKeyedStateBackend</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srichter">Stefan Richter</assignee>
                                    <reporter username="srichter">Stefan Richter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jan 2017 09:22:00 +0000</created>
                <updated>Wed, 25 Jan 2017 16:57:05 +0000</updated>
                            <resolved>Wed, 25 Jan 2017 16:56:47 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15835897" author="githubbot" created="Tue, 24 Jan 2017 09:26:04 +0000"  >&lt;p&gt;GitHub user StefanRRichter opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5626&quot; title=&quot;Improve resource release in RocksDBKeyedStateBackend&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5626&quot;&gt;&lt;del&gt;FLINK-5626&lt;/del&gt;&lt;/a&gt; Improved resource deallocation in RocksDBKeyedStateBackend&lt;/p&gt;

&lt;p&gt;    This PR improves some cases of resource deallocation for RocksDB under exceptions. On top of that, I gave some exceptions a more appropriate type.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StefanRRichter/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StefanRRichter/flink&lt;/a&gt; RocksHardening&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3198&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a30466009e0431aa884f7d358ecb2f386d4feb01&lt;br/&gt;
Author: Stefan Richter &amp;lt;s.richter@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2017-01-19T17:08:02Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5626&quot; title=&quot;Improve resource release in RocksDBKeyedStateBackend&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5626&quot;&gt;&lt;del&gt;FLINK-5626&lt;/del&gt;&lt;/a&gt; Improved resource deallocation in RocksDBKeyedStateBackend&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15835898" author="githubbot" created="Tue, 24 Jan 2017 09:26:19 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc @tillrohrmann &lt;/p&gt;</comment>
                            <comment id="15836023" author="githubbot" created="Tue, 24 Jan 2017 11:10:49 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97521501&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97521501&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-contrib/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBKeyedStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -345,7 +337,7 @@ public void done(boolean canceled) {&lt;br/&gt;
     		/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;1) Create a snapshot object from RocksDB.&lt;br/&gt;
     		 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param checkpointId id of the checkpoint for which we take the snapshot&lt;br/&gt;
    +		 * @param checkpointId        id of the checkpoint for which we take the snapshot
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think we don&apos;t do these kind of alignments because they increase the maintenance overhead when renaming parameters.&lt;/p&gt;</comment>
                            <comment id="15836024" author="githubbot" created="Tue, 24 Jan 2017 11:10:49 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97521254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97521254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-contrib/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBKeyedStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -201,12 +191,12 @@ public void dispose() {&lt;br/&gt;
     				for (Tuple2&amp;lt;ColumnFamilyHandle, RegisteredBackendStateMetaInfo&amp;lt;?, ?&amp;gt;&amp;gt; column :&lt;br/&gt;
     						kvStateInformation.values()) &lt;/p&gt;
{
     
    -					column.f0.close();
    +					IOUtils.closeQuietly(column.f0);
     				}

&lt;p&gt;     				kvStateInformation.clear();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;db.close();&lt;br/&gt;
    +				IOUtils.closeQuietly(db);&lt;br/&gt;
     				db = null;&lt;br/&gt;
     			}&lt;br/&gt;
     		}
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Not visible here, but just the next catch clause swallows its caught exception.&lt;/p&gt;</comment>
                            <comment id="15836025" author="githubbot" created="Tue, 24 Jan 2017 11:10:49 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97523023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97523023&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/AbstractStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -66,4 +66,9 @@ public OperatorStateBackend createOperatorStateBackend(&lt;br/&gt;
     			String operatorIdentifier) throws Exception &lt;/p&gt;
{
     		return new DefaultOperatorStateBackend(env.getUserClassLoader());
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public void close() throws Exception &lt;/p&gt;
{
    +
    +	}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Does it make sense to not implement the `close` method here? Then all subclasses would be forced to think about what happens when closing the state backend?&lt;/p&gt;</comment>
                            <comment id="15836026" author="githubbot" created="Tue, 24 Jan 2017 11:10:49 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97522787&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97522787&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/util/IOUtils.java &amp;#8212;&lt;br/&gt;
    @@ -216,9 +215,52 @@ public static void closeSocket(final Socket sock) {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Closes all &lt;/p&gt;
{@link AutoCloseable}
&lt;p&gt; objects in the parameter, suppressing exceptions. Exception will be emitted&lt;br/&gt;
    +	 * after calling close() on every object.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param closeables iterable with closeables to close.&lt;br/&gt;
    +	 * @throws Exception collected exceptions that occurred during closing&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void closeAll(Iterable&amp;lt;? extends AutoCloseable&amp;gt; closeables) throws Exception {&lt;br/&gt;
    +		if (null != closeables) {&lt;br/&gt;
    +&lt;br/&gt;
    +			Exception collectedExceptions = null;&lt;br/&gt;
    +&lt;br/&gt;
    +			for (AutoCloseable closeable : closeables) {&lt;br/&gt;
    +				try {&lt;br/&gt;
    +					if (null != closeable) &lt;/p&gt;
{
    +						closeable.close();
    +					}
&lt;p&gt;    +				} catch (Exception e) {&lt;br/&gt;
    +					if (null == collectedExceptions) &lt;/p&gt;
{
    +						collectedExceptions = e;
    +					}
&lt;p&gt; else &lt;/p&gt;
{
    +						collectedExceptions.addSuppressed(e);
    +					}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Here you could use `collectedExceptions = ExceptionUtils.firstOrSuppressed(e, collectedExceptions);`&lt;/p&gt;</comment>
                            <comment id="15836027" author="githubbot" created="Tue, 24 Jan 2017 11:10:49 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97520822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97520822&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-contrib/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBKeyedStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -148,16 +140,14 @@ public RocksDBKeyedStateBackend(&lt;br/&gt;
     	) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think this can now be narrowed down to `IOException`.&lt;/p&gt;</comment>
                            <comment id="15836028" author="githubbot" created="Tue, 24 Jan 2017 11:10:49 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97520420&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97520420&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-contrib/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBKeyedStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -148,16 +140,14 @@ public RocksDBKeyedStateBackend(&lt;br/&gt;
     	) throws Exception {&lt;/p&gt;

&lt;p&gt;     		super(kvStateRegistry, keySerializer, userCodeClassLoader, numberOfKeyGroups, keyGroupRange);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this.operatorIdentifier = operatorIdentifier;&lt;/li&gt;
	&lt;li&gt;this.jobId = jobId;&lt;br/&gt;
     		this.columnOptions = columnFamilyOptions;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		this.instanceBasePath = instanceBasePath;&lt;br/&gt;
     		this.instanceRocksDBPath = new File(instanceBasePath, &quot;db&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Maybe we could add here `Preconditions` checks?&lt;/p&gt;</comment>
                            <comment id="15836033" author="githubbot" created="Tue, 24 Jan 2017 11:14:30 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97523685&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97523685&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/AbstractStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -66,4 +66,9 @@ public OperatorStateBackend createOperatorStateBackend(&lt;br/&gt;
     			String operatorIdentifier) throws Exception &lt;/p&gt;
{
     		return new DefaultOperatorStateBackend(env.getUserClassLoader());
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public void close() throws Exception &lt;/p&gt;
{
    +
    +	}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I absolutely agree, but I am afraid that this might be a breaking API change. Maybe @aljoscha can give a second opinion about this.&lt;/p&gt;</comment>
                            <comment id="15836042" author="githubbot" created="Tue, 24 Jan 2017 11:20:12 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97524568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97524568&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-contrib/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBKeyedStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -245,14 +235,15 @@ public int getKeyGroupPrefixBytes() {&lt;br/&gt;
     		// hold the db lock while operation on the db to guard us against async db disposal&lt;br/&gt;
     		synchronized (asyncSnapshotLock) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (kvStateInformation.isEmpty()) {&lt;/li&gt;
	&lt;li&gt;LOG.info(&quot;Asynchronous RocksDB snapshot performed on empty keyed state at &quot; + timestamp +&lt;/li&gt;
	&lt;li&gt;&quot; . Returning null.&quot;);&lt;br/&gt;
    +			if (db != null) 
{
     
    -				return new DoneFuture&amp;lt;&amp;gt;(null);
    -			}
&lt;p&gt;    +				if (kvStateInformation.isEmpty()) {&lt;br/&gt;
    +					LOG.info(&quot;Asynchronous RocksDB snapshot performed on empty keyed state at &quot; + timestamp +&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Wondering whether we should log this on debug. As a user, I don&apos;t know how useful this is for me when I see this message in my logs.&lt;/p&gt;</comment>
                            <comment id="15836046" author="githubbot" created="Tue, 24 Jan 2017 11:22:39 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97524989&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97524989&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/AbstractStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -66,4 +66,9 @@ public OperatorStateBackend createOperatorStateBackend(&lt;br/&gt;
     			String operatorIdentifier) throws Exception &lt;/p&gt;
{
     		return new DefaultOperatorStateBackend(env.getUserClassLoader());
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public void close() throws Exception &lt;/p&gt;
{
    +
    +	}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Do you mean for users implementing their own state backends?&lt;/p&gt;</comment>
                            <comment id="15836052" author="githubbot" created="Tue, 24 Jan 2017 11:26:49 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97525648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97525648&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/AbstractStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -66,4 +66,9 @@ public OperatorStateBackend createOperatorStateBackend(&lt;br/&gt;
     			String operatorIdentifier) throws Exception &lt;/p&gt;
{
     		return new DefaultOperatorStateBackend(env.getUserClassLoader());
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public void close() throws Exception &lt;/p&gt;
{
    +
    +	}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    yes&lt;/p&gt;</comment>
                            <comment id="15836108" author="githubbot" created="Tue, 24 Jan 2017 13:01:21 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97540340&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97540340&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/AbstractStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -66,4 +66,9 @@ public OperatorStateBackend createOperatorStateBackend(&lt;br/&gt;
     			String operatorIdentifier) throws Exception &lt;/p&gt;
{
     		return new DefaultOperatorStateBackend(env.getUserClassLoader());
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public void close() throws Exception &lt;/p&gt;
{
    +
    +	}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    `AbstractStateBackend` has never been part of the public API. Given that, we won&apos;t break at least the API stability promise.&lt;/p&gt;</comment>
                            <comment id="15836109" author="githubbot" created="Tue, 24 Jan 2017 13:01:37 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97540391&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97540391&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-contrib/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBKeyedStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -245,14 +235,15 @@ public int getKeyGroupPrefixBytes() {&lt;br/&gt;
     		// hold the db lock while operation on the db to guard us against async db disposal&lt;br/&gt;
     		synchronized (asyncSnapshotLock) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (kvStateInformation.isEmpty()) {&lt;/li&gt;
	&lt;li&gt;LOG.info(&quot;Asynchronous RocksDB snapshot performed on empty keyed state at &quot; + timestamp +&lt;/li&gt;
	&lt;li&gt;&quot; . Returning null.&quot;);&lt;br/&gt;
    +			if (db != null) 
{
     
    -				return new DoneFuture&amp;lt;&amp;gt;(null);
    -			}
&lt;p&gt;    +				if (kvStateInformation.isEmpty()) {&lt;br/&gt;
    +					LOG.info(&quot;Asynchronous RocksDB snapshot performed on empty keyed state at &quot; + timestamp +&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="15836127" author="githubbot" created="Tue, 24 Jan 2017 13:29:06 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I changed my PR as suggested by @uce and @tillrohrmann.&lt;/p&gt;</comment>
                            <comment id="15836167" author="githubbot" created="Tue, 24 Jan 2017 14:11:36 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97553270&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97553270&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-contrib/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/RocksDBKeyedStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -773,12 +783,13 @@ private void restoreKVStateData() throws IOException, RocksDBException {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;we don&apos;t restore the individual k/v states, just the global RocksDB data base and the&lt;/li&gt;
	&lt;li&gt;list of column families. When a k/v state is first requested we check here whether we&lt;/li&gt;
	&lt;li&gt;already have a column family for that and return it or create a new one if it doesn&apos;t exist.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    superfluous `&amp;lt;p&amp;gt;`&lt;/p&gt;</comment>
                            <comment id="15836172" author="githubbot" created="Tue, 24 Jan 2017 14:18:59 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97554901&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97554901&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/AbstractStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -66,4 +66,9 @@ public OperatorStateBackend createOperatorStateBackend(&lt;br/&gt;
     			String operatorIdentifier) throws Exception &lt;/p&gt;
{
     		return new DefaultOperatorStateBackend(env.getUserClassLoader());
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public void close() throws Exception &lt;/p&gt;
{
    +
    +	}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The reason for not renaming it is because it&apos;s used in the (admittedly `@PublicEvolcing`) method `StreamExecutionEnvironment.setStateBackend()`. If we didn&apos;t have that I would also prefer renaming this to something like `StateBackendFactory`.&lt;/p&gt;

&lt;p&gt;    The fact that it is in fact a factory (that should be stateless) makes me a bit uneasy about adding a `close()` method to the `AbstractStateBackend`. Why is it needed, in fact?&lt;/p&gt;</comment>
                            <comment id="15836187" author="githubbot" created="Tue, 24 Jan 2017 14:32:58 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198#discussion_r97558004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198#discussion_r97558004&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/AbstractStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -66,4 +66,9 @@ public OperatorStateBackend createOperatorStateBackend(&lt;br/&gt;
     			String operatorIdentifier) throws Exception &lt;/p&gt;
{
     		return new DefaultOperatorStateBackend(env.getUserClassLoader());
     	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public void close() throws Exception &lt;/p&gt;
{
    +
    +	}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Releasing some native resources in `RocksDBStateBackend`.&lt;/p&gt;</comment>
                            <comment id="15837387" author="githubbot" created="Wed, 25 Jan 2017 08:46:52 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think we can keep from having to close the `AbstractStateBackend` by not caching the `dbOptions` and `columnOptions` and instead giving new ones to the `RocksDBKeyedStateBackend`.  The keyed backend is not meant to be stateless and already has a lifecycle and will be disposed. It would simply take ownership of these options as well which would make responsibilities more clear.&lt;/p&gt;

&lt;p&gt;    Sorry for being annoying about this but I would really like to keep the &quot;state backend factory&quot; as a factory and not add lifecycle stuff to it as well.&lt;/p&gt;</comment>
                            <comment id="15837448" author="githubbot" created="Wed, 25 Jan 2017 09:38:38 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Aljoscha&apos;s proposal sounds reasonable to me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15837456" author="githubbot" created="Wed, 25 Jan 2017 09:42:52 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    If the caching is optional, then I would also prefer to keep it out of the factory. Different question: if there is no other reason against it, wouldn&apos;t that also be an opportunity to rename this to abstract factory? &lt;/p&gt;</comment>
                            <comment id="15837488" author="githubbot" created="Wed, 25 Jan 2017 09:52:16 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The is already `StateBackendFactory`. &#128521; Both are used in the &quot;public&quot; APIs: `StateBackendFactory` is used for setting a backend in the config while `AbstractStateBackend` appears in a public method on `StreamExecutionEnvironment`.&lt;/p&gt;

&lt;p&gt;    Bringing in @rmetzger, the API stability czar. &#128515;  &lt;/p&gt;</comment>
                            <comment id="15837495" author="githubbot" created="Wed, 25 Jan 2017 09:54:33 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I would call this `AbstractStateBackendFactory`, because that is what it is...an abstract factory for state backends.&lt;/p&gt;</comment>
                            <comment id="15837496" author="githubbot" created="Wed, 25 Jan 2017 09:54:49 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Renaming is not part of this PR/Jira Issue, though, so with the changes to ownership of the RocksDB options I would like to merge this quickly. We can then open another issue for the renaming, if it can happen at all.&lt;/p&gt;</comment>
                            <comment id="15837498" author="githubbot" created="Wed, 25 Jan 2017 09:55:14 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Alright, then I am changing this first.&lt;/p&gt;</comment>
                            <comment id="15837899" author="githubbot" created="Wed, 25 Jan 2017 15:25:21 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 to these changes, very good!&lt;/p&gt;</comment>
                            <comment id="15838116" author="uce" created="Wed, 25 Jan 2017 16:56:47 +0000"  >&lt;p&gt;Fixed in 5a435fc (release-1.2), cd9115f (master).&lt;/p&gt;</comment>
                            <comment id="15838119" author="githubbot" created="Wed, 25 Jan 2017 16:57:05 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3198&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3198&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i394dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>