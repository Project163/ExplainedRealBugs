<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:20:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-35498] Unexpected argument name conflict error when do extract method params from udf</title>
                <link>https://issues.apache.org/jira/browse/FLINK-35498</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Follow the steps to reproduce the error:&lt;/p&gt;

&lt;p&gt;test case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
util.addTemporarySystemFunction(&lt;span class=&quot;code-quote&quot;&gt;&quot;myudf&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestXyz)
util.tableEnv.explainSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select&#160;myudf(f1, f2) from t&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;udf: TestXyz&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestXyz &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ScalarFunction {
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; eval(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s1, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s2) {

&lt;span class=&quot;code-comment&quot;&gt;// will not fail &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; add initialization
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; localV1;

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (s1 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (s2 != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
localV1 = s2;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
localV1 = s2 + s1;
}
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;xx&quot;&lt;/span&gt;.equals(s2)) {
localV1 = s1.length() &amp;gt;= s2.length() ? s1 : s2;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
localV1 = s1;
}
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (s1 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; s2 + localV1;
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (s2 == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; s1;
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; s1.length() &amp;gt;= s2.length() ? s1 + localV1 : s2;
}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;error stack:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.apache.flink.table.api.ValidationException: Unable to extract a type inference from method:
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; org.apache.flink.table.planner.runtime.utils.TestXyz.eval(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;,java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)
&#160; &#160; at org.apache.flink.table.types.extraction.ExtractionUtils.extractionError(ExtractionUtils.java:362)
&#160; &#160; at org.apache.flink.table.types.extraction.BaseMappingExtractor.extractResultMappings(BaseMappingExtractor.java:154)
&#160; &#160; at org.apache.flink.table.types.extraction.BaseMappingExtractor.extractOutputMapping(BaseMappingExtractor.java:100)
&#160; &#160; ... 53 more
Caused by: org.apache.flink.table.api.ValidationException: Argument name conflict, there are at least two argument names that are the same.
&#160; &#160; at org.apache.flink.table.types.extraction.ExtractionUtils.extractionError(ExtractionUtils.java:362)
&#160; &#160; at org.apache.flink.table.types.extraction.ExtractionUtils.extractionError(ExtractionUtils.java:357)
&#160; &#160; at org.apache.flink.table.types.extraction.FunctionSignatureTemplate.of(FunctionSignatureTemplate.java:73)
&#160; &#160; at org.apache.flink.table.types.extraction.BaseMappingExtractor.lambda$createParameterSignatureExtraction$9(BaseMappingExtractor.java:381)
&#160; &#160; at org.apache.flink.table.types.extraction.BaseMappingExtractor.putExtractedResultMappings(BaseMappingExtractor.java:298)
&#160; &#160; at org.apache.flink.table.types.extraction.BaseMappingExtractor.collectMethodMappings(BaseMappingExtractor.java:244)
&#160; &#160; at org.apache.flink.table.types.extraction.BaseMappingExtractor.extractResultMappings(BaseMappingExtractor.java:137)
&#160; &#160; ... 54 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13581154">FLINK-35498</key>
            <summary>Unexpected argument name conflict error when do extract method params from udf</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xuyangzhong">Xuyang Zhong</assignee>
                                    <reporter username="lincoln.86xy">lincoln lee</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 31 May 2024 11:00:15 +0000</created>
                <updated>Thu, 4 Jul 2024 13:18:24 +0000</updated>
                            <resolved>Thu, 4 Jul 2024 13:17:59 +0000</resolved>
                                    <version>1.19.0</version>
                    <version>1.20.0</version>
                                    <fixVersion>1.20.0</fixVersion>
                    <fixVersion>1.19.2</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17851430" author="lincoln.86xy" created="Sun, 2 Jun 2024 15:17:45 +0000"  >&lt;p&gt;Add some inputs:&#160;&lt;br/&gt;
For the test class TestXyz, if the local variable `localV1` without an initialization when declare, the `LocalVariableTable` of the method may include several lines for it, as the following code example and class files&apos; snippet comparison&#160;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// will not fail &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; add initializationString localV1;
&lt;/span&gt;
&lt;span class=&quot;code-comment&quot;&gt;// with initialization
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; localV1 = &quot;&quot;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069253/13069253_image-2024-06-02-23-09-17-768.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;this will cause different analysis results via asm tool, and we should consider these duplicate vars when extract the method params.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17852333" author="xuyangzhong" created="Wed, 5 Jun 2024 08:31:43 +0000"  >&lt;p&gt;Copied from this available pr:&lt;/p&gt;

&lt;p&gt;Currently, we depend on asm to extract method parameter names. We custom a MethodVisitor to visit local variable tables in file `&lt;tt&gt;.class`&lt;/tt&gt;, and then cut the first `&lt;tt&gt;N`&lt;/tt&gt;&#160;local variable names as the method parameter names.&lt;/p&gt;

&lt;p&gt;However, if there are multi blocks about one local variable, the first `&lt;tt&gt;N`&lt;/tt&gt; local variable names could be same, and then wrongly be extracted, and crashed when validating the conflict of them(the new logic added in 1.19).&lt;/p&gt;

&lt;p&gt;This pr will use the slot index in `&lt;tt&gt;.class`&lt;/tt&gt; file to extract the method parameter names, because method parameter names are always at the head in the &apos;slot index&apos; list(&lt;a href=&quot;https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-3.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Chapter 3.6. Receiving Arguments&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;Take the test function `&lt;tt&gt;ExtractionUtilsTest#MultiLocalVariableBlocksWithoutInitializationClass`&lt;/tt&gt;&#160;as an example:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Before fix:&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;extract parameter names from asm:&lt;br/&gt;
&lt;tt&gt;`&lt;span class=&quot;error&quot;&gt;&amp;#91;localVariable, localVariable, localVariable, this, generic, genericFuture, listOfGenericFuture, array, localVariable&amp;#93;&lt;/span&gt;`&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;get the first 4 after offset 1(expected&#160;&lt;tt&gt;this&lt;/tt&gt;&#160;in index 0)&lt;br/&gt;
&lt;tt&gt;`&lt;span class=&quot;error&quot;&gt;&amp;#91;localVariable, localVariable, this, generic&amp;#93;&lt;/span&gt;`&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;This is because in local variable table, there are multi&#160;&lt;tt&gt;localVariable&lt;/tt&gt;&#160;with different lifecycle in different blocks.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;After fix:&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;extract parameter names from asm:&lt;br/&gt;
&lt;tt&gt;`&lt;span class=&quot;error&quot;&gt;&amp;#91;this, generic, genericFuture, listOfGenericFuture, array, localVariable&amp;#93;&lt;/span&gt;`&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;get the first 4 after offset 1(expected&#160;&lt;tt&gt;this&lt;/tt&gt;&#160;in index 0)&lt;br/&gt;
&lt;tt&gt;`&lt;span class=&quot;error&quot;&gt;&amp;#91;generic, genericFuture, listOfGenericFuture, array&amp;#93;&lt;/span&gt;`&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;That&apos;s what we expected.&lt;/p&gt;

&lt;p&gt;Further more, if the local variable has been initialized before `&lt;tt&gt;if statement`&lt;/tt&gt;, its lifecycle is across all `&lt;tt&gt;if`&lt;/tt&gt;&#160;blocks, and there is no need to init new local variable&#160;&lt;tt&gt;localVariable&lt;/tt&gt; for it. Otherwize, `&lt;tt&gt;localVariable`&lt;/tt&gt; in multi blocks are actually not visible although it is declared at first, and jvm will create multi `&lt;tt&gt;localVariable`&lt;/tt&gt; for different blocks and add it in local variable table(You can see in local variable table, although these `&lt;tt&gt;localVariable&lt;/tt&gt;`&apos;s slots are same, but their start label and end label are different).&lt;/p&gt;</comment>
                            <comment id="17861290" author="lincoln.86xy" created="Tue, 2 Jul 2024 01:15:10 +0000"  >&lt;p&gt;fixed in master: 84165b23cfc756881d43cdab1b26c814d87e6227&lt;/p&gt;

&lt;p&gt;fixed in 1.20: ce29a69bcbe384cdfaec7db98ce4447b760ce3a2&lt;/p&gt;

&lt;p&gt;fixed in 1.19: 2581c26e4f0e38886ba29f36268d7d7657eb8531&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13069253" name="image-2024-06-02-23-09-17-768.png" size="1164710" author="lincoln.86xy" created="Sun, 2 Jun 2024 15:09:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1pjlc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>