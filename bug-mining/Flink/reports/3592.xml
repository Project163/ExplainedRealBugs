<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15383] Using sink Schema field name instead of query Schema field name in UpsertStreamTableSink</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15383</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;when user&#160; define a upsert table with primary key underlying(eg. mysql)&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// primary key (log_per_min, item, currency_time)
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sinkTableDDL =  &lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE gmv (\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  log_per_min STRING,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  item STRING,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  order_cnt BIGINT,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  currency_time TIMESTAMP(3),\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  gmv DECIMAL(38, 18),&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  timestamp9 TIMESTAMP(6),\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  time9 TIME(6),\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  gdp DECIMAL(8, 4)\n&quot;&lt;/span&gt; +
         &lt;span class=&quot;code-quote&quot;&gt;&quot;) WITH (\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;   &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.type&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;jdbc&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;   &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.url&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;jdbc:mysql:&lt;span class=&quot;code-comment&quot;&gt;//localhost:3306/test&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
&lt;/span&gt;        &lt;span class=&quot;code-quote&quot;&gt;&quot;   &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.username&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;root&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;   &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.table&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;gmv&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;   &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.driver&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;com.mysql.jdbc.Driver&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;   &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.write.flush.max-rows&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;5000&apos;&lt;/span&gt;, \n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;   &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.write.flush.interval&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;2s&apos;&lt;/span&gt;, \n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;   &lt;span class=&quot;code-quote&quot;&gt;&apos;connector.write.max-retries&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt;&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If user&#8216;s query field name is different with sinktable&apos;s field name. For example, user defined a field `log_ts` which not equals `log_per_min` as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;insert into gmv \n&quot; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;select log_ts,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; item, COUNT(order_id) as order_cnt, currency_time, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(sum(amount_kg) * max(rate) as DECIMAL(38, 4))  as gmv,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; max(timestamp9), max(time9), max(gdp) \n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; from ( \n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; select &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(o.ts as VARCHAR) as log_ts, o.item as item, o.order_id as order_id, c.currency_time as currency_time,\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; o.amount_kg as amount_kg, c.rate as rate, c.timestamp9 as timestamp9, c.time9 as time9, c.gdp as gdp \n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; from orders as o \n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; join currency FOR SYSTEM_TIME AS OF o.proc_time c \n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; on o.currency = c.currency_name \n&quot;&lt;/span&gt; +
        &quot; ) a group by log_ts, item, currency_time

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;The query will execute fail:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;Caused by: java.lang.ArrayIndexOutOfBoundsException: -1Caused by: java.lang.ArrayIndexOutOfBoundsException: -1 at org.apache.flink.api.java.io.jdbc.writer.UpsertWriter.lambda$create$0(UpsertWriter.java:59) at java.util.stream.IntPipeline$3$1.accept(IntPipeline.java:233) at java.util.Spliterators$IntArraySpliterator.forEachRemaining(Spliterators.java:1032) at java.util.Spliterator$OfInt.forEachRemaining(Spliterator.java:693) at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481) at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471) at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:545) at java.util.stream.AbstractPipeline.evaluateToArrayNode(AbstractPipeline.java:260) at java.util.stream.IntPipeline.toArray(IntPipeline.java:502) at org.apache.flink.api.java.io.jdbc.writer.UpsertWriter.create(UpsertWriter.java:59) at org.apache.flink.api.java.io.jdbc.JDBCUpsertOutputFormat.open(JDBCUpsertOutputFormat.java:104) at org.apache.flink.api.java.io.jdbc.JDBCUpsertSinkFunction.open(JDBCUpsertSinkFunction.java:42) at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:36) at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.open(AbstractUdfStreamOperator.java:102) at org.apache.flink.streaming.api.operators.StreamSink.open(StreamSink.java:48) at org.apache.flink.streaming.runtime.tasks.StreamTask.initializeStateAndOpen(StreamTask.java:1023) at org.apache.flink.streaming.runtime.tasks.StreamTask.lambda$beforeInvoke$0(StreamTask.java:454) at org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$SynchronizedStreamTaskActionExecutor.runThrowing(StreamTaskActionExecutor.java:94) at org.apache.flink.streaming.runtime.tasks.StreamTask.beforeInvoke(StreamTask.java:449) at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:461) at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:702) at org.apache.flink.runtime.taskmanager.Task.run(Task.java:527) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The root cause is that we should use sink Schema field name rather than query Schema field name in StreamExecSink&lt;/p&gt;</description>
                <environment></environment>
        <key id="13276226">FLINK-15383</key>
            <summary>Using sink Schema field name instead of query Schema field name in UpsertStreamTableSink</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="leonard">Leonard Xu</assignee>
                                    <reporter username="leonard">Leonard Xu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 24 Dec 2019 12:38:19 +0000</created>
                <updated>Thu, 2 Jan 2020 12:24:42 +0000</updated>
                            <resolved>Thu, 2 Jan 2020 12:24:42 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Table SQL / Legacy Planner</component>
                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3000">50m</timespent>
                                <comments>
                            <comment id="17003616" author="lzljs3620320" created="Thu, 26 Dec 2019 12:28:29 +0000"  >&lt;p&gt;Consider it is unfriendly behavior since UpsertSink was introduced. So I set it critical instead of blocker.&lt;/p&gt;</comment>
                            <comment id="17006767" author="jark" created="Thu, 2 Jan 2020 12:24:42 +0000"  >&lt;p&gt;1.11.0: 3843e167a9bd47d891e82d12e8ae609185ebfbfe&lt;br/&gt;
1.10.0: 4a63854bc054c859b94d054d82371d100e3e5ab8&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13276430">FLINK-15401</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09yvs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>