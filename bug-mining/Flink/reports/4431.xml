<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:48:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-18629] ConnectedStreams#keyBy can not derive key TypeInformation for lambda KeySelectors</title>
                <link>https://issues.apache.org/jira/browse/FLINK-18629</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Following test fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	@Test
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testKeyedConnectedStreamsType() {
		StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();

		DataStreamSource&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; stream1 = env.fromElements(1, 2);
		DataStreamSource&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; stream2 = env.fromElements(1, 2);

		ConnectedStreams&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; connectedStreams = stream1.connect(stream2)
			.keyBy(v -&amp;gt; v, v -&amp;gt; v);

		KeyedStream&amp;lt;?, ?&amp;gt; firstKeyedInput = (KeyedStream&amp;lt;?, ?&amp;gt;) connectedStreams.getFirstInput();
		KeyedStream&amp;lt;?, ?&amp;gt; secondKeyedInput = (KeyedStream&amp;lt;?, ?&amp;gt;) connectedStreams.getSecondInput();
		assertThat(firstKeyedInput.getKeyType(), equalTo(Types.INT));
		assertThat(secondKeyedInput.getKeyType(), equalTo(Types.INT));
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is that the wildcard type is evaluated as &lt;tt&gt;Object&lt;/tt&gt; for lambdas, which in turn produces &lt;tt&gt;GenericTypeInfo&amp;lt;Object&amp;gt;&lt;/tt&gt; for any KeySelector provided as lambda.&lt;/p&gt;

&lt;p&gt;I suggest changing the method signature to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;K1, K2&amp;gt; ConnectedStreams&amp;lt;IN1, IN2&amp;gt; keyBy(
			KeySelector&amp;lt;IN1, K1&amp;gt; keySelector1,
			KeySelector&amp;lt;IN2, K2&amp;gt; keySelector2)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This would be a code compatible change. Might break the compatibility of state backend (would change derived key type info). &lt;/p&gt;

&lt;p&gt;Still there would be a workaround to use the second method for old programs:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;KEY&amp;gt; ConnectedStreams&amp;lt;IN1, IN2&amp;gt; keyBy(
			KeySelector&amp;lt;IN1, KEY&amp;gt; keySelector1,
			KeySelector&amp;lt;IN2, KEY&amp;gt; keySelector2,
			TypeInformation&amp;lt;KEY&amp;gt; keyType)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13317409">FLINK-18629</key>
            <summary>ConnectedStreams#keyBy can not derive key TypeInformation for lambda KeySelectors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dwysakowicz">Dawid Wysakowicz</assignee>
                                    <reporter username="dwysakowicz">Dawid Wysakowicz</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 17 Jul 2020 12:52:41 +0000</created>
                <updated>Fri, 24 Jul 2020 08:51:52 +0000</updated>
                            <resolved>Fri, 24 Jul 2020 08:51:52 +0000</resolved>
                                    <version>1.10.0</version>
                    <version>1.11.0</version>
                    <version>1.12.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17159904" author="dawidwys" created="Fri, 17 Jul 2020 12:53:10 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; WDYT?&lt;/p&gt;</comment>
                            <comment id="17161359" author="aljoscha" created="Mon, 20 Jul 2020 16:23:12 +0000"  >&lt;p&gt;Yes, I believe this was a mistake. But why not&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;KEY&amp;gt; ConnectedStreams&amp;lt;IN1, IN2&amp;gt; keyBy(
			KeySelector&amp;lt;IN1, KEY&amp;gt; keySelector1,
			KeySelector&amp;lt;IN2, KEY&amp;gt; keySelector2) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The key must be the same for the two streams after all.&lt;/p&gt;</comment>
                            <comment id="17161829" author="dawidwys" created="Tue, 21 Jul 2020 07:48:24 +0000"  >&lt;p&gt;The reason is extreme conservatism. The option with a common KEY type theoretically disallows potential use case where the keys are of a different type in the same hierarchy.&lt;/p&gt;

&lt;p&gt;E.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;A {};
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;B &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; A {};

ConnectedStreams&amp;lt;A, B&amp;gt; connectedStreams = stream1.connect(stream2)
	.keyBy(v -&amp;gt; v, v -&amp;gt; v);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Important fact here is that they would have to produce the same TypeInformation which is not easy to achieve (nevertheless possible through TypeInfoFactories).&lt;br/&gt;
But I am more than happy to use the version with a single key type.&lt;/p&gt;</comment>
                            <comment id="17161876" author="aljoscha" created="Tue, 21 Jul 2020 09:00:19 +0000"  >&lt;p&gt;I&apos;m happy with either approach. Currently, if you did use different keys it will just break later, when it tries to assemble the operator, right?&lt;/p&gt;</comment>
                            <comment id="17164285" author="dawidwys" created="Fri, 24 Jul 2020 08:51:52 +0000"  >&lt;p&gt;Implemented in:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;master: 094cd530c052c2f0776883521e71c53748e7eb2c&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gv7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>