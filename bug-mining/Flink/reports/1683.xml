<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6537] Umbrella issue for fixes to incremental snapshots</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6537</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This issue tracks ongoing fixes in the incremental checkpointing feature for the 1.3 release.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13071106">FLINK-6537</key>
            <summary>Umbrella issue for fixes to incremental snapshots</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srichter">Stefan Richter</assignee>
                                    <reporter username="srichter">Stefan Richter</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 May 2017 09:43:50 +0000</created>
                <updated>Thu, 5 Mar 2020 15:09:53 +0000</updated>
                            <resolved>Thu, 5 Mar 2020 15:09:48 +0000</resolved>
                                    <version>1.3.0</version>
                                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                                                            <comments>
                            <comment id="16010393" author="gyfora" created="Mon, 15 May 2017 12:06:54 +0000"  >&lt;p&gt;Hi Stefan!&lt;/p&gt;

&lt;p&gt;Thank you for all the work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
I have tested your changes today and some of the issues have been resolved.&lt;/p&gt;

&lt;p&gt;Incremental checkpoints now succeed but cannot be restored from them (ether after cacnellation or under normal failure scenarios)&lt;br/&gt;
Savepoints still fail with the previous error. And also there seems to be some error while discarding subsumed checkpoints. I am attaching the logs containing the errors:&lt;/p&gt;

&lt;p&gt;In the beginning you can see the failed savepoint, then a couple of successful checkpoints with the warnings and at the end I killed the TM to trigger a restore which lead to file not found errors in HDFS:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/gyfora/2bb5569fb703bbd7e47ba60352f90086&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/gyfora/2bb5569fb703bbd7e47ba60352f90086&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I hope this helps &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Gyula&lt;/p&gt;</comment>
                            <comment id="16011952" author="srichter" created="Tue, 16 May 2017 08:09:15 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;thanks a lot for the testing effort and yes, there is still a known problem with between the incremental checkpointing and the &lt;tt&gt;ZookeeperCompletedCheckpointStore&lt;/tt&gt;. I am working on it.&lt;/p&gt;

&lt;p&gt;Best,&lt;br/&gt;
Stefan&lt;/p&gt;</comment>
                            <comment id="16019611" author="gyfora" created="Mon, 22 May 2017 14:09:48 +0000"  >&lt;p&gt;Hi Stefan!&lt;br/&gt;
I can confirm that the incremental checkpointing and recovery now seems to work as expected &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Great job on the fixes!&lt;/p&gt;

&lt;p&gt;Savepointing still gives the same error regardless whether incremental checkpointing is used or not. &lt;br/&gt;
Is there a JIRA for tracking that issue? I have no idea what might cause it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thank you!&lt;br/&gt;
Gyula&lt;/p&gt;</comment>
                            <comment id="16019717" author="srichter" created="Mon, 22 May 2017 15:39:44 +0000"  >&lt;p&gt;Which exception is that exactly? And how does it happen all the time? There is no JIRA for it, because I have not encountered the problem. Can this be reproduced somehow? Is only the first savepoint failing or all? What exceptions still remain after the latest fixes?&lt;/p&gt;

&lt;p&gt;Edit: In a quick run on GCloud, I could not reproduce any problems with savepoints and RocksDB.&lt;/p&gt;</comment>
                            <comment id="16019999" author="gyfora" created="Mon, 22 May 2017 18:46:57 +0000"  >&lt;p&gt;You can look at all the logs I have posted. For example: &lt;a href=&quot;https://gist.github.com/gyfora/2bb5569fb703bbd7e47ba60352f90086#file-gistfile1-txt-L197&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/gyfora/2bb5569fb703bbd7e47ba60352f90086#file-gistfile1-txt-L197&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This exact error happens at every single savepoint attempt.&lt;/p&gt;</comment>
                            <comment id="16020789" author="srichter" created="Tue, 23 May 2017 08:18:39 +0000"  >&lt;p&gt;I had a look at those logs, but they seem strange to me. From the exceptions, the root cause seems to be that the &lt;tt&gt;SafetyNetWrapperFileSystem&lt;/tt&gt; has a registry that is already closed, which can only happen in two places in &lt;tt&gt;Task&lt;/tt&gt;, one correlated with checkpointing in line 834. We are using a thread local variable to hold the registry, but this variable is re-initialized with a fresh registry for each checkpoint runnable. Since we are not using &lt;tt&gt;InheritableThreadLocal&lt;/tt&gt;, there should be no leaking to other threads, e.g. through threadpools. From the log, I also cannot see the precondition fail that indicates that there is already another registry in place. So right now, I only see the explanation that the an old, closed registry is leaked somehow, but cannot see how this is possible. For debugging purposes, what we could do is print the reference to the created, closed, and used registries that wrap the streams to check if an old registry somehow survives where it should not.&lt;/p&gt;

&lt;p&gt;I also tried to reproduce the problem, but unfortunately could never see this in any test runs. Is there something very special about your setup or are you using a customized version of Flink? For a test run, you could also deactivate the safety net in &lt;tt&gt;FileSystem&lt;/tt&gt; line 389 and check if this solves all the problem. Still wonder how this actually can cause troubles, in particular as this is already a Flink 1.2 feature &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Edit: This should actually also cause savepoints with all other backends to fail?&lt;br/&gt;
Edit 2: Ok, one way for this to happen is that the FileSystem is cached somewhere, where it shouldn&apos;t (in particular: without previously unwrapping it).&lt;/p&gt;</comment>
                            <comment id="16020941" author="srichter" created="Tue, 23 May 2017 09:27:30 +0000"  >&lt;p&gt;Ok, I think I have an idea about a possible problem, but it makes me wonder how this code has actually ever worked at all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Will double check and then come up with a fix.&lt;/p&gt;</comment>
                            <comment id="16021111" author="gyfora" created="Tue, 23 May 2017 12:10:18 +0000"  >&lt;p&gt;Thanks a lot for looking into this. I wont be able to verify any fix today as I am travelling to London, but I can try to do it tomorrow!!+&lt;/p&gt;</comment>
                            <comment id="16021248" author="srichter" created="Tue, 23 May 2017 14:21:00 +0000"  >&lt;p&gt;So this is not strictly related to incremental checkpoints, but from a different problem. I know how to easily fix this for the release and found that some things could be nicer about this code in general (can refactor in 1.4). Tracking in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6685&quot; title=&quot;SafetyNetCloseableRegistry is closed prematurely in Task::triggerCheckpointBarrier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6685&quot;&gt;&lt;del&gt;FLINK-6685&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6684&quot; title=&quot;Remove AsyncCheckpointRunnable from StreamTask&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6684&quot;&gt;&lt;del&gt;FLINK-6684&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17052231" author="stephanewen" created="Thu, 5 Mar 2020 15:09:48 +0000"  >&lt;p&gt;All subtasks are closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="13071101">FLINK-6535</subtask>
                            <subtask id="13071091">FLINK-6534</subtask>
                            <subtask id="13071088">FLINK-6533</subtask>
                            <subtask id="13070799">FLINK-6527</subtask>
                            <subtask id="13070344">FLINK-6505</subtask>
                            <subtask id="13070342">FLINK-6504</subtask>
                            <subtask id="13069804">FLINK-6475</subtask>
                            <subtask id="13071116">FLINK-6540</subtask>
                            <subtask id="13071176">FLINK-6545</subtask>
                            <subtask id="13072435">FLINK-6599</subtask>
                            <subtask id="13073354">FLINK-6633</subtask>
                            <subtask id="13073442">FLINK-6640</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3etpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>