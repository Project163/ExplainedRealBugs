<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:41:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14370] KafkaProducerAtLeastOnceITCase&gt;KafkaProducerTestBase.testOneToOneAtLeastOnceRegularSink fails on Travis</title>
                <link>https://issues.apache.org/jira/browse/FLINK-14370</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;KafkaProducerAtLeastOnceITCase&amp;gt;KafkaProducerTestBase.testOneToOneAtLeastOnceRegularSink&lt;/tt&gt; fails on Travis with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Test testOneToOneAtLeastOnceRegularSink(org.apache.flink.streaming.connectors.kafka.KafkaProducerAtLeastOnceITCase) failed with:
java.lang.AssertionError: Job should fail!
	at org.junit.Assert.fail(Assert.java:88)
	at org.apache.flink.streaming.connectors.kafka.KafkaProducerTestBase.testOneToOneAtLeastOnce(KafkaProducerTestBase.java:280)
	at org.apache.flink.streaming.connectors.kafka.KafkaProducerTestBase.testOneToOneAtLeastOnceRegularSink(KafkaProducerTestBase.java:206)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://api.travis-ci.com/v3/job/244297223/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.com/v3/job/244297223/log.txt&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13261737">FLINK-14370</key>
            <summary>KafkaProducerAtLeastOnceITCase&gt;KafkaProducerTestBase.testOneToOneAtLeastOnceRegularSink fails on Travis</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="becket_qin">Jiangjie Qin</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Fri, 11 Oct 2019 08:48:39 +0000</created>
                <updated>Tue, 22 Jun 2021 13:54:53 +0000</updated>
                            <resolved>Tue, 29 Oct 2019 05:47:36 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.8.3</fixVersion>
                    <fixVersion>1.9.2</fixVersion>
                    <fixVersion>1.10.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16952425" author="yanghua" created="Wed, 16 Oct 2019 01:43:23 +0000"  >&lt;p&gt;another instance: &lt;a href=&quot;https://api.travis-ci.com/v3/job/245838696/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.com/v3/job/245838696/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16952831" author="becket_qin" created="Wed, 16 Oct 2019 13:38:19 +0000"  >&lt;p&gt;I haven&apos;t figured out the full story yet. But here are some clues:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The problem reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14308&quot; title=&quot;Kafka09ProducerITCase&amp;gt;KafkaProducerTestBase.testOneToOneAtLeastOnceCustomOperator fails on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14308&quot;&gt;&lt;del&gt;FLINK-14308&lt;/del&gt;&lt;/a&gt; is related to the failure in this ticket. The problem is that when this test fails, it did not unblock the traffic to the Kafka cluster, so the next test sharing the same Kafka cluster fails.&lt;/li&gt;
	&lt;li&gt;Some timeout failures reported in other tests may be related to the long timeout here. I reduced the timeout so the tests finishes faster.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The part that still not clear to me is how the job expected to fail succeeded. I added a debugging message to give us some clue when hit this again.&lt;/p&gt;</comment>
                            <comment id="16953318" author="jark" created="Thu, 17 Oct 2019 01:59:58 +0000"  >&lt;p&gt;another instances: &lt;br/&gt;
&lt;a href=&quot;https://api.travis-ci.com/v3/job/246299399/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.com/v3/job/246299399/log.txt&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://api.travis-ci.com/v3/job/246299491/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.com/v3/job/246299491/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16955110" author="arvid" created="Sat, 19 Oct 2019 08:29:20 +0000"  >&lt;p&gt;We found the root cause and are currently discussing fixes as this is a non-trivial interplay of components.&lt;/p&gt;

&lt;p&gt;If you are in need of a quick (and dirty) fix: &lt;a href=&quot;https://github.com/apache/flink/pull/9918/commits/6a79fb8e9272b5d56ecb286634170c72403c751e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9918/commits/921ef31baa96bfc7c0629854104515dd856a6d29&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16955667" author="becket_qin" created="Mon, 21 Oct 2019 00:44:04 +0000"  >&lt;p&gt;Thanks&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid.heise%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;arvid.heise@gmail.com&quot;&gt;arvid.heise@gmail.com&lt;/a&gt;&#160;for finding the problem. The cause was that when all the records are processed before a snapshot was taken, the records that could not be sent out trigger the snapshot to fail. That snapshot failure will not cause the job to exit. However, all the records in the KafkaProducer are already expired after the snapshot failure. So when the producer closes, there will be no more exception thrown. Thus the job finished successfully.&lt;/p&gt;

&lt;p&gt;It looks that the expected behavior from connector is to report exception in &lt;tt&gt;close()&lt;/tt&gt;&#160;method as long as there was a record that could not be sent. On the other hand, exception thrown from &lt;tt&gt;CheckpointedFunction.snapshotState()&lt;/tt&gt;&#160;might be ignored. Not sure if this is reasonable, but this expectation is not super clear from the connector implementation&apos;s perspective.&lt;/p&gt;

&lt;p&gt;In terms of immediate fix, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid.heise%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;arvid.heise@gmail.com&quot;&gt;arvid.heise@gmail.com&lt;/a&gt;&#160;proposes to always throw exception as long as there has been a record sending failure. I agree that is the right fix per current expected behavior on the connectors.&lt;/p&gt;</comment>
                            <comment id="16956135" author="arvid" created="Mon, 21 Oct 2019 14:10:33 +0000"  >&lt;p&gt;So &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; will merge a better fix for stabilizing the test soonish. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; can you also merge your hotfix/cleanup commit where you improved on the test?&lt;/p&gt;

&lt;p&gt;We create a follow-up ticket&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14480&quot; title=&quot;Sort out exception supression during snapshotting for non-running tasks.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14480&quot;&gt;FLINK-14480&lt;/a&gt; where we discuss changes to the production code and potentially fix it.&lt;/p&gt;</comment>
                            <comment id="16956632" author="becket_qin" created="Tue, 22 Oct 2019 02:59:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid.heise%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;arvid.heise@gmail.com&quot;&gt;arvid.heise@gmail.com&lt;/a&gt;&#160;I am wondering if it would be better to wait for the patch from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;&#160;before checking my improvement as there is a high chance the build fails in my PR due to the test stability.&lt;/p&gt;</comment>
                            <comment id="16956751" author="arvid" created="Tue, 22 Oct 2019 07:12:17 +0000"  >&lt;p&gt;Yes, that&apos;s a good idea. &lt;a href=&quot;https://github.com/apache/flink/pull/9959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9959&lt;/a&gt; for reference.&lt;/p&gt;</comment>
                            <comment id="16957127" author="pnowojski" created="Tue, 22 Oct 2019 14:38:34 +0000"  >&lt;p&gt;My work is done &amp;lt;flies away&amp;gt;&lt;/p&gt;</comment>
                            <comment id="16960876" author="becket_qin" created="Mon, 28 Oct 2019 09:06:48 +0000"  >&lt;p&gt;I&apos;ve checked in the patch to master, will backport Piotr&apos;s patch and mine to &lt;tt&gt;release-1.8&lt;/tt&gt;&#160;and &lt;tt&gt;release-1.9&lt;/tt&gt;&#160;after travis on those two branches passes.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                            <outwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13261736">FLINK-14369</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13260047">FLINK-14308</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07hxs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>