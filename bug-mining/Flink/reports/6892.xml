<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30386] Column constraint lacks primary key not enforced check</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30386</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, only table constraint performs the enforced check. Not sure if it is by design or a bug.&lt;/p&gt;

&lt;p&gt;The following case can be reproduced on Flink 1.16.0, 1.15.3, and 1.15.2. I think the earlier version might also reveal it.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
Flink &lt;span class=&quot;code-keyword&quot;&gt;SQL&lt;/span&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; T (f0 &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;primary&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;, f1 &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;);
[INFO] &lt;span class=&quot;code-keyword&quot;&gt;Execute&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;statement&lt;/span&gt; succeed.

Flink &lt;span class=&quot;code-keyword&quot;&gt;SQL&lt;/span&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;explain&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; * &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; T;
== Abstract Syntax Tree ==
LogicalProject(f0=[$0], f1=[$1])
+- LogicalTableScan(&lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;=[[default_catalog, default_database, T]])

== Optimized Physical &lt;span class=&quot;code-keyword&quot;&gt;Plan&lt;/span&gt; ==
TableSourceScan(&lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;=[[default_catalog, default_database, T]], &lt;span class=&quot;code-keyword&quot;&gt;fields&lt;/span&gt;=[f0, f1])

== Optimized Execution &lt;span class=&quot;code-keyword&quot;&gt;Plan&lt;/span&gt; ==
TableSourceScan(&lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;=[[default_catalog, default_database, T]], &lt;span class=&quot;code-keyword&quot;&gt;fields&lt;/span&gt;=[f0, f1])


Flink &lt;span class=&quot;code-keyword&quot;&gt;SQL&lt;/span&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;create&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt; S (f0 &lt;span class=&quot;code-keyword&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, f1 &lt;span class=&quot;code-keyword&quot;&gt;string&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;primary&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;key&lt;/span&gt;(f0)) &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;);
[ERROR] Could &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;execute&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;SQL&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;statement&lt;/span&gt;. Reason:
org.apache.flink.&lt;span class=&quot;code-keyword&quot;&gt;table&lt;/span&gt;.api.ValidationException: Flink doesn&apos;t support ENFORCED &lt;span class=&quot;code-keyword&quot;&gt;mode&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;PRIMARY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;KEY&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;constraint&lt;/span&gt;. ENFORCED/&lt;span class=&quot;code-keyword&quot;&gt;NOT&lt;/span&gt; ENFORCED  controls &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the &lt;span class=&quot;code-keyword&quot;&gt;constraint&lt;/span&gt; checks &lt;span class=&quot;code-keyword&quot;&gt;are&lt;/span&gt; performed &lt;span class=&quot;code-keyword&quot;&gt;on&lt;/span&gt; the incoming/outgoing &lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt;. Flink does &lt;span class=&quot;code-keyword&quot;&gt;not&lt;/span&gt; own the &lt;span class=&quot;code-keyword&quot;&gt;data&lt;/span&gt; therefore the &lt;span class=&quot;code-keyword&quot;&gt;only&lt;/span&gt; supported &lt;span class=&quot;code-keyword&quot;&gt;mode&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;is&lt;/span&gt; the &lt;span class=&quot;code-keyword&quot;&gt;NOT&lt;/span&gt; ENFORCED &lt;span class=&quot;code-keyword&quot;&gt;mode&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13513218">FLINK-30386</key>
            <summary>Column constraint lacks primary key not enforced check</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="qingyue">Jane Chan</assignee>
                                    <reporter username="qingyue">Jane Chan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 12 Dec 2022 15:12:43 +0000</created>
                <updated>Mon, 21 Aug 2023 14:50:58 +0000</updated>
                            <resolved>Tue, 7 Feb 2023 07:16:04 +0000</resolved>
                                    <version>1.16.0</version>
                    <version>1.15.2</version>
                    <version>1.15.3</version>
                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>hbase-3.0.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17646172" author="dawidwys" created="Mon, 12 Dec 2022 15:35:48 +0000"  >&lt;p&gt;Do you mean that we should support the &lt;tt&gt;ENFORCED&lt;/tt&gt;  mode? It was a conscious decision to support only &lt;tt&gt;NOT ENFORCED&lt;/tt&gt; as the data is stored outside of Flink and thus there is no way to ensure the uniqueness of the key.&lt;/p&gt;</comment>
                            <comment id="17646395" author="qingyue" created="Tue, 13 Dec 2022 02:16:19 +0000"  >&lt;p&gt;Re &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; . The `NOT ENFORCED` check only performs on the table constraint but skips the column constraint. As a result, `PRIMARY KEY(a)` will throw an exception, but `a BIGINT NOT NULL PRIMARY KEY` is allowed.&lt;/p&gt;

&lt;p&gt;I think we should also throw the exception when encountering `a BIGINT NOT NULL PRIMARY KEY` and inform users to use `a BIGINT NOT NULL PRIMARY KEY NOT ENFORCED` instead.&lt;/p&gt;</comment>
                            <comment id="17646407" author="qingyue" created="Tue, 13 Dec 2022 03:22:23 +0000"  >&lt;p&gt;Would you help verify this issue, is it a bug or by design? cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lincoln.86xy&quot; class=&quot;user-hover&quot; rel=&quot;lincoln.86xy&quot;&gt;lincoln.86xy&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17646491" author="dawidwys" created="Tue, 13 Dec 2022 08:12:54 +0000"  >&lt;p&gt;Thanks for the explanation &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingyue&quot; class=&quot;user-hover&quot; rel=&quot;qingyue&quot;&gt;qingyue&lt;/a&gt;, I think that&apos;s fair assessment. &lt;/p&gt;</comment>
                            <comment id="17646619" author="lincoln.86xy" created="Tue, 13 Dec 2022 12:50:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingyue&quot; class=&quot;user-hover&quot; rel=&quot;qingyue&quot;&gt;qingyue&lt;/a&gt; this is indeed a bug of current implementation,  `a BIGINT NOT NULL PRIMARY KEY` (without `NOT ENFORCED`) is expected to be unsupported and requires an error here&lt;/p&gt;</comment>
                            <comment id="17646951" author="qingyue" created="Wed, 14 Dec 2022 06:14:28 +0000"  >&lt;p&gt;Thanks for the explanation, and let&apos;s fix this. Please assign the ticket to me. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lincoln.86xy&quot; class=&quot;user-hover&quot; rel=&quot;lincoln.86xy&quot;&gt;lincoln.86xy&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17685100" author="lincoln.86xy" created="Tue, 7 Feb 2023 07:16:04 +0000"  >&lt;p&gt;fixed in master: e69e6514d0b901eb03f1a8bfc499680d076248c9&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13329395">FLINK-19418</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1dz60:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>