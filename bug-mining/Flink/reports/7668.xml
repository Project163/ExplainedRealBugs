<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:21:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-36455] Sink should commit everything on notifyCheckpointCompleted</title>
                <link>https://issues.apache.org/jira/browse/FLINK-36455</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, we retry committables at some time later until they eventually succeed.&lt;/p&gt;

&lt;p&gt;However, that violates the contract of notifyCheckpointCompleted which states that all side effect must be committed before returning the method. In particular, notifyCheckpointCompleted must fail if we cannot guarantee that all side effects are committed for final checkpoints. As soon as notifyCheckpointCompleted returns, the final checkpoint is deemed completed, which currently may mean that some transactions are still open.&lt;/p&gt;

&lt;p&gt;The solution is that all retries must happen in a close loop in notifyCheckpointCompleted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13594784">FLINK-36455</key>
            <summary>Sink should commit everything on notifyCheckpointCompleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arvid">Arvid Heise</assignee>
                                    <reporter username="arvid">Arvid Heise</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 9 Oct 2024 13:21:46 +0000</created>
                <updated>Fri, 6 Dec 2024 14:07:18 +0000</updated>
                            <resolved>Wed, 6 Nov 2024 08:56:35 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.19.2</fixVersion>
                    <fixVersion>1.20.1</fixVersion>
                                    <component>API / Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17887940" author="galenwarren" created="Wed, 9 Oct 2024 13:33:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid&quot; class=&quot;user-hover&quot; rel=&quot;arvid&quot;&gt;arvid&lt;/a&gt; I&apos;m trying to understand the scope of this issue. Would all sinks be impacted? All versions of Flink? Thanks.&lt;/p&gt;</comment>
                            <comment id="17887948" author="arvid" created="Wed, 9 Oct 2024 14:00:39 +0000"  >&lt;p&gt;Yes, all sinks following the FLIP-143 API are susceptible to the issue. After implementing this ticket, graceful final checkpoints will never leave transactions open (unless the connector is buggy). For normal checkpoints, open transactions can only occur iff the RPC message notifyCheckpointCompleted is lost (which cannot happen for final checkpoints).&lt;/p&gt;

&lt;p&gt;Note that the issue is only relevant when transactions fail to commit on first try, so everything is an edge case.&lt;/p&gt;</comment>
                            <comment id="17887949" author="galenwarren" created="Wed, 9 Oct 2024 14:05:14 +0000"  >&lt;p&gt;Gotcha, thanks. Presumably that wouldn&apos;t include the legacy StreamingFileSink?&lt;/p&gt;</comment>
                            <comment id="17887987" author="arvid" created="Wed, 9 Oct 2024 15:36:11 +0000"  >&lt;p&gt;I&apos;m not an expert of the SFS but from cross checking the code, it looks safe because it has no retries whatsoever. So it would fail on transient error and trigger a new final checkpoint which is in accordance with the contract of notifyCheckpointCompleted.&lt;/p&gt;</comment>
                            <comment id="17887988" author="galenwarren" created="Wed, 9 Oct 2024 15:40:26 +0000"  >&lt;p&gt;Thanks for checking, much appreciated. I may go ahead and use the older one for now until I can use your fix.&lt;/p&gt;</comment>
                            <comment id="17895909" author="arvid" created="Wed, 6 Nov 2024 08:55:47 +0000"  >&lt;p&gt;Merged bc0f241b86799a39d7ce08e5902e47c71bdaf68f..13fe0e641cdd3260fd52c1e7a15a8d595bb29624 into main.&lt;/p&gt;</comment>
                            <comment id="17895988" author="galenwarren" created="Wed, 6 Nov 2024 14:22:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid&quot; class=&quot;user-hover&quot; rel=&quot;arvid&quot;&gt;arvid&lt;/a&gt; Thanks for this! Do you think this will be backported into any 1.x releases or is this just for 2.0?&lt;/p&gt;</comment>
                            <comment id="17903588" author="arvid" created="Fri, 6 Dec 2024 09:02:13 +0000"  >&lt;p&gt;Merged into 1.20 as 41fef6f5df79fbf3f5cacc86697ecc4a6e7c9492..958ba8c5cfb4ab376c0e860fe5259ded5e8cba0e.&lt;/p&gt;</comment>
                            <comment id="17903655" author="arvid" created="Fri, 6 Dec 2024 14:06:15 +0000"  >&lt;p&gt;Merged into 1.19 as bb043471604ee9564876aebf85e415181f217a17..5222a25540db7f6f6b7292ffea3086f4b7986e04.&lt;/p&gt;</comment>
                            <comment id="17903656" author="arvid" created="Fri, 6 Dec 2024 14:07:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=galenwarren&quot; class=&quot;user-hover&quot; rel=&quot;galenwarren&quot;&gt;galenwarren&lt;/a&gt; , backports are done now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1rvl4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Added the option sink.committer.retries to specify the number of retries a Flink application attempts for committable operations (such as transactions) on retriable errors, as specified by the sink connector, before Flink fails and potentially restarts.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>