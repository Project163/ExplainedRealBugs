<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19655] NPE when using blink planner and TemporalTableFunction after setting IdleStateRetentionTime </title>
                <link>https://issues.apache.org/jira/browse/FLINK-19655</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;My Code here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
EnvironmentSettings bsSettings = EnvironmentSettings.newInstance().useBlinkPlanner().inStreamingMode().build();
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StreamTableEnvironment tableEnv = StreamTableEnvironment.create(env, bsSettings);
tableEnv.getConfig().setIdleStateRetentionTime(Time.seconds(60), Time.seconds(600));

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Table table = tableEnv.from(&lt;span class=&quot;code-quote&quot;&gt;&quot;tableName&quot;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TableFunction&amp;lt;?&amp;gt; function = table.createTemporalTableFunction(
                    temporalTableEntry.getTimeAttribute(),
                    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.join(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;, temporalTableEntry.getPrimaryKeyFields()));
tableEnv.registerFunction(temporalTableEntry.getName(), function);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;And NPE throwed when I executed my program.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException
	at org.apache.flink.table.runtime.operators.join.temporal.BaseTwoInputStreamOperatorWithStateRetention.registerProcessingCleanupTimer(BaseTwoInputStreamOperatorWithStateRetention.java:109)
	at org.apache.flink.table.runtime.operators.join.temporal.TemporalProcessTimeJoinOperator.processElement2(TemporalProcessTimeJoinOperator.java:98)
	at org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor.processRecord2(StreamTwoInputProcessor.java:145)
	at org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor.lambda$&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;$1(StreamTwoInputProcessor.java:107)
	at org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor$StreamTaskNetworkOutput.emitRecord(StreamTwoInputProcessor.java:362)
	at org.apache.flink.streaming.runtime.io.StreamTaskNetworkInput.processElement(StreamTaskNetworkInput.java:151)
	at org.apache.flink.streaming.runtime.io.StreamTaskNetworkInput.emitNext(StreamTaskNetworkInput.java:128)
	at org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor.processInput(StreamTwoInputProcessor.java:185)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.processInput(StreamTask.java:311)
	at org.apache.flink.streaming.runtime.tasks.mailbox.MailboxProcessor.runMailboxLoop(MailboxProcessor.java:187)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.runMailboxLoop(StreamTask.java:487)
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:470)
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:707)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:532)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And When I changed to useOldPlanner, it worked fine.And when I debuged the code ,I found BaseTwoInputStreamOperatorWithStateRetention#open did not be executed.&lt;br/&gt;
Here is BaseTwoInputStreamOperatorWithStateRetention#open code.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void open() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		initializeTimerService();

		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stateCleaningEnabled) {
			ValueStateDescriptor&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; cleanupStateDescriptor =
				&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ValueStateDescriptor&amp;lt;&amp;gt;(CLEANUP_TIMESTAMP, Types.LONG);
			latestRegisteredCleanupTimer = getRuntimeContext().getState(cleanupStateDescriptor);
		}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is TemporalProcessTimeJoinOperator#open code.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void open() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.joinCondition = generatedJoinCondition.newInstance(getRuntimeContext().getUserCodeClassLoader());
		FunctionUtils.setFunctionRuntimeContext(joinCondition, getRuntimeContext());
		FunctionUtils.openFunction(joinCondition, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration());

		ValueStateDescriptor&amp;lt;BaseRow&amp;gt; rightStateDesc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ValueStateDescriptor&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;right&quot;&lt;/span&gt;, rightType);
		&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rightState = getRuntimeContext().getState(rightStateDesc);
		&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.collector = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TimestampedCollector&amp;lt;&amp;gt;(output);
		&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outRow = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JoinedRow();
		&lt;span class=&quot;code-comment&quot;&gt;// consider watermark from left stream only.
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.processWatermark2(Watermark.MAX_WATERMARK);
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I compared the code with oldplaner(TemporalProcessTimeJoin#open).May be TemporalProcessTimeJoinOperator#open should add super.open()?&lt;br/&gt;
Here is TemporalProcessTimeJoin#open code.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; open(): Unit = {
    LOG.debug(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Compiling FlatJoinFunction: $genJoinFuncName \n\n Code:\n$genJoinFuncCode&quot;&lt;/span&gt;)
    &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; clazz = compile(
      getRuntimeContext.getUserCodeClassLoader,
      genJoinFuncName,
      genJoinFuncCode)

    LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Instantiating FlatJoinFunction.&quot;&lt;/span&gt;)
    joinFunction = clazz.newInstance()
    FunctionUtils.setFunctionRuntimeContext(joinFunction, getRuntimeContext)
    FunctionUtils.openFunction(joinFunction, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Configuration())

    &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; rightStateDescriptor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ValueStateDescriptor[Row](&lt;span class=&quot;code-quote&quot;&gt;&quot;right&quot;&lt;/span&gt;, rightType)
    rightState = getRuntimeContext.getState(rightStateDescriptor)

    collector = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TimestampedCollector[CRow](output)
    cRowWrapper = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CRowWrappingCollector()
    cRowWrapper.out = collector

    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.open()
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13335591">FLINK-19655</key>
            <summary>NPE when using blink planner and TemporalTableFunction after setting IdleStateRetentionTime </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="seunjjs">seunjjs</assignee>
                                    <reporter username="seunjjs">seunjjs</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 15 Oct 2020 11:01:03 +0000</created>
                <updated>Thu, 22 Oct 2020 03:18:24 +0000</updated>
                            <resolved>Thu, 22 Oct 2020 03:18:24 +0000</resolved>
                                    <version>1.10.0</version>
                    <version>1.11.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17215122" author="libenchao" created="Fri, 16 Oct 2020 02:27:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seunjjs&quot; class=&quot;user-hover&quot; rel=&quot;seunjjs&quot;&gt;seunjjs&lt;/a&gt;&#160;Thanks for reporting this, would you like to raise a PR to fix it?&lt;/p&gt;</comment>
                            <comment id="17215143" author="nicholasjiang" created="Fri, 16 Oct 2020 03:33:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seunjjs&quot; class=&quot;user-hover&quot; rel=&quot;seunjjs&quot;&gt;seunjjs&lt;/a&gt;, I agree with your point that super.open should be add in TemporalProcessTimeJoinOperator.open(). TemporalProcessTimeJoinOperator should also initialize timer service for processing time.&lt;br/&gt;
cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17215333" author="seunjjs" created="Fri, 16 Oct 2020 10:41:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt;&#160;OK,I will try it tomorrow.&lt;/p&gt;</comment>
                            <comment id="17216116" author="seunjjs" created="Sun, 18 Oct 2020 07:25:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicholasjiang&quot; class=&quot;user-hover&quot; rel=&quot;nicholasjiang&quot;&gt;nicholasjiang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=libenchao&quot; class=&quot;user-hover&quot; rel=&quot;libenchao&quot;&gt;libenchao&lt;/a&gt; Hi, I have raised a PR &lt;a href=&quot;https://github.com/apache/flink/pull/13675&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;13675&lt;/a&gt;, Please review it,thanks. &lt;br/&gt;
BTW,Run all tests of flink project in local(Windows10 Laptop) is difficult, I found these problems:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1. The path of Flink Source Code should not have whitespace&lt;/li&gt;
	&lt;li&gt;2. On Win 10,  the code needs to be put on disk C(FileUtilsTest#testCompressionOnRelativePath use empty path to get root loc which is code loc)&lt;/li&gt;
	&lt;li&gt;3. AbstractRecoverableWriterTest#testCloseWithNoData always throw Exception: xxx/part-0: &#21478;&#19968;&#20010;&#31243;&#24207;&#27491;&#22312;&#20351;&#29992;&#27492;&#25991;&#20214;&#65292;&#36827;&#31243;&#26080;&#27861;&#35775;&#38382;&#12290;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;At last, I gave up executing all tests but only flink-table-runtime-blink tests.&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17216395" author="leonard xu" created="Mon, 19 Oct 2020 01:40:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=seunjjs&quot; class=&quot;user-hover&quot; rel=&quot;seunjjs&quot;&gt;seunjjs&lt;/a&gt;&#160;I reviewed the PR, you can have a look. &lt;sup&gt;_&lt;/sup&gt;&lt;/p&gt;</comment>
                            <comment id="17218711" author="jark" created="Thu, 22 Oct 2020 03:18:24 +0000"  >&lt;p&gt;Fixed in master: daeda68edf3466a3f9347c25bdf866ef4f620396&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jq8o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>