<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4201] Checkpoints for jobs in non-terminal state (e.g. suspended) get deleted</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4201</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;For example, when shutting down a Yarn session, according to the logs checkpoints for jobs that did not terminate are deleted. In the shutdown hook, removeAllCheckpoints is called and removes checkpoints that should still be kept.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12988722">FLINK-4201</key>
            <summary>Checkpoints for jobs in non-terminal state (e.g. suspended) get deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="uce">Ufuk Celebi</assignee>
                                    <reporter username="srichter">Stefan Richter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jul 2016 13:56:35 +0000</created>
                <updated>Fri, 22 Jul 2016 12:28:12 +0000</updated>
                            <resolved>Fri, 22 Jul 2016 12:27:47 +0000</resolved>
                                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15379639" author="uce" created="Fri, 15 Jul 2016 16:24:57 +0000"  >&lt;p&gt;The shut down hook is actually not a problem, because it is only active in standalone recovery mode. The issue is that a suspended execution graph will shut down the checkpoint coordinator, which discards all checkpoints on shut down. We still need to call shutdown in order to free some resources like the timer task, but have to skip discarding the checkpoints if the execution graph is suspended and not in a globally terminal state.&lt;/p&gt;</comment>
                            <comment id="15387564" author="githubbot" created="Thu, 21 Jul 2016 12:02:15 +0000"  >&lt;p&gt;GitHub user uce opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4201&quot; title=&quot;Checkpoints for jobs in non-terminal state (e.g. suspended) get deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4201&quot;&gt;&lt;del&gt;FLINK-4201&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Forward suspend to checkpoint coordinator&lt;/p&gt;

&lt;p&gt;    Suspended jobs were leading to shutdown of the checkpoint coordinator and hence removal of checkpoint state. For standalone recovery mode this is OK as no state can be recovered anyways (unchanged in this PR). For HA though this lead to removal of checkpoint state, which we&lt;br/&gt;
    actually want to keep for recovery.&lt;/p&gt;

&lt;p&gt;    We have the following behaviour now:&lt;/p&gt;


&lt;p&gt;    JobState | Standalone | High Availability&lt;br/&gt;
    ----------&lt;del&gt;|&lt;/del&gt;----------&lt;del&gt;|&lt;/del&gt;------------------&lt;br/&gt;
     SUSPENDED |  Discard   |       Keep&lt;br/&gt;
     FINISHED/FAILED/CANCELED |  Discard   |     Discard&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/uce/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/uce/flink&lt;/a&gt; 4201-discard_checkpoint&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2276.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2276.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2276&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 65bec557bafcfcfd53b6246f0a2154d259b0d6dd&lt;br/&gt;
Author: Ufuk Celebi &amp;lt;uce@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-07-19T14:30:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4201&quot; title=&quot;Checkpoints for jobs in non-terminal state (e.g. suspended) get deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4201&quot;&gt;&lt;del&gt;FLINK-4201&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Forward suspend to checkpoint coordinator&lt;/p&gt;

&lt;p&gt;    Suspended jobs were leading to shutdown of the checkpoint coordinator&lt;br/&gt;
    and hence removal of checkpoint state. For standalone recovery mode&lt;br/&gt;
    this is OK as no state can be recovered anyways (unchanged in this PR).&lt;br/&gt;
    For HA though this lead to removal of checkpoint state, which we&lt;br/&gt;
    actually want to keep for recovery.&lt;/p&gt;

&lt;p&gt;    We have the following behaviour now:&lt;/p&gt;

&lt;p&gt;    ----------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Standalone &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; High Availability&lt;br/&gt;
    ----------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------------&lt;br/&gt;
     SUSPENDED &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Discard   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;       Keep&lt;br/&gt;
    ----------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------------&lt;br/&gt;
     FINISHED/ &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  Discard   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;     Discard&lt;br/&gt;
     FAILED/   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;     CANCELED  |            |&lt;br/&gt;
    ----------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------------&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15387721" author="githubbot" created="Thu, 21 Jul 2016 13:50:32 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think that change is good in &quot;our&quot; philosophy, just wondering about the following implication:&lt;/p&gt;

&lt;p&gt;    Some people want to run HA setups without ZooKeeper, simply using an external service to make sure that the JobManager is restarted. The latest completed checkpoint is found via a well-defined path in the checkpoint storage (rather than a well defined path in ZooKeeper).&lt;/p&gt;

&lt;p&gt;    That works as an HA setup (with the exception of being susceptible to &quot;split brain&quot; behavior in the presence of network partitions. &lt;/p&gt;

&lt;p&gt;    Would we interfere with such a setup when removing checkpoints on &quot;suspend&quot; in &quot;standalone&quot; mode?&lt;/p&gt;

&lt;p&gt;    BTW: We should really find a new name for &quot;standalone&quot; more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; The term is overloaded.&lt;/p&gt;</comment>
                            <comment id="15387789" author="githubbot" created="Thu, 21 Jul 2016 14:38:00 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for taking a look, Stephan.&lt;/p&gt;

&lt;p&gt;    Regarding your question: &lt;b&gt;Would we interfere with such a setup when removing checkpoints on &quot;suspend&quot; in &quot;standalone&quot; mode?&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;    Yes, we would interfere, but what you describe is currently *&lt;b&gt;not&lt;/b&gt;* possible with Flink (that is no one can run it like that). The problem is that recovery on the master is tightly coupled to ZooKeeper (configured via `recovery.mode: ZOOKEEPER`). I really like your idea and agree that it should be possible to run an HA setup like that. I will open an issue for it. Do you think it&apos;s important to fix this for 1.1 already?&lt;/p&gt;

&lt;p&gt;    Regarding the name &lt;b&gt;standalone&lt;/b&gt;:&lt;/p&gt;

&lt;p&gt;    I fully agree. We have a standalone cluster mode and standalone recovery mode. Our standalone recovery mode (`recovery.mode: STANDALONE`) actually means `NO_RECOVERY`. I think that&apos;s what also made you assume that what you describe is possible, right? &lt;/p&gt;</comment>
                            <comment id="15387800" author="githubbot" created="Thu, 21 Jul 2016 14:43:59 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think as it is, it is fine.&lt;/p&gt;

&lt;p&gt;    Let&apos;s extend the option for HA in a separate issue. We could have:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;high-availability: &lt;b&gt;none&lt;/b&gt; (what is currently &lt;b&gt;standalone recovery&lt;/b&gt;)&lt;/li&gt;
	&lt;li&gt;high-availability: &lt;b&gt;filesystem&lt;/b&gt; (no protection against split brain partitioning)&lt;/li&gt;
	&lt;li&gt;high-availability: &lt;b&gt;zookeeper&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15389400" author="uce" created="Fri, 22 Jul 2016 12:27:47 +0000"  >&lt;p&gt;Fixed in 54f02ec (master).&lt;/p&gt;</comment>
                            <comment id="15389401" author="githubbot" created="Fri, 22 Jul 2016 12:28:12 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2276&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30umf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>