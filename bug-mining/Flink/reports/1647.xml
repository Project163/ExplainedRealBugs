<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6427] BucketingSink does not sync file length in case of cancel</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6427</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This is from a discussion on the user mailing lists: &lt;a href=&quot;https://lists.apache.org/thread.html/917dbbbd7c8f48b33e7b470fa9ed382df61cf43cb5deb46becebf4b5@%3Cuser.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/917dbbbd7c8f48b33e7b470fa9ed382df61cf43cb5deb46becebf4b5@%3Cuser.flink.apache.org%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A possible solution is to add this to &lt;tt&gt;StreamWriterBase.hflushOrSync()&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (os.getWrappedStream() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; DFSOutputStream) {
    ((DFSOutputStream) os.getWrappedStream()).hsync(EnumSet.of(HdfsDataOutputStream.SyncFlag.UPDATE_LENGTH));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13068368">FLINK-6427</key>
            <summary>BucketingSink does not sync file length in case of cancel</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 May 2017 09:36:08 +0000</created>
                <updated>Wed, 2 Oct 2019 17:42:00 +0000</updated>
                            <resolved>Wed, 3 May 2017 12:35:57 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Connectors / Common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15992631" author="aljoscha" created="Tue, 2 May 2017 09:36:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srichter&quot; class=&quot;user-hover&quot; rel=&quot;srichter&quot;&gt;srichter&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt;, what do you think? You mostly worked with DFS related problems during the last release cycle.&lt;/p&gt;</comment>
                            <comment id="15992671" author="githubbot" created="Tue, 2 May 2017 10:09:40 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3807&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6427&quot; title=&quot;BucketingSink does not sync file length in case of cancel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6427&quot;&gt;&lt;del&gt;FLINK-6427&lt;/del&gt;&lt;/a&gt; Ensure file length is flushed in StreamWriterBase&lt;/p&gt;

&lt;p&gt;    StreamWriterBase is used with BucketingSink. With HDFS, it can happen that the&lt;br/&gt;
    NameNode does not update the file length if we flush but don&apos;t properly close&lt;br/&gt;
    the file. We now specify that we also want to flush the file length when&lt;br/&gt;
    flushing.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; bucketing-sink-flush-file-length&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3807.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3807.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3807&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit dbc3899d5dbda642fdce0f06e9fece43dbc9585f&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-05-02T09:31:40Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6427&quot; title=&quot;BucketingSink does not sync file length in case of cancel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6427&quot;&gt;&lt;del&gt;FLINK-6427&lt;/del&gt;&lt;/a&gt; Ensure file length is flushed in StreamWriterBase&lt;/p&gt;

&lt;p&gt;    StreamWriterBase is used with BucketingSink. With HDFS, it can happen that the&lt;br/&gt;
    NameNode does not update the file length if we flush but don&apos;t properly close&lt;br/&gt;
    the file. We now specify that we also want to flush the file length when&lt;br/&gt;
    flushing.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15992928" author="githubbot" created="Tue, 2 May 2017 13:51:00 +0000"  >&lt;p&gt;Github user juergenthomann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3807&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It seems that DFSOutputStream is considered a private class (see Annotation). HdfsDataOutputStream also provides an hsync with flags and is considered public. It is also the place where the SyncFlags are provided.&lt;/p&gt;

&lt;p&gt;    I will try it with my mentioned small change and see if that solves our problem.&lt;/p&gt;</comment>
                            <comment id="15993041" author="githubbot" created="Tue, 2 May 2017 15:04:21 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3807&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @juergenthomann Cool, if you want I can also close this PR and wait for you to open a fixed (and verified) change.&lt;/p&gt;</comment>
                            <comment id="15994658" author="githubbot" created="Wed, 3 May 2017 10:55:53 +0000"  >&lt;p&gt;Github user juergenthomann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3807&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @aljoscha I&apos;ll create a new pull request in some minutes. In my case the valid-length and the size reported by the namenode are exactly the same.&lt;/p&gt;</comment>
                            <comment id="15994681" author="githubbot" created="Wed, 3 May 2017 11:17:20 +0000"  >&lt;p&gt;GitHub user juergenthomann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6427&quot; title=&quot;BucketingSink does not sync file length in case of cancel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6427&quot;&gt;&lt;del&gt;FLINK-6427&lt;/del&gt;&lt;/a&gt; Ensure file length is flushed in StreamWriterBase&lt;/p&gt;

&lt;p&gt;    StreamWriterBase is used with BucketingSink. With HDFS, it can happen that the NameNode does not know about the current file length if we flush but don&apos;t properly close the file. We now specify that we also want to update the file length when syncing a Stream.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/juergenthomann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/juergenthomann/flink&lt;/a&gt; bucketing-sink-flush-file-length&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3813&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 83799ce096e54e0590aa1d79b37dec8ff4300e2e&lt;br/&gt;
Author: J&#252;rgen Thomann &amp;lt;juergen.thomann@innogames.com&amp;gt;&lt;br/&gt;
Date:   2017-05-03T11:06:04Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6427&quot; title=&quot;BucketingSink does not sync file length in case of cancel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6427&quot;&gt;&lt;del&gt;FLINK-6427&lt;/del&gt;&lt;/a&gt; Ensure file length is flushed in StreamWriterBase&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15994697" author="githubbot" created="Wed, 3 May 2017 11:36:11 +0000"  >&lt;p&gt;Github user aljoscha closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3807&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15994700" author="githubbot" created="Wed, 3 May 2017 11:37:33 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This looks good to me. @StefanRRichter do you have an opinion on this?&lt;/p&gt;</comment>
                            <comment id="15994708" author="githubbot" created="Wed, 3 May 2017 11:46:48 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @juergenthomann you tested this in your program, correct?&lt;/p&gt;</comment>
                            <comment id="15994728" author="githubbot" created="Wed, 3 May 2017 12:07:14 +0000"  >&lt;p&gt;Github user juergenthomann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @aljoscha I tested it now 3 times and always the valid length was equal or smaller than the file size reported by the namenode. So for me it works perfectly fine now.&lt;/p&gt;</comment>
                            <comment id="15994731" author="githubbot" created="Wed, 3 May 2017 12:08:53 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    No objections from my side. LGTM.&lt;/p&gt;</comment>
                            <comment id="15994768" author="aljoscha" created="Wed, 3 May 2017 12:35:57 +0000"  >&lt;p&gt;Implemented in 6d0c4c340d0b052d2a97e7e86622707d05f6b6d7&lt;/p&gt;</comment>
                            <comment id="15994769" author="githubbot" created="Wed, 3 May 2017 12:36:52 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merged. &#128077; @juergenthomann could you please close this PR?&lt;/p&gt;

&lt;p&gt;    Thanks for fixing this and finding and debugging it in the first place!&lt;/p&gt;</comment>
                            <comment id="15994772" author="githubbot" created="Wed, 3 May 2017 12:38:57 +0000"  >&lt;p&gt;Github user juergenthomann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for merging!&lt;/p&gt;</comment>
                            <comment id="15994773" author="githubbot" created="Wed, 3 May 2017 12:38:58 +0000"  >&lt;p&gt;Github user juergenthomann closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3813&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ecuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>