<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17869] Fix the race condition of aborting unaligned checkpoint</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17869</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;On ChannelStateWriter side, the lifecycle of checkpoint should be as follows:&lt;/p&gt;

&lt;p&gt;start -&amp;gt; in progress/abort -&amp;gt; stop.&lt;/p&gt;

&lt;p&gt;The&#160;ChannelStateWriteResult is created during #start, and removed by #abort or #stop processes. There are some potential race conditions here:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;#start is called while receiving the first barrier by netty thread and schedule to execute the checkpoint&lt;/li&gt;
	&lt;li&gt;The task thread might process cancel checkpoint and call #abort before performing the above respective checkpoint&lt;/li&gt;
	&lt;li&gt;The checkpoint can still be executed by task thread afterwards even thought the above abort happened before, because we can not remove the checkpoint action from mailbox during aborting.&lt;/li&gt;
	&lt;li&gt;While checkpoint executing, it will call `ChannelStateWriter#getWriteResult` then it would cause `IllegalStateException` because the respective result was already removed in advance during handling #abort method before.&lt;/li&gt;
	&lt;li&gt;Therefore it will cause unnecessary task failure during performing checkpoint&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I guess we do not want to fail the task when one checkpoint is aborted by design. And the illegal state check during&#160;ChannelStateWriter#getWriteResult was mainly proposed for normal process validation I guess.&lt;/p&gt;

&lt;p&gt;If we do not remove the&#160;ChannelStateWriteResult while handling #abort and rely on #stop to remove it, then it might probably exist another scenario that the checkpoint will never be performed after #start (we have another mechanism to exit the triggering checkpoint in advance if the abort is sent by CheckpointCoordinator), then the legacy&#160;ChannelStateWriteResult will be retained inside&#160;ChannelStateWriter long time.&lt;/p&gt;

&lt;p&gt;Maybe the potential option to fix this issue is to let&#160;SubtaskCheckpointCoordinatorImpl handle the exception from&#160;ChannelStateWriter#getWriteResult properly to not fail the task in the aborted case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13306524">FLINK-17869</key>
            <summary>Fix the race condition of aborting unaligned checkpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="zjwang">Zhijiang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 21 May 2020 15:36:43 +0000</created>
                <updated>Thu, 11 Jun 2020 03:18:11 +0000</updated>
                            <resolved>Wed, 10 Jun 2020 20:34:02 +0000</resolved>
                                                    <fixVersion>1.11.0</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17132873" author="zjwang" created="Thu, 11 Jun 2020 03:18:11 +0000"  >&lt;p&gt;Merged in release-1.11:&#160;7bb3ffa91a9916348d2f0a6a2e6cba4b109be56e,&#160;&lt;/p&gt;

&lt;p&gt;d8069249703bbe7858e0c6a044deb54ce75e3989&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Merged in master:&#160;64ff6765036dd00761f79d9e206f6128c5bad671,&#160;&lt;/p&gt;

&lt;p&gt;91df1a5fd0f4937a852a82a6139a1a0ed28165e0&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13305439">FLINK-17768</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0f0e8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>