<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9789] Watermark metrics for an operator&amp;task shadow each other</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9789</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4812&quot; title=&quot;Report Watermark metrics in all operators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4812&quot;&gt;&lt;del&gt;FLINK-4812&lt;/del&gt;&lt;/a&gt; we reworked the watermark metrics to be exposed for each operator.&lt;br/&gt;
In &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9467&quot; title=&quot;No Watermark display on Web UI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9467&quot;&gt;&lt;del&gt;FLINK-9467&lt;/del&gt;&lt;/a&gt; we made further modifications to also expose these metrics again for tasks.&lt;/p&gt;

&lt;p&gt;In both JIRAs we register a single metric multiple times, for example the input watermark metric is registered for both the first operator in the task, and the task itself.&lt;/p&gt;

&lt;p&gt;Unfortunately, the metric system assumes metric objects to be unique, as can be seen in virtually all reporter implementations as well as the MetricQueryService.&lt;/p&gt;

&lt;p&gt;As a result the watermark metrics override each other in the reporter, causing only one to be reported, whichever was registered last.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="13171113">FLINK-9789</key>
            <summary>Watermark metrics for an operator&amp;task shadow each other</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 10 Jul 2018 10:41:18 +0000</created>
                <updated>Wed, 11 Jul 2018 10:08:39 +0000</updated>
                            <resolved>Tue, 10 Jul 2018 18:48:19 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Runtime / Metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16538446" author="githubbot" created="Tue, 10 Jul 2018 11:42:36 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9789&quot; title=&quot;Watermark metrics for an operator&amp;amp;task shadow each other&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9789&quot;&gt;&lt;del&gt;FLINK-9789&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;metrics&amp;#93;&lt;/span&gt; Ensure uniqueness of watermark metrics&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR ensures that all registered watermark metric objects are only registered once; shared gauges must be wrapped and registered separately to avoid collisions in reporters which generally assume that metric objects are unique.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;ensure uniqueness by wrapping re-used metrics in `&lt;span class=&quot;error&quot;&gt;&amp;#91;One|Two&amp;#93;&lt;/span&gt;InputStreamTask` and `OperatorChain`&lt;/li&gt;
	&lt;li&gt;add `InterceptingTaskMetricGroup` to gather registered metrics&lt;/li&gt;
	&lt;li&gt;modify `&lt;span class=&quot;error&quot;&gt;&amp;#91;One|Two&amp;#93;&lt;/span&gt;InputStreamTask#testWatermarkMetrics` to check uniqueness of registered objects, and cover re-use for tasks&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;run `&lt;span class=&quot;error&quot;&gt;&amp;#91;One|Two&amp;#93;&lt;/span&gt;InputStreamTask#testWatermarkMetrics`&lt;/li&gt;
	&lt;li&gt;run any streaming job and check existence of all watermark metrics for task and operator&lt;/li&gt;
	&lt;li&gt;(via REST API: /job/&amp;lt;job_id&amp;gt;/vertices/&amp;lt;vertex_id&amp;gt;/metrics)&lt;/li&gt;
	&lt;li&gt;see the &lt;span class=&quot;error&quot;&gt;&amp;#91;metrics documentation&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-master/monitoring/metrics.html#io&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci.apache.org/projects/flink/flink-docs-master/monitoring/metrics.html#io&lt;/a&gt;) for a list of expected metrics&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; 9789&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6292&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4a7a0c6114893250e625dc36d953209de22ce57e&lt;br/&gt;
Author: zentol &amp;lt;chesnay@...&amp;gt;&lt;br/&gt;
Date:   2018-07-10T11:27:34Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9789&quot; title=&quot;Watermark metrics for an operator&amp;amp;task shadow each other&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9789&quot;&gt;&lt;del&gt;FLINK-9789&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;metrics&amp;#93;&lt;/span&gt; Ensure uniqueness of watermark metrics&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16538464" author="githubbot" created="Tue, 10 Jul 2018 11:53:04 +0000"  >&lt;p&gt;Github user yanghua commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292#discussion_r201313023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292#discussion_r201313023&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/metrics/util/InterceptingTaskMetricGroup.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,53 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.metrics.util;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.metrics.Metric;&lt;br/&gt;
    +import org.apache.flink.runtime.metrics.groups.TaskMetricGroup;&lt;br/&gt;
    +import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.util.HashMap;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * A &lt;/p&gt;
{@link TaskMetricGroup}
&lt;p&gt; that exposes all registered metrics.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class InterceptingTaskMetricGroup extends UnregisteredMetricGroups.UnregisteredTaskMetricGroup {&lt;br/&gt;
    +&lt;br/&gt;
    +	private Map&amp;lt;String, Metric&amp;gt; intercepted;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Returns the registered metric for the given name, or null if it was never registered.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param name metric name&lt;br/&gt;
    +	 * @return registered metric for the given name, or null if it was never registered&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public Metric get(String name) {&lt;br/&gt;
    +		return intercepted.get(name);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;     if this method is invoked before `addMetric` , then the `intercepted` would not be initialized, seems it can trigger NPE&lt;/p&gt;</comment>
                            <comment id="16538476" author="githubbot" created="Tue, 10 Jul 2018 12:03:57 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292#discussion_r201315827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292#discussion_r201315827&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/metrics/util/InterceptingTaskMetricGroup.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,53 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.metrics.util;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.metrics.Metric;&lt;br/&gt;
    +import org.apache.flink.runtime.metrics.groups.TaskMetricGroup;&lt;br/&gt;
    +import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.util.HashMap;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * A &lt;/p&gt;
{@link TaskMetricGroup}
&lt;p&gt; that exposes all registered metrics.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class InterceptingTaskMetricGroup extends UnregisteredMetricGroups.UnregisteredTaskMetricGroup {&lt;br/&gt;
    +&lt;br/&gt;
    +	private Map&amp;lt;String, Metric&amp;gt; intercepted;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Returns the registered metric for the given name, or null if it was never registered.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param name metric name&lt;br/&gt;
    +	 * @return registered metric for the given name, or null if it was never registered&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public Metric get(String name) {&lt;br/&gt;
    +		return intercepted.get(name);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    That&apos;s true, but the same code exists in the `InterceptingOperatorMetricGroup`. We could simplify that but I&apos;d do it in a separate ticket.&lt;br/&gt;
    The NPE is virtually impossible to occur unless used in weird ways (i.e. not being passed to a task).&lt;/p&gt;</comment>
                            <comment id="16538582" author="githubbot" created="Tue, 10 Jul 2018 13:25:08 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292#discussion_r201340299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292#discussion_r201340299&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/OneInputStreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -93,7 +93,7 @@ public void init() throws Exception &lt;/p&gt;
{
     					inputWatermarkGauge);
     		}
&lt;p&gt;     		headOperator.getMetricGroup().gauge(MetricNames.IO_CURRENT_INPUT_WATERMARK, this.inputWatermarkGauge);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getEnvironment().getMetricGroup().gauge(MetricNames.IO_CURRENT_INPUT_WATERMARK, this.inputWatermarkGauge);&lt;br/&gt;
    +		getEnvironment().getMetricGroup().gauge(MetricNames.IO_CURRENT_INPUT_WATERMARK, this.inputWatermarkGauge::getValue);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    maybe document that we create a wrapping metric because registered metrics objects have to be unique&lt;/p&gt;</comment>
                            <comment id="16538610" author="githubbot" created="Tue, 10 Jul 2018 13:46:07 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292#discussion_r201347774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292#discussion_r201347774&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/OneInputStreamTask.java &amp;#8212;&lt;br/&gt;
    @@ -93,7 +93,7 @@ public void init() throws Exception &lt;/p&gt;
{
     					inputWatermarkGauge);
     		}
&lt;p&gt;     		headOperator.getMetricGroup().gauge(MetricNames.IO_CURRENT_INPUT_WATERMARK, this.inputWatermarkGauge);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getEnvironment().getMetricGroup().gauge(MetricNames.IO_CURRENT_INPUT_WATERMARK, this.inputWatermarkGauge);&lt;br/&gt;
    +		getEnvironment().getMetricGroup().gauge(MetricNames.IO_CURRENT_INPUT_WATERMARK, this.inputWatermarkGauge::getValue);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    will add a comment while merging&lt;/p&gt;</comment>
                            <comment id="16538625" author="githubbot" created="Tue, 10 Jul 2018 13:56:42 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292#discussion_r201352126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292#discussion_r201352126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/metrics/util/InterceptingTaskMetricGroup.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,53 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.metrics.util;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.metrics.Metric;&lt;br/&gt;
    +import org.apache.flink.runtime.metrics.groups.TaskMetricGroup;&lt;br/&gt;
    +import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.util.HashMap;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * A &lt;/p&gt;
{@link TaskMetricGroup}
&lt;p&gt; that exposes all registered metrics.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class InterceptingTaskMetricGroup extends UnregisteredMetricGroups.UnregisteredTaskMetricGroup {&lt;br/&gt;
    +&lt;br/&gt;
    +	private Map&amp;lt;String, Metric&amp;gt; intercepted;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Returns the registered metric for the given name, or null if it was never registered.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param name metric name&lt;br/&gt;
    +	 * @return registered metric for the given name, or null if it was never registered&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public Metric get(String name) {&lt;br/&gt;
    +		return intercepted.get(name);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    this is also only for testing, right?&lt;/p&gt;
</comment>
                            <comment id="16538660" author="githubbot" created="Tue, 10 Jul 2018 14:13:25 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292#discussion_r201358726&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292#discussion_r201358726&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/metrics/util/InterceptingTaskMetricGroup.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,53 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.metrics.util;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.metrics.Metric;&lt;br/&gt;
    +import org.apache.flink.runtime.metrics.groups.TaskMetricGroup;&lt;br/&gt;
    +import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.util.HashMap;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * A &lt;/p&gt;
{@link TaskMetricGroup}
&lt;p&gt; that exposes all registered metrics.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class InterceptingTaskMetricGroup extends UnregisteredMetricGroups.UnregisteredTaskMetricGroup {&lt;br/&gt;
    +&lt;br/&gt;
    +	private Map&amp;lt;String, Metric&amp;gt; intercepted;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Returns the registered metric for the given name, or null if it was never registered.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param name metric name&lt;br/&gt;
    +	 * @return registered metric for the given name, or null if it was never registered&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public Metric get(String name) {&lt;br/&gt;
    +		return intercepted.get(name);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    correct.&lt;/p&gt;</comment>
                            <comment id="16539088" author="zentol" created="Tue, 10 Jul 2018 18:48:19 +0000"  >&lt;p&gt;1.5: a0a810720d251fb9ab6a4cf9d995828d99a3f2c8&lt;/p&gt;</comment>
                            <comment id="16539741" author="githubbot" created="Wed, 11 Jul 2018 08:48:39 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 to merge this now but I think in the long run we should make the metrics system not rely on metrics objects being unique (or them correctly implementing `hashCode()`/`equals()`).&lt;/p&gt;</comment>
                            <comment id="16539818" author="githubbot" created="Wed, 11 Jul 2018 10:01:47 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Relying on hashCode/equals implementations would mean we could no longer use lambdas/method references for gauges which imo isn&apos;t a viable option.&lt;/p&gt;</comment>
                            <comment id="16539827" author="githubbot" created="Wed, 11 Jul 2018 10:07:19 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6292&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6292&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16539838" author="zentol" created="Wed, 11 Jul 2018 10:08:39 +0000"  >&lt;p&gt;master: 60df251ad34ac033ed6c4423a69765739cb04199&lt;br/&gt;
1.5: a0a810720d251fb9ab6a4cf9d995828d99a3f2c8&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 18 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vpvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>