<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:10:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-27218] Serializer in OperatorState has not been updated when new Serializers are NOT incompatible</title>
                <link>https://issues.apache.org/jira/browse/FLINK-27218</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;OperatorState such as &lt;b&gt;BroadcastState&lt;/b&gt; or &lt;b&gt;PartitionableListState&lt;/b&gt;&#160; can only be constructed via &lt;b&gt;DefaultOperatorStateBackend&lt;/b&gt;. But when &lt;b&gt;BroadcastState&lt;/b&gt; or &lt;b&gt;PartitionableListState&lt;/b&gt; Serializer changes after we restart the job , it seems to have the following problems .&lt;/p&gt;

&lt;p&gt;As an example, we can see how PartitionableListState is initialized.&lt;/p&gt;

&lt;p&gt;First, RestoreOperation will construct a restored PartitionableListState based on the information in the snapshot.&lt;/p&gt;

&lt;p&gt;Then StateMetaInfo in partitionableListState will be updated&#160; as the following code&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TypeSerializerSchemaCompatibility&amp;lt;S&amp;gt; stateCompatibility =
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; restoredPartitionableListStateMetaInfo.updatePartitionStateSerializer(newPartitionStateSerializer);

partitionableListState.setStateMetaInfo(restoredPartitionableListStateMetaInfo);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The main problem is that there is also an &lt;b&gt;internalListCopySerializer&lt;/b&gt; in &lt;b&gt;PartitionableListState&lt;/b&gt; that is built using the previous Serializer and it has not been updated.&#160;&lt;/p&gt;

&lt;p&gt;Therefore, when we update the StateMetaInfo, the &lt;b&gt;internalListCopySerializer&lt;/b&gt; also needs to be updated.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13439367">FLINK-27218</key>
            <summary>Serializer in OperatorState has not been updated when new Serializers are NOT incompatible</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mayuehappy">Yue Ma</assignee>
                                    <reporter username="mayuehappy">Yue Ma</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 13 Apr 2022 07:11:19 +0000</created>
                <updated>Fri, 22 Apr 2022 14:44:33 +0000</updated>
                            <resolved>Fri, 22 Apr 2022 14:44:33 +0000</resolved>
                                    <version>1.15.1</version>
                                    <fixVersion>1.15.1</fixVersion>
                    <fixVersion>1.16.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17522266" author="mayuehappy" created="Thu, 14 Apr 2022 12:20:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt; could you please take a look at this ticket ?&#160;&lt;/p&gt;</comment>
                            <comment id="17522634" author="yunta" created="Fri, 15 Apr 2022 03:22:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mayuehappy&quot; class=&quot;user-hover&quot; rel=&quot;mayuehappy&quot;&gt;mayuehappy&lt;/a&gt; I think you&apos;re right, this would affect the correctness when executing copy during snapshot. Do you like to take this ticket to fix this bug?&lt;/p&gt;</comment>
                            <comment id="17522779" author="mayuehappy" created="Fri, 15 Apr 2022 10:29:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; ok i&apos;m glad to do this fix, i&apos;ll submit a pr soon&lt;/p&gt;</comment>
                            <comment id="17523488" author="yunta" created="Mon, 18 Apr 2022 02:43:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mayuehappy&quot; class=&quot;user-hover&quot; rel=&quot;mayuehappy&quot;&gt;mayuehappy&lt;/a&gt; Already assigned to you, please go ahead.&lt;/p&gt;</comment>
                            <comment id="17523702" author="mayuehappy" created="Mon, 18 Apr 2022 13:48:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; hi , I drafted a pr &lt;a href=&quot;https://github.com/apache/flink/pull/19508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/19508&lt;/a&gt;&#160; , can you help with a review&#160; ? thx&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17526474" author="roman_khachatryan" created="Fri, 22 Apr 2022 14:44:33 +0000"  >&lt;p&gt;Merged into master as 4033ddc5fa682a1619f8f22348e2ee38afcc1c85,&lt;/p&gt;

&lt;p&gt;into 1.15 as 3d4b3a495b273c3a15ce7d35ba5a5b2e4ddc4c20.&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13042348" name="image-2022-04-13-14-50-10-921.png" size="312" author="mayuehappy" created="Wed, 13 Apr 2022 06:50:12 +0000"/>
                            <attachment id="13042584" name="image-2022-04-18-21-48-30-519.png" size="312" author="mayuehappy" created="Mon, 18 Apr 2022 13:48:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z11f60:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>