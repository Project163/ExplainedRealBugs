<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9694] Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9694</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;the partial specific exception stack trace&#160;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.NullPointerException
at org.apache.flink.api.common.typeutils.CompositeTypeSerializerConfigSnapshot.&amp;lt;init&amp;gt;(CompositeTypeSerializerConfigSnapshot.java:53)
at org.apache.flink.table.runtime.types.CRowSerializer$CRowSerializerConfigSnapshot.&amp;lt;init&amp;gt;(CRowSerializer.scala:120)
at org.apache.flink.table.runtime.types.CRowSerializer$CRowSerializerConfigSnapshot.&amp;lt;init&amp;gt;(CRowSerializer.scala:123)
at sun.reflect.GeneratedConstructorAccessor10.newInstance(Unknown Source)
at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)
at java.lang.reflect.Constructor.newInstance(Constructor.java:423)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.newInstance(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:442)
at org.apache.flink.util.InstantiationUtil.instantiate(InstantiationUtil.java:319)
... 20 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;related code is :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CompositeTypeSerializerConfigSnapshot(TypeSerializer&amp;lt;?&amp;gt;... nestedSerializers) {
   Preconditions.checkNotNull(nestedSerializers);

   &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.nestedSerializersAndConfigs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(nestedSerializers.length);
   &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (TypeSerializer&amp;lt;?&amp;gt; nestedSerializer : nestedSerializers) {
      TypeSerializerConfigSnapshot configSnapshot = nestedSerializer.snapshotConfiguration();
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.nestedSerializersAndConfigs.add(
         &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;TypeSerializer&amp;lt;?&amp;gt;, TypeSerializerConfigSnapshot&amp;gt;(
            nestedSerializer.duplicate(),
            Preconditions.checkNotNull(configSnapshot)));
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;exception happens at :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TypeSerializerConfigSnapshot configSnapshot = nestedSerializer.snapshotConfiguration();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the reason is the type of constructor&apos;s parameter &quot;...&quot;&#160;used &quot;varargs&quot; feature. The&#160; initialize code in &lt;b&gt;CRowSerializer.scala&lt;/b&gt; is :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;() = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)    &lt;span class=&quot;code-comment&quot;&gt;// Scala code&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;when invoked this, actually the the type of CompositeTypeSerializerConfigSnapshot&apos;s&lt;/p&gt;

&lt;p&gt;nestedSerializers parameter is :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TypeSerializer&amp;lt;?&amp;gt;[] nestedSerializers = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TypeSerializer&amp;lt;?&amp;gt;[] {&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;so the checkNotNull precondition statement :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Preconditions.checkNotNull(nestedSerializers);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is always useless.&lt;/p&gt;

&lt;p&gt;So we should check the object reference in &lt;em&gt;for&lt;/em&gt; loop to protect NPE.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13169311">FLINK-9694</key>
            <summary>Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pnowojski">Piotr Nowojski</assignee>
                                    <reporter username="yanghua">vinoyang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 30 Jun 2018 06:29:38 +0000</created>
                <updated>Wed, 1 Aug 2018 13:04:34 +0000</updated>
                            <resolved>Wed, 1 Aug 2018 13:04:34 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.3</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16528575" author="githubbot" created="Sat, 30 Jun 2018 06:40:04 +0000"  >&lt;p&gt;GitHub user yanghua opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9694&quot; title=&quot;Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9694&quot;&gt;&lt;del&gt;FLINK-9694&lt;/del&gt;&lt;/a&gt; Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;This pull request fixed a NPE in CompositeTypeSerializerConfigSnapshot constructor&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Add a non-null check in CompositeTypeSerializerConfigSnapshot constructor&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is a trivial rework / code cleanup without any test coverage.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable / docs / JavaDocs / *&lt;b&gt;not documented&lt;/b&gt;*)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/yanghua/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yanghua/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9694&quot; title=&quot;Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9694&quot;&gt;&lt;del&gt;FLINK-9694&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6231&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8d5bb522d3f457db4ccf3a0f1045dec4b431b268&lt;br/&gt;
Author: yanghua &amp;lt;yanghua1127@...&amp;gt;&lt;br/&gt;
Date:   2018-06-30T06:37:14Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9694&quot; title=&quot;Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9694&quot;&gt;&lt;del&gt;FLINK-9694&lt;/del&gt;&lt;/a&gt; Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16528608" author="githubbot" created="Sat, 30 Jun 2018 07:43:35 +0000"  >&lt;p&gt;Github user zhangminglei commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good from my side @yanghua  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16528616" author="githubbot" created="Sat, 30 Jun 2018 08:07:05 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc @twalthr and @fhueske &lt;/p&gt;</comment>
                            <comment id="16538432" author="githubbot" created="Tue, 10 Jul 2018 11:32:31 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @pnowojski  can you review this?&lt;/p&gt;</comment>
                            <comment id="16539966" author="githubbot" created="Wed, 11 Jul 2018 11:56:27 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This doesn&apos;t look correct to me, the serializer should always be non-null, and silently dropping null serializers most likely just causes other problems.&lt;/p&gt;

&lt;p&gt;    Did you actually run into this NPE when using Flink, or did you explicitly call the constructor for demonstration purposes?&lt;/p&gt;

&lt;p&gt;    As far as I can tell the code in `CRowSerializer` is either broken or a not adequately documented hack.&lt;br/&gt;
    It is at the very least untested as this NPE &lt;em&gt;always&lt;/em&gt; occur when this constructor is used.&lt;/p&gt;

&lt;p&gt;    @tzulitai Why exactly is this &lt;span class=&quot;error&quot;&gt;&amp;#91;constructor&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/types/CRowSerializer.scala#L123&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/types/CRowSerializer.scala#L123&lt;/a&gt;) necessary?&lt;/p&gt;</comment>
                            <comment id="16539994" author="githubbot" created="Wed, 11 Jul 2018 12:06:55 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol we really caused this exception, in our inner Flink version, we customized flink-table and implemented stream and dim table join. I think the default constructor is needed by deserialization.&lt;br/&gt;
    Whatever it takes, the author who wrote this code misunderstood the variable `nestedSerializers ` could be null(in current case), but it did not happens. The truth is : the elements in `nestedSerializers` could be null.&lt;br/&gt;
    We add a judgement and fixed this NPE, now it works OK.&lt;/p&gt;</comment>
                            <comment id="16549095" author="githubbot" created="Thu, 19 Jul 2018 10:29:37 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I agree with @zentol and I do not see reason for supporting nulls here. This fix looks like hiding underlying implementation problem. Default constructor of `CRowSerializerConfigSnapshot` could use `CompositeTypeSerializerConfigSnapshot#CompositeTypeSerializerConfigSnapshot()` (without parameters).&lt;/p&gt;

&lt;p&gt;    I don&apos;t know much about scala, but shouldn&apos;t it use this pattern:&lt;br/&gt;
    &lt;a href=&quot;https://stackoverflow.com/questions/3299776/in-scala-how-can-i-subclass-a-java-class-with-multiple-constructors&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/3299776/in-scala-how-can-i-subclass-a-java-class-with-multiple-constructors&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="16549144" author="githubbot" created="Thu, 19 Jul 2018 11:18:13 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    hi @pnowojski I did not call the `CompositeTypeSerializerConfigSnapshot(TypeSerializer&amp;lt;?&amp;gt;... nestedSerializers)` constructor explicitly, the caller is Flink itself, see &lt;span class=&quot;error&quot;&gt;&amp;#91;here&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/types/CRowSerializer.scala#L123&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/types/CRowSerializer.scala#L123&lt;/a&gt;). And I just fix the NPE in this case : &lt;/p&gt;

&lt;p&gt;    ```scala&lt;br/&gt;
    def this() = this(null)    //scala&lt;br/&gt;
    ```&lt;br/&gt;
    but it does not means : &lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    CompositeTypeSerializerConfigSnapshot(null);    //java&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    it seems means : &lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    CompositeTypeSerializerConfigSnapshot(new TypeSerializer&amp;lt;?&amp;gt;[] &lt;/p&gt;
{null}
&lt;p&gt;)    //java&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    so it jumps the preconditions not null check : &lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    Preconditions.checkNotNull(nestedSerializers);    //java&lt;br/&gt;
    ```&lt;br/&gt;
    then coursed NPE in the `for` loop &lt;span class=&quot;error&quot;&gt;&amp;#91;here&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-core/src/main/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerConfigSnapshot.java#L53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-core/src/main/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerConfigSnapshot.java#L53&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;    I think it is a defensive check, then it&apos;s OK in our inner Flink version (in the previous comment, I said we customized table&amp;amp;sql to provide stream and dimension table join).&lt;/p&gt;
</comment>
                            <comment id="16552675" author="githubbot" created="Mon, 23 Jul 2018 11:16:09 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Nope, you are not quite correct. This:&lt;br/&gt;
    ```&lt;br/&gt;
    def this() = this(null)    //scala&lt;br/&gt;
    ```&lt;br/&gt;
    translates to&lt;br/&gt;
    ```&lt;br/&gt;
    CompositeTypeSerializerConfigSnapshot(null); &lt;br/&gt;
    ```&lt;br/&gt;
    But because of varargs usages in `public CompositeTypeSerializerConfigSnapshot(TypeSerializer&amp;lt;?&amp;gt;... nestedSerializers)`, you get  in this constructor one element array containing single null value.&lt;/p&gt;

&lt;p&gt;    If there was&lt;br/&gt;
    ```&lt;br/&gt;
    def this() = this(null, null, null)    //in scala&lt;br/&gt;
    CompositeTypeSerializerConfigSnapshot(null, null, null); // or in java&lt;br/&gt;
    ```&lt;br/&gt;
    `nestedSerializers` array would have three null elements.&lt;/p&gt;

&lt;p&gt;    Never the less I still do not think this is a good fix. Instead of supporting and handling nulls in `CompositeTypeSerializerConfigSnapshot` constructor (ugly and dangerous), default constructor of `CRowSerializerConfigSnapshot` should invoke default constructor of `CompositeTypeSerializerConfigSnapshot`.&lt;/p&gt;</comment>
                            <comment id="16552686" author="githubbot" created="Mon, 23 Jul 2018 11:31:03 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @pnowojski I have said it is because of the constructor : &lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    CompositeTypeSerializerConfigSnapshot(TypeSerializer&amp;lt;?&amp;gt;... nestedSerializers)&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    used &lt;span class=&quot;error&quot;&gt;&amp;#91;`varargs ` in JIRA description&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9694&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-9694&lt;/a&gt;), the last comment in this PR, I just explain it looks like this style.&lt;/p&gt;

&lt;p&gt;    We added null check and it works fine in our Flink env. So if we do not process it, in this case, this code is useless: &lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    Preconditions.checkNotNull(nestedSerializers);&lt;br/&gt;
    ```&lt;br/&gt;
    Why we do not check null in the potential nullable context? So what&apos;s the way you think is not ugly and dangerous? &lt;/p&gt;

</comment>
                            <comment id="16552900" author="githubbot" created="Mon, 23 Jul 2018 13:59:24 +0000"  >&lt;p&gt;GitHub user pnowojski opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9694&quot; title=&quot;Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9694&quot;&gt;&lt;del&gt;FLINK-9694&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Fix NPE in CRowSerializerConfigSnapshot constructor&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Fix NPE in CRowSerializerConfigSnapshot constructor&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR adds new test to cover regression.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/pnowojski/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pnowojski/flink&lt;/a&gt; f9694&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6392&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit cfc62bb5a6728e9cc245e5daf8f2ace721d14f1c&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@...&amp;gt;&lt;br/&gt;
Date:   2018-07-23T13:27:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9694&quot; title=&quot;Potentially NPE in CompositeTypeSerializerConfigSnapshot constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9694&quot;&gt;&lt;del&gt;FLINK-9694&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Fix NPE in CRowSerializerConfigSnapshot constructor&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16552911" author="githubbot" created="Mon, 23 Jul 2018 14:07:39 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    True, `checkNotNull(nestedSerializers);` is useless.&lt;/p&gt;

&lt;p&gt;    Allowing nulls without enabled compile errors on violated `@Nullable` checks (this we can not enable in Flink) always leads to some null pointer exceptions and makes developing code unnecessary complicated - you need to manually walk through whole call stack up and down to confirm if null can/should be handled/supported/provided. &lt;/p&gt;

&lt;p&gt;    This is annoying especially that in 99.9% cases completely avoidable - in this case, just call different constructor.&lt;/p&gt;

&lt;p&gt;    I was looking for a way to call this other constructor in Scala and I couldn&apos;t (Scala seems to be annoying), however I found this workaround:&lt;br/&gt;
    &lt;a href=&quot;https://github.com/apache/flink/pull/6392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16553026" author="githubbot" created="Mon, 23 Jul 2018 15:55:29 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @pnowojski thanks for giving a solution, I will try to verify it in our inner Flink version.&lt;/p&gt;</comment>
                            <comment id="16554003" author="githubbot" created="Tue, 24 Jul 2018 09:26:55 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392#discussion_r204684670&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392#discussion_r204684670&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerConfigSnapshot.java &amp;#8212;&lt;br/&gt;
    @@ -46,8 +46,6 @@&lt;br/&gt;
     	public CompositeTypeSerializerConfigSnapshot() {}&lt;/p&gt;

&lt;p&gt;     	public CompositeTypeSerializerConfigSnapshot(TypeSerializer&amp;lt;?&amp;gt;... nestedSerializers) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Preconditions.checkNotNull(nestedSerializers);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Not sure about this. It should be perfectly fine that we have a null check here.&lt;/p&gt;</comment>
                            <comment id="16554038" author="githubbot" created="Tue, 24 Jul 2018 10:02:49 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392#discussion_r204695915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392#discussion_r204695915&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerConfigSnapshot.java &amp;#8212;&lt;br/&gt;
    @@ -46,8 +46,6 @@&lt;br/&gt;
     	public CompositeTypeSerializerConfigSnapshot() {}&lt;/p&gt;

&lt;p&gt;     	public CompositeTypeSerializerConfigSnapshot(TypeSerializer&amp;lt;?&amp;gt;... nestedSerializers) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Preconditions.checkNotNull(nestedSerializers);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Wasn&apos;t that a dead code? `CompositeTypeSerializerConfigSnapshot(null)` resolves to `CompositeTypeSerializerConfigSnapshot(new TypeSerializer&amp;lt;&amp;gt;&lt;/p&gt;
{null}
&lt;p&gt;)`.&lt;/p&gt;</comment>
                            <comment id="16554041" author="githubbot" created="Tue, 24 Jul 2018 10:05:38 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392#discussion_r204696678&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392#discussion_r204696678&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/typeutils/CompositeTypeSerializerConfigSnapshot.java &amp;#8212;&lt;br/&gt;
    @@ -46,8 +46,6 @@&lt;br/&gt;
     	public CompositeTypeSerializerConfigSnapshot() {}&lt;/p&gt;

&lt;p&gt;     	public CompositeTypeSerializerConfigSnapshot(TypeSerializer&amp;lt;?&amp;gt;... nestedSerializers) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Preconditions.checkNotNull(nestedSerializers);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Ops, scratch that. It wasn&apos;t dead code, `CompositeTypeSerializerConfigSnapshot( (TypeSerializer&amp;lt;&amp;gt;[]) null)` would probably trigger this condition. Reverted&lt;/p&gt;</comment>
                            <comment id="16555209" author="githubbot" created="Wed, 25 Jul 2018 06:34:30 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    LGTM, +1&lt;/p&gt;</comment>
                            <comment id="16555230" author="githubbot" created="Wed, 25 Jul 2018 06:54:06 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1, I will close my PR #6231 about this issue&lt;/p&gt;</comment>
                            <comment id="16555233" author="githubbot" created="Wed, 25 Jul 2018 06:55:19 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    PR #6392 fixed this issue.&lt;/p&gt;</comment>
                            <comment id="16555234" author="githubbot" created="Wed, 25 Jul 2018 06:55:19 +0000"  >&lt;p&gt;Github user yanghua closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16555355" author="githubbot" created="Wed, 25 Jul 2018 08:25:02 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6231&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for verification and reporting issue!&lt;/p&gt;</comment>
                            <comment id="16555358" author="githubbot" created="Wed, 25 Jul 2018 08:32:18 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks, merging&lt;/p&gt;</comment>
                            <comment id="16555359" author="githubbot" created="Wed, 25 Jul 2018 08:33:06 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6392&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6392&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16558347" author="pnowojski" created="Thu, 26 Jul 2018 14:04:05 +0000"  >&lt;p&gt;Back ported to 1.5 branch (for 1.5.2 release) in:&#160;&lt;/p&gt;

&lt;p&gt;cb4c2c9ad87535933011760ecaebddbc0e476b11&lt;/p&gt;

&lt;p&gt;and to 1.6 branch in:&lt;/p&gt;

&lt;p&gt;e7efb63416e43615e3756185034aa995aad96fea&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3veun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>