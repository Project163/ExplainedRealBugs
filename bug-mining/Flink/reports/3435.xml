<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:42:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14968] Kerberized YARN on Docker test (custom fs plugin) fails on Travis</title>
                <link>https://issues.apache.org/jira/browse/FLINK-14968</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This change made the test flaky: &lt;a href=&quot;https://github.com/apache/flink/commit/749965348170e4608ff2a23c9617f67b8c341df5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/749965348170e4608ff2a23c9617f67b8c341df5&lt;/a&gt;. It changes the job to have two sources instead of one which, under normal circumstances, requires too many slots to run and therefore the job will fail.&lt;/p&gt;

&lt;p&gt;The setup of this test is very intricate, we configure YARN to have two NodeManagers with 2500mb memory each: &lt;a href=&quot;https://github.com/apache/flink/blob/413a77157caf25dbbfb8b0caaf2c9e12c7374d98/flink-end-to-end-tests/test-scripts/docker-hadoop-secure-cluster/config/yarn-site.xml#L39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/413a77157caf25dbbfb8b0caaf2c9e12c7374d98/flink-end-to-end-tests/test-scripts/docker-hadoop-secure-cluster/config/yarn-site.xml#L39&lt;/a&gt;. We run the job with parallelism 3 and configure Flink to use 1000mb as TaskManager memory and 1000mb of JobManager memory. This means that the job fits into the YARN memory budget but more TaskManagers would not fit. We also don&apos;t simply increase the YARN resources because we want the Flink job to use TMs on different NMs because we had a bug where Kerberos config file shipping was not working correctly but the bug was not materialising if all TMs where on the same NM.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://api.travis-ci.org/v3/job/612782888/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/612782888/log.txt&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13270911">FLINK-14968</key>
            <summary>Kerberized YARN on Docker test (custom fs plugin) fails on Travis</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gjy">Gary Yao</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 27 Nov 2019 08:18:39 +0000</created>
                <updated>Thu, 28 Nov 2019 17:57:25 +0000</updated>
                            <resolved>Thu, 28 Nov 2019 17:57:25 +0000</resolved>
                                    <version>1.10.0</version>
                                                    <component>Runtime / Coordination</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16983279" author="aljoscha" created="Wed, 27 Nov 2019 08:29:28 +0000"  >&lt;p&gt;I disabled the tests for now to get a better CI signal: &lt;a href=&quot;https://github.com/apache/flink/commit/5374cfec2231fb14a70bd786424a18daee383231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/5374cfec2231fb14a70bd786424a18daee383231&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16983286" author="pnowojski" created="Wed, 27 Nov 2019 08:39:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; I would expect 1.9 branch to be affected by this as well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjy&quot; class=&quot;user-hover&quot; rel=&quot;gjy&quot;&gt;gjy&lt;/a&gt;, why adding another source exhausts the available slots? Shouldn&apos;t the slots be shared? Also do you know why it happens only &quot;under normal circumstances&quot; and not always?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; FYI&lt;/p&gt;</comment>
                            <comment id="16983349" author="fly_in_gis" created="Wed, 27 Nov 2019 10:10:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gjy&quot; class=&quot;user-hover&quot; rel=&quot;gjy&quot;&gt;gjy&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I think the flink job should not fail with not enough slots. We start 3 TaskManager with 1 slot for each, and each slot could run a complete pipeline. I have tested on a real yarn cluster, it always works as expected. Only 3 TaskManagers are started and the job finished successfully.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/flink run -d -p 3 -m yarn-cluster examples/streaming/WordCount.jar --input dummy:&lt;span class=&quot;code-comment&quot;&gt;//localhost/words --input anotherDummy://localhost/words&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have gone over the logs and find that the `SlotPoolImpl` allocates 4 slot. It should be only 3. May some bugs happen in Scheduler internally.&#160;&lt;/p&gt;</comment>
                            <comment id="16983776" author="aljoscha" created="Wed, 27 Nov 2019 17:48:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; You might be right? I&apos;ll keep investigating this myself. But if more people could look at it it would be good.&lt;/p&gt;

&lt;p&gt;Maybe the reason is the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14834&quot; title=&quot;Kerberized YARN on Docker test fails on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14834&quot;&gt;&lt;del&gt;FLINK-14834&lt;/del&gt;&lt;/a&gt; in the end. &#128517;&lt;/p&gt;</comment>
                            <comment id="16984225" author="gjy" created="Thu, 28 Nov 2019 08:23:11 +0000"  >&lt;p&gt;Does this also happen when running the WordCount job from the IDE or at least in standalone mode? Would be good to be able to set a breakpoint for debugging.&lt;/p&gt;</comment>
                            <comment id="16984335" author="aljoscha" created="Thu, 28 Nov 2019 11:15:22 +0000"  >&lt;p&gt;It&apos;s very strange, I&apos;m running this on my machine against a standalone 3-TM cluster and it didn&apos;t fail so far. It is reproducible on my local machine using the yarn/kerberos docker test, though. But that&apos;s hard to debug.&lt;/p&gt;</comment>
                            <comment id="16984565" author="aljoscha" created="Thu, 28 Nov 2019 17:35:55 +0000"  >&lt;p&gt;Something very strange is going on. When I try this on a (dockerized) YARN cluster the job sometimes needs 3 slots to run and sometimes needs 4 slots. I run this job:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/flink run -m yarn-cluster -p 3 -yjm 2000 -ytm 2000 examples/streaming/WordCount.jar --input hdfs:&lt;span class=&quot;code-comment&quot;&gt;///wc-in-1 --input hdfs:///wc-in-2 --output hdfs:///wc-out&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The attached logs show the (DEBUG) jobmanager.log of two different runs. Try searching for &quot;Requesting new slot&quot;.&lt;/p&gt;</comment>
                            <comment id="16984573" author="aljoscha" created="Thu, 28 Nov 2019 17:57:25 +0000"  >&lt;p&gt;I&apos;m closing this as a duplicate because the underlying reason does indeed seem to be the same as for &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14834&quot; title=&quot;Kerberized YARN on Docker test fails on Travis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14834&quot;&gt;&lt;del&gt;FLINK-14834&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="13268942">FLINK-14834</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13261948">FLINK-14382</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12987087" name="run-with-3-slots.txt" size="144592" author="aljoscha" created="Thu, 28 Nov 2019 17:34:34 +0000"/>
                            <attachment id="12987088" name="run-with-4-slots.txt" size="156212" author="aljoscha" created="Thu, 28 Nov 2019 17:34:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0922w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>