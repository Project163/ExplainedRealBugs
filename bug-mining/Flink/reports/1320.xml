<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5075] Kinesis consumer incorrectly determines shards as newly discovered when tested against Kinesalite</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5075</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A user reported that when our Kinesis connector is used against Kinesalite (&lt;a href=&quot;https://github.com/mhart/kinesalite&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mhart/kinesalite&lt;/a&gt;), we&apos;re incorrectly determining already found shards as newly discovered:&lt;br/&gt;
&lt;a href=&quot;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Subtask-keeps-on-discovering-new-Kinesis-shard-when-using-Kinesalite-td10133.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Subtask-keeps-on-discovering-new-Kinesis-shard-when-using-Kinesalite-td10133.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I suspect the problem to be the mock Kinesis API implementations of Kinesalite doesn&apos;t completely match with the official AWS Kinesis behaviour.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13021047">FLINK-5075</key>
            <summary>Kinesis consumer incorrectly determines shards as newly discovered when tested against Kinesalite</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tzulitai">Tzu-Li (Gordon) Tai</assignee>
                                    <reporter username="tzulitai">Tzu-Li (Gordon) Tai</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Nov 2016 06:15:16 +0000</created>
                <updated>Thu, 24 Nov 2016 10:58:37 +0000</updated>
                            <resolved>Thu, 24 Nov 2016 10:58:36 +0000</resolved>
                                                    <fixVersion>1.1.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Connectors / Kinesis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15673047" author="githubbot" created="Thu, 17 Nov 2016 07:33:13 +0000"  >&lt;p&gt;GitHub user tzulitai opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5075&quot; title=&quot;Kinesis consumer incorrectly determines shards as newly discovered when tested against Kinesalite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5075&quot;&gt;&lt;del&gt;FLINK-5075&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kinesis&amp;#93;&lt;/span&gt; Make Kinesis consumer fail-proof to incorrect Kinesalite API behaviour&lt;/p&gt;

&lt;p&gt;    A user reported that when tested against Kinesalite (a widely used mock Kinesis implementation), the connector was incorrectly determining already seen shards as newly discovered.&lt;/p&gt;

&lt;p&gt;    The problem was that the connector was using the API `describeStream(streamName, exclusiveStartIShardId)` to fetch shards of a stream after the provided `exclusiveStartShardId` (given as the last id of the latest shard we&apos;ve already discovered), and Kinesalite behaves differently for this from the official Kinesis API.&lt;/p&gt;

&lt;p&gt;    For example, if the current complete shard list is &lt;span class=&quot;error&quot;&gt;&amp;#91;shard-0, shard-1, shard-2, shard-3&amp;#93;&lt;/span&gt; for &quot;test-stream&quot;,&lt;br/&gt;
    then `describeStream(&quot;test-stream&quot;, &quot;shard-1&quot;)` should return: &lt;span class=&quot;error&quot;&gt;&amp;#91;shard-2, shard-3&amp;#93;&lt;/span&gt;.&lt;br/&gt;
    Kinesalite, however, incorrectly returns the whole list.&lt;/p&gt;

&lt;p&gt;    I&apos;ve manually tested this change against Kinesalite, and shard discovery is working normally again.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tzulitai/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tzulitai/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5075&quot; title=&quot;Kinesis consumer incorrectly determines shards as newly discovered when tested against Kinesalite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5075&quot;&gt;&lt;del&gt;FLINK-5075&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2822&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit cbef7eabeae645a1cd3533d3274cdb7491b1a779&lt;br/&gt;
Author: Tzu-Li (Gordon) Tai &amp;lt;tzulitai@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-17T06:24:24Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5075&quot; title=&quot;Kinesis consumer incorrectly determines shards as newly discovered when tested against Kinesalite&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5075&quot;&gt;&lt;del&gt;FLINK-5075&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kinesis&amp;#93;&lt;/span&gt; Make connector fail-proof to incorrect Kinesalite API behaviour&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15673053" author="githubbot" created="Thu, 17 Nov 2016 07:37:32 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m not entirely sure whether the fix is a good workaround, or whether we should really bother with Kinesalite&apos;s incorrect behaviour at all in our Kinesis connector.&lt;/p&gt;

&lt;p&gt;    I&apos;ve considered the alternative is to just use the `describeStream(streamName)` variant, always fetching the whole shard list and explicitly ruling out shards we&apos;ve already seen. That&apos;ll make the code clean of such &quot;workarounds&quot;, but will be problematic for Kinesis users whose shard count exceeds the largest number of shards the API can return.&lt;/p&gt;</comment>
                            <comment id="15686551" author="githubbot" created="Tue, 22 Nov 2016 12:03:29 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822#discussion_r89100942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822#discussion_r89100942&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-kinesis/src/main/java/org/apache/flink/streaming/connectors/kinesis/proxy/KinesisProxy.java &amp;#8212;&lt;br/&gt;
    @@ -283,7 +285,7 @@ public String getShardIterator(KinesisStreamShard shard, String shardIteratorTyp&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@param startShardId which shard to start with for this describe operation (earlier shard&apos;s infos will not appear in result)&lt;/li&gt;
	&lt;li&gt;@return the result of the describe stream operation&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private DescribeStreamResult describeStream(String streamName, String startShardId) throws InterruptedException {&lt;br/&gt;
    +	private DescribeStreamResult describeStream(String streamName, @Nullable String startShardId) throws InterruptedException {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Does only Kinesalite supply the `startShardId` parameter?&lt;/p&gt;</comment>
                            <comment id="15686816" author="githubbot" created="Tue, 22 Nov 2016 13:55:58 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822#discussion_r89119126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822#discussion_r89119126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-kinesis/src/main/java/org/apache/flink/streaming/connectors/kinesis/proxy/KinesisProxy.java &amp;#8212;&lt;br/&gt;
    @@ -283,7 +285,7 @@ public String getShardIterator(KinesisStreamShard shard, String shardIteratorTyp&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;@param startShardId which shard to start with for this describe operation (earlier shard&apos;s infos will not appear in result)&lt;/li&gt;
	&lt;li&gt;@return the result of the describe stream operation&lt;br/&gt;
     	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private DescribeStreamResult describeStream(String streamName, String startShardId) throws InterruptedException {&lt;br/&gt;
    +	private DescribeStreamResult describeStream(String streamName, @Nullable String startShardId) throws InterruptedException {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Only Kinesis does. Kinesalite incorrectly ignores `startShardId`.&lt;br/&gt;
    It&apos;s marked `Nullable` here, because on fresh startups this method will be called with a `null` as the start ID (on startup there will be no shard Id to start from).&lt;/p&gt;</comment>
                            <comment id="15686823" author="githubbot" created="Tue, 22 Nov 2016 13:59:15 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @StephanEwen. I&apos;m pretty sure this doesn&apos;t affect the normal Kinesis shard discovery. I&apos;ll give it some final tests before merging (would like to get this in before the next 1.1.4 RC).&lt;/p&gt;

&lt;p&gt;    Yes, using `describeStream(streamName)` only will be problematic for users with large numbers of shards, because the whole list may not be able to be returned in a single call. So that&apos;s most likely not a solution we can consider.&lt;/p&gt;</comment>
                            <comment id="15689835" author="githubbot" created="Wed, 23 Nov 2016 11:29:30 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Makes sense.&lt;/p&gt;

&lt;p&gt;    +1 to this!&lt;/p&gt;</comment>
                            <comment id="15692951" author="githubbot" created="Thu, 24 Nov 2016 10:49:22 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging ..&lt;/p&gt;</comment>
                            <comment id="15692965" author="githubbot" created="Thu, 24 Nov 2016 10:55:23 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2822&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15692971" author="tzulitai" created="Thu, 24 Nov 2016 10:58:04 +0000"  >&lt;p&gt;Resolved for &lt;tt&gt;master&lt;/tt&gt; via &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flink/commit/f5f4f7a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flink/commit/f5f4f7a&lt;/a&gt;&lt;br/&gt;
Resolved for &lt;tt&gt;release-1.1&lt;/tt&gt; via &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flink/commit/b9e6dcc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flink/commit/b9e6dcc&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36dtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>