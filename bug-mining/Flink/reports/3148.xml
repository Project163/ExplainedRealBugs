<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:40:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-12858] Potential distributed deadlock in case of synchronous savepoint failure</title>
                <link>https://issues.apache.org/jira/browse/FLINK-12858</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Current implementation of stop-with-savepoint (&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11458&quot; title=&quot;Add TERMINATE/SUSPEND Job with Savepoint (FLIP-34)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11458&quot;&gt;&lt;del&gt;FLINK-11458&lt;/del&gt;&lt;/a&gt;) would lock the thread (on &lt;tt&gt;syncSavepointLatch&lt;/tt&gt;) that carries &lt;tt&gt;StreamTask.performCheckpoint()&lt;/tt&gt;. For non-source tasks, this thread is implied to be the task&apos;s main thread (stop-with-savepoint deliberately stops any activity in the task&apos;s main thread).&lt;/p&gt;

&lt;p&gt;Unlocking happens either when the task is cancelled or when the corresponding checkpoint is acknowledged.&lt;/p&gt;

&lt;p&gt;It&apos;s possible, that other downstream tasks of the same Flink job &quot;soft&quot; fail the checkpoint/savepoint due to various reasons (for example, due to max buffered bytes &lt;tt&gt;BarrierBuffer.checkSizeLimit()&lt;/tt&gt;. In such case, the checkpoint abortion would be notified to JM . But it looks like, the checkpoint coordinator would handle such abortion as usual and assume that the Flink job continues running.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13239692">FLINK-12858</key>
            <summary>Potential distributed deadlock in case of synchronous savepoint failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="1u0">Alex</assignee>
                                    <reporter username="1u0">Alex</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 15 Jun 2019 12:02:19 +0000</created>
                <updated>Wed, 31 Jul 2019 09:12:14 +0000</updated>
                            <resolved>Wed, 31 Jul 2019 08:48:55 +0000</resolved>
                                    <version>1.9.0</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                                        <aggregatetimeremainingestimate seconds="0">0h</aggregatetimeremainingestimate>
                                        <aggregatetimespent seconds="1800">0.5h</aggregatetimespent>
                                    <comments>
                            <comment id="16882692" author="guanghui" created="Thu, 11 Jul 2019 07:05:41 +0000"  >&lt;p&gt;Hi,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=1u0&quot; class=&quot;user-hover&quot; rel=&quot;1u0&quot;&gt;1u0&lt;/a&gt;,can you give more description about this issue,such as &quot;non-source tasks&quot;&#65311;thanks.&lt;/p&gt;</comment>
                            <comment id="16882826" author="1u0" created="Thu, 11 Jul 2019 10:23:31 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=guanghui&quot; class=&quot;user-hover&quot; rel=&quot;guanghui&quot;&gt;guanghui&lt;/a&gt;, by non-source tasks I mean tasks that are not start nodes in a Flink job execution graph, they are nodes that have some incoming edges.&lt;/p&gt;</comment>
                            <comment id="16882944" author="kkl0u" created="Thu, 11 Jul 2019 13:17:39 +0000"  >&lt;p&gt;I think that the problem here is not limited to the &lt;tt&gt;stop-with-savepoint&lt;/tt&gt;. This seems to be related to that the &lt;tt&gt;BarrierBuffer.checkSizeLimit()&lt;/tt&gt; configuration parameter aborts a checkpoint and reports it to the checkpoint coordinator without respecting the user-specified parameter that specifies the policy of how a checkpoint failure should be handled (the  &lt;tt&gt;CheckpointExceptionHandler&lt;/tt&gt;) and without somehow informing the task about it.&lt;/p&gt;

&lt;p&gt;Another implication of that is that I am not sure how this also affects the already existing &lt;tt&gt;cancel-with-savepoint&lt;/tt&gt; command from a user&apos;s perspective.&lt;/p&gt;</comment>
                            <comment id="16886197" author="1u0" created="Tue, 16 Jul 2019 15:20:03 +0000"  >&lt;p&gt;Some recap of discussions around this issue:&lt;br/&gt;
the proposed workaround solution is to fail execution of the whole job.&lt;br/&gt;
In case of stop-with-savepoint and &lt;tt&gt;drain=true&lt;/tt&gt;, we cannot unlock the tasks and continue job execution (as it may side effect on job results). Handling two cases differently may be a little involved.&lt;/p&gt;</comment>
                            <comment id="16886211" author="1u0" created="Tue, 16 Jul 2019 15:27:00 +0000"  >&lt;p&gt;I&apos;m not sure, but failing the task (that originates the discarded savepoint/checkpoint) may be not an option due to region recovery (which would not restart the tasks that are actually locked).&lt;/p&gt;</comment>
                            <comment id="16891070" author="till.rohrmann" created="Tue, 23 Jul 2019 14:28:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkl0u&quot; class=&quot;user-hover&quot; rel=&quot;kkl0u&quot;&gt;kkl0u&lt;/a&gt; had a comment whether to add a test or not. I would be in favour of guarding this fix with a test case.&lt;/p&gt;</comment>
                            <comment id="16893881" author="kkl0u" created="Fri, 26 Jul 2019 15:09:38 +0000"  >&lt;p&gt;The test is ready and there is a PR for it here &lt;a href=&quot;https://github.com/apache/flink/pull/9240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/9240&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16896934" author="kkl0u" created="Wed, 31 Jul 2019 08:48:55 +0000"  >&lt;p&gt;Merged on master with 7b4d4b9114e6deff5d7c41925936665db53ecd8a&lt;br/&gt;
and on release-1.9 with 9407e1b4a56c853688d7395da448d7d107c6fb76&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="13247309">FLINK-13440</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z03rzk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>