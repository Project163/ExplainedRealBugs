<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:21:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2797] CLI: Missing option to submit jobs in detached mode</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2797</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Jobs can only be submitted in detached mode using YARN but not on a standalone installation. This has been requested by users who want to submit a job, get the job id, and later query its status.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12901896">FLINK-2797</key>
            <summary>CLI: Missing option to submit jobs in detached mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sachingoel0101">Sachin Goel</assignee>
                                    <reporter username="mxm">Maximilian Michels</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Oct 2015 13:47:51 +0000</created>
                <updated>Fri, 13 Nov 2015 15:55:22 +0000</updated>
                            <resolved>Fri, 13 Nov 2015 15:55:22 +0000</resolved>
                                    <version>0.9</version>
                    <version>0.10.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Command Line Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                                                            <comments>
                            <comment id="14941061" author="mxm" created="Fri, 2 Oct 2015 12:06:34 +0000"  >&lt;p&gt;I would propose &lt;tt&gt;-d&lt;/tt&gt; as a flag for submitting detached jobs. The CLI should exit after the job submission. It would be great if &lt;tt&gt;-d&lt;/tt&gt; also triggered detached execution for YARN jobs. However, the &lt;tt&gt;-yd&lt;/tt&gt; YARN flag has to stay for backwards-compatibility.&lt;/p&gt;</comment>
                            <comment id="14941076" author="mxm" created="Fri, 2 Oct 2015 12:32:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sachingoel0101&quot; class=&quot;user-hover&quot; rel=&quot;sachingoel0101&quot;&gt;sachingoel0101&lt;/a&gt; Did you start working on this? I&apos;d like to get this in soon for the release candidate next week.&lt;/p&gt;</comment>
                            <comment id="14941108" author="sachingoel0101" created="Fri, 2 Oct 2015 13:08:28 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, yes. I&apos;m almost done. Just building and testing locally right now.&lt;/p&gt;</comment>
                            <comment id="14941137" author="githubbot" created="Fri, 2 Oct 2015 13:33:27 +0000"  >&lt;p&gt;GitHub user sachingoel0101 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2797&quot; title=&quot;CLI: Missing option to submit jobs in detached mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2797&quot;&gt;&lt;del&gt;FLINK-2797&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;cli&amp;#93;&lt;/span&gt; Add support for running jobs in detached mode from CLI&lt;/p&gt;

&lt;p&gt;    Adds an option `-d` to run jobs in detached mode.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sachingoel0101/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sachingoel0101/flink&lt;/a&gt; detached_cli&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1214&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f75467cddbc182fdc42061c9ca602e20690a4ef5&lt;br/&gt;
Author: Sachin Goel &amp;lt;sachingoel0101@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-10-02T12:41:09Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2797&quot; title=&quot;CLI: Missing option to submit jobs in detached mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2797&quot;&gt;&lt;del&gt;FLINK-2797&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;cli&amp;#93;&lt;/span&gt; Add support for running jobs in detached mode from CLI&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14941142" author="githubbot" created="Fri, 2 Oct 2015 13:42:21 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145023847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145023847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I tested the normal execution mode. However, I don&apos;t have a yarn setup. Can someone give it a quick check with yarn?&lt;br/&gt;
    Quick question though: In detached mode, print or collect throw exceptions. Is that intended?&lt;/p&gt;</comment>
                            <comment id="14941161" author="githubbot" created="Fri, 2 Oct 2015 13:57:49 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145029090&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145029090&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good but the Maven Checkstyle check doesn&apos;t pass...&lt;/p&gt;</comment>
                            <comment id="14941214" author="githubbot" created="Fri, 2 Oct 2015 14:44:06 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145044584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145044584&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The current version of the detached mode doesn&apos;t really work for eager execution calls like `count()` or `collect()`. Those calls will also be executed detached and thus the result will never be available. I think we can only get this to work if we move the handling of the eager execution into the JobManager.&lt;/p&gt;</comment>
                            <comment id="14941250" author="githubbot" created="Fri, 2 Oct 2015 15:20:27 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145059638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145059638&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It doesn&apos;t really make sense to call `print` or `collect` in detached mode. Even if the result is printed on JobManager, client cannot access it anyway &lt;span class=&quot;error&quot;&gt;&amp;#91;short of going through the std out logs of JM&amp;#93;&lt;/span&gt;.&lt;br/&gt;
    Also, right now, the stack trace for this failure is uninformative.&lt;br/&gt;
    I propose to explicitly disallow functions which access Accumulator results in detached mode &lt;b&gt;viz&lt;/b&gt; `count`, `collect` and `print`. What do you think?&lt;br/&gt;
    We can provide a hint that a sink should be used instead in the exception message.&lt;/p&gt;</comment>
                            <comment id="14943141" author="githubbot" created="Mon, 5 Oct 2015 09:48:38 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145483163&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145483163&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fair enough, we can do this but the error reporting must be pretty good. Otherwise it might confuse users because not everyone gets that eager execution spawns multiple jobs. The documentation should also explain why detached jobs cannot contain eager executions. I&apos;m not sure whether we can still include this in 0.10 but please go ahead if you want to improve the pull request.&lt;/p&gt;</comment>
                            <comment id="14943229" author="githubbot" created="Mon, 5 Oct 2015 11:04:23 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145496208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145496208&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Okay. I will push a fix. I intend to solve it like this:&lt;br/&gt;
    Maintain a static variable in `ExecutionEnvironment`, which is set to true whenever the job is submitted in a detached mode. And the DataSet api throws exceptions accordingly, which can again be handled by the Client to display proper error message. Does that sound okay?&lt;/p&gt;</comment>
                            <comment id="14943305" author="githubbot" created="Mon, 5 Oct 2015 12:31:41 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145513084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145513084&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    That sounds good.&lt;/p&gt;</comment>
                            <comment id="14943860" author="githubbot" created="Mon, 5 Oct 2015 19:13:36 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145635600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145635600&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @uce , I have pushed a commit with my fix for disabling eager execution in detached mode. Please have a look. If it&apos;s okay, I can go ahead with adding docs for it.&lt;/p&gt;</comment>
                            <comment id="14944831" author="githubbot" created="Tue, 6 Oct 2015 10:07:39 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145810314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145810314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , what I&apos;m doing right now is throwing an exception whenever a eager execution function is called in detached mode. However, like you said, maybe the results should be written to a file on the job manager, and we can maintain that information in `JobInfo`. These results can be served to the user from the web frontend under a separate tab for `Outputs`.&lt;br/&gt;
    I can see where the relevant changes would be. In `JobManager.scala`, under the case check for `JobStatusChanged`, whenever the `Client` ref is none, we just write the accumulator results to a file. &lt;br/&gt;
    However, I&apos;m not very familiar with how to access type serializes and type information for de-serializing the results. Can you help with that?&lt;/p&gt;</comment>
                            <comment id="14944860" author="githubbot" created="Tue, 6 Oct 2015 10:34:25 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r41248646&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r41248646&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/apis/programming_guide.md &amp;#8212;&lt;br/&gt;
    @@ -440,6 +440,46 @@ The `execute()` method is returning the `JobExecutionResult`, including executio&lt;br/&gt;
     accumulator results. `print()` and `collect()` are not returning the result, but it can be&lt;br/&gt;
     accessed from the `getLastJobExecutionResult()` method.&lt;/p&gt;

&lt;p&gt;    +Further, `collect`, `print`, `printToErr` and `count` methods are &lt;b&gt;eager execution&lt;/b&gt; methods. This&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think parenthesis make these easier to recognize as methods when skimming over text.&lt;/p&gt;</comment>
                            <comment id="14944872" author="githubbot" created="Tue, 6 Oct 2015 10:42:01 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145818892&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145818892&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Can we step back a bit with this issue? The design for this seems quite crucial to get right to not get extreme code complexity/bloat and make everything about job submission, accumulators, etc very hard in the future.&lt;/p&gt;

&lt;p&gt;    What is the design behind this pull request?&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Can the &quot;detached mode&quot; handle interactive programs?&lt;/li&gt;
	&lt;li&gt;What about programs that use accumulators?&lt;/li&gt;
	&lt;li&gt;If not, how would they be recognized and what errors can be given?&lt;/li&gt;
	&lt;li&gt;The problem here seems very similar to intercepting the execution plan of a job and returning it. Any code sharing?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14944882" author="githubbot" created="Tue, 6 Oct 2015 11:10:10 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145824055&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145824055&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes. I agree. It started out as a simple issue to support detached jobs but gotten a bit messy.&lt;br/&gt;
    1. In detached mode, whether the program is run in interactive mode or normal mode, if there is a call to an eager execution function, it will lead to an exception. &lt;span class=&quot;error&quot;&gt;&amp;#91;As of now.&amp;#93;&lt;/span&gt;&lt;br/&gt;
    2. This is where the problem started to appear more difficult. Since the accumulator addition is entirely handled by Runtime Context, there can be no check whether the job is in detached mode. Of course, having to store this information in two places&lt;span class=&quot;error&quot;&gt;&amp;#91;`ExecutionEnvironment` and `RuntimeContext`&amp;#93;&lt;/span&gt; is poor design. &lt;br/&gt;
    If the job is being run in detached mode, the accumulators are lost and user can never access them or use them.&lt;br/&gt;
    But disallowing accumulators will effectively break most of existing programs. So that&apos;s bad choice.&lt;br/&gt;
    Eager execution functions use just accumulators actually, so, to maintain harmony, we have to maintain them too.&lt;br/&gt;
    If we just consider the first commit of this PR which adds support for executing detached jobs, on a eager call, the main program throws an exception, because the job execution result doesn&apos;t contain any accumulators.&lt;br/&gt;
    ```java&lt;br/&gt;
    this.flatMap(new Utils.CollectHelper&amp;lt;T&amp;gt;(id, serializer)).name(&quot;collect()&quot;)&lt;br/&gt;
    	.output(new DiscardingOutputFormat&amp;lt;T&amp;gt;()).name(&quot;collect() sink&quot;);&lt;br/&gt;
    JobExecutionResult res = getExecutionEnvironment().execute();&lt;br/&gt;
    ```&lt;br/&gt;
    I&apos;m really not sure how to handle accumulators in detached programs. What we can do is:&lt;br/&gt;
    In `JobExecutionResult`, whenever an accumulator is requested, we check for the runtime to be -1, which indicates job was exited in detached mode. Display  a warning to the user on the Cli itself and indicate that the results of accumulators are available on the web frontend &lt;span class=&quot;error&quot;&gt;&amp;#91;which will require writing them to a file on the job manager&amp;#93;&lt;/span&gt;. &lt;br/&gt;
    One more thing: Since the detached mode is available on Yarn, it must throw the exception too in case of `collect` or `print` calls. Is this the case? I can&apos;t check on a yarn cluster myself.&lt;/p&gt;</comment>
                            <comment id="14945495" author="githubbot" created="Tue, 6 Oct 2015 18:10:37 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145949994&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145949994&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @sachingoel0101 You&apos;re right. The detached YARN execution mode is broken for jobs which use eager execution and build other jobs using the results. However, the detached YARN execution could work if the ApplicationMaster executed the program. Essentially, this means shifting the Client to the YARN cluster.&lt;/p&gt;

&lt;p&gt;    @StephanEwen The way Sachin was going to handle the eager execution during detached mode is to throw an Exception. However, the current code doesn&apos;t handle all cases. It is in the nature of an interactive session that multiple jobs can be submitted. Results from submitted jobs can be reused not only via count/collect but also using the returned JobExecutionResult. Therefore, it is very difficult to deal with all these cases. IMHO we can only support non-interactive detached job submissions.&lt;/p&gt;

&lt;p&gt;    All in all, I think this is a nice idea but implementing it has too much overhead. The implications of the changes are not quite clear. I pledge to change this to &quot;Won&apos;t Fix&quot; until we think about a proper implementation. In the meantime, we should fix the detached YARN mode or remove it.&lt;/p&gt;</comment>
                            <comment id="14945621" author="githubbot" created="Tue, 6 Oct 2015 19:26:43 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-145972139&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-145972139&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I agree. We need to have a proper handling of eager execution, and why exactly it shouldn&apos;t be allowed. The client exits is not a very good explanation from the user viewpoint, and it might end up breaking programs.&lt;br/&gt;
    Further, the collect call is used in other API methods as well, for example, in Gelly. Detached mode in the current version will lead to failure of every such code.&lt;/p&gt;

&lt;p&gt;    One question: What exactly is the significance of a detached submission and what does the user expect when they submit the job in detached mode? From what I understand, it should mean that the user should be able to shut down the machine on which the client is present. They should be able to monitor the output for however long they want, stop and resume at a later point. I&apos;m drawing the analogy from how the `screen` program works on linux systems. &lt;br/&gt;
    According to this understanding of mine, the following organization would make sense:&lt;br/&gt;
                                                            __ __ __ __ __ __ __ __ __ __&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  ExecutorClient(invokes main)  &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   [Output available on web        &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;    User(command line/ webclient) -&amp;gt;  |    if detached mode. Otherwise |&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;Actor system receives updates     |    sent to user client&amp;#93;&lt;/span&gt;                  |&lt;br/&gt;
    if not in detached mode otherwise |   [Compute job graph and         |&lt;br/&gt;
    shuts down after submitting]          |       submit to Job Manager]       |  -&amp;gt; Task Managers&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;             Job Manager                 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;__ __ __ __ __ __ __ __ __ __  &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;                                                              Job Manager actor system&lt;/p&gt;

&lt;p&gt;    However, if the executor program is in the job manager actor system, what happens in case of a failure? Can we recover the state of the main thread, its memory space etc. on a different leader?&lt;/p&gt;

&lt;p&gt;    I hope that added something to a discussion that is now bound to happen on detached mode. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="14950397" author="githubbot" created="Fri, 9 Oct 2015 13:40:22 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146874010&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146874010&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Before interactive programs were allowed, the detached mode would have been worked fine because a single JobGraph would have been transferred to the job manager and executed there. This doesn&apos;t make sense now, unless we have another dedicated Executor (like you proposed). If that one is on the job manager, we need a fault tolerance mechanism there. Even after the HA changes, the Client is still the a single point of failure for interactive programs.&lt;/p&gt;</comment>
                            <comment id="14950410" author="githubbot" created="Fri, 9 Oct 2015 13:47:49 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146875588&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146875588&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think it would be fine to not have HA for interactive programs. After all, Flink need no client/master interactivity for streaming and iterations, which is where the HA is most important.&lt;/p&gt;
</comment>
                            <comment id="14950412" author="githubbot" created="Fri, 9 Oct 2015 13:49:50 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146876057&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146876057&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Having a dedicated executor on the JobManager seems like a very big thing, for a not so important issue. Why not just fail when someone tries to submit a interactive program detached?&lt;/p&gt;

&lt;p&gt;    Long term, we can think about deploying the driver program to a YARN container, if desired. That way, the submission process is detached, and the execution follows its core model.&lt;/p&gt;</comment>
                            <comment id="14950416" author="githubbot" created="Fri, 9 Oct 2015 13:53:50 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146877512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146877512&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 for now, just let submission fail for detached interactive programs (with a nice exception) &lt;/p&gt;

&lt;p&gt;    @sachingoel0101 Could you change the PR accordingly? This would also fix the detached YARN mode for interactive programs.&lt;/p&gt;

&lt;p&gt;    +1 for having a dedicated execution container for YARN in the long run&lt;/p&gt;</comment>
                            <comment id="14950515" author="githubbot" created="Fri, 9 Oct 2015 14:55:48 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146895195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146895195&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm, just to confirm one thing:&lt;br/&gt;
    Interactive mode is defined when the the main class isn&apos;t of the type `Program`. In that case, doesn&apos;t it mean we&apos;re essentially failing most of the programs in detached mode? Unless my understanding is wrong of course, in which case could you clarify?&lt;/p&gt;
</comment>
                            <comment id="14950525" author="githubbot" created="Fri, 9 Oct 2015 15:00:27 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146896402&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146896402&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, that is true. We&apos;re failing them which is a similar to failing for eager executions but a much cleaner and easier solution. Essentially, we cannot detect what a user does in interactive mode, that&apos;s why we shouldn&apos;t allow detached mode for interactive programs until we have a more sophisticated solution.&lt;/p&gt;</comment>
                            <comment id="14950533" author="githubbot" created="Fri, 9 Oct 2015 15:06:40 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146897768&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146897768&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @sachingoel0101 you are right, interactive mode is actually pretty broad (as defined in the Client).&lt;/p&gt;

&lt;p&gt;    What I have been taking about in prior comments was programs that do multiple round trips between JobManager and client (because of using `collect()` `count()` or so).&lt;/p&gt;</comment>
                            <comment id="14950536" author="githubbot" created="Fri, 9 Oct 2015 15:09:04 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146898360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146898360&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    When we grab the Optimizer Plan from interactive programs, we also have a similar problem - we would in theory need to execute the whole program. What we do instead is to grab the program part that constitutes the first portion (up to the first job submission to the JobManager)&lt;/p&gt;

&lt;p&gt;    I agree with you, maybe we can do something like that. Failing all interactive programs (in the sense of programs with a `main` function rather than implementing the `Program` interface) is too much of a restriction.&lt;/p&gt;</comment>
                            <comment id="14950540" author="githubbot" created="Fri, 9 Oct 2015 15:14:02 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146899718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146899718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    OK....now I&apos;m confused. This PR was all about disallowing &quot;multiple round trips&quot; and that&apos;s what Sachin tried to solve. Failing all interactive programs detached is a quick solution because solving the &quot;multiple round trips&quot; problem is not trivial. &lt;/p&gt;

&lt;p&gt;    How do you want to detect another execution after the current one? Essentially we have to forbid all user code that follows execute(), collect(), print(), count().&lt;/p&gt;</comment>
                            <comment id="14950553" author="githubbot" created="Fri, 9 Oct 2015 15:22:09 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146901927&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146901927&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    That won&apos;t suffice. Even if we allow one execute call, we cannot be sure that user won&apos;t try to access the `JobExecutionResult`. That also is an issue.&lt;br/&gt;
    Disallowing every program which doesn&apos;t implement the `Program` interface isn&apos;t a good solution. I&apos;m not an expert but most people would usually have a main method. In that case, it doesn&apos;t make sense to have a detached mode if we cannot allow such executions.&lt;br/&gt;
    We might be able to detect the exact program structure by exploiting the Context Environment. Before actually executing the program, we instead first do a validation.&lt;br/&gt;
    1. On an execute call, instead of actually executing the program, we instead build the plan and store it. If another call to execute comes in, we fail.&lt;br/&gt;
    2. The `JobExecutionResult` can be wrapped in a `DetachedExecutionResult` which will fail if user tries to access, say accumulators.&lt;/p&gt;

&lt;p&gt;    In the documentation for detached mode, we should specify that only programs with one execute call, and no usage of the execution result will be allowed. This handles the eager execution issue also.&lt;br/&gt;
    But I&apos;m concerned this isn&apos;t the best possible design.&lt;/p&gt;</comment>
                            <comment id="14950581" author="githubbot" created="Fri, 9 Oct 2015 15:50:00 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146908658&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146908658&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The way we do this with the Optimizer plan is a bit pragmatic. We wick the first runnable part and use that. We could do the same here. Detached mode would submit the first part of the program. If the program has more than one submission to the jobManager, the other ones would not get executed.&lt;/p&gt;</comment>
                            <comment id="14950589" author="githubbot" created="Fri, 9 Oct 2015 15:54:06 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146909628&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146909628&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This will fail hard when users rely on the result of the first job. So imagine your program always worked. You submit it detached and then it fails after 12 hours when the first job completes. Granted, we could alleviate the problem a bit by only allowing execute() for detached programs because then the date has been written to a proper sink. Still, the accumulator values might be used after job completion.&lt;/p&gt;</comment>
                            <comment id="14950601" author="githubbot" created="Fri, 9 Oct 2015 15:55:41 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146909986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146909986&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I would solve it pragmatically and simply make the Program interface a requirement for detached programs. Otherwise, fail with an explanation.&lt;/p&gt;</comment>
                            <comment id="14950605" author="githubbot" created="Fri, 9 Oct 2015 15:59:59 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146911063&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146911063&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think we need to ensure that interactive programs which can execute successfully should still be allowed.&lt;br/&gt;
    What I proposed should work. I can push a commit and we can discuss whether it&apos;s a nice solution or not. But it most certainly makes the detached mode more useful.&lt;/p&gt;</comment>
                            <comment id="14950611" author="githubbot" created="Fri, 9 Oct 2015 16:04:21 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146911998&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146911998&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    With proper documentation, failing on the second execute could be an acceptable workaround but it&apos;s bound to cause trouble. In addition we might want to warn users on the command line.&lt;/p&gt;</comment>
                            <comment id="14950616" author="githubbot" created="Fri, 9 Oct 2015 16:06:45 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146912518&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146912518&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    We can go with the `Program` interface ,but I think that is such a heavy restriction that this effectively renders the feature useless...&lt;/p&gt;</comment>
                            <comment id="14950629" author="githubbot" created="Fri, 9 Oct 2015 16:10:40 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146913514&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146913514&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    IMO even removing the detached mode might be better than restricting to `Program` interface. Instead of failing late in the execution, or with a non-informative warning, it would be better to fail before submitting anything to the JobManager, and throw a nice exception message documenting the exact cause of failure.&lt;/p&gt;</comment>
                            <comment id="14950634" author="githubbot" created="Fri, 9 Oct 2015 16:13:21 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146914064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146914064&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    There are three root causes(please add if I&apos;ve missed any.)&lt;br/&gt;
    1. Call to execute twice&lt;br/&gt;
    2. Access job execution results.&lt;br/&gt;
    3. Executing one of the eager execution methods as the first part of program. &lt;span class=&quot;error&quot;&gt;&amp;#91;Second time is automatically a failure&amp;#93;&lt;/span&gt;&lt;br/&gt;
    We can handle all three easily. If a program doesn&apos;t have any of these, it shouldn&apos;t be failed.&lt;/p&gt;</comment>
                            <comment id="14950643" author="githubbot" created="Fri, 9 Oct 2015 16:22:34 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146918295&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146918295&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good points. &lt;/p&gt;

&lt;p&gt;    I think that should do it, Sachin. Curious, how you&apos;ll implement it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Don&apos;t we run into the problem that we never know if another execution followed unless we execute the whole user code (might have some other side effects)? However, it&apos;s the only way to check whether we can submit the job detached. Another approach I can think of is bytecode analysis.. &lt;/p&gt;</comment>
                            <comment id="14951151" author="githubbot" created="Fri, 9 Oct 2015 20:34:31 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-146980054&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-146980054&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm @StephanEwen I have an implementation ready. I have also added unit tests to verify the behavior. Let me know if this is an acceptable way. All the relevant changes are in the second commit.&lt;/p&gt;</comment>
                            <comment id="14951854" author="githubbot" created="Sat, 10 Oct 2015 14:04:51 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-147091911&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-147091911&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I tested this out on yarn and without yarn. Works like a charm. &lt;br/&gt;
    However, the travis builds are failing in `flink-yarn-tests`. Is there any way I can access the travis logs? I tried debugging in IntelliJ but it fails to find the jar. Running on linux is getting stuck at `Connecting to ResourceManager at ubuntu:8032`. Is there anything specific to keep in mind while running yarn tests?&lt;/p&gt;</comment>
                            <comment id="14951957" author="githubbot" created="Sat, 10 Oct 2015 17:53:28 +0000"  >&lt;p&gt;Github user hsaputra commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-147112611&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-147112611&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @sachingoel0101 , could you access this URL: &lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/84664370&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/84664370&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    You could always set your own Apache Flink forked repo. That way you could try to send PR against your own copy of the repo to kick off Travis.&lt;/p&gt;</comment>
                            <comment id="14951975" author="githubbot" created="Sat, 10 Oct 2015 18:26:08 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-147114132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-147114132&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @hsaputra Yes. However, the travis build log doesn&apos;t display the exact cause of the failure. In the code, there is code to log the file with prohibited strings at error level, however, it isn&apos;t actually happening. &lt;br/&gt;
    The problem is I&apos;m unable to test the module locally. Yarn works without any issues if I use, say, `bin/yarn-session.sh` or start a cluster using `start-yarn.sh`, but the tests are getting stuck. I was just wondering if it requires any special configuration to run the tests.&lt;/p&gt;</comment>
                            <comment id="14952388" author="githubbot" created="Sun, 11 Oct 2015 18:57:57 +0000"  >&lt;p&gt;Github user hsaputra commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-147235260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-147235260&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Seems like each build fail in different places.&lt;/p&gt;</comment>
                            <comment id="14956617" author="githubbot" created="Wed, 14 Oct 2015 10:02:14 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-147997899&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-147997899&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Failures on unrelated cases: JIRA 2847, and the scala shell test is flaky. Till is working on it.&lt;/p&gt;</comment>
                            <comment id="14963097" author="githubbot" created="Mon, 19 Oct 2015 10:02:54 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-149172503&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-149172503&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The test failures are on the flaky scala shell integration test.&lt;/p&gt;

&lt;p&gt;    @mxm @StephanEwen , can you take a look at this so we can add proper documentation to the programming guide.&lt;/p&gt;
</comment>
                            <comment id="14969411" author="githubbot" created="Thu, 22 Oct 2015 16:38:18 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42772489&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42772489&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/Client.java &amp;#8212;&lt;br/&gt;
    @@ -277,12 +278,20 @@ else if (prog.isUsingInteractiveMode()) {&lt;br/&gt;
     			// invoke here&lt;br/&gt;
     			try {&lt;br/&gt;
     				prog.invokeInteractiveModeForExecution();&lt;br/&gt;
    +				// if we&apos;re here, it means the program is valid for detached mode execution.&lt;br/&gt;
    +				JobWithJars plan = ContextEnvironment.ContextEnvironmentFactory.getPlan();&lt;br/&gt;
    +				JobGraph graph = ContextEnvironment.ContextEnvironmentFactory.getGraph();&lt;br/&gt;
    +				if (plan != null &amp;amp;&amp;amp; graph == null) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    What would happen if we created a streaming program and a batch program in one jar? Then both would be set and only the batch program would be created...&lt;/p&gt;</comment>
                            <comment id="14969413" author="githubbot" created="Thu, 22 Oct 2015 16:39:17 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42772606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42772606&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -172,5 +184,74 @@ public ExecutionEnvironment createExecutionEnvironment() {&lt;br/&gt;
     			}&lt;br/&gt;
     			return env;&lt;br/&gt;
     		}&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void setPlan(JobWithJars plan) {&lt;br/&gt;
    +			if (_plan == null) &lt;/p&gt;
{
    +				_plan = plan;
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				throw new DetachedProgramException(&quot;The Job was submitted in detached mode. Only &quot; +
    +						&quot;one execution is allowed. Please make sure your program doesn&apos;t call &quot; +
    +						&quot;execute twice and/or doesn&apos;t call an eager execution function[collect, &quot; +
    +						&quot;print, printToErr, count].\n&quot;);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		public static JobWithJars getPlan() &lt;/p&gt;
{
    +			return _plan;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		public static JobGraph getGraph() &lt;/p&gt;
{
    +			return _graph;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		public static void setGraph(JobGraph graph) {&lt;br/&gt;
    +			if (_graph == null) &lt;/p&gt;
{
    +				_graph = graph;
    +			}
&lt;p&gt; else &lt;/p&gt;
{
    +				throw new DetachedProgramException(&quot;The Job was submitted in detached mode. Only &quot; +
    +						&quot;one call to execute is allowed.&quot;);
    +			}
&lt;p&gt;    +		}&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class DetachedJobExecutionResult extends JobExecutionResult {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static final DetachedJobExecutionResult INSTANCE = new DetachedJobExecutionResult();&lt;br/&gt;
    +&lt;br/&gt;
    +		public DetachedJobExecutionResult() {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Constructor should be private to be a singleton.&lt;/p&gt;</comment>
                            <comment id="14969414" author="githubbot" created="Thu, 22 Oct 2015 16:39:29 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42772634&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42772634&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -161,6 +171,8 @@ public ContextEnvironmentFactory(Client client, List&amp;lt;URL&amp;gt; jarFilesToAttach,&lt;br/&gt;
     			this.userCodeClassLoader = userCodeClassLoader;&lt;br/&gt;
     			this.defaultParallelism = defaultParallelism;&lt;br/&gt;
     			this.wait = wait;&lt;br/&gt;
    +			_plan = null;&lt;br/&gt;
    +			_graph = null;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Is there a reason for these odd names? `lastBatchPlan` and `lastStreamJobGraph` would be more appropriate. The first one is for batch programs, the latter for JobGraph created by the streaming API.&lt;/p&gt;</comment>
                            <comment id="14969416" author="githubbot" created="Thu, 22 Oct 2015 16:39:42 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42772661&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42772661&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -139,6 +140,69 @@ public void shouldSubmitToJobClient() {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Tests that invalid detached mode programs fail.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testDetachedMode() throws Exception{&lt;br/&gt;
    +		jobManagerSystem.actorOf(Props.create(SuccessReturningActor.class), JobManager.JOB_MANAGER_NAME());&lt;br/&gt;
    +		Client out = new Client(config);&lt;br/&gt;
    +&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			PackagedProgram prg = new PackagedProgram(TestExecuteTwice.class, &quot;/dev/random&quot;, &quot;/tmp&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This should write to System.getProperty(&quot;java.io.tmpdir&quot;) and have some other Random input to be cross-platform compatible.&lt;/p&gt;</comment>
                            <comment id="14969417" author="githubbot" created="Thu, 22 Oct 2015 16:39:45 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42772667&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42772667&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -139,6 +140,69 @@ public void shouldSubmitToJobClient() {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Tests that invalid detached mode programs fail.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testDetachedMode() throws Exception{&lt;br/&gt;
    +		jobManagerSystem.actorOf(Props.create(SuccessReturningActor.class), JobManager.JOB_MANAGER_NAME());&lt;br/&gt;
    +		Client out = new Client(config);&lt;br/&gt;
    +&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			PackagedProgram prg = new PackagedProgram(TestExecuteTwice.class, &quot;/dev/random&quot;, &quot;/tmp&quot;);
    +			out.runDetached(prg, 1);
    +		}
&lt;p&gt; catch (ProgramInvocationException e) {&lt;br/&gt;
    +			assertEquals(&quot;The Job was submitted in detached mode. Only one execution is allowed. &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Can we make this message available somewhere such that it doesn&apos;t have to be copied over and over?&lt;/p&gt;</comment>
                            <comment id="14969418" author="githubbot" created="Thu, 22 Oct 2015 16:39:57 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42772695&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42772695&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -304,4 +368,60 @@ public String getDescription() &lt;/p&gt;
{
     			return &quot;TestOptimizerPlan &amp;lt;input-file-path&amp;gt; &amp;lt;output-file-path&amp;gt;&quot;;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class TestExecuteTwice {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void main(String args[]) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    These are no proper tests.&lt;/p&gt;</comment>
                            <comment id="14969420" author="githubbot" created="Thu, 22 Oct 2015 16:41:02 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-150283627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-150283627&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the update @sachingoel0101. I&apos;ve made some comments. I think the pull request needs a bit of cleanup to make things more explicit. The general approach looks good.&lt;/p&gt;</comment>
                            <comment id="14969432" author="githubbot" created="Thu, 22 Oct 2015 16:52:10 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42774255&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42774255&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/Client.java &amp;#8212;&lt;br/&gt;
    @@ -277,12 +278,20 @@ else if (prog.isUsingInteractiveMode()) {&lt;br/&gt;
     			// invoke here&lt;br/&gt;
     			try {&lt;br/&gt;
     				prog.invokeInteractiveModeForExecution();&lt;br/&gt;
    +				// if we&apos;re here, it means the program is valid for detached mode execution.&lt;br/&gt;
    +				JobWithJars plan = ContextEnvironment.ContextEnvironmentFactory.getPlan();&lt;br/&gt;
    +				JobGraph graph = ContextEnvironment.ContextEnvironmentFactory.getGraph();&lt;br/&gt;
    +				if (plan != null &amp;amp;&amp;amp; graph == null) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Ah. I had not considered this possibility. What should be done in such a case? Execute both programs? That does make sense, but what should be the return value? &lt;/p&gt;</comment>
                            <comment id="14969435" author="githubbot" created="Thu, 22 Oct 2015 16:53:28 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42774405&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42774405&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -161,6 +171,8 @@ public ContextEnvironmentFactory(Client client, List&amp;lt;URL&amp;gt; jarFilesToAttach,&lt;br/&gt;
     			this.userCodeClassLoader = userCodeClassLoader;&lt;br/&gt;
     			this.defaultParallelism = defaultParallelism;&lt;br/&gt;
     			this.wait = wait;&lt;br/&gt;
    +			_plan = null;&lt;br/&gt;
    +			_graph = null;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I tend to use `_field` appended names instead of `this.field`. But yeah. `last*` makes more sense here.&lt;/p&gt;</comment>
                            <comment id="14969446" author="githubbot" created="Thu, 22 Oct 2015 16:55:31 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42774635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42774635&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -139,6 +140,69 @@ public void shouldSubmitToJobClient() {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Tests that invalid detached mode programs fail.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testDetachedMode() throws Exception{&lt;br/&gt;
    +		jobManagerSystem.actorOf(Props.create(SuccessReturningActor.class), JobManager.JOB_MANAGER_NAME());&lt;br/&gt;
    +		Client out = new Client(config);&lt;br/&gt;
    +&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			PackagedProgram prg = new PackagedProgram(TestExecuteTwice.class, &quot;/dev/random&quot;, &quot;/tmp&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I was following the code in `testGetExecutionPlan`. Can you elaborate a bit more?&lt;/p&gt;</comment>
                            <comment id="14969447" author="githubbot" created="Thu, 22 Oct 2015 16:55:41 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42774659&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42774659&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -139,6 +140,69 @@ public void shouldSubmitToJobClient() {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Tests that invalid detached mode programs fail.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testDetachedMode() throws Exception{&lt;br/&gt;
    +		jobManagerSystem.actorOf(Props.create(SuccessReturningActor.class), JobManager.JOB_MANAGER_NAME());&lt;br/&gt;
    +		Client out = new Client(config);&lt;br/&gt;
    +&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			PackagedProgram prg = new PackagedProgram(TestExecuteTwice.class, &quot;/dev/random&quot;, &quot;/tmp&quot;);
    +			out.runDetached(prg, 1);
    +		}
&lt;p&gt; catch (ProgramInvocationException e) {&lt;br/&gt;
    +			assertEquals(&quot;The Job was submitted in detached mode. Only one execution is allowed. &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Will do.&lt;/p&gt;</comment>
                            <comment id="14969448" author="githubbot" created="Thu, 22 Oct 2015 16:56:38 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42774775&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42774775&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -304,4 +368,60 @@ public String getDescription() &lt;/p&gt;
{
     			return &quot;TestOptimizerPlan &amp;lt;input-file-path&amp;gt; &amp;lt;output-file-path&amp;gt;&quot;;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class TestExecuteTwice {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void main(String args[]) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I was concerned about this too. Perhaps a better idea would be have these classes in the test-jar?&lt;/p&gt;</comment>
                            <comment id="14969503" author="githubbot" created="Thu, 22 Oct 2015 17:28:19 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42778575&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42778575&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -139,6 +140,69 @@ public void shouldSubmitToJobClient() {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Tests that invalid detached mode programs fail.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testDetachedMode() throws Exception{&lt;br/&gt;
    +		jobManagerSystem.actorOf(Props.create(SuccessReturningActor.class), JobManager.JOB_MANAGER_NAME());&lt;br/&gt;
    +		Client out = new Client(config);&lt;br/&gt;
    +&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			PackagedProgram prg = new PackagedProgram(TestExecuteTwice.class, &quot;/dev/random&quot;, &quot;/tmp&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Actually, these arguments are not needed. I will simply remove them.&lt;br/&gt;
    Also, in `textGetExecutionPlan` where these values are used, the locations are not actually accessed. Only plan is tested. So shouldn&apos;t be an issue.&lt;/p&gt;</comment>
                            <comment id="14969512" author="githubbot" created="Thu, 22 Oct 2015 17:35:03 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-150299549&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-150299549&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , I have addressed some of your comments. &lt;br/&gt;
    Two things still remain: batch + stream jobs, and better tests. Need advice on those.&lt;/p&gt;</comment>
                            <comment id="14971182" author="githubbot" created="Fri, 23 Oct 2015 15:39:16 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42879700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42879700&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -139,6 +141,69 @@ public void shouldSubmitToJobClient() {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Tests that invalid detached mode programs fail.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testDetachedMode() throws Exception{&lt;br/&gt;
    +		jobManagerSystem.actorOf(Props.create(SuccessReturningActor.class), JobManager.JOB_MANAGER_NAME());&lt;br/&gt;
    +		Client out = new Client(config);&lt;br/&gt;
    +&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			PackagedProgram prg = new PackagedProgram(TestExecuteTwice.class);
    +			out.runDetached(prg, 1);
    +		}
&lt;p&gt; catch (ProgramInvocationException e) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The problem with this test is that it doesn&apos;t fail if the Program actually runs (which is the aim of the test...).&lt;/p&gt;</comment>
                            <comment id="14971185" author="githubbot" created="Fri, 23 Oct 2015 15:39:45 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42879750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42879750&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -304,4 +368,60 @@ public String getDescription() &lt;/p&gt;
{
     			return &quot;TestOptimizerPlan &amp;lt;input-file-path&amp;gt; &amp;lt;output-file-path&amp;gt;&quot;;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class TestExecuteTwice {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void main(String args[]) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Oh didn&apos;t see you actually use these. Then its fine. Perhaps make them private.&lt;/p&gt;</comment>
                            <comment id="14971231" author="githubbot" created="Fri, 23 Oct 2015 15:59:40 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42882120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42882120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -139,6 +141,69 @@ public void shouldSubmitToJobClient() {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;br/&gt;
    +	 * Tests that invalid detached mode programs fail.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testDetachedMode() throws Exception{&lt;br/&gt;
    +		jobManagerSystem.actorOf(Props.create(SuccessReturningActor.class), JobManager.JOB_MANAGER_NAME());&lt;br/&gt;
    +		Client out = new Client(config);&lt;br/&gt;
    +&lt;br/&gt;
    +		try &lt;/p&gt;
{
    +			PackagedProgram prg = new PackagedProgram(TestExecuteTwice.class);
    +			out.runDetached(prg, 1);
    +		}
&lt;p&gt; catch (ProgramInvocationException e) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Aha. Good point. Will fix it.&lt;/p&gt;</comment>
                            <comment id="14971233" author="githubbot" created="Fri, 23 Oct 2015 16:00:51 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42882261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42882261&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -304,4 +368,60 @@ public String getDescription() &lt;/p&gt;
{
     			return &quot;TestOptimizerPlan &amp;lt;input-file-path&amp;gt; &amp;lt;output-file-path&amp;gt;&quot;;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class TestExecuteTwice {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void main(String args[]) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    &amp;gt; I guess then the invocation of the main method doesn&apos;t work properly...&lt;br/&gt;
    What do you mean by that?&lt;/p&gt;</comment>
                            <comment id="14971285" author="githubbot" created="Fri, 23 Oct 2015 16:22:39 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42884467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42884467&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -304,4 +368,60 @@ public String getDescription() &lt;/p&gt;
{
     			return &quot;TestOptimizerPlan &amp;lt;input-file-path&amp;gt; &amp;lt;output-file-path&amp;gt;&quot;;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class TestExecuteTwice {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void main(String args[]) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    A `PackagedProgram` needs to have a main class with a main method with a `public` modifier. That&apos;s why it wouldn&apos;t work.&lt;/p&gt;</comment>
                            <comment id="14971328" author="githubbot" created="Fri, 23 Oct 2015 16:38:36 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42886049&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42886049&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -304,4 +368,60 @@ public String getDescription() &lt;/p&gt;
{
     			return &quot;TestOptimizerPlan &amp;lt;input-file-path&amp;gt; &amp;lt;output-file-path&amp;gt;&quot;;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class TestExecuteTwice {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void main(String args[]) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes. But marking the class `private` won&apos;t interfere with that. I&apos;ve already pushed a fix and it does pass.&lt;/p&gt;</comment>
                            <comment id="14974019" author="githubbot" created="Mon, 26 Oct 2015 10:57:17 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r42979520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r42979520&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -304,4 +368,60 @@ public String getDescription() &lt;/p&gt;
{
     			return &quot;TestOptimizerPlan &amp;lt;input-file-path&amp;gt; &amp;lt;output-file-path&amp;gt;&quot;;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class TestExecuteTwice {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void main(String args[]) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Ok that&apos;s better then! Thanks&lt;/p&gt;
</comment>
                            <comment id="14974487" author="githubbot" created="Mon, 26 Oct 2015 16:19:43 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43015201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43015201&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/test/java/org/apache/flink/client/program/ClientTest.java &amp;#8212;&lt;br/&gt;
    @@ -304,4 +368,60 @@ public String getDescription() &lt;/p&gt;
{
     			return &quot;TestOptimizerPlan &amp;lt;input-file-path&amp;gt; &amp;lt;output-file-path&amp;gt;&quot;;
     		}
&lt;p&gt;     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	public static final class TestExecuteTwice {&lt;br/&gt;
    +&lt;br/&gt;
    +		public static void main(String args[]) throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Okay. Cool. Lemme know if there&apos;s any other issues to address. :smile:&lt;/p&gt;</comment>
                            <comment id="14974646" author="githubbot" created="Mon, 26 Oct 2015 17:49:35 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-151224527&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-151224527&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I took a look at this again because I wanted to merge it for 0.10. However, I think it still needs a bit of work. The `ContextEnvironmentFactory` shouldn&apos;t hold the state for detached batch and stream executions. Could you store the batch plan in the `ContextEnvironment` and the stream graph in the `StreamContextEnvironment` (non-static)? Please give them appropriate names.&lt;/p&gt;

&lt;p&gt;    Since the `ContextEnvironmentFactory` is currently the entry point for batch and streaming execution (the streaming environment just checks whether the `ContextEnvironment` is instantiated), you may set a flag in the factory to prevent multiple executions.&lt;/p&gt;</comment>
                            <comment id="14975886" author="githubbot" created="Tue, 27 Oct 2015 07:39:33 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-151402904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-151402904&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm I have made some changes and now the &lt;b&gt;current&lt;/b&gt; plan resides in the `ContextEnvironment`. This required some changes in `StreamContextEnvironment`, which now wraps the `ContextEnvironment` which was initially created to check the existence of context environment.&lt;br/&gt;
    Furthermore, `ContextEnvironmentFactory` needs to store the last context environment created, which can be used then to access the plan, so it can be executed after the call to interactive program&apos;s `main` finishes.&lt;/p&gt;</comment>
                            <comment id="14976070" author="githubbot" created="Tue, 27 Oct 2015 09:23:57 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43098098&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43098098&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -75,29 +62,31 @@ public JobExecutionResult execute() throws Exception {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JobGraph jobGraph;&lt;/li&gt;
	&lt;li&gt;if (jobName == null) 
{
    -			jobGraph = this.getStreamGraph().getJobGraph();
    -		}
&lt;p&gt; else &lt;/p&gt;
{
    -			jobGraph = this.getStreamGraph().getJobGraph(jobName);
    -		}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transformations.clear();&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// attach all necessary jar files to the JobGraph&lt;/li&gt;
	&lt;li&gt;for (URL file : jars) 
{
    -			jobGraph.addJar(new Path(file.toURI()));
    -		}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;jobGraph.setClasspaths(classpaths);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No classpaths for detached jobs?&lt;/p&gt;</comment>
                            <comment id="14976071" author="githubbot" created="Tue, 27 Oct 2015 09:23:58 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43098099&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43098099&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -75,29 +62,31 @@ public JobExecutionResult execute() throws Exception {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JobGraph jobGraph;&lt;/li&gt;
	&lt;li&gt;if (jobName == null) 
{
    -			jobGraph = this.getStreamGraph().getJobGraph();
    -		}
&lt;p&gt; else &lt;/p&gt;
{
    -			jobGraph = this.getStreamGraph().getJobGraph(jobName);
    -		}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transformations.clear();&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// attach all necessary jar files to the JobGraph&lt;/li&gt;
	&lt;li&gt;for (URL file : jars) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No Jars for detached jobs?&lt;/p&gt;</comment>
                            <comment id="14976077" author="githubbot" created="Tue, 27 Oct 2015 09:25:31 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43098234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43098234&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/Client.java &amp;#8212;&lt;br/&gt;
    @@ -271,18 +272,21 @@ public JobSubmissionResult runDetached(PackagedProgram prog, int parallelism)&lt;br/&gt;
     		}&lt;br/&gt;
     		else if (prog.isUsingInteractiveMode()) {&lt;br/&gt;
     			LOG.info(&quot;Starting program in interactive mode&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ContextEnvironment.setAsContext(this, prog.getAllLibraries(), prog.getClasspaths(),&lt;/li&gt;
	&lt;li&gt;prog.getUserCodeClassLoader(), parallelism, false);&lt;br/&gt;
    -&lt;br/&gt;
    +			ContextEnvironment.ContextEnvironmentFactory factory = ContextEnvironment.setAsContext(this,&lt;br/&gt;
    +					prog.getAllLibraries(), prog.getClasspaths(), prog.getUserCodeClassLoader(), parallelism, false);&lt;br/&gt;
     			// invoke here&lt;br/&gt;
     			try {&lt;br/&gt;
     				prog.invokeInteractiveModeForExecution();&lt;br/&gt;
    +				ContextEnvironment ctx = factory.getLastEnvironment();&lt;br/&gt;
    +				if (ctx == null) {&lt;br/&gt;
    +					throw new InvalidProgramException(&quot;No execution environment was created.&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Do we really want to fail here?&lt;/p&gt;</comment>
                            <comment id="14976078" author="githubbot" created="Tue, 27 Oct 2015 09:26:01 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43098268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43098268&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/CliFrontend.java &amp;#8212;&lt;br/&gt;
    @@ -909,7 +919,21 @@ private int handleError(Throwable t) {&lt;br/&gt;
     		}&lt;br/&gt;
     		LOG.error(&quot;Error while running the command.&quot;, t);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;t.printStackTrace();&lt;br/&gt;
    +		// check if the error was due to an invalid program in detached mode.&lt;br/&gt;
    +		if (t instanceof ProgramInvocationException &amp;amp;&amp;amp; t.getCause() instanceof DetachedProgramException) {&lt;br/&gt;
    +			System.err.println(t.getCause().getMessage());&lt;br/&gt;
    +			// now trace to the user&apos;s main method. We don&apos;t wanna show unnecessary information&lt;br/&gt;
    +			// in this particular case.
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why in this case? Doesn&apos;t that apply to all errors that occur during interactive execution?&lt;/p&gt;</comment>
                            <comment id="14976079" author="githubbot" created="Tue, 27 Oct 2015 09:27:11 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43098367&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43098367&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -75,29 +62,31 @@ public JobExecutionResult execute() throws Exception {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JobGraph jobGraph;&lt;/li&gt;
	&lt;li&gt;if (jobName == null) 
{
    -			jobGraph = this.getStreamGraph().getJobGraph();
    -		}
&lt;p&gt; else &lt;/p&gt;
{
    -			jobGraph = this.getStreamGraph().getJobGraph(jobName);
    -		}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transformations.clear();&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// attach all necessary jar files to the JobGraph&lt;/li&gt;
	&lt;li&gt;for (URL file : jars) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The detached job goes through `Client#getJobGraph(FlinkPlan, List&amp;lt;URL&amp;gt;, List&amp;lt;URL&amp;gt;)` where the jars and classpaths are added to the job graph. &lt;/p&gt;</comment>
                            <comment id="14976080" author="githubbot" created="Tue, 27 Oct 2015 09:27:54 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43098424&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43098424&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/Client.java &amp;#8212;&lt;br/&gt;
    @@ -271,18 +272,21 @@ public JobSubmissionResult runDetached(PackagedProgram prog, int parallelism)&lt;br/&gt;
     		}&lt;br/&gt;
     		else if (prog.isUsingInteractiveMode()) {&lt;br/&gt;
     			LOG.info(&quot;Starting program in interactive mode&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ContextEnvironment.setAsContext(this, prog.getAllLibraries(), prog.getClasspaths(),&lt;/li&gt;
	&lt;li&gt;prog.getUserCodeClassLoader(), parallelism, false);&lt;br/&gt;
    -&lt;br/&gt;
    +			ContextEnvironment.ContextEnvironmentFactory factory = ContextEnvironment.setAsContext(this,&lt;br/&gt;
    +					prog.getAllLibraries(), prog.getClasspaths(), prog.getUserCodeClassLoader(), parallelism, false);&lt;br/&gt;
     			// invoke here&lt;br/&gt;
     			try {&lt;br/&gt;
     				prog.invokeInteractiveModeForExecution();&lt;br/&gt;
    +				ContextEnvironment ctx = factory.getLastEnvironment();&lt;br/&gt;
    +				if (ctx == null) {&lt;br/&gt;
    +					throw new InvalidProgramException(&quot;No execution environment was created.&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    It&apos;s not strictly necessary. This should return a `JobSubmissionResult` with null job id then.&lt;/p&gt;</comment>
                            <comment id="14976084" author="githubbot" created="Tue, 27 Oct 2015 09:31:22 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43098720&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43098720&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/CliFrontend.java &amp;#8212;&lt;br/&gt;
    @@ -909,7 +919,21 @@ private int handleError(Throwable t) {&lt;br/&gt;
     		}&lt;br/&gt;
     		LOG.error(&quot;Error while running the command.&quot;, t);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;t.printStackTrace();&lt;br/&gt;
    +		// check if the error was due to an invalid program in detached mode.&lt;br/&gt;
    +		if (t instanceof ProgramInvocationException &amp;amp;&amp;amp; t.getCause() instanceof DetachedProgramException) {&lt;br/&gt;
    +			System.err.println(t.getCause().getMessage());&lt;br/&gt;
    +			// now trace to the user&apos;s main method. We don&apos;t wanna show unnecessary information&lt;br/&gt;
    +			// in this particular case.
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    True. I didn&apos;t wanna change the existing stack traces.&lt;br/&gt;
    This will require maintaining a global variable for whether the program was run in interactive mode. The `DetachedProgramException` is a special case where we don&apos;t wanna clutter the stack trace with flink&apos;s trace, instead just show the user program&apos;s stack trace.&lt;br/&gt;
    In other cases, this might not be the case.&lt;/p&gt;</comment>
                            <comment id="14976087" author="githubbot" created="Tue, 27 Oct 2015 09:32:31 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-151430438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-151430438&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks. Looks much better. Let&apos;s make sure we don&apos;t break any classloader or jar dependencies during job submission. This can cause annoyances for users and we have to fix it afterwards &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14976104" author="githubbot" created="Tue, 27 Oct 2015 09:43:37 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-151435402&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-151435402&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Agreed. I&apos;ll build and test with the example programs in standalone mode and on yarn. It should work perfectly though since `YarnSessionFIFOITCase` checks both batch and streaming jobs on detached clusters, and the standalone mode is tested in `ClientTest#testDetached`.&lt;/p&gt;</comment>
                            <comment id="14976226" author="githubbot" created="Tue, 27 Oct 2015 11:10:31 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-151458018&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-151458018&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , I have tested the build with the following commands:&lt;br/&gt;
    1. Standalone cluster: `bin/flink run -d` for both streaming and batch wordcount examples.&lt;br/&gt;
    2. Yarn: `bin/flink run -d -m yarn-cluster` and `bin/flink run -m yarn-cluster -yd` for both streaming and batch wordcount.&lt;br/&gt;
    Lemme know if there&apos;s any other checks to be made.&lt;br/&gt;
    Also, what should I do about &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43098424?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43098424?&lt;/a&gt; Let it be or return a null job id?&lt;/p&gt;</comment>
                            <comment id="14978450" author="githubbot" created="Wed, 28 Oct 2015 13:49:05 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-151849439&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-151849439&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , if there are any more comments, let me know. I&apos;ll try to resolve them quickly so we can include this in the next rc (which will likely be the last one&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;). A round of testing might be needed to make sure everything works fine. I&apos;m not much aware of how streaming jobs work, so I might have missed something while testing myself.&lt;/p&gt;</comment>
                            <comment id="14978611" author="githubbot" created="Wed, 28 Oct 2015 15:43:26 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43273230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43273230&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/Client.java &amp;#8212;&lt;br/&gt;
    @@ -271,18 +272,21 @@ public JobSubmissionResult runDetached(PackagedProgram prog, int parallelism)&lt;br/&gt;
     		}&lt;br/&gt;
     		else if (prog.isUsingInteractiveMode()) {&lt;br/&gt;
     			LOG.info(&quot;Starting program in interactive mode&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ContextEnvironment.setAsContext(this, prog.getAllLibraries(), prog.getClasspaths(),&lt;/li&gt;
	&lt;li&gt;prog.getUserCodeClassLoader(), parallelism, false);&lt;br/&gt;
    -&lt;br/&gt;
    +			ContextEnvironment.ContextEnvironmentFactory factory = ContextEnvironment.setAsContext(this,&lt;br/&gt;
    +					prog.getAllLibraries(), prog.getClasspaths(), prog.getUserCodeClassLoader(), parallelism, false);&lt;br/&gt;
     			// invoke here&lt;br/&gt;
     			try {&lt;br/&gt;
     				prog.invokeInteractiveModeForExecution();&lt;br/&gt;
    +				ContextEnvironment ctx = factory.getLastEnvironment();&lt;br/&gt;
    +				if (ctx == null) {&lt;br/&gt;
    +					throw new InvalidProgramException(&quot;No execution environment was created.&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Ok let&apos;s leave it like that.&lt;/p&gt;</comment>
                            <comment id="14982519" author="githubbot" created="Fri, 30 Oct 2015 12:57:48 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43498784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43498784&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -75,29 +62,31 @@ public JobExecutionResult execute() throws Exception {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JobGraph jobGraph;&lt;/li&gt;
	&lt;li&gt;if (jobName == null) 
{
    -			jobGraph = this.getStreamGraph().getJobGraph();
    -		}
&lt;p&gt; else &lt;/p&gt;
{
    -			jobGraph = this.getStreamGraph().getJobGraph(jobName);
    -		}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transformations.clear();&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// attach all necessary jar files to the JobGraph&lt;/li&gt;
	&lt;li&gt;for (URL file : jars) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Jars and classpaths also need to be attached to the JobGraph of the non-detached streaming job, right? Wouldn&apos;t it be nice to always do that at the Client? It&apos;s always good to avoid multiple branches for doing the same thing. `Client.getJobGraph(FlinkPlan,..` enables you to pass the streamgraph directly with the jars and classpaths.&lt;/p&gt;</comment>
                            <comment id="14984807" author="githubbot" created="Mon, 2 Nov 2015 06:55:40 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-152934449&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-152934449&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm, since you already delegated job graph creation to the Client in one of your commits, I&apos;ve removed that from my commits. Rebasing required squashing all commits first.&lt;/p&gt;</comment>
                            <comment id="14984810" author="githubbot" created="Mon, 2 Nov 2015 06:57:49 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43600897&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43600897&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -36,28 +31,16 @@&lt;/p&gt;

&lt;p&gt;     	private static final Logger LOG = LoggerFactory.getLogger(StreamContextEnvironment.class);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final List&amp;lt;URL&amp;gt; jars;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;private final List&amp;lt;URL&amp;gt; classpaths;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;private final Client client;&lt;br/&gt;
    +	private final ContextEnvironment ctx;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private final ClassLoader userCodeClassLoader;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;private final boolean wait;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected StreamContextEnvironment(Client client, List&amp;lt;URL&amp;gt; jars, List&amp;lt;URL&amp;gt; classpaths, int parallelism,&lt;/li&gt;
	&lt;li&gt;boolean wait) {&lt;/li&gt;
	&lt;li&gt;this.client = client;&lt;/li&gt;
	&lt;li&gt;this.jars = jars;&lt;/li&gt;
	&lt;li&gt;this.classpaths = classpaths;&lt;/li&gt;
	&lt;li&gt;this.wait = wait;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;this.userCodeClassLoader = JobWithJars.buildUserCodeClassLoader(jars, classpaths,&lt;/li&gt;
	&lt;li&gt;getClass().getClassLoader());&lt;br/&gt;
    +	protected StreamContextEnvironment(ContextEnvironment ctx) {&lt;br/&gt;
    +		this.ctx = ctx;&lt;br/&gt;
    +		this.userCodeClassLoader = JobWithJars.buildUserCodeClassLoader(ctx.getJars(), ctx.getClasspaths(), getClass().getClassLoader());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I&apos;m not very familiar with classloaders. Is it necessary that the classloader for Streaming jobs be built here and not via the usual `Program#getUserCodeClassLoader` in `Client` class?&lt;/p&gt;</comment>
                            <comment id="14984949" author="githubbot" created="Mon, 2 Nov 2015 09:30:32 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43609625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43609625&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -36,28 +31,16 @@&lt;/p&gt;

&lt;p&gt;     	private static final Logger LOG = LoggerFactory.getLogger(StreamContextEnvironment.class);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final List&amp;lt;URL&amp;gt; jars;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;private final List&amp;lt;URL&amp;gt; classpaths;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;private final Client client;&lt;br/&gt;
    +	private final ContextEnvironment ctx;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private final ClassLoader userCodeClassLoader;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;private final boolean wait;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected StreamContextEnvironment(Client client, List&amp;lt;URL&amp;gt; jars, List&amp;lt;URL&amp;gt; classpaths, int parallelism,&lt;/li&gt;
	&lt;li&gt;boolean wait) {&lt;/li&gt;
	&lt;li&gt;this.client = client;&lt;/li&gt;
	&lt;li&gt;this.jars = jars;&lt;/li&gt;
	&lt;li&gt;this.classpaths = classpaths;&lt;/li&gt;
	&lt;li&gt;this.wait = wait;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;this.userCodeClassLoader = JobWithJars.buildUserCodeClassLoader(jars, classpaths,&lt;/li&gt;
	&lt;li&gt;getClass().getClassLoader());&lt;br/&gt;
    +	protected StreamContextEnvironment(ContextEnvironment ctx) {&lt;br/&gt;
    +		this.ctx = ctx;&lt;br/&gt;
    +		this.userCodeClassLoader = JobWithJars.buildUserCodeClassLoader(ctx.getJars(), ctx.getClasspaths(), getClass().getClassLoader());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Classloaders rules are the same for streaming and batch. We should try to reuse code when possible. So probably a good idea to delgate this to the Client class.&lt;/p&gt;</comment>
                            <comment id="14984951" author="githubbot" created="Mon, 2 Nov 2015 09:32:02 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43609728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43609728&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -75,29 +62,31 @@ public JobExecutionResult execute() throws Exception {&lt;br/&gt;
     	@Override&lt;br/&gt;
     	public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JobGraph jobGraph;&lt;/li&gt;
	&lt;li&gt;if (jobName == null) 
{
    -			jobGraph = this.getStreamGraph().getJobGraph();
    -		}
&lt;p&gt; else &lt;/p&gt;
{
    -			jobGraph = this.getStreamGraph().getJobGraph(jobName);
    -		}
&lt;p&gt;    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;transformations.clear();&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;// attach all necessary jar files to the JobGraph&lt;/li&gt;
	&lt;li&gt;for (URL file : jars) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I pushed a fix for this issue: bf29de981c2bcd5cb5d33c68b158c95c8820f43d&lt;br/&gt;
    It think you have already adapted to this change. Nice &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="14984964" author="githubbot" created="Mon, 2 Nov 2015 09:39:30 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43610296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43610296&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -36,28 +31,16 @@&lt;/p&gt;

&lt;p&gt;     	private static final Logger LOG = LoggerFactory.getLogger(StreamContextEnvironment.class);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final List&amp;lt;URL&amp;gt; jars;&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;private final List&amp;lt;URL&amp;gt; classpaths;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;private final Client client;&lt;br/&gt;
    +	private final ContextEnvironment ctx;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	private final ClassLoader userCodeClassLoader;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;private final boolean wait;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;protected StreamContextEnvironment(Client client, List&amp;lt;URL&amp;gt; jars, List&amp;lt;URL&amp;gt; classpaths, int parallelism,&lt;/li&gt;
	&lt;li&gt;boolean wait) {&lt;/li&gt;
	&lt;li&gt;this.client = client;&lt;/li&gt;
	&lt;li&gt;this.jars = jars;&lt;/li&gt;
	&lt;li&gt;this.classpaths = classpaths;&lt;/li&gt;
	&lt;li&gt;this.wait = wait;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;this.userCodeClassLoader = JobWithJars.buildUserCodeClassLoader(jars, classpaths,&lt;/li&gt;
	&lt;li&gt;getClass().getClassLoader());&lt;br/&gt;
    +	protected StreamContextEnvironment(ContextEnvironment ctx) {&lt;br/&gt;
    +		this.ctx = ctx;&lt;br/&gt;
    +		this.userCodeClassLoader = JobWithJars.buildUserCodeClassLoader(ctx.getJars(), ctx.getClasspaths(), getClass().getClassLoader());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Okay. I will go through all usages of classloaders and try to delegate them to the `Client`.&lt;/p&gt;</comment>
                            <comment id="14984972" author="githubbot" created="Mon, 2 Nov 2015 09:42:15 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43610508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43610508&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -165,12 +181,65 @@ public ContextEnvironmentFactory(Client client, List&amp;lt;URL&amp;gt; jarFilesToAttach,&lt;/p&gt;

&lt;p&gt;     		@Override&lt;br/&gt;
     		public ExecutionEnvironment createExecutionEnvironment() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ContextEnvironment env = new ContextEnvironment(client, jarFilesToAttach, classpathsToAttach,&lt;/li&gt;
	&lt;li&gt;userCodeClassLoader, wait);&lt;/li&gt;
	&lt;li&gt;if (defaultParallelism &amp;gt; 0) {&lt;/li&gt;
	&lt;li&gt;env.setParallelism(defaultParallelism);&lt;br/&gt;
    +			if (wait || lastEnv == null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Could you at least add a comment here? This condition is not very intuitive. Why do you even set `lastEnv` here for blocking execution mode?&lt;/p&gt;</comment>
                            <comment id="14984987" author="githubbot" created="Mon, 2 Nov 2015 09:51:14 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-152973475&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-152973475&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for adapting the pull request to the latest master. It is in better shape now but I still think it can be improved. Please make sure there is an explicit way to submit a job in both detached and blocking execution mode. Some classes mix up the two modes (e.g. `StreamContextEnvironment`).&lt;/p&gt;</comment>
                            <comment id="14985044" author="githubbot" created="Mon, 2 Nov 2015 10:56:21 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-152987728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-152987728&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , there is a lot of code duplication between the detached and blocking submission modes. I&apos;m gonna try to clean that up while I address your concerns.&lt;br/&gt;
    Does it make sense to have a single run method which is called as `run(..., mode)` where mode is an enum?&lt;/p&gt;</comment>
                            <comment id="14985057" author="githubbot" created="Mon, 2 Nov 2015 11:07:31 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-152989560&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-152989560&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It&apos;s fine to have separate code for detached and blocking submission where necessary. I was more concerned with this pull request that it introduces new code branches which distort the existing submission logic. Wherever possible we should try to be explicit about the submission code path we&apos;re in instead of mixing them all together.&lt;/p&gt;

&lt;p&gt;    For instance, you&apos;re setting `lastEnv&#180; on blocking execution but then you never access it during blocking execution. This is not a clear code style.&lt;/p&gt;</comment>
                            <comment id="14985075" author="githubbot" created="Mon, 2 Nov 2015 11:14:25 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-152990620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-152990620&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The lastEnv is set for blocking also, because it still makes sense. It just stores what the last environment created by the factory was.&lt;br/&gt;
    I worked on this a while back while fixing a bug&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; in `TestEnvironment` which was meant to allow accessing last created environments. &lt;a href=&quot;https://github.com/apache/flink/commit/166b3705c9079efafe9217d98e7edaf54e6a84cf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/166b3705c9079efafe9217d98e7edaf54e6a84cf&lt;/a&gt;&lt;br/&gt;
    Whether it is accessed or not is an entirely different matter IMO.&lt;/p&gt;</comment>
                            <comment id="14985330" author="githubbot" created="Mon, 2 Nov 2015 14:53:41 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43635433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43635433&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -165,12 +181,65 @@ public ContextEnvironmentFactory(Client client, List&amp;lt;URL&amp;gt; jarFilesToAttach,&lt;/p&gt;

&lt;p&gt;     		@Override&lt;br/&gt;
     		public ExecutionEnvironment createExecutionEnvironment() {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ContextEnvironment env = new ContextEnvironment(client, jarFilesToAttach, classpathsToAttach,&lt;/li&gt;
	&lt;li&gt;userCodeClassLoader, wait);&lt;/li&gt;
	&lt;li&gt;if (defaultParallelism &amp;gt; 0) {&lt;/li&gt;
	&lt;li&gt;env.setParallelism(defaultParallelism);&lt;br/&gt;
    +			if (wait || lastEnv == null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Could you reformulate the if-else? That way the code would be more explicit:&lt;/p&gt;

&lt;p&gt;    ```java&lt;br/&gt;
    // We only allow one detached environment in detached mode&lt;br/&gt;
    if (!wait &amp;amp;&amp;amp; lastEnv != null) &lt;/p&gt;
{
      throw new DetachedProgramException(..);
    }
&lt;p&gt;    // regular submission flow&lt;br/&gt;
    lastEnv = ...&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="14985585" author="githubbot" created="Mon, 2 Nov 2015 17:36:22 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-153094985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-153094985&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , I&apos;ve made some modifications and removed `ClassLoader` code from the `StreamContextEnvironment`. &lt;br/&gt;
    Further, made the code branch to set the `lastEnv` more explicit.&lt;/p&gt;</comment>
                            <comment id="14987321" author="githubbot" created="Tue, 3 Nov 2015 14:09:05 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43750488&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43750488&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -81,13 +60,13 @@ public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;p&gt;     		transformations.clear();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// execute the programs&lt;/li&gt;
	&lt;li&gt;if (wait) {&lt;/li&gt;
	&lt;li&gt;return client.runBlocking(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +		if (ctx.isWait()) 
{
    +			return ctx.getClient().runBlocking(streamGraph, ctx.getJars(), ctx.getClasspaths(),
    +					ctx.getUserCodeClassLoader());
     		}
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;JobSubmissionResult result = client.runDetached(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +			ctx.setCurrentPlan(streamGraph);&lt;br/&gt;
     			LOG.warn(&quot;Job was executed in detached mode, the results will be available on completion.&quot;);&lt;/li&gt;
	&lt;li&gt;return JobExecutionResult.fromJobSubmissionResult(result);&lt;br/&gt;
    +			return ContextEnvironment.DetachedJobExecutionResult.INSTANCE;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Could you add a comment here which explains why you delay the execution?&lt;/p&gt;</comment>
                            <comment id="14987356" author="githubbot" created="Tue, 3 Nov 2015 14:31:08 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r43753100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r43753100&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -81,13 +60,13 @@ public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;p&gt;     		transformations.clear();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// execute the programs&lt;/li&gt;
	&lt;li&gt;if (wait) {&lt;/li&gt;
	&lt;li&gt;return client.runBlocking(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +		if (ctx.isWait()) 
{
    +			return ctx.getClient().runBlocking(streamGraph, ctx.getJars(), ctx.getClasspaths(),
    +					ctx.getUserCodeClassLoader());
     		}
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;JobSubmissionResult result = client.runDetached(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +			ctx.setCurrentPlan(streamGraph);&lt;br/&gt;
     			LOG.warn(&quot;Job was executed in detached mode, the results will be available on completion.&quot;);&lt;/li&gt;
	&lt;li&gt;return JobExecutionResult.fromJobSubmissionResult(result);&lt;br/&gt;
    +			return ContextEnvironment.DetachedJobExecutionResult.INSTANCE;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Done.&lt;/p&gt;</comment>
                            <comment id="14987402" author="githubbot" created="Tue, 3 Nov 2015 14:53:49 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-153377995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-153377995&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good @sachingoel0101. Good to merge from my side.&lt;/p&gt;</comment>
                            <comment id="14987418" author="githubbot" created="Tue, 3 Nov 2015 15:01:22 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-153381184&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-153381184&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Cool. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
    Squashing commits.&lt;/p&gt;</comment>
                            <comment id="14989006" author="githubbot" created="Wed, 4 Nov 2015 06:40:14 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-153599182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-153599182&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Build passes. Let&apos;s include this in the next rc.&lt;/p&gt;</comment>
                            <comment id="14989364" author="githubbot" created="Wed, 4 Nov 2015 11:17:00 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-153689197&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-153689197&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;d like to merge this on the master but I don&apos;t think it should be included in 0.10 because it is too big of a change for a release candidate. Additionally, it&apos;s not a pressing issue.&lt;/p&gt;</comment>
                            <comment id="14989372" author="githubbot" created="Wed, 4 Nov 2015 11:21:44 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-153690460&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-153690460&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    That&apos;s a good point. It might inadvertently break things.&lt;br/&gt;
    For the release candidate, how about including just the first part, i.e., just the detached mode for standalone clusters. That would not break any functionality, and bring the yarn and standalone mode at par as far as detached mode is concerned. It will definitely stay broken for both in case of eager jobs.&lt;/p&gt;</comment>
                            <comment id="14992051" author="githubbot" created="Thu, 5 Nov 2015 17:25:46 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44040745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44040745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -81,13 +60,15 @@ public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;p&gt;     		transformations.clear();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// execute the programs&lt;/li&gt;
	&lt;li&gt;if (wait) {&lt;/li&gt;
	&lt;li&gt;return client.runBlocking(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +		if (ctx.isWait()) 
{
    +			return ctx.getClient().runBlocking(streamGraph, ctx.getJars(), ctx.getClasspaths(),
    +					ctx.getUserCodeClassLoader());
     		}
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;JobSubmissionResult result = client.runDetached(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +			ctx.setCurrentPlan(streamGraph);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Here, the last call to execute() would override all the previous ones. I think you should throw an Exception here like in ContextEnvironment. Or you throw the Exception on setCurrentPlan. We want to allow only one job to be submitted detached, right?&lt;/p&gt;</comment>
                            <comment id="14992114" author="githubbot" created="Thu, 5 Nov 2015 17:57:37 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44044799&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44044799&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -81,13 +60,15 @@ public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;p&gt;     		transformations.clear();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// execute the programs&lt;/li&gt;
	&lt;li&gt;if (wait) {&lt;/li&gt;
	&lt;li&gt;return client.runBlocking(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +		if (ctx.isWait()) 
{
    +			return ctx.getClient().runBlocking(streamGraph, ctx.getJars(), ctx.getClasspaths(),
    +					ctx.getUserCodeClassLoader());
     		}
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;JobSubmissionResult result = client.runDetached(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +			ctx.setCurrentPlan(streamGraph);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Ah. Yes. I was earlier throwing the exception in `setCurrentPlan`. Forgot to change this.&lt;/p&gt;</comment>
                            <comment id="14992231" author="githubbot" created="Thu, 5 Nov 2015 18:48:27 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44051406&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44051406&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -81,13 +60,15 @@ public JobExecutionResult execute(String jobName) throws Exception {&lt;/p&gt;

&lt;p&gt;     		transformations.clear();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// execute the programs&lt;/li&gt;
	&lt;li&gt;if (wait) {&lt;/li&gt;
	&lt;li&gt;return client.runBlocking(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +		if (ctx.isWait()) 
{
    +			return ctx.getClient().runBlocking(streamGraph, ctx.getJars(), ctx.getClasspaths(),
    +					ctx.getUserCodeClassLoader());
     		}
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;JobSubmissionResult result = client.runDetached(streamGraph, jars, classpaths, userCodeClassLoader);&lt;br/&gt;
    +			ctx.setCurrentPlan(streamGraph);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    @mxm , fixed.&lt;/p&gt;</comment>
                            <comment id="14993322" author="githubbot" created="Fri, 6 Nov 2015 08:02:37 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-154339878&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-154339878&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Failure on an unrelated test: JobManagerSubmittedJobGraphsRecoveryITCase&lt;/p&gt;</comment>
                            <comment id="14993414" author="githubbot" created="Fri, 6 Nov 2015 09:22:16 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44117601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44117601&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -114,15 +115,33 @@ public Client getClient() {&lt;br/&gt;
     	public List&amp;lt;URL&amp;gt; getClasspaths()&lt;/p&gt;
{
     		return classpathsToAttach;
     	}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
    +	public ClassLoader getUserCodeClassLoader() &lt;/p&gt;
{
    +		return userCodeClassLoader;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void setCurrentPlan(FlinkPlan plan) {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Isn&apos;t `setDetachedPlan` a better name? It&apos;s only used for the detached mode and it&apos;s either set or null.&lt;/p&gt;</comment>
                            <comment id="14993415" author="githubbot" created="Fri, 6 Nov 2015 09:22:24 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44117608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44117608&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -114,15 +115,33 @@ public Client getClient() {&lt;br/&gt;
     	public List&amp;lt;URL&amp;gt; getClasspaths()&lt;/p&gt;
{
     		return classpathsToAttach;
     	}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
    +	public ClassLoader getUserCodeClassLoader() &lt;/p&gt;
{
    +		return userCodeClassLoader;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void setCurrentPlan(FlinkPlan plan) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		if (currentPlan == null) {
    +			currentPlan = plan;
    +		} else {
    +			throw new DetachedProgramException(
    +					DetachedJobExecutionResult.DETACHED_MESSAGE + DetachedJobExecutionResult.EXECUTE_TWICE_MESSAGE
    +			);
    +		}    +	}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;    +&lt;br/&gt;
    +	public FlinkPlan getCurrentPlan() {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Same as above here.&lt;/p&gt;</comment>
                            <comment id="14993517" author="githubbot" created="Fri, 6 Nov 2015 11:17:25 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44126978&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44126978&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ContextEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -114,15 +115,33 @@ public Client getClient() {&lt;br/&gt;
     	public List&amp;lt;URL&amp;gt; getClasspaths()&lt;/p&gt;
{
     		return classpathsToAttach;
     	}
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
    +	public ClassLoader getUserCodeClassLoader() &lt;/p&gt;
{
    +		return userCodeClassLoader;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void setCurrentPlan(FlinkPlan plan) {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Fair enough. Changed.&lt;/p&gt;</comment>
                            <comment id="14993764" author="githubbot" created="Fri, 6 Nov 2015 14:50:22 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-154428753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-154428753&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    There are still two issues I noticed. Printing to standard out should be disabled during the dry-run phase. Just like in the OptimizerPlanEnvironment. The other one is ContextEnvironment. Do you think you could refactor your changes in ContextEnvironment into a separate DetachedEnvironment? We don&apos;t really need the context for the dry run. Thus, we have a better separation of concerns with an extra class for the detached execution.&lt;/p&gt;</comment>
                            <comment id="14996407" author="githubbot" created="Mon, 9 Nov 2015 11:52:44 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155043211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155043211&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @mxm , I&apos;m not sure about directing sysout and syserr to null. Detached mode just means flink jobs are being run in detached mode; the rest of the program should go whatever way the user requested.&lt;/p&gt;

&lt;p&gt;    As for refactoring into a separate environment, I agree. I&apos;ve already done that.&lt;/p&gt;</comment>
                            <comment id="14996419" author="githubbot" created="Mon, 9 Nov 2015 12:11:32 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155047586&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155047586&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the timely update @sachingoel0101. &lt;/p&gt;

&lt;p&gt;    I was referring to the acquisition of the plan. When we create the plan, (e.g. ./bin/flink info JAR) we suppress printing to standard out. I thought we should do similar when we create the detached plan which we submit only after we have determined whether we can run the jar in detached mode. I ran some of the examples in detached mode and found it odd that it prints to stdout during the creation of the plan. The actual execution of the plan should of course be able to print to stdout. What do you think?&lt;/p&gt;</comment>
                            <comment id="14996451" author="githubbot" created="Mon, 9 Nov 2015 12:36:00 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155052238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155052238&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    When the main method is invoked via `PackagedProgram#invokeInteractiveModeForExecution`, it executes everything, and the flink plan it builds is stored in the `DetachedEnvironment`&lt;span class=&quot;error&quot;&gt;&amp;#91;now&amp;#93;&lt;/span&gt;. &lt;br/&gt;
    I just ran an example with the new code, and it prints something like this on the cli:&lt;br/&gt;
    !&lt;span class=&quot;error&quot;&gt;&amp;#91;capture&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://cloud.githubusercontent.com/assets/8874261/11033786/2cfad902-870c-11e5-8605-8bca4782443f.PNG&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cloud.githubusercontent.com/assets/8874261/11033786/2cfad902-870c-11e5-8605-8bca4782443f.PNG&lt;/a&gt;)&lt;br/&gt;
    Is this what you mean? If not, can you check again?&lt;/p&gt;</comment>
                            <comment id="14996512" author="githubbot" created="Mon, 9 Nov 2015 13:19:16 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155059238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155059238&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, the idea is suppress output during the dry-run and plan creation.&lt;/p&gt;</comment>
                            <comment id="14996990" author="githubbot" created="Mon, 9 Nov 2015 17:48:32 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155137822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155137822&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m not sure why we should do this in Detached mode. When `info` is run, user has only directly explicitly requested the plan. This is a full fledged execution of the use code, and should show any user generated out and err messages in my opinion.&lt;/p&gt;</comment>
                            <comment id="14996995" author="githubbot" created="Mon, 9 Nov 2015 17:50:22 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155138232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155138232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Of course, anything Flink will print, say, log messages, will already be disabled as there is no actor to receive the messages.&lt;/p&gt;</comment>
                            <comment id="14998327" author="githubbot" created="Tue, 10 Nov 2015 09:53:39 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155373495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155373495&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;This is a full fledged execution of the use code, and should show any user generated out and err messages in my opinion.&lt;/p&gt;

&lt;p&gt;    You&apos;re probably right. It may just seem odd to the user that code gets executed even though the job won&apos;t be submitted. We might fix that in the future if users don&apos;t like it.&lt;/p&gt;

&lt;p&gt;    &amp;gt;Of course, anything Flink will print, say, log messages, will already be disabled as there is no actor to receive the messages.&lt;/p&gt;

&lt;p&gt;    There are still jobmanager/taskmanager log files.&lt;/p&gt;</comment>
                            <comment id="14998376" author="githubbot" created="Tue, 10 Nov 2015 10:26:19 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155381011&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155381011&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks like your recent changes broke the YARN tests?&lt;/p&gt;</comment>
                            <comment id="14998392" author="githubbot" created="Tue, 10 Nov 2015 10:41:11 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155385085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155385085&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt;&amp;gt; You&apos;re probably right. It may just seem odd to the user that code gets executed even though the job won&apos;t be submitted. We might fix that in the future if users don&apos;t like it.&lt;/p&gt;

&lt;p&gt;    I think most people will be aware that Flink executes lazily, and just because the program goes right till the end printing whatever it does, it doesn&apos;t guarantee a true submission. But there is no point debating on this. We can adapt to whatever people prefer. This&apos;ll likely go through a major change before 1.0 to support truly detached mode anyways.&lt;/p&gt;

&lt;p&gt;    &amp;gt;&amp;gt;&amp;gt;Looks like your recent changes broke the YARN tests?&lt;br/&gt;
    Yes. It&apos;s also kind of hard to debug them. I can&apos;t seem to run them on my VM, and travis build takes a full one and a half hour to produce anything useful, and even then, I can&apos;t access the complete logs. It probably requires AWS keys or something. I&apos;m not sure.&lt;br/&gt;
    Do you know of any change I can make to travis conf so all modules are built but only Yarn tests get executed? &lt;/p&gt;

&lt;p&gt;    I have one more concern:&lt;br/&gt;
    There are four types of Yarn runs we can perform:&lt;br/&gt;
    1. Yarn session in detached mode: Equivalent to `bin/start-cluster.sh`&lt;br/&gt;
    2. Yarn session: Doesn&apos;t have a counterpart in standalone mode&lt;br/&gt;
    3. Per job yarn in detached mode: No counterpart in standalone mode, even after we add this PR.&lt;br/&gt;
    4. Per job yarn: No counterpart in standalone mode.&lt;/p&gt;

&lt;p&gt;    Now, when `bin/flink -d` is run, user will expect there to be a single semantics; that a cluster will be brought up, job will be submitted and the cluster will be terminated. However, there doesn&apos;t seem to be any way of achieving this in standalone mode. Will this create any confusion? &lt;/p&gt;</comment>
                            <comment id="14998413" author="githubbot" created="Tue, 10 Nov 2015 11:13:03 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155391848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155391848&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;Do you know of any change I can make to travis conf so all modules are built but only Yarn tests get executed? &lt;/p&gt;

&lt;p&gt;    Yes change the build instructions in .travis.yml to run `mvn clean install -DskipTests` followed by a `cd flink-yarn-tests &amp;amp;&amp;amp; mvn verify`. Locally, you can find the logs in the target directory of flink-yarn-tests. There is also a way to upload these log files with an AWS account.&lt;/p&gt;

&lt;p&gt;    I think the different semantics for YARN and standalone are fine. The `-d` flag always starts the job detached. That&apos;s independent of YARN or standalone mode.&lt;/p&gt;</comment>
                            <comment id="15000161" author="githubbot" created="Wed, 11 Nov 2015 09:41:07 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155717073&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155717073&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , fortunately, this time I was able to run the tests on my machine. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
    I&apos;m seeing a strange error. This is the error in Task manager log file for per job detached streaming test:&lt;br/&gt;
    ```java&lt;br/&gt;
    java.io.IOException: File or directory already exists. Existing files and directories are not overwritten in NO_OVERWRITE mode. Use OVERWRITE mode to overwrite existing files and directories.&lt;br/&gt;
    	at org.apache.flink.core.fs.FileSystem.initOutPathLocalFS(FileSystem.java:549)&lt;br/&gt;
    	at org.apache.flink.api.common.io.FileOutputFormat.open(FileOutputFormat.java:226)&lt;br/&gt;
    	at org.apache.flink.api.java.io.TextOutputFormat.open(TextOutputFormat.java:77)&lt;br/&gt;
    	at org.apache.flink.streaming.api.functions.sink.FileSinkFunction.open(FileSinkFunction.java:62)&lt;br/&gt;
    	at org.apache.flink.api.common.functions.util.FunctionUtils.openFunction(FunctionUtils.java:36)&lt;br/&gt;
    	at org.apache.flink.streaming.api.operators.AbstractUdfStreamOperator.open(AbstractUdfStreamOperator.java:89)&lt;br/&gt;
    	at org.apache.flink.streaming.runtime.tasks.StreamTask.openAllOperators(StreamTask.java:286)&lt;br/&gt;
    	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:213)&lt;br/&gt;
    	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:584)&lt;br/&gt;
    	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    This is surprising because I have made no changes to the way file writes or overwrites are handled. &lt;br/&gt;
    Here&apos;s the thing though: it should fail, because the folder is created at line 475 in `YarnSessionFIFOITCase` and the program will need to overwrite it.&lt;br/&gt;
    ```java&lt;br/&gt;
    File tmpOutFolder = null;&lt;br/&gt;
    try&lt;/p&gt;
{
    	tmpOutFolder = tmp.newFolder();
    }
&lt;p&gt;    catch(IOException e) &lt;/p&gt;
{
    	throw new RuntimeException(e);
    }
&lt;p&gt;    ```&lt;br/&gt;
    But the tests always pass on the master branch. &lt;br/&gt;
    The rest of the tests which follow this automatically fail because they again check all the logs files for exception strings.&lt;/p&gt;</comment>
                            <comment id="15000310" author="githubbot" created="Wed, 11 Nov 2015 12:31:14 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155764884&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155764884&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Okay. Figured it out. The Parallelism in the `ContextEnvironment` wasn&apos;t being respected in `StreamContextEnvironment`. Passes on my local machine now; waiting for travis to give the green light now.&lt;/p&gt;</comment>
                            <comment id="15000652" author="githubbot" created="Wed, 11 Nov 2015 16:49:13 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155842188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155842188&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    There is a merge conflict. Looks good otherwise.&lt;/p&gt;</comment>
                            <comment id="15000790" author="githubbot" created="Wed, 11 Nov 2015 17:55:58 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-155861149&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-155861149&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , rebased. &lt;/p&gt;</comment>
                            <comment id="15001938" author="githubbot" created="Thu, 12 Nov 2015 10:30:32 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44641729&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44641729&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/DetachedEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,116 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.client.program;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.InvalidProgramException;&lt;br/&gt;
    +import org.apache.flink.api.common.JobExecutionResult;&lt;br/&gt;
    +import org.apache.flink.api.common.JobID;&lt;br/&gt;
    +import org.apache.flink.api.common.JobSubmissionResult;&lt;br/&gt;
    +import org.apache.flink.api.common.Plan;&lt;br/&gt;
    +import org.apache.flink.optimizer.plan.FlinkPlan;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.net.URL;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Execution Environment for remote execution with the Client in detached mode.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class DetachedEnvironment extends ContextEnvironment {&lt;br/&gt;
    +&lt;br/&gt;
    +	/** Keeps track of the program plan for the Client to access. */&lt;br/&gt;
    +	private FlinkPlan detachedPlan;&lt;br/&gt;
    +&lt;br/&gt;
    +	private static final Logger LOG = LoggerFactory.getLogger(DetachedEnvironment.class);&lt;br/&gt;
    +&lt;br/&gt;
    +	public DetachedEnvironment(Client remoteConnection, List&amp;lt;URL&amp;gt; jarFiles, List&amp;lt;URL&amp;gt; classpaths, ClassLoader userCodeClassLoader) &lt;/p&gt;
{
    +		super(remoteConnection, jarFiles, classpaths, userCodeClassLoader);
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public JobExecutionResult execute(String jobName) throws Exception &lt;/p&gt;
{
    +		Plan p = createProgramPlan(jobName);
    +		setDetachedPlan(Client.getOptimizedPlan(client.compiler, p, getParallelism()));
    +		LOG.warn(&quot;Job was executed in detached mode, the results will be available on completion.&quot;);
    +		this.lastJobExecutionResult = DetachedJobExecutionResult.INSTANCE;
    +		return this.lastJobExecutionResult;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void setDetachedPlan(FlinkPlan plan) {&lt;br/&gt;
    +		if (detachedPlan == null) &lt;/p&gt;
{
    +			detachedPlan = plan;
    +		}
&lt;p&gt; else &lt;/p&gt;
{
    +			throw new InvalidProgramException(DetachedJobExecutionResult.DETACHED_MESSAGE +
    +					DetachedJobExecutionResult.EXECUTE_TWICE_MESSAGE);
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Finishes this Context Environment&apos;s execution by explicitly running the plan constructed.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public JobSubmissionResult finalizeExecute() throws ProgramInvocationException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Wouldn&apos;t it make more sense to overwrite `execute()` here?&lt;/p&gt;</comment>
                            <comment id="15001955" author="githubbot" created="Thu, 12 Nov 2015 10:52:25 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44643881&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44643881&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/DetachedEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,116 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.client.program;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.InvalidProgramException;&lt;br/&gt;
    +import org.apache.flink.api.common.JobExecutionResult;&lt;br/&gt;
    +import org.apache.flink.api.common.JobID;&lt;br/&gt;
    +import org.apache.flink.api.common.JobSubmissionResult;&lt;br/&gt;
    +import org.apache.flink.api.common.Plan;&lt;br/&gt;
    +import org.apache.flink.optimizer.plan.FlinkPlan;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.net.URL;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Execution Environment for remote execution with the Client in detached mode.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class DetachedEnvironment extends ContextEnvironment {&lt;br/&gt;
    +&lt;br/&gt;
    +	/** Keeps track of the program plan for the Client to access. */&lt;br/&gt;
    +	private FlinkPlan detachedPlan;&lt;br/&gt;
    +&lt;br/&gt;
    +	private static final Logger LOG = LoggerFactory.getLogger(DetachedEnvironment.class);&lt;br/&gt;
    +&lt;br/&gt;
    +	public DetachedEnvironment(Client remoteConnection, List&amp;lt;URL&amp;gt; jarFiles, List&amp;lt;URL&amp;gt; classpaths, ClassLoader userCodeClassLoader) &lt;/p&gt;
{
    +		super(remoteConnection, jarFiles, classpaths, userCodeClassLoader);
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public JobExecutionResult execute(String jobName) throws Exception &lt;/p&gt;
{
    +		Plan p = createProgramPlan(jobName);
    +		setDetachedPlan(Client.getOptimizedPlan(client.compiler, p, getParallelism()));
    +		LOG.warn(&quot;Job was executed in detached mode, the results will be available on completion.&quot;);
    +		this.lastJobExecutionResult = DetachedJobExecutionResult.INSTANCE;
    +		return this.lastJobExecutionResult;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void setDetachedPlan(FlinkPlan plan) {&lt;br/&gt;
    +		if (detachedPlan == null) &lt;/p&gt;
{
    +			detachedPlan = plan;
    +		}
&lt;p&gt; else &lt;/p&gt;
{
    +			throw new InvalidProgramException(DetachedJobExecutionResult.DETACHED_MESSAGE +
    +					DetachedJobExecutionResult.EXECUTE_TWICE_MESSAGE);
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Finishes this Context Environment&apos;s execution by explicitly running the plan constructed.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public JobSubmissionResult finalizeExecute() throws ProgramInvocationException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I&apos;m not sure I understand. `execute()` should default to `execute(null)`, no? &lt;br/&gt;
    We don&apos;t really want to allow the user to trigger execution explicitly, which also makes me realize this should be a package private method.&lt;/p&gt;</comment>
                            <comment id="15001969" author="githubbot" created="Thu, 12 Nov 2015 11:07:10 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44645161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44645161&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/DetachedEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,116 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.client.program;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.InvalidProgramException;&lt;br/&gt;
    +import org.apache.flink.api.common.JobExecutionResult;&lt;br/&gt;
    +import org.apache.flink.api.common.JobID;&lt;br/&gt;
    +import org.apache.flink.api.common.JobSubmissionResult;&lt;br/&gt;
    +import org.apache.flink.api.common.Plan;&lt;br/&gt;
    +import org.apache.flink.optimizer.plan.FlinkPlan;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.net.URL;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Execution Environment for remote execution with the Client in detached mode.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class DetachedEnvironment extends ContextEnvironment {&lt;br/&gt;
    +&lt;br/&gt;
    +	/** Keeps track of the program plan for the Client to access. */&lt;br/&gt;
    +	private FlinkPlan detachedPlan;&lt;br/&gt;
    +&lt;br/&gt;
    +	private static final Logger LOG = LoggerFactory.getLogger(DetachedEnvironment.class);&lt;br/&gt;
    +&lt;br/&gt;
    +	public DetachedEnvironment(Client remoteConnection, List&amp;lt;URL&amp;gt; jarFiles, List&amp;lt;URL&amp;gt; classpaths, ClassLoader userCodeClassLoader) &lt;/p&gt;
{
    +		super(remoteConnection, jarFiles, classpaths, userCodeClassLoader);
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public JobExecutionResult execute(String jobName) throws Exception &lt;/p&gt;
{
    +		Plan p = createProgramPlan(jobName);
    +		setDetachedPlan(Client.getOptimizedPlan(client.compiler, p, getParallelism()));
    +		LOG.warn(&quot;Job was executed in detached mode, the results will be available on completion.&quot;);
    +		this.lastJobExecutionResult = DetachedJobExecutionResult.INSTANCE;
    +		return this.lastJobExecutionResult;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void setDetachedPlan(FlinkPlan plan) {&lt;br/&gt;
    +		if (detachedPlan == null) &lt;/p&gt;
{
    +			detachedPlan = plan;
    +		}
&lt;p&gt; else &lt;/p&gt;
{
    +			throw new InvalidProgramException(DetachedJobExecutionResult.DETACHED_MESSAGE +
    +					DetachedJobExecutionResult.EXECUTE_TWICE_MESSAGE);
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Finishes this Context Environment&apos;s execution by explicitly running the plan constructed.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public JobSubmissionResult finalizeExecute() throws ProgramInvocationException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Ah you&apos;re overwriting`execute()` already. Sorry. Yes, please make the finalize method package private.&lt;/p&gt;</comment>
                            <comment id="15001973" author="githubbot" created="Thu, 12 Nov 2015 11:10:18 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#discussion_r44645434&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#discussion_r44645434&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/DetachedEnvironment.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,116 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.client.program;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.InvalidProgramException;&lt;br/&gt;
    +import org.apache.flink.api.common.JobExecutionResult;&lt;br/&gt;
    +import org.apache.flink.api.common.JobID;&lt;br/&gt;
    +import org.apache.flink.api.common.JobSubmissionResult;&lt;br/&gt;
    +import org.apache.flink.api.common.Plan;&lt;br/&gt;
    +import org.apache.flink.optimizer.plan.FlinkPlan;&lt;br/&gt;
    +import org.slf4j.Logger;&lt;br/&gt;
    +import org.slf4j.LoggerFactory;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.net.URL;&lt;br/&gt;
    +import java.util.List;&lt;br/&gt;
    +import java.util.Map;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Execution Environment for remote execution with the Client in detached mode.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class DetachedEnvironment extends ContextEnvironment {&lt;br/&gt;
    +&lt;br/&gt;
    +	/** Keeps track of the program plan for the Client to access. */&lt;br/&gt;
    +	private FlinkPlan detachedPlan;&lt;br/&gt;
    +&lt;br/&gt;
    +	private static final Logger LOG = LoggerFactory.getLogger(DetachedEnvironment.class);&lt;br/&gt;
    +&lt;br/&gt;
    +	public DetachedEnvironment(Client remoteConnection, List&amp;lt;URL&amp;gt; jarFiles, List&amp;lt;URL&amp;gt; classpaths, ClassLoader userCodeClassLoader) &lt;/p&gt;
{
    +		super(remoteConnection, jarFiles, classpaths, userCodeClassLoader);
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public JobExecutionResult execute(String jobName) throws Exception &lt;/p&gt;
{
    +		Plan p = createProgramPlan(jobName);
    +		setDetachedPlan(Client.getOptimizedPlan(client.compiler, p, getParallelism()));
    +		LOG.warn(&quot;Job was executed in detached mode, the results will be available on completion.&quot;);
    +		this.lastJobExecutionResult = DetachedJobExecutionResult.INSTANCE;
    +		return this.lastJobExecutionResult;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void setDetachedPlan(FlinkPlan plan) {&lt;br/&gt;
    +		if (detachedPlan == null) &lt;/p&gt;
{
    +			detachedPlan = plan;
    +		}
&lt;p&gt; else &lt;/p&gt;
{
    +			throw new InvalidProgramException(DetachedJobExecutionResult.DETACHED_MESSAGE +
    +					DetachedJobExecutionResult.EXECUTE_TWICE_MESSAGE);
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Finishes this Context Environment&apos;s execution by explicitly running the plan constructed.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public JobSubmissionResult finalizeExecute() throws ProgramInvocationException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Already done. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15002017" author="githubbot" created="Thu, 12 Nov 2015 12:43:28 +0000"  >&lt;p&gt;Github user sachingoel0101 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214#issuecomment-156094351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214#issuecomment-156094351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @mxm , should be ready to merge now. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15004159" author="githubbot" created="Fri, 13 Nov 2015 15:52:47 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1214&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15004160" author="mxm" created="Fri, 13 Nov 2015 15:54:19 +0000"  >&lt;p&gt;Merged in b7cf642bca109dced7dc1a02e831405887d7a9a6&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12904546">FLINK-2850</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mi27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>