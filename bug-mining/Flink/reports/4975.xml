<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:51:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20606] sql cli with hive catalog cannot create function using user classes from jar which specified by  -j option   </title>
                <link>https://issues.apache.org/jira/browse/FLINK-20606</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;with flink version 1.12.0(versions before also affected)&lt;/p&gt;

&lt;p&gt;I started a sql cli&#160; with a hive catalog and specified a user jar file with -j option like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
bin/sql-client.sh embedded -j /Users/akis/Desktop/flink-func/myfunc.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;font color=&quot;#ff0000&quot;&gt;when i tried to create a custom function using class from&#160;myfunc.jar&#65292;cli reported ClassNotFoundException.&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Flink SQL&amp;gt; use catalog myhive;

Flink SQL&amp;gt; create function myfunc1 as &lt;span class=&quot;code-quote&quot;&gt;&apos;me.aki.flink.flinkudf.MyFunc&apos;&lt;/span&gt;;
[ERROR] Could not execute SQL statement. Reason:
java.lang.ClassNotFoundException: me.aki.flink.flinkudf.MyFunc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;me.aki.flink.flinkudf.MyFunc is the identifier of udf&#65292;which defined like this&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; me.aki.flink.flinkudf;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.table.functions.ScalarFunction;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyFunc &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ScalarFunction {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; eval(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; s) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;myfunc_&quot;&lt;/span&gt; + s;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;after walking through the related code, I believe this is a bug caused by wrong classloader&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;when using a hive catalog, flink will use&#160;&#160;&lt;font color=&quot;#ff0000&quot;&gt;CatalogFunctionImpl&lt;/font&gt;&#160; to wrap the function&#12290; The&lt;/p&gt;

&lt;p&gt;isGeneric() methed&#160; uses &lt;font color=&quot;#ff0000&quot;&gt;Class.forName(String clazzName)&lt;/font&gt;&#160;which will use a current classloader(classloader loads flink/lib) to determine the class&#12290;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;however with -j option, user jar is set to the ExecutionContext and loaded by another userClassLoader&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;and the fix can be easy to pass a classloader to the&#160;Class.forName method.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; cl = &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getContextClassLoader();
&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; c = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(className, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, cl);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;after do such fix and build a new flink dist&#65292;create function behaves right&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Flink SQL&amp;gt; select myfunc1(&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;);

&lt;span class=&quot;code-comment&quot;&gt;// output
&lt;/span&gt;&#160; &#160; &#160;EXPR$0
&#160; &#160; &#160;myfunc_1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13345992">FLINK-20606</key>
            <summary>sql cli with hive catalog cannot create function using user classes from jar which specified by  -j option   </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="akisaya">akisaya</assignee>
                                    <reporter username="akisaya">akisaya</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 14 Dec 2020 23:24:50 +0000</created>
                <updated>Fri, 28 May 2021 06:59:01 +0000</updated>
                            <resolved>Wed, 30 Dec 2020 09:26:14 +0000</resolved>
                                    <version>1.10.2</version>
                    <version>1.11.2</version>
                    <version>1.12.0</version>
                                    <fixVersion>1.13.0</fixVersion>
                                    <component>Connectors / Hive</component>
                    <component>Table SQL / API</component>
                    <component>Table SQL / Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17249398" author="akisaya" created="Mon, 14 Dec 2020 23:28:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#65292;I would like make a&#160; pr to this issue, can you assign this to me?&lt;/p&gt;</comment>
                            <comment id="17249738" author="akisaya" created="Tue, 15 Dec 2020 15:10:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lithium147&quot; class=&quot;user-hover&quot; rel=&quot;lithium147&quot;&gt;lithium147&lt;/a&gt;&#65292;what do you think and could you assign it to me?&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;%C2%A0&quot;&gt;&lt;/a&gt;&#160;&lt;/h3&gt;</comment>
                            <comment id="17255478" author="akisaya" created="Mon, 28 Dec 2020 09:09:27 +0000"  >&lt;p&gt;seems pending for long, sorry to bother &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;&#65292;not sure who to @&lt;/p&gt;</comment>
                            <comment id="17256394" author="jark" created="Wed, 30 Dec 2020 09:26:14 +0000"  >&lt;p&gt;Fixed in master: f17562e78526eb27398ab9699e8e4fb60501cc99&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13377851">FLINK-22632</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0libs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>