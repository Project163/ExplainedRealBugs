<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:02:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20427] Remove CheckpointConfig.setPreferCheckpointForRecovery because it can lead to data loss</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20427</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;CheckpointConfig.setPreferCheckpointForRecovery&lt;/tt&gt; allows to configure whether Flink prefers checkpoints for recovery if the &lt;tt&gt;CompletedCheckpointStore&lt;/tt&gt; contains savepoints and checkpoints. This is problematic because due to this feature, Flink might prefer older checkpoints over newer savepoints for recovery. Since some components expect that the always the latest checkpoint/savepoint is used (e.g. the &lt;tt&gt;SourceCoordinator&lt;/tt&gt;), it breaks assumptions and can lead to &lt;tt&gt;SourceSplits&lt;/tt&gt; which are not read. This effectively means that the system loses data. Similarly, this behaviour can cause that exactly once sinks might output results multiple times which violates the processing guarantees. Hence, I believe that we should remove this setting because it changes Flink&apos;s behaviour in some very significant way potentially w/o the user noticing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13343351">FLINK-20427</key>
            <summary>Remove CheckpointConfig.setPreferCheckpointForRecovery because it can lead to data loss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Nicolaus Weidner">Nicolaus Weidner</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                            <label>auto-deprioritized-critical</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 30 Nov 2020 16:30:54 +0000</created>
                <updated>Fri, 3 Sep 2021 09:12:18 +0000</updated>
                            <resolved>Fri, 3 Sep 2021 09:12:18 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                                    <component>API / DataStream</component>
                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>14</watches>
                                                                                                                <comments>
                            <comment id="17240860" author="till.rohrmann" created="Mon, 30 Nov 2020 16:31:41 +0000"  >&lt;p&gt;The feature has been originally introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11159&quot; title=&quot;Allow configuration whether to fall back to savepoints for restore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11159&quot;&gt;&lt;del&gt;FLINK-11159&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17240862" author="till.rohrmann" created="Mon, 30 Nov 2020 16:32:04 +0000"  >&lt;p&gt;fyi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=NicoK&quot; class=&quot;user-hover&quot; rel=&quot;NicoK&quot;&gt;NicoK&lt;/a&gt; in case you want to discuss it.&lt;/p&gt;</comment>
                            <comment id="17240904" author="stephanewen" created="Mon, 30 Nov 2020 17:22:47 +0000"  >&lt;p&gt;+1 to remove it, until the semantics we better defined.&lt;/p&gt;

&lt;p&gt;I would also vote to deprecate/discourage it in 1.12 already.&lt;/p&gt;</comment>
                            <comment id="17240929" author="till.rohrmann" created="Mon, 30 Nov 2020 17:53:30 +0000"  >&lt;p&gt;I&apos;d also be in favour of deprecating this option in &lt;tt&gt;1.12.0&lt;/tt&gt; to discourage users from using this feature.&lt;/p&gt;</comment>
                            <comment id="17241465" author="nicok" created="Tue, 1 Dec 2020 11:43:57 +0000"  >&lt;p&gt;I&apos;m not sure we should touch this before the rework of the checkpoint/savepoint semantics - if this is still planned, I am talking about not having checkpoints vs. savepoints but rather snapshots with certain properties. In that case, we could have user-triggered snapshots with statebackend-native format and then I don&apos;t see any downside of using these for recovery just like using checkpoints-only now.&lt;br/&gt;
From what we learned, RocksDB-recovery from a savepoint can actually take a considerable amount of time and especially in at-least-once sink use cases with low latency requirements, this could be a problem!&lt;/p&gt;</comment>
                            <comment id="17241485" author="till.rohrmann" created="Tue, 1 Dec 2020 12:31:06 +0000"  >&lt;p&gt;Are users aware of the consequences when setting &lt;tt&gt;CheckpointConfig.setPreferCheckpointForRecovery(true)&lt;/tt&gt;? I would be sceptical because I couldn&apos;t find it documented anywhere. Exposing such an option is in my opinion a recipe for disaster and exposes yet another special case knob for tuning Flink which is already hard enough to operate properly. Especially, with the new sources where it can lead to not reading data it can be problematic.&lt;/p&gt;</comment>
                            <comment id="17241831" author="nicok" created="Tue, 1 Dec 2020 20:05:33 +0000"  >&lt;p&gt;If Flink 1.12 adds additional risks here due to the new sources, that would of course be something to consider, but I&apos;m a bit unclear what the problems are there.&lt;/p&gt;

&lt;p&gt;Are you saying that any restore operation for these sources that is not based on the latest snapshot will/may lead to data loss? So including restoring from an arbitrary savepoint (or actually also a retained checkpoint)? If that was the case, that&apos;s imho a bug in the new sources...&lt;/p&gt;</comment>
                            <comment id="17242413" author="till.rohrmann" created="Wed, 2 Dec 2020 14:58:12 +0000"  >&lt;p&gt;No, it is only a problem if a regional failover occurs where we don&apos;t resume from the latest checkpoint/savepoint. This can, however, easily happen in normal operation mode and, hence, I believe that we should not allow resuming from an earlier checkpoint/savepoint. Global failovers where all tasks are restarted or manual resuming from a savepoint are fine. &lt;/p&gt;</comment>
                            <comment id="17243032" author="nicok" created="Thu, 3 Dec 2020 09:09:13 +0000"  >&lt;p&gt;Ahh...Flink regional failover. Makes sense now: for these, the sources have the implicit assumption that they recover from the latest snapshot (while for a global failover, they restore from the snapshotted state). It would be good to add a safeguard these to ensure that the source is always recovering from the latest snapshot for regional failovers then (ideally it would then fall back to a global failover if this assumption is not true).&lt;br/&gt;
As for removing &lt;tt&gt;CheckpointConfig.setPreferCheckpointForRecovery&lt;/tt&gt;: Let&apos;s evaluate with the user ml whether anyone is relying on this and if not, let&apos;s remove it and get rid of one more special case. The only use case I can think of which may benefit from this feature here is a low-latency use case which tolerates duplicates in the sinks but has very strong SLAs even in the failure case: these could work around the slow savepoint-restore via retained checkpoints. Retained checkpoints, however, don&apos;t really serve as a backup which you can roll back to in case of bugs - user-triggered checkpoints could be a better solution here, as mentioned, but they don&apos;t exist yet.&lt;/p&gt;</comment>
                            <comment id="17243183" author="stephanewen" created="Thu, 3 Dec 2020 13:26:51 +0000"  >&lt;p&gt;We need to do something about this, because the current state is just broken. Like Till mentioned, any regional failover is inconsistent. Exactly-once sinks are by definition broken with this.&lt;/p&gt;

&lt;p&gt;I am in favor of deprecating this in 1.12. It would not break programs, but would make users aware that this is not a feature with well-defined semantics.&lt;/p&gt;

&lt;p&gt;Then let&apos;s clearly define how savepoints, side effects, and durability notifications (checkpoint complete) should interact in all these scenarios. Then we can think about adding this option back, or maybe the option will not be necessary any more.&lt;/p&gt;</comment>
                            <comment id="17254988" author="liwen liu" created="Sat, 26 Dec 2020 09:40:54 +0000"  >&lt;p&gt;Hi&#65292;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could you assign this ticket to me ?&lt;/p&gt;

&lt;p&gt;Thanks~&lt;/p&gt;</comment>
                            <comment id="17255495" author="till.rohrmann" created="Mon, 28 Dec 2020 09:46:46 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Liwen+Liu&quot; class=&quot;user-hover&quot; rel=&quot;Liwen Liu&quot;&gt;Liwen Liu&lt;/a&gt;, this ticket is not only about removing this config option but also to define the proper semantics of savepoints and side effects. Hence, we would first need a discussion about how they can be properly defined before removing this setting.&lt;/p&gt;</comment>
                            <comment id="17255499" author="liwen liu" created="Mon, 28 Dec 2020 09:54:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; I got you.Thanks.&lt;/p&gt;</comment>
                            <comment id="17286046" author="rex-remind" created="Wed, 17 Feb 2021 18:15:13 +0000"  >&lt;p&gt;We&apos;ve been relying on this because recovery from savepoints takes hours instead of minutes. Our sources are Kafka and sink is ES. We already expect ES to receive duplicate writes but don&apos;t care. However, we can&apos;t lose data from Kafka. Is one of the sources impacted by this bug Kafka?&lt;/p&gt;</comment>
                            <comment id="17286453" author="till.rohrmann" created="Thu, 18 Feb 2021 12:40:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rex-remind&quot; class=&quot;user-hover&quot; rel=&quot;rex-remind&quot;&gt;rex-remind&lt;/a&gt;, the sources are not affected by this problem. You have problems if you require your Flink job to have exactly once processing guarantees wrt to your sink or external systems you are interacting. If your setup tolerates duplicates in ES, then this is not a problem.&lt;/p&gt;</comment>
                            <comment id="17286823" author="rex-remind" created="Fri, 19 Feb 2021 02:39:12 +0000"  >&lt;p&gt;Cool, thanks!&lt;/p&gt;</comment>
                            <comment id="17316043" author="dawidwys" created="Wed, 7 Apr 2021 06:54:47 +0000"  >&lt;p&gt;Is this still targeted at 1.13?&lt;/p&gt;</comment>
                            <comment id="17329011" author="flink-jira-bot" created="Thu, 22 Apr 2021 12:24:52 +0000"  >&lt;p&gt;This critical issue is unassigned and itself and all of its Sub-Tasks have not been updated for 7 days. So, it has been labeled &quot;stale-critical&quot;. If this ticket is indeed critical, please either assign yourself or give an update. Afterwards, please remove the label. In 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17336944" author="flink-jira-bot" created="Thu, 29 Apr 2021 23:49:29 +0000"  >&lt;p&gt;This issue was labeled &quot;stale-critical&quot; 7 ago and has not received any updates so it is being deprioritized. If this ticket is actually Critical, please raise the priority and ask a committer to assign you the issue or revive the public discussion.&lt;/p&gt;</comment>
                            <comment id="17347967" author="flink-jira-bot" created="Wed, 19 May 2021 22:56:30 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Critical but is unassigned and neither itself nor its Sub-Tasks have been updated for 7 days. I have gone ahead and marked it &quot;stale-critical&quot;. If this ticket is critical, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17348138" author="till.rohrmann" created="Thu, 20 May 2021 08:02:33 +0000"  >&lt;p&gt;I think this is still a very important issue to sort out and fix because it can lead to unwanted data loss.&lt;/p&gt;</comment>
                            <comment id="17352864" author="flink-jira-bot" created="Thu, 27 May 2021 23:05:21 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Critical but is unassigned and neither itself nor its Sub-Tasks have been updated for 7 days. I have gone ahead and marked it &quot;stale-critical&quot;. If this ticket is critical, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17357714" author="flink-jira-bot" created="Fri, 4 Jun 2021 23:23:08 +0000"  >&lt;p&gt;This issue was labeled &quot;stale-critical&quot; 7 ago and has not received any updates so it is being deprioritized. If this ticket is actually Critical, please raise the priority and ask a committer to assign you the issue or revive the public discussion.&lt;/p&gt;</comment>
                            <comment id="17400822" author="xintongsong" created="Wed, 18 Aug 2021 06:26:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;,&lt;br/&gt;
This interface has been deprecated in 1.12.0. Shall we remove it completely in 1.14.0?&lt;/p&gt;</comment>
                            <comment id="17400912" author="till.rohrmann" created="Wed, 18 Aug 2021 08:51:45 +0000"  >&lt;p&gt;I would be in favour because using this feature breaks processing guarantees. However, I am not sure whether &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkruber&quot; class=&quot;user-hover&quot; rel=&quot;nkruber&quot;&gt;nkruber&lt;/a&gt; would agree. Stephan wrote a design for defining the checkpoint and savepoint semantics properly. This will most likely be implemented in the next Flink version.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkruber&quot; class=&quot;user-hover&quot; rel=&quot;nkruber&quot;&gt;nkruber&lt;/a&gt; do we know whether our users actually use this flag or can we remove it after being deprecated for two releases?&lt;/p&gt;</comment>
                            <comment id="17402158" author="nicok" created="Fri, 20 Aug 2021 11:03:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; it may be cleaner to remove this along with the new checkpoint/savepoint semantics, but I also don&apos;t have any user in mind who relies on this flag.&lt;/p&gt;</comment>
                            <comment id="17403641" author="stephanewen" created="Tue, 24 Aug 2021 08:27:35 +0000"  >&lt;p&gt;I&apos;ll start a poll on the mailing list to see if anyone uses this and whether there are big concerns about removing this.&lt;/p&gt;</comment>
                            <comment id="17403714" author="stephanewen" created="Tue, 24 Aug 2021 09:52:22 +0000"  >&lt;p&gt;About the above-mentioned design doc for the improved semantics: I&apos;ll try to share this publicly asap, once I have cleaned it up a bit (it currently contains a lot of raw notes still).&lt;/p&gt;</comment>
                            <comment id="17403724" author="stephanewen" created="Tue, 24 Aug 2021 09:59:59 +0000"  >&lt;p&gt;Here is the Mailing List Poll: &lt;a href=&quot;https://lists.apache.org/x/thread.html/rce4e625f80c1b4014f96b15fb1add9ff7dd13203b871e3f6d3b80f11@%3Cdev.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/x/thread.html/rce4e625f80c1b4014f96b15fb1add9ff7dd13203b871e3f6d3b80f11@%3Cdev.flink.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17409392" author="till.rohrmann" created="Fri, 3 Sep 2021 09:12:18 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;1.15.0:&lt;br/&gt;
eb8c21c12d60db2e579d88e465df0cdbeccba74b&lt;br/&gt;
6b0383719cacdbd2cff14fa9280c2971cd2fa216&lt;/p&gt;

&lt;p&gt;1.14.0:&lt;br/&gt;
fcb8ccf6856cd43d0faec91e6296255ed619bccd&lt;br/&gt;
af85ad47c8461751ca7f3e1aac9a14e88a95d44d&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13343519">FLINK-20441</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13204292">FLINK-11159</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13342066">FLINK-20290</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0l21s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Remove deprecated CheckpointConfig#setPreferCheckpointForRecovery&lt;br/&gt;
&lt;br/&gt;
Deprecated method CheckpointConfig#setPreferCheckpointForRecovery was removed, because preferring older checkpoints over newer savepoints for recovery can lead to data loss.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>