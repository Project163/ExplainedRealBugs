<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-21213] e2e test fail with &apos;As task is already not running, no longer decline checkpoint&apos;</title>
                <link>https://issues.apache.org/jira/browse/FLINK-21213</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=12686&amp;amp;view=logs&amp;amp;j=68a897ab-3047-5660-245a-cce8f83859f6&amp;amp;t=d47e27f5-9721-5d5f-1cf3-62adbf3d115d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=12686&amp;amp;view=logs&amp;amp;j=68a897ab-3047-5660-245a-cce8f83859f6&amp;amp;t=d47e27f5-9721-5d5f-1cf3-62adbf3d115d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
Checking for non-empty .out files... &lt;br/&gt;
No non-empty .out files. &lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13355687">FLINK-21213</key>
            <summary>e2e test fail with &apos;As task is already not running, no longer decline checkpoint&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yunta">Yun Tang</assignee>
                                    <reporter username="maguowei">Guowei Ma</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Sun, 31 Jan 2021 01:32:41 +0000</created>
                <updated>Tue, 22 Jun 2021 13:55:44 +0000</updated>
                            <resolved>Sat, 20 Feb 2021 06:11:11 +0000</resolved>
                                    <version>1.13.0</version>
                                    <fixVersion>1.11.4</fixVersion>
                    <fixVersion>1.12.2</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17276306" author="arvid" created="Mon, 1 Feb 2021 13:02:17 +0000"  >&lt;p&gt;The sanity check at the end of the e2e fails as the log contains&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2021-01-29 23:46:05,857 WARN  org.apache.flink.streaming.runtime.tasks.AsyncCheckpointRunnable [] - As task is already not running, no longer decline checkpoint 1.
java.lang.Exception: Could not materialize checkpoint 1 for operator Source: Sequence Source -&amp;gt; Flat Map -&amp;gt; Sink: Unnamed (1/1).
	at org.apache.flink.streaming.runtime.tasks.AsyncCheckpointRunnable.handleExecutionException(AsyncCheckpointRunnable.java:214) [flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT]
	at org.apache.flink.streaming.runtime.tasks.AsyncCheckpointRunnable.run(AsyncCheckpointRunnable.java:149) [flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_282]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_282]
	at java.lang.Thread.run(Thread.java:748) [?:1.8.0_282]
Caused by: java.util.concurrent.CancellationException
	at java.util.concurrent.FutureTask.report(FutureTask.java:121) ~[?:1.8.0_282]
	at java.util.concurrent.FutureTask.get(FutureTask.java:192) ~[?:1.8.0_282]
	at org.apache.flink.runtime.concurrent.FutureUtils.runIfNotDoneAndGet(FutureUtils.java:501) ~[flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT]
	at org.apache.flink.streaming.api.operators.OperatorSnapshotFinalizer.&amp;lt;init&amp;gt;(OperatorSnapshotFinalizer.java:57) ~[flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT]
	at org.apache.flink.streaming.runtime.tasks.AsyncCheckpointRunnable.run(AsyncCheckpointRunnable.java:112) ~[flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT]
	... 3 more &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17276365" author="arvid" created="Mon, 1 Feb 2021 14:28:25 +0000"  >&lt;p&gt;This issue is caused by a new warning added in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-20675&quot; title=&quot;Asynchronous checkpoint failure would not fail the job anymore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-20675&quot;&gt;&lt;del&gt;FLINK-20675&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
There are a two options:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;make sure that this warning never pops up, for example by reducing level to DEBUG. We could also completely remove it.&lt;/li&gt;
	&lt;li&gt;add it to the whitelists of allowed exceptions in e2e.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;As I&apos;m currently not seeing a benefit for the end-user, I&apos;d go with the first option. &lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Note: I had a bit of trouble of understanding the error message at first. Maybe we can rephrase it to &lt;tt&gt;Ignore decline of checkpoint 1 as task is not running anymore.&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17277074" author="yunta" created="Tue, 2 Feb 2021 12:10:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt; thanks for reminder, I think changing this warning to INFO level should also be okay as Flink-1.8 would &lt;a href=&quot;https://github.com/apache/flink/blob/0e8e8062bcc159e9ed2a0d4a0a61db4efcb01f2f/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java#L1156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;not fail when async checkpoint failure if task not running&lt;/a&gt; with code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void handleAsyncException(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message, Throwable exception) {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isRunning) {
			&lt;span class=&quot;code-comment&quot;&gt;// only fail &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the task is still running
&lt;/span&gt;			getEnvironment().failExternally(exception);
		}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17277092" author="arvid" created="Tue, 2 Feb 2021 12:44:05 +0000"  >&lt;p&gt;On INFO, it probably still triggers e2e failure, cf. &lt;tt&gt;check_logs_for_exceptions&lt;/tt&gt; in common.sh.&lt;/p&gt;</comment>
                            <comment id="17287549" author="yunta" created="Sat, 20 Feb 2021 06:09:38 +0000"  >&lt;p&gt;Only degrade to INFO level is not enough, and my PR also remove the exception message.&lt;/p&gt;</comment>
                            <comment id="17287551" author="yunta" created="Sat, 20 Feb 2021 06:11:03 +0000"  >&lt;p&gt;merged &lt;br/&gt;
master: 32ed58254303aaec6290a1adb0402279ac5ee7d1&lt;br/&gt;
release-1.12: 6ce29325332be84bd15601b45f37fa1b22b1bdff&lt;br/&gt;
release-1.11: 9bc2fba0bc404fff36c53a4560c76919705ec383&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13357943">FLINK-21349</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0n6b4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>