<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:07:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24506] checkpoint directory is not configurable through the Flink configuration passed into the StreamExecutionEnvironment</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24506</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-19463&quot; title=&quot;Disentangle StateBackends from Checkpointing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-19463&quot;&gt;&lt;del&gt;FLINK-19463&lt;/del&gt;&lt;/a&gt; introduced the separation of &lt;tt&gt;StateBackend&lt;/tt&gt; and &lt;tt&gt;CheckpointStorage&lt;/tt&gt;. Before that, both were included in the same interface implementation &lt;a href=&quot;https://github.com/apache/flink/blob/0a76daba0a428a322f0273d7dc6a70966f62bf26/flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/AbstractFileStateBackend.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;AbstractFileStateBackend&lt;/a&gt;. &lt;tt&gt;FsStateBackend&lt;/tt&gt; was used as a default implementation pre-1.13.&lt;/p&gt;

&lt;p&gt;pre-&lt;tt&gt;1.13&lt;/tt&gt; initialized the checkpoint directory when instantiating the state backend (see &lt;a href=&quot;https://github.com/apache/flink/blob/release-1.12/flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/FsStateBackendFactory.java#L46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FsStateBackendFactory&lt;/a&gt;). Starting from &lt;tt&gt;1.13&lt;/tt&gt; loading the &lt;tt&gt;CheckpointStorage&lt;/tt&gt; is done by the &lt;tt&gt;CheckpointStorageLoader.load&lt;/tt&gt; method that is called in various places:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Savepoint Disposal (through &lt;tt&gt;Checkpoints.loadCheckpointStorage&lt;/tt&gt;) where it only relies on the configuration passed in by the cluster configuration (no application checkpoint storage is passed)&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;SchedulerBase&lt;/tt&gt; initialization (through DefaultExecutionGraphBuilder) where it&#8217;s based on the cluster&#8217;s configuration but also the application configuration (i.e. the &lt;tt&gt;JobGraph&lt;/tt&gt;&#8217;s setting) that would be considered if &lt;tt&gt;CheckpointConfig#configure&lt;/tt&gt; would have the checkpoint storage included&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;StreamTask&lt;/tt&gt; on the &lt;tt&gt;TaskManager&lt;/tt&gt;&#8217;s side where it&#8217;s based on the configuration passed in by the &lt;tt&gt;JobVertex&lt;/tt&gt; for the application&#8217;s &lt;tt&gt;CheckpointStorage&lt;/tt&gt; and the &lt;tt&gt;TaskManager&lt;/tt&gt;&#8217;s configuration (coming from the session cluster) for the fallback &lt;tt&gt;CheckpointStorage&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The issue is that we don&apos;t set the checkpoint directory in the &lt;tt&gt;CheckpointConfig&lt;/tt&gt;. Hence, it&apos;s not going to get picked up as a job-related property. Flink always uses the fallback provided by the session cluster configuration.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13405915">FLINK-24506</key>
            <summary>checkpoint directory is not configurable through the Flink configuration passed into the StreamExecutionEnvironment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mapohl">Matthias Pohl</assignee>
                                    <reporter username="mapohl">Matthias Pohl</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 11 Oct 2021 11:03:54 +0000</created>
                <updated>Wed, 15 Dec 2021 01:44:14 +0000</updated>
                            <resolved>Fri, 3 Dec 2021 09:39:25 +0000</resolved>
                                    <version>1.14.0</version>
                    <version>1.13.2</version>
                                    <fixVersion>1.13.6</fixVersion>
                    <fixVersion>1.14.3</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Runtime / Configuration</component>
                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17451622" author="mapohl" created="Wed, 1 Dec 2021 08:54:13 +0000"  >&lt;p&gt;Both, &lt;tt&gt;StreamPlanEnvironment&lt;/tt&gt; and &lt;tt&gt;StreamContextEnvironment&lt;/tt&gt; are intialized using the Flink configuration (which includes the checkpoint directory). Both classes derive from &lt;tt&gt;StreamExecutionEnvironment&lt;/tt&gt;. The &lt;tt&gt;StreamExecutionEnvironment&lt;/tt&gt; initializes the &lt;tt&gt;CheckpointConfig&lt;/tt&gt; (see &lt;a href=&quot;https://github.com/apache/flink/blob/b4c385e41832f16e39d5cbe4fb69ead9bbe077b2/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java#L975&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StreamExecutionEnvironment:975&lt;/a&gt;). But it doesn&#8217;t set the checkpoint directory in &lt;a href=&quot;https://github.com/apache/flink/blob/cd01d4c02793d1b29618093f730b3bc521152b62/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/CheckpointConfig.java#L753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CheckpointConfig#configure&lt;/a&gt;. This was previously set when initializing the &lt;tt&gt;StateBackend&lt;/tt&gt; in &lt;a href=&quot;https://github.com/apache/flink/blob/b4c385e41832f16e39d5cbe4fb69ead9bbe077b2/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironment.java#L919&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StreamExecutionEnvironment#configure&lt;/a&gt; which calls &lt;a href=&quot;https://github.com/apache/flink/blob/641c31e92fd8ff3702d2ac3510a63b0653802a2e/flink-runtime/src/main/java/org/apache/flink/runtime/state/StateBackendLoader.java#L146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StateBackendLoader#loadStateBackendFromConfig&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;FsStateBackend&lt;/tt&gt; was initialized using the checkpoint directory. &lt;tt&gt;HashMapStateBackend&lt;/tt&gt; does not include this pointer anymore but relies on the &lt;tt&gt;CheckpointStorage&lt;/tt&gt; instead that is loaded through &lt;a href=&quot;https://github.com/apache/flink/blob/658fac3736b73adf54b629242ede91313947e7e1/flink-runtime/src/main/java/org/apache/flink/runtime/state/CheckpointStorageLoader.java#L158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CheckpointStorageLoader.load&lt;/a&gt; which is called when creating the ExecutionGraph in &lt;a href=&quot;https://github.com/apache/flink/blob/eba8f574c550123004ed4f557cef28ff557cd88e/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/DefaultExecutionGraphBuilder.java#L269&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DefaultExecutionGraphBuilder:269&lt;/a&gt;. The &lt;tt&gt;CheckpointStorage&lt;/tt&gt; is either loaded from the JobManager configuration (i.e. the Session cluster&#8217;s configuration) or from the application (i.e. the &lt;tt&gt;JobGraph&lt;/tt&gt;). But the &lt;tt&gt;JobGraph&lt;/tt&gt; does not have this setting set due to it not being written &lt;a href=&quot;https://github.com/apache/flink/blob/cd01d4c02793d1b29618093f730b3bc521152b62/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/CheckpointConfig.java#L753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CheckpointConfig#configure&lt;/a&gt; as written earlier already.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;CheckpointStorage&lt;/tt&gt; is loaded in three locations:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Savepoint Disposal (through &lt;a href=&quot;https://github.com/apache/flink/blob/4597d5557c640e0ef5a526cbb6d46686be5dd813/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/Checkpoints.java#L351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Checkpoints.loadCheckpointStorage&lt;/a&gt;) where it only relies on the configuration passed in by the cluster configuration (no application checkpoint storage is passed)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Scheduler initialization (through &lt;a href=&quot;https://github.com/apache/flink/blob/f7bedb0603c33cb4e25c62c9899edb709b264371/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/DefaultExecutionGraphBuilder.java#L268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DefaultExecutionGraphBuilder&lt;/a&gt;) where it&#8217;s based on the cluster&#8217;s configuration but also the application configuration (i.e. the JobGraph&#8217;s setting) that would be considered if &lt;a href=&quot;https://github.com/apache/flink/blob/cd01d4c02793d1b29618093f730b3bc521152b62/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/CheckpointConfig.java#L753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CheckpointConfig#configure&lt;/a&gt; would have the checkpoint storage included&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/apache/flink/blob/79a801a7bf669813d88784fd642d724d6dab69f4/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java#L1505&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;StreamTask&lt;/a&gt; on the TaskManager&#8217;s side where it&#8217;s based on the configuration passed in by the &lt;tt&gt;JobVertex&lt;/tt&gt; for the application&#8217;s &lt;tt&gt;CheckpointStorage&lt;/tt&gt; and the TaskManager&#8217;s configuration (coming from the session cluster) for the fallback &lt;tt&gt;CheckpointStorage&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For the latter two, we could solve the issue of not having the checkpoint directory being loaded from the job spec by considering the option in &lt;a href=&quot;https://github.com/apache/flink/blob/cd01d4c02793d1b29618093f730b3bc521152b62/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/environment/CheckpointConfig.java#L753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CheckpointConfig#configure&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The Savepoint Disposal is save even with this change because it relies on an external pointer for the savepoint and does not use the checkpoint directory at all.&lt;/p&gt;</comment>
                            <comment id="17452861" author="zentol" created="Fri, 3 Dec 2021 09:39:25 +0000"  >&lt;p&gt;master: 83cad724890e4904758b46f0e292a64fc1a5d1d4&lt;br/&gt;
1.14: 7e4cc6fc23732a151e5e4eab58988b4e99b290cf&lt;br/&gt;
1.13: 98c49d63efa7723ed5394e503f7f0c3f54061456&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13330017">FLINK-19463</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vqhc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-19463&quot; title=&quot;Disentangle StateBackends from Checkpointing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-19463&quot;&gt;&lt;strike&gt;FLINK-19463&lt;/strike&gt;&lt;/a&gt; introduced a change in Flink 1.13+ where the configuration passed in through the StreamExecutionEnvironment wouldn&amp;#39;t be considered for the state.checkpoints.dir parameter. This is fixed now bringing back the old behavior which was available in 1.12-.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>