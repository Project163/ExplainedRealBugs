<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:48:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-18893] Python tests fails with &quot;AppendStreamTableSink requires that Table has only insert changes.&quot;</title>
                <link>https://issues.apache.org/jira/browse/FLINK-18893</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=5392&amp;amp;view=logs&amp;amp;j=9cada3cb-c1d3-5621-16da-0f718fb86602&amp;amp;t=455fddbf-5921-5b71-25ac-92992ad80b28&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=5392&amp;amp;view=logs&amp;amp;j=9cada3cb-c1d3-5621-16da-0f718fb86602&amp;amp;t=455fddbf-5921-5b71-25ac-92992ad80b28&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-08-11T09:33:00.6405057Z 
2020-08-11T09:33:00.6407257Z =================================== FAILURES ===================================
2020-08-11T09:33:00.6407774Z _________ StreamPandasConversionTests.test_to_pandas_for_retract_table _________
2020-08-11T09:33:00.6408007Z 
2020-08-11T09:33:00.6409313Z a = (&lt;span class=&quot;code-quote&quot;&gt;&apos;xro10353&apos;&lt;/span&gt;, &amp;lt;py4j.java_gateway.GatewayClient object at 0x7f9572c53ac8&amp;gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;z:org.apache.flink.table.runtime.arrow.ArrowUtils&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;collectAsPandasDataFrame&apos;&lt;/span&gt;)
2020-08-11T09:33:00.6409732Z kw = {}
2020-08-11T09:33:00.6410610Z s = &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.flink.table.api.TableException: AppendStreamTableSink requires that Table has only insert changes.&apos;&lt;/span&gt;
2020-08-11T09:33:00.6413478Z stack_trace = &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.flink.table.plan.nodes.datastream.DataStreamSink.writeToAppendSink(DataStreamSink.scala:118)\n\t at org.ap....api.python.shaded.py4j.GatewayConnection.run(GatewayConnection.java:238)\n\t at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&apos;&lt;/span&gt;
2020-08-11T09:33:00.6414468Z exception = &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.flink.table.api.TableException&apos;&lt;/span&gt;
2020-08-11T09:33:00.6414663Z 
2020-08-11T09:33:00.6414858Z     def deco(*a, **kw):
2020-08-11T09:33:00.6415060Z         &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;:
2020-08-11T09:33:00.6415274Z &amp;gt;           &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; f(*a, **kw)
2020-08-11T09:33:00.6415419Z 
2020-08-11T09:33:00.6415615Z pyflink/util/exceptions.py:147: 
2020-08-11T09:33:00.6415918Z _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ 
2020-08-11T09:33:00.6416154Z 
2020-08-11T09:33:00.6416459Z answer = &lt;span class=&quot;code-quote&quot;&gt;&apos;xro10353&apos;&lt;/span&gt;
2020-08-11T09:33:00.6416746Z gateway_client = &amp;lt;py4j.java_gateway.GatewayClient object at 0x7f9572c53ac8&amp;gt;
2020-08-11T09:33:00.6419376Z target_id = &lt;span class=&quot;code-quote&quot;&gt;&apos;z:org.apache.flink.table.runtime.arrow.ArrowUtils&apos;&lt;/span&gt;
2020-08-11T09:33:00.6420325Z name = &lt;span class=&quot;code-quote&quot;&gt;&apos;collectAsPandasDataFrame&apos;&lt;/span&gt;
2020-08-11T09:33:00.6420574Z 
2020-08-11T09:33:00.6421009Z     def get_return_value(answer, gateway_client, target_id=None, name=None):
2020-08-11T09:33:00.6421735Z         &quot;&quot;&quot;Converts an answer received from the Java gateway into a Python object.
2020-08-11T09:33:00.6422153Z     
2020-08-11T09:33:00.6422538Z         For example, string representation of integers are converted to Python
2020-08-11T09:33:00.6423113Z         integer, string representation of objects are converted to JavaObject
2020-08-11T09:33:00.6423424Z         instances, etc.
2020-08-11T09:33:00.6423594Z     
2020-08-11T09:33:00.6423844Z         :param answer: the string returned by the Java gateway
2020-08-11T09:33:00.6424203Z         :param gateway_client: the gateway client used to communicate with the Java
2020-08-11T09:33:00.6424604Z             Gateway. Only necessary &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the answer is a reference (e.g., object,
2020-08-11T09:33:00.6424874Z             list, map)
2020-08-11T09:33:00.6425375Z         :param target_id: the name of the object from which the answer comes from
2020-08-11T09:33:00.6425735Z             (e.g., *object1* in `object1.hello()`). Optional.
2020-08-11T09:33:00.6426069Z         :param name: the name of the member from which the answer comes from
2020-08-11T09:33:00.6426422Z             (e.g., *hello* in `object1.hello()`). Optional.
2020-08-11T09:33:00.6426648Z         &quot;&quot;&quot;
2020-08-11T09:33:00.6426868Z         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; is_error(answer)[0]:
2020-08-11T09:33:00.6427112Z             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; len(answer) &amp;gt; 1:
2020-08-11T09:33:00.6427358Z                 type = answer[1]
2020-08-11T09:33:00.6427665Z                 value = OUTPUT_CONVERTER[type](answer[2:], gateway_client)
2020-08-11T09:33:00.6428032Z                 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; answer[1] == REFERENCE_TYPE:
2020-08-11T09:33:00.6428313Z                     raise Py4JJavaError(
2020-08-11T09:33:00.6428691Z                         &lt;span class=&quot;code-quote&quot;&gt;&quot;An error occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; calling {0}{1}{2}.\n&quot;&lt;/span&gt;.
2020-08-11T09:33:00.6429083Z &amp;gt;                       format(target_id, &lt;span class=&quot;code-quote&quot;&gt;&quot;.&quot;&lt;/span&gt;, name), value)
2020-08-11T09:33:00.6429798Z E                   py4j.protocol.Py4JJavaError: An error occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; calling z:org.apache.flink.table.runtime.arrow.ArrowUtils.collectAsPandasDataFrame.
2020-08-11T09:33:00.6430529Z E                   : org.apache.flink.table.api.TableException: AppendStreamTableSink requires that Table has only insert changes.
2020-08-11T09:33:00.6431132Z E                   	at org.apache.flink.table.plan.nodes.datastream.DataStreamSink.writeToAppendSink(DataStreamSink.scala:118)
2020-08-11T09:33:00.6431793Z E                   	at org.apache.flink.table.plan.nodes.datastream.DataStreamSink.writeToSink(DataStreamSink.scala:74)
2020-08-11T09:33:00.6432378Z E                   	at org.apache.flink.table.plan.nodes.datastream.DataStreamSink.translateToPlan(DataStreamSink.scala:59)
2020-08-11T09:33:00.6433145Z E                   	at org.apache.flink.table.planner.StreamPlanner.org$apache$flink$table$planner$StreamPlanner$$translateToCRow(StreamPlanner.scala:274)
2020-08-11T09:33:00.6434258Z E                   	at org.apache.flink.table.planner.StreamPlanner$$anonfun$translate$1.apply(StreamPlanner.scala:120)
2020-08-11T09:33:00.6435151Z E                   	at org.apache.flink.table.planner.StreamPlanner$$anonfun$translate$1.apply(StreamPlanner.scala:117)
2020-08-11T09:33:00.6436010Z E                   	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)
2020-08-11T09:33:00.6436565Z E                   	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)
2020-08-11T09:33:00.6437051Z E                   	at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:891)
2020-08-11T09:33:00.6437492Z E                   	at scala.collection.AbstractIterator.foreach(Iterator.scala:1334)
2020-08-11T09:33:00.6437963Z E                   	at scala.collection.IterableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(IterableLike.scala:72)
2020-08-11T09:33:00.6438568Z E                   	at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
2020-08-11T09:33:00.6439109Z E                   	at scala.collection.TraversableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;map(TraversableLike.scala:234)
2020-08-11T09:33:00.6439574Z E                   	at scala.collection.AbstractTraversable.map(Traversable.scala:104)
2020-08-11T09:33:00.6440142Z E                   	at org.apache.flink.table.planner.StreamPlanner.translate(StreamPlanner.scala:117)
2020-08-11T09:33:00.6440681Z E                   	at org.apache.flink.table.api.internal.TableEnvironmentImpl.translate(TableEnvironmentImpl.java:1264)
2020-08-11T09:33:00.6441279Z E                   	at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeInternal(TableEnvironmentImpl.java:733)
2020-08-11T09:33:00.6441924Z E                   	at org.apache.flink.table.api.internal.TableImpl.execute(TableImpl.java:570)
2020-08-11T09:33:00.6442447Z E                   	at org.apache.flink.table.runtime.arrow.ArrowUtils.collectAsPandasDataFrame(ArrowUtils.java:643)
2020-08-11T09:33:00.6442934Z E                   	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
2020-08-11T09:33:00.6443477Z E                   	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
2020-08-11T09:33:00.6444005Z E                   	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
2020-08-11T09:33:00.6444476Z E                   	at java.lang.reflect.Method.invoke(Method.java:498)
2020-08-11T09:33:00.6444953Z E                   	at org.apache.flink.api.python.shaded.py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)
2020-08-11T09:33:00.6445545Z E                   	at org.apache.flink.api.python.shaded.py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)
2020-08-11T09:33:00.6446079Z E                   	at org.apache.flink.api.python.shaded.py4j.Gateway.invoke(Gateway.java:282)
2020-08-11T09:33:00.6446631Z E                   	at org.apache.flink.api.python.shaded.py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)
2020-08-11T09:33:00.6447221Z E                   	at org.apache.flink.api.python.shaded.py4j.commands.CallCommand.execute(CallCommand.java:79)
2020-08-11T09:33:00.6447764Z E                   	at org.apache.flink.api.python.shaded.py4j.GatewayConnection.run(GatewayConnection.java:238)
2020-08-11T09:33:00.6448224Z E                   	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2020-08-11T09:33:00.6448437Z 
2020-08-11T09:33:00.6449124Z .tox/py35-cython/lib/python3.5/site-packages/py4j/protocol.py:328: Py4JJavaError
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13322092">FLINK-18893</key>
            <summary>Python tests fails with &quot;AppendStreamTableSink requires that Table has only insert changes.&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dian.fu">Dian Fu</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Tue, 11 Aug 2020 18:06:57 +0000</created>
                <updated>Wed, 12 Aug 2020 02:56:49 +0000</updated>
                            <resolved>Wed, 12 Aug 2020 02:56:41 +0000</resolved>
                                    <version>1.11.2</version>
                    <version>1.12.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>API / Python</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17175927" author="dian.fu" created="Wed, 12 Aug 2020 01:50:28 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;, I will fix this issue ASAP.&lt;/p&gt;</comment>
                            <comment id="17175947" author="dian.fu" created="Wed, 12 Aug 2020 02:51:59 +0000"  >&lt;p&gt;Just found that &lt;b&gt;Table.execute&lt;/b&gt; doesn&apos;t support upsert table in 1.11 and so we should not cherry-pick&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18848&quot; title=&quot;table.to_pandas should handle retraction rows properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18848&quot;&gt;&lt;del&gt;FLINK-18848&lt;/del&gt;&lt;/a&gt; to release-1.11.&#160; So fixing this issue by:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Revert the PR of&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18848&quot; title=&quot;table.to_pandas should handle retraction rows properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18848&quot;&gt;&lt;del&gt;FLINK-18848&lt;/del&gt;&lt;/a&gt; from release-1.11&lt;/li&gt;
	&lt;li&gt;As this issue also exists in master, submit a PR to fix it in master&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17175948" author="dian.fu" created="Wed, 12 Aug 2020 02:54:21 +0000"  >&lt;p&gt;master: Fixed via&#160;3932683871e7d1aaa74d318aa4cee90d9b2f9e61&lt;br/&gt;
release-1.11: Revert &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18848&quot; title=&quot;table.to_pandas should handle retraction rows properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18848&quot;&gt;&lt;del&gt;FLINK-18848&lt;/del&gt;&lt;/a&gt; via&#160;0ca2720b13510e3f76cda2942268614304c64916&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 13 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hnzs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>