<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:57:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22689] Table API Documentation Row-Based Operations Example Fails</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22689</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I wrote the following program according to the example code provided in &lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-release-1.13/docs/dev/table/tableapi/#row-based-operations&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Documentation/Table API/Row-based operations&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TableUDF {
 &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
 &#160; &#160; &#160; &#160;StreamExecutionEnvironment env = StreamExecutionEnvironment.createLocalEnvironment();
 &#160; &#160; &#160; &#160;StreamTableEnvironment tEnv = StreamTableEnvironment.create(env);
&#8203;
 &#160; &#160; &#160; &#160;Table input = tEnv.fromValues(
 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;DataTypes.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;ROW&amp;lt;c STRING&amp;gt;&quot;&lt;/span&gt;),
 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;Row.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;name&quot;&lt;/span&gt;)
 &#160; &#160; &#160;  );
&#8203;
 &#160; &#160; &#160; &#160;ScalarFunction func = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyMapFunction();
 &#160; &#160; &#160; &#160;tEnv.registerFunction(&lt;span class=&quot;code-quote&quot;&gt;&quot;func&quot;&lt;/span&gt;, func);
&#8203;
 &#160; &#160; &#160; &#160;Table table = input
 &#160; &#160; &#160; &#160; &#160; &#160; &#160;  .map(call(&lt;span class=&quot;code-quote&quot;&gt;&quot;func&quot;&lt;/span&gt;, $(&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;)).as(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;// exception occurs here
&lt;/span&gt;&#8203;
 &#160; &#160; &#160; &#160;table.execute().print();
 &#160;  }
&#8203;
 &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyMapFunction &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ScalarFunction {
 &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Row eval(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; a) {
 &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Row.of(a, &lt;span class=&quot;code-quote&quot;&gt;&quot;pre-&quot;&lt;/span&gt; + a);
 &#160; &#160; &#160;  }
&#8203;
 &#160; &#160; &#160; &#160;@Override
 &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TypeInformation&amp;lt;?&amp;gt; getResultType(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt;[] signature) {
 &#160; &#160; &#160; &#160; &#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Types.ROW(Types.STRING, Types.STRING);
 &#160; &#160; &#160;  }
 &#160;  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The code above would throw an exception like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.flink.table.api.ValidationException: Only a scalar function can be used in the map &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.
  at org.apache.flink.table.operations.utils.OperationTreeBuilder.map(OperationTreeBuilder.java:480)
  at org.apache.flink.table.api.internal.TableImpl.map(TableImpl.java:519)
  at org.apache.flink.ml.common.function.TableUDFBug.main(TableUDF.java:29)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;&#160; The core of the program above is identical to that provided in flink documentation, but it cannot function correctly. This might affect users who want to use custom function with table API.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13378930">FLINK-22689</key>
            <summary>Table API Documentation Row-Based Operations Example Fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="paul8263">Yao Zhang</assignee>
                                    <reporter username="yunfengzhou">Yunfeng Zhou</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 18 May 2021 02:50:37 +0000</created>
                <updated>Sat, 28 Aug 2021 12:13:39 +0000</updated>
                            <resolved>Tue, 1 Jun 2021 04:09:20 +0000</resolved>
                                    <version>1.12.1</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.2</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17353012" author="paul8263" created="Fri, 28 May 2021 07:08:36 +0000"  >&lt;p&gt;I reproduced this problem. The &quot;as&quot; method call in BaseExpressions.java simply transformed the expression to UnresolvedCallExpression with the functionDefinition of BuiltInFunctionDefinitions.AS, which does not meet the requirement of &quot;map&quot;, who needs the kind of resolvedMapFunction to be FunctionKind.SCALAR.&lt;/p&gt;

&lt;p&gt;Also, the &quot;as&quot; method in BaseExpressions.java fails to expand ROW type to multiple fields.&lt;/p&gt;

&lt;p&gt;Could you pls assign this issue to me?&lt;/p&gt;</comment>
                            <comment id="17354785" author="jark" created="Tue, 1 Jun 2021 04:09:20 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 997fa27e462c612f70401939c0fa9b217490dd73&lt;/li&gt;
	&lt;li&gt;release-1.13: dab3cf240ada16aa754f7855dff4a364abf91e5f&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0r45k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>