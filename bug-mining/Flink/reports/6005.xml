<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:07:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24708] `ConvertToNotInOrInRule` has a bug which leads to wrong result</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24708</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A user report this bug in maillist, I paste the content here.&lt;/p&gt;

&lt;p&gt;We are in the process of upgrading from Flink 1.9.3 to 1.13.3.&#160; We have noticed that statements with either where UPPER(field) or LOWER(field) in combination with an IN do not always evaluate correctly.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The following test case highlights this problem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.streaming.api.datastream.DataStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.table.api.Schema;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.flink.table.api.bridge.java.StreamTableEnvironment;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestCase {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
        env.setParallelism(1);

        TestData testData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestData();
        testData.setField1(&lt;span class=&quot;code-quote&quot;&gt;&quot;bcd&quot;&lt;/span&gt;);
        DataStream&amp;lt;TestData&amp;gt; stream = env.fromElements(testData);
        stream.print();  &lt;span class=&quot;code-comment&quot;&gt;// To prevent &lt;span class=&quot;code-quote&quot;&gt;&apos;No operators&apos;&lt;/span&gt; error
&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StreamTableEnvironment tableEnvironment = StreamTableEnvironment.create(env);
        tableEnvironment.createTemporaryView(&lt;span class=&quot;code-quote&quot;&gt;&quot;testTable&quot;&lt;/span&gt;, stream, Schema.newBuilder().build());

        &lt;span class=&quot;code-comment&quot;&gt;// Fails because abcd is larger than abc
&lt;/span&gt;        tableEnvironment.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select *, &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; as run from testTable WHERE lower(field1) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;abcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;cde&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).print();
        &lt;span class=&quot;code-comment&quot;&gt;// Succeeds because lower was removed
&lt;/span&gt;        tableEnvironment.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select *, &lt;span class=&quot;code-quote&quot;&gt;&apos;2&apos;&lt;/span&gt; as run from testTable WHERE field1 IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;abcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;cde&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).print();
        &lt;span class=&quot;code-comment&quot;&gt;// These 4 succeed because the smallest literal is before abcd
&lt;/span&gt;        tableEnvironment.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select *, &lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt; as run from testTable WHERE lower(field1) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;cde&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).print();
        tableEnvironment.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select *, &lt;span class=&quot;code-quote&quot;&gt;&apos;4&apos;&lt;/span&gt; as run from testTable WHERE lower(field1) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abhi&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;cde&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).print();
        tableEnvironment.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select *, &lt;span class=&quot;code-quote&quot;&gt;&apos;5&apos;&lt;/span&gt; as run from testTable WHERE lower(field1) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;cde&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bcd&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).print();
        tableEnvironment.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select *, &lt;span class=&quot;code-quote&quot;&gt;&apos;6&apos;&lt;/span&gt; as run from testTable WHERE lower(field1) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;cde&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abc&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bcd&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).print();
        &lt;span class=&quot;code-comment&quot;&gt;// Fails because smallest is not first
&lt;/span&gt;        tableEnvironment.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select *, &lt;span class=&quot;code-quote&quot;&gt;&apos;7&apos;&lt;/span&gt; as run from testTable WHERE lower(field1) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;cdef&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abce&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abcd&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;ab&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bcd&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).print();
        &lt;span class=&quot;code-comment&quot;&gt;// Succeeds
&lt;/span&gt;        tableEnvironment.executeSql(&lt;span class=&quot;code-quote&quot;&gt;&quot;select *, &lt;span class=&quot;code-quote&quot;&gt;&apos;8&apos;&lt;/span&gt; as run from testTable WHERE lower(field1) IN (&lt;span class=&quot;code-quote&quot;&gt;&apos;ab&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;cdef&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abce&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;abcdefgh&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;bcd&apos;&lt;/span&gt;)&quot;&lt;/span&gt;).print();

        env.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;TestCase&quot;&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestData {
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; field1;

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getField1() {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; field1;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setField1(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; field1) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.field1 = field1;
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The job produces the following output:&lt;/p&gt;

&lt;p&gt;Empty set&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;op&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; field1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; run&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+I&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bcd&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 2&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;

&lt;p&gt;1 row in set&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;op&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; field1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; run&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+I&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bcd&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;3&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;

&lt;p&gt;1 row in set&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;op&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; field1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; run&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+I&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bcd&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;

&lt;p&gt;1 row in set&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;op&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; field1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; run&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+I&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bcd&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 5&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;

&lt;p&gt;1 row in set&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;op&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; field1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; run&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+I&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bcd&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 6&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;

&lt;p&gt;1 row in set&lt;/p&gt;

&lt;p&gt;Empty set&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;op&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; field1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; run&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;+I&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; bcd&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; 8&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&lt;ins&gt;----&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;-----------------------------&lt;del&gt;++&lt;/del&gt;-------------------------------&lt;/p&gt;

&lt;p&gt;1 row in set&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13409144">FLINK-24708</key>
            <summary>`ConvertToNotInOrInRule` has a bug which leads to wrong result</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fsk119">Shengkai Fang</assignee>
                                    <reporter username="jingzhang">Jing Zhang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 29 Oct 2021 15:58:31 +0000</created>
                <updated>Tue, 30 Aug 2022 07:26:08 +0000</updated>
                            <resolved>Tue, 23 Nov 2021 04:36:46 +0000</resolved>
                                                    <fixVersion>1.13.6</fixVersion>
                    <fixVersion>1.14.3</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="17436049" author="qingru zhang" created="Fri, 29 Oct 2021 16:00:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=TsReaper&quot; class=&quot;user-hover&quot; rel=&quot;TsReaper&quot;&gt;TsReaper&lt;/a&gt; cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfrey&quot; class=&quot;user-hover&quot; rel=&quot;godfrey&quot;&gt;godfrey&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt; &#160;It seems to be a bug in `ConvertToNotInOrInRule`.&lt;br/&gt;
For query 1 and query 7, after apply `ConvertToNotInOrInRule` &#160;in &apos;default_rewrite&apos; phase, &apos;abc&apos;,&apos;bcd&apos;,&apos;cde&apos; would be cast to CHAR(4) which leads to empty result, because &apos;bcd&apos; != &apos;bcd &apos;.&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13035482/13035482_image-2021-10-29-23-59-48-074.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17436500" author="godfreyhe" created="Sun, 31 Oct 2021 15:16:00 +0000"  >&lt;p&gt;Thanks for reporting this bug. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingru+zhang&quot; class=&quot;user-hover&quot; rel=&quot;qingru zhang&quot;&gt;qingru zhang&lt;/a&gt; Currently the first element&apos;s type of Range is used as the element type for the Search node when calling RexBuilder#makeIn. We need to fix RexBuilder#makeIn. Search is introduced in Flink 1.12 when upgrading Calcite to 1.23&lt;/p&gt;</comment>
                            <comment id="17443509" author="qingru zhang" created="Mon, 15 Nov 2021 02:16:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt; Thanks for response. BTW,&#160; I also created a Jira in Calcite: &lt;a href=&quot;https://issues.apache.org/jira/browse/CALCITE-4888&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CALCITE-4888&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17447769" author="godfreyhe" created="Tue, 23 Nov 2021 04:36:46 +0000"  >&lt;p&gt;Fixed in:&lt;br/&gt;
1.15.0: 90e850301e672fc0da293abc55eb446f7ec68ffa&lt;br/&gt;
1.14.1: 4315c1be1f94367058c85be82e89d1bd623c63a7&lt;br/&gt;
1.13.4: 39134d1c1524f6014e0ce676e471379d386bc659&lt;/p&gt;</comment>
                            <comment id="17597605" author="lam167" created="Tue, 30 Aug 2022 07:26:08 +0000"  >&lt;p&gt;hello, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jingzhang&quot; class=&quot;user-hover&quot; rel=&quot;jingzhang&quot;&gt;jingzhang&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I had this problem recently too with flink 1.12.2, and fixed it locally. Then I saw the issue, and found maybe the test case you provided can not fully reproduce the error, there&apos;s a rule named `SimplifyFilterConditionRule` that would be applied optimization before the `ConvertToNotInOrInRule`, so the test case&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT * from MyTable where e in (&lt;span class=&quot;code-quote&quot;&gt;&apos;CTNBSmokeSensor&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;H388N&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;H389N     &apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;GHL-IRD&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;JY-BF-20YN&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;HC809&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;DH-9908N-AEP&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;DH-9908N&apos;&lt;/span&gt;) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;would alse produce the right result before this bug was fixed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3], e=[$4])
+- LogicalFilter(condition=[SEARCH($4, Sarg[_UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;CTNBSmokeSensor&apos;&lt;/span&gt;:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;DH-9908N&apos;&lt;/span&gt;:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;DH-9908N-AEP&apos;&lt;/span&gt;:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;GHL-IRD&apos;&lt;/span&gt;:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;H388N&apos;&lt;/span&gt;:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;H389N &#160; &#160; &apos;&lt;/span&gt;:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;HC809&apos;&lt;/span&gt;:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;JY-BF-20YN&apos;&lt;/span&gt;:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;]:VARCHAR(15) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt;)])
&#160; &#160;+- LogicalTableScan(table=[[default_catalog, default_database, MyTable, source: [TestTableSource(a, b, c, d, e)]]]) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Only when we tried to check if `f(e)` in the literals scope, which `f` is a used-defined function, `SimplifyFilterConditionRule` would be invalid, and then `ConvertToNotInOrInRule` would take an effect and reproduce the bug.&lt;/p&gt;

&lt;p&gt;I&apos;m not very sure if there&apos;s a need to add more tests for this problem and I just add some of my understanding of the problem. If you think this is not a problem, I&apos;m ok with this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13411692">CALCITE-4888</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13035482" name="image-2021-10-29-23-59-48-074.png" size="141403" author="jingzhang" created="Fri, 29 Oct 2021 15:59:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0wads:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>