<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5214] Clean up checkpoint files when failing checkpoint operation on TM</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5214</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When the &lt;tt&gt;StreamTask#performCheckpoint&lt;/tt&gt; operation fails on a &lt;tt&gt;TaskManager&lt;/tt&gt; potentially created checkpoint files are not cleaned up. This should be changed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13024510">FLINK-5214</key>
            <summary>Clean up checkpoint files when failing checkpoint operation on TM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Nov 2016 17:13:41 +0000</created>
                <updated>Sun, 29 Jan 2017 14:42:21 +0000</updated>
                            <resolved>Tue, 24 Jan 2017 10:37:52 +0000</resolved>
                                    <version>1.1.3</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.1.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15710512" author="xiaogang.shi" created="Thu, 1 Dec 2016 01:42:19 +0000"  >&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5086&quot; title=&quot;Clean dead snapshot files produced by the tasks failing to acknowledge checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5086&quot;&gt;FLINK-5086&lt;/a&gt; to report a similar problem, but I do not have a good idea how to resolve it. &lt;/p&gt;

&lt;p&gt;Because JM does know the existence of these checkpoint files, it seems only TM can delete them. But as a failed TM may not be recovered by the JM if the number of retries exceeds the given limit,  these files will not be deleted in such cases.&lt;/p&gt;

&lt;p&gt;One possible solution i think is to let each TM return a handler to JM when the TM is registered. JM can use the handler to clean the files even when the TM fails. &lt;/p&gt;

&lt;p&gt;Another solution is to recover the TM when the number of retries exceeds the limit. Once the TM is recovered, the only thing it does is to clean the checkpoint files.&lt;/p&gt;

&lt;p&gt;Do you have any better ideas?&lt;/p&gt;</comment>
                            <comment id="15712443" author="githubbot" created="Thu, 1 Dec 2016 16:47:12 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2918&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2918&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5214&quot; title=&quot;Clean up checkpoint files when failing checkpoint operation on TM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5214&quot;&gt;&lt;del&gt;FLINK-5214&lt;/del&gt;&lt;/a&gt; Clean up checkpoint data in case of a failing checkpoint operation&lt;/p&gt;

&lt;p&gt;    Adds exception handling to the stream operators for the snapshotState method. In case of an&lt;br/&gt;
    exception while performing the snapshot operation, all until then checkpointed data will&lt;br/&gt;
    be discarded/deleted. This makes sure that a failing checkpoint operation won&apos;t leave&lt;br/&gt;
    orphaned checkpoint data (e.g. files) behind.&lt;/p&gt;

&lt;p&gt;    Add test case for FsCheckpointStateOutputStream&lt;/p&gt;

&lt;p&gt;    Add RocksDB FullyAsyncSnapshot cleanup test&lt;/p&gt;

&lt;p&gt;    Add proper state cleanup tests for window operator&lt;/p&gt;

&lt;p&gt;    Add state cleanup test for failing snapshot call of AbstractUdfStreamOperator&lt;/p&gt;

&lt;p&gt;    cc @StephanEwen&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixTaskCheckpointFailure&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2918.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2918.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2918&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 35fc74dd501fc49aa0b55f415c85c2140206220a&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-12-01T12:25:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5214&quot; title=&quot;Clean up checkpoint files when failing checkpoint operation on TM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5214&quot;&gt;&lt;del&gt;FLINK-5214&lt;/del&gt;&lt;/a&gt; Clean up checkpoint data in case of a failing checkpoint operation&lt;/p&gt;

&lt;p&gt;    Adds exception handling to the stream operators for the snapshotState method. In case of an&lt;br/&gt;
    exception while performing the snapshot operation, all until then checkpointed data will&lt;br/&gt;
    be discarded/deleted. This makes sure that a failing checkpoint operation won&apos;t leave&lt;br/&gt;
    orphaned checkpoint data (e.g. files) behind.&lt;/p&gt;

&lt;p&gt;    Add test case for FsCheckpointStateOutputStream&lt;/p&gt;

&lt;p&gt;    Add RocksDB FullyAsyncSnapshot cleanup test&lt;/p&gt;

&lt;p&gt;    Add proper state cleanup tests for window operator&lt;/p&gt;

&lt;p&gt;    Add state cleanup test for failing snapshot call of AbstractUdfStreamOperator&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15712981" author="githubbot" created="Thu, 1 Dec 2016 20:23:03 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2918&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2918&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15722059" author="till.rohrmann" created="Mon, 5 Dec 2016 11:48:40 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xiaogang.shi&quot; class=&quot;user-hover&quot; rel=&quot;xiaogang.shi&quot;&gt;xiaogang.shi&lt;/a&gt;, you&apos;re right that in case of a TM crash there might be orphaned checkpoint files left which are not properly cleaned up. I think what you describe in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5086&quot; title=&quot;Clean dead snapshot files produced by the tasks failing to acknowledge checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5086&quot;&gt;FLINK-5086&lt;/a&gt; could be a viable solution to the problem. This is actually the follow up to this issue which covers the case of a recoverable exception.&lt;/p&gt;</comment>
                            <comment id="15831718" author="githubbot" created="Fri, 20 Jan 2017 13:07:09 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5214&quot; title=&quot;Clean up checkpoint files when failing checkpoint operation on TM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5214&quot;&gt;&lt;del&gt;FLINK-5214&lt;/del&gt;&lt;/a&gt; Clean up checkpoint data in case of a failing checkpoint operation&lt;/p&gt;

&lt;p&gt;    Adds exception handling to the stream operators for the snapshotState method. A failing&lt;br/&gt;
    snapshot operation will trigger the clean up of all so far generated state resources.&lt;br/&gt;
    This will avoid that in case of a failing snapshot operation resources (e.g. files) are&lt;br/&gt;
    left behind.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; taskOperatorStateCleanup&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3178&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c1a597320dbe3c7f4514297d5ad7f2b8f416e287&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-12-01T12:25:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5214&quot; title=&quot;Clean up checkpoint files when failing checkpoint operation on TM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5214&quot;&gt;&lt;del&gt;FLINK-5214&lt;/del&gt;&lt;/a&gt; Clean up checkpoint data in case of a failing checkpoint operation&lt;/p&gt;

&lt;p&gt;    Adds exception handling to the stream operators for the snapshotState method. A failing&lt;br/&gt;
    snapshot operation will trigger the clean up of all so far generated state resources.&lt;br/&gt;
    This will avoid that in case of a failing snapshot operation resources (e.g. files) are&lt;br/&gt;
    left behind.&lt;/p&gt;

&lt;p&gt;    Add test case for OperatorSnapshotResult&lt;/p&gt;

&lt;p&gt;    Add StateSnapshotContextSynchronousImplTest&lt;/p&gt;

&lt;p&gt;    Add AbstractStreamOperator failing snapshot tests&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15831954" author="githubbot" created="Fri, 20 Jan 2017 15:33:54 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3183&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;backport&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5214&quot; title=&quot;Clean up checkpoint files when failing checkpoint operation on TM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5214&quot;&gt;&lt;del&gt;FLINK-5214&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5229&quot; title=&quot;Cleanup StreamTaskStates if a checkpoint operation of a subsequent operator fails &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5229&quot;&gt;&lt;del&gt;FLINK-5229&lt;/del&gt;&lt;/a&gt; Backport StreamTask and StreamOperator checkpoint cleanup&lt;/p&gt;

&lt;p&gt;    Backport of #3179 and #3178 onto the `release-1.2` branch.&lt;/p&gt;

&lt;p&gt;    Adds exception handling to the stream operators for the snapshotState method. A failing&lt;br/&gt;
    snapshot operation will trigger the clean up of all so far generated state resources.&lt;br/&gt;
    This will avoid that in case of a failing snapshot operation resources (e.g. files) are&lt;br/&gt;
    left behind.&lt;/p&gt;

&lt;p&gt;    This PR adds operator state cleanup to the StreamTask class. If a stream task contains multiple&lt;br/&gt;
    stream operators, then every operator is checkpointed. In case that a snapshot operation fails&lt;br/&gt;
    all state handles and OperatorSnapshotResults belonging to previous operators have to be freed.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; backportStateCleanup&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3183.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3183.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3183&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit a0edef186c49520e353fe6cdc3321ef208e1bb3b&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-12-01T12:25:05Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5214&quot; title=&quot;Clean up checkpoint files when failing checkpoint operation on TM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5214&quot;&gt;&lt;del&gt;FLINK-5214&lt;/del&gt;&lt;/a&gt; Clean up checkpoint data in case of a failing checkpoint operation&lt;/p&gt;

&lt;p&gt;    Adds exception handling to the stream operators for the snapshotState method. A failing&lt;br/&gt;
    snapshot operation will trigger the clean up of all so far generated state resources.&lt;br/&gt;
    This will avoid that in case of a failing snapshot operation resources (e.g. files) are&lt;br/&gt;
    left behind.&lt;/p&gt;

&lt;p&gt;    Add test case for OperatorSnapshotResult&lt;/p&gt;

&lt;p&gt;    Add StateSnapshotContextSynchronousImplTest&lt;/p&gt;

&lt;p&gt;    Add AbstractStreamOperator failing snapshot tests&lt;/p&gt;

&lt;p&gt;commit 5eb4c2ff00a3818c53bac6c440d83bff0be8501a&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-01-20T13:28:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5229&quot; title=&quot;Cleanup StreamTaskStates if a checkpoint operation of a subsequent operator fails &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5229&quot;&gt;&lt;del&gt;FLINK-5229&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;state&amp;#93;&lt;/span&gt; Cleanup of operator snapshots if subsequent operator snapshots fail&lt;/p&gt;

&lt;p&gt;    This PR adds operator state cleanup to the StreamTask class. If a stream task contains multiple&lt;br/&gt;
    stream operators, then every operator is checkpointed. In case that a snapshot operation fails&lt;br/&gt;
    all state handles and OperatorSnapshotResults belonging to previous operators have to be freed.&lt;/p&gt;

&lt;p&gt;    Add test cases for failing checkpoint operations in StreamTask&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15834173" author="githubbot" created="Mon, 23 Jan 2017 09:57:19 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97282223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97282223&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java &amp;#8212;&lt;br/&gt;
    @@ -342,21 +343,50 @@ public final OperatorSnapshotResult snapshotState(&lt;br/&gt;
     		StateSnapshotContextSynchronousImpl snapshotContext = new StateSnapshotContextSynchronousImpl(&lt;br/&gt;
     				checkpointId, timestamp, streamFactory, keyGroupRange, getContainingTask().getCancelables());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;snapshotState(snapshotContext);&lt;br/&gt;
    +		try {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Here we could use the try-with-resource if `SnapshotContext` implements `AutoCloseable`&lt;/p&gt;</comment>
                            <comment id="15834174" author="githubbot" created="Mon, 23 Jan 2017 09:57:19 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97279484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97279484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/StateSnapshotContextSynchronousImpl.java &amp;#8212;&lt;br/&gt;
    @@ -127,4 +128,38 @@ public OperatorStateCheckpointOutputStream getRawOperatorStateOutput() throws Ex&lt;br/&gt;
     		return new DoneFuture&amp;lt;&amp;gt;(stream.closeAndGetHandle());&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    -}&lt;br/&gt;
    \ No newline at end of file&lt;br/&gt;
    +	private &amp;lt;T extends StreamStateHandle&amp;gt; void closeAndUnregisterStream(NonClosingCheckpointOutputStream&amp;lt;T&amp;gt; stream) throws IOException &lt;/p&gt;
{
    +		Preconditions.checkNotNull(stream);
    +
    +		closableRegistry.unregisterClosable(stream.getDelegate());
    +		stream.getDelegate().close();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void close() throws IOException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    If we already introduce a close method, we could also make this implement `AutoCloseable` and use it in try-with-resource?&lt;/p&gt;</comment>
                            <comment id="15834175" author="githubbot" created="Mon, 23 Jan 2017 09:57:19 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97279062&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97279062&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/StateSnapshotContext.java &amp;#8212;&lt;br/&gt;
    @@ -21,8 +21,9 @@&lt;br/&gt;
     import org.apache.flink.annotation.PublicEvolving;&lt;/p&gt;

&lt;p&gt;     /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* This interface provides a context in which operators that use managed (i.e. state that is managed by state&lt;/li&gt;
	&lt;li&gt;* backends) or raw (i.e. the operator can write it&apos;s state streams) state can perform a snapshot.&lt;br/&gt;
    + * This interface provides a context in which operators that use managed (i.e. state that is managed
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    All changes in this file are unrelated/reformatting.&lt;/p&gt;</comment>
                            <comment id="15834434" author="githubbot" created="Mon, 23 Jan 2017 12:58:38 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97312291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97312291&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/StateSnapshotContext.java &amp;#8212;&lt;br/&gt;
    @@ -21,8 +21,9 @@&lt;br/&gt;
     import org.apache.flink.annotation.PublicEvolving;&lt;/p&gt;

&lt;p&gt;     /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* This interface provides a context in which operators that use managed (i.e. state that is managed by state&lt;/li&gt;
	&lt;li&gt;* backends) or raw (i.e. the operator can write it&apos;s state streams) state can perform a snapshot.&lt;br/&gt;
    + * This interface provides a context in which operators that use managed (i.e. state that is managed
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    True. Will revert them.&lt;/p&gt;</comment>
                            <comment id="15834442" author="githubbot" created="Mon, 23 Jan 2017 13:05:51 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97313258&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97313258&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/StateSnapshotContextSynchronousImpl.java &amp;#8212;&lt;br/&gt;
    @@ -127,4 +128,38 @@ public OperatorStateCheckpointOutputStream getRawOperatorStateOutput() throws Ex&lt;br/&gt;
     		return new DoneFuture&amp;lt;&amp;gt;(stream.closeAndGetHandle());&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    -}&lt;br/&gt;
    \ No newline at end of file&lt;br/&gt;
    +	private &amp;lt;T extends StreamStateHandle&amp;gt; void closeAndUnregisterStream(NonClosingCheckpointOutputStream&amp;lt;T&amp;gt; stream) throws IOException &lt;/p&gt;
{
    +		Preconditions.checkNotNull(stream);
    +
    +		closableRegistry.unregisterClosable(stream.getDelegate());
    +		stream.getDelegate().close();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void close() throws IOException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Good idea. I will let it implement the `Closeable` interface&lt;/p&gt;</comment>
                            <comment id="15834452" author="githubbot" created="Mon, 23 Jan 2017 13:10:10 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97313842&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97313842&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/AbstractStreamOperator.java &amp;#8212;&lt;br/&gt;
    @@ -342,21 +343,50 @@ public final OperatorSnapshotResult snapshotState(&lt;br/&gt;
     		StateSnapshotContextSynchronousImpl snapshotContext = new StateSnapshotContextSynchronousImpl(&lt;br/&gt;
     				checkpointId, timestamp, streamFactory, keyGroupRange, getContainingTask().getCancelables());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;snapshotState(snapshotContext);&lt;br/&gt;
    +		try {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes, you&apos;re right. Will refactor the code that way &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15834453" author="githubbot" created="Mon, 23 Jan 2017 13:10:38 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @StefanRRichter. I&apos;ll address your comments and then merge this PR.&lt;/p&gt;</comment>
                            <comment id="15834469" author="githubbot" created="Mon, 23 Jan 2017 13:17:42 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97314933&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97314933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/StateSnapshotContextSynchronousImpl.java &amp;#8212;&lt;br/&gt;
    @@ -127,4 +128,38 @@ public OperatorStateCheckpointOutputStream getRawOperatorStateOutput() throws Ex&lt;br/&gt;
     		return new DoneFuture&amp;lt;&amp;gt;(stream.closeAndGetHandle());&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    -}&lt;br/&gt;
    \ No newline at end of file&lt;br/&gt;
    +	private &amp;lt;T extends StreamStateHandle&amp;gt; void closeAndUnregisterStream(NonClosingCheckpointOutputStream&amp;lt;T&amp;gt; stream) throws IOException &lt;/p&gt;
{
    +		Preconditions.checkNotNull(stream);
    +
    +		closableRegistry.unregisterClosable(stream.getDelegate());
    +		stream.getDelegate().close();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void close() throws IOException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I would prefer `AutoCloseable` over `Closeable`, because the former is general while the latter is more related to IO.&lt;/p&gt;</comment>
                            <comment id="15834588" author="githubbot" created="Mon, 23 Jan 2017 14:08:33 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97323947&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97323947&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/StateSnapshotContextSynchronousImpl.java &amp;#8212;&lt;br/&gt;
    @@ -127,4 +128,38 @@ public OperatorStateCheckpointOutputStream getRawOperatorStateOutput() throws Ex&lt;br/&gt;
     		return new DoneFuture&amp;lt;&amp;gt;(stream.closeAndGetHandle());&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    -}&lt;br/&gt;
    \ No newline at end of file&lt;br/&gt;
    +	private &amp;lt;T extends StreamStateHandle&amp;gt; void closeAndUnregisterStream(NonClosingCheckpointOutputStream&amp;lt;T&amp;gt; stream) throws IOException &lt;/p&gt;
{
    +		Preconditions.checkNotNull(stream);
    +
    +		closableRegistry.unregisterClosable(stream.getDelegate());
    +		stream.getDelegate().close();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void close() throws IOException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    But isn&apos;t it better to be as specific as possible? In this case we wouldn&apos;t unnecessarily widen the thrown exception.&lt;/p&gt;</comment>
                            <comment id="15834594" author="githubbot" created="Mon, 23 Jan 2017 14:12:29 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178#discussion_r97324700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178#discussion_r97324700&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/StateSnapshotContextSynchronousImpl.java &amp;#8212;&lt;br/&gt;
    @@ -127,4 +128,38 @@ public OperatorStateCheckpointOutputStream getRawOperatorStateOutput() throws Ex&lt;br/&gt;
     		return new DoneFuture&amp;lt;&amp;gt;(stream.closeAndGetHandle());&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    -}&lt;br/&gt;
    \ No newline at end of file&lt;br/&gt;
    +	private &amp;lt;T extends StreamStateHandle&amp;gt; void closeAndUnregisterStream(NonClosingCheckpointOutputStream&amp;lt;T&amp;gt; stream) throws IOException &lt;/p&gt;
{
    +		Preconditions.checkNotNull(stream);
    +
    +		closableRegistry.unregisterClosable(stream.getDelegate());
    +		stream.getDelegate().close();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public void close() throws IOException {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Of course, but you can and should always pick a more specific exception on the signature of your implementation. If `IOException` or a subclass is appropriate here, then you could also go with `Closeable` of course.&lt;/p&gt;</comment>
                            <comment id="15834841" author="githubbot" created="Mon, 23 Jan 2017 16:34:24 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3178&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15834845" author="githubbot" created="Mon, 23 Jan 2017 16:38:05 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3183&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merged manually into `release-1.2` branch.&lt;/p&gt;</comment>
                            <comment id="15834846" author="githubbot" created="Mon, 23 Jan 2017 16:38:11 +0000"  >&lt;p&gt;Github user tillrohrmann closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3183&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15835986" author="till.rohrmann" created="Tue, 24 Jan 2017 10:37:52 +0000"  >&lt;p&gt;1.3.0: e458975756e137ae2abb94e09fd92578ecd739bc&lt;br/&gt;
1.2.0: 006fcc4443f837d1384b8e85f9fb6dd048d2f743&lt;br/&gt;
1.1.4: 9c058871f778f748059829b1b350687e3f789f6f&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36z73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>