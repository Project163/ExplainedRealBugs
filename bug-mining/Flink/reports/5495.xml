<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:57:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-21301] Decouple window aggregate allow lateness with state ttl configuration</title>
                <link>https://issues.apache.org/jira/browse/FLINK-21301</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, state retention time config will also effect state clean behavior of Window Aggregate, which is unexpected for most users.&lt;/p&gt;

&lt;p&gt;E.g for the following example,&#160; User would set `MinIdleStateRetentionTime` to 1 Day to clean state in `deduplicate` . However, it will also effects clean behavior of window aggregate. For example, 2021-01-04 data would clean at 2021-01-06 instead of 2021-01-05.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt;
 DATE_FORMAT(tumble_end(ROWTIME ,&lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DAY&lt;/span&gt;),&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyy-MM-dd&apos;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; stat_time,
 &lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;(1) first_phone_num
&lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; (
 &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; 
 ROWTIME,
 user_id,
 &lt;span class=&quot;code-keyword&quot;&gt;row_number&lt;/span&gt;() &lt;span class=&quot;code-keyword&quot;&gt;over&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; user_id, pdate &lt;span class=&quot;code-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; ROWTIME ) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; rn
 &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; source_kafka_biz_shuidi_sdb_crm_call_record 
) cal 
&lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; rn =1
&lt;span class=&quot;code-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; tumble(ROWTIME,&lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DAY&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It&apos;s better to decouple window aggregate allow lateness with&#160;`MinIdleStateRetentionTime` .&lt;/p&gt;</description>
                <environment></environment>
        <key id="13357009">FLINK-21301</key>
            <summary>Decouple window aggregate allow lateness with state ttl configuration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jingzhang">Jing Zhang</assignee>
                                    <reporter username="jingzhang">Jing Zhang</reporter>
                        <labels>
                            <label>auto-unassigned</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 5 Feb 2021 09:42:09 +0000</created>
                <updated>Mon, 21 Nov 2022 20:16:43 +0000</updated>
                            <resolved>Thu, 10 Jun 2021 04:10:32 +0000</resolved>
                                                    <fixVersion>1.14.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17279631" author="jark" created="Fri, 5 Feb 2021 11:06:55 +0000"  >&lt;p&gt;We can enable state ttl for window state only when emit strategy is specified. What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingru+zhang&quot; class=&quot;user-hover&quot; rel=&quot;qingru zhang&quot;&gt;qingru zhang&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17279710" author="qingru zhang" created="Fri, 5 Feb 2021 14:06:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;Thanks for your reply. Of course, we could set allow lateness to state ttl for window state if `lateFireDelayEnabled` is enabled. However, it&apos;s more flexible if we could set&#160;allow lateness different with state ttl. For above example, user may want to set `MinIdleStateRetentionTime` to 1 day, but only want set allow lateness to 5 min ~10min instead of 1 day.&#160;&lt;/p&gt;

&lt;p&gt;Looking forward to your reply, thanks.&lt;/p&gt;</comment>
                            <comment id="17324107" author="flink-jira-bot" created="Fri, 16 Apr 2021 22:43:26 +0000"  >&lt;p&gt;This issue is assigned but has not received an update in 7 days so it has been labeled &quot;stale-assigned&quot;. If you are still working on the issue, please give an update and remove the label. If you are no longer working on the issue, please unassign so someone else may work on it. In 7 days the issue will be automatically unassigned.&lt;/p&gt;</comment>
                            <comment id="17333619" author="flink-jira-bot" created="Tue, 27 Apr 2021 22:47:45 +0000"  >&lt;p&gt;This issue was marked &quot;stale-assigned&quot; and has not received an update in 7 days. It is now automatically unassigned. If you are still working on it, you can assign it to yourself again. Please also give an update about the status of the work.&lt;/p&gt;</comment>
                            <comment id="17345659" author="qingru zhang" created="Sun, 16 May 2021 09:48:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160; I could fix the bug that only enable allow lateness only when&#160;emit strategy is specified. However I think it&apos;s better to decouple allow lateness with state retention configuration because of the following reasons:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;it is not a intuitive to use state retention configuration to control windowed operator allow lateness&#160;&lt;/li&gt;
	&lt;li&gt;state retention configuration is global configuration for a job which would effects all state operator. If a job contains multiple state operators, e.g (deduplicate/ unbounded aggregate/window operator), user may want to set different values for different operator. For the above mentioned example, 1 day state retention for deduplicate, 5 min allow lateness for window aggregate.
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt;
 DATE_FORMAT(tumble_end(ROWTIME ,&lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DAY&lt;/span&gt;),&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyy-MM-dd&apos;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; stat_time,
 &lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;(1) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; cnt, &lt;span class=&quot;code-keyword&quot;&gt;sum&lt;/span&gt;(num) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; sum_num
&lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; (
 &lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; 
 ROWTIME,
 user_id,
 &lt;span class=&quot;code-keyword&quot;&gt;row_number&lt;/span&gt;() &lt;span class=&quot;code-keyword&quot;&gt;over&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;partition&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; user_id, pdate &lt;span class=&quot;code-keyword&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; ROWTIME ) &lt;span class=&quot;code-keyword&quot;&gt;as&lt;/span&gt; rn
 &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; source_kafka_biz_shuidi_sdb_crm_call_record 
) cal 
&lt;span class=&quot;code-keyword&quot;&gt;where&lt;/span&gt; rn =1
&lt;span class=&quot;code-keyword&quot;&gt;group&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;by&lt;/span&gt; tumble(ROWTIME,&lt;span class=&quot;code-keyword&quot;&gt;interval&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;DAY&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;What&apos;s your opinion about the issue?&lt;/p&gt;</comment>
                            <comment id="17345841" author="jark" created="Mon, 17 May 2021 02:59:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingru+zhang&quot; class=&quot;user-hover&quot; rel=&quot;qingru zhang&quot;&gt;qingru zhang&lt;/a&gt;, I thought about this again. Your requirement sounds like a fine-grained state TTL that different operators can have different TTL. Maybe can be addressed by this issue &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17173&quot; title=&quot;Supports query hint to config &amp;quot;IdleStateRetentionTime&amp;quot; per operator in SQL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17173&quot;&gt;FLINK-17173&lt;/a&gt;? &lt;/p&gt;</comment>
                            <comment id="17346026" author="qingru zhang" created="Mon, 17 May 2021 09:46:34 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; Thanks for your reply.&lt;/p&gt;

&lt;p&gt;I agree that things will be simpler if&#160;a fine-grained state TTL that different operators can have different TTL.&lt;/p&gt;

&lt;p&gt;However, IMO, allow lateness of window operator has relationship with TTL, but has a little difference. If enable allow lateness, the behavior of state ttl on window operator would be effected. But set state ttl could effect the behavior of allow lateness on window operator? I means allow lateness&#160;not only effects state ttl but also trigger behavior and emit behavior. It&apos;s better to introduce new configuration or new syntax to handle allow lateness.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="17346097" author="jark" created="Mon, 17 May 2021 11:28:51 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingru+zhang&quot; class=&quot;user-hover&quot; rel=&quot;qingru zhang&quot;&gt;qingru zhang&lt;/a&gt;, I&apos;m fine with introducing configurtions e.g. &lt;tt&gt;table.exec.emit.late-fire.allow-lateness&lt;/tt&gt;. But please still mark it &lt;tt&gt;@Experimental&lt;/tt&gt; and also keep the state ttl can still take effect when the new config is not set. &lt;/p&gt;</comment>
                            <comment id="17360532" author="godfreyhe" created="Thu, 10 Jun 2021 04:10:32 +0000"  >&lt;p&gt;Fixed in 1.14.0: 145502801c789143074536952f270bea56b30253&lt;/p&gt;</comment>
                            <comment id="17366448" author="lzljs3620320" created="Mon, 21 Jun 2021 08:00:21 +0000"  >&lt;p&gt;I&apos;m skeptical about this config option.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The trigger of window is complicated, introducing a new config option make more complicated.&lt;/li&gt;
	&lt;li&gt;What is the difference between allow lateness and TTL?&#160;The difference between allow lateness and TTL is very subtle. I think that in essence, after late emit is turned on, there is no difference between ordinary AGG and window AGG. They are basically doing the same thing. There is no need to introduce redundant configuration to user.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17366477" author="lzljs3620320" created="Mon, 21 Jun 2021 09:20:52 +0000"  >&lt;p&gt;And&#160;what&apos;s the difference between allow-lateness and late-fire?&#160;&lt;/p&gt;

&lt;p&gt;From the name, I think with allow-lateness on, there should be late fire ability. They seem to have the overlap ability.&lt;/p&gt;</comment>
                            <comment id="17529678" author="xiangcaohello" created="Thu, 28 Apr 2022 22:42:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt;&#160; &lt;del&gt;what is the table config for late-fire? I didn&apos;t find it in the documentation. &lt;a href=&quot;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/config/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/config/&lt;/a&gt;&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;del&gt;I also find it useful to have this allow-lateness config separate from state ttl. For example, when I have a join and windowing in the same SQL Script, I only want to set state ttl for join but not allowed lateness for windowing. I don&apos;t find another way to do so without table.exec.emit.allow-lateness&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;I misunderstood the current solution. &lt;a href=&quot;https://www.mail-archive.com/issues@flink.apache.org/msg498605.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/issues@flink.apache.org/msg498605.html&lt;/a&gt;&#160;provides a good summarization.&#160;&lt;/p&gt;</comment>
                            <comment id="17636864" author="JIRAUSER295489" created="Mon, 21 Nov 2022 20:03:53 +0000"  >&lt;p&gt;Hi there, I had a read of &lt;a href=&quot;https://www.mail-archive.com/user@flink.apache.org/msg43316.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/user@flink.apache.org/msg43316.html&lt;/a&gt; and was wondering if there was any particular reason why the allow-lateness configuration is not enabled for Window TVF aggregations? As I saw that Group Window Aggregation is deprecated &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;Would it be something hard to implement? We might have bandwidth on our team to work on it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - &lt;a href=&quot;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/queries/window-agg/#group-window-aggregation&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/sql/queries/window-agg/#group-window-aggregation&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nego:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>