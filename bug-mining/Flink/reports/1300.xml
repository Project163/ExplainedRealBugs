<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4177] CassandraConnectorTest.testCassandraCommitter causing unstable builds</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4177</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This build: &lt;a href=&quot;https://api.travis-ci.org/jobs/143272982/log.txt?deansi=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/jobs/143272982/log.txt?deansi=true&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;failed with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;07/08/2016 09:59:12	Job execution switched to status FINISHED.
Tests run: 7, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 146.646 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.streaming.connectors.cassandra.CassandraConnectorTest
testCassandraCommitter(org.apache.flink.streaming.connectors.cassandra.CassandraConnectorTest)  Time elapsed: 9.057 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
com.datastax.driver.core.exceptions.WriteTimeoutException: Cassandra timeout during write query at consistency LOCAL_SERIAL (1 replica were required but only 0 acknowledged the write)
	at com.datastax.driver.core.exceptions.WriteTimeoutException.copy(WriteTimeoutException.java:73)
	at com.datastax.driver.core.exceptions.WriteTimeoutException.copy(WriteTimeoutException.java:26)
	at com.datastax.driver.core.DriverThrowables.propagateCause(DriverThrowables.java:37)
	at com.datastax.driver.core.DefaultResultSetFuture.getUninterruptibly(DefaultResultSetFuture.java:245)
	at com.datastax.driver.core.AbstractSession.execute(AbstractSession.java:63)
	at com.datastax.driver.core.AbstractSession.execute(AbstractSession.java:39)
	at org.apache.flink.streaming.connectors.cassandra.CassandraCommitter.open(CassandraCommitter.java:103)
	at org.apache.flink.streaming.connectors.cassandra.CassandraConnectorTest.testCassandraCommitter(CassandraConnectorTest.java:284)
Caused by: com.datastax.driver.core.exceptions.WriteTimeoutException: Cassandra timeout during write query at consistency LOCAL_SERIAL (1 replica were required but only 0 acknowledged the write)
	at com.datastax.driver.core.exceptions.WriteTimeoutException.copy(WriteTimeoutException.java:100)
	at com.datastax.driver.core.Responses$Error.asException(Responses.java:122)
	at com.datastax.driver.core.RequestHandler$SpeculativeExecution.onSet(RequestHandler.java:477)
	at com.datastax.driver.core.Connection$Dispatcher.channelRead0(Connection.java:1005)
	at com.datastax.driver.core.Connection$Dispatcher.channelRead0(Connection.java:928)
	at io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:105)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:318)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:304)
	at io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:266)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:318)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:304)
	at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:318)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:304)
	at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:276)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:263)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:318)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:304)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:846)
	at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:618)
	at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:329)
	at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:250)
	at io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:112)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: com.datastax.driver.core.exceptions.WriteTimeoutException: Cassandra timeout during write query at consistency LOCAL_SERIAL (1 replica were required but only 0 acknowledged the write)
	at com.datastax.driver.core.Responses$Error$1.decode(Responses.java:59)
	at com.datastax.driver.core.Responses$Error$1.decode(Responses.java:37)
	at com.datastax.driver.core.Message$ProtocolDecoder.decode(Message.java:266)
	at com.datastax.driver.core.Message$ProtocolDecoder.decode(Message.java:246)
	at io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:89)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:318)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:304)
	at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:276)
	at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:263)
	at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:318)
	at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:304)
	at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:846)
	at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:618)
	at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:329)
	at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:250)
	at io.netty.util.concurrent.SingleThreadEventExecutor$2.run(SingleThreadEventExecutor.java:112)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12987742">FLINK-4177</key>
            <summary>CassandraConnectorTest.testCassandraCommitter causing unstable builds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Fri, 8 Jul 2016 10:05:36 +0000</created>
                <updated>Wed, 2 Oct 2019 17:48:35 +0000</updated>
                            <resolved>Mon, 14 Nov 2016 13:41:05 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Connectors / Cassandra</component>
                    <component>Connectors / Common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15367574" author="alkagin" created="Fri, 8 Jul 2016 11:47:26 +0000"  >&lt;p&gt;Increasing the timeout should be enough, we can do it adding `write_request_timeout_in_ms: &amp;lt;milliseconds&amp;gt;` in the `test/resources/cassandra.yaml`  &lt;/p&gt;</comment>
                            <comment id="15418743" author="stephanewen" created="Fri, 12 Aug 2016 12:10:44 +0000"  >&lt;p&gt;I am also seeing failures: &lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/151759896/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/151759896/log.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Can the tests be adjusted to validate that Cassandra is properly running before starting anything?&lt;br/&gt;
Possibly have a retry loop starting / validating Cassandra?&lt;/p&gt;</comment>
                            <comment id="15418745" author="stephanewen" created="Fri, 12 Aug 2016 12:11:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; What is your take on this?&lt;/p&gt;</comment>
                            <comment id="15418779" author="zentol" created="Fri, 12 Aug 2016 12:55:29 +0000"  >&lt;p&gt;I don&apos;t think this will fix the issue. While this exception would indeed occur if Cassandra is not running it is much more likely that we just didn&apos;t receive a response in time which can easily happen under heavy load. The embedded Cassandra instance that is started is quite the resource hog; it regularly caused by PC to lockup for a while. I couldn&apos;t fix these with config tweaks ,giving Cassandra time to startup properly or using a different testing infrastructure as i could not find one that is ASF-License compatible.&lt;/p&gt;

&lt;p&gt;As i see it, if we really want to stop these issues we will either have to &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;disable the test&lt;/li&gt;
	&lt;li&gt;mock the hell out of the driver and not work against a real Cassandra instance&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15421271" author="stephanewen" created="Mon, 15 Aug 2016 17:02:51 +0000"  >&lt;p&gt;A few days back we discussing about starting Cassandra in a separate process. That way, at least, it would be less prone to completely starving off the JUnit process.&lt;br/&gt;
Is that option still on the table, or does that also not really help?&lt;/p&gt;</comment>
                            <comment id="15421419" author="zentol" created="Mon, 15 Aug 2016 18:22:00 +0000"  >&lt;p&gt;I wrote my comment a a little bit before our discussion, so it is still on the table &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15476803" author="githubbot" created="Fri, 9 Sep 2016 11:03:26 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4177&quot; title=&quot;CassandraConnectorTest.testCassandraCommitter causing unstable builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4177&quot;&gt;&lt;del&gt;FLINK-4177&lt;/del&gt;&lt;/a&gt; Harden CassandraConnectorTest&lt;/p&gt;

&lt;p&gt;    This PR (hopefully) resolves the instability issues with the Cassandra connector tests.&lt;/p&gt;

&lt;p&gt;    Changelog:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;updated cassandra/driver versions&lt;/li&gt;
	&lt;li&gt;the `cassandra.yaml` was cleaned up&lt;/li&gt;
	&lt;li&gt;removed several configuration values that used the default&lt;/li&gt;
	&lt;li&gt;sorted the remaining settings in alphabetical order&lt;/li&gt;
	&lt;li&gt;the at-least-once sinks were modified to&lt;/li&gt;
	&lt;li&gt;properly log exceptions when close() is called&lt;/li&gt;
	&lt;li&gt;keep track of how many records were not acknowledged yet&lt;/li&gt;
	&lt;li&gt;the tests were modified to&lt;/li&gt;
	&lt;li&gt;start the embedded cassandra instance in a separate process&lt;/li&gt;
	&lt;li&gt;and supply an array of performance related jvm arguments, taken from the cassandra repo&lt;/li&gt;
	&lt;li&gt;no longer truncate tables; instead every test uses a separate table&lt;/li&gt;
	&lt;li&gt;wait until a connection could be established to cassandra in a retry-loop instead of waiting for a fixed time&lt;/li&gt;
	&lt;li&gt;no longer run actual flink jobs&lt;/li&gt;
	&lt;li&gt;use increased timeouts&lt;/li&gt;
	&lt;li&gt;clean up temporary files&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; cass_tmp&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2484&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 64b125343839788530729a2119d1dc92e50e849a&lt;br/&gt;
Author: zentol &amp;lt;chesnay@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-09-05T09:03:00Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4177&quot; title=&quot;CassandraConnectorTest.testCassandraCommitter causing unstable builds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4177&quot;&gt;&lt;del&gt;FLINK-4177&lt;/del&gt;&lt;/a&gt; Harden CassandraConnectorTest&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15516270" author="githubbot" created="Fri, 23 Sep 2016 12:12:56 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484#discussion_r79462622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484#discussion_r79462622&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-cassandra/src/test/java/org/apache/flink/streaming/connectors/cassandra/CassandraConnectorITCase.java &amp;#8212;&lt;br/&gt;
    @@ -178,89 +166,122 @@ public static void startCassandra() throws IOException {&lt;br/&gt;
     		}&lt;br/&gt;
     		scanner.close();&lt;/p&gt;

&lt;p&gt;    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Tell cassandra where the configuration files are.&lt;/li&gt;
	&lt;li&gt;// Use the test configuration file.&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;cassandra.config&quot;, tmp.getAbsoluteFile().toURI().toString());&lt;br/&gt;
    -&lt;br/&gt;
     		if (EMBEDDED) {&lt;/li&gt;
	&lt;li&gt;cassandra = new EmbeddedCassandraService();&lt;/li&gt;
	&lt;li&gt;cassandra.start();&lt;br/&gt;
    +			String javaCommand = getJavaCommandPath();&lt;br/&gt;
    +&lt;br/&gt;
    +			// create a logging file for the process&lt;br/&gt;
    +			File tempLogFile = File.createTempFile(&quot;testlogconfig&quot;, &quot;properties&quot;);&lt;br/&gt;
    +			CommonTestUtils.printLog4jDebugConfig(tempLogFile);&lt;br/&gt;
    +&lt;br/&gt;
    +			// start the task manager process&lt;br/&gt;
    +			String[] command = new String[]
{
    +				javaCommand,
    +				&quot;-Dlog.level=DEBUG&quot;,
    +				&quot;-Dlog4j.configuration=file:&quot; + tempLogFile.getAbsolutePath(),
    +				&quot;-Dcassandra.config=&quot; + tmp.toURI(),
    +				// these options were taken directly from the jvm.options file in the cassandra repo
    +				&quot;-XX:+UseThreadPriorities&quot;,
    +				&quot;-Xss256k&quot;,
    +				&quot;-XX:+AlwaysPreTouch&quot;,
    +				&quot;-XX:+UseTLAB&quot;,
    +				&quot;-XX:+ResizeTLAB&quot;,
    +				&quot;-XX:+UseNUMA&quot;,
    +				&quot;-XX:+PerfDisableSharedMem&quot;,
    +				&quot;-XX:+UseParNewGC&quot;,
    +				&quot;-XX:+UseConcMarkSweepGC&quot;,
    +				&quot;-XX:+CMSParallelRemarkEnabled&quot;,
    +				&quot;-XX:SurvivorRatio=8&quot;,
    +				&quot;-XX:MaxTenuringThreshold=1&quot;,
    +				&quot;-XX:CMSInitiatingOccupancyFraction=75&quot;,
    +				&quot;-XX:+UseCMSInitiatingOccupancyOnly&quot;,
    +				&quot;-XX:CMSWaitDuration=10000&quot;,
    +				&quot;-XX:+CMSParallelInitialMarkEnabled&quot;,
    +				&quot;-XX:+CMSEdenChunksRecordAlways&quot;,
    +				&quot;-XX:+CMSClassUnloadingEnabled&quot;,
    +
    +				&quot;-classpath&quot;, getCurrentClasspath(),
    +				EmbeddedCassandraService.class.getName()
    +			}
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +			ProcessBuilder bld = new ProcessBuilder(command);&lt;br/&gt;
    +			cassandra = bld.start();&lt;br/&gt;
    +			sw = new StringWriter();&lt;br/&gt;
    +			new PipeForwarder(cassandra.getErrorStream(), sw);&lt;br/&gt;
     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
    -			Thread.sleep(1000 * 10);
    -		}
&lt;p&gt; catch (InterruptedException e) { //give cassandra a few seconds to start up&lt;br/&gt;
    +		int attempt = 0;&lt;br/&gt;
    +		while (true) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				attempt++;
    +				cluster = builder.getCluster();
    +				session = cluster.connect();
    +				break;
    +			}
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
    +				if (attempt &amp;gt; 30) &lt;/p&gt;
{
    +					throw e;
    +				}
&lt;p&gt;    +				try {&lt;br/&gt;
    +					Thread.sleep(1000);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    It is not guaranteed that this actually waits as long as it is set, so a good strategy is actually to have a `while` loop with a deadline, rather than a fix number of attempts and a sleep.&lt;/p&gt;</comment>
                            <comment id="15516271" author="githubbot" created="Fri, 23 Sep 2016 12:12:56 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484#discussion_r79463411&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484#discussion_r79463411&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-cassandra/src/test/java/org/apache/flink/streaming/connectors/cassandra/CassandraConnectorITCase.java &amp;#8212;&lt;br/&gt;
    @@ -178,89 +166,122 @@ public static void startCassandra() throws IOException {&lt;br/&gt;
     		}&lt;br/&gt;
     		scanner.close();&lt;/p&gt;

&lt;p&gt;    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Tell cassandra where the configuration files are.&lt;/li&gt;
	&lt;li&gt;// Use the test configuration file.&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;cassandra.config&quot;, tmp.getAbsoluteFile().toURI().toString());&lt;br/&gt;
    -&lt;br/&gt;
     		if (EMBEDDED) {&lt;/li&gt;
	&lt;li&gt;cassandra = new EmbeddedCassandraService();&lt;/li&gt;
	&lt;li&gt;cassandra.start();&lt;br/&gt;
    +			String javaCommand = getJavaCommandPath();&lt;br/&gt;
    +&lt;br/&gt;
    +			// create a logging file for the process&lt;br/&gt;
    +			File tempLogFile = File.createTempFile(&quot;testlogconfig&quot;, &quot;properties&quot;);&lt;br/&gt;
    +			CommonTestUtils.printLog4jDebugConfig(tempLogFile);&lt;br/&gt;
    +&lt;br/&gt;
    +			// start the task manager process&lt;br/&gt;
    +			String[] command = new String[]
{
    +				javaCommand,
    +				&quot;-Dlog.level=DEBUG&quot;,
    +				&quot;-Dlog4j.configuration=file:&quot; + tempLogFile.getAbsolutePath(),
    +				&quot;-Dcassandra.config=&quot; + tmp.toURI(),
    +				// these options were taken directly from the jvm.options file in the cassandra repo
    +				&quot;-XX:+UseThreadPriorities&quot;,
    +				&quot;-Xss256k&quot;,
    +				&quot;-XX:+AlwaysPreTouch&quot;,
    +				&quot;-XX:+UseTLAB&quot;,
    +				&quot;-XX:+ResizeTLAB&quot;,
    +				&quot;-XX:+UseNUMA&quot;,
    +				&quot;-XX:+PerfDisableSharedMem&quot;,
    +				&quot;-XX:+UseParNewGC&quot;,
    +				&quot;-XX:+UseConcMarkSweepGC&quot;,
    +				&quot;-XX:+CMSParallelRemarkEnabled&quot;,
    +				&quot;-XX:SurvivorRatio=8&quot;,
    +				&quot;-XX:MaxTenuringThreshold=1&quot;,
    +				&quot;-XX:CMSInitiatingOccupancyFraction=75&quot;,
    +				&quot;-XX:+UseCMSInitiatingOccupancyOnly&quot;,
    +				&quot;-XX:CMSWaitDuration=10000&quot;,
    +				&quot;-XX:+CMSParallelInitialMarkEnabled&quot;,
    +				&quot;-XX:+CMSEdenChunksRecordAlways&quot;,
    +				&quot;-XX:+CMSClassUnloadingEnabled&quot;,
    +
    +				&quot;-classpath&quot;, getCurrentClasspath(),
    +				EmbeddedCassandraService.class.getName()
    +			}
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +			ProcessBuilder bld = new ProcessBuilder(command);&lt;br/&gt;
    +			cassandra = bld.start();&lt;br/&gt;
    +			sw = new StringWriter();&lt;br/&gt;
    +			new PipeForwarder(cassandra.getErrorStream(), sw);&lt;br/&gt;
     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
    -			Thread.sleep(1000 * 10);
    -		}
&lt;p&gt; catch (InterruptedException e) { //give cassandra a few seconds to start up&lt;br/&gt;
    +		int attempt = 0;&lt;br/&gt;
    +		while (true) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				attempt++;
    +				cluster = builder.getCluster();
    +				session = cluster.connect();
    +				break;
    +			}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				if (attempt &amp;gt; 30) {
    +					throw e;
    +				}    +				try {
    +					Thread.sleep(1000);
    +				} catch (InterruptedException e1) {
    +				}    +			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;     		}&lt;br/&gt;
    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;cluster = builder.getCluster();&lt;/li&gt;
	&lt;li&gt;session = cluster.connect();&lt;br/&gt;
    +		LOG.debug(&quot;Connection established after &quot; + attempt + &quot; attempts.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		session.execute(CREATE_KEYSPACE_QUERY);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;session.execute(CREATE_TABLE_QUERY);&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;@BeforeClass&lt;/li&gt;
	&lt;li&gt;public static void startFlink() throws Exception {&lt;/li&gt;
	&lt;li&gt;Configuration config = new Configuration();&lt;/li&gt;
	&lt;li&gt;config.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS, 4);&lt;br/&gt;
    +		session.execute(CREATE_TABLE_QUERY.replace(&quot;$TABLE&quot;, &quot;flink_initial&quot;));&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkCluster = new ForkableFlinkMiniCluster(config);&lt;/li&gt;
	&lt;li&gt;flinkCluster.start();&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			Thread.sleep(5000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Fix time sleeps usually result in a mix of long build times (value is large) and instability (value is sometimes not large enough). Can one do a polling scheme here, that checks if the statement is completed?&lt;/p&gt;</comment>
                            <comment id="15516272" author="githubbot" created="Fri, 23 Sep 2016 12:12:56 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484#discussion_r79462214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484#discussion_r79462214&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-cassandra/src/test/java/org/apache/flink/streaming/connectors/cassandra/CassandraConnectorITCase.java &amp;#8212;&lt;br/&gt;
    @@ -178,89 +166,122 @@ public static void startCassandra() throws IOException {&lt;br/&gt;
     		}&lt;br/&gt;
     		scanner.close();&lt;/p&gt;

&lt;p&gt;    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Tell cassandra where the configuration files are.&lt;/li&gt;
	&lt;li&gt;// Use the test configuration file.&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;cassandra.config&quot;, tmp.getAbsoluteFile().toURI().toString());&lt;br/&gt;
    -&lt;br/&gt;
     		if (EMBEDDED) {&lt;/li&gt;
	&lt;li&gt;cassandra = new EmbeddedCassandraService();&lt;/li&gt;
	&lt;li&gt;cassandra.start();&lt;br/&gt;
    +			String javaCommand = getJavaCommandPath();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    There is the `TestJvmProcess` class that encapsulates much behavior, including log forwarding. Did that not work here?&lt;/p&gt;</comment>
                            <comment id="15516276" author="githubbot" created="Fri, 23 Sep 2016 12:14:35 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484#discussion_r80232630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484#discussion_r80232630&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-cassandra/src/test/java/org/apache/flink/streaming/connectors/cassandra/CassandraConnectorITCase.java &amp;#8212;&lt;br/&gt;
    @@ -178,89 +166,122 @@ public static void startCassandra() throws IOException {&lt;br/&gt;
     		}&lt;br/&gt;
     		scanner.close();&lt;/p&gt;

&lt;p&gt;    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Tell cassandra where the configuration files are.&lt;/li&gt;
	&lt;li&gt;// Use the test configuration file.&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;cassandra.config&quot;, tmp.getAbsoluteFile().toURI().toString());&lt;br/&gt;
    -&lt;br/&gt;
     		if (EMBEDDED) {&lt;/li&gt;
	&lt;li&gt;cassandra = new EmbeddedCassandraService();&lt;/li&gt;
	&lt;li&gt;cassandra.start();&lt;br/&gt;
    +			String javaCommand = getJavaCommandPath();
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    wasn&apos;t aware of it.&lt;/p&gt;</comment>
                            <comment id="15516291" author="githubbot" created="Fri, 23 Sep 2016 12:19:53 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484#discussion_r80233334&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484#discussion_r80233334&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-cassandra/src/test/java/org/apache/flink/streaming/connectors/cassandra/CassandraConnectorITCase.java &amp;#8212;&lt;br/&gt;
    @@ -178,89 +166,122 @@ public static void startCassandra() throws IOException {&lt;br/&gt;
     		}&lt;br/&gt;
     		scanner.close();&lt;/p&gt;

&lt;p&gt;    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Tell cassandra where the configuration files are.&lt;/li&gt;
	&lt;li&gt;// Use the test configuration file.&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;cassandra.config&quot;, tmp.getAbsoluteFile().toURI().toString());&lt;br/&gt;
    -&lt;br/&gt;
     		if (EMBEDDED) {&lt;/li&gt;
	&lt;li&gt;cassandra = new EmbeddedCassandraService();&lt;/li&gt;
	&lt;li&gt;cassandra.start();&lt;br/&gt;
    +			String javaCommand = getJavaCommandPath();&lt;br/&gt;
    +&lt;br/&gt;
    +			// create a logging file for the process&lt;br/&gt;
    +			File tempLogFile = File.createTempFile(&quot;testlogconfig&quot;, &quot;properties&quot;);&lt;br/&gt;
    +			CommonTestUtils.printLog4jDebugConfig(tempLogFile);&lt;br/&gt;
    +&lt;br/&gt;
    +			// start the task manager process&lt;br/&gt;
    +			String[] command = new String[]
{
    +				javaCommand,
    +				&quot;-Dlog.level=DEBUG&quot;,
    +				&quot;-Dlog4j.configuration=file:&quot; + tempLogFile.getAbsolutePath(),
    +				&quot;-Dcassandra.config=&quot; + tmp.toURI(),
    +				// these options were taken directly from the jvm.options file in the cassandra repo
    +				&quot;-XX:+UseThreadPriorities&quot;,
    +				&quot;-Xss256k&quot;,
    +				&quot;-XX:+AlwaysPreTouch&quot;,
    +				&quot;-XX:+UseTLAB&quot;,
    +				&quot;-XX:+ResizeTLAB&quot;,
    +				&quot;-XX:+UseNUMA&quot;,
    +				&quot;-XX:+PerfDisableSharedMem&quot;,
    +				&quot;-XX:+UseParNewGC&quot;,
    +				&quot;-XX:+UseConcMarkSweepGC&quot;,
    +				&quot;-XX:+CMSParallelRemarkEnabled&quot;,
    +				&quot;-XX:SurvivorRatio=8&quot;,
    +				&quot;-XX:MaxTenuringThreshold=1&quot;,
    +				&quot;-XX:CMSInitiatingOccupancyFraction=75&quot;,
    +				&quot;-XX:+UseCMSInitiatingOccupancyOnly&quot;,
    +				&quot;-XX:CMSWaitDuration=10000&quot;,
    +				&quot;-XX:+CMSParallelInitialMarkEnabled&quot;,
    +				&quot;-XX:+CMSEdenChunksRecordAlways&quot;,
    +				&quot;-XX:+CMSClassUnloadingEnabled&quot;,
    +
    +				&quot;-classpath&quot;, getCurrentClasspath(),
    +				EmbeddedCassandraService.class.getName()
    +			}
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +			ProcessBuilder bld = new ProcessBuilder(command);&lt;br/&gt;
    +			cassandra = bld.start();&lt;br/&gt;
    +			sw = new StringWriter();&lt;br/&gt;
    +			new PipeForwarder(cassandra.getErrorStream(), sw);&lt;br/&gt;
     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
    -			Thread.sleep(1000 * 10);
    -		}
&lt;p&gt; catch (InterruptedException e) { //give cassandra a few seconds to start up&lt;br/&gt;
    +		int attempt = 0;&lt;br/&gt;
    +		while (true) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				attempt++;
    +				cluster = builder.getCluster();
    +				session = cluster.connect();
    +				break;
    +			}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				if (attempt &amp;gt; 30) {
    +					throw e;
    +				}    +				try {
    +					Thread.sleep(1000);
    +				} catch (InterruptedException e1) {
    +				}    +			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;     		}&lt;br/&gt;
    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;cluster = builder.getCluster();&lt;/li&gt;
	&lt;li&gt;session = cluster.connect();&lt;br/&gt;
    +		LOG.debug(&quot;Connection established after &quot; + attempt + &quot; attempts.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		session.execute(CREATE_KEYSPACE_QUERY);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;session.execute(CREATE_TABLE_QUERY);&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;@BeforeClass&lt;/li&gt;
	&lt;li&gt;public static void startFlink() throws Exception {&lt;/li&gt;
	&lt;li&gt;Configuration config = new Configuration();&lt;/li&gt;
	&lt;li&gt;config.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS, 4);&lt;br/&gt;
    +		session.execute(CREATE_TABLE_QUERY.replace(&quot;$TABLE&quot;, &quot;flink_initial&quot;));&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkCluster = new ForkableFlinkMiniCluster(config);&lt;/li&gt;
	&lt;li&gt;flinkCluster.start();&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			Thread.sleep(5000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    the execute() call is synchronous, it&apos;s not about making sure that it is complete. I just found that giving Cassandra a bit of time after creating the keyspace and the first table resulted in a higher stability.&lt;/p&gt;</comment>
                            <comment id="15516301" author="githubbot" created="Fri, 23 Sep 2016 12:25:01 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484#discussion_r80233989&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484#discussion_r80233989&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-cassandra/src/test/java/org/apache/flink/streaming/connectors/cassandra/CassandraConnectorITCase.java &amp;#8212;&lt;br/&gt;
    @@ -178,89 +166,122 @@ public static void startCassandra() throws IOException {&lt;br/&gt;
     		}&lt;br/&gt;
     		scanner.close();&lt;/p&gt;

&lt;p&gt;    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Tell cassandra where the configuration files are.&lt;/li&gt;
	&lt;li&gt;// Use the test configuration file.&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;cassandra.config&quot;, tmp.getAbsoluteFile().toURI().toString());&lt;br/&gt;
    -&lt;br/&gt;
     		if (EMBEDDED) {&lt;/li&gt;
	&lt;li&gt;cassandra = new EmbeddedCassandraService();&lt;/li&gt;
	&lt;li&gt;cassandra.start();&lt;br/&gt;
    +			String javaCommand = getJavaCommandPath();&lt;br/&gt;
    +&lt;br/&gt;
    +			// create a logging file for the process&lt;br/&gt;
    +			File tempLogFile = File.createTempFile(&quot;testlogconfig&quot;, &quot;properties&quot;);&lt;br/&gt;
    +			CommonTestUtils.printLog4jDebugConfig(tempLogFile);&lt;br/&gt;
    +&lt;br/&gt;
    +			// start the task manager process&lt;br/&gt;
    +			String[] command = new String[]
{
    +				javaCommand,
    +				&quot;-Dlog.level=DEBUG&quot;,
    +				&quot;-Dlog4j.configuration=file:&quot; + tempLogFile.getAbsolutePath(),
    +				&quot;-Dcassandra.config=&quot; + tmp.toURI(),
    +				// these options were taken directly from the jvm.options file in the cassandra repo
    +				&quot;-XX:+UseThreadPriorities&quot;,
    +				&quot;-Xss256k&quot;,
    +				&quot;-XX:+AlwaysPreTouch&quot;,
    +				&quot;-XX:+UseTLAB&quot;,
    +				&quot;-XX:+ResizeTLAB&quot;,
    +				&quot;-XX:+UseNUMA&quot;,
    +				&quot;-XX:+PerfDisableSharedMem&quot;,
    +				&quot;-XX:+UseParNewGC&quot;,
    +				&quot;-XX:+UseConcMarkSweepGC&quot;,
    +				&quot;-XX:+CMSParallelRemarkEnabled&quot;,
    +				&quot;-XX:SurvivorRatio=8&quot;,
    +				&quot;-XX:MaxTenuringThreshold=1&quot;,
    +				&quot;-XX:CMSInitiatingOccupancyFraction=75&quot;,
    +				&quot;-XX:+UseCMSInitiatingOccupancyOnly&quot;,
    +				&quot;-XX:CMSWaitDuration=10000&quot;,
    +				&quot;-XX:+CMSParallelInitialMarkEnabled&quot;,
    +				&quot;-XX:+CMSEdenChunksRecordAlways&quot;,
    +				&quot;-XX:+CMSClassUnloadingEnabled&quot;,
    +
    +				&quot;-classpath&quot;, getCurrentClasspath(),
    +				EmbeddedCassandraService.class.getName()
    +			}
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +			ProcessBuilder bld = new ProcessBuilder(command);&lt;br/&gt;
    +			cassandra = bld.start();&lt;br/&gt;
    +			sw = new StringWriter();&lt;br/&gt;
    +			new PipeForwarder(cassandra.getErrorStream(), sw);&lt;br/&gt;
     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
    -			Thread.sleep(1000 * 10);
    -		}
&lt;p&gt; catch (InterruptedException e) { //give cassandra a few seconds to start up&lt;br/&gt;
    +		int attempt = 0;&lt;br/&gt;
    +		while (true) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				attempt++;
    +				cluster = builder.getCluster();
    +				session = cluster.connect();
    +				break;
    +			}
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
    +				if (attempt &amp;gt; 30) &lt;/p&gt;
{
    +					throw e;
    +				}
&lt;p&gt;    +				try {&lt;br/&gt;
    +					Thread.sleep(1000);&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    that&apos;s true, will change it.&lt;/p&gt;</comment>
                            <comment id="15516321" author="githubbot" created="Fri, 23 Sep 2016 12:32:50 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484#discussion_r80235122&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484#discussion_r80235122&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-cassandra/src/test/java/org/apache/flink/streaming/connectors/cassandra/CassandraConnectorITCase.java &amp;#8212;&lt;br/&gt;
    @@ -178,89 +166,122 @@ public static void startCassandra() throws IOException {&lt;br/&gt;
     		}&lt;br/&gt;
     		scanner.close();&lt;/p&gt;

&lt;p&gt;    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Tell cassandra where the configuration files are.&lt;/li&gt;
	&lt;li&gt;// Use the test configuration file.&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;cassandra.config&quot;, tmp.getAbsoluteFile().toURI().toString());&lt;br/&gt;
    -&lt;br/&gt;
     		if (EMBEDDED) {&lt;/li&gt;
	&lt;li&gt;cassandra = new EmbeddedCassandraService();&lt;/li&gt;
	&lt;li&gt;cassandra.start();&lt;br/&gt;
    +			String javaCommand = getJavaCommandPath();&lt;br/&gt;
    +&lt;br/&gt;
    +			// create a logging file for the process&lt;br/&gt;
    +			File tempLogFile = File.createTempFile(&quot;testlogconfig&quot;, &quot;properties&quot;);&lt;br/&gt;
    +			CommonTestUtils.printLog4jDebugConfig(tempLogFile);&lt;br/&gt;
    +&lt;br/&gt;
    +			// start the task manager process&lt;br/&gt;
    +			String[] command = new String[]
{
    +				javaCommand,
    +				&quot;-Dlog.level=DEBUG&quot;,
    +				&quot;-Dlog4j.configuration=file:&quot; + tempLogFile.getAbsolutePath(),
    +				&quot;-Dcassandra.config=&quot; + tmp.toURI(),
    +				// these options were taken directly from the jvm.options file in the cassandra repo
    +				&quot;-XX:+UseThreadPriorities&quot;,
    +				&quot;-Xss256k&quot;,
    +				&quot;-XX:+AlwaysPreTouch&quot;,
    +				&quot;-XX:+UseTLAB&quot;,
    +				&quot;-XX:+ResizeTLAB&quot;,
    +				&quot;-XX:+UseNUMA&quot;,
    +				&quot;-XX:+PerfDisableSharedMem&quot;,
    +				&quot;-XX:+UseParNewGC&quot;,
    +				&quot;-XX:+UseConcMarkSweepGC&quot;,
    +				&quot;-XX:+CMSParallelRemarkEnabled&quot;,
    +				&quot;-XX:SurvivorRatio=8&quot;,
    +				&quot;-XX:MaxTenuringThreshold=1&quot;,
    +				&quot;-XX:CMSInitiatingOccupancyFraction=75&quot;,
    +				&quot;-XX:+UseCMSInitiatingOccupancyOnly&quot;,
    +				&quot;-XX:CMSWaitDuration=10000&quot;,
    +				&quot;-XX:+CMSParallelInitialMarkEnabled&quot;,
    +				&quot;-XX:+CMSEdenChunksRecordAlways&quot;,
    +				&quot;-XX:+CMSClassUnloadingEnabled&quot;,
    +
    +				&quot;-classpath&quot;, getCurrentClasspath(),
    +				EmbeddedCassandraService.class.getName()
    +			}
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +			ProcessBuilder bld = new ProcessBuilder(command);&lt;br/&gt;
    +			cassandra = bld.start();&lt;br/&gt;
    +			sw = new StringWriter();&lt;br/&gt;
    +			new PipeForwarder(cassandra.getErrorStream(), sw);&lt;br/&gt;
     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
    -			Thread.sleep(1000 * 10);
    -		}
&lt;p&gt; catch (InterruptedException e) { //give cassandra a few seconds to start up&lt;br/&gt;
    +		int attempt = 0;&lt;br/&gt;
    +		while (true) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				attempt++;
    +				cluster = builder.getCluster();
    +				session = cluster.connect();
    +				break;
    +			}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				if (attempt &amp;gt; 30) {
    +					throw e;
    +				}    +				try {
    +					Thread.sleep(1000);
    +				} catch (InterruptedException e1) {
    +				}    +			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;     		}&lt;br/&gt;
    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;cluster = builder.getCluster();&lt;/li&gt;
	&lt;li&gt;session = cluster.connect();&lt;br/&gt;
    +		LOG.debug(&quot;Connection established after &quot; + attempt + &quot; attempts.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		session.execute(CREATE_KEYSPACE_QUERY);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;session.execute(CREATE_TABLE_QUERY);&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;@BeforeClass&lt;/li&gt;
	&lt;li&gt;public static void startFlink() throws Exception {&lt;/li&gt;
	&lt;li&gt;Configuration config = new Configuration();&lt;/li&gt;
	&lt;li&gt;config.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS, 4);&lt;br/&gt;
    +		session.execute(CREATE_TABLE_QUERY.replace(&quot;$TABLE&quot;, &quot;flink_initial&quot;));&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkCluster = new ForkableFlinkMiniCluster(config);&lt;/li&gt;
	&lt;li&gt;flinkCluster.start();&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			Thread.sleep(5000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Can this not be modeled via attempting trying to execute operations on the table? Or is the remaining work not guaranteed to succeed, even if the first table operations succeed?&lt;/p&gt;</comment>
                            <comment id="15516363" author="githubbot" created="Fri, 23 Sep 2016 12:54:44 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484#discussion_r80238252&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484#discussion_r80238252&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-cassandra/src/test/java/org/apache/flink/streaming/connectors/cassandra/CassandraConnectorITCase.java &amp;#8212;&lt;br/&gt;
    @@ -178,89 +166,122 @@ public static void startCassandra() throws IOException {&lt;br/&gt;
     		}&lt;br/&gt;
     		scanner.close();&lt;/p&gt;

&lt;p&gt;    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Tell cassandra where the configuration files are.&lt;/li&gt;
	&lt;li&gt;// Use the test configuration file.&lt;/li&gt;
	&lt;li&gt;System.setProperty(&quot;cassandra.config&quot;, tmp.getAbsoluteFile().toURI().toString());&lt;br/&gt;
    -&lt;br/&gt;
     		if (EMBEDDED) {&lt;/li&gt;
	&lt;li&gt;cassandra = new EmbeddedCassandraService();&lt;/li&gt;
	&lt;li&gt;cassandra.start();&lt;br/&gt;
    +			String javaCommand = getJavaCommandPath();&lt;br/&gt;
    +&lt;br/&gt;
    +			// create a logging file for the process&lt;br/&gt;
    +			File tempLogFile = File.createTempFile(&quot;testlogconfig&quot;, &quot;properties&quot;);&lt;br/&gt;
    +			CommonTestUtils.printLog4jDebugConfig(tempLogFile);&lt;br/&gt;
    +&lt;br/&gt;
    +			// start the task manager process&lt;br/&gt;
    +			String[] command = new String[]
{
    +				javaCommand,
    +				&quot;-Dlog.level=DEBUG&quot;,
    +				&quot;-Dlog4j.configuration=file:&quot; + tempLogFile.getAbsolutePath(),
    +				&quot;-Dcassandra.config=&quot; + tmp.toURI(),
    +				// these options were taken directly from the jvm.options file in the cassandra repo
    +				&quot;-XX:+UseThreadPriorities&quot;,
    +				&quot;-Xss256k&quot;,
    +				&quot;-XX:+AlwaysPreTouch&quot;,
    +				&quot;-XX:+UseTLAB&quot;,
    +				&quot;-XX:+ResizeTLAB&quot;,
    +				&quot;-XX:+UseNUMA&quot;,
    +				&quot;-XX:+PerfDisableSharedMem&quot;,
    +				&quot;-XX:+UseParNewGC&quot;,
    +				&quot;-XX:+UseConcMarkSweepGC&quot;,
    +				&quot;-XX:+CMSParallelRemarkEnabled&quot;,
    +				&quot;-XX:SurvivorRatio=8&quot;,
    +				&quot;-XX:MaxTenuringThreshold=1&quot;,
    +				&quot;-XX:CMSInitiatingOccupancyFraction=75&quot;,
    +				&quot;-XX:+UseCMSInitiatingOccupancyOnly&quot;,
    +				&quot;-XX:CMSWaitDuration=10000&quot;,
    +				&quot;-XX:+CMSParallelInitialMarkEnabled&quot;,
    +				&quot;-XX:+CMSEdenChunksRecordAlways&quot;,
    +				&quot;-XX:+CMSClassUnloadingEnabled&quot;,
    +
    +				&quot;-classpath&quot;, getCurrentClasspath(),
    +				EmbeddedCassandraService.class.getName()
    +			}
&lt;p&gt;;&lt;br/&gt;
    +&lt;br/&gt;
    +			ProcessBuilder bld = new ProcessBuilder(command);&lt;br/&gt;
    +			cassandra = bld.start();&lt;br/&gt;
    +			sw = new StringWriter();&lt;br/&gt;
    +			new PipeForwarder(cassandra.getErrorStream(), sw);&lt;br/&gt;
     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;try 
{
    -			Thread.sleep(1000 * 10);
    -		}
&lt;p&gt; catch (InterruptedException e) { //give cassandra a few seconds to start up&lt;br/&gt;
    +		int attempt = 0;&lt;br/&gt;
    +		while (true) {&lt;br/&gt;
    +			try &lt;/p&gt;
{
    +				attempt++;
    +				cluster = builder.getCluster();
    +				session = cluster.connect();
    +				break;
    +			}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				if (attempt &amp;gt; 30) {
    +					throw e;
    +				}    +				try {
    +					Thread.sleep(1000);
    +				} catch (InterruptedException e1) {
    +				}    +			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;     		}&lt;br/&gt;
    -&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;cluster = builder.getCluster();&lt;/li&gt;
	&lt;li&gt;session = cluster.connect();&lt;br/&gt;
    +		LOG.debug(&quot;Connection established after &quot; + attempt + &quot; attempts.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		session.execute(CREATE_KEYSPACE_QUERY);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;session.execute(CREATE_TABLE_QUERY);&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;@BeforeClass&lt;/li&gt;
	&lt;li&gt;public static void startFlink() throws Exception {&lt;/li&gt;
	&lt;li&gt;Configuration config = new Configuration();&lt;/li&gt;
	&lt;li&gt;config.setInteger(ConfigConstants.TASK_MANAGER_NUM_TASK_SLOTS, 4);&lt;br/&gt;
    +		session.execute(CREATE_TABLE_QUERY.replace(&quot;$TABLE&quot;, &quot;flink_initial&quot;));&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkCluster = new ForkableFlinkMiniCluster(config);&lt;/li&gt;
	&lt;li&gt;flinkCluster.start();&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			Thread.sleep(5000);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I tried that and the results were actually quite interesting.&lt;/p&gt;

&lt;p&gt;    The last issues i dealt with was that fairly regularly the first test that is executed would fail. I could disable one test after another, but the failure would just occur on the test that was now executed first. I figured that Cassandra may not be ready yet to receive data, so i implemented what you suggested: create a table, write a row, and check whether it was written. That thing failed not even once, but sure enough the tests still did.&lt;/p&gt;</comment>
                            <comment id="15564902" author="githubbot" created="Tue, 11 Oct 2016 08:32:45 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Will this pull request fix this build instability? &lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/166508416/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/166508416/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15564932" author="githubbot" created="Tue, 11 Oct 2016 08:51:21 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Probably improves test stability. My feeling is that as long as the issue Chesnay described in the discussion about the &quot;sleep(5000)&quot; remains, we will not have full test stability.&lt;/p&gt;</comment>
                            <comment id="15565062" author="githubbot" created="Tue, 11 Oct 2016 10:02:33 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @rmetzger I did not encounter the issue you linked when i ran the tests, so i would be cautiously optimistic. As Stephan said though i can&apos;t guarantee complete stability.&lt;/p&gt;</comment>
                            <comment id="15629089" author="githubbot" created="Wed, 2 Nov 2016 14:11:03 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StephanEwen I&apos;ve rebased and updated the PR. The tests now use the `TestJvmProcess` class to setup the cassandra instance and have a fixed deadline for the initial connection instead of a fixed number of attempts.&lt;/p&gt;

&lt;p&gt;    I have also removed the `sleep(5000)` statement; i would like to see whether we can get by without it.&lt;/p&gt;</comment>
                            <comment id="15663885" author="githubbot" created="Mon, 14 Nov 2016 13:15:10 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    merging&lt;/p&gt;</comment>
                            <comment id="15663944" author="githubbot" created="Mon, 14 Nov 2016 13:39:58 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2484&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15663948" author="zentol" created="Mon, 14 Nov 2016 13:40:47 +0000"  >&lt;p&gt;Possibly resolved in 62523acbe175cf159fe1b4ab6cf5c0412fc4d232.&lt;/p&gt;</comment>
                            <comment id="15663949" author="zentol" created="Mon, 14 Nov 2016 13:41:05 +0000"  >&lt;p&gt;Possibly resolved in 62523acbe175cf159fe1b4ab6cf5c0412fc4d232.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30p2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>