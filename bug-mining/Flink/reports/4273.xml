<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-18214] Incorrect warning if jobstore.cache-size exceeds heap size</title>
                <link>https://issues.apache.org/jira/browse/FLINK-18214</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The logging parameters are mixed up.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
The configured or derived JVM heap memory size (jobstore.cache-size: 128.000mb (134217728 bytes)) is less than the configured or &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; size of the job store cache (jobmanager.memory.heap.size: 1.000gb (1073741825 bytes))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13310371">FLINK-18214</key>
            <summary>Incorrect warning if jobstore.cache-size exceeds heap size</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="azagrebin">Andrey Zagrebin</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 9 Jun 2020 11:39:59 +0000</created>
                <updated>Thu, 11 Jun 2020 07:37:27 +0000</updated>
                            <resolved>Thu, 11 Jun 2020 07:37:27 +0000</resolved>
                                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Runtime / Configuration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17129175" author="nicholasjiang" created="Tue, 9 Jun 2020 11:44:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; This bug has already fixed in &lt;a href=&quot;https://github.com/apache/flink/pull/12516&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Jobstore size check compares against offHeapMemory title&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17129182" author="zentol" created="Tue, 9 Jun 2020 11:52:35 +0000"  >&lt;p&gt;Related: if we exceed the heap memory we should probably fail early.&lt;/p&gt;</comment>
                            <comment id="17129183" author="zentol" created="Tue, 9 Jun 2020 11:54:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicholasjiang&quot; class=&quot;user-hover&quot; rel=&quot;nicholasjiang&quot;&gt;nicholasjiang&lt;/a&gt; Yes, I think you&apos;re right.&lt;/p&gt;</comment>
                            <comment id="17129196" author="nicholasjiang" created="Tue, 9 Jun 2020 12:04:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;, therefore, if this pull request is merged, could this issue close?&lt;/p&gt;</comment>
                            <comment id="17129212" author="zentol" created="Tue, 9 Jun 2020 12:13:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicholasjiang&quot; class=&quot;user-hover&quot; rel=&quot;nicholasjiang&quot;&gt;nicholasjiang&lt;/a&gt; Not necessarily; it might also make sense to fail early in this case.&lt;/p&gt;</comment>
                            <comment id="17129365" author="azagrebin" created="Tue, 9 Jun 2020 14:56:12 +0000"  >&lt;p&gt;The size of the cached jobs cannot really be calculated. Hence we only estimate the size of the jobs.&lt;/p&gt;

&lt;p&gt;The job cache size is more of a soft threshold anyways and we cannot guarantee that we use at most this amount of memory.&lt;/p&gt;

&lt;p&gt;So the earlier agreement was to not fail but warn.&lt;/p&gt;

&lt;p&gt;Therefore, I suggest to close the issue.&lt;/p&gt;</comment>
                            <comment id="17129387" author="zentol" created="Tue, 9 Jun 2020 15:17:51 +0000"  >&lt;p&gt;Then the option is rather misleading; the description explicitly says &lt;tt&gt;&quot;The job store cache size in bytes which is used to keep completed jobs in memory.&quot;&lt;/tt&gt; and the current error message just reinforces this wrong interpretation.&lt;br/&gt;
It also doesn&apos;t mention what the consequences are; will this just lead to some jobs being evicted earlier? (no) can this crash the cluster? (answer: &lt;b&gt;yes&lt;/b&gt;).&lt;/p&gt;

&lt;p&gt;The documentation is then also wrong, on both counts to boost:&lt;br/&gt;
&lt;tt&gt;The Job cache resides in the JVM Heap. It can be configured by jobstore.cache-size which must be less than the configured or derived JVM Heap size.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;How good of an estimate is it for actual jobs? For what size of a job is the estimate correct?&lt;/p&gt;

&lt;p&gt;As is stands, a user who uses this option will assume that this provides some form of assurance that the cache will not impact the job execution. But this is simply not the case.&lt;/p&gt;

&lt;p&gt;I appreciate the difficulty of nailing down the cache size of in-memory objects, but if we can&apos;t do that reliably, we have to document that.&lt;/p&gt;</comment>
                            <comment id="17129398" author="azagrebin" created="Tue, 9 Jun 2020 15:32:01 +0000"  >&lt;p&gt;True, we can improve the docs. I guess I also got into the same trap of option description.&lt;/p&gt;</comment>
                            <comment id="17130765" author="azagrebin" created="Wed, 10 Jun 2020 15:02:16 +0000"  >&lt;p&gt;The offline conclusion (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azagrebin&quot; class=&quot;user-hover&quot; rel=&quot;azagrebin&quot;&gt;azagrebin&lt;/a&gt; ) is to remove the check as it may be inconclusive and confusing for the users.&lt;br/&gt;
The job cache size option does not strictly limit the real size and stays an advanced emergency mean.&lt;/p&gt;

&lt;p&gt;Therefore, I will submit a PR to remove the related code from&#160;JobManagerProcessUtils, tests and memory tune guide.&lt;/p&gt;</comment>
                            <comment id="17133009" author="azagrebin" created="Thu, 11 Jun 2020 07:37:27 +0000"  >&lt;p&gt;merged into master by&#160;1adfd582c5ca8d90b71557d38463eddddcf94c0b&lt;/p&gt;

&lt;p&gt;merged into 1.11 by 3ca7fe0b69b906ab54d3cdbe79643421536321e0&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                            <outwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13309706">FLINK-18157</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310460">
                    <name>Child-Issue</name>
                                                                <inwardlinks description="is a child of">
                                        <issuelink>
            <issuekey id="13307733">FLINK-17973</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0fo1s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>