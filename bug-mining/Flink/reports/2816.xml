<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:38:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-11085] NoClassDefFoundError in presto-s3 filesystem</title>
                <link>https://issues.apache.org/jira/browse/FLINK-11085</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A user has reporter an issue on the ML where using the presto-s3 filesystem fails with an exception due to a missing class. The missing class is indeed filtered out in the shade-plugin configuration.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NoClassDefFoundError: org/apache/flink/fs/s3presto/shaded/com/facebook/presto/hadoop/HadoopFileStatus
	at org.apache.flink.fs.s3presto.shaded.com.facebook.presto.hive.PrestoS3FileSystem.directory(PrestoS3FileSystem.java:446)
	at org.apache.flink.fs.s3presto.shaded.com.facebook.presto.hive.PrestoS3FileSystem.delete(PrestoS3FileSystem.java:423)
	at org.apache.flink.fs.s3.common.hadoop.HadoopFileSystem.delete(HadoopFileSystem.java:147)
	at org.apache.flink.runtime.state.filesystem.FileStateHandle.discardState(FileStateHandle.java:80)
	at org.apache.flink.runtime.checkpoint.CompletedCheckpoint.doDiscard(CompletedCheckpoint.java:250)
	at org.apache.flink.runtime.checkpoint.CompletedCheckpoint.discardOnSubsume(CompletedCheckpoint.java:219)
	at org.apache.flink.runtime.checkpoint.StandaloneCompletedCheckpointStore.addCheckpoint(StandaloneCompletedCheckpointStore.java:72)
	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.completePendingCheckpoint(CheckpointCoordinator.java:844)
	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.receiveAcknowledgeMessage(CheckpointCoordinator.java:756)
	at org.apache.flink.runtime.jobmaster.JobMaster.lambda$acknowledgeCheckpoint$8(JobMaster.java:680)
	at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:39)
	at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:415)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13202798">FLINK-11085</key>
            <summary>NoClassDefFoundError in presto-s3 filesystem</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 6 Dec 2018 13:17:39 +0000</created>
                <updated>Wed, 2 Oct 2019 17:47:41 +0000</updated>
                            <resolved>Wed, 12 Dec 2018 15:00:41 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.1</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>FileSystems</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16711433" author="zentol" created="Thu, 6 Dec 2018 13:23:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; What&apos;s your take on this?&lt;/p&gt;</comment>
                            <comment id="16711900" author="stephanewen" created="Thu, 6 Dec 2018 19:15:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; The class is not filtered out, the filter defines an inclusion rule for that artifact.&lt;/p&gt;</comment>
                            <comment id="16712667" author="spoganshev" created="Fri, 7 Dec 2018 11:04:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; Yes, the inclusion rule is there, but flink-s3-fs-presto-1.7.0.jar does not contain&#160;org/apache/flink/fs/s3presto/shaded/com/facebook/presto/hadoop package:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12950975/12950975_image-2018-12-07-13-04-06-563.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16712815" author="zentol" created="Fri, 7 Dec 2018 12:51:12 +0000"  >&lt;p&gt;indeed, it is an include filter, but for some reason it &lt;em&gt;is&lt;/em&gt; preventing anything from being included. If I remove it the entire jar is included :/&lt;/p&gt;

&lt;p&gt;Even if I remove all other filters and relocations it is &lt;em&gt;still&lt;/em&gt; not included. I&apos;ll investigate more.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;On a related note, this issue was not detected due to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11100&quot; title=&quot;Presto S3 FileSystem E2E test broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11100&quot;&gt;&lt;del&gt;FLINK-11100&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16712826" author="zentol" created="Fri, 7 Dec 2018 13:00:45 +0000"  >&lt;p&gt;Small correction on my part, if the following filter section is removed is packaged correctly.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &amp;lt;filter&amp;gt;
      &amp;lt;artifact&amp;gt;*&amp;lt;/artifact&amp;gt;
      &amp;lt;excludes&amp;gt;
         &amp;lt;exclude&amp;gt;META-INF/maven/org.weakref/**&amp;lt;/exclude&amp;gt;
         &amp;lt;exclude&amp;gt;META-INF/maven/org.hdrhistogram/**&amp;lt;/exclude&amp;gt;
         &amp;lt;exclude&amp;gt;META-INF/maven/joda-time/**&amp;lt;/exclude&amp;gt;
         &amp;lt;exclude&amp;gt;META-INF/maven/io.airlift/**&amp;lt;/exclude&amp;gt;
         &amp;lt;exclude&amp;gt;META-INF/maven/com*/**&amp;lt;/exclude&amp;gt;
         &amp;lt;exclude&amp;gt;META-INF/maven/org.apache.flink/force-shading/**&amp;lt;/exclude&amp;gt;
         &amp;lt;exclude&amp;gt;META-INF/LICENSE.txt&amp;lt;/exclude&amp;gt;
      &amp;lt;/excludes&amp;gt;
   &amp;lt;/filter&amp;gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16712850" author="githubbot" created="Fri, 7 Dec 2018 13:24:11 +0000"  >&lt;p&gt;zentol opened a new pull request #7261: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11085&quot; title=&quot;NoClassDefFoundError in presto-s3 filesystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11085&quot;&gt;&lt;del&gt;FLINK-11085&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;s3&amp;#93;&lt;/span&gt; Fix inclusion of presto hadoop classes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7261&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This PR fixes the bundling of hadoop classes from `com.facebook.presto.hadoop:hadoop-apache2` in the presto-s3 filesystem module.&lt;/p&gt;

&lt;p&gt;   As of right now I do not really know why this fixes the issue, but intend to file an issue with MSHADE.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;reorder filter definitions&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Manually verified. Ensure that `org\apache\flink\fs\s3presto\shaded\com\facebook\presto\hadoop\` is contained in the jar, and no other contents from this jar are included (for example, `nativelib`).&lt;/p&gt;

&lt;p&gt;   Optionally you can also run the presto e2e test if you also include the commits from &lt;a href=&quot;https://github.com/zentol/flink/tree/11100&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink/tree/11100&lt;/a&gt;.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16717447" author="githubbot" created="Tue, 11 Dec 2018 16:10:02 +0000"  >&lt;p&gt;zentol commented on issue #7261: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11085&quot; title=&quot;NoClassDefFoundError in presto-s3 filesystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11085&quot;&gt;&lt;del&gt;FLINK-11085&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;s3&amp;#93;&lt;/span&gt; Fix inclusion of presto hadoop classes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7261#issuecomment-446259203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7261#issuecomment-446259203&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I believe I finally figured it out. This is a bug in the shade-plugin where it merges filters defined in parent/child poms by index, and not by artifact id.&lt;br/&gt;
   So, the &lt;em&gt;second&lt;/em&gt; filter in the parent pom defines an exclusion for &lt;em&gt;all&lt;/em&gt; classes, and the &lt;em&gt;second&lt;/em&gt; filter in the presto pom defines *&lt;b&gt;no exclusion&lt;/b&gt;*. As a result it &lt;em&gt;inherits&lt;/em&gt; the exclusion from the &lt;em&gt;second&lt;/em&gt; filter in the parent pom, excluding all classes.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16718766" author="githubbot" created="Wed, 12 Dec 2018 10:50:34 +0000"  >&lt;p&gt;zentol commented on issue #7261: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11085&quot; title=&quot;NoClassDefFoundError in presto-s3 filesystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11085&quot;&gt;&lt;del&gt;FLINK-11085&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;s3&amp;#93;&lt;/span&gt; Fix inclusion of presto hadoop classes&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7261#issuecomment-446544953&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7261#issuecomment-446544953&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I have confirmed by theory and opened &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-305&quot; title=&quot;Filters are merged by index, not by artifactId&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-305&quot;&gt;&lt;del&gt;MSHADE-305&lt;/del&gt;&lt;/a&gt;. In the meantime we can simply disable the merging of filters, and instead default to appending them.&lt;/p&gt;

&lt;p&gt;   Only `flink-fs-s3-presto` should be affected by this in a significant way, as it is the only module that used inclusion filters, leaving room for an exclusion filter to be inherited that impacts the packaging.&lt;/p&gt;

&lt;p&gt;   For the remaining modules,&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;if no filter was defined the module was not affected at all as the parent filters are inherited as is&lt;/li&gt;
	&lt;li&gt;if a filter was defined all parent filters were disabled. They were neither appended, nor could be merged as both the parent and child filters defined exclusions, and these (apparently) are overridden by children by default.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16719056" author="till.rohrmann" created="Wed, 12 Dec 2018 15:00:42 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
1.8.0: &lt;a href=&quot;https://github.com/apache/flink/commit/ea8373e05048ad9dc2a42a2f8d10a9049559e975&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/ea8373e05048ad9dc2a42a2f8d10a9049559e975&lt;/a&gt;&lt;br/&gt;
1.7.1: &lt;a href=&quot;https://github.com/apache/flink/commit/4ab682bd76ecaa5fef67b077880665b5d86b03c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/4ab682bd76ecaa5fef67b077880665b5d86b03c2&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13203955">MSHADE-305</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13185761">FLINK-10366</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13203023">FLINK-11100</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12950975" name="image-2018-12-07-13-04-06-563.png" size="64314" author="spoganshev" created="Fri, 7 Dec 2018 11:04:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s018p4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>