<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4482] numUnsuccessfulCheckpointsTriggers is accessed without holding triggerLock</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4482</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In CheckpointCoordinator#stopCheckpointScheduler() :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (lock) {
...
      numUnsuccessfulCheckpointsTriggers = 0;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;triggerLock is not held in the above operation.&lt;br/&gt;
See comment for triggerLock earlier in triggerCheckpoint():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-comment&quot;&gt;// we lock with a special lock to make sure that trigger requests &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not overtake each other.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is not done with the coordinator-wide lock, because the &lt;span class=&quot;code-quote&quot;&gt;&apos;checkpointIdCounter&apos;&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// may issue blocking operations. Using a different lock than teh coordinator-wide lock,
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// we avoid blocking the processing of &lt;span class=&quot;code-quote&quot;&gt;&apos;acknowledge/decline&apos;&lt;/span&gt; messages during that time.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (triggerLock) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12999846">FLINK-4482</key>
            <summary>numUnsuccessfulCheckpointsTriggers is accessed without holding triggerLock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Aug 2016 23:07:05 +0000</created>
                <updated>Wed, 2 Oct 2019 17:45:26 +0000</updated>
                            <resolved>Fri, 23 Sep 2016 17:17:03 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15437274" author="stephanewen" created="Thu, 25 Aug 2016 17:21:29 +0000"  >&lt;p&gt;I think the statements can be adjusted to be properly locked.&lt;/p&gt;

&lt;p&gt;How about adding some &lt;tt&gt;GuardedBy&lt;/tt&gt; annotations and adding the maven &quot;findbugs&quot; plugin to check such situations automatically?&lt;/p&gt;</comment>
                            <comment id="15437383" author="githubbot" created="Thu, 25 Aug 2016 18:17:46 +0000"  >&lt;p&gt;GitHub user tedyu opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4482&quot; title=&quot;numUnsuccessfulCheckpointsTriggers is accessed without holding triggerLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4482&quot;&gt;&lt;del&gt;FLINK-4482&lt;/del&gt;&lt;/a&gt; numUnsuccessfulCheckpointsTriggers is accessed without holding triggerLock&lt;/p&gt;

&lt;p&gt;    Thanks for contributing to Apache Flink. Before you open your pull request, please take the following check list into consideration.&lt;br/&gt;
    If your changes take all of the items into account, feel free to open your pull request. For more information and/or questions please refer to the &lt;span class=&quot;error&quot;&gt;&amp;#91;How To Contribute guide&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://flink.apache.org/how-to-contribute.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://flink.apache.org/how-to-contribute.html&lt;/a&gt;).&lt;br/&gt;
    In addition to going through the list, please provide a meaningful description of your changes.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] General&lt;/li&gt;
	&lt;li&gt;The pull request references the related JIRA issue (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;FLINK-XXX&amp;#93;&lt;/span&gt; Jira title text&quot;)&lt;/li&gt;
	&lt;li&gt;The pull request addresses only one issue&lt;/li&gt;
	&lt;li&gt;Each commit in the PR has a meaningful commit message (including the JIRA id)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Documentation&lt;/li&gt;
	&lt;li&gt;Documentation has been added for new functionality&lt;/li&gt;
	&lt;li&gt;Old documentation affected by the pull request has been updated&lt;/li&gt;
	&lt;li&gt;JavaDoc for public methods has been added&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;[ ] Tests &amp;amp; Build&lt;/li&gt;
	&lt;li&gt;Functionality added by the pull request is covered by tests&lt;/li&gt;
	&lt;li&gt;`mvn clean verify` has been executed successfully locally or a Travis build has passed&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tedyu/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tedyu/flink&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2421&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2021f4790715ecb762dbb23438bf0b2b2755845e&lt;br/&gt;
Author: tedyu &amp;lt;yuzhihong@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-08-25T18:11:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4482&quot; title=&quot;numUnsuccessfulCheckpointsTriggers is accessed without holding triggerLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4482&quot;&gt;&lt;del&gt;FLINK-4482&lt;/del&gt;&lt;/a&gt; numUnsuccessfulCheckpointsTriggers is accessed without holding triggerLock&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15448674" author="yuzhihong@gmail.com" created="Tue, 30 Aug 2016 10:25:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt;:&lt;br/&gt;
Can you take a look at the PR ?&lt;/p&gt;</comment>
                            <comment id="15452018" author="githubbot" created="Wed, 31 Aug 2016 11:48:57 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think it would be good to use the `triggerLock` only within the `triggerCheckpoint(...)` method.&lt;/p&gt;

&lt;p&gt;    The access to `numUnsuccessfulCheckpointsTriggers` is not super critical, it is merely an informational variable. We could make it an AtomicInteger, if that helps.&lt;/p&gt;</comment>
                            <comment id="15453564" author="githubbot" created="Wed, 31 Aug 2016 22:26:34 +0000"  >&lt;p&gt;Github user tedyu commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The test failure in flink-mesos is unrelated to the PR.&lt;/p&gt;</comment>
                            <comment id="15455163" author="githubbot" created="Thu, 1 Sep 2016 11:55:31 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421#discussion_r77159592&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421#discussion_r77159592&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -135,7 +136,7 @@&lt;br/&gt;
     	private JobStatusListener jobStatusListener;&lt;/p&gt;

&lt;p&gt;     	/** The number of consecutive failed trigger attempts */&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private int numUnsuccessfulCheckpointsTriggers;&lt;br/&gt;
    +	private AtomicInteger numUnsuccessfulCheckpointsTriggers = new AtomicInteger(0);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This should be final&lt;/p&gt;</comment>
                            <comment id="15455192" author="githubbot" created="Thu, 1 Sep 2016 12:05:55 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421#discussion_r77160806&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421#discussion_r77160806&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -401,7 +402,7 @@ CheckpointTriggerResult triggerCheckpoint(long timestamp, CheckpointProperties p&lt;br/&gt;
     				checkpointID = checkpointIdCounter.getAndIncrement();&lt;br/&gt;
     			}&lt;br/&gt;
     			catch (Throwable t) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int numUnsuccessful = ++numUnsuccessfulCheckpointsTriggers;&lt;br/&gt;
    +				int numUnsuccessful = numUnsuccessfulCheckpointsTriggers.addAndGet(1);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Minor: `incrementAndGet()` reads nice here.&lt;/p&gt;</comment>
                            <comment id="15455193" author="githubbot" created="Thu, 1 Sep 2016 12:06:03 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421#discussion_r77160818&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421#discussion_r77160818&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java &amp;#8212;&lt;br/&gt;
    @@ -503,7 +504,7 @@ else if (!props.isSavepoint()) &lt;/p&gt;
{
     					pendingCheckpoints.remove(checkpointID);
     				}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;int numUnsuccessful = ++numUnsuccessfulCheckpointsTriggers;&lt;br/&gt;
    +				int numUnsuccessful = numUnsuccessfulCheckpointsTriggers.addAndGet(1);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    same as above&lt;/p&gt;</comment>
                            <comment id="15455194" author="githubbot" created="Thu, 1 Sep 2016 12:06:25 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Two minor comments, otherwise +1&lt;/p&gt;</comment>
                            <comment id="15459062" author="yuzhihong@gmail.com" created="Fri, 2 Sep 2016 17:08:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt;:&lt;br/&gt;
All checks passed.&lt;/p&gt;

&lt;p&gt;Please take a look.&lt;/p&gt;</comment>
                            <comment id="15516292" author="githubbot" created="Fri, 23 Sep 2016 12:19:58 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging this...&lt;/p&gt;</comment>
                            <comment id="15516950" author="githubbot" created="Fri, 23 Sep 2016 16:50:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2421&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15517014" author="stephanewen" created="Fri, 23 Sep 2016 17:17:04 +0000"  >&lt;p&gt;Fixed via 5d0358af46e0f3683224986a7718adca88f504db&lt;/p&gt;

&lt;p&gt;Thank you for the contribution!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32r8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>