<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5073] ZooKeeperCompleteCheckpointStore executes blocking delete operation in ZooKeeper client thread</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5073</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When deleting completed checkpoints from the &lt;tt&gt;ZooKeeperCompletedCheckpointStore&lt;/tt&gt;, one first tries to delete the meta state handle from ZooKeeper and then deletes the actual checkpoint in a callback from the delete operation. This callback is executed by the ZooKeeper client&apos;s main thread which is problematic, because it blocks the ZooKeeper client. If a delete operation takes longer than it takes to complete a checkpoint, then it might even happen that delete operations of outdated checkpoints are piling up because they are effectively executed sequentially.&lt;/p&gt;

&lt;p&gt;I propose to execute the delete operations by a dedicated &lt;tt&gt;Executor&lt;/tt&gt; so that we keep the client&apos;s main thread free to do ZooKeeper related work.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13020899">FLINK-5073</key>
            <summary>ZooKeeperCompleteCheckpointStore executes blocking delete operation in ZooKeeper client thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Nov 2016 19:59:30 +0000</created>
                <updated>Tue, 22 Nov 2016 22:11:50 +0000</updated>
                            <resolved>Tue, 22 Nov 2016 22:11:50 +0000</resolved>
                                    <version>1.1.3</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.1.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15669775" author="githubbot" created="Wed, 16 Nov 2016 08:06:33 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2815&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2815&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5073&quot; title=&quot;ZooKeeperCompleteCheckpointStore executes blocking delete operation in ZooKeeper client thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5073&quot;&gt;&lt;del&gt;FLINK-5073&lt;/del&gt;&lt;/a&gt; Use Executor to run ZooKeeper callbacks in ZooKeeperStateHandleStore&lt;/p&gt;

&lt;p&gt;    Use dedicated Executor to run ZooKeeper callbacks in ZooKeeperStateHandleStore instead&lt;br/&gt;
    of running it in the ZooKeeper client&apos;s thread. The callback can be blocking because it&lt;br/&gt;
    discards state which might entail deleting files from disk.&lt;/p&gt;

&lt;p&gt;    Review @uce.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixZooKeeperDelete&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2815.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2815.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2815&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 63ec894de907f38ffff362572c87aef1808062d0&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-15T21:45:04Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5073&quot; title=&quot;ZooKeeperCompleteCheckpointStore executes blocking delete operation in ZooKeeper client thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5073&quot;&gt;&lt;del&gt;FLINK-5073&lt;/del&gt;&lt;/a&gt; Use Executor to run ZooKeeper callbacks in ZooKeeperStateHandleStore&lt;/p&gt;

&lt;p&gt;    Use dedicated Executor to run ZooKeeper callbacks in ZooKeeperStateHandleStore instead&lt;br/&gt;
    of running it in the ZooKeeper client&apos;s thread. The callback can be blocking because it&lt;br/&gt;
    discards state which might entail deleting files from disk.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15669777" author="githubbot" created="Wed, 16 Nov 2016 08:07:39 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2816&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2816&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;backport&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5073&quot; title=&quot;ZooKeeperCompleteCheckpointStore executes blocking delete operation in ZooKeeper client thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5073&quot;&gt;&lt;del&gt;FLINK-5073&lt;/del&gt;&lt;/a&gt; Use Executor to run ZooKeeper callbacks in ZooKeeperStateHandleStore&lt;/p&gt;

&lt;p&gt;    Backport of #2815 for the release-1.1 branch.&lt;/p&gt;

&lt;p&gt;    Use dedicated Executor to run ZooKeeper callbacks in ZooKeeperStateHandleStore instead&lt;br/&gt;
    of running it in the ZooKeeper client&apos;s thread. The callback can be blocking because it&lt;br/&gt;
    discards state which might entail deleting files from disk.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; backportFixZooKeeperDelete&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2816.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2816.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2816&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ae67fe9a3bbc768911b8eab8dc32d18c2cb10c1a&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-15T21:45:04Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5073&quot; title=&quot;ZooKeeperCompleteCheckpointStore executes blocking delete operation in ZooKeeper client thread&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5073&quot;&gt;&lt;del&gt;FLINK-5073&lt;/del&gt;&lt;/a&gt; Use Executor to run ZooKeeper callbacks in ZooKeeperStateHandleStore&lt;/p&gt;

&lt;p&gt;    Use dedicated Executor to run ZooKeeper callbacks in ZooKeeperStateHandleStore instead&lt;br/&gt;
    of running it in the ZooKeeper client&apos;s thread. The callback can be blocking because it&lt;br/&gt;
    discards state which might entail deleting files from disk.&lt;/p&gt;

&lt;p&gt;    Add TestExecutors&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15670029" author="githubbot" created="Wed, 16 Nov 2016 10:08:39 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2816#discussion_r88204552&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2816#discussion_r88204552&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/util/ZooKeeperUtils.java &amp;#8212;&lt;br/&gt;
    @@ -237,11 +242,12 @@ public static CompletedCheckpointStore createCompletedCheckpoints(&lt;br/&gt;
     		checkpointsPath += ZooKeeperSubmittedJobGraphStore.getPathForJob(jobId);&lt;/p&gt;

&lt;p&gt;     		return new ZooKeeperCompletedCheckpointStore(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;maxNumberOfCheckpointsToRetain,&lt;br/&gt;
    +			maxNumberOfCheckpointsToRetain,&lt;br/&gt;
     				userClassLoader,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    inconsistent indent&lt;/p&gt;</comment>
                            <comment id="15670380" author="githubbot" created="Wed, 16 Nov 2016 13:02:06 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2816#discussion_r88231145&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2816#discussion_r88231145&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/util/ZooKeeperUtils.java &amp;#8212;&lt;br/&gt;
    @@ -237,11 +242,12 @@ public static CompletedCheckpointStore createCompletedCheckpoints(&lt;br/&gt;
     		checkpointsPath += ZooKeeperSubmittedJobGraphStore.getPathForJob(jobId);&lt;/p&gt;

&lt;p&gt;     		return new ZooKeeperCompletedCheckpointStore(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;maxNumberOfCheckpointsToRetain,&lt;br/&gt;
    +			maxNumberOfCheckpointsToRetain,&lt;br/&gt;
     				userClassLoader,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    True. Will correct it. Thanks for spotting it.&lt;/p&gt;</comment>
                            <comment id="15686099" author="githubbot" created="Tue, 22 Nov 2016 08:46:27 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2816&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2816&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Build passed locally: &lt;a href=&quot;https://travis-ci.org/tillrohrmann/flink/builds/177725509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/tillrohrmann/flink/builds/177725509&lt;/a&gt;. Merging this PR.&lt;/p&gt;</comment>
                            <comment id="15686104" author="githubbot" created="Tue, 22 Nov 2016 08:49:09 +0000"  >&lt;p&gt;Github user tillrohrmann closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2816&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2816&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15688072" author="githubbot" created="Tue, 22 Nov 2016 22:11:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2815&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2815&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15688076" author="till.rohrmann" created="Tue, 22 Nov 2016 22:11:50 +0000"  >&lt;p&gt;Fixed in 1.2 via 3fb92d8687f03c1fac8b87396b2b5a7ff29f6dd6&lt;br/&gt;
Fixed in 1.1.4 via f2e4c193e1fb6b0cf26861bc01c2f3d6bcd4d8f6&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36cwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>