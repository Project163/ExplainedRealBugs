<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:19:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2134] Deadlock in SuccessAfterNetworkBuffersFailureITCase</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2134</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I ran into the issue in a Travis run for a PR: &lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/64994288/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/64994288/log.txt&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can reproduce this locally by running SuccessAfterNetworkBuffersFailureITCase multiple times:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;cluster = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ForkableFlinkMiniCluster(config, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 100; i++) {
   &lt;span class=&quot;code-comment&quot;&gt;// run test programs CC, KMeans, CC
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The iteration tasks wait for superstep notifications like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;Join (Join at runConnectedComponents(SuccessAfterNetworkBuffersFailureITCase.java:128)) (8/6)&quot;&lt;/span&gt; daemon prio=5 tid=0x00007f95f374f800 nid=0x138a7 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x0000000123f2a000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (on object monitor)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
	- waiting on &amp;lt;0x00000007f89e3440&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	at org.apache.flink.runtime.iterative.concurrent.SuperstepKickoffLatch.awaitStartOfSuperstepOrTermination(SuperstepKickoffLatch.java:57)
	- locked &amp;lt;0x00000007f89e3440&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	at org.apache.flink.runtime.iterative.task.IterationTailPactTask.run(IterationTailPactTask.java:131)
	at org.apache.flink.runtime.operators.RegularPactTask.invoke(RegularPactTask.java:362)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:559)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve asked &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; to reproduce this and it deadlocks for him as well. The system needs to be under some load for this to occur after multiple runs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12834568">FLINK-2134</key>
            <summary>Deadlock in SuccessAfterNetworkBuffersFailureITCase</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="uce">Ufuk Celebi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jun 2015 12:39:52 +0000</created>
                <updated>Tue, 6 Oct 2015 15:51:19 +0000</updated>
                            <resolved>Thu, 4 Jun 2015 09:18:01 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14569835" author="uce" created="Tue, 2 Jun 2015 21:56:21 +0000"  >&lt;p&gt;I&apos;m debugging this. The result so far is that some backwards termination events (from sync task to heads) get lost. The sync task sends out all tasks and clear itself. I&apos;m currently trying to figure out where the events get lost...&lt;/p&gt;</comment>
                            <comment id="14571311" author="githubbot" created="Wed, 3 Jun 2015 16:53:16 +0000"  >&lt;p&gt;GitHub user uce opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/773&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/773&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2134&quot; title=&quot;Deadlock in SuccessAfterNetworkBuffersFailureITCase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2134&quot;&gt;&lt;del&gt;FLINK-2134&lt;/del&gt;&lt;/a&gt; Close Netty channel via CloseRequest msg&lt;/p&gt;

&lt;p&gt;    The failing `SuccessAfterNetworkBuffersFailureITCase` discovered a race between sending backwards events (e.g. from sync task to iteration head task) and closing the TCP channel. The close overtook outstanding backwards task events. This change guarnatees that it is in order by sending a explicit close msg.&lt;/p&gt;

&lt;p&gt;    (I&apos;ve also tried other approaches, but this struck me as the simplest solution.)&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/uce/incubator-flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/uce/incubator-flink&lt;/a&gt; event-deadlock-2134&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/773.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/773.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #773&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6a4dcd0d4866ba16c432d15de25df7c161c894b7&lt;br/&gt;
Author: Ufuk Celebi &amp;lt;uce@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-06-03T16:41:40Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2134&quot; title=&quot;Deadlock in SuccessAfterNetworkBuffersFailureITCase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2134&quot;&gt;&lt;del&gt;FLINK-2134&lt;/del&gt;&lt;/a&gt; Close Netty channel via CloseRequest msg&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14571716" author="githubbot" created="Wed, 3 Jun 2015 21:57:03 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/773#issuecomment-108627084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/773#issuecomment-108627084&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Can you elaborate? Why are there backwards events after the connection is closed? The iteration head should not close until the iteration terminates, in which case there should be no back events any more.&lt;/p&gt;</comment>
                            <comment id="14571730" author="githubbot" created="Wed, 3 Jun 2015 22:06:47 +0000"  >&lt;p&gt;Github user uce commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/773#issuecomment-108628742&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/773#issuecomment-108628742&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    No, there are no backwards events &lt;b&gt;after&lt;/b&gt; the channel is closed. The sync sends out the backwards events, then closes. But the close could overtake the unflushed backwards events. This lead to a deadlock, because the head was waiting on termination events, which never arrived.&lt;/p&gt;</comment>
                            <comment id="14571745" author="githubbot" created="Wed, 3 Jun 2015 22:17:01 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/773#issuecomment-108630661&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/773#issuecomment-108630661&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ah, it is a close from the receiver end, got it.&lt;/p&gt;</comment>
                            <comment id="14571748" author="githubbot" created="Wed, 3 Jun 2015 22:18:30 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/773#issuecomment-108630865&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/773#issuecomment-108630865&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Makes sense.&lt;br/&gt;
    +1 to get this in!&lt;/p&gt;</comment>
                            <comment id="14572413" author="githubbot" created="Thu, 4 Jun 2015 09:07:56 +0000"  >&lt;p&gt;Github user uce commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/773#issuecomment-108795770&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/773#issuecomment-108795770&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    OK, thanks for the review. I&apos;m merging this now.&lt;/p&gt;</comment>
                            <comment id="14572424" author="githubbot" created="Thu, 4 Jun 2015 09:16:51 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/773&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/773&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14572427" author="uce" created="Thu, 4 Jun 2015 09:18:01 +0000"  >&lt;p&gt;Fixed via 0dea359.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fidj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>