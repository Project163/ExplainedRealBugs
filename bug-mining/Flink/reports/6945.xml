<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31272] Duplicate operators appear in the StreamGraph for Python DataStream API jobs</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31272</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;For the following job:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; argparse
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; json
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; sys
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; time
from typing &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Iterable, &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;

from pyflink.common &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Types, Time, Encoder
from pyflink.datastream &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamExecutionEnvironment, ProcessWindowFunction, EmbeddedRocksDBStateBackend, \
    PredefinedOptions, FileSystemCheckpointStorage, CheckpointingMode, ExternalizedCheckpointCleanup
from pyflink.datastream.connectors.file_system &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; FileSink, RollingPolicy, OutputFileConfig
from pyflink.datastream.state &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; ReducingState, ReducingStateDescriptor
from pyflink.datastream.window &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; TimeWindow, Trigger, TriggerResult, T, TumblingProcessingTimeWindows, \
    ProcessingTimeTrigger


&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CountWithProcessTimeoutTrigger(ProcessingTimeTrigger):

    def __init__(self, window_size: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;):
        self._window_size = window_size
        self._count_state_descriptor = ReducingStateDescriptor(
            &lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;, lambda a, b: a + b, Types.LONG())

    @staticmethod
    def of(window_size: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) -&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;CountWithProcessTimeoutTrigger&apos;&lt;/span&gt;:
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; CountWithProcessTimeoutTrigger(window_size)

    def on_element(self,
                   element: T,
                   timestamp: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
                   window: TimeWindow,
                   ctx: &lt;span class=&quot;code-quote&quot;&gt;&apos;Trigger.TriggerContext&apos;&lt;/span&gt;) -&amp;gt; TriggerResult:
        count_state = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(ReducingState, ctx.get_partitioned_state(self._count_state_descriptor))
        count_state.add(1)
        # print(&lt;span class=&quot;code-quote&quot;&gt;&quot;element arrive:&quot;&lt;/span&gt;, element, &lt;span class=&quot;code-quote&quot;&gt;&quot;count_state:&quot;&lt;/span&gt;, count_state.get(), window.max_timestamp(),
        #       ctx.get_current_watermark())

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; count_state.get() &amp;gt;= self._window_size:  # &#24517;&#39035;fire&amp;amp;purge&#65281;&#65281;&#65281;&#65281;
            print(&lt;span class=&quot;code-quote&quot;&gt;&quot;fire element count&quot;&lt;/span&gt;, element, count_state.get(), window.max_timestamp(),
                  ctx.get_current_watermark())
            count_state.clear()
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TriggerResult.FIRE_AND_PURGE
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; timestamp &amp;gt;= window.end:
            count_state.clear()
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TriggerResult.FIRE_AND_PURGE
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TriggerResult.CONTINUE

    def on_processing_time(self,
                           timestamp: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
                           window: TimeWindow,
                           ctx: Trigger.TriggerContext) -&amp;gt; TriggerResult:
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; timestamp &amp;gt;= window.end:
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TriggerResult.CONTINUE
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
            print(&lt;span class=&quot;code-quote&quot;&gt;&quot;fire with process_time:&quot;&lt;/span&gt;, timestamp)
            count_state = &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt;(ReducingState, ctx.get_partitioned_state(self._count_state_descriptor))
            count_state.clear()
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TriggerResult.FIRE_AND_PURGE

    def on_event_time(self,
                      timestamp: &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
                      window: TimeWindow,
                      ctx: &lt;span class=&quot;code-quote&quot;&gt;&apos;Trigger.TriggerContext&apos;&lt;/span&gt;) -&amp;gt; TriggerResult:
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; TriggerResult.CONTINUE

    def clear(self,
              window: TimeWindow,
              ctx: &lt;span class=&quot;code-quote&quot;&gt;&apos;Trigger.TriggerContext&apos;&lt;/span&gt;) -&amp;gt; None:
        count_state = ctx.get_partitioned_state(self._count_state_descriptor)
        count_state.clear()


def to_dict_map(v):
    time.sleep(1)
    dict_value = json.loads(v)
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dict_value


def get_group_key(value, keys):
    group_key_values = []
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; key in keys:
        one_key_value = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&apos;&lt;/span&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; key in value:
            list_value = value[key]
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; list_value:
                one_key_value = str(list_value[0])
        group_key_values.append(one_key_value)
    group_key = &lt;span class=&quot;code-quote&quot;&gt;&apos;_&apos;&lt;/span&gt;.join(group_key_values)
    # print(&lt;span class=&quot;code-quote&quot;&gt;&quot;group_key=&quot;&lt;/span&gt;, group_key)
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; group_key


&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CountWindowProcessFunction(ProcessWindowFunction[dict, dict, str, TimeWindow]):

    def __init__(self, uf):
        self._user_function = uf

    def process(self,
                key: str,
                context: ProcessWindowFunction.Context[TimeWindow],
                elements: Iterable[dict]) -&amp;gt; Iterable[dict]:
        result_list = self._user_function.process_after_group_by_function(elements)
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result_list


&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;code-quote&quot;&gt;&apos;__main__&apos;&lt;/span&gt;:
    parser = argparse.ArgumentParser()
    parser.add_argument(
        &lt;span class=&quot;code-quote&quot;&gt;&apos;--output&apos;&lt;/span&gt;,
        dest=&lt;span class=&quot;code-quote&quot;&gt;&apos;output&apos;&lt;/span&gt;,
        required=False,
        help=&lt;span class=&quot;code-quote&quot;&gt;&apos;Output file to write results to.&apos;&lt;/span&gt;)

    argv = sys.argv[1:]
    known_args, _ = parser.parse_known_args(argv)
    output_path = known_args.output

    env = StreamExecutionEnvironment.get_execution_environment()
    # write all the data to one file
    env.set_parallelism(1)

    # process time
    env.get_config().set_auto_watermark_interval(0)
    state_backend = EmbeddedRocksDBStateBackend(True)
    state_backend.set_predefined_options(PredefinedOptions.FLASH_SSD_OPTIMIZED)
    env.set_state_backend(state_backend)
    config = env.get_checkpoint_config()
    # config.set_checkpoint_storage(FileSystemCheckpointStorage(&lt;span class=&quot;code-quote&quot;&gt;&quot;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//ha-nn-uri/tmp/checkpoint/&quot;&lt;/span&gt;))
&lt;/span&gt;    config.set_checkpoint_storage(FileSystemCheckpointStorage(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:&lt;span class=&quot;code-comment&quot;&gt;///Users/10030122/Downloads/pyflink_checkpoint/&quot;&lt;/span&gt;))
&lt;/span&gt;    config.set_checkpointing_mode(CheckpointingMode.AT_LEAST_ONCE)
    config.set_checkpoint_interval(5000)
    config.set_externalized_checkpoint_cleanup(ExternalizedCheckpointCleanup.DELETE_ON_CANCELLATION)

    # define the source
    data_stream1 = env.from_collection([&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [0,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [1,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [2,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [3,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [4,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [5,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [6,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [7,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [8,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [9,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [10,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [11,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [12,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [13,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [14,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [15,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [16,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [17,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [18,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [19,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [20,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [21,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [22,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [23,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [24,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [25,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [26,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [27,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [28,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [29,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [30,0]}&apos;&lt;/span&gt;])

    data_stream2 = env.from_collection([&lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [0,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [1,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [2,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [3,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [4,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [5,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [6,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [7,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [8,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [9,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [10,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [11,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [12,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [13,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [14,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [15,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [16,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [17,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [18,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [19,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [20,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [21,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [22,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [23,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [24,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [25,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [26,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [27,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [28,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [29,0]}&apos;&lt;/span&gt;,
                                        &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt;: [&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;], &lt;span class=&quot;code-quote&quot;&gt;&quot;goods_id&quot;&lt;/span&gt;: [30,0]}&apos;&lt;/span&gt;])

    # group_keys = [&lt;span class=&quot;code-quote&quot;&gt;&apos;user_id&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;goods_id&apos;&lt;/span&gt;]
    group_keys = [&lt;span class=&quot;code-quote&quot;&gt;&apos;user_id&apos;&lt;/span&gt;]

    sink_to_file_flag = True

    data_stream = data_stream1.union(data_stream2)

    # user_function = __import__(&lt;span class=&quot;code-quote&quot;&gt;&quot;UserFunction&quot;&lt;/span&gt;)

    ds = data_stream.map(lambda v: to_dict_map(v)) \
        .filter(lambda v: v) \
        .map(lambda v: v) \
        .key_by(lambda v: get_group_key(v, group_keys)) \
        .window(TumblingProcessingTimeWindows.of(Time.seconds(12))) \
        .process(CountWindowProcessFunction(lambda v: v), Types.STRING())

    ds = ds.map(lambda v: v, Types.PRIMITIVE_ARRAY(Types.BYTE()))

    base_path = &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/1.txt&quot;&lt;/span&gt;
    encoder = Encoder.simple_string_encoder()
    file_sink_builder = FileSink.for_row_format(base_path, encoder)
    file_sink = file_sink_builder \
        .with_bucket_check_interval(1000) \
        .with_rolling_policy(RollingPolicy.on_checkpoint_rolling_policy()) \
        .with_output_file_config(
        OutputFileConfig.builder().with_part_prefix(&lt;span class=&quot;code-quote&quot;&gt;&quot;pre&quot;&lt;/span&gt;).with_part_suffix(&lt;span class=&quot;code-quote&quot;&gt;&quot;suf&quot;&lt;/span&gt;).build()) \
        .build()
    ds.sink_to(file_sink)

    # submit &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; execution
    env.execute()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The stream graph is as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;nodes&quot;&lt;/span&gt; : [ {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 1,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Source: Collection Source&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;pact&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Data Source&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;contents&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Source: Collection Source&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;parallelism&quot;&lt;/span&gt; : 1
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 2,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Source: Collection Source&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;pact&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Data Source&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;contents&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Source: Collection Source&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;parallelism&quot;&lt;/span&gt; : 1
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 9,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;TumblingProcessingTimeWindows&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;pact&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Operator&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;contents&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Window(TumblingProcessingTimeWindows(12000, 0), ProcessingTimeTrigger, CountWindowProcessFunction)&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;parallelism&quot;&lt;/span&gt; : 1,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;predecessors&quot;&lt;/span&gt; : [ {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 15,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;ship_strategy&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;HASH&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;side&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;second&quot;&lt;/span&gt;
    } ]
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 10,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Map&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;pact&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Operator&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;contents&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Map&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;parallelism&quot;&lt;/span&gt; : 1,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;predecessors&quot;&lt;/span&gt; : [ {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 9,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;ship_strategy&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;FORWARD&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;side&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;second&quot;&lt;/span&gt;
    } ]
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 15,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Map, Filter, Map, _stream_key_by_map_operator&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;pact&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Operator&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;contents&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Map, Filter, Map, _stream_key_by_map_operator&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;parallelism&quot;&lt;/span&gt; : 1,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;predecessors&quot;&lt;/span&gt; : [ {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 1,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;ship_strategy&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;FORWARD&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;side&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;second&quot;&lt;/span&gt;
    }, {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 2,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;ship_strategy&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;FORWARD&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;side&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;second&quot;&lt;/span&gt;
    } ]
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 16,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;TumblingProcessingTimeWindows, Map&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;pact&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Operator&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;contents&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Window(TumblingProcessingTimeWindows(12000, 0), ProcessingTimeTrigger, CountWindowProcessFunction)&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;parallelism&quot;&lt;/span&gt; : 1,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;predecessors&quot;&lt;/span&gt; : [ {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 15,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;ship_strategy&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;HASH&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;side&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;second&quot;&lt;/span&gt;
    } ]
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 18,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Sink: Writer&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;pact&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Operator&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;contents&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Sink: Writer&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;parallelism&quot;&lt;/span&gt; : 1,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;predecessors&quot;&lt;/span&gt; : [ {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 10,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;ship_strategy&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;FORWARD&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;side&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;second&quot;&lt;/span&gt;
    } ]
  }, {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 20,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Sink: Committer&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;pact&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Operator&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;contents&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Sink: Committer&quot;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;parallelism&quot;&lt;/span&gt; : 1,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;predecessors&quot;&lt;/span&gt; : [ {
      &lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt; : 18,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;ship_strategy&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;FORWARD&quot;&lt;/span&gt;,
      &lt;span class=&quot;code-quote&quot;&gt;&quot;side&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;second&quot;&lt;/span&gt;
    } ]
  } ]
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The plan is incorrect as we can see that TumblingProcessingTimeWindows appears twice.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13526622">FLINK-31272</key>
            <summary>Duplicate operators appear in the StreamGraph for Python DataStream API jobs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dianfu">Dian Fu</assignee>
                                    <reporter username="dianfu">Dian Fu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 1 Mar 2023 07:19:28 +0000</created>
                <updated>Wed, 8 Mar 2023 17:54:01 +0000</updated>
                            <resolved>Wed, 1 Mar 2023 13:25:29 +0000</resolved>
                                    <version>1.15.0</version>
                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.15.4</fixVersion>
                    <fixVersion>1.16.2</fixVersion>
                                    <component>API / Python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17695075" author="dianfu" created="Wed, 1 Mar 2023 13:25:29 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 753734f0a1a6f44b9e33e84377f63ea6f0a85769&lt;/li&gt;
	&lt;li&gt;1.17: c19c6e5288429bf8df2550e85cefd91fffffb760&lt;/li&gt;
	&lt;li&gt;1.16: 823aa25381ee67673407d581da7fd7259cfbac06&lt;/li&gt;
	&lt;li&gt;1.15: 52cef9e5c6ae747e4f9b1f1d5725bd90db9da7b7&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1g9cw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>It may produce duplicate operators for Python DataStream API jobs of versions 1.15.0 ~ 1.15.3 and 1.16.0 ~ 1.16.1. It has addressed this issue since 1.15.4, 1.16.2 and 1.17.0. For jobs which are not affected by this issue, there are no backward compatibility issues. However, for jobs which are affected, it may not be possible to restore from savepoints generated from versions 1.15.0 ~ 1.15.3 and 1.16.0 ~ 1.16.1.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>