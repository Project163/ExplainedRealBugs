<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5019] Proper isRestored result for tasks that did not write state</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5019</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When a subtask is restored from a checkpoint that does not contain any state (e.g. because the subtask did not write state in the previous run), the result of &lt;tt&gt;StateInitializationContext::isRestored&lt;/tt&gt; will incorrectly return false.&lt;/p&gt;

&lt;p&gt;We should ensure that empty state is somehow reflected in a checkpoint and return true on restore, independent from the presence of state.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13018065">FLINK-5019</key>
            <summary>Proper isRestored result for tasks that did not write state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srichter">Stefan Richter</assignee>
                                    <reporter username="srichter">Stefan Richter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Nov 2016 13:17:03 +0000</created>
                <updated>Wed, 9 Nov 2016 10:24:10 +0000</updated>
                            <resolved>Wed, 9 Nov 2016 10:23:18 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15636392" author="githubbot" created="Fri, 4 Nov 2016 13:54:30 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2746#discussion_r86549195&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2746#discussion_r86549195&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-tests/src/test/java/org/apache/flink/test/checkpointing/SavepointITCase.java &amp;#8212;&lt;br/&gt;
    @@ -339,9 +339,12 @@ protected void run() {&lt;br/&gt;
     					SubtaskState subtaskState = taskState.getState(tdd.getIndexInSubtaskGroup());&lt;/p&gt;

&lt;p&gt;     					assertNotNull(subtaskState);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;errMsg = &quot;Initial operator state mismatch.&quot;;&lt;/li&gt;
	&lt;li&gt;assertEquals(errMsg, subtaskState.getLegacyOperatorState(),&lt;/li&gt;
	&lt;li&gt;tdd.getTaskStateHandles().getLegacyOperatorState());&lt;br/&gt;
    +&lt;br/&gt;
    +					if (subtaskState.hasState()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think this check can actually be replaced by `subtaskState.getLegacyOperatorState()` and if you do that there is no place in the code that calls `SubtaskState.hasState()`, making it obsolete.&lt;/p&gt;

&lt;p&gt;    Please correct me if I&apos;m wrong. &#128517; &lt;/p&gt;</comment>
                            <comment id="15636410" author="githubbot" created="Fri, 4 Nov 2016 13:59:35 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2746#discussion_r86550272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2746#discussion_r86550272&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/StateAssignmentOperation.java &amp;#8212;&lt;br/&gt;
    @@ -63,164 +63,170 @@ public StateAssignmentOperation(&lt;br/&gt;
     	public boolean assignStates() throws Exception {&lt;/p&gt;

&lt;p&gt;     		for (Map.Entry&amp;lt;JobVertexID, TaskState&amp;gt; taskGroupStateEntry : latest.getTaskStates().entrySet()) {&lt;br/&gt;
    +&lt;br/&gt;
     			TaskState taskState = taskGroupStateEntry.getValue();&lt;br/&gt;
     			ExecutionJobVertex executionJobVertex = tasks.get(taskGroupStateEntry.getKey());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (executionJobVertex != null) {&lt;/li&gt;
	&lt;li&gt;// check that the number of key groups have not changed&lt;/li&gt;
	&lt;li&gt;if (taskState.getMaxParallelism() != executionJobVertex.getMaxParallelism()) {&lt;/li&gt;
	&lt;li&gt;throw new IllegalStateException(&quot;The maximum parallelism (&quot; +&lt;/li&gt;
	&lt;li&gt;taskState.getMaxParallelism() + &quot;) with which the latest &quot; +&lt;/li&gt;
	&lt;li&gt;&quot;checkpoint of the execution job vertex &quot; + executionJobVertex +&lt;/li&gt;
	&lt;li&gt;&quot; has been taken and the current maximum parallelism (&quot; +&lt;/li&gt;
	&lt;li&gt;executionJobVertex.getMaxParallelism() + &quot;) changed. This &quot; +&lt;/li&gt;
	&lt;li&gt;&quot;is currently not supported.&quot;);&lt;br/&gt;
    +			if (executionJobVertex == null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    There is no change to the code, right? Just changing the three-way if to a two-way if with a `continue`?&lt;/p&gt;</comment>
                            <comment id="15636413" author="githubbot" created="Fri, 4 Nov 2016 14:00:13 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2746&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2746&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Overall, this change is very good! &#128077; &lt;/p&gt;

&lt;p&gt;    I had some inline comments/questions.&lt;/p&gt;</comment>
                            <comment id="15636456" author="githubbot" created="Fri, 4 Nov 2016 14:10:42 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2746#discussion_r86552393&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2746#discussion_r86552393&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/StateAssignmentOperation.java &amp;#8212;&lt;br/&gt;
    @@ -63,164 +63,170 @@ public StateAssignmentOperation(&lt;br/&gt;
     	public boolean assignStates() throws Exception {&lt;/p&gt;

&lt;p&gt;     		for (Map.Entry&amp;lt;JobVertexID, TaskState&amp;gt; taskGroupStateEntry : latest.getTaskStates().entrySet()) {&lt;br/&gt;
    +&lt;br/&gt;
     			TaskState taskState = taskGroupStateEntry.getValue();&lt;br/&gt;
     			ExecutionJobVertex executionJobVertex = tasks.get(taskGroupStateEntry.getKey());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (executionJobVertex != null) {&lt;/li&gt;
	&lt;li&gt;// check that the number of key groups have not changed&lt;/li&gt;
	&lt;li&gt;if (taskState.getMaxParallelism() != executionJobVertex.getMaxParallelism()) {&lt;/li&gt;
	&lt;li&gt;throw new IllegalStateException(&quot;The maximum parallelism (&quot; +&lt;/li&gt;
	&lt;li&gt;taskState.getMaxParallelism() + &quot;) with which the latest &quot; +&lt;/li&gt;
	&lt;li&gt;&quot;checkpoint of the execution job vertex &quot; + executionJobVertex +&lt;/li&gt;
	&lt;li&gt;&quot; has been taken and the current maximum parallelism (&quot; +&lt;/li&gt;
	&lt;li&gt;executionJobVertex.getMaxParallelism() + &quot;) changed. This &quot; +&lt;/li&gt;
	&lt;li&gt;&quot;is currently not supported.&quot;);&lt;br/&gt;
    +			if (executionJobVertex == null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The code should do the same, I just found the if-nesting was a little deep and checking the preconditions first makes it more readable imo.&lt;/p&gt;</comment>
                            <comment id="15636459" author="githubbot" created="Fri, 4 Nov 2016 14:11:25 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2746#discussion_r86552553&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2746#discussion_r86552553&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-tests/src/test/java/org/apache/flink/test/checkpointing/SavepointITCase.java &amp;#8212;&lt;br/&gt;
    @@ -339,9 +339,12 @@ protected void run() {&lt;br/&gt;
     					SubtaskState subtaskState = taskState.getState(tdd.getIndexInSubtaskGroup());&lt;/p&gt;

&lt;p&gt;     					assertNotNull(subtaskState);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;errMsg = &quot;Initial operator state mismatch.&quot;;&lt;/li&gt;
	&lt;li&gt;assertEquals(errMsg, subtaskState.getLegacyOperatorState(),&lt;/li&gt;
	&lt;li&gt;tdd.getTaskStateHandles().getLegacyOperatorState());&lt;br/&gt;
    +&lt;br/&gt;
    +					if (subtaskState.hasState()) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Didn&apos;t run a find-usage, but if that is true then I agree to your proposal &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15636501" author="githubbot" created="Fri, 4 Nov 2016 14:27:45 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2746#discussion_r86555735&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2746#discussion_r86555735&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/StateAssignmentOperation.java &amp;#8212;&lt;br/&gt;
    @@ -63,164 +63,170 @@ public StateAssignmentOperation(&lt;br/&gt;
     	public boolean assignStates() throws Exception {&lt;/p&gt;

&lt;p&gt;     		for (Map.Entry&amp;lt;JobVertexID, TaskState&amp;gt; taskGroupStateEntry : latest.getTaskStates().entrySet()) {&lt;br/&gt;
    +&lt;br/&gt;
     			TaskState taskState = taskGroupStateEntry.getValue();&lt;br/&gt;
     			ExecutionJobVertex executionJobVertex = tasks.get(taskGroupStateEntry.getKey());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (executionJobVertex != null) {&lt;/li&gt;
	&lt;li&gt;// check that the number of key groups have not changed&lt;/li&gt;
	&lt;li&gt;if (taskState.getMaxParallelism() != executionJobVertex.getMaxParallelism()) {&lt;/li&gt;
	&lt;li&gt;throw new IllegalStateException(&quot;The maximum parallelism (&quot; +&lt;/li&gt;
	&lt;li&gt;taskState.getMaxParallelism() + &quot;) with which the latest &quot; +&lt;/li&gt;
	&lt;li&gt;&quot;checkpoint of the execution job vertex &quot; + executionJobVertex +&lt;/li&gt;
	&lt;li&gt;&quot; has been taken and the current maximum parallelism (&quot; +&lt;/li&gt;
	&lt;li&gt;executionJobVertex.getMaxParallelism() + &quot;) changed. This &quot; +&lt;/li&gt;
	&lt;li&gt;&quot;is currently not supported.&quot;);&lt;br/&gt;
    +			if (executionJobVertex == null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    That&apos;s what I thought. I just wanted to double check because Github makes it look very scary. &#128515; &lt;/p&gt;</comment>
                            <comment id="15650561" author="githubbot" created="Wed, 9 Nov 2016 10:24:10 +0000"  >&lt;p&gt;Github user StefanRRichter closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2746&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2746&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35vf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>