<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8325] Add COUNT AGG support constant parameter, i.e. COUNT(*), COUNT(1) </title>
                <link>https://issues.apache.org/jira/browse/FLINK-8325</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;COUNT(1) with Group Window, always output 0. &lt;br/&gt;
e.g.&lt;br/&gt;
DATA:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val data = List(
    (1L, 1, &lt;span class=&quot;code-quote&quot;&gt;&quot;Hi&quot;&lt;/span&gt;),
    (2L, 2, &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt;),
    (4L, 2, &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt;),
    (8L, 3, &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello world&quot;&lt;/span&gt;),
    (16L, 3, &lt;span class=&quot;code-quote&quot;&gt;&quot;Hello world&quot;&lt;/span&gt;))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SQL:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT b, COUNT(1) FROM MyTable GROUP BY Hop(proctime, interval &lt;span class=&quot;code-quote&quot;&gt;&apos;0.001&apos;&lt;/span&gt; SECOND, interval &lt;span class=&quot;code-quote&quot;&gt;&apos;0.002&apos;&lt;/span&gt; SECOND),b
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;OUTPUT:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1,0,1, 
1,0,1, 
2,0,1,
2,0,1, 
2,0,2, 
3,0,1,
3,0,1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13127485">FLINK-8325</key>
            <summary>Add COUNT AGG support constant parameter, i.e. COUNT(*), COUNT(1) </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sunjincheng121">sunjincheng</assignee>
                                    <reporter username="sunjincheng121">sunjincheng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Dec 2017 08:33:09 +0000</created>
                <updated>Sun, 21 Jan 2018 09:15:49 +0000</updated>
                            <resolved>Sun, 21 Jan 2018 09:15:49 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16309715" author="sunjincheng121" created="Wed, 3 Jan 2018 14:27:55 +0000"  >&lt;p&gt;After I check the detail I find that only  `CountAggFunction&#160;` has this problem. The reason is calcite do the argument optimize. when meet &lt;tt&gt;COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/tt&gt; or &lt;tt&gt;COUNT(1)&lt;/tt&gt;, calcite will ignore the param,so flink will get &lt;tt&gt;COUNT()&lt;/tt&gt;. we should add &lt;tt&gt;COUNT()&lt;/tt&gt; in &lt;tt&gt;CountAggFunction&lt;/tt&gt; and &lt;tt&gt;AggregateUtil&lt;/tt&gt;. &lt;/p&gt;</comment>
                            <comment id="16311503" author="githubbot" created="Thu, 4 Jan 2018 15:29:36 +0000"  >&lt;p&gt;GitHub user sunjincheng121 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8325&quot; title=&quot;Add COUNT AGG support constant parameter, i.e. COUNT(*), COUNT(1) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8325&quot;&gt;&lt;del&gt;FLINK-8325&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Add COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;,COUNT(1) supported&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;Thank you very much for contributing to Apache Flink - we are happy that you want to help us improve Flink. To help the community review your contribution in the best possible way, please go through the checklist below, which will get the contribution into a shape in which it can be best reviewed.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;    &lt;b&gt;Please understand that we do not do this to make contributions to Flink a hassle. In order to uphold a high standard of quality for code contributions, while at the same time managing a large number of contributions, we need contributors to prepare the contributions well, and give reviewers enough contextual information for the review. Please also understand that contributions that do not follow this guide will take longer to review and thus typically be picked up with lower priority by the community.&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;This PR add COUNT(&amp;#42;),COUNT(1) supported.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add a construct parameter for `CountAggFunction`&lt;/li&gt;
	&lt;li&gt;Using `aggregateCall.argList` as parameter to create CountAggFunction` instance&lt;br/&gt;
     in AggregateUtil.`transformToAggregateFunctions` &lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Add `GroupWindowITCase` to test bounded and unbounded group agg.&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Add `CountAggFunctionWithConstantTest` to test COUNT aggregate function with non-nullable parameter&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Modify some batch test case for corrected test result.&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): ( no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sunjincheng121/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sunjincheng121/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8325&quot; title=&quot;Add COUNT AGG support constant parameter, i.e. COUNT(*), COUNT(1) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8325&quot;&gt;&lt;del&gt;FLINK-8325&lt;/del&gt;&lt;/a&gt;-PR&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5241&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 51621e29fa6cb0780716c884ab9b9f0c3f468b08&lt;br/&gt;
Author: &#37329;&#31481; &amp;lt;jincheng.sunjc@...&amp;gt;&lt;br/&gt;
Date:   2018-01-03T15:13:49Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8325&quot; title=&quot;Add COUNT AGG support constant parameter, i.e. COUNT(*), COUNT(1) &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8325&quot;&gt;&lt;del&gt;FLINK-8325&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Add COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;,COUNT(1) supported&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16317217" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160250511&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160250511&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/AggregationCodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -121,7 +121,7 @@ class AggregationCodeGenerator(&lt;/p&gt;

&lt;p&gt;         // get parameter lists for aggregation functions&lt;br/&gt;
         val parametersCode = aggFields.map { inFields =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val fields = inFields.map { f =&amp;gt;&lt;br/&gt;
    +      val fields =  inFields.filter(index =&amp;gt; index &amp;gt; -1).map { f =&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `filter(index =&amp;gt; index &amp;gt; -1)` can be shortend to `filter(_ &amp;gt; -1)`&lt;/p&gt;
</comment>
                            <comment id="16317218" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160250423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160250423&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/AggregationCodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -121,7 +121,7 @@ class AggregationCodeGenerator(&lt;/p&gt;

&lt;p&gt;         // get parameter lists for aggregation functions&lt;br/&gt;
         val parametersCode = aggFields.map { inFields =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val fields = inFields.map { f =&amp;gt;&lt;br/&gt;
    +      val fields =  inFields.filter(index =&amp;gt; index &amp;gt; -1).map { f =&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    remove double space&lt;/p&gt;</comment>
                            <comment id="16317219" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160250581&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160250581&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/AggregationCodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -139,7 +139,7 @@ class AggregationCodeGenerator(&lt;br/&gt;
         val classes = UserDefinedFunctionUtils.typeInfoToClass(physicalInputTypes)&lt;br/&gt;
         val constantClasses = UserDefinedFunctionUtils.typeInfoToClass(constantTypes)&lt;br/&gt;
         val methodSignaturesList = aggFields.map { inFields =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;inFields.map { f =&amp;gt;&lt;br/&gt;
    +      inFields.filter(index =&amp;gt; index &amp;gt; -1).map { f =&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `filter(index =&amp;gt; index &amp;gt; -1)` can be shortend to `filter(_ &amp;gt; -1)`&lt;/p&gt;</comment>
                            <comment id="16317220" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160251401&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160251401&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/functions/aggfunctions/CountAggFunction.scala &amp;#8212;&lt;br/&gt;
    @@ -33,7 +33,20 @@ class CountAccumulator extends JTuple1&lt;span class=&quot;error&quot;&gt;&amp;#91;Long&amp;#93;&lt;/span&gt; {&lt;br/&gt;
     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;built-in count aggregate function&lt;br/&gt;
       */&lt;br/&gt;
    -class CountAggFunction extends AggregateFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;JLong, CountAccumulator&amp;#93;&lt;/span&gt; {&lt;br/&gt;
    +class CountAggFunction&lt;br/&gt;
    +  extends AggregateFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;JLong, CountAccumulator&amp;#93;&lt;/span&gt; {&lt;br/&gt;
    +&lt;br/&gt;
    +  // process argument is optimized by calcite.&lt;br/&gt;
    +  // For instance count(42) or count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; which will optimized to count().&lt;br/&gt;
    +  def accumulate(acc: CountAccumulator): Unit = 
{
    +    acc.f0 += 1L
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  // process argument is optimized by calcite.&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `calcite` -&amp;gt; `Calcite`&lt;/p&gt;</comment>
                            <comment id="16317221" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160257426&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160257426&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -254,7 +254,7 @@ class JoinITCase(&lt;br/&gt;
         val table = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a1, &apos;a2, &apos;a3)&lt;br/&gt;
         tEnv.registerTable(&quot;A&quot;, table)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val sqlQuery2 = &quot;SELECT * FROM (SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM A) CROSS JOIN A&quot;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why are you changing the query? Is it not working anymore?&lt;/p&gt;</comment>
                            <comment id="16317222" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160260174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160260174&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/sql/GroupWindowITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,122 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +package org.apache.flink.table.runtime.stream.sql&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.scala._&lt;br/&gt;
    +import org.apache.flink.streaming.api.TimeCharacteristic&lt;br/&gt;
    +import org.apache.flink.streaming.api.functions.AssignerWithPunctuatedWatermarks&lt;br/&gt;
    +import org.apache.flink.streaming.api.scala.StreamExecutionEnvironment&lt;br/&gt;
    +import org.apache.flink.streaming.api.watermark.Watermark&lt;br/&gt;
    +import org.apache.flink.table.api.TableEnvironment&lt;br/&gt;
    +import org.apache.flink.table.api.scala._&lt;br/&gt;
    +import org.apache.flink.table.runtime.stream.sql.GroupWindowITCase.TimestampAndWatermarkWithOffset&lt;br/&gt;
    +import org.apache.flink.table.runtime.utils.&lt;/p&gt;
{StreamITCase, StreamingWithStateTestBase}
&lt;p&gt;    +import org.apache.flink.types.Row&lt;br/&gt;
    +import org.junit.Assert._&lt;br/&gt;
    +import org.junit._&lt;br/&gt;
    +&lt;br/&gt;
    +import scala.collection.mutable&lt;br/&gt;
    +&lt;br/&gt;
    +class GroupWindowITCase extends StreamingWithStateTestBase {&lt;br/&gt;
    +&lt;br/&gt;
    +  val data = List(&lt;br/&gt;
    +    (1000L, &quot;1&quot;, &quot;Hello&quot;),&lt;br/&gt;
    +    (2000L, &quot;2&quot;, &quot;Hello&quot;),&lt;br/&gt;
    +    (3000L, null.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;, &quot;Hello&quot;),&lt;br/&gt;
    +    (4000L, &quot;4&quot;, &quot;Hello&quot;),&lt;br/&gt;
    +    (5000L, null.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;String&amp;#93;&lt;/span&gt;, &quot;Hello&quot;),&lt;br/&gt;
    +    (6000L, &quot;6&quot;, &quot;Hello&quot;),&lt;br/&gt;
    +    (7000L, &quot;7&quot;, &quot;Hello World&quot;),&lt;br/&gt;
    +    (8000L, &quot;8&quot;, &quot;Hello World&quot;),&lt;br/&gt;
    +    (20000L, &quot;20&quot;, &quot;Hello World&quot;))&lt;br/&gt;
    +&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def testRowTimeTumbleWindow(): Unit = &lt;/p&gt;
{
    +
    +    val env = StreamExecutionEnvironment.getExecutionEnvironment
    +    env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime)
    +    val tEnv = TableEnvironment.getTableEnvironment(env)
    +    StreamITCase.testResults = mutable.MutableList()
    +    StreamITCase.clear
    +    env.setParallelism(1)
    +
    +    val stream = env
    +      .fromCollection(data)
    +      .assignTimestampsAndWatermarks(
    +        new TimestampAndWatermarkWithOffset[(Long, String, String)](0L))
    +    val table = stream.toTable(tEnv, &apos;a, &apos;b, &apos;c, &apos;rowtime.rowtime)
    +
    +    tEnv.registerTable(&quot;T1&quot;, table)
    +
    +    val sqlQuery = &quot;SELECT c, COUNT(*), COUNT(1), COUNT(b) FROM T1 &quot; +
    +      &quot;GROUP BY TUMBLE(rowtime, interval &apos;5&apos; SECOND), c&quot;
    +
    +    val result = tEnv.sqlQuery(sqlQuery).toAppendStream[Row]
    +    result.addSink(new StreamITCase.StringSink[Row])
    +    env.execute()
    +
    +    val expected = List(&quot;Hello World,2,2,2&quot;, &quot;Hello World,1,1,1&quot;, &quot;Hello,4,4,3&quot;, &quot;Hello,2,2,1&quot;)
    +    assertEquals(expected.sorted, StreamITCase.testResults.sorted)
    +  }
&lt;p&gt;    +&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def testUnboundedGroupWindow(): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Rename to `testNonWindowedCount()`&lt;/p&gt;</comment>
                            <comment id="16317223" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160255883&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160255883&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/aggfunctions/AggFunctionTestBase.scala &amp;#8212;&lt;br/&gt;
    @@ -146,14 +146,31 @@ abstract class AggFunctionTestBase&lt;span class=&quot;error&quot;&gt;&amp;#91;T, ACC&amp;#93;&lt;/span&gt; {&lt;br/&gt;
         val accumulator = aggregator.createAccumulator()&lt;br/&gt;
         vals.foreach(&lt;br/&gt;
           v =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;accumulateFunc.invoke(aggregator, accumulator.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Object&amp;#93;&lt;/span&gt;, v.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Object&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +        if(accumulateFunc.getParameterCount == 1)
{
    +          this.accumulateFunc.invoke(aggregator, accumulator.asInstanceOf[Object])
    +        }
&lt;p&gt;else&lt;/p&gt;
{
    --- End diff --
    
    add spaces `}
&lt;p&gt; else {`&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16317225" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160251387&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160251387&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/functions/aggfunctions/CountAggFunction.scala &amp;#8212;&lt;br/&gt;
    @@ -33,7 +33,20 @@ class CountAccumulator extends JTuple1&lt;span class=&quot;error&quot;&gt;&amp;#91;Long&amp;#93;&lt;/span&gt; {&lt;br/&gt;
     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;built-in count aggregate function&lt;br/&gt;
       */&lt;br/&gt;
    -class CountAggFunction extends AggregateFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;JLong, CountAccumulator&amp;#93;&lt;/span&gt; {&lt;br/&gt;
    +class CountAggFunction&lt;br/&gt;
    +  extends AggregateFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;JLong, CountAccumulator&amp;#93;&lt;/span&gt; {&lt;br/&gt;
    +&lt;br/&gt;
    +  // process argument is optimized by calcite.
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `calcite` -&amp;gt; `Calcite`&lt;/p&gt;</comment>
                            <comment id="16317224" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160265977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160265977&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/datastream/DataStreamOverAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -145,6 +145,14 @@ class DataStreamOverAggregate(&lt;br/&gt;
           inputSchema.typeInfo,&lt;br/&gt;
           Some(constants))&lt;/p&gt;

&lt;p&gt;    +    val constantsTypeInfo =&lt;br/&gt;
    +      Some(constants).map(&lt;em&gt;.map(generator.generateExpression(&lt;/em&gt;))).getOrElse(Seq()).map(_.resultType)&lt;br/&gt;
    +  val aggInputTypeInfo = constantsTypeInfo.++:(inputSchema.fieldTypeInfos)&lt;br/&gt;
    +&lt;br/&gt;
    +    val aggregateInputType =&lt;br/&gt;
    +      cluster.getTypeFactory.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;FlinkTypeFactory&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It should be possible to create a `RelDataType` without going through code generation and `TypeInformation`. We have a `RelDataType` for the input row and `RelDataType`s for the `RexNode`s. &lt;/p&gt;

&lt;p&gt;    Check if we can use `FlinkTypeFactory.createStructType()` to create a `RelDataType`.&lt;/p&gt;</comment>
                            <comment id="16317226" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160253551&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160253551&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/AggregationCodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -383,12 +388,16 @@ class AggregationCodeGenerator(&lt;/p&gt;

&lt;p&gt;           val retract: String = {&lt;br/&gt;
             for (i &amp;lt;- aggs.indices) yield {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;j&quot;&quot;&quot;&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${accTypes&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;} acc$i = (${accTypes&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;}) accs.getField($i);&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${genDataViewFieldSetter(s&quot;acc$i&quot;, i)}&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${aggs&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;}.retract(&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;      acc$i,&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;      ${parametersCode&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;});&quot;&quot;&quot;.stripMargin&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    same as for accumulate&lt;/p&gt;</comment>
                            <comment id="16317227" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160253454&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160253454&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/AggregationCodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -359,12 +359,17 @@ class AggregationCodeGenerator(&lt;/p&gt;

&lt;p&gt;           val accumulate: String = {&lt;br/&gt;
             for (i &amp;lt;- aggs.indices) yield {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;j&quot;&quot;&quot;&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${accTypes&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;} acc$i = (${accTypes&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;}) accs.getField($i);&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${genDataViewFieldSetter(s&quot;acc$i&quot;, i)}&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${aggs&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;}.accumulate(&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;      acc$i,&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;      ${parametersCode&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;});&quot;&quot;&quot;.stripMargin&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Change to &lt;/p&gt;

&lt;p&gt;    ```&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${aggs&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;}.accumulate(&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;      acc$i&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;        ${if (!parametersCode&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.isEmpty) &quot;,&quot;}&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;      ${parametersCode&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;}&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    );&quot;&quot;&quot;.stripMargin&lt;br/&gt;
    ```&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

</comment>
                            <comment id="16317228" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160260046&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160260046&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/stream/sql/GroupWindowITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,122 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +package org.apache.flink.table.runtime.stream.sql&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.scala._&lt;br/&gt;
    +import org.apache.flink.streaming.api.TimeCharacteristic&lt;br/&gt;
    +import org.apache.flink.streaming.api.functions.AssignerWithPunctuatedWatermarks&lt;br/&gt;
    +import org.apache.flink.streaming.api.scala.StreamExecutionEnvironment&lt;br/&gt;
    +import org.apache.flink.streaming.api.watermark.Watermark&lt;br/&gt;
    +import org.apache.flink.table.api.TableEnvironment&lt;br/&gt;
    +import org.apache.flink.table.api.scala._&lt;br/&gt;
    +import org.apache.flink.table.runtime.stream.sql.GroupWindowITCase.TimestampAndWatermarkWithOffset&lt;br/&gt;
    +import org.apache.flink.table.runtime.utils.&lt;/p&gt;
{StreamITCase, StreamingWithStateTestBase}
&lt;p&gt;    +import org.apache.flink.types.Row&lt;br/&gt;
    +import org.junit.Assert._&lt;br/&gt;
    +import org.junit._&lt;br/&gt;
    +&lt;br/&gt;
    +import scala.collection.mutable&lt;br/&gt;
    +&lt;br/&gt;
    +class GroupWindowITCase extends StreamingWithStateTestBase {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Add these tests to `SqlITCase` instead of creating a new class. The new test class will result in a new mini cluster to be setup which is quite expensive&lt;/p&gt;</comment>
                            <comment id="16317229" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160259534&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160259534&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This PR introduces a regression. Previously working queries will compute incorrect results when we merge it. &lt;/p&gt;

&lt;p&gt;    IMO, we should only merge it if all existing tests pass. The problem is that &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; cannot be easily fixed. We need to add a NULL tuple, because Flink&apos;s DataSet API won&apos;t compute any result if the input is empty. Not sure how this can be resolved.&lt;/p&gt;
</comment>
                            <comment id="16317230" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160255960&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160255960&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/aggfunctions/AggFunctionTestBase.scala &amp;#8212;&lt;br/&gt;
    @@ -146,14 +146,31 @@ abstract class AggFunctionTestBase&lt;span class=&quot;error&quot;&gt;&amp;#91;T, ACC&amp;#93;&lt;/span&gt; {&lt;br/&gt;
         val accumulator = aggregator.createAccumulator()&lt;br/&gt;
         vals.foreach(&lt;br/&gt;
           v =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;accumulateFunc.invoke(aggregator, accumulator.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Object&amp;#93;&lt;/span&gt;, v.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;Object&amp;#93;&lt;/span&gt;)&lt;br/&gt;
    +        if(accumulateFunc.getParameterCount == 1){
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    add spaces `if (accumulateFunc.getParameterCount == 1) {`&lt;/p&gt;</comment>
                            <comment id="16317231" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160268601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160268601&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/aggregate/AggregateUtil.scala &amp;#8212;&lt;br/&gt;
    @@ -1130,259 +1134,263 @@ object AggregateUtil {&lt;br/&gt;
         // create aggregate function instances by function type and aggregate field data type.&lt;br/&gt;
         aggregateCalls.zipWithIndex.foreach { case (aggregateCall, index) =&amp;gt;&lt;br/&gt;
           val argList: util.List&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt; = aggregateCall.getArgList&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (argList.isEmpty) {&lt;/li&gt;
	&lt;li&gt;if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) 
{
    -          aggFieldIndexes(index) = Array[Int](0)
    -        }
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;throw new TableException(&quot;Aggregate fields should not be empty.&quot;)&lt;br/&gt;
    +&lt;br/&gt;
    +      if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) {&lt;br/&gt;
    +        aggregates(index) = new CountAggFunction()&lt;br/&gt;
    +        if(argList.isEmpty) 
{
    +          aggFieldIndexes(index) = Array[Int](-1)
    +        }
&lt;p&gt;else{&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    add spaces&lt;/p&gt;</comment>
                            <comment id="16317232" author="githubbot" created="Mon, 8 Jan 2018 22:26:12 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160267929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160267929&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/datastream/DataStreamOverAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -145,6 +145,14 @@ class DataStreamOverAggregate(&lt;br/&gt;
           inputSchema.typeInfo,&lt;br/&gt;
           Some(constants))&lt;/p&gt;

&lt;p&gt;    +    val constantsTypeInfo =&lt;br/&gt;
    +      Some(constants).map(&lt;em&gt;.map(generator.generateExpression(&lt;/em&gt;))).getOrElse(Seq()).map(_.resultType)&lt;br/&gt;
    +  val aggInputTypeInfo = constantsTypeInfo.++:(inputSchema.fieldTypeInfos)&lt;br/&gt;
    +&lt;br/&gt;
    +    val aggregateInputType =&lt;br/&gt;
    +      cluster.getTypeFactory.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;FlinkTypeFactory&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Something like:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    val constantTypes = constants.map(_.getType)&lt;br/&gt;
    val fieldTypes = input.getRowType.getFieldList.asScala.map(_.getType)&lt;br/&gt;
    val aggInTypes = constantTypes ++ fieldTypes&lt;br/&gt;
    val aggInNames = aggInTypes.indices.map(&quot;f&quot; + _)&lt;/p&gt;

&lt;p&gt;    val aggInRowType = getCluster.getTypeFactory.createStructType(aggInTypes.asJava, aggInNames.asJava)&lt;br/&gt;
    ```&lt;/p&gt;
</comment>
                            <comment id="16317233" author="githubbot" created="Mon, 8 Jan 2018 22:26:13 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160271966&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160271966&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/aggregate/AggregateUtil.scala &amp;#8212;&lt;br/&gt;
    @@ -1130,259 +1134,263 @@ object AggregateUtil {&lt;br/&gt;
         // create aggregate function instances by function type and aggregate field data type.&lt;br/&gt;
         aggregateCalls.zipWithIndex.foreach { case (aggregateCall, index) =&amp;gt;&lt;br/&gt;
           val argList: util.List&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt; = aggregateCall.getArgList&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (argList.isEmpty) {&lt;/li&gt;
	&lt;li&gt;if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) {&lt;/li&gt;
	&lt;li&gt;aggFieldIndexes(index) = Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Int&amp;#93;&lt;/span&gt;(0)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Couldn&apos;t just change this line to `aggFieldIndexes(index) = Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Int&amp;#93;&lt;/span&gt;(-1)` instead of touching each line of this method?&lt;/p&gt;</comment>
                            <comment id="16317234" author="githubbot" created="Mon, 8 Jan 2018 22:26:15 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160268630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160268630&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/aggregate/AggregateUtil.scala &amp;#8212;&lt;br/&gt;
    @@ -1130,259 +1134,263 @@ object AggregateUtil {&lt;br/&gt;
         // create aggregate function instances by function type and aggregate field data type.&lt;br/&gt;
         aggregateCalls.zipWithIndex.foreach { case (aggregateCall, index) =&amp;gt;&lt;br/&gt;
           val argList: util.List&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt; = aggregateCall.getArgList&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (argList.isEmpty) {&lt;/li&gt;
	&lt;li&gt;if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) 
{
    -          aggFieldIndexes(index) = Array[Int](0)
    -        }
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;throw new TableException(&quot;Aggregate fields should not be empty.&quot;)&lt;br/&gt;
    +&lt;br/&gt;
    +      if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) {&lt;br/&gt;
    +        aggregates(index) = new CountAggFunction()&lt;br/&gt;
    +        if(argList.isEmpty) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    add space&lt;/p&gt;</comment>
                            <comment id="16318456" author="githubbot" created="Tue, 9 Jan 2018 14:04:52 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160413762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160413762&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/codegen/AggregationCodeGenerator.scala &amp;#8212;&lt;br/&gt;
    @@ -359,12 +359,17 @@ class AggregationCodeGenerator(&lt;/p&gt;

&lt;p&gt;           val accumulate: String = {&lt;br/&gt;
             for (i &amp;lt;- aggs.indices) yield {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;j&quot;&quot;&quot;&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${accTypes&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;} acc$i = (${accTypes&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;}) accs.getField($i);&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${genDataViewFieldSetter(s&quot;acc$i&quot;, i)}&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;    ${aggs&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;}.accumulate(&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;      acc$i,&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;
&lt;/li&gt;
	&lt;li&gt;&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;      ${parametersCode&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;});&quot;&quot;&quot;.stripMargin&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The code is very simple. bug when `!parametersCode&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.isEmpty`, will generate the following code: &lt;br/&gt;
    `.accumulate(acc0());` which we do not wanted.&lt;/p&gt;</comment>
                            <comment id="16318457" author="githubbot" created="Tue, 9 Jan 2018 14:05:43 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160413930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160413930&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/datastream/DataStreamOverAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -145,6 +145,14 @@ class DataStreamOverAggregate(&lt;br/&gt;
           inputSchema.typeInfo,&lt;br/&gt;
           Some(constants))&lt;/p&gt;

&lt;p&gt;    +    val constantsTypeInfo =&lt;br/&gt;
    +      Some(constants).map(&lt;em&gt;.map(generator.generateExpression(&lt;/em&gt;))).getOrElse(Seq()).map(_.resultType)&lt;br/&gt;
    +  val aggInputTypeInfo = constantsTypeInfo.++:(inputSchema.fieldTypeInfos)&lt;br/&gt;
    +&lt;br/&gt;
    +    val aggregateInputType =&lt;br/&gt;
    +      cluster.getTypeFactory.asInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;FlinkTypeFactory&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="16318461" author="githubbot" created="Tue, 9 Jan 2018 14:10:14 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160414914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160414914&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -254,7 +254,7 @@ class JoinITCase(&lt;br/&gt;
         val table = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a1, &apos;a2, &apos;a3)&lt;br/&gt;
         tEnv.registerTable(&quot;A&quot;, table)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val sqlQuery2 = &quot;SELECT * FROM (SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM A) CROSS JOIN A&quot;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes, when using `COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ` we must change result expect. &lt;br/&gt;
    ``` &lt;br/&gt;
     expected: &lt;span class=&quot;error&quot;&gt;&amp;#91;3,1,1,Hi, 3,2,2,Hello, 3,3,2,Hello world&amp;#93;&lt;/span&gt;&lt;br/&gt;
     received: &lt;span class=&quot;error&quot;&gt;&amp;#91;4,1,1,Hi, 4,2,2,Hello, 4,3,2,Hello world&amp;#93;&lt;/span&gt; &lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16318475" author="githubbot" created="Tue, 9 Jan 2018 14:16:49 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160416641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160416641&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think this test case is bug of batch, so we should open it after &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt;. &lt;br/&gt;
    You are right we not sure how to fix the &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; current time, but we are sure add a `null` row is not correct(best) way to deal with `non-groupby` query.  But I think we should fix &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; after this PR merged(when we know how to fix it). What do you think?&lt;/p&gt;</comment>
                            <comment id="16318487" author="githubbot" created="Tue, 9 Jan 2018 14:26:11 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160419117&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160419117&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    A workaround way is we create a `transformToBatchAggregateFunctions` or add a parameter to `transformToAggregateFunctions` which can identify batch or stream.&lt;br/&gt;
    but not elegant &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="16318495" author="githubbot" created="Tue, 9 Jan 2018 14:32:25 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160420917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160420917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -254,7 +254,7 @@ class JoinITCase(&lt;br/&gt;
         val table = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a1, &apos;a2, &apos;a3)&lt;br/&gt;
         tEnv.registerTable(&quot;A&quot;, table)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val sqlQuery2 = &quot;SELECT * FROM (SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM A) CROSS JOIN A&quot;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The current result is correct. `CollectionDataSets.getSmall3TupleDataSet` has three rows. Hence `SELECT count(a1) FROM A` must be `3` and not `4`. &lt;br/&gt;
    The PR breaks the correctness of the test.&lt;/p&gt;</comment>
                            <comment id="16318501" author="githubbot" created="Tue, 9 Jan 2018 14:35:13 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160421752&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160421752&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I had a look at the test and think that it is correct.  `SELECT a FROM Table3` returns `1, 2, 3` and `SELECT d FROM Table5` returns `1, 2, 2, 3, 3, 3, 4, 4, 4, 4, 5, 5, 5, 5, 5`. So the result of the query should be 6 times `true` and 9 times `false`.&lt;/p&gt;

&lt;p&gt;    Which result woud you expect?&lt;/p&gt;</comment>
                            <comment id="16318538" author="githubbot" created="Tue, 9 Jan 2018 14:50:25 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160426130&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160426130&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -254,7 +254,7 @@ class JoinITCase(&lt;br/&gt;
         val table = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a1, &apos;a2, &apos;a3)&lt;br/&gt;
         tEnv.registerTable(&quot;A&quot;, table)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val sqlQuery2 = &quot;SELECT * FROM (SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM A) CROSS JOIN A&quot;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    HI, @fhueske I do not think The PR breaks the correctness of the test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, because when we run this test case will match `DataSetAggregateWithNullValuesRule`. which will union a NULL  row to dataset.  so using `COUNT(a1)` result `3` and using `COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;` result `4`. I think this is batch bug.  The snip as follow:&lt;br/&gt;
    !&lt;span class=&quot;error&quot;&gt;&amp;#91;image&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://user-images.githubusercontent.com/22488084/34726497-250f4b30-f58f-11e7-92cf-595f9c9a64e0.png&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://user-images.githubusercontent.com/22488084/34726497-250f4b30-f58f-11e7-92cf-595f9c9a64e0.png&lt;/a&gt;) &lt;br/&gt;
    I think we can talk about this bug in FlINK-8355... What do you think?&lt;/p&gt;
</comment>
                            <comment id="16318548" author="githubbot" created="Tue, 9 Jan 2018 14:58:34 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160428673&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160428673&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/aggregate/AggregateUtil.scala &amp;#8212;&lt;br/&gt;
    @@ -1130,259 +1134,263 @@ object AggregateUtil {&lt;br/&gt;
         // create aggregate function instances by function type and aggregate field data type.&lt;br/&gt;
         aggregateCalls.zipWithIndex.foreach { case (aggregateCall, index) =&amp;gt;&lt;br/&gt;
           val argList: util.List&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt; = aggregateCall.getArgList&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (argList.isEmpty) {&lt;/li&gt;
	&lt;li&gt;if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) {&lt;/li&gt;
	&lt;li&gt;aggFieldIndexes(index) = Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Int&amp;#93;&lt;/span&gt;(0)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think it should work, but I do not want deal with `SqlCountAggFunction` twice, so i remove the `SqlCountAggFunction` from case condition. &lt;/p&gt;</comment>
                            <comment id="16318558" author="githubbot" created="Tue, 9 Jan 2018 15:04:16 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160430205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160430205&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    `6` times true and `9` times false is my expect.. but because `DataSetAggregateWithNullValuesRule` we will get the `9` times `null`.  as follows:&lt;br/&gt;
    ```&lt;br/&gt;
     expected: &lt;span class=&quot;error&quot;&gt;&amp;#91;false, false, false, false, false, false, false, false, false, true, true, true, true, true, true&amp;#93;&lt;/span&gt;&lt;br/&gt;
     received: &lt;span class=&quot;error&quot;&gt;&amp;#91;null, null, null, null, null, null, null, null, null, true, true, true, true, true, true&amp;#93;&lt;/span&gt; &lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16318597" author="githubbot" created="Tue, 9 Jan 2018 15:28:11 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160437205&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160437205&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The rule or anything else that happens during optimization does not matter. The only thing that counts are input data, query, and output data. Given the query and the input data, the current result is correct. &lt;/p&gt;

&lt;p&gt;    The test was passing before. If it fails now, it is clear that the PR broke it.&lt;/p&gt;</comment>
                            <comment id="16318603" author="githubbot" created="Tue, 9 Jan 2018 15:31:17 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160438113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160438113&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -254,7 +254,7 @@ class JoinITCase(&lt;br/&gt;
         val table = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a1, &apos;a2, &apos;a3)&lt;br/&gt;
         tEnv.registerTable(&quot;A&quot;, table)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val sqlQuery2 = &quot;SELECT * FROM (SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM A) CROSS JOIN A&quot;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    The test was working correctly before. If you remove all your changes, the test will pass. It started to fail when you added the count aggregate that is not null-aware. It does not matter which rules are applied during optimization as long as the query computes for the given input data the correct result. The test is correct and is failing due to the changes of the PR. Hence, the PR breaks the correctness of some queries that were working before.&lt;/p&gt;

&lt;p&gt;    IMO, we cannot merge it in the current state. We have to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; before we can merge this PR. I have an idea how to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; and will add that to the ticket.&lt;/p&gt;</comment>
                            <comment id="16318607" author="githubbot" created="Tue, 9 Jan 2018 15:36:14 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160439631&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160439631&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The test was passing before because both `COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;` and `COUNT(a)` ignore the `NULL` before this PR. That&apos;s a bug.... please seee SQL 92 &lt;a href=&quot;https://docs.microsoft.com/en-us/sql/t-sql/functions/count-transact-sql&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.microsoft.com/en-us/sql/t-sql/functions/count-transact-sql&lt;/a&gt; &lt;br/&gt;
    ```&lt;br/&gt;
    COUNT&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; returns the number of rows in a specified table without getting rid of duplicates. It counts each row separately. This includes rows that contain null values.&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16318622" author="githubbot" created="Tue, 9 Jan 2018 15:44:26 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160442170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160442170&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/JoinITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -254,7 +254,7 @@ class JoinITCase(&lt;br/&gt;
         val table = CollectionDataSets.getSmall3TupleDataSet(env).toTable(tEnv).as(&apos;a1, &apos;a2, &apos;a3)&lt;br/&gt;
         tEnv.registerTable(&quot;A&quot;, table)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val sqlQuery2 = &quot;SELECT * FROM (SELECT count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; FROM A) CROSS JOIN A&quot;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Sounds good.  &lt;/p&gt;</comment>
                            <comment id="16318629" author="githubbot" created="Tue, 9 Jan 2018 15:46:57 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160442930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160442930&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It is correct, that the current state does not work for all queries and input data. There is a bug that needs to be fixed. However, it is working correctly for the &lt;b&gt;given&lt;/b&gt; test.&lt;/p&gt;

&lt;p&gt;    The test is correct and is now failing due to this PR. Hence it causes a regression. Your changes fix a bug but introduce another one.&lt;/p&gt;</comment>
                            <comment id="16318688" author="githubbot" created="Tue, 9 Jan 2018 16:26:08 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160454995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160454995&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Maybe I did not clearly express what I mean. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="16319938" author="githubbot" created="Wed, 10 Jan 2018 09:12:41 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r160622372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r160622372&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/runtime/batch/sql/SetOperatorsITCase.scala &amp;#8212;&lt;br/&gt;
    @@ -278,7 +278,14 @@ class SetOperatorsITCase(&lt;br/&gt;
         TestBaseUtils.compareResultAsText(results.asJava, expected)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +    * This test will checks IN for NULLs based on whether COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT (a) are equal. Due to&lt;br/&gt;
    +    * [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.table.plan.rules.dataSet.DataSetAggregateWithNullValuesRule&amp;#93;&lt;/span&gt;] will&lt;br/&gt;
    +    * union a NULL row in to input DataSet for non-groupBy agg. That caused COUNT &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; and COUNT(a)&lt;br/&gt;
    +    * are not equal. So this test case ignored before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; be fixed.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    No worries. I think if we fix &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; first, the test cases should work correctly. I&apos;ve added a comment to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; with an idea how to fix it.&lt;/p&gt;</comment>
                            <comment id="16326164" author="githubbot" created="Mon, 15 Jan 2018 11:51:48 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @fhueske Thanks for your review and suggestion about &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt;, I have fixed the &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8355&quot; title=&quot;DataSet Should not union a NULL row for AGG without GROUP BY clause.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8355&quot;&gt;&lt;del&gt;FLINK-8355&lt;/del&gt;&lt;/a&gt; issue in this PR. I appreciate if you can review the change again.&lt;/p&gt;

&lt;p&gt;    Best, Jincheng&lt;/p&gt;</comment>
                            <comment id="16332417" author="githubbot" created="Fri, 19 Jan 2018 15:42:50 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r162642637&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r162642637&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/dataset/DataSetAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -157,6 +158,7 @@ class DataSetAggregate(&lt;br/&gt;
           } else {&lt;br/&gt;
             inputDS&lt;br/&gt;
               .reduceGroup(finalAgg)&lt;br/&gt;
    +          .mapPartition(emptyProcessMapPartition.get)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I thought about this again. &lt;/p&gt;

&lt;p&gt;    I think we should extend `DataSetFinalAggFunction` to also implement `MapPartitionFunction` similar to the `DataSetPreAggFunction`. The `GroupReduceFunction.reduceGroup()` method and the `MapPartitionFunction.mapPartition()` function share the same code. For the grouped aggregation, we use `reduceGroup(function)` and for the non-grouped aggregation we use `mapPartition(function).setParallelism(1)`. Setting the parallelism is important here.&lt;/p&gt;

&lt;p&gt;    That way we avoid an additional function and its a cleaner design.&lt;/p&gt;</comment>
                            <comment id="16332418" author="githubbot" created="Fri, 19 Jan 2018 15:42:50 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r162639253&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r162639253&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/functions/aggfunctions/CountAggFunction.scala &amp;#8212;&lt;br/&gt;
    @@ -33,7 +33,20 @@ class CountAccumulator extends JTuple1&lt;span class=&quot;error&quot;&gt;&amp;#91;Long&amp;#93;&lt;/span&gt; {&lt;br/&gt;
     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;built-in count aggregate function&lt;br/&gt;
       */&lt;br/&gt;
    -class CountAggFunction extends AggregateFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;JLong, CountAccumulator&amp;#93;&lt;/span&gt; {&lt;br/&gt;
    +class CountAggFunction&lt;br/&gt;
    +  extends AggregateFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;JLong, CountAccumulator&amp;#93;&lt;/span&gt; {&lt;br/&gt;
    +&lt;br/&gt;
    +  // process argument is optimized by Calcite.&lt;br/&gt;
    +  // For instance count(42) or count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; which will optimized to count().
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `For instance count(42) or count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; which will optimized to count().` -&amp;gt; &lt;br/&gt;
    `For instance count(42) or count&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; will be optimized to count().`&lt;/p&gt;</comment>
                            <comment id="16332419" author="githubbot" created="Fri, 19 Jan 2018 15:42:51 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r162643053&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r162643053&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/rules/FlinkRuleSets.scala &amp;#8212;&lt;br/&gt;
    @@ -164,7 +164,6 @@ object FlinkRuleSets {&lt;br/&gt;
         // translate to Flink DataSet nodes&lt;br/&gt;
         DataSetWindowAggregateRule.INSTANCE,&lt;br/&gt;
         DataSetAggregateRule.INSTANCE,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;DataSetAggregateWithNullValuesRule.INSTANCE,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Please move the changes to remove this rule into a separate PR.&lt;/p&gt;</comment>
                            <comment id="16332420" author="githubbot" created="Fri, 19 Jan 2018 15:42:51 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r162643699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r162643699&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/aggregate/AggregateUtil.scala &amp;#8212;&lt;br/&gt;
    @@ -829,7 +833,8 @@ object AggregateUtil {&lt;br/&gt;
           outputType: RelDataType,&lt;br/&gt;
           groupings: Array&lt;span class=&quot;error&quot;&gt;&amp;#91;Int&amp;#93;&lt;/span&gt;): (Option&lt;span class=&quot;error&quot;&gt;&amp;#91;DataSetPreAggFunction&amp;#93;&lt;/span&gt;,&lt;br/&gt;
             Option[TypeInformation&lt;span class=&quot;error&quot;&gt;&amp;#91;Row&amp;#93;&lt;/span&gt;],&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;RichGroupReduceFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;Row, Row&amp;#93;&lt;/span&gt;) = {&lt;br/&gt;
    +        RichGroupReduceFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;Row, Row&amp;#93;&lt;/span&gt;,&lt;br/&gt;
    +        Option[MapPartitionFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;Row, Row&amp;#93;&lt;/span&gt;]) = {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Please remove this parameter and extend `DataSetFinalAggFunction` to also implement `RichMapPartitionFunction` such that it can be used as both (similar to `DataSetPreAggFunction`).&lt;/p&gt;</comment>
                            <comment id="16332421" author="githubbot" created="Fri, 19 Jan 2018 15:42:51 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r162644529&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r162644529&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/aggregate/DataSetEmptyProcessMapPartition.scala &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,83 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +package org.apache.flink.table.runtime.aggregate&lt;br/&gt;
    +&lt;br/&gt;
    +import java.lang&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.functions.RichMapPartitionFunction&lt;br/&gt;
    +import org.apache.flink.configuration.Configuration&lt;br/&gt;
    +import org.apache.flink.table.codegen.&lt;/p&gt;
{Compiler, GeneratedAggregationsFunction}
&lt;p&gt;    +import org.apache.flink.table.util.Logging&lt;br/&gt;
    +import org.apache.flink.types.Row&lt;br/&gt;
    +import org.apache.flink.util.Collector&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    +  * Set default value of all aggregates for non-grouped aggregates on empty dataset.&lt;br/&gt;
    +  */&lt;br/&gt;
    +class DataSetEmptyProcessMapPartition(genAggregations: GeneratedAggregationsFunction)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Can be removed if we extend `DataSetFinalAggFunction` to also implement `MapPartitionFunction`&lt;/p&gt;</comment>
                            <comment id="16332422" author="githubbot" created="Fri, 19 Jan 2018 15:42:51 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r162649999&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r162649999&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/aggregate/AggregateUtil.scala &amp;#8212;&lt;br/&gt;
    @@ -1130,259 +1137,263 @@ object AggregateUtil {&lt;br/&gt;
         // create aggregate function instances by function type and aggregate field data type.&lt;br/&gt;
         aggregateCalls.zipWithIndex.foreach { case (aggregateCall, index) =&amp;gt;&lt;br/&gt;
           val argList: util.List&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt; = aggregateCall.getArgList&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (argList.isEmpty) {&lt;/li&gt;
	&lt;li&gt;if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) 
{
    -          aggFieldIndexes(index) = Array[Int](0)
    -        }
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;throw new TableException(&quot;Aggregate fields should not be empty.&quot;)&lt;br/&gt;
    +&lt;br/&gt;
    +      if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) {&lt;br/&gt;
    +        aggregates(index) = new CountAggFunction&lt;br/&gt;
    +        if(argList.isEmpty) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +space&lt;/p&gt;</comment>
                            <comment id="16332423" author="githubbot" created="Fri, 19 Jan 2018 15:42:51 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r162649590&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r162649590&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/runtime/aggregate/AggregateUtil.scala &amp;#8212;&lt;br/&gt;
    @@ -1130,259 +1137,263 @@ object AggregateUtil {&lt;br/&gt;
         // create aggregate function instances by function type and aggregate field data type.&lt;br/&gt;
         aggregateCalls.zipWithIndex.foreach { case (aggregateCall, index) =&amp;gt;&lt;br/&gt;
           val argList: util.List&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt; = aggregateCall.getArgList&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (argList.isEmpty) {&lt;/li&gt;
	&lt;li&gt;if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) 
{
    -          aggFieldIndexes(index) = Array[Int](0)
    -        }
&lt;p&gt; else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;throw new TableException(&quot;Aggregate fields should not be empty.&quot;)&lt;br/&gt;
    +&lt;br/&gt;
    +      if (aggregateCall.getAggregation.isInstanceOf&lt;span class=&quot;error&quot;&gt;&amp;#91;SqlCountAggFunction&amp;#93;&lt;/span&gt;) {&lt;br/&gt;
    +        aggregates(index) = new CountAggFunction&lt;br/&gt;
    +        if(argList.isEmpty) 
{
    +          aggFieldIndexes(index) = Array[Int](-1)
    +        }
&lt;p&gt;else{&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +spaces&lt;/p&gt;</comment>
                            <comment id="16332424" author="githubbot" created="Fri, 19 Jan 2018 15:42:51 +0000"  >&lt;p&gt;Github user fhueske commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241#discussion_r162645683&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241#discussion_r162645683&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/plan/nodes/dataset/DataSetAggregate.scala &amp;#8212;&lt;br/&gt;
    @@ -157,6 +158,7 @@ class DataSetAggregate(&lt;br/&gt;
           } else {&lt;br/&gt;
             inputDS&lt;br/&gt;
               .reduceGroup(finalAgg)&lt;br/&gt;
    +          .mapPartition(emptyProcessMapPartition.get)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    We should implement the pre-aggregated non-grouped agg also with `mapPartition` then, IMO.&lt;/p&gt;</comment>
                            <comment id="16332842" author="githubbot" created="Fri, 19 Jan 2018 20:00:31 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Please rebase the PR on the master once #5320 was merged.&lt;br/&gt;
    I&apos;ll have a look at the changes after the rebase.&lt;/p&gt;

&lt;p&gt;    Thank you, Fabian&lt;/p&gt;</comment>
                            <comment id="16333199" author="githubbot" created="Sat, 20 Jan 2018 14:34:33 +0000"  >&lt;p&gt;Github user sunjincheng121 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @fhueske,  I had rebase the code. I appreciate if you can review the changes.&lt;/p&gt;

&lt;p&gt;    Best, Jincheng&lt;/p&gt;</comment>
                            <comment id="16333346" author="githubbot" created="Sat, 20 Jan 2018 23:43:46 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the update and rebasing @sunjincheng121.&lt;br/&gt;
    The PR looks good. Will run final tests and merge it.&lt;/p&gt;

&lt;p&gt;    Best, Fabian&lt;/p&gt;</comment>
                            <comment id="16333421" author="githubbot" created="Sun, 21 Jan 2018 08:05:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5241&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16333426" author="fhueske" created="Sun, 21 Jan 2018 09:15:49 +0000"  >&lt;p&gt;Fixed for 1.4.1 with aa5e4918049a59b965e7f7df385130ebb462c879&lt;br/&gt;
Fixed for 1.5.0 with 4c883e342e59ebe5cf8d8c8d47535013557ef5f7&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13128248">FLINK-8355</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 43 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3oc4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>