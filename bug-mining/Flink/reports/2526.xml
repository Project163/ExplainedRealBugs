<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9143] Restart strategy defined in flink-conf.yaml is ignored</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9143</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Restart strategy defined in flink-conf.yaml is disregarded,&#160;when user enables checkpointing.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;p&gt;1. Download flink distribution (1.4.2), update flink-conf.yaml:&lt;br/&gt;
 &#160;&lt;br/&gt;
 restart-strategy: none&lt;br/&gt;
 state.backend: rocksdb&lt;br/&gt;
 state.backend.fs.checkpointdir: &lt;a href=&quot;file:///tmp/nfsrecovery/flink-checkpoints-metadata&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///tmp/nfsrecovery/flink-checkpoints-metadata&lt;/a&gt;&lt;br/&gt;
 state.backend.rocksdb.checkpointdir: &lt;a href=&quot;file:///tmp/nfsrecovery/flink-checkpoints-rocksdb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///tmp/nfsrecovery/flink-checkpoints-rocksdb&lt;/a&gt;&lt;br/&gt;
 &#160;&lt;br/&gt;
 2. create new java project as described at&#160;&lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-release-1.4/quickstart/java_api_quickstart.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ci.apache.org/projects/flink/flink-docs-release-1.4/quickstart/java_api_quickstart.html&lt;/a&gt;&lt;br/&gt;
 here&apos;s the code:&lt;br/&gt;
 public class FailedJob&lt;br/&gt;
 {&lt;br/&gt;
 &#160; &#160; static final Logger LOGGER = LoggerFactory.getLogger(FailedJob.class);&lt;br/&gt;
 &#160; &#160; public static void main( String[] args ) throws Exception&lt;br/&gt;
 &#160; &#160; {&lt;br/&gt;
 &#160; &#160; &#160; &#160; final StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();&lt;br/&gt;
 &#160; &#160; &#160; &#160; env.enableCheckpointing(5000, CheckpointingMode.EXACTLY_ONCE);&lt;br/&gt;
 &#160; &#160; &#160; &#160; DataStream&amp;lt;String&amp;gt; stream = env.fromCollection(Arrays.asList(&quot;test&quot;));&lt;br/&gt;
 &#160; &#160; &#160; &#160; stream.map(new MapFunction&amp;lt;String, String&amp;gt;(){&lt;br/&gt;
 &#160; &#160; &#160; &#160; &#160; &#160; @Override&lt;br/&gt;
 &#160; &#160; &#160; &#160; &#160; &#160; public String map(String obj)&lt;/p&gt;

{ &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; throw new NullPointerException(&quot;NPE&quot;); &#160; &#160; &#160; &#160; &#160; &#160; }

&lt;p&gt;&#160;&lt;br/&gt;
 &#160; &#160; &#160; &#160; });&lt;br/&gt;
 &#160; &#160; &#160; &#160; env.execute(&quot;Failed job&quot;);&lt;br/&gt;
 &#160; &#160; }&lt;br/&gt;
 }&lt;br/&gt;
 &#160;&lt;br/&gt;
 3. Compile: mvn clean package; submit it to the cluster&lt;br/&gt;
 &#160;&lt;br/&gt;
 4. Go to Job Manager configuration in WebUI, ensure settings from flink-conf.yaml is there (screenshot attached)&lt;br/&gt;
 &#160;&lt;br/&gt;
 5. Go to Job&apos;s configuration, see Execution Configuration section&lt;br/&gt;
 &#160;&lt;br/&gt;
 &lt;b&gt;Expected result&lt;/b&gt;: restart strategy as defined in flink-conf.yaml&lt;br/&gt;
 &#160;&lt;br/&gt;
 &lt;b&gt;Actual result&lt;/b&gt;:&#160;Restart with fixed delay (10000 ms). #2147483647 restart attempts.&lt;br/&gt;
 &#160;&lt;br/&gt;
 &#160;&lt;br/&gt;
 see attached screenshots and jobmanager log (line 1 and 31)&lt;br/&gt;
 &#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13150527">FLINK-9143</key>
            <summary>Restart strategy defined in flink-conf.yaml is ignored</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dwysakowicz">Dawid Wysakowicz</assignee>
                                    <reporter username="asmirnov">Alex Smirnov</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 6 Apr 2018 07:27:13 +0000</created>
                <updated>Wed, 2 Oct 2019 17:50:01 +0000</updated>
                            <resolved>Sat, 14 Jul 2018 05:53:50 +0000</resolved>
                                    <version>1.4.2</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Runtime / Configuration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16428060" author="asmirnov" created="Fri, 6 Apr 2018 07:28:25 +0000"  >&lt;p&gt;mailing list discusssion:&#160;&lt;a href=&quot;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Restart-strategy-defined-in-flink-conf-yaml-is-ignored-td19361.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Restart-strategy-defined-in-flink-conf-yaml-is-ignored-td19361.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16429282" author="yuqi" created="Sat, 7 Apr 2018 08:28:39 +0000"  >&lt;p&gt;As far as i know, if you set&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
env.enableCheckpointing(5000, CheckpointingMode.EXACTLY_ONCE);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;by default, flink will use `fixedDelayRestart`, see blow:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void configureCheckpointing() {
 CheckpointConfig cfg = streamGraph.getCheckpointConfig();

 &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; interval = cfg.getCheckpointInterval();
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (interval &amp;gt; 0) {
 &lt;span class=&quot;code-comment&quot;&gt;// check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a restart strategy has been set, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not then set the FixedDelayRestartStrategy
&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (streamGraph.getExecutionConfig().getRestartStrategy() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
 &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the user enabled checkpointing, the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; number of exec retries is infinite.
&lt;/span&gt; streamGraph.getExecutionConfig().setRestartStrategy(
 RestartStrategies.fixedDelayRestart(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE, DEFAULT_RESTART_DELAY));
 }
 } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
 &lt;span class=&quot;code-comment&quot;&gt;// interval of max value means disable periodic checkpoint
&lt;/span&gt; interval = &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.MAX_VALUE;
 }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So, this is not a bug, what&apos;s your option?&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16429285" author="zentol" created="Sat, 7 Apr 2018 09:19:40 +0000"  >&lt;p&gt;Yes itt is a bug:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;// check if a restart strategy has been set, if not then set the FixedDelayRestartStrategy&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This check completely ignores the configuration file, which it shouldn&apos;t do.&lt;/p&gt;</comment>
                            <comment id="16429590" author="yuqi" created="Sun, 8 Apr 2018 02:50:37 +0000"  >&lt;p&gt;En, Agree with you on this point &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;, I also wonder why flink ignores configuration file and set restart strategy to fixed delay if users do not set strategy explicitly in code no matter configuration file is. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; could you give us some hint ?&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; in jobmanger, flink will sets strategy according to configuraion file if users forget to set this option, see jobmanager.scala&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val restartStrategy =
 Option(jobGraph.getSerializedExecutionConfig()
 .deserializeValue(userCodeLoader)
 .getRestartStrategy())
 .map(RestartStrategyFactory.createRestartStrategy)
 .filter(p =&amp;gt; p != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) match {
 &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; Some(strategy) =&amp;gt; strategy
 &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; None =&amp;gt; restartStrategyFactory.createRestartStrategy()
 }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Back to this issue. restart strategy will be set to fixed delay if no one was set by flink client. as show above, at this time restartStrategy on the jobmanager will never be `None` and thus cause problem.&lt;/p&gt;</comment>
                            <comment id="16437604" author="till.rohrmann" created="Fri, 13 Apr 2018 17:17:58 +0000"  >&lt;p&gt;The problem is that we don&apos;t necessarily have the cluster configuration when we submit the job. Consequently, it is a priori not possible to decide whether the cluster has a default restart strategy or not.&lt;/p&gt;

&lt;p&gt;The underlying problem with the restart strategies is that the it is a cluster configuration as well as a job configuration option. I think it should only be a cluster configuration option. If we don&apos;t want break the behavior, then a solution could be to differentiate between an explicitly set job-specific restart strategy and the default job-specific restart strategy set when submitting a streaming job with checkpointing enabled.&lt;/p&gt;</comment>
                            <comment id="16438252" author="githubbot" created="Sat, 14 Apr 2018 06:22:28 +0000"  >&lt;p&gt;GitHub user yuqi1129 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9143&quot; title=&quot;Restart strategy defined in flink-conf.yaml is ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9143&quot;&gt;&lt;del&gt;FLINK-9143&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;client&amp;#93;&lt;/span&gt; Restart strategy defined in flink-conf.yaml is ignored&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is to fix the bug that if restart strategy was not specifically set in user code, flink will not use default strategy set in flink-conf.yaml in flip6 mode. &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In `ClusterClient.getJobGraph`, if no strategy was set in user code, we set strategy strategy just as flink-conf.yaml do&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add `ClusterClientTest.testgetJobGraph`&lt;/li&gt;
	&lt;li&gt;Add `FailureRateRestartStrategyTest.testFailureRateRestartStrategyConf` and `FixedDelayRestartStrategyTest.testFixedRestartStrategyConf`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/yuqi1129/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/yuqi1129/flink&lt;/a&gt; confproblem&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5846&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7c2a8045a310e2942f4fbec3b4a2696b73fae3af&lt;br/&gt;
Author: hzyuqi1 &amp;lt;hzyuqi1@...&amp;gt;&lt;br/&gt;
Date:   2018-04-14T05:45:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9143&quot; title=&quot;Restart strategy defined in flink-conf.yaml is ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9143&quot;&gt;&lt;del&gt;FLINK-9143&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;client&amp;#93;&lt;/span&gt; Restart strategy defined in flink-conf.yaml is ignored&lt;/p&gt;

&lt;p&gt;    This closes #9143.&lt;/p&gt;

&lt;p&gt;commit df23fbe809c2cbd025a923cd8607ec852d40b4ae&lt;br/&gt;
Author: hzyuqi1 &amp;lt;hzyuqi1@...&amp;gt;&lt;br/&gt;
Date:   2018-04-14T05:46:21Z&lt;/p&gt;

&lt;p&gt;    Merge branch &apos;master&apos; of &lt;a href=&quot;https://github.com/apache/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink&lt;/a&gt; into confproblem&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16438710" author="githubbot" created="Sun, 15 Apr 2018 13:45:55 +0000"  >&lt;p&gt;Github user yuqi1129 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann Can you help to look if this change is OK ? thanks&lt;/p&gt;</comment>
                            <comment id="16487057" author="githubbot" created="Wed, 23 May 2018 10:32:40 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @yuqi1129 Thank you for your contribution. &lt;/p&gt;

&lt;p&gt;    Did I understand this change correctly that it only affects situation when the checkpointing is disabled? Currently in this case the `RestartStrategy` will be set from cluster&apos;s `flink-conf.yaml`. After your change the cluster configuration will never be taken into account (neither with nor without checkpointing). Therefore I would be against merging it in current shape, as it does not address the original problem, but just changes only one of many corner cases.&lt;/p&gt;

&lt;p&gt;    What do you think about such strategy for resolving `RestartStrategy`?:&lt;/p&gt;

&lt;p&gt;    1. job config&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;set in code&lt;/li&gt;
	&lt;li&gt;client configuration&lt;/li&gt;
	&lt;li&gt;(no default, even in case of checkpointing)&lt;br/&gt;
    2. cluster config&lt;/li&gt;
	&lt;li&gt;cluster configuration (flink-conf)&lt;/li&gt;
	&lt;li&gt;default value = FixedDelayRestart (might be only in case of checkpointing)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16491687" author="yuqi" created="Sat, 26 May 2018 14:57:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; Thanks for your reviews.&lt;br/&gt;
```&lt;br/&gt;
Did I understand this change correctly that it only affects situation when the checkpointing is disabled?&lt;br/&gt;
```&lt;br/&gt;
Not really. What i change is when user do not set restart strategy in the flink code explicitly, then we will use strategy set in client configuration,  if not set in client configuration, we will use cluster configuration. &lt;/p&gt;

&lt;p&gt;```After your change the cluster configuration will never be taken into account (neither with nor without checkpointing).```&lt;/p&gt;

&lt;p&gt;Indeed, createRestartStrategyConfiguration will not return null even restart strategy was not set in client configuration, i have change the logic. and job manager will set this point when submit job as restart strategy is null.&lt;/p&gt;

&lt;p&gt;In mode before flip6, job manager have take cluster configuration of flink-conf.yaml effect, So, I only need to change job master in flip6.&lt;/p&gt;

&lt;p&gt;About your suggestion, i do agree on this point. may be &lt;br/&gt;
1. set in code&lt;br/&gt;
2. client configuration&lt;br/&gt;
3. cluster configuration&lt;br/&gt;
4. default/no default.&lt;/p&gt;

&lt;p&gt;if you have time, please help to review the change again.&lt;/p&gt;</comment>
                            <comment id="16492356" author="githubbot" created="Mon, 28 May 2018 07:40:45 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    One comment first. Please reply to review comments in github, otherwise it is hard to follow the discussion. Comments from github are posted to the jira issue automatically.&lt;/p&gt;

&lt;p&gt;    I still think your changes only affect the situation when checkpointing is disabled. If checkpointing is enabled the default strategy is set on the client side via: `ClusteClient#getJobGraph &amp;gt; StreamGraph#getJobGraph &amp;gt; StreamingJobGraphGenerator#createJobGraph &amp;gt; StreamingJobGraphGenerator#configureCheckpointing.&lt;/p&gt;</comment>
                            <comment id="16492386" author="githubbot" created="Mon, 28 May 2018 08:15:46 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191133405&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191133405&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java &amp;#8212;&lt;br/&gt;
    @@ -255,6 +264,35 @@ public void start() throws Exception {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 *&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Missing javadoc.&lt;/p&gt;</comment>
                            <comment id="16492387" author="githubbot" created="Mon, 28 May 2018 08:15:46 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191133512&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191133512&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java &amp;#8212;&lt;br/&gt;
    @@ -255,6 +264,35 @@ public void start() throws Exception {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param job  job graph&lt;br/&gt;
    +	 * @param configuration configuration in flink-conf.yaml&lt;br/&gt;
    +	 * @param isClusterPoint whether this is client side or cluster site&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void setJobgraphRestartStrategy(JobGraph job, Configuration configuration, boolean isClusterPoint) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Don&apos;t think it is the right place. Especially as it is used also on the client side. Maybe move to `JobGraph`?&lt;/p&gt;</comment>
                            <comment id="16492388" author="githubbot" created="Mon, 28 May 2018 08:15:46 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191133308&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191133308&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -896,6 +898,10 @@ public static JobGraph getJobGraph(Configuration flinkConfig, FlinkPlan optPlan,&lt;br/&gt;
     			job = gen.compileJobGraph((OptimizedPlan) optPlan);&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		//  if we disable checkpoint and do not set restart strategy, Restart strategy will be set as in flink-conf.yaml&lt;br/&gt;
    +		//  in flip6, jobmaster do not set this conf, so we have set this conf here.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Don&apos;t get this comment? Why do you say the jobmaster does not set it? &lt;/p&gt;</comment>
                            <comment id="16492389" author="githubbot" created="Mon, 28 May 2018 08:15:46 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191133623&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191133623&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java &amp;#8212;&lt;br/&gt;
    @@ -255,6 +264,35 @@ public void start() throws Exception {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param job  job graph&lt;br/&gt;
    +	 * @param configuration configuration in flink-conf.yaml&lt;br/&gt;
    +	 * @param isClusterPoint whether this is client side or cluster site&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void setJobgraphRestartStrategy(JobGraph job, Configuration configuration, boolean isClusterPoint) {&lt;br/&gt;
    +&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			ExecutionConfig config = job.getSerializedExecutionConfig().deserializeValue(&lt;br/&gt;
    +				Dispatcher.class.getClassLoader());&lt;br/&gt;
    +&lt;br/&gt;
    +			if (config.getRestartStrategy() == null) {&lt;br/&gt;
    +				RestartStrategies.RestartStrategyConfiguration restartStrategyConfiguration =&lt;br/&gt;
    +					RestartStrategyFactory.createRestartStrategyConfiguration(configuration);&lt;br/&gt;
    +&lt;br/&gt;
    +				//FixedDelay will be as default&lt;br/&gt;
    +				if (restartStrategyConfiguration == null &amp;amp;&amp;amp; isClusterPoint) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think in case the checkpointing is disabled the default strategy should be `noRestart`.&lt;/p&gt;</comment>
                            <comment id="16492390" author="githubbot" created="Mon, 28 May 2018 08:15:46 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191140799&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191140799&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java &amp;#8212;&lt;br/&gt;
    @@ -250,6 +259,35 @@ public void start() throws Exception {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param job  job graph&lt;br/&gt;
    +	 * @param configuration configuration in flink-conf.yaml&lt;br/&gt;
    +	 * @param isClusterPoint whether this is client side or cluster site&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void setJobgraphRestartStrategy(JobGraph job, Configuration configuration, boolean isClusterPoint) {&lt;br/&gt;
    +&lt;br/&gt;
    +		try {&lt;br/&gt;
    +			ExecutionConfig config = job.getSerializedExecutionConfig().deserializeValue(&lt;br/&gt;
    +				Dispatcher.class.getClassLoader());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You should use userclassloader here  (especially in case of cluster side)&lt;/p&gt;</comment>
                            <comment id="16492398" author="githubbot" created="Mon, 28 May 2018 08:28:05 +0000"  >&lt;p&gt;Github user yuqi1129 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191143746&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191143746&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -896,6 +898,10 @@ public static JobGraph getJobGraph(Configuration flinkConfig, FlinkPlan optPlan,&lt;br/&gt;
     			job = gen.compileJobGraph((OptimizedPlan) optPlan);&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		//  if we disable checkpoint and do not set restart strategy, Restart strategy will be set as in flink-conf.yaml&lt;br/&gt;
    +		//  in flip6, jobmaster do not set this conf, so we have set this conf here.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    before flip6, cluster site will set restart strategy:&lt;br/&gt;
    ```&lt;br/&gt;
        val restartStrategy =&lt;br/&gt;
              Option(jobGraph.getSerializedExecutionConfig()&lt;br/&gt;
                .deserializeValue(userCodeLoader)&lt;br/&gt;
                .getRestartStrategy())&lt;br/&gt;
                .map(RestartStrategyFactory.createRestartStrategy)&lt;br/&gt;
                .filter(p =&amp;gt; p != null) match &lt;/p&gt;
{
                case Some(strategy) =&amp;gt; strategy
                case None =&amp;gt; restartStrategyFactory.createRestartStrategy()
              }
&lt;p&gt;    ```&lt;br/&gt;
    in Jobmanger.java&lt;/p&gt;

&lt;p&gt;    in flip6, cluster will directly use jobgraph deserialized from client size&lt;/p&gt;</comment>
                            <comment id="16492399" author="githubbot" created="Mon, 28 May 2018 08:28:08 +0000"  >&lt;p&gt;Github user yuqi1129 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191143764&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191143764&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java &amp;#8212;&lt;br/&gt;
    @@ -255,6 +264,35 @@ public void start() throws Exception {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 *&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    OK&lt;/p&gt;</comment>
                            <comment id="16492400" author="githubbot" created="Mon, 28 May 2018 08:28:41 +0000"  >&lt;p&gt;Github user yuqi1129 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191143882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191143882&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java &amp;#8212;&lt;br/&gt;
    @@ -255,6 +264,35 @@ public void start() throws Exception {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param job  job graph&lt;br/&gt;
    +	 * @param configuration configuration in flink-conf.yaml&lt;br/&gt;
    +	 * @param isClusterPoint whether this is client side or cluster site&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void setJobgraphRestartStrategy(JobGraph job, Configuration configuration, boolean isClusterPoint) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    en. Indeed this is not a proper place&lt;/p&gt;</comment>
                            <comment id="16492423" author="githubbot" created="Mon, 28 May 2018 08:56:21 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191150742&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191150742&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -896,6 +898,10 @@ public static JobGraph getJobGraph(Configuration flinkConfig, FlinkPlan optPlan,&lt;br/&gt;
     			job = gen.compileJobGraph((OptimizedPlan) optPlan);&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		//  if we disable checkpoint and do not set restart strategy, Restart strategy will be set as in flink-conf.yaml&lt;br/&gt;
    +		//  in flip6, jobmaster do not set this conf, so we have set this conf here.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I am pretty sure the behaviour is still there. In JobMaster.java, or am I wrong?&lt;/p&gt;

&lt;p&gt;    	final RestartStrategies.RestartStrategyConfiguration restartStrategyConfiguration =&lt;br/&gt;
    			jobGraph.getSerializedExecutionConfig()&lt;br/&gt;
    					.deserializeValue(userCodeLoader)&lt;br/&gt;
    					.getRestartStrategy();&lt;/p&gt;

&lt;p&gt;    	this.restartStrategy = (restartStrategyConfiguration != null) ?&lt;br/&gt;
    			RestartStrategyFactory.createRestartStrategy(restartStrategyConfiguration) :&lt;br/&gt;
    			jobManagerSharedServices.getRestartStrategyFactory().createRestartStrategy();&lt;/p&gt;</comment>
                            <comment id="16492691" author="githubbot" created="Mon, 28 May 2018 13:49:19 +0000"  >&lt;p&gt;Github user yuqi1129 commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846#discussion_r191211627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846#discussion_r191211627&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-clients/src/main/java/org/apache/flink/client/program/ClusterClient.java &amp;#8212;&lt;br/&gt;
    @@ -896,6 +898,10 @@ public static JobGraph getJobGraph(Configuration flinkConfig, FlinkPlan optPlan,&lt;br/&gt;
     			job = gen.compileJobGraph((OptimizedPlan) optPlan);&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		//  if we disable checkpoint and do not set restart strategy, Restart strategy will be set as in flink-conf.yaml&lt;br/&gt;
    +		//  in flip6, jobmaster do not set this conf, so we have set this conf here.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You are right, I omit this point, sorry&lt;/p&gt;</comment>
                            <comment id="16513780" author="githubbot" created="Fri, 15 Jun 2018 12:53:44 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @yuqi1129 , do you still want to work on this?&lt;/p&gt;</comment>
                            <comment id="16516530" author="githubbot" created="Tue, 19 Jun 2018 01:42:46 +0000"  >&lt;p&gt;Github user yuqi1129 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dawidwys &lt;br/&gt;
    Sorry , I will push my code in two days,  if there still have any problem, any suggestions are appreciated. &lt;br/&gt;
    any way, if you have try to fix this problem, just go head.&lt;/p&gt;
</comment>
                            <comment id="16536604" author="githubbot" created="Mon, 9 Jul 2018 07:21:55 +0000"  >&lt;p&gt;GitHub user dawidwys opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9143&quot; title=&quot;Restart strategy defined in flink-conf.yaml is ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9143&quot;&gt;&lt;del&gt;FLINK-9143&lt;/del&gt;&lt;/a&gt; Use cluster strategy if none was set on client side&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    The goal of this PR is to enable configuring default restart strategy from the server side&apos;s config.&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;no strategy is set on the client side if none explicitly specified&lt;/li&gt;
	&lt;li&gt;on server side the strategy is resolved based on: client configuration, server side configuration, fallback to `FixedDelayStrategy` if none set on client side and `NoRestartStrategy` set on server side in case of checkpointing enabled&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;RestartStrategyResolvingTest.java&lt;/li&gt;
	&lt;li&gt;tests using cluster pass&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (*&lt;b&gt;yes&lt;/b&gt;* / no / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dawidwys/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dawidwys/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9143&quot; title=&quot;Restart strategy defined in flink-conf.yaml is ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9143&quot;&gt;&lt;del&gt;FLINK-9143&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6283&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8efded9c1e1a555edd7733b35d9f1f49f8cc7304&lt;br/&gt;
Author: Dawid Wysakowicz &amp;lt;dwysakowicz@...&amp;gt;&lt;br/&gt;
Date:   2018-07-05T11:48:23Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9143&quot; title=&quot;Restart strategy defined in flink-conf.yaml is ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9143&quot;&gt;&lt;del&gt;FLINK-9143&lt;/del&gt;&lt;/a&gt; Use cluster strategy if none was set on client side&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16541795" author="githubbot" created="Thu, 12 Jul 2018 15:10:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202013103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202013103&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/restart/RestartStrategyResolving.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,74 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.executiongraph.restart;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.restartstrategy.RestartStrategies;&lt;br/&gt;
    +&lt;br/&gt;
    +import javax.annotation.Nullable;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Utility method for resolving &lt;/p&gt;
{@link RestartStrategy}.&lt;br/&gt;
    + */&lt;br/&gt;
    +public final class RestartStrategyResolving {&lt;br/&gt;
    +&lt;br/&gt;
    +	private static final long DEFAULT_RESTART_DELAY = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Resolves which {@link RestartStrategy}
&lt;p&gt; to use. It should be used only on the server side.&lt;br/&gt;
    +	 * The resolving strategy is as follows:&lt;br/&gt;
    +	 * &amp;lt;ol&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Strategy set within job graph.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Strategy set flink-conf.yaml on the server set, unless is set to &lt;/p&gt;
{@link NoRestartStrategy}
&lt;p&gt; and checkpointing is enabled.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;If no strategy was set on client and server side and checkpointing was enabled then &lt;/p&gt;
{@link FixedDelayRestartStrategy}
&lt;p&gt; is used&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ol&amp;gt;&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param clientConfiguration    restart configuration given within the job graph&lt;br/&gt;
    +	 * @param serverStrategyFactory  default server side strategy factory&lt;br/&gt;
    +	 * @param isCheckpointingEnabled if checkpointing was enabled for the job&lt;br/&gt;
    +	 * @return resolved strategy&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static RestartStrategy resolve(&lt;br/&gt;
    +			@Nullable RestartStrategies.RestartStrategyConfiguration clientConfiguration,&lt;br/&gt;
    +			RestartStrategyFactory serverStrategyFactory,&lt;br/&gt;
    +			boolean isCheckpointingEnabled) {&lt;br/&gt;
    +&lt;br/&gt;
    +		final RestartStrategy serverSideRestartStrategy = serverStrategyFactory.createRestartStrategy();&lt;br/&gt;
    +&lt;br/&gt;
    +		RestartStrategy clientSideRestartStrategy = null;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    could be `final`&lt;/p&gt;</comment>
                            <comment id="16541796" author="githubbot" created="Thu, 12 Jul 2018 15:10:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202065050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202065050&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/executiongraph/restart/RestartStrategyResolvingTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,72 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.executiongraph.restart;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.time.Time;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.flink.api.common.restartstrategy.RestartStrategies.noRestart;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Tests for &lt;/p&gt;
{@link RestartStrategyResolving}
&lt;p&gt;.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class RestartStrategyResolvingTest {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Test classes should extend from `TestLogger` to give better test logging output separation.&lt;/p&gt;</comment>
                            <comment id="16541797" author="githubbot" created="Thu, 12 Jul 2018 15:10:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202012704&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202012704&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/restart/RestartStrategyResolving.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,74 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.executiongraph.restart;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.restartstrategy.RestartStrategies;&lt;br/&gt;
    +&lt;br/&gt;
    +import javax.annotation.Nullable;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Utility method for resolving &lt;/p&gt;
{@link RestartStrategy}.&lt;br/&gt;
    + */&lt;br/&gt;
    +public final class RestartStrategyResolving {&lt;br/&gt;
    +&lt;br/&gt;
    +	private static final long DEFAULT_RESTART_DELAY = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Resolves which {@link RestartStrategy}
&lt;p&gt; to use. It should be used only on the server side.&lt;br/&gt;
    +	 * The resolving strategy is as follows:&lt;br/&gt;
    +	 * &amp;lt;ol&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Strategy set within job graph.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Strategy set flink-conf.yaml on the server set, unless is set to &lt;/p&gt;
{@link NoRestartStrategy}
&lt;p&gt; and checkpointing is enabled.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;If no strategy was set on client and server side and checkpointing was enabled then &lt;/p&gt;
{@link FixedDelayRestartStrategy}
&lt;p&gt; is used&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ol&amp;gt;&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param clientConfiguration    restart configuration given within the job graph&lt;br/&gt;
    +	 * @param serverStrategyFactory  default server side strategy factory&lt;br/&gt;
    +	 * @param isCheckpointingEnabled if checkpointing was enabled for the job&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Please don&apos;t align the java doc strings. The problem is whenever someone changes the names of the parameters, he will be tempted to also correct the then wrong indentation which is unnecessary work. &lt;/p&gt;</comment>
                            <comment id="16541798" author="githubbot" created="Thu, 12 Jul 2018 15:10:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202070020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202070020&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/test/java/org/apache/flink/streaming/api/RestartStrategyTest.java &amp;#8212;&lt;br/&gt;
    @@ -33,12 +33,11 @@&lt;br/&gt;
     public class RestartStrategyTest extends TestLogger {&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Tests that in a streaming use case where checkpointing is enabled, a&lt;/li&gt;
	&lt;li&gt;* fixed delay with Integer.MAX_VALUE retries is instantiated if no other restart&lt;/li&gt;
	&lt;li&gt;* strategy has been specified.&lt;br/&gt;
    +	 * Tests that in a streaming use case where checkpointing is enabled, there is no default strategy set on the&lt;br/&gt;
    +	 * client side.&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Test&lt;/li&gt;
	&lt;li&gt;public void testAutomaticRestartingWhenCheckpointing() throws Exception {&lt;br/&gt;
    +	public void testNoDefaultStrategyOnClientSideWhenCheckpointing() throws Exception {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Maybe `testNoDefaultStrategyOnClientSideWhenCheckpointingEnabled`&lt;/p&gt;</comment>
                            <comment id="16541799" author="githubbot" created="Thu, 12 Jul 2018 15:10:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202065356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202065356&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/executiongraph/restart/RestartStrategyResolvingTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,72 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.executiongraph.restart;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.time.Time;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.flink.api.common.restartstrategy.RestartStrategies.noRestart;&lt;br/&gt;
    +import static org.junit.Assert.assertTrue;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Tests for &lt;/p&gt;
{@link RestartStrategyResolving}
&lt;p&gt;.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class RestartStrategyResolvingTest {&lt;br/&gt;
    +&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testClientSideHighestPriority() {&lt;br/&gt;
    +&lt;br/&gt;
    +		RestartStrategy resolvedStrategy = RestartStrategyResolving.resolve(noRestart(),&lt;br/&gt;
    +			new FixedDelayRestartStrategy.FixedDelayRestartStrategyFactory(2, 1000L),&lt;br/&gt;
    +			true);&lt;br/&gt;
    +&lt;br/&gt;
    +		assertTrue(resolvedStrategy instanceof NoRestartStrategy);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    For the future I would suggest to use Hamcrest matchers, because they give better failure messages and are more expressive.&lt;/p&gt;</comment>
                            <comment id="16541801" author="githubbot" created="Thu, 12 Jul 2018 15:10:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202070710&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202070710&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CoordinatorShutdownTest.java &amp;#8212;&lt;br/&gt;
    @@ -83,6 +86,10 @@ public void testCoordinatorShutsDownOnFailure() {&lt;br/&gt;
     						CheckpointRetentionPolicy.NEVER_RETAIN_AFTER_TERMINATION,&lt;br/&gt;
     						true),&lt;br/&gt;
     					null));&lt;br/&gt;
    +&lt;br/&gt;
    +			ExecutionConfig executionConfig = new ExecutionConfig();&lt;br/&gt;
    +			executionConfig.setRestartStrategy(RestartStrategies.fallBackRestart());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Should we maybe set the `FallbackRestartStrategyConfiguration` per default in the `ExecutionConfig`? That way, we could also simplify the resolve code.&lt;/p&gt;</comment>
                            <comment id="16541800" author="githubbot" created="Thu, 12 Jul 2018 15:10:56 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202071547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202071547&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/restart/RestartStrategyResolving.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,74 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.executiongraph.restart;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.restartstrategy.RestartStrategies;&lt;br/&gt;
    +&lt;br/&gt;
    +import javax.annotation.Nullable;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Utility method for resolving &lt;/p&gt;
{@link RestartStrategy}.&lt;br/&gt;
    + */&lt;br/&gt;
    +public final class RestartStrategyResolving {&lt;br/&gt;
    +&lt;br/&gt;
    +	private static final long DEFAULT_RESTART_DELAY = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Resolves which {@link RestartStrategy}
&lt;p&gt; to use. It should be used only on the server side.&lt;br/&gt;
    +	 * The resolving strategy is as follows:&lt;br/&gt;
    +	 * &amp;lt;ol&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Strategy set within job graph.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;Strategy set flink-conf.yaml on the server set, unless is set to &lt;/p&gt;
{@link NoRestartStrategy}
&lt;p&gt; and checkpointing is enabled.&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;li&amp;gt;If no strategy was set on client and server side and checkpointing was enabled then &lt;/p&gt;
{@link FixedDelayRestartStrategy}
&lt;p&gt; is used&amp;lt;/li&amp;gt;&lt;br/&gt;
    +	 * &amp;lt;/ol&amp;gt;&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param clientConfiguration    restart configuration given within the job graph&lt;br/&gt;
    +	 * @param serverStrategyFactory  default server side strategy factory&lt;br/&gt;
    +	 * @param isCheckpointingEnabled if checkpointing was enabled for the job&lt;br/&gt;
    +	 * @return resolved strategy&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static RestartStrategy resolve(&lt;br/&gt;
    +			@Nullable RestartStrategies.RestartStrategyConfiguration clientConfiguration,&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    By setting the default restart strategy to `FallbackRestartStrategyConfiguration` in the `ExecutionConfig` we could remove the `@Nullable` annotation here and simplify the code by avoiding the null checks.&lt;/p&gt;</comment>
                            <comment id="16541899" author="githubbot" created="Thu, 12 Jul 2018 16:27:38 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202098798&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202098798&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CoordinatorShutdownTest.java &amp;#8212;&lt;br/&gt;
    @@ -83,6 +86,10 @@ public void testCoordinatorShutsDownOnFailure() {&lt;br/&gt;
     						CheckpointRetentionPolicy.NEVER_RETAIN_AFTER_TERMINATION,&lt;br/&gt;
     						true),&lt;br/&gt;
     					null));&lt;br/&gt;
    +&lt;br/&gt;
    +			ExecutionConfig executionConfig = new ExecutionConfig();&lt;br/&gt;
    +			executionConfig.setRestartStrategy(RestartStrategies.fallBackRestart());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Right now null is a bit different than `FallbackRestartStrategy`. &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;null - allows fallback to `FixedRestartStrategy` in case of checkpointing enabled and `noRestart` was set on server-side&lt;/li&gt;
	&lt;li&gt;`FallbackRestartStrategy` - always the server-side strategy is used (indifferent to checkpointing)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    If we by default set the `FallbackStrategy` we have two options:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;we either always set `FixedRestartStrategy` if checkpointing is enabled and `noRestart` was set on server side&lt;/li&gt;
	&lt;li&gt;we never automatically fallback to `FixedRestartStrategy`, even in case of checkpointing.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    What do you think would be better option? Keep the null, always fallback to `FixedRestartStrategy` or never fallback to it?&lt;/p&gt;</comment>
                            <comment id="16541926" author="githubbot" created="Thu, 12 Jul 2018 16:44:07 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202103545&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202103545&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/checkpoint/CoordinatorShutdownTest.java &amp;#8212;&lt;br/&gt;
    @@ -83,6 +86,10 @@ public void testCoordinatorShutsDownOnFailure() {&lt;br/&gt;
     						CheckpointRetentionPolicy.NEVER_RETAIN_AFTER_TERMINATION,&lt;br/&gt;
     						true),&lt;br/&gt;
     					null));&lt;br/&gt;
    +&lt;br/&gt;
    +			ExecutionConfig executionConfig = new ExecutionConfig();&lt;br/&gt;
    +			executionConfig.setRestartStrategy(RestartStrategies.fallBackRestart());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You&apos;re right. I&apos;m just wondering whether you ever want to enable checkpointing without a restart strategy. So to speak if you set `FallbackRestartStrategy`, enable checkpointing and set `NoRestartStrategy` as the server side `RestartStrategy`, then do you want `FixedRestartStrategy` or `NoRestartStrategy`?&lt;/p&gt;

&lt;p&gt;    On the other hand you might want to disable restarting for all jobs running on your cluster by setting the restart strategy to `NoRestartStrategy`.&lt;/p&gt;

&lt;p&gt;    Maybe the proper solution would be to set `ExecutionConfig#restartStrategy` to `FallbackRestartStrategy` and introduce a new default server side restart strategy `NoOrFixedIfCheckpointingEnabled` which resolved to `FixedRestartStrategy` if checkpointing is enabled and if not it resolves to `NoRestartStrategy`.&lt;/p&gt;

&lt;p&gt;    What do you think?&lt;/p&gt;</comment>
                            <comment id="16542819" author="githubbot" created="Fri, 13 Jul 2018 10:05:54 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202298725&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202298725&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/jobmaster/JobMasterTest.java &amp;#8212;&lt;br/&gt;
    @@ -357,6 +362,42 @@ public void testRestoringFromSavepoint() throws Exception {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Tests that in a streaming use case where checkpointing is enabled, a&lt;br/&gt;
    +	 * fixed delay with Integer.MAX_VALUE retries is instantiated if no other restart&lt;br/&gt;
    +	 * strategy has been specified.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testAutomaticRestartingWhenCheckpointing() throws Exception {&lt;br/&gt;
    +		// create savepoint data&lt;br/&gt;
    +		final long savepointId = 42L;&lt;br/&gt;
    +		final File savepointFile = createSavepoint(savepointId);&lt;br/&gt;
    +&lt;br/&gt;
    +		// set savepoint settings&lt;br/&gt;
    +		final SavepointRestoreSettings savepointRestoreSettings = SavepointRestoreSettings.forPath(&lt;br/&gt;
    +			savepointFile.getAbsolutePath(),&lt;br/&gt;
    +			true);&lt;br/&gt;
    +		final JobGraph jobGraph = createJobGraphWithCheckpointing(savepointRestoreSettings);&lt;br/&gt;
    +&lt;br/&gt;
    +		final StandaloneCompletedCheckpointStore completedCheckpointStore = new StandaloneCompletedCheckpointStore(1);&lt;br/&gt;
    +		final TestingCheckpointRecoveryFactory testingCheckpointRecoveryFactory = new TestingCheckpointRecoveryFactory(&lt;br/&gt;
    +			completedCheckpointStore,&lt;br/&gt;
    +			new StandaloneCheckpointIDCounter());&lt;br/&gt;
    +		haServices.setCheckpointRecoveryFactory(testingCheckpointRecoveryFactory);&lt;br/&gt;
    +		final JobMaster jobMaster = createJobMaster(&lt;br/&gt;
    +			new Configuration(),&lt;br/&gt;
    +			jobGraph,&lt;br/&gt;
    +			haServices,&lt;br/&gt;
    +			new TestingJobManagerSharedServicesBuilder().build());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Changing this line into&lt;br/&gt;
    ```&lt;br/&gt;
    new TestingJobManagerSharedServicesBuilder()&lt;br/&gt;
    				.setRestartStrategyFactory(RestartStrategyFactory.createRestartStrategyFactory(configuration))&lt;br/&gt;
    				.build()&lt;br/&gt;
    ```&lt;br/&gt;
    Will make the test fail.&lt;/p&gt;</comment>
                            <comment id="16542820" author="githubbot" created="Fri, 13 Jul 2018 10:05:54 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202297182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202297182&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/restart/NoOrFixedIfCheckpointingEnabledRestartStrategy.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,87 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.runtime.executiongraph.restart;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.annotation.VisibleForTesting;&lt;br/&gt;
    +import org.apache.flink.configuration.Configuration;&lt;br/&gt;
    +import org.apache.flink.runtime.concurrent.ScheduledExecutor;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Default restart strategy that resolves either to &lt;/p&gt;
{@link NoRestartStrategy} or {@link FixedDelayRestartStrategy}&lt;br/&gt;
    + * depending if checkpointing was enabled.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class NoOrFixedIfCheckpointingEnabledRestartStrategy implements RestartStrategy {&lt;br/&gt;
    +&lt;br/&gt;
    +	private static final long DEFAULT_RESTART_DELAY = 0;&lt;br/&gt;
    +&lt;br/&gt;
    +	private final RestartStrategy resolvedStrategy;&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates a NoOrFixedIfCheckpointingEnabledRestartStrategyFactory instance.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param configuration Configuration object which is ignored&lt;br/&gt;
    +	 * @return NoOrFixedIfCheckpointingEnabledRestartStrategyFactory instance&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static NoOrFixedIfCheckpointingEnabledRestartStrategyFactory createFactory(Configuration configuration) {
    +		return new NoOrFixedIfCheckpointingEnabledRestartStrategyFactory();
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates instance of NoOrFixedIfCheckpointingEnabledRestartStrategy&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param isCheckpointingEnabled if true resolves to {@link FixedDelayRestartStrategy}&lt;br/&gt;
    +	 * otherwise to {@link NoRestartStrategy}
&lt;p&gt;    +	 */&lt;br/&gt;
    +	public NoOrFixedIfCheckpointingEnabledRestartStrategy(boolean isCheckpointingEnabled) {&lt;br/&gt;
    +		if (isCheckpointingEnabled) &lt;/p&gt;
{
    +			resolvedStrategy = new FixedDelayRestartStrategy(Integer.MAX_VALUE, DEFAULT_RESTART_DELAY);
    +		}
&lt;p&gt; else &lt;/p&gt;
{
    +			resolvedStrategy = new NoRestartStrategy();
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public boolean canRestart() &lt;/p&gt;
{
    +		return resolvedStrategy.canRestart();
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	@Override&lt;br/&gt;
    +	public void restart(RestartCallback restarter, ScheduledExecutor executor) &lt;/p&gt;
{
    +		resolvedStrategy.restart(restarter, executor);
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public static class NoOrFixedIfCheckpointingEnabledRestartStrategyFactory extends RestartStrategyFactory {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Wouldn&apos;t it be enough to only have this restart strategy factory without the corresponding `RestartStrategy`? We could instantiate the respective strategies in the `createRestartStrategy(boolean isCheckpointingEnabled)` method.&lt;/p&gt;</comment>
                            <comment id="16542821" author="githubbot" created="Fri, 13 Jul 2018 10:05:54 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202297327&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202297327&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/restart/RestartStrategyFactory.java &amp;#8212;&lt;br/&gt;
    @@ -149,7 +149,7 @@ public static RestartStrategyFactory createRestartStrategyFactory(Configuration&lt;br/&gt;
     				}&lt;/p&gt;

&lt;p&gt;     				// fallback in case of an error&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return NoRestartStrategy.createFactory(configuration);&lt;br/&gt;
    +				return NoOrFixedIfCheckpointingEnabledRestartStrategy.createFactory(configuration);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think we should also create this factory if the `restart-strategy` configuration value is `&quot;non&quot;` which is the default value.&lt;/p&gt;</comment>
                            <comment id="16542822" author="githubbot" created="Fri, 13 Jul 2018 10:05:54 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202304777&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202304777&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/JobGraph.java &amp;#8212;&lt;br/&gt;
    @@ -339,12 +339,28 @@ public void setSnapshotSettings(JobCheckpointingSettings settings) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Gets the settings for asynchronous snapshots. This method returns null, when&lt;/li&gt;
	&lt;li&gt;checkpointing is not enabled.&lt;br/&gt;
     	 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return The snapshot settings, or null, if checkpointing is not enabled.&lt;br/&gt;
    +	 * @return The snapshot settings&lt;br/&gt;
     	 */&lt;br/&gt;
     	public JobCheckpointingSettings getCheckpointingSettings() 
{
     		return snapshotSettings;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Checks if the checkpointing was enabled for this job graph&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return true if checkpointing enabled&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public boolean isCheckpointingEnabled() {&lt;br/&gt;
    +&lt;br/&gt;
    +		if (snapshotSettings == null) &lt;/p&gt;
{
    +			return false;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		long checkpointInterval = snapshotSettings.getCheckpointCoordinatorConfiguration().getCheckpointInterval();&lt;br/&gt;
    +		return checkpointInterval &amp;gt; 0 &amp;amp;&amp;amp;&lt;br/&gt;
    +			checkpointInterval &amp;lt; Long.MAX_VALUE;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think technically, we enable checkpointing, meaning creating a `CheckpointCoordinator`, always iff `snapshotSettings != null`. We could also say that we check the `CheckpointCoordinator.isPeriodicCheckpointingConfigured` in order to decide whether checkpointing is enabled. Then we would not need to introduce this method which could go out of sync with how we define whether checkpointing is enabled or not. What do you think?&lt;/p&gt;</comment>
                            <comment id="16542859" author="githubbot" created="Fri, 13 Jul 2018 10:35:33 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202311125&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202311125&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/restart/RestartStrategyFactory.java &amp;#8212;&lt;br/&gt;
    @@ -149,7 +149,7 @@ public static RestartStrategyFactory createRestartStrategyFactory(Configuration&lt;br/&gt;
     				}&lt;/p&gt;

&lt;p&gt;     				// fallback in case of an error&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return NoRestartStrategy.createFactory(configuration);&lt;br/&gt;
    +				return NoOrFixedIfCheckpointingEnabledRestartStrategy.createFactory(configuration);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Don&apos;t know why, but assumed the `default` branch is reached in case nothing was set in config. My mistake.&lt;/p&gt;

&lt;p&gt;    I&apos;ve fixed it to differentiate the situation when `&quot;none&quot;` was set (this value is used across documentation, I think it should translate directly to `NoRestart`) and when the config was not set at all.&lt;/p&gt;</comment>
                            <comment id="16542899" author="githubbot" created="Fri, 13 Jul 2018 11:18:05 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202319384&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202319384&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/jobgraph/JobGraph.java &amp;#8212;&lt;br/&gt;
    @@ -339,12 +339,28 @@ public void setSnapshotSettings(JobCheckpointingSettings settings) {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Gets the settings for asynchronous snapshots. This method returns null, when&lt;/li&gt;
	&lt;li&gt;checkpointing is not enabled.&lt;br/&gt;
     	 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return The snapshot settings, or null, if checkpointing is not enabled.&lt;br/&gt;
    +	 * @return The snapshot settings&lt;br/&gt;
     	 */&lt;br/&gt;
     	public JobCheckpointingSettings getCheckpointingSettings() 
{
     		return snapshotSettings;
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Checks if the checkpointing was enabled for this job graph&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return true if checkpointing enabled&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public boolean isCheckpointingEnabled() {&lt;br/&gt;
    +&lt;br/&gt;
    +		if (snapshotSettings == null) &lt;/p&gt;
{
    +			return false;
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		long checkpointInterval = snapshotSettings.getCheckpointCoordinatorConfiguration().getCheckpointInterval();&lt;br/&gt;
    +		return checkpointInterval &amp;gt; 0 &amp;amp;&amp;amp;&lt;br/&gt;
    +			checkpointInterval &amp;lt; Long.MAX_VALUE;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I don&apos;t think it is true (about the checkpoint enabling). I thought the same based on some javadocs, but it turned out that `snapshotSetting` is always set in `org.apache.flink.streaming.api.graph.StreamingJobGraphGenerator#configureCheckpointing`.&lt;br/&gt;
    That&apos;s why I added this method.&lt;/p&gt;

&lt;p&gt;    The problem with the second method is that the `CheckpointCoordinator` is created while constructing `ExecutionGraph` which requires the restartstrategy. I thought adding this method was the least invasive one.&lt;/p&gt;</comment>
                            <comment id="16542921" author="githubbot" created="Fri, 13 Jul 2018 11:25:27 +0000"  >&lt;p&gt;Github user dawidwys commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202320783&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202320783&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/jobmaster/JobMasterTest.java &amp;#8212;&lt;br/&gt;
    @@ -357,6 +362,42 @@ public void testRestoringFromSavepoint() throws Exception {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Tests that in a streaming use case where checkpointing is enabled, a&lt;br/&gt;
    +	 * fixed delay with Integer.MAX_VALUE retries is instantiated if no other restart&lt;br/&gt;
    +	 * strategy has been specified.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testAutomaticRestartingWhenCheckpointing() throws Exception {&lt;br/&gt;
    +		// create savepoint data&lt;br/&gt;
    +		final long savepointId = 42L;&lt;br/&gt;
    +		final File savepointFile = createSavepoint(savepointId);&lt;br/&gt;
    +&lt;br/&gt;
    +		// set savepoint settings&lt;br/&gt;
    +		final SavepointRestoreSettings savepointRestoreSettings = SavepointRestoreSettings.forPath(&lt;br/&gt;
    +			savepointFile.getAbsolutePath(),&lt;br/&gt;
    +			true);&lt;br/&gt;
    +		final JobGraph jobGraph = createJobGraphWithCheckpointing(savepointRestoreSettings);&lt;br/&gt;
    +&lt;br/&gt;
    +		final StandaloneCompletedCheckpointStore completedCheckpointStore = new StandaloneCompletedCheckpointStore(1);&lt;br/&gt;
    +		final TestingCheckpointRecoveryFactory testingCheckpointRecoveryFactory = new TestingCheckpointRecoveryFactory(&lt;br/&gt;
    +			completedCheckpointStore,&lt;br/&gt;
    +			new StandaloneCheckpointIDCounter());&lt;br/&gt;
    +		haServices.setCheckpointRecoveryFactory(testingCheckpointRecoveryFactory);&lt;br/&gt;
    +		final JobMaster jobMaster = createJobMaster(&lt;br/&gt;
    +			new Configuration(),&lt;br/&gt;
    +			jobGraph,&lt;br/&gt;
    +			haServices,&lt;br/&gt;
    +			new TestingJobManagerSharedServicesBuilder().build());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This was the problem with wrongly handling default value in `RestartStrategyFactory`. Fixed now.&lt;/p&gt;</comment>
                            <comment id="16542979" author="githubbot" created="Fri, 13 Jul 2018 12:28:34 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283#discussion_r202333518&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283#discussion_r202333518&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/graph/StreamingJobGraphGenerator.java &amp;#8212;&lt;br/&gt;
    @@ -567,22 +560,16 @@ private void configureCheckpointing() {&lt;/p&gt;

&lt;p&gt;     		long interval = cfg.getCheckpointInterval();&lt;br/&gt;
     		if (interval &amp;gt; 0) {&lt;br/&gt;
    -&lt;br/&gt;
     			ExecutionConfig executionConfig = streamGraph.getExecutionConfig();&lt;br/&gt;
     			// propagate the expected behaviour for checkpoint errors to task.&lt;br/&gt;
     			executionConfig.setFailTaskOnCheckpointError(cfg.isFailOnCheckpointingErrors());&lt;br/&gt;
    -&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// check if a restart strategy has been set, if not then set the FixedDelayRestartStrategy&lt;/li&gt;
	&lt;li&gt;if (executionConfig.getRestartStrategy() == null) 
{
    -				// if the user enabled checkpointing, the default number of exec retries is infinite.
    -				executionConfig.setRestartStrategy(
    -					RestartStrategies.fixedDelayRestart(Integer.MAX_VALUE, DEFAULT_RESTART_DELAY));
    -			}
&lt;p&gt;     		} else &lt;/p&gt;
{
     			// interval of max value means disable periodic checkpoint
     			interval = Long.MAX_VALUE;
     		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +&lt;br/&gt;
    +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Remove two line breaks&lt;/p&gt;</comment>
                            <comment id="16542988" author="githubbot" created="Fri, 13 Jul 2018 12:34:56 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks @tillrohrmann for review. I&apos;ve pushed one more commit that fixes test failure. It adds proper comparison of `RestartStrategies`, otherwise `org.apache.flink.api.common.ExecutionConfigTest#testExecutionConfigSerialization` fails.&lt;/p&gt;</comment>
                            <comment id="16542993" author="githubbot" created="Fri, 13 Jul 2018 12:38:36 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Alright, I think I fetched the last commit as well. Once Travis gives green light, I&apos;ll merge it.&lt;/p&gt;</comment>
                            <comment id="16544044" author="till.rohrmann" created="Sat, 14 Jul 2018 05:53:50 +0000"  >&lt;p&gt;Fixed via 57872d53c4584faace6dc8e4038ad1f2d068a453&lt;/p&gt;</comment>
                            <comment id="16544056" author="githubbot" created="Sat, 14 Jul 2018 05:54:48 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6283&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16754085" author="rmetzger" created="Mon, 28 Jan 2019 15:52:48 +0000"  >&lt;p&gt;&#160;I assume we can close this pull request as it has been fixed by now: &lt;a href=&quot;https://github.com/apache/flink/pull/5846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5846&lt;/a&gt;&#160;?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12917832" name="execution_config.png" size="102433" author="asmirnov" created="Fri, 6 Apr 2018 07:24:49 +0000"/>
                            <attachment id="12917830" name="jobmanager.log" size="5721" author="asmirnov" created="Fri, 6 Apr 2018 07:25:53 +0000"/>
                            <attachment id="12917831" name="jobmanager.png" size="128783" author="asmirnov" created="Fri, 6 Apr 2018 07:24:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s83b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>