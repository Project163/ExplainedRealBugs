<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31182] CompiledPlan cannot deserialize BridgingSqlFunction with MissingTypeStrategy</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31182</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This issue is reported from the &lt;a href=&quot;https://lists.apache.org/thread/y6fgzyx330omhkr40376knw8k4oczz3s&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;user mail list&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The stacktrace is&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Unable to find source-code formatter &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; language: text. Available languages are: actionscript, ada, applescript, bash, c, c#, c++, cpp, css, erlang, go, groovy, haskell, html, java, javascript, js, json, lua, none, nyan, objc, perl, php, python, r, rainbow, ruby, scala, sh, sql, swift, visualbasic, xml, yamlCaused by: org.apache.flink.table.api.TableException: Could not resolve internal system function &lt;span class=&quot;code-quote&quot;&gt;&apos;$UNNEST_ROWS$1&apos;&lt;/span&gt;. This is a bug, please file an issue.
&#160; &#160; at org.apache.flink.table.planner.plan.nodes.exec.serde.RexNodeJsonDeserializer.deserializeInternalFunction(RexNodeJsonDeserializer.java:392)
&#160; &#160; at org.apache.flink.table.planner.plan.nodes.exec.serde.RexNodeJsonDeserializer.deserializeSqlOperator(RexNodeJsonDeserializer.java:337)
&#160; &#160; at org.apache.flink.table.planner.plan.nodes.exec.serde.RexNodeJsonDeserializer.deserializeCall(RexNodeJsonDeserializer.java:307)
&#160; &#160; at org.apache.flink.table.planner.plan.nodes.exec.serde.RexNodeJsonDeserializer.deserialize(RexNodeJsonDeserializer.java:146)
&#160; &#160; at org.apache.flink.table.planner.plan.nodes.exec.serde.RexNodeJsonDeserializer.deserialize(RexNodeJsonDeserializer.java:128)
&#160; &#160; at org.apache.flink.table.planner.plan.nodes.exec.serde.RexNodeJsonDeserializer.deserialize(RexNodeJsonDeserializer.java:115) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The root cause is that although ModuleManager can resolve &apos;$UNNEST_ROWS$1&apos;, the output type strategy is &quot;Missing&quot;; as a result, FunctionCatalogOperatorTable#convertToBridgingSqlFunction returns empty.&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13055730/13055730_screenshot-1.png&quot; height=&quot;295&quot; width=&quot;675&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13525719">FLINK-31182</key>
            <summary>CompiledPlan cannot deserialize BridgingSqlFunction with MissingTypeStrategy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="twalthr">Timo Walther</assignee>
                                    <reporter username="qingyue">Jane Chan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 22 Feb 2023 10:17:21 +0000</created>
                <updated>Mon, 6 Mar 2023 14:33:13 +0000</updated>
                            <resolved>Mon, 6 Mar 2023 14:33:13 +0000</resolved>
                                    <version>1.17.0</version>
                    <version>1.18.0</version>
                    <version>1.17.1</version>
                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.16.2</fixVersion>
                    <fixVersion>1.18.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17692156" author="qingyue" created="Wed, 22 Feb 2023 12:03:34 +0000"  >&lt;p&gt;Correct me if I&apos;m wrong, but for all BultinFunctionDefinition with output type strategy as TypeStrategies.MISSING, the deserialization will fail. By removing the check, the execution of the deserialized plan is successful. However, I&apos;m not very sure about the purpose of the check. Can anyone shed some light?&lt;/p&gt;</comment>
                            <comment id="17692344" author="sergey nuyanzin" created="Wed, 22 Feb 2023 19:51:57 +0000"  >&lt;p&gt;it looks this code is present for a long time... Doesn&apos;t it work with older versions as well?&lt;br/&gt;
Or if it works with e.g. 1.16.x or 1.15.x then probably the reason in some other changes&lt;/p&gt;</comment>
                            <comment id="17692450" author="qingyue" created="Thu, 23 Feb 2023 02:24:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Sergey+Nuyanzin&quot; class=&quot;user-hover&quot; rel=&quot;Sergey Nuyanzin&quot;&gt;Sergey Nuyanzin&lt;/a&gt; Yes, the check on the output type inference strategy was introduced in FunctionCatalogTableOperator in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-15487&quot; title=&quot;Expose the new type inference for scalar functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-15487&quot;&gt;&lt;del&gt;FLINK-15487&lt;/del&gt;&lt;/a&gt; for FLIP-65 a long time ago.&lt;/p&gt;

&lt;p&gt;I guess it worked well before FLIP-190 was introduced because`LogicalUnnestRule` will infer the output type and convert UNNEST to EXPLODE. (see &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-table/flink-table-planner/src/main/scala/org/apache/flink/table/planner/plan/rules/logical/LogicalUnnestRule.scala#L99&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LogicalUnnestRule L#99&lt;/a&gt;). As a result, although the BuiltinFunctionDefinition for UNNEST always has a &quot;MISSING&quot; type inference, it does not affect the execution.&lt;/p&gt;

&lt;p&gt;However, after CompiledPlan is introduced, RexNodeJsonDeserializer relies on the OperatorTable to lookup functions, which always get a static placeholder (i.e. MISSING) for UNNEST, and due to this check, the deserialization failed.&#160;&lt;/p&gt;

&lt;p&gt;Could you help to take a look, cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17694035" author="twalthr" created="Mon, 27 Feb 2023 13:44:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=qingyue&quot; class=&quot;user-hover&quot; rel=&quot;qingyue&quot;&gt;qingyue&lt;/a&gt; I opened a PR. Would be great if you can help me with a review.&lt;/p&gt;</comment>
                            <comment id="17696532" author="qingyue" created="Sun, 5 Mar 2023 07:40:11 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;, thanks for the fix!&#160; LGTM, and feel free to merge.&lt;/p&gt;</comment>
                            <comment id="17696983" author="twalthr" created="Mon, 6 Mar 2023 14:33:13 +0000"  >&lt;p&gt;Fixed in master: 86e0a0b384291f9d8bacc3bbef3c58fcfb79bb04&lt;br/&gt;
Fixed in 1.17: 5c1ec1980b0adf24a1557119e6b28efa7fffe93e&lt;br/&gt;
Fixed in 1.16: d71a87dc722e2b311d929623d5715321a003353b&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13055730" name="screenshot-1.png" size="714044" author="qingyue" created="Wed, 22 Feb 2023 10:38:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1g3sw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>