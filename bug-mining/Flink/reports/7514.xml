<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:20:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-35358] Breaking change when loading artifacts</title>
                <link>https://issues.apache.org/jira/browse/FLINK-35358</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;We have been using the following code snippet in our Dockerfiles for running a Flink job in application mode&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
FROM flink:1.18.1-scala_2.12-java17

COPY --from=build /app/target/my-job*.jar /opt/flink/usrlib/artifacts/my-job.jar

USER flink &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Which has been working since at least around Flink 1.14, but the 1.19 update has broken our Dockerfiles. The fix is to put the jar file a step further out so the code snippet becomes&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
FROM flink:1.18.1-scala_2.12-java17

COPY --from=build /app/target/my-job*.jar /opt/flink/usrlib/my-job.jar

USER flink  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We have not spent too much time looking into what the cause is, but we get the stack trace&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
myjob-jobmanager-1 &#160; | org.apache.flink.util.FlinkException: Could not load the provided entrypoint class.
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.DefaultPackagedProgramRetriever.getPackagedProgram(DefaultPackagedProgramRetriever.java:230) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.container.entrypoint.StandaloneApplicationClusterEntryPoint.getPackagedProgram(StandaloneApplicationClusterEntryPoint.java:149) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.container.entrypoint.StandaloneApplicationClusterEntryPoint.lambda$main$0(StandaloneApplicationClusterEntryPoint.java:90) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.runtime.security.contexts.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:28) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.container.entrypoint.StandaloneApplicationClusterEntryPoint.main(StandaloneApplicationClusterEntryPoint.java:89) [flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | Caused by: org.apache.flink.client.program.ProgramInvocationException: The program&lt;span class=&quot;code-quote&quot;&gt;&apos;s entry point class &apos;&lt;/span&gt;my.company.job.MyJob&apos; was not found in the jar file.
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.PackagedProgram.loadMainClass(PackagedProgram.java:481) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.PackagedProgram.&amp;lt;init&amp;gt;(PackagedProgram.java:153) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.PackagedProgram.&amp;lt;init&amp;gt;(PackagedProgram.java:65) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.PackagedProgram$Builder.build(PackagedProgram.java:691) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.DefaultPackagedProgramRetriever.getPackagedProgram(DefaultPackagedProgramRetriever.java:228) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; ... 4 more
myjob-jobmanager-1 &#160; | Caused by: java.lang.ClassNotFoundException: my.company.job.MyJob
myjob-jobmanager-1 &#160; | &#160; &#160; at java.net.URLClassLoader.findClass(Unknown Source) ~[?:?]
myjob-jobmanager-1 &#160; | &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(Unknown Source) ~[?:?]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.util.FlinkUserCodeClassLoader.loadClassWithoutExceptionHandling(FlinkUserCodeClassLoader.java:67) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.util.ChildFirstClassLoader.loadClassWithoutExceptionHandling(ChildFirstClassLoader.java:74) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.util.FlinkUserCodeClassLoader.loadClass(FlinkUserCodeClassLoader.java:51) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(Unknown Source) ~[?:?]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.util.FlinkUserCodeClassLoaders$SafetyNetWrapperClassLoader.loadClass(FlinkUserCodeClassLoaders.java:197) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method) ~[?:?]
myjob-jobmanager-1 &#160; | &#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(Unknown Source) ~[?:?]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.PackagedProgram.loadMainClass(PackagedProgram.java:479) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.PackagedProgram.&amp;lt;init&amp;gt;(PackagedProgram.java:153) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.PackagedProgram.&amp;lt;init&amp;gt;(PackagedProgram.java:65) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.PackagedProgram$Builder.build(PackagedProgram.java:691) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; at org.apache.flink.client.program.DefaultPackagedProgramRetriever.getPackagedProgram(DefaultPackagedProgramRetriever.java:228) ~[flink-dist-1.19.0.jar:1.19.0]
myjob-jobmanager-1 &#160; | &#160; &#160; ... 4 more&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have changed some text in the stack trace to keep it anonymous so it is possible there is a typo but that is not the issue. As you can see, the stack trace leads to PackagedProgram and DefaultPackagedProgramRetriever to which the only commits after Flink 1.18 are &lt;a href=&quot;https://github.com/apache/flink/commit/d0ce5349fdf1a611518eba20a169c475ee0b46c5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PackagedProgram commit&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/flink/commit/e63aa12252843d0098a56f3091b28d48aff5b5af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;DefaultPackagedProgramRetriever commit&lt;/a&gt; and we suspect the culprit is the latter, specifically &lt;a href=&quot;https://github.com/apache/flink/commit/e63aa12252843d0098a56f3091b28d48aff5b5af#diff-11b5162d6745014c68e96303d26c71bdb88bac068c27834dbdbb7c9089ffbe9fL227&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this line&lt;/a&gt; which we think has made the artifact check non-recursive. We assume it is intended to have your artifacts directly in /opt/flink/usrlib without the artifacts directory so we are planning on changing that for our Dockerfiles anyway, but it is still a breaking change so we wanted to make an issue on it first.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13579335">FLINK-35358</key>
            <summary>Breaking change when loading artifacts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10200" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Not a Priority</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ferenc-csaky">Ferenc Csaky</assignee>
                                    <reporter username="rkth">Rasmus Thygesen</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 15 May 2024 07:55:09 +0000</created>
                <updated>Mon, 3 Jun 2024 07:46:59 +0000</updated>
                            <resolved>Thu, 30 May 2024 14:15:25 +0000</resolved>
                                    <version>1.19.0</version>
                                    <fixVersion>1.20.0</fixVersion>
                    <fixVersion>1.19.1</fixVersion>
                                    <component>Client / Job Submission</component>
                    <component>flink-docker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17846536" author="martijnvisser" created="Wed, 15 May 2024 08:04:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ferenc-csaky&quot; class=&quot;user-hover&quot; rel=&quot;ferenc-csaky&quot;&gt;ferenc-csaky&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbalassi&quot; class=&quot;user-hover&quot; rel=&quot;mbalassi&quot;&gt;mbalassi&lt;/a&gt; Any thoughts on this one?&lt;/p&gt;</comment>
                            <comment id="17846549" author="JIRAUSER302631" created="Wed, 15 May 2024 08:46:55 +0000"  >&lt;p&gt;I would like to add that we have a project where upgrading from Flink 1.18.1 to 1.19.0 right now would mean we have to make a new major release, however, if this gets fixed, it will only be a minor. We will wait a little bit to see what the Flink community agrees on &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17846647" author="ferenc-csaky" created="Wed, 15 May 2024 14:07:56 +0000"  >&lt;p&gt;This change was unintentional. Restricting JARs to only be put the root level of &lt;tt&gt;usrlib&lt;/tt&gt; seems an unnecessary boundary. I think your analysis is on point, but AFAIK whatever we do this only can be fixed in a Flink patch version, but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; correct me if I am wrong.&lt;/p&gt;

&lt;p&gt;The fix is easy, I can open a PR with the fix and added unit tests to cover this case by EOD today. So feel free to assign this to me.&lt;/p&gt;</comment>
                            <comment id="17846911" author="ferenc-csaky" created="Thu, 16 May 2024 11:07:04 +0000"  >&lt;p&gt;PR is opened against master and 1.19, CI run were successful for both.&lt;/p&gt;</comment>
                            <comment id="17846914" author="JIRAUSER302631" created="Thu, 16 May 2024 11:20:59 +0000"  >&lt;p&gt;Yep I saw it, code looks good to me. In your test, is it correct that you are setting the usrlib to the parent directory so it looks from /opt/flink instead of /opt/flink/usrlib and therefore it needs to search recursively to also find the artifacts inside /opt/flink/usrlib?&lt;/p&gt;</comment>
                            <comment id="17846991" author="ferenc-csaky" created="Thu, 16 May 2024 14:53:51 +0000"  >&lt;p&gt;In that test class all directories are generated before every test case, so it looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/wp/ccy48gw1255bswh9bx9svxjc0000gn/T/5ea4975f-13a5-47eb-a61f-4b1166e7f885/_user_dir_with_single_entry_class
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The JAR(s) are under the &lt;tt&gt;_user_dir_with_single_entry_class&lt;/tt&gt; dir, and even its parent is generated specifically for the test case, so it is safe to simply get the parent for testing the recursive file listing. These tests do not use the actual &lt;tt&gt;/opt/flink/usrlib&lt;/tt&gt; path at all.&lt;/p&gt;</comment>
                            <comment id="17847191" author="JIRAUSER302631" created="Fri, 17 May 2024 07:30:15 +0000"  >&lt;p&gt;Right, but the same idea with just searching the parent directory since that requires a recursive search. Cool way to test it and thanks a lot!&lt;/p&gt;</comment>
                            <comment id="17850727" author="hong" created="Thu, 30 May 2024 14:14:56 +0000"  >&lt;p&gt;&#160;merged commit &lt;a href=&quot;https://github.com/apache/flink/commit/853989bd862c31e0c74cd5a584177dc401c5a3d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;853989b&lt;/tt&gt;&lt;/a&gt; into   apache:master&lt;/p&gt;</comment>
                            <comment id="17850729" author="hong" created="Thu, 30 May 2024 14:15:10 +0000"  >&lt;p&gt;merged commit &lt;a href=&quot;https://github.com/apache/flink/commit/90a71a124771697a0b8b2c2bbc520856d6ae9e25&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;90a71a1&lt;/tt&gt;&lt;/a&gt; into   apache:release-1.19&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1p8e8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>