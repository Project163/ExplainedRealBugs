<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:22:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3253] deserializeObject exception on WindowOperator</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3253</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;It&apos;s seem that the data in the WindowOperator can serialize successfully. however deserialize failed when the taskmanager restarted by jobmanager. &lt;/p&gt;

&lt;p&gt;Root exception&lt;br/&gt;
java.lang.Exception: Could not restore checkpointed state to operators and functions&lt;br/&gt;
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreStateLazy(StreamTask.java:414)&lt;br/&gt;
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:208)&lt;br/&gt;
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:584)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:744)&lt;br/&gt;
Caused by: java.io.StreamCorruptedException: invalid type code: 00&lt;br/&gt;
	at java.io.ObjectInputStream$BlockDataInputStream.readBlockHeader(ObjectInputStream.java:2508)&lt;br/&gt;
	at java.io.ObjectInputStream$BlockDataInputStream.refill(ObjectInputStream.java:2543)&lt;br/&gt;
	at java.io.ObjectInputStream$BlockDataInputStream.read(ObjectInputStream.java:2615)&lt;br/&gt;
	at java.io.DataInputStream.readInt(DataInputStream.java:387)&lt;br/&gt;
	at java.io.ObjectInputStream$BlockDataInputStream.readInt(ObjectInputStream.java:2820)&lt;br/&gt;
	at java.io.ObjectInputStream.readInt(ObjectInputStream.java:971)&lt;br/&gt;
	at java.util.HashMap.readObject(HashMap.java:1158)&lt;br/&gt;
	at sun.reflect.GeneratedMethodAccessor29.invoke(Unknown Source)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:606)&lt;br/&gt;
	at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1017)&lt;br/&gt;
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1893)&lt;br/&gt;
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)&lt;br/&gt;
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)&lt;br/&gt;
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370)&lt;br/&gt;
	at org.apache.flink.util.InstantiationUtil.deserializeObject(InstantiationUtil.java:294)&lt;br/&gt;
	at org.apache.flink.streaming.runtime.operators.windowing.WindowOperator$Context.&amp;lt;init&amp;gt;(WindowOperator.java:446)&lt;br/&gt;
	at org.apache.flink.streaming.runtime.operators.windowing.WindowOperator.restoreState(WindowOperator.java:621)&lt;br/&gt;
	at org.apache.flink.streaming.runtime.tasks.StreamTask.restoreStateLazy(StreamTask.java:406)&lt;/p&gt;</description>
                <environment>&lt;p&gt;flink on yarn, hadoop 2.6&lt;br/&gt;
state backend: hdfs&lt;br/&gt;
jobmanager: high-availability&lt;/p&gt;</environment>
        <key id="12932165">FLINK-3253</key>
            <summary>deserializeObject exception on WindowOperator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10101">Abandoned</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="godfreyhe">godfrey he</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Jan 2016 14:18:26 +0000</created>
                <updated>Wed, 12 Oct 2016 18:13:52 +0000</updated>
                            <resolved>Wed, 12 Oct 2016 18:13:44 +0000</resolved>
                                    <version>0.10.0</version>
                                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15105419" author="aljoscha" created="Mon, 18 Jan 2016 15:18:57 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
could you please specify what kind of WindowAssigner/Trigger you are using so that I can investigate the problem.&lt;/p&gt;</comment>
                            <comment id="15106158" author="godfreyhe" created="Tue, 19 Jan 2016 02:48:20 +0000"  >&lt;p&gt;hi,&lt;/p&gt;

&lt;p&gt;I use tumbling time window with EventTimeTrigger, and add preAggregator parameter for the apply function. &lt;/p&gt;

&lt;p&gt;thank you&lt;/p&gt;</comment>
                            <comment id="15106480" author="aljoscha" created="Tue, 19 Jan 2016 09:30:22 +0000"  >&lt;p&gt;Hmm, there is actually a test case that verifies exactly that case and it works. Could you maybe provide a minimal  example so that I can reproduce the problem on my machine?&lt;/p&gt;</comment>
                            <comment id="15110687" author="godfreyhe" created="Thu, 21 Jan 2016 14:44:48 +0000"  >&lt;p&gt;It&apos;s seem that the exception was threw when the task manager was restarted. I also write some test cases, but It also works. All the objects in flink must be pojo class, or just need to  extends/implements Serializable interface?&lt;/p&gt;

&lt;p&gt;minimal example: read data(like: &apos;name&apos; &apos;timestamp&apos; &apos;value&apos;) from kafka, and assign event timestamp, aggregate the values of the same &apos;name&apos; each one minute.&lt;/p&gt;

&lt;p&gt;code: &lt;br/&gt;
StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();&lt;br/&gt;
env.setStreamTimeCharacteristic(TimeCharacteristic.EventTime);&lt;br/&gt;
env.getConfig().setAutoWatermarkInterval(1000);&lt;br/&gt;
env.enableCheckpointing(60000);&lt;br/&gt;
env.setStateBackend(new FsStateBackend(&quot;hdfs:///flink/checkpoints&quot;));&lt;/p&gt;

&lt;p&gt;env.addSource(new FlinkKafkaConsumer082(&quot;topic&quot;, new SimpleStringSchema(), properties))&lt;br/&gt;
        .flatMap(new FlatMapFunction&amp;lt;String, AggregatableDataPoint&amp;gt;() {&lt;br/&gt;
            @Override&lt;br/&gt;
            public void flatMap(String str, Collector&amp;lt;AggregatableDataPoint&amp;gt; out) &lt;/p&gt;
{
                String[] words = str.split(&quot; &quot;);
                String name = words[0];
                long timestamp = Long.valueOf(words[1]);
                double value = Double.valueOf(words[2]);
                Aggregator aggregator = Aggregators.get(&quot;sum&quot;);
                aggregator.addValue(value);
                out.collect(new AggregatableDataPoint(name, timestamp, aggregator));
            }
&lt;p&gt;        })&lt;br/&gt;
        .assignTimestamps(new TimestampExtractor&amp;lt;AggregatableDataPoint&amp;gt;() {&lt;br/&gt;
            @Override&lt;br/&gt;
            public long extractTimestamp(AggregatableDataPoint element, long currentTimestamp) &lt;/p&gt;
{
                return element.getTimestamp();
            }
&lt;p&gt;            @Override&lt;br/&gt;
            public long extractWatermark(AggregatableDataPoint element, long currentTimestamp) &lt;/p&gt;
{
                return Long.MIN_VALUE;
            }
&lt;p&gt;            @Override&lt;br/&gt;
            public long getCurrentWatermark() &lt;/p&gt;
{
                return System.currentTimeMillis() - 10000; // delay 10s
            }
&lt;p&gt;        })&lt;br/&gt;
        .keyBy(new KeySelector&amp;lt;AggregatableDataPoint, Tuple2&amp;lt;Long, String&amp;gt;&amp;gt;() {&lt;br/&gt;
            @Override&lt;br/&gt;
            public Tuple2&amp;lt;Long, String&amp;gt; getKey(AggregatableDataPoint dp) throws Exception &lt;/p&gt;
{
                Long time = dp.getTimestamp() / 60000; // aggregate data in 1 minute to 1 dp
                return new Tuple2&amp;lt;&amp;gt;(time, dp.getName());
            }
&lt;p&gt;        })&lt;br/&gt;
        .timeWindow(Time.of(60000, TimeUnit.MILLISECONDS))&lt;br/&gt;
        .apply(new ReduceFunction&amp;lt;AggregatableDataPoint&amp;gt;() {&lt;br/&gt;
            @Override&lt;br/&gt;
            public AggregatableDataPoint reduce(AggregatableDataPoint lastElement, AggregatableDataPoint curElement) throws Exception &lt;/p&gt;
{
                lastElement.aggregate(curElement.getValue());
                return lastElement; // always return first element
            }
&lt;p&gt;        }, new WindowFunction&amp;lt;AggregatableDataPoint, AggregatableDataPoint, Tuple2&amp;lt;Long, String&amp;gt;, TimeWindow&amp;gt;() {&lt;br/&gt;
            @Override&lt;br/&gt;
            public void apply(Tuple2&amp;lt;Long, String&amp;gt; key, TimeWindow window,  Iterable&amp;lt;AggregatableDataPoint&amp;gt; values, Collector&amp;lt;AggregatableDataPoint&amp;gt; out) throws Exception &lt;/p&gt;
{
                out.collect(values.iterator().next()); // only one element
            }
&lt;p&gt;        });&lt;br/&gt;
env.execute();&lt;/p&gt;


&lt;p&gt;public class AggregatableDataPoint implements DataPoint {&lt;br/&gt;
    private String name;&lt;br/&gt;
    private long timestamp;&lt;br/&gt;
    private Aggregator aggregator; // sum, avg ...&lt;/p&gt;

&lt;p&gt;    public AggregatableDataPoint(String name, long timestamp,&lt;br/&gt;
                                 Aggregator aggregator) &lt;/p&gt;
{
        this.name = name;
        this.timestamp = timestamp;
        this.aggregator = aggregator;
    }

&lt;p&gt;    public void aggregate(double value) &lt;/p&gt;
{
        this.aggregator.addValue(value);
    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;public interface DataPoint extends Serializable {&lt;br/&gt;
    String getName();&lt;br/&gt;
    long getTimestamp();&lt;br/&gt;
    double getValue();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;public interface Aggregator extends Serializable {&lt;br/&gt;
    void addValue(double value);&lt;br/&gt;
    double getValue();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;public class Aggregators {&lt;br/&gt;
    public static Aggregator get(final String name) {&lt;br/&gt;
        switch (name) &lt;/p&gt;
{
            case &quot;sum&quot;:
                return new Sum();
            default:
                throw new IllegalArgumentException(&quot;No such aggregator: &quot; + name);
        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    public static class Sum implements Aggregator {&lt;br/&gt;
        private double sum = 0;&lt;br/&gt;
        @Override&lt;br/&gt;
        public void addValue(double value) &lt;/p&gt;
{
            sum += value;
        }
&lt;p&gt;        @Override&lt;br/&gt;
        public double getValue() &lt;/p&gt;
{
            return sum;
        }
&lt;p&gt;    }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;thank you&lt;/p&gt;</comment>
                            <comment id="15134395" author="aljoscha" created="Fri, 5 Feb 2016 16:20:44 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;,&lt;br/&gt;
we recently changed the internals of the WindowOperator. Could you maybe check if your problem still persists? It would be much appreciated. &lt;/p&gt;</comment>
                            <comment id="15158264" author="godfreyhe" created="Tue, 23 Feb 2016 04:26:19 +0000"  >&lt;p&gt;is version 0.10.1 ?  thx~&lt;/p&gt;</comment>
                            <comment id="15158880" author="aljoscha" created="Tue, 23 Feb 2016 13:42:36 +0000"  >&lt;p&gt;in 0.10.x we did not change it, only 1.0-SNAPSHOT which will become 1.0 very soon.&lt;/p&gt;</comment>
                            <comment id="15569455" author="stephanewen" created="Wed, 12 Oct 2016 18:13:44 +0000"  >&lt;p&gt;The code for this part of the system changed completely, so that this issue is no longer applicable to the newer version of Flink.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rn5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>