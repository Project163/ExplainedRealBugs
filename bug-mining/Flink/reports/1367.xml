<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2821] Change Akka configuration to allow accessing actors from different URLs</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2821</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Akka expects the actor&apos;s URL to be exactly matching.&lt;/p&gt;

&lt;p&gt;As pointed out here, cases where users were complaining about this: &lt;a href=&quot;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Error-trying-to-access-JM-through-proxy-td3018.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Error-trying-to-access-JM-through-proxy-td3018.html&lt;/a&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Proxy routing (as described here, send to the proxy URL, receiver recognizes only original URL)&lt;/li&gt;
	&lt;li&gt;Using hostname / IP interchangeably does not work (we solved this by always putting IP addresses into URLs, never hostnames)&lt;/li&gt;
	&lt;li&gt;Binding to multiple interfaces (any local 0.0.0.0) does not work. Still no solution to that (but seems not too much of a restriction)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;I am aware that this is not possible due to Akka, so it is actually not a Flink bug. But I think we should track the resolution of the issue here anyways because its affecting our user&apos;s satisfaction.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12902556">FLINK-2821</key>
            <summary>Change Akka configuration to allow accessing actors from different URLs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Oct 2015 00:19:00 +0000</created>
                <updated>Wed, 2 Oct 2019 17:44:27 +0000</updated>
                            <resolved>Fri, 16 Dec 2016 17:04:40 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>12</watches>
                                                                                                                                                            <comments>
                            <comment id="15204553" author="mxm" created="Mon, 21 Mar 2016 16:35:55 +0000"  >&lt;p&gt;It is now possible to separate the bind address from the public address: &lt;a href=&quot;http://doc.akka.io/docs/akka/2.4.0/additional/faq.html#Why_are_replies_not_received_from_a_remote_actor_&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://doc.akka.io/docs/akka/2.4.0/additional/faq.html#Why_are_replies_not_received_from_a_remote_actor_&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have a fix but it requires to bump our Akka version from &lt;tt&gt;2.3.7&lt;/tt&gt; to &lt;tt&gt;2.4.x&lt;/tt&gt;. Now the big downer, Akka 2.4.x is NOT compatible with Scala 2.10 which is our default Scala version. Unless we upgrade to Scala 2.11, we won&apos;t be able to use this feature.&lt;/p&gt;

&lt;p&gt;In the meantime, what we could do is to explicitly offer this feature only for the 2.11 release and document that accordingly.&lt;/p&gt;</comment>
                            <comment id="15206810" author="stephanewen" created="Tue, 22 Mar 2016 17:13:24 +0000"  >&lt;p&gt;How about the following solution (multiple steps):&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We make the default Scala version from Flink 1.1 on Scala 2.11. That version is stable and many people seem to use it anyways (my impression from the mailing lists)&lt;/li&gt;
	&lt;li&gt;We make the default Akka version Akka 2.4.x&lt;/li&gt;
	&lt;li&gt;The &quot;change-scala-version.sh&quot; script needs to adjust both Scala and Akka versions.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;That way, the default (don&apos;t care which Scala version) releases would have a fix.&lt;br/&gt;
Specially downgraded versions would have the restriction.&lt;/p&gt;</comment>
                            <comment id="15206980" author="rmetzger" created="Tue, 22 Mar 2016 18:30:53 +0000"  >&lt;p&gt;That sounds like a very good idea!&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="15208366" author="mxm" created="Wed, 23 Mar 2016 12:59:12 +0000"  >&lt;p&gt;+1 Sounds like a good way to proceed.&lt;/p&gt;</comment>
                            <comment id="15268703" author="rmetzger" created="Tue, 3 May 2016 13:26:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, are you okay with me taking over these issues? my current task with kinesis is blocked on this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15268708" author="mxm" created="Tue, 3 May 2016 13:27:12 +0000"  >&lt;p&gt;Sure, go ahead!&lt;/p&gt;</comment>
                            <comment id="15270359" author="rmetzger" created="Wed, 4 May 2016 09:07:37 +0000"  >&lt;p&gt;I&apos;m stopping to work on these issues for now, because Akka 2.4 requires Java 8, and I don&apos;t think its feasible yet for us to move to Java 8.&lt;/p&gt;

&lt;p&gt;If (in a few years) somebody wants to pick up my work, here is my current branch: &lt;a href=&quot;https://github.com/rmetzger/flink/tree/flink-3662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rmetzger/flink/tree/flink-3662&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15270497" author="mxm" created="Wed, 4 May 2016 11:35:52 +0000"  >&lt;p&gt;Awww, that&apos;s unfortunate &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I wonder, would it make sense to maintain a custom Akka version with a simple patch to make the Netty bind address configurable? IMHO that would even be better than our existing approach to bundle Akka versions depending on the Scala version used. I would like to look into this at some point.&lt;/p&gt;</comment>
                            <comment id="15571405" author="philipp.bussche" created="Thu, 13 Oct 2016 09:27:48 +0000"  >&lt;p&gt;+1 for this feature. I am orchestrating my docker environment with something called Rancher (&lt;a href=&quot;http://rancher.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://rancher.com/&lt;/a&gt;). With this you might end up having 3 IP addresses a container can be accessed with (IP exposed to the host, docker IP and Rancher IP). Starting a jobmanager container via Rancher will make the RPC address be set to the Docker IP however if you want to use the Rancher DNS capabilities (which are quite cool), then you would communicate in your Rancher network (from taskmanager to jobmanager where taskmanager is also a container started under Rancher) using the Rancher IP. This however does not work at the moment. I worked around this for now by telling the taskmanager which Docker IP to connect to in order to reach the Jobmanager while starting it up but this however is not really nice when thinking about automation and using other capabilities of Rancher.&lt;br/&gt;
I can see this being quite a problem when using any orchestration on top of Docker ?!?&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="15571823" author="stephanewen" created="Thu, 13 Oct 2016 12:49:10 +0000"  >&lt;p&gt;I agree, it would be good to resolve that. It seems, though, that we are literally blocked by Akka on this. There seem to be these choices:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Abandon Java 7 (seems not a good idea at this point)&lt;/li&gt;
	&lt;li&gt;Abandon Akka (may be possible in future versions of Flink, after flip-6 and the new RPC abstraction is in)&lt;/li&gt;
	&lt;li&gt;Find a way to build a custom version of Akka 2.4 compatible with Java 7 (I know Robert tried, but it is quite hard)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Any suggestions and feedback more than welcome!&lt;/p&gt;</comment>
                            <comment id="15572174" author="mxm" created="Thu, 13 Oct 2016 15:01:10 +0000"  >&lt;p&gt;Just to add another option:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Apply the patch that enabled bind and listen address to the release-2.3 branch&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think that could be the most feasible and since we plan to drop Akka in the long run we&apos;re probably fine with staying on a 2.3-custom.&lt;/p&gt;</comment>
                            <comment id="15572364" author="mxm" created="Thu, 13 Oct 2016 16:12:18 +0000"  >&lt;p&gt;Just out of fun, I actually tried that and got the release-2.3 branch to fully build with the patch applied. It applied almost cleanly with one very minor modification.&lt;/p&gt;</comment>
                            <comment id="15572639" author="philipp.bussche" created="Thu, 13 Oct 2016 17:38:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; thats awesome ! That might work for me actually. I am happy to give this a try.&lt;/p&gt;</comment>
                            <comment id="15572671" author="stephanewen" created="Thu, 13 Oct 2016 17:50:04 +0000"  >&lt;p&gt;That&apos;s pretty amazing.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.bussche&quot; class=&quot;user-hover&quot; rel=&quot;philipp.bussche&quot;&gt;philipp.bussche&lt;/a&gt; do you have the time to try out building that custom version of akka (maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; can share the code), use that in Flink and see if it functions properly and solves your case?&lt;/p&gt;</comment>
                            <comment id="15572723" author="philipp.bussche" created="Thu, 13 Oct 2016 18:07:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; yes more than happy to try out building the version and using it in my Rancher environment.&lt;/p&gt;</comment>
                            <comment id="15574755" author="mxm" created="Fri, 14 Oct 2016 09:20:28 +0000"  >&lt;p&gt;Here you can find the custom release-2.3 branch of Akka: &lt;a href=&quot;https://github.com/mxm/akka/tree/release-2.3-custom&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/akka/tree/release-2.3-custom&lt;/a&gt;&lt;br/&gt;
It builds and all the tests ran successfully.&lt;/p&gt;

&lt;p&gt;We still have to expose the changes in the Flink configuration but I was actually working on this before. So expect an update pretty soon. Would be awesome if you could try the changes &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.bussche&quot; class=&quot;user-hover&quot; rel=&quot;philipp.bussche&quot;&gt;philipp.bussche&lt;/a&gt;. I&apos;ll provide some instructions.&lt;/p&gt;</comment>
                            <comment id="15575226" author="mxm" created="Fri, 14 Oct 2016 12:41:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.bussche&quot; class=&quot;user-hover&quot; rel=&quot;philipp.bussche&quot;&gt;philipp.bussche&lt;/a&gt; Which version of Flink do you want to use? I&apos;ve assembled a Flink 1.1.3 with a custom Akka version: &lt;a href=&quot;http://people.apache.org/~mxm/flink-1.1.3-custom.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~mxm/flink-1.1.3-custom.zip&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In flink-conf.yaml, you&apos;ll find two new address configuration entries which allow you to specify a bind address:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jobmanager.rpc.address: externalHostName
jobmanager.rpc.port: 6123
jobmanager.rpc.bind-address: localhost
jobmanager.rpc.bind-port: 6123
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Would be great if you could give it a try!&lt;/p&gt;</comment>
                            <comment id="15575240" author="mxm" created="Fri, 14 Oct 2016 12:49:26 +0000"  >&lt;p&gt;Forgot to mention, the build is based on the Hadoop 2.X and Scala 2.10.&lt;/p&gt;</comment>
                            <comment id="15575266" author="philipp.bussche" created="Fri, 14 Oct 2016 13:00:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; thanks, Flink 1.1.3 is perfect. I will give it a try and feed back. It will be in a few hours / tonight hopefully.&lt;/p&gt;</comment>
                            <comment id="15576002" author="philipp.bussche" created="Fri, 14 Oct 2016 17:47:41 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, here are my first test results. &lt;br/&gt;
I have built a container and am just for a first test running it with address set to localhost and bind-address set to the actual hostname (I ended up doing that because in Rancher it wouldn&apos;t start the container at all with address set to the Rancher DNS name and bind-address set to the docker host name - so this is the most simple test I could think of).&lt;br/&gt;
I am seeing this in the logfile of the jobmanager:&lt;/p&gt;

&lt;p&gt;2016-10-14 17:35:22,035 ERROR org.apache.flink.runtime.jobmanager.JobManager                - Failed to run JobManager.&lt;br/&gt;
java.lang.Exception: Could not create JobManager actor system&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$.startActorSystemAndJobManagerActors(JobManager.scala:2186)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$.runJobManager(JobManager.scala:2015)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$2.apply$mcV$sp(JobManager.scala:2078)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$2.apply(JobManager.scala:2056)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$2.apply(JobManager.scala:2056)&lt;br/&gt;
	at scala.util.Try$.apply(Try.scala:161)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$.retryOnBindException(JobManager.scala:2111)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$.runJobManager(JobManager.scala:2056)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$.main(JobManager.scala:1981)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager.main(JobManager.scala)&lt;br/&gt;
Caused by: java.lang.ClassNotFoundException: com.google.protobuf.GeneratedMessage&lt;br/&gt;
	at java.net.URLClassLoader.findClass(URLClassLoader.java:381)&lt;/p&gt;

&lt;p&gt;It is true that this class is not part of flink-dist_2.10-1.1.3.jar, well it is there but as part of the shaded packages.&lt;br/&gt;
I compared to my running container and this class is part of the jar file with the exact package structure in addition to the shaded structure.&lt;/p&gt;

&lt;p&gt;bash-4.3$ unzip -l flink-dist_2.10-1.1.3.jar | grep com.google.protobuf.GeneratedMessage&lt;br/&gt;
gives me a lot of these:&lt;br/&gt;
2006  10-14-16 14:29   org/apache/flink/hadoop/shaded/com/google/protobuf/GeneratedMessage$1.class&lt;br/&gt;
1203  10-14-16 14:29   org/apache/flink/hadoop/shaded/com/google/protobuf/GeneratedMessage$2.class&lt;br/&gt;
1665  10-14-16 14:29   org/apache/flink/hadoop/shaded/com/google/protobuf/GeneratedMessage$Builder$BuilderParentImpl.cla&lt;/p&gt;

&lt;p&gt;whereas on the running flink jobmanager&lt;br/&gt;
bash-4.3$ unzip -l flink-dist_2.11-1.1.3.jar | grep com.google.protobuf.GeneratedMessage&lt;br/&gt;
gives me also this:&lt;br/&gt;
1513  10-10-16 15:10   com/google/protobuf/GeneratedMessage$1.class&lt;br/&gt;
989  10-10-16 15:10   com/google/protobuf/GeneratedMessage$2.class&lt;br/&gt;
1296  10-10-16 15:10   com/google/protobuf/GeneratedMessage$Builder$BuilderParentImpl.class&lt;/p&gt;

&lt;p&gt;Note that on my running containers I am using Scala 2.11.&lt;/p&gt;</comment>
                            <comment id="15582605" author="mxm" created="Mon, 17 Oct 2016 15:57:45 +0000"  >&lt;p&gt;Thanks for testing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.bussche&quot; class=&quot;user-hover&quot; rel=&quot;philipp.bussche&quot;&gt;philipp.bussche&lt;/a&gt;. There was an issue with the dependency management of my custom build. I&apos;ve resolved the issue and would like to invite you to try again: &lt;a href=&quot;http://people.apache.org/~mxm/flink-1.1.3-custom-akka.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~mxm/flink-1.1.3-custom-akka.zip&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;With the new version, you should be able to run your containers. Next, we should resolve why you can&apos;t use the external address of the Rancher container and bind to the internal container address. What kind of error do you get?&lt;/p&gt;</comment>
                            <comment id="15582974" author="philipp.bussche" created="Mon, 17 Oct 2016 18:13:10 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, I am not getting this Exception anymore, however I don&apos;t think this is working yet.&lt;br/&gt;
I have to admit though that I had to change my environment slightly in which I am testing since I am currently travelling. I don&apos;t at the moment have access to the Rancher environment so I am purely bringing up a Docker container on my Mac within a (non-native) docker-machine which basically means I have a virtualbox virtual machine running on my Mac which runs the Docker daemon and from this virtual machine I am running my Docker containers at the moment. I do believe though that this test environment is quite similar to my initial test with Rancher. I have exposed port 6123 from the docker container to the host (aka the virtual machine).&lt;/p&gt;

&lt;p&gt;This happens on my non-customized 1.1.3 build (not the one you have created for me):&lt;br/&gt;
I am trying to access my Flink&apos;s jobmanager rpc address (doing a simple flink list from my Mac) like this:&lt;/p&gt;

&lt;p&gt;PHILIPPs-MacBook:~ philipp$ flink list --jobmanager 192.168.99.100:6123 # 192.168.99.100 is the docker host&apos;s IP / the IP of the virtual machine&lt;/p&gt;

&lt;p&gt;I am getting this error message after a while:&lt;/p&gt;

&lt;p&gt;Retrieving JobManager.&lt;br/&gt;
Using address /192.168.99.100:6123 to connect to JobManager.&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------&lt;br/&gt;
 The program finished with the following exception:&lt;/p&gt;

&lt;p&gt;org.apache.flink.runtime.leaderretrieval.LeaderRetrievalException: Could not retrieve the leader gateway&lt;br/&gt;
        at org.apache.flink.runtime.util.LeaderRetrievalUtils.retrieveLeaderGateway(LeaderRetrievalUtils.java:127)&lt;br/&gt;
        at org.apache.flink.client.program.ClusterClient.getJobManagerGateway(ClusterClient.java:644)&lt;br/&gt;
        at org.apache.flink.client.CliFrontend.getJobManagerGateway(CliFrontend.java:868)&lt;br/&gt;
        at org.apache.flink.client.CliFrontend.list(CliFrontend.java:387)&lt;br/&gt;
        at org.apache.flink.client.CliFrontend.parseParameters(CliFrontend.java:1008)&lt;br/&gt;
        at org.apache.flink.client.CliFrontend.main(CliFrontend.java:1048)&lt;br/&gt;
Caused by: java.util.concurrent.TimeoutException: Futures timed out after &lt;span class=&quot;error&quot;&gt;&amp;#91;10000 milliseconds&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at scala.concurrent.impl.Promise$DefaultPromise.ready(Promise.scala:219)&lt;br/&gt;
        at scala.concurrent.impl.Promise$DefaultPromise.result(Promise.scala:223)&lt;br/&gt;
        at scala.concurrent.Await$$anonfun$result$1.apply(package.scala:190)&lt;br/&gt;
        at scala.concurrent.BlockContext$DefaultBlockContext$.blockOn(BlockContext.scala:53)&lt;br/&gt;
        at scala.concurrent.Await$.result(package.scala:190)&lt;br/&gt;
        at scala.concurrent.Await.result(package.scala)&lt;br/&gt;
        at org.apache.flink.runtime.util.LeaderRetrievalUtils.retrieveLeaderGateway(LeaderRetrievalUtils.java:125)&lt;br/&gt;
        ... 5 more&lt;/p&gt;

&lt;p&gt;And in my Flink&apos;s jobmanager log file I am seeing this error message:&lt;/p&gt;

&lt;p&gt;2016-10-17 17:58:46,088 INFO  org.apache.flink.runtime.jobmanager.JobManager                - Starting JobManager at akka.tcp://flink@172.17.0.2:6123/user/jobmanager.&lt;br/&gt;
2016-10-17 17:58:46,108 INFO  org.apache.flink.runtime.clusterframework.standalone.StandaloneResourceManager  - Trying to associate with JobManager leader akka.tcp://flink@172.17.0.2:6123/user/jobmanager&lt;br/&gt;
2016-10-17 17:58:46,132 INFO  org.apache.flink.runtime.jobmanager.JobManager                - JobManager akka.tcp://flink@172.17.0.2:6123/user/jobmanager was granted leadership with leader session ID None.&lt;br/&gt;
2016-10-17 17:58:46,140 INFO  org.apache.flink.runtime.clusterframework.standalone.StandaloneResourceManager  - Resource Manager associating with leading JobManager Actor&lt;a href=&quot;#-1164381512&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;akka://flink/user/jobmanager#-1164381512&lt;/a&gt; - leader session null&lt;br/&gt;
2016-10-17 17:59:34,896 ERROR akka.remote.EndpointWriter                                    - dropping message &lt;span class=&quot;error&quot;&gt;&amp;#91;class akka.actor.ActorSelectionMessage&amp;#93;&lt;/span&gt; for non-local recipient [Actor&lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@192.168.99.100:6123/&amp;#93;&lt;/span&gt;] arriving at &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@192.168.99.100:6123&amp;#93;&lt;/span&gt; inbound addresses are &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@172.17.0.2:6123&amp;#93;&lt;/span&gt;&lt;br/&gt;
2016-10-17 17:59:45,052 WARN  akka.remote.ReliableDeliverySupervisor                        - Association with remote system &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@192.168.99.1:51492&amp;#93;&lt;/span&gt; has failed, address is now gated for &lt;span class=&quot;error&quot;&gt;&amp;#91;5000&amp;#93;&lt;/span&gt; ms. Reason is: &lt;span class=&quot;error&quot;&gt;&amp;#91;Disassociated&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;I would think that the difference between this and the Rancher approach would be that Rancher introduces this third IP address (10.x) which gets used when using the Rancher DNS name between containers in a Rancher environment.&lt;/p&gt;

&lt;p&gt;Anyways when I am using the custom version that you have sent me and I configure my jobmanager like this:&lt;/p&gt;

&lt;p&gt;jobmanager.rpc.address: 192.168.99.100&lt;br/&gt;
jobmanager.rpc.bind-address: da54c7ceaaa9 # container&apos;s host name resolving to the 172.x address&lt;br/&gt;
jobmanager.rpc.port: 6123&lt;br/&gt;
jobmanager.rpc.bind-port: 6123&lt;/p&gt;

&lt;p&gt;The jobmanager startup fails with a message like this in the log:&lt;/p&gt;

&lt;p&gt;2016-10-17 17:40:42,104 INFO  org.apache.flink.runtime.jobmanager.JobManager                - Starting JobManager on 192.168.99.100:6123 with execution mode CLUSTER&lt;br/&gt;
2016-10-17 17:40:42,169 INFO  org.apache.flink.runtime.jobmanager.JobManager                - Security is not enabled. Starting non-authenticated JobManager.&lt;br/&gt;
2016-10-17 17:40:42,174 INFO  org.apache.flink.util.NetUtils                                - Unable to allocate on port 6123, due to error: Address not available&lt;br/&gt;
2016-10-17 17:40:42,189 ERROR org.apache.flink.runtime.jobmanager.JobManager                - Failed to run JobManager.&lt;br/&gt;
java.lang.RuntimeException: Unable to do further retries starting the actor system&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager$.retryOnBindException(JobManager.scala:2116)&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager$.runJobManager(JobManager.scala:2056)&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager$.main(JobManager.scala:1981)&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager.main(JobManager.scala)&lt;/p&gt;

&lt;p&gt;As I said I am travelling at the moment and will be back home Wednesday night and I should be able to test more then.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="15589153" author="mxm" created="Wed, 19 Oct 2016 16:20:49 +0000"  >&lt;p&gt;Thanks a lot for the prompt feedback! You&apos;re right, it wasn&apos;t fully working yet. The problem was that there was some code still assuming that &lt;tt&gt;jobmanager.rpc.address&lt;/tt&gt; and &lt;tt&gt;jobmanager.rpc.port&lt;/tt&gt; would be available to listen or open a port on. I&apos;ve removed such checks because we clearly can&apos;t make any assumptions about that from within a container.&lt;/p&gt;

&lt;p&gt;Could you try one more time? I&apos;ve actually also tested it using a VM on my machine: &lt;a href=&quot;https://people.apache.org/~mxm/flink-1.1.3-custom-akka3.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://people.apache.org/~mxm/flink-1.1.3-custom-akka3.zip&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;edit: updated the URL&lt;/p&gt;</comment>
                            <comment id="15592357" author="philipp.bussche" created="Thu, 20 Oct 2016 16:57:28 +0000"  >&lt;p&gt;Thank you for all your effort &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;. I have tested this and was able to connect a jobmanager and a task manager in a docker-machine environment on my Mac as well as in Rancher. For the Rancher setup to work though I had to have the bind-address be set to 0.0.0.0 . I think this makes sense since Rancher introduces this additional 10.x address (on top of the 172.x address given by Docker) but when specifying the hostname as bind address it would only bind to the 172.x address.&lt;br/&gt;
One other thing which I realized was that my local flink cli on my Mac would not work together with your customer build anymore because of version discrepancies. I felt this is quite harsh given that I am running 1.1.3 on bother sides but obviously different builds.&lt;br/&gt;
I will play around with this a bit more and send some data across and let you know if I see anything else popping up.&lt;br/&gt;
Thanks again !&lt;/p&gt;</comment>
                            <comment id="15632332" author="mxm" created="Thu, 3 Nov 2016 10:34:10 +0000"  >&lt;p&gt;Glad to hear it&apos;s working, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.bussche&quot; class=&quot;user-hover&quot; rel=&quot;philipp.bussche&quot;&gt;philipp.bussche&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;I&apos;m curious to learn more about your network configuration. Can you actually access the resolved external IP address the Rancher DNS provides from within your Docker JobManager container? If so, wouldn&apos;t another solution for your problem be to pass the external IP as an environment variable to your Docker JobManager container upon creation?&lt;/p&gt;

&lt;p&gt;Of course we would have to provide support for setting the address through the environment variable. Still, that would be much easier than maintaining our custom Akka version.&lt;/p&gt;</comment>
                            <comment id="15659436" author="philipp.bussche" created="Sat, 12 Nov 2016 10:20:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; sorry for my late reply but it is good that you have asked these questions as I think I need to optimize my setup here a bit. Whenever my test server goes down (which it does quite a bit lately) then my flink services won&apos;t come up without manual intervention and I think that is not good.&lt;br/&gt;
Since I have forgotten some of the details of my setup myself I am just going to outline them again below:&lt;/p&gt;

&lt;p&gt;So I actually took the Dockerfile from the Flink contrib Github project as a basis.&lt;br/&gt;
In the Docker entrypoint I am doing this to set the JobManager listen address (I think this is still default):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sed -i -e &lt;span class=&quot;code-quote&quot;&gt;&quot;s/jobmanager.rpc.address: localhost/jobmanager.rpc.address: `hostname -f`/g&quot;&lt;/span&gt; $FLINK_HOME/conf/flink-conf.yaml&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So this actually leads to the JobManager doing this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Starting JobManager actor system at 172.17.0.23:6123&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The 172.x address would be the IP address coming from Docker.&lt;/p&gt;

&lt;p&gt;On my TaskManager container I obviously can access this address and I am actually having an environment variable set for this on the TaskManager that points to this address. However this is of course not really dynamic, in fact I have about 20 or so containers on my test system and after the last reboot of the server the Docker IP address changed (it was actually .24 before). So then this whole setup breaks kind of.&lt;/p&gt;

&lt;p&gt;Moving on to Rancher: you are able to define stacks (which is like a grouping for your containers). I have one stack for all my containers I need for doing data science things (well maybe thats a bit of overselling but anyways &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ). So the name of the service (that in Rancher is kind of another wrapper around a container so you say you have a service and it is using Docker image X and then if you need more than lets say one you scale the service up and down etc. and service can run on different hosts etc.) representing the JobManager functionality is flink-jobmanager. Now with the Rancher DNS I can access the service (and since I only have one active container essentially the container) by just connecting to &amp;lt;protocol&amp;gt;:flink-jobmanager . This is when I am creating the connection from within the same stack. If I was on my application stack and want to access flink directly (I don&apos;t because it goes from the webservice into Kafka first which is already on the same stack) I could connect via &amp;lt;protocol&amp;gt;:flink-jobmanager.analyticsstack.&lt;br/&gt;
Now this is quite cool because I can leave out any of those references to hosts etc via environment variables or parameters because I can be pretty sure that my other services/containers are always resolvable. However the resolution is done against the Rancher IP and the one for the JobManager in my setup currently is 10.42.9.68.&lt;/p&gt;

&lt;p&gt;So from my TaskManager container I can access all three of those IPs (the Host IP, the Docker IP and the Rancher IP) however I don&apos;t really want to go for the Host IP and the Docker IP because this would make things to static but when I have the JobManager bind on the Docker IP and try to connect to it via the Rancher IP then it complains. &lt;br/&gt;
On the other hand I can&apos;t have the JobManager bind on the Rancher IP because that is not available inside the Container, it is something available in the Rancher context that then gets mapped/forwarded onto Docker and the 172.x address.&lt;/p&gt;

&lt;p&gt;It seems I am currently not running the build where just patched the akka version but I remember I did for a while and it worked fine. I also think this would be the only way how this could work but I might be missing something. Thanks for looking into this !&lt;/p&gt;
</comment>
                            <comment id="15661367" author="melentye" created="Sun, 13 Nov 2016 11:51:01 +0000"  >&lt;p&gt;The custom akka 3 build of Flink 1.1.3 also resolves the problem with running Flink on Kubernetes: with vanilla 1.1.3 build the JobManager&apos;s Akka system would drop the messages from Task Managers because of the IP mismatch. I couldn&apos;t find a working combination of job manager.rpc.address values without making Kubernetes use fixed IP address for Job Manager which kind of ruins the whole idea. &lt;/p&gt;

&lt;p&gt;With the custom 1.1.3 build the following setup works.&lt;/p&gt;

&lt;h5&gt;&lt;a name=&quot;JobManagerflinkconf.yaml&quot;&gt;&lt;/a&gt;Job Manager flink-conf.yaml&lt;/h5&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jobmanager.rpc.address: jobmanager.flink.svc.cluster.local
jobmanager.rpc.port: 6123
jobmanager.rpc.bind-address: 0.0.0.0
jobmanager.rpc.bind-port: 6123
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;h5&gt;&lt;a name=&quot;TaskManagerflinkconf.yaml&quot;&gt;&lt;/a&gt;Task Manager flink-conf.yaml&lt;/h5&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jobmanager.rpc.address: jobmanager.flink.svc.cluster.local
jobmanager.rpc.port: 6123
jobmanager.rpc.bind-address: localhost # is this necessary on Task Manager side?
jobmanager.rpc.bind-port: 6123 # is this necessary on Task Manager side?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where jobmanager.flink.svc.cluster.local is the Kubernetes DNS record for the Job Manager service.&lt;/p&gt;

&lt;p&gt;Sources: &lt;a href=&quot;https://github.com/melentye/flink-kubernetes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/melentye/flink-kubernetes&lt;/a&gt; and &lt;a href=&quot;https://github.com/melentye/flink-docker/tree/custom-akka3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/melentye/flink-docker/tree/custom-akka3&lt;/a&gt; which is published as melentye/flink:1.1.3-custom-akka3 on &lt;a href=&quot;https://hub.docker.com/r/melentye/flink/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hub.docker.com/r/melentye/flink/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15675182" author="mxm" created="Thu, 17 Nov 2016 23:50:18 +0000"  >&lt;blockquote&gt;
&lt;p&gt;On the other hand I can&apos;t have the JobManager bind on the Rancher IP because that is not available inside the Container, it is something available in the Rancher context that then gets mapped/forwarded onto Docker and the 172.x address.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for clarifying. So we can&apos;t pass the Rancher address to the JobManager container through an environment variable. We simply can&apos;t resolve the correct address from the Rancher DNS from within the JobManager container; that makes the Akka patch necessary.&lt;/p&gt;
</comment>
                            <comment id="15675194" author="mxm" created="Thu, 17 Nov 2016 23:53:43 +0000"  >&lt;p&gt;Thanks for your feedback &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=melentye&quot; class=&quot;user-hover&quot; rel=&quot;melentye&quot;&gt;melentye&lt;/a&gt;! The bind settings are only read by the JobManager. No need to set them on the TaskManager side.&lt;/p&gt;</comment>
                            <comment id="15675221" author="mxm" created="Fri, 18 Nov 2016 00:04:48 +0000"  >&lt;p&gt;Thanks you for your answers, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.bussche&quot; class=&quot;user-hover&quot; rel=&quot;philipp.bussche&quot;&gt;philipp.bussche&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=melentye&quot; class=&quot;user-hover&quot; rel=&quot;melentye&quot;&gt;melentye&lt;/a&gt;. Very helpful!&lt;/p&gt;

&lt;p&gt;I&apos;m thinking about getting rid of the bind settings again and simply defaulting to &quot;0.0.0.0&quot; for the bind address. It seems that this is the only useful setting in an environment where we can&apos;t resolve the correct bind ip from within the JobManager container. The bind port setting might still be useful though.&lt;/p&gt;

&lt;p&gt;The only thing that might be missing is support for highly availability setups. Currently, we rely on the JobManager to publish its address to Zookeeper. If it uses (&lt;tt&gt;jobmanager.rpc.address&lt;/tt&gt;) there and never tries to resolve this address, we should be fine. I have to double check the code if that is actually the case.&lt;/p&gt;</comment>
                            <comment id="15676678" author="stephanewen" created="Fri, 18 Nov 2016 13:11:19 +0000"  >&lt;p&gt;+1 for getting rid of &lt;tt&gt;jobmanager.rpc.bind-address&lt;/tt&gt; and &lt;tt&gt;jobmanager.rpc.bind-por&lt;/tt&gt; and binding always to &lt;tt&gt;0.0.0.0&lt;/tt&gt; and having the same port and bind-port.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=melentye&quot; class=&quot;user-hover&quot; rel=&quot;melentye&quot;&gt;melentye&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.bussche&quot; class=&quot;user-hover&quot; rel=&quot;philipp.bussche&quot;&gt;philipp.bussche&lt;/a&gt; do you see any issues with that?&lt;/p&gt;</comment>
                            <comment id="15676689" author="stephanewen" created="Fri, 18 Nov 2016 13:16:20 +0000"  >&lt;p&gt;Concerning HA setups: Publishing the JobManager host name is necessary for discovery (ZooKeeper becomes the naming service effectively).&lt;br/&gt;
In Kubernetes and similar setups, there is already dynamic naming, so it is redundant, but should not harm.&lt;/p&gt;

&lt;p&gt;The only thing to think through is that we internally always replace host names by resolved IP addresses. That is important because akka makes an &quot;exact string match&quot; on the actor URLs, so we have to have a normalized format. We decided to go with IP addresses in the URL, because name resolution works better than reverse name lookups.&lt;/p&gt;</comment>
                            <comment id="15677009" author="philipp.bussche" created="Fri, 18 Nov 2016 15:55:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; I am not quite sure if this is going to work. So the IP of the orchestration framework I am using (Rancher) is exposing a 10.x IP address which is not available on the host itself (only the 172.x address from Docker). So what I have seen with binding previously was that when the host is binding to 172.x it would reject a request against a 10.x address. So if we think that it won&apos;t do that when binding on 0.0.0.0 then I am cool with the change &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
If this is too theoretical though I am more than happy to do more testing if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; wants to do the change.&lt;/p&gt;</comment>
                            <comment id="15679052" author="melentye" created="Sat, 19 Nov 2016 10:56:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; I think getting rid of &quot;bind&quot; params is a good idea: I don&apos;t really see a use case for a separate binding port and using 0.0.0.0 to bind to all interfaces seems to work too. The fewer parameters the better!&lt;/p&gt;

&lt;p&gt;As for the high availability, to be honest, I haven&apos;t though it through for Kubernetes yet. I tend to think that HA for Job Manager in K8S will be more similar to YARN case than to the standalone cluster case, i.e. it&apos;s gonna be up to Kubernetes to ensure there&apos;s a single Job Manager running and from the point of view of the Task Managers it can be abstracted by a DNS record.&lt;/p&gt;</comment>
                            <comment id="15690454" author="mxm" created="Wed, 23 Nov 2016 15:42:50 +0000"  >&lt;p&gt;My changes don&apos;t resolve the given hostname for the JobManager anymore. This is to make sure we provide Akka with a consistent hostname. This should work better in container scenarios than using IPs. Does Akka replace the given hostname upon lookup? I was under the assumption it uses the provided one. &lt;/p&gt;</comment>
                            <comment id="15690461" author="mxm" created="Wed, 23 Nov 2016 15:45:13 +0000"  >&lt;p&gt;Thanks for your feedback! I will open a pull request in the next days containing the additional changes, i.e. remove binding parameters and publish the correct address to Zookeeper.&lt;/p&gt;</comment>
                            <comment id="15712187" author="githubbot" created="Thu, 1 Dec 2016 14:57:51 +0000"  >&lt;p&gt;GitHub user mxm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2821&quot; title=&quot;Change Akka configuration to allow accessing actors from different URLs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2821&quot;&gt;&lt;del&gt;FLINK-2821&lt;/del&gt;&lt;/a&gt; use custom Akka build to listen on all interfaces&lt;/p&gt;

&lt;p&gt;    This uses Flakka (a custom Akka 2.3 build) to resolve the issue that&lt;br/&gt;
    the bind address needs to be matching the external address of the&lt;br/&gt;
    JobManager. With the changes applied, we can now bind to all&lt;br/&gt;
    interfaces, e.g. via 0.0.0.0 (IPv4) or :: (Ipv6).&lt;/p&gt;

&lt;p&gt;    For this to work properly, the configuration entry&lt;br/&gt;
    JOB_MANAGER_IPC_ADDRESS now represents the external address of the&lt;br/&gt;
    JobManager. Consequently, it should not be resolved to an IP address&lt;br/&gt;
    anymore because it may not be resolvable from within containered&lt;br/&gt;
    environments. Akka treats this address as the logical address. Any&lt;br/&gt;
    messages which are not tagged with this address will be received by&lt;br/&gt;
    the Actor System (because we listen on all interfaces) but will be&lt;br/&gt;
    dropped subsequently. In addition, we need the external address for&lt;br/&gt;
    the JobManager to be able to publish its address to Zookeeper for HA&lt;br/&gt;
    setups.&lt;/p&gt;

&lt;p&gt;    Flakka: &lt;a href=&quot;https://github.com/mxm/flakka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/flakka&lt;/a&gt; &lt;br/&gt;
    Patch applied: akka/akka#15610&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mxm/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2821&quot; title=&quot;Change Akka configuration to allow accessing actors from different URLs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2821&quot;&gt;&lt;del&gt;FLINK-2821&lt;/del&gt;&lt;/a&gt;.master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2917&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1ab82041f01df10b8e86da7e9b2696dd175f7e89&lt;br/&gt;
Author: Maximilian Michels &amp;lt;mxm@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-16T14:50:01Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2821&quot; title=&quot;Change Akka configuration to allow accessing actors from different URLs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2821&quot;&gt;&lt;del&gt;FLINK-2821&lt;/del&gt;&lt;/a&gt; use custom Akka build to listen on all interfaces&lt;/p&gt;

&lt;p&gt;    This uses Flakka (a custom Akka 2.3 build) to resolve the issue that&lt;br/&gt;
    the bind address needs to be matching the external address of the&lt;br/&gt;
    JobManager. With the changes applied, we can now bind to all&lt;br/&gt;
    interfaces, e.g. via 0.0.0.0 (IPv4) or :: (Ipv6).&lt;/p&gt;

&lt;p&gt;    For this to work properly, the configuration entry&lt;br/&gt;
    JOB_MANAGER_IPC_ADDRESS now represents the external address of the&lt;br/&gt;
    JobManager. Consequently, it should not be resolved to an IP address&lt;br/&gt;
    anymore because it may not be resolvable from within containered&lt;br/&gt;
    environments. Akka treats this address as the logical address. Any&lt;br/&gt;
    messages which are not tagged with this address will be received by&lt;br/&gt;
    the Actor System (because we listen on all interfaces) but will be&lt;br/&gt;
    dropped subsequently. In addition, we need the external address for&lt;br/&gt;
    the JobManager to be able to publish it to Zookeeper for HA setups.&lt;/p&gt;

&lt;p&gt;    Flakka: &lt;a href=&quot;https://github.com/mxm/flakka&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/flakka&lt;/a&gt; Patch applied:&lt;br/&gt;
    &lt;a href=&quot;https://github.com/akka/akka/pull/15610&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/akka/akka/pull/15610&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;commit 10b66ff80fec27102417e675c0e99cbad11abfc3&lt;br/&gt;
Author: Maximilian Michels &amp;lt;mxm@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-30T18:21:26Z&lt;/p&gt;

&lt;p&gt;    use staging repository for now&lt;/p&gt;

&lt;p&gt;commit 9b8059e1b7217f56fc277a9ac886dd6150190045&lt;br/&gt;
Author: Maximilian Michels &amp;lt;mxm@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-12-01T14:50:11Z&lt;/p&gt;

&lt;p&gt;    adapt config and test cases&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15712722" author="githubbot" created="Thu, 1 Dec 2016 18:45:52 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r90510382&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r90510382&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/util/NetUtils.java &amp;#8212;&lt;br/&gt;
    @@ -309,6 +313,19 @@ public static ServerSocket createSocketFromPorts(Iterator&amp;lt;Integer&amp;gt; portsIterator&lt;br/&gt;
     		return null;&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Returns the wildcard address to listen on all interfaces.&lt;br/&gt;
    +	 * @return Either 0.0.0.0 or :: depending on the IP setup.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static String getWildcardIPAddress() {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    You could move that code into a static initializer. That way you don&apos;t need to lock and check if it was set before.&lt;/p&gt;</comment>
                            <comment id="15712739" author="githubbot" created="Thu, 1 Dec 2016 18:50:32 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r90511221&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r90511221&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -1891,8 +1891,8 @@ object JobManager {&lt;br/&gt;
         // parsing the command line arguments&lt;br/&gt;
         val (configuration: Configuration,&lt;br/&gt;
              executionMode: JobManagerMode,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;listeningHost: String,&lt;/li&gt;
	&lt;li&gt;listeningPortRange: java.util.Iterator&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt;) =&lt;br/&gt;
    +         reachableHost: String,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    What does &quot;reachableHost&quot; mean here? I understand that it is not really the &quot;listeningHost&quot; any more (that is the wildcard address), but I don&apos;t understand what &quot;reachableHost&quot; should mean.&lt;/p&gt;</comment>
                            <comment id="15712791" author="githubbot" created="Thu, 1 Dec 2016 19:08:48 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It&apos;s a cool fix to help Flink run in container environments.&lt;/p&gt;

&lt;p&gt;    There is one concern I have with the code, though: Previously, we decided explicitly to encode IP addresses in the Akka URLs, because Akka requires an exact match of the host in the URL.&lt;/p&gt;

&lt;p&gt;    That has two problems:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All nodes need to agree to use either hostname or address. Enforcing to use the address was possible, enforcing to use the hostname not.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;More importantly: IPv6 has multiple valid representations of the same address. If different nodes have the same address but represent it as a string differently, the messages would not arrive. That&apos;s why we have a &quot;normalizing&quot; encoding step that makes sure all URLs would be the same. That step relied on translating&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I see two dangers now that may occur:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If different parts of the code or the JDK do a subtle change of behavior (i.e. resolve the InetAddress), then some nodes may have a hostname in the URL, others an address.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If two machines have a slightly different network configuration (especially concerning preferences to represent/encode IPv6 addresses) and the users set the IP address as the JobManager host, then they might create different Akka URLs and the machines cannot talk to each other again.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I am a bit unsure how to proceed from here. Is there any way we can keep using IP addresses in the Akka URLs? Or does that just inherently not make sense with &quot;dynamic hostnames&quot; as they are used in container environments?&lt;/p&gt;</comment>
                            <comment id="15714771" author="githubbot" created="Fri, 2 Dec 2016 10:47:00 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r90621698&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r90621698&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -1891,8 +1891,8 @@ object JobManager {&lt;br/&gt;
         // parsing the command line arguments&lt;br/&gt;
         val (configuration: Configuration,&lt;br/&gt;
              executionMode: JobManagerMode,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;listeningHost: String,&lt;/li&gt;
	&lt;li&gt;listeningPortRange: java.util.Iterator&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt;) =&lt;br/&gt;
    +         reachableHost: String,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    It is the consistent external hostname of the JobManager.&lt;/p&gt;</comment>
                            <comment id="15714774" author="githubbot" created="Fri, 2 Dec 2016 10:48:49 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r90621937&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r90621937&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -2729,11 +2727,11 @@ object JobManager {&lt;br/&gt;
       def getRemoteJobManagerAkkaURL(config: Configuration) : String = {&lt;br/&gt;
         val (protocol, hostname, port) = TaskManager.getAndCheckJobManagerAddress(config)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;var hostPort: InetSocketAddress = null&lt;br/&gt;
    +    var hostPort: InetSocketAddress = new InetSocketAddress(hostname, port)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    It is just a check to see if we expect messages from a resolvable hostname. It is not necessary to do that but I found test cases rely on that. Also, it improves error reporting for the user in case a non-resolvable hostname was chosen.&lt;/p&gt;</comment>
                            <comment id="15714835" author="githubbot" created="Fri, 2 Dec 2016 11:12:44 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for checking out the code!&lt;/p&gt;

&lt;p&gt;    &amp;gt;If different parts of the code or the JDK do a subtle change of behavior (i.e. resolve the InetAddress), then some nodes may have a hostname in the URL, others an address.&lt;/p&gt;

&lt;p&gt;    Fair point. Let&apos;s remove InetAddress and use a String instead.&lt;/p&gt;

&lt;p&gt;    &amp;gt;If two machines have a slightly different network configuration (especially concerning preferences to represent/encode IPv6 addresses) and the users set the IP address as the JobManager host, then they might create different Akka URLs and the machines cannot talk to each other again.&lt;/p&gt;

&lt;p&gt;    A problem of the old method was that hostnames might resolve differently depending on the container context. So that method was not reliable either. Using IP addresses will work with the new method. They just have to be consistent on all node configurations. I don&apos;t think that is a problem because a configuration is usually created once and then copied over to all nodes.&lt;/p&gt;

&lt;p&gt;    &amp;gt;I am a bit unsure how to proceed from here. Is there any way we can keep using IP addresses in the Akka URLs? Or does that just inherently not make sense with &quot;dynamic hostnames&quot; as they are used in container environments?&lt;/p&gt;

&lt;p&gt;    For this PR to address the core problems of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2821&quot; title=&quot;Change Akka configuration to allow accessing actors from different URLs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2821&quot;&gt;&lt;del&gt;FLINK-2821&lt;/del&gt;&lt;/a&gt;, we have to avoid resolving the hostname because the IP address would represent the internal container address which may be unreachable from the outside; even if it were resolvable, Akka would drop the messages because of its exact URL match policy. Using the hostname which now acts as a purely logical address ultimately is a more reliable way across different network environments. We just have to make sure we document the new requirement that the JobManager address (JOB_MANAGER_IPC_ADDRESS) is consistent across all Flink cluster nodes.&lt;/p&gt;
</comment>
                            <comment id="15714881" author="githubbot" created="Fri, 2 Dec 2016 11:31:49 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r90627441&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r90627441&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -1891,8 +1891,8 @@ object JobManager {&lt;br/&gt;
         // parsing the command line arguments&lt;br/&gt;
         val (configuration: Configuration,&lt;br/&gt;
              executionMode: JobManagerMode,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;listeningHost: String,&lt;/li&gt;
	&lt;li&gt;listeningPortRange: java.util.Iterator&lt;span class=&quot;error&quot;&gt;&amp;#91;Integer&amp;#93;&lt;/span&gt;) =&lt;br/&gt;
    +         reachableHost: String,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Agreed. I&apos;ve switched terms during some iterations on the changes. I think `externalHostname` is the better alternative.&lt;/p&gt;</comment>
                            <comment id="15714889" author="githubbot" created="Fri, 2 Dec 2016 11:35:54 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I have to dig back a bit (long time since I worked on that), but I thought the IPv6 addresses issue was quite tricky one and the normalization code for address representations was necessary.&lt;/p&gt;

&lt;p&gt;    Can we try and preserve both in some way? When a logical hostname is specified, we use that one in the Akka URLs. When an IP address is specified, we normalize it and use it.&lt;/p&gt;

&lt;p&gt;    That way we only &quot;loose&quot; the ability to use mixed hostname/IP-address configurations, but that would be okay, I guess.&lt;/p&gt;</comment>
                            <comment id="15715218" author="githubbot" created="Fri, 2 Dec 2016 14:09:40 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;Can we try and preserve both in some way? When a logical hostname is specified, we use that one in the Akka URLs. When an IP address is specified, we normalize it and use it.&lt;/p&gt;

&lt;p&gt;    Detecting whether we have an IPv4/IPv6 address or a hostname should be possible. Let me see if I can incorporate that in the PR.&lt;/p&gt;</comment>
                            <comment id="15723269" author="philipp.bussche" created="Mon, 5 Dec 2016 20:19:55 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, I wanted to give this a try but I am not sure if I am testing this correctly.&lt;br/&gt;
Do I just have to set jobmanager.rpc.address but to the hostname that will be used for access from outside ?&lt;br/&gt;
I tried to use a name that is not resolvable on the host itself and that fails but this is on my local docker environment and this should be different as soon as I move this to rancher.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="15723319" author="mxm" created="Mon, 5 Dec 2016 20:42:34 +0000"  >&lt;p&gt;Thanks for testing! The PR assumes that &lt;tt&gt;jobmanager.rpc.address&lt;/tt&gt; is resolvable in order to verify that it is a valid address. It doesn&apos;t use the resolved address. I understand that this is an assumption we have to move away from because there may be environments where the specified hostname is not resolvable from within the JobManager. There are some tests cases which rely on this behavior which I&apos;ll have to adapt.&lt;/p&gt;</comment>
                            <comment id="15726595" author="philipp.bussche" created="Tue, 6 Dec 2016 20:22:00 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;. This should then work nicely in my Rancher environment as the hostname I will use from the TaskManager to talk to the JobManager will be resolvable on the JobManager but my local docker-machine based environment on my Laptop seems to struggle with this as the hostname I am using here is not resolvable. Then again I am normally testing my Flink Jobs locally without the Docker/Rancher bits so I guess I am cool with the PR as it is. I will do more testing after tomorrow when I am back home.&lt;/p&gt;</comment>
                            <comment id="15731314" author="philipp.bussche" created="Thu, 8 Dec 2016 06:42:55 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, some more feedback on my testing back in the Rancher environment. The connection between TaskManager and JobManager via the Rancher DNS name is working now, however I still seem to have a slight problem deploying my Jobs.&lt;br/&gt;
I am doing this from Jenkins using the flink cli and running it with a hostname (It is still slightly different to what I have configured on the JobManager) seems to trigger an IP resolution and then it is trying to connect via IP rather than hostname and hence the cli is still blocked from connecting on the JobManager side.&lt;br/&gt;
Can we make it somehow that hostname and whatever this resolves to on the JobManager is allowed to connect ?&lt;/p&gt;

&lt;p&gt;Output from flink cli command:&lt;/p&gt;

&lt;p&gt;flink list --jobmanager flink-jobmanager.analyticsstack:6123&lt;br/&gt;
Retrieving JobManager.&lt;br/&gt;
Using address /10.42.202.225:6123 to connect to JobManager.&lt;/p&gt;

&lt;p&gt;------------------------------------------------------------&lt;br/&gt;
 The program finished with the following exception:&lt;/p&gt;

&lt;p&gt;org.apache.flink.runtime.leaderretrieval.LeaderRetrievalException: Could not retrieve the leader gateway&lt;br/&gt;
	at org.apache.flink.runtime.util.LeaderRetrievalUtils.retrieveLeaderGateway(LeaderRetrievalUtils.java:127)&lt;/p&gt;

&lt;p&gt;Output from jobamanager logfile:&lt;/p&gt;

&lt;p&gt;2016-12-08 06:39:27,581 ERROR akka.remote.EndpointWriter                                    - dropping message &lt;span class=&quot;error&quot;&gt;&amp;#91;class akka.actor.ActorSelectionMessage&amp;#93;&lt;/span&gt; for non-local recipient [Actor&lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@10.42.202.225:6123/&amp;#93;&lt;/span&gt;] arriving at &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@10.42.202.225:6123&amp;#93;&lt;/span&gt; inbound addresses are &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@flink-jobmanager:6123&amp;#93;&lt;/span&gt;&lt;br/&gt;
2016-12-08 06:39:37,711 WARN  akka.remote.ReliableDeliverySupervisor                        - Association with remote system &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@172.17.0.6:46589&amp;#93;&lt;/span&gt; has failed, address is now gated for &lt;span class=&quot;error&quot;&gt;&amp;#91;5000&amp;#93;&lt;/span&gt; ms. Reason: &lt;span class=&quot;error&quot;&gt;&amp;#91;Disassociated&amp;#93;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="15731744" author="mxm" created="Thu, 8 Dec 2016 10:11:45 +0000"  >&lt;p&gt;Thanks for testing again! I&apos;ve already fixed the issue you mentioned in the latest version which I will push to the PR later today. &lt;/p&gt;

&lt;p&gt;The new version never touches hostnames but tries to resolve IP addresses if it finds one to make sure that different IP formats, e.g. IPv6 are consistently resolved.&lt;/p&gt;</comment>
                            <comment id="15732925" author="githubbot" created="Thu, 8 Dec 2016 18:05:58 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StephanEwen I&apos;ve updated the pull request to incorporate your suggestions. When an IPv6 address is specified, we format it like in the current code base. When a hostname is specified, we do some simple validation but do not resolve it. IPv4 addresses are simply used as-is. &lt;/p&gt;

&lt;p&gt;    I hope that this PR becomes more mergeable in this state. With the help of some eager users we can further test this in a cluster environment.&lt;/p&gt;</comment>
                            <comment id="15734537" author="philipp.bussche" created="Fri, 9 Dec 2016 06:58:49 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; this is working for me now. I tested again and am purely using Rancher DNS names now as well as can deploy my jobs from my build service. There are two things I still had to do which was a) to also update the flink version on my build slave so it seems the client also got some changes and b) to exactly match the hostname when connecting e.g. from the client. So in Rancher a host can be reached by hostname.stackname where in my case stackname was in camel case and then I also had to use camel case to connect from the client to the jobmanager because otherwise the jobmanager would again refuse.&lt;br/&gt;
Anyways this looks quite good now and I will test further with this. Thanks again for the help !&lt;/p&gt;</comment>
                            <comment id="15734969" author="mxm" created="Fri, 9 Dec 2016 10:46:50 +0000"  >&lt;p&gt;I appreciate your timely feedback! &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I also had to use camel case to connect from the client to the jobmanager because otherwise the jobmanager would again refuse.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point! We should convert the jobmanager hostname to lower case to avoid that.&lt;/p&gt;</comment>
                            <comment id="15737849" author="philipp.bussche" created="Sat, 10 Dec 2016 13:09:27 +0000"  >&lt;p&gt;Just looking into another use case where communication with the jobmanager is required but where the client is actually not part of the Rancher or Docker environment. So for that I would not use the hostname specified as rpc address, well I could not. This is a use case I am seeing when deploying the jobmanager lets say to AWS but I want to deploy the jobs from my on prem build system. The jobmanager (container) has a name that is resolveable from the Internet but since it is also part of the Rancher network I have it listen on the Rancher DNS name. This makes sense so that JobManager and TaskManager will only communicate within the Rancher network but still I have to from outside deploy the jobs and would do that via the Internet host name. However I would then have the JobManager registered to the Internet host name and subsequently the taskmanager would also have to use that name.&lt;br/&gt;
So for this now to work I would need the JobManager to accept communications on at least two rpc addresses. I still don&apos;t quite understand why this is being verified anyways, why not just serve any connection as long as it hits the right port ?&lt;/p&gt;</comment>
                            <comment id="15741890" author="mxm" created="Mon, 12 Dec 2016 13:29:40 +0000"  >&lt;p&gt;Wouldn&apos;t it work to use the &quot;Internet host name&quot; for all communication?&lt;/p&gt;

&lt;p&gt;The exact host name match is a restriction of the Akka RPC library. There is not much we can do about it; at least for now until we replace Akka. The patch enables us to bind to all interfaces but we still have to use a single &quot;logical&quot; address.&lt;/p&gt;</comment>
                            <comment id="15751532" author="githubbot" created="Thu, 15 Dec 2016 14:38:46 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92620428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92620428&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/akka/AkkaUtils.scala &amp;#8212;&lt;br/&gt;
    @@ -102,21 +102,24 @@ object AkkaUtils {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;specified, then the actor system will listen on the respective address.&lt;br/&gt;
        *&lt;/li&gt;
	&lt;li&gt;@param configuration instance containing the user provided configuration values&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param listeningAddress optional tuple of hostname and port to listen on. If None is given,&lt;/li&gt;
	&lt;li&gt;*                         then an Akka config for local actor system will be returned&lt;br/&gt;
    +   * @param externalAddress optional tuple of hostname and port to be reachable at.&lt;br/&gt;
    +   *                        If None is given, then an Akka config for local actor system&lt;br/&gt;
    +   *                        will be returned&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@return Akka config&lt;br/&gt;
        */&lt;br/&gt;
       @throws(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;UnknownHostException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
       def getAkkaConfig(configuration: Configuration,&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;listeningAddress: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, Int)&amp;#93;&lt;/span&gt;): Config = {&lt;br/&gt;
    +                    externalAddress: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, Int)&amp;#93;&lt;/span&gt;): Config = {&lt;br/&gt;
         val defaultConfig = getBasicAkkaConfig(configuration)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;listeningAddress match {&lt;br/&gt;
    +    externalAddress match {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;           case Some((hostname, port)) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val ipAddress = InetAddress.getByName(hostname)&lt;/li&gt;
	&lt;li&gt;val hostString = &quot;\&quot;&quot; + NetUtils.ipAddressToUrlString(ipAddress) + &quot;\&quot;&quot;&lt;/li&gt;
	&lt;li&gt;val remoteConfig = getRemoteAkkaConfig(configuration, hostString, port)&lt;br/&gt;
    +&lt;br/&gt;
    +        val remoteConfig = getRemoteAkkaConfig(configuration,&lt;br/&gt;
    +          NetUtils.getWildcardIPAddress, port,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Maybe we could add a comment here that we choose the wildcard ip to bind to all network interfaces.&lt;/p&gt;</comment>
                            <comment id="15751583" author="githubbot" created="Thu, 15 Dec 2016 15:02:03 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92625229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92625229&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/pom.xml &amp;#8212;&lt;br/&gt;
    @@ -193,8 +193,8 @@ under the License.&lt;br/&gt;
     		&amp;lt;/dependency&amp;gt;&lt;/p&gt;

&lt;p&gt;     		&amp;lt;dependency&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&amp;lt;groupId&amp;gt;com.typesafe.akka&amp;lt;/groupId&amp;gt;&lt;/li&gt;
	&lt;li&gt;&amp;lt;artifactId&amp;gt;akka-testkit_${scala.binary.version}&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
    +			&amp;lt;groupId&amp;gt;com.data-artisans&amp;lt;/groupId&amp;gt;&lt;br/&gt;
    +			&amp;lt;artifactId&amp;gt;flakka-testkit_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think this dependency be in `test` scope.&lt;/p&gt;</comment>
                            <comment id="15751592" author="githubbot" created="Thu, 15 Dec 2016 15:05:10 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92625848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92625848&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/akka/AkkaUtils.scala &amp;#8212;&lt;br/&gt;
    @@ -216,12 +219,19 @@ object AkkaUtils {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;identified by hostname.&lt;br/&gt;
        *&lt;/li&gt;
	&lt;li&gt;@param configuration instance containing the user provided configuration values&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param hostname of the network interface to listen on&lt;br/&gt;
    +   * @param hostname of the network interface to bind on&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param port to bind to or if 0 then Akka picks a free port automatically&lt;br/&gt;
    +   * @param externalHostname The host name to expect for Akka messages&lt;br/&gt;
    +   * @param externalPort The port to expect for Akka messages&lt;/li&gt;
	&lt;li&gt;@return Flink&apos;s Akka configuration for remote actor systems&lt;br/&gt;
        */&lt;br/&gt;
       private def getRemoteAkkaConfig(configuration: Configuration,&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;hostname: String, port: Int): Config = {&lt;br/&gt;
    +                                  hostname: String, port: Int,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Would be good to call `hostname` here `bind address`.&lt;/p&gt;</comment>
                            <comment id="15751596" author="githubbot" created="Thu, 15 Dec 2016 15:06:41 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92626161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92626161&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/util/NetUtils.java &amp;#8212;&lt;br/&gt;
    @@ -111,7 +115,51 @@ public static int getAvailablePort() {&lt;br/&gt;
     	// ------------------------------------------------------------------------&lt;br/&gt;
     	//  Encoding of IP addresses for URLs&lt;br/&gt;
     	// ------------------------------------------------------------------------&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;p&gt;    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Returns an address in a normalized format for Akka.&lt;br/&gt;
    +	 * When an IPv6 address is specified, it normalizes the IPv6 address to avoid&lt;br/&gt;
    +	 * complications with the exact URL match policy of Akka.&lt;br/&gt;
    +	 * @param host The hostname, IPv4 or IPv6 address&lt;br/&gt;
    +	 * @return host which will be normalized if it is an IPv6 address&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static String unresolvedHostToNormalizedString(String host) {&lt;br/&gt;
    +		// Return loopback interface address if host is null&lt;br/&gt;
    +		// This represents the behavior of &lt;/p&gt;
{@code InetAddress.getByName }
&lt;p&gt; and RFC 3330&lt;br/&gt;
    +		if (host == null) &lt;/p&gt;
{
    +			host = InetAddress.getLoopbackAddress().getHostAddress();
    +		}
&lt;p&gt; else &lt;/p&gt;
{
    +			host = host.trim().toLowerCase();
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		// normalize and valid address&lt;br/&gt;
    +		if (IPAddressUtil.isIPv6LiteralAddress(host)) &lt;/p&gt;
{
    +			byte[] ipV6Address = IPAddressUtil.textToNumericFormatV6(host);
    +			host = getIPv6UrlRepresentation(ipV6Address);
    +		}
&lt;p&gt; else if (!IPAddressUtil.isIPv4LiteralAddress(host)) {&lt;br/&gt;
    +			// We don&apos;t allow these in hostnames&lt;br/&gt;
    +			Preconditions.checkArgument(!host.startsWith(&quot;.&quot;));&lt;br/&gt;
    +			Preconditions.checkArgument(!host.endsWith(&quot;.&quot;));&lt;br/&gt;
    +			Preconditions.checkArgument(!host.contains(&quot;:&quot;));&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Maybe we could add a clarifying error message here for the user.&lt;/p&gt;</comment>
                            <comment id="15751598" author="githubbot" created="Thu, 15 Dec 2016 15:07:46 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92626387&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92626387&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/akka/AkkaUtils.scala &amp;#8212;&lt;br/&gt;
    @@ -216,12 +219,19 @@ object AkkaUtils {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;identified by hostname.&lt;br/&gt;
        *&lt;/li&gt;
	&lt;li&gt;@param configuration instance containing the user provided configuration values&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param hostname of the network interface to listen on&lt;br/&gt;
    +   * @param hostname of the network interface to bind on&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param port to bind to or if 0 then Akka picks a free port automatically&lt;br/&gt;
    +   * @param externalHostname The host name to expect for Akka messages&lt;br/&gt;
    +   * @param externalPort The port to expect for Akka messages&lt;/li&gt;
	&lt;li&gt;@return Flink&apos;s Akka configuration for remote actor systems&lt;br/&gt;
        */&lt;br/&gt;
       private def getRemoteAkkaConfig(configuration: Configuration,&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;hostname: String, port: Int): Config = {&lt;br/&gt;
    +                                  hostname: String, port: Int,&lt;br/&gt;
    +                                  externalHostname: String, externalPort: Int): Config = {&lt;br/&gt;
    +&lt;br/&gt;
    +    LOG.info(s&quot;Using binding address $hostname:$port&quot; +
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Not too bad here, but in general, I think having loggers in util classes is not a very good idea. It typically leads to the log lines showing up very often and at strange places. The information should usually be logged by the caller of the functions.&lt;/p&gt;</comment>
                            <comment id="15751950" author="githubbot" created="Thu, 15 Dec 2016 17:29:33 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92658254&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92658254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/akka/AkkaUtils.scala &amp;#8212;&lt;br/&gt;
    @@ -102,21 +102,24 @@ object AkkaUtils {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;specified, then the actor system will listen on the respective address.&lt;br/&gt;
        *&lt;/li&gt;
	&lt;li&gt;@param configuration instance containing the user provided configuration values&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param listeningAddress optional tuple of hostname and port to listen on. If None is given,&lt;/li&gt;
	&lt;li&gt;*                         then an Akka config for local actor system will be returned&lt;br/&gt;
    +   * @param externalAddress optional tuple of hostname and port to be reachable at.&lt;br/&gt;
    +   *                        If None is given, then an Akka config for local actor system&lt;br/&gt;
    +   *                        will be returned&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@return Akka config&lt;br/&gt;
        */&lt;br/&gt;
       @throws(classOf&lt;span class=&quot;error&quot;&gt;&amp;#91;UnknownHostException&amp;#93;&lt;/span&gt;)&lt;br/&gt;
       def getAkkaConfig(configuration: Configuration,&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;listeningAddress: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, Int)&amp;#93;&lt;/span&gt;): Config = {&lt;br/&gt;
    +                    externalAddress: Option&lt;span class=&quot;error&quot;&gt;&amp;#91;(String, Int)&amp;#93;&lt;/span&gt;): Config = {&lt;br/&gt;
         val defaultConfig = getBasicAkkaConfig(configuration)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;listeningAddress match {&lt;br/&gt;
    +    externalAddress match {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;           case Some((hostname, port)) =&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val ipAddress = InetAddress.getByName(hostname)&lt;/li&gt;
	&lt;li&gt;val hostString = &quot;\&quot;&quot; + NetUtils.ipAddressToUrlString(ipAddress) + &quot;\&quot;&quot;&lt;/li&gt;
	&lt;li&gt;val remoteConfig = getRemoteAkkaConfig(configuration, hostString, port)&lt;br/&gt;
    +&lt;br/&gt;
    +        val remoteConfig = getRemoteAkkaConfig(configuration,&lt;br/&gt;
    +          NetUtils.getWildcardIPAddress, port,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="15751957" author="githubbot" created="Thu, 15 Dec 2016 17:31:27 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92658704&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92658704&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/akka/AkkaUtils.scala &amp;#8212;&lt;br/&gt;
    @@ -216,12 +219,19 @@ object AkkaUtils {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;identified by hostname.&lt;br/&gt;
        *&lt;/li&gt;
	&lt;li&gt;@param configuration instance containing the user provided configuration values&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param hostname of the network interface to listen on&lt;br/&gt;
    +   * @param hostname of the network interface to bind on&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param port to bind to or if 0 then Akka picks a free port automatically&lt;br/&gt;
    +   * @param externalHostname The host name to expect for Akka messages&lt;br/&gt;
    +   * @param externalPort The port to expect for Akka messages&lt;/li&gt;
	&lt;li&gt;@return Flink&apos;s Akka configuration for remote actor systems&lt;br/&gt;
        */&lt;br/&gt;
       private def getRemoteAkkaConfig(configuration: Configuration,&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;hostname: String, port: Int): Config = {&lt;br/&gt;
    +                                  hostname: String, port: Int,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +1&lt;/p&gt;</comment>
                            <comment id="15751968" author="githubbot" created="Thu, 15 Dec 2016 17:35:04 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92659443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92659443&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/akka/AkkaUtils.scala &amp;#8212;&lt;br/&gt;
    @@ -216,12 +219,19 @@ object AkkaUtils {&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;identified by hostname.&lt;br/&gt;
        *&lt;/li&gt;
	&lt;li&gt;@param configuration instance containing the user provided configuration values&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @param hostname of the network interface to listen on&lt;br/&gt;
    +   * @param hostname of the network interface to bind on&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param port to bind to or if 0 then Akka picks a free port automatically&lt;br/&gt;
    +   * @param externalHostname The host name to expect for Akka messages&lt;br/&gt;
    +   * @param externalPort The port to expect for Akka messages&lt;/li&gt;
	&lt;li&gt;@return Flink&apos;s Akka configuration for remote actor systems&lt;br/&gt;
        */&lt;br/&gt;
       private def getRemoteAkkaConfig(configuration: Configuration,&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;hostname: String, port: Int): Config = {&lt;br/&gt;
    +                                  hostname: String, port: Int,&lt;br/&gt;
    +                                  externalHostname: String, externalPort: Int): Config = {&lt;br/&gt;
    +&lt;br/&gt;
    +    LOG.info(s&quot;Using binding address $hostname:$port&quot; +
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    That&apos;s right. Removing this statement because this is also logged at JobManager startup.&lt;/p&gt;</comment>
                            <comment id="15751990" author="githubbot" created="Thu, 15 Dec 2016 17:43:50 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917#discussion_r92661183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917#discussion_r92661183&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/pom.xml &amp;#8212;&lt;br/&gt;
    @@ -193,8 +193,8 @@ under the License.&lt;br/&gt;
     		&amp;lt;/dependency&amp;gt;&lt;/p&gt;

&lt;p&gt;     		&amp;lt;dependency&amp;gt;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&amp;lt;groupId&amp;gt;com.typesafe.akka&amp;lt;/groupId&amp;gt;&lt;/li&gt;
	&lt;li&gt;&amp;lt;artifactId&amp;gt;akka-testkit_${scala.binary.version}&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
    +			&amp;lt;groupId&amp;gt;com.data-artisans&amp;lt;/groupId&amp;gt;&lt;br/&gt;
    +			&amp;lt;artifactId&amp;gt;flakka-testkit_${scala.binary.version}&amp;lt;/artifactId&amp;gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This probably needs to be changed independently of this PR.&lt;/p&gt;</comment>
                            <comment id="15751991" author="githubbot" created="Thu, 15 Dec 2016 17:43:57 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks you @tillrohrmann  and @StephanEwen. I&apos;ve addressed your comments. I&apos;ll have to redeploy Flakka because the staging repository which this PR used, has been dropped in the meantime. I will update the PR tomorrow to use the Maven central servers.&lt;/p&gt;</comment>
                            <comment id="15752145" author="githubbot" created="Thu, 15 Dec 2016 18:43:43 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve added the new staging repository to test the PR changes. Also, the repository is currently deploying to Maven central.&lt;/p&gt;</comment>
                            <comment id="15754414" author="githubbot" created="Fri, 16 Dec 2016 13:25:30 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good to me now, +1 to merge this&lt;/p&gt;</comment>
                            <comment id="15754427" author="githubbot" created="Fri, 16 Dec 2016 13:32:10 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thank you, will go ahead and merge then.&lt;/p&gt;</comment>
                            <comment id="15754954" author="githubbot" created="Fri, 16 Dec 2016 17:01:49 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15754959" author="mxm" created="Fri, 16 Dec 2016 17:04:41 +0000"  >&lt;p&gt;Fixed with 27ebdf7acde0e2c3ad183503d0588ca91e63d729.&lt;/p&gt;</comment>
                            <comment id="15758235" author="eronwright" created="Sun, 18 Dec 2016 05:15:47 +0000"  >&lt;p&gt;Folks, would there be any issue with canonicalizing the value of jobmanager.rpc.address, rather than &quot;lower-casing&quot; it which seems hacky.    Canonical hostnames are very important for SSL hostname verification, which Akka doesn&apos;t support but the post-FLIP-6 RPC could. &lt;/p&gt;

&lt;p&gt;Early in the discussion it was questioned whether the external address could be resolved from within the container - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.bussche&quot; class=&quot;user-hover&quot; rel=&quot;philipp.bussche&quot;&gt;philipp.bussche&lt;/a&gt; could you clarify?   To be clear, I mean &apos;resolve&apos; not &apos;bind&apos;.&lt;/p&gt;

&lt;p&gt;Secondly, while this bug addressed the Akka endpoint, there are almost a half-dozen other endpoints within Flink.  Should we fixup all addresses that an external client would use?&lt;/p&gt;</comment>
                            <comment id="15761149" author="stephanewen" created="Mon, 19 Dec 2016 13:24:13 +0000"  >&lt;p&gt;I think most other endpoints are not affected by the same problems as the Akka endpoint, because they do not perform an exact string compare on the endpoint&apos;s URI.&lt;/p&gt;

&lt;p&gt;Canonicalizing host names in general and everywhere actually makes sense nonetheless. I would say we should do that in the next release.&lt;/p&gt;</comment>
                            <comment id="15812287" author="githubbot" created="Mon, 9 Jan 2017 17:15:01 +0000"  >&lt;p&gt;Github user schmichri commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    when is this planned to be released? &lt;/p&gt;</comment>
                            <comment id="15812341" author="githubbot" created="Mon, 9 Jan 2017 17:35:23 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    There is a release candidate out: &lt;a href=&quot;https://github.com/apache/flink/tree/release-1.2.0-rc0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/tree/release-1.2.0-rc0&lt;/a&gt;&lt;br/&gt;
    Download at &lt;a href=&quot;http://people.apache.org/~rmetzger/flink-1.2.0-rc0/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~rmetzger/flink-1.2.0-rc0/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The official release comes when the testing phase is done, which should be soon.&lt;/p&gt;

&lt;p&gt;    If you can try the release candidate and tell us if it worked for your scenario, that would help with the release testing.&lt;/p&gt;</comment>
                            <comment id="15812569" author="githubbot" created="Mon, 9 Jan 2017 19:11:17 +0000"  >&lt;p&gt;Github user schmichri commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    short: it works!&lt;/p&gt;

&lt;p&gt;    long: my scenario a docker-compose setup: &lt;/p&gt;

&lt;p&gt;    `  jobmanager:&lt;br/&gt;
        image: flink:1.2.0_rc0&lt;br/&gt;
        container_name: &quot;jobmanager&quot;&lt;br/&gt;
        expose:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;6123&quot;&lt;/li&gt;
	&lt;li&gt;&quot;8081&quot;&lt;br/&gt;
        ports:&lt;/li&gt;
	&lt;li&gt;&quot;8081:8081&quot;&lt;/li&gt;
	&lt;li&gt;&quot;10.0.0.11:6123:6123&quot;&lt;br/&gt;
        command: jobmanager&lt;br/&gt;
        environment:&lt;/li&gt;
	&lt;li&gt;JOB_MANAGER_RPC_ADDRESS=10.0.0.11&lt;br/&gt;
    `&lt;br/&gt;
    and the taskmanager(s):&lt;br/&gt;
    `  taskmanager:&lt;br/&gt;
        image: flink:1.2.0_rc0&lt;br/&gt;
        expose:&lt;/li&gt;
	&lt;li&gt;&quot;6121&quot;&lt;/li&gt;
	&lt;li&gt;&quot;6122&quot;&lt;br/&gt;
        command: taskmanager&lt;/li&gt;
	&lt;li&gt;&quot;jobmanager:jobmanager&quot;&lt;br/&gt;
        environment:&lt;/li&gt;
	&lt;li&gt;JOB_MANAGER_RPC_ADDRESS=10.0.0.11&lt;br/&gt;
        extra_hosts:&lt;/li&gt;
	&lt;li&gt;&quot;jobmanager:10.0.0.11&quot;`&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    1. the jobmanager webinterface works now&lt;br/&gt;
    2. the taskmanager can connect now to the jobmanager &lt;br/&gt;
    previous errormessage: &lt;br/&gt;
    &amp;gt; dropping message &lt;span class=&quot;error&quot;&gt;&amp;#91;class akka.actor.ActorSelectionMessage&amp;#93;&lt;/span&gt; for non-local recipient [Actor&lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@10.0.0.11:6123/&amp;#93;&lt;/span&gt;] arriving at &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@10.0.0.11:6123&amp;#93;&lt;/span&gt; inbound addresses are &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@172.31.0.2:6123&amp;#93;&lt;/span&gt;&lt;br/&gt;
    &amp;gt; flink-master    | 2017-01-09 15:30:39,865 ERROR akka.remote.EndpointWriter&lt;/p&gt;

&lt;p&gt;    thats very cool! &lt;/p&gt;</comment>
                            <comment id="15840738" author="githubbot" created="Fri, 27 Jan 2017 00:16:03 +0000"  >&lt;p&gt;Github user peay commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This did not work for me with `1.2.0-rc2`. Is there something special to do to make it bind on `0.0.0.0` now?&lt;/p&gt;

&lt;p&gt;    I am still getting:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    dropping message &lt;span class=&quot;error&quot;&gt;&amp;#91;class akka.actor.ActorSelectionMessage&amp;#93;&lt;/span&gt; for non-local recipient [Actor&lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@10.50.50.167:6123/&amp;#93;&lt;/span&gt;] arriving at &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@10.50.50.167:6123&amp;#93;&lt;/span&gt; inbound addresses are &lt;span class=&quot;error&quot;&gt;&amp;#91;akka.tcp://flink@jobmanager.flink.svc.cluster.local:6123&amp;#93;&lt;/span&gt;&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    with `JOB_MANAGER_RPC_ADDRESS=jobmanager.flink.svc.cluster.local`.&lt;/p&gt;</comment>
                            <comment id="15842417" author="githubbot" created="Fri, 27 Jan 2017 09:05:17 +0000"  >&lt;p&gt;Github user mxm commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2917&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;gt;edit: Re-reading the PR description, I actually got it to work by setting jobmanager.rpc.address to the external IP and getting rid of the hostname.&lt;/p&gt;

&lt;p&gt;    Glad you were able to solve the problem! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Akka requires that all messages are tagged with the same address which was used during initialization of the receiver actor system. While this PR gets rid of the issue that an address might not be available for binding during initialization of the receiver, it still requires you to use a consistent address.&lt;/p&gt;</comment>
                            <comment id="15848287" author="philipp.bussche" created="Wed, 1 Feb 2017 11:55:38 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, after being quiet for a while I wanted to feed back on the setup I am running at the moment.&lt;br/&gt;
To recap (I had to think about my setup myself again after not spending much time on it lately &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;job manager and task manager run in Docker containers&lt;/li&gt;
	&lt;li&gt;I am using an orchestration engine called Rancher on top of docker which also introduces another set of IP addresses / network on top of Docker.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Since I am communicating to the JobManager from within the Docker / Rancher network as well as from outside (from my local buildserver) I had to have the JobManager register to a hostname that is resolvable on the Internet. Both the task manager (coming from within the Docker / Rancher network) as well as the build server connect via the internet host name now. Obviously since the task manager would live right next to the job manager the preferred solution would be for the task manager to connect locally (meaning through the Docker / Rancher network) but since one can only specify one listener address it has to go through the internet host name.&lt;/p&gt;

&lt;p&gt;However this does not solve the problem completly yet because if I just tell the JobManager to bind to the internet host name I am getting the following exception while JobManager starts up:&lt;/p&gt;

&lt;p&gt;017-02-01 11:13:51,997 INFO  org.apache.flink.util.NetUtils                                - Unable to allocate on port 6123, due to error: Address not available (Bind failed)&lt;br/&gt;
2017-02-01 11:13:51,999 ERROR org.apache.flink.runtime.jobmanager.JobManager                - Failed to run JobManager.&lt;br/&gt;
java.lang.RuntimeException: Unable to do further retries starting the actor system&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager$.retryOnBindException(JobManager.scala:2136)&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager$.runJobManager(JobManager.scala:2076)&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager$$anon$12.call(JobManager.scala:1971)&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager$$anon$12.call(JobManager.scala:1969)&lt;br/&gt;
        at org.apache.flink.runtime.security.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:29)&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager$.main(JobManager.scala:1969)&lt;br/&gt;
        at org.apache.flink.runtime.jobmanager.JobManager.main(JobManager.scala)&lt;/p&gt;

&lt;p&gt;So additionally I had to put the Docker IP address of the JobManager container into /etc/hosts resolving to the internet host name so that it tries to bind on the Docker IP address rather than the Amazon AWS IP address (which is the IP that the internet host name resolves to).&lt;/p&gt;

&lt;p&gt;This works for me now, I would not call it ideal though.&lt;/p&gt;

&lt;p&gt;I have to admit I have not tested this with the latest RC, will do that later in the week.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12952811">FLINK-3661</subtask>
                            <subtask id="12952812">FLINK-3662</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mm53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>