<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:15:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-28863] Snapshot result of RocksDB native savepoint should have empty shared-state</title>
                <link>https://issues.apache.org/jira/browse/FLINK-28863</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The current snapshot result of RocksDB native savepoint has non-empty shared state, which is obviously not correct as all snapshot artifacts already stay in the exclusive checkpoint scope folder.&lt;/p&gt;

&lt;p&gt;This does not bring real harmful result due to we would not register the snapshot results of RocksDB native savepoint.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13475688">FLINK-28863</key>
            <summary>Snapshot result of RocksDB native savepoint should have empty shared-state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lijinzhong">Jinzhong Li</assignee>
                                    <reporter username="yunta">Yun Tang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 8 Aug 2022 08:37:39 +0000</created>
                <updated>Mon, 26 Dec 2022 02:16:29 +0000</updated>
                            <resolved>Fri, 23 Dec 2022 02:26:32 +0000</resolved>
                                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.16.1</fixVersion>
                    <fixVersion>1.15.4</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17625402" author="lijinzhong" created="Fri, 28 Oct 2022 03:12:33 +0000"  >&lt;p&gt;In my opinion, for Rocksdb native savepoint SnapshotResult, we should put &lt;a href=&quot;https://github.com/apache/flink/blob/bb9f2525e6e16d00ef2f0739d9cb96c2e47e35e7/flink-state-backends/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/snapshot/RocksIncrementalSnapshotStrategy.java#L302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;sstFiles&lt;/a&gt; into privateState Map of IncrementalRemoteKeyedStateHandle to fix this issue.&lt;/p&gt;

&lt;p&gt;This change has no effect on restore, which &lt;a href=&quot;#L53].&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;downloads both the priavateStates and shareStates&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; WDYT?&#160; If my understanding is correct, I can fix the issue.&lt;/p&gt;</comment>
                            <comment id="17626365" author="yunta" created="Mon, 31 Oct 2022 03:58:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lijinzhong&quot; class=&quot;user-hover&quot; rel=&quot;lijinzhong&quot;&gt;lijinzhong&lt;/a&gt; I think this idea should be correct, already assigned to you.&lt;/p&gt;</comment>
                            <comment id="17627484" author="lijinzhong" created="Wed, 2 Nov 2022 06:41:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;1. I found that the changes I metioned above would change native savepoint&apos;s behavior in CLAIM mode.&lt;/p&gt;

&lt;p&gt;Now, when job restore from native savepoint in CLAIM mode, the first checkpoint will be incremental based on savepoint sstFiles.&lt;br/&gt;
This means although native savepoint sstFiles stay in the exclusive scope folder, the checkpoints of the job which restore from the savepoint can still share sstFiles with it.&lt;br/&gt;
If we put &lt;a href=&quot;https://github.com/apache/flink/blob/bb9f2525e6e16d00ef2f0739d9cb96c2e47e35e7/flink-state-backends/flink-statebackend-rocksdb/src/main/java/org/apache/flink/contrib/streaming/state/snapshot/RocksIncrementalSnapshotStrategy.java#L302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;sstFiles&lt;/a&gt; into privateState Map of IncrementalRemoteKeyedStateHandle for native savepoint, the above behavior will be changed.&lt;/p&gt;

&lt;p&gt;2. Back to the issue itself, i think, if the semantic of &quot;&lt;a href=&quot;https://github.com/apache/flink/blob/bb9f2525e6e16d00ef2f0739d9cb96c2e47e35e7/flink-runtime/src/main/java/org/apache/flink/runtime/state/IncrementalRemoteKeyedStateHandle.java#L80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;sharedState&lt;/a&gt;&quot; in IncrementalRemoteKeyedStateHandle is that state files can be shared by other checkpoints (include checkpoints after restore), &lt;b&gt;current behavior is by design.&lt;/b&gt; &#160; In other words, &#160;the snapshot artifacts in the exclusive scope folder can still share sstFiles with checkpoints after restore in CLAIM mode.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; &#160;WDYT?&#160;&lt;/p&gt;</comment>
                            <comment id="17638121" author="yunta" created="Thu, 24 Nov 2022 06:45:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lijinzhong&quot; class=&quot;user-hover&quot; rel=&quot;lijinzhong&quot;&gt;lijinzhong&lt;/a&gt; Thanks for the analysis, do you mean if we put the &quot;sstFiles&quot; into the privateState map, the next restored checkpoint in CLAIM mode would be a full checkpoint? If so, I think we can keep the logic as it was now to not break the behavior. However, the logic is still not so straightforward, and we could add some comments in related code for developers.&lt;/p&gt;</comment>
                            <comment id="17648326" author="lijinzhong" created="Fri, 16 Dec 2022 04:17:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; &#160;Yes, that is. And +1 for keeping the logic as it was now.&#160;&lt;br/&gt;
Thanks for the advice. I&#8216;ve added some comments in related code. Could you please help review it?&lt;/p&gt;</comment>
                            <comment id="17651297" author="yunta" created="Thu, 22 Dec 2022 14:08:28 +0000"  >&lt;p&gt;merged in master: 287929c407d26541f1af1c7eaed24507d691725d&lt;/p&gt;</comment>
                            <comment id="17651901" author="yunta" created="Mon, 26 Dec 2022 02:16:29 +0000"  >&lt;p&gt;merged in release-1.16: bb17c3baab727c23059db978ca48adadbbd0e897&lt;br/&gt;
merged in release-1.15: beaa0f698b0551a04cc751292cddeb4ba39c01e2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 46 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17kc8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>