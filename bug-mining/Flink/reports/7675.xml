<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:21:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-36613] RescaleCheckpointManuallyITCase.testCheckpointRescalingInKeyedState fails on AZP</title>
                <link>https://issues.apache.org/jira/browse/FLINK-36613</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;RescaleCheckpointManuallyITCase.testCheckpointRescalingInKeyedState&lt;/tt&gt; fails like&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Oct 28 04:42:03 04:42:03.884 [ERROR] org.apache.flink.test.checkpointing.RescaleCheckpointManuallyITCase.testCheckpointRescalingInKeyedState -- Time elapsed: 6.107 s &amp;lt;&amp;lt;&amp;lt; FAILURE!
Oct 28 04:42:03 java.lang.AssertionError: expected:&amp;lt;[(0,24000), (1,22500), (0,34500), (1,33000), (0,21000), (0,45000), (2,31500), (2,42000), (1,6000), (0,28500), (0,52500), (2,15000), (1,3000), (1,51000), (0,1500), (0,49500), (2,12000), (2,60000), (0,36000), (1,10500), (1,58500), (0,46500), (0,9000), (0,57000), (2,19500), (2,43500), (1,7500), (1,55500), (2,30000), (1,18000), (0,54000), (2,40500), (1,4500), (0,16500), (2,27000), (1,39000), (2,13500), (1,25500), (0,37500), (0,61500), (2,0), (2,48000)]&amp;gt; but was:&amp;lt;[(1,22500), (0,34500), (1,33000), (0,45000), (0,21000), (2,31500), (0,28500), (0,52500), (2,15000), (1,3000), (1,51000), (0,49500), (0,1500), (1,58500), (1,10500), (0,46500), (0,9000), (0,57000), (2,43500), (2,19500), (1,7500), (1,55500), (2,40500), (1,4500), (0,16500), (2,27000), (1,39000), (2,13500), (1,25500), (0,37500), (0,61500)]&amp;gt;
Oct 28 04:42:03 	at org.junit.Assert.fail(Assert.java:89)
Oct 28 04:42:03 	at org.junit.Assert.failNotEquals(Assert.java:835)
Oct 28 04:42:03 	at org.junit.Assert.assertEquals(Assert.java:120)
Oct 28 04:42:03 	at org.junit.Assert.assertEquals(Assert.java:146)
Oct 28 04:42:03 	at org.apache.flink.test.checkpointing.RescaleCheckpointManuallyITCase.restoreAndAssert(RescaleCheckpointManuallyITCase.java:216)
Oct 28 04:42:03 	at org.apache.flink.test.checkpointing.RescaleCheckpointManuallyITCase.testCheckpointRescalingKeyedState(RescaleCheckpointManuallyITCase.java:138)
Oct 28 04:42:03 	at org.apache.flink.test.checkpointing.RescaleCheckpointManuallyITCase.testCheckpointRescalingInKeyedState(RescaleCheckpointManuallyITCase.java:111)
Oct 28 04:42:03 	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
Oct 28 04:42:03 	at org.apache.flink.util.TestNameProvider$1.evaluate(TestNameProvider.java:45)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;for instance &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63345&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63345&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;the issue is floating however could be reproduced locally after several repetitions like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cd flink-tests

&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; i in $(seq 1 100); &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; ../mvnw -Dtest=RescaleCheckpointManuallyITCase test || &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt; ; done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;there is a similar issue &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-32483&quot; title=&quot;RescaleCheckpointManuallyITCase.testCheckpointRescalingOutKeyedState fails on AZP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-32483&quot;&gt;&lt;del&gt;FLINK-32483&lt;/del&gt;&lt;/a&gt; however it seems fixed (not closed for some reason and not related)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13596939">FLINK-36613</key>
            <summary>RescaleCheckpointManuallyITCase.testCheckpointRescalingInKeyedState fails on AZP</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zakelly">Zakelly Lan</assignee>
                                    <reporter username="Sergey Nuyanzin">Sergey Nuyanzin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Mon, 28 Oct 2024 11:58:28 +0000</created>
                <updated>Mon, 9 Dec 2024 03:09:24 +0000</updated>
                            <resolved>Mon, 9 Dec 2024 03:09:24 +0000</resolved>
                                    <version>2.0.0</version>
                                                    <component>Runtime / Checkpointing</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17893415" author="sergey nuyanzin" created="Mon, 28 Oct 2024 12:00:08 +0000"  >&lt;p&gt;It is very likely that the reason is &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-36556&quot; title=&quot;Allow to configure starting buffer size when using buffer debloating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-36556&quot;&gt;&lt;del&gt;FLINK-36556&lt;/del&gt;&lt;/a&gt; where was changed default value for &lt;tt&gt;STARTING_MEMORY_SEGMENT_SIZE&lt;/tt&gt; and it impacts the test&lt;/p&gt;

&lt;p&gt;BTW before changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-36556&quot; title=&quot;Allow to configure starting buffer size when using buffer debloating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-36556&quot;&gt;&lt;del&gt;FLINK-36556&lt;/del&gt;&lt;/a&gt; it is not reproduced&lt;/p&gt;</comment>
                            <comment id="17893434" author="sergey nuyanzin" created="Mon, 28 Oct 2024 12:37:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; since you were involved into &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-36556&quot; title=&quot;Allow to configure starting buffer size when using buffer debloating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-36556&quot;&gt;&lt;del&gt;FLINK-36556&lt;/del&gt;&lt;/a&gt; , could you please have a look at the thoughts above and the small fix (based on these thoughts)&lt;/p&gt;</comment>
                            <comment id="17893669" author="hackergin" created="Tue, 29 Oct 2024 02:13:17 +0000"  >&lt;p&gt;Another failed tests.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63351&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63351&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17893856" author="pnowojski" created="Tue, 29 Oct 2024 14:23:11 +0000"  >&lt;blockquote&gt;
&lt;p&gt;It is very likely that the reason is &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-36556&quot; title=&quot;Allow to configure starting buffer size when using buffer debloating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-36556&quot;&gt;&lt;del&gt;FLINK-36556&lt;/del&gt;&lt;/a&gt; where was changed default value for STARTING_MEMORY_SEGMENT_SIZE and it impacts the test&lt;/p&gt;

&lt;p&gt;BTW before changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-36556&quot; title=&quot;Allow to configure starting buffer size when using buffer debloating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-36556&quot;&gt;&lt;del&gt;FLINK-36556&lt;/del&gt;&lt;/a&gt; it is not reproduced&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think that &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-36556&quot; title=&quot;Allow to configure starting buffer size when using buffer debloating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-36556&quot;&gt;&lt;del&gt;FLINK-36556&lt;/del&gt;&lt;/a&gt; can be the culprit here. Buffer debloating is not enabled neither randomly in the test environment nor in the &lt;tt&gt;RescaleCheckpointManuallyITCase&lt;/tt&gt; itself. It&apos;s also disabled by default, so changes in the &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-36556&quot; title=&quot;Allow to configure starting buffer size when using buffer debloating&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-36556&quot;&gt;&lt;del&gt;FLINK-36556&lt;/del&gt;&lt;/a&gt; shouldn&apos;t affect in any way this test. I would presume that test is still broken in some way. I&apos;ve tried looking into it, but after a bit of digging I couldn&apos;t find what&apos;s actually wrong with it.&lt;/p&gt;</comment>
                            <comment id="17894395" author="weijie guo" created="Thu, 31 Oct 2024 02:04:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63405&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&amp;amp;l=8712&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63405&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&amp;amp;l=8712&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17894752" author="JIRAUSER307549" created="Fri, 1 Nov 2024 02:32:29 +0000"  >&lt;p&gt;here&apos;s another one:&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63425&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63425&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17895359" author="pnowojski" created="Mon, 4 Nov 2024 17:03:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63473&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63473&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17897323" author="weijie guo" created="Tue, 12 Nov 2024 01:48:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63613&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&amp;amp;l=8437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=63613&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&amp;amp;l=8437&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17897369" author="zakelly" created="Tue, 12 Nov 2024 05:48:01 +0000"  >&lt;p&gt;I found that when I run &lt;tt&gt;RescaleCheckpointManuallyITCase.testCheckpointRescalingInKeyedState&lt;/tt&gt; 100 times, it looks fine. But when I run &lt;tt&gt;RescaleCheckpointManuallyITCase&lt;/tt&gt;, it is easy to reproduce the failure. My guess is that due to some static variables being accessed concurrently by multiple tests, the test fails randomly. We encountered &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-35041&quot; title=&quot;IncrementalRemoteKeyedStateHandleTest.testSharedStateReRegistration failed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-35041&quot;&gt;&lt;del&gt;FLINK-35041&lt;/del&gt;&lt;/a&gt; before for similar reason.&lt;/p&gt;

&lt;p&gt;It seems &lt;tt&gt;RescaleCheckpointManuallyITCase#CollectionSink&lt;/tt&gt; collects the job results into a static collection, this might be the root cause. Fixing....&lt;/p&gt;</comment>
                            <comment id="17897492" author="zakelly" created="Tue, 12 Nov 2024 12:06:03 +0000"  >&lt;p&gt;Seems the concurrency issue is not the only problem. The test does not ensure all the data from the first job has being processed and snapshotted before it performs a rescale, resulting in some data loss in the final aggregation result. This can be easily reproduced by setting the param &lt;tt&gt;checkpointingInterval&lt;/tt&gt; of &lt;tt&gt;createJobGraphWithKeyedState&lt;/tt&gt; as 20 or less.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also fixed in my PR.&lt;/p&gt;</comment>
                            <comment id="17897801" author="zakelly" created="Wed, 13 Nov 2024 02:36:52 +0000"  >&lt;p&gt;Merge 73c120d...6fe39c6 into master&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13541927">FLINK-32483</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1s8uw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>