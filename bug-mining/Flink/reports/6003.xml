<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:07:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24608] Sinks built with the unified sink framework do not receive timestamps when used in Table API</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24608</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;All sinks built with the unified sink framework extract the timestamp from the internal &lt;tt&gt;StreamRecord&lt;/tt&gt;. The Table API does not facilitate the timestamp field in the &lt;tt&gt;StreamRecord&lt;/tt&gt;  but extracts the timestamp from the actual data. &lt;/p&gt;

&lt;p&gt;We either have to use a dedicated operator before all the sinks to simulate the behavior or allow a customizable timestamp extraction during the sink translation.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13407684">FLINK-24608</key>
            <summary>Sinks built with the unified sink framework do not receive timestamps when used in Table API</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="matriv">Marios Trivyzas</assignee>
                                    <reporter username="fpaul">Fabian Paul</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 21 Oct 2021 06:46:53 +0000</created>
                <updated>Wed, 15 Dec 2021 01:44:12 +0000</updated>
                            <resolved>Mon, 22 Nov 2021 06:59:30 +0000</resolved>
                                    <version>1.14.0</version>
                    <version>1.13.3</version>
                    <version>1.15.0</version>
                                    <fixVersion>1.14.3</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Connectors / Common</component>
                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17440522" author="matriv" created="Mon, 8 Nov 2021 14:50:17 +0000"  >&lt;p&gt;After discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; it seems there are 2 ways to implement this.&lt;/p&gt;

&lt;p&gt;There is an issue with &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; which keeps a state, and its state is a leas of `RowData` so any information on the &lt;b&gt;StreamRecord&lt;/b&gt;&#160;is lost, so:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Keep any constraint validation operator before the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; and add a new operator at the end (after the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt;) to set the timestamp on the &lt;b&gt;StreamRecord&lt;/b&gt;&lt;/li&gt;
	&lt;li&gt;Combine the constraint validation operator with this new one which sets the timestamp, and apply it after the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;(Currently the constraint validation in place is only the &lt;b&gt;SinkNotNullEnforcer&lt;/b&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;With &lt;b&gt;1&lt;/b&gt; we could already filter out records, or shorter the length of char/varchar fields of a record (soon to be implemented) before the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt;&#160;thus decreasing the size of its state.&lt;/p&gt;

&lt;p&gt;With &lt;b&gt;2&lt;/b&gt; we loose this possible memory gain from &lt;b&gt;1&lt;/b&gt; but we avoid introducing yet another operator in the pipeline.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fpaul&quot; class=&quot;user-hover&quot; rel=&quot;fpaul&quot;&gt;fpaul&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; Could you please share your opinion on this?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17441009" author="twalthr" created="Tue, 9 Nov 2021 09:25:25 +0000"  >&lt;p&gt;I would vote for option 1. In theory, when shortening CHAR/VARCHAR this could even affect the primary key (e.g. &quot;asdf&quot; and &quot;aaa&quot; could become &quot;a&quot; with VARCHAR(1)). It is safer to do that before the `SinkUpsertMaterializer` and users can enforce another keyBy and upsert materialize step to normalize the output. Having another operator in the pipeline seems to be unavoidable unless we only pass the &lt;tt&gt;rowtimeIndex&lt;/tt&gt; directly to the sink and every sink implements custom logic for reading the timestamp.&lt;/p&gt;</comment>
                            <comment id="17441010" author="fabian.paul" created="Tue, 9 Nov 2021 09:25:52 +0000"  >&lt;p&gt;I do not fully see the connection between the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; and the issue described in the ticket. Is the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; suffering from the same problem as the unified Sinks? AFAICT the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; is not accessing the timestamp of the StreamRecord.&lt;/p&gt;


&lt;p&gt;WDYT about an alternative 3 keeping one constraint operator before the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; with different functions i.e. not null enforcer, timestamp extractor ... and always use the StreamRecord#timestamp in the &lt;b&gt;SinkUpsertMaterializer&lt;/b&gt;. It has the benefit that it is guaranteed that there is always a timestamp when using the materialize and you do not have to deal with null checks.&lt;/p&gt;

</comment>
                            <comment id="17441029" author="matriv" created="Tue, 9 Nov 2021 09:58:41 +0000"  >&lt;p&gt;The problem with&#160;&lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; is that currently it uses a state which is a&#160;&lt;b&gt;List&amp;lt;RowData&amp;gt;&lt;/b&gt; and not a&#160;&lt;b&gt;List&amp;lt;StreamRecord&amp;gt;,&lt;/b&gt;&#160;therefore it &quot;looses&quot; the timestamp info.&lt;/p&gt;

&lt;p&gt;If we set the&#160;&lt;b&gt;timestamp&lt;/b&gt; to the stream record before&#160;&lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; then we need to either store&#160;&lt;b&gt;List&amp;lt;StreamRecord&amp;gt;,&lt;/b&gt;&#160;thus increasing the size of its state, or pass the column index of the timestamp&lt;/p&gt;

&lt;p&gt;to&#160;&lt;b&gt;SinkUpsertMaterializer&lt;/b&gt; so it can retrieve the&#160;&lt;b&gt;timestamp&lt;/b&gt; and set it to the result&#160;&lt;b&gt;StreamRecord&lt;/b&gt;s, which somehow negates the point of setting the timestamp beforehand.&lt;/p&gt;</comment>
                            <comment id="17441056" author="matriv" created="Tue, 9 Nov 2021 10:36:24 +0000"  >&lt;p&gt;I would also vote for option 1, so get the benefits of filtering records before needing to buffer them in&#160;&lt;b&gt;SinkUpsertMaterializer&lt;/b&gt;, + the possible changed to CHAR/VARCHAR types as mentioned by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;and then have a dedicated operator to handle the timestamp in one place, (keep in mind that&#160;&lt;b&gt;SinkUpsertMaterilizer&lt;/b&gt; is not always applied).&lt;/p&gt;</comment>
                            <comment id="17447216" author="twalthr" created="Mon, 22 Nov 2021 06:59:30 +0000"  >&lt;p&gt;Fixed in master: 548b96e9cb226aaf8d919d900c9326520a5b6dc8&lt;br/&gt;
Fixed in 1.14.1: 3719c0402ec979c619371fcde9f2e7d2c46d69ed&lt;/p&gt;

&lt;p&gt;For now I did not back port this fix to 1.13. 1.14 is still not adopted by many users whereas 1.13 is. The change could affect the savepoint restoration.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13407411">FLINK-24596</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0w1dc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This adds an additional operator to the topology if the new sink interfaces are used (e.g. for Kafka). It could cause issues in 1.14.1 when restoring from a 1.14 savepoint. A workaround is to cast the time attribute to a regular timestamp in the SQL statement closely before the sink.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>