<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:49:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19064] HBaseRowDataInputFormat is leaking resources</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19064</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;HBaseRowDataInputFormat.configure()&lt;/tt&gt; is calling &lt;tt&gt;connectToTable()&lt;/tt&gt;, which creates a connection to HBase that is not closed again.&lt;/p&gt;

&lt;p&gt;A user reported this problem on the user@ list: &lt;a href=&quot;https://lists.apache.org/thread.html/ra04f6996eb50ee83aabd2ad0d50bec9afb6a924bfbb48ada3269c6d8%40%3Cuser.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/ra04f6996eb50ee83aabd2ad0d50bec9afb6a924bfbb48ada3269c6d8%40%3Cuser.flink.apache.org%3E&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13324846">FLINK-19064</key>
            <summary>HBaseRowDataInputFormat is leaking resources</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nicholasjiang">Nicholas Jiang</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 27 Aug 2020 13:23:47 +0000</created>
                <updated>Fri, 19 Feb 2021 07:20:47 +0000</updated>
                            <resolved>Mon, 21 Sep 2020 02:23:27 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Connectors / HBase</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17185856" author="nicholasjiang" created="Thu, 27 Aug 2020 13:56:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; HBaseRowDataInputFormat should create HBase connection in method configure() and close the connection in method close(). &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, what do you think about this?&lt;/p&gt;</comment>
                            <comment id="17185878" author="rmetzger" created="Thu, 27 Aug 2020 14:19:26 +0000"  >&lt;p&gt;The problem is that the &lt;tt&gt;DataSourceNode.computeOperatorSpecificDefaultEstimates&lt;/tt&gt; method does not call the close method.&lt;br/&gt;
I guess the &lt;tt&gt;HBaseRowDataInputFormat&lt;/tt&gt; should override the open() method, instead of configure, then the Optimizer won&apos;t create a new connection, and the close() method is properly called to close the connection again.&lt;/p&gt;</comment>
                            <comment id="17185881" author="jark" created="Thu, 27 Aug 2020 14:21:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicholasjiang&quot; class=&quot;user-hover&quot; rel=&quot;nicholasjiang&quot;&gt;nicholasjiang&lt;/a&gt; you are right. The created connection should definitely be closed at the end. Are you interested to open a pull request?&lt;/p&gt;</comment>
                            <comment id="17185887" author="jark" created="Thu, 27 Aug 2020 14:29:38 +0000"  >&lt;p&gt;What &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; said makes sense to me. &lt;tt&gt;configure()&lt;/tt&gt; is not a recommended method to create connection. According to the Javadoc, we should override the &lt;tt&gt;openInputFormat()&lt;/tt&gt; to allocate resources and release them in &lt;tt&gt;closeInputFormat()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17185972" author="zhushang" created="Thu, 27 Aug 2020 16:54:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; ,According to the Javadoc,the connection should be created in configure() definitely.&lt;/p&gt;

&lt;p&gt;Now the problem is the connection should be closed in&#160;closeInputFormat().&lt;/p&gt;

&lt;p&gt;i&apos;d like to do this,if it has not be picked by&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicholasjiang&quot; class=&quot;user-hover&quot; rel=&quot;nicholasjiang&quot;&gt;nicholasjiang&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17186215" author="jark" created="Fri, 28 Aug 2020 02:38:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ZhuShang&quot; class=&quot;user-hover&quot; rel=&quot;ZhuShang&quot;&gt;ZhuShang&lt;/a&gt;, why the connection should be created in &lt;tt&gt;configure()&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17187456" author="nicholasjiang" created="Mon, 31 Aug 2020 06:12:46 +0000"  >&lt;p&gt;Back to this issue, method&#160;DataSourceNode#computeOperatorSpecificDefaultEstimates only calls format#configure, doesn&apos;t call RichInputFormat#closeInputFormat. In my opinion, method&#160;computeOperatorSpecificDefaultEstimates should close the input format, in another word, which configure the format should be responsible for closing the input format. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, what do you consider about this leaking resources?&lt;/p&gt;</comment>
                            <comment id="17187510" author="jark" created="Mon, 31 Aug 2020 07:19:45 +0000"  >&lt;p&gt;From the definition of &lt;tt&gt;configure()&lt;/tt&gt;, it dosn&apos;t open any resources, so calling &lt;tt&gt;close()&lt;/tt&gt; doesn&apos;t make sense to me. &lt;br/&gt;
I think the current method interfaces of &lt;tt&gt;InputFormat&lt;/tt&gt; is chaotic and I&apos;m not familiar with &lt;tt&gt;InputFormat&lt;/tt&gt; enough to fix it. Currently, the &lt;tt&gt;openInputFormat&lt;/tt&gt; doesn&apos;t happen before &lt;tt&gt;createInputSplits&lt;/tt&gt;. One approach will be moving the calling of &lt;tt&gt;format.openInputFormat()&lt;/tt&gt; from &lt;tt&gt;InputFormatSourceFunction#run(ctx)&lt;/tt&gt; to &lt;tt&gt;InputFormatSourceFunction#open(params)&lt;/tt&gt;. However, as I said before, I&apos;m not clear about what&apos;s the side effect. We may need to pull in someone familiar with &lt;tt&gt;InputFormat&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;After all, I don&apos;t think this is a critical bug, as the problem only happens in the legacy &lt;tt&gt;DataSet&lt;/tt&gt; API which is not maintained for some time and will be removed in the future. Besides, maybe it&apos;s time to migrate the HBase source to the new FLIP-27 source to have the clearly defined interfaces. &lt;/p&gt;</comment>
                            <comment id="17188996" author="nicholasjiang" created="Wed, 2 Sep 2020 05:46:56 +0000"  >&lt;p&gt;Yeah, I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;. From my perspective, set aside the issue scene, other scenes need to close the HBase connection in&#160;RichInputFormat#closeInputFormat.&lt;/p&gt;

&lt;p&gt;And in this issue, the approach above mentioned make sense to me, but this change would affect other cases for other connectors.&lt;/p&gt;

&lt;p&gt;In my opinion, there is no perfect solution to solve this&#160;leaking resources problem. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;, do you have any great&#160;approach to handle this case?&lt;/p&gt;</comment>
                            <comment id="17189005" author="rmetzger" created="Wed, 2 Sep 2020 05:56:58 +0000"  >&lt;p&gt;Why can&apos;t we open the connection in the &lt;tt&gt;open()&lt;/tt&gt; method, and close it in the &lt;tt&gt;close()&lt;/tt&gt; method? That should solve the problem for &lt;tt&gt;InputFormatSourceFunction&lt;/tt&gt; and &lt;tt&gt;DataSourceNode#computeOperatorSpecificDefaultEstimates&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17189039" author="nicholasjiang" created="Wed, 2 Sep 2020 07:22:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;,&#160;DataSourceNode#computeOperatorSpecificDefaultEstimates&#160;just call configure(), doesn&apos;t call close(). And in current behavior, open() is called after&#160;createInputSplits() which need use the hbase connection. Therefore, this is why&#160;we can&apos;t open the connection in the open() method, and close it in the close() method.&lt;/p&gt;</comment>
                            <comment id="17189043" author="rmetzger" created="Wed, 2 Sep 2020 07:38:11 +0000"  >&lt;p&gt;In my understanding of the &lt;tt&gt;InputFormat&lt;/tt&gt; interface, the open() and close() method have a different lifecycle than the createInputSplits() method.&lt;/p&gt;

&lt;p&gt;If in the HBase case createInputSplits() needs a connection, then this method needs to establish and close the connection in this method call.&lt;br/&gt;
Afaik the createInputSplits() method is called on the JobManager once during initialization.&lt;/p&gt;


&lt;p&gt;The open() and close() methods are opened and closed for each split on the TaskManagers.&lt;/p&gt;

&lt;p&gt;Thus we can not open the connection once and use it for all purposes. We need to establish a connection on the master, and then on the TaskManagers as well.&lt;/p&gt;

&lt;p&gt;DataSourceNode#computeOperatorSpecificDefaultEstimates() is irrelevant for the Hbase format, since the getStatistics() call always returns null.&lt;/p&gt;</comment>
                            <comment id="17199120" author="jark" created="Mon, 21 Sep 2020 02:23:27 +0000"  >&lt;p&gt;Fixed in master (1.12.0): a4d037b406185cd5864357b83ddbb823b611de9e&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0i4y8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>