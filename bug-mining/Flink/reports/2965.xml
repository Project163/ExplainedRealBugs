<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:39:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10712] RestartPipelinedRegionStrategy does not restore state</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10712</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;RestartPipelinedRegionStrategy does not perform any state restore. This is big problem because all restored regions will be restarted with empty state. We need to take checkpoints into account when restoring.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13194814">FLINK-10712</key>
            <summary>RestartPipelinedRegionStrategy does not restore state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yunta">Yun Tang</assignee>
                                    <reporter username="srichter">Stefan Richter</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 29 Oct 2018 11:51:41 +0000</created>
                <updated>Tue, 6 Aug 2019 13:24:59 +0000</updated>
                            <resolved>Wed, 17 Apr 2019 11:49:39 +0000</resolved>
                                    <version>1.3.3</version>
                    <version>1.4.2</version>
                    <version>1.5.5</version>
                    <version>1.6.2</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16668962" author="aljoscha" created="Tue, 30 Oct 2018 16:16:57 +0000"  >&lt;p&gt;Isn&apos;t this a blocker?&lt;/p&gt;</comment>
                            <comment id="16668964" author="yunta" created="Tue, 30 Oct 2018 16:17:34 +0000"  >&lt;p&gt;We have already refactored &lt;em&gt;FailoverRegion.java&lt;/em&gt; to support fail-over with state when using region-failover strategy in our production environment. I&apos;ll organize related code to crate a new PR in these days.&lt;/p&gt;</comment>
                            <comment id="16671867" author="till.rohrmann" created="Thu, 1 Nov 2018 16:57:42 +0000"  >&lt;p&gt;Thanks a lot for contributing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; I don&apos;t think that this is a release blocker since it is broken for quite some time. However, we should fix it soon.&lt;/p&gt;</comment>
                            <comment id="16673402" author="githubbot" created="Fri, 2 Nov 2018 16:48:20 +0000"  >&lt;p&gt;Myasuka opened a new pull request #7009: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10712&quot; title=&quot;RestartPipelinedRegionStrategy does not restore state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10712&quot;&gt;&lt;del&gt;FLINK-10712&lt;/del&gt;&lt;/a&gt; Support to restore state when using RestartPipelinedRegionStrategy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7009&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7009&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   Currently, RestartPipelinedRegionStrategy does not perform any state restore. This is big problem because all restored regions will be restarted with empty state. This PR supports to restore state when using RestartPipelinedRegionStrategy.&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Implement new `restoreLatestCheckpointedState` API for region-based failover in `CheckpointCoordinator`.&lt;/li&gt;
	&lt;li&gt;Reload checkpointed state when `FailoverRegion` called `restart` method.&lt;/li&gt;
	&lt;li&gt;`StateAssignmentOperation` could assign state with given executionVertices.&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;br/&gt;
   This change added tests and can be verified as follows:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added unit tests for `FailoverRegion` to ensure the failover region ever called new `restoreLatestCheckpointedState` API within `CheckpointCoordinator`.&lt;/li&gt;
	&lt;li&gt;Added unit tests for `CheckpointCoordinatorTest` to ensure `CheckpointCoordinator` could restore with `RestartPipelinedRegionStrategy`.&lt;/li&gt;
	&lt;li&gt;Added unit tests for `CheckpointStateRestoreTest` to ensure `RestartPipelinedRegionStrategy` could handle well when restoring state from a checkpoint to the task executions.&lt;/li&gt;
	&lt;li&gt;Added new integration test `RegionFailoverITCase` to verify state could be restored properly when the job consists multi regions.&lt;/li&gt;
	&lt;li&gt;Refactored `StreamFaultToleranceTestBase` to let all sub-classes ITs could failover with state using RestartPipelinedRegionStrategy.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): don&apos;t know&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? yes&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? JavaDocs&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16699077" author="githubbot" created="Mon, 26 Nov 2018 14:57:43 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #7009: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10712&quot; title=&quot;RestartPipelinedRegionStrategy does not restore state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10712&quot;&gt;&lt;del&gt;FLINK-10712&lt;/del&gt;&lt;/a&gt; Support to restore state when using RestartPipelinedRegionStrategy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7009#discussion_r236283201&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7009#discussion_r236283201&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/StateAssignmentOperation.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -201,31 +261,33 @@ private void assignTaskStateToExecutionJobVertices(&lt;/p&gt;

&lt;p&gt; 		for (int subTaskIndex = 0; subTaskIndex &amp;lt; newParallelism; subTaskIndex++) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Execution currentExecutionAttempt = executionJobVertex.getTaskVertices()&lt;span class=&quot;error&quot;&gt;&amp;#91;subTaskIndex&amp;#93;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;.getCurrentExecutionAttempt();&lt;br/&gt;
+			if (subTaskIndices.contains(subTaskIndex)) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   instead of `for i in (0 .. newParallelism) -&amp;gt; `contains&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;`, why not supply an `Iterable&amp;lt;Integer&amp;gt; subtaskIDs` instead and then `for (int subtask : subtaskIDs)`? The old codepath would just pass in an iterable from 0 to new parallelism.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16699078" author="githubbot" created="Mon, 26 Nov 2018 14:57:43 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #7009: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10712&quot; title=&quot;RestartPipelinedRegionStrategy does not restore state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10712&quot;&gt;&lt;del&gt;FLINK-10712&lt;/del&gt;&lt;/a&gt; Support to restore state when using RestartPipelinedRegionStrategy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7009#discussion_r236284582&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7009#discussion_r236284582&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -1073,6 +1073,108 @@ public boolean restoreLatestCheckpointedState(&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * Restores the latest checkpointed state at the granularity of execution vertex.&lt;br/&gt;
+	 *&lt;br/&gt;
+	 * @param executionVertices Set of execution vertices to restore. State for these vertices is&lt;br/&gt;
+	 * restored via &lt;/p&gt;
{@link Execution#setInitialState(JobManagerTaskRestore)}
&lt;p&gt;.&lt;br/&gt;
+	 * @param errorIfNoCheckpoint Fail if no completed checkpoint is available to&lt;br/&gt;
+	 * restore from.&lt;br/&gt;
+	 * @param allowNonRestoredState Allow checkpoint state that cannot be mapped&lt;br/&gt;
+	 * to any jobID vertex in tasks.&lt;br/&gt;
+	 * @return &amp;lt;code&amp;gt;true&amp;lt;/code&amp;gt; if state was restored, &amp;lt;code&amp;gt;false&amp;lt;/code&amp;gt; otherwise.&lt;br/&gt;
+	 * @throws IllegalStateException If the CheckpointCoordinator is shut down.&lt;br/&gt;
+	 * @throws IllegalStateException If no completed checkpoint is available and&lt;br/&gt;
+	 *                               the &amp;lt;code&amp;gt;failIfNoCheckpoint&amp;lt;/code&amp;gt; flag has been set.&lt;br/&gt;
+	 * @throws IllegalStateException If the checkpoint contains state that cannot be&lt;br/&gt;
+	 *                               mapped to any jobID vertex in &amp;lt;code&amp;gt;tasks&amp;lt;/code&amp;gt; and the&lt;br/&gt;
+	 *                               &amp;lt;code&amp;gt;allowNonRestoredState&amp;lt;/code&amp;gt; flag has not been set.&lt;br/&gt;
+	 * @throws IllegalStateException If the max parallelism changed for an operator&lt;br/&gt;
+	 *                               that restores state from this checkpoint.&lt;br/&gt;
+	 * @throws IllegalStateException If the parallelism changed for an operator&lt;br/&gt;
+	 *                               that restores &amp;lt;i&amp;gt;non-partitioned&amp;lt;/i&amp;gt; state from this&lt;br/&gt;
+	 *                               checkpoint.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public boolean restoreLatestCheckpointedState(&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Again, this is almost a complete duplication of the original method. We should unify boths methods to keep this maintainable.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16699079" author="githubbot" created="Mon, 26 Nov 2018 14:57:43 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #7009: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10712&quot; title=&quot;RestartPipelinedRegionStrategy does not restore state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10712&quot;&gt;&lt;del&gt;FLINK-10712&lt;/del&gt;&lt;/a&gt; Support to restore state when using RestartPipelinedRegionStrategy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7009#discussion_r236283793&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7009#discussion_r236283793&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/StateAssignmentOperation.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -105,13 +106,70 @@ public boolean assignStates() throws Exception &lt;/p&gt;
{
 				continue;
 			}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;assignAttemptState(task.getValue(), operatorStates);&lt;br/&gt;
+			Set&amp;lt;Integer&amp;gt; executionVertexIndices = new HashSet&amp;lt;&amp;gt;();&lt;br/&gt;
+			for (ExecutionVertex executionVertex : task.getValue().getTaskVertices()) 
{
+				executionVertexIndices.add(executionVertex.getParallelSubtaskIndex());
+			}
&lt;p&gt;+			assignAttemptState(task.getValue(), operatorStates, executionVertexIndices);&lt;br/&gt;
+		}&lt;br/&gt;
+&lt;br/&gt;
+		return true;&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Assign states to given execution vertices.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public boolean assignStates(List&amp;lt;ExecutionVertex&amp;gt; executionVertices) throws Exception {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   There is a lot of duplicated code between this method and the orginal `assignStates()`. I am sure that this is not required and if we rethink this a bit the old method should just be able to call the new one. Duplicating most of the code is not very maintainable. I suggest to rething what we gibe to the state assignent operation in constructor or as parameter to this method and unify it. From a quick look I am very sure this is easily possible.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16699080" author="githubbot" created="Mon, 26 Nov 2018 14:57:43 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #7009: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10712&quot; title=&quot;RestartPipelinedRegionStrategy does not restore state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10712&quot;&gt;&lt;del&gt;FLINK-10712&lt;/del&gt;&lt;/a&gt; Support to restore state when using RestartPipelinedRegionStrategy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7009#discussion_r236285508&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7009#discussion_r236285508&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/StateAssignmentOperation.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -105,13 +106,70 @@ public boolean assignStates() throws Exception &lt;/p&gt;
{
 				continue;
 			}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;assignAttemptState(task.getValue(), operatorStates);&lt;br/&gt;
+			Set&amp;lt;Integer&amp;gt; executionVertexIndices = new HashSet&amp;lt;&amp;gt;();&lt;br/&gt;
+			for (ExecutionVertex executionVertex : task.getValue().getTaskVertices()) 
{
+				executionVertexIndices.add(executionVertex.getParallelSubtaskIndex());
+			}
&lt;p&gt;+			assignAttemptState(task.getValue(), operatorStates, executionVertexIndices);&lt;br/&gt;
+		}&lt;br/&gt;
+&lt;br/&gt;
+		return true;&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Assign states to given execution vertices.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public boolean assignStates(List&amp;lt;ExecutionVertex&amp;gt; executionVertices) throws Exception {&lt;br/&gt;
+		Map&amp;lt;OperatorID, OperatorState&amp;gt; localOperators = new HashMap&amp;lt;&amp;gt;(operatorStates);&lt;br/&gt;
+		Map&amp;lt;JobVertexID, ExecutionJobVertex&amp;gt; localTasks = this.tasks;&lt;br/&gt;
+&lt;br/&gt;
+		checkStateMappingCompleteness(allowNonRestoredState, operatorStates, tasks);&lt;br/&gt;
+&lt;br/&gt;
+		// get job vertex and its subTaskIndex from given executionVertices.&lt;br/&gt;
+		Map&amp;lt;JobVertexID, Set&amp;lt;Integer&amp;gt;&amp;gt; jobVertexIDSetMap = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
+		for (ExecutionVertex executionVertex : executionVertices) &lt;/p&gt;
{
+			JobVertexID jobvertexId = executionVertex.getJobvertexId();
+			jobVertexIDSetMap.putIfAbsent(jobvertexId, new HashSet&amp;lt;&amp;gt;());
+			jobVertexIDSetMap.get(jobvertexId).add(executionVertex.getParallelSubtaskIndex());
+		}
&lt;p&gt;+&lt;br/&gt;
+		for (Map.Entry&amp;lt;JobVertexID, ExecutionJobVertex&amp;gt; task : localTasks.entrySet()) {&lt;br/&gt;
+			final ExecutionJobVertex executionJobVertex = task.getValue();&lt;br/&gt;
+&lt;br/&gt;
+			// find the states of all operators belonging to this task&lt;br/&gt;
+			List&amp;lt;OperatorID&amp;gt; operatorIDs = executionJobVertex.getOperatorIDs();&lt;br/&gt;
+			List&amp;lt;OperatorID&amp;gt; altOperatorIDs = executionJobVertex.getUserDefinedOperatorIDs();&lt;br/&gt;
+			List&amp;lt;OperatorState&amp;gt; operatorStates = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
+			boolean statelessTask = true;&lt;br/&gt;
+			for (int x = 0; x &amp;lt; operatorIDs.size(); x++) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+				OperatorID operatorID = altOperatorIDs.get(x) == null+					? operatorIDs.get(x)+					}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+			if (statelessTask) &lt;/p&gt;
{ // skip tasks where no operator has any state
+				continue;
+			}
&lt;p&gt;+&lt;br/&gt;
+			if (jobVertexIDSetMap.containsKey(executionJobVertex.getJobVertexId())) &lt;/p&gt;
{
+				assignAttemptState(executionJobVertex, operatorStates, jobVertexIDSetMap.get(executionJobVertex.getJobVertexId()));
+			}
&lt;p&gt; 		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		return true;&lt;br/&gt;
 	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private void assignAttemptState(ExecutionJobVertex executionJobVertex, List&amp;lt;OperatorState&amp;gt; operatorStates) {&lt;br/&gt;
+	private void assignAttemptState(ExecutionJobVertex executionJobVertex, List&amp;lt;OperatorState&amp;gt; operatorStates, Set&amp;lt;Integer&amp;gt; subTaskIndices) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   I doubt that `Set&amp;lt;Integer&amp;gt;` is the best representation of subtask indexes. At least from the interface leven, an `Iterable&amp;lt;Integer&amp;gt;` could do the job if we rewite the loop as I suggested. Forthermore, we can have a more memory friendly implementation to back this, for example `boolean[]` or `Bitset`. &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16704290" author="githubbot" created="Fri, 30 Nov 2018 05:35:32 +0000"  >&lt;p&gt;Myasuka commented on issue #7009: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10712&quot; title=&quot;RestartPipelinedRegionStrategy does not restore state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10712&quot;&gt;&lt;del&gt;FLINK-10712&lt;/del&gt;&lt;/a&gt; Support to restore state when using RestartPipelinedRegionStrategy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7009#issuecomment-443096765&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7009#issuecomment-443096765&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @StefanRRichter Thanks for your comments, I would refactor this PR.&lt;br/&gt;
   BTW, I found region failover without letting checkpoint coordinator restart its `checkpointScheduler` would not guarantee `EXACTLY_ONCE` mechanism. I&apos;ll include this part of modification in next commits.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16714574" author="githubbot" created="Mon, 10 Dec 2018 11:00:12 +0000"  >&lt;p&gt;StefanRRichter commented on issue #7009: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10712&quot; title=&quot;RestartPipelinedRegionStrategy does not restore state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10712&quot;&gt;&lt;del&gt;FLINK-10712&lt;/del&gt;&lt;/a&gt; Support to restore state when using RestartPipelinedRegionStrategy&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7009#issuecomment-445776062&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7009#issuecomment-445776062&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Ok, sounds good, looking forward to the new changes!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16820002" author="srichter" created="Wed, 17 Apr 2019 11:49:39 +0000"  >&lt;p&gt;Merged in:&lt;br/&gt;
master: c3a9293&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13215767">FLINK-11618</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13198303">FLINK-10880</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13249130">FLINK-13601</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13081702">FLINK-6984</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zqz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>