<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:23:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3633] Job submission silently fails when using user code types</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3633</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;With the changes introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3327&quot; title=&quot;Attach the ExecutionConfig to the JobGraph and make it accessible to the AbstractInvocable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3327&quot;&gt;&lt;del&gt;FLINK-3327&lt;/del&gt;&lt;/a&gt;, it is no longer possible to run remote Flink jobs which work on user code types. The reason is that now the &lt;tt&gt;ExecutionConfig&lt;/tt&gt; is directly stored in the &lt;tt&gt;JobGraph&lt;/tt&gt; which is sent as an Akka message to the &lt;tt&gt;JobManager&lt;/tt&gt;. Per default, user code types are automatically detected and registered in the &lt;tt&gt;ExecutionConfig&lt;/tt&gt;. When deserializing a &lt;tt&gt;JobGraph&lt;/tt&gt; whose &lt;tt&gt;ExecutionConfig&lt;/tt&gt; contains user code classes the user code class loader is consequently required. However, Akka does not have access to it and uses the system class loader. This causes that Akka silently discards the &lt;tt&gt;SubmitJob&lt;/tt&gt; message which cannot be deserialized because of a &lt;tt&gt;ClassNotFoundException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I propose to not sent the &lt;tt&gt;ExecutionConfig&lt;/tt&gt; explicitly with the &lt;tt&gt;JobGraph&lt;/tt&gt; and, thus, to partially revert the changes to before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3327&quot; title=&quot;Attach the ExecutionConfig to the JobGraph and make it accessible to the AbstractInvocable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3327&quot;&gt;&lt;del&gt;FLINK-3327&lt;/del&gt;&lt;/a&gt;. Before, the &lt;tt&gt;ExectuionConfig&lt;/tt&gt; was serialized into the job configuration and deserialized on the &lt;tt&gt;TaskManager&lt;/tt&gt; using the proper user code class loader.&lt;/p&gt;

&lt;p&gt;In order to reproduce the problem you can submit the following job to a remote cluster.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Job {
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CustomType {
		&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; value;

		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CustomType(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; value) {
			&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.value = value;
		}

		@Override
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; toString() {
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;CustomType(&quot;&lt;/span&gt; + value + &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;;
		}
	}

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		ExecutionEnvironment env = ExecutionEnvironment.createRemoteEnvironment(Address, Port, PathToJar);

		DataSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; input = env.fromElements(1,2,3,4,5);

		DataSet&amp;lt;CustomType&amp;gt; customTypes = input.map(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MapFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, CustomType&amp;gt;() {
			@Override
			&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CustomType map(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; integer) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
				&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CustomType(integer);
			}
		});

		customTypes.print();
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12951204">FLINK-3633</key>
            <summary>Job submission silently fails when using user code types</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Mar 2016 13:32:20 +0000</created>
                <updated>Fri, 22 Apr 2016 08:10:25 +0000</updated>
                            <resolved>Fri, 1 Apr 2016 16:10:25 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15201634" author="githubbot" created="Fri, 18 Mar 2016 15:31:52 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3633&quot; title=&quot;Job submission silently fails when using user code types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3633&quot;&gt;&lt;del&gt;FLINK-3633&lt;/del&gt;&lt;/a&gt; Fix user code de/serialization in ExecutionConfig&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3327&quot; title=&quot;Attach the ExecutionConfig to the JobGraph and make it accessible to the AbstractInvocable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3327&quot;&gt;&lt;del&gt;FLINK-3327&lt;/del&gt;&lt;/a&gt; moved the ExecutionConfig directly to the JobGraph so that it was serialized&lt;br/&gt;
    and deserialized using the system class loader when sending a SubmitJob message to the&lt;br/&gt;
    JobManager. This is problematic since the ExecutionConfig can contain user code class&lt;br/&gt;
    which require a user code class loader for deserialization. In order to circumvent the&lt;br/&gt;
    problem, a UserCodeValue class was introduced which automatically sends the wrapped value&lt;br/&gt;
    as a byte array. On the receiving side, the wrapped value has to be explicitly deserialized&lt;br/&gt;
    providing a class loader.&lt;/p&gt;

&lt;p&gt;    To test the feature the ScalaShellITCase.testSubmissionOfExternalLibrary was adapted&lt;br/&gt;
    to register org.apache.flink.ml.math.Vector at the ExecutionConfig.&lt;/p&gt;

&lt;p&gt;    This commit also re-introduces the removed ExecutionConfig.CONFIG_KEY key, so that&lt;br/&gt;
    version 1.1 does not break the API.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixJobSubmission&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1818&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7abef1b685d76a5249ddeb0fcc4f1190b541ba57&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-03-18T15:22:04Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3633&quot; title=&quot;Job submission silently fails when using user code types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3633&quot;&gt;&lt;del&gt;FLINK-3633&lt;/del&gt;&lt;/a&gt; Fix user code de/serialization in ExecutionConfig&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3327&quot; title=&quot;Attach the ExecutionConfig to the JobGraph and make it accessible to the AbstractInvocable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3327&quot;&gt;&lt;del&gt;FLINK-3327&lt;/del&gt;&lt;/a&gt; moved the ExecutionConfig directly to the JobGraph so that it was serialized&lt;br/&gt;
    and deserialized using the system class loader when sending a SubmitJob message to the&lt;br/&gt;
    JobManager. This is problematic since the ExecutionConfig can contain user code class&lt;br/&gt;
    which require a user code class loader for deserialization. In order to circumvent the&lt;br/&gt;
    problem, a UserCodeValue class was introduced which automatically sends the wrapped value&lt;br/&gt;
    as a byte array. On the receiving side, the wrapped value has to be explicitly deserialized&lt;br/&gt;
    providing a class loader.&lt;/p&gt;

&lt;p&gt;    To test the feature the ScalaShellITCase.testSubmissionOfExternalLibrary was adapted&lt;br/&gt;
    to register org.apache.flink.ml.math.Vector at the ExecutionConfig.&lt;/p&gt;

&lt;p&gt;    This commit also re-introduces the removed ExecutionConfig.CONFIG_KEY key, so that&lt;br/&gt;
    version 1.1 does not break the API.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15201635" author="greghogan" created="Fri, 18 Mar 2016 15:32:17 +0000"  >&lt;p&gt;I am puzzled why this appears to work for some user classes yet fails with other user classes.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;This comment was in regard to the original ticket, not the pull request that appear simultaneously&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="15201654" author="till.rohrmann" created="Fri, 18 Mar 2016 15:40:41 +0000"  >&lt;p&gt;It works for all user classes which are also available to the system class loader. So for example, if you put the gelly library in the &lt;tt&gt;lib&lt;/tt&gt; folder, then the gelly classes are available to the system class loader and you won&apos;t see a problem.&lt;/p&gt;</comment>
                            <comment id="15201665" author="githubbot" created="Fri, 18 Mar 2016 15:46:15 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56676581&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56676581&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/setup/config.md &amp;#8212;&lt;br/&gt;
    @@ -183,7 +184,7 @@ The following parameters configure Flink&apos;s JobManager and TaskManagers.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`akka.transport.threshold`: Threshold for the transport failure detector. Since Flink uses TCP, the detector is not necessary and, thus, the threshold is set to a high value (DEFAULT: *&lt;b&gt;300&lt;/b&gt;*).&lt;/li&gt;
	&lt;li&gt;`akka.tcp.timeout`: Timeout for all outbound connections. If you should experience problems with connecting to a TaskManager due to a slow network, you should increase this value (DEFAULT: *&lt;b&gt;akka.ask.timeout&lt;/b&gt;*).&lt;/li&gt;
	&lt;li&gt;`akka.throughput`: Number of messages that are processed in a batch before returning the thread to the pool. Low values denote a fair scheduling whereas high values can increase the performance at the cost of unfairness (DEFAULT: *&lt;b&gt;15&lt;/b&gt;*).
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;`akka.log.lifecycle.events`: Turns on the Akka&apos;s remote logging of events. Set this value to &apos;on&apos; in case of debugging (DEFAULT: *&lt;b&gt;off&lt;/b&gt;*).&lt;br/&gt;
    +- `akka.log.lifecycle.events`: Turns on the Akka&apos;s remote logging of events. Set this value to &apos;on&apos; in case of debugging (DEFAULT: *&lt;b&gt;false&lt;/b&gt;*).
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Should this say, &quot;Set this value to &apos;true&apos; in case ...&quot;?&lt;/p&gt;</comment>
                            <comment id="15201670" author="githubbot" created="Fri, 18 Mar 2016 15:48:10 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56676850&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56676850&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/setup/config.md &amp;#8212;&lt;br/&gt;
    @@ -183,7 +184,7 @@ The following parameters configure Flink&apos;s JobManager and TaskManagers.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`akka.transport.threshold`: Threshold for the transport failure detector. Since Flink uses TCP, the detector is not necessary and, thus, the threshold is set to a high value (DEFAULT: *&lt;b&gt;300&lt;/b&gt;*).&lt;/li&gt;
	&lt;li&gt;`akka.tcp.timeout`: Timeout for all outbound connections. If you should experience problems with connecting to a TaskManager due to a slow network, you should increase this value (DEFAULT: *&lt;b&gt;akka.ask.timeout&lt;/b&gt;*).&lt;/li&gt;
	&lt;li&gt;`akka.throughput`: Number of messages that are processed in a batch before returning the thread to the pool. Low values denote a fair scheduling whereas high values can increase the performance at the cost of unfairness (DEFAULT: *&lt;b&gt;15&lt;/b&gt;*).
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;`akka.log.lifecycle.events`: Turns on the Akka&apos;s remote logging of events. Set this value to &apos;on&apos; in case of debugging (DEFAULT: *&lt;b&gt;off&lt;/b&gt;*).&lt;br/&gt;
    +- `akka.log.lifecycle.events`: Turns on the Akka&apos;s remote logging of events. Set this value to &apos;on&apos; in case of debugging (DEFAULT: *&lt;b&gt;false&lt;/b&gt;*).
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes, definitely. Thanks for spotting it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15201746" author="githubbot" created="Fri, 18 Mar 2016 16:29:12 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56683381&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56683381&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/util/UserCodeValue.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,98 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.util;&lt;br/&gt;
    +&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.io.ObjectOutputStream;&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Value wrapper which automatically transfers the data as a serialized byte array. Upon reception&lt;br/&gt;
    + * the serialized byte array has to be explicitly deserialized providing a class loader with the&lt;br/&gt;
    + * correct classes.&lt;br/&gt;
    + *&lt;br/&gt;
    + * This is useful if the object would get deserialized by the system class loader which does not&lt;br/&gt;
    + * have access to the user code classes.&lt;br/&gt;
    + * @param &amp;lt;T&amp;gt;&lt;br/&gt;
    + */&lt;br/&gt;
    +public class UserCodeValue&amp;lt;T extends Serializable&amp;gt; implements Serializable {&lt;br/&gt;
    +	private static final long serialVersionUID = 6903400536729445732L;&lt;br/&gt;
    +&lt;br/&gt;
    +	private transient T value;&lt;br/&gt;
    +&lt;br/&gt;
    +	private byte[] serializedValue;&lt;br/&gt;
    +&lt;br/&gt;
    +	public UserCodeValue(T value) &lt;/p&gt;
{
    +		this.value = value;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public T getValue() {&lt;br/&gt;
    +		if (value == null &amp;amp;&amp;amp; serializedValue != null) {&lt;br/&gt;
    +			throw new NullPointerException(&quot;The user code value has not been serialied. Call &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    &quot;serialized&quot; -&amp;gt; &quot;deserialized&quot;?&lt;/p&gt;</comment>
                            <comment id="15201749" author="githubbot" created="Fri, 18 Mar 2016 16:30:42 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56683616&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56683616&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java &amp;#8212;&lt;br/&gt;
    @@ -499,7 +514,7 @@ else if (current == ExecutionState.CANCELING) {&lt;br/&gt;
     					jobId, vertexId, executionId, userCodeClassLoader, actorAskTimeout);&lt;/p&gt;

&lt;p&gt;     			Environment env = new RuntimeEnvironment(jobId, vertexId, executionId,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;executionConfig, taskInfo, jobConfiguration, taskConfiguration,&lt;br/&gt;
    +				executionConfig, taskInfo, jobConfiguration, taskConfiguration,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Formatting regression?&lt;/p&gt;</comment>
                            <comment id="15201893" author="githubbot" created="Fri, 18 Mar 2016 18:09:25 +0000"  >&lt;p&gt;Github user rmetzger commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56699092&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56699092&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/ExecutionConfig.java &amp;#8212;&lt;br/&gt;
    @@ -109,22 +113,22 @@&lt;/p&gt;

&lt;p&gt;     	private RestartStrategies.RestartStrategyConfiguration restartStrategyConfiguration;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private long taskCancellationIntervalMillis = ConfigConstants.DEFAULT_TASK_CANCELLATION_INTERVAL_MILLIS;&lt;br/&gt;
    +	private long taskCancellationIntervalMillis = -1;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// Serializers and types registered with Kryo and the PojoSerializer&lt;br/&gt;
     	// we store them in linked maps/sets to ensure they are registered in order in all kryo instances.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt; registeredTypesWithKryoSerializers = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializers = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializerClasses = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializerClasses = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt; defaultKryoSerializers = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializers = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializerClasses = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializerClasses = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; registeredKryoTypes = new LinkedHashSet&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredKryoTypes = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; registeredPojoTypes = new LinkedHashSet&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredPojoTypes = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    You forgot to put the `GlobalJobParameters` into a `UserCodeValue`. That one can also contain usercode.&lt;/p&gt;</comment>
                            <comment id="15204000" author="githubbot" created="Mon, 21 Mar 2016 10:34:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56803053&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56803053&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/util/UserCodeValue.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,98 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.util;&lt;br/&gt;
    +&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.IOException;&lt;br/&gt;
    +import java.io.ObjectOutputStream;&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Arrays;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Value wrapper which automatically transfers the data as a serialized byte array. Upon reception&lt;br/&gt;
    + * the serialized byte array has to be explicitly deserialized providing a class loader with the&lt;br/&gt;
    + * correct classes.&lt;br/&gt;
    + *&lt;br/&gt;
    + * This is useful if the object would get deserialized by the system class loader which does not&lt;br/&gt;
    + * have access to the user code classes.&lt;br/&gt;
    + * @param &amp;lt;T&amp;gt;&lt;br/&gt;
    + */&lt;br/&gt;
    +public class UserCodeValue&amp;lt;T extends Serializable&amp;gt; implements Serializable {&lt;br/&gt;
    +	private static final long serialVersionUID = 6903400536729445732L;&lt;br/&gt;
    +&lt;br/&gt;
    +	private transient T value;&lt;br/&gt;
    +&lt;br/&gt;
    +	private byte[] serializedValue;&lt;br/&gt;
    +&lt;br/&gt;
    +	public UserCodeValue(T value) &lt;/p&gt;
{
    +		this.value = value;
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	public T getValue() {&lt;br/&gt;
    +		if (value == null &amp;amp;&amp;amp; serializedValue != null) {&lt;br/&gt;
    +			throw new NullPointerException(&quot;The user code value has not been serialied. Call &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    good catch. Thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15204001" author="githubbot" created="Mon, 21 Mar 2016 10:34:26 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56803087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56803087&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java &amp;#8212;&lt;br/&gt;
    @@ -499,7 +514,7 @@ else if (current == ExecutionState.CANCELING) {&lt;br/&gt;
     					jobId, vertexId, executionId, userCodeClassLoader, actorAskTimeout);&lt;/p&gt;

&lt;p&gt;     			Environment env = new RuntimeEnvironment(jobId, vertexId, executionId,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;executionConfig, taskInfo, jobConfiguration, taskConfiguration,&lt;br/&gt;
    +				executionConfig, taskInfo, jobConfiguration, taskConfiguration,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    True, will revert it.&lt;/p&gt;</comment>
                            <comment id="15204008" author="githubbot" created="Mon, 21 Mar 2016 10:42:41 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56803957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56803957&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/ExecutionConfig.java &amp;#8212;&lt;br/&gt;
    @@ -109,22 +113,22 @@&lt;/p&gt;

&lt;p&gt;     	private RestartStrategies.RestartStrategyConfiguration restartStrategyConfiguration;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private long taskCancellationIntervalMillis = ConfigConstants.DEFAULT_TASK_CANCELLATION_INTERVAL_MILLIS;&lt;br/&gt;
    +	private long taskCancellationIntervalMillis = -1;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// Serializers and types registered with Kryo and the PojoSerializer&lt;br/&gt;
     	// we store them in linked maps/sets to ensure they are registered in order in all kryo instances.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt; registeredTypesWithKryoSerializers = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializers = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializerClasses = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializerClasses = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt; defaultKryoSerializers = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializers = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializerClasses = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializerClasses = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; registeredKryoTypes = new LinkedHashSet&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredKryoTypes = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; registeredPojoTypes = new LinkedHashSet&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredPojoTypes = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    That is true, I will fix it. Personally, I think this `GlobalJobParameters` is a huge crime. It basically allows you to store anything in the `ExecutionConfig`. Sometimes I&apos;m overcome with the feeling that this `ExecutionConfig` is simply a dumping ground for all kinds of parameters which are somehow needed somewhere.&lt;/p&gt;</comment>
                            <comment id="15204013" author="githubbot" created="Mon, 21 Mar 2016 10:48:40 +0000"  >&lt;p&gt;Github user rmetzger commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#discussion_r56804605&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#discussion_r56804605&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/ExecutionConfig.java &amp;#8212;&lt;br/&gt;
    @@ -109,22 +113,22 @@&lt;/p&gt;

&lt;p&gt;     	private RestartStrategies.RestartStrategyConfiguration restartStrategyConfiguration;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private long taskCancellationIntervalMillis = ConfigConstants.DEFAULT_TASK_CANCELLATION_INTERVAL_MILLIS;&lt;br/&gt;
    +	private long taskCancellationIntervalMillis = -1;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	// Serializers and types registered with Kryo and the PojoSerializer&lt;br/&gt;
     	// we store them in linked maps/sets to ensure they are registered in order in all kryo instances.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt; registeredTypesWithKryoSerializers = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializers = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializerClasses = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&amp;gt; registeredTypesWithKryoSerializerClasses = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt; defaultKryoSerializers = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializers = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, SerializableSerializer&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializerClasses = new LinkedHashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;&amp;gt; defaultKryoSerializerClasses = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashMap&amp;lt;Class&amp;lt;?&amp;gt;, Class&amp;lt;? extends Serializer&amp;lt;?&amp;gt;&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; registeredKryoTypes = new LinkedHashSet&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredKryoTypes = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; registeredPojoTypes = new LinkedHashSet&amp;lt;&amp;gt;();&lt;br/&gt;
    +	private final UserCodeValue&amp;lt;LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;&amp;gt; registeredPojoTypes = new UserCodeValue&amp;lt;&amp;gt;(new LinkedHashSet&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt;());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Thanks for the fix.&lt;/p&gt;

&lt;p&gt;    The original motivation for adding it was the following:&lt;br/&gt;
    Users requested a way to have one central configuration file for all their job&apos;s UDFs. With setting global job parameters (for example the ParameterTool), they can use a properties file and the KVs from there are accessible from all UDFs.&lt;br/&gt;
    Also, the same user wanted to have these configuration properties accessible in the webinterface. So if the `toMap()` method is overwritten (the ParameterTool is doing that), the job parameters are accessible from the web interface.&lt;/p&gt;
</comment>
                            <comment id="15204529" author="githubbot" created="Mon, 21 Mar 2016 16:21:19 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-199363606&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-199363606&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Due to the tight coupling of the ExecutionConfig and multiple Flink components&lt;br/&gt;
    (e.g. PojoSerializer) the automatic serialization and manual deserialization of&lt;br/&gt;
    user code objects via the UserCodeValue class caused problems. In order to minimize&lt;br/&gt;
    the impact of the changes, I changed the serialization strategy to an explicit one.&lt;br/&gt;
    One has to call `ExecutionConfig.serializeUserCode` to store the user code objects in a SerializedValue&lt;br/&gt;
    object and nulling the corresponding member fields. If that is not done, then it is&lt;br/&gt;
    assumed that the object is deserialized using a user code class loader. On the receiving side one has to call `ExecutionConfig.deserializeConfig` providing a class loader which knows the user code classes.&lt;/p&gt;</comment>
                            <comment id="15208470" author="githubbot" created="Wed, 23 Mar 2016 14:20:15 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-200364341&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-200364341&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The issue has been introduced after the 1.0 release, so we don&apos;t need to incldue this into 1.0.1?&lt;/p&gt;</comment>
                            <comment id="15208482" author="githubbot" created="Wed, 23 Mar 2016 14:25:28 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-200366856&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-200366856&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes I think so.&lt;/p&gt;</comment>
                            <comment id="15208489" author="githubbot" created="Wed, 23 Mar 2016 14:26:58 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-200367314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-200367314&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    okay, thank you.&lt;/p&gt;</comment>
                            <comment id="15210119" author="githubbot" created="Thu, 24 Mar 2016 11:48:49 +0000"  >&lt;p&gt;Github user uce commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-200802077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-200802077&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The changes look good and make parts where user code is serialized very clear. :+1: &lt;/p&gt;

&lt;p&gt;    I&apos;ve verified that the `ScalaShellITCase` with the change in this PR fails for the current master. I&apos;m wondering whether it is possible to make the test for this more explicit by adding a JAR with the example program outlined in the JIRA issue to the `ClassLoaderITCase`.&lt;/p&gt;

&lt;p&gt;    In any case, +1 to merge. It&apos;s your call whether you add a further class loader test or not.&lt;/p&gt;


</comment>
                            <comment id="15210180" author="githubbot" created="Thu, 24 Mar 2016 13:03:08 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-200821794&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-200821794&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I agree that having a dedicated class loading test would be nicer. However, we would need to build a jar containing the test job before executing the test, right? So the easiest solution for that would be a new module. But that is also really ugly. @uce do you have a better idea for that?&lt;/p&gt;</comment>
                            <comment id="15210201" author="githubbot" created="Thu, 24 Mar 2016 13:23:19 +0000"  >&lt;p&gt;Github user uce commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-200830880&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-200830880&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The other programs that are executed in `ClassLoaderITCase` are contained in the `org.apache.flink.test.classloading.jar` package (search for `KMeansForTest` for example). They are then packaged by the assembly plugin (see `pom.xml` of `flink-tests`). The `ClassLoaderITCase` sets up a cluster and submits the assembled JARs.&lt;/p&gt;

&lt;p&gt;    Can we just follow this setup?&lt;/p&gt;</comment>
                            <comment id="15210320" author="till.rohrmann" created="Thu, 24 Mar 2016 14:38:40 +0000"  >&lt;p&gt;Yes that should work. Will try to update the PR. Thanks for the pointer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;On Thu, Mar 24, 2016 at 2:23 PM, ASF GitHub Bot (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="15221598" author="githubbot" created="Fri, 1 Apr 2016 11:59:59 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-204368378&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-204368378&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    That is a good idea @uce &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;ll add a corresponding test for the `ExecutionConfig`.&lt;/p&gt;</comment>
                            <comment id="15221695" author="githubbot" created="Fri, 1 Apr 2016 13:39:39 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-204399612&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-204399612&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve added an additional test case for registered user code types in the `ExecutionConfig`. I will rebase this PR and if travis gives green light, then I&apos;ll merge it.&lt;/p&gt;</comment>
                            <comment id="15221896" author="githubbot" created="Fri, 1 Apr 2016 16:08:32 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818#issuecomment-204452690&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818#issuecomment-204452690&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Failing test case seems to be unrelated&lt;/p&gt;</comment>
                            <comment id="15221899" author="till.rohrmann" created="Fri, 1 Apr 2016 16:10:26 +0000"  >&lt;p&gt;Fixed via 0331882af124a1750a54b4c6a9bd13819d65f72e&lt;/p&gt;</comment>
                            <comment id="15221900" author="githubbot" created="Fri, 1 Apr 2016 16:10:38 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1818&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1818&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12956131">FLINK-3701</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2utsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>