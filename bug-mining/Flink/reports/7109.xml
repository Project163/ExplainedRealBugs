<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:17:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-32136] Pyflink gateway server launch fails when purelib != platlib</title>
                <link>https://issues.apache.org/jira/browse/FLINK-32136</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;On distros where python&apos;s &lt;tt&gt;purelib&lt;/tt&gt; is different than &lt;tt&gt;platlib&lt;/tt&gt; (e.g. Amazon Linux 2, but from my research it&apos;s all of the Redhat-based ones), you wind up with components of packages being installed across two different locations (e.g. &lt;tt&gt;/usr/local/lib/python3.7/site-packages/pyflink&lt;/tt&gt; and &lt;tt&gt;/usr/local/lib64/python3.7/site-packages/pyflink&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;_find_flink_home&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/flink/blob/06688f345f6793a8964ec00002175f44cda13c33/flink-python/pyflink/find_flink_home.py#L58C63-L60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;handles&lt;/a&gt; this, and in flink releases &amp;lt;= 1.13.2 its setting of the &lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; environment variable was the one being used. However, from 1.13.3, a refactoring of &lt;tt&gt;launch_gateway_server_process&lt;/tt&gt; (&lt;a href=&quot;https://github.com/apache/flink/blob/release-1.13.2/flink-python/pyflink/pyflink_gateway_server.py#L200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1.13.2,&lt;/a&gt;&#160;&lt;a href=&quot;https://github.com/apache/flink/blob/release-1.13.3/flink-python/pyflink/pyflink_gateway_server.py#L280&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;1.13.3&lt;/a&gt;) re-ordered some method calls. &lt;tt&gt;prepare_environment_variable&lt;/tt&gt;&apos;s &lt;a href=&quot;https://github.com/apache/flink/blob/release-1.13.3/flink-python/pyflink/pyflink_gateway_server.py#L94C67-L95&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;non-awareness&lt;/a&gt; of multiple homes and setting of &lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; now is the one that matters, and it is the incorrect location.&lt;/p&gt;

&lt;p&gt;I&apos;ve confirmed this problem on Amazon Linux 2 and 2023. The problem does not exist on, for example, Ubuntu 20 and 22 (for which &lt;tt&gt;platlib&lt;/tt&gt; == &lt;tt&gt;purelib&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;Repro steps on Amazon Linux 2&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;yum -y install python3 java-11&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;pip3 install apache-flink==1.13.3&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;python3 -c &apos;from pyflink.table import EnvironmentSettings ; EnvironmentSettings.new_instance()&apos;&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The resulting error is&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;The flink-python jar is not found in the opt folder of the FLINK_HOME: /usr/local/lib64/python3.7/site-packages/pyflink&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Error: Could not find or load main class org.apache.flink.client.python.PythonGatewayServer&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Caused by: java.lang.ClassNotFoundException: org.apache.flink.client.python.PythonGatewayServer&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Traceback (most recent call last):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; File &quot;&amp;lt;string&amp;gt;&quot;, line 1, in &amp;lt;module&amp;gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; File &quot;/usr/local/lib64/python3.7/site-packages/pyflink/table/environment_settings.py&quot;, line 214, in new_instance&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; return EnvironmentSettings.Builder()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; File &quot;/usr/local/lib64/python3.7/site-packages/pyflink/table/environment_settings.py&quot;, line 48, in &lt;em&gt;{&lt;/em&gt;}init{&lt;em&gt;}&lt;/em&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; gateway = get_gateway()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; File &quot;/usr/local/lib64/python3.7/site-packages/pyflink/java_gateway.py&quot;, line 62, in get_gateway&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; _gateway = launch_gateway()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; File &quot;/usr/local/lib64/python3.7/site-packages/pyflink/java_gateway.py&quot;, line 112, in launch_gateway&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; raise Exception(&quot;Java gateway process exited before sending its port number&quot;)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;Exception: Java gateway process exited before sending its port number&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The flink home under /lib64/ does not contain the jar, but it is in the /lib/ location&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;bash-4.2# find /usr/local/lib64/python3.7/site-packages/pyflink -name &quot;flink-python*.jar&quot;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;bash-4.2# find /usr/local/lib/python3.7/site-packages/pyflink -name &quot;flink-python*.jar&quot;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;/usr/local/lib/python3.7/site-packages/pyflink/opt/flink-python_2.11-1.13.3.jar&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13536902">FLINK-32136</key>
            <summary>Pyflink gateway server launch fails when purelib != platlib</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dianfu">Dian Fu</assignee>
                                    <reporter username="wash">William Ashley</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 19 May 2023 17:34:49 +0000</created>
                <updated>Sat, 17 Jun 2023 10:03:29 +0000</updated>
                            <resolved>Sat, 17 Jun 2023 10:03:29 +0000</resolved>
                                    <version>1.13.3</version>
                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.16.3</fixVersion>
                    <fixVersion>1.17.2</fixVersion>
                                    <component>API / Python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17733017" author="dianfu" created="Thu, 15 Jun 2023 11:44:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wash&quot; class=&quot;user-hover&quot; rel=&quot;wash&quot;&gt;wash&lt;/a&gt; Good catch! This seems like a critical problem. Would you like to open a PR to fix this issue?&lt;/p&gt;</comment>
                            <comment id="17733064" author="JIRAUSER300500" created="Thu, 15 Jun 2023 13:36:34 +0000"  >&lt;p&gt;I doubt I&apos;ll have the time anytime soon to study the code enough to make such a change.&lt;/p&gt;</comment>
                            <comment id="17733327" author="dianfu" created="Fri, 16 Jun 2023 05:25:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wash&quot; class=&quot;user-hover&quot; rel=&quot;wash&quot;&gt;wash&lt;/a&gt; I have submitted a PR (&lt;a href=&quot;https://github.com/apache/flink/pull/22802&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/22802&lt;/a&gt;). Could you help to review? It would be great if you could also help to verify it~&lt;/p&gt;</comment>
                            <comment id="17733620" author="JIRAUSER300500" created="Fri, 16 Jun 2023 18:01:27 +0000"  >&lt;p&gt;I can confirm it resolves the use-case that was previously failing for me. Thanks for getting that PR up so quickly.&lt;/p&gt;</comment>
                            <comment id="17733727" author="dianfu" created="Sat, 17 Jun 2023 10:03:29 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master via&#160;f64563bc1a7ff698acd708b61e9e80ae9c3e848f&lt;/li&gt;
	&lt;li&gt;release-1.17 via&#160;1b3f25432a29005370b0f51aaa7d4ee79a5edd58&lt;/li&gt;
	&lt;li&gt;release-1.16 via&#160;f9394025fb756c844ec5f2615971f227d40b9244&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1i0go:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>