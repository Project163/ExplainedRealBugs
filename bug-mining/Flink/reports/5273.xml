<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:55:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22124] The job finished without any exception if error was thrown during state access</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22124</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;For the following job:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; logging

from pyflink.common &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; WatermarkStrategy, Row
from pyflink.common.serialization &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Encoder
from pyflink.common.typeinfo &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; Types
from pyflink.datastream &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamExecutionEnvironment
from pyflink.datastream.connectors &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; FileSink, OutputFileConfig, NumberSequenceSource
from pyflink.datastream.execution_mode &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; RuntimeExecutionMode
from pyflink.datastream.functions &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; KeyedProcessFunction, RuntimeContext
from pyflink.datastream.state &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; MapStateDescriptor


env = StreamExecutionEnvironment.get_execution_environment()
env.set_parallelism(2)
env.set_runtime_mode(RuntimeExecutionMode.BATCH)

seq_num_source = NumberSequenceSource(1, 1000)

file_sink = FileSink \
    .for_row_format(&lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/dianfu/code/src/apache/playgrounds/examples/output/data_stream_batch_state&apos;&lt;/span&gt;,
                    Encoder.simple_string_encoder()) \
    .with_output_file_config(OutputFileConfig.builder().with_part_prefix(&lt;span class=&quot;code-quote&quot;&gt;&apos;pre&apos;&lt;/span&gt;).with_part_suffix(&lt;span class=&quot;code-quote&quot;&gt;&apos;suf&apos;&lt;/span&gt;).build()) \
    .build()

ds = env.from_source(
    source=seq_num_source,
    watermark_strategy=WatermarkStrategy.for_monotonous_timestamps(),
    source_name=&lt;span class=&quot;code-quote&quot;&gt;&apos;file_source&apos;&lt;/span&gt;,
    type_info=Types.LONG())


&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyKeyedProcessFunction(KeyedProcessFunction):

    def __init__(self):
        self.state = None

    def open(self, runtime_context: RuntimeContext):
        logging.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;open&quot;&lt;/span&gt;)
        state_desc = MapStateDescriptor(&lt;span class=&quot;code-quote&quot;&gt;&apos;map&apos;&lt;/span&gt;, Types.LONG(), Types.LONG())
        self.state = runtime_context.get_map_state(state_desc)

    def process_element(self, value, ctx: &lt;span class=&quot;code-quote&quot;&gt;&apos;KeyedProcessFunction.Context&apos;&lt;/span&gt;):
        existing = self.state.get(value[0])
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; existing is None:
            result = value[1]
            self.state.put(value[0], result)
        elif existing &amp;lt;= 10:
            result = value[1] + existing
            self.state.put(value[0], result)
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
            result = existing
        yield result


ds.map(lambda a: Row(a % 4, 1), output_type=Types.ROW([Types.LONG(), Types.LONG()])) \
    .key_by(lambda a: a[0]) \
    .process(MyKeyedProcessFunction(), Types.LONG()) \
    .sink_to(file_sink)

env.execute(&lt;span class=&quot;code-quote&quot;&gt;&apos;data_stream_batch_state&apos;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As it will encounter KeyError in `self.state.get(value&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;)` if value&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; doesn&apos;t exist in the state, the job finished without any error message. This issue should be addressed. We should make sure the error message appears in the log file to help users to figure out what happens.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13369795">FLINK-22124</key>
            <summary>The job finished without any exception if error was thrown during state access</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hxbks2ks">Huang Xingbo</assignee>
                                    <reporter username="dian.fu">Dian Fu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 6 Apr 2021 12:45:53 +0000</created>
                <updated>Fri, 28 May 2021 09:05:37 +0000</updated>
                            <resolved>Tue, 13 Apr 2021 11:39:58 +0000</resolved>
                                    <version>1.13.0</version>
                                    <fixVersion>1.13.0</fixVersion>
                    <fixVersion>1.12.3</fixVersion>
                                    <component>API / Python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17320099" author="hxbks2ks" created="Tue, 13 Apr 2021 11:39:58 +0000"  >&lt;p&gt;Merged into master via f82941852a4abda0cb1d60d54970031b750b2e4b&lt;br/&gt;
Merged into release-1.12 via feb1155c4e7458b6d5c3310cbf65c29a571b23e7&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0pkio:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>