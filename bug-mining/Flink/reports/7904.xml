<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:22:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-38370] CommitterOperator does not checkpoint all pending committables</title>
                <link>https://issues.apache.org/jira/browse/FLINK-38370</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;What is the issue?&lt;br/&gt;
==============&lt;/p&gt;

&lt;p&gt;In a nutshell, the CommiterOperator (V2 Sink) does not commit all pending committables for batch pipelines anymore, but only for current_checkpoint_id+1. This is caused specifically by this line: &lt;a href=&quot;https://github.com/apache/flink/blob/5ad464d8156b5094e0aba7712e4aa22b9f44e84d/flink-runtime/src/main/java/org/apache/flink/streaming/runtime/operators/sink/CommitterOperator.java#L154&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/5ad464d8156b5094e0aba7712e4aa22b9f44e84d/flink-runtime/src/main/java/org/apache/flink/streaming/runtime/operators/sink/CommitterOperator.java#L154&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In Iceberg, we use `Long.MAX_VALUE` for the final checkpoint id: &lt;a href=&quot;https://github.com/apache/iceberg/blob/ee90c10e39cec0ccceb9425e03a3e0b5690daf3b/flink/v2.0/flink/src/main/java/org/apache/iceberg/flink/sink/IcebergWriteAggregator.java#L79&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/iceberg/blob/ee90c10e39cec0ccceb9425e03a3e0b5690daf3b/flink/v2.0/flink/src/main/java/org/apache/iceberg/flink/sink/IcebergWriteAggregator.java#L79&lt;/a&gt;. This value was generally used by other connectors in Flink. This behavior was changed in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-37605&quot; title=&quot;SinkWriter may incorrectly infer end of input during rescale&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-37605&quot;&gt;&lt;del&gt;FLINK-37605&lt;/del&gt;&lt;/a&gt; / &lt;a href=&quot;https://github.com/apache/flink/pull/26433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/26433&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Since committables using `Long.MAX_VALUE` won&apos;t be committed, the Iceberg table won&apos;t be updated on shutdown, which means it will not contain any data! That results in potential data loss.&lt;/p&gt;

&lt;p&gt;How to fix this issue?&lt;br/&gt;
================&lt;/p&gt;

&lt;p&gt;For Flink 2.1.0+, Iceberg can generate committables with `checkpoint = last_checkpoint_id + 1`. We already took this approach in &lt;a href=&quot;https://github.com/apache/iceberg/pull/13714&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/iceberg/pull/13714&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;That is fine for the upcoming Iceberg version for Flink 2.1.0, but users who use the current Iceberg version with 1.19.2 or 1.20.1 will be up for a surprise when they upgrade to the latest patch release 1.19.3 or 1.20.2. We should restore the old behavior for the Flink 1.19.4 and 1.20.3 releases.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13629139">FLINK-38370</key>
            <summary>CommitterOperator does not checkpoint all pending committables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="mxm">Maximilian Michels</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 17 Sep 2025 08:53:42 +0000</created>
                <updated>Thu, 2 Oct 2025 09:26:25 +0000</updated>
                            <resolved>Mon, 22 Sep 2025 08:00:06 +0000</resolved>
                                    <version>1.19.3</version>
                    <version>1.20.2</version>
                    <version>2.0.1</version>
                                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>1.19.4</fixVersion>
                    <fixVersion>1.20.3</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="18021074" author="JIRAUSER306704" created="Thu, 18 Sep 2025 07:49:28 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt;, I am preparing the 1.20.3 release in a few days. Seems like you are proposing to restore the old behavior for Flink 1.20.3. If it can be fixed in a day or two, we can wait for the fix.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid&quot; class=&quot;user-hover&quot; rel=&quot;arvid&quot;&gt;arvid&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18021091" author="arvid" created="Thu, 18 Sep 2025 08:53:36 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; , did you read up the respective ticket and understood the implications? Basically, there can be multiple final checkpoints and using MAX_VALUE breaks any reliable way to correlate them which is important for STREAMING. That&apos;s also important if parts of your pipeline finish before other parts of the pipeline. Because closed operators also receive the final checkpoint.&lt;br/&gt;
I suggest to rather backport your adjustments to the old iceberg releases and release bugfix releases.&lt;/p&gt;

&lt;p&gt;Sorry for the breaking changes but we basically dealt with data loss scenarios in STREAMING. We apparently have a choice here to break STREAMING in edge cases or BATCH in general but you already have a fix for the latter.&lt;/p&gt;</comment>
                            <comment id="18021133" author="mxm" created="Thu, 18 Sep 2025 10:45:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid&quot; class=&quot;user-hover&quot; rel=&quot;arvid&quot;&gt;arvid&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Hi Maximilian Michels , did you read up the respective ticket and understood the implications?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes! I think the change, all in all, makes a lot of sense. Please let me know if I misunderstood anything.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Basically, there can be multiple final checkpoints and using MAX_VALUE breaks any reliable way to correlate them which is important for STREAMING.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Maybe I didn&apos;t make it clear, but this is a batch-only issue. STREAMING does not have this issue. The new logic makes perfect sense for streaming.&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;That&apos;s also important if parts of your pipeline finish before other parts of the pipeline. Because closed operators also receive the final checkpoint.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s fine for streaming, but there will be only one &quot;checkpoint&quot; in batch when we call the finish() method. After the change in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-37605&quot; title=&quot;SinkWriter may incorrectly infer end of input during rescale&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-37605&quot;&gt;&lt;del&gt;FLINK-37605&lt;/del&gt;&lt;/a&gt;, when a user upgrades to the latest patch version, they will suddenly not have any data committed by the V2 sink framework for batch pipelines. That does not seem right.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I suggest to rather backport your adjustments to the old iceberg releases and release bugfix releases.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Frankly, I don&apos;t think that is an option. How would we even detect which Flink version has which behavior? I&apos;m fine with the change in minor versions, but patch releases must retain the current behavior. Again, I&apos;m not against the general approach, but we must fix the issue described in this JIRA, which affects batch pipelines only.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Sorry for the breaking changes but we basically dealt with data loss scenarios in STREAMING. We apparently have a choice here to break STREAMING in edge cases or BATCH in general but you already have a fix for the latter.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-37605&quot; title=&quot;SinkWriter may incorrectly infer end of input during rescale&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-37605&quot;&gt;&lt;del&gt;FLINK-37605&lt;/del&gt;&lt;/a&gt; is ok and I understand why it was necessary, but it introduces a new issue which needs to be fixed for the next patch release.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sxnan&quot; class=&quot;user-hover&quot; rel=&quot;sxnan&quot;&gt;sxnan&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Hi Maximilian Michels, I am preparing the 1.20.3 release in a few days. Seems like you are proposing to restore the old behavior for Flink 1.20.3. If it can be fixed in a day or two, we can wait for the fix.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That would be great, I think I can provide a fix. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid&quot; class=&quot;user-hover&quot; rel=&quot;arvid&quot;&gt;arvid&lt;/a&gt; can probably help reviewing it.&lt;/p&gt;</comment>
                            <comment id="18021197" author="mxm" created="Thu, 18 Sep 2025 14:54:24 +0000"  >&lt;p&gt;Here is the promised fix: &lt;a href=&quot;https://github.com/apache/flink/pull/27004&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/27004&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="18021198" author="arvid" created="Thu, 18 Sep 2025 14:55:32 +0000"  >&lt;p&gt;Okay &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; agreed to proceed with rollback for the patch versions.&lt;/p&gt;</comment>
                            <comment id="18021200" author="arvid" created="Thu, 18 Sep 2025 14:57:02 +0000"  >&lt;p&gt;Approved.&lt;/p&gt;</comment>
                            <comment id="18021214" author="mxm" created="Thu, 18 Sep 2025 16:13:57 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Okay &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; agreed to proceed with rollback for the patch versions.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks! For the patch versions, do you prefer rolling back the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-37605&quot; title=&quot;SinkWriter may incorrectly infer end of input during rescale&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-37605&quot;&gt;&lt;del&gt;FLINK-37605&lt;/del&gt;&lt;/a&gt; or forward-fixing via &lt;a href=&quot;https://github.com/apache/flink/pull/27004?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/27004?&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="18021343" author="JIRAUSER306704" created="Fri, 19 Sep 2025 07:12:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; Looks like the patch is merged in master. Can we backport the fix to release-1.20? I am waiting for the fix before building the release candidate.&lt;/p&gt;</comment>
                            <comment id="18021425" author="mxm" created="Fri, 19 Sep 2025 14:07:17 +0000"  >&lt;p&gt;Status: &lt;/p&gt;

&lt;p&gt;1.19: Fix is merged (4ee1a82388c42a294c795257013dd99e53c0b110)&lt;br/&gt;
1.20: Fix is merged (691b8f9b8a182eeb29fb1306afb350d4b5995e31)&lt;br/&gt;
2.0: Fix is merged (70004f1fcbba95ac8e63bebe89b5d80f44e16274)&lt;br/&gt;
2.1: Fix is merged (7025a3f1ec19b8ca9b537d2dce1805a2624c5953)&lt;br/&gt;
master: Fix is merged (335621e598c86bbc5e9d782e95869aaf8960e914)&lt;/p&gt;

&lt;p&gt;edit: Updated comment to reflect all commits.&lt;/p&gt;</comment>
                            <comment id="18021776" author="mxm" created="Mon, 22 Sep 2025 08:00:06 +0000"  >&lt;p&gt;This is now complete. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arvid&quot; class=&quot;user-hover&quot; rel=&quot;arvid&quot;&gt;arvid&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sxnan&quot; class=&quot;user-hover&quot; rel=&quot;sxnan&quot;&gt;sxnan&lt;/a&gt; for the quick reviews and for holding off the Flink 1.20.3 release until the fix was in.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13614005">FLINK-37605</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1xqcw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fix an issue in the Sink V2 sink framework for batch pipelines (either batch execution mode or streaming mode with checkpointing disabled), which prevents a final checkpoint on job shutdown.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>