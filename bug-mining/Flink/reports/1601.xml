<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:27:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6162] Fix bug in ByteArrayOutputStreamWithPos#setPosition</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6162</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently the precondition check in setPosition will fail when the buffer is full: &lt;br/&gt;
&lt;tt&gt;Preconditions.checkArgument(position &amp;lt; getEndPosition(), &quot;Position out of bounds.&quot;);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;We should allow the expected position to be the end position&lt;/p&gt;</description>
                <environment></environment>
        <key id="13058216">FLINK-6162</key>
            <summary>Fix bug in ByteArrayOutputStreamWithPos#setPosition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wenlong.lwl">Wenlong Lyu</assignee>
                                    <reporter username="wenlong.lwl">Wenlong Lyu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Mar 2017 13:16:05 +0000</created>
                <updated>Thu, 28 Feb 2019 13:20:45 +0000</updated>
                            <resolved>Sat, 8 Apr 2017 00:20:14 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15936280" author="githubbot" created="Wed, 22 Mar 2017 13:18:21 +0000"  >&lt;p&gt;GitHub user wenlong88 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6162&quot; title=&quot;Fix bug in ByteArrayOutputStreamWithPos#setPosition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6162&quot;&gt;&lt;del&gt;FLINK-6162&lt;/del&gt;&lt;/a&gt;Fix bug in ByteArrayOutputStreamWithPos#setPosition&lt;/p&gt;

&lt;p&gt;    Currently the precondition check in setPosition will fail when the buffer is full: &lt;br/&gt;
    {{Preconditions.checkArgument(position &amp;lt; getEndPosition(), &quot;Position out of bounds.&quot;);{{&lt;br/&gt;
    We should allow the expected position to be the end position&lt;/p&gt;

&lt;p&gt;    I have added a test on the fix.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/wenlong88/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wenlong88/flink&lt;/a&gt; bugfix-1&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3595&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 905e513612142a934bde78e54bf8a311c25a3107&lt;br/&gt;
Author: wenlong.lwl &amp;lt;wenlong.lwl@alibaba-inc.com&amp;gt;&lt;br/&gt;
Date:   2017-03-22T01:48:42Z&lt;/p&gt;

&lt;p&gt;    Fix bug in ByteArrayOutputStreamWithPos&lt;/p&gt;

&lt;p&gt;commit 09cc96adf52f78052bb3555f2ccda0d860da4895&lt;br/&gt;
Author: wenlong.lwl &amp;lt;wenlong.lwl@alibaba-inc.com&amp;gt;&lt;br/&gt;
Date:   2017-03-22T06:30:59Z&lt;/p&gt;

&lt;p&gt;    fix typo&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15936381" author="githubbot" created="Wed, 22 Mar 2017 14:18:54 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595#discussion_r107423467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595#discussion_r107423467&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/core/memory/ByteArrayOutputStreamWithPosTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,31 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.core.memory;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class ByteArrayOutputStreamWithPosTest {&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void setPositionWhenBufferIsFull() throws Exception {&lt;br/&gt;
    +		ByteArrayOutputStreamWithPos stream = new ByteArrayOutputStreamWithPos();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Initialize with a constant size matching the next line.&lt;/p&gt;</comment>
                            <comment id="15937546" author="githubbot" created="Thu, 23 Mar 2017 01:51:42 +0000"  >&lt;p&gt;Github user wenlong88 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @greghogan thanks for the review, I have changed the change test to use explicit buffer size.&lt;br/&gt;
    you are right that currently there is no dependency on this method. We used the ByteArrayOutputStreamWithPOs in our own scenario and caught the bug.&lt;/p&gt;</comment>
                            <comment id="15938556" author="githubbot" created="Thu, 23 Mar 2017 15:21:50 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595#discussion_r107696959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595#discussion_r107696959&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/core/memory/ByteArrayOutputStreamWithPosTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,31 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.core.memory;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class ByteArrayOutputStreamWithPosTest {&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void setPositionWhenBufferIsFull() throws Exception {&lt;br/&gt;
    +		ByteArrayOutputStreamWithPos stream = new ByteArrayOutputStreamWithPos(32);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think it is stronger to replace `32` on these lines with a descriptive local variable. After initialization could add an assertion that `getBuf().length` equals that value.&lt;/p&gt;</comment>
                            <comment id="15938557" author="githubbot" created="Thu, 23 Mar 2017 15:21:50 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595#discussion_r107697744&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595#discussion_r107697744&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/core/memory/ByteArrayOutputStreamWithPosTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,31 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.core.memory;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class ByteArrayOutputStreamWithPosTest {&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void setPositionWhenBufferIsFull() throws Exception {&lt;br/&gt;
    +		ByteArrayOutputStreamWithPos stream = new ByteArrayOutputStreamWithPos(32);&lt;br/&gt;
    +		stream.write(new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;32&amp;#93;&lt;/span&gt;);&lt;br/&gt;
    +		stream.setPosition(stream.getPosition());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Assert that `getPosition` is equal to the expected value. Can validate that `setPosition` now works per the change above and does not change the position, and also check that `toString` can be executed.&lt;/p&gt;</comment>
                            <comment id="15939776" author="githubbot" created="Fri, 24 Mar 2017 04:27:21 +0000"  >&lt;p&gt;Github user wenlong88 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @greghogan comments addressed&lt;/p&gt;</comment>
                            <comment id="15940181" author="githubbot" created="Fri, 24 Mar 2017 11:29:44 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I would suggest to introduce the analogue check also in `ByteArrayInputStreamWithPos`.&lt;/p&gt;</comment>
                            <comment id="15944618" author="githubbot" created="Tue, 28 Mar 2017 06:27:34 +0000"  >&lt;p&gt;Github user wenlong88 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    hi, @StefanRRichter , I have add check in setPosition in ByteArrayInputSteamWithPos, there is no dependency on this method too, so I rename the method from setPos to setPosition for unifying.&lt;/p&gt;</comment>
                            <comment id="15947056" author="githubbot" created="Wed, 29 Mar 2017 12:56:34 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595#discussion_r108438856&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595#discussion_r108438856&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/test/java/org/apache/flink/core/memory/ByteArrayInputStreamWithPosTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,50 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
    + * distributed with this work for additional information&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.core.memory;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.junit.Assert;&lt;br/&gt;
    +import org.junit.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +public class ByteArrayInputStreamWithPosTest {&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 *  This tests setting position on a &lt;/p&gt;
{@link ByteArrayInputStreamWithPos}
&lt;p&gt;    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testSetPosition() throws Exception {&lt;br/&gt;
    +		byte[] data = new byte[] &lt;/p&gt;
{&apos;0&apos;,&apos;1&apos;,&apos;2&apos;,&apos;3&apos;,&apos;4&apos;,&apos;5&apos;,&apos;6&apos;,&apos;7&apos;,&apos;8&apos;,&apos;9&apos;}
&lt;p&gt;;&lt;br/&gt;
    +		ByteArrayInputStreamWithPos inputStreamWithPos = new ByteArrayInputStreamWithPos(data);&lt;br/&gt;
    +		inputStreamWithPos.setPosition(1);&lt;br/&gt;
    +		Assert.assertEquals(&apos;1&apos;, inputStreamWithPos.read());&lt;br/&gt;
    +		inputStreamWithPos.setPosition(3);&lt;br/&gt;
    +		Assert.assertEquals(&apos;3&apos;, inputStreamWithPos.read());&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * This tests that the expected position exceeds the capacity of the byte array.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test(expected = IllegalArgumentException.class)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think the preference is to instead use `ExpectedException` which can also take an expected message.&lt;/p&gt;</comment>
                            <comment id="15947057" author="githubbot" created="Wed, 29 Mar 2017 12:56:34 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595#discussion_r108437565&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595#discussion_r108437565&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/core/memory/ByteArrayInputStreamWithPos.java &amp;#8212;&lt;br/&gt;
    @@ -118,7 +118,8 @@ public int getPosition() &lt;/p&gt;
{
     		return position;
     	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void setPos(int pos) {&lt;br/&gt;
    +	public void setPosition(int pos) {&lt;br/&gt;
    +		Preconditions.checkArgument(pos &amp;lt; count, &quot;Position out of bounds.&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Allow for equality as with `ByteArrayOutputStreamWithPos`? And check for non-negative. Should we create a matching `getEndPosition()` as in `ByteArrayOutputStreamWithPos`?&lt;/p&gt;</comment>
                            <comment id="15947058" author="githubbot" created="Wed, 29 Mar 2017 12:56:34 +0000"  >&lt;p&gt;Github user greghogan commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595#discussion_r108437640&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595#discussion_r108437640&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/core/memory/ByteArrayOutputStreamWithPos.java &amp;#8212;&lt;br/&gt;
    @@ -110,7 +110,7 @@ public int getPosition() {&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	public void setPosition(int position) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Preconditions.checkArgument(position &amp;lt; getEndPosition(), &quot;Position out of bounds.&quot;);&lt;br/&gt;
    +		Preconditions.checkArgument(position &amp;lt;= getEndPosition(), &quot;Position out of bounds.&quot;);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Check for non-negative.&lt;/p&gt;</comment>
                            <comment id="15948441" author="githubbot" created="Thu, 30 Mar 2017 05:24:36 +0000"  >&lt;p&gt;Github user wenlong88 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @greghogan Thanks for the review. I have add non-negative check and update the test with ExpectedException. But I don&apos;t think we need to call toString in the test since we have check the position instead I add a test to verify that toString returns the substring with range(0, position) to meet your concern. One update about setPosition in outputStream, I think it is better to auto extend the buffer when setting a position larger than the buffer size, just like the auto extending in write.&lt;/p&gt;</comment>
                            <comment id="15948835" author="githubbot" created="Thu, 30 Mar 2017 10:51:44 +0000"  >&lt;p&gt;Github user greghogan commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    When expanding with `write` the new capacity (up to `position` of course) is filled with data. Expanding with `setPosition` can leave holes in the data and may mask a bug. Since these classes are undocumented it would be safer to leave this behavior unmodified.&lt;/p&gt;</comment>
                            <comment id="15950223" author="githubbot" created="Fri, 31 Mar 2017 02:40:28 +0000"  >&lt;p&gt;Github user wenlong88 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @greghogan Currently we check the position with the EndPosition which is the size of buffer instead of a max written size , so it is still possible to  leave holes when keeping unmodified. Enabling auto extending can give the user the flexibility to reserved some space for later filling and does not change current functions logics.&lt;/p&gt;</comment>
                            <comment id="15951157" author="githubbot" created="Fri, 31 Mar 2017 15:41:23 +0000"  >&lt;p&gt;Github user greghogan commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @wenlong88 you are right that the position can currently be moved beyond written data. This still feels a bit like feature creep as we&apos;ve added to the PR. Do you need to expand the array is this manner? How did you run across this bug? I&apos;m not disagreeing with the change but would like to be conservative and understand the why.&lt;/p&gt;</comment>
                            <comment id="15951957" author="githubbot" created="Sat, 1 Apr 2017 02:52:33 +0000"  >&lt;p&gt;Github user wenlong88 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @greghogan I come across this bug when we are trying to write some objects to a byte array: at first, I wrote a 0 as initial size and then the serialized object, after that, I seek back to the start position to correct the size and then seek to the end of the written data to continue to write other object. When the array can auto expanding, I can just reserve some hole at first and then seek back and fill the hole.&lt;/p&gt;</comment>
                            <comment id="15960315" author="githubbot" created="Fri, 7 Apr 2017 05:55:15 +0000"  >&lt;p&gt;Github user wenlong88 commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    hi, @greghogan , do you have any new comment about the changes?&lt;/p&gt;</comment>
                            <comment id="15961379" author="githubbot" created="Fri, 7 Apr 2017 20:14:18 +0000"  >&lt;p&gt;Github user greghogan commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @wenlong88 thanks for the contribution (and the ping)! Merging ...&lt;/p&gt;</comment>
                            <comment id="15961580" author="githubbot" created="Sat, 8 Apr 2017 00:12:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3595&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15961585" author="greghogan" created="Sat, 8 Apr 2017 00:20:14 +0000"  >&lt;p&gt;Fixed in af34e5bd0bc8bf93c78b8bf37033ee660e7913be&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 32 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3cmtz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>