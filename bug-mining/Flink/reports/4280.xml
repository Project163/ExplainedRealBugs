<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17182] RemoteInputChannelTest.testConcurrentOnSenderBacklogAndRecycle fail on azure</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17182</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/rmetzger/Flink/_build/results?buildId=7546&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=d2c1c472-9d7b-5913-b8e4-461f3092fb7a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/rmetzger/Flink/_build/results?buildId=7546&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=d2c1c472-9d7b-5913-b8e4-461f3092fb7a&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Tests run: 21, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 3.943 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.runtime.io.network.partition.consumer.RemoteInputChannelTest
[ERROR] testConcurrentOnSenderBacklogAndRecycle(org.apache.flink.runtime.io.network.partition.consumer.RemoteInputChannelTest)  Time elapsed: 0.011 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: There should be 248 buffers available in channel. expected:&amp;lt;248&amp;gt; but was:&amp;lt;238&amp;gt;
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failNotEquals(Assert.java:834)
	at org.junit.Assert.assertEquals(Assert.java:645)
	at org.apache.flink.runtime.io.network.partition.consumer.RemoteInputChannelTest.testConcurrentOnSenderBacklogAndRecycle(RemoteInputChannelTest.java:869)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:365)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeWithRerun(JUnit4Provider.java:273)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:238)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:159)
	at org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)
	at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)
	at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13298724">FLINK-17182</key>
            <summary>RemoteInputChannelTest.testConcurrentOnSenderBacklogAndRecycle fail on azure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gaoyunhaii">Yun Gao</assignee>
                                    <reporter username="dwysakowicz">Dawid Wysakowicz</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Thu, 16 Apr 2020 07:09:12 +0000</created>
                <updated>Fri, 12 Jun 2020 02:59:18 +0000</updated>
                            <resolved>Fri, 12 Jun 2020 02:58:53 +0000</resolved>
                                    <version>1.11.0</version>
                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17084620" author="zjwang" created="Thu, 16 Apr 2020 07:28:51 +0000"  >&lt;p&gt;Thanks for reporting this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;, I have assigned &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&#160;for investigating this issue.&lt;/p&gt;</comment>
                            <comment id="17087003" author="gaoyunhaii" created="Sun, 19 Apr 2020 13:24:13 +0000"  >&lt;p&gt;This should be caused by when the unfulfilled buffer is fulfilled by recycled exclusive buffers, the status of waiting on buffer pool is not cleared, thus it could not reuse buffer returned by itself to buffer pool. A simulated case would be:&lt;/p&gt;

&lt;p&gt;Suppose initially both the input channel and buffer pool have no buffers, which the case in this test. We also temporarily ignore the initial credit, which does not affect the issue.&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;(Thread 1)&#160; inputChannel.onSenderBacklog(2), which makes the input channel start waiting on the buffer pool&lt;/li&gt;
	&lt;li&gt;(Thread 2) one buffer is recycled to the buffer pool and assigned to the input channel.&lt;/li&gt;
	&lt;li&gt;(Thread 2) One buffer is going to be recycled to the buffer pool. The listener is taken, and the thread paused before notifying the buffer to the channel.&lt;/li&gt;
	&lt;li&gt;(Thread 3) one exclusive buffer is recycle and returned to the input channel. With current implementation the input channel will not stop waiting, even if its available buffers are already equal to the required.&lt;/li&gt;
	&lt;li&gt;(Thread 3)&#160; one exclusive buffer is recycled and return to the input channel. input channel will return one buffer to the buffer pool. Since the listener is not in the queue now, the buffer could not be allocated to the channel again.&lt;/li&gt;
	&lt;li&gt;(Thread 1)&#160; inputChannel.onSenderBacklog(4), thus one more buffer is required, however, since the channel is still waiting on the buffer pool, it cannot request the available buffer in the buffer pool. There is also no other chances to assign this buffer to the input channel.&#160;&lt;/li&gt;
	&lt;li&gt;(Thread 2) Wake up again and finish notifying the buffer. However, the available buffer recycled in step 5 could not assigned to the channel again.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thus, one buffer is left in the buffer pool and cannot assign to the input channel.&lt;/p&gt;</comment>
                            <comment id="17089545" author="zjwang" created="Wed, 22 Apr 2020 10:45:52 +0000"  >&lt;p&gt;After confirming with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gaoyunhaii&quot; class=&quot;user-hover&quot; rel=&quot;gaoyunhaii&quot;&gt;gaoyunhaii&lt;/a&gt;&#160;offline, it has no effect for the normal process, because floating/exclusive buffers recycle can not be executed concurrently except the cancel case.&lt;/p&gt;

&lt;p&gt;I think we can adjust this unit test to execute floating/exclusive buffer recycle only in one thread to avoid the unstable issue.&lt;/p&gt;</comment>
                            <comment id="17099875" author="rmetzger" created="Tue, 5 May 2020 13:34:23 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=622&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=4ed44b66-cdd6-5dcf-5f6a-88b07dda665d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=622&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=4ed44b66-cdd6-5dcf-5f6a-88b07dda665d&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17106015" author="yunta" created="Wed, 13 May 2020 06:42:52 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=462&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=4ed44b66-cdd6-5dcf-5f6a-88b07dda665d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=462&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=4ed44b66-cdd6-5dcf-5f6a-88b07dda665d&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17132951" author="rmetzger" created="Thu, 11 Jun 2020 06:30:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=3214&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=4ed44b66-cdd6-5dcf-5f6a-88b07dda665d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=3214&amp;amp;view=logs&amp;amp;j=0da23115-68bb-5dcd-192c-bd4c8adebde1&amp;amp;t=4ed44b66-cdd6-5dcf-5f6a-88b07dda665d&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17132997" author="zjwang" created="Thu, 11 Jun 2020 07:20:04 +0000"  >&lt;p&gt;I think I should review this PR today to save some efforts for testing stability, although this issue is not a blocker for release. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17133857" author="gaoyunhaii" created="Fri, 12 Jun 2020 02:58:28 +0000"  >&lt;p&gt;Fix via:&lt;/p&gt;

&lt;p&gt;   master: f88d98da41957beca84d1807319a5fb004cd02f8&lt;br/&gt;
        1.11: 22098b27c32342f3ef74848a86d4b4d8d3c1dfb8&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0doxs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>