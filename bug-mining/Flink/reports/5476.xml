<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:57:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22863] ArrayIndexOutOfBoundsException may happen when building rescale edges</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22863</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;For EdgeManagerBuildUtil introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21326&quot; title=&quot;Optimize building topology when initializing ExecutionGraph&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21326&quot;&gt;&lt;del&gt;FLINK-21326&lt;/del&gt;&lt;/a&gt;, we find that during the construction of rescale edges, it may throw ArrayIndexOutOfBoundsException like this:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13026328/13026328_image-2021-06-03-15-06-09-301.png&quot; height=&quot;200&quot; width=&quot;938&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;It is mainly caused by the precision of &lt;tt&gt;double&lt;/tt&gt;&#160;in Java.&lt;/p&gt;

&lt;p&gt;In EdgeManagerBuildUtil#connectPointwise, when upstream parallelism &amp;lt; downstream parallelism, we calculate the indices of downstream vertices that connect to each upstream partition like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; start = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) (&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.ceil(partitionNum * factor)); 
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; end = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) (&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.ceil((partitionNum + 1) * factor));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The index range is [&lt;tt&gt;start&lt;/tt&gt;, &lt;tt&gt;end&lt;/tt&gt;).&#160;&lt;/p&gt;

&lt;p&gt;In some cases the value of &lt;tt&gt;end&lt;/tt&gt; may exceed the downstream parallelism and throw the ArrayIndexOutOfBoundsException.&lt;/p&gt;

&lt;p&gt;Let&apos;s take an example. The upstream parallelism is 7. The downstream parallelism is 29. For the last upstream partition (which &lt;tt&gt;partitionNum&lt;/tt&gt; is 6), &lt;tt&gt;(partitionNum + 1) * factor&lt;/tt&gt; is 29.00002, which is slightly larger than 29. This is caused by the precision of &lt;tt&gt;double&lt;/tt&gt;. Then &lt;tt&gt;end&lt;/tt&gt; = &lt;tt&gt;Math.ceil(29.00002)&lt;/tt&gt;, which is 30.&#160;ArrayIndexOutOfBoundsException is thrown here.&lt;/p&gt;

&lt;p&gt;To solve this issue, we need to add an extra check for the boundary condition like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; end = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(targetCount, (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) (&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.ceil((partitionNum + 1) * factor)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This affects release-1.13.0 and release-1.13.1.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13381851">FLINK-22863</key>
            <summary>ArrayIndexOutOfBoundsException may happen when building rescale edges</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Thesharing">Zhilong Hong</assignee>
                                    <reporter username="Thesharing">Zhilong Hong</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 3 Jun 2021 07:29:13 +0000</created>
                <updated>Thu, 23 Sep 2021 17:22:26 +0000</updated>
                            <resolved>Fri, 4 Jun 2021 09:30:19 +0000</resolved>
                                    <version>1.13.0</version>
                    <version>1.13.1</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.2</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17356248" author="thesharing" created="Thu, 3 Jun 2021 07:31:36 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhuzh&quot; class=&quot;user-hover&quot; rel=&quot;zhuzh&quot;&gt;zhuzh&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17356274" author="zhuzh" created="Thu, 3 Jun 2021 08:01:09 +0000"  >&lt;p&gt;Thanks for reporting this issue. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Thesharing&quot; class=&quot;user-hover&quot; rel=&quot;Thesharing&quot;&gt;Thesharing&lt;/a&gt;&lt;br/&gt;
 It is indeed a problem that we should fix ASAP.&lt;br/&gt;
I have assign it to you and let&apos;s have a fix PR for it soon.&lt;/p&gt;</comment>
                            <comment id="17356336" author="till.rohrmann" created="Thu, 3 Jun 2021 10:58:30 +0000"  >&lt;p&gt;Yes, let&apos;s fix it asap. Thanks for reporting it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Thesharing&quot; class=&quot;user-hover&quot; rel=&quot;Thesharing&quot;&gt;Thesharing&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17357212" author="zhuzh" created="Fri, 4 Jun 2021 09:30:19 +0000"  >&lt;p&gt;Fixed via&lt;br/&gt;
master: 739a12add50c90e020e4b9aaafc1cc45465fa937&lt;br/&gt;
release-1.13: 6f774c9db8c33c86ce81cccd68beb7a2e096c177&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13026328" name="image-2021-06-03-15-06-09-301.png" size="221614" author="Thesharing" created="Thu, 3 Jun 2021 07:06:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0rm40:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>