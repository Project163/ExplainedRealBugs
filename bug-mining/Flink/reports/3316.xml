<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:41:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7629] Scala stream aggregations should support nested field expressions</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7629</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In the Scala API, &lt;tt&gt;KeyedStream.maxBy&lt;/tt&gt; and similar methods currently only work with a field name, and not with nested field expressions, such as &quot;fieldA.fieldX&quot;. (Their documentation says this should work.)&lt;/p&gt;

&lt;p&gt;The reason for this is that the string overload of &lt;tt&gt;KeyedStream.aggregate&lt;/tt&gt; uses &lt;tt&gt;fieldNames2Indices&lt;/tt&gt; and then calls the integer overload. Instead, it should create a &lt;tt&gt;SumAggregator&lt;/tt&gt; or &lt;tt&gt;ComparableAggregator&lt;/tt&gt; directly, as the integer overload does (and as the Java API does). The ctors of &lt;tt&gt;SumAggregator&lt;/tt&gt; or &lt;tt&gt;ComparableAggregator&lt;/tt&gt; will call &lt;tt&gt;FieldAccessorFactory.getAccessor&lt;/tt&gt;, which will correctly handle a nested field expression.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13102535">FLINK-7629</key>
            <summary>Scala stream aggregations should support nested field expressions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggevay">G&#225;bor G&#233;vay</assignee>
                                    <reporter username="ggevay">G&#225;bor G&#233;vay</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 15 Sep 2017 11:21:39 +0000</created>
                <updated>Fri, 18 Oct 2019 12:52:50 +0000</updated>
                            <resolved>Fri, 18 Oct 2019 12:52:50 +0000</resolved>
                                                    <fixVersion>1.10.0</fixVersion>
                                    <component>API / Scala</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16169412" author="githubbot" created="Sun, 17 Sep 2017 20:51:25 +0000"  >&lt;p&gt;GitHub user ggevay opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4680&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4680&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7629&quot; title=&quot;Scala stream aggregations should support nested field expressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7629&quot;&gt;&lt;del&gt;FLINK-7629&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;scala&amp;#93;&lt;/span&gt; Fix KeyedStream.aggregate for nested field expressions&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Make `KeyedStream.aggregate` (and `sum`, `maxBy`, etc.) able to handle nested field expressions.&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    The first commit fixes a bug in `RecursiveProductFieldAccessor`: the `fieldType` field should contain the type of the innermost field. I.e., if the field expression is `&quot;field1.field2.field3&quot;`, then it should be the type of `field3`, and not `field1`.&lt;/p&gt;

&lt;p&gt;    The second commit modifies the string overload of `KeyedStream.aggregate` to not use `fieldNames2Indices` to resolve the given field expression, but directly create a `SumAggregator` or `ComparableAggregator`, whose constructors call `FieldAccessorFactory.getAccessor`, which correctly resolves nested field expressions like `&quot;field1.field2.field3&quot;`.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Extended the tests in `FieldAccessorTest` to catch the `fieldType` issue.&lt;/li&gt;
	&lt;li&gt;Added a test which calls `KeyedStream.sum` with a nested field expression.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? yes&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? The feature was already documented in the JavaDocs of the aggregation methods of `KeyedStream`. This PR just brings the functionality up-to-date with the documentation.&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ggevay/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ggevay/flink&lt;/a&gt; agg-scala-&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7629&quot; title=&quot;Scala stream aggregations should support nested field expressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7629&quot;&gt;&lt;del&gt;FLINK-7629&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4680.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4680.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4680&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 56b524140bde7f55f5680be3a1a936a1d710722a&lt;br/&gt;
Author: Gabor Gevay &amp;lt;ggab90@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-17T18:55:13Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7629&quot; title=&quot;Scala stream aggregations should support nested field expressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7629&quot;&gt;&lt;del&gt;FLINK-7629&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;scala&amp;#93;&lt;/span&gt; Fix RecursiveProductFieldAccessor.fieldType&lt;/p&gt;

&lt;p&gt;commit c605e8957de6068de6620108a643e5d8252c9d14&lt;br/&gt;
Author: Gabor Gevay &amp;lt;ggab90@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-09-17T19:03:46Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7629&quot; title=&quot;Scala stream aggregations should support nested field expressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7629&quot;&gt;&lt;del&gt;FLINK-7629&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;scala&amp;#93;&lt;/span&gt; Fix KeyedStream.aggregate for nested field expressions&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16954571" author="aljoscha" created="Fri, 18 Oct 2019 12:52:50 +0000"  >&lt;p&gt;Fixed in 13603a9bad90997e25302a4b47028e9686301d8a&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3k47b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>