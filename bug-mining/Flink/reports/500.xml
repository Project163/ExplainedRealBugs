<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:20:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2447] TypeExtractor returns wrong type info when a Tuple has two fields of the same POJO type</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2447</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Consider the following code:&lt;/p&gt;

&lt;p&gt;DataSet&amp;lt;FooBarPojo&amp;gt; d1 = env.fromElements(new FooBarPojo());&lt;br/&gt;
		DataSet&amp;lt;Tuple2&amp;lt;FooBarPojo, FooBarPojo&amp;gt;&amp;gt; d2 = d1.map(new MapFunction&amp;lt;FooBarPojo, Tuple2&amp;lt;FooBarPojo, FooBarPojo&amp;gt;&amp;gt;() {&lt;br/&gt;
			@Override&lt;br/&gt;
			public Tuple2&amp;lt;FooBarPojo, FooBarPojo&amp;gt; map(FooBarPojo value) throws Exception &lt;/p&gt;
{
				return null;
			}
&lt;p&gt;		});&lt;/p&gt;

&lt;p&gt;where FooBarPojo is the following type:&lt;br/&gt;
public class FooBarPojo {&lt;br/&gt;
	public int foo, bar;&lt;br/&gt;
	public FooBarPojo() {}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;This should print a tuple type with two identical fields:&lt;br/&gt;
Java Tuple2&amp;lt;PojoType&amp;lt;FooBarPojo, fields = &lt;span class=&quot;error&quot;&gt;&amp;#91;bar: Integer, foo: Integer&amp;#93;&lt;/span&gt;&amp;gt;, PojoType&amp;lt;FooBarPojo, fields = &lt;span class=&quot;error&quot;&gt;&amp;#91;bar: Integer, foo: Integer&amp;#93;&lt;/span&gt;&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;But it prints the following instead:&lt;br/&gt;
Java Tuple2&amp;lt;PojoType&amp;lt;FooBarPojo, fields = &lt;span class=&quot;error&quot;&gt;&amp;#91;bar: Integer, foo: Integer&amp;#93;&lt;/span&gt;&amp;gt;, GenericType&amp;lt;FooBarPojo&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;Note, that this problem causes some co-groups in Gelly to crash with &quot;org.apache.flink.api.common.InvalidProgramException: The pair of co-group keys are not compatible with each other&quot; when the vertex ID type is a POJO, because the second field of the Edge type gets to be a generic type, but the POJO gets recognized in the Vertex type, and getNumberOfKeyFields returns different numbers for the POJO and the generic type.&lt;/p&gt;

&lt;p&gt;The source of the problem is the mechanism in TypeExtractor that would detect recursive types (see the &quot;alreadySeen&quot; field in TypeExtractor), as it mistakes the second appearance of FooBarPojo with a recursive field.&lt;/p&gt;

&lt;p&gt;Specifically the following happens: createTypeInfoWithTypeHierarchy starts to process the Tuple2&amp;lt;FooBarPojo, FooBarPojo&amp;gt; type, and in line 434 it calls itself for the first field, which proceeds into the privateGetForClass case which correctly detects that it is a POJO, and correctly returns a PojoTypeInfo; but in the meantime in line 1191, privateGetForClass adds PojoTypeInfo to &quot;alreadySeen&quot;. Then the outer createTypeInfoWithTypeHierarchy approaches the second field, goes into privateGetForClass, which mistakenly returns a GenericTypeInfo, as it thinks in line 1187, that a recursive type is being processed.&lt;/p&gt;

&lt;p&gt;(Note, that if we comment out the recursive type detection (the lines that do their thing with the alreadySeen field), then the output is correct.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12850536">FLINK-2447</key>
            <summary>TypeExtractor returns wrong type info when a Tuple has two fields of the same POJO type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="twalthr">Timo Walther</assignee>
                                    <reporter username="ggevay">G&#225;bor G&#233;vay</reporter>
                        <labels>
                    </labels>
                <created>Fri, 31 Jul 2015 07:58:36 +0000</created>
                <updated>Thu, 28 Feb 2019 14:29:15 +0000</updated>
                            <resolved>Wed, 5 Aug 2015 14:48:46 +0000</resolved>
                                                    <fixVersion>0.9.1</fixVersion>
                    <fixVersion>0.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14648906" author="fhueske" created="Fri, 31 Jul 2015 08:13:19 +0000"  >&lt;p&gt;Thanks for the detailed report!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;, has done a lot in the TypeExtractor. Maybe he can comment on this problem.&lt;/p&gt;</comment>
                            <comment id="14653324" author="twalthr" created="Tue, 4 Aug 2015 09:09:18 +0000"  >&lt;p&gt;Yes, I will look into it.&lt;/p&gt;</comment>
                            <comment id="14653414" author="fhueske" created="Tue, 4 Aug 2015 10:20:59 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;!&lt;br/&gt;
Do you think we can get a fix in for 0.9.1? Seems to be a serious bug.&lt;/p&gt;</comment>
                            <comment id="14653466" author="twalthr" created="Tue, 4 Aug 2015 11:20:42 +0000"  >&lt;p&gt;I&apos;m working on it.&lt;/p&gt;</comment>
                            <comment id="14653649" author="githubbot" created="Tue, 4 Aug 2015 13:39:53 +0000"  >&lt;p&gt;GitHub user twalthr opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/986&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2447&quot; title=&quot;TypeExtractor returns wrong type info when a Tuple has two fields of the same POJO type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2447&quot;&gt;&lt;del&gt;FLINK-2447&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;java api&amp;#93;&lt;/span&gt; TypeExtractor returns wrong type info when a Tuple has two fields of the same POJO type&lt;/p&gt;

&lt;p&gt;    This fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2447&quot; title=&quot;TypeExtractor returns wrong type info when a Tuple has two fields of the same POJO type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2447&quot;&gt;&lt;del&gt;FLINK-2447&lt;/del&gt;&lt;/a&gt; and simplifies the TypeExtractor a little bit.&lt;/p&gt;

&lt;p&gt;    Actually, the `alreadySeen` variable was unneccessary. The `typeHierarchy` can be easily used for that. I think the problem was that the POJO-feature developers didn&apos;t know the concept behind the `typeHierarchy` parameter. I added a notice so that those bugs (hopefully) don&apos;t happen again.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/twalthr/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/twalthr/flink&lt;/a&gt; PojoTypeExtrBug&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/986.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/986.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #986&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e05081dc4c445cc13fbe1addaf433cd354a50dc9&lt;br/&gt;
Author: twalthr &amp;lt;twalthr@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-08-04T13:30:28Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2447&quot; title=&quot;TypeExtractor returns wrong type info when a Tuple has two fields of the same POJO type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2447&quot;&gt;&lt;del&gt;FLINK-2447&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;java api&amp;#93;&lt;/span&gt; TypeExtractor returns wrong type info when a Tuple has two fields of the same POJO type&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14654029" author="githubbot" created="Tue, 4 Aug 2015 17:44:37 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/986#issuecomment-127689216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/986#issuecomment-127689216&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m not a type extractor expert but since its fixing a bug and it has tests: +1&lt;/p&gt;</comment>
                            <comment id="14655075" author="githubbot" created="Wed, 5 Aug 2015 09:36:22 +0000"  >&lt;p&gt;Github user fhueske commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/986#issuecomment-127935086&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/986#issuecomment-127935086&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good to me, will merge this&lt;/p&gt;</comment>
                            <comment id="14658280" author="githubbot" created="Wed, 5 Aug 2015 14:24:59 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/986&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/986&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14658314" author="fhueske" created="Wed, 5 Aug 2015 14:48:46 +0000"  >&lt;p&gt;Fixed in 0.10 with 5546a1efabcc9c5f500abdb4e38a5cc05d35980a&lt;br/&gt;
Fixed in 0.9.1 with ec3b983276e85e0baed98ffa8acf6709f20032de&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i65r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>