<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4154] Correction of murmur hash breaks backwards compatibility</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4154</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The correction of Flink&apos;s murmur hash with commit &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, breaks Flink&apos;s backwards compatibility with respect to savepoints. The reason is that the changed murmur hash which is used to partition elements in a &lt;tt&gt;KeyedStream&lt;/tt&gt; changes the mapping from keys to sub tasks. This changes the assigned key spaces for a sub task. Consequently, an old savepoint (version 1.0) assigns states with a different key space to the sub tasks.&lt;/p&gt;

&lt;p&gt;I think that this must be fixed for the upcoming 1.1 release. I see two options to solve the problem:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;revert the changes, but then we don&apos;t know how the flawed murmur hash performs&lt;/li&gt;
	&lt;li&gt;develop tooling to repartition state of old savepoints. This is probably not trivial since a keyed stream can also contain non-partitioned state which is not partitionable in all cases. And even if only partitioned state is used, we would need some kind of special operator which can repartition the state wrt the key.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think that the latter option requires some more thoughts and is thus unlikely to be done before the release 1.1. Therefore, as a workaround, I think that we should revert the murmur hash changes.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/flink/commit/641a0d436c9b7a34ff33ceb370cf29962cac4dee&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/641a0d436c9b7a34ff33ceb370cf29962cac4dee&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12986842">FLINK-4154</key>
            <summary>Correction of murmur hash breaks backwards compatibility</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="greghogan">Greg Hogan</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jul 2016 15:05:23 +0000</created>
                <updated>Mon, 1 Aug 2016 16:03:22 +0000</updated>
                            <resolved>Mon, 11 Jul 2016 15:22:07 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15362653" author="aljoscha" created="Tue, 5 Jul 2016 15:39:43 +0000"  >&lt;p&gt;I&apos;d vote for 1) i.e. revert the change to murmur hash.&lt;/p&gt;</comment>
                            <comment id="15362673" author="greghogan" created="Tue, 5 Jul 2016 15:56:02 +0000"  >&lt;p&gt;This is a keen observation. Considering the usage and looking at the algorithm the right shifts will pull entropy into the lower bits before we take the modulus for the channel number. This might be something we note in the code and keep forever unless we have other breaking changes in saved state for 2.0.&lt;/p&gt;</comment>
                            <comment id="15367950" author="greghogan" created="Fri, 8 Jul 2016 16:41:38 +0000"  >&lt;p&gt;I wanted to see how much skew this causes in case we should consider fixing the algorithm for 2.0. With the proper MurmurHash I see no skew. In the Flink version the skew is typically much less than 1% when parallelism is small.&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; channels &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; min count &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; max count &lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; relative skew &lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 16 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 268391180 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 268480808 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3.3394540014317905E-4 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 37 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 116042832 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 116126424 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 7.20354704890346E-4 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 64 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 67091700 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 67129376 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 5.615597756503413E-4 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 117 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 36686636 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 36742216 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.0015149930890365636 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 256 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 16767212 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 16786620 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.0011574971438304711 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 731 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 5857272 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 5890152 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.005613534764989572 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1024 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 4186452 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 4202972 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.003946062202552424 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1497 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2860692 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2878580 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.006253032483049556 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2048 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2090320 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 2103128 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.00612729151517471 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 4096 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1043084 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1053744 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.0102196946746379 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 5555 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 768004 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 778560 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.013744720079582919 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 7143 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 596812 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 606124 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.015602903426874795 &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 16384 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 259052 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 265432 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 0.02462825996325062 &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; channels : &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[]{16, 37, 64, 117, 256, 731, 1024}) {
	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] counts = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[channels];

	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MIN_VALUE;
	&lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; {
		counts[murmurHash(i) % channels]++;
	} &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (i++ &amp;lt; &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE);

	Arrays.sort(counts);
	&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(channels + &lt;span class=&quot;code-quote&quot;&gt;&quot;: &quot;&lt;/span&gt; + counts[0] + &lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt; + counts[channels - 1] + &lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt; + ((1.0 * counts[channels - 1] - counts[0]) / counts[0]));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15368130" author="githubbot" created="Fri, 8 Jul 2016 18:25:54 +0000"  >&lt;p&gt;GitHub user greghogan opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2223&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4154&quot; title=&quot;Correction of murmur hash breaks backwards compatibility&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4154&quot;&gt;&lt;del&gt;FLINK-4154&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;core&amp;#93;&lt;/span&gt; Correction of murmur hash breaks backwards compatibility&lt;/p&gt;

&lt;p&gt;    Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3623&quot; title=&quot;Adjust MurmurHash algorithm&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3623&quot;&gt;&lt;del&gt;FLINK-3623&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Adjust MurmurHash Algorithm&quot;&lt;/p&gt;

&lt;p&gt;    This reverts commit 641a0d436c9b7a34ff33ceb370cf29962cac4dee.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/greghogan/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/greghogan/flink&lt;/a&gt; 4154_correction_of_murmurhash_breaks_backwards_compatibility&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2223.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2223.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2223&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 99696c2fc40db7b5767c9c1b20bcc1fa5edfc890&lt;br/&gt;
Author: Greg Hogan &amp;lt;code@greghogan.com&amp;gt;&lt;br/&gt;
Date:   2016-07-08T14:57:42Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4154&quot; title=&quot;Correction of murmur hash breaks backwards compatibility&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4154&quot;&gt;&lt;del&gt;FLINK-4154&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;core&amp;#93;&lt;/span&gt; Correction of murmur hash breaks backwards compatibility&lt;/p&gt;

&lt;p&gt;    Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3623&quot; title=&quot;Adjust MurmurHash algorithm&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3623&quot;&gt;&lt;del&gt;FLINK-3623&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Adjust MurmurHash Algorithm&quot;&lt;/p&gt;

&lt;p&gt;    This reverts commit 641a0d436c9b7a34ff33ceb370cf29962cac4dee.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15370346" author="githubbot" created="Mon, 11 Jul 2016 08:01:17 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2223&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for investigating this. +1, go ahead and merge.&lt;/p&gt;</comment>
                            <comment id="15370961" author="githubbot" created="Mon, 11 Jul 2016 15:20:44 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2223&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2223&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15370964" author="greghogan" created="Mon, 11 Jul 2016 15:22:08 +0000"  >&lt;p&gt;Fixed in 81cf2296683a473db4061dd3bed0aeb249e05058&lt;/p&gt;</comment>
                            <comment id="15401665" author="uce" created="Mon, 1 Aug 2016 07:46:43 +0000"  >&lt;p&gt;Backwards-compatability with 1.0 savepoints did not work out after all. If there is a RC2 for 1.1 we could revert this again and use the correct Murmur hash. Sorry for all the confusion. &lt;/p&gt;</comment>
                            <comment id="15401989" author="till.rohrmann" created="Mon, 1 Aug 2016 12:55:18 +0000"  >&lt;p&gt;+1 for introducing the correct murmur hash function.&lt;/p&gt;</comment>
                            <comment id="15402300" author="uce" created="Mon, 1 Aug 2016 16:03:22 +0000"  >&lt;p&gt;Reverted in 0274f9c (release-1.1) and 0f92a6b (master).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 16 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30jjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>