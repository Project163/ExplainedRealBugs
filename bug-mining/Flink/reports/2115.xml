<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8186] AvroInputFormat regression: fails to deserialize GenericRecords on standalone cluster with hadoop27 compat</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8186</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The following job runs fine on a Flink 1.3.2 cluster, but fails on a Flink 1.4.0 RC2 standalone cluster, &quot;hadoop27&quot; flavour:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;GenericRecordCount {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; input = ParameterTool.fromArgs(args).getRequired(&lt;span class=&quot;code-quote&quot;&gt;&quot;input&quot;&lt;/span&gt;);

        ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();

        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; count = env.readFile(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AvroInputFormat&amp;lt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(input), GenericRecord.class), input)
                .count();

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;Counted %d records\n&quot;&lt;/span&gt;, count);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Runs fine in LocalExecutionEnvironment and also on no-hadoop flavour standalone cluster, though. Exception thrown in Flink 1.4.0 hadoop27:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
12/01/2017 13:22:09     DataSource (at readFile(ExecutionEnvironment.java:514) (org.apache.flink.formats.avro.AvroInputFormat))(4/4) switched to FAILED
java.lang.RuntimeException: java.lang.NoSuchMethodException: org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericRecord.&amp;lt;init&amp;gt;()
        at org.apache.avro.specific.SpecificData.newInstance(SpecificData.java:353)
        at org.apache.avro.specific.SpecificData.newRecord(SpecificData.java:369)
        at org.apache.avro.reflect.ReflectData.newRecord(ReflectData.java:901)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.readRecord(GenericDatumReader.java:212)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.readWithoutConversion(GenericDatumReader.java:175)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.read(GenericDatumReader.java:153)
        at org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericDatumReader.read(GenericDatumReader.java:145)
        at org.apache.avro.file.DataFileStream.next(DataFileStream.java:233)
        at org.apache.flink.formats.avro.AvroInputFormat.nextRecord(AvroInputFormat.java:165)
        at org.apache.flink.runtime.operators.DataSourceTask.invoke(DataSourceTask.java:167)
        at org.apache.flink.runtime.taskmanager.Task.run(Task.java:718)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: java.lang.NoSuchMethodException: org.apache.avro.&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;.GenericRecord.&amp;lt;init&amp;gt;()
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:3082)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredConstructor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2178)
        at org.apache.avro.specific.SpecificData.newInstance(SpecificData.java:347)
        ... 11 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13122170">FLINK-8186</key>
            <summary>AvroInputFormat regression: fails to deserialize GenericRecords on standalone cluster with hadoop27 compat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="packet">Sebastian Klemke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Dec 2017 13:20:47 +0000</created>
                <updated>Wed, 6 Dec 2017 11:01:38 +0000</updated>
                            <resolved>Tue, 5 Dec 2017 15:53:57 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16274435" author="packet" created="Fri, 1 Dec 2017 14:04:15 +0000"  >&lt;p&gt;Test program runs with Flink 1.4 hadoop27 on YARN. Is no-hadoop flavour recommended for standalone?&lt;/p&gt;</comment>
                            <comment id="16274452" author="twalthr" created="Fri, 1 Dec 2017 14:18:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=packet&quot; class=&quot;user-hover&quot; rel=&quot;packet&quot;&gt;packet&lt;/a&gt; we moved Avro out of the Flink core into a dedicated &lt;tt&gt;flink-avro&lt;/tt&gt; module in order to reduce our default dependencies. Did you add &lt;tt&gt;flink-avro&lt;/tt&gt; to your dependencies? I just checked that &lt;tt&gt;org.apache.avro.generic.GenericRecord&lt;/tt&gt; is included in the &lt;tt&gt;flink-dist&lt;/tt&gt; jar that is placed in the &lt;tt&gt;/lib&lt;/tt&gt; folder. I will try to reproduce your issue.&lt;/p&gt;</comment>
                            <comment id="16274497" author="packet" created="Fri, 1 Dec 2017 15:10:47 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;, I used the flink-quickstart-java and added flink-clients_2.11 and flink-avro as dependencies. It runs on YARN, though. So maybe it&apos;s a documentation issue? Does it make sense to use hadoop27 flavour for a standalone cluster? I&apos;ll attach pom.xml + java source.&lt;/p&gt;</comment>
                            <comment id="16274503" author="packet" created="Fri, 1 Dec 2017 15:18:09 +0000"  >&lt;p&gt;Invocation:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
flink-1.4.0/bin/jobmanager.sh start cluster
flink-1.4.0/bin/taskmanager.sh start
flink-1.4.0/bin/taskmanager.sh start
flink-1.4.0/bin/taskmanager.sh start
flink-1.4.0/bin/taskmanager.sh start
flink-1.4.0/bin/flink run -p 4 -c de.nerdheim.flink.GenericRecordCount target/&lt;span class=&quot;code-keyword&quot;&gt;generic&lt;/span&gt;-record-count-1.0-SNAPSHOT.jar --input &amp;lt;non-empty-avro-dataset&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16274561" author="twalthr" created="Fri, 1 Dec 2017 16:05:47 +0000"  >&lt;p&gt;I&apos;m sorry but I cannot reproduce your error. Are you using these binaries? &lt;a href=&quot;http://people.apache.org/~aljoscha/flink-1.4.0-rc2/flink-1.4.0-bin-hadoop27-scala_2.11.tgz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~aljoscha/flink-1.4.0-rc2/flink-1.4.0-bin-hadoop27-scala_2.11.tgz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16274565" author="twalthr" created="Fri, 1 Dec 2017 16:08:17 +0000"  >&lt;p&gt;Actually, the error is also very weird because &lt;tt&gt;GenericRecord&lt;/tt&gt; is an interface with no constructor and actually this record is therefore serialized with Kryo.&lt;/p&gt;</comment>
                            <comment id="16274567" author="twalthr" created="Fri, 1 Dec 2017 16:10:42 +0000"  >&lt;p&gt;Is it possible that the error is only reproducible with your Avro files?&lt;/p&gt;</comment>
                            <comment id="16274601" author="packet" created="Fri, 1 Dec 2017 16:39:25 +0000"  >&lt;p&gt;What puzzles me is org.apache.avro.reflect.ReflectData.newRecord(ReflectData.java:901) in the stack trace. It should be GenericData.newRecord().&lt;/p&gt;</comment>
                            <comment id="16274609" author="packet" created="Fri, 1 Dec 2017 16:43:52 +0000"  >&lt;p&gt;Regarding binaries: Yes, this is the runtime I&apos;m using. I&apos;m compiling against 1.4 snapshot via maven. And for the avro files: I&apos;ll test with &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-formats/flink-avro/src/test/resources/testdata.avro&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-formats/flink-avro/src/test/resources/testdata.avro&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16274628" author="packet" created="Fri, 1 Dec 2017 17:00:45 +0000"  >&lt;p&gt;The error only occurs if job jar was built with -Pbuild-jar. It also occurs on testdata.avro from Flink repo.&lt;/p&gt;</comment>
                            <comment id="16274641" author="twalthr" created="Fri, 1 Dec 2017 17:06:40 +0000"  >&lt;p&gt;Thanks, I will look into it again on Monday.&lt;/p&gt;</comment>
                            <comment id="16274656" author="packet" created="Fri, 1 Dec 2017 17:17:54 +0000"  >&lt;p&gt;With -Pbuild-jar, the job fat-jar includes avro, without it doesn&apos;t. I added org.apache.flink:flink-avro:${flink.version} to &quot;provided&quot; dependency list: Now it works in standalone cluster and the jar only contains GenericRecordCount class. Have to re-test on YARN and LocalExecutionEnvironment.&lt;/p&gt;</comment>
                            <comment id="16274913" author="packet" created="Fri, 1 Dec 2017 20:20:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; Thanks for looking into it. To summarize: Provided test program and pom fail with above mentioned exception if all of the following conditions are true:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;test program is built using &quot;build-jar&quot; profile&lt;/li&gt;
	&lt;li&gt;Flink 1.4.0 RC2 hadoop27 runtime is used&lt;/li&gt;
	&lt;li&gt;standalone cluster&lt;/li&gt;
	&lt;li&gt;input dataset is non-empty&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In this case, rhs of &lt;a href=&quot;https://github.com/apache/flink/blob/release-1.4/flink-formats/flink-avro/src/main/java/org/apache/flink/formats/avro/AvroInputFormat.java#L119&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/release-1.4/flink-formats/flink-avro/src/main/java/org/apache/flink/formats/avro/AvroInputFormat.java#L119&lt;/a&gt; is loaded by org.apache.flink.runtime.execution.librarycache.FlinkUserCodeClassLoaders$ChildFirstClassLoader, comparison fails and else branch is evaluated, leading to ReflectDatumReader being used instead of GenericDatumReader.&lt;/p&gt;</comment>
                            <comment id="16276027" author="stephanewen" created="Sun, 3 Dec 2017 18:48:00 +0000"  >&lt;p&gt;Hotfix: You should be able to make it work by setting &lt;tt&gt;classloader.resolve-order: parent-first&lt;/tt&gt; in the &lt;tt&gt;flink-conf.yaml&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The problem seems to be caused by the inverted classloading in Flink 1.4. Inverted classloading means that user code may load a different copy of its dependencies, compared to those in the classpath, and helps circumvent many dependency conflicts, as well as other issues like class cast conflicts in Avro&apos;s schema and data caching.&lt;/p&gt;

&lt;p&gt;Apparently, for some reason, the &lt;tt&gt;AvroInputFormat&lt;/tt&gt; (or at least its Avro dependency) gets loaded from the parent (classpath, i.e., from Avro in &lt;tt&gt;flink-dist&lt;/tt&gt; or in the Hadoop jars) and the user-supplied parameters get properly loaded from the user-code jar. Hence the clash that &lt;tt&gt;GenericRecord != GenericRecord&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;One fix would be to remove the &lt;tt&gt;flink-avro&lt;/tt&gt; dependency from &lt;tt&gt;flink-dist&lt;/tt&gt; (and removing the exclusion in the quickstarts), meaning that it always has to go through the user code classloader - no dependency duplication.&lt;/p&gt;

&lt;p&gt;But I think we should better understand why this happens in the first place. The &lt;tt&gt;AvroInputFormat&lt;/tt&gt; and the Avro classes it references should also come from the user code jar, and we should know why it does not come from there in this scenario.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; - because this looks like a classloading issue, what is your take?&lt;/p&gt;</comment>
                            <comment id="16276432" author="twalthr" created="Mon, 4 Dec 2017 08:14:27 +0000"  >&lt;p&gt;I think we should rework the dependencies of our quickstarts. What is in the jars seems pretty random to me.&lt;/p&gt;

&lt;p&gt;Without -Pbuild-jar:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO] Excluding org.apache.flink:flink-java:jar:1.4-SNAPSHOT from the shaded jar.
[INFO] Excluding org.apache.flink:flink-core:jar:1.4-SNAPSHOT from the shaded jar.
[INFO] Excluding org.apache.flink:flink-annotations:jar:1.4-SNAPSHOT from the shaded jar.
[INFO] Excluding org.apache.flink:flink-metrics-core:jar:1.4-SNAPSHOT from the shaded jar.
[INFO] Excluding com.esotericsoftware.kryo:kryo:jar:2.24.0 from the shaded jar.
[INFO] Excluding com.esotericsoftware.minlog:minlog:jar:1.2 from the shaded jar.
[INFO] Excluding org.objenesis:objenesis:jar:2.1 from the shaded jar.
[INFO] Excluding commons-collections:commons-collections:jar:3.2.2 from the shaded jar.
[INFO] Excluding org.apache.commons:commons-compress:jar:1.4.1 from the shaded jar.
[INFO] Excluding org.xerial.snappy:snappy-java:jar:1.1.1.3 from the shaded jar.
[INFO] Including org.apache.flink:flink-shaded-asm:jar:5.0.4-2.0 in the shaded jar.
[INFO] Excluding org.apache.commons:commons-lang3:jar:3.3.2 from the shaded jar.
[INFO] Including org.apache.commons:commons-math3:jar:3.5 in the shaded jar.
[INFO] Excluding org.slf4j:slf4j-api:jar:1.7.7 from the shaded jar.
[INFO] Including com.google.code.findbugs:jsr305:jar:1.3.9 in the shaded jar.
[INFO] Including org.apache.flink:force-shading:jar:1.4-SNAPSHOT in the shaded jar.
[INFO] Excluding org.apache.flink:flink-clients_2.11:jar:1.4-SNAPSHOT from the shaded jar.
[INFO] Excluding org.apache.flink:flink-runtime_2.11:jar:1.4-SNAPSHOT from the shaded jar.
[INFO] Including org.apache.flink:flink-queryable-state-client-java_2.11:jar:1.4-SNAPSHOT in the shaded jar.
[INFO] Including org.apache.flink:flink-hadoop-fs:jar:1.4-SNAPSHOT in the shaded jar.
[INFO] Excluding commons-io:commons-io:jar:2.4 from the shaded jar.
[INFO] Including org.apache.flink:flink-shaded-netty:jar:4.0.27.Final-2.0 in the shaded jar.
[INFO] Including org.apache.flink:flink-shaded-guava:jar:18.0-2.0 in the shaded jar.
[INFO] Excluding org.apache.flink:flink-shaded-jackson:jar:2.7.9-2.0 from the shaded jar.
[INFO] Including org.javassist:javassist:jar:3.18.2-GA in the shaded jar.
[INFO] Excluding org.scala-lang:scala-library:jar:2.11.11 from the shaded jar.
[INFO] Excluding com.typesafe.akka:akka-actor_2.11:jar:2.4.20 from the shaded jar.
[INFO] Excluding com.typesafe:config:jar:1.3.0 from the shaded jar.
[INFO] Including org.scala-lang.modules:scala-java8-compat_2.11:jar:0.7.0 in the shaded jar.
[INFO] Including com.typesafe.akka:akka-stream_2.11:jar:2.4.20 in the shaded jar.
[INFO] Including org.reactivestreams:reactive-streams:jar:1.0.0 in the shaded jar.
[INFO] Including com.typesafe:ssl-config-core_2.11:jar:0.2.1 in the shaded jar.
[INFO] Including org.scala-lang.modules:scala-parser-combinators_2.11:jar:1.0.4 in the shaded jar.
[INFO] Including com.typesafe.akka:akka-protobuf_2.11:jar:2.4.20 in the shaded jar.
[INFO] Excluding com.typesafe.akka:akka-slf4j_2.11:jar:2.4.20 from the shaded jar.
[INFO] Including org.clapper:grizzled-slf4j_2.11:jar:1.0.2 in the shaded jar.
[INFO] Excluding com.github.scopt:scopt_2.11:jar:3.5.0 from the shaded jar.
[INFO] Excluding com.twitter:chill_2.11:jar:0.7.4 from the shaded jar.
[INFO] Excluding com.twitter:chill-java:jar:0.7.4 from the shaded jar.
[INFO] Excluding org.apache.flink:flink-optimizer_2.11:jar:1.4-SNAPSHOT from the shaded jar.
[INFO] Excluding commons-cli:commons-cli:jar:1.3.1 from the shaded jar.
[INFO] Excluding org.apache.flink:flink-avro:jar:1.4-SNAPSHOT from the shaded jar.
[INFO] Excluding org.apache.avro:avro:jar:1.8.2 from the shaded jar.
[INFO] Excluding org.codehaus.jackson:jackson-core-asl:jar:1.9.13 from the shaded jar.
[INFO] Excluding org.codehaus.jackson:jackson-mapper-asl:jar:1.9.13 from the shaded jar.
[INFO] Excluding com.thoughtworks.paranamer:paranamer:jar:2.7 from the shaded jar.
[INFO] Excluding org.tukaani:xz:jar:1.5 from the shaded jar.
[INFO] Excluding org.slf4j:slf4j-log4j12:jar:1.7.7 from the shaded jar.
[INFO] Excluding log4j:log4j:jar:1.2.17 from the shaded jar.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With -Pbuild-jar:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO] Including org.apache.commons:commons-compress:jar:1.4.1 in the shaded jar.
[INFO] Including org.xerial.snappy:snappy-java:jar:1.1.1.3 in the shaded jar.
[INFO] Including org.slf4j:slf4j-api:jar:1.7.7 in the shaded jar.
[INFO] Including com.google.code.findbugs:jsr305:jar:1.3.9 in the shaded jar.
[INFO] Including org.apache.flink:force-shading:jar:1.4-SNAPSHOT in the shaded jar.
[INFO] Including org.apache.flink:flink-avro:jar:1.4-SNAPSHOT in the shaded jar.
[INFO] Including org.apache.avro:avro:jar:1.8.2 in the shaded jar.
[INFO] Including org.codehaus.jackson:jackson-core-asl:jar:1.9.13 in the shaded jar.
[INFO] Including org.codehaus.jackson:jackson-mapper-asl:jar:1.9.13 in the shaded jar.
[INFO] Including com.thoughtworks.paranamer:paranamer:jar:2.7 in the shaded jar.
[INFO] Including org.tukaani:xz:jar:1.5 in the shaded jar.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16276676" author="zentol" created="Mon, 4 Dec 2017 12:03:11 +0000"  >&lt;p&gt;I will take a look at the quickstart poms.&lt;/p&gt;</comment>
                            <comment id="16276685" author="aljoscha" created="Mon, 4 Dec 2017 12:11:08 +0000"  >&lt;p&gt;Just a quick update, I&apos;m looking into this.&lt;/p&gt;

&lt;p&gt;Setting the classloader to &quot;parent-first&quot; does solve the problem, as expected.&lt;/p&gt;</comment>
                            <comment id="16276842" author="packet" created="Mon, 4 Dec 2017 14:28:40 +0000"  >&lt;p&gt;Thanks to all of you for looking into this. Does it make sense to site-wide set &quot;parent-first&quot; for transition purposes? In our case, that will usually mean avro 1.7.x in classpath, so I guess we&apos;d have a hard migration anyway.&lt;/p&gt;</comment>
                            <comment id="16276924" author="aljoscha" created="Mon, 4 Dec 2017 15:17:13 +0000"  >&lt;p&gt;I have a fix for this, PR coming up in a minute.&lt;/p&gt;</comment>
                            <comment id="16276928" author="githubbot" created="Mon, 4 Dec 2017 15:18:19 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8186&quot; title=&quot;AvroInputFormat regression: fails to deserialize GenericRecords on standalone cluster with hadoop27 compat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8186&quot;&gt;&lt;del&gt;FLINK-8186&lt;/del&gt;&lt;/a&gt; Exclude flink-avro from flink-dist; fix AvroUtils loading&lt;/p&gt;

&lt;p&gt;    Before, AvroUtils were loaded when the class was loaded which didn&apos;t&lt;br/&gt;
    take into account the user-code ClassLoader. Now, we try loading avro&lt;br/&gt;
    utils with the Thread context ClassLoader.&lt;/p&gt;

&lt;p&gt;    R: @StephanEwen &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; jira-8186-fix-avro-loading&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5120.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5120.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5120&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f4fcd3882e1cda108404325ada685abd38cf210d&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-12-04T15:14:56Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8186&quot; title=&quot;AvroInputFormat regression: fails to deserialize GenericRecords on standalone cluster with hadoop27 compat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8186&quot;&gt;&lt;del&gt;FLINK-8186&lt;/del&gt;&lt;/a&gt; Exclude flink-avro from flink-dist; fix AvroUtils loading&lt;/p&gt;

&lt;p&gt;    Before, AvroUtils were loaded when the class was loaded which didn&apos;t&lt;br/&gt;
    take into account the user-code ClassLoader. Now, we try loading avro&lt;br/&gt;
    utils with the Thread context ClassLoader.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16276932" author="githubbot" created="Mon, 4 Dec 2017 15:23:21 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    is the exclusion from flink-dist still necessary?&lt;/p&gt;</comment>
                            <comment id="16276952" author="githubbot" created="Mon, 4 Dec 2017 15:34:34 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good to me. This is actually two fixes in one:&lt;/p&gt;

&lt;p&gt;      1. Avro should not be in `flink-dist`, because starting with `org.apache.flink`, it would always be loaded &lt;b&gt;&quot;parent first&quot;&lt;/b&gt;. That causes problems because Avro classes exist multiple times, both in the parent and in the child classloader, failing equality and &apos;instanceof&apos; comparisons.&lt;/p&gt;

&lt;p&gt;      2. The Avro Utils were never using any code in the user code jar, only code in the classpath.&lt;/p&gt;

&lt;p&gt;    This is good for now, but it shows that the reveres classloading has some subtle implication as soon as flink dependencies occur both in the user code jar and in `/lib`. &lt;/p&gt;</comment>
                            <comment id="16276992" author="githubbot" created="Mon, 4 Dec 2017 16:05:45 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol I think so, yes. First, I only excluded, which led me to discover the problem with `AvroUtils` and them not using the right classloader to dynamically load the them.&lt;/p&gt;</comment>
                            <comment id="16278766" author="aljoscha" created="Tue, 5 Dec 2017 15:53:57 +0000"  >&lt;p&gt;Fixed on release-1.4 in&lt;br/&gt;
612f07bbd2dc9aa1abf01ebf817c8341c1ad7a10&lt;/p&gt;

&lt;p&gt;Fixed on master in &lt;br/&gt;
f6e24ab60c3d434186d9cd9906c6562433617ff7&lt;/p&gt;</comment>
                            <comment id="16279963" author="githubbot" created="Wed, 6 Dec 2017 10:14:14 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @aljoscha Did you forget to close this PR?&lt;/p&gt;</comment>
                            <comment id="16280022" author="githubbot" created="Wed, 6 Dec 2017 11:01:38 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    thanks for reminding me! closing...&lt;/p&gt;</comment>
                            <comment id="16280023" author="githubbot" created="Wed, 6 Dec 2017 11:01:38 +0000"  >&lt;p&gt;Github user aljoscha closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5120&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12900234" name="GenericRecordCount.java" size="717" author="packet" created="Fri, 1 Dec 2017 15:11:28 +0000"/>
                            <attachment id="12900235" name="pom.xml" size="19320" author="packet" created="Fri, 1 Dec 2017 15:11:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 49 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nfiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>