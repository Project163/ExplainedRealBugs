<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:33:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9174] The type of state created in ProccessWindowFunction.proccess() is inconsistency</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9174</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The type of state created from windowState and globalState in &lt;tt&gt;ProcessWindowFunction.process()&lt;/tt&gt; is inconsistency. For detail,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
context.windowState().getListState(); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type is HeapListState or RocksDBListState
&lt;/span&gt;context.globalState().getListState(); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; type is UserFacingListState&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This cause the problem in the following code,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Iterable&amp;lt;T&amp;gt; iterableState = listState.get();
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (terableState.iterator().hasNext()) {
   &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (T value : iterableState) {
     value.setRetracting(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
     collector.collect(value);
   }
   state.clear();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If the &lt;tt&gt;listState&lt;/tt&gt; is created from &lt;tt&gt;context.globalState()&lt;/tt&gt; is fine, but when it created from &lt;tt&gt;context.windowState()&lt;/tt&gt; this will cause NPE. I met this in 1.3.2 but I found it also affect 1.5.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13152470">FLINK-9174</key>
            <summary>The type of state created in ProccessWindowFunction.proccess() is inconsistency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sihuazhou">Sihua Zhou</assignee>
                                    <reporter username="sihuazhou">Sihua Zhou</reporter>
                        <labels>
                    </labels>
                <created>Sat, 14 Apr 2018 10:19:38 +0000</created>
                <updated>Thu, 17 May 2018 13:23:41 +0000</updated>
                            <resolved>Wed, 16 May 2018 12:53:03 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16438306" author="githubbot" created="Sat, 14 Apr 2018 10:29:57 +0000"  >&lt;p&gt;GitHub user sihuazhou opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9174&quot; title=&quot;The type of state created in ProccessWindowFunction.proccess() is inconsistency&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9174&quot;&gt;&lt;del&gt;FLINK-9174&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;datastream&amp;#93;&lt;/span&gt;Fix the type of state created in ProccessWindowFunction.proccess() is inconsistency&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR fixes the type of state created in ```ProccessWindowFunction.proccess()``` is inconsistency.&lt;/p&gt;

&lt;p&gt;    Problem detail,&lt;/p&gt;

&lt;p&gt;    ```java&lt;br/&gt;
    context.windowState().getListState(); // return type is HeapListState or RocksDBListState&lt;br/&gt;
    context.globalState().getListState(); // return type is UserFacingListState&lt;br/&gt;
    ````&lt;/p&gt;

&lt;p&gt;    This cause the problem in the following code,&lt;br/&gt;
    ```java&lt;br/&gt;
    Iterable&amp;lt;T&amp;gt; iterableState = listState.get();&lt;br/&gt;
     if (terableState.iterator().hasNext()) {&lt;br/&gt;
       for (T value : iterableState) &lt;/p&gt;
{
         value.setRetracting(true);
         collector.collect(value);
       }
&lt;p&gt;       state.clear();&lt;br/&gt;
    }&lt;br/&gt;
    ```&lt;br/&gt;
    If the listState is created from context.globalState() then it&apos;s fine, but when it created from context.windowState() this will cause NPE. I met this in 1.3.2 but I found it also affect 1.5.0.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;modify ```WindowOperator#PerWindowStateStore``` to ensure the type of state created from `context.windowState().createXXXState()` is consistency with the state created from `context.globalState().createXXXState()`&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add a unit test in ``` WindowOperatorTest#testStateTypeIsConsistencyCreatedFromWindowStateAndGlobalState()``` to guard this change.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/sihuazhou/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/sihuazhou/flink&lt;/a&gt; fixStateTypeInconsistencyForWindowOperator&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5847&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d92122575c150f7d0b6b7ed48824c490d4de0b64&lt;br/&gt;
Author: sihuazhou &amp;lt;summerleafs@...&amp;gt;&lt;br/&gt;
Date:   2018-04-14T10:02:24Z&lt;/p&gt;

&lt;p&gt;    Fix the type of state created from windowState &amp;amp; globalState inconsistency.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16438307" author="githubbot" created="Sat, 14 Apr 2018 10:36:05 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi, @StephanEwen could you please have a look at this? If you think this is a a non-issue, I&apos;d like to close this. (sorry for pinging you here, it because I saw your some comments about ```UserFacingListState``` in &lt;span class=&quot;error&quot;&gt;&amp;#91;5356&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/flink/pull/5356&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5356&lt;/a&gt;))&lt;/p&gt;</comment>
                            <comment id="16451673" author="sihuazhou" created="Wed, 25 Apr 2018 05:27:17 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt;, could you please have a look at this? Do you think this should be an issue?&lt;/p&gt;</comment>
                            <comment id="16458736" author="githubbot" created="Mon, 30 Apr 2018 16:38:38 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @aljoscha Thanks for your review, I have addressed your comments.&lt;/p&gt;</comment>
                            <comment id="16462176" author="githubbot" created="Thu, 3 May 2018 09:22:33 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi @aljoscha does this PR look good to you now?&lt;/p&gt;</comment>
                            <comment id="16467312" author="githubbot" created="Tue, 8 May 2018 12:09:35 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi, @aljoscha will this PR go into 1.5?&lt;/p&gt;</comment>
                            <comment id="16469015" author="githubbot" created="Wed, 9 May 2018 16:15:32 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc @StephanEwen Could you please have a look at this? I think it&apos;s already for another review.&lt;/p&gt;</comment>
                            <comment id="16473491" author="githubbot" created="Sun, 13 May 2018 13:51:00 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Could anyone have a look at this...&lt;/p&gt;</comment>
                            <comment id="16475487" author="githubbot" created="Tue, 15 May 2018 08:25:44 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc @tillrohrmann could you please take a look at this?&lt;/p&gt;</comment>
                            <comment id="16475552" author="githubbot" created="Tue, 15 May 2018 09:36:32 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    cc @StefanRRichter could you please have a look at this...&lt;/p&gt;</comment>
                            <comment id="16477369" author="githubbot" created="Wed, 16 May 2018 12:44:39 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Sorry for the delay @sihuazhou I have a few minor touchups that I&apos;ll apply while merging. &#128077; &lt;/p&gt;

&lt;p&gt;    And thanks for discovering this and fixing it. &#128516; &lt;/p&gt;</comment>
                            <comment id="16477376" author="aljoscha" created="Wed, 16 May 2018 12:53:03 +0000"  >&lt;p&gt;release-1.5:&lt;br/&gt;
4365dcb0acc1b079981d09a0e9ab04ce8e74aa84&lt;/p&gt;

&lt;p&gt;master:&lt;br/&gt;
63740e7c51800599d6d4d77bb7762600df2bad88&lt;/p&gt;</comment>
                            <comment id="16479040" author="githubbot" created="Thu, 17 May 2018 13:23:40 +0000"  >&lt;p&gt;Github user sihuazhou commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Closing, because it&apos;s already merged.&lt;/p&gt;</comment>
                            <comment id="16479041" author="githubbot" created="Thu, 17 May 2018 13:23:41 +0000"  >&lt;p&gt;Github user sihuazhou closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5847&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5847&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3sk13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>