<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19777] Fix NullPointException for WindowOperator.close()</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19777</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;i use flink sql run a job,the sql and metadata is :&lt;br/&gt;
 meta :&lt;/p&gt;

&lt;p&gt;1&amp;gt;soure: kafka&lt;br/&gt;
 create table metric_source_window_table(&lt;/p&gt;

&lt;p&gt;`metricName` String,&lt;/p&gt;

&lt;p&gt;`namespace` String,&lt;/p&gt;

&lt;p&gt;`timestamp` BIGINT,&lt;/p&gt;

&lt;p&gt;`doubleValue` DOUBLE,&lt;/p&gt;

&lt;p&gt;`longValue` BIGINT,&lt;/p&gt;

&lt;p&gt;`metricsValue` String,&lt;/p&gt;

&lt;p&gt;`tags` MAP&amp;lt;String, String&amp;gt;,&lt;/p&gt;

&lt;p&gt;`meta` Map&amp;lt;String, String&amp;gt;,&lt;/p&gt;

&lt;p&gt;t as TO_TIMESTAMP(FROM_UNIXTIME(`timestamp`/1000,&apos;yyyy-MM-dd HH:mm:ss&apos;)),&lt;/p&gt;

&lt;p&gt;WATERMARK FOR t AS t) WITH (&lt;/p&gt;

&lt;p&gt;&apos;connector&apos; = &apos;kafka&apos;,&lt;/p&gt;

&lt;p&gt;&apos;topic&apos; = &apos;ai-platform&apos;,&lt;/p&gt;

&lt;p&gt;&apos;properties.bootstrap.servers&apos; = &apos;xxx&apos;,&lt;/p&gt;

&lt;p&gt;&apos;properties.group.id&apos; = &apos;metricgroup&apos;,&lt;/p&gt;

&lt;p&gt;&apos;scan.startup.mode&apos;=&apos;earliest-offset&apos;,&lt;/p&gt;

&lt;p&gt;&apos;format&apos; = &apos;json&apos;,&lt;/p&gt;

&lt;p&gt;&apos;json.fail-on-missing-field&apos; = &apos;false&apos;,&lt;/p&gt;

&lt;p&gt;&apos;json.ignore-parse-errors&apos; = &apos;true&apos;)&lt;/p&gt;

&lt;p&gt;2&amp;gt;sink to clickhouse(the clickhouse-connector was developed by ourself)&lt;/p&gt;

&lt;p&gt;create table flink_metric_window_table(&lt;/p&gt;

&lt;p&gt;`timestamp` BIGINT,&lt;/p&gt;

&lt;p&gt;`longValue` BIGINT,&lt;/p&gt;

&lt;p&gt;`metricName` String,&lt;/p&gt;

&lt;p&gt;`metricsValueSum` DOUBLE,&lt;/p&gt;

&lt;p&gt;`metricsValueMin` DOUBLE,&lt;/p&gt;

&lt;p&gt;`metricsValueMax` DOUBLE,&lt;/p&gt;

&lt;p&gt;`tag_record_id` String,&lt;/p&gt;

&lt;p&gt;`tag_host_ip` String,&lt;/p&gt;

&lt;p&gt;`tag_instance` String,&lt;/p&gt;

&lt;p&gt;`tag_job_name` String,&lt;/p&gt;

&lt;p&gt;`tag_ai_app_name` String,&lt;/p&gt;

&lt;p&gt;`tag_namespace` String,&lt;/p&gt;

&lt;p&gt;`tag_ai_type` String,&lt;/p&gt;

&lt;p&gt;`tag_host_name` String,&lt;/p&gt;

&lt;p&gt;`tag_alarm_domain` String) WITH (&lt;/p&gt;

&lt;p&gt;&apos;connector.type&apos; = &apos;clickhouse&apos;,&lt;/p&gt;

&lt;p&gt;&apos;connector.property-version&apos; = &apos;1&apos;,&lt;/p&gt;

&lt;p&gt;&apos;connector.url&apos; = &apos;jdbc:clickhouse://xxx:8123/dataeye&apos;,&lt;/p&gt;

&lt;p&gt;&apos;connector.cluster&apos;=&apos;ck_cluster&apos;,&lt;/p&gt;

&lt;p&gt;&apos;connector.write.flush.max-rows&apos;=&apos;6000&apos;,&lt;/p&gt;

&lt;p&gt;&apos;connector.write.flush.interval&apos;=&apos;1000&apos;,&lt;/p&gt;

&lt;p&gt;&apos;connector.table&apos; = &apos;flink_metric_table_all&apos;)&lt;/p&gt;

&lt;p&gt;my sql is :&lt;/p&gt;

&lt;p&gt;insert into&lt;br/&gt;
 hive.temp_vipflink.flink_metric_window_table&lt;br/&gt;
select&lt;br/&gt;
 cast(HOP_ROWTIME(t, INTERVAL &apos;60&apos; SECOND, INTERVAL &apos;15&apos; MINUTE) AS BIGINT) AS `timestamps`,&lt;br/&gt;
 sum(COALESCE( `longValue`, 0)) AS longValue,&lt;br/&gt;
 metricName,&lt;br/&gt;
 sum(IF(IS_DIGIT(metricsValue), cast(metricsValue AS DOUBLE), 0)) AS metricsValueSum,&lt;br/&gt;
 min(IF(IS_DIGIT(metricsValue), cast(metricsValue AS DOUBLE), 0)) AS metricsValueMin,&lt;br/&gt;
 max(IF(IS_DIGIT(metricsValue), cast(metricsValue AS DOUBLE), 0)) AS metricsValueMax,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;record_id&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;host_ip&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;instance&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;job_name&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;ai_app_name&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;namespace&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;ai_type&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;host_name&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;alarm_domain&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
from&lt;br/&gt;
 hive.temp_vipflink.metric_source_window_table&lt;br/&gt;
 group by &lt;br/&gt;
 metricName,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;record_id&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;host_ip&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;instance&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;job_name&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;ai_app_name&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;namespace&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;ai_type&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;host_name&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 tags &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;alarm_domain&amp;#39;&amp;#93;&lt;/span&gt;,&lt;br/&gt;
 HOP(t, INTERVAL &apos;60&apos; SECOND, INTERVAL &apos;15&apos; MINUTE)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;when i run this sql for a long hours, it will appear a exception like this:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2020-10-22 20:54:52.089&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; [GroupWindowAggregate(groupBy=&lt;span class=&quot;error&quot;&gt;&amp;#91;metricName, $f1, $f2, $f3, $f4, $f5, $f6, $f7, $f8, $f9&amp;#93;&lt;/span&gt;, window=&lt;span class=&quot;error&quot;&gt;&amp;#91;SlidingGroupWindow(&amp;#39;w$, t, 900000, 60000)&amp;#93;&lt;/span&gt;, properties=&lt;span class=&quot;error&quot;&gt;&amp;#91;w$start, w$end, w$rowtime, w$proctime&amp;#93;&lt;/span&gt;, select=&lt;span class=&quot;error&quot;&gt;&amp;#91;metricName, $f1, $f2, $f3, $f4, $f5, $f6, $f7, $f8, $f9, SUM($f11) AS longValue, SUM($f12) AS metricsValueSum, MIN($f12) AS metricsValueMin, MAX($f12) AS metricsValueMax, start(&amp;#39;w$) AS w$start, end(&amp;#39;w$) AS w$end, rowtime(&amp;#39;w$) AS w$rowtime, proctime(&amp;#39;w$) AS w$proctime&amp;#93;&lt;/span&gt;) -&amp;gt; Calc(select=&lt;span class=&quot;error&quot;&gt;&amp;#91;CAST(CAST(w$rowtime)) AS timestamps, longValue, metricName, metricsValueSum, metricsValueMin, metricsValueMax, $f1 AS EXPR$6, $f2 AS EXPR$7, $f3 AS EXPR$8, $f4 AS EXPR$9, $f5 AS EXPR$10, $f6 AS EXPR$11, $f7 AS EXPR$12, $f8 AS EXPR$13, $f9 AS EXPR$14&amp;#93;&lt;/span&gt;) -&amp;gt; SinkConversionToTuple2 -&amp;gt; Sink: JdbcUpsertTableSink(timestamp, longValue, metricName, metricsValueSum, metricsValueMin, metricsValueMax, tag_record_id, tag_host_ip, tag_instance, tag_job_name, tag_ai_app_name, tag_namespace, tag_ai_type, tag_host_name, tag_alarm_domain) (23/44)] &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.flink.streaming.runtime.tasks.StreamTask&amp;#93;&lt;/span&gt; &amp;gt;&amp;gt;&amp;gt; Error during disposal of stream operator. java.lang.NullPointerException: null at org.apache.flink.table.runtime.operators.window.WindowOperator.dispose(WindowOperator.java:318) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;flink-table-blink_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT&amp;#93;&lt;/span&gt; at org.apache.flink.streaming.runtime.tasks.StreamTask.disposeAllOperators(StreamTask.java:729) &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT&amp;#93;&lt;/span&gt; at org.apache.flink.streaming.runtime.tasks.StreamTask.cleanUpInvoke(StreamTask.java:645) &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT&amp;#93;&lt;/span&gt; at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:549) &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT&amp;#93;&lt;/span&gt; at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:721) &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT&amp;#93;&lt;/span&gt; at org.apache.flink.runtime.taskmanager.Task.run(Task.java:546) &lt;span class=&quot;error&quot;&gt;&amp;#91;flink-dist_2.11-1.11-SNAPSHOT.jar:1.11-SNAPSHOT&amp;#93;&lt;/span&gt; at java.lang.Thread.run(Thread.java:748) &lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_262&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;finally ,this job is error, and this job will be failed&lt;/p&gt;</description>
                <environment>&lt;p&gt;jdk 1.8.0_262&lt;br/&gt;
flink 1.11.1&lt;/p&gt;</environment>
        <key id="13336854">FLINK-19777</key>
            <summary>Fix NullPointException for WindowOperator.close()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jark">Jark Wu</assignee>
                                    <reporter username="frank wang">frank wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 23 Oct 2020 06:07:11 +0000</created>
                <updated>Tue, 27 Oct 2020 07:22:02 +0000</updated>
                            <resolved>Tue, 27 Oct 2020 07:22:02 +0000</resolved>
                                    <version>1.11.2</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Table SQL / Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17219638" author="hailong wang" created="Fri, 23 Oct 2020 11:27:35 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, I wonder under what circumstances&#160;will the close method be called before the open method?&lt;/p&gt;</comment>
                            <comment id="17219698" author="jark" created="Fri, 23 Oct 2020 14:08:51 +0000"  >&lt;p&gt;If the job is failed before the window operator initialized, this might happen. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hailong+wang&quot; class=&quot;user-hover&quot; rel=&quot;hailong wang&quot;&gt;hailong wang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17220443" author="hailong wang" created="Mon, 26 Oct 2020 02:22:33 +0000"  >&lt;p&gt;You are right.&#160;More correctly, the dispose method is called before the open method when job&#160;is failed before the operator initialized. For the close method is invoked when job finished&#160;or is canceled, and when job is failed, the dispose method is&#160;invoked.&lt;/p&gt;</comment>
                            <comment id="17221076" author="jark" created="Tue, 27 Oct 2020 02:34:09 +0000"  >&lt;p&gt;Fixed in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 1bdac236eb0eb19ab2125bf70ebb1099e0bca468&lt;/li&gt;
	&lt;li&gt;1.11: ea96f48b38fad49cfdbbac842a730ba2b298b796&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jy0g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>