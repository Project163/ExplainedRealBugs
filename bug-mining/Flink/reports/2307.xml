<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:32:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8073] Test instability FlinkKafkaProducer011ITCase.testScaleDownBeforeFirstCheckpoint()</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8073</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Travis log: &lt;a href=&quot;https://travis-ci.org/kl0u/flink/jobs/301985988&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/kl0u/flink/jobs/301985988&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13118297">FLINK-8073</key>
            <summary>Test instability FlinkKafkaProducer011ITCase.testScaleDownBeforeFirstCheckpoint()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kkl0u">Kostas Kloudas</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Tue, 14 Nov 2017 17:00:16 +0000</created>
                <updated>Fri, 19 Oct 2018 19:18:51 +0000</updated>
                            <resolved>Fri, 19 Oct 2018 19:18:51 +0000</resolved>
                                    <version>1.4.0</version>
                    <version>1.5.0</version>
                                                    <component>Connectors / Kafka</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16278585" author="till.rohrmann" created="Tue, 5 Dec 2017 13:59:04 +0000"  >&lt;p&gt;Happened also on the release-1.4 branch: &lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/311502347&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/311502347&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16323281" author="tzulitai" created="Fri, 12 Jan 2018 00:24:19 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://api.travis-ci.org/v3/job/327769316/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/327769316/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16334083" author="till.rohrmann" created="Mon, 22 Jan 2018 09:51:08 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://travis-ci.org/tillrohrmann/flink/jobs/331696951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/tillrohrmann/flink/jobs/331696951&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16348691" author="dyanarose" created="Thu, 1 Feb 2018 14:58:11 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/336094494,&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/336094494,&lt;/a&gt;&#160;&lt;a href=&quot;https://api.travis-ci.org/v3/job/336094494/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/336094494/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16368165" author="till.rohrmann" created="Sat, 17 Feb 2018 10:13:29 +0000"  >&lt;p&gt;Another instance:&#160;&lt;a href=&quot;https://api.travis-ci.org/v3/job/342673340/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://api.travis-ci.org/v3/job/342673340/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16401958" author="gjy" created="Fri, 16 Mar 2018 14:15:42 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/354290449&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/354290449&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16404768" author="githubbot" created="Mon, 19 Mar 2018 12:59:58 +0000"  >&lt;p&gt;GitHub user pnowojski opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8073&quot; title=&quot;Test instability FlinkKafkaProducer011ITCase.testScaleDownBeforeFirstCheckpoint()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8073&quot;&gt;&lt;del&gt;FLINK-8073&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-tests&amp;#93;&lt;/span&gt; Disable timeout in tests&lt;/p&gt;

&lt;p&gt;    To get stacktraces in case of deadlock do not timeout tests programatically.&lt;/p&gt;

&lt;p&gt;    This is a trivial change in tests.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/pnowojski/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pnowojski/flink&lt;/a&gt; f8073&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5718&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0e201cd462f1c1c1a94e18f1c1b3135dbf6a145c&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@...&amp;gt;&lt;br/&gt;
Date:   2018-03-19T08:48:15Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8073&quot; title=&quot;Test instability FlinkKafkaProducer011ITCase.testScaleDownBeforeFirstCheckpoint()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8073&quot;&gt;&lt;del&gt;FLINK-8073&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-tests&amp;#93;&lt;/span&gt; Disable timeout in tests&lt;/p&gt;

&lt;p&gt;    To get stacktraces in case of deadlock do not timeout tests programatically.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16404828" author="githubbot" created="Mon, 19 Mar 2018 13:49:59 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This change appears to be focus mostly around Travis which i dislike a bit. &lt;br/&gt;
    I&apos;d rather add a custom `Timeout` that prints the thread-dump so we still get nice behavior when running things locally/in the IDE.&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    	@Rule&lt;br/&gt;
    	public final Timeout timeout = new MyTimeOut(10, TimeUnit.MILLISECONDS);&lt;/p&gt;

&lt;p&gt;    	public static class MyTimeOut extends Timeout {&lt;/p&gt;

&lt;p&gt;    		public MyTimeOut(long timeout, TimeUnit timeUnit) &lt;/p&gt;
{
    			super(timeout, timeUnit);
    		}

&lt;p&gt;    		@Override&lt;br/&gt;
    		public Statement apply(Statement base, Description description) {&lt;br/&gt;
    			Statement fail = super.apply(base, description);&lt;br/&gt;
    			return new Statement() {&lt;br/&gt;
    				@Override&lt;br/&gt;
    				public void evaluate() throws Throwable &lt;/p&gt;
{
    					System.out.println(crunchifyGenerateThreadDump());
    					fail.evaluate();
    				}
&lt;p&gt;    			};&lt;br/&gt;
    		}&lt;br/&gt;
    	}&lt;/p&gt;

&lt;p&gt;    	public static String crunchifyGenerateThreadDump() {&lt;br/&gt;
    		final StringBuilder dump = new StringBuilder();&lt;br/&gt;
    		final ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();&lt;br/&gt;
    		final ThreadInfo[] threadInfos = threadMXBean.getThreadInfo(threadMXBean.getAllThreadIds(), 100);&lt;br/&gt;
    		for (ThreadInfo threadInfo : threadInfos) {&lt;br/&gt;
    			dump.append(&apos;&quot;&apos;);&lt;br/&gt;
    			dump.append(threadInfo.getThreadName());&lt;br/&gt;
    			dump.append(&quot;\&quot; &quot;);&lt;br/&gt;
    			final Thread.State state = threadInfo.getThreadState();&lt;br/&gt;
    			dump.append(&quot;\n   java.lang.Thread.State: &quot;);&lt;br/&gt;
    			dump.append(state);&lt;br/&gt;
    			final StackTraceElement[] stackTraceElements = threadInfo.getStackTrace();&lt;br/&gt;
    			for (final StackTraceElement stackTraceElement : stackTraceElements) &lt;/p&gt;
{
    				dump.append(&quot;\n        at &quot;);
    				dump.append(stackTraceElement);
    			}
&lt;p&gt;    			dump.append(&quot;\n\n&quot;);&lt;br/&gt;
    		}&lt;br/&gt;
    		return dump.toString();&lt;br/&gt;
    	}&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16404944" author="githubbot" created="Mon, 19 Mar 2018 15:10:10 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think that timeouts in IDE are only making things worse:&lt;br/&gt;
    1. you can not debug, since longer debugging session will fail &lt;br/&gt;
    2. in case of deadlocks, locally you can always manually dump/view stack traces but you also can do full thread/memory dump and/or attach a debugger.&lt;/p&gt;

&lt;p&gt;    On travis you can not debug it in any way, thus automated actions make sense (and they preserve some travis resources for other builds). &lt;/p&gt;

&lt;p&gt;    Furthermore, such rule would have to be implemented in all of our tests, not only here. Also IMO if you want to replace/remove `travis_mvn_watchdog` with such rule, this is out of scope of this ticket and it should be discussed separately (I would be against it), so that it doesn&apos;t hinder this ticket.&lt;/p&gt;

&lt;p&gt;    When I originally created those tests (with `@Test(timeout = xxxx)`) I did it by copying without thinking from a test, that was printing something to logs once every checkpoint, thus it was interrupting travis watchdog and one could argue that it required this special case timeout. This commit makes it more consistent with rest of the tests.&lt;/p&gt;</comment>
                            <comment id="16404972" author="githubbot" created="Mon, 19 Mar 2018 15:25:52 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I agree with @pnowojski. The watchdog and Travis itself should time out the test for us if things take too long.&lt;/p&gt;</comment>
                            <comment id="16405298" author="githubbot" created="Mon, 19 Mar 2018 19:14:24 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I don&apos;t want to make a fuss over a single test, so for the purposes of this test it&apos;s fine to just remote the timeout.&lt;/p&gt;

&lt;p&gt;    In general however i think it would be pretty neat if we would add such a `Timeout` to the `TestLogger` class. I see the problem of debugging tests that have timeouts, but removing timeouts altogether is the wrong conclusion imo. Instead, we could implement the `Timeout` such that it doesn&apos;t fail the test if a certain profile/property is set.&lt;/p&gt;

&lt;p&gt;    With this we keep the benefits of test timeouts (CI service independence, less special behavior locally vs CI, fixed upper bound for test times which is particularly useful for new tests, &quot;guarantee&quot; that the test terminates) while still allowing debugging. In fact we may end up improving the debugging situation by consolidating how timeouts are implemented instead of each test rolling their own solution that you can&apos;t disable.&lt;/p&gt;

&lt;p&gt;    The travis watchdog &lt;em&gt;cannot&lt;/em&gt; be removed as it covers the entire maven process that from time to time locks up outside of tests. That said, the fact that we have to rely on the travis watchdog &lt;em&gt;to ensure that tests terminate&lt;/em&gt; is a bad sign. Not to mention that it already forced us to introduce workarounds to make tests &quot;compatible&quot;, like the kafka tests and others that print stuff for the sole purposes of not triggering it.&lt;/p&gt;
</comment>
                            <comment id="16406291" author="githubbot" created="Tue, 20 Mar 2018 13:05:09 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In that case can we merge it as it is and if you want @zentol, we can start a discussion about future direction of this?&lt;/p&gt;</comment>
                            <comment id="16407745" author="githubbot" created="Wed, 21 Mar 2018 10:52:14 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Having a custom timeout like @zentol suggests could be helpful in the long run.&lt;/p&gt;

&lt;p&gt;    For now, though, I personally agree that the timeouts are counter productive (I actually never understood what they are supposed to solve). I prefer a deadlocking test to stay around, so I can jstack to the process, attach a debugger, pull a heap dump, whatever. The only environment where we cannot do that is the CI server, which has a timeout and thread dump already...&lt;/p&gt;</comment>
                            <comment id="16407852" author="githubbot" created="Wed, 21 Mar 2018 12:52:36 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    merging.&lt;/p&gt;</comment>
                            <comment id="16408009" author="githubbot" created="Wed, 21 Mar 2018 14:37:02 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks!&lt;/p&gt;</comment>
                            <comment id="16408705" author="githubbot" created="Wed, 21 Mar 2018 22:40:15 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5718&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16419019" author="till.rohrmann" created="Thu, 29 Mar 2018 13:54:16 +0000"  >&lt;p&gt;Added a commit for better debugging&lt;br/&gt;
master: e273d5fea782399c6887fe7bdc169602a7026fcc&lt;br/&gt;
1.5.0: 2b85b464d52942541b5c6d63fddd70a18a36ab9e&lt;/p&gt;</comment>
                            <comment id="16419026" author="till.rohrmann" created="Thu, 29 Mar 2018 13:56:31 +0000"  >&lt;p&gt;Unblocking 1.5.0 from this issue since this problem seems to be introduced with 1.4. Might be a Kafka problem. We should definitely keep an eye on these tests.&lt;/p&gt;</comment>
                            <comment id="16657303" author="till.rohrmann" created="Fri, 19 Oct 2018 19:18:51 +0000"  >&lt;p&gt;Problem did not reappear for quite some time. Closing. If this issue reappears, then we should reopen this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mrof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>