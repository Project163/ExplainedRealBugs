<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:38:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-11591] Restoring LockableTypeSerializer&apos;s snapshot from 1.6 and below requires pre-processing before snapshot is valid to use</title>
                <link>https://issues.apache.org/jira/browse/FLINK-11591</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In 1.6 and below, the &lt;tt&gt;LockableTypeSerializer&lt;/tt&gt; incorrectly returns directly the element serializer&apos;s snapshot instead of wrapping it within an independent snapshot class:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/blob/release-1.6/flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/sharedbuffer/Lockable.java#L188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/release-1.6/flink-libraries/flink-cep/src/main/java/org/apache/flink/cep/nfa/sharedbuffer/Lockable.java#L188&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This results in the fact that the the written state information for this would be &lt;tt&gt;(LockableTypeSerializer, SomeArbitrarySnapshot)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The problem occurs when restoring this in Flink 1.7+, since compatibility checks are now performed by providing the new serializer to the snapshot, what would happen is:&lt;br/&gt;
&lt;tt&gt;SomeArbitrarySnapshot.resolveSchemaCompatibility(newLockableTypeSerializer)&lt;/tt&gt;, which would not work since the arbitrary snapshot does not recognize the &lt;tt&gt;LockableTypeSerializer&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;To fix this, we essentially need to preprocess that arbitrary snapshot when restoring from &amp;lt;= 1.6 version snapshots.&lt;/p&gt;

&lt;p&gt;A proposed fix would be to have the following interface:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; RequiresLegacySerializerSnapshotPreprocessing&amp;lt;T&amp;gt; {
    TypeSerializerSnapshot&amp;lt;T&amp;gt; preprocessLegacySerializerSnapshot(TypeSerializerSnapshot&amp;lt;T&amp;gt; legacySnapshot)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;tt&gt;LockableTypeSerializer&lt;/tt&gt; would then implement this interface, and in the &lt;tt&gt;preprocessLegacySerializerSnapshot&lt;/tt&gt; method, properly wrap that arbitrary element serializer snapshot into a &lt;tt&gt;LockableTypeSerializerSnapshot&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;In general, this interface is useful to preprocess any problematic snapshot that was returned pre 1.7.&lt;/p&gt;

&lt;p&gt;The point-in-time to check if a written serializer in &amp;lt;= 1.6 savepoints implements this interface and preprocesses the read snapshot would be:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/flink/blob/a567a1ef628eadad21e11864ec328481cd6d7898/flink-core/src/main/java/org/apache/flink/api/common/typeutils/TypeSerializerSerializationUtil.java#L218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/a567a1ef628eadad21e11864ec328481cd6d7898/flink-core/src/main/java/org/apache/flink/api/common/typeutils/TypeSerializerSerializationUtil.java#L218&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13215448">FLINK-11591</key>
            <summary>Restoring LockableTypeSerializer&apos;s snapshot from 1.6 and below requires pre-processing before snapshot is valid to use</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="igalshilman">Igal Shilman</assignee>
                                    <reporter username="tzulitai">Tzu-Li (Gordon) Tai</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 13 Feb 2019 08:29:12 +0000</created>
                <updated>Thu, 14 Feb 2019 09:17:20 +0000</updated>
                            <resolved>Thu, 14 Feb 2019 09:17:20 +0000</resolved>
                                    <version>1.7.0</version>
                    <version>1.7.1</version>
                                    <fixVersion>1.8.0</fixVersion>
                                    <component>API / Type Serialization System</component>
                    <component>Library / CEP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16768029" author="tzulitai" created="Thu, 14 Feb 2019 09:17:14 +0000"  >&lt;p&gt;Merged for 1.8.0 - f9532cba36c04fbde7e6956a0813ba260ad96953&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0xlc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>