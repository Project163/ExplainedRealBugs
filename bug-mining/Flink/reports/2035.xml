<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:30:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7338] User Defined aggregation with constants causes error under in lowerbound over window extraction</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7338</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A user defined aggregation that passes a constant among the arguments causes a RuntimeException extracting the lower boundary over window.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;val sqlQuery = &lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT a, &quot;&lt;/span&gt; +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;  myAgg(a, CAST(&lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt; as BIGINT)) &quot;&lt;/span&gt;+
      &quot;   OVER (ORDER BY proctime RANGE BETWEEN INTERVAL &lt;span class=&quot;code-quote&quot;&gt;&apos;30&apos;&lt;/span&gt; SECOND 
               PRECEDING AND CURRENT ROW) &quot; +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;FROM MyTable&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The error is in the org.apache.flink.table.plan.nodes.OverAggregate.scala&lt;/p&gt;

&lt;p&gt;we do : field count - lower bound index&lt;br/&gt;
&amp;#8211;  which causes a -1 get, and subsequent RuntimeException. &lt;br/&gt;
We should do: lower bound offset - field count to find the value in the constant array.&lt;/p&gt;

&lt;p&gt;The code below should fix the problem.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;[flink] def getLowerBoundary(
    logicWindow: Window,
    overWindow: Group,
    input: RelNode): &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; = {

    val ref: RexInputRef = overWindow.lowerBound.getOffset.asInstanceOf[RexInputRef]
    val lowerBoundIndex = ref.getIndex - input.getRowType.getFieldCount
    val lowerBound = logicWindow.constants.get(lowerBoundIndex).getValue2
    lowerBound match {
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; x: java.math.BigDecimal =&amp;gt; x.asInstanceOf[java.math.BigDecimal].longValue()
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _ =&amp;gt; lowerBound.asInstanceOf[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;]
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13091584">FLINK-7338</key>
            <summary>User Defined aggregation with constants causes error under in lowerbound over window extraction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fhueske">Fabian Hueske</assignee>
                                    <reporter username="stefano.bortoli">Stefano Bortoli</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Aug 2017 15:16:09 +0000</created>
                <updated>Fri, 3 Nov 2017 09:33:20 +0000</updated>
                            <resolved>Fri, 3 Nov 2017 09:33:19 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16236687" author="fhueske" created="Thu, 2 Nov 2017 22:11:36 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stefano.bortoli&quot; class=&quot;user-hover&quot; rel=&quot;stefano.bortoli&quot;&gt;stefano.bortoli&lt;/a&gt; for reporting the bug and providing the fix!&lt;br/&gt;
I&apos;ll fix this for the 1.4.0 release.&lt;/p&gt;

&lt;p&gt;Thanks, Fabian&lt;/p&gt;</comment>
                            <comment id="16237352" author="fhueske" created="Fri, 3 Nov 2017 09:33:20 +0000"  >&lt;p&gt;Fixed for 1.4.0 with 16b088218435dc64848ad641a383f9ce808f07c2&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 2 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3i9sn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>