<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:30:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7669] Always load Flink classes through parent ClassLoader</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7669</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Latest code pulled from trunk threw errors at runtime when i ran a job against it; but when i ran the JAR against the stable version &lt;tt&gt;1.3.2&lt;/tt&gt; it was OK. Here is the stacktrace. &lt;/p&gt;

&lt;p&gt;An exception is being thrown :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Cluster configuration: Standalone cluster with JobManager at localhost/127.0.0.1:6123
Using address localhost:6123 to connect to JobManager.
JobManager web interface address http://localhost:8081
Starting execution of programhttps://issues.apache.org/jira/issues/?jql=text%20~%20%22org.apache.flink.api.common.ExecutionConfig%20cannot%20be%20cast%20to%22#
Submitting job with JobID: 05dd8e60c6fda3b96fc22ef6cf389a23. Waiting for job completion.
Connected to JobManager at Actor[akka.tcp://flink@localhost:6123/user/jobmanager#-234825544] with leader session id 00000000-0000-0000-0000-000000000000.

------------------------------------------------------------
 The program finished with the following exception:

org.apache.flink.client.program.ProgramInvocationException: The program execution failed: Failed to submit job 05dd8e60c6fda3b96fc22ef6cf389a23 (Flink Streaming Job)
	at org.apache.flink.client.program.ClusterClient.run(ClusterClient.java:479)
	at org.apache.flink.client.program.StandaloneClusterClient.submitJob(StandaloneClusterClient.java:105)
	at org.apache.flink.client.program.ClusterClient.run(ClusterClient.java:443)
	at org.apache.flink.streaming.api.environment.StreamContextEnvironment.execute(StreamContextEnvironment.java:66)
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.execute(StreamExecutionEnvironment.java:1501)
	at org.apache.flink.streaming.api.scala.StreamExecutionEnvironment.execute(StreamExecutionEnvironment.scala:629)
	at org.example.streams.split.SimpleSplitStreams$.main(04splitstreams.scala:53)
	at org.example.streams.split.SimpleSplitStreams.main(04splitstreams.scala)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:525)
	at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:417)
	at org.apache.flink.client.program.ClusterClient.run(ClusterClient.java:383)
	at org.apache.flink.client.CliFrontend.executeProgram(CliFrontend.java:840)
	at org.apache.flink.client.CliFrontend.run(CliFrontend.java:285)
	at org.apache.flink.client.CliFrontend.parseParameters(CliFrontend.java:1088)
	at org.apache.flink.client.CliFrontend$2.call(CliFrontend.java:1135)
	at org.apache.flink.client.CliFrontend$2.call(CliFrontend.java:1132)
	at org.apache.flink.runtime.security.HadoopSecurityContext$1.run(HadoopSecurityContext.java:44)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1556)
	at org.apache.flink.runtime.security.HadoopSecurityContext.runSecured(HadoopSecurityContext.java:41)
	at org.apache.flink.client.CliFrontend.main(CliFrontend.java:1132)
Caused by: org.apache.flink.runtime.client.JobExecutionException: Failed to submit job 05dd8e60c6fda3b96fc22ef6cf389a23 (Flink Streaming Job)
	at org.apache.flink.runtime.jobmanager.JobManager.org$apache$flink$runtime$jobmanager$JobManager$$submitJob(JobManager.scala:1358)
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1.applyOrElse(JobManager.scala:484)
	at scala.runtime.AbstractPartialFunction.apply(AbstractPartialFunction.scala:36)
	at org.apache.flink.runtime.LeaderSessionMessageFilter$$anonfun$receive$1.applyOrElse(LeaderSessionMessageFilter.scala:38)
	at scala.runtime.AbstractPartialFunction.apply(AbstractPartialFunction.scala:36)
	at org.apache.flink.runtime.LogMessages$$anon$1.apply(LogMessages.scala:33)
	at org.apache.flink.runtime.LogMessages$$anon$1.apply(LogMessages.scala:28)
	at scala.PartialFunction$class.applyOrElse(PartialFunction.scala:123)
	at org.apache.flink.runtime.LogMessages$$anon$1.applyOrElse(LogMessages.scala:28)
	at akka.actor.Actor$class.aroundReceive(Actor.scala:467)
	at org.apache.flink.runtime.jobmanager.JobManager.aroundReceive(JobManager.scala:125)
	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:516)
	at akka.actor.ActorCell.invoke(ActorCell.scala:487)
	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:238)
	at akka.dispatch.Mailbox.run(Mailbox.scala:220)
	at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:397)
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
Caused by: java.lang.ClassCastException: org.apache.flink.api.common.ExecutionConfig cannot be cast to org.apache.flink.api.common.ExecutionConfig
	at org.apache.flink.runtime.jobmanager.JobManager.org$apache$flink$runtime$jobmanager$JobManager$$submitJob(JobManager.scala:1279)
	... 19 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;OS: macOS Sierra&lt;/li&gt;
	&lt;li&gt;Oracle JDK 1.8&lt;/li&gt;
	&lt;li&gt;Scala 2.11.11&lt;/li&gt;
	&lt;li&gt;sbt 0.13.16&lt;/li&gt;
	&lt;li&gt;Build from trunk code at commit hash &lt;tt&gt;42cc3a2a9c41dda7cf338db36b45131db9150674&lt;/tt&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;started a local flink node&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="13104231">FLINK-7669</key>
            <summary>Always load Flink classes through parent ClassLoader</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="raymondtay">Raymond Tay</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Sep 2017 09:16:10 +0000</created>
                <updated>Wed, 25 Oct 2017 13:58:24 +0000</updated>
                            <resolved>Wed, 25 Oct 2017 13:58:04 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16176428" author="aljoscha" created="Fri, 22 Sep 2017 13:38:32 +0000"  >&lt;p&gt;How are your running your program?&lt;/p&gt;</comment>
                            <comment id="16176560" author="raymondtay" created="Fri, 22 Sep 2017 15:05:45 +0000"  >&lt;p&gt;Basically, the program is built using &lt;tt&gt;sbt assembly&lt;/tt&gt; which produces a &lt;em&gt;fatjar&lt;/em&gt; and i have 2 installations running locally (version &lt;tt&gt;1.3.2&lt;/tt&gt; which i d/l from the website and locally built &lt;tt&gt;1.4.0-SNAPSHOT&lt;/tt&gt;. The execution command is like this:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;installation directory&amp;gt;/bin/flink run -p 4 JARFILE&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Another piece of information i wanted to share is this: i built the &lt;tt&gt;1.4.0-SNAPSHOT&lt;/tt&gt; locally 2 days back and it was alright and this failure only happened when i pulled again today&lt;/p&gt;</comment>
                            <comment id="16176592" author="aljoscha" created="Fri, 22 Sep 2017 15:38:39 +0000"  >&lt;p&gt;And the fat-jar is built against 1.3.2 always or do you build it against 1.4-SNAPSHOT when running on that cluster?&lt;/p&gt;</comment>
                            <comment id="16177433" author="raymondtay" created="Sat, 23 Sep 2017 01:44:54 +0000"  >&lt;p&gt;The fatjar was initially built against 1.4-SNAPSHOT and when it gave those error messages, i d/l 1.3.2 and used the same fatjar to run against 1.3.2 and it was alright. I suspect some commit in the last 2 days caused it.&lt;/p&gt;</comment>
                            <comment id="16180679" author="aljoscha" created="Tue, 26 Sep 2017 12:32:15 +0000"  >&lt;p&gt;Did you rebuild the fat jar against the most recent 1.4-SNAPSHOT when running on the most recent 1.4-SNAPSHOT cluster? Also, can you check whether &lt;tt&gt;ExecutionConfig&lt;/tt&gt; exists in your fat jar?&lt;/p&gt;</comment>
                            <comment id="16181812" author="raymondtay" created="Wed, 27 Sep 2017 00:57:16 +0000"  >&lt;p&gt;Checked but its still occurring, i&apos;ll investigate this a little bit more&lt;/p&gt;</comment>
                            <comment id="16198406" author="aljoscha" created="Tue, 10 Oct 2017 09:18:34 +0000"  >&lt;p&gt;So is the &lt;tt&gt;ExecutionConfig&lt;/tt&gt; in the fat jar?&lt;/p&gt;</comment>
                            <comment id="16198464" author="raymondtay" created="Tue, 10 Oct 2017 10:09:49 +0000"  >&lt;p&gt;Actually it is inside the fatjar file. This is what i was trying to do and it works fine against 1.3 but gives that error using 1.4-SNAPSHOT. The only option i have not tried is to clear the &lt;tt&gt;.ivy2&lt;/tt&gt; and &lt;tt&gt;.mvn&lt;/tt&gt; directories. Any ideas why this is the case?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
object SimpleSplitStreams {

  def main(args: Array[String]) {

    val env: StreamExecutionEnvironment = StreamExecutionEnvironment.getExecutionEnvironment
    env.setParallelism(2)

    val positiveInts = env.fromCollection(1 to 100)
    val splitS =
      positiveInts
        .name(&lt;span class=&quot;code-quote&quot;&gt;&quot;splitStream&quot;&lt;/span&gt;) // give the source a name
        .split(datum =&amp;gt; if (datum % 2 == 0) &lt;span class=&quot;code-quote&quot;&gt;&quot;even&quot;&lt;/span&gt; :: Nil else &lt;span class=&quot;code-quote&quot;&gt;&quot;odd&quot;&lt;/span&gt; :: Nil)
    splitS.select(&lt;span class=&quot;code-quote&quot;&gt;&quot;even&quot;&lt;/span&gt;).addSink(new PrintSinkFunction[Int] {
      override def invoke(record : Int) { 
        println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;even data: [$record]&quot;&lt;/span&gt;)
      }
    }).name(&lt;span class=&quot;code-quote&quot;&gt;&quot;even-stream&quot;&lt;/span&gt;) // Give this sink a name

    splitS.select(&lt;span class=&quot;code-quote&quot;&gt;&quot;odd&quot;&lt;/span&gt;).addSink(new PrintSinkFunction[Int] {
      override def invoke(record: Int) {
        println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;odd data: [$record]&quot;&lt;/span&gt;)
      }
    }).name(&lt;span class=&quot;code-quote&quot;&gt;&quot;odd-stream&quot;&lt;/span&gt;) 
    env.execute
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16198631" author="aljoscha" created="Tue, 10 Oct 2017 13:02:22 +0000"  >&lt;p&gt;The problem is that the class loader that is used in the client is different from the one used on the cluster. On the client, a &quot;normal&quot; class loader will be used that resolved classes in parent-first order. On the cluster a &quot;child-first&quot; class loader is used by default (this was changed a few weeks back). Because &lt;tt&gt;ExecutionConfig&lt;/tt&gt; is both in the fat-jar and in the jar files of the Flink Runtime this leads to incompatible classes because they are loaded by different class loaders.&lt;/p&gt;

&lt;p&gt;As a workaround, can you try setting &lt;tt&gt;classloader.resolve-order&lt;/tt&gt; to &lt;tt&gt;parent-first&lt;/tt&gt; in &lt;tt&gt;conf/flink-conf.yaml&lt;/tt&gt;? This means that the same class loading order is used in all parts.&lt;/p&gt;</comment>
                            <comment id="16199687" author="raymondtay" created="Wed, 11 Oct 2017 01:54:34 +0000"  >&lt;p&gt;I tried that suggestion but it didn&apos;t work and here&apos;s what i did&lt;br/&gt;
(a) pull from flink&apos;s trunk (git log head hash : 427dfe42e2bea891b40e662bc97cdea57cdae3f5) &lt;br/&gt;
(b) cleaned flink&apos;s build dir&lt;br/&gt;
(c) re-build flink&lt;br/&gt;
  (c.1) re-install flink to local ivy/mvn cache&lt;br/&gt;
(d) applied parameters into &quot;build-target/conf/flink-conf.yaml&quot;&lt;br/&gt;
(e) re-build fatjar (telling sbt to look for ivy/mvn cache)&lt;br/&gt;
(f) start local flink cluster&lt;br/&gt;
(g) ran the program via &quot;flink run ....&quot;&lt;/p&gt;</comment>
                            <comment id="16199891" author="aljoscha" created="Wed, 11 Oct 2017 07:04:25 +0000"  >&lt;p&gt;Could you maybe send me your code so that I can build it myself and try and debug it?&lt;/p&gt;</comment>
                            <comment id="16212025" author="kzhu" created="Fri, 20 Oct 2017 01:30:19 +0000"  >&lt;p&gt;I encountered exactly the same problem a few days ago. I later figured that, if I exclude both flink-core and flink-shaded-curator-recipes from building package (so that modules therein now depends on flink runtime rather than fat-jar), everything works fine. I guess a different version of curator leads to a different memory layout of ExecutionConfig and triggers a deserialization error when JobManager tries to load it.&lt;/p&gt;</comment>
                            <comment id="16214349" author="aljoscha" created="Sun, 22 Oct 2017 15:27:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kzhu&quot; class=&quot;user-hover&quot; rel=&quot;kzhu&quot;&gt;kzhu&lt;/a&gt; Did you try only excluding &lt;tt&gt;flink-core&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="16214356" author="aljoscha" created="Sun, 22 Oct 2017 15:42:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=raymondtay&quot; class=&quot;user-hover&quot; rel=&quot;raymondtay&quot;&gt;raymondtay&lt;/a&gt; I did reproduce the problem by also building a fat-jar that contains the &lt;tt&gt;ExecutionConfig&lt;/tt&gt; class. However, I was able to run the program by setting &lt;tt&gt;classloader.resolve-order: parent-first&lt;/tt&gt; in the Flink conf and restarting the cluster.&lt;/p&gt;

&lt;p&gt;The problem can be fixed by also using the configured classloader resolution order in the client, I&apos;ll be working on that. (I actually had that code in my original PR for introducing the ClassLoader resolution-order so that should be easy to do. &#128578;)&lt;/p&gt;</comment>
                            <comment id="16214505" author="raymondtay" created="Mon, 23 Oct 2017 01:23:31 +0000"  >&lt;p&gt;couldn&apos;t stay ontop of this issue - work and all.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; i haven&apos;t built it against the trunk as of 23 october 2017 and i&apos;ll try that again but if it does deviate from my previous report then i suspect there&apos;s a subtle bug somewhere. i&apos;ll come back and give all an update - fingers crossed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; . Is there a issue already somewhere that helps me/us understand how the classloading should work in flink ? &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kzhu&quot; class=&quot;user-hover&quot; rel=&quot;kzhu&quot;&gt;kzhu&lt;/a&gt; great to hear of a workaround &lt;/p&gt;</comment>
                            <comment id="16214556" author="raymondtay" created="Mon, 23 Oct 2017 02:45:38 +0000"  >&lt;p&gt;The trunk commit stands at hash: &lt;tt&gt;94f1d2b1672ee8f34db9ae85b94bd916ebc38f3e&lt;/tt&gt;&lt;br/&gt;
Using that hash, i rebuilt the cluster and re-did the configuration with &lt;tt&gt;classloader.resolve-order: parent-first&lt;/tt&gt; and discovered that things do work now. Something on the Apache Flink codebase definitely changed but i didn&apos;t investigate as to exactly what it is.&lt;/p&gt;</comment>
                            <comment id="16215178" author="aljoscha" created="Mon, 23 Oct 2017 14:04:07 +0000"  >&lt;p&gt;Good to hear that you could reproduce the fix. I&apos;m currently working on a fix that will make it work also with &lt;tt&gt;classloader.resolve-order: child-first&lt;/tt&gt; which is currently the default on master.&lt;/p&gt;</comment>
                            <comment id="16215263" author="githubbot" created="Mon, 23 Oct 2017 15:07:24 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;     &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7669&quot; title=&quot;Always load Flink classes through parent ClassLoader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7669&quot;&gt;&lt;del&gt;FLINK-7669&lt;/del&gt;&lt;/a&gt; Always load Flink classes via parent ClassLoader&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; jira-7669-classloader-fix-flink-always-parent&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4891&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6ed8bd2b51676bbbd199fcd452136de99445aba4&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-23T15:03:21Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7669&quot; title=&quot;Always load Flink classes through parent ClassLoader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7669&quot;&gt;&lt;del&gt;FLINK-7669&lt;/del&gt;&lt;/a&gt; Always load Flink classes via parent ClassLoader&lt;/p&gt;

&lt;p&gt;    Before, when setting classloader.resolve-order Flink classes where also&lt;br/&gt;
    resolved via the child ClassLoader which could lead to problems if the&lt;br/&gt;
    user-jar contains copies of Flink classes. This change introduces a new&lt;br/&gt;
    setting classloader.always-parent-first-patterns, which is&lt;br/&gt;
    &quot;org.apache.flink&quot; by default. Classes that match this pattern will&lt;br/&gt;
    always be resolved by the parent first, even when using the child-first&lt;br/&gt;
    ClassLoader.&lt;/p&gt;

&lt;p&gt;commit dda0dc6247e53724177d7754ae7add91f0697082&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-10-23T15:05:57Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7669&quot; title=&quot;Always load Flink classes through parent ClassLoader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7669&quot;&gt;&lt;del&gt;FLINK-7669&lt;/del&gt;&lt;/a&gt; Add ClassLoader resolution order to classloader doc&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16215483" author="githubbot" created="Mon, 23 Oct 2017 17:24:12 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146335716&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146335716&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/monitoring/debugging_classloading.md &amp;#8212;&lt;br/&gt;
    @@ -57,22 +57,34 @@ YARN classloading differs between single job deployments and sessions:&lt;/p&gt;

&lt;p&gt;     *&lt;b&gt;Mesos&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;    -Mesos setups following &lt;span class=&quot;error&quot;&gt;&amp;#91;this documentation&amp;#93;&lt;/span&gt;(../ops/deployment/mesos.html) currently behave very much like the a &lt;br/&gt;
    +Mesos setups following &lt;span class=&quot;error&quot;&gt;&amp;#91;this documentation&amp;#93;&lt;/span&gt;(../ops/deployment/mesos.html) currently behave very much like the a&lt;br/&gt;
     YARN session: The TaskManager and JobManager processes are started with the Flink framework classes in classpath, job&lt;br/&gt;
     classes are loaded dynamically when the jobs are submitted.&lt;/p&gt;

&lt;p&gt;    +## Configuring ClassLoader Resolution Order&lt;br/&gt;
    +&lt;br/&gt;
    +Flink uses a hierarchy of ClassLoaders for loading classes from the user-code jar(s). The user-code&lt;br/&gt;
    +ClassLoader has a reference to the parent ClassLoader, which is the default Java ClassLoader in most&lt;br/&gt;
    +cases. By default, Java ClassLoaders will first look for classes in the parent ClassLoader and then in&lt;br/&gt;
    +the child ClassLoader for cases where we have a hierarchy of ClassLoaders. This is problematic if you&lt;br/&gt;
    +have in your user jar a version of a library that conflicts with a version that comes with Flink. You can&lt;br/&gt;
    +change this behaviour by configuring the ClassLoader resolution order via&lt;br/&gt;
    +`classloader.resolve-order: child-first` in the Flink config. However, Flink classes will still&lt;br/&gt;
    +be resolved through the parent ClassLoader first, altough you can also configure this via&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    altough -&amp;gt; although&lt;/p&gt;</comment>
                            <comment id="16215484" author="githubbot" created="Mon, 23 Oct 2017 17:24:13 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146336395&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146336395&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/ops/config.md &amp;#8212;&lt;br/&gt;
    @@ -77,6 +77,10 @@ without explicit scheme definition, such as `/user/USERNAME/in.txt`, is going to&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`classloader.resolve-order`: Whether Flink should use a child-first `ClassLoader` when loading&lt;br/&gt;
     user-code classes or a parent-first `ClassLoader`. Can be one of `parent-first` or `child-first`. (default: `child-first`)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +- `classloader.always-parent-first-patterns`: A (comma-separated) list of patterns that specifies which classes should always be resolved&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    are these prefixes; does it support regex?&lt;/p&gt;</comment>
                            <comment id="16215496" author="githubbot" created="Mon, 23 Oct 2017 17:32:41 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146338877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146338877&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/monitoring/debugging_classloading.md &amp;#8212;&lt;br/&gt;
    @@ -57,22 +57,34 @@ YARN classloading differs between single job deployments and sessions:&lt;/p&gt;

&lt;p&gt;     *&lt;b&gt;Mesos&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;    -Mesos setups following &lt;span class=&quot;error&quot;&gt;&amp;#91;this documentation&amp;#93;&lt;/span&gt;(../ops/deployment/mesos.html) currently behave very much like the a &lt;br/&gt;
    +Mesos setups following &lt;span class=&quot;error&quot;&gt;&amp;#91;this documentation&amp;#93;&lt;/span&gt;(../ops/deployment/mesos.html) currently behave very much like the a&lt;br/&gt;
     YARN session: The TaskManager and JobManager processes are started with the Flink framework classes in classpath, job&lt;br/&gt;
     classes are loaded dynamically when the jobs are submitted.&lt;/p&gt;

&lt;p&gt;    +## Configuring ClassLoader Resolution Order&lt;br/&gt;
    +&lt;br/&gt;
    +Flink uses a hierarchy of ClassLoaders for loading classes from the user-code jar(s). The user-code&lt;br/&gt;
    +ClassLoader has a reference to the parent ClassLoader, which is the default Java ClassLoader in most&lt;br/&gt;
    +cases. By default, Java ClassLoaders will first look for classes in the parent ClassLoader and then in&lt;br/&gt;
    +the child ClassLoader for cases where we have a hierarchy of ClassLoaders. This is problematic if you&lt;br/&gt;
    +have in your user jar a version of a library that conflicts with a version that comes with Flink. You can&lt;br/&gt;
    +change this behaviour by configuring the ClassLoader resolution order via&lt;br/&gt;
    +`classloader.resolve-order: child-first` in the Flink config. However, Flink classes will still&lt;br/&gt;
    +be resolved through the parent ClassLoader first, altough you can also configure this via&lt;br/&gt;
    +`classloader.always-parent-first-patterns`, which is `org.apache.flink`, by default.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    change `always-parent-first-patterns` to `parent-first-patterns`?&lt;/p&gt;</comment>
                            <comment id="16215497" author="githubbot" created="Mon, 23 Oct 2017 17:32:41 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146336544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146336544&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/JobManagerServices.java &amp;#8212;&lt;br/&gt;
    @@ -116,8 +116,15 @@ public static JobManagerServices fromConfiguration(&lt;br/&gt;
     		final String classLoaderResolveOrder =&lt;br/&gt;
     			config.getString(CoreOptions.CLASSLOADER_RESOLVE_ORDER);&lt;/p&gt;

&lt;p&gt;    +		final String alwaysParentFirstLoaderString =&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think this could use some exception handling, for example when the parameter is null, or empty, or does not split.&lt;/p&gt;</comment>
                            <comment id="16215498" author="githubbot" created="Mon, 23 Oct 2017 17:32:41 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146336888&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146336888&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/JobManagerServices.java &amp;#8212;&lt;br/&gt;
    @@ -116,8 +116,15 @@ public static JobManagerServices fromConfiguration(&lt;br/&gt;
     		final String classLoaderResolveOrder =&lt;br/&gt;
     			config.getString(CoreOptions.CLASSLOADER_RESOLVE_ORDER);&lt;/p&gt;

&lt;p&gt;    +		final String alwaysParentFirstLoaderString =&lt;br/&gt;
    +			config.getString(CoreOptions.ALWAYS_PARENT_FIRST_LOADER);&lt;br/&gt;
    +		final String[] alwaysParentFirstLoaderPatterns = alwaysParentFirstLoaderString.split(&quot;,&quot;);&lt;br/&gt;
    +&lt;br/&gt;
     		final BlobLibraryCacheManager libraryCacheManager =&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new BlobLibraryCacheManager(blobServer, FlinkUserCodeClassLoaders.ResolveOrder.fromString(classLoaderResolveOrder));&lt;br/&gt;
    +			new BlobLibraryCacheManager(&lt;br/&gt;
    +				blobServer,&lt;br/&gt;
    +				FlinkUserCodeClassLoaders.ResolveOrder.fromString(classLoaderResolveOrder),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Does this fail with a very ugly enum exception when someone misspells the enum literal?&lt;/p&gt;</comment>
                            <comment id="16215499" author="githubbot" created="Mon, 23 Oct 2017 17:32:41 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146336120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146336120&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/execution/librarycache/FlinkUserCodeClassLoaders.java &amp;#8212;&lt;br/&gt;
    @@ -31,24 +31,23 @@&lt;br/&gt;
      */&lt;br/&gt;
     public class FlinkUserCodeClassLoaders {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static URLClassLoader parentFirst(URL[] urls) 
{
    -		return new ParentFirstClassLoader(urls);
    -	}
&lt;p&gt;    -&lt;br/&gt;
     	public static URLClassLoader parentFirst(URL[] urls, ClassLoader parent) &lt;/p&gt;
{
     		return new ParentFirstClassLoader(urls, parent);
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static URLClassLoader childFirst(URL[] urls, ClassLoader parent) {&lt;/li&gt;
	&lt;li&gt;return new ChildFirstClassLoader(urls, parent);&lt;br/&gt;
    +	public static URLClassLoader childFirst(&lt;br/&gt;
    +		URL[] urls,&lt;br/&gt;
    +		ClassLoader parent,&lt;br/&gt;
    +		String[] alwaysParentFirstPatterns) 
{
    +		return new ChildFirstClassLoader(urls, parent, alwaysParentFirstPatterns);
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	public static URLClassLoader create(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ResolveOrder resolveOrder, URL[] urls, ClassLoader parent) {&lt;br/&gt;
    +		ResolveOrder resolveOrder, URL[] urls, ClassLoader parent, String[] alwaysParentFirstPatterns) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Make this a vararg parameter for nice APIs during testing ?&lt;/p&gt;</comment>
                            <comment id="16215501" author="githubbot" created="Mon, 23 Oct 2017 17:34:48 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good fix, with minor comments.&lt;/p&gt;

&lt;p&gt;    I think we want to have even more default parent-first classes, because they leak through the public API.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`org.slf4j`&lt;/li&gt;
	&lt;li&gt;`javax.annotation`&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16216590" author="githubbot" created="Tue, 24 Oct 2017 09:17:48 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146499992&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146499992&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/monitoring/debugging_classloading.md &amp;#8212;&lt;br/&gt;
    @@ -57,22 +57,34 @@ YARN classloading differs between single job deployments and sessions:&lt;/p&gt;

&lt;p&gt;     *&lt;b&gt;Mesos&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;    -Mesos setups following &lt;span class=&quot;error&quot;&gt;&amp;#91;this documentation&amp;#93;&lt;/span&gt;(../ops/deployment/mesos.html) currently behave very much like the a &lt;br/&gt;
    +Mesos setups following &lt;span class=&quot;error&quot;&gt;&amp;#91;this documentation&amp;#93;&lt;/span&gt;(../ops/deployment/mesos.html) currently behave very much like the a&lt;br/&gt;
     YARN session: The TaskManager and JobManager processes are started with the Flink framework classes in classpath, job&lt;br/&gt;
     classes are loaded dynamically when the jobs are submitted.&lt;/p&gt;

&lt;p&gt;    +## Configuring ClassLoader Resolution Order&lt;br/&gt;
    +&lt;br/&gt;
    +Flink uses a hierarchy of ClassLoaders for loading classes from the user-code jar(s). The user-code&lt;br/&gt;
    +ClassLoader has a reference to the parent ClassLoader, which is the default Java ClassLoader in most&lt;br/&gt;
    +cases. By default, Java ClassLoaders will first look for classes in the parent ClassLoader and then in&lt;br/&gt;
    +the child ClassLoader for cases where we have a hierarchy of ClassLoaders. This is problematic if you&lt;br/&gt;
    +have in your user jar a version of a library that conflicts with a version that comes with Flink. You can&lt;br/&gt;
    +change this behaviour by configuring the ClassLoader resolution order via&lt;br/&gt;
    +`classloader.resolve-order: child-first` in the Flink config. However, Flink classes will still&lt;br/&gt;
    +be resolved through the parent ClassLoader first, altough you can also configure this via&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    fixing&lt;/p&gt;</comment>
                            <comment id="16216591" author="githubbot" created="Tue, 24 Oct 2017 09:18:04 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146500066&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146500066&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/ops/config.md &amp;#8212;&lt;br/&gt;
    @@ -77,6 +77,10 @@ without explicit scheme definition, such as `/user/USERNAME/in.txt`, is going to&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`classloader.resolve-order`: Whether Flink should use a child-first `ClassLoader` when loading&lt;br/&gt;
     user-code classes or a parent-first `ClassLoader`. Can be one of `parent-first` or `child-first`. (default: `child-first`)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +- `classloader.always-parent-first-patterns`: A (comma-separated) list of patterns that specifies which classes should always be resolved&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    simple prefix, changing doc &#128077; &lt;/p&gt;</comment>
                            <comment id="16216592" author="githubbot" created="Tue, 24 Oct 2017 09:18:20 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146500129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146500129&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/monitoring/debugging_classloading.md &amp;#8212;&lt;br/&gt;
    @@ -57,22 +57,34 @@ YARN classloading differs between single job deployments and sessions:&lt;/p&gt;

&lt;p&gt;     *&lt;b&gt;Mesos&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;    -Mesos setups following &lt;span class=&quot;error&quot;&gt;&amp;#91;this documentation&amp;#93;&lt;/span&gt;(../ops/deployment/mesos.html) currently behave very much like the a &lt;br/&gt;
    +Mesos setups following &lt;span class=&quot;error&quot;&gt;&amp;#91;this documentation&amp;#93;&lt;/span&gt;(../ops/deployment/mesos.html) currently behave very much like the a&lt;br/&gt;
     YARN session: The TaskManager and JobManager processes are started with the Flink framework classes in classpath, job&lt;br/&gt;
     classes are loaded dynamically when the jobs are submitted.&lt;/p&gt;

&lt;p&gt;    +## Configuring ClassLoader Resolution Order&lt;br/&gt;
    +&lt;br/&gt;
    +Flink uses a hierarchy of ClassLoaders for loading classes from the user-code jar(s). The user-code&lt;br/&gt;
    +ClassLoader has a reference to the parent ClassLoader, which is the default Java ClassLoader in most&lt;br/&gt;
    +cases. By default, Java ClassLoaders will first look for classes in the parent ClassLoader and then in&lt;br/&gt;
    +the child ClassLoader for cases where we have a hierarchy of ClassLoaders. This is problematic if you&lt;br/&gt;
    +have in your user jar a version of a library that conflicts with a version that comes with Flink. You can&lt;br/&gt;
    +change this behaviour by configuring the ClassLoader resolution order via&lt;br/&gt;
    +`classloader.resolve-order: child-first` in the Flink config. However, Flink classes will still&lt;br/&gt;
    +be resolved through the parent ClassLoader first, altough you can also configure this via&lt;br/&gt;
    +`classloader.always-parent-first-patterns`, which is `org.apache.flink`, by default.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Fixing, I&apos;m very open to suggestions here because I don&apos;t like the name much.&lt;/p&gt;</comment>
                            <comment id="16216593" author="githubbot" created="Tue, 24 Oct 2017 09:20:21 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146500656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146500656&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/execution/librarycache/FlinkUserCodeClassLoaders.java &amp;#8212;&lt;br/&gt;
    @@ -31,24 +31,23 @@&lt;br/&gt;
      */&lt;br/&gt;
     public class FlinkUserCodeClassLoaders {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static URLClassLoader parentFirst(URL[] urls) 
{
    -		return new ParentFirstClassLoader(urls);
    -	}
&lt;p&gt;    -&lt;br/&gt;
     	public static URLClassLoader parentFirst(URL[] urls, ClassLoader parent) &lt;/p&gt;
{
     		return new ParentFirstClassLoader(urls, parent);
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static URLClassLoader childFirst(URL[] urls, ClassLoader parent) {&lt;/li&gt;
	&lt;li&gt;return new ChildFirstClassLoader(urls, parent);&lt;br/&gt;
    +	public static URLClassLoader childFirst(&lt;br/&gt;
    +		URL[] urls,&lt;br/&gt;
    +		ClassLoader parent,&lt;br/&gt;
    +		String[] alwaysParentFirstPatterns) 
{
    +		return new ChildFirstClassLoader(urls, parent, alwaysParentFirstPatterns);
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	public static URLClassLoader create(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ResolveOrder resolveOrder, URL[] urls, ClassLoader parent) {&lt;br/&gt;
    +		ResolveOrder resolveOrder, URL[] urls, ClassLoader parent, String[] alwaysParentFirstPatterns) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I specifically didn&apos;t make it a vararg parameter to ensure that all call-sites consciously have to deal with this parameter. Making it a varargs makes it easy to forget that you can/should set this.&lt;/p&gt;

&lt;p&gt;    What do you think? I can still easily make it a vararg.&lt;/p&gt;</comment>
                            <comment id="16216600" author="githubbot" created="Tue, 24 Oct 2017 09:25:51 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the reviews, @zentol and @StephanEwen?&lt;/p&gt;

&lt;p&gt;    @StephanEwen Regarding your last two comments, it would be nice if the `ConfigOption` itself did the parsing, i.e. if I could have a `ConfigOption&amp;lt;String, String[]&amp;gt;` or some such that parses a string to a list of strings and deals with all exceptions. Same would be true for the resolve order, where I would like to have `ConfigOption&amp;lt;String, ResolveOrder&amp;gt;` and it internally does the enum parsing. As it is now I have to do the parsing and exception handling in all places where the config is used. What do you think?&lt;/p&gt;

&lt;p&gt;    Regarding the list of parent-first patterns, `javax.annotation` I can see, but where do loggers bleed through the API?&lt;/p&gt;</comment>
                            <comment id="16216608" author="githubbot" created="Tue, 24 Oct 2017 09:32:45 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146503853&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146503853&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/JobManagerServices.java &amp;#8212;&lt;br/&gt;
    @@ -116,8 +116,15 @@ public static JobManagerServices fromConfiguration(&lt;br/&gt;
     		final String classLoaderResolveOrder =&lt;br/&gt;
     			config.getString(CoreOptions.CLASSLOADER_RESOLVE_ORDER);&lt;/p&gt;

&lt;p&gt;    +		final String alwaysParentFirstLoaderString =&lt;br/&gt;
    +			config.getString(CoreOptions.ALWAYS_PARENT_FIRST_LOADER);&lt;br/&gt;
    +		final String[] alwaysParentFirstLoaderPatterns = alwaysParentFirstLoaderString.split(&quot;,&quot;);&lt;br/&gt;
    +&lt;br/&gt;
     		final BlobLibraryCacheManager libraryCacheManager =&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new BlobLibraryCacheManager(blobServer, FlinkUserCodeClassLoaders.ResolveOrder.fromString(classLoaderResolveOrder));&lt;br/&gt;
    +			new BlobLibraryCacheManager(&lt;br/&gt;
    +				blobServer,&lt;br/&gt;
    +				FlinkUserCodeClassLoaders.ResolveOrder.fromString(classLoaderResolveOrder),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This will fail with `IllegalArgumentException(&quot;Unknown resolve order: &quot; + resolveOrder)`.&lt;/p&gt;</comment>
                            <comment id="16216612" author="githubbot" created="Tue, 24 Oct 2017 09:36:23 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146504815&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146504815&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/JobManagerServices.java &amp;#8212;&lt;br/&gt;
    @@ -116,8 +116,15 @@ public static JobManagerServices fromConfiguration(&lt;br/&gt;
     		final String classLoaderResolveOrder =&lt;br/&gt;
     			config.getString(CoreOptions.CLASSLOADER_RESOLVE_ORDER);&lt;/p&gt;

&lt;p&gt;    +		final String alwaysParentFirstLoaderString =&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The parameter cannot be `null`, since there is a default value. If it is empty, won&apos;t `split` simply return an empty array?&lt;/p&gt;

&lt;p&gt;    I made a comment about this below, i.e. where we should handle parsing of config options.&lt;/p&gt;</comment>
                            <comment id="16216702" author="githubbot" created="Tue, 24 Oct 2017 11:00:00 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @aljoscha I&apos;ve suggested non-primitive/string ConfigOptions in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6577&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-6577&lt;/a&gt;, along with moving the validation into the ConfigOptions in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6576&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-6576&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16216806" author="githubbot" created="Tue, 24 Oct 2017 12:26:28 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol That would be excellent to have!&lt;/p&gt;</comment>
                            <comment id="16216963" author="githubbot" created="Tue, 24 Oct 2017 14:14:39 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146573602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146573602&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/execution/librarycache/FlinkUserCodeClassLoaders.java &amp;#8212;&lt;br/&gt;
    @@ -31,24 +31,23 @@&lt;br/&gt;
      */&lt;br/&gt;
     public class FlinkUserCodeClassLoaders {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static URLClassLoader parentFirst(URL[] urls) 
{
    -		return new ParentFirstClassLoader(urls);
    -	}
&lt;p&gt;    -&lt;br/&gt;
     	public static URLClassLoader parentFirst(URL[] urls, ClassLoader parent) &lt;/p&gt;
{
     		return new ParentFirstClassLoader(urls, parent);
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static URLClassLoader childFirst(URL[] urls, ClassLoader parent) {&lt;/li&gt;
	&lt;li&gt;return new ChildFirstClassLoader(urls, parent);&lt;br/&gt;
    +	public static URLClassLoader childFirst(&lt;br/&gt;
    +		URL[] urls,&lt;br/&gt;
    +		ClassLoader parent,&lt;br/&gt;
    +		String[] alwaysParentFirstPatterns) 
{
    +		return new ChildFirstClassLoader(urls, parent, alwaysParentFirstPatterns);
     	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	public static URLClassLoader create(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ResolveOrder resolveOrder, URL[] urls, ClassLoader parent) {&lt;br/&gt;
    +		ResolveOrder resolveOrder, URL[] urls, ClassLoader parent, String[] alwaysParentFirstPatterns) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    No, I see your argument. Keep it.&lt;/p&gt;</comment>
                            <comment id="16216966" author="githubbot" created="Tue, 24 Oct 2017 14:15:07 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891#discussion_r146573737&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891#discussion_r146573737&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/jobmaster/JobManagerServices.java &amp;#8212;&lt;br/&gt;
    @@ -116,8 +116,15 @@ public static JobManagerServices fromConfiguration(&lt;br/&gt;
     		final String classLoaderResolveOrder =&lt;br/&gt;
     			config.getString(CoreOptions.CLASSLOADER_RESOLVE_ORDER);&lt;/p&gt;

&lt;p&gt;    +		final String alwaysParentFirstLoaderString =&lt;br/&gt;
    +			config.getString(CoreOptions.ALWAYS_PARENT_FIRST_LOADER);&lt;br/&gt;
    +		final String[] alwaysParentFirstLoaderPatterns = alwaysParentFirstLoaderString.split(&quot;,&quot;);&lt;br/&gt;
    +&lt;br/&gt;
     		final BlobLibraryCacheManager libraryCacheManager =&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new BlobLibraryCacheManager(blobServer, FlinkUserCodeClassLoaders.ResolveOrder.fromString(classLoaderResolveOrder));&lt;br/&gt;
    +			new BlobLibraryCacheManager(&lt;br/&gt;
    +				blobServer,&lt;br/&gt;
    +				FlinkUserCodeClassLoaders.ResolveOrder.fromString(classLoaderResolveOrder),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Okay, that works.&lt;/p&gt;</comment>
                            <comment id="16216987" author="githubbot" created="Tue, 24 Oct 2017 14:24:24 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Concerning loggers: I think for logging frameworks, they should rarely bleed through, but if you instantiate multiple ones, you get problems. It is more serious for the logging backend (where having multiple ones may mean logging does not happen at all or get at least crazy warnings), but preventing duplication in the logging frontend cannot hurt I believe.&lt;/p&gt;

&lt;p&gt;    Regarding non-primitive config options: Nice idea, but I would suggest to do it without for now, because it does not seem crucial enough for me to slow down a release for that.&lt;/p&gt;

&lt;p&gt;    How about configuring the default parent first options as:&lt;br/&gt;
    `java.;org.apache.flink.;javax.annotation;org.slf4j;org.apache.log4j;org.apache.logging.log4j;ch.qos.logback`&lt;/p&gt;</comment>
                            <comment id="16216992" author="githubbot" created="Tue, 24 Oct 2017 14:27:03 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, I wasn&apos;t expecting to do that for the release. &#128517;&lt;/p&gt;

&lt;p&gt;    The defaults make sense, I&apos;ll push a fixup commit.&lt;/p&gt;</comment>
                            <comment id="16217268" author="githubbot" created="Tue, 24 Oct 2017 17:03:31 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good to me, +1&lt;/p&gt;

&lt;p&gt;    When we start introducing even more config options for class loading, it makes sense to introduce a class to bundle those up (like resolve order, parent first patterns, and future strings and arrays).&lt;/p&gt;</comment>
                            <comment id="16218668" author="aljoscha" created="Wed, 25 Oct 2017 13:58:04 +0000"  >&lt;p&gt;Fixed via 2d88ab85ba8ff1f2e920e8a142c9b702c7f1e6da&lt;/p&gt;</comment>
                            <comment id="16218670" author="githubbot" created="Wed, 25 Oct 2017 13:58:24 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merged&lt;/p&gt;</comment>
                            <comment id="16218671" author="githubbot" created="Wed, 25 Oct 2017 13:58:24 +0000"  >&lt;p&gt;Github user aljoscha closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4891&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4891&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3kelz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>