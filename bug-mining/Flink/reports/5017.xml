<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19771] NullPointerException when accessing null array from postgres in JDBC Connector</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19771</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When trying to utilize the JDBC Connector for Postgres, I tried to read in a text array. When a row that was null was attempted to be read in, the connector threw an exception and execution stopped. It appears looking at the source code that if the row is null that it will still attempt to grab the contents out:&#160;&lt;a href=&quot;https://github.com/apache/flink/blob/release-1.11.2/flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/internal/converter/PostgresRowConverter.java#L97&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/release-1.11.2/flink-connectors/flink-connector-jdbc/src/main/java/org/apache/flink/connector/jdbc/internal/converter/PostgresRowConverter.java#L97&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The stack trace is as follows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[error] Caused by: java.io.IOException: Couldn&apos;t access resultSet
[error] &#160; at org.apache.flink.connector.jdbc.table.JdbcRowDataInputFormat.nextRecord(JdbcRowDataInputFormat.java:266)
[error] &#160; at org.apache.flink.connector.jdbc.table.JdbcRowDataInputFormat.nextRecord(JdbcRowDataInputFormat.java:57)
[error] &#160; at org.apache.flink.streaming.api.functions.source.InputFormatSourceFunction.run(InputFormatSourceFunction.java:91)
[error] &#160; at org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:100)
[error] &#160; at org.apache.flink.streaming.api.operators.StreamSource.run(StreamSource.java:63)
[error] &#160; at org.apache.flink.streaming.runtime.tasks.SourceStreamTask$LegacySourceFunctionThread.run(SourceStreamTask.java:213)
[error] Caused by: java.lang.NullPointerException
[error] &#160; at org.apache.flink.connector.jdbc.internal.converter.PostgresRowConverter.lambda$createPostgresArrayConverter$c06ce9f4$2(PostgresRowConverter.java:97)
[error] &#160; at org.apache.flink.connector.jdbc.internal.converter.AbstractJdbcRowConverter.toInternal(AbstractJdbcRowConverter.java:79)
[error] &#160; at org.apache.flink.connector.jdbc.table.JdbcRowDataInputFormat.nextRecord(JdbcRowDataInputFormat.java:259)
[error] &#160; ... 5 more &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13336732">FLINK-19771</key>
            <summary>NullPointerException when accessing null array from postgres in JDBC Connector</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dforciea">Dylan Forciea</assignee>
                                    <reporter username="dforciea">Dylan Forciea</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 22 Oct 2020 13:51:59 +0000</created>
                <updated>Fri, 28 May 2021 07:12:27 +0000</updated>
                            <resolved>Fri, 22 Jan 2021 09:56:30 +0000</resolved>
                                    <version>1.11.2</version>
                                    <fixVersion>1.11.4</fixVersion>
                    <fixVersion>1.12.2</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Connectors / JDBC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17219678" author="nicholasjiang" created="Fri, 23 Oct 2020 13:31:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dforciea&quot; class=&quot;user-hover&quot; rel=&quot;dforciea&quot;&gt;dforciea&lt;/a&gt;, IMO, PostgresRowConverter#createPostgresArrayConverter doesn&apos;t check whether the pgArray is null. If pgArray is null, the converter should return null. Therefore, createPostgresArrayConverter should the check whether the pgArray is null.&lt;br/&gt;
cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17219708" author="jark" created="Fri, 23 Oct 2020 14:17:18 +0000"  >&lt;p&gt;I think &lt;tt&gt;PostgresRowConverter&lt;/tt&gt; should override &lt;tt&gt;AbstractJdbcRowConverter#createInternalConverter&lt;/tt&gt; instead of &lt;tt&gt;createNullableInternalConverter&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17219728" author="dforciea" created="Fri, 23 Oct 2020 14:44:44 +0000"  >&lt;p&gt;I wouldn&apos;t mind taking this one on... but I would have a question about adding unit tests for this bug. Digging in, I don&apos;t see anything that directly tests out the &lt;tt&gt;PostgresRowConverter&lt;/tt&gt;. It looks like the existing tests only test the dialect itself, and otherwise just uses Derby.&lt;/p&gt;

&lt;p&gt;Should a unit test for &lt;tt&gt;PostgresRowConverter&lt;/tt&gt; be added? Or did I miss seeing an end to end test that spins up a postgres container to perform validation?&lt;/p&gt;</comment>
                            <comment id="17220418" author="dforciea" created="Mon, 26 Oct 2020 00:06:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nicholasjiang&quot; class=&quot;user-hover&quot; rel=&quot;nicholasjiang&quot;&gt;nicholasjiang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I created a branch with the fix as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;described in his comment, and I also created some unit tests for the PostgresRowConverter that were missing. Let me know if you think this is a proper approach, and I&apos;ll gladly create a PR for this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/dforciea/flink/compare/master...dforciea:FLINK-19771&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dforciea/flink/compare/master...dforciea:FLINK-19771&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17220439" author="leonard xu" created="Mon, 26 Oct 2020 02:18:14 +0000"  >&lt;p&gt;Thanks&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dforciea&quot; class=&quot;user-hover&quot; rel=&quot;dforciea&quot;&gt;dforciea&lt;/a&gt;&#160;for reporting,&lt;/p&gt;

&lt;p&gt;I think we should override `createInternalConverter` and reuse null check in `createNullableInternalConverter`.&lt;/p&gt;



&lt;p&gt;The `DerbyRowConverter` and `MySQLRowConverter` have same logic and so use derby is enough, For `PostgresRowConverter`&#160; test,&#160; `PostgresCatalogITCase` cover it, I think we can add null array test in `PostgresCatalogITCase.testArrayTypes`.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17220450" author="dforciea" created="Mon, 26 Oct 2020 02:56:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard+Xu&quot; class=&quot;user-hover&quot; rel=&quot;Leonard Xu&quot;&gt;Leonard Xu&lt;/a&gt;&#160;Thank you for the pointer on where there are postgres-specific tests. I have updated my branch accordingly to accomplish what you&apos;ve described. Let me know if you want me to submit it as a PR.&lt;/p&gt;</comment>
                            <comment id="17220454" author="leonard xu" created="Mon, 26 Oct 2020 03:01:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dforciea&quot; class=&quot;user-hover&quot; rel=&quot;dforciea&quot;&gt;dforciea&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Your branch makes sense to me, I think you can submit a PR to fix this, thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17226937" author="dforciea" created="Thu, 5 Nov 2020 19:27:56 +0000"  >&lt;p&gt;Sorry, I think I had put in the wrong issue number on my commit message in the PR. That is now fixed, if that is holding this up.&lt;/p&gt;</comment>
                            <comment id="17270036" author="twalthr" created="Fri, 22 Jan 2021 09:56:30 +0000"  >&lt;p&gt;Fixed in 1.13.0: 2bbac78b9eaa812b113cfc34f57c14ef3a3c35bc&lt;br/&gt;
Fixed in 1.12.2: d11137ea1f68a0480ada713e65065c092b281e1e&lt;br/&gt;
Fixed in 1.11.4: 428c67369bb1863e0d5e67b7b197fbd73f140e42&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jx9k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>