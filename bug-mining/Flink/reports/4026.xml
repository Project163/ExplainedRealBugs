<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:45:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15841] TimeWindow.intersects return true for consecutive windows</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15841</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The TimeWindow JavaDoc explains that the start index is inclusive and the end index is exclusive, therefore two windows T0 to T1 and T1 to T2 are next to each other without overlapping.&lt;/p&gt;

&lt;p&gt;To fix this the intersects comparison should be changed to: &lt;tt&gt;this.start &amp;lt; other.end &amp;amp;&amp;amp; this.end &amp;gt; other.start&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Also a test should be added to verify the methods works correctly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13282778">FLINK-15841</key>
            <summary>TimeWindow.intersects return true for consecutive windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="joern">J&#246;rn Kottmann</assignee>
                                    <reporter username="joern">J&#246;rn Kottmann</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 1 Feb 2020 17:01:50 +0000</created>
                <updated>Tue, 13 Apr 2021 20:41:09 +0000</updated>
                            <resolved>Tue, 12 May 2020 14:32:20 +0000</resolved>
                                                    <fixVersion>1.11.0</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17028148" author="joern" created="Sat, 1 Feb 2020 17:02:45 +0000"  >&lt;p&gt;I would like to contribute a test case and the fix to TimeWindow.intersects.&lt;/p&gt;</comment>
                            <comment id="17028867" author="aljoscha" created="Mon, 3 Feb 2020 10:51:32 +0000"  >&lt;p&gt;Did you try and do the change and check if all the tests still pass. If the behaviour of &lt;tt&gt;intersect()&lt;/tt&gt; has been wrong for so long now, maybe some code relies on this quirk.&lt;/p&gt;</comment>
                            <comment id="17029216" author="joern" created="Mon, 3 Feb 2020 19:31:17 +0000"  >&lt;p&gt;Just tried it now, there are many test failures after the change.&lt;/p&gt;

&lt;p&gt;I could try to work through them. Is there an interest to get this fixed?&lt;/p&gt;</comment>
                            <comment id="17029628" author="aljoscha" created="Tue, 4 Feb 2020 08:05:16 +0000"  >&lt;p&gt;Which tests are failing? I will try and take a look.&lt;/p&gt;

&lt;p&gt;I think failing tests would indicate that we shouldn&apos;t change the behaviour now, even though it&apos;s wrong according to the Javadoc. Mostly because of what I mentioned above about things having been like this for so long.&lt;/p&gt;</comment>
                            <comment id="17029637" author="joern" created="Tue, 4 Feb 2020 08:25:38 +0000"  >&lt;p&gt;A new method with the correct behavior could be added and then intersects could be deprecated. Flink probably has also code which uses the method as specified in the JavaDoc.&lt;/p&gt;

&lt;p&gt;In flink-streaming-java these tests failed:&lt;br/&gt;
 {{&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Results:&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; &lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failures: &lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; StreamSourceOperatorWatermarksTest.testNoMaxWatermarkOnAsyncCancel:127&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; DynamicEventTimeSessionWindowsTest.testMergeConsecutiveWindows:121 &lt;br/&gt;
 Wanted but not invoked:&lt;br/&gt;
 mergeCallback.merge(&lt;br/&gt;
 iterable over [&amp;lt;TimeWindow&lt;/p&gt;

{start=0, end=1}
&lt;p&gt;&amp;gt;, &amp;lt;TimeWindow{start=1, end=2}&amp;gt;, &amp;lt;TimeWindow{start=2, end=3}&amp;gt;] in any order,&lt;br/&gt;
 TimeWindow{start=0, end=3}&lt;br/&gt;
 );&lt;br/&gt;
 -&amp;gt; at org.apache.flink.streaming.runtime.operators.windowing.DynamicEventTimeSessionWindowsTest.testMergeConsecutiveWindows(DynamicEventTimeSessionWindowsTest.java:121)&lt;br/&gt;
 Actually, there were zero interactions with this mock.&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; DynamicProcessingTimeSessionWindowsTest.testMergeConsecutiveWindows:126 &lt;br/&gt;
 Wanted but not invoked:&lt;br/&gt;
 mergeCallback.merge(&lt;br/&gt;
 iterable over [&amp;lt;TimeWindow{start=0, end=1}&lt;/p&gt;

&lt;p&gt;&amp;gt;, &amp;lt;TimeWindow&lt;/p&gt;

{start=1, end=2}
&lt;p&gt;&amp;gt;, &amp;lt;TimeWindow{start=2, end=3}&amp;gt;] in any order,&lt;br/&gt;
 TimeWindow{start=0, end=3}&lt;br/&gt;
 );&lt;br/&gt;
 -&amp;gt; at org.apache.flink.streaming.runtime.operators.windowing.DynamicProcessingTimeSessionWindowsTest.testMergeConsecutiveWindows(DynamicProcessingTimeSessionWindowsTest.java:126)&lt;br/&gt;
 Actually, there were zero interactions with this mock.&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; EventTimeSessionWindowsTest.testMergeConsecutiveWindows:114 &lt;br/&gt;
 Wanted but not invoked:&lt;br/&gt;
 mergeCallback.merge(&lt;br/&gt;
 iterable over [&amp;lt;TimeWindow{start=0, end=1}&amp;gt;, &amp;lt;TimeWindow{start=1, end=2}&lt;/p&gt;

&lt;p&gt;&amp;gt;, &amp;lt;TimeWindow&lt;/p&gt;

{start=2, end=3}
&lt;p&gt;&amp;gt;] in any order,&lt;br/&gt;
 TimeWindow{start=0, end=3}&lt;br/&gt;
 );&lt;br/&gt;
 -&amp;gt; at org.apache.flink.streaming.runtime.operators.windowing.EventTimeSessionWindowsTest.testMergeConsecutiveWindows(EventTimeSessionWindowsTest.java:114)&lt;br/&gt;
 Actually, there were zero interactions with this mock.&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; MergingWindowSetTest.testLateMerging:230 expected:&amp;lt;TimeWindow{start=5, end=13}&amp;gt; but was:&amp;lt;TimeWindow{start=8, end=10}&amp;gt;&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; ProcessingTimeSessionWindowsTest.testMergeConsecutiveWindows:118 &lt;br/&gt;
 Wanted but not invoked:&lt;br/&gt;
 mergeCallback.merge(&lt;br/&gt;
 iterable over [&amp;lt;TimeWindow{start=0, end=1}&amp;gt;, &amp;lt;TimeWindow{start=1, end=2}&amp;gt;, &amp;lt;TimeWindow{start=2, end=3}&lt;/p&gt;

&lt;p&gt;&amp;gt;] in any order,&lt;br/&gt;
 TimeWindow&lt;/p&gt;

{start=0, end=3}

&lt;p&gt;);&lt;br/&gt;
 -&amp;gt; at org.apache.flink.streaming.runtime.operators.windowing.ProcessingTimeSessionWindowsTest.testMergeConsecutiveWindows(ProcessingTimeSessionWindowsTest.java:118)&lt;br/&gt;
 Actually, there were zero interactions with this mock.&lt;br/&gt;
 }}&lt;/p&gt;</comment>
                            <comment id="17029922" author="aljoscha" created="Tue, 4 Feb 2020 15:04:34 +0000"  >&lt;p&gt;I think all code/tests expects the current behaviour, the expectation of the session/window merging code is that two windows that have zero gap, i.e. &lt;tt&gt;(t1, t2)&lt;/tt&gt; and &lt;tt&gt;(t2, t3)&lt;/tt&gt; will be merged because there is no gap in between. Therefore I think we shouldn&apos;t not (cannot) change the behaviour. We can extend the Javadoc of &lt;tt&gt;intersect()&lt;/tt&gt; to better describe the behaviour.&lt;/p&gt;

&lt;p&gt;The class-level Javadoc is still correct, in my opinion. Consider two windows &lt;tt&gt;w1 = (0, 2)&lt;/tt&gt; and &lt;tt&gt;w2 = (2, 4)&lt;/tt&gt;. They might have these elements in them:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// value, timestamp
&lt;/span&gt;0, 0&#160;&lt;span class=&quot;code-comment&quot;&gt;// in w1
&lt;/span&gt;1, 1 &lt;span class=&quot;code-comment&quot;&gt;// in w1
&lt;/span&gt;2, 2 &lt;span class=&quot;code-comment&quot;&gt;// in w2
&lt;/span&gt;3, 3 &lt;span class=&quot;code-comment&quot;&gt;// in w2&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I.e. &lt;tt&gt;w1&lt;/tt&gt; doesn&apos;t contain elements of timestamp &lt;tt&gt;2&lt;/tt&gt;, because the end is exclusive. Still, these are two windows that should be merged into one session, i.e. they should &quot;intersect&quot;.&lt;/p&gt;</comment>
                            <comment id="17030077" author="joern" created="Tue, 4 Feb 2020 19:24:50 +0000"  >&lt;p&gt;Happy to then contribute the addition to the Javadoc and it would probably still be good to add a test case for the current behavior.&lt;/p&gt;</comment>
                            <comment id="17030422" author="aljoscha" created="Wed, 5 Feb 2020 08:01:54 +0000"  >&lt;p&gt;Sure yes, that would be good.&#160;&#128076;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17105489" author="aljoscha" created="Tue, 12 May 2020 14:32:20 +0000"  >&lt;p&gt;master: b9eee7816dda4b29a7f4261a7f46106113388799&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0b2kw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>