<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4711] TaskManager can crash due to failing onPartitionStateUpdate call</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4711</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;TaskManager&lt;/tt&gt; can crash because it calls &lt;tt&gt;Task.onPartitionStateUpdate&lt;/tt&gt; when it receives a &lt;tt&gt;PartitionState&lt;/tt&gt; message. The &lt;tt&gt;onPartitionStateUpdate&lt;/tt&gt; method can throw an &lt;tt&gt;IOException&lt;/tt&gt; or &lt;tt&gt;InterruptedException&lt;/tt&gt; which are not handled on the &lt;tt&gt;TaskManager&lt;/tt&gt; level.&lt;/p&gt;

&lt;p&gt;Another problem is that the initial partition state request is triggered within the &lt;tt&gt;SingleInputGate&lt;/tt&gt;. The request causes the &lt;tt&gt;JobManager&lt;/tt&gt; to send a &lt;tt&gt;PartitionState&lt;/tt&gt; message to the &lt;tt&gt;TaskManager&lt;/tt&gt; which forwards it to the &lt;tt&gt;Task&lt;/tt&gt;. If the at any of these points a message gets lost, then it is not retried and the partition state remains unknown.&lt;/p&gt;

&lt;p&gt;In order to handle the exceptions, to make the data flow clearer and to add automatic retries, I propose to let the &lt;tt&gt;Task&lt;/tt&gt; send the partition state check requests. Furthermore, the &lt;tt&gt;JobManager&lt;/tt&gt; should directly answer to the &lt;tt&gt;Task&lt;/tt&gt; by replying to an ask operation. That way the message does not have to be routed through the &lt;tt&gt;TaskManager&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13008552">FLINK-4711</key>
            <summary>TaskManager can crash due to failing onPartitionStateUpdate call</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Sep 2016 14:34:46 +0000</created>
                <updated>Fri, 30 Sep 2016 07:09:02 +0000</updated>
                            <resolved>Fri, 30 Sep 2016 07:08:32 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15532964" author="githubbot" created="Thu, 29 Sep 2016 14:42:28 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4711&quot; title=&quot;TaskManager can crash due to failing onPartitionStateUpdate call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4711&quot;&gt;&lt;del&gt;FLINK-4711&lt;/del&gt;&lt;/a&gt; Let the Task trigger partition state requests and handle their responses&lt;/p&gt;

&lt;p&gt;    This PR makes changes the partition state check in a way that the Task is now responsible&lt;br/&gt;
    for triggering the state check instead of the SingleInputGate. Furthermore, the operation&lt;br/&gt;
    returns a future containing the JobManager&apos;s answer. That way we don&apos;t have to route the&lt;br/&gt;
    response through the TaskManager and can add automatic retries in case of a timeout.&lt;/p&gt;

&lt;p&gt;    The PR removes the JobManagerCommunicationFactory and gets rid of the excessive&lt;br/&gt;
    PartitionStateChecker and ResultPartitionConsumableNotifier creation. Instead of creating&lt;br/&gt;
    for each SingleInputGate one PartitionStateChecker we create one for the TaskManager which&lt;br/&gt;
    is reused across all SingleInputGates. The same applies to the&lt;br/&gt;
    ResultPartitionConsumableNotifier.&lt;/p&gt;

&lt;p&gt;    This PR is also a simplification for the Flip-6 implementation.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixOnUpdatePartitionState&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2569&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit eefd4ee31633656d134078503a60f43e14806311&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-09-29T14:19:30Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4711&quot; title=&quot;TaskManager can crash due to failing onPartitionStateUpdate call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4711&quot;&gt;&lt;del&gt;FLINK-4711&lt;/del&gt;&lt;/a&gt; Let the Task trigger partition state requests and handle their responses&lt;/p&gt;

&lt;p&gt;    This PR makes changes the partition state check in a way that the Task is now responsible&lt;br/&gt;
    for triggering the state check instead of the SingleInputGate. Furthermore, the operation&lt;br/&gt;
    returns a future containing the JobManager&apos;s answer. That way we don&apos;t have to route the&lt;br/&gt;
    response through the TaskManager and can add automatic retries in case of a timeout.&lt;/p&gt;

&lt;p&gt;    The PR removes the JobManagerCommunicationFactory and gets rid of the excessive&lt;br/&gt;
    PartitionStateChecker and ResultPartitionConsumableNotifier creation. Instead of creating&lt;br/&gt;
    for each SingleInputGate one PartitionStateChecker we create one for the TaskManager which&lt;br/&gt;
    is reused across all SingleInputGates. The same applies to the&lt;br/&gt;
    ResultPartitionConsumableNotifier.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15533098" author="githubbot" created="Thu, 29 Sep 2016 15:32:18 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569#discussion_r81162283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569#discussion_r81162283&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/JobManagerCommunicationFactory.java &amp;#8212;&lt;br/&gt;
    @@ -27,15 +26,6 @@&lt;br/&gt;
     public interface JobManagerCommunicationFactory {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This has been become obsolete with your change and is unused. Let&apos;s remove it completely?&lt;/p&gt;</comment>
                            <comment id="15533099" author="githubbot" created="Thu, 29 Sep 2016 15:32:18 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569#discussion_r81164326&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569#discussion_r81164326&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/messages/TaskControlMessages.scala &amp;#8212;&lt;br/&gt;
    @@ -92,16 +92,6 @@ object TaskMessages {&lt;br/&gt;
       // --------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;       /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Answer to a [&lt;span class=&quot;error&quot;&gt;&amp;#91;RequestPartitionState&amp;#93;&lt;/span&gt;] with the state of the respective partition.&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;case class PartitionState(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Has some unused imports after removal that we could remove before merging&lt;/p&gt;</comment>
                            <comment id="15533100" author="githubbot" created="Thu, 29 Sep 2016 15:32:18 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569#discussion_r81164597&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569#discussion_r81164597&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -873,8 +873,7 @@ class JobManager(&lt;br/&gt;
           }&lt;/p&gt;

&lt;p&gt;           sender ! decorateMessage(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;PartitionState(&lt;/li&gt;
	&lt;li&gt;taskExecutionId,&lt;br/&gt;
    +        new org.apache.flink.runtime.io.network.PartitionState(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think it&apos;s not ambiguous anymore after removal of the TaskControlMessage and we can directly use `PartitionState`?&lt;/p&gt;</comment>
                            <comment id="15533192" author="githubbot" created="Thu, 29 Sep 2016 16:07:58 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569#discussion_r81173481&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569#discussion_r81173481&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/JobManagerCommunicationFactory.java &amp;#8212;&lt;br/&gt;
    @@ -27,15 +26,6 @@&lt;br/&gt;
     public interface JobManagerCommunicationFactory {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Good catch. Will remove it.&lt;/p&gt;</comment>
                            <comment id="15533193" author="githubbot" created="Thu, 29 Sep 2016 16:08:21 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569#discussion_r81173562&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569#discussion_r81173562&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/messages/TaskControlMessages.scala &amp;#8212;&lt;br/&gt;
    @@ -92,16 +92,6 @@ object TaskMessages {&lt;br/&gt;
       // --------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;       /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Answer to a [&lt;span class=&quot;error&quot;&gt;&amp;#91;RequestPartitionState&amp;#93;&lt;/span&gt;] with the state of the respective partition.&lt;/li&gt;
	&lt;li&gt;*/&lt;/li&gt;
	&lt;li&gt;case class PartitionState(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes that is also true. Will fix it.&lt;/p&gt;</comment>
                            <comment id="15533194" author="githubbot" created="Thu, 29 Sep 2016 16:08:34 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569#discussion_r81173599&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569#discussion_r81173599&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -873,8 +873,7 @@ class JobManager(&lt;br/&gt;
           }&lt;/p&gt;

&lt;p&gt;           sender ! decorateMessage(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;PartitionState(&lt;/li&gt;
	&lt;li&gt;taskExecutionId,&lt;br/&gt;
    +        new org.apache.flink.runtime.io.network.PartitionState(
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes that&apos;s true. Will fix it.&lt;/p&gt;</comment>
                            <comment id="15533215" author="githubbot" created="Thu, 29 Sep 2016 16:13:48 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @uce. If Travis gives green light, I&apos;ll merge the PR.&lt;/p&gt;</comment>
                            <comment id="15535256" author="githubbot" created="Fri, 30 Sep 2016 07:05:54 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Travis passed locally. Will merge the PR.&lt;/p&gt;</comment>
                            <comment id="15535261" author="till.rohrmann" created="Fri, 30 Sep 2016 07:08:33 +0000"  >&lt;p&gt;Fixed via 477d1c5d4ca6f469b3c87bc1f7962ece805cae1d&lt;/p&gt;</comment>
                            <comment id="15535263" author="githubbot" created="Fri, 30 Sep 2016 07:09:02 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2569&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i348w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>