<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:51:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20221] DelimitedInputFormat does not restore compressed filesplits correctly leading to dataloss</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20221</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;It seems that the delimited input format cannot correctly restore input splits if they belong to compressed files. Basically when a compressed filesplit is restored in the middle, it won&apos;t read it anymore leading to dataloss.&lt;/p&gt;

&lt;p&gt;The cause of the problem is that for compressed splits that use an inflater stream, the splitlength is set to the magic number -1 which is ignored in the reopen method and causes the split to go to `end` state immediately.&lt;/p&gt;

&lt;p&gt;The problem and the fix is shown in this commit:&lt;br/&gt;
&lt;a href=&quot;https://github.com/gyfora/flink/commit/4adc8ba8d1989fff2db43881c9cb3799848c6e0d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/gyfora/flink/commit/4adc8ba8d1989fff2db43881c9cb3799848c6e0d&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13341337">FLINK-20221</key>
            <summary>DelimitedInputFormat does not restore compressed filesplits correctly leading to dataloss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gyfora">Gyula Fora</assignee>
                                    <reporter username="gyfora">Gyula Fora</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 18 Nov 2020 13:32:00 +0000</created>
                <updated>Tue, 8 Dec 2020 11:36:19 +0000</updated>
                            <resolved>Tue, 8 Dec 2020 11:36:18 +0000</resolved>
                                    <version>1.10.2</version>
                    <version>1.11.2</version>
                    <version>1.12.0</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.1</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Connectors / FileSystem</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17235133" author="xintongsong" created="Thu, 19 Nov 2020 02:38:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gyfora&quot; class=&quot;user-hover&quot; rel=&quot;gyfora&quot;&gt;gyfora&lt;/a&gt;, thanks for reporting the issue.&lt;/p&gt;

&lt;p&gt;I&apos;m not familiar with the problem, and may have not fully understand the problem. However, I think any issue that may lead to data loss should be considered as a release blocker.&lt;/p&gt;

&lt;p&gt;Tagged the fix versions so that this issue shows in the release kanban boards.&lt;/p&gt;</comment>
                            <comment id="17235955" author="rmetzger" created="Fri, 20 Nov 2020 07:30:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gyfora&quot; class=&quot;user-hover&quot; rel=&quot;gyfora&quot;&gt;gyfora&lt;/a&gt; What&apos;s the plan with merging this? do you want to create a PR for the change?&lt;/p&gt;

&lt;p&gt;it would be nice to include this into the next release candidate for 1.12.0 which I would like to create on Monday&lt;/p&gt;</comment>
                            <comment id="17235988" author="gyfora" created="Fri, 20 Nov 2020 08:25:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;&#160;, I would like to open a PR but first I think I need some feedback from someone who understands the internals of these input formats more in detail.&#160;&lt;/p&gt;

&lt;p&gt;Turns out this is not a super straightforward change as the current behaviour of `reopen` calls `open` which causes some problems as the open method already start reading the stream which would trigger a backwards seek in the reopen in many cases. Backwards seek is however not supported on the wrapper inflater input streams used for compressed files.&lt;/p&gt;

&lt;p&gt;So maybe we have to change reopen so as to not call open (or maybe only call it if we checkpointed the state before we started reading the split, not even sure if this is possible).&#160;&lt;/p&gt;

&lt;p&gt;In any case changing the reopen this way would cause problems in the hierarchy as other subclasses like CsvInputFormat rely on the open method being always called (even on restore).&#160;&lt;/p&gt;

&lt;p&gt;I am not super eager to push some last minute change that will break this completely &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17236085" author="rmetzger" created="Fri, 20 Nov 2020 11:30:16 +0000"  >&lt;p&gt;Thanks a lot for your comment. I agree that we should not rush things last minute.&lt;br/&gt;
Let&apos;s include this fix on a best effort basis into the release. Since the issue has been around for a while, we can also include a fix in the next bugfix release (which usually comes quite soon after the .0 release).&lt;/p&gt;</comment>
                            <comment id="17237072" author="xintongsong" created="Mon, 23 Nov 2020 02:50:19 +0000"  >&lt;p&gt;Given that the fix for this issue requires quite many changes and may come up with a risk breaking other things,&#160;I&apos;m also good with fixing it on a best effort basis and deferring to the next bugfix release if necessary.&lt;/p&gt;

&lt;p&gt;Then shall we downgrading it to `Critical`?&#160;&lt;/p&gt;</comment>
                            <comment id="17237161" author="dian.fu" created="Mon, 23 Nov 2020 07:24:54 +0000"  >&lt;p&gt;I&apos;m also in favor of downgrading the priority to Critical and trying to fix this issue on a best effort basis.&lt;/p&gt;</comment>
                            <comment id="17237172" author="dian.fu" created="Mon, 23 Nov 2020 07:50:35 +0000"  >&lt;p&gt;I have downgraded this issue to Critical. Feel free to set it back if anyone feels that this should be a blocker issue.&lt;/p&gt;</comment>
                            <comment id="17242301" author="gyfora" created="Wed, 2 Dec 2020 12:16:07 +0000"  >&lt;p&gt;master:&#160;02f16958346483d91cd59cb902e0cce63fa5875f&lt;/p&gt;</comment>
                            <comment id="17242543" author="gyfora" created="Wed, 2 Dec 2020 17:22:19 +0000"  >&lt;p&gt;release-1.12:&#160;b82a3dc3939bcf4fa5e6f398eafb7d0e92bf62c7&lt;br/&gt;
release-1.11:&#160;edf59d73631b3108149c3a97172253f6706c32fe&lt;/p&gt;</comment>
                            <comment id="17245821" author="twalthr" created="Tue, 8 Dec 2020 11:15:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gyfora&quot; class=&quot;user-hover&quot; rel=&quot;gyfora&quot;&gt;gyfora&lt;/a&gt; can we close this issue or are you planning to also fix it for 1.10?&lt;/p&gt;</comment>
                            <comment id="17245825" author="gyfora" created="Tue, 8 Dec 2020 11:23:31 +0000"  >&lt;p&gt;Do you think we should also backport this to 1.10? I feel that there is not much use for that&lt;/p&gt;</comment>
                            <comment id="17245835" author="twalthr" created="Tue, 8 Dec 2020 11:36:10 +0000"  >&lt;p&gt;We can still do it later, if there is a need for it. I will close this issue now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0kpo0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>