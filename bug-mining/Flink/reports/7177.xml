<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-25447] batch query cannot generate plan when a sorted view into multi sinks</title>
                <link>https://issues.apache.org/jira/browse/FLINK-25447</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A batch query  write a sorted view into multi sinks will get a cannot plan exception&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Test
  def testSortedResultIntoMultiSinks(): Unit = {
    util.tableEnv.executeSql(
      s&quot;&quot;&quot;
         |CREATE TABLE Src (
         |  `a` INT,
         |  `b` BIGINT,
         |  `c` STRING,
         |  `d` STRING,
         |  `e` STRING
         |) WITH (
         |  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;values&apos;&lt;/span&gt;,
         |  &lt;span class=&quot;code-quote&quot;&gt;&apos;bounded&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;
         |)
       &quot;&quot;&quot;.stripMargin)
    val query = &lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM Src order by c&quot;&lt;/span&gt;
    val table = util.tableEnv.sqlQuery(query)
    util.tableEnv.registerTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;sortedTable&quot;&lt;/span&gt;, table)
    util.tableEnv.executeSql(
      s&quot;&quot;&quot;
         |CREATE TABLE sink1 (
         |  `a` INT,
         |  `b` BIGINT,
         |  `c` STRING
         |) WITH (
         |  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;filesystem&apos;&lt;/span&gt;,
         |  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;testcsv&apos;&lt;/span&gt;,
         |  &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/test&apos;&lt;/span&gt;
         |)
       &quot;&quot;&quot;.stripMargin)
    util.tableEnv.executeSql(
      s&quot;&quot;&quot;
         |CREATE TABLE sink2 (
         |  `a` INT,
         |  `b` BIGINT,
         |  `c` STRING,
         |  `d` STRING
         |) WITH (
         |  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;filesystem&apos;&lt;/span&gt;,
         |  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;testcsv&apos;&lt;/span&gt;,
         |  &lt;span class=&quot;code-quote&quot;&gt;&apos;path&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;/tmp/test&apos;&lt;/span&gt;
         |)
      &quot;&quot;&quot;.stripMargin)
    val stmtSet= util.tableEnv.createStatementSet()
    stmtSet.addInsertSql(
      &lt;span class=&quot;code-quote&quot;&gt;&quot;insert into sink1 select a, b, listagg(d) from sortedTable group by a, b&quot;&lt;/span&gt;)
    stmtSet.addInsertSql(
      &lt;span class=&quot;code-quote&quot;&gt;&quot;insert into sink2 select a, b, c, d from sortedTable&quot;&lt;/span&gt;)

    util.verifyExecPlan(stmtSet)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  org.apache.flink.table.api.TableException: Cannot generate a valid execution plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the given query: 

  LogicalSink(table=[default_catalog.default_database.sink2], fields=[a, b, c, d])
  +- LogicalProject(inputs=[0..3])
     +- LogicalTableScan(table=[[IntermediateRelTable_0]])

  This exception indicates that the query uses an unsupported SQL feature.
  Please check the documentation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the set of currently supported SQL features.

  	at org.apache.flink.table.planner.plan.optimize.program.FlinkVolcanoProgram.optimize(FlinkVolcanoProgram.scala:76)
  	at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.$anonfun$optimize$1(FlinkChainedProgram.scala:62)
  	at scala.collection.TraversableOnce.$anonfun$foldLeft$1(TraversableOnce.scala:156)
  	at scala.collection.TraversableOnce.$anonfun$foldLeft$1$adapted(TraversableOnce.scala:156)
  	at scala.collection.Iterator.foreach(Iterator.scala:937)
  	at scala.collection.Iterator.foreach$(Iterator.scala:937)
  	at scala.collection.AbstractIterator.foreach(Iterator.scala:1425)
  	at scala.collection.IterableLike.foreach(IterableLike.scala:70)
  	at scala.collection.IterableLike.foreach$(IterableLike.scala:69)
  	at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
  	at scala.collection.TraversableOnce.foldLeft(TraversableOnce.scala:156)
  	at scala.collection.TraversableOnce.foldLeft$(TraversableOnce.scala:154)
  	at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
  	at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.optimize(FlinkChainedProgram.scala:58)
  	at org.apache.flink.table.planner.plan.optimize.BatchCommonSubGraphBasedOptimizer.optimizeTree(BatchCommonSubGraphBasedOptimizer.scala:88)
  	at org.apache.flink.table.planner.plan.optimize.BatchCommonSubGraphBasedOptimizer.optimizeBlock(BatchCommonSubGraphBasedOptimizer.scala:59)
  	at org.apache.flink.table.planner.plan.optimize.BatchCommonSubGraphBasedOptimizer.$anonfun$doOptimize$1(BatchCommonSubGraphBasedOptimizer.scala:47)
  	at org.apache.flink.table.planner.plan.optimize.BatchCommonSubGraphBasedOptimizer.$anonfun$doOptimize$1$adapted(BatchCommonSubGraphBasedOptimizer.scala:47)
  	at scala.collection.mutable.ResizableArray.foreach(ResizableArray.scala:58)
  	at scala.collection.mutable.ResizableArray.foreach$(ResizableArray.scala:51)
  	at scala.collection.mutable.ArrayBuffer.foreach(ArrayBuffer.scala:47)
  	at org.apache.flink.table.planner.plan.optimize.BatchCommonSubGraphBasedOptimizer.doOptimize(BatchCommonSubGraphBasedOptimizer.scala:47)
  	at org.apache.flink.table.planner.plan.optimize.CommonSubGraphBasedOptimizer.optimize(CommonSubGraphBasedOptimizer.scala:77)
  	at org.apache.flink.table.planner.delegation.PlannerBase.optimize(PlannerBase.scala:309)
  	at org.apache.flink.table.planner.utils.TableTestUtilBase.assertPlanEquals(TableTestBase.scala:888)
  	at org.apache.flink.table.planner.utils.TableTestUtilBase.doVerifyPlan(TableTestBase.scala:857)
  	at org.apache.flink.table.planner.utils.TableTestUtilBase.verifyExecPlan(TableTestBase.scala:640)
  	at org.apache.flink.table.planner.plan.batch.sql.TableSinkTest.testMultiSinksSplitOnSortedResult(TableSinkTest.scala:188)
  	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
  	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  	at java.base/java.lang.reflect.Method.invoke(Method.java:566)
  	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)
  	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
  	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)
  	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
  	at org.junit.rules.ExpectedException$ExpectedExceptionStatement.evaluate(ExpectedException.java:258)
  	at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:61)
  	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:54)
  	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
  	at org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)
  	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)
  	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)
  	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)
  	at org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)
  	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)
  	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)
  	at org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)
  	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)
  	at org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)
  	at org.junit.runners.ParentRunner.run(ParentRunner.java:413)
  	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
  	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:69)
  	at com.intellij.rt.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:33)
  	at com.intellij.rt.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:235)
  	at com.intellij.rt.junit.JUnitStarter.main(JUnitStarter.java:54)
  Caused by: org.apache.calcite.plan.RelOptPlanner$CannotPlanException: There are not enough rules to produce a node with desired properties: convention=LOGICAL, FlinkRelDistributionTraitDef=any, sort=[].
  Missing conversion is LogicalProject[convention: NONE -&amp;gt; LOGICAL]
  There is 1 empty subset: rel#816:RelSubset#27.LOGICAL.any.[2 ASC-nulls-first], the relevant part of the original plan is as follows
  806:LogicalProject(a=[$0], b=[$1], c=[$2], d=[$3])
    162:LogicalTableScan(subset=[rel#805:RelSubset#26.NONE.any.[]], table=[[IntermediateRelTable_0]])

  Root: rel#810:RelSubset#28.LOGICAL.any.[]
  Original rel:
  LogicalSort(subset=[rel#129:RelSubset#1.LOGICAL.any.[2 ASC-nulls-first]], sort0=[$2], dir0=[ASC-nulls-first]): rowcount = 1.0E8, cumulative cost = {1.0E8 rows, 3.684136148790473E10 cpu, 0.0 io, 0.0 network, 0.0 memory}, id = 127
    LogicalTableScan(subset=[rel#126:RelSubset#0.NONE.any.[]], table=[[default_catalog, default_database, SmallTable]]): rowcount = 1.0E8, cumulative cost = {1.0E8 rows, 1.00000001E8 cpu, 0.0 io, 0.0 network, 0.0 memory}, id = 1

  Sets:
  Set#26, type: RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) d, VARCHAR(2147483647) e)
  	rel#805:RelSubset#26.NONE.any.[], best=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
  		rel#162:LogicalTableScan.NONE.any.[](table=[IntermediateRelTable_0]), rowcount=1.0E8, cumulative cost={inf}
  	rel#813:RelSubset#26.LOGICAL.any.[], best=rel#812
  		rel#812:FlinkLogicalIntermediateTableScan.LOGICAL.any.[](table=[IntermediateRelTable_0],fields=a, b, c, d, e), rowcount=1.0E8, cumulative cost={1.0E8 rows, 1.0E8 cpu, 4.8E9 io, 0.0 network, 0.0 memory}
  Set#27, type: RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) d)
  	rel#807:RelSubset#27.NONE.any.[2 ASC-nulls-first], best=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
  		rel#806:LogicalProject.NONE.any.[2 ASC-nulls-first](input=RelSubset#805,inputs=0..3), rowcount=1.0E8, cumulative cost={inf}
  	rel#815:RelSubset#27.NONE.any.[], best=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
  		rel#806:LogicalProject.NONE.any.[2 ASC-nulls-first](input=RelSubset#805,inputs=0..3), rowcount=1.0E8, cumulative cost={inf}
  		rel#814:LogicalCalc.NONE.any.[](input=RelSubset#805,expr#0..4={inputs},proj#0..3={exprs}), rowcount=1.0E8, cumulative cost={inf}
  	rel#816:RelSubset#27.LOGICAL.any.[2 ASC-nulls-first], best=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
  	rel#819:RelSubset#27.LOGICAL.any.[], best=rel#818
  		rel#818:FlinkLogicalCalc.LOGICAL.any.[](input=RelSubset#813,select=a, b, c, d), rowcount=1.0E8, cumulative cost={2.0E8 rows, 1.0E8 cpu, 4.8E9 io, 0.0 network, 0.0 memory}
  Set#28, type: RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) d)
  	rel#809:RelSubset#28.NONE.any.[], best=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
  		rel#808:LogicalSink.NONE.any.[](input=RelSubset#807,table=default_catalog.default_database.sink2,fields=a, b, c, d), rowcount=1.0E8, cumulative cost={inf}
  	rel#810:RelSubset#28.LOGICAL.any.[], best=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
  		rel#811:AbstractConverter.LOGICAL.any.[](input=RelSubset#809,convention=LOGICAL,FlinkRelDistributionTraitDef=any,sort=[]), rowcount=1.0E8, cumulative cost={inf}
  		rel#817:FlinkLogicalSink.LOGICAL.any.[](input=RelSubset#816,table=default_catalog.default_database.sink2,fields=a, b, c, d), rowcount=1.0E8, cumulative cost={inf}

  Graphviz:
  digraph G {
  	root [style=filled,label=&lt;span class=&quot;code-quote&quot;&gt;&quot;Root&quot;&lt;/span&gt;];
  	subgraph cluster26{
  		label=&lt;span class=&quot;code-quote&quot;&gt;&quot;Set 26 RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) d, VARCHAR(2147483647) e)&quot;&lt;/span&gt;;
  		rel162 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#162:LogicalTableScan\ntable=[IntermediateRelTable_0]\nrows=1.0E8, cost={inf}&quot;&lt;/span&gt;,shape=box]
  		rel812 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#812:FlinkLogicalIntermediateTableScan\ntable=[IntermediateRelTable_0],fields=a, b, c, d, e\nrows=1.0E8, cost={1.0E8 rows, 1.0E8 cpu, 4.8E9 io, 0.0 network, 0.0 memory}&quot;&lt;/span&gt;,color=blue,shape=box]
  		subset805 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#805:RelSubset#26.NONE.any.[]&quot;&lt;/span&gt;]
  		subset813 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#813:RelSubset#26.LOGICAL.any.[]&quot;&lt;/span&gt;]
  	}
  	subgraph cluster27{
  		label=&lt;span class=&quot;code-quote&quot;&gt;&quot;Set 27 RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) d)&quot;&lt;/span&gt;;
  		rel806 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#806:LogicalProject\ninput=RelSubset#805,inputs=0..3\nrows=1.0E8, cost={inf}&quot;&lt;/span&gt;,shape=box]
  		rel814 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#814:LogicalCalc\ninput=RelSubset#805,expr#0..4={inputs},proj#0..3={exprs}\nrows=1.0E8, cost={inf}&quot;&lt;/span&gt;,shape=box]
  		rel818 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#818:FlinkLogicalCalc\ninput=RelSubset#813,select=a, b, c, d\nrows=1.0E8, cost={2.0E8 rows, 1.0E8 cpu, 4.8E9 io, 0.0 network, 0.0 memory}&quot;&lt;/span&gt;,color=blue,shape=box]
  		subset807 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#807:RelSubset#27.NONE.any.[2 ASC-nulls-first]&quot;&lt;/span&gt;]
  		subset815 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#815:RelSubset#27.NONE.any.[]&quot;&lt;/span&gt;]
  		subset816 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#816:RelSubset#27.LOGICAL.any.[2 ASC-nulls-first]&quot;&lt;/span&gt;,color=red]
  		subset819 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#819:RelSubset#27.LOGICAL.any.[]&quot;&lt;/span&gt;]
  		subset819 -&amp;gt; subset816;		subset815 -&amp;gt; subset807;	}
  	subgraph cluster28{
  		label=&lt;span class=&quot;code-quote&quot;&gt;&quot;Set 28 RecordType(INTEGER a, BIGINT b, VARCHAR(2147483647) c, VARCHAR(2147483647) d)&quot;&lt;/span&gt;;
  		rel808 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#808:LogicalSink\ninput=RelSubset#807,table=default_catalog.default_database.sink2,fields=a, b, c, d\nrows=1.0E8, cost={inf}&quot;&lt;/span&gt;,shape=box]
  		rel811 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#811:AbstractConverter\ninput=RelSubset#809,convention=LOGICAL,FlinkRelDistributionTraitDef=any,sort=[]\nrows=1.0E8, cost={inf}&quot;&lt;/span&gt;,shape=box]
  		rel817 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#817:FlinkLogicalSink\ninput=RelSubset#816,table=default_catalog.default_database.sink2,fields=a, b, c, d\nrows=1.0E8, cost={inf}&quot;&lt;/span&gt;,shape=box]
  		subset809 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#809:RelSubset#28.NONE.any.[]&quot;&lt;/span&gt;]
  		subset810 [label=&lt;span class=&quot;code-quote&quot;&gt;&quot;rel#810:RelSubset#28.LOGICAL.any.[]&quot;&lt;/span&gt;]
  	}
  	root -&amp;gt; subset810;
  	subset805 -&amp;gt; rel162;
  	subset813 -&amp;gt; rel812[color=blue];
  	subset807 -&amp;gt; rel806; rel806 -&amp;gt; subset805;
  	subset815 -&amp;gt; rel814; rel814 -&amp;gt; subset805;
  	subset819 -&amp;gt; rel818[color=blue]; rel818 -&amp;gt; subset813[color=blue];
  	subset809 -&amp;gt; rel808; rel808 -&amp;gt; subset807;
  	subset810 -&amp;gt; rel811; rel811 -&amp;gt; subset809;
  	subset810 -&amp;gt; rel817; rel817 -&amp;gt; subset816;
  }
  	at org.apache.calcite.plan.volcano.RelSubset$CheapestPlanReplacer.visit(RelSubset.java:742)
  	at org.apache.calcite.plan.volcano.RelSubset.buildCheapestPlan(RelSubset.java:365)
  	at org.apache.calcite.plan.volcano.VolcanoPlanner.findBestExp(VolcanoPlanner.java:520)
  	at org.apache.calcite.tools.Programs$RuleSetProgram.run(Programs.java:312)
  	at org.apache.flink.table.planner.plan.optimize.program.FlinkVolcanoProgram.optimize(FlinkVolcanoProgram.scala:69)
  	... 55 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13419477">FLINK-25447</key>
            <summary>batch query cannot generate plan when a sorted view into multi sinks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhengyunhong97">Zheng yunhong</assignee>
                                    <reporter username="lincoln.86xy">lincoln lee</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>stale-assigned</label>
                    </labels>
                <created>Mon, 27 Dec 2021 04:08:54 +0000</created>
                <updated>Mon, 26 May 2025 02:48:33 +0000</updated>
                            <resolved>Mon, 26 May 2025 02:48:33 +0000</resolved>
                                    <version>1.19.0</version>
                                    <fixVersion>1.19.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17521568" author="JIRAUSER287975" created="Wed, 13 Apr 2022 09:19:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lincoln.86xy&quot; class=&quot;user-hover&quot; rel=&quot;lincoln.86xy&quot;&gt;lincoln.86xy&lt;/a&gt; , do you have time to fix this problem. If not, I will try to fix it.&lt;/p&gt;</comment>
                            <comment id="17529738" author="JIRAUSER287975" created="Fri, 29 Apr 2022 03:24:44 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;&#160; Can you assign this to me, Thanks!&lt;/p&gt;</comment>
                            <comment id="17537440" author="lincoln.86xy" created="Mon, 16 May 2022 09:54:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhengyunhong97&quot; class=&quot;user-hover&quot; rel=&quot;zhengyunhong97&quot;&gt;zhengyunhong97&lt;/a&gt; sorry for my late response~  just feel free to take over.&lt;/p&gt;</comment>
                            <comment id="17655801" author="fsk119" created="Sun, 8 Jan 2023 15:28:10 +0000"  >&lt;p&gt;After investigations,&#160; the main problem is that LogicalCalc doesn&apos;t generate the correct &lt;tt&gt;RelCollation&lt;/tt&gt; when converting the &lt;tt&gt;LogicalProject&lt;/tt&gt; to &lt;tt&gt;LogicalCalc&lt;/tt&gt;. When the RelSubSet computes the cost, it finds the cancidate can&apos;t satisfy the traits. (BTW, is there any better way we can print the candiates in the RelSubSet...)&lt;/p&gt;

&lt;p&gt;Just as the PR fixes, we only need to generate correct &lt;tt&gt;RelCollation&lt;/tt&gt; in the &lt;tt&gt;IntermediateTable&lt;/tt&gt;.  The problem only happens in the table api. When using `CREATE TEMPORARY VIEW` to register the view, the problem disappers. The reason behind is that we reuse the same calcite tree in the Table API, but in the SQL we always generate a new calcite tree. Because the Table API, we use the `QueryOperationCatalogView` to store the parsed view but in the SQL we use the `ResolvedCatalogView` that only stores the origin SQL. Because of the differences, the optimizer can reuse the view in the table api. For SQL &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INSERT INTO sink1 SELECT a, b, d FROM sorted_view;
INSERT INTO sink2 SELECT a, b, c, d FROM sorted_view;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;we have the following relblocks&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
relblock1:
sort
+- scan

relblock2:
sink1
+- project(fields=[a, b, d])
+-- scan(intermediate_table)

relblock3:
sink2
+- project(fields=[a, b, c, d])
+-- scan(intermediate_table)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But in the SQL, we have the following relblocks&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
relblock1:
sink1
+- project(fields=[a, b, d])
+-- sort
+--- scan

relblock2:
sink2
+- project(fields=[a, b, c, d])
+-- sort
+--- scan
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Therefore, in the SQL we don&apos;t get the problem. (BTW, it seems we can reuse more nodes in the Table API comparing to the SQL...)&lt;/p&gt;


&lt;p&gt;The PR looks good in general, but I am not sure wheter we should also override the &lt;tt&gt;getDistribution&lt;/tt&gt; in the &lt;tt&gt;IntermediateTable&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17655874" author="lincoln.86xy" created="Mon, 9 Jan 2023 02:18:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; Good question! From my understanding, the `getDistribution` is the same case as `getCollationList` (other related methods maybe also useful for optimization),  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=337361684%40qq.com&quot; class=&quot;user-hover&quot; rel=&quot;337361684@qq.com&quot;&gt;337361684@qq.com&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt; WDYT?&lt;/p&gt;</comment>
                            <comment id="17656361" author="JIRAUSER287975" created="Tue, 10 Jan 2023 01:33:59 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lincoln.86xy&quot; class=&quot;user-hover&quot; rel=&quot;lincoln.86xy&quot;&gt;lincoln.86xy&lt;/a&gt;&#160; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; ,&#160; thanks for your comments&#65292; I think it&apos;s necessary to ensure that `IntermediateTable` gets the correct informations like `distribution`&#65292; `collationList` and `isKey` etc.&#160; I have done this part of work in this PR.&lt;/p&gt;</comment>
                            <comment id="17752573" author="fsk119" created="Thu, 10 Aug 2023 01:54:22 +0000"  >&lt;p&gt;Merged into master: 9231d62d25dd60bc82c0635e7554d1494e4fc82b&lt;/p&gt;</comment>
                            <comment id="17763383" author="flink-jira-bot" created="Sat, 9 Sep 2023 22:35:18 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issue is assigned but has not received an update in 30 days, so it has been labeled &quot;stale-assigned&quot;.&lt;br/&gt;
If you are still working on the issue, please remove the label and add a comment updating the community on your progress.  If this issue is waiting on feedback, please consider this a reminder to the committer/reviewer. Flink is a very active project, and so we appreciate your patience.&lt;br/&gt;
If you are no longer working on the issue, please unassign yourself so someone else may work on it.&lt;/p&gt;</comment>
                            <comment id="17766313" author="sergey nuyanzin" created="Mon, 18 Sep 2023 10:21:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhengyunhong97&quot; class=&quot;user-hover&quot; rel=&quot;zhengyunhong97&quot;&gt;zhengyunhong97&lt;/a&gt;&lt;br/&gt;
to double check, since it is merged to master can we close it?&lt;br/&gt;
And another question: do we need to create backports?&lt;/p&gt;</comment>
                            <comment id="17953972" author="fsk119" created="Mon, 26 May 2025 02:46:17 +0000"  >&lt;p&gt;Sorry for the late response... I forget to close the issue.&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            24 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0y1g8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>