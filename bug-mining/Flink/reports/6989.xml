<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31478] TypeError: a bytes-like object is required, not &apos;JavaList&apos; is thrown when ds.execute_and_collect() is called on a KeyedStream</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31478</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
################################################################################
#  Licensed to the Apache Software Foundation (ASF) under one
#  or more contributor license agreements.  See the NOTICE file
#  distributed with &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; work &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; additional information
#  regarding copyright ownership.  The ASF licenses &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file
#  to you under the Apache License, Version 2.0 (the
#  &lt;span class=&quot;code-quote&quot;&gt;&quot;License&quot;&lt;/span&gt;); you may not use &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file except in compliance
#  with the License.  You may obtain a copy of the License at
#
#      http:&lt;span class=&quot;code-comment&quot;&gt;//www.apache.org/licenses/LICENSE-2.0
&lt;/span&gt;#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an &lt;span class=&quot;code-quote&quot;&gt;&quot;AS IS&quot;&lt;/span&gt; BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the specific language governing permissions and
# limitations under the License.
################################################################################
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; argparse
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; logging
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; sys

from pyflink.common &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; WatermarkStrategy, Encoder, Types
from pyflink.datastream &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; StreamExecutionEnvironment, RuntimeExecutionMode
from pyflink.datastream.connectors.file_system &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; (FileSource, StreamFormat, FileSink,
                                                       OutputFileConfig, RollingPolicy)


word_count_data = [&lt;span class=&quot;code-quote&quot;&gt;&quot;To be, or not to be,--that is the question:--&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;Whether &apos;tis nobler in the mind to suffer&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;The slings and arrows of outrageous fortune&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;Or to take arms against a sea of troubles,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;And by opposing end them?--To die,--to sleep,--&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;No more; and by a sleep to say we end&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;The heartache, and the thousand natural shocks&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;That flesh is heir to,--&apos;tis a consummation&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;Devoutly to be wish&apos;d. To die,--to sleep;--&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;To sleep! perchance to dream:--ay, there&apos;s the rub;&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;For in that sleep of death what dreams may come,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;When we have shuffled off &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; mortal coil,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;Must give us pause: there&apos;s the respect&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;That makes calamity of so &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; life;&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;For who would bear the whips and scorns of time,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;The oppressor&lt;span class=&quot;code-quote&quot;&gt;&apos;s wrong, the proud man&apos;&lt;/span&gt;s contumely,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;The pangs of despis&lt;span class=&quot;code-quote&quot;&gt;&apos;d love, the law&apos;&lt;/span&gt;s delay,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;The insolence of office, and the spurns&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;That patient merit of the unworthy takes,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;When he himself might his quietus make&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;With a bare bodkin? who would these fardels bear,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;To grunt and sweat under a weary life,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;But that the dread of something after death,--&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;The undiscover&apos;d country, from whose bourn&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;No traveller returns,--puzzles the will,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;And makes us rather bear those ills we have&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;Than fly to others that we know not of?&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;Thus conscience does make cowards of us all;&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;And thus the &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt; hue of resolution&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;Is sicklied o&apos;er with the pale &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; of thought;&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;And enterprises of great pith and moment,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;With &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; regard, their currents turn awry,&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;And lose the name of action.--Soft you now!&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;The fair Ophelia!--Nymph, in thy orisons&quot;&lt;/span&gt;,
                   &lt;span class=&quot;code-quote&quot;&gt;&quot;Be all my sins remember&apos;d.&quot;&lt;/span&gt;]


def word_count(input_path, output_path):
    env = StreamExecutionEnvironment.get_execution_environment()
    env.set_runtime_mode(RuntimeExecutionMode.BATCH)
    # write all the data to one file
    env.set_parallelism(1)

    # define the source
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; input_path is not None:
        ds = env.from_source(
            source=FileSource.for_record_stream_format(StreamFormat.text_line_format(),
                                                       input_path)
                             .process_static_file_set().build(),
            watermark_strategy=WatermarkStrategy.for_monotonous_timestamps(),
            source_name=&lt;span class=&quot;code-quote&quot;&gt;&quot;file_source&quot;&lt;/span&gt;
        )
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
        print(&lt;span class=&quot;code-quote&quot;&gt;&quot;Executing word_count example with &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; input data set.&quot;&lt;/span&gt;)
        print(&lt;span class=&quot;code-quote&quot;&gt;&quot;Use --input to specify file input.&quot;&lt;/span&gt;)
        ds = env.from_collection(word_count_data)

    def split(line):
        yield from line.split()

    # compute word count
    ds = ds.flat_map(split) \
           .map(lambda i: (i, 1), output_type=Types.TUPLE([Types.STRING(), Types.INT()])) \
           .key_by(lambda i: i[0])
           # .reduce(lambda i, j: (i[0], i[1] + j[1]))

    # define the sink
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; output_path is not None:
        ds.sink_to(
            sink=FileSink.for_row_format(
                base_path=output_path,
                encoder=Encoder.simple_string_encoder())
            .with_output_file_config(
                OutputFileConfig.builder()
                .with_part_prefix(&lt;span class=&quot;code-quote&quot;&gt;&quot;prefix&quot;&lt;/span&gt;)
                .with_part_suffix(&lt;span class=&quot;code-quote&quot;&gt;&quot;.ext&quot;&lt;/span&gt;)
                .build())
            .with_rolling_policy(RollingPolicy.default_rolling_policy())
            .build()
        )
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;:
        print(&lt;span class=&quot;code-quote&quot;&gt;&quot;Printing result to stdout. Use --output to specify output path.&quot;&lt;/span&gt;)
        a = list(ds.execute_and_collect())


&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; __name__ == &lt;span class=&quot;code-quote&quot;&gt;&apos;__main__&apos;&lt;/span&gt;:
    logging.basicConfig(stream=sys.stdout, level=logging.INFO, format=&lt;span class=&quot;code-quote&quot;&gt;&quot;%(message)s&quot;&lt;/span&gt;)

    parser = argparse.ArgumentParser()
    parser.add_argument(
        &lt;span class=&quot;code-quote&quot;&gt;&apos;--input&apos;&lt;/span&gt;,
        dest=&lt;span class=&quot;code-quote&quot;&gt;&apos;input&apos;&lt;/span&gt;,
        required=False,
        help=&lt;span class=&quot;code-quote&quot;&gt;&apos;Input file to process.&apos;&lt;/span&gt;)
    parser.add_argument(
        &lt;span class=&quot;code-quote&quot;&gt;&apos;--output&apos;&lt;/span&gt;,
        dest=&lt;span class=&quot;code-quote&quot;&gt;&apos;output&apos;&lt;/span&gt;,
        required=False,
        help=&lt;span class=&quot;code-quote&quot;&gt;&apos;Output file to write results to.&apos;&lt;/span&gt;)

    argv = sys.argv[1:]
    known_args, _ = parser.parse_known_args(argv)

    word_count(known_args.input, known_args.output)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the above job, the following exception will be thrown:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Traceback (most recent call last):
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/dianfu/code/src/workspace/pyflink-examples/udf/test_udf_perf.py&quot;&lt;/span&gt;, line 131, in &amp;lt;module&amp;gt;
    word_count(known_args.input, known_args.output)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/dianfu/code/src/workspace/pyflink-examples/udf/test_udf_perf.py&quot;&lt;/span&gt;, line 110, in word_count
    a = list(ds.execute_and_collect())
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/dianfu/venv/examples-37/lib/python3.7/site-packages/pyflink/datastream/data_stream.py&quot;&lt;/span&gt;, line 2920, in __next__
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; self.next()
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/dianfu/venv/examples-37/lib/python3.7/site-packages/pyflink/datastream/data_stream.py&quot;&lt;/span&gt;, line 2931, in next
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; convert_to_python_obj(self._j_closeable_iterator.next(), self._type_info)
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/dianfu/venv/examples-37/lib/python3.7/site-packages/pyflink/datastream/utils.py&quot;&lt;/span&gt;, line 72, in convert_to_python_obj
    fields.append(pickled_bytes_to_python_converter(data, field_type))
  File &lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/dianfu/venv/examples-37/lib/python3.7/site-packages/pyflink/datastream/utils.py&quot;&lt;/span&gt;, line 91, in pickled_bytes_to_python_converter
    data = pickle.loads(data)
TypeError: a bytes-like object is required, not &lt;span class=&quot;code-quote&quot;&gt;&apos;JavaList&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See more details on &lt;a href=&quot;https://apache-flink.slack.com/archives/C03G7LJTS2G/p1678894062180649&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://apache-flink.slack.com/archives/C03G7LJTS2G/p1678894062180649&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13528716">FLINK-31478</key>
            <summary>TypeError: a bytes-like object is required, not &apos;JavaList&apos; is thrown when ds.execute_and_collect() is called on a KeyedStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dianfu">Dian Fu</assignee>
                                    <reporter username="dianfu">Dian Fu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 16 Mar 2023 02:44:48 +0000</created>
                <updated>Fri, 17 Mar 2023 15:16:48 +0000</updated>
                            <resolved>Fri, 17 Mar 2023 15:16:48 +0000</resolved>
                                                    <fixVersion>1.16.2</fixVersion>
                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.17.1</fixVersion>
                                    <component>API / Python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17701849" author="dianfu" created="Fri, 17 Mar 2023 15:16:48 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master via 5e059efee864e17939a33f29272a848d00598531&lt;/li&gt;
	&lt;li&gt;release-1.17 via ec5a09b3ce56426d1bdc8eeac4bf52cac9be015b&lt;/li&gt;
	&lt;li&gt;release-1.16 via cadf4b35fb6f20c8cba310fa54626d0b9bae1361&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1gm9s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>