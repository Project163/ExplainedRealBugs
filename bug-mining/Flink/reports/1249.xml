<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4727] Kafka 0.9 Consumer should also checkpoint auto retrieved offsets even when no data is read</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4727</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This is basically the 0.9 version counterpart for &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3440&quot; title=&quot;Kafka should also checkpoint partitions where no initial offset was retrieved&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3440&quot;&gt;&lt;del&gt;FLINK-3440&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;When the 0.9 consumer fetches initial offsets from Kafka on startup, but does not have any data to read, it should also checkpoint &amp;amp; commit these initial offsets.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13009191">FLINK-4727</key>
            <summary>Kafka 0.9 Consumer should also checkpoint auto retrieved offsets even when no data is read</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10003">Resolved</resolution>
                                        <assignee username="tzulitai">Tzu-Li (Gordon) Tai</assignee>
                                    <reporter username="tzulitai">Tzu-Li (Gordon) Tai</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Oct 2016 08:47:57 +0000</created>
                <updated>Wed, 16 Nov 2016 06:31:31 +0000</updated>
                            <resolved>Wed, 16 Nov 2016 06:31:30 +0000</resolved>
                                                    <fixVersion>1.1.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15544834" author="githubbot" created="Tue, 4 Oct 2016 09:08:03 +0000"  >&lt;p&gt;GitHub user tzulitai opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2585&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2585&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4727&quot; title=&quot;Kafka 0.9 Consumer should also checkpoint auto retrieved offsets even when no data is read&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4727&quot;&gt;&lt;del&gt;FLINK-4727&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-connector&amp;#93;&lt;/span&gt; Set missing initial offset states with starting KafkaConsumer position&lt;/p&gt;

&lt;p&gt;    This was fixed for the 0.8 consumer before. This PR adds the behaviour to the 0.9 consumer.&lt;/p&gt;

&lt;p&gt;    In #2580, there&apos;s a new IT test that assures this behaviour for 0.8 and 0.9, but is commented out for 0.9 in #2580 because that test won&apos;t pass until the changes in this PR is also included.&lt;/p&gt;

&lt;p&gt;    I want to keep the review / discussion of the two issues apart, hence separate PRs. I suggest to merge #2580 first, and then rebase this afterwards to include the test.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tzulitai/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tzulitai/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4727&quot; title=&quot;Kafka 0.9 Consumer should also checkpoint auto retrieved offsets even when no data is read&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4727&quot;&gt;&lt;del&gt;FLINK-4727&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2585.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2585.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2585&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d030c3e4230d821d53ddf3377e0910404284300e&lt;br/&gt;
Author: Tzu-Li (Gordon) Tai &amp;lt;tzulitai@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-10-04T08:53:38Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4727&quot; title=&quot;Kafka 0.9 Consumer should also checkpoint auto retrieved offsets even when no data is read&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4727&quot;&gt;&lt;del&gt;FLINK-4727&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka-connector&amp;#93;&lt;/span&gt; Set missing initial offset states with starting KafkaConsumer position&lt;/p&gt;

&lt;p&gt;    With this change, on a clean startup of FlinkKafkaConsumer09, the auto retrieved offsets (either earliest, latest, or an actual&lt;br/&gt;
    committed offset) from Kafka will also be checkpointed and committed, even if no records are read after the startup.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15570678" author="githubbot" created="Thu, 13 Oct 2016 03:18:39 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2585#discussion_r83138654&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2585#discussion_r83138654&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-connectors/flink-connector-kafka-0.9/src/main/java/org/apache/flink/streaming/connectors/kafka/internal/Kafka09Fetcher.java &amp;#8212;&lt;br/&gt;
    @@ -204,7 +204,22 @@ public void run() {&lt;br/&gt;
     			// seek the consumer to the initial offsets&lt;br/&gt;
     			for (KafkaTopicPartitionState&amp;lt;TopicPartition&amp;gt; partition : subscribedPartitions()) {&lt;br/&gt;
     				if (partition.isOffsetDefined()) {&lt;br/&gt;
    +					LOG.info(&quot;Partition {} has restored initial offsets {} from checkpoint / savepoint; seeking the consumer &quot; +&lt;br/&gt;
    +						&quot;to position {}&quot;, partition.getKafkaPartitionHandle(), partition.getOffset(), partition.getOffset() + 1);&lt;br/&gt;
    +&lt;br/&gt;
     					consumer.seek(partition.getKafkaPartitionHandle(), partition.getOffset() + 1);&lt;br/&gt;
    +				} else {&lt;br/&gt;
    +					// for partitions that do not have offsets restored from a checkpoint/savepoint,&lt;br/&gt;
    +					// we need to define our internal offset state for them using the initial offsets retrieved from Kafka&lt;br/&gt;
    +					// by the KafkaConsumer, so that they are correctly checkpointed and committed on the next checkpoint&lt;br/&gt;
    +&lt;br/&gt;
    +					long fetchedOffset = consumer.position(partition.getKafkaPartitionHandle());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I just confirmed this with a simple test.&lt;br/&gt;
    Yes, when no commit offset is available for the group id, the &quot;auto.offset.reset&quot; behavior is used.&lt;br/&gt;
    The &quot;position&quot; basically means which offset the KafkaConsumer will start reading from. It automatically determines the position once it is assigned partitions, either from committed offsets or the &quot;auto.offset.reset&quot; if none exists.&lt;/p&gt;</comment>
                            <comment id="15572005" author="githubbot" created="Thu, 13 Oct 2016 13:58:11 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2585&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2585&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 to merge&lt;/p&gt;</comment>
                            <comment id="15584340" author="githubbot" created="Tue, 18 Oct 2016 03:50:53 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2585&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2585&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Rebasing to include f46ca39 with the IT tests de-commented. Will merge when Travis turns green.&lt;/p&gt;</comment>
                            <comment id="15587354" author="githubbot" created="Wed, 19 Oct 2016 01:49:16 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2585&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2585&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The failing tests are unrelated, and related tests are covered and have passed. Merging this ...&lt;/p&gt;</comment>
                            <comment id="15587370" author="githubbot" created="Wed, 19 Oct 2016 01:55:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2585&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2585&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15587389" author="tzulitai" created="Wed, 19 Oct 2016 02:01:39 +0000"  >&lt;p&gt;Resolved for master via &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flink/commit/e4343ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flink/commit/e4343ba&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13009044">FLINK-4723</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34ctj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>