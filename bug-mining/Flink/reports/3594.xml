<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15381] INSERT INTO VALUES statement fails if a cast project is applied</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15381</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The following query will fail:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-scala&quot;&gt;
  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;def&lt;/span&gt; test(): Unit = {
    &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; sinkDDL =
      &quot;&quot;&quot;
        |create table t2(
        |  a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;,
        |  b string
        |) &lt;span class=&quot;code-keyword&quot;&gt;with&lt;/span&gt; (
        |  &apos;connector&apos; = &apos;COLLECTION&apos;
        |)
      &quot;&quot;&quot;.stripMargin
    &lt;span class=&quot;code-keyword&quot;&gt;val&lt;/span&gt; query =
      &quot;&quot;&quot;
        |insert into t2 select cast(a as &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;), cast(b as varchar) from (values (3, &apos;c&apos;)) T(a,b)
      &quot;&quot;&quot;.stripMargin
    tableEnv.sqlUpdate(sinkDDL)
    tableEnv.sqlUpdate(query)
    execJob(&lt;span class=&quot;code-quote&quot;&gt;&quot;testJob&quot;&lt;/span&gt;)
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;exception:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.flink.table.api.TableException: Cannot generate a valid execution plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the given query: 

LogicalSink(name=[`default_catalog`.`default_database`.`t2`], fields=[a, b])
+- LogicalProject(EXPR$0=[$0], EXPR$1=[CAST($1):VARCHAR(2147483647) CHARACTER SET &lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-16LE&quot;&lt;/span&gt; NOT NULL])
   +- LogicalValues(type=[RecordType(INTEGER a, CHAR(1) b)], tuples=[[{ 3, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;c&apos;&lt;/span&gt; }]])

This exception indicates that the query uses an unsupported SQL feature.
Please check the documentation &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the set of currently supported SQL features.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</description>
                <environment></environment>
        <key id="13276207">FLINK-15381</key>
            <summary>INSERT INTO VALUES statement fails if a cast project is applied</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="godfreyhe">godfrey he</assignee>
                                    <reporter username="jark">Jark Wu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 24 Dec 2019 09:20:30 +0000</created>
                <updated>Thu, 2 Jan 2020 12:56:14 +0000</updated>
                            <resolved>Thu, 2 Jan 2020 12:56:14 +0000</resolved>
                                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17003492" author="godfreyhe" created="Thu, 26 Dec 2019 06:54:55 +0000"  >&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12989479/12989479_image-2019-12-26-14-56-00-634.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
the reason is: the original &lt;tt&gt;LogicalProject&lt;/tt&gt; has collation trait (see the above picture: &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/tt&gt; which means the second field is ordered and its direction is ascending), but when &lt;tt&gt;LogicalProject&lt;/tt&gt; converts to &lt;tt&gt;LogicalCalc&lt;/tt&gt; in &lt;tt&gt;ProjectToCalcRule&lt;/tt&gt;, the collation info of new Calc is empty. The root cause is the collation derive logic on &lt;tt&gt;RelSubset&lt;/tt&gt; in &lt;tt&gt;RelMdCollation&lt;/tt&gt; in not collect.&lt;/p&gt;

</comment>
                            <comment id="17003496" author="ykt836" created="Thu, 26 Dec 2019 07:02:40 +0000"  >&lt;p&gt;Just curious, who generated collation trait in the plan? It seems no operator involved has such information.&#160;&lt;/p&gt;</comment>
                            <comment id="17006544" author="godfreyhe" created="Thu, 2 Jan 2020 02:55:07 +0000"  >&lt;p&gt;The collection trait is generated when creating &lt;tt&gt;LogicalProject&lt;/tt&gt; in &lt;tt&gt;SqlToRelConverter&lt;/tt&gt;. code is &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-comment&quot;&gt;// LogicalProject.java
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; LogicalProject create(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RelNode input,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RexNode&amp;gt; projects, RelDataType rowType) {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RelOptCluster cluster = input.getCluster();
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RelMetadataQuery mq = cluster.getMetadataQuery();
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RelTraitSet traitSet =
        cluster.traitSet().replace(Convention.NONE)
            .replaceIfs(RelCollationTraitDef.INSTANCE,
                () -&amp;gt; RelMdCollation.project(mq, input, projects));
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LogicalProject(cluster, traitSet, input, projects, rowType);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17006579" author="godfreyhe" created="Thu, 2 Jan 2020 04:21:08 +0000"  >&lt;p&gt;&lt;tt&gt;RelMdCollation&lt;/tt&gt; will derive collation for `Values`. The derivation result of &lt;tt&gt;Values ((1, 9, true, 2), (2, 6, false, 3), (3, 3, true, 4))&lt;/tt&gt; is &lt;tt&gt;(0, 1, 2, 3)&lt;/tt&gt; and &lt;tt&gt;(3)&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17006795" author="jark" created="Thu, 2 Jan 2020 12:56:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-15381&quot; title=&quot;INSERT INTO VALUES statement fails if a cast project is applied&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-15381&quot;&gt;&lt;del&gt;FLINK-15381&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table-planner-blink&amp;#93;&lt;/span&gt; Fix collation derive logic on RelSubset in RelMdCollation&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1.11.0: 6b6dfd07950a22e5de421f9712b826fe6f756ae1&lt;/li&gt;
	&lt;li&gt;1.10.0: 49ddaa1f5bbc12570155e24ca766228089c76016&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12989479" name="image-2019-12-26-14-56-00-634.png" size="256722" author="godfreyhe" created="Thu, 26 Dec 2019 06:56:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z09yrk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>