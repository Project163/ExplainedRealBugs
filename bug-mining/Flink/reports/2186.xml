<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6623] BlobCacheSuccessTest fails on Windows</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6623</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;All tests in &lt;tt&gt;BlobCacheSuccessTest&lt;/tt&gt; fail on Windows.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.nio.file.FileSystemException: C:\Users\Zento\AppData\Local\Temp\junit1683251984771313204\junit8061309906182960047\blobStore-04a01d13-96c8-4c0d-b209-5ea0bf5e534d\incoming\temp-00000000 -&amp;gt; C:\Users\Zento\AppData\Local\Temp\junit1683251984771313204\junit8061309906182960047\blobStore-04a01d13-96c8-4c0d-b209-5ea0bf5e534d\job_a8fef824a8e43a546dfa05d0c8b73e57\blob_p-0ae4f711ef5d6e9d26c611fd2c8c8ac45ecbf9e7-cd525d0173571dc24f4c0723130892af: The process cannot access the file because it is being used by another process.


	at sun.nio.fs.WindowsException.translateToIOException(WindowsException.java:86)
	at sun.nio.fs.WindowsException.rethrowAsIOException(WindowsException.java:97)
	at sun.nio.fs.WindowsFileCopy.move(WindowsFileCopy.java:387)
	at sun.nio.fs.WindowsFileSystemProvider.move(WindowsFileSystemProvider.java:287)
	at java.nio.file.Files.move(Files.java:1395)
	at org.apache.flink.runtime.blob.BlobUtils.moveTempFileToStore(BlobUtils.java:464)
	at org.apache.flink.runtime.blob.BlobServer.moveTempFileToStore(BlobServer.java:708)
	at org.apache.flink.runtime.blob.BlobServer.putBuffer(BlobServer.java:608)
	at org.apache.flink.runtime.blob.BlobServer.putPermanent(BlobServer.java:568)
	at org.apache.flink.runtime.blob.BlobServerPutTest.put(BlobServerPutTest.java:778)
	at org.apache.flink.runtime.blob.BlobCacheSuccessTest.uploadFileGetTest(BlobCacheSuccessTest.java:173)
	at org.apache.flink.runtime.blob.BlobCacheSuccessTest.testBlobForJobCacheHa(BlobCacheSuccessTest.java:90)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.rules.ExternalResource$1.evaluate(ExternalResource.java:48)
	at org.junit.rules.TestWatcher$1.evaluate(TestWatcher.java:55)
	at org.junit.rules.RunRules.evaluate(RunRules.java:20)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;windows 10, java 1.8&lt;/p&gt;</environment>
        <key id="13073053">FLINK-6623</key>
            <summary>BlobCacheSuccessTest fails on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="vivarem">constantine stanley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 May 2017 08:56:28 +0000</created>
                <updated>Tue, 30 Jan 2018 14:57:24 +0000</updated>
                            <resolved>Tue, 30 Jan 2018 14:57:13 +0000</resolved>
                                    <version>1.4.0</version>
                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16015459" author="zentol" created="Thu, 18 May 2017 09:04:07 +0000"  >&lt;p&gt;It would be great if you could provide stack traces for failing test.&lt;/p&gt;</comment>
                            <comment id="16337427" author="zentol" created="Wed, 24 Jan 2018 11:26:22 +0000"  >&lt;p&gt;I&apos;ve adjusted the description, removing all test failures that i couldn&apos;t reproduce.&lt;/p&gt;</comment>
                            <comment id="16337432" author="zentol" created="Wed, 24 Jan 2018 11:30:23 +0000"  >&lt;p&gt;The reason is in &lt;tt&gt;BlobServer#putBuffer&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (FileOutputStream fos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(incomingFile)) {
	md.update(value);
	fos.write(value);

	&lt;span class=&quot;code-comment&quot;&gt;// persist file
&lt;/span&gt;	blobKey = moveTempFileToStore(incomingFile, jobId, md.digest(), blobType);

	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; blobKey;
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
	&lt;span class=&quot;code-comment&quot;&gt;// delete incomingFile from a failed download
&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!incomingFile.delete() &amp;amp;&amp;amp; incomingFile.exists()) {
		LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Could not delete the staging file {} &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; blob key {} and job {}.&quot;&lt;/span&gt;,
			incomingFile, blobKey, jobId);
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We open a FileOutputStream to the temp file and then try to move the file while the stream is still open. The move should be done after the stream was closed.&lt;/p&gt;</comment>
                            <comment id="16337466" author="githubbot" created="Wed, 24 Jan 2018 12:02:15 +0000"  >&lt;p&gt;GitHub user zentol opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6623&quot; title=&quot;BlobCacheSuccessTest fails on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6623&quot;&gt;&lt;del&gt;FLINK-6623&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Blob&amp;#93;&lt;/span&gt; BlobServer#putBuffer moves file after stream is cl&#8230;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    In BlobServer#putBuffer we were moving a file while we still had an open FileOutputStream for it, causing the `BlobCacheSuccessTest` to categorically fail on Windows.&lt;/p&gt;

&lt;p&gt;    The PR splits the existing try-with-resources block into 2 blocks: one for writing the data to the temporary file, and another one for moving the file to the storage directory.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is a trivial rework / code cleanup without any test coverage.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/zentol/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/zentol/flink&lt;/a&gt; 6623&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5351&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 196efd73b5af16c4e7bc51ebe16cb886342c0d80&lt;br/&gt;
Author: zentol &amp;lt;chesnay@...&amp;gt;&lt;br/&gt;
Date:   2018-01-24T11:34:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6623&quot; title=&quot;BlobCacheSuccessTest fails on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6623&quot;&gt;&lt;del&gt;FLINK-6623&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Blob&amp;#93;&lt;/span&gt; BlobServer#putBuffer moves file after stream is closed&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16337468" author="githubbot" created="Wed, 24 Jan 2018 12:03:08 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Note that the tests may still sporadically fail due to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5659&quot; title=&quot;FileBaseUtils#deleteFileOrDirectory not thread-safe on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5659&quot;&gt;&lt;del&gt;FLINK-5659&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16337982" author="githubbot" created="Wed, 24 Jan 2018 17:56:42 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol I revived and rebased an old branch with an attempt to fix the concurrency issue of file deletes on Windows: &lt;a href=&quot;https://github.com/StephanEwen/incubator-flink/commit/0504a66b82ca2afe9a40457413585ecab6d6cc33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StephanEwen/incubator-flink/commit/0504a66b82ca2afe9a40457413585ecab6d6cc33&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Can you check this out, see if it works, and commit is it is helpful?&lt;/p&gt;</comment>
                            <comment id="16339148" author="githubbot" created="Thu, 25 Jan 2018 12:18:19 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Taking a look at the moment. I tried it with the `BlobCacheSuccessTest` and get about 30-50% less failures, but this could also be due to some leak in the BlobServer we haven&apos;t found yet.&lt;/p&gt;

&lt;p&gt;    I&apos;ll try it with the `FileUtilsTest`, that one should be isolated from other components.&lt;/p&gt;</comment>
                            <comment id="16339286" author="githubbot" created="Thu, 25 Jan 2018 14:33:33 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    So the `FIleBaseUtilsTest` ran without a hitch 3000 times in a row, which is &lt;em&gt;really&lt;/em&gt; nice.&lt;/p&gt;</comment>
                            <comment id="16340637" author="githubbot" created="Fri, 26 Jan 2018 07:06:11 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Cool, do you want to commit both changes (this PR and the referenced branch) together?&lt;/p&gt;</comment>
                            <comment id="16343152" author="githubbot" created="Mon, 29 Jan 2018 09:58:35 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    yes I&apos;ll push them together.&lt;/p&gt;</comment>
                            <comment id="16345168" author="zentol" created="Tue, 30 Jan 2018 14:57:13 +0000"  >&lt;p&gt;master: e135c3a5e2a42911f4c7f744003f5804c25d2dd9&lt;/p&gt;</comment>
                            <comment id="16345171" author="githubbot" created="Tue, 30 Jan 2018 14:57:24 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5351&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3f5ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>