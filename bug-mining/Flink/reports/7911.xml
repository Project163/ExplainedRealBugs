<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:22:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-38344] The local files of the HistoryServer may risk never being deleted.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-38344</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When the&#160;{{historyserver.web.tmpdir }}configuration points to a non-system temporary directory, the contents of this directory will only be cleaned up if explicitly deleted.&lt;/p&gt;

&lt;p&gt;Under the current cleanup logic, this directory is cleared in the following two scenarios:&lt;/p&gt;

&lt;p&gt;1.&lt;/p&gt;

&lt;p&gt;&#8203;&lt;b&gt;&#8203;When the HistoryServer encounters an exception&#8203;&lt;/b&gt;&#8203;, it actively cleans up this directory. However, if the HistoryServer process is forcibly terminated externally, this cleanup logic will not be triggered.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13078339/13078339_image-2025-09-11-00-31-26-595.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13078340/13078340_image-2025-09-11-00-32-25-793.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;2.&lt;/p&gt;

&lt;p&gt;&#8203;&lt;b&gt;&#8203;The&#160;&lt;tt&gt;HistoryServerArchiveFetcher&lt;/tt&gt;&#8203;&lt;/b&gt;&#8203; builds&#160;&lt;tt&gt;cachedArchivesPerRefreshDirectory&lt;/tt&gt;based on the job information still present in the remote directory and uses this to determine which local job files need cleanup. Consequently, if the HistoryServer retains a large number of local job files that no longer exist in remote storage, these files will never be deleted. This may lead to excessive file handle usage on the local node, resulting in file descriptor leaks.&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13078341/13078341_image-2025-09-11-00-34-54-580.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A relatively straightforward fix would be:&lt;/p&gt;

&lt;p&gt;In the HistoryServer constructor, first clear all files in the&#160;&lt;tt&gt;historyserver.web.tmpdir&lt;/tt&gt;directory before proceeding with the original initialization logic. This ensures that the local files marked for cleanup&#8212;based on&#160;&lt;tt&gt;HistoryServerArchiveFetcher#cachedArchivesPerRefreshDirectory&lt;/tt&gt;&#8212;are free from leaks.&lt;/p&gt;

&lt;p&gt;I&apos;d like to fix it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13628605">FLINK-38344</key>
            <summary>The local files of the HistoryServer may risk never being deleted.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="RocMarshal">RocMarshal</assignee>
                                    <reporter username="RocMarshal">RocMarshal</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 10 Sep 2025 16:20:56 +0000</created>
                <updated>Sun, 28 Sep 2025 03:13:44 +0000</updated>
                            <resolved>Sun, 28 Sep 2025 03:12:59 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.20.0</version>
                    <version>2.1.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                    <fixVersion>1.20.4</fixVersion>
                                    <component>Runtime / Web Frontend</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="18023373" author="zhongwei" created="Sun, 28 Sep 2025 03:12:20 +0000"  >&lt;p&gt;Merged to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master via 39a46288c7e74d7c5c799b48ef5a42f0c47dcaad&lt;/li&gt;
	&lt;li&gt;release-2.1 via 53c5d716d8d38f9e273ed9acc0da8fa2379010f4&lt;/li&gt;
	&lt;li&gt;release-2.0 via cc3f16b6dde1ff16bad491fe343e69056aed00ee&lt;/li&gt;
	&lt;li&gt;release-1.20 via 714d1ba46842ca823292ae5ef52d65f24b02f5c5&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="13078339" name="image-2025-09-11-00-31-26-595.png" size="273991" author="RocMarshal" created="Wed, 10 Sep 2025 16:31:28 +0000"/>
                            <attachment id="13078340" name="image-2025-09-11-00-32-25-793.png" size="34957" author="RocMarshal" created="Wed, 10 Sep 2025 16:32:26 +0000"/>
                            <attachment id="13078341" name="image-2025-09-11-00-34-54-580.png" size="309814" author="RocMarshal" created="Wed, 10 Sep 2025 16:34:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1xn28:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>