<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17322] Enable latency tracker would corrupt the broadcast state</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17322</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This bug is reported from user mail list:&lt;br/&gt;
 &lt;a href=&quot;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Latency-tracking-together-with-broadcast-state-can-cause-job-failure-td34013.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Latency-tracking-together-with-broadcast-state-can-cause-job-failure-td34013.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Execute &lt;tt&gt;BroadcastStateIT#broadcastStateWorksWithLatencyTracking&lt;/tt&gt; would easily reproduce this problem.&lt;/p&gt;

&lt;p&gt;From current information, the broadcast element would be corrupt once we enable &lt;tt&gt;env.getConfig().setLatencyTrackingInterval(2000)&lt;/tt&gt;.&lt;br/&gt;
 The exception stack trace would be: (based on current master branch)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.io.IOException: Corrupt stream, found tag: 84
	at org.apache.flink.streaming.runtime.streamrecord.StreamElementSerializer.deserialize(StreamElementSerializer.java:217) ~[classes/:?]
	at org.apache.flink.streaming.runtime.streamrecord.StreamElementSerializer.deserialize(StreamElementSerializer.java:46) ~[classes/:?]
	at org.apache.flink.runtime.plugable.NonReusingDeserializationDelegate.read(NonReusingDeserializationDelegate.java:55) ~[classes/:?]
	at org.apache.flink.runtime.io.network.api.serialization.SpillingAdaptiveSpanningRecordDeserializer.getNextRecord(SpillingAdaptiveSpanningRecordDeserializer.java:157) ~[classes/:?]
	at org.apache.flink.streaming.runtime.io.StreamTaskNetworkInput.emitNext(StreamTaskNetworkInput.java:123) ~[classes/:?]
	at org.apache.flink.streaming.runtime.io.StreamTwoInputProcessor.processInput(StreamTwoInputProcessor.java:181) ~[classes/:?]
	at org.apache.flink.streaming.runtime.tasks.StreamTask.processInput(StreamTask.java:332) ~[classes/:?]
	at org.apache.flink.streaming.runtime.tasks.mailbox.MailboxProcessor.runMailboxStep(MailboxProcessor.java:206) ~[classes/:?]
	at org.apache.flink.streaming.runtime.tasks.mailbox.MailboxProcessor.runMailboxLoop(MailboxProcessor.java:196) ~[classes/:?]
	at org.apache.flink.streaming.runtime.tasks.StreamTask.runMailboxLoop(StreamTask.java:505) ~[classes/:?]
	at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:485) ~[classes/:?]
	at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:720) ~[classes/:?]
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:544) ~[classes/:?]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) ~[?:1.8.0_144]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13300210">FLINK-17322</key>
            <summary>Enable latency tracker would corrupt the broadcast state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arvid">Arvid Heise</assignee>
                                    <reporter username="yunta">Yun Tang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 22 Apr 2020 08:58:38 +0000</created>
                <updated>Tue, 22 Jun 2021 14:05:09 +0000</updated>
                            <resolved>Tue, 16 Jun 2020 07:44:17 +0000</resolved>
                                    <version>1.9.3</version>
                    <version>1.10.1</version>
                    <version>1.11.0</version>
                    <version>1.12.0</version>
                                    <fixVersion>1.10.2</fixVersion>
                    <fixVersion>1.11.0</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17089483" author="yunta" created="Wed, 22 Apr 2020 09:00:31 +0000"  >&lt;p&gt;I have also uploaded the related project to reproduce this problem, which is offered from user Lasse Nedergaard &lt;/p&gt;</comment>
                            <comment id="17113083" author="arvid" created="Thu, 21 May 2020 11:10:20 +0000"  >&lt;p&gt;&lt;em&gt;Removed old message.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Bug seems to be related to random emit within BroadcastRecordWriter. I have found a simple fix, which influences latency measurement on source level (will underestimate lag). I will dig deeper to find a proper fix.&lt;/p&gt;</comment>
                            <comment id="17134561" author="arvid" created="Fri, 12 Jun 2020 22:24:05 +0000"  >&lt;p&gt;Proper fix has been merged to master; currently backporting.&lt;/p&gt;</comment>
                            <comment id="17135772" author="arvid" created="Mon, 15 Jun 2020 11:31:15 +0000"  >&lt;p&gt;Merged fix to 1.11 and 1.10 is about to be merged.&lt;/p&gt;

&lt;p&gt;For 1.9, there seems to be a completely different cause; the buggy code first appeared in 1.10. Since 1.11 is about to pop and latency markers in conjunction with broadcast state is rarely used, we decided to not fix it in 1.9.&lt;/p&gt;

&lt;p&gt;I&apos;ll close this ticket as soon as 1.10 is merged.&lt;/p&gt;</comment>
                            <comment id="17136400" author="arvid" created="Tue, 16 Jun 2020 07:44:33 +0000"  >&lt;p&gt;Merged to master as 7e7b132f611f5a564e8c7b1e6b195692293fa90f&lt;br/&gt;
Merged to 1.11 as dfdfdadf445ea055c841c526b1a382424e1e1865&lt;br/&gt;
Merged to 1.10 as 5c0f827bf1c1f531ba30f97bdf6ab4393a32b0f0. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13000810" name="Telematics2-feature-flink-1.10-latency-tracking-broken.zip" size="73221" author="yunta" created="Wed, 22 Apr 2020 08:59:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dxqw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>