<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:10:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-25256] Savepoints do not work with ExternallyInducedSources</title>
                <link>https://issues.apache.org/jira/browse/FLINK-25256</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;It is not possible to take a proper savepoint with &lt;tt&gt;ExternallyInducedSource&lt;/tt&gt; or &lt;tt&gt;ExternallyInducedSourceReader&lt;/tt&gt; (both legacy and FLIP-27 versions). The problem is that we&apos;re hardcoding &lt;tt&gt;CheckpointOptions&lt;/tt&gt; in the &lt;tt&gt;triggerHook&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The outcome of current state is that operators would try to take checkpoints in the checkpoint location whereas the &lt;tt&gt;CheckpointCoordinator&lt;/tt&gt; will write metadata for those states in the savepoint location.&lt;/p&gt;

&lt;p&gt;Moreover the situation gets even weirder (I have not checked it entirely), if we have a mixture of &lt;tt&gt;ExternallyInducedSource(s)&lt;/tt&gt; and regular sources. In such a case the location and format at which the state of a particular task is persisted depends on the order of barriers arrival. If a barrier from a regular source arrives last the task takes a savepoint, on the other hand if last barrier is from an externally induced source it will take a checkpoint.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13416531">FLINK-25256</key>
            <summary>Savepoints do not work with ExternallyInducedSources</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arvid">Arvid Heise</assignee>
                                    <reporter username="dwysakowicz">Dawid Wysakowicz</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>stale-assigned</label>
                    </labels>
                <created>Fri, 10 Dec 2021 10:52:13 +0000</created>
                <updated>Thu, 30 Mar 2023 10:54:14 +0000</updated>
                            <resolved>Fri, 15 Jul 2022 12:30:48 +0000</resolved>
                                    <version>1.14.0</version>
                    <version>1.13.3</version>
                    <version>1.12.7</version>
                                    <fixVersion>1.15.0</fixVersion>
                    <fixVersion>1.16.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17457060" author="dawidwys" created="Fri, 10 Dec 2021 10:53:35 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17457073" author="pnowojski" created="Fri, 10 Dec 2021 11:12:12 +0000"  >&lt;p&gt;This is related to supporting/handling &quot;force full snapshot&quot; flag in the -no-claim recovery mode.&lt;/p&gt;</comment>
                            <comment id="17499438" author="dawidwys" created="Tue, 1 Mar 2022 10:29:00 +0000"  >&lt;p&gt;Externally induced sources are quite limited atm. How important is the feature for Pravega connector? See also &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-26392&lt;/a&gt; As far as I know it is the only one that has ever used it. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Brian+Zhou&quot; class=&quot;user-hover&quot; rel=&quot;Brian Zhou&quot;&gt;Brian Zhou&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jqin&quot; class=&quot;user-hover&quot; rel=&quot;jqin&quot;&gt;jqin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17499879" author="brian zhou" created="Wed, 2 Mar 2022 03:48:56 +0000"  >&lt;p&gt;Yes, this interface is now used in the both the legacy reader and our coming FLIP-27 reader(still in review now).&lt;/p&gt;

&lt;p&gt;Let me explain the reason first.&lt;/p&gt;

&lt;p&gt;In general, Pravega handles checkpoint in a different way with other common messaging system such as Kafka. It is a self-contained approach that does not require the extra external management for offsets. Pravega itself has an internal synchronizer to synchronize the read progress for each reader and returns a Checkpoint object on the reader output to have a consistent view of the read progress.&lt;/p&gt;

&lt;p&gt;This is why we need such ExternallyInducedSource interface to integrate with Flink, because we need to control the time we trigger and pass the barrier to achieve the exactly once semantics on the source side.&lt;/p&gt;

&lt;p&gt;We need to fix this issue as we are just starting integrating Flink 1.14.&lt;/p&gt;</comment>
                            <comment id="17500468" author="becket_qin" created="Thu, 3 Mar 2022 03:03:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; Pravega essentially uses an in-band checkpoint style. The checkpoint process is roughly the following:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Flink CheckpointCoordinator initiates the checkpoint, and invokes the MasterHooks.triggerHook(). The Pravega hook then tell the Pravega server that the Flink job has triggered a checkpoint.&lt;/li&gt;
	&lt;li&gt;The Pravega server inserts the checkpoint control messages in the data stream to each of the Prevaga readers of the Flink job.&lt;/li&gt;
	&lt;li&gt;When the Prevaga readers see the checkpoint control messages, they trigger the Flink task checkpoint via the &lt;tt&gt;ExternallyInducedSource.CheckpointTrigger&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;After FLIP-27, the SplitEnumerator can completely replace the MasterHook in JM. But Prevaga connector still relies on the &lt;tt&gt;ExternallyInducedSource.CheckpointTrigger&lt;/tt&gt; to perform checkpoint in the subtasks.&lt;/p&gt;

&lt;p&gt;Ultimately, the requirement is to manipulate the task based on some user space records. A similar requirement is stopping the subtask when it sees a given message in the stream. What we need to think of would be how much control plane actions do we want to expose to the users. So far the two actions we see are taking checkpoint on the tasks and stopping the tasks, and by now such manipulation requirements are only in the Source tasks.&lt;/p&gt;

&lt;p&gt;We can probably just make such records driven task actions a more explicit primitive for the users. For example, we can have an interface like &lt;tt&gt;TaskActionTrigger&lt;/tt&gt;, which is passed to each user logic. And that allows user logic to ask the task to take some action based on the records it processed. That said, I do think such control plane exposure should be minimal.&lt;/p&gt;</comment>
                            <comment id="17500557" author="dawidwys" created="Thu, 3 Mar 2022 07:45:02 +0000"  >&lt;p&gt;I don&apos;t have an opinion on a more explicit control plane at the moment. I&apos;ll abstain from that discussion for now, hope that&apos;s fine.&lt;/p&gt;

&lt;p&gt;The current situation is that we do have interfaces for that use case, for some time already. Unfortunately, they do not work too well in many situations. Does any of you have spare cycles to work on improvements there to get it to a usable state? We would be happy to guide such a contribution through in the runtime team.&lt;/p&gt;</comment>
                            <comment id="17503251" author="brian zhou" created="Wed, 9 Mar 2022 02:02:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; , there are still something we want to know more details.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;What Flink version is affected. From this ticket, I see the affect version is 1.14.0 and 1.13.3, does that mean the earlier versions are not affected?&lt;/li&gt;
	&lt;li&gt;Do you know the exact commit or feature that causes this regression issue? If you can explain more, we are willing to look deeper and work together with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; to fix&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17503274" author="becket_qin" created="Wed, 9 Mar 2022 03:29:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Brian+Zhou&quot; class=&quot;user-hover&quot; rel=&quot;Brian Zhou&quot;&gt;Brian Zhou&lt;/a&gt; I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=renqs&quot; class=&quot;user-hover&quot; rel=&quot;renqs&quot;&gt;renqs&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard&quot; class=&quot;user-hover&quot; rel=&quot;leonard&quot;&gt;Leonard&lt;/a&gt; seems the best person to follow up with this issue.&lt;/p&gt;</comment>
                            <comment id="17503350" author="dawidwys" created="Wed, 9 Mar 2022 07:47:07 +0000"  >&lt;p&gt;All Flink versions are affected. It has never worked properly. It is not a regression.&lt;/p&gt;</comment>
                            <comment id="17504787" author="arvid" created="Fri, 11 Mar 2022 08:29:47 +0000"  >&lt;p&gt;I&apos;ll have a look. I&apos;d focus on FLIP-27 interfaces.&lt;/p&gt;</comment>
                            <comment id="17505212" author="brian zhou" created="Sat, 12 Mar 2022 07:51:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; , I want to ask what the influence is of this issue, for example, what kind of application or state backend settings is not able to recover correctly.&lt;/p&gt;

&lt;p&gt;We have internally tried to reproduce this issue for some basic applications. We&apos;ve found that when savepointing, all of the states are stored in the metadata, which makes the job to recover correctly. We have tried both stateful and stateless apps, both filesystem and rocksdb backend, and always seeing the metadata file in the savepoint directory.&lt;/p&gt;

&lt;p&gt;I understand from the code, it does look incorrect in checkpointing when treating the externally induced source, but we need to get the influence to help us make plans in our product releases.&lt;/p&gt;</comment>
                            <comment id="17513910" author="arvid" created="Tue, 29 Mar 2022 08:15:28 +0000"  >&lt;p&gt;Merged into 1.15 as 5a5490a49866d02ab5c4761f59ddf94c06f42b41..42e978548f44e98fafbf5f62175e48acba8642e0.&lt;/p&gt;</comment>
                            <comment id="17514306" author="arvid" created="Tue, 29 Mar 2022 19:43:30 +0000"  >&lt;p&gt;Merged into master as 7aefdf2c6aefe8c24af30a4f28a59f2780503d21..a4d194e4a0981dceb003508a3178c6a4e0ce0e82. 1.14 backport is pending.&lt;/p&gt;</comment>
                            <comment id="17567000" author="flink-jira-bot" created="Thu, 14 Jul 2022 22:38:22 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issue is assigned but has not received an update in 30 days, so it has been labeled &quot;stale-assigned&quot;.&lt;br/&gt;
If you are still working on the issue, please remove the label and add a comment updating the community on your progress.  If this issue is waiting on feedback, please consider this a reminder to the committer/reviewer. Flink is a very active project, and so we appreciate your patience.&lt;br/&gt;
If you are no longer working on the issue, please unassign yourself so someone else may work on it.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13415593">FLINK-25192</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13529579">FLINK-31560</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13430957">FLINK-26392</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0xjs0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>