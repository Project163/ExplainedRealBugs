<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31420] ThreadInfoRequestCoordinatorTest.testShutDown failed on CI</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31420</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=47076&amp;amp;view=logs&amp;amp;j=4d4a0d10-fca2-5507-8eed-c07f0bdf4887&amp;amp;t=7b25afdf-cc6c-566f-5459-359dc2585798&amp;amp;l=8394&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=47076&amp;amp;view=logs&amp;amp;j=4d4a0d10-fca2-5507-8eed-c07f0bdf4887&amp;amp;t=7b25afdf-cc6c-566f-5459-359dc2585798&amp;amp;l=8394&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Mar 13 03:58:48 [ERROR] Failures: 
Mar 13 03:58:48 [ERROR]   ThreadInfoRequestCoordinatorTest.testShutDown:207 
Mar 13 03:58:48 Expecting
Mar 13 03:58:48   &amp;lt;CompletableFuture[Failed with the following stack trace:
Mar 13 03:58:48 java.lang.RuntimeException: Discarded
Mar 13 03:58:48 	at org.apache.flink.runtime.webmonitor.stats.TaskStatsRequestCoordinator$PendingStatsRequest.discard(TaskStatsRequestCoordinator.java:266)
Mar 13 03:58:48 	at org.apache.flink.runtime.webmonitor.stats.TaskStatsRequestCoordinator.handleFailedResponse(TaskStatsRequestCoordinator.java:114)
Mar 13 03:58:48 	at org.apache.flink.runtime.webmonitor.threadinfo.ThreadInfoRequestCoordinator.lambda$requestThreadInfo$1(ThreadInfoRequestCoordinator.java:152)
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750)
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:456)
Mar 13 03:58:48 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
Mar 13 03:58:48 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
Mar 13 03:58:48 	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:180)
Mar 13 03:58:48 	at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:293)
Mar 13 03:58:48 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
Mar 13 03:58:48 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
Mar 13 03:58:48 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Mar 13 03:58:48 Caused by: java.util.concurrent.CompletionException: java.util.concurrent.TimeoutException: Request timeout.
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:326)
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:338)
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture.uniRelay(CompletableFuture.java:925)
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture$UniRelay.tryFire(CompletableFuture.java:913)
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
Mar 13 03:58:48 	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)
Mar 13 03:58:48 	at org.apache.flink.runtime.webmonitor.threadinfo.ThreadInfoRequestCoordinatorTest.lambda$createMockTaskManagerGateway$2(ThreadInfoRequestCoordinatorTest.java:259)
Mar 13 03:58:48 	... 6 more
Mar 13 03:58:48 Caused by: java.util.concurrent.TimeoutException: Request timeout.
Mar 13 03:58:48 	... 7 more
Mar 13 03:58:48 ]&amp;gt;
Mar 13 03:58:48 not to be done.
Mar 13 03:58:48 Be aware that the state of the &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; message might not reflect the one at the time when the assertion was performed as it is evaluated later on &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13528219">FLINK-31420</key>
            <summary>ThreadInfoRequestCoordinatorTest.testShutDown failed on CI</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Weijie Guo">Weijie Guo</assignee>
                                    <reporter username="renqs">Qingsheng Ren</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 13 Mar 2023 10:29:05 +0000</created>
                <updated>Wed, 15 Mar 2023 14:46:59 +0000</updated>
                            <resolved>Wed, 15 Mar 2023 14:46:59 +0000</resolved>
                                    <version>1.16.2</version>
                                    <fixVersion>1.16.2</fixVersion>
                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.17.1</fixVersion>
                                    <component>Runtime / REST</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17699547" author="renqs" created="Mon, 13 Mar 2023 10:29:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fanrui&quot; class=&quot;user-hover&quot; rel=&quot;fanrui&quot;&gt;fanrui&lt;/a&gt;&#160;Could you take a look on this one? Thanks&lt;/p&gt;</comment>
                            <comment id="17699671" author="weijie guo" created="Mon, 13 Mar 2023 14:17:27 +0000"  >&lt;p&gt;After checking the code, I found that this is a test code issue. IIUC, This should be a problem that has existed for a long time, I don&apos;t know why it has not been revealed until now, but the probability of triggering this exception is very low. I will fix it asap.&lt;/p&gt;

&lt;p&gt;The key point is &lt;tt&gt;ThreadInfoRequestCoordinatorTest#testShutDown&lt;/tt&gt; using two gateways contains a timeout gateway but expected all request futures not done before &lt;tt&gt;shutdown&lt;/tt&gt;. If the timeout reached, this future will be failed, result in request futures to be done. This makes the test strongly dependent on the execution order of assertion and timeout, thus causing this test unstable.&lt;/p&gt;</comment>
                            <comment id="17700588" author="weijie guo" created="Wed, 15 Mar 2023 09:56:04 +0000"  >&lt;p&gt;master(1.18) via 7fccd5992f6222df62ed850542ef50b0714cd647.&lt;br/&gt;
release-1.17 via 6eb213d9093d90a7bd91801abfb822edf51f90bb.&lt;br/&gt;
release-1.16 via 3ffd113365e69185b871b2b683067b1541a17e5c.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13056376" name="image-2023-03-15-22-45-54-585.png" size="86084" author="Weijie Guo" created="Wed, 15 Mar 2023 14:45:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1gj7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>