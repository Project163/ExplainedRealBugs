<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:01:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24035] Fix the deadlock issue caused by buffer listeners may not be notified</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24035</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The buffer listeners are not notified when the&#160;the local buffer pool receives available notification from the global pool. This may cause potential deadlock issue:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;A LocalBufferPool is created, but there is no available buffers in the global NetworkBufferPool.&lt;/li&gt;
	&lt;li&gt;The LocalBufferPool&#160;registers an available buffer listener to the global NetworkBufferPool.&lt;/li&gt;
	&lt;li&gt;The BufferManager requests buffers from the&#160;LocalBufferPool but no buffer is available. As a result, it registers an&#160;available buffer listener to the&#160;LocalBufferPool.&lt;/li&gt;
	&lt;li&gt;A buffer is recycled to the global pool and the local buffer pool is notified about the available buffer.&lt;/li&gt;
	&lt;li&gt;The local buffer pool requests the available buffer from the global pool but the registered&#160;available buffer listener of BufferManager is not notified and it can never get a chance to be notified so deadlock occurs.&lt;/li&gt;
&lt;/ol&gt;

</description>
                <environment></environment>
        <key id="13397927">FLINK-24035</key>
            <summary>Fix the deadlock issue caused by buffer listeners may not be notified</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kevin.cyj">Yingjie Cao</assignee>
                                    <reporter username="kevin.cyj">Yingjie Cao</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 28 Aug 2021 02:39:37 +0000</created>
                <updated>Tue, 21 Dec 2021 15:45:58 +0000</updated>
                            <resolved>Wed, 1 Sep 2021 16:09:19 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.15.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17407102" author="pnowojski" created="Tue, 31 Aug 2021 06:19:14 +0000"  >&lt;p&gt;Merged to master as d82b69ef5db&lt;br/&gt;
Merged to release-1.14 as 851ed821bdf&lt;/p&gt;</comment>
                            <comment id="17407129" author="pnowojski" created="Tue, 31 Aug 2021 07:04:40 +0000"  >&lt;p&gt;Solution here is to always request at least a single buffer.&lt;/p&gt;

&lt;p&gt;This is not an issue on the output side, because there are no &lt;tt&gt;BufferListeners&lt;/tt&gt; in that case. Also if buffer is requested on the output side, it will be used and eventually flushed.&lt;/p&gt;

&lt;p&gt;On the input on the other hand, with exclusive buffers &amp;gt; 0, we are already requesting exclusive buffers in a blocking way with a timeout (&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-12852&quot; title=&quot;[hotfix timeout] Deadlock occurs when requiring exclusive buffer for RemoteInputChannel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-12852&quot;&gt;&lt;del&gt;FLINK-12852&lt;/del&gt;&lt;/a&gt;), so we know that task will be able to make progress regardless if we notify about more buffers or not. With exclusive buffers = 0, this solution requests a single floating buffer, so we will also be able to make a progress. Once data starts flowing/this single buffer will be recycled, listeners would be notified and more buffers would be requested.&lt;/p&gt;</comment>
                            <comment id="17407138" author="pnowojski" created="Tue, 31 Aug 2021 07:16:07 +0000"  >&lt;p&gt;Re-opening as we want to refactor the code that we have just merged a bit.&lt;/p&gt;</comment>
                            <comment id="17407139" author="pnowojski" created="Tue, 31 Aug 2021 07:17:48 +0000"  >&lt;p&gt;This is a similar problem as in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13203&quot; title=&quot;[proper fix] Deadlock occurs when requiring exclusive buffer for RemoteInputChannel&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13203&quot;&gt;FLINK-13203&lt;/a&gt;. We need to setup the input gates in a such way, that we are sure that they can always make progress.&lt;/p&gt;</comment>
                            <comment id="17407312" author="kevin.cyj" created="Tue, 31 Aug 2021 12:44:57 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;. I opened a refactor PR for this:&#160;&lt;a href=&quot;https://github.com/apache/flink/pull/17075&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/17075.&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17408258" author="pnowojski" created="Wed, 1 Sep 2021 16:09:19 +0000"  >&lt;p&gt;Follow up refactor&lt;br/&gt;
merged commit 75adb32 into apache:master now&lt;br/&gt;
merged as 4c826c8c3d9 into release-1.14&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13415532">FLINK-25185</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13418857">FLINK-25407</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13391269">FLINK-23466</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13244241">FLINK-13203</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13239507">FLINK-12852</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ud7c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>