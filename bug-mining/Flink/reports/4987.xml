<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15660] Redundant AllocationID verification for allocateSlot in TaskSlotTable</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15660</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12991311/12991311_image-2020-01-19-15-46-42-664.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In function TaskSlotTable::allocateSlot, first we will check whether allocationId is exist, when exist we will refused this allocation, this was introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14589&quot; title=&quot;Redundant slot requests with the same AllocationID leads to inconsistent slot table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14589&quot;&gt;&lt;del&gt;FLINK-14589&lt;/del&gt;&lt;/a&gt; . But in &lt;del&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14189&quot; title=&quot;Extend TaskExecutor to support dynamic slot allocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14189&quot;&gt;&lt;del&gt;FLINK-14189&lt;/del&gt;&lt;/a&gt;&lt;/del&gt;, when allocationId exist, we think this is valid, which is contradictory with the first check.&lt;/p&gt;

&lt;p&gt;&#160;The code is following:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/flink/blob/310452e800355f0dcc4bc9dd26e9cecba263f3d6/flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/slot/TaskSlotTable.java#L261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/310452e800355f0dcc4bc9dd26e9cecba263f3d6/flink-runtime/src/main/java/org/apache/flink/runtime/taskexecutor/slot/TaskSlotTable.java#L261&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13280363">FLINK-15660</key>
            <summary>Redundant AllocationID verification for allocateSlot in TaskSlotTable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tedxia">xiajun</reporter>
                        <labels>
                    </labels>
                <created>Sun, 19 Jan 2020 07:42:01 +0000</created>
                <updated>Fri, 8 Jan 2021 10:33:20 +0000</updated>
                            <resolved>Fri, 8 Jan 2021 10:33:19 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.13.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17018842" author="xintongsong" created="Sun, 19 Jan 2020 08:33:29 +0000"  >&lt;p&gt;Thanks for reporting this issue, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedxia&quot; class=&quot;user-hover&quot; rel=&quot;tedxia&quot;&gt;tedxia&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;This is indeed inconsistency caused by concurrent efforts on &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14589&quot; title=&quot;Redundant slot requests with the same AllocationID leads to inconsistent slot table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14589&quot;&gt;&lt;del&gt;FLINK-14589&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14189&quot; title=&quot;Extend TaskExecutor to support dynamic slot allocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14189&quot;&gt;&lt;del&gt;FLINK-14189&lt;/del&gt;&lt;/a&gt;. To my understanding, the root contradiction is what should &lt;tt&gt;TaskSlotTable::allocateSlot&lt;/tt&gt; return for duplicated allocation id when other information (job id, slot index, etc.) is consistent. I think both returning true and false should work, as long as the contract of &lt;tt&gt;TaskSlotTable::allocateSlot&lt;/tt&gt; is consistent.&lt;/p&gt;

&lt;p&gt;The good news is that, this inconsistent logic does not cause any problem at the moment. All we need now is a code clean-up without any behavior changes.&lt;/p&gt;

&lt;p&gt;Please help double check on this, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azagrebin&quot; class=&quot;user-hover&quot; rel=&quot;azagrebin&quot;&gt;azagrebin&lt;/a&gt;. Thx~&lt;/p&gt;</comment>
                            <comment id="17027365" author="zentol" created="Fri, 31 Jan 2020 10:37:32 +0000"  >&lt;p&gt;Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=azagrebin&quot; class=&quot;user-hover&quot; rel=&quot;azagrebin&quot;&gt;azagrebin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17186433" author="azagrebin" created="Fri, 28 Aug 2020 09:53:55 +0000"  >&lt;p&gt;I agree one of the highlighted &apos;if&apos;s is probably redundant. The second &apos;else if&apos; will never be executed atm. I believe the first &apos;if&apos; is already covered by the next &apos;if/else if&apos;. In a long term, the&#160;next &apos;if/else if&apos; &#160;makes more sense for both static and dynamic covering &lt;del&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14589&quot; title=&quot;Redundant slot requests with the same AllocationID leads to inconsistent slot table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14589&quot;&gt;&lt;del&gt;FLINK-14589&lt;/del&gt;&lt;/a&gt;&lt;/del&gt;&#160;as well. Therefore, I would remove the first &apos;if&apos;.&lt;/p&gt;</comment>
                            <comment id="17186447" author="zentol" created="Fri, 28 Aug 2020 10:12:00 +0000"  >&lt;p&gt;The code in question will likely be refactored once we have finalized FLIP-138 and it&apos;s follow-ups.&lt;/p&gt;</comment>
                            <comment id="17261208" author="xintongsong" created="Fri, 8 Jan 2021 10:33:20 +0000"  >&lt;p&gt;Subsumed by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-20837&quot; title=&quot;Refactor dynamic SlotID&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-20837&quot;&gt;&lt;del&gt;FLINK-20837&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Fixed via&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;master (1.13): c6443a501ef26ebc0c30ddb630e75926757a12d3&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Not fixing for previous major releases, since the dynamic slot feature were not activated.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12991311" name="image-2020-01-19-15-46-42-664.png" size="82469" author="tedxia" created="Sun, 19 Jan 2020 07:46:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0anog:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>