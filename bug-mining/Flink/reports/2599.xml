<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10159] TestHarness#initializeState(xyz) calls after TestHarness#open() are being silently ignored</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10159</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This is an old issue. Incorrect order of initializeState and open result to initializeState being ignored. For example in this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testHarness = createTestHarness(topic);
testHarness.setup();
testHarness.open();
testHarness.initializeState(snapshot1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which is miss-leading both for Flink developers and for users (since we recommend using test harness for unit tests).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13179326">FLINK-10159</key>
            <summary>TestHarness#initializeState(xyz) calls after TestHarness#open() are being silently ignored</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pnowojski">Piotr Nowojski</assignee>
                                    <reporter username="pnowojski">Piotr Nowojski</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 16 Aug 2018 11:37:25 +0000</created>
                <updated>Fri, 17 Aug 2018 07:34:31 +0000</updated>
                            <resolved>Fri, 17 Aug 2018 07:34:06 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16582719" author="githubbot" created="Thu, 16 Aug 2018 15:42:11 +0000"  >&lt;p&gt;pnowojski opened a new pull request #6570: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10159&quot; title=&quot;TestHarness#initializeState(xyz) calls after TestHarness#open() are being silently ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10159&quot;&gt;&lt;del&gt;FLINK-10159&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Fail TestHarness.initializeState if harness has already been initialized&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6570&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This is a change in tests only. Previously it was technically possible to call first `harness.open()` followed by `harness.initializeState(fooBar)`. However this was incorrect, since `open()` was already calling `initializeState(null)`, which was leading to quirks. This commit adds a `checkState` which makes sure that `initializeState` is called only once.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16583496" author="githubbot" created="Fri, 17 Aug 2018 07:33:07 +0000"  >&lt;p&gt;pnowojski closed pull request #6570: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10159&quot; title=&quot;TestHarness#initializeState(xyz) calls after TestHarness#open() are being silently ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10159&quot;&gt;&lt;del&gt;FLINK-10159&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Fail TestHarness.initializeState if harness has already been initialized&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6570&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011ITCase.java b/flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011ITCase.java&lt;br/&gt;
index 74c58ad2891..57b7e77dc7f 100644&lt;br/&gt;
&amp;#8212; a/flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011ITCase.java&lt;br/&gt;
+++ b/flink-connectors/flink-connector-kafka-0.11/src/test/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011ITCase.java&lt;br/&gt;
@@ -172,7 +172,6 @@ public void testFlinkKafkaProducer011FailBeforeNotify() throws Exception {&lt;/p&gt;

&lt;p&gt; 		testHarness.setup();&lt;br/&gt;
 		testHarness.open();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testHarness.initializeState(null);&lt;br/&gt;
 		testHarness.processElement(42, 0);&lt;br/&gt;
 		testHarness.snapshot(0, 1);&lt;br/&gt;
 		testHarness.processElement(43, 2);&lt;br/&gt;
@@ -225,7 +224,6 @@ public void testFlinkKafkaProducer011FailTransactionCoordinatorBeforeNotify() th&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		testHarness1.setup();&lt;br/&gt;
 		testHarness1.open();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testHarness1.initializeState(null);&lt;br/&gt;
 		testHarness1.processElement(42, 0);&lt;br/&gt;
 		testHarness1.snapshot(0, 1);&lt;br/&gt;
 		testHarness1.processElement(43, 2);&lt;br/&gt;
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/checkpoint/ListCheckpointedTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/checkpoint/ListCheckpointedTest.java&lt;br/&gt;
index ff0b0fcb172..644ab04fb70 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/checkpoint/ListCheckpointedTest.java&lt;br/&gt;
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/checkpoint/ListCheckpointedTest.java&lt;br/&gt;
@@ -30,6 +30,9 @@&lt;br/&gt;
 import java.util.Collections;&lt;br/&gt;
 import java.util.List;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+import static org.junit.Assert.assertFalse;&lt;br/&gt;
+import static org.junit.Assert.assertTrue;&lt;br/&gt;
+&lt;br/&gt;
 /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Tests for 
{@link ListCheckpointed}
&lt;p&gt;.&lt;br/&gt;
  */&lt;br/&gt;
@@ -37,35 +40,39 @@&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Test&lt;br/&gt;
 	public void testUDFReturningNull() throws Exception &lt;/p&gt;
{
-		TestUserFunction userFunction = new TestUserFunction(null);
-		AbstractStreamOperatorTestHarness&amp;lt;Integer&amp;gt; testHarness =
-				new AbstractStreamOperatorTestHarness&amp;lt;&amp;gt;(new StreamMap&amp;lt;&amp;gt;(userFunction), 1, 1, 0);
-		testHarness.open();
-		OperatorSubtaskState snapshot = testHarness.snapshot(0L, 0L);
-		testHarness.initializeState(snapshot);
-		Assert.assertTrue(userFunction.isRestored());
+		testUDF(new TestUserFunction(null));
 	}

&lt;p&gt; 	@Test&lt;br/&gt;
 	public void testUDFReturningEmpty() throws Exception &lt;/p&gt;
{
-		TestUserFunction userFunction = new TestUserFunction(Collections.&amp;lt;Integer&amp;gt;emptyList());
-		AbstractStreamOperatorTestHarness&amp;lt;Integer&amp;gt; testHarness =
-				new AbstractStreamOperatorTestHarness&amp;lt;&amp;gt;(new StreamMap&amp;lt;&amp;gt;(userFunction), 1, 1, 0);
-		testHarness.open();
-		OperatorSubtaskState snapshot = testHarness.snapshot(0L, 0L);
-		testHarness.initializeState(snapshot);
-		Assert.assertTrue(userFunction.isRestored());
+		testUDF(new TestUserFunction(Collections.&amp;lt;Integer&amp;gt;emptyList()));
 	}

&lt;p&gt; 	@Test&lt;br/&gt;
 	public void testUDFReturningData() throws Exception &lt;/p&gt;
{
-		TestUserFunction userFunction = new TestUserFunction(Arrays.asList(1, 2, 3));
-		AbstractStreamOperatorTestHarness&amp;lt;Integer&amp;gt; testHarness =
-				new AbstractStreamOperatorTestHarness&amp;lt;&amp;gt;(new StreamMap&amp;lt;&amp;gt;(userFunction), 1, 1, 0);
-		testHarness.open();
-		OperatorSubtaskState snapshot = testHarness.snapshot(0L, 0L);
-		testHarness.initializeState(snapshot);
-		Assert.assertTrue(userFunction.isRestored());
+		testUDF(new TestUserFunction(Arrays.asList(1, 2, 3)));
+	}
&lt;p&gt;+&lt;br/&gt;
+	private static void testUDF(TestUserFunction userFunction) throws Exception {&lt;br/&gt;
+		OperatorSubtaskState snapshot;&lt;br/&gt;
+		try (AbstractStreamOperatorTestHarness&amp;lt;Integer&amp;gt; testHarness = createTestHarness(userFunction)) &lt;/p&gt;
{
+			testHarness.open();
+			snapshot = testHarness.snapshot(0L, 0L);
+			assertFalse(userFunction.isRestored());
+		}
&lt;p&gt;+		try (AbstractStreamOperatorTestHarness&amp;lt;Integer&amp;gt; testHarness = createTestHarness(userFunction)) &lt;/p&gt;
{
+			testHarness.initializeState(snapshot);
+			testHarness.open();
+			assertTrue(userFunction.isRestored());
+		}
&lt;p&gt;+	}&lt;br/&gt;
+&lt;br/&gt;
+	private static AbstractStreamOperatorTestHarness&amp;lt;Integer&amp;gt; createTestHarness(TestUserFunction userFunction) throws Exception &lt;/p&gt;
{
+		return new AbstractStreamOperatorTestHarness&amp;lt;&amp;gt;(
+			new StreamMap&amp;lt;&amp;gt;(userFunction),
+			1,
+			1,
+			0);
 	}

&lt;p&gt; 	private static class TestUserFunction extends RichMapFunction&amp;lt;Integer, Integer&amp;gt; implements ListCheckpointed&amp;lt;Integer&amp;gt; {&lt;br/&gt;
@@ -95,7 +102,7 @@ public void restoreState(List&amp;lt;Integer&amp;gt; state) throws Exception {&lt;br/&gt;
 			if (null != expected) &lt;/p&gt;
{
 				Assert.assertEquals(expected, state);
 			}
&lt;p&gt; else &lt;/p&gt;
{
-				Assert.assertTrue(state.isEmpty());
+				assertTrue(state.isEmpty());
 			}
&lt;p&gt; 			restored = true;&lt;br/&gt;
 		}&lt;br/&gt;
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java&lt;br/&gt;
index 166dc5a622a..2970b87789d 100644&lt;br/&gt;
&amp;#8212; a/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java&lt;br/&gt;
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/api/functions/sink/TwoPhaseCommitSinkFunctionTest.java&lt;br/&gt;
@@ -195,10 +195,14 @@ public void testIgnoreCommitExceptionDuringRecovery() throws Exception {&lt;br/&gt;
 		final OperatorSubtaskState snapshot = harness.snapshot(0, 1);&lt;br/&gt;
 		harness.notifyOfCompletedCheckpoint(1);&lt;/p&gt;

&lt;p&gt;+		throwException.set(true);&lt;br/&gt;
+&lt;br/&gt;
+		closeTestHarness();&lt;br/&gt;
+		setUpTestHarness();&lt;br/&gt;
+&lt;br/&gt;
 		final long transactionTimeout = 1000;&lt;br/&gt;
 		sinkFunction.setTransactionTimeout(transactionTimeout);&lt;br/&gt;
 		sinkFunction.ignoreFailuresAfterTransactionTimeout();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;throwException.set(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		try {&lt;br/&gt;
 			harness.initializeState(snapshot);&lt;br/&gt;
@@ -251,11 +255,20 @@ public void testLogTimeoutAlmostReachedWarningDuringRecovery() throws Exception&lt;br/&gt;
 		final OperatorSubtaskState snapshot = harness.snapshot(0, 1);&lt;br/&gt;
 		final long elapsedTime = (long) ((double) transactionTimeout * warningRatio + 2);&lt;br/&gt;
 		clock.setEpochMilli(elapsedTime);&lt;br/&gt;
+&lt;br/&gt;
+		closeTestHarness();&lt;br/&gt;
+		setUpTestHarness();&lt;br/&gt;
+		sinkFunction.setTransactionTimeout(transactionTimeout);&lt;br/&gt;
+		sinkFunction.enableTransactionTimeoutWarnings(warningRatio);&lt;br/&gt;
+&lt;br/&gt;
 		harness.initializeState(snapshot);&lt;br/&gt;
+		harness.open();&lt;/p&gt;

&lt;p&gt; 		final List&amp;lt;String&amp;gt; logMessages =&lt;br/&gt;
 			loggingEvents.stream().map(LoggingEvent::getRenderedMessage).collect(Collectors.toList());&lt;/p&gt;

&lt;p&gt;+		closeTestHarness();&lt;br/&gt;
+&lt;br/&gt;
 		assertThat(&lt;br/&gt;
 			logMessages,&lt;br/&gt;
 			hasItem(containsString(&quot;has been open for 502 ms. &quot; +&lt;br/&gt;
diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarness.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarness.java&lt;br/&gt;
index 2f19ce28e48..0e120eb766e 100644&lt;br/&gt;
&amp;#8212; a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarness.java&lt;br/&gt;
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarness.java&lt;br/&gt;
@@ -80,6 +80,7 @@&lt;br/&gt;
 import java.util.Optional;&lt;br/&gt;
 import java.util.concurrent.ConcurrentLinkedQueue;&lt;/p&gt;

&lt;p&gt;+import static org.apache.flink.util.Preconditions.checkState;&lt;br/&gt;
 import static org.mockito.Matchers.any;&lt;br/&gt;
 import static org.mockito.Mockito.doAnswer;&lt;br/&gt;
 import static org.mockito.Mockito.mock;&lt;br/&gt;
@@ -138,16 +139,9 @@ public AbstractStreamOperatorTestHarness(&lt;br/&gt;
 			int subtaskIndex) throws Exception &lt;/p&gt;
{
 		this(
 			operator,
-			new MockEnvironmentBuilder()
-				.setTaskName(&quot;MockTask&quot;)
-				.setMemorySize(3 * 1024 * 1024)
-				.setInputSplitProvider(new MockInputSplitProvider())
-				.setBufferSize(1024)
-				.setMaxParallelism(maxParallelism)
-				.setParallelism(parallelism)
-				.setSubtaskIndex(subtaskIndex)
-				.build(),
-			true,
+			maxParallelism,
+			parallelism,
+			subtaskIndex,
 			new OperatorID());
 	}

&lt;p&gt;@@ -359,6 +353,8 @@ public void initializeState(&lt;br/&gt;
 		OperatorSubtaskState jmOperatorStateHandles,&lt;br/&gt;
 		OperatorSubtaskState tmOperatorStateHandles) throws Exception {&lt;/p&gt;

&lt;p&gt;+		checkState(!initializeCalled, &quot;TestHarness has already been initialized. Have you &quot; +&lt;br/&gt;
+			&quot;opened this harness before initializing it?&quot;);&lt;br/&gt;
 		if (!setupCalled) &lt;/p&gt;
{
 			setup();
 		}
&lt;p&gt;diff --git a/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarnessTest.java b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarnessTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..65f62a363d0&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/flink-streaming-java/src/test/java/org/apache/flink/streaming/util/AbstractStreamOperatorTestHarnessTest.java&lt;br/&gt;
@@ -0,0 +1,55 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ * &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.streaming.util;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.runtime.checkpoint.OperatorSubtaskState;&lt;br/&gt;
+import org.apache.flink.streaming.api.operators.AbstractStreamOperator;&lt;br/&gt;
+import org.apache.flink.util.TestLogger;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Rule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+import org.junit.rules.ExpectedException;&lt;br/&gt;
+&lt;br/&gt;
+import static org.hamcrest.CoreMatchers.containsString;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Tests for &lt;/p&gt;
{@link AbstractStreamOperatorTestHarness}
&lt;p&gt;.&lt;br/&gt;
+ */&lt;br/&gt;
+public class AbstractStreamOperatorTestHarnessTest extends TestLogger {&lt;br/&gt;
+	@Rule&lt;br/&gt;
+	public ExpectedException expectedException = ExpectedException.none();&lt;br/&gt;
+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testInitializeAfterOpenning() throws Throwable {&lt;br/&gt;
+		expectedException.expect(IllegalStateException.class);&lt;br/&gt;
+		expectedException.expectMessage(containsString(&quot;TestHarness has already been initialized.&quot;));&lt;br/&gt;
+&lt;br/&gt;
+		AbstractStreamOperatorTestHarness&amp;lt;Integer&amp;gt; result;&lt;br/&gt;
+		result =&lt;br/&gt;
+			new AbstractStreamOperatorTestHarness&amp;lt;&amp;gt;(&lt;br/&gt;
+				new AbstractStreamOperator&amp;lt;Integer&amp;gt;() &lt;/p&gt;
{
+				}
&lt;p&gt;,&lt;br/&gt;
+				1,&lt;br/&gt;
+				1,&lt;br/&gt;
+				0);&lt;br/&gt;
+		result.setup();&lt;br/&gt;
+		result.open();&lt;br/&gt;
+		result.initializeState(new OperatorSubtaskState());&lt;br/&gt;
+	}&lt;br/&gt;
+}&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16583497" author="githubbot" created="Fri, 17 Aug 2018 07:33:35 +0000"  >&lt;p&gt;pnowojski commented on issue #6570: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10159&quot; title=&quot;TestHarness#initializeState(xyz) calls after TestHarness#open() are being silently ignored&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10159&quot;&gt;&lt;del&gt;FLINK-10159&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Fail TestHarness.initializeState if harness has already been initialized&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6570#issuecomment-413782923&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6570#issuecomment-413782923&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks! Merged.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16583499" author="pnowojski" created="Fri, 17 Aug 2018 07:34:31 +0000"  >&lt;p&gt;Merged on master as&#160;b70f783911112424b5bdb4119ee8fdbfe16fee13&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x40v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>