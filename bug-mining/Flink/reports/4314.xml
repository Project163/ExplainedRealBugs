<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:47:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17824] &quot;Resuming Savepoint&quot; e2e stalls indefinitely </title>
                <link>https://issues.apache.org/jira/browse/FLINK-17824</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;CI; &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=1887&amp;amp;view=logs&amp;amp;j=91bf6583-3fb2-592f-e4d4-d79d79c3230a&amp;amp;t=94459a52-42b6-5bfc-5d74-690b5d3c6de8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=1887&amp;amp;view=logs&amp;amp;j=91bf6583-3fb2-592f-e4d4-d79d79c3230a&amp;amp;t=94459a52-42b6-5bfc-5d74-690b5d3c6de8&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-05-19T21:05:52.9696236Z ==============================================================================
2020-05-19T21:05:52.9696860Z Running &lt;span class=&quot;code-quote&quot;&gt;&apos;Resuming Savepoint (file, async, scale down) end-to-end test&apos;&lt;/span&gt;
2020-05-19T21:05:52.9697243Z ==============================================================================
2020-05-19T21:05:52.9713094Z TEST_DATA_DIR: /home/vsts/work/1/s/flink-end-to-end-tests/test-scripts/temp-test-directory-52970362751
2020-05-19T21:05:53.1194478Z Flink dist directory: /home/vsts/work/1/s/flink-dist/target/flink-1.12-SNAPSHOT-bin/flink-1.12-SNAPSHOT
2020-05-19T21:05:53.2180375Z Starting cluster.
2020-05-19T21:05:53.9986167Z Starting standalonesession daemon on host fv-az558.
2020-05-19T21:05:55.5997224Z Starting taskexecutor daemon on host fv-az558.
2020-05-19T21:05:55.6223837Z Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Dispatcher REST endpoint to come up...
2020-05-19T21:05:57.0552482Z Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Dispatcher REST endpoint to come up...
2020-05-19T21:05:57.9446865Z Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Dispatcher REST endpoint to come up...
2020-05-19T21:05:59.0098434Z Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Dispatcher REST endpoint to come up...
2020-05-19T21:06:00.0569710Z Dispatcher REST endpoint is up.
2020-05-19T21:06:07.7099937Z Job (a92a74de8446a80403798bb4806b73f3) is running.
2020-05-19T21:06:07.7855906Z Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job to process up to 200 records, current progress: 114 records ...
2020-05-19T21:06:55.5755111Z 
2020-05-19T21:06:55.5756550Z ------------------------------------------------------------
2020-05-19T21:06:55.5757225Z  The program finished with the following exception:
2020-05-19T21:06:55.5757566Z 
2020-05-19T21:06:55.5765453Z org.apache.flink.util.FlinkException: Could not stop with a savepoint job &lt;span class=&quot;code-quote&quot;&gt;&quot;a92a74de8446a80403798bb4806b73f3&quot;&lt;/span&gt;.
2020-05-19T21:06:55.5766873Z 	at org.apache.flink.client.cli.CliFrontend.lambda$stop$5(CliFrontend.java:485)
2020-05-19T21:06:55.5767980Z 	at org.apache.flink.client.cli.CliFrontend.runClusterAction(CliFrontend.java:854)
2020-05-19T21:06:55.5769014Z 	at org.apache.flink.client.cli.CliFrontend.stop(CliFrontend.java:477)
2020-05-19T21:06:55.5770052Z 	at org.apache.flink.client.cli.CliFrontend.parseParameters(CliFrontend.java:921)
2020-05-19T21:06:55.5771107Z 	at org.apache.flink.client.cli.CliFrontend.lambda$main$10(CliFrontend.java:982)
2020-05-19T21:06:55.5772223Z 	at org.apache.flink.runtime.security.contexts.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:30)
2020-05-19T21:06:55.5773325Z 	at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:982)
2020-05-19T21:06:55.5774871Z Caused by: java.util.concurrent.ExecutionException: java.util.concurrent.CompletionException: java.util.concurrent.CompletionException: org.apache.flink.runtime.checkpoint.CheckpointException: Checkpoint Coordinator is suspending.
2020-05-19T21:06:55.5777183Z 	at java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:357)
2020-05-19T21:06:55.5778884Z 	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928)
2020-05-19T21:06:55.5779920Z 	at org.apache.flink.client.cli.CliFrontend.lambda$stop$5(CliFrontend.java:483)
2020-05-19T21:06:55.5781175Z 	... 6 more
2020-05-19T21:06:55.5782391Z Caused by: java.util.concurrent.CompletionException: java.util.concurrent.CompletionException: org.apache.flink.runtime.checkpoint.CheckpointException: Checkpoint Coordinator is suspending.
2020-05-19T21:06:55.5783885Z 	at org.apache.flink.runtime.scheduler.SchedulerBase.lambda$stopWithSavepoint$9(SchedulerBase.java:890)
2020-05-19T21:06:55.5784992Z 	at java.util.concurrent.CompletableFuture.uniHandle(CompletableFuture.java:836)
2020-05-19T21:06:55.5786492Z 	at java.util.concurrent.CompletableFuture$UniHandle.tryFire(CompletableFuture.java:811)
2020-05-19T21:06:55.5787601Z 	at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:456)
2020-05-19T21:06:55.5788682Z 	at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRunAsync(AkkaRpcActor.java:402)
2020-05-19T21:06:55.5790308Z 	at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:195)
2020-05-19T21:06:55.5791664Z 	at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:74)
2020-05-19T21:06:55.5792767Z 	at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleMessage(AkkaRpcActor.java:152)
2020-05-19T21:06:55.5793756Z 	at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:26)
2020-05-19T21:06:55.5794652Z 	at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:21)
2020-05-19T21:06:55.5795605Z 	at scala.PartialFunction$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;applyOrElse(PartialFunction.scala:123)
2020-05-19T21:06:55.5796551Z 	at akka.japi.pf.UnitCaseStatement.applyOrElse(CaseStatements.scala:21)
2020-05-19T21:06:55.5797459Z 	at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:170)
2020-05-19T21:06:55.5798390Z 	at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171)
2020-05-19T21:06:55.5799311Z 	at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171)
2020-05-19T21:06:55.5800175Z 	at akka.actor.Actor$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;aroundReceive(Actor.scala:517)
2020-05-19T21:06:55.5801078Z 	at akka.actor.AbstractActor.aroundReceive(AbstractActor.scala:225)
2020-05-19T21:06:55.5802741Z 	at akka.actor.ActorCell.receiveMessage(ActorCell.scala:592)
2020-05-19T21:06:55.5803579Z 	at akka.actor.ActorCell.invoke(ActorCell.scala:561)
2020-05-19T21:06:55.5804628Z 	at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:258)
2020-05-19T21:06:55.5805435Z 	at akka.dispatch.Mailbox.run(Mailbox.scala:225)
2020-05-19T21:06:55.5806194Z 	at akka.dispatch.Mailbox.exec(Mailbox.scala:235)
2020-05-19T21:06:55.5807037Z 	at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
2020-05-19T21:06:55.5808001Z 	at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
2020-05-19T21:06:55.5808984Z 	at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
2020-05-19T21:06:55.5809970Z 	at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
2020-05-19T21:06:55.5811188Z Caused by: java.util.concurrent.CompletionException: org.apache.flink.runtime.checkpoint.CheckpointException: Checkpoint Coordinator is suspending.
2020-05-19T21:06:55.5813260Z 	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
2020-05-19T21:06:55.5814556Z 	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
2020-05-19T21:06:55.5815578Z 	at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:607)
2020-05-19T21:06:55.5816604Z 	at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)
2020-05-19T21:06:55.5817663Z 	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
2020-05-19T21:06:55.5822918Z 	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)
2020-05-19T21:06:55.5824096Z 	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.lambda$&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;$0(CheckpointCoordinator.java:464)
2020-05-19T21:06:55.5825220Z 	at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)
2020-05-19T21:06:55.5826274Z 	at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750)
2020-05-19T21:06:55.5827334Z 	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
2020-05-19T21:06:55.5828369Z 	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)
2020-05-19T21:06:55.5830735Z 	at org.apache.flink.runtime.checkpoint.PendingCheckpoint.abort(PendingCheckpoint.java:493)
2020-05-19T21:06:55.5831962Z 	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.abortPendingCheckpoint(CheckpointCoordinator.java:1565)
2020-05-19T21:06:55.5833475Z 	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.abortPendingCheckpoint(CheckpointCoordinator.java:1552)
2020-05-19T21:06:55.5834742Z 	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.abortPendingCheckpoints(CheckpointCoordinator.java:1440)
2020-05-19T21:06:55.5836006Z 	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.abortPendingCheckpoints(CheckpointCoordinator.java:1422)
2020-05-19T21:06:55.5837431Z 	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.abortPendingAndQueuedCheckpoints(CheckpointCoordinator.java:1660)
2020-05-19T21:06:55.5838737Z 	at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.stopCheckpointScheduler(CheckpointCoordinator.java:1410)
2020-05-19T21:06:55.5840060Z 	at org.apache.flink.runtime.checkpoint.CheckpointCoordinatorDeActivator.jobStatusChanges(CheckpointCoordinatorDeActivator.java:46)
2020-05-19T21:06:55.5841361Z 	at org.apache.flink.runtime.executiongraph.ExecutionGraph.notifyJobStatusChange(ExecutionGraph.java:1668)
2020-05-19T21:06:55.5842509Z 	at org.apache.flink.runtime.executiongraph.ExecutionGraph.transitionState(ExecutionGraph.java:1250)
2020-05-19T21:06:55.5843916Z 	at org.apache.flink.runtime.executiongraph.ExecutionGraph.transitionState(ExecutionGraph.java:1228)
2020-05-19T21:06:55.5845083Z 	at org.apache.flink.runtime.scheduler.SchedulerBase.transitionExecutionGraphState(SchedulerBase.java:432)
2020-05-19T21:06:55.5846293Z 	at org.apache.flink.runtime.scheduler.DefaultScheduler.addVerticesToRestartPending(DefaultScheduler.java:240)
2020-05-19T21:06:55.5847351Z 	at org.apache.flink.runtime.scheduler.DefaultScheduler.restartTasksWithDelay(DefaultScheduler.java:227)
2020-05-19T21:06:55.5847998Z 	at org.apache.flink.runtime.scheduler.DefaultScheduler.maybeRestartTasks(DefaultScheduler.java:214)
2020-05-19T21:06:55.5848654Z 	at org.apache.flink.runtime.scheduler.DefaultScheduler.handleTaskFailure(DefaultScheduler.java:193)
2020-05-19T21:06:55.5849327Z 	at org.apache.flink.runtime.scheduler.DefaultScheduler.maybeHandleTaskFailure(DefaultScheduler.java:185)
2020-05-19T21:06:55.5850012Z 	at org.apache.flink.runtime.scheduler.DefaultScheduler.updateTaskExecutionStateInternal(DefaultScheduler.java:179)
2020-05-19T21:06:55.5850701Z 	at org.apache.flink.runtime.scheduler.SchedulerBase.updateTaskExecutionState(SchedulerBase.java:503)
2020-05-19T21:06:55.5851473Z 	at org.apache.flink.runtime.scheduler.UpdateSchedulerNgOnInternalFailuresListener.notifyTaskFailure(UpdateSchedulerNgOnInternalFailuresListener.java:49)
2020-05-19T21:06:55.5852381Z 	at org.apache.flink.runtime.executiongraph.ExecutionGraph.notifySchedulerNgAboutInternalTaskFailure(ExecutionGraph.java:1717)
2020-05-19T21:06:55.5853059Z 	at org.apache.flink.runtime.executiongraph.Execution.processFail(Execution.java:1268)
2020-05-19T21:06:55.5853663Z 	at org.apache.flink.runtime.executiongraph.Execution.processFail(Execution.java:1236)
2020-05-19T21:06:55.5854297Z 	at org.apache.flink.runtime.executiongraph.Execution.fail(Execution.java:954)
2020-05-19T21:06:55.5854938Z 	at org.apache.flink.runtime.jobmaster.slotpool.SingleLogicalSlot.signalPayloadRelease(SingleLogicalSlot.java:173)
2020-05-19T21:06:55.5855620Z 	at org.apache.flink.runtime.jobmaster.slotpool.SingleLogicalSlot.release(SingleLogicalSlot.java:165)
2020-05-19T21:06:55.5856296Z 	at org.apache.flink.runtime.jobmaster.slotpool.SlotSharingManager$SingleTaskSlot.release(SlotSharingManager.java:732)
2020-05-19T21:06:55.5857025Z 	at org.apache.flink.runtime.jobmaster.slotpool.SlotSharingManager$MultiTaskSlot.release(SlotSharingManager.java:537)
2020-05-19T21:06:55.5857747Z 	at org.apache.flink.runtime.jobmaster.slotpool.AllocatedSlot.releasePayload(AllocatedSlot.java:149)
2020-05-19T21:06:55.5858408Z 	at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.releaseTaskManagerInternal(SlotPoolImpl.java:818)
2020-05-19T21:06:55.5859085Z 	at org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl.releaseTaskManager(SlotPoolImpl.java:777)
2020-05-19T21:06:55.5859806Z 	at org.apache.flink.runtime.jobmaster.JobMaster.disconnectTaskManager(JobMaster.java:435)
2020-05-19T21:06:55.5860469Z 	at org.apache.flink.runtime.jobmaster.JobMaster$TaskManagerHeartbeatListener.notifyHeartbeatTimeout(JobMaster.java:1193)
2020-05-19T21:06:55.5861152Z 	at org.apache.flink.runtime.heartbeat.HeartbeatMonitorImpl.run(HeartbeatMonitorImpl.java:109)
2020-05-19T21:06:55.5861751Z 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
2020-05-19T21:06:55.5862340Z 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
2020-05-19T21:06:55.5862732Z 	... 22 more
2020-05-19T21:06:55.5863134Z Caused by: org.apache.flink.runtime.checkpoint.CheckpointException: Checkpoint Coordinator is suspending.
2020-05-19T21:06:55.5863754Z 	at org.apache.flink.runtime.checkpoint.PendingCheckpoint.abort(PendingCheckpoint.java:492)
2020-05-19T21:06:55.5864204Z 	... 57 more
2020-05-19T21:06:55.5864528Z Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; job (a92a74de8446a80403798bb4806b73f3) to reach terminal state FINISHED ...
2020-05-20T00:30:52.9000401Z ##[error]The operation was canceled.
2020-05-20T00:30:52.9019065Z ##[section]Finishing: Run e2e tests
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13306062">FLINK-17824</key>
            <summary>&quot;Resuming Savepoint&quot; e2e stalls indefinitely </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="roman">Roman Khachatryan</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 20 May 2020 05:16:19 +0000</created>
                <updated>Tue, 5 Jan 2021 10:39:07 +0000</updated>
                            <resolved>Tue, 16 Jun 2020 14:08:27 +0000</resolved>
                                    <version>1.10.1</version>
                    <version>1.11.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17118758" author="rmetzger" created="Thu, 28 May 2020 14:37:03 +0000"  >&lt;p&gt;Introduced a timeout for this test so that we can debug future cases: &lt;a href=&quot;https://github.com/apache/flink/commit/61423e97a034b94dc9c0ffe350dc3667585d6822&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/61423e97a034b94dc9c0ffe350dc3667585d6822&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17124618" author="rmetzger" created="Wed, 3 Jun 2020 05:41:26 +0000"  >&lt;p&gt;Now with logs: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=2586&amp;amp;view=logs&amp;amp;j=91bf6583-3fb2-592f-e4d4-d79d79c3230a&amp;amp;t=94459a52-42b6-5bfc-5d74-690b5d3c6de8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=2586&amp;amp;view=logs&amp;amp;j=91bf6583-3fb2-592f-e4d4-d79d79c3230a&amp;amp;t=94459a52-42b6-5bfc-5d74-690b5d3c6de8&lt;/a&gt; (hadoop 3.1.3 profile, see &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17404&quot; title=&quot;Running HA per-job cluster (rocks, non-incremental) gets stuck killing a non-existing pid in Hadoop 3 build profile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17404&quot;&gt;&lt;del&gt;FLINK-17404&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="17125594" author="rmetzger" created="Thu, 4 Jun 2020 06:51:23 +0000"  >&lt;p&gt;hadoop 3.1.3 &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=2663&amp;amp;view=logs&amp;amp;j=91bf6583-3fb2-592f-e4d4-d79d79c3230a&amp;amp;t=94459a52-42b6-5bfc-5d74-690b5d3c6de8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=2663&amp;amp;view=logs&amp;amp;j=91bf6583-3fb2-592f-e4d4-d79d79c3230a&amp;amp;t=94459a52-42b6-5bfc-5d74-690b5d3c6de8&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17125795" author="rmetzger" created="Thu, 4 Jun 2020 10:28:49 +0000"  >&lt;p&gt;Another instance on master (which makes the Hadoop 3.1.3 theory less likely) &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=2696&amp;amp;view=logs&amp;amp;j=c88eea3b-64a0-564d-0031-9fdcd7b8abee&amp;amp;t=1e2bbe5b-4657-50be-1f07-d84bfce5b1f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=2696&amp;amp;view=logs&amp;amp;j=c88eea3b-64a0-564d-0031-9fdcd7b8abee&amp;amp;t=1e2bbe5b-4657-50be-1f07-d84bfce5b1f5&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17126379" author="pnowojski" created="Fri, 5 Jun 2020 04:39:11 +0000"  >&lt;p&gt;As it was first reported around feature when we were merging quite a bit of unaligned checkpoints code, this issue might be related to something we did.&lt;/p&gt;

&lt;p&gt;It also might be fixed accidentally via one of the in-progress bugs like &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18136&quot; title=&quot;Don&amp;#39;t start channel state writing for savepoints (RPC)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18136&quot;&gt;&lt;del&gt;FLINK-18136&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17128952" author="roman_khachatryan" created="Tue, 9 Jun 2020 07:22:48 +0000"  >&lt;p&gt;I&apos;m looking into this issue and found so far:&lt;br/&gt;
 1. After the test, cluster is not shut down; if the cluster is running failure is more likely to happen; but as seen from CI logs, test also fails when cluster is started afresh&lt;br/&gt;
 2. The failure is caused by stopWithSavepoint taking too long&lt;br/&gt;
 3. JM (and CheckpointCoordinator in particular) work as expected; no further checkpoints are performed after stop-with-Savepoint&lt;br/&gt;
 4. Checkpointing is done in less than 1 minute (rarely it exceeds 60s timeout window); once it&apos;s done AND job is finished test proceeds (all checkpoint completion callbacks are executed)&lt;br/&gt;
 5. Upon confirming the checkpoint, source subtasks send EndOfPartition event downstream and cancel themselves as expected&lt;br/&gt;
 6. Further &quot;network tasks&quot; do NOT consume EndOfPartition event for several minutes - delaying finishing job and causing test failure&lt;br/&gt;
 7. Upstream subpartitions is NOT blocked after sending aligned barrier (new optimization in 1.11).&lt;/p&gt;

&lt;p&gt;Looks like the channels ARE notified and they ARE polled, but return Optional.empty or some data buffers for several minutes.&lt;br/&gt;
 Currently, I&apos;m double checking this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Edit:&lt;/p&gt;

&lt;p&gt;&amp;gt; After the test, cluster is not shut down&lt;/p&gt;

&lt;p&gt;I guess it&apos;s my local issue. The test doesn&apos;t shut down the cluster or cancel the job explicitly; however, it registers handlers to do so on SIGINT and EXIT&lt;/p&gt;</comment>
                            <comment id="17132567" author="roman_khachatryan" created="Wed, 10 Jun 2020 17:50:22 +0000"  >&lt;p&gt;TLDR: If there is an ongoing checkpoint then it slows down stop-with-savepoint command:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;first by slowing down the barrier itself;&lt;/li&gt;
	&lt;li&gt;then by delaying EndOfPartition because of the need to process all the data accumulated during the checkpoint (32K+ per channel).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The fact that sources don&apos;t stop immediately (but rather on completion notification) seems deliberate:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void notifyCheckpointComplete(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; checkpointId) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception { &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void notifyCheckpointComplete(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; checkpointId) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    subtaskCheckpointCoordinator.notifyCheckpointComplete(checkpointId, operatorChain, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;::isRunning); 
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isRunning &amp;amp;&amp;amp; isSynchronousSavepointId(checkpointId)) { 
        finishTask();
        ...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;The issue is reproducible in 1.10 (&lt;b&gt;release-1.10 branch as of Jun 10&lt;/b&gt;).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I see several ways of how to deal with it:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;stop the sources immediately: though the checkpoint can fail, checkpoint coordinator is not supposed to continue work after stop-with-savepoint&lt;/li&gt;
	&lt;li&gt;stop downstreams the same way as sources - upon sync_savepoint completion (not waiting for EndOfPartition)
	&lt;ul&gt;
		&lt;li&gt;or emit&#160;EndOfPartition from source right after the last checkpoint barrier&#160;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;&lt;del&gt;reduce max-concurrent-checkpoints and don&apos;t force any checkpoints (currently, savepoints are forced, i.e. the limit is ignored)&lt;/del&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In the long run,&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;we could leverage RPC abort notifications to stop alignment- (which will shorten checkpointing time); they were introduced in 1.11 and currently don&apos;t affect &quot;network&quot; parts&lt;/li&gt;
	&lt;li&gt;probably unaligned checkpoints could help&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In the meantime, we can try to&#160;reduce CI failures probability by playing with test timeout/ sleep time in source; buffer/record size.&lt;/p&gt;

&lt;p&gt;WDYT, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Edit: also happens with&#160;tag: release-1.10.0&lt;/p&gt;</comment>
                            <comment id="17132984" author="rmetzger" created="Thu, 11 Jun 2020 07:02:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt; do you think this is the same problem: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18148&quot; title=&quot;&amp;quot;Resuming Savepoint&amp;quot; e2e fails with TimeoutException in CliFrontend.stop() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18148&quot;&gt;&lt;del&gt;FLINK-18148&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="17133014" author="roman_khachatryan" created="Thu, 11 Jun 2020 07:39:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;, yes I think it&apos;s the same issue.&lt;/p&gt;</comment>
                            <comment id="17134028" author="pnowojski" created="Fri, 12 Jun 2020 07:51:48 +0000"  >&lt;p&gt;Thanks for investigation &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman_khachatryan&quot; class=&quot;user-hover&quot; rel=&quot;roman_khachatryan&quot;&gt;roman_khachatryan&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; 1. stop the sources immediately: though the checkpoint can fail, checkpoint coordinator is not supposed to continue work after stop-with-savepoint&lt;/p&gt;

&lt;p&gt;I think it&apos;s important designed feature that if stop with savepoint fails, (in some cases) we continue working.&lt;/p&gt;

&lt;p&gt;&amp;gt; 2. stop downstreams the same way as sources - upon sync_savepoint completion (not waiting for EndOfPartition)&lt;/p&gt;

&lt;p&gt;This doesn&apos;t sound right. Logically &lt;tt&gt;EndOfPartitionEvent&lt;/tt&gt; is supposed to mark end of data, if we do not wait for it, we are braking some contract. Which might be fine now, but could cause problems later.&lt;/p&gt;

&lt;p&gt;&amp;gt; 6. Further &quot;network tasks&quot; do NOT consume EndOfPartition event for several minutes - delaying finishing job and causing test failure&lt;/p&gt;

&lt;p&gt;Why is it taking so long?  Can not we speed up the test? Is it taking couple of minutes to process the remaining data? It sounds excessive.&lt;/p&gt;</comment>
                            <comment id="17135572" author="roman_khachatryan" created="Mon, 15 Jun 2020 08:04:30 +0000"  >&lt;p&gt;&amp;gt; Is it taking couple of minutes to process the remaining data? &lt;br/&gt;
Yes. Also just to stop the job without savepoint.&lt;/p&gt;

&lt;p&gt;I didn&apos;t find anything abnormal, just too much records generated and buffered by sources in case of any delay in downstreams.&lt;br/&gt;
Without the delay, I guess source and downstreams compete for memory buffers.&lt;/p&gt;

&lt;p&gt;&amp;gt; Can not we speed up the test? &lt;br/&gt;
Increasing job parameter sequence_generator_source.sleep_time from 15 to 30&#160;to 30 fixes the issue (locally).&lt;/p&gt;

&lt;p&gt;&#160;Decreasing it to 5&#160;makes the test to fail always (each source generates up to seven 32K buffers).&lt;/p&gt;

&lt;p&gt;Similar effect have segment-size and number of segments.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I suggest to increase sequence_generator_source.sleep_time and consider a proper fix in future.&lt;/p&gt;</comment>
                            <comment id="17135897" author="pnowojski" created="Mon, 15 Jun 2020 14:10:14 +0000"  >&lt;p&gt;Ok, let&apos;s try to increase the sleep_time. But this parameter doesn&apos;t answer this question:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&amp;gt; 6. Further &quot;network tasks&quot; do NOT consume EndOfPartition event for several minutes - delaying finishing job and causing test failure&lt;/p&gt;

&lt;p&gt;Why is it taking so long? Can not we speed up the test? Is it taking couple of minutes to process the remaining data? It sounds excessive.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If I understand your previous message, it takes several minutes for downstream tasks to consume buffered data - data that has already been produced by the source, so this sleep time should have no affect on that. So my question remains open, why is it taking couple of minutes to process the remaining data?&lt;/p&gt;</comment>
                            <comment id="17136450" author="roman_khachatryan" created="Tue, 16 Jun 2020 08:50:34 +0000"  >&lt;p&gt;I&apos;ve published a PR to fix the test:&#160;&lt;a href=&quot;https://github.com/apache/flink/pull/12671&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/12671&lt;/a&gt;&lt;br/&gt;
&#160;&lt;/p&gt;

&lt;p&gt;The sleep is between injecting records by the Source, so it slows down and reduces the amount of data to be consumed by the downstream.&lt;br/&gt;
&#160;&lt;br/&gt;
&amp;gt;&#160;So my question remains open, why is it taking couple of minutes to process the remaining data?&lt;/p&gt;

&lt;p&gt;Because there is a lot of data and the processing is much heavier then injecting (kryo, java streams with filter, etc.) .&lt;/p&gt;

&lt;p&gt;The data are injected by the source during the alignment phase of downstream.&lt;/p&gt;

&lt;p&gt;Source is not backpressured because buffers aren&apos;t needed by the&#160;downstream (this is a local environment) so it&apos;s only limited by the aforementioned sleep_time.&lt;/p&gt;</comment>
                            <comment id="17136548" author="pnowojski" created="Tue, 16 Jun 2020 11:02:31 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Waiting for job to process up to 200 records, current progress: 114 records ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I wouldn&apos;t call 200 records &quot;lots of data&quot;, unless something is multiplying records count. Serialisation and other processing of 200 records really shouldn&apos;t take more than a second (&lt;a href=&quot;http://codespeed.dak8s.net:8000/timeline/?ben=serializerKryo&amp;amp;env=2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;kryo is easily capable of hundreds thousands of records per second&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Or is it a problem with the sleep time on the sources not working anymore after 200 records and quickly backpressuring whole job? &lt;/p&gt;</comment>
                            <comment id="17136624" author="roman_khachatryan" created="Tue, 16 Jun 2020 12:47:17 +0000"  >&lt;p&gt;&quot;200 records&quot; is measured closer to sink.&lt;/p&gt;

&lt;p&gt;Source generates about 5-20K records (depending on delay).&lt;/p&gt;</comment>
                            <comment id="17136679" author="pnowojski" created="Tue, 16 Jun 2020 14:06:53 +0000"  >&lt;p&gt;Still I don&apos;t see why it is or why does it have to be so slow. But let&apos;s wait and see if the increased sleep time helped and let&apos;s revisit the problem only if it doesn&apos;t help.&lt;/p&gt;

&lt;p&gt;merged commit increasing sleep time a9d3074 into apache:master&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13348452">FLINK-20818</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13301179">FLINK-17404</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0exjk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>