<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:09:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-26284] The ZooKeeperStateHandleStore cleans the metadata before cleaning the StateHandle</title>
                <link>https://issues.apache.org/jira/browse/FLINK-26284</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Cleanup of job state does not work properly in an HA setup. &lt;tt&gt;releaseAndTryRemove&lt;/tt&gt; deletes the meta data stored in the store before cleaning up the &lt;tt&gt;StateHandle&lt;/tt&gt;. If the &lt;tt&gt;StateHandle&lt;/tt&gt; cleanup fails after the reference is already deleted in the &lt;tt&gt;StateHandleStore&lt;/tt&gt;, a cleanup retry will constantly fail because it cannot deserialize the &lt;tt&gt;StateHandle&lt;/tt&gt; anymore.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13429737">FLINK-26284</key>
            <summary>The ZooKeeperStateHandleStore cleans the metadata before cleaning the StateHandle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mapohl">Matthias Pohl</assignee>
                                    <reporter username="mapohl">Matthias Pohl</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 21 Feb 2022 14:27:46 +0000</created>
                <updated>Fri, 1 Apr 2022 12:59:49 +0000</updated>
                            <resolved>Mon, 28 Feb 2022 10:35:53 +0000</resolved>
                                    <version>1.15.0</version>
                                    <fixVersion>1.15.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17495898" author="mapohl" created="Tue, 22 Feb 2022 07:08:34 +0000"  >&lt;p&gt;Several options were considered:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Have an additional flag for deletion as a child ZK node: This is problematic because of the transactional deletion of the already existing access child lock. We&apos;re not supposed to delete the ZK node if there&apos;s a lock on it due to some other client accessing it. Hence, we would have to check for the existince of the access child lock, and delete everything if it doesn&apos;t exist or delete only the deletion-flag child node if it does.&lt;/li&gt;
	&lt;li&gt;Alternatively, we could model the deletion-flag node on the same level as the StateHandle node. This makes it possible to run the transactional delete on the StateHandle node and clear the deletion-flag node afterwards.&lt;/li&gt;
	&lt;li&gt;Move the deletion marker into the &lt;tt&gt;RetrievableStateHandle&lt;/tt&gt;. It has the benefit that it can be used by the &lt;tt&gt;KubernetesStateHandleStore&lt;/tt&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26286&quot; title=&quot;The KubernetesStateHandleStore cleans the metadata before cleaning the StateHandle&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26286&quot;&gt;&lt;del&gt;FLINK-26286&lt;/del&gt;&lt;/a&gt;) as well but has the flaw that it requires a deserialization which is a problem in cases where the data was corrupted. But in these cases, we want to delete the data anyway.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17496221" author="mapohl" created="Tue, 22 Feb 2022 16:54:36 +0000"  >&lt;p&gt;We still had trouble running the check for locks and marking-for-deletion in an atomic manner. Therefore, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dmvk&quot; class=&quot;user-hover&quot; rel=&quot;dmvk&quot;&gt;dmvk&lt;/a&gt; proposed a different solution which worked in the end: A &lt;tt&gt;/locks&lt;/tt&gt; subfolder was introduced that holds all the locks of open ZK connections. Deleting this subfolder indicates that the node is ready for deletion. This operation fails if there are still connections open.&lt;/p&gt;

&lt;p&gt;This approach allows us to do the connection check and mark-for-deletion operation in an atomic manner.&lt;/p&gt;</comment>
                            <comment id="17498820" author="mapohl" created="Mon, 28 Feb 2022 10:35:53 +0000"  >&lt;p&gt;&lt;tt&gt;master&lt;/tt&gt;: &lt;a href=&quot;https://github.com/apache/flink/commit/c3df4c3f1f868d40e1e70404bea41b7a007e8b08&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;c3df4c3f1f868d40e1e70404bea41b7a007e8b08&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13429750">FLINK-26285</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="13429752">FLINK-26286</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13437227">FLINK-26987</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13419214">FLINK-25432</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                            <outwardlinks description="Testing discovered">
                                        <issuelink>
            <issuekey id="13429750">FLINK-26285</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13429763">FLINK-26288</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zsi0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>