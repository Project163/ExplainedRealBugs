<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:10:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-26864] Performance regression on 25.03.2022</title>
                <link>https://issues.apache.org/jira/browse/FLINK-26864</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;http://codespeed.dak8s.net:8000/timeline/#/?exe=1&amp;amp;ben=arrayKeyBy&amp;amp;extr=on&amp;amp;quarts=on&amp;amp;equid=off&amp;amp;env=2&amp;amp;revs=200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codespeed.dak8s.net:8000/timeline/#/?exe=1&amp;amp;ben=arrayKeyBy&amp;amp;extr=on&amp;amp;quarts=on&amp;amp;equid=off&amp;amp;env=2&amp;amp;revs=200&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://codespeed.dak8s.net:8000/timeline/#/?exe=1&amp;amp;ben=remoteFilePartition&amp;amp;extr=on&amp;amp;quarts=on&amp;amp;equid=off&amp;amp;env=2&amp;amp;revs=200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codespeed.dak8s.net:8000/timeline/#/?exe=1&amp;amp;ben=remoteFilePartition&amp;amp;extr=on&amp;amp;quarts=on&amp;amp;equid=off&amp;amp;env=2&amp;amp;revs=200&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://codespeed.dak8s.net:8000/timeline/#/?exe=1&amp;amp;ben=remoteSortPartition&amp;amp;extr=on&amp;amp;quarts=on&amp;amp;equid=off&amp;amp;env=2&amp;amp;revs=200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codespeed.dak8s.net:8000/timeline/#/?exe=1&amp;amp;ben=remoteSortPartition&amp;amp;extr=on&amp;amp;quarts=on&amp;amp;equid=off&amp;amp;env=2&amp;amp;revs=200&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://codespeed.dak8s.net:8000/timeline/#/?exe=1&amp;amp;ben=tupleKeyBy&amp;amp;extr=on&amp;amp;quarts=on&amp;amp;equid=off&amp;amp;env=2&amp;amp;revs=200&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codespeed.dak8s.net:8000/timeline/#/?exe=1&amp;amp;ben=tupleKeyBy&amp;amp;extr=on&amp;amp;quarts=on&amp;amp;equid=off&amp;amp;env=2&amp;amp;revs=200&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13435765">FLINK-26864</key>
            <summary>Performance regression on 25.03.2022</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="smattheis">Sebastian Mattheis</assignee>
                                    <reporter username="pnowojski">Piotr Nowojski</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 25 Mar 2022 09:50:59 +0000</created>
                <updated>Mon, 11 Apr 2022 08:54:45 +0000</updated>
                            <resolved>Mon, 11 Apr 2022 08:54:45 +0000</resolved>
                                    <version>1.16.0</version>
                                    <fixVersion>1.16.0</fixVersion>
                                    <component>Benchmarks</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17512287" author="pnowojski" created="Fri, 25 Mar 2022 09:57:02 +0000"  >&lt;p&gt;Suspected range: 010f622555..ff3336266e&lt;/p&gt;

&lt;p&gt;After first glance from this range the most likely candidate is &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26279&quot; title=&quot;Provide mailbox delay metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26279&quot;&gt;&lt;del&gt;FLINK-26279&lt;/del&gt;&lt;/a&gt; and &lt;em&gt;maybe&lt;/em&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26592&quot; title=&quot;[Changelog] Deadlock in FsStateChangelogWriter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26592&quot;&gt;&lt;del&gt;FLINK-26592&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;CC &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=smattheis&quot; class=&quot;user-hover&quot; rel=&quot;smattheis&quot;&gt;smattheis&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roman&quot; class=&quot;user-hover&quot; rel=&quot;roman&quot;&gt;roman&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17512723" author="ym" created="Sat, 26 Mar 2022 12:01:28 +0000"  >&lt;p&gt;Is changelog enabled in the benchmark?&lt;/p&gt;

&lt;p&gt;If not, the code path to add &quot;on success/failure&quot; action into the mailbox should not take effect. Specifically, I mean this &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26592&quot; title=&quot;[Changelog] Deadlock in FsStateChangelogWriter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26592&quot;&gt;&lt;del&gt;FLINK-26592&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17513446" author="roman_khachatryan" created="Mon, 28 Mar 2022 15:05:10 +0000"  >&lt;p&gt;I double &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ym&quot; class=&quot;user-hover&quot; rel=&quot;ym&quot;&gt;ym&lt;/a&gt; concern.&lt;/p&gt;

&lt;p&gt;Changelog is disabled by default and is only enabled via randomization, which shouldn&apos;t affect benchmarks.&lt;/p&gt;

&lt;p&gt;Looking at the changes in the commit range, the following seem suspicious to me: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26279&quot; title=&quot;Provide mailbox delay metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26279&quot;&gt;&lt;del&gt;FLINK-26279&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-25904&quot; title=&quot;NullArgumentException when accessing checkpoint stats on standby JobManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-25904&quot;&gt;&lt;del&gt;FLINK-25904&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26334&quot; title=&quot;When timestamp - offset + windowSize &amp;lt; 0, elements cannot be assigned to the correct window&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26334&quot;&gt;&lt;del&gt;FLINK-26334&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17513530" author="JIRAUSER284806" created="Mon, 28 Mar 2022 17:46:51 +0000"  >&lt;p&gt;I have run some benchmarks tests locally and I&apos;m sure performance regression comes from &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26279&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-26279&lt;/a&gt; (my changes -&amp;gt; sorry). I&apos;m currently running some more tests for possible hotfixes other than a commit revert.&lt;/p&gt;</comment>
                            <comment id="17517318" author="ym" created="Tue, 5 Apr 2022 08:51:11 +0000"  >&lt;p&gt;Should we make this a blocker for Release 1.15?&lt;/p&gt;

&lt;p&gt;(I see the change is not included 1.15, never mind)&lt;/p&gt;</comment>
                            <comment id="17517468" author="JIRAUSER284806" created="Tue, 5 Apr 2022 14:17:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ym&quot; class=&quot;user-hover&quot; rel=&quot;ym&quot;&gt;ym&lt;/a&gt; , I talked to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;&#160; if we should do a quick-fix like a revert while I&apos;m working on it but we agreed that this is not too urgent for now as it is not included in 1.15. The fix is, as said, WIP and I will finish it this week where I&apos;m expecting to get back to performance as before.&lt;br/&gt;
The performance regression is similar to what is observed in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23560&quot; title=&quot;Performance regression on 29.07.2021&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-23560&quot;&gt;&lt;del&gt;FLINK-23560&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Root cause: In the specific benchmarks, a lock elision takes effect because there are no mail actions generated/executed. This lock elision cannot be applied anymore and is normal if, e.g., checkpointing is executed but also with the changes which perform latency measurements for mailbox processing and, hence, generates/executes mail actions. If lock elision cannot be applied anymore, performance drops for these specific benchmarks as observed/described in this issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The implications are:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;There is no performance regression if the application performs checkpointing anyways, i.e., in most streaming applications.&lt;/li&gt;
	&lt;li&gt;For batch processing applications, there might be the observed performance regression. To avoid the regression, the fix is to start latency measurements only if there are mails genergated/executed. This fix is WIP.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="17519139" author="JIRAUSER284806" created="Thu, 7 Apr 2022 20:06:40 +0000"  >&lt;p&gt;I have created a PR with a fix to recover performance values as before in &lt;a href=&quot;https://github.com/apache/flink/pull/19398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/19398&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Performance evaluation:&lt;/b&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The performance before regression was assessed in &lt;b&gt;build #148&lt;/b&gt; (&lt;a href=&quot;http://codespeed.dak8s.net:8080/job/flink-master-benchmarks-java8/148/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codespeed.dak8s.net:8080/job/flink-master-benchmarks-java8/148/&lt;/a&gt;) based on apache/flink master commit 010f622555. (&lt;b&gt;This is the baseline&lt;/b&gt;.)&lt;/li&gt;
	&lt;li&gt;The performanc regression was observed in &lt;b&gt;build #149&lt;/b&gt; (&lt;a href=&quot;http://codespeed.dak8s.net:8080/job/flink-master-benchmarks-java8/149/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codespeed.dak8s.net:8080/job/flink-master-benchmarks-java8/149/&lt;/a&gt;) based on apache/flink master commit ff3336266e.&lt;/li&gt;
	&lt;li&gt;The fix is based on current apache/master in commit 39433bafd0 &#160;and has been evaluated in &lt;b&gt;build #74&lt;/b&gt; &lt;a href=&quot;http://codespeed.dak8s.net:8080/job/flink-benchmark-request/74/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codespeed.dak8s.net:8080/job/flink-benchmark-request/74/&lt;/a&gt;. (This is the change of PR &lt;a href=&quot;https://github.com/apache/flink/pull/19398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/19398&lt;/a&gt;)&lt;/li&gt;
	&lt;li&gt;The fix has also been cherry-picked on top of commit ff3336266e (regression) to verify the fix which has been evaluted in &lt;b&gt;build #73&lt;/b&gt; (&lt;a href=&quot;http://codespeed.dak8s.net:8080/job/flink-benchmark-request/73/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://codespeed.dak8s.net:8080/job/flink-benchmark-request/73/&lt;/a&gt;).&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The following table shows the performance implications of the various changes where for the delta (in percent) the basis is build # 148. (&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13042131/13042131_jmh-result-summary.ods&quot; title=&quot;jmh-result-summary.ods attached to FLINK-26864&quot;&gt;jmh-result-summary.ods&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13042130/13042130_jmh-result-summary.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Conclusion:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;Build #73 shows that the fix, if cherry-picked on the commit that first showed a performance regression in build #149, recovers the performance values from before as of build #148. Build #74, which is the fix based on the current master, shows that there is no other significant performance except the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;org.apache.flink.benchmark.CheckpointingTimeBenchmark.checkpointSingleInput -&amp;gt; -18.74%&lt;/li&gt;
	&lt;li&gt;org.apache.flink.benchmark.SerializationFrameworkMiniBenchmarks.serializerHeavyString -&amp;gt; -14%&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;However, both deviations seem to be within a normal range of varying performance values and did not drop with the changes after March 25:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;org.apache.flink.benchmark.CheckpointingTimeBenchmark.checkpointSingleInput.UNALIGNED_1&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13042132/13042132_checkpointSingleInput_UNALIGNED_1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/li&gt;
	&lt;li&gt;org.apache.flink.benchmark.SerializationFrameworkMiniBenchmarks.serializerHeavyString&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13042133/13042133_serializerHeavyString.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17520444" author="pnowojski" created="Mon, 11 Apr 2022 08:54:45 +0000"  >&lt;p&gt;merged commit fecd0fb into apache:master&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13042132" name="checkpointSingleInput_UNALIGNED_1.png" size="189890" author="smattheis" created="Thu, 7 Apr 2022 20:01:59 +0000"/>
                            <attachment id="13042131" name="jmh-result-summary.ods" size="33000" author="smattheis" created="Thu, 7 Apr 2022 19:49:08 +0000"/>
                            <attachment id="13042130" name="jmh-result-summary.png" size="483869" author="smattheis" created="Thu, 7 Apr 2022 19:48:57 +0000"/>
                            <attachment id="13042133" name="serializerHeavyString.png" size="167338" author="smattheis" created="Thu, 7 Apr 2022 20:02:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10tig:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>