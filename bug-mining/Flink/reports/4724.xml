<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19927] ExecutionStateUpdateListener is only updated when legacy scheduling is enabled</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19927</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This is a finding from &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-19805&quot; title=&quot;LeaderChangeClusterComponentsTest.testReelectionOfJobMaster is instable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-19805&quot;&gt;&lt;del&gt;FLINK-19805&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;ExecutionDeploymentTracker&lt;/tt&gt; is never notified about executions reaching terminal state, when using the default scheduler.&lt;br/&gt;
This can potentially lead to invalid execution reconciliation behavior.&lt;/p&gt;

&lt;p&gt;Fixing this ticket probably involves switching the statements here: &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java#L1688-L1692&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-runtime/src/main/java/org/apache/flink/runtime/executiongraph/ExecutionGraph.java#L1688-L1692&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As part of the this tickets resolution, I suggest to also introduce a test case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13338393">FLINK-19927</key>
            <summary>ExecutionStateUpdateListener is only updated when legacy scheduling is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="azagrebin">Andrey Zagrebin</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 2 Nov 2020 10:40:17 +0000</created>
                <updated>Wed, 4 Nov 2020 08:02:11 +0000</updated>
                            <resolved>Wed, 4 Nov 2020 08:02:11 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17224687" author="azagrebin" created="Mon, 2 Nov 2020 14:32:21 +0000"  >&lt;p&gt;It seems we need unit tests for how EG integrates with&#160;ExecutionStateUpdateListener and also&#160;ExecutionDeploymentListener after&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17075&quot; title=&quot;Add task status reconciliation between TM and JM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17075&quot;&gt;&lt;del&gt;FLINK-17075&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I suggest to add at least tests for integration of&#160;ExecutionStateUpdateListener with EG in the scope of this issue, e.g. in&#160;ExecutionGraphStateUpdateTest. We can address&#160;ExecutionDeploymentListener&#160;integration in other ticket.&lt;/p&gt;

&lt;p&gt;wdyt? or was the plan to continue write more high level cases in&#160;JobMasterExecutionDeploymentReconciliationTest, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="17224706" author="zentol" created="Mon, 2 Nov 2020 14:51:28 +0000"  >&lt;p&gt;There should definitely be a test that ensures that the EG issues notifications for all state transitions, but we first of course have to decide whether the new scheduler should even rely on this mechanism. EG#notifyExecutionChange is a no-op outside of legacy scheduling, so my assumption was that the new scheduler would handle this in some other form.&lt;/p&gt;

&lt;p&gt;In the reconcilation test we should add a case to ensure that the tracker is properly cleared when the job is suspended or, more generally, if the job terminates.&lt;/p&gt;</comment>
                            <comment id="17225290" author="azagrebin" created="Tue, 3 Nov 2020 10:40:08 +0000"  >&lt;p&gt;True, the recent state handling logic resides in the new SchedulerNG, currently DefaultScheduler. The execution&#160;state handling in EG is partially inactive, like the problematic&#160;notifyExecutionChange in this issue. We could reconsider how the execution tracking for&#160;reconciliation is integrated with the scheduling. I think the tracking logic could be moved from Execution#deploy and EG#notifyExecutionChange to either&#160;SchedulerNG#updateTaskExecutionState or&#160;DefaultScheduler#deployTaskSafe. The latter looks to me currently more natural.&#160;ExecutionVertexOperations.deploy could return submission future for deployment completion in&#160;ExecutionDeploymentTracker and Execution#getTerminalFuture to stop the tracking. This would be easier to unit test as well.&lt;/p&gt;

&lt;p&gt;Nonetheless, this is not a quick fix. The fix, which &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;&#160;mentions in the issue description, would be quick, I already tried it:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Doing&#160;the tracking stop in&#160;EG#notifyExecutionChange w/o legacy scheduling check&lt;/li&gt;
	&lt;li&gt;Testing it in&#160;JobMasterExecutionDeploymentReconciliationTest by intercepting&#160;the tracking stop in&#160;DefaultExecutionDeploymentTracker&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17225375" author="azagrebin" created="Tue, 3 Nov 2020 13:36:11 +0000"  >&lt;p&gt;After offline discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;&#160;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;, the decision is to proceed with the quick fix of the original intention in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17075&quot; title=&quot;Add task status reconciliation between TM and JM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17075&quot;&gt;&lt;del&gt;FLINK-17075&lt;/del&gt;&lt;/a&gt;&#160;to stop tracking in EG#notifyExecutionChange, also for SchedulerNG. The refactoring suggestions to move tracking to&#160;DefaultScheduler are moved to the follow-up ticket&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-19954&quot; title=&quot;Move execution deployment tracking logic from legacy EG code to SchedulerNG&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-19954&quot;&gt;FLINK-19954&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17225919" author="azagrebin" created="Wed, 4 Nov 2020 08:02:11 +0000"  >&lt;p&gt;merged into master by&#160;375c96c0c1e3ef3555b756c90d58c17c6a2e47e5&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13337120">FLINK-19805</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13338644">FLINK-19954</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0k7i8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>