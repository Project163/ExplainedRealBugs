<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:09:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-26030] Set FLINK_LIB_DIR to &apos;lib&apos; under working dir in YARN containers</title>
                <link>https://issues.apache.org/jira/browse/FLINK-26030</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, we utilize &lt;tt&gt;org.apache.flink.runtime.entrypoint.ClusterEntrypointUtils#tryFindUserLibDirectory&lt;/tt&gt; to locate usrlib in both flink client and cluster side. &lt;br/&gt;
This method relies on the value of environment variable &lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; to find the &lt;tt&gt;usrlib&lt;/tt&gt;.&lt;br/&gt;
It makes sense in client side since in &lt;tt&gt;bin/config.sh&lt;/tt&gt;, &lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; will be set by default(i.e. &lt;tt&gt;FLINK_HOME/lib&lt;/tt&gt; if not exists. But in YARN cluster&apos;s containers, when we want to reuse this method to find &lt;tt&gt;usrlib&lt;/tt&gt;, as the YARN usually starts the process using commands like&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;/bin/bash -c /usr/lib/jvm/java-1.8.0/bin/java -Xmx1073741824 -Xms1073741824 -XX:MaxMetaspaceSize=268435456org.apache.flink.yarn.entrypoint.YarnJobClusterEntrypoint -D jobmanager.memory.off-heap.size=134217728b -D jobmanager.memory.jvm-overhead.min=201326592b -D jobmanager.memory.jvm-metaspace.size=268435456b -D jobmanager.memory.heap.size=1073741824b -D jobmanager.memory.jvm-overhead.max=201326592b ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; is not guaranteed to be set in such case. Current codes will use current working dir to locate the &lt;tt&gt;usrlib&lt;/tt&gt; which is correct in most cases. But bad things can happen if the machine which the YARN container resides in has already set &lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; to a different folder. In that case, codes will try to find &lt;tt&gt;usrlib&lt;/tt&gt; in a undesired place.&lt;/p&gt;

&lt;p&gt;One possible solution would be overriding the &lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; in YARN container env to the &lt;tt&gt;lib&lt;/tt&gt; dir under YARN&apos;s working dir.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13427375">FLINK-26030</key>
            <summary>Set FLINK_LIB_DIR to &apos;lib&apos; under working dir in YARN containers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bgeng777">Biao Geng</assignee>
                                    <reporter username="bgeng777">Biao Geng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 9 Feb 2022 06:01:41 +0000</created>
                <updated>Wed, 16 Mar 2022 06:50:02 +0000</updated>
                            <resolved>Wed, 16 Mar 2022 06:50:02 +0000</resolved>
                                                    <fixVersion>1.16.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17489303" author="fly_in_gis" created="Wed, 9 Feb 2022 07:35:10 +0000"  >&lt;p&gt;&lt;tt&gt;ClusterEntrypointUtils#tryFindUserLibDirectory&lt;/tt&gt; will return a wrong usr lib if environment&#160;&lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; is pre-configured in the YARN cluster. So I think this ticket is a minor bug, not an improvement. Right?&lt;/p&gt;</comment>
                            <comment id="17489957" author="bgeng777" created="Thu, 10 Feb 2022 05:02:42 +0000"  >&lt;p&gt;Yes, it should be a bug.&lt;/p&gt;

&lt;p&gt;I believe to be consistent with the behavior in flink client side, in YARN cluster side, we should make the &lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt;&#160;in YARN container env to the&#160;&lt;tt&gt;lib&lt;/tt&gt; dir under YARN&apos;s working dir. If that is the case, I may start investigating on how to implement it properly. Let me know if above assumption make sense. Thanks!&lt;/p&gt;</comment>
                            <comment id="17489978" author="fly_in_gis" created="Thu, 10 Feb 2022 06:12:51 +0000"  >&lt;p&gt;Setting the &lt;tt&gt;FLINK_LIB_DIR&lt;/tt&gt; to workDir/usrlib makes sense to me.&lt;/p&gt;</comment>
                            <comment id="17507372" author="fly_in_gis" created="Wed, 16 Mar 2022 06:50:02 +0000"  >&lt;p&gt;Fixed via:&lt;/p&gt;

&lt;p&gt;master(1.16):&#160;&lt;/p&gt;

&lt;p&gt;5bf4b072c31e799c91f171f0dcd56319728aec5a&lt;/p&gt;

&lt;p&gt;b95037b4d9c2be2e5eacd2205d9fcd033db117d9&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zdzc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>