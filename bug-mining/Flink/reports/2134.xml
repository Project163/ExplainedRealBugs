<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8227] Optimize the performance of SharedBufferSerializer</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8227</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently &lt;tt&gt;SharedBufferSerializer.serialize()&lt;/tt&gt; will create a HashMap and put all the &lt;tt&gt;SharedBufferEntry&lt;/tt&gt; into it. Usually this is not a problem. But we obverse that in some cases the calculation of hashCode may become the bottleneck. The performance will decrease as the number of &lt;tt&gt;SharedBufferEdge&lt;/tt&gt; increases. For looping pattern &lt;tt&gt;A*&lt;/tt&gt;, if the number of &lt;tt&gt;SharedBufferEntry&lt;/tt&gt; is &lt;tt&gt;N&lt;/tt&gt;, the number of &lt;tt&gt;SharedBufferEdge&lt;/tt&gt; is about &lt;tt&gt;N * N&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13123873">FLINK-8227</key>
            <summary>Optimize the performance of SharedBufferSerializer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dian.fu">Dian Fu</assignee>
                                    <reporter username="dian.fu">Dian Fu</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Dec 2017 03:48:57 +0000</created>
                <updated>Mon, 1 Jan 2018 04:23:31 +0000</updated>
                            <resolved>Mon, 1 Jan 2018 04:22:08 +0000</resolved>
                                                                    <component>Library / CEP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16284570" author="githubbot" created="Sat, 9 Dec 2017 03:53:49 +0000"  >&lt;p&gt;GitHub user dianfu opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8227&quot; title=&quot;Optimize the performance of SharedBufferSerializer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8227&quot;&gt;&lt;del&gt;FLINK-8227&lt;/del&gt;&lt;/a&gt; Optimize the performance of SharedBufferSerializer&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    &lt;b&gt;This pull request optimize the performance of SharedBufferSerializer&lt;/b&gt;&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is a performance improvement without any test coverage.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dianfu/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dianfu/flink&lt;/a&gt; optimize_sharedbuffer&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5142&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit b586abec579ef7f251333032c9385d7e71f3799b&lt;br/&gt;
Author: Dian Fu &amp;lt;fudian.fd@alibaba-inc.com&amp;gt;&lt;br/&gt;
Date:   2017-12-09T03:51:04Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8227&quot; title=&quot;Optimize the performance of SharedBufferSerializer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8227&quot;&gt;&lt;del&gt;FLINK-8227&lt;/del&gt;&lt;/a&gt; Optimize the performance of SharedBufferSerializer&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16293066" author="githubbot" created="Fri, 15 Dec 2017 19:25:25 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @kl0u or @dawidwys I think this could use your opinion.&lt;/p&gt;

&lt;p&gt;    General questions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Is there any reason to use a boxed integer over a primitive one? Primitives should be the default choice.&lt;/li&gt;
	&lt;li&gt;Is is correct that this the id is transient?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16294174" author="githubbot" created="Sun, 17 Dec 2017 14:35:49 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I think it is a very good and needed change.&lt;/p&gt;

&lt;p&gt;    As for @StephanEwen questions:&lt;/p&gt;

&lt;p&gt;    Ad 1. I see no problem with this `entryId` being primitive `int`. &lt;br/&gt;
    Ad 2. I think this field should be transient it is used only during the serialization process to reflect the order in which we serialize the SharedBufferEntries to restore the links between them. It does not play any role outside of serialization.&lt;br/&gt;
    Ad 3. I agree it should be at least long. It will limit  the number of intermittent state of pattern graph.&lt;/p&gt;

&lt;p&gt;    After changing `int` to `long` I think it is ok to be merged.&lt;/p&gt;</comment>
                            <comment id="16299640" author="githubbot" created="Thu, 21 Dec 2017 06:52:24 +0000"  >&lt;p&gt;Github user dianfu commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dawidwys  @StephanEwen Sorry for late response. For question 1 and 2, I have the same thought with @dawidwys and have updated the PR accordingly. For question 3,  I think `int` is enough as we currently store `SharedBufferEntry` in a `HashMap` for each `SharedBufferPage`, and the size of  `HashMap` is `int`. If we want to support `long`, we should also change `HashMap` to something else. What&apos;s your thought?&lt;/p&gt;</comment>
                            <comment id="16304515" author="githubbot" created="Wed, 27 Dec 2017 13:04:58 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @dianfu Don&apos;t we assign unique id across all pages, not just a single one? The maximum number of entries is MAX_INT * MAX_INT then, isn&apos;t it? If I am right, I think we should use `long` then.&lt;/p&gt;</comment>
                            <comment id="16304986" author="githubbot" created="Thu, 28 Dec 2017 01:54:52 +0000"  >&lt;p&gt;Github user dianfu commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The page number is the number of patterns and so it is usually very small.  The `long` is only needed in theory just as you said MAX_INT * MAX_INT resulting to MAX_LONG. If this makes sense, then the `HashMap` may be should also be replaced as the entry number in one page may be MAX_LONG in theory too.  &lt;/p&gt;

&lt;p&gt;    Changing `int` to `long` will introduce state incompatible issue and we need to take care of that when performing serialization/deserialization. I just wonder if it is worth making this change.&lt;/p&gt;</comment>
                            <comment id="16305130" author="githubbot" created="Thu, 28 Dec 2017 07:36:36 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    You are right. I see now this `int` is not the only reason for the limit of `SharedBufferEntry`. Increasing this limit would require way more changes. Let&apos;s keep `int` then.&lt;/p&gt;

&lt;p&gt;    Will merge it soon.&lt;/p&gt;</comment>
                            <comment id="16306256" author="githubbot" created="Fri, 29 Dec 2017 12:56:36 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16306257" author="githubbot" created="Fri, 29 Dec 2017 12:57:09 +0000"  >&lt;p&gt;Github user dawidwys commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merged it. Thanks for the contribution!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3npxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>