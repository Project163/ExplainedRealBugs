<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20675] Asynchronous checkpoint failure would not fail the job anymore</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20675</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-12364&quot; title=&quot;Introduce a CheckpointFailureManager to centralized manage checkpoint failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-12364&quot;&gt;&lt;del&gt;FLINK-12364&lt;/del&gt;&lt;/a&gt;, no mater how many times of asynchronous part of checkpoint on task failed, the job itself would not fail by default:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;Default behavior&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Flink-1.5 &#8212;&amp;gt; Flink-1.8&lt;/td&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Flink-1.9 -&amp;gt; Flink-1.12&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Synchronous part of checkpoint at task failed&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Job failed&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Job failed&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Asynchronous part of checkpoint at task failed&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;Job failed&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;Job would not fail&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;This error was because &lt;tt&gt;StreamTask&lt;/tt&gt; use &lt;tt&gt;Exception&lt;/tt&gt; instead of &lt;tt&gt;CheckpointException&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/flink/blob/5125b1123dfcfff73b5070401dfccb162959080c/flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java#L1118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;when async part failed&lt;/a&gt; as decline message. Thus checkpoint coordinator would call&#160;&lt;tt&gt;failPendingCheckpointDueToTaskFailure(pendingCheckpoint, CheckpointFailureReason.JOB_FAILURE, cause, executionAttemptID)&lt;/tt&gt; to &lt;a href=&quot;https://github.com/apache/flink/blob/release-1.9/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointCoordinator.java#L1316-L1323&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;process the declined checkpoint&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cause == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
	failPendingCheckpointDueToTaskFailure(pendingCheckpoint, CheckpointFailureReason.CHECKPOINT_DECLINED, executionAttemptID);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cause &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; CheckpointException) {
	CheckpointException exception = (CheckpointException) cause;
	failPendingCheckpointDueToTaskFailure(pendingCheckpoint, exception.getCheckpointFailureReason(), cause, executionAttemptID);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
	failPendingCheckpointDueToTaskFailure(pendingCheckpoint, CheckpointFailureReason.JOB_FAILURE, cause, executionAttemptID);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, &lt;tt&gt;CheckpointFailureManager&lt;/tt&gt; would &lt;a href=&quot;https://github.com/apache/flink/blob/5125b1123dfcfff73b5070401dfccb162959080c/flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/CheckpointFailureManager.java#L108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ignore the JOB_FAILURE reason&lt;/a&gt; and not count this failed checkpoint, which causes asynchronous checkpoint failure would not fail the job anymore.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16753&quot; title=&quot;Exception from AsyncCheckpointRunnable should be wrapped in CheckpointException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16753&quot;&gt;&lt;del&gt;FLINK-16753&lt;/del&gt;&lt;/a&gt; corrects the misleading message of&#160;JOB_FAILURE but the asynchronous checkpoint failure still cannot fail the job.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;As this bug exists too long, I decide to set it as critical instead of blocker level.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13346813">FLINK-20675</key>
            <summary>Asynchronous checkpoint failure would not fail the job anymore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yunta">Yun Tang</assignee>
                                    <reporter username="yunta">Yun Tang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 18 Dec 2020 15:49:52 +0000</created>
                <updated>Wed, 3 Mar 2021 13:02:50 +0000</updated>
                            <resolved>Fri, 29 Jan 2021 08:10:34 +0000</resolved>
                                    <version>1.9.3</version>
                    <version>1.10.2</version>
                    <version>1.11.3</version>
                    <version>1.12.0</version>
                                    <fixVersion>1.11.4</fixVersion>
                    <fixVersion>1.12.2</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17251834" author="yunta" created="Fri, 18 Dec 2020 15:50:53 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17261195" author="pnowojski" created="Fri, 8 Jan 2021 10:13:58 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt;, do you have any progress working on this issue?&lt;/p&gt;</comment>
                            <comment id="17262380" author="yunta" created="Mon, 11 Jan 2021 04:00:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt;, thanks for your reminder. I tried to &lt;a href=&quot;https://github.com/Myasuka/flink/tree/async-checkpoint-failure&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;modify locally&lt;/a&gt; before 2021 new year&apos;s day but found it was a bit complicated than what I thought. I&apos;ll submit the PR in this week.&lt;/p&gt;</comment>
                            <comment id="17273480" author="yunta" created="Thu, 28 Jan 2021 10:07:10 +0000"  >&lt;p&gt;Merged in master with three commits:&lt;br/&gt;
f421c6f72b91b7897ff2246bdf4f408e3609f6f0&lt;br/&gt;
c7ed2e818a4ead70c6081117f771c54a1bbc0fc5&lt;br/&gt;
be6eb95af5eaa866ead85ebfa89bdbc7c57c6edc&lt;/p&gt;</comment>
                            <comment id="17274118" author="yunta" created="Fri, 29 Jan 2021 02:18:11 +0000"  >&lt;p&gt;Merged in release-1.12 with two commits:&lt;br/&gt;
d1f8f41b773ec160d4ccee8f6b82e63afd78c901&lt;br/&gt;
4d6b952a82facc838d5ea73bc8fe20e6dc66e1cf&lt;/p&gt;</comment>
                            <comment id="17274223" author="yunta" created="Fri, 29 Jan 2021 08:10:21 +0000"  >&lt;p&gt;Merged into release-1.11 with two commits:&lt;br/&gt;
43fa9bfeb3768368da80011b0b41cc9ed28d98d0&lt;br/&gt;
4ad5c811c075901ee90c64e3272effe7d66dc7fe&lt;/p&gt;

&lt;p&gt;Private CI success: &lt;a href=&quot;https://myasuka.visualstudio.com/flink/_build/results?buildId=245&amp;amp;view=results&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://myasuka.visualstudio.com/flink/_build/results?buildId=245&amp;amp;view=results&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17276128" author="pnowojski" created="Mon, 1 Feb 2021 08:10:46 +0000"  >&lt;p&gt;FYI: this change caused UnalignedCheckpointITCase to become unstable.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-21215&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cancellation of Async part of the checkpoint is still not working correctly.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13355691">FLINK-21215</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13356360">FLINK-21244</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13230648">FLINK-12364</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0lne8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>