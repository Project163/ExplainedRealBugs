<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:06:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-11250] fix thread leaked when StreamTask switched from DEPLOYING to CANCELING</title>
                <link>https://issues.apache.org/jira/browse/FLINK-11250</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;begin flink-1.5.x version, streamRecordWriters was created in StreamTask&apos;s constructor, which start OutputFlusher daemon thread. so when task switched from DEPLOYING to CANCELING state, the daemon thread will be leaked.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;reproducible example&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
    env.enableCheckpointing(5000);
    env
            .addSource(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SourceFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;() {
                @Override
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run(SourceContext&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; ctx) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

                    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 100000000; i++) {
                        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(100);
                        ctx.collect(&lt;span class=&quot;code-quote&quot;&gt;&quot;data &quot;&lt;/span&gt; + i);
                    }
                }

                @Override
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancel() {

                }
            })
            .addSink(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RichSinkFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;() {

                @Override
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void open(Configuration parameters) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(1 / 0);
                }

                @Override
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void invoke(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value, Context context) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

                }

            }).setParallelism(2);


    env.execute();

}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;some useful log&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-01-02 03:03:47.525 [thread==&amp;gt; jobmanager-&lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt;-thread-2] executiongraph.Execution#transitionState:1316 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) switched from CREATED to SCHEDULED.
2019-01-02 03:03:47.526 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] slotpool.SlotPool#allocateSlot:326 Received slot request [SlotRequestId{12bfcf1674f5b96567a076086dbbfd1b}] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task: Attempt #1 (Source: Custom Source (1/1)) @ (unassigned) - [SCHEDULED]
2019-01-02 03:03:47.527 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] slotpool.SlotSharingManager#createRootSlot:151 Create multi task slot [SlotRequestId{494e47eb8318e2c09999a1db91dda6b8}] in slot [SlotRequestId{6d7f0173c1d48e5559f6a14b080ee817}].
2019-01-02 03:03:47.527 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] slotpool.SlotSharingManager$MultiTaskSlot#allocateSingleTaskSlot:426 Create single task slot [SlotRequestId{12bfcf1674f5b96567a076086dbbfd1b}] in multi task slot [SlotRequestId{494e47eb8318e2c09999a1db91dda6b8}] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; group bc764cd8ddf7a0cff126f51c16239658.
2019-01-02 03:03:47.528 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] slotpool.SlotSharingManager$MultiTaskSlot#allocateSingleTaskSlot:426 Create single task slot [SlotRequestId{8a877431375df8aeadb2fd845cae15fc}] in multi task slot [SlotRequestId{494e47eb8318e2c09999a1db91dda6b8}] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; group 0a448493b4782967b150582570326227.
2019-01-02 03:03:47.528 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] slotpool.SlotSharingManager#createRootSlot:151 Create multi task slot [SlotRequestId{56a36d3902ee1a7d0e2e84f50039c1ca}] in slot [SlotRequestId{dbf5c9fa39f1e5a0b34a4a8c10699ee5}].
2019-01-02 03:03:47.528 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] slotpool.SlotSharingManager$MultiTaskSlot#allocateSingleTaskSlot:426 Create single task slot [SlotRequestId{5929c12b52dccee682f86afbe1cff5cf}] in multi task slot [SlotRequestId{56a36d3902ee1a7d0e2e84f50039c1ca}] &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; group 0a448493b4782967b150582570326227.
2019-01-02 03:03:47.529 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] executiongraph.Execution#transitionState:1316 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) switched from SCHEDULED to DEPLOYING.
2019-01-02 03:03:47.529 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] executiongraph.Execution#deploy:576 Deploying Source: Custom Source (1/1) (attempt #1) to localhost
2019-01-02 03:03:47.530 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] state.TaskExecutorLocalStateStoresManager#localStateStoreForSubtask:162 Registered &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; local state store with configuration LocalRecoveryConfig{localRecoveryMode=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, localStateDirectories=LocalRecoveryDirectoryProvider{rootDirectories=[/tmp/localState/aid_AllocationID{7b5faad9073d7fac6759e40981197b8d}], jobID=06e76f6e31728025b22fdda9fadd6f01, jobVertexID=bc764cd8ddf7a0cff126f51c16239658, subtaskIndex=0}} &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 06e76f6e31728025b22fdda9fadd6f01 - bc764cd8ddf7a0cff126f51c16239658 - 0 under allocation id AllocationID{7b5faad9073d7fac6759e40981197b8d}.
2019-01-02 03:03:47.530 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] partition.ResultPartition#&amp;lt;init&amp;gt;:172 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef): Initialized ResultPartition 85c7415bae559d6198b8bb69d4c6e49f@74a4ed4bb2f80aa2b98e11bd09ea64ef [PIPELINED_BOUNDED, 2 subpartitions, 2 pending references]
2019-01-02 03:03:47.530 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] taskexecutor.TaskExecutor#submitTask:541 Received task Source: Custom Source (1/1).
2019-01-02 03:03:47.532 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#transitionState:992 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) switched from CREATED to DEPLOYING.
2019-01-02 03:03:47.532 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:655 Creating FileSystem stream leak safety net &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) [DEPLOYING]
2019-01-02 03:03:47.532 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] state.TaskExecutorLocalStateStoresManager#localStateStoreForSubtask:166 Found existing local state store &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 06e76f6e31728025b22fdda9fadd6f01 - 0a448493b4782967b150582570326227 - 0 under allocation id AllocationID{7b5faad9073d7fac6759e40981197b8d}: org.apache.flink.runtime.state.NoOpTaskLocalStateStoreImpl@176e8a65
2019-01-02 03:03:47.535 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:662 Loading JAR files &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) [DEPLOYING].
2019-01-02 03:03:47.536 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#createUserCodeClassloader:947 Getting user code &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;loader &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task 74a4ed4bb2f80aa2b98e11bd09ea64ef at library cache manager took 0 milliseconds
2019-01-02 03:03:47.537 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:688 Registering task at network: Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) [DEPLOYING].
2019-01-02 03:03:47.537 [thread==&amp;gt; Source: Custom Source (1/1)] buffer.LocalBufferPool#&amp;lt;init&amp;gt;:125 Using a local buffer pool with 2-12 buffers
2019-01-02 03:03:47.537 [thread==&amp;gt; Source: Custom Source (1/1)] partition.ResultPartitionManager#registerResultPartition:62 Registered ResultPartition 85c7415bae559d6198b8bb69d4c6e49f@74a4ed4bb2f80aa2b98e11bd09ea64ef [PIPELINED_BOUNDED, 2 subpartitions, 2 pending references].
2019-01-02 03:03:47.537 [thread==&amp;gt; Source: Custom Source (1/1)] network.TaskEventDispatcher#registerPartition:59 registering 85c7415bae559d6198b8bb69d4c6e49f@74a4ed4bb2f80aa2b98e11bd09ea64ef
2019-01-02 03:03:47.537 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] state.TaskExecutorLocalStateStoresManager#localStateStoreForSubtask:166 Found existing local state store &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 06e76f6e31728025b22fdda9fadd6f01 - 0a448493b4782967b150582570326227 - 1 under allocation id AllocationID{d8a1fd06e3e52101b003a04355f64be1}: org.apache.flink.runtime.state.NoOpTaskLocalStateStoreImpl@57bf2d8e
2019-01-02 03:03:47.537 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:714 =======&amp;gt; next, kick off the background copying of files &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the distributed cache: Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) [DEPLOYING].
2019-01-02 03:03:47.538 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:729 =======&amp;gt; isCanceledOrFailed: Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) [DEPLOYING].
2019-01-02 03:03:47.540 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:737 =======&amp;gt; call the user code initialization methods: Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) [DEPLOYING].
2019-01-02 03:03:47.543 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:765 =======&amp;gt; now load and instantiate the task&apos;s invokable code: Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) [DEPLOYING].
2019-01-02 03:03:47.543 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] executiongraph.ExecutionGraph#transitionState:1356 Job Flink Streaming Job (06e76f6e31728025b22fdda9fadd6f01) switched from state RUNNING to FAILING.
2019-01-02 03:03:47.544 [thread==&amp;gt; Source: Custom Source (1/1)] tasks.StreamTask#createStreamRecordWriter:1214 Using partitioner REBALANCE &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; output 0 of task Source: Custom Source
2019-01-02 03:03:47.544 [thread==&amp;gt; Source: Custom Source (1/1)] io.StreamRecordWriter$OutputFlusher#&amp;lt;init&amp;gt;:174 StreamRecordWriter start : outputflusher1546369427544, timeout: 100
2019-01-02 03:03:47.544 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-5] executiongraph.Execution#transitionState:1316 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) switched from DEPLOYING to CANCELING.
2019-01-02 03:03:47.544 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] taskmanager.Task#cancelExecution:1055 Attempting to cancel task Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef).
2019-01-02 03:03:47.544 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] taskmanager.Task#cancelOrFailAndCancelInvokable:1078 cancelOrFailAndCancelInvokable_current_execution_state==&amp;gt; task: Source: Custom Source (1/1), state: DEPLOYING, targetState CANCELING
2019-01-02 03:03:47.545 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] taskmanager.Task#transitionState:992 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) switched from DEPLOYING to CANCELING.
2019-01-02 03:03:47.545 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] slotpool.SlotPool#releaseSlot:745 Releasing slot [SlotRequestId{5929c12b52dccee682f86afbe1cff5cf}] because: Slot is being returned to the SlotPool.
2019-01-02 03:03:47.545 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] slotpool.SlotPool#releaseSlot:745 Releasing slot [SlotRequestId{dbf5c9fa39f1e5a0b34a4a8c10699ee5}] because: Release multi task slot because all children have been released.
2019-01-02 03:03:47.545 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] slotpool.SlotPool#tryFulfillSlotRequestOrMakeAvailable:842 Adding returned slot [AllocationID{d8a1fd06e3e52101b003a04355f64be1}] to available slots
2019-01-02 03:03:47.546 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] taskexecutor.TaskExecutor#failPartition:656 Discarding the results produced by task execution 8aeff98e78ed3d348af9d4d5679f2b26.
2019-01-02 03:03:47.546 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] partition.ResultPartitionManager#releasePartitionsProducedBy:105 Released all partitions produced by 8aeff98e78ed3d348af9d4d5679f2b26.
2019-01-02 03:03:47.547 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#transitionState:992 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) switched from CANCELING to CANCELED.
2019-01-02 03:03:47.547 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:892 Freeing task resources &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef).
2019-01-02 03:03:47.547 [thread==&amp;gt; Source: Custom Source (1/1)] network.NetworkEnvironment#unregisterTask:263 Unregister task Source: Custom Source (1/1) from network environment (state: CANCELED).
2019-01-02 03:03:47.547 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:47.547 [thread==&amp;gt; Source: Custom Source (1/1)] partition.ResultPartition#release:313 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef): Releasing ResultPartition 85c7415bae559d6198b8bb69d4c6e49f@74a4ed4bb2f80aa2b98e11bd09ea64ef [PIPELINED_BOUNDED, 2 subpartitions, 2 pending references].
2019-01-02 03:03:47.548 [thread==&amp;gt; Source: Custom Source (1/1)] partition.PipelinedSubpartition#release:137 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef): Released PipelinedSubpartition#0 [number of buffers: 0 (0 bytes), number of buffers in backlog: 0, finished? &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, read view? &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;].
2019-01-02 03:03:47.548 [thread==&amp;gt; Source: Custom Source (1/1)] partition.PipelinedSubpartition#release:137 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef): Released PipelinedSubpartition#1 [number of buffers: 0 (0 bytes), number of buffers in backlog: 0, finished? &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, read view? &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;].
2019-01-02 03:03:47.548 [thread==&amp;gt; Source: Custom Source (1/1)] partition.ResultPartitionManager#releasePartitionsProducedBy:105 Released all partitions produced by 74a4ed4bb2f80aa2b98e11bd09ea64ef.
2019-01-02 03:03:47.548 [thread==&amp;gt; Source: Custom Source (1/1)] network.TaskEventDispatcher#unregisterPartition:78 unregistering 85c7415bae559d6198b8bb69d4c6e49f@74a4ed4bb2f80aa2b98e11bd09ea64ef
2019-01-02 03:03:47.548 [thread==&amp;gt; Source: Custom Source (1/1)] taskmanager.Task#run:919 Ensuring all FileSystem streams are closed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) [CANCELED]
2019-01-02 03:03:47.549 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-2] taskexecutor.TaskExecutor#unregisterTaskAndNotifyFinalState:1337 Un-registering task and sending &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; execution state CANCELED to JobManager &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; task Source: Custom Source 74a4ed4bb2f80aa2b98e11bd09ea64ef.
2019-01-02 03:03:47.562 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] slotpool.SlotPool#releaseSlot:745 Releasing slot [SlotRequestId{8a877431375df8aeadb2fd845cae15fc}] because: Slot is being returned to the SlotPool.
2019-01-02 03:03:47.566 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] executiongraph.Execution#transitionState:1316 Source: Custom Source (1/1) (74a4ed4bb2f80aa2b98e11bd09ea64ef) switched from CANCELING to CANCELED.
2019-01-02 03:03:47.566 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] executiongraph.Execution#processFail:1079 Ignoring transition of vertex Source: Custom Source (1/1) - execution #1 to FAILED &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; being CANCELED.
2019-01-02 03:03:47.567 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] slotpool.SlotPool#releaseSlot:745 Releasing slot [SlotRequestId{12bfcf1674f5b96567a076086dbbfd1b}] because: Slot is being returned to the SlotPool.
2019-01-02 03:03:47.567 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] executiongraph.ExecutionGraph#tryRestartOrFail:1477 Try to restart or fail the job Flink Streaming Job (06e76f6e31728025b22fdda9fadd6f01) &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no longer possible.
2019-01-02 03:03:47.567 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] executiongraph.ExecutionGraph#transitionState:1356 Job Flink Streaming Job (06e76f6e31728025b22fdda9fadd6f01) switched from state FAILING to RESTARTING.
2019-01-02 03:03:47.567 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] executiongraph.ExecutionGraph#tryRestartOrFail:1487 Restarting the job Flink Streaming Job (06e76f6e31728025b22fdda9fadd6f01).
2019-01-02 03:03:47.567 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] slotpool.SlotPool#releaseSlot:745 Releasing slot [SlotRequestId{6d7f0173c1d48e5559f6a14b080ee817}] because: Release multi task slot because all children have been released.
2019-01-02 03:03:47.567 [thread==&amp;gt; flink-akka.actor.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-dispatcher-3] slotpool.SlotPool#tryFulfillSlotRequestOrMakeAvailable:842 Adding returned slot [AllocationID{7b5faad9073d7fac6759e40981197b8d}] to available slots
2019-01-02 03:03:47.647 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:47.748 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:47.848 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:47.948 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:48.049 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:48.149 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:48.249 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:48.349 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:48.450 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
2019-01-02 03:03:48.550 [thread==&amp;gt; OutputFlusher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Source: Custom Source] io.StreamRecordWriter$OutputFlusher#run:192 Running OutputFlusher outputflusher1546369427544
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13207250">FLINK-11250</key>
            <summary>fix thread leaked when StreamTask switched from DEPLOYING to CANCELING</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="akalashnikov">Anton Kalashnikov</assignee>
                                    <reporter username="lamber-ken">lamber-ken</reporter>
                        <labels>
                            <label>auto-deprioritized-major</label>
                            <label>auto-unassigned</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 2 Jan 2019 09:55:30 +0000</created>
                <updated>Fri, 17 Sep 2021 02:17:10 +0000</updated>
                            <resolved>Fri, 17 Sep 2021 02:17:01 +0000</resolved>
                                    <version>1.5.6</version>
                    <version>1.6.3</version>
                    <version>1.7.1</version>
                                    <fixVersion>1.7.3</fixVersion>
                                    <component>Runtime / Task</component>
                        <due>Wed, 2 Jan 2019 00:00:00 +0000</due>
                            <votes>1</votes>
                                    <watches>10</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16961818" author="rustedbones" created="Tue, 29 Oct 2019 08:47:35 +0000"  >&lt;p&gt;This also seems to affect Flink 1.8.1&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We suspected a class-loader leak from our application so we made a dump from the JobManager process.&lt;/p&gt;

&lt;p&gt;Some of the GC roots from our leaked classes point to the flink OutputFlusher thread.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When the dump was made, only 2 jobs were running with a source of parallelism 1. I expect to have only 2&#160;OutputFlusher threads. However, the dumps shows we have 86 daemon threads for this source.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Those thread having a reference to the user class loader, creates the memory leak leads to a OOM of our application after some time.&lt;/p&gt;</comment>
                            <comment id="17323401" author="flink-jira-bot" created="Fri, 16 Apr 2021 11:16:12 +0000"  >&lt;p&gt;This issue is assigned but has not received an update in 7 days so it has been labeled &quot;stale-assigned&quot;. If you are still working on the issue, please give an update and remove the label. If you are no longer working on the issue, please unassign so someone else may work on it. In 7 days the issue will be automatically unassigned.&lt;/p&gt;</comment>
                            <comment id="17334042" author="flink-jira-bot" created="Tue, 27 Apr 2021 23:10:13 +0000"  >&lt;p&gt;This issue was marked &quot;stale-assigned&quot; and has not received an update in 7 days. It is now automatically unassigned. If you are still working on it, you can assign it to yourself again. Please also give an update about the status of the work.&lt;/p&gt;</comment>
                            <comment id="17360792" author="flink-jira-bot" created="Thu, 10 Jun 2021 11:34:52 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Major but is unassigned and neither itself nor its Sub-Tasks have been updated for 30 days. I have gone ahead and added a &quot;stale-major&quot; to the issue&quot;. If this ticket is a Major, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17365901" author="flink-jira-bot" created="Sat, 19 Jun 2021 10:40:19 +0000"  >&lt;p&gt;This issue was labeled &quot;stale-major&quot; 7 ago and has not received any updates so it is being deprioritized. If this ticket is actually Major, please raise the priority and ask a committer to assign you the issue or revive the public discussion.&lt;/p&gt;</comment>
                            <comment id="17409890" author="akalashnikov" created="Sat, 4 Sep 2021 07:26:44 +0000"  >&lt;p&gt;I actually don&apos;t think that this ticket is still relevant. As I can see OutputFlusher is properly terminated in RecordWriter#close. More precysly, the closing chain looks like: StreamTask#cleanUp -&amp;gt; StreamTask -&amp;gt; releaseOutputResources -&amp;gt; RegularOperationChain#close -&amp;gt; RecordWriterOutput#close -&amp;gt; RecordWriter#close -&amp;gt; OutupFlusher#terminate.&lt;br/&gt;
I am not really ready to say which ticket exactly fixed this bug because there were a lot of them since this bug was created. But perhaps, merging `StreamRecordWriter` into `RecordWriter`(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11282&quot; title=&quot;Merge StreamRecordWriter into RecordWriter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11282&quot;&gt;&lt;del&gt;FLINK-11282&lt;/del&gt;&lt;/a&gt;) helped or one of the improvements of StreamTask#cleanUp which were a lot.&lt;/p&gt;

&lt;p&gt;So if nobody minds I suggest closing this ticket as `not reproduced` since the last news about this bug was two years ago and since the attached reproducer doesn&apos;t reproduce anything(it works perfectly fine).&lt;/p&gt;</comment>
                            <comment id="17410514" author="pnowojski" created="Mon, 6 Sep 2021 10:14:32 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akalashnikov&quot; class=&quot;user-hover&quot; rel=&quot;akalashnikov&quot;&gt;akalashnikov&lt;/a&gt; you are missing:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt; so when task switched from DEPLOYING to CANCELING state&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Is the key point here. In this case inside &lt;tt&gt;Task#doRun&lt;/tt&gt; we can instantiate &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java#L739:L741&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;SteamTask&lt;/tt&gt;&lt;/a&gt; (and start &lt;tt&gt;OutputFlusher&lt;/tt&gt; threads) but in case of this &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-runtime/src/main/java/org/apache/flink/runtime/taskmanager/Task.java#L756:L758&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;piece of code&lt;/a&gt; &lt;tt&gt;StreamTask#cleanUp()&lt;/tt&gt; will not be called.&lt;/p&gt;</comment>
                            <comment id="17416396" author="ym" created="Fri, 17 Sep 2021 02:17:01 +0000"  >&lt;p&gt;merged commit&#160;&lt;a href=&quot;https://github.com/apache/flink/commit/3b6b5229df09c05fbeeaf88bf91df6d18c71097a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;3b6b522&lt;/tt&gt;&lt;/a&gt;&#160;into&#160;apache:master&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00g20:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>