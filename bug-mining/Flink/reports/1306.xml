<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5063] State handles are not properly cleaned up for declined or expired checkpoints</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5063</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In case that a &lt;tt&gt;Checkpoint&lt;/tt&gt; is declined or expires, the &lt;tt&gt;CheckpointCoordinator&lt;/tt&gt; will dispose the &lt;tt&gt;PendingCheckpoint&lt;/tt&gt;. Disposing the &lt;tt&gt;PendingCheckpoint&lt;/tt&gt; entails that all so far registered &lt;tt&gt;SubtaskStates&lt;/tt&gt; of the acknowledged &lt;tt&gt;Tasks&lt;/tt&gt; are discarded. However, all late arriving acknowledge messages are simply ignored without properly discarding the transmitted state handles. This can lead to a cluttering of checkpoint directory since the checkpoint files of late or unknown acknowledge checkpoint messages are never deleted.&lt;/p&gt;

&lt;p&gt;I propose to properly discard the state handles at the &lt;tt&gt;CheckpointCoordinator&lt;/tt&gt; if receiving a late acknowledge message or an acknowledge message for an unknown &lt;tt&gt;ExecutionAttemptID&lt;/tt&gt; belonging to the job of the &lt;tt&gt;CheckpointCoordinator&lt;/tt&gt;. However, checkpoint messages belonging to a different job won&apos;t be handled and simply ignored.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13020534">FLINK-5063</key>
            <summary>State handles are not properly cleaned up for declined or expired checkpoints</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Nov 2016 15:47:39 +0000</created>
                <updated>Thu, 17 Nov 2016 09:29:01 +0000</updated>
                            <resolved>Wed, 16 Nov 2016 23:54:49 +0000</resolved>
                                    <version>1.1.3</version>
                    <version>1.2.0</version>
                                    <fixVersion>1.1.4</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15667321" author="githubbot" created="Tue, 15 Nov 2016 14:43:40 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2812&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5063&quot; title=&quot;State handles are not properly cleaned up for declined or expired checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5063&quot;&gt;&lt;del&gt;FLINK-5063&lt;/del&gt;&lt;/a&gt; Discard state handles of declined or expired state handles&lt;/p&gt;

&lt;p&gt;    Whenever the checkpoint coordinator receives an acknowledge checkpoint message which belongs&lt;br/&gt;
    to the job maintained by the checkpoint coordinator, it should either record the state handles&lt;br/&gt;
    for later processing or discard to free the resources. The latter case can happen if a&lt;br/&gt;
    checkpoint has been expired and late acknowledge checkpoint messages arrive. Furthermore, it&lt;br/&gt;
    can happen if a Task sent a decline checkpoint message while other Tasks where still drawing&lt;br/&gt;
    a checkpoint. This PR changes the behaviour such that state handles belonging to the job of&lt;br/&gt;
    the checkpoint coordinator are discarded if they could not be added to the PendingCheckpoint.&lt;/p&gt;

&lt;p&gt;    Review @uce, @StephanEwen &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixStateHandleCleanup&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2812.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2812.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2812&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c4c000d1b39de5617b6796eed524ce2a449100d3&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-14T17:33:55Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5063&quot; title=&quot;State handles are not properly cleaned up for declined or expired checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5063&quot;&gt;&lt;del&gt;FLINK-5063&lt;/del&gt;&lt;/a&gt; Discard state handles of declined or expired state handles&lt;/p&gt;

&lt;p&gt;    Whenever the checkpoint coordinator receives an acknowledge checkpoint message which belongs&lt;br/&gt;
    to the job maintained by the checkpoint coordinator, it should either record the state handles&lt;br/&gt;
    for later processing or discard to free the resources. The latter case can happen if a&lt;br/&gt;
    checkpoint has been expired and late acknowledge checkpoint messages arrive. Furthremore, it&lt;br/&gt;
    can happen if a Task sent a decline checkpoint message while other Tasks where still drawing&lt;br/&gt;
    a checkpoint. This PR changes the behaviour such that state handles belonging to the job of&lt;br/&gt;
    the checkpoint coordinator are discarded if they could not be added to the PendingCheckpoint.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15667338" author="githubbot" created="Tue, 15 Nov 2016 14:45:06 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;backport&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5063&quot; title=&quot;State handles are not properly cleaned up for declined or expired checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5063&quot;&gt;&lt;del&gt;FLINK-5063&lt;/del&gt;&lt;/a&gt; Discard state handles of declined or expired state handles&lt;/p&gt;

&lt;p&gt;    This is backport of #2812 for the release-1.1 branch.&lt;/p&gt;

&lt;p&gt;    Whenever the checkpoint coordinator receives an acknowledge checkpoint message which belongs&lt;br/&gt;
    to the job maintained by the checkpoint coordinator, it should either record the state handles&lt;br/&gt;
    for later processing or discard to free the resources. The latter case can happen if a&lt;br/&gt;
    checkpoint has been expired and late acknowledge checkpoint messages arrive. Furthermore, it&lt;br/&gt;
    can happen if a Task sent a decline checkpoint message while other Tasks where still drawing&lt;br/&gt;
    a checkpoint. This PR changes the behaviour such that state handles belonging to the job of&lt;br/&gt;
    the checkpoint coordinator are discarded if they could not be added to the PendingCheckpoint.&lt;/p&gt;

&lt;p&gt;    Review @uce &lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; backportFixStateHandleCleanup&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2813.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2813.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2813&lt;/p&gt;

&lt;hr /&gt;

&lt;hr /&gt;</comment>
                            <comment id="15670516" author="githubbot" created="Wed, 16 Nov 2016 14:17:50 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2812&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good catch and patch!&lt;/p&gt;

&lt;p&gt;    +1 from my side to merge this&lt;/p&gt;</comment>
                            <comment id="15670518" author="githubbot" created="Wed, 16 Nov 2016 14:18:16 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Similar to #2812 - good fix!&lt;br/&gt;
    +1 from my side!&lt;/p&gt;</comment>
                            <comment id="15671523" author="githubbot" created="Wed, 16 Nov 2016 20:29:15 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging this...&lt;/p&gt;</comment>
                            <comment id="15672074" author="githubbot" created="Wed, 16 Nov 2016 23:36:47 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2812&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15672124" author="stephanewen" created="Wed, 16 Nov 2016 23:54:49 +0000"  >&lt;p&gt;Fixed in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1.1.4 via 4daf3bbc1e0251e1e84d799421dae9e3fa2363fc&lt;/li&gt;
	&lt;li&gt;1.2.0 via 72b295b3b52dff2d0bc5b78881826e8936c370ff&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15673233" author="githubbot" created="Thu, 17 Nov 2016 09:29:01 +0000"  >&lt;p&gt;Github user tillrohrmann closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2813&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36anj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>