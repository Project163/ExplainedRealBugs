<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-32668] fix up watchdog timeout error msg  in common.sh(e2e test) </title>
                <link>https://issues.apache.org/jira/browse/FLINK-32668</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When run e2e test, an error like this occrurs:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13061593/13061593_image-2023-07-25-15-27-37-441.png&quot; height=&quot;115&quot; width=&quot;733&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The corresponding code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
kill_test_watchdog() {
&#160; &#160; local watchdog_pid=$(cat $TEST_DATA_DIR/job_watchdog.pid)
&#160; &#160; echo &lt;span class=&quot;code-quote&quot;&gt;&quot;Stopping job timeout watchdog (with pid=$watchdog_pid)&quot;&lt;/span&gt;
&#160; &#160; kill $watchdog_pid
} 
internal_run_with_timeout() {
&#160; &#160; local timeout_in_seconds=&lt;span class=&quot;code-quote&quot;&gt;&quot;$1&quot;&lt;/span&gt;
&#160; &#160; local on_failure=&lt;span class=&quot;code-quote&quot;&gt;&quot;$2&quot;&lt;/span&gt;
&#160; &#160; local command_label=&lt;span class=&quot;code-quote&quot;&gt;&quot;$3&quot;&lt;/span&gt;
&#160; &#160; local command=&lt;span class=&quot;code-quote&quot;&gt;&quot;${@:4}&quot;&lt;/span&gt;

&#160; &#160; on_exit kill_test_watchdog
&#160; &#160;(
&#160; &#160; &#160; &#160; &#160; &#160;command_pid=$BASHPID
&#160; &#160; &#160; &#160; &#160; &#160;(sleep &lt;span class=&quot;code-quote&quot;&gt;&quot;${timeout_in_seconds}&quot;&lt;/span&gt; # set a timeout &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; command
&#160; &#160; &#160; &#160; &#160; &#160; echo &lt;span class=&quot;code-quote&quot;&gt;&quot;${command_label:-&quot;&lt;/span&gt;The command &lt;span class=&quot;code-quote&quot;&gt;&apos;${command}&apos;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;} (pid: $command_pid) did not finish after $timeout_in_seconds seconds.&quot;&lt;/span&gt;
eval &lt;span class=&quot;code-quote&quot;&gt;&quot;${on_failure}&quot;&lt;/span&gt;
&#160; &#160; &#160; &#160; &#160; &#160;kill &lt;span class=&quot;code-quote&quot;&gt;&quot;$command_pid&quot;&lt;/span&gt;) &amp;amp; watchdog_pid=$!
&#160; &#160; &#160; &#160; &#160; &#160;echo $watchdog_pid &amp;gt; $TEST_DATA_DIR/job_watchdog.pid
&#160; &#160; &#160; &#160; &#160; &#160;# invoke
&#160; &#160; &#160; &#160; &#160; $command
&#160; )

}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;When &lt;tt&gt;$command&lt;/tt&gt; completes before the timeout, the watchdog process is killed successfully. However, when &lt;tt&gt;$command&lt;/tt&gt; times out, the watchdog process kills &lt;tt&gt;$command&lt;/tt&gt; and then exits itself, leaving behind an error message when trying to kill its own process ID with &lt;tt&gt;kill $watchdog_pid&lt;/tt&gt;.This error msg &quot;no such process&quot; is hard to understand.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;So, I will modify like this with better error message:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
kill_test_watchdog() {
&#160; &#160; &#160; local watchdog_pid=$(cat $TEST_DATA_DIR/job_watchdog.pid)
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; kill -0 $watchdog_pid &amp;gt; /dev/&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; 2&amp;gt;&amp;amp;1; then
&#160; &#160; &#160; &#160; &#160; &#160;echo &lt;span class=&quot;code-quote&quot;&gt;&quot;Stopping job timeout watchdog (with pid=$watchdog_pid)&quot;&lt;/span&gt;
&#160; &#160; &#160; &#160; &#160; &#160;kill $watchdog_pid
&#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
&#160; &#160; &#160; &#160; &#160; &#160; echo &lt;span class=&quot;code-quote&quot;&gt;&quot;[ERROR] Test is timeout&quot;&lt;/span&gt;
 &#160; &#160; &#160; &#160; &#160; &#160;exit 1 &#160; &#160; &#160; 
      fi
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13544754">FLINK-32668</key>
            <summary>fix up watchdog timeout error msg  in common.sh(e2e test) </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="loserwang1024">Hongshun Wang</assignee>
                                    <reporter username="loserwang1024">Hongshun Wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 25 Jul 2023 08:11:58 +0000</created>
                <updated>Mon, 21 Aug 2023 08:10:31 +0000</updated>
                            <resolved>Mon, 21 Aug 2023 08:10:31 +0000</resolved>
                                    <version>1.16.2</version>
                    <version>1.18.0</version>
                    <version>1.17.1</version>
                                    <fixVersion>1.18.0</fixVersion>
                                    <component>Build System / CI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17746861" author="JIRAUSER298968" created="Tue, 25 Jul 2023 09:07:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; ,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; ,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Leonard&quot; class=&quot;user-hover&quot; rel=&quot;leonard&quot;&gt;Leonard&lt;/a&gt; &#65292;CC. Would you like to assign this to me?&lt;/p&gt;</comment>
                            <comment id="17746923" author="mapohl" created="Tue, 25 Jul 2023 11:28:22 +0000"  >&lt;p&gt;Thanks for raising this issue, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=loserwang1024&quot; class=&quot;user-hover&quot; rel=&quot;loserwang1024&quot;&gt;loserwang1024&lt;/a&gt;. I&apos;m not sure about the error message, though: Isn&apos;t it more of a warning rather than an error message because the outcome of the function is still the desired one (i.e. the process is gone). But we can move that discussion into the corresponding PR. I&apos;m gonna assign the issue to you and update the Jira metadata.&lt;/p&gt;</comment>
                            <comment id="17747240" author="JIRAUSER298968" created="Wed, 26 Jul 2023 02:52:06 +0000"  >&lt;p&gt;Thanks for your advise, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;In&#160;fact,&#160;it&apos;s&#160;also&#160;hard&#160;for&#160;me&#160;to&#160;decide&#160;whether&#160;to&#160;throw&#160;an&#160;error,&#160;which&#160;depends&#160;on&#160;whether&#160;a&#160;timeout&#160;test&#160;case&#160;meets&#160;our&#160;requirements.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&#160;If we think test case needs to meet the required time performance requirements, we need to throw an error here.&#160;&lt;/li&gt;
	&lt;li&gt;If we think that even if the timeout is met, it&apos;s&#160;&#160;still ok. The reason why kills this test is that &lt;b&gt;we just want to execute the next one quickly&lt;/b&gt;, then there is no need to throw an error here.A warning is well enough.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="17747441" author="mapohl" created="Wed, 26 Jul 2023 10:25:45 +0000"  >&lt;p&gt;As far as I see it, this failure can only occur if the watchdog thread exited on its own or the watchdog process was exited by some other process (which would be problematic if the corresponding test is still operating). The latter case is the problematic one because we might miss killing the test. We should throw an error in that case. We don&apos;t have to worry if both processes are already killed (in this situation, maybe even a warning is not needed but rather a informal output). WDYT?&lt;/p&gt;</comment>
                            <comment id="17755331" author="JIRAUSER298968" created="Thu, 17 Aug 2023 02:45:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; , thanks a lot. One more question:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&#160;We don&apos;t have to worry if both processes are already killed (in this situation, maybe even a warning is not needed but rather a informal output).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When the watchdog thread exits on its own, it indicates that the test has timed out. If no errors are thrown, then this timed-out test is considered successful finally.Is this the expected behavior?&lt;/p&gt;

&lt;p&gt;For example, the flink-streaming-kafka end-to-end test is set to run for 6 minutes. However, if the download of the Kafka distribution takes longer than 6 minutes, or if the Flink execution is too slow, the test may time out.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="17755421" author="mapohl" created="Thu, 17 Aug 2023 08:23:26 +0000"  >&lt;p&gt;If the test times out, the failure handling should be triggered (see &lt;a href=&quot;https://github.com/apache/flink/blob/c8ae39d4ac73f81873e1d8ac37e17c29ae330b23/flink-end-to-end-tests/test-scripts/common.sh#L957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;common.sh:957&lt;/a&gt;) to print a meaningful output. Nonetheless, the following kill command will cause the actual test run to return with a non-zero exit code. As a consequence, the script will fail. So, your scenario should be already covered by the existing code.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;kill_test_watchdog&lt;/tt&gt; covers a separate scenario: Killing the watchdog process if it&apos;s still around. Here, we shouldn&apos;t cover the corresponding test run anymore (and imply whether the test succeeded or not based on whether the watchdog process is still around). The error handling, as said in the previous paragraph, should be covered in the test execution itself.&lt;/p&gt;

&lt;p&gt;Please correct me if I&apos;m missing anything.&lt;/p&gt;</comment>
                            <comment id="17755529" author="JIRAUSER298968" created="Thu, 17 Aug 2023 12:34:36 +0000"  >&lt;p&gt;I get it.Thanks a lot, &#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; .I will modify this as soon as possible.&lt;/p&gt;</comment>
                            <comment id="17756729" author="mapohl" created="Mon, 21 Aug 2023 08:10:31 +0000"  >&lt;p&gt;master (1.18): 404a7804188c520b83ef38c863150b8bc4da80a3&lt;/p&gt;

&lt;p&gt;No backports were created because it&apos;s a minor issue without any effects on CI execution.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13061593" name="image-2023-07-25-15-27-37-441.png" size="1030006" author="loserwang1024" created="Tue, 25 Jul 2023 07:27:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jcrk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>