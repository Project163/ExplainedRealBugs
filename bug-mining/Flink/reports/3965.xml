<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:45:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-15669] SQL client can&apos;t cancel flink job</title>
                <link>https://issues.apache.org/jira/browse/FLINK-15669</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;in sql client, CLI client do cancel query operation through &lt;tt&gt;void cancelQuery(String sessionId, String resultId)&lt;/tt&gt; method in &lt;tt&gt;Executor&lt;/tt&gt;. However, the &lt;tt&gt;resultId&lt;/tt&gt; is a random UUID, is not the job id. So CLI client can&apos;t cancel a running job.&lt;/p&gt;


&lt;p&gt;related code in &lt;tt&gt;LocalExecutor&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &amp;lt;C&amp;gt; ResultDescriptor executeQueryInternal(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sessionId, ExecutionContext&amp;lt;C&amp;gt; context, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; query) {
	 ......

	&lt;span class=&quot;code-comment&quot;&gt;// store the result with a unique id
&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resultId = UUID.randomUUID().toString();
	resultStore.storeResult(resultId, result);

	......

	&lt;span class=&quot;code-comment&quot;&gt;// create execution
&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ProgramDeployer deployer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProgramDeployer(
		configuration, jobName, pipeline);

	&lt;span class=&quot;code-comment&quot;&gt;// start result retrieval
&lt;/span&gt;	result.startRetrieval(deployer);

	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ResultDescriptor(
			resultId,
			removeTimeAttributes(table.getSchema()),
			result.isMaterialized());
}



&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &amp;lt;T&amp;gt; void cancelQueryInternal(ExecutionContext&amp;lt;T&amp;gt; context, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resultId) {
	......

	&lt;span class=&quot;code-comment&quot;&gt;// stop Flink job
&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ClusterDescriptor&amp;lt;T&amp;gt; clusterDescriptor = context.createClusterDescriptor()) {
		ClusterClient&amp;lt;T&amp;gt; clusterClient = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			&lt;span class=&quot;code-comment&quot;&gt;// retrieve existing cluster
&lt;/span&gt;			clusterClient = clusterDescriptor.retrieve(context.getClusterId()).getClusterClient();
			&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
				&lt;span class=&quot;code-comment&quot;&gt;// ======== cancel job through resultId =======
&lt;/span&gt;				clusterClient.cancel(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JobID(StringUtils.hexStringToByte(resultId))).get();
			} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
				&lt;span class=&quot;code-comment&quot;&gt;// the job might has finished earlier
&lt;/span&gt;			}
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SqlExecutionException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Could not retrieve or create a cluster.&quot;&lt;/span&gt;, e);
		} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
			&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
				&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (clusterClient != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
					clusterClient.close();
				}
			} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
				&lt;span class=&quot;code-comment&quot;&gt;// ignore
&lt;/span&gt;			}
		}
	} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SqlExecutionException e) {
		&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
	} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
		&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SqlExecutionException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Could not locate a cluster.&quot;&lt;/span&gt;, e);
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


</description>
                <environment></environment>
        <key id="13280393">FLINK-15669</key>
            <summary>SQL client can&apos;t cancel flink job</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="godfreyhe">godfrey he</assignee>
                                    <reporter username="godfreyhe">godfrey he</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 19 Jan 2020 11:36:04 +0000</created>
                <updated>Mon, 27 Apr 2020 09:22:10 +0000</updated>
                            <resolved>Mon, 27 Apr 2020 09:22:10 +0000</resolved>
                                    <version>1.10.0</version>
                                    <fixVersion>1.10.1</fixVersion>
                    <fixVersion>1.11.0</fixVersion>
                                    <component>Table SQL / Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="17018899" author="godfreyhe" created="Sun, 19 Jan 2020 12:32:54 +0000"  >&lt;p&gt;I would like to fix it.&lt;/p&gt;

&lt;p&gt;my solution is: changes the non-blocking deployment to blocking deployment in &lt;tt&gt;LocalExecutor#executeQueryInternal&lt;/tt&gt; method, and then we can get jobId from &lt;tt&gt;JobClient&lt;/tt&gt;, and then use it as resultId. The parameter of &lt;tt&gt;DynamicResult#startRetrieval&lt;/tt&gt; method should also be changed from &lt;tt&gt;ProgramDeployer&lt;/tt&gt; to &lt;tt&gt;JobClient&lt;/tt&gt;, like &lt;tt&gt;void startRetrieval(JobClient jobClient);&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17019480" author="aljoscha" created="Mon, 20 Jan 2020 13:43:19 +0000"  >&lt;p&gt;I think that should work, yes. This at least waits until the job is successfully submitted, which seems good anyways.&lt;/p&gt;

&lt;p&gt;maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; has an opinion here as well.&lt;/p&gt;</comment>
                            <comment id="17072562" author="aljoscha" created="Wed, 1 Apr 2020 09:18:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt; Will you still work on this?&lt;/p&gt;</comment>
                            <comment id="17072570" author="godfreyhe" created="Wed, 1 Apr 2020 09:25:04 +0000"  >&lt;p&gt;yes, The PR is ready for the fix. And I also verify the scenario &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; mentioned today, and give the reply in the PR.&lt;/p&gt;</comment>
                            <comment id="17089430" author="aljoscha" created="Wed, 22 Apr 2020 08:09:00 +0000"  >&lt;p&gt;master: 0650e4b6b6a9725c3a9589a110b202478a68f90c&lt;br/&gt;
release-1.10: 6de489d136e142fad53a18abc6ab6d5ecee1f88f&lt;/p&gt;</comment>
                            <comment id="17092586" author="aljoscha" created="Sun, 26 Apr 2020 08:27:26 +0000"  >&lt;p&gt;I partially reverted these changes:&lt;br/&gt;
Only the tests are reverted because the fix is still good.  The added&lt;br/&gt;
tests don&apos;t work because of a race condition: if the query finishes&lt;br/&gt;
before the test cancels them the job status will be FINISHED, and not&lt;br/&gt;
CANCELLED, as the text expects.&lt;/p&gt;

&lt;p&gt;revert on release-1.10: 4518d18a726b35de9ff802d155fd8100dc711a63&lt;br/&gt;
revert on master: cbaea2924a90a1141d9794f6cd8f561e77ddc11a&lt;/p&gt;</comment>
                            <comment id="17093025" author="carp84" created="Mon, 27 Apr 2020 05:45:49 +0000"  >&lt;p&gt;Since the fix is still good and only test reverted, I think it makes sense to still leave the fix version of this JIRA to 1.10.1. Maybe we could also close this one and open another JIRA to harden the test, what do you think? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt; Thanks.&lt;/p&gt;</comment>
                            <comment id="17093199" author="godfreyhe" created="Mon, 27 Apr 2020 08:44:52 +0000"  >&lt;p&gt;I can create a random source which could be a bounded or unbounded table source and make sure the table source run longer than timeout. I will create a JIRA to fix this.&lt;/p&gt;</comment>
                            <comment id="17093212" author="aljoscha" created="Mon, 27 Apr 2020 08:54:44 +0000"  >&lt;p&gt;Thanks for the fast response, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17093239" author="carp84" created="Mon, 27 Apr 2020 09:22:10 +0000"  >&lt;p&gt;Thanks for the quick action &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;Closing this JIRA since the test case improvement is tracked by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17405&quot; title=&quot;add test cases for cancel job in SQL client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17405&quot;&gt;FLINK-17405&lt;/a&gt; instead.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13301194">FLINK-17405</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0anv4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>