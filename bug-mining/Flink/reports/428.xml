<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:19:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2191] Inconsistent use of Closure Cleaner in Streaming API</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2191</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In the streaming API operations on DataStream.java call clean() if the closure cleaner is enabled in the execution config. Methods in StreamExecutionEnvironment.java always call clean, no way of disabling it. Operations in the Scala Streaming API also always call clean(), no way of disabling it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12836546">FLINK-2191</key>
            <summary>Inconsistent use of Closure Cleaner in Streaming API</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jun 2015 13:39:40 +0000</created>
                <updated>Thu, 28 Feb 2019 11:15:26 +0000</updated>
                            <resolved>Wed, 10 Jun 2015 15:25:37 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14578904" author="aljoscha" created="Tue, 9 Jun 2015 13:53:42 +0000"  >&lt;p&gt;Did you start? I already have a fix.&lt;/p&gt;</comment>
                            <comment id="14580130" author="githubbot" created="Wed, 10 Jun 2015 06:53:30 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2191&quot; title=&quot;Inconsistent use of Closure Cleaner in Streaming API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2191&quot;&gt;&lt;del&gt;FLINK-2191&lt;/del&gt;&lt;/a&gt; Fix inconsistent use of closure cleaner in Scala Streaming&lt;/p&gt;

&lt;p&gt;    The closure cleaner still cannot be disabled for the Timestamp extractor&lt;br/&gt;
    in Time and for the delta function in Delta (windowing helpers).&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; closure-cleaner-fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #813&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 07ad8dfb0d766a40fb27611f9c8c9a155c48c6c8&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-06-09T14:17:48Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2191&quot; title=&quot;Inconsistent use of Closure Cleaner in Streaming API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2191&quot;&gt;&lt;del&gt;FLINK-2191&lt;/del&gt;&lt;/a&gt; Fix inconsistent use of closure cleaner in Scala Streaming&lt;/p&gt;

&lt;p&gt;    The closure cleaner still cannot be disabled for the Timestamp extractor&lt;br/&gt;
    in Time and for the delta function in Delta (windowing helpers).&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14580316" author="githubbot" created="Wed, 10 Jun 2015 09:47:40 +0000"  >&lt;p&gt;Github user mbalassi commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813#discussion_r32102450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813#discussion_r32102450&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-scala/src/main/scala/org/apache/flink/streaming/api/scala/DataStream.scala &amp;#8212;&lt;br/&gt;
    @@ -781,11 +780,24 @@ class DataStream&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;(javaStream: JavaStream&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt;) {&lt;br/&gt;
         if (fun == null) &lt;/p&gt;
{
           throw new NullPointerException(&quot;Sink function must not be null.&quot;)
         }
&lt;p&gt;    +    val cleanFun = clean(fun)&lt;br/&gt;
         val sinkFunction = new SinkFunction&lt;span class=&quot;error&quot;&gt;&amp;#91;T&amp;#93;&lt;/span&gt; &lt;/p&gt;
{
    -      val cleanFun = clean(fun)
           def invoke(in: T) = cleanFun(in)
         }
&lt;p&gt;         this.addSink(sinkFunction)&lt;br/&gt;
       }&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +   * Returns a &quot;closure-cleaned&quot; version of the given function. Cleans only if closure cleaning&lt;br/&gt;
    +   * is not disabled in the &lt;/p&gt;
{@link org.apache.flink.api.common.ExecutionConfig}
&lt;p&gt;    +   */&lt;br/&gt;
    +  private&lt;span class=&quot;error&quot;&gt;&amp;#91;flink&amp;#93;&lt;/span&gt; def clean&lt;span class=&quot;error&quot;&gt;&amp;#91;F &amp;lt;: AnyRef&amp;#93;&lt;/span&gt;(f: F): F = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Why do we need multiple clean functions? I think scala visibility solves that. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14580319" author="githubbot" created="Wed, 10 Jun 2015 09:48:09 +0000"  >&lt;p&gt;Github user mbalassi commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813#discussion_r32102485&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813#discussion_r32102485&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-scala/src/main/scala/org/apache/flink/streaming/api/scala/StreamExecutionEnvironment.scala &amp;#8212;&lt;br/&gt;
    @@ -455,15 +455,22 @@ class StreamExecutionEnvironment(javaEnv: JavaEnv) {&lt;br/&gt;
        */&lt;br/&gt;
       def getStreamGraph = javaEnv.getStreamGraph&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +   * Returns a &quot;closure-cleaned&quot; version of the given function. Cleans only if closure cleaning&lt;br/&gt;
    +   * is not disabled in the &lt;/p&gt;
{@link org.apache.flink.api.common.ExecutionConfig}
&lt;p&gt;    +   */&lt;br/&gt;
    +  private&lt;span class=&quot;error&quot;&gt;&amp;#91;flink&amp;#93;&lt;/span&gt; def clean&lt;span class=&quot;error&quot;&gt;&amp;#91;F &amp;lt;: AnyRef&amp;#93;&lt;/span&gt;(f: F): F = {&lt;br/&gt;
    +    if (getConfig.isClosureCleanerEnabled) &lt;/p&gt;
{
    +      ClosureCleaner.clean(f, true)
    +    }
&lt;p&gt; else &lt;/p&gt;
{
    +      ClosureCleaner.ensureSerializable(f)
    +    }
&lt;p&gt;    +    f&lt;br/&gt;
    +  }&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I would suggest to have just this clean.&lt;/p&gt;</comment>
                            <comment id="14580331" author="githubbot" created="Wed, 10 Jun 2015 10:01:12 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813#discussion_r32103307&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813#discussion_r32103307&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-staging/flink-streaming/flink-streaming-scala/src/main/scala/org/apache/flink/streaming/api/scala/StreamExecutionEnvironment.scala &amp;#8212;&lt;br/&gt;
    @@ -455,15 +455,22 @@ class StreamExecutionEnvironment(javaEnv: JavaEnv) {&lt;br/&gt;
        */&lt;br/&gt;
       def getStreamGraph = javaEnv.getStreamGraph&lt;/p&gt;

&lt;p&gt;    +  /**&lt;br/&gt;
    +   * Returns a &quot;closure-cleaned&quot; version of the given function. Cleans only if closure cleaning&lt;br/&gt;
    +   * is not disabled in the &lt;/p&gt;
{@link org.apache.flink.api.common.ExecutionConfig}
&lt;p&gt;    +   */&lt;br/&gt;
    +  private&lt;span class=&quot;error&quot;&gt;&amp;#91;flink&amp;#93;&lt;/span&gt; def clean&lt;span class=&quot;error&quot;&gt;&amp;#91;F &amp;lt;: AnyRef&amp;#93;&lt;/span&gt;(f: F): F = {&lt;br/&gt;
    +    if (getConfig.isClosureCleanerEnabled) &lt;/p&gt;
{
    +      ClosureCleaner.clean(f, true)
    +    }
&lt;p&gt; else &lt;/p&gt;
{
    +      ClosureCleaner.ensureSerializable(f)
    +    }
&lt;p&gt;    +    f&lt;br/&gt;
    +  }&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I will look into it. The problem is that the DataStream and all the other classes don&apos;t have a reference to the Scala StreamExecutionEnvironment.&lt;/p&gt;</comment>
                            <comment id="14580465" author="githubbot" created="Wed, 10 Jun 2015 12:38:50 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813#issuecomment-110733849&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813#issuecomment-110733849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I updated it, now we still have several &quot;clean&quot; functions but they just forward to the StreamingExEnv.scalaClean() function. &lt;/p&gt;</comment>
                            <comment id="14580491" author="githubbot" created="Wed, 10 Jun 2015 12:53:49 +0000"  >&lt;p&gt;Github user gyfora commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813#issuecomment-110739702&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813#issuecomment-110739702&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good to me :+1: &lt;/p&gt;</comment>
                            <comment id="14580614" author="githubbot" created="Wed, 10 Jun 2015 15:01:36 +0000"  >&lt;p&gt;Github user mbalassi commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813#issuecomment-110786608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813#issuecomment-110786608&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging.&lt;/p&gt;</comment>
                            <comment id="14580631" author="githubbot" created="Wed, 10 Jun 2015 15:20:04 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/813&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14580636" author="mbalassi" created="Wed, 10 Jun 2015 15:25:37 +0000"  >&lt;p&gt;Implemented via e2304c4. Minor issue remains, tracked in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2201&quot; title=&quot;Inconsistent use of ClosureCleaner in streaming window helpers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2201&quot;&gt;&lt;del&gt;FLINK-2201&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fty7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>