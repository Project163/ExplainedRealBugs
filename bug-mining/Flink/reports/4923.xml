<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:51:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20273] Fix Table api Kafka connector Sink Partitioner Document Error</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20273</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-master/dev/table/connectors/kafka.html#sink-partitioning&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;doc&lt;/a&gt;&#160;tells us that the kafka sink uses fixed partitioner by default. However, in my local test, the it uses sticky partitioner to get the record partition id if key is not set.&lt;/p&gt;

&lt;p&gt;You can add the test in the &lt;tt&gt;KafkaTableITCase&lt;/tt&gt;, the code follows&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testKafkaSourceSinkWithDefaultPartitioner() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isLegacyConnector) {
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
		}
		&lt;span class=&quot;code-comment&quot;&gt;// we always use a different topic name &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; each parameterized topic,
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// in order to make sure the topic can be created.
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; topic = &lt;span class=&quot;code-quote&quot;&gt;&quot;key_full_value_topic_&quot;&lt;/span&gt; + format;
		createTestTopic(topic, 3, 1);

		&lt;span class=&quot;code-comment&quot;&gt;// ---------- Produce an event time stream into Kafka -------------------
&lt;/span&gt;		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; groupId = standardProps.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;group.id&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; bootstraps = standardProps.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;bootstrap.servers&quot;&lt;/span&gt;);

		&lt;span class=&quot;code-comment&quot;&gt;// compared to the partial value test we cannot support both k_user_id and user_id in a full
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// value due to duplicate names after key prefix stripping,
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// fields are reordered on purpose,
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// fields &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; keys and values are overlapping
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; createSourceTable = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(
				&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE kafkaSource (\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  `user_id` BIGINT,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  `name` STRING,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  `partition` INT METADATA&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;) WITH (\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.group.id&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;scan.startup.mode&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;earliest-offset&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;,
				topic,
				bootstraps,
				groupId,
				format);
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; createSinkTable = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(
				&lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE kafkaSink (\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  `user_id` BIGINT,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  `name` STRING\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;) WITH (\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.group.id&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;scan.startup.mode&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;earliest-offset&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;  &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;\n&quot;&lt;/span&gt;
						+ &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;,
				topic,
				bootstraps,
				groupId,
				format);

		tEnv.executeSql(createSourceTable);
		tEnv.executeSql(createSinkTable);

		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; initialValues = &lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO kafkaSink\n&quot;&lt;/span&gt;
									+ &lt;span class=&quot;code-quote&quot;&gt;&quot;VALUES\n&quot;&lt;/span&gt;
									+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (1, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 1&apos;&lt;/span&gt;),\n&quot;&lt;/span&gt;
									+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (2, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 2&apos;&lt;/span&gt;),\n&quot;&lt;/span&gt;
									+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (3, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 3&apos;&lt;/span&gt;)&quot;&lt;/span&gt;;
		tEnv.executeSql(initialValues).await();

		initialValues = &lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO kafkaSink\n&quot;&lt;/span&gt;
				+ &lt;span class=&quot;code-quote&quot;&gt;&quot;VALUES\n&quot;&lt;/span&gt;
				+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (4, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 4&apos;&lt;/span&gt;),\n&quot;&lt;/span&gt;
				+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (5, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 5&apos;&lt;/span&gt;),\n&quot;&lt;/span&gt;
				+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (6, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 6&apos;&lt;/span&gt;)&quot;&lt;/span&gt;;
		tEnv.executeSql(initialValues).await();

		initialValues = &lt;span class=&quot;code-quote&quot;&gt;&quot;INSERT INTO kafkaSink\n&quot;&lt;/span&gt;
				+ &lt;span class=&quot;code-quote&quot;&gt;&quot;VALUES\n&quot;&lt;/span&gt;
				+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (7, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 7&apos;&lt;/span&gt;),\n&quot;&lt;/span&gt;
				+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (8, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 8&apos;&lt;/span&gt;),\n&quot;&lt;/span&gt;
				+ &lt;span class=&quot;code-quote&quot;&gt;&quot; (9, &lt;span class=&quot;code-quote&quot;&gt;&apos;name 9&apos;&lt;/span&gt;)&quot;&lt;/span&gt;;
		tEnv.executeSql(initialValues).await();


		&lt;span class=&quot;code-comment&quot;&gt;// ---------- Consume stream from Kafka -------------------
&lt;/span&gt;
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;Row&amp;gt; result = collectRows(tEnv.sqlQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT * FROM kafkaSource&quot;&lt;/span&gt;), 9);



		&lt;span class=&quot;code-comment&quot;&gt;// ------------- cleanup -------------------
&lt;/span&gt;
		deleteTestTopic(topic);
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The test will use the kafka default partitioner and sends record to kafka topic. After insert, we can read the record with the parititon id. If it uses the fixed partitioner, all records will has the same partition id. I repeat the test 3 times and the results are&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// the first result
&lt;/span&gt;&amp;lt;1,name 1,1&amp;gt;
&amp;lt;2,name 2,1&amp;gt;
&amp;lt;3,name 3,1&amp;gt;
&amp;lt;7,name 7,1&amp;gt;
&amp;lt;4,name 4,0&amp;gt;
&amp;lt;5,name 5,0&amp;gt;
&amp;lt;6,name 6,0&amp;gt;
&amp;lt;8,name 8,0&amp;gt;
&amp;lt;9,name 9,0&amp;gt;
&lt;span class=&quot;code-comment&quot;&gt;// the second result
&lt;/span&gt;&amp;lt;1,name 1,1&amp;gt;
&amp;lt;2,name 2,1&amp;gt;
&amp;lt;3,name 3,1&amp;gt;
&amp;lt;4,name 4,0&amp;gt;
&amp;lt;5,name 5,0&amp;gt;
&amp;lt;6,name 6,0&amp;gt;
&amp;lt;7,name 7,0&amp;gt;
&amp;lt;8,name 8,0&amp;gt;
&amp;lt;9,name 9,0&amp;gt;
&lt;span class=&quot;code-comment&quot;&gt;// the third result
&lt;/span&gt;&amp;lt;9,name 9,2&amp;gt;
&amp;lt;1,name 1,0&amp;gt;
&amp;lt;2,name 2,0&amp;gt;
&amp;lt;3,name 3,0&amp;gt;
&amp;lt;4,name 4,0&amp;gt;
&amp;lt;5,name 5,0&amp;gt;
&amp;lt;6,name 6,0&amp;gt;
&amp;lt;7,name 7,1&amp;gt;
&amp;lt;8,name 8,1&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The last column is the partition-id and we have 3 partitions in the test. The results show the default partitioner is sticky paritioner rather than fixed partitioner.&lt;/p&gt;

&lt;p&gt;By the way, the sink partitioning section in the doc only works when the key is null. If we set the key fields, the &lt;tt&gt;round-robin&lt;/tt&gt; strategy will not work.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13341970">FLINK-20273</key>
            <summary>Fix Table api Kafka connector Sink Partitioner Document Error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fsk119">Shengkai Fang</assignee>
                                    <reporter username="fsk119">Shengkai Fang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 22 Nov 2020 08:08:12 +0000</created>
                <updated>Mon, 7 Dec 2020 15:28:44 +0000</updated>
                            <resolved>Mon, 7 Dec 2020 15:28:44 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.12.1</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Documentation</component>
                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17236949" author="jark" created="Sun, 22 Nov 2020 14:05:34 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; for the investigation!&lt;/p&gt;</comment>
                            <comment id="17245272" author="jark" created="Mon, 7 Dec 2020 15:28:44 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: d59e9f9748234e4dc4749f45863fe6e0a34b8961&lt;/li&gt;
	&lt;li&gt;release-1.12: 033b230a155ed188ca8051c5defcda016427591a&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ktk8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>