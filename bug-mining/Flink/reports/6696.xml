<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:14:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14896] Kinesis connector doesn&apos;t shade jackson dependency</title>
                <link>https://issues.apache.org/jira/browse/FLINK-14896</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;flink-kinesis-connector depends on aws java sdk which is shaded to&#160;&lt;tt&gt;org.apache.flink.kinesis.shaded.com.amazonaws.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;However, the aws sdk has a transitive dependency to&#160;jackson wich is not shaded in the artifact.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;This creates problem when running flink on YARN:&#160;&lt;/tt&gt;&lt;tt&gt;The aws sdk requires jackson-core v2.6 but hadoop pulls in 2.3. See &lt;a href=&quot;https://github.com/apache/flink/blob/e7c11ed672013512e5b159e7e892b27b1ef60a1b/flink-yarn/pom.xml#L133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;If YARN uses the loads wrong jackson version from classpath. Jod fails with&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2019-11-20 17:23:11,563 ERROR org.apache.flink.runtime.webmonitor.handlers.JarRunHandler    - Unhandled exception.org.apache.flink.client.program.ProgramInvocationException: The program caused an error: &#160;&#160;&#160;&#160;at org.apache.flink.client.program.OptimizerPlanEnvironment.getOptimizedPlan(OptimizerPlanEnvironment.java:93)&#160;&#160;&#160;&#160;at org.apache.flink.client.program.PackagedProgramUtils.createJobGraph(PackagedProgramUtils.java:80)&#160;&#160;&#160;&#160;at org.apache.flink.runtime.webmonitor.handlers.utils.JarHandlerUtils$JarHandlerContext.toJobGraph(JarHandlerUtils.java:126)&#160;&#160;&#160;&#160;at org.apache.flink.runtime.webmonitor.handlers.JarRunHandler.lambda$getJobGraphAsync$6(JarRunHandler.java:142)&#160;&#160;&#160;&#160;at java.util.concurrent.CompletableFuture$AsyncSupply.run(CompletableFuture.java:1590)&#160;&#160;&#160;&#160;at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)&#160;&#160;&#160;&#160;at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)&#160;&#160;&#160;&#160;at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)Caused by: java.lang.NoSuchMethodError: com.fasterxml.jackson.databind.ObjectMapper.enable([Lcom/fasterxml/jackson/core/JsonParser$Feature;)Lcom/fasterxml/jackson/databind/ObjectMapper;&#160;&#160;&#160;&#160;at com.amazonaws.partitions.PartitionsLoader.&amp;lt;clinit&amp;gt;(PartitionsLoader.java:54)&#160;&#160;&#160;&#160;at com.amazonaws.regions.RegionMetadataFactory.create(RegionMetadataFactory.java:30)&#160;&#160;&#160;&#160;at com.amazonaws.regions.RegionUtils.initialize(RegionUtils.java:65)&#160;&#160;&#160;&#160;at com.amazonaws.regions.RegionUtils.getRegionMetadata(RegionUtils.java:53)&#160;&#160;&#160;&#160;at com.amazonaws.regions.RegionUtils.getRegion(RegionUtils.java:107)&#160;&#160;&#160;&#160;at com.amazonaws.client.builder.AwsClientBuilder.getRegionObject(AwsClientBuilder.java:256)&#160;&#160;&#160;&#160;at com.amazonaws.client.builder.AwsClientBuilder.setRegion(AwsClientBuilder.java:460)&#160;&#160;&#160;&#160;at com.amazonaws.client.builder.AwsClientBuilder.configureMutableProperties(AwsClientBuilder.java:424)&#160;&#160;&#160;&#160;at com.amazonaws.client.builder.AwsAsyncClientBuilder.build(AwsAsyncClientBuilder.java:80)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The&#160;flink-kinesis-connector should do as other connectors: shade jackson or use the&#160;flink-shaded-jackson core dependency&lt;/p&gt;</description>
                <environment>&lt;p&gt;AWS EMR 5.28.0&lt;/p&gt;</environment>
        <key id="13269836">FLINK-14896</key>
            <summary>Kinesis connector doesn&apos;t shade jackson dependency</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10200" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Not a Priority</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dannycranmer">Danny Cranmer</assignee>
                                    <reporter username="RustedBones">Michel Davit</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 21 Nov 2019 13:00:48 +0000</created>
                <updated>Tue, 13 Jun 2023 09:08:16 +0000</updated>
                            <resolved>Tue, 27 Sep 2022 07:38:56 +0000</resolved>
                                    <version>1.9.0</version>
                    <version>1.16.0</version>
                    <version>1.15.2</version>
                                    <fixVersion>1.17.0</fixVersion>
                                    <component>Connectors / Kinesis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16979278" author="rustedbones" created="Thu, 21 Nov 2019 13:39:19 +0000"  >&lt;p&gt;After digging deeper, this bug only happens if user make custom use of the shaded aws sdk.&lt;/p&gt;

&lt;p&gt;In our case, we create a DynamoDbClient in our code, which leads to the issue. If user does not access the sdk, the problem does not trigger.&lt;/p&gt;

&lt;p&gt;Not packaging the required &lt;tt&gt;jackson-databind&lt;/tt&gt;&#160;dependency from the aws sdk is not intuitive and can easily lead to&#160;ClassNotFoundError or mismatched version.&lt;/p&gt;</comment>
                            <comment id="16979959" author="aljoscha" created="Fri, 22 Nov 2019 08:21:37 +0000"  >&lt;p&gt;You mean the bug in the Flink framework code triggers when you access the SDK? Or there is a problem purely in user code when accessing the SDK (the aws SDK)?&lt;/p&gt;</comment>
                            <comment id="16980053" author="rustedbones" created="Fri, 22 Nov 2019 10:41:47 +0000"  >&lt;p&gt;The bug triggers only when user code access part of the AWS SDK which relies on jackson (in my case&#160; the PartitionsLoader).&lt;/p&gt;

&lt;p&gt;In our case, we were simply using the SDK in the main function to figure out the DynamoDb stream ARN from the table name. Seeing that flink includes the aws-sdk-dynamodb, I though it was safe to use it. It actually worked for some time until the classpath ordering changed when updating to 1.9. At this point, the jackson lib used was the one pulled by hadoop which is not compatible with the SDK.&lt;/p&gt;

&lt;p&gt;Even if this does not impact the flink framework itself, I&apos;considering this as a &lt;b&gt;minor&lt;/b&gt; bug since this problem can be avoided without costs (flink already contains a compatible shaded version of jackson)&lt;/p&gt;</comment>
                            <comment id="17321437" author="flink-jira-bot" created="Wed, 14 Apr 2021 22:46:16 +0000"  >&lt;p&gt;This issue and all of its Sub-Tasks have not been updated for 180 days. So, it has been labeled &quot;stale-minor&quot;. If you are still affected by this bug or are still interested in this issue, please give an update and remove the label. In 7 days the issue will be closed automatically.&lt;/p&gt;</comment>
                            <comment id="17329644" author="flink-jira-bot" created="Thu, 22 Apr 2021 22:56:35 +0000"  >&lt;p&gt;This issue has been labeled &quot;stale-minor&quot; for 7 days. It is closed now. If you are still affected by this or would like to raise the priority of this ticket please re-open, removing the label &quot;auto-closed&quot; and raise the ticket priority accordingly.&lt;/p&gt;</comment>
                            <comment id="17389687" author="knaufk" created="Thu, 29 Jul 2021 07:31:07 +0000"  >&lt;p&gt;Re-opening in accordance with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-23206&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17604983" author="afedulov" created="Wed, 14 Sep 2022 21:26:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny.cranmer&quot; class=&quot;user-hover&quot; rel=&quot;danny.cranmer&quot;&gt;danny.cranmer&lt;/a&gt; could you address this one? It causes issues in the user code.&lt;/p&gt;</comment>
                            <comment id="17605536" author="dannycranmer" created="Thu, 15 Sep 2022 21:47:17 +0000"  >&lt;p&gt;Copy from Slack (&lt;a href=&quot;https://apache-flink.slack.com/archives/C03GV7L3G2C/p1663190927323999&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://apache-flink.slack.com/archives/C03GV7L3G2C/p1663190927323999&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I have done some digging and cannot find anything to say why Jackson was not shaded. Here is the original commit to add the shade plugin: &lt;a href=&quot;https://github.com/apache/flink/commit/fd3dba6e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/fd3dba6e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I cannot see any public contracts that would be broken by using the shaded variant instead. That being said, it would be a breaking change since users could be relying on this transitive dependency. Therefore I would be inclined to fix in the next x.y.0 release. Thoughts?&lt;/p&gt;</comment>
                            <comment id="17607294" author="dannycranmer" created="Tue, 20 Sep 2022 16:26:01 +0000"  >&lt;p&gt;There is a good discussion on the old PR &lt;a href=&quot;https://github.com/apache/flink/pull/10285&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/10285&lt;/a&gt;. I am inclined to shade Jackson since it is not exposed on the public interfaces, and the majority of dependencies are shaded for this connector, including AWS SDK. This means users cannot change Jackson without potentially breaking AWS SDK. Since AWS SDK is shaded, the user cannot override this version.&lt;/p&gt;

&lt;p&gt;Looking forwards, the new Kinesis connector does not use Jackson directly, or shade the AWS SDK.&lt;/p&gt;</comment>
                            <comment id="17609878" author="dannycranmer" created="Tue, 27 Sep 2022 07:38:50 +0000"  >&lt;p&gt;Merged commit &lt;a href=&quot;https://github.com/apache/flink/commit/54f81c4a9d1e29b887d4bccafc30df0392146b94&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;54f81c4&lt;/tt&gt;&lt;/a&gt;&#160;into&#160;apache:master&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08vg0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Shade and relocate transitive Jackson dependencies of {{flink-connector-kinesis}}. If your Flink job was transitively relying on the these, you may need to include additional Jackson dependencies into your project.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>