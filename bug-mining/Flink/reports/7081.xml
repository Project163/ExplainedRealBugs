<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:17:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-31967] SQL with LAG function NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/FLINK-31967</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I want to make a query with the LAG function. And got Job Exception without any explanations.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Code:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void t1_LeadLag(DataStream&amp;lt;UserModel&amp;gt; ds, StreamExecutionEnvironment env) {
    StreamTableEnvironment te = StreamTableEnvironment.create(env);
    Table t = te.fromDataStream(ds, Schema.newBuilder().columnByExpression(&lt;span class=&quot;code-quote&quot;&gt;&quot;proctime&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;proctime()&quot;&lt;/span&gt;).build());

    te.createTemporaryView(&lt;span class=&quot;code-quote&quot;&gt;&quot;users&quot;&lt;/span&gt;, t);

    Table res = te.sqlQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT userId, `count`,\n&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; LAG(`count`) OVER (PARTITION BY userId ORDER BY proctime) AS prev_quantity\n&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; FROM users&quot;&lt;/span&gt;);

    te.toChangelogStream(res).print();
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Input:&lt;/b&gt;&lt;/p&gt;

{&quot;userId&quot;:3,&quot;count&quot;:0,&quot;dt&quot;:&quot;2023-04-28T07:44:21.551Z&quot;}

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Exception:&lt;/b&gt;&#160;I remove part about basic JobExecutionException and kept the important(i think)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.NullPointerException
    at org.apache.flink.table.data.GenericRowData.getInt(GenericRowData.java:149)
    at org.apache.flink.table.data.RowData.lambda$createFieldGetter$245ca7d1$6(RowData.java:245)
    at org$apache$flink$table$runtime$functions$aggregate$LagAggFunction$LagAcc$2$Converter.toExternal(Unknown Source)
    at org.apache.flink.table.data.conversion.StructuredObjectConverter.toExternal(StructuredObjectConverter.java:101)
    at UnboundedOverAggregateHelper$15.setAccumulators(Unknown Source)
    at org.apache.flink.table.runtime.operators.over.ProcTimeUnboundedPrecedingFunction.processElement(ProcTimeUnboundedPrecedingFunction.java:92)
    at org.apache.flink.table.runtime.operators.over.ProcTimeUnboundedPrecedingFunction.processElement(ProcTimeUnboundedPrecedingFunction.java:42)
    at org.apache.flink.streaming.api.operators.KeyedProcessOperator.processElement(KeyedProcessOperator.java:83)
    at org.apache.flink.streaming.runtime.io.RecordProcessorUtils.lambda$getRecordProcessor$0(RecordProcessorUtils.java:60)
    at org.apache.flink.streaming.runtime.tasks.OneInputStreamTask$StreamTaskNetworkOutput.emitRecord(OneInputStreamTask.java:237)
    at org.apache.flink.streaming.runtime.io.AbstractStreamTaskNetworkInput.processElement(AbstractStreamTaskNetworkInput.java:146)
    at org.apache.flink.streaming.runtime.io.AbstractStreamTaskNetworkInput.emitNext(AbstractStreamTaskNetworkInput.java:110)
    at org.apache.flink.streaming.runtime.io.StreamOneInputProcessor.processInput(StreamOneInputProcessor.java:65)
    at org.apache.flink.streaming.runtime.tasks.StreamTask.processInput(StreamTask.java:550)
    at org.apache.flink.streaming.runtime.tasks.mailbox.MailboxProcessor.runMailboxLoop(MailboxProcessor.java:231)
    at org.apache.flink.streaming.runtime.tasks.StreamTask.runMailboxLoop(StreamTask.java:839)
    at org.apache.flink.streaming.runtime.tasks.StreamTask.invoke(StreamTask.java:788)
    at org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:952)
    at org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:931)
    at org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:745)
    at org.apache.flink.runtime.taskmanager.Task.run(Task.java:562)
    at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13534418">FLINK-31967</key>
            <summary>SQL with LAG function NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pyro">Haojin Wang</assignee>
                                    <reporter username="padavan">padavan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 28 Apr 2023 08:06:38 +0000</created>
                <updated>Wed, 31 May 2023 03:07:34 +0000</updated>
                            <resolved>Wed, 31 May 2023 03:07:34 +0000</resolved>
                                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.16.3</fixVersion>
                    <fixVersion>1.17.2</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17717550" author="martijnvisser" created="Fri, 28 Apr 2023 08:55:39 +0000"  >&lt;p&gt;I can&apos;t reproduce this. I&apos;ve created the following table:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; users (
    userId &lt;span class=&quot;code-keyword&quot;&gt;STRING&lt;/span&gt;,
    `&lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;` &lt;span class=&quot;code-keyword&quot;&gt;INT&lt;/span&gt;,
    proctime &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; PROCTIME()
) &lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;fields&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;min&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;fields&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;max&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then run &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; userId, `&lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;`, LAG(`&lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;`) &lt;span class=&quot;code-keyword&quot;&gt;OVER&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;PARTITION&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; userId &lt;span class=&quot;code-keyword&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; proctime) &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; prev_quantity &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; users;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On Flink 1.17.0. There&apos;s no NPE for me. Which Flink version did you use?&lt;/p&gt;</comment>
                            <comment id="17717552" author="martijnvisser" created="Fri, 28 Apr 2023 08:58:17 +0000"  >&lt;p&gt;Also, when using:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;TABLE&lt;/span&gt; users (
    userId &lt;span class=&quot;code-keyword&quot;&gt;INT&lt;/span&gt;,
    `&lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;` &lt;span class=&quot;code-keyword&quot;&gt;INT&lt;/span&gt;,
    proctime &lt;span class=&quot;code-keyword&quot;&gt;AS&lt;/span&gt; PROCTIME()
) &lt;span class=&quot;code-keyword&quot;&gt;WITH&lt;/span&gt; (
  &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;fields&lt;/span&gt;.userId.&lt;span class=&quot;code-keyword&quot;&gt;min&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;fields&lt;/span&gt;.userId.&lt;span class=&quot;code-keyword&quot;&gt;max&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;10&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;fields&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;min&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;,
  &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;fields&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;count&lt;/span&gt;.&lt;span class=&quot;code-keyword&quot;&gt;max&lt;/span&gt;&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;10&apos;&lt;/span&gt;
);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get results as I would expect. &lt;/p&gt;</comment>
                            <comment id="17717628" author="JIRAUSER287909" created="Fri, 28 Apr 2023 11:44:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;/usr/lib/jvm/java-1.11.0-openjdk-amd64/&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13057705/13057705_image-2023-04-28-14-46-19-736.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
 &#160;
  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
&#160;
 &#160;KafkaSource&amp;lt;UserModel&amp;gt; source = KafkaSource.&amp;lt;UserModel&amp;gt;builder()
                .setBootstrapServers(kafka)
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .setTopics(&lt;span class=&quot;code-quote&quot;&gt;&quot;x1&quot;&lt;/span&gt;).setGroupId(&lt;span class=&quot;code-quote&quot;&gt;&quot;flink_group&quot;&lt;/span&gt;)
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .setValueOnlyDeserializer(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JsonConverter()).build();
&#160;
  &#160; &#160; &#160; WatermarkStrategy&amp;lt;UserModel&amp;gt; strategy = WatermarkStrategy.               &amp;lt;UserModel&amp;gt;forBoundedOutOfOrderness(Duration.ofSeconds(10))
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .withTimestampAssigner((i, timestamp) -&amp;gt; {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; time = i.dt.toInstant(ZoneOffset.UTC).toEpochMilli();
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; time;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; });
&#160; &#160; &#160; &#160; DataStream&amp;lt;UserModel&amp;gt; ds = env.fromSource(source, strategy, &lt;span class=&quot;code-quote&quot;&gt;&quot;Kafka Source&quot;&lt;/span&gt;);
 &#160; &#160; &#160; &#160;
        t1_LeadLag(ds, env);
        env.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;Flink Java API Skeleton&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void t1_LeadLag(DataStream&amp;lt;UserModel&amp;gt; ds, StreamExecutionEnvironment env) {
    StreamTableEnvironment te = StreamTableEnvironment.create(env);
    Table t = te.fromDataStream(ds, Schema.newBuilder().columnByExpression(&lt;span class=&quot;code-quote&quot;&gt;&quot;proctime&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;proctime()&quot;&lt;/span&gt;).build());

    te.createTemporaryView(&lt;span class=&quot;code-quote&quot;&gt;&quot;users&quot;&lt;/span&gt;, t);

    Table res = te.sqlQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT userId, `count`,\n&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; LAG(`count`) OVER (PARTITION BY userId ORDER BY proctime) AS prev_quantity\n&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; FROM users&quot;&lt;/span&gt;);

    te.toChangelogStream(res).print();
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17717636" author="martijnvisser" created="Fri, 28 Apr 2023 11:54:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=padavan&quot; class=&quot;user-hover&quot; rel=&quot;padavan&quot;&gt;padavan&lt;/a&gt; You are mixing different versions of Flink (1.17.0, 1.16.1). That won&apos;t work. Please make sure that you are all using the same versions. &lt;/p&gt;</comment>
                            <comment id="17717647" author="JIRAUSER287909" created="Fri, 28 Apr 2023 12:15:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt;&#160; i sync to latest version&#160;&lt;/p&gt;

&lt;p&gt;1.17.0&lt;/p&gt;

&lt;p&gt;nothing change , same error&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13057708/13057708_image-2023-04-28-15-17-49-144.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17717652" author="martijnvisser" created="Fri, 28 Apr 2023 12:25:19 +0000"  >&lt;p&gt;I can&apos;t reproduce it. You&apos;re using Kafka Source, so it could be your incoming data. Can you create a reproducer with the datagen connector? &lt;/p&gt;</comment>
                            <comment id="17717672" author="JIRAUSER287909" created="Fri, 28 Apr 2023 13:18:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;wow , intresting if use DataGen then all work fine:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void t1_LeadLag(StreamExecutionEnvironment env) {
&#160; &#160; &#160; &#160; StreamTableEnvironment te = StreamTableEnvironment.create(env);

&#160; &#160; &#160; &#160; te.executeSql(
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE users (\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; &#160; &#160;userId INT,\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; &#160; &#160;`count` INT,\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; &#160; &#160;proctime AS PROCTIME()\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;) WITH (\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; &#160;&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; &#160;&lt;span class=&quot;code-quote&quot;&gt;&apos;fields.userId.min&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;1&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; &#160;&lt;span class=&quot;code-quote&quot;&gt;&apos;fields.userId.max&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;10&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; &#160;&lt;span class=&quot;code-quote&quot;&gt;&apos;fields.count.min&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;,\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; &#160;&lt;span class=&quot;code-quote&quot;&gt;&apos;fields.count.max&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;10&apos;&lt;/span&gt;\n&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;);&quot;&lt;/span&gt;);

/* &#160; &#160; &#160;
        Table t = te.fromDataStream(ds, Schema.newBuilder().columnByExpression(&lt;span class=&quot;code-quote&quot;&gt;&quot;proctime&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;proctime()&quot;&lt;/span&gt;).build());
&#160; &#160; &#160; &#160; t.printSchema();
&#160; &#160; &#160; &#160; te.createTemporaryView(&lt;span class=&quot;code-quote&quot;&gt;&quot;users&quot;&lt;/span&gt;, t);
*/

&#160; &#160; &#160; &#160; Table res = te.sqlQuery(&lt;span class=&quot;code-quote&quot;&gt;&quot;SELECT userId, `count`, proctime,&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; LAG(`count`, 1, 1) OVER w AS prev_quantity&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; FROM users&quot;&lt;/span&gt; +
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot; WINDOW w AS (ORDER BY proctime)&quot;&lt;/span&gt;);
&#160;
&#160; &#160; &#160; &#160; te.toChangelogStream(res).print();
&#160; &#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I work with kafka and did various ETLs with it, Window Agg all worked fine.&lt;/p&gt;

&lt;p&gt;But when I started working with the LAG and above code, it gives an exception.&#160;&lt;/p&gt;

&lt;p&gt;What can it be?&lt;br/&gt;
If need, Maybe I should make a project archive with my example (but you need kafka (for example in docker))?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17717675" author="martijnvisser" created="Fri, 28 Apr 2023 13:34:21 +0000"  >&lt;p&gt;That would be great for debugging, yes. &lt;/p&gt;</comment>
                            <comment id="17717688" author="JIRAUSER287909" created="Fri, 28 Apr 2023 14:07:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Add Project&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13057712/13057712_simpleFlinkKafkaLag.zip&quot; title=&quot;simpleFlinkKafkaLag.zip attached to FLINK-31967&quot;&gt;simpleFlinkKafkaLag.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;with two functions (work datagen and exception kafka)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13057713/13057713_image-2023-04-28-17-06-20-737.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;For kafta input example:&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&quot;userId&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;count&quot;&lt;/span&gt;:5,&lt;span class=&quot;code-quote&quot;&gt;&quot;dt&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;2023-04-28T14:02:23.113Z&quot;&lt;/span&gt;}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;java-1.11.0-openjdk-amd64&lt;/p&gt;</comment>
                            <comment id="17720303" author="JIRAUSER287909" created="Sun, 7 May 2023 12:27:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lincoln.86xy&quot; class=&quot;user-hover&quot; rel=&quot;lincoln.86xy&quot;&gt;lincoln.86xy&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;If you need anything else, let me know, i&apos;ll do it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17721756" author="fsk119" created="Thu, 11 May 2023 12:45:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=padavan&quot; class=&quot;user-hover&quot; rel=&quot;padavan&quot;&gt;padavan&lt;/a&gt; after investigation, the type inference is not correct for the lag function. For a quick fix, you can modify the type of the `count` in the UserModel to `Integer`.&#160;&lt;/p&gt;</comment>
                            <comment id="17721936" author="JIRAUSER287909" created="Thu, 11 May 2023 21:50:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; with Integer work.&#160;&lt;/p&gt;

&lt;p&gt;I think it is at least unexpected behavior that int != Integer. Will there be any fixes? Or will you just improve the output error with a description?&lt;/p&gt;</comment>
                            <comment id="17721969" author="fsk119" created="Fri, 12 May 2023 01:38:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=padavan&quot; class=&quot;user-hover&quot; rel=&quot;padavan&quot;&gt;padavan&lt;/a&gt; Sure. There will be a PR to fix this soon.&#160;&lt;/p&gt;</comment>
                            <comment id="17722665" author="JIRAUSER300404" created="Mon, 15 May 2023 06:25:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=padavan&quot; class=&quot;user-hover&quot; rel=&quot;padavan&quot;&gt;padavan&lt;/a&gt;&#160; This problem is caused by the basic data type of Java, and I will propose a PR to solve this problem in the future&lt;/p&gt;</comment>
                            <comment id="17723826" author="JIRAUSER287909" created="Thu, 18 May 2023 07:49:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pyro&quot; class=&quot;user-hover&quot; rel=&quot;pyro&quot;&gt;pyro&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;This looks like basic functionality that is often used. It&apos;s very strange that it still doesn&apos;t work. I hope to get this fixed as soon as possible &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17726029" author="fsk119" created="Thu, 25 May 2023 03:07:07 +0000"  >&lt;p&gt;Merged into master: ac6aedbf0f35ba9734108a3c347e649bbf231c62&lt;/p&gt;

&lt;p&gt;Merged into release-1.17: 6cac01d827ddb58bd79b5b42e1af4e05fbc45814&lt;/p&gt;

&lt;p&gt;Merged into release-1.16: c07b50170d081978a3ca17b968d183ca9f4a57a2&lt;/p&gt;</comment>
                            <comment id="17726834" author="JIRAUSER287909" created="Sat, 27 May 2023 18:18:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; already in master ?&#160;&lt;/p&gt;

&lt;p&gt;How can I check what works? Will there be new versions of java packages ? 1.17.2 ?&#160;&lt;/p&gt;</comment>
                            <comment id="17727761" author="fsk119" created="Wed, 31 May 2023 03:06:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=padavan&quot; class=&quot;user-hover&quot; rel=&quot;padavan&quot;&gt;padavan&lt;/a&gt; Yes we have already merged into the master, 1.17 and 1.16. It will a bug fix version for 1.17 in the future. But right now you should package the latest 1.17 branch. It&apos;s welcome you report the new problems here.&lt;/p&gt;</comment>
                            <comment id="17727762" author="fsk119" created="Wed, 31 May 2023 03:07:34 +0000"  >&lt;p&gt;I close this right now. If meet a new problem about this, please reopen this again.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13057705" name="image-2023-04-28-14-46-19-736.png" size="42569" author="padavan" created="Fri, 28 Apr 2023 11:46:19 +0000"/>
                            <attachment id="13057706" name="image-2023-04-28-15-06-48-184.png" size="42597" author="padavan" created="Fri, 28 Apr 2023 12:06:47 +0000"/>
                            <attachment id="13057707" name="image-2023-04-28-15-14-58-788.png" size="43658" author="padavan" created="Fri, 28 Apr 2023 12:14:58 +0000"/>
                            <attachment id="13057708" name="image-2023-04-28-15-17-49-144.png" size="43020" author="padavan" created="Fri, 28 Apr 2023 12:17:49 +0000"/>
                            <attachment id="13057713" name="image-2023-04-28-17-06-20-737.png" size="6571" author="padavan" created="Fri, 28 Apr 2023 14:06:20 +0000"/>
                            <attachment id="13057712" name="simpleFlinkKafkaLag.zip" size="15459991" author="padavan" created="Fri, 28 Apr 2023 14:05:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1hlc8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>