<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:17:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30966] Flink SQL IF FUNCTION logic error</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30966</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;my data is&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;{ &lt;span class=&quot;code-quote&quot;&gt;&quot;before&quot;&lt;/span&gt;: { &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;sent&quot;&lt;/span&gt; }, &lt;span class=&quot;code-quote&quot;&gt;&quot;after&quot;&lt;/span&gt;: { &lt;span class=&quot;code-quote&quot;&gt;&quot;status&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;succeed&quot;&lt;/span&gt; }, &lt;span class=&quot;code-quote&quot;&gt;&quot;op&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;u&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ts_ms&quot;&lt;/span&gt;: 1671926400225, &lt;span class=&quot;code-quote&quot;&gt;&quot;transaction&quot;&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; } &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;my sql is&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CREATE TABLE t
(
    before ROW (

        status varchar (32)

        ),
    after ROW (

        status varchar (32)

        ),
    ts_ms                bigint,
    op                   string,
    kafka_timestamp      timestamp METADATA FROM &lt;span class=&quot;code-quote&quot;&gt;&apos;timestamp&apos;&lt;/span&gt;,
--     @formatter:off
    proctime AS PROCTIME()
--     @formatter:on
) WITH (
    &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,
--     &lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &apos;&apos;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos; &apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.group.id&apos;&lt;/span&gt; = &apos;&apos;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;scan.topic-partition-discovery.interval&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;60s&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;scan.startup.mode&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;earliest-offset&apos;&lt;/span&gt;,
    &lt;span class=&quot;code-quote&quot;&gt;&apos;json.ignore-parse-errors&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt;
 );
create table p
(
    status                  STRING ,
    before_status                  STRING ,
    after_status                  STRING ,
    metadata_operation      STRING COMMENT &lt;span class=&quot;code-quote&quot;&gt;&apos;&#28304;&#35760;&#24405;&#25805;&#20316;&#31867;&#22411;&apos;&lt;/span&gt;,
    dt                      STRING
)WITH (
    &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;print&apos;&lt;/span&gt;
 );
INSERT INTO p
SELECT
       IF(op &amp;lt;&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;d&apos;&lt;/span&gt;, after.status, before.status),
        before.status,
        after.status,
       op                                         AS metadata_operation,
       DATE_FORMAT(kafka_timestamp, &lt;span class=&quot;code-quote&quot;&gt;&apos;yyyy-MM-dd&apos;&lt;/span&gt;) AS dt
FROM t;

 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;my local env output is&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+I[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, sent, succeed, u, 2023-02-08] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;my produtionc env output is&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+I[sent, sent, succeed, u, 2023-02-08]  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;why?&#160;&#160;&lt;br/&gt;
This look like a bug.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13523766">FLINK-30966</key>
            <summary>Flink SQL IF FUNCTION logic error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="csq">Shuiqiang Chen</assignee>
                                    <reporter username="hiscat">&#35874;&#27874;</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 8 Feb 2023 13:20:08 +0000</created>
                <updated>Thu, 20 Jul 2023 04:21:13 +0000</updated>
                            <resolved>Tue, 6 Jun 2023 02:54:56 +0000</resolved>
                                    <version>1.16.0</version>
                    <version>1.16.1</version>
                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.16.3</fixVersion>
                    <fixVersion>1.17.2</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17686842" author="csq" created="Fri, 10 Feb 2023 02:38:12 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hiscat&quot; class=&quot;user-hover&quot; rel=&quot;hiscat&quot;&gt;hiscat&lt;/a&gt;, I have reproduced the same error and it seems a bug in IFCallGen.&lt;br/&gt;
After investigated the generated code, there are two problems:&lt;br/&gt;
1. It perform the result term casting before the calculation logic, and finally the actual result always refer to a non-initialized field.&lt;br/&gt;
2. when normalizing arguments, it always align to the type of ARG1, like IF(1 &amp;gt;  2, &apos;true&apos;, &apos;false&apos;)&lt;br/&gt;
the result will be string &apos;fals&apos; which length is the same as &apos;true&apos;.&lt;/p&gt;

&lt;p&gt;I would like to help fix it. &lt;/p&gt;</comment>
                            <comment id="17686843" author="csq" created="Fri, 10 Feb 2023 02:41:11 +0000"  >&lt;p&gt;BTW, the expected result of your query might be:&lt;br/&gt;
+I&lt;span class=&quot;error&quot;&gt;&amp;#91;succeed, sent, u, 2023-02-08&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17687676" author="luoyuxia" created="Mon, 13 Feb 2023 02:37:34 +0000"  >&lt;p&gt;Seems same to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-31003&quot; title=&quot;Flink SQL IF / CASE WHEN Funcation incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-31003&quot;&gt;&lt;del&gt;FLINK-31003&lt;/del&gt;&lt;/a&gt;?&#160;&lt;/p&gt;</comment>
                            <comment id="17687683" author="csq" created="Mon, 13 Feb 2023 02:48:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=luoyuxia&quot; class=&quot;user-hover&quot; rel=&quot;luoyuxia&quot;&gt;luoyuxia&lt;/a&gt;The matter of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-31003&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;FLINK-31003&lt;/a&gt; is return type inferencing, while there is another issue that the code block position of result term casting might be wrong.&lt;/p&gt;</comment>
                            <comment id="17687768" author="lincoln.86xy" created="Mon, 13 Feb 2023 07:15:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csq&quot; class=&quot;user-hover&quot; rel=&quot;csq&quot;&gt;csq&lt;/a&gt; assigned to you&lt;/p&gt;</comment>
                            <comment id="17727776" author="luoyuxia" created="Wed, 31 May 2023 03:45:46 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=csq&quot; class=&quot;user-hover&quot; rel=&quot;csq&quot;&gt;csq&lt;/a&gt; I have reviewed your pr. Hope you can find sometime to have a look again.&lt;/p&gt;</comment>
                            <comment id="17727780" author="csq" created="Wed, 31 May 2023 03:51:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=luoyuxia&quot; class=&quot;user-hover&quot; rel=&quot;luoyuxia&quot;&gt;luoyuxia&lt;/a&gt;Sorry for the delay, I would continue to work on the issue and update the PR  as soon as possible.&lt;/p&gt;</comment>
                            <comment id="17729262" author="luoyuxia" created="Mon, 5 Jun 2023 09:48:11 +0000"  >&lt;p&gt;master: 6663c8b29f672b961d34baed314940621f3754ca&lt;/p&gt;

&lt;p&gt;1.17: 8e82359be4982c8534b271259c7e649e4c12df1d&lt;/p&gt;

&lt;p&gt;1.16: 6bdf2ba59678289b517b208ac5173c8e58b50690&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                            <outwardlinks description="fixes">
                                        <issuelink>
            <issuekey id="13502111">FLINK-30018</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13516450">FLINK-30559</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13516450">FLINK-30559</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13516450">FLINK-30559</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13530563">FLINK-31653</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1frrk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>