<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:50:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-19253] SourceReaderTestBase.testAddSplitToExistingFetcher hangs</title>
                <link>https://issues.apache.org/jira/browse/FLINK-19253</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=6521&amp;amp;view=logs&amp;amp;j=fc5181b0-e452-5c8f-68de-1097947f6483&amp;amp;t=62110053-334f-5295-a0ab-80dd7e2babbf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=6521&amp;amp;view=logs&amp;amp;j=fc5181b0-e452-5c8f-68de-1097947f6483&amp;amp;t=62110053-334f-5295-a0ab-80dd7e2babbf&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-09-15T10:51:35.5236837Z &lt;span class=&quot;code-quote&quot;&gt;&quot;SourceFetcher&quot;&lt;/span&gt; #39 prio=5 os_prio=0 tid=0x00007f70d0a57000 nid=0x858 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007f6fd81f0000]
2020-09-15T10:51:35.5237447Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
2020-09-15T10:51:35.5237962Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
2020-09-15T10:51:35.5238886Z 	- waiting on &amp;lt;0x00000000c27f5be8&amp;gt; (a java.util.ArrayDeque)
2020-09-15T10:51:35.5239380Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:502)
2020-09-15T10:51:35.5240401Z 	at org.apache.flink.connector.base.source.reader.mocks.TestingSplitReader.fetch(TestingSplitReader.java:52)
2020-09-15T10:51:35.5241471Z 	- locked &amp;lt;0x00000000c27f5be8&amp;gt; (a java.util.ArrayDeque)
2020-09-15T10:51:35.5242180Z 	at org.apache.flink.connector.base.source.reader.fetcher.FetchTask.run(FetchTask.java:58)
2020-09-15T10:51:35.5243245Z 	at org.apache.flink.connector.base.source.reader.fetcher.SplitFetcher.runOnce(SplitFetcher.java:128)
2020-09-15T10:51:35.5244263Z 	at org.apache.flink.connector.base.source.reader.fetcher.SplitFetcher.run(SplitFetcher.java:95)
2020-09-15T10:51:35.5245128Z 	at org.apache.flink.util.ThrowableCatchingRunnable.run(ThrowableCatchingRunnable.java:42)
2020-09-15T10:51:35.5245973Z 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
2020-09-15T10:51:35.5247081Z 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
2020-09-15T10:51:35.5247816Z 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
2020-09-15T10:51:35.5248809Z 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
2020-09-15T10:51:35.5249463Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2020-09-15T10:51:35.5249827Z 
2020-09-15T10:51:35.5250383Z &lt;span class=&quot;code-quote&quot;&gt;&quot;SourceFetcher&quot;&lt;/span&gt; #37 prio=5 os_prio=0 tid=0x00007f70d0a4b000 nid=0x856 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007f6f80cfa000]
2020-09-15T10:51:35.5251124Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
2020-09-15T10:51:35.5251636Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
2020-09-15T10:51:35.5252767Z 	- waiting on &amp;lt;0x00000000c298d0b8&amp;gt; (a java.util.ArrayDeque)
2020-09-15T10:51:35.5253336Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:502)
2020-09-15T10:51:35.5254184Z 	at org.apache.flink.connector.base.source.reader.mocks.TestingSplitReader.fetch(TestingSplitReader.java:52)
2020-09-15T10:51:35.5255220Z 	- locked &amp;lt;0x00000000c298d0b8&amp;gt; (a java.util.ArrayDeque)
2020-09-15T10:51:35.5255678Z 	at org.apache.flink.connector.base.source.reader.fetcher.FetchTask.run(FetchTask.java:58)
2020-09-15T10:51:35.5256235Z 	at org.apache.flink.connector.base.source.reader.fetcher.SplitFetcher.runOnce(SplitFetcher.java:128)
2020-09-15T10:51:35.5256803Z 	at org.apache.flink.connector.base.source.reader.fetcher.SplitFetcher.run(SplitFetcher.java:95)
2020-09-15T10:51:35.5257351Z 	at org.apache.flink.util.ThrowableCatchingRunnable.run(ThrowableCatchingRunnable.java:42)
2020-09-15T10:51:35.5257838Z 	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
2020-09-15T10:51:35.5258284Z 	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
2020-09-15T10:51:35.5258856Z 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
2020-09-15T10:51:35.5259350Z 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
2020-09-15T10:51:35.5260011Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2020-09-15T10:51:35.5260211Z 
2020-09-15T10:51:35.5260574Z &lt;span class=&quot;code-quote&quot;&gt;&quot;process reaper&quot;&lt;/span&gt; #24 daemon prio=10 os_prio=0 tid=0x00007f6f70042000 nid=0x844 waiting on condition [0x00007f6fd832a000]
2020-09-15T10:51:35.5261036Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (parking)
2020-09-15T10:51:35.5261342Z 	at sun.misc.Unsafe.park(Native Method)
2020-09-15T10:51:35.5261972Z 	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x00000000815d0810&amp;gt; (a java.util.concurrent.SynchronousQueue$TransferStack)
2020-09-15T10:51:35.5262456Z 	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
2020-09-15T10:51:35.5263067Z 	at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:460)
2020-09-15T10:51:35.5263611Z 	at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:362)
2020-09-15T10:51:35.5264176Z 	at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:941)
2020-09-15T10:51:35.5264649Z 	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1073)
2020-09-15T10:51:35.5265143Z 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
2020-09-15T10:51:35.5265750Z 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
2020-09-15T10:51:35.5266152Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2020-09-15T10:51:35.5266369Z 
2020-09-15T10:51:35.5267000Z &lt;span class=&quot;code-quote&quot;&gt;&quot;surefire-forkedjvm-ping-30s&quot;&lt;/span&gt; #23 daemon prio=5 os_prio=0 tid=0x00007f70d03eb800 nid=0x83e waiting on condition [0x00007f6fd8942000]
2020-09-15T10:51:35.5267483Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (parking)
2020-09-15T10:51:35.5267801Z 	at sun.misc.Unsafe.park(Native Method)
2020-09-15T10:51:35.5268418Z 	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x0000000081595d18&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
2020-09-15T10:51:35.5269030Z 	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:215)
2020-09-15T10:51:35.5269600Z 	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2078)
2020-09-15T10:51:35.5270234Z 	at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:1093)
2020-09-15T10:51:35.5270850Z 	at java.util.concurrent.ScheduledThreadPoolExecutor$DelayedWorkQueue.take(ScheduledThreadPoolExecutor.java:809)
2020-09-15T10:51:35.5271405Z 	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:1074)
2020-09-15T10:51:35.5271891Z 	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1134)
2020-09-15T10:51:35.5272397Z 	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
2020-09-15T10:51:35.5272908Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2020-09-15T10:51:35.5273106Z 
2020-09-15T10:51:35.5273722Z &lt;span class=&quot;code-quote&quot;&gt;&quot;surefire-forkedjvm-command-thread&quot;&lt;/span&gt; #22 daemon prio=5 os_prio=0 tid=0x00007f70d03d4000 nid=0x83d runnable [0x00007f6fd8c4d000]
2020-09-15T10:51:35.5274193Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5274508Z 	at java.io.FileInputStream.readBytes(Native Method)
2020-09-15T10:51:35.5274878Z 	at java.io.FileInputStream.read(FileInputStream.java:255)
2020-09-15T10:51:35.5275292Z 	at java.io.BufferedInputStream.fill(BufferedInputStream.java:246)
2020-09-15T10:51:35.5275737Z 	at java.io.BufferedInputStream.read(BufferedInputStream.java:265)
2020-09-15T10:51:35.5276314Z 	- locked &amp;lt;0x0000000081597fc8&amp;gt; (a java.io.BufferedInputStream)
2020-09-15T10:51:35.5276692Z 	at java.io.DataInputStream.readInt(DataInputStream.java:387)
2020-09-15T10:51:35.5277173Z 	at org.apache.maven.surefire.booter.MasterProcessCommand.decode(MasterProcessCommand.java:115)
2020-09-15T10:51:35.5277719Z 	at org.apache.maven.surefire.booter.CommandReader$CommandRunnable.run(CommandReader.java:391)
2020-09-15T10:51:35.5278143Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2020-09-15T10:51:35.5278358Z 
2020-09-15T10:51:35.5278764Z &lt;span class=&quot;code-quote&quot;&gt;&quot;Service &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;&quot;&lt;/span&gt; #21 daemon prio=9 os_prio=0 tid=0x00007f70d02cb800 nid=0x839 runnable [0x0000000000000000]
2020-09-15T10:51:35.5279262Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5279447Z 
2020-09-15T10:51:35.5279807Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C1 CompilerThread14&quot;&lt;/span&gt; #20 daemon prio=9 os_prio=0 tid=0x00007f70d02c8000 nid=0x838 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5280243Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5280425Z 
2020-09-15T10:51:35.5280788Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C1 CompilerThread13&quot;&lt;/span&gt; #19 daemon prio=9 os_prio=0 tid=0x00007f70d02c6000 nid=0x837 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5281203Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5281398Z 
2020-09-15T10:51:35.5281748Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C1 CompilerThread12&quot;&lt;/span&gt; #18 daemon prio=9 os_prio=0 tid=0x00007f70d02c4000 nid=0x836 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5282180Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5282362Z 
2020-09-15T10:51:35.5282804Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C1 CompilerThread11&quot;&lt;/span&gt; #17 daemon prio=9 os_prio=0 tid=0x00007f70d02c1800 nid=0x835 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5283239Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5283423Z 
2020-09-15T10:51:35.5283768Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C1 CompilerThread10&quot;&lt;/span&gt; #16 daemon prio=9 os_prio=0 tid=0x00007f70d02c0000 nid=0x834 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5284331Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5284529Z 
2020-09-15T10:51:35.5284870Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread9&quot;&lt;/span&gt; #15 daemon prio=9 os_prio=0 tid=0x00007f70d02bd000 nid=0x833 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5285299Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5285481Z 
2020-09-15T10:51:35.5285838Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread8&quot;&lt;/span&gt; #14 daemon prio=9 os_prio=0 tid=0x00007f70d02bb000 nid=0x832 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5286249Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5286446Z 
2020-09-15T10:51:35.5286784Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread7&quot;&lt;/span&gt; #13 daemon prio=9 os_prio=0 tid=0x00007f70d02b9000 nid=0x831 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5287211Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5287410Z 
2020-09-15T10:51:35.5287752Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread6&quot;&lt;/span&gt; #12 daemon prio=9 os_prio=0 tid=0x00007f70d02b7800 nid=0x830 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5288182Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5288362Z 
2020-09-15T10:51:35.5288804Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread5&quot;&lt;/span&gt; #11 daemon prio=9 os_prio=0 tid=0x00007f70d02b5000 nid=0x82f waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5289213Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5289409Z 
2020-09-15T10:51:35.5289753Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread4&quot;&lt;/span&gt; #10 daemon prio=9 os_prio=0 tid=0x00007f70d02b3000 nid=0x82e waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5290168Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5290352Z 
2020-09-15T10:51:35.5290706Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread3&quot;&lt;/span&gt; #9 daemon prio=9 os_prio=0 tid=0x00007f70d02a9000 nid=0x82d waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5291125Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5291310Z 
2020-09-15T10:51:35.5291667Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread2&quot;&lt;/span&gt; #8 daemon prio=9 os_prio=0 tid=0x00007f70d02a6800 nid=0x82c waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5292082Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5292276Z 
2020-09-15T10:51:35.5292692Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread1&quot;&lt;/span&gt; #7 daemon prio=9 os_prio=0 tid=0x00007f70d02a4800 nid=0x82b waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5293115Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5293296Z 
2020-09-15T10:51:35.5293655Z &lt;span class=&quot;code-quote&quot;&gt;&quot;C2 CompilerThread0&quot;&lt;/span&gt; #6 daemon prio=9 os_prio=0 tid=0x00007f70d02a2800 nid=0x82a waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5294127Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5294310Z 
2020-09-15T10:51:35.5294647Z &lt;span class=&quot;code-quote&quot;&gt;&quot;Signal Dispatcher&quot;&lt;/span&gt; #5 daemon prio=9 os_prio=0 tid=0x00007f70d02a0800 nid=0x829 runnable [0x0000000000000000]
2020-09-15T10:51:35.5295037Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5295304Z 
2020-09-15T10:51:35.5295679Z &lt;span class=&quot;code-quote&quot;&gt;&quot;Surrogate Locker &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; (Concurrent GC)&quot;&lt;/span&gt; #4 daemon prio=9 os_prio=0 tid=0x00007f70d029f000 nid=0x828 waiting on condition [0x0000000000000000]
2020-09-15T10:51:35.5296135Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5296319Z 
2020-09-15T10:51:35.5296658Z &lt;span class=&quot;code-quote&quot;&gt;&quot;Finalizer&quot;&lt;/span&gt; #3 daemon prio=8 os_prio=0 tid=0x00007f70d026e800 nid=0x827 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007f6fda624000]
2020-09-15T10:51:35.5297103Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
2020-09-15T10:51:35.5297418Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
2020-09-15T10:51:35.5297994Z 	- waiting on &amp;lt;0x00000000815d17f0&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)
2020-09-15T10:51:35.5298413Z 	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:144)
2020-09-15T10:51:35.5299073Z 	- locked &amp;lt;0x00000000815d17f0&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)
2020-09-15T10:51:35.5299486Z 	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:165)
2020-09-15T10:51:35.5299917Z 	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:216)
2020-09-15T10:51:35.5300174Z 
2020-09-15T10:51:35.5300529Z &lt;span class=&quot;code-quote&quot;&gt;&quot;Reference Handler&quot;&lt;/span&gt; #2 daemon prio=10 os_prio=0 tid=0x00007f70d026a000 nid=0x813 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007f6fda725000]
2020-09-15T10:51:35.5301046Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
2020-09-15T10:51:35.5301372Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
2020-09-15T10:51:35.5301884Z 	- waiting on &amp;lt;0x00000000815d1d80&amp;gt; (a java.lang.ref.Reference$Lock)
2020-09-15T10:51:35.5302228Z 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:502)
2020-09-15T10:51:35.5302701Z 	at java.lang.ref.Reference.tryHandlePending(Reference.java:191)
2020-09-15T10:51:35.5303254Z 	- locked &amp;lt;0x00000000815d1d80&amp;gt; (a java.lang.ref.Reference$Lock)
2020-09-15T10:51:35.5303668Z 	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153)
2020-09-15T10:51:35.5303989Z 
2020-09-15T10:51:35.5304284Z &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; #1 prio=5 os_prio=0 tid=0x00007f70d000b800 nid=0x7a1 runnable [0x00007f70d7e66000]
2020-09-15T10:51:35.5304658Z    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
2020-09-15T10:51:35.5305148Z 	at org.apache.flink.connector.base.source.reader.SourceReaderTestBase.testAddSplitToExistingFetcher(SourceReaderTestBase.java:98)
2020-09-15T10:51:35.5305688Z 	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
2020-09-15T10:51:35.5306130Z 	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
2020-09-15T10:51:35.5306631Z 	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
2020-09-15T10:51:35.5307087Z 	at java.lang.reflect.Method.invoke(Method.java:498)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13327765">FLINK-19253</key>
            <summary>SourceReaderTestBase.testAddSplitToExistingFetcher hangs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sxnan">Xuannan Su</assignee>
                                    <reporter username="dian.fu">Dian Fu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 16 Sep 2020 02:53:26 +0000</created>
                <updated>Fri, 18 Oct 2024 19:38:12 +0000</updated>
                            <resolved>Tue, 8 Dec 2020 09:45:47 +0000</resolved>
                                    <version>1.11.2</version>
                                    <fixVersion>1.11.3</fixVersion>
                    <fixVersion>1.12.0</fixVersion>
                                    <component>Connectors / Common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17196635" author="dian.fu" created="Wed, 16 Sep 2020 02:54:28 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jqin&quot; class=&quot;user-hover&quot; rel=&quot;jqin&quot;&gt;jqin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17228958" author="JIRAUSER306704" created="Tue, 10 Nov 2020 04:03:02 +0000"  >&lt;p&gt;I think it is a potential race condition in SplitFetcher.&lt;/p&gt;

&lt;p&gt;It occurs when one thread executing the SplitFetcher#checkAndSetIdle method and the other thread adding split to the SplitFetcher with SplitFetcher#addSplits. i.e., the checkAndSetIdle first check if it should go to idle and set the isIdle flag. Between these two steps, another thread could call the addSplits, which put a new task into the taskQueue and set the isIdle flag to false. Then, the first thread set the isIdle flag to true.&lt;/p&gt;

&lt;p&gt;We need to sychronize the thread that modifying the isIdle flag.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17229011" author="becket_qin" created="Tue, 10 Nov 2020 06:46:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuannan&quot; class=&quot;user-hover&quot; rel=&quot;xuannan&quot;&gt;xuannan&lt;/a&gt; Good catch. Will you submit a fix?&lt;/p&gt;</comment>
                            <comment id="17229013" author="JIRAUSER306704" created="Tue, 10 Nov 2020 06:50:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; I&apos;d love to submit a fix. Could you assign the ticket to me?&lt;/p&gt;</comment>
                            <comment id="17229865" author="becket_qin" created="Wed, 11 Nov 2020 09:30:48 +0000"  >&lt;p&gt;Looking at the code, I think there might be another race in the &lt;tt&gt;SourceReaderBase&lt;/tt&gt;&#160;that may cause &lt;tt&gt;finishOrAvailableLater()&lt;/tt&gt;&#160;to throw &lt;tt&gt;IllegalStateException&lt;/tt&gt;&#160;incorrectly. The sequence is following:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The &lt;tt&gt;SourceReader&lt;/tt&gt;&#160;has received &lt;tt&gt;NoMoreSplitsAssignedEvent&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;The main thread calls &lt;tt&gt;SourceReader.pollNext()&lt;/tt&gt;&#160;but there is no record in the elementQueue. So it invokes &lt;tt&gt;finishedOrAvailableLater()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;In &lt;tt&gt;SplitFetcher.runOnce()&lt;/tt&gt;, the &lt;tt&gt;SplitFetcher&lt;/tt&gt;&#160;thread runs the &lt;tt&gt;FetchTask&lt;/tt&gt;. The &lt;tt&gt;FetchTask&lt;/tt&gt;&#160;finishes enqueuing the last &lt;tt&gt;RecordsWithSplitIds&lt;/tt&gt;&#160;to the elementQueue, remove the last split from the &lt;tt&gt;assignedSplits&lt;/tt&gt;, and then returns. At this point the &lt;tt&gt;assignedSplits&lt;/tt&gt;&#160;becomes empty.&lt;/li&gt;
	&lt;li&gt;The &lt;tt&gt;SplitFetcher&lt;/tt&gt;&#160;thread then invoke &lt;tt&gt;checkAndSetIdle()&lt;/tt&gt;&#160;and set isIdle to true.&lt;/li&gt;
	&lt;li&gt;The main thread invokes &lt;tt&gt;splitFetcherManager.maybeShutdownFinishedFetchers()&lt;/tt&gt;, sees the &lt;tt&gt;SplitFetcher&lt;/tt&gt;&#160;is idle then shuts it down. At this point there is no alive fetchers any more.&lt;/li&gt;
	&lt;li&gt;Since &lt;tt&gt;noMoreSplitsAssignment &amp;amp;&amp;amp; allFetchersHaveShutdown&lt;/tt&gt; is met, the main thread will go and check to see if the elementQueue is empty. And in this case, the element queue has the last RecordsWithSplitIds from step 3. The SourceReaderBase will then throw &lt;tt&gt;IllegalStateException&lt;/tt&gt; incorrectly.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Since this is also related to the SplitFetcher idleness, I am thinking that we can fix this problem in this patch as well.&lt;/p&gt;</comment>
                            <comment id="17229980" author="JIRAUSER306704" created="Wed, 11 Nov 2020 13:32:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; You are right. This indeed can cause IllegalStateException to be thrown. After closely looking at the code, I think it made more sense to return MORE_AVAILABLE instead of throwing the IllegalStateException at that point. The rationale is shown in the comment of the code below. And we might want to change the name of the method from `finishedOrAvailableLater` to something like `getInputStatus`. What do you think?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; InputStatus finishedOrAvailableLater() {
		&lt;span class=&quot;code-comment&quot;&gt;// assumption: elementQueue is empty (might not be valid already)
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; allFetchersHaveShutdown = splitFetcherManager.maybeShutdownFinishedFetchers();
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(noMoreSplitsAssignment &amp;amp;&amp;amp; allFetchersHaveShutdown)) {
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; InputStatus.NOTHING_AVAILABLE;
		}
		&lt;span class=&quot;code-comment&quot;&gt;// at &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; point we are guarantee that no more split will be assigned
&lt;/span&gt;		&lt;span class=&quot;code-comment&quot;&gt;// and all the SplitFetchers are idle and has been shutdown
&lt;/span&gt;		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (elementsQueue.isEmpty()) {
			splitFetcherManager.checkErrors();
			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; InputStatus.END_OF_INPUT;
		} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
			&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we see a non-empty elementsQueue here, it means that our assumption that the
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;// elementsQueue is empty is violated. This indicates that after our last check on
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;// the elementsQueue, all SplitFetchers fetch all the elements, put them in the
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;// element queue and closed, which means there are element available before
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;// we can &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; END_OF_INPUT. Therefore, we &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; MORE_AVAILABLE 
&lt;/span&gt;			&lt;span class=&quot;code-comment&quot;&gt;// instead of throwing exception.
&lt;/span&gt;			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; InputStatus.MORE_AVAILABLE;
&lt;span class=&quot;code-comment&quot;&gt;//			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Called &lt;span class=&quot;code-quote&quot;&gt;&apos;finishedOrAvailableLater()&apos;&lt;/span&gt; with shut-down fetchers but non-empty queue&quot;&lt;/span&gt;);
&lt;/span&gt;		}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="17229991" author="becket_qin" created="Wed, 11 Nov 2020 14:33:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xuannan&quot; class=&quot;user-hover&quot; rel=&quot;xuannan&quot;&gt;xuannan&lt;/a&gt;&#160;Thanks for digging into this. Yes, I agree that returning &lt;tt&gt;MORE_AVAILABLE&lt;/tt&gt;&#160;makes sense. Can you update the patch? Ideally, we would also like to have a unit test to detect such issues. Thanks.&lt;/p&gt;</comment>
                            <comment id="17230377" author="JIRAUSER306704" created="Thu, 12 Nov 2020 06:29:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=becket_qin&quot; class=&quot;user-hover&quot; rel=&quot;becket_qin&quot;&gt;becket_qin&lt;/a&gt; I think &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-19448&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-19448&lt;/a&gt; has fixed the problem. Can you take a look?&lt;/p&gt;</comment>
                            <comment id="17230685" author="becket_qin" created="Thu, 12 Nov 2020 14:56:33 +0000"  >&lt;p&gt;Yes, that has been fixed. Thanks for adding the tests.&lt;/p&gt;

&lt;p&gt;The patch has been merged to master.&lt;br/&gt;
e131a474fbfefddcede2600027dcf883ad3aeffd&lt;/p&gt;


&lt;p&gt;I am leaving this issue open because it has not been backported to 1.11.3. I am not doing that right away because there seems some other bug fixes prior to this fix that is still not backported. Ideally we want to do that in order so that we can avoid unnecessary rebase.&lt;/p&gt;</comment>
                            <comment id="17230756" author="JIRAUSER306704" created="Thu, 12 Nov 2020 16:30:22 +0000"  >&lt;p&gt;Thanks for letting me know. I will stay tuned until we can backport. &lt;/p&gt;</comment>
                            <comment id="17245778" author="becket_qin" created="Tue, 8 Dec 2020 09:45:47 +0000"  >&lt;p&gt;Merged to release-1.11.&lt;/p&gt;

&lt;p&gt;69e9d3c2913fb1f923d71ab0f9d0eed43af11ff3&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13339903">FLINK-20083</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 49 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0imxk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>