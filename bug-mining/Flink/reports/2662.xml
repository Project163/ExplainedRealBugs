<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10316] Add check to KinesisProducer that aws.region is set</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10316</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Related to: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9402&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-9402&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A fix (Flink-9402) was introduced to force the configurations to have &lt;b&gt;exactly&lt;/b&gt; one of &quot;aws.region&quot; or &quot;aws.endpoint&quot;, but the underlying problem wasn&apos;t entirely fixed.&lt;/p&gt;

&lt;p&gt;If &quot;aws.endpoint&quot; is set and &quot;aws.region&quot; is unset, a different exception is thrown, instead.&lt;/p&gt;

&lt;p&gt;In &lt;b&gt;KinesisConfigUtil.java&lt;/b&gt;, &lt;b&gt;getValidatedProducerConfiguration()&lt;/b&gt; calls:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&#160;&#160; validateAwsConfiguration(config)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Where the original fix was introduced (&quot;aws.region&quot; XOR &quot;aws.endpoint&quot;)&lt;br/&gt;
 But a couple of lines later, &lt;b&gt;getValidatedProducerConfiguration()&lt;/b&gt; then calls:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    kpc.setRegion(config.getProperty(AWSConfigConstants.AWS_REGION));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which explicitly checks for the existence of &quot;aws.region&quot;, and throws an exception if it is not set.&lt;br/&gt;
 Thus, this class needs to be fixed such that &quot;aws.region&quot; is only required if &quot;aws.endpoint&quot; is unset, as the original ticket indicated.&lt;/p&gt;

&lt;p&gt;Also, &lt;b&gt;validateAwsConfiguration()&lt;/b&gt; has a minor bug where is labels the &quot;aws.endpoint&quot; incorrectly.&lt;br/&gt;
 Current:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(config.containsKey(AWSConfigConstants.AWS_REGION) ^ config.containsKey(ConsumerConfigConstants.AWS_ENDPOINT))) {
   &lt;span class=&quot;code-comment&quot;&gt;// per validation in AwsClientBuilder
&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Either AWS region (&lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;) or AWS endpoint (&lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;) must be set in the config.&quot;&lt;/span&gt;,
      AWSConfigConstants.AWS_REGION, AWSConfigConstants.AWS_REGION));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But should be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(config.containsKey(AWSConfigConstants.AWS_REGION) ^ config.containsKey(ConsumerConfigConstants.AWS_ENDPOINT))) {
   &lt;span class=&quot;code-comment&quot;&gt;// per validation in AwsClientBuilder
&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;Either AWS region (&lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;) or AWS endpoint (&lt;span class=&quot;code-quote&quot;&gt;&apos;%s&apos;&lt;/span&gt;) must be set in the config.&quot;&lt;/span&gt;,
      AWSConfigConstants.AWS_REGION, ConsumerConfigConstants.AWS_ENDPOINT));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13184159">FLINK-10316</key>
            <summary>Add check to KinesisProducer that aws.region is set</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lazlolazarous">Joseph Sims</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 10 Sep 2018 21:26:34 +0000</created>
                <updated>Wed, 17 Oct 2018 08:27:47 +0000</updated>
                            <resolved>Wed, 10 Oct 2018 09:13:56 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.5.5</fixVersion>
                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Connectors / Kinesis</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16637252" author="githubbot" created="Wed, 3 Oct 2018 17:23:20 +0000"  >&lt;p&gt;diego-carvallo-tx opened a new pull request #6789: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10316&quot; title=&quot;Add check to KinesisProducer that aws.region is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10316&quot;&gt;&lt;del&gt;FLINK-10316&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kinesis&amp;#93;&lt;/span&gt; bug was preventing FlinkKinesisProducer to connect to Kinesalite&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6789&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6789&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Some time ago &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4197&quot; title=&quot;Allow Kinesis Endpoint to be Overridden via Config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4197&quot;&gt;&lt;del&gt;FLINK-4197&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4197&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-4197&lt;/a&gt;) added the ability to connect to a local Kinesis endpoint but also introduced some bugs&lt;/li&gt;
	&lt;li&gt;Some time ago &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9402&quot; title=&quot;Kinesis consumer validation incorrectly requires aws.region property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9402&quot;&gt;&lt;del&gt;FLINK-9402&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9402&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-9402&lt;/a&gt;) added some fixes for those bugs but for FlinkKinesisConsumer only&lt;/li&gt;
	&lt;li&gt;This PR addresses &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10316&quot; title=&quot;Add check to KinesisProducer that aws.region is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10316&quot;&gt;&lt;del&gt;FLINK-10316&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10316&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-10316&lt;/a&gt;) to fix the remaining bugs to allow FlinkKinesisProducer also to connect to a local Kinesis endpoint&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The method `KinesisConfigUtil.validateAwsConfiguration(Properties config)` is used by both `FlinkKinesisConsumer` and `FlinkKinesisProducer` but AWS_REGION/AWS_ENDPOINT validation was performed only for Consumer who needs only one of them to be set. On the other side Producer requires AWS_REGION to be set even if AWS_ENDPOINT is defined to connect to local Kinesis. So the change in this PR is to change the method signature to have a boolean to identify if it is a Consumer or Producer so the validation can be done properly for each case:&lt;br/&gt;
   `KinesisConfigUtil.validateAwsConfiguration(Properties config, boolean isProducer)`&lt;/li&gt;
	&lt;li&gt;Changed the Unit Tests accordingly&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Jira Note&lt;br/&gt;
   There are 2 other tickets that could be closed along with this one since they all refer to the same issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9618&quot; title=&quot;NullPointerException in FlinkKinesisProducer when aws.region is not set and aws.endpoint is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9618&quot;&gt;&lt;del&gt;FLINK-9618&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9618&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-9618&lt;/a&gt;) and &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8936&quot; title=&quot;Provide only AWS region or endpoint in line with the SDK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8936&quot;&gt;&lt;del&gt;FLINK-8936&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8936&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-8936&lt;/a&gt;)&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change is already covered by existing tests, such as &lt;b&gt;(please describe tests)&lt;/b&gt;.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KinesisConfigUtilTest.testMissingAwsRegionInConfig&lt;/li&gt;
	&lt;li&gt;KinesisConfigUtilTest.testAwsRegionOrEndpointInConfig&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (no)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (no)&lt;/li&gt;
	&lt;li&gt;The serializers: (no)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (no)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (no)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (no)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16638284" author="githubbot" created="Thu, 4 Oct 2018 14:26:10 +0000"  >&lt;p&gt;tweise commented on a change in pull request #6789: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10316&quot; title=&quot;Add check to KinesisProducer that aws.region is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10316&quot;&gt;&lt;del&gt;FLINK-10316&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kinesis&amp;#93;&lt;/span&gt; bug was preventing FlinkKinesisProducer to connect to Kinesalite&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6789#discussion_r222691000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6789#discussion_r222691000&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-connectors/flink-connector-kinesis/src/main/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtil.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -266,10 +266,18 @@ public static void validateAwsConfiguration(Properties config) {&lt;br/&gt;
 			}&lt;br/&gt;
 		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!(config.containsKey(AWSConfigConstants.AWS_REGION) ^ config.containsKey(ConsumerConfigConstants.AWS_ENDPOINT))) {&lt;/li&gt;
	&lt;li&gt;// per validation in AwsClientBuilder&lt;/li&gt;
	&lt;li&gt;throw new IllegalArgumentException(String.format(&quot;Either AWS region (&apos;%s&apos;) or AWS endpoint (&apos;%s&apos;) must be set in the config.&quot;,&lt;/li&gt;
	&lt;li&gt;AWSConfigConstants.AWS_REGION, AWSConfigConstants.AWS_REGION));&lt;br/&gt;
+		if (isProducer) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Since it isn&apos;t common, respective code should be moved into `validateConsumerConfiguration` and `getValidatedProducerConfiguration`.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16639056" author="githubbot" created="Thu, 4 Oct 2018 23:49:16 +0000"  >&lt;p&gt;diego-carvallo-tx commented on a change in pull request #6789: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10316&quot; title=&quot;Add check to KinesisProducer that aws.region is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10316&quot;&gt;&lt;del&gt;FLINK-10316&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kinesis&amp;#93;&lt;/span&gt; bug was preventing FlinkKinesisProducer to connect to Kinesalite&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6789#discussion_r222859878&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6789#discussion_r222859878&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-connectors/flink-connector-kinesis/src/main/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtil.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -266,10 +266,18 @@ public static void validateAwsConfiguration(Properties config) {&lt;br/&gt;
 			}&lt;br/&gt;
 		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!(config.containsKey(AWSConfigConstants.AWS_REGION) ^ config.containsKey(ConsumerConfigConstants.AWS_ENDPOINT))) {&lt;/li&gt;
	&lt;li&gt;// per validation in AwsClientBuilder&lt;/li&gt;
	&lt;li&gt;throw new IllegalArgumentException(String.format(&quot;Either AWS region (&apos;%s&apos;) or AWS endpoint (&apos;%s&apos;) must be set in the config.&quot;,&lt;/li&gt;
	&lt;li&gt;AWSConfigConstants.AWS_REGION, AWSConfigConstants.AWS_REGION));&lt;br/&gt;
+		if (isProducer) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Thanks for the suggestion, I just pushed the code with this change and also updated the PR description.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644636" author="githubbot" created="Wed, 10 Oct 2018 08:39:23 +0000"  >&lt;p&gt;tzulitai commented on issue #6789: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10316&quot; title=&quot;Add check to KinesisProducer that aws.region is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10316&quot;&gt;&lt;del&gt;FLINK-10316&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kinesis&amp;#93;&lt;/span&gt; bug was preventing FlinkKinesisProducer to connect to Kinesalite&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6789#issuecomment-428487506&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6789#issuecomment-428487506&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for the PR @diego-carvallo-tx.&lt;br/&gt;
   Changes look good, merging this PR.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644663" author="githubbot" created="Wed, 10 Oct 2018 08:58:14 +0000"  >&lt;p&gt;asfgit closed pull request #6789: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10316&quot; title=&quot;Add check to KinesisProducer that aws.region is set&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10316&quot;&gt;&lt;del&gt;FLINK-10316&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kinesis&amp;#93;&lt;/span&gt; bug was preventing FlinkKinesisProducer to connect to Kinesalite&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6789&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6789&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-connectors/flink-connector-kinesis/src/main/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtil.java b/flink-connectors/flink-connector-kinesis/src/main/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtil.java&lt;br/&gt;
index a4d60ed496d..75c84cdca5a 100644&lt;br/&gt;
&amp;#8212; a/flink-connectors/flink-connector-kinesis/src/main/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtil.java&lt;br/&gt;
+++ b/flink-connectors/flink-connector-kinesis/src/main/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtil.java&lt;br/&gt;
@@ -87,6 +87,12 @@ public static void validateConsumerConfiguration(Properties config) {&lt;/p&gt;

&lt;p&gt; 		validateAwsConfiguration(config);&lt;/p&gt;

&lt;p&gt;+		if (!(config.containsKey(AWSConfigConstants.AWS_REGION) ^ config.containsKey(ConsumerConfigConstants.AWS_ENDPOINT))) &lt;/p&gt;
{
+			// per validation in AwsClientBuilder
+			throw new IllegalArgumentException(String.format(&quot;For FlinkKinesisConsumer either AWS region (&apos;%s&apos;) or AWS endpoint (&apos;%s&apos;) must be set in the config.&quot;,
+					AWSConfigConstants.AWS_REGION, AWSConfigConstants.AWS_ENDPOINT));
+		}
&lt;p&gt;+&lt;br/&gt;
 		if (config.containsKey(ConsumerConfigConstants.STREAM_INITIAL_POSITION)) {&lt;br/&gt;
 			String initPosType = config.getProperty(ConsumerConfigConstants.STREAM_INITIAL_POSITION);&lt;/p&gt;

&lt;p&gt;@@ -213,6 +219,11 @@ public static KinesisProducerConfiguration getValidatedProducerConfiguration(Pro&lt;/p&gt;

&lt;p&gt; 		validateAwsConfiguration(config);&lt;/p&gt;

&lt;p&gt;+		if (!config.containsKey(AWSConfigConstants.AWS_REGION)) &lt;/p&gt;
{
+			// per requirement in Amazon Kinesis Producer Library
+			throw new IllegalArgumentException(String.format(&quot;For FlinkKinesisProducer AWS region (&apos;%s&apos;) must be set in the config.&quot;, AWSConfigConstants.AWS_REGION));
+		}
&lt;p&gt;+&lt;br/&gt;
 		KinesisProducerConfiguration kpc = KinesisProducerConfiguration.fromProperties(config);&lt;br/&gt;
 		kpc.setRegion(config.getProperty(AWSConfigConstants.AWS_REGION));&lt;/p&gt;

&lt;p&gt;@@ -266,12 +277,6 @@ public static void validateAwsConfiguration(Properties config) {&lt;br/&gt;
 			}&lt;br/&gt;
 		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (!(config.containsKey(AWSConfigConstants.AWS_REGION) ^ config.containsKey(ConsumerConfigConstants.AWS_ENDPOINT))) 
{
-			// per validation in AwsClientBuilder
-			throw new IllegalArgumentException(String.format(&quot;Either AWS region (&apos;%s&apos;) or AWS endpoint (&apos;%s&apos;) must be set in the config.&quot;,
-				AWSConfigConstants.AWS_REGION, AWSConfigConstants.AWS_REGION));
-		}
&lt;p&gt;-&lt;br/&gt;
 		if (config.containsKey(AWSConfigConstants.AWS_REGION)) {&lt;br/&gt;
 			// specified AWS Region name must be recognizable&lt;br/&gt;
 			if (!AWSUtil.isValidRegion(config.getProperty(AWSConfigConstants.AWS_REGION))) {&lt;br/&gt;
diff --git a/flink-connectors/flink-connector-kinesis/src/test/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtilTest.java b/flink-connectors/flink-connector-kinesis/src/test/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtilTest.java&lt;br/&gt;
index c4bfa17675c..ae2d21e9493 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-connectors/flink-connector-kinesis/src/test/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtilTest.java&lt;br/&gt;
+++ b/flink-connectors/flink-connector-kinesis/src/test/java/org/apache/flink/streaming/connectors/kinesis/util/KinesisConfigUtilTest.java&lt;br/&gt;
@@ -125,14 +125,10 @@ public void testCorrectlySetRegionInProducerConfiguration() 
{
 		assertEquals(&quot;incorrect region&quot;, region, kpc.getRegion());
 	}&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// ----------------------------------------------------------------------&lt;/li&gt;
	&lt;li&gt;// validateAwsConfiguration() tests&lt;/li&gt;
	&lt;li&gt;// ----------------------------------------------------------------------&lt;br/&gt;
-&lt;br/&gt;
 	@Test&lt;/li&gt;
	&lt;li&gt;public void testMissingAwsRegionInConfig() {&lt;/li&gt;
	&lt;li&gt;String expectedMessage = String.format(&quot;Either AWS region (&apos;%s&apos;) or AWS endpoint (&apos;%s&apos;) must be set in the config.&quot;,&lt;/li&gt;
	&lt;li&gt;AWSConfigConstants.AWS_REGION, AWSConfigConstants.AWS_REGION);&lt;br/&gt;
+	public void testMissingAwsRegionInProducerConfig() {&lt;br/&gt;
+		String expectedMessage = String.format(&quot;For FlinkKinesisProducer AWS region (&apos;%s&apos;) must be set in the config.&quot;,&lt;br/&gt;
+				AWSConfigConstants.AWS_REGION);&lt;br/&gt;
 		exception.expect(IllegalArgumentException.class);&lt;br/&gt;
 		exception.expectMessage(expectedMessage);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -140,9 +136,13 @@ public void testMissingAwsRegionInConfig() &lt;/p&gt;
{
 		testConfig.setProperty(AWSConfigConstants.AWS_ACCESS_KEY_ID, &quot;accessKey&quot;);
 		testConfig.setProperty(AWSConfigConstants.AWS_SECRET_ACCESS_KEY, &quot;secretKey&quot;);
 
-		KinesisConfigUtil.validateAwsConfiguration(testConfig);
+		KinesisConfigUtil.getValidatedProducerConfiguration(testConfig);
 	}

&lt;p&gt;+	// ----------------------------------------------------------------------&lt;br/&gt;
+	// validateAwsConfiguration() tests&lt;br/&gt;
+	// ----------------------------------------------------------------------&lt;br/&gt;
+&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testUnrecognizableAwsRegionInConfig() {&lt;br/&gt;
 		exception.expect(IllegalArgumentException.class);&lt;br/&gt;
@@ -156,22 +156,6 @@ public void testUnrecognizableAwsRegionInConfig() &lt;/p&gt;
{
 		KinesisConfigUtil.validateAwsConfiguration(testConfig);
 	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Test&lt;/li&gt;
	&lt;li&gt;public void testAwsRegionOrEndpointInConfig() 
{
-		String expectedMessage = String.format(&quot;Either AWS region (&apos;%s&apos;) or AWS endpoint (&apos;%s&apos;) must be set in the config.&quot;,
-			AWSConfigConstants.AWS_REGION, AWSConfigConstants.AWS_REGION);
-		exception.expect(IllegalArgumentException.class);
-		exception.expectMessage(expectedMessage);
-
-		Properties testConfig = new Properties();
-		testConfig.setProperty(AWSConfigConstants.AWS_REGION, &quot;us-east&quot;);
-		testConfig.setProperty(AWSConfigConstants.AWS_ENDPOINT, &quot;fake&quot;);
-		testConfig.setProperty(AWSConfigConstants.AWS_ACCESS_KEY_ID, &quot;accessKey&quot;);
-		testConfig.setProperty(AWSConfigConstants.AWS_SECRET_ACCESS_KEY, &quot;secretKey&quot;);
-
-		KinesisConfigUtil.validateAwsConfiguration(testConfig);
-	}
&lt;p&gt;-&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testCredentialProviderTypeSetToBasicButNoCredentialSetInConfig() {&lt;br/&gt;
 		exception.expect(IllegalArgumentException.class);&lt;br/&gt;
@@ -200,6 +184,22 @@ public void testUnrecognizableCredentialProviderTypeInConfig() {&lt;br/&gt;
 	// validateConsumerConfiguration() tests&lt;br/&gt;
 	// ----------------------------------------------------------------------&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+	@Test&lt;br/&gt;
+	public void testAwsRegionOrEndpointInConsumerConfig() &lt;/p&gt;
{
+		String expectedMessage = String.format(&quot;For FlinkKinesisConsumer either AWS region (&apos;%s&apos;) or AWS endpoint (&apos;%s&apos;) must be set in the config.&quot;,
+				AWSConfigConstants.AWS_REGION, AWSConfigConstants.AWS_ENDPOINT);
+		exception.expect(IllegalArgumentException.class);
+		exception.expectMessage(expectedMessage);
+
+		Properties testConfig = new Properties();
+		testConfig.setProperty(AWSConfigConstants.AWS_REGION, &quot;us-east-1&quot;);
+		testConfig.setProperty(AWSConfigConstants.AWS_ENDPOINT, &quot;fake&quot;);
+		testConfig.setProperty(AWSConfigConstants.AWS_ACCESS_KEY_ID, &quot;accessKey&quot;);
+		testConfig.setProperty(AWSConfigConstants.AWS_SECRET_ACCESS_KEY, &quot;secretKey&quot;);
+
+		KinesisConfigUtil.validateConsumerConfiguration(testConfig);
+	}
&lt;p&gt;+&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testUnrecognizableStreamInitPositionTypeInConfig() {&lt;br/&gt;
 		exception.expect(IllegalArgumentException.class);&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644694" author="tzulitai" created="Wed, 10 Oct 2018 09:13:56 +0000"  >&lt;p&gt;Merged.&lt;/p&gt;

&lt;p&gt;1.5.5:&#160;60bab122878b320f5f55371b5aa0f9ae516c3e69&lt;br/&gt;
1.6.2:&#160;c363e9ee7cab768b642fb8f9fb6ede6fbddc852a&lt;br/&gt;
1.7.0:&#160;9b0bf691194755823c804db28330bc343b99a5b6&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3xxk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>