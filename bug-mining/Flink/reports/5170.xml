<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:54:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-11408] ContinuousProcessingTimeTrigger: NPE on clear() and state is lost on merge</title>
                <link>https://issues.apache.org/jira/browse/FLINK-11408</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I was testing session windows using processing time and found a couple of problems with the&#160;&lt;/p&gt;

&lt;p&gt;ContinuousProcessingTimeTrigger. The first one is an NPE in the clear method:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/casidiablo/flink-continuous-processing-trigger-bugs/blob/master/src/main/java/flink/bug/Bug1.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/casidiablo/flink-continuous-processing-trigger-bugs/blob/master/src/main/java/flink/bug/Bug1.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The second one, which is most likely related and the root cause of the first one, is that the way the state is merged for windows that are merged somehow makes it so that the trigger gets confused and it stops triggering:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/casidiablo/flink-continuous-processing-trigger-bugs/blob/master/src/main/java/flink/bug/Bug2.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/casidiablo/flink-continuous-processing-trigger-bugs/blob/master/src/main/java/flink/bug/Bug2.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I managed to solve both of these by using a modified version of&#160;&lt;/p&gt;

&lt;p&gt;ContinuousProcessingTimeTrigger which does NOT call `ctx.mergePartitionedState(stateDesc);` in the onMerge method.&lt;/p&gt;

&lt;p&gt;This is what I understand it happens at the trigger level:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The first element in the stream sets an initial&#160;fire time (logic is in&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ContinuousProcessingTimeTrigger#onElement()), if there is no trigger set.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;From then on,&#160;ContinuousProcessingTimeTrigger#onProcessingTime() is responsible for scheduling the next trigger.&#160;&lt;/li&gt;
	&lt;li&gt;When the windows are merged (in the case of session windows), somehow the clear and merge methods are called using the wrong window namespace (I think this is the root cause of the bug, but I&apos;m not too familiar with that code).&lt;/li&gt;
	&lt;li&gt;Because the state is not cleared properly in the new window namespace,&#160;the previously scheduled trigger gets executed against the window that was cleared.&lt;/li&gt;
	&lt;li&gt;Moreover, the new window has the state of the previous window, which means that:
	&lt;ol&gt;
		&lt;li&gt;onElement will NOT schedule a fire trigger&lt;/li&gt;
		&lt;li&gt;onProcessingTime will never be called at all&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Put both bugs in &lt;a href=&quot;https://github.com/casidiablo/flink-continuous-processing-trigger-bugs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/casidiablo/flink-continuous-processing-trigger-bugs&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is running Flink 1.7.1 locally.&lt;/p&gt;</environment>
        <key id="13211020">FLINK-11408</key>
            <summary>ContinuousProcessingTimeTrigger: NPE on clear() and state is lost on merge</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="kezhuw">Kezhu Wang</assignee>
                                    <reporter username="casidiablo">Cristian</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 22 Jan 2019 16:26:32 +0000</created>
                <updated>Wed, 24 Mar 2021 14:38:15 +0000</updated>
                            <resolved>Wed, 24 Mar 2021 14:38:15 +0000</resolved>
                                                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17302181" author="kezhuw" created="Tue, 16 Mar 2021 02:59:39 +0000"  >&lt;p&gt;I think it is same as&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5717&quot; title=&quot;NPE on SessionWindows with ContinuousProcessingTimeTrigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5717&quot;&gt;&lt;del&gt;FLINK-5717&lt;/del&gt;&lt;/a&gt; and similar to event time trigger counterpart &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4862&quot; title=&quot;NPE on EventTimeSessionWindows with ContinuousEventTimeTrigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4862&quot;&gt;&lt;del&gt;FLINK-4862&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The problems is:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In merging, old trigger states are merged out. In later &lt;tt&gt;clear&lt;/tt&gt; for old triggers, they will get no &lt;tt&gt;fireTimestampState&lt;/tt&gt;. This causes Bug1.&lt;/li&gt;
	&lt;li&gt;In merging, only state got merged into new window namespace but processing timer was not registered there. This causes Bug2.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mxm&quot; class=&quot;user-hover&quot; rel=&quot;mxm&quot;&gt;mxm&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;&#160;Could I take over this due to stale &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5717&quot; title=&quot;NPE on SessionWindows with ContinuousProcessingTimeTrigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5717&quot;&gt;&lt;del&gt;FLINK-5717&lt;/del&gt;&lt;/a&gt; ? I plans to add test similar to &lt;tt&gt;ContinuousEventTimeTriggerTest.testMergingWindows&lt;/tt&gt; to cover both cases.&lt;/p&gt;</comment>
                            <comment id="17302258" author="dawidwys" created="Tue, 16 Mar 2021 06:50:38 +0000"  >&lt;p&gt;Please go ahead &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kezhuw&quot; class=&quot;user-hover&quot; rel=&quot;kezhuw&quot;&gt;kezhuw&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17307864" author="dawidwys" created="Wed, 24 Mar 2021 14:37:59 +0000"  >&lt;p&gt;I will close this one as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5717&quot; title=&quot;NPE on SessionWindows with ContinuousProcessingTimeTrigger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5717&quot;&gt;&lt;del&gt;FLINK-5717&lt;/del&gt;&lt;/a&gt;. Sorry I have not spotted that earlier.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13040572">FLINK-5717</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 33 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi06cw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>