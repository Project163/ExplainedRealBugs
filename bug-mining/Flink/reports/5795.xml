<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:01:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-23971] PulsarSourceITCase.testIdleReader failed on azure</title>
                <link>https://issues.apache.org/jira/browse/FLINK-23971</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO] Running org.apache.flink.connector.pulsar.source.PulsarSourceITCase
[ERROR] Tests run: 8, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 353.527 s &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.flink.connector.pulsar.source.PulsarSourceITCase
[ERROR] testIdleReader{TestEnvironment, ExternalContext}[2]  Time elapsed: 4.549 s  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError:

Expected: Records consumed by Flink should be identical to test data and preserve the order in multiple splits
     but: Unexpected record &lt;span class=&quot;code-quote&quot;&gt;&apos;tj7MpFRWX95GzBpSF3CCjxKSal6bRhR0aF&apos;&lt;/span&gt;
   at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:20)
   at org.hamcrest.MatcherAssert.assertThat(MatcherAssert.java:8)
   at org.apache.flink.connectors.test.common.testsuites.SourceTestSuiteBase.testIdleReader(SourceTestSuiteBase.java:193)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=22819&amp;amp;view=logs&amp;amp;j=fc5181b0-e452-5c8f-68de-1097947f6483&amp;amp;t=995c650b-6573-581c-9ce6-7ad4cc038461&amp;amp;l=24448&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=22819&amp;amp;view=logs&amp;amp;j=fc5181b0-e452-5c8f-68de-1097947f6483&amp;amp;t=995c650b-6573-581c-9ce6-7ad4cc038461&amp;amp;l=24448&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the same error as in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23828&quot; title=&quot;KafkaSourceITCase.testIdleReader fails on azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-23828&quot;&gt;FLINK-23828&lt;/a&gt; (kafka).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13397216">FLINK-23971</key>
            <summary>PulsarSourceITCase.testIdleReader failed on azure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ruanhang1993">Ruan Hang</assignee>
                                    <reporter username="roman">Roman Khachatryan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 25 Aug 2021 15:21:01 +0000</created>
                <updated>Wed, 12 Jan 2022 14:24:19 +0000</updated>
                            <resolved>Wed, 1 Sep 2021 09:54:44 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                                    <component>Connectors / Pulsar</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17404881" author="xintongsong" created="Thu, 26 Aug 2021 03:30:00 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=syhily&quot; class=&quot;user-hover&quot; rel=&quot;syhily&quot;&gt;syhily&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=renqs&quot; class=&quot;user-hover&quot; rel=&quot;renqs&quot;&gt;renqs&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17405573" author="ruanhang1993" created="Fri, 27 Aug 2021 04:11:27 +0000"  >&lt;p&gt;There is a problem in the test method&#160;&lt;em&gt;matchesMultipleSplitTestData.&lt;/em&gt;&#160;When there are the same records between two split, the test may fail.&lt;/p&gt;

&lt;p&gt;For example, there are totally two splits for the test. And the first split records is like {a,b,b,c}, the second split records is like {a,b,c,d}. The final result is {a,a,b,c,d,b,b,c}. It is a right result, but the test will fail.&lt;/p&gt;

&lt;p&gt;I think we need to add a prefix for each record in different splits, like &quot;0-XXXXXX&quot; for the first split. Then the test will return the right judgement.&lt;/p&gt;

&lt;p&gt;The test should fail in both&#160;&lt;em&gt;testMultipleSplits&lt;/em&gt; and &lt;em&gt;testIdleReader&lt;/em&gt; test case. But only the latter test case occurs, and the problem probability is supposed to be very low. Maybe we need more&#160;evidence about it.&lt;/p&gt;</comment>
                            <comment id="17405622" author="ruanhang1993" created="Fri, 27 Aug 2021 06:33:28 +0000"  >&lt;p&gt;After a lot of times to test, I reproduced the error and get the&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13032584/13032584_error.log&quot; title=&quot;error.log attached to FLINK-23971&quot;&gt;error.log&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; that I have provided in the attachments.&lt;/p&gt;

&lt;p&gt;The log shows that there is a duplicate string &quot;3&quot; in both split 2 and split 3. When taking the next loop, the logic uses the &quot;3&quot; in split 2(we should take it from split 3), the next string &quot;aXf1QgrCBzQNlr&quot; in the result can not be found as the next string after doing that.&lt;/p&gt;</comment>
                            <comment id="17406538" author="xintongsong" created="Mon, 30 Aug 2021 03:52:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23011&amp;amp;view=logs&amp;amp;j=5cae8624-c7eb-5c51-92d3-4d2dacedd221&amp;amp;t=5acec1b4-945b-59ca-34f8-168928ce5199&amp;amp;l=24445&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23011&amp;amp;view=logs&amp;amp;j=5cae8624-c7eb-5c51-92d3-4d2dacedd221&amp;amp;t=5acec1b4-945b-59ca-34f8-168928ce5199&amp;amp;l=24445&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17406539" author="xintongsong" created="Mon, 30 Aug 2021 03:56:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruanhang1993&quot; class=&quot;user-hover&quot; rel=&quot;ruanhang1993&quot;&gt;ruanhang1993&lt;/a&gt;,&lt;br/&gt;
Thanks for looking into this. Would you like to provide a PR to fix this?&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=renqs&quot; class=&quot;user-hover&quot; rel=&quot;renqs&quot;&gt;renqs&lt;/a&gt;, could you help verify &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruanhang1993&quot; class=&quot;user-hover&quot; rel=&quot;ruanhang1993&quot;&gt;ruanhang1993&lt;/a&gt;&apos;s findings?&lt;/p&gt;</comment>
                            <comment id="17406602" author="ruanhang1993" created="Mon, 30 Aug 2021 07:48:23 +0000"  >&lt;p&gt;Fine, I will provide a PR to fix it.&lt;/p&gt;</comment>
                            <comment id="17406615" author="xintongsong" created="Mon, 30 Aug 2021 08:10:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruanhang1993&quot; class=&quot;user-hover&quot; rel=&quot;ruanhang1993&quot;&gt;ruanhang1993&lt;/a&gt;, you&apos;re assigned. Please move ahead.&lt;/p&gt;</comment>
                            <comment id="17406618" author="renqs" created="Mon, 30 Aug 2021 08:20:30 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruanhang1993&quot; class=&quot;user-hover&quot; rel=&quot;ruanhang1993&quot;&gt;ruanhang1993&lt;/a&gt;&#160;for the investigation! I double checked the code and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruanhang1993&quot; class=&quot;user-hover&quot; rel=&quot;ruanhang1993&quot;&gt;ruanhang1993&lt;/a&gt;&apos;s assumption is reasonable.&lt;/p&gt;

&lt;p&gt;Also I think this ticket shares the same cause as &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23828&quot; title=&quot;KafkaSourceITCase.testIdleReader fails on azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-23828&quot;&gt;FLINK-23828&lt;/a&gt;. I&apos;ll mark it as related to this one.&#160;&lt;/p&gt;</comment>
                            <comment id="17408070" author="becket_qin" created="Wed, 1 Sep 2021 09:54:44 +0000"  >&lt;p&gt;PR merged to master:&#160;ad052cc056c7d6e63d8356dbd22d6a98b54743c3&lt;/p&gt;

&lt;p&gt;Cherry-picked to release-1.14:&#160;267b863683b23b8b3df29bee55ac58a25ca1fcd0&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13395601">FLINK-23828</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13032584" name="error.log" size="52481" author="ruanhang1993" created="Fri, 27 Aug 2021 06:27:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0u8ts:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>