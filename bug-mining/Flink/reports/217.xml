<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:18:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-1531] Custom Kryo Serializer fails in itertation scenario</title>
                <link>https://issues.apache.org/jira/browse/FLINK-1531</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When using iterations with a custom serializer for a domain object, the iteration will fail.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.flink.runtime.client.JobExecutionException: com.esotericsoftware.kryo.KryoException: Buffer underflow
	at org.apache.flink.api.java.typeutils.runtime.NoFetchingInput.require(NoFetchingInput.java:76)
	at com.esotericsoftware.kryo.io.Input.readVarInt(Input.java:355)
	at com.esotericsoftware.kryo.util.DefaultClassResolver.readClass(DefaultClassResolver.java:109)
	at com.esotericsoftware.kryo.Kryo.readClass(Kryo.java:641)
	at com.esotericsoftware.kryo.Kryo.readClassAndObject(Kryo.java:752)
	at org.apache.flink.api.java.typeutils.runtime.KryoSerializer.deserialize(KryoSerializer.java:198)
	at org.apache.flink.api.java.typeutils.runtime.KryoSerializer.deserialize(KryoSerializer.java:203)
	at org.apache.flink.runtime.io.disk.InputViewIterator.next(InputViewIterator.java:43)
	at org.apache.flink.runtime.iterative.task.IterationHeadPactTask.streamOutFinalOutputBulk(IterationHeadPactTask.java:404)
	at org.apache.flink.runtime.iterative.task.IterationHeadPactTask.run(IterationHeadPactTask.java:377)
	at org.apache.flink.runtime.operators.RegularPactTask.invoke(RegularPactTask.java:360)
	at org.apache.flink.runtime.execution.RuntimeEnvironment.run(RuntimeEnvironment.java:204)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12774528">FLINK-1531</key>
            <summary>Custom Kryo Serializer fails in itertation scenario</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jkirsch">Johannes</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Feb 2015 10:36:56 +0000</created>
                <updated>Wed, 2 Oct 2019 17:44:05 +0000</updated>
                            <resolved>Thu, 12 Feb 2015 17:41:36 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9</fixVersion>
                    <fixVersion>0.8.1</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14317980" author="jkirsch" created="Thu, 12 Feb 2015 10:41:37 +0000"  >&lt;p&gt;JUnit test to reproduce&lt;/p&gt;</comment>
                            <comment id="14318002" author="jkirsch" created="Thu, 12 Feb 2015 11:09:52 +0000"  >&lt;p&gt;It seems that in the attached test scenario there is a MutableObjectIterator which is iterated and null is used to signal &quot;no more&quot;.&lt;br/&gt;
Because kryo is in the mix - it eagerly tries to read &quot;next&quot; which fails with &lt;em&gt;buffer underflow&lt;/em&gt;&lt;br/&gt;
So somewhere there should be a &lt;em&gt;hasNext&lt;/em&gt; call ..&lt;/p&gt;</comment>
                            <comment id="14318314" author="jkirsch" created="Thu, 12 Feb 2015 14:59:17 +0000"  >&lt;p&gt;I just had a look again at the logging again&lt;/p&gt;

&lt;p&gt;Right at the beginning I see&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;15:56:17.009 [main] INFO  org.apache.flink.api.java.typeutils.TypeExtractor  - &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestKryoIterationSerializer$DomainObject is not a valid POJO type
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which is clear, as this one should be managed by Kryos serializer.&lt;br/&gt;
Looks like if the process fails on this issue, it would be clearer.&lt;br/&gt;
It seems that the serializer is only invoked for fields. So if I wrap the object into a value holder or tuple class it works fine, without the default constructor or any of the setters or getters.&lt;/p&gt;</comment>
                            <comment id="14318430" author="githubbot" created="Thu, 12 Feb 2015 15:57:51 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/391&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/391&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-1531&quot; title=&quot;Custom Kryo Serializer fails in itertation scenario&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-1531&quot;&gt;&lt;del&gt;FLINK-1531&lt;/del&gt;&lt;/a&gt; Fixes KryoSerializer&apos;s EOFException forwarding&lt;/p&gt;

&lt;p&gt;    Adds proper EOFException forwarding to the KryoSerializer.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixKryoUnderflow&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/391.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/391.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #391&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8e9c94b50c55f31c311d60ff63bd42108962e9a4&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-02-12T15:50:46Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-1531&quot; title=&quot;Custom Kryo Serializer fails in itertation scenario&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-1531&quot;&gt;&lt;del&gt;FLINK-1531&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Adds proper EOFException forwarding to KryoSerializer.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14318436" author="till.rohrmann" created="Thu, 12 Feb 2015 16:03:45 +0000"  >&lt;p&gt;Thanks for the great bug description with the additional UnitTest &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkirsch&quot; class=&quot;user-hover&quot; rel=&quot;jkirsch&quot;&gt;jkirsch&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;The reason for the failure was that the KryoSerializer did not properly forwarded the EOFException of the underlying stream. The EOFException is used by the system to know when all data of an input channel has been consumed. &lt;/p&gt;

&lt;p&gt;I created a PR for this and once all tests pass on Travis, I&apos;ll commit it. &lt;/p&gt;</comment>
                            <comment id="14318440" author="githubbot" created="Thu, 12 Feb 2015 16:06:26 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/391#issuecomment-74097085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/391#issuecomment-74097085&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good&lt;br/&gt;
    +1&lt;/p&gt;</comment>
                            <comment id="14318463" author="githubbot" created="Thu, 12 Feb 2015 16:17:07 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/391#issuecomment-74099311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/391#issuecomment-74099311&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    We should also put the fix into the release-0.8 branch.&lt;/p&gt;</comment>
                            <comment id="14318465" author="githubbot" created="Thu, 12 Feb 2015 16:17:51 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/391#issuecomment-74099482&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/391#issuecomment-74099482&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Tests for release-0.8 are running.&lt;/p&gt;</comment>
                            <comment id="14318543" author="githubbot" created="Thu, 12 Feb 2015 16:58:02 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/391#issuecomment-74107768&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/391#issuecomment-74107768&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ok, I&apos;ll merge it.&lt;/p&gt;</comment>
                            <comment id="14318603" author="githubbot" created="Thu, 12 Feb 2015 17:40:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/391&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/391&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14318606" author="till.rohrmann" created="Thu, 12 Feb 2015 17:41:36 +0000"  >&lt;p&gt;Fixed for 0.9 in 21f47d9c69441c17b5f90ea2c7cb8f4d47f7fcb5&lt;br/&gt;
Fixed for 0.8 in a669d785e74534731c19e982e47457475420f4a7&lt;/p&gt;</comment>
                            <comment id="14318779" author="jkirsch" created="Thu, 12 Feb 2015 19:06:55 +0000"  >&lt;p&gt;Thanks for the quick turnaround&lt;br/&gt;
Tried it locally and it works now - thanks&lt;/p&gt;

&lt;p&gt;But as a general though, isn&apos;t using exceptions to signal EOF much to costly?&lt;/p&gt;

&lt;p&gt;Quick informative write up on stack overflow:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://stackoverflow.com/questions/299068/how-slow-are-java-exceptions&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/299068/how-slow-are-java-exceptions&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14319835" author="stephanewen" created="Fri, 13 Feb 2015 10:28:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jkirsch&quot; class=&quot;user-hover&quot; rel=&quot;jkirsch&quot;&gt;jkirsch&lt;/a&gt; Exceptions are used rarely, only at the end of jobs and at the end of supersteps. That is a handful of times within a job and should be okay.&lt;br/&gt;
We are using a java interface that uses EOFException to signal the last record, so we need to do this until we get rid of that interface.&lt;/p&gt;

&lt;p&gt;BTW: I think exceptions became much faster since that answer (6 years ago), since stack traces are filled in lazily now.&lt;/p&gt;</comment>
                            <comment id="14321520" author="jkirsch" created="Sat, 14 Feb 2015 15:26:56 +0000"  >&lt;p&gt;Thanks for the info &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt;&lt;br/&gt;
Makes sense to me and considering the &quot;old&quot; SO issue, you are definitively right, just wanted to raise this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12698398" name="TestKryoIterationSerializer.java" size="2702" author="jkirsch" created="Thu, 12 Feb 2015 10:41:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25jbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>