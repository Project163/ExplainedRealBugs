<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:23:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3631] CodeGenerator does not check type compatibility for equality expressions</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3631</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The following Table API query does not fail but produces an empty result:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    val env = ExecutionEnvironment.getExecutionEnvironment
    val ds = CollectionDataSets.get3TupleDataSet(env).as(&lt;span class=&quot;code-quote&quot;&gt;&apos;a, &apos;&lt;/span&gt;b, &apos;c)

    &lt;span class=&quot;code-comment&quot;&gt;// must fail. Field &apos;a is not a string.
&lt;/span&gt;    ds.filter( &apos;a === &lt;span class=&quot;code-quote&quot;&gt;&quot;nope&quot;&lt;/span&gt; ).collect()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The generated flatMap code looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void flatMap(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; _in1, org.apache.flink.util.Collector c) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
  org.apache.flink.api.table.Row in1 = (org.apache.flink.api.table.Row) _in1;
  
  java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; result$17 = (java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;) in1.productElement(2);
  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; result$11 = (java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;) in1.productElement(0);
  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; result$14 = (java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;) in1.productElement(1);

  java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; result$19 = &lt;span class=&quot;code-quote&quot;&gt;&quot;nope&quot;&lt;/span&gt;;
  
  &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; result$21 = result$19.equals(result$11);
  
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result$21) {
    out.setField(0, result$11);
  	out.setField(1, result$14);
  	out.setField(2, result$17);
    c.collect(out);
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would expect the query to fail due to a Integer/String type conflict.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12951178">FLINK-3631</key>
            <summary>CodeGenerator does not check type compatibility for equality expressions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Mar 2016 12:47:04 +0000</created>
                <updated>Tue, 22 Mar 2016 12:59:28 +0000</updated>
                            <resolved>Tue, 22 Mar 2016 12:59:28 +0000</resolved>
                                    <version>1.1.0</version>
                                    <fixVersion>1.1.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15200008" author="ram_krish" created="Thu, 17 Mar 2016 17:40:28 +0000"  >&lt;p&gt;Can I take this JIRA &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt;? &lt;/p&gt;</comment>
                            <comment id="15201210" author="fhueske" created="Fri, 18 Mar 2016 09:03:31 +0000"  >&lt;p&gt;Sure &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ram_krish&lt;/a&gt;. Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; can give some advice for how to approach this issue.&lt;/p&gt;</comment>
                            <comment id="15201221" author="ram_krish" created="Fri, 18 Mar 2016 09:11:40 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fhueske&quot; class=&quot;user-hover&quot; rel=&quot;fhueske&quot;&gt;fhueske&lt;/a&gt;. I was able to spot where the problem is and I will take &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;&apos;s advice before preparing a patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; val generator = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CodeGenerator(config, inputDS.getType)

    val condition = calcProgram.getCondition
    val expandedExpressions = calcProgram.getProjectList.map(
       expr =&amp;gt; calcProgram.expandLocalRef(expr))
    val projection = generator.generateResultExpression(
      returnType,
      rowType.getFieldNames,
      expandedExpressions)

    val body = {
      &lt;span class=&quot;code-comment&quot;&gt;// only projection
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (condition == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        s&quot;&quot;&quot;
          |${projection.code}
          |${generator.collectorTerm}.collect(${projection.resultTerm});
          |&quot;&quot;&quot;.stripMargin
      }
      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        val filterCondition = generator.generateExpression(
          calcProgram.expandLocalRef(calcProgram.getCondition))
        &lt;span class=&quot;code-comment&quot;&gt;// only filter
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (projection == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-comment&quot;&gt;// conversion
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (inputDS.getType != returnType) {
            val conversion = generator.generateConverterResultExpression(
              returnType,
              rowType.getFieldNames)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here &apos;generator.generateResultExpression&apos; does some vaildatons on the result types. But &apos;generator.generateExpression&apos; that creates the filterCondition does not do any validations. I am new to Scala so will take some time to see how to fix this. &lt;/p&gt;</comment>
                            <comment id="15204556" author="githubbot" created="Mon, 21 Mar 2016 16:36:20 +0000"  >&lt;p&gt;GitHub user ramkrish86 opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1823&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3631&quot; title=&quot;CodeGenerator does not check type compatibility for equality expressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3631&quot;&gt;&lt;del&gt;FLINK-3631&lt;/del&gt;&lt;/a&gt; CodeGenerator does not check type compatibility for equa&#8230;&lt;/p&gt;

&lt;p&gt;    Adds a check on the CodeGenerator.scala code which does a check on the left and right operands so that all the comparison expressions can work now. (=,!=,&amp;gt;,&amp;lt;)&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/ramkrish86/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ramkrish86/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3631&quot; title=&quot;CodeGenerator does not check type compatibility for equality expressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3631&quot;&gt;&lt;del&gt;FLINK-3631&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1823.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1823.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1823&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d107f4825d40998b9e40a5270b8df48dd48b8eb2&lt;br/&gt;
Author: ramkrishna &amp;lt;ramkrishna.s.vasudevan@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-03-21T16:33:42Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3631&quot; title=&quot;CodeGenerator does not check type compatibility for equality expressions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3631&quot;&gt;&lt;del&gt;FLINK-3631&lt;/del&gt;&lt;/a&gt; CodeGenerator does not check type compatibility for equality&lt;br/&gt;
    expressions&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15205250" author="githubbot" created="Mon, 21 Mar 2016 22:02:25 +0000"  >&lt;p&gt;Github user fhueske commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1823#issuecomment-199506835&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1823#issuecomment-199506835&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the PR @ramkrish86 &lt;br/&gt;
    Looks good. Just one minor thing. Can you add a one line comment to each test that explains why the program should fail such as the tests `testNonWorkingSubstring1()` and `testNonWorkingSubstring2()`? Thanks!&lt;/p&gt;</comment>
                            <comment id="15205811" author="githubbot" created="Tue, 22 Mar 2016 05:12:04 +0000"  >&lt;p&gt;Github user ramkrish86 commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1823#issuecomment-199641069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1823#issuecomment-199641069&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I have done the update @fhueske .Thanks for the review. &lt;/p&gt;</comment>
                            <comment id="15205969" author="githubbot" created="Tue, 22 Mar 2016 08:01:15 +0000"  >&lt;p&gt;Github user fhueske commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1823#issuecomment-199686918&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1823#issuecomment-199686918&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Perfect, thanks for the update. Good to merge.&lt;/p&gt;</comment>
                            <comment id="15206063" author="githubbot" created="Tue, 22 Mar 2016 09:34:01 +0000"  >&lt;p&gt;Github user fhueske commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1823#issuecomment-199717085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1823#issuecomment-199717085&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging&lt;/p&gt;</comment>
                            <comment id="15206144" author="ram_krish" created="Tue, 22 Mar 2016 10:42:22 +0000"  >&lt;p&gt;So can we close this JIRA?  Thanks for the merge and taking time to look into the PR.&lt;/p&gt;</comment>
                            <comment id="15206179" author="fhueske" created="Tue, 22 Mar 2016 11:07:56 +0000"  >&lt;p&gt;I&apos;m currently running final tests before merging. I will close the JIRA once the code was actually merged.&lt;br/&gt;
Thanks, Fabian&lt;/p&gt;</comment>
                            <comment id="15206296" author="githubbot" created="Tue, 22 Mar 2016 12:55:02 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1823&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15206303" author="fhueske" created="Tue, 22 Mar 2016 12:59:28 +0000"  >&lt;p&gt;Fixed with 22d327f0409665c64588a4cb81acef97b481fb37&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2utn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>