<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:26:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5118] Inconsistent records sent/received metrics</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5118</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In 1.2-SNAPSHOT running a large scale job you see that the counts for send/received records are inconsistent, e.g. in a simple word count job we see more received records/bytes than we see sent. This is a regression from 1.1 where everything works as expected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13022227">FLINK-5118</key>
            <summary>Inconsistent records sent/received metrics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="uce">Ufuk Celebi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Nov 2016 15:45:57 +0000</created>
                <updated>Mon, 23 Jan 2017 13:16:09 +0000</updated>
                            <resolved>Mon, 23 Jan 2017 13:16:04 +0000</resolved>
                                    <version>1.2.0</version>
                    <version>1.3.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / Metrics</component>
                    <component>Runtime / Web Frontend</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15821166" author="zentol" created="Thu, 12 Jan 2017 14:52:26 +0000"  >&lt;p&gt;PR at &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15821232" author="githubbot" created="Thu, 12 Jan 2017 15:18:17 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106#discussion_r95812448&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106#discussion_r95812448&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/api/serialization/SpanningRecordSerializer.java &amp;#8212;&lt;br/&gt;
    @@ -99,7 +99,7 @@ public SerializationResult addRecord(T record) throws IOException {&lt;br/&gt;
     		this.lengthBuffer.putInt(0, len);&lt;/p&gt;

&lt;p&gt;     		if (numBytesOut != null) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;numBytesOut.inc(len);&lt;br/&gt;
    +			numBytesOut.inc(len + 4);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think this warrants both a comment and a test.&lt;/p&gt;</comment>
                            <comment id="15821239" author="githubbot" created="Thu, 12 Jan 2017 15:20:55 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Good catch. I was wondering whether it is better to count in a consistent way, too, e.g. count the size of each buffer or each record on both A and B (now we have per record on the output side and per buffer on the input side).&lt;/p&gt;</comment>
                            <comment id="15821625" author="githubbot" created="Fri, 13 Jan 2017 11:02:56 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @uce Could you take another look? I moved the bytesOut counter into the RecordWriter.&lt;/p&gt;
</comment>
                            <comment id="15823250" author="githubbot" created="Sun, 15 Jan 2017 20:04:10 +0000"  >&lt;p&gt;Github user xhumanoid commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol &lt;br/&gt;
    what do you think about remove &lt;br/&gt;
    if (numBytesOut != null) {&lt;/p&gt;

&lt;p&gt;    and replace&lt;br/&gt;
     numBytesOut = metrics.getNumBytesOutCounter();&lt;/p&gt;

&lt;p&gt;    with&lt;/p&gt;

&lt;p&gt;    + if (metrics.getNumBytesOutCounter() != null) &lt;/p&gt;
{
    +    numBytesOut = metrics.getNumBytesOutCounter();
    + }
&lt;p&gt; else &lt;/p&gt;
{
    +    numBytesOut = new NullCounter();
    + }

&lt;p&gt;    where NullCounter have empty implementation for every method,&lt;/p&gt;

&lt;p&gt;    prof:&lt;br/&gt;
    we do null check in one place, because sometime we may forget to do it&lt;/p&gt;

&lt;p&gt;    cons:&lt;br/&gt;
    sometimes we broke devirtualization and inlining for counter.inc(..) method&lt;/p&gt;</comment>
                            <comment id="15823265" author="githubbot" created="Sun, 15 Jan 2017 20:52:16 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @xhumanoid The metrics returned by the TaskIOMetricGroup can&apos;t actually be null, so I wouldn&apos;t put too much thought into dealing with that case.&lt;/p&gt;</comment>
                            <comment id="15823272" author="githubbot" created="Sun, 15 Jan 2017 21:19:30 +0000"  >&lt;p&gt;Github user xhumanoid commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @zentol I asked because you always check on null when you try writing to Counter &lt;br/&gt;
    or is it prevent uninitialized state?&lt;/p&gt;</comment>
                            <comment id="15823662" author="githubbot" created="Mon, 16 Jan 2017 09:16:08 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    The code checks for null since there is no &lt;b&gt;technical&lt;/b&gt; contract that the returned value is null. They aren&apos;t strictly necessary, and are only meant to guard against programming errors in the metrics system.&lt;/p&gt;

&lt;p&gt;    Using a ```NullCounter``` would indeed do the same, would however introduce effectively dead code.&lt;/p&gt;</comment>
                            <comment id="15823968" author="githubbot" created="Mon, 16 Jan 2017 13:35:14 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1 to this approach.&lt;/p&gt;

&lt;p&gt;    Some suggestions for small performance improvements, not specific to this case, but also applicable to other cases:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It may make sense to type the counters at that level to the &quot;SimpleCounter&quot;, if we anyways provide them. The TaskIOMetricGroup could type its counters to &quot;SimpleCounter&quot; as well. Since that class it not final, and future mocks/checks can be implemented on that class as well&lt;/li&gt;
	&lt;li&gt;We can make sure that the field `counter` is always initialized by initially assigning a standalone SimpleCounter. That way we could drop the null checks in the code.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15826057" author="githubbot" created="Tue, 17 Jan 2017 13:37:39 +0000"  >&lt;p&gt;Github user zentol commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StephanEwen I&apos;ll add the default initialization of ```counter``` while merging.&lt;/p&gt;

&lt;p&gt;    Typing the counters to a ```SimpleCounter``` would affect a lot of other classes though (especially since we can extend this to the ```OperatorIOMetricGroup```), so I would like to do that as part of another issue. &lt;/p&gt;</comment>
                            <comment id="15834460" author="githubbot" created="Mon, 23 Jan 2017 13:13:21 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3106&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15834468" author="stephanewen" created="Mon, 23 Jan 2017 13:16:05 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1.2.0 via 940b4900d1cfc19b32af2b3e8753d3b6e01622ee&lt;/li&gt;
	&lt;li&gt;1.3.0 via 3a258f7eabe0940abaca63f900a080204b32d2fc&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36l3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>