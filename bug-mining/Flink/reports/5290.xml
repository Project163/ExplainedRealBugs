<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:56:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-21992] Fix availability notification in UnionInputGate</title>
                <link>https://issues.apache.org/jira/browse/FLINK-21992</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A user on mailing list reported that his job gets stuck with unaligned checkpoint enabled.&lt;br/&gt;
&lt;a href=&quot;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Source-Operators-Stuck-in-the-requestBufferBuilderBlocking-tt42530.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/Source-Operators-Stuck-in-the-requestBufferBuilderBlocking-tt42530.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We received two similar reports in the past, but the users didn&apos;t follow up, so it was not as easy to diagnose as this time where the initial report already contains many relevant data points. &lt;/p&gt;

&lt;p&gt;Beside a buffer leak, there could also be an issue with priority notification.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13367824">FLINK-21992</key>
            <summary>Fix availability notification in UnionInputGate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arvid">Arvid Heise</assignee>
                                    <reporter username="arvid">Arvid Heise</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 26 Mar 2021 10:24:40 +0000</created>
                <updated>Tue, 22 Jun 2021 14:07:05 +0000</updated>
                            <resolved>Wed, 14 Apr 2021 19:28:53 +0000</resolved>
                                    <version>1.12.2</version>
                    <version>1.13.0</version>
                                    <fixVersion>1.13.0</fixVersion>
                    <fixVersion>1.12.3</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                                                                <comments>
                            <comment id="17319986" author="arvid" created="Tue, 13 Apr 2021 07:28:56 +0000"  >&lt;p&gt;It turns out that there is an issue with notification. We managed to reliable reproduce it with:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Unaligned checkpoints with&lt;/li&gt;
	&lt;li&gt;Unions going into&lt;/li&gt;
	&lt;li&gt;Two input tasks.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The root cause is a bug in &lt;tt&gt;UnionInputGate&lt;/tt&gt; introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-19026&quot; title=&quot;Improve threading model of Unaligner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-19026&quot;&gt;&lt;del&gt;FLINK-19026&lt;/del&gt;&lt;/a&gt;. The available notification of &lt;tt&gt;UnionInputGate&lt;/tt&gt; is simply reset too early, leading to stuck tasks.&lt;/p&gt;

&lt;p&gt;The bug can probably also be triggered with single input tasks but there are certain factors that rectify the bug: If you drain a union gate entirely without looking at availability after the first buffer, the bug would not be visible. Since we hot-loop at plenty of places until running out of data, it might be that just the combination of the three things actually makes it visible.&lt;/p&gt;</comment>
                            <comment id="17320001" author="dawidwys" created="Tue, 13 Apr 2021 07:48:52 +0000"  >&lt;p&gt;Do we target that for 1.13?&lt;/p&gt;</comment>
                            <comment id="17320653" author="maguowei" created="Wed, 14 Apr 2021 02:33:48 +0000"  >&lt;p&gt;We also see the same stack in our internal tests without unaligned checkpoint enabled.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[stat_date, cate_id, user_id, biz, MIN(visit_time_int) FILTER $f5 AS min$0, MIN(visit_time_int) FILTER $f6 AS min$1, MIN(visit_time_int) FILTER $f7 AS min$2, MIN(visit_time_int) FILTER $f8 AS min$3, MIN(visit_time_int) FILTER $f9 AS min$4]))) (68/256)#0&quot; Id=101 WAITING on java.util.concurrent.CompletableFuture$Signaller@2e0b208c
at sun.misc.Unsafe.park(Native Method)
-  waiting on java.util.concurrent.CompletableFuture$Signaller@2e0b208c
at java.util.concurrent.locks.LockSupport.park(LockSupport.java:189)
at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1693)
at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)
at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1729)
at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1895)
at org.apache.flink.runtime.io.network.buffer.LocalBufferPool.requestMemorySegmentBlocking(LocalBufferPool.java:319)
at org.apache.flink.runtime.io.network.buffer.LocalBufferPool.requestBufferBuilderBlocking(LocalBufferPool.java:291)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17321096" author="arvid" created="Wed, 14 Apr 2021 15:35:48 +0000"  >&lt;p&gt;Merged into master as 7c3abe11a28d54a585985ef908f36d8cf5857e14.&lt;/p&gt;</comment>
                            <comment id="17321279" author="arvid" created="Wed, 14 Apr 2021 19:28:40 +0000"  >&lt;p&gt;Merged into 1.12 as e2cbfad6a3cdafe3d568bb43a1d048f9533b29ec.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0p8eo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>