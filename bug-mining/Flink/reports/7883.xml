<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:22:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-38181] Code generation fails for ROW() with CAST to SMALLINT/TINYINT when input is non-literal</title>
                <link>https://issues.apache.org/jira/browse/FLINK-38181</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Summary&quot;&gt;&lt;/a&gt;Summary&lt;/h3&gt;

&lt;p&gt;When using the&#160;ROW()&#160;function with&#160;CAST()&#160;to&#160;SMALLINT&#160;or&#160;TINYINT types on non-literal input expressions, code generation fails with a compilation error. The generated Java code produces incorrectly typed default&#160;values that&#160;don&apos;t match method signatures.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Description&quot;&gt;&lt;/a&gt;Description&lt;/h3&gt;

&lt;p&gt;&lt;b&gt;Problem:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The&#160;primitiveDefaultValue()&#160;method in&#160;CodeGenUtils.scala&#160;returns untyped integer literals (&quot;-1&quot;) for both&#160;TINYINT&#160;and&#160;SMALLINT&#160;types. When these&#160;default&#160;values are used in generated code, they&#160;fail to compile&#160;because they&#160;don&apos;t match the expected parameter&#160;types for&#160;methods&#160;like&#160;BinaryRowWriter.writeShort(int,&#160;short).&lt;/p&gt;

&lt;p&gt;{*}Root Cause:&lt;br/&gt;
{*}In&#160;CodeGenUtils.primitiveDefaultValue(), the&#160;method has:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; TINYINT | SMALLINT | INTEGER | DATE | TIME_WITHOUT_TIME_ZONE | INTERVAL_YEAR_MONTH =&amp;gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;-1&quot;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This generates Java code like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
writer.writeShort(0, -1);  &lt;span class=&quot;code-comment&quot;&gt;// Compilation error: -1 is &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, not &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; &lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Expected Behavior:&lt;/b&gt;&lt;br/&gt;
The method should return properly&#160;typed literals:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TINYINT &#8594; &lt;span class=&quot;code-quote&quot;&gt;&quot;((&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) -1)&quot;&lt;/span&gt;
SMALLINT &#8594; &lt;span class=&quot;code-quote&quot;&gt;&quot;((&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;) -1)&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;h3&gt;&lt;a name=&quot;Steps%C2%A0to%C2%A0Reproduce&quot;&gt;&lt;/a&gt;Steps&#160;to&#160;Reproduce&lt;/h3&gt;

&lt;p&gt;Execute the following SQL query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT ROW(CAST(SCORE AS SMALLINT)) FROM (VALUES (1), (2), (3)) AS T(SCORE) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Observe the compilation error during code generation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: org.codehaus.commons.compiler.CompileException: Line 22, Column 20: No applicable constructor/method found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; actual parameters &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;; candidates are: &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void org.apache.flink.table.data.writer.BinaryRowWriter.writeShort(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;)&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; void org.apache.flink.table.data.writer.BinaryWriter.writeShort(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;)&quot;&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13625287">FLINK-38181</key>
            <summary>Code generation fails for ROW() with CAST to SMALLINT/TINYINT when input is non-literal</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="raminqaf">Ramin Gharib</assignee>
                                    <reporter username="raminqaf">Ramin Gharib</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 1 Aug 2025 15:33:37 +0000</created>
                <updated>Thu, 7 Aug 2025 15:20:06 +0000</updated>
                            <resolved>Thu, 7 Aug 2025 15:20:06 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="18012614" author="twalthr" created="Thu, 7 Aug 2025 15:20:06 +0000"  >&lt;p&gt;Fixed in master: eef14cb8781ae06e53dedcd6848b1707b2081a17&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1x2io:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Casting to TIME type now consideres the correct precision (0-3). Casting incorrect strings to time (e.g. where the hour component is higher than 24) leads to a runtime exception now. Casting between BINARY and VARBINARY should now correctly consider the target length.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>