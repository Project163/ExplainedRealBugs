<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:57:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22329] Missing credentials in jobconf causes repeated authentication in Hive datasource</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22329</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Related Flink code: &lt;a href=&quot;https://github.com/apache/flink/blob/577113f0c339df844f2cc32b1d4a09d3da28085a/flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveSourceFileEnumerator.java#L107&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/577113f0c339df844f2cc32b1d4a09d3da28085a/flink-connectors/flink-connector-hive/src/main/java/org/apache/flink/connectors/hive/HiveSourceFileEnumerator.java#L107&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In this &lt;tt&gt;getSplits&lt;/tt&gt;&#160;method, it will call hadoop &lt;tt&gt;FileInputFormat&apos;s getSplits&lt;/tt&gt;&#160;method. related hadoop code is &lt;a href=&quot;https://github.com/apache/hadoop/blob/03cfc852791c14fad39db4e5b14104a276c08e59/hadoop-mapreduce-project/hadoop-mapreduce-client/hadoop-mapreduce-client-core/src/main/java/org/apache/hadoop/mapreduce/lib/input/FileInputFormat.java#L426&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;. Simple code is as follows&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Hadoop FileInputFormat
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; InputSplit[] getSplits(JobConf job, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numSplits)
  &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
  StopWatch sw = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StopWatch().start();
  FileStatus[] stats = listStatus(job);

 
  ......
}


&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; FileStatus[] listStatus(JobConf job) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
  Path[] dirs = getInputPaths(job);
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dirs.length == 0) {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;No input paths specified in job&quot;&lt;/span&gt;);
  }

  &lt;span class=&quot;code-comment&quot;&gt;// get tokens &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; all the required FileSystems..
&lt;/span&gt;  TokenCache.obtainTokensForNamenodes(job.getCredentials(), dirs, job);
  
  &lt;span class=&quot;code-comment&quot;&gt;// Whether we need to recursive look into the directory structure
&lt;/span&gt;
  ......
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;listStatus&lt;/tt&gt;&#160;method, it will obtain delegation tokens by calling&#160; &lt;tt&gt;TokenCache.obtainTokensForNamenodes&lt;/tt&gt; method. Howerver this method will give up to get delegation tokens when credentials in jobconf.&lt;/p&gt;

&lt;p&gt;So it&apos;s neccessary to inject current ugi credentials into jobconf.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Besides, when Flink support delegation tokens directly without keytab(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21700&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;refer to this PR&lt;/a&gt;), &lt;tt&gt;TokenCache.obtainTokensForNamenodes&lt;/tt&gt; will failed  without this patch because of no corresponding credentials.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13373197">FLINK-22329</key>
            <summary>Missing credentials in jobconf causes repeated authentication in Hive datasource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zuston">Junfan Zhang</assignee>
                                    <reporter username="zuston">Junfan Zhang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 17 Apr 2021 10:07:01 +0000</created>
                <updated>Sat, 28 Aug 2021 12:17:17 +0000</updated>
                            <resolved>Wed, 16 Jun 2021 06:12:30 +0000</resolved>
                                                    <fixVersion>1.14.0</fixVersion>
                                    <component>Connectors / Hive</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17324223" author="zuston" created="Sat, 17 Apr 2021 10:11:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt; Cloud you assign this task to me. Thanks&lt;/p&gt;</comment>
                            <comment id="17331459" author="zuston" created="Sun, 25 Apr 2021 08:52:05 +0000"  >&lt;p&gt;Gentle ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;. This PR will block Oozie integrate with Flink batch. Thanks ~&lt;/p&gt;</comment>
                            <comment id="17344497" author="zuston" created="Fri, 14 May 2021 09:37:41 +0000"  >&lt;p&gt;Update it, please review it again. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lirui&quot; class=&quot;user-hover&quot; rel=&quot;lirui&quot;&gt;lirui&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17364082" author="lirui" created="Wed, 16 Jun 2021 06:12:30 +0000"  >&lt;p&gt;Fixed in master: e461c7dd9615fa12fec8e158a9c201b17ab03ec3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0q4ts:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>