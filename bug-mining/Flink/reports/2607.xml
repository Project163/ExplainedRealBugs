<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10192] SQL Client table visualization mode does not update correctly</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10192</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The table visualization modes does not seem to update correctly.&lt;br/&gt;
When I run a query that groups and aggregates on a few (6) distinct keys, the client visualizes some keys multiple times. Also the aggregated values do not seem to be correct.&lt;br/&gt;
Due to the small number of keys, these get frequently updated.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13180234">FLINK-10192</key>
            <summary>SQL Client table visualization mode does not update correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="twalthr">Timo Walther</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 21 Aug 2018 15:27:38 +0000</created>
                <updated>Thu, 28 Feb 2019 13:49:17 +0000</updated>
                            <resolved>Tue, 28 Aug 2018 08:58:22 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Table SQL / API</component>
                    <component>Table SQL / Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16593493" author="githubbot" created="Mon, 27 Aug 2018 11:08:13 +0000"  >&lt;p&gt;twalthr opened a new pull request #6617: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10192&quot; title=&quot;SQL Client table visualization mode does not update correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10192&quot;&gt;&lt;del&gt;FLINK-10192&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;sql-client&amp;#93;&lt;/span&gt; Fix SQL Client table visualization mode&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6617&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This PR fixes the wrong materialization for the debugging visualization in table mode.&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Rework the caching mechanism in `MaterializedCollectStreamResult`.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Unit test added in `MaterializedCollectStreamResultTest`.&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? not applicable&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16594710" author="githubbot" created="Tue, 28 Aug 2018 08:43:08 +0000"  >&lt;p&gt;twalthr commented on issue #6617: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10192&quot; title=&quot;SQL Client table visualization mode does not update correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10192&quot;&gt;&lt;del&gt;FLINK-10192&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;sql-client&amp;#93;&lt;/span&gt; Fix SQL Client table visualization mode&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6617#issuecomment-416501203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6617#issuecomment-416501203&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thank you @fhueske. Merging...&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16594719" author="githubbot" created="Tue, 28 Aug 2018 08:51:37 +0000"  >&lt;p&gt;asfgit closed pull request #6617: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10192&quot; title=&quot;SQL Client table visualization mode does not update correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10192&quot;&gt;&lt;del&gt;FLINK-10192&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;sql-client&amp;#93;&lt;/span&gt; Fix SQL Client table visualization mode&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6617&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6617&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-libraries/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/TypedResult.java b/flink-libraries/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/TypedResult.java&lt;br/&gt;
index ee4e8d3ff10..6ef8ef33074 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/TypedResult.java&lt;br/&gt;
+++ b/flink-libraries/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/TypedResult.java&lt;br/&gt;
@@ -18,6 +18,8 @@&lt;/p&gt;

&lt;p&gt; package org.apache.flink.table.client.gateway;&lt;/p&gt;

&lt;p&gt;+import java.util.Objects;&lt;br/&gt;
+&lt;br/&gt;
 /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Result with an attached type (actual payload, EOS, etc.).&lt;br/&gt;
  *&lt;br/&gt;
@@ -55,6 +57,23 @@ public String toString() 
{
 		return &quot;TypedResult&amp;lt;&quot; + type + &quot;&amp;gt;&quot;;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+	@Override&lt;br/&gt;
+	public boolean equals(Object o) {&lt;br/&gt;
+		if (this == o) &lt;/p&gt;
{
+			return true;
+		}
&lt;p&gt;+		if (o == null || getClass() != o.getClass()) &lt;/p&gt;
{
+			return false;
+		}
&lt;p&gt;+		TypedResult&amp;lt;?&amp;gt; that = (TypedResult&amp;lt;?&amp;gt;) o;&lt;br/&gt;
+		return type == that.type &amp;amp;&amp;amp; Objects.equals(payload, that.payload);&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	@Override&lt;br/&gt;
+	public int hashCode() &lt;/p&gt;
{
+		return Objects.hash(type, payload);
+	}
&lt;p&gt;+&lt;br/&gt;
 	// --------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 	public static &amp;lt;T&amp;gt; TypedResult&amp;lt;T&amp;gt; empty() {&lt;br/&gt;
diff --git a/flink-libraries/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/local/result/MaterializedCollectStreamResult.java b/flink-libraries/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/local/result/MaterializedCollectStreamResult.java&lt;br/&gt;
index 7321bd0b35a..45c4f7553c6 100644&lt;br/&gt;
&amp;#8212; a/flink-libraries/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/local/result/MaterializedCollectStreamResult.java&lt;br/&gt;
+++ b/flink-libraries/flink-sql-client/src/main/java/org/apache/flink/table/client/gateway/local/result/MaterializedCollectStreamResult.java&lt;br/&gt;
@@ -39,10 +39,20 @@&lt;br/&gt;
 public class MaterializedCollectStreamResult&amp;lt;C&amp;gt; extends CollectStreamResult&amp;lt;C&amp;gt; implements MaterializedResult&amp;lt;C&amp;gt; {&lt;/p&gt;

&lt;p&gt; 	private final List&amp;lt;Row&amp;gt; materializedTable;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final Map&amp;lt;Row, List&amp;lt;Integer&amp;gt;&amp;gt; rowPositions; // positions of rows in table for faster access&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Caches the last row position for faster access. The position might not be exact (if rows&lt;br/&gt;
+	 * with smaller position are deleted) nor complete (for deletes of duplicates). However, the&lt;br/&gt;
+	 * cache narrows the search in the materialized table.&lt;br/&gt;
+	 */&lt;br/&gt;
+	private final Map&amp;lt;Row, Integer&amp;gt; rowPositionCache;&lt;br/&gt;
+&lt;br/&gt;
 	private final List&amp;lt;Row&amp;gt; snapshot;&lt;br/&gt;
+&lt;br/&gt;
 	private int pageCount;&lt;br/&gt;
+&lt;br/&gt;
 	private int pageSize;&lt;br/&gt;
+&lt;br/&gt;
 	private boolean isLastSnapshot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	public MaterializedCollectStreamResult(TypeInformation&amp;lt;Row&amp;gt; outputType, ExecutionConfig config,&lt;br/&gt;
@@ -51,7 +61,7 @@ public MaterializedCollectStreamResult(TypeInformation&amp;lt;Row&amp;gt; outputType, Executio&lt;/p&gt;

&lt;p&gt; 		// prepare for materialization&lt;br/&gt;
 		materializedTable = new ArrayList&amp;lt;&amp;gt;();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;rowPositions = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
+		rowPositionCache = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
 		snapshot = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
 		isLastSnapshot = false;&lt;br/&gt;
 		pageCount = 0;&lt;br/&gt;
@@ -101,32 +111,29 @@ else if (!isRetrieving()) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
 	protected void processRecord(Tuple2&amp;lt;Boolean, Row&amp;gt; change) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// we track the position of rows for faster access and in order to return consistent&lt;/li&gt;
	&lt;li&gt;// snapshots where new rows are appended at the end&lt;br/&gt;
 		synchronized (resultLock) {&lt;/li&gt;
	&lt;li&gt;final List&amp;lt;Integer&amp;gt; positions = rowPositions.get(change.f1);&lt;br/&gt;
-&lt;br/&gt;
+			final Row row = change.f1;&lt;br/&gt;
 			// insert&lt;br/&gt;
 			if (change.f0) {&lt;/li&gt;
	&lt;li&gt;materializedTable.add(change.f1);&lt;/li&gt;
	&lt;li&gt;if (positions == null) 
{
-					// new row
-					final ArrayList&amp;lt;Integer&amp;gt; pos = new ArrayList&amp;lt;&amp;gt;(1);
-					pos.add(materializedTable.size() - 1);
-					rowPositions.put(change.f1, pos);
-				}
&lt;p&gt; else &lt;/p&gt;
{
-					// row exists already, only add position
-					positions.add(materializedTable.size() - 1);
-				}
&lt;p&gt;+				materializedTable.add(row);&lt;br/&gt;
+				rowPositionCache.put(row, materializedTable.size() - 1);&lt;br/&gt;
 			}&lt;br/&gt;
 			// delete&lt;br/&gt;
 			else {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (positions != null) {&lt;/li&gt;
	&lt;li&gt;// delete row position and row itself&lt;/li&gt;
	&lt;li&gt;final int pos = positions.remove(positions.size() - 1);&lt;/li&gt;
	&lt;li&gt;materializedTable.remove(pos);&lt;/li&gt;
	&lt;li&gt;if (positions.isEmpty()) {&lt;/li&gt;
	&lt;li&gt;rowPositions.remove(change.f1);&lt;br/&gt;
+				// delete the newest record first to minimize per-page changes&lt;br/&gt;
+				final Integer cachedPos = rowPositionCache.get(row);&lt;br/&gt;
+				final int startSearchPos;&lt;br/&gt;
+				if (cachedPos != null) 
{
+					startSearchPos = Math.min(cachedPos, materializedTable.size() - 1);
+				}
&lt;p&gt; else &lt;/p&gt;
{
+					startSearchPos = materializedTable.size() - 1;
+				}
&lt;p&gt;+&lt;br/&gt;
+				for (int i = startSearchPos; i &amp;gt;= 0; i--) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+					if (materializedTable.get(i).equals(row)) {
+						materializedTable.remove(i);
+						rowPositionCache.remove(row);
+						break;
 					} 				}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; 			}&lt;br/&gt;
diff --git a/flink-libraries/flink-sql-client/src/test/java/org/apache/flink/table/client/gateway/local/result/MaterializedCollectStreamResultTest.java b/flink-libraries/flink-sql-client/src/test/java/org/apache/flink/table/client/gateway/local/result/MaterializedCollectStreamResultTest.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..c7e41ffe111&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;/dev/null&lt;br/&gt;
+++ b/flink-libraries/flink-sql-client/src/test/java/org/apache/flink/table/client/gateway/local/result/MaterializedCollectStreamResultTest.java&lt;br/&gt;
@@ -0,0 +1,114 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one&lt;br/&gt;
+ * or more contributor license agreements.  See the NOTICE file&lt;br/&gt;
+ * distributed with this work for additional information&lt;br/&gt;
+ * regarding copyright ownership.  The ASF licenses this file&lt;br/&gt;
+ * to you under the Apache License, Version 2.0 (the&lt;br/&gt;
+ * &quot;License&quot;); you may not use this file except in compliance&lt;br/&gt;
+ * with the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *     &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.table.client.gateway.local.result;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.api.common.ExecutionConfig;&lt;br/&gt;
+import org.apache.flink.api.common.typeinfo.TypeInformation;&lt;br/&gt;
+import org.apache.flink.api.common.typeinfo.Types;&lt;br/&gt;
+import org.apache.flink.api.java.tuple.Tuple2;&lt;br/&gt;
+import org.apache.flink.table.client.gateway.TypedResult;&lt;br/&gt;
+import org.apache.flink.types.Row;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.net.InetAddress;&lt;br/&gt;
+import java.net.UnknownHostException;&lt;br/&gt;
+import java.util.Collections;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Tests for 
{@link MaterializedCollectStreamResult}
&lt;p&gt;.&lt;br/&gt;
+ */&lt;br/&gt;
+public class MaterializedCollectStreamResultTest {&lt;br/&gt;
+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testSnapshot() throws UnknownHostException {&lt;br/&gt;
+		final TypeInformation&amp;lt;Row&amp;gt; type = Types.ROW(Types.STRING, Types.LONG);&lt;br/&gt;
+&lt;br/&gt;
+		TestMaterializedCollectStreamResult result = null;&lt;br/&gt;
+		try &lt;/p&gt;
{
+			result = new TestMaterializedCollectStreamResult(
+				type,
+				new ExecutionConfig(),
+				InetAddress.getLocalHost(),
+				0);
+
+			result.isRetrieving = true;
+
+			result.processRecord(Tuple2.of(true, Row.of(&quot;A&quot;, 1)));
+			result.processRecord(Tuple2.of(true, Row.of(&quot;B&quot;, 1)));
+			result.processRecord(Tuple2.of(true, Row.of(&quot;A&quot;, 1)));
+			result.processRecord(Tuple2.of(true, Row.of(&quot;C&quot;, 2)));
+
+			assertEquals(TypedResult.payload(4), result.snapshot(1));
+
+			assertEquals(Collections.singletonList(Row.of(&quot;A&quot;, 1)), result.retrievePage(1));
+			assertEquals(Collections.singletonList(Row.of(&quot;B&quot;, 1)), result.retrievePage(2));
+			assertEquals(Collections.singletonList(Row.of(&quot;A&quot;, 1)), result.retrievePage(3));
+			assertEquals(Collections.singletonList(Row.of(&quot;C&quot;, 2)), result.retrievePage(4));
+
+			result.processRecord(Tuple2.of(false, Row.of(&quot;A&quot;, 1)));
+
+			assertEquals(TypedResult.payload(3), result.snapshot(1));
+
+			assertEquals(Collections.singletonList(Row.of(&quot;A&quot;, 1)), result.retrievePage(1));
+			assertEquals(Collections.singletonList(Row.of(&quot;B&quot;, 1)), result.retrievePage(2));
+			assertEquals(Collections.singletonList(Row.of(&quot;C&quot;, 2)), result.retrievePage(3));
+
+			result.processRecord(Tuple2.of(false, Row.of(&quot;C&quot;, 2)));
+			result.processRecord(Tuple2.of(false, Row.of(&quot;A&quot;, 1)));
+
+			assertEquals(TypedResult.payload(1), result.snapshot(1));
+
+			assertEquals(Collections.singletonList(Row.of(&quot;B&quot;, 1)), result.retrievePage(1));
+		}
&lt;p&gt; finally &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			if (result != null) {
+				result.close();
+			}+		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+	}&lt;br/&gt;
+&lt;br/&gt;
+	// --------------------------------------------------------------------------------------------&lt;br/&gt;
+	// Helper classes&lt;br/&gt;
+	// --------------------------------------------------------------------------------------------&lt;br/&gt;
+&lt;br/&gt;
+	private static class TestMaterializedCollectStreamResult extends MaterializedCollectStreamResult &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {++		public boolean isRetrieving;++		public TestMaterializedCollectStreamResult(+				TypeInformation&amp;lt;Row&amp;gt; outputType,+				ExecutionConfig config,+				InetAddress gatewayAddress,+				int gatewayPort) {
+
+			super(
+				outputType,
+				config,
+				gatewayAddress,
+				gatewayPort);
+		}++		@Override+		protected boolean isRetrieving() {
+			return isRetrieving;
+		}+	}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+}&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16594721" author="twalthr" created="Tue, 28 Aug 2018 08:58:22 +0000"  >&lt;p&gt;Fixed in 1.7.0: d78bb60715044077eb4267ad4b171616e94d90e3&lt;br/&gt;
Fixed in 1.6.1: baa1a2a8f79f907cc89033c7ccbbd675dae68839&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x9lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>