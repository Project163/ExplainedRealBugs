<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:46:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17918] LIMIT queries are failed when adding sleeping time of async checkpoint</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17918</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When we change the timing of operations (sleep after emit first record and sleep for async operation of checkpoint) with this &lt;a href=&quot;https://github.com/apache/flink/commit/c05a0d865989c9959047cebcf2cd68b3838cc699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt;, the test &lt;tt&gt;org.apache.flink.table.planner.runtime.stream.sql.AggregateITCase#testDifferentTypesSumWithRetract&lt;/tt&gt; in flink-table-planner-blink is failed. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13307160">FLINK-17918</key>
            <summary>LIMIT queries are failed when adding sleeping time of async checkpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jark">Jark Wu</assignee>
                                    <reporter username="pnowojski">Piotr Nowojski</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 25 May 2020 07:31:39 +0000</created>
                <updated>Tue, 22 Jun 2021 13:55:47 +0000</updated>
                            <resolved>Thu, 4 Jun 2020 10:30:28 +0000</resolved>
                                    <version>1.11.0</version>
                                    <fixVersion>1.11.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                    <component>Table SQL / Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>17</watches>
                                                                                                                <comments>
                            <comment id="17115815" author="gyfora" created="Mon, 25 May 2020 08:11:48 +0000"  >&lt;p&gt;Should this be a blocker for 1.11?&lt;/p&gt;</comment>
                            <comment id="17115923" author="pnowojski" created="Mon, 25 May 2020 10:43:52 +0000"  >&lt;p&gt;We are still evaluating the issue (it&apos;s extremely difficult to debug this issue, as neither me nor &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjwang&quot; class=&quot;user-hover&quot; rel=&quot;zjwang&quot;&gt;zjwang&lt;/a&gt; were able to reproduce it locally after couple days of trying), but  it looks like it&apos;s only limited to two input operators - if that&apos;s the case, we can always support unaligned checkpoints only for one input operators in 1.11. That&apos;s why I created it as CRITICAL.&lt;/p&gt;

&lt;p&gt;But I guess either way, this indeed should be a blocker &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gyfora&quot; class=&quot;user-hover&quot; rel=&quot;gyfora&quot;&gt;gyfora&lt;/a&gt;. If we decide to limit support to one input operators, we still need to at least verify it this upon job submission.&lt;/p&gt;</comment>
                            <comment id="17120870" author="pnowojski" created="Mon, 1 Jun 2020 09:11:48 +0000"  >&lt;p&gt;Some status update. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt; has added quite a big of debug messages, focusing on:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.apache.flink.table.planner.runtime.stream.sql.AggregateITCase#testDifferentTypesSumWithRetract&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;This test is fairly reliably failing locally with unaligned checkpoints enabled by default after 2-15 minutes, when running the following command (&lt;br/&gt;
Sometimes you might need to bump fork counts or number of parallel iterations (for loop)):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;for i in {0..7}; do mvn -Dlog4j.configurationFile=/Users/arv/workspace/flink/flink-table/flink-table-planner-blink/src/test/resources/log4j2-test.properties -Dflink.forkCount=1 -Dflink.forkCountTestPackage=1 -Dfast -Dflink.tests.with-openssl -Dhadoop.version=2.8.3 -Dinclude_hadoop_aws -Dscala-2.11 -pl flink-table/flink-table-planner-blink integration-test -Dtest=org.apache.flink.table.planner.runtime.stream.sql.AggregateITCase$testDifferentTypesSumWithRetract &amp;amp;&amp;gt;test_$i.txt &amp;amp; done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After adding a lot of debug messages &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt; pinpointed a problem to the following scenario. Somehow during async part of checkpointing, blink operator (in the case that we are debugging it&#8217;s &lt;tt&gt;AppendOnlyTopNFunction&lt;/tt&gt; implementation of &lt;tt&gt;LIMIT&lt;/tt&gt; operation) is checkpointing too many records.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Upstream source task is sending: &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;record1, chk1, record2, record3, record4&amp;#93;&lt;/span&gt;&lt;/tt&gt;. Downstream &lt;tt&gt;LIMIT&lt;/tt&gt; is receiving them in this order&lt;/li&gt;
	&lt;li&gt;only record1 is processed&lt;/li&gt;
	&lt;li&gt;sync part of checkpoint chk1 completes&lt;/li&gt;
	&lt;li&gt;AFTER that &lt;tt&gt;LIMIT&lt;/tt&gt; is processing &lt;tt&gt;record2, record3, record4&lt;/tt&gt;...&lt;/li&gt;
	&lt;li&gt;.. but somehow async operation of checkpoint is ending up writing a state as if all of the records were processed. Including &lt;tt&gt;record2, record3, record4&lt;/tt&gt;, which shouldn&#8217;t be part of the checkpoint 1 for &lt;tt&gt;LIMIT&lt;/tt&gt; operator&#8217;s state.&lt;/li&gt;
	&lt;li&gt;failure happens&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;LIMIT&lt;/tt&gt; operator is restoring with 4 records on the state but ...&lt;/li&gt;
	&lt;li&gt;source is correctly re-emitting the records &lt;tt&gt;record2, record3, record4&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;This means LIMIT operator is reaching it&#8217;s limit 3 records sooner, and last 3 expected records are lost.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The same failure can be induced with &lt;b&gt;aligned checkpoints&lt;/b&gt; by altering a timing of the operations (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt;? adding a 100ms sleep after emitting first record and adding 100ms sleep in async part of the checkpointing operation). Currently on the master this issue is not visible because (quoting &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt;)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;FailingDataSource is currently only failing at source if half elements are emitted AND a subsequent checkpoint happened. So with aligned the issue is never visible.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="17120902" author="ykt836" created="Mon, 1 Jun 2020 09:53:28 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17120903" author="ykt836" created="Mon, 1 Jun 2020 09:55:19 +0000"  >&lt;p&gt;From above comment, it seems that the problem is caused by &lt;b&gt;step 5&lt;/b&gt; (the checkpoint&amp;amp;state is inconsistent with stream operators)?&lt;/p&gt;</comment>
                            <comment id="17120968" author="arvid" created="Mon, 1 Jun 2020 12:10:14 +0000"  >&lt;p&gt;Yes &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ykt836&quot; class=&quot;user-hover&quot; rel=&quot;ykt836&quot;&gt;ykt836&lt;/a&gt; . I&apos;m suspecting that during &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/runtime/operators/rank/AppendOnlyTopNFunction.java#L116&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;updating the state of Limit&lt;/a&gt;, we add a mutable list as the value, such that after the state is being snapshotted, the value is still mutable.&lt;/p&gt;

&lt;p&gt;Thus, when the value is actually being serialized in the background, there may have been updates to the list by task thread.&lt;/p&gt;

&lt;p&gt;I&apos;m assuming a conservative fix is to add a copy of the list as the value. Alternatively, I guess we could also use a keyed list state, but I&apos;m not very knowledgable about states.&lt;/p&gt;</comment>
                            <comment id="17120974" author="arvid" created="Mon, 1 Jun 2020 12:16:50 +0000"  >&lt;p&gt;Btw see this &lt;a href=&quot;https://github.com/apache/flink/commit/c05a0d865989c9959047cebcf2cd68b3838cc699&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt; for changes in the test setup, which reliably reproduces the failure on my end. These values were especially tweaked for org.apache.flink.table.planner.runtime.stream.sql.AggregateITCase#testDifferentTypesSumWithRetract in flink-table-planner-blink.&lt;/p&gt;</comment>
                            <comment id="17121031" author="pnowojski" created="Mon, 1 Jun 2020 13:55:17 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt; is right. We are mutating the list that&apos;s used in the state field &lt;tt&gt;AppendOnlyTopNFunction#dataState&lt;/tt&gt; &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/runtime/operators/rank/AppendOnlyTopNFunction.java#L113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here in the line 113&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Someone could correct me if I&apos;m wrong, I do not know the guarantees of our state backends very well, but via looking at the relevant code there is an assumption, that sync part of checkpoint should do all of the defensive copies/protections from making sure of &quot;freezeing&quot; state snapshot for later IO operations. This seems to be confirmed by the java doc above &lt;tt&gt;org.apache.flink.runtime.state.heap.CopyOnWriteStateMap#stateSnapshot&lt;/tt&gt; (it&apos;s being invoked in sync checkpoint part for the &lt;tt&gt;AppendOnlyTopNFunction#dataState&lt;/tt&gt; field):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	/**
	 * Creates a snapshot of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; {@link CopyOnWriteStateMap}, to be written in checkpointing. The snapshot integrity
	 * is &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; through copy-on-write from the {@link CopyOnWriteStateMap}. Users should call
	 * {@link #releaseSnapshot(StateMapSnapshot)} after using the returned object.
	 *
	 * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; a snapshot from &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; {@link CopyOnWriteStateMap}, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; checkpointing.
	 */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but in the &lt;tt&gt;org.apache.flink.runtime.state.heap.CopyOnWriteStateMap#snapshotMapArrays&lt;/tt&gt; we are only marking whole &lt;tt&gt;StateMapEntry&lt;/tt&gt; (the type of &lt;tt&gt;AppendOnlyTopNFunction#dataState&lt;/tt&gt; is  &lt;tt&gt;MapState&amp;lt;RowData, List&amp;lt;RowData&amp;gt;&amp;gt;&lt;/tt&gt;. Nothing more. So the defensive copy-on-write works only as long, as someone else is not updating the referenced structures (like the &lt;tt&gt;List&amp;lt;RowData&amp;gt;&lt;/tt&gt; in the background.&lt;/p&gt;</comment>
                            <comment id="17121526" author="jark" created="Tue, 2 Jun 2020 03:23:23 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt; for the investigating. After discussing with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yunta&quot; class=&quot;user-hover&quot; rel=&quot;yunta&quot;&gt;yunta&lt;/a&gt; pointed that user should take care of deep copying when using heap statebackend, the Javadoc of CopyOnWriteStateMap says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;IMPORTANT: the contracts for this class rely on the user not holding any references to objects returned by this map&lt;br/&gt;
beyond the life cycle of per-element operations. Or phrased differently, all get-update-put operations on a mapping&lt;br/&gt;
should be within one call of processElement. Otherwise, the user must take care of taking deep copies, e.g. for&lt;br/&gt;
caching purposes.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;However, I didn&apos;t find the note on the documentation. If this is true, I think we should update documentation and update the &lt;tt&gt;AppendOnlyTopNFunction&lt;/tt&gt; to put the copied list into &lt;tt&gt;dataState&lt;/tt&gt; (and this will bring additional cost for RocksDB statebackend). We should also go through all the other operators.&lt;/p&gt;

&lt;p&gt;Besides of this, I can also reproduce the failure of &lt;tt&gt;AggregateITCase#testDifferentTypesSumWithRetract&lt;/tt&gt; with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt;&apos;s commit. But I think this maybe another issue, because the simplest case &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;LocalGlobal=OFF, MiniBatch=OFF, StateBackend=HEAP&amp;#93;&lt;/span&gt;&quot; which uses &lt;tt&gt;GroupAggFunction&lt;/tt&gt; will also fail. In the &lt;tt&gt;GroupAggFunction&lt;/tt&gt;, all the &lt;tt&gt;accumulators&lt;/tt&gt; of &lt;a href=&quot;https://github.com/apache/flink/blob/4ff59a72b4c8532510cca349840fcbe668de911e/flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/runtime/operators/aggregate/GroupAggFunction.java#L179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;accState.update(accumulators)&lt;/tt&gt;&lt;/a&gt; is always a new object.&lt;/p&gt;</comment>
                            <comment id="17121532" author="carp84" created="Tue, 2 Jun 2020 03:37:22 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, I was about to add the same comments, that the observed behavior of `CopyOnWriteStateMap` is by design.&lt;/p&gt;

&lt;p&gt;Actually this condition (don&apos;t hold the reference and further modifying the object beyond `processElement`) applies to all kinds of `StateTable` for `HeapKeyedStateBackend`, and is the source of performance gain (data kept on heap in object format w/o serialization/deserialization or any similar op like deep copy) for heap backend. And a big +1 to explicitly write this down in our document.&lt;/p&gt;</comment>
                            <comment id="17123375" author="pnowojski" created="Tue, 2 Jun 2020 06:12:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;But I think this maybe another issue, because the simplest case &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;LocalGlobal=OFF, MiniBatch=OFF, StateBackend=HEAP&amp;#93;&lt;/span&gt;&quot; which uses GroupAggFunction will also fail. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Why do you think this combination should work fine? If the problem is with &lt;tt&gt;AppendOnlyTopNFunction&lt;/tt&gt; introduced by:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;SELECT *, CAST(c AS DECIMAL(3, 2)) AS h FROM T LIMIT 8
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then it should happen always, right?&lt;/p&gt;</comment>
                            <comment id="17123385" author="arvid" created="Tue, 2 Jun 2020 06:25:30 +0000"  >&lt;p&gt;Yes, the root cause is &lt;tt&gt;LIMIT&lt;/tt&gt; swallowing up some tail records because it saw the first records two times effectively. Since LIMIT is used in many tests (I guess for correctly working retract streams, but I haven&apos;t understood it entirely), many tests are currently prone to fail.&lt;/p&gt;

&lt;p&gt;On a side-note, I&apos;d keep the change in my commit on the &lt;tt&gt;FailingDataSource&lt;/tt&gt; that fails after at least one element was checkpointed (ofc remove all timing related changes). The current way effectively drains all records before triggering the crash, which will hide quite a lot of failures like this one.&lt;/p&gt;</comment>
                            <comment id="17123447" author="yunta" created="Tue, 2 Jun 2020 07:34:24 +0000"  >&lt;p&gt;As far as I know, most users would choose RocksDB as state backend on production environment and that might explain why even we do not talk about the limit in documentation, it seems no user has ever reported similar problem. &lt;br/&gt;
I have created related issue &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18060&quot; title=&quot;Add notice for heap-based state backend of state access reference problem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18060&quot;&gt;&lt;del&gt;FLINK-18060&lt;/del&gt;&lt;/a&gt; to add notice about this limitation.&lt;/p&gt;</comment>
                            <comment id="17123491" author="jark" created="Tue, 2 Jun 2020 08:19:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; Oh, sorry I didn&apos;t notice the inner LIMIT in the query (tests are migrated from blink code). Then I think you are right, the root cause is in &lt;tt&gt;AppendOnlyTopNFunction&lt;/tt&gt;. I can help to prepare a pull request for this. &lt;/p&gt;

&lt;p&gt;But I still can&apos;t understand why the join IT cases are failed, the join cases doesn&apos;t contain LIMIT and the join operators doesn&apos;t mutate values in state. &lt;/p&gt;</comment>
                            <comment id="17123503" author="arvid" created="Tue, 2 Jun 2020 08:32:32 +0000"  >&lt;p&gt;I fear that these errors are independent, but could be related to recovery as well.&lt;/p&gt;

&lt;p&gt;But we also have issues with watermarks in unaligned checkpoints (not sure if they are used in the failing join tests).&lt;/p&gt;</comment>
                            <comment id="17123696" author="jark" created="Tue, 2 Jun 2020 12:04:37 +0000"  >&lt;p&gt;No, all the failed join tests do not use watermarks. &lt;/p&gt;</comment>
                            <comment id="17124941" author="pnowojski" created="Wed, 3 Jun 2020 13:11:11 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; you are right, we have also checked the remaining tests with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt; yesterday and it seems there is at least one more bug. Probably on our side that indeed has something to do with the two input operators. Anyway, let&apos;s split the issues and use this ticket for solving the `LIMIT`, we can create new tickets for the remaining issues.&lt;/p&gt;</comment>
                            <comment id="17125109" author="arvid" created="Wed, 3 Jun 2020 16:32:17 +0000"  >&lt;p&gt;The ticket originally was &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17918&quot; title=&quot;LIMIT queries are failed when adding sleeping time of async checkpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17918&quot;&gt;&lt;del&gt;FLINK-17918&lt;/del&gt;&lt;/a&gt; Jobs with two input operators are loosing data with unaligned checkpoints&quot; and indeed the test failures in the description are caused in unaligned checkpoint code.&lt;br/&gt;
Discovering the LIMIT bug was more or less just a byproduct apparently.&lt;br/&gt;
Since there is already a PR for LIMIT under &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17918&quot; title=&quot;LIMIT queries are failed when adding sleeping time of async checkpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17918&quot;&gt;&lt;del&gt;FLINK-17918&lt;/del&gt;&lt;/a&gt;, I guess we should fork out a new ticket and update the description of this ticket to only mention LIMIT.&lt;/p&gt;</comment>
                            <comment id="17125637" author="jark" created="Thu, 4 Jun 2020 07:44:34 +0000"  >&lt;p&gt;FYI, I have updated the title and description of this issue and forked out a new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18118&quot; title=&quot;Some SQL Jobs with two input operators are loosing data with unaligned checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18118&quot;&gt;&lt;del&gt;FLINK-18118&lt;/del&gt;&lt;/a&gt; for the remaining problems.&lt;/p&gt;</comment>
                            <comment id="17125797" author="jark" created="Thu, 4 Jun 2020 10:30:28 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table-planner-blink&amp;#93;&lt;/span&gt; Store last watermark in state to emit on recovery for EventTimeProcessOperator&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master (1.12.0): 550d4e168bdf068b2c4eadd51878abaa98f0bb3c&lt;/li&gt;
	&lt;li&gt;1.11.0: 7c72335a3dbf2a8de7469d2bef8074d1e33284c9&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-17918&quot; title=&quot;LIMIT queries are failed when adding sleeping time of async checkpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-17918&quot;&gt;&lt;del&gt;FLINK-17918&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;table-blink&amp;#93;&lt;/span&gt; Fix AppendOnlyTopNFunction shouldn&apos;t mutate list value of MapState&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master (1.12.0): 5ab403dafa3bc5ee8654173fb543969dfdd746f8&lt;/li&gt;
	&lt;li&gt;1.11.0: a290c8a3af4083fb32febfc7f955a9bdce08e4b8&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13309375">FLINK-18118</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13308889">FLINK-18060</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0f4bk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>