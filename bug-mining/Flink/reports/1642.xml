<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6341] JobManager can go to definite message sending loop when TaskManager registered</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6341</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When TaskManager register to JobManager, JM will send a &quot;NotifyResourceStarted&quot; message to kick off Resource Manager, then trigger a reconnection to resource manager through sending a &quot;TriggerRegistrationAtJobManager&quot;.&lt;/p&gt;

&lt;p&gt;When the ref of resource manager in JobManager is not None and the reconnection is to same resource manager, JobManager will go to a infinite message sending loop which will always sending himself a &quot;ReconnectResourceManager&quot; every 2 seconds.&lt;/p&gt;

&lt;p&gt;We have already observed that phonomenon. More details, check how JobManager handles `ReconnectResourceManager`.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13065511">FLINK-6341</key>
            <summary>JobManager can go to definite message sending loop when TaskManager registered</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="WangTao">Tao Wang</assignee>
                                    <reporter username="WangTao">Tao Wang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Apr 2017 12:25:47 +0000</created>
                <updated>Thu, 28 Feb 2019 14:01:08 +0000</updated>
                            <resolved>Fri, 28 Apr 2017 16:12:34 +0000</resolved>
                                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15976609" author="githubbot" created="Thu, 20 Apr 2017 12:34:31 +0000"  >&lt;p&gt;GitHub user WangTaoTheTonic opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6341&quot; title=&quot;JobManager can go to definite message sending loop when TaskManager registered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6341&quot;&gt;&lt;del&gt;FLINK-6341&lt;/del&gt;&lt;/a&gt;Don&apos;t let JM fall into infinite loop&lt;/p&gt;

&lt;p&gt;    When TaskManager register to JobManager, JM will send a &quot;NotifyResourceStarted&quot; message to kick off Resource Manager, then trigger a reconnection to resource manager through sending a &quot;TriggerRegistrationAtJobManager&quot;.&lt;br/&gt;
    When the ref of resource manager in JobManager is not None and the reconnection is to same resource manager, JobManager will go to a infinite message sending loop which will always sending himself a &quot;ReconnectResourceManager&quot; every 2 seconds.&lt;br/&gt;
    We have already observed that phonomenon. More details, check how JobManager handles `ReconnectResourceManager`.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/WangTaoTheTonic/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/WangTaoTheTonic/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6341&quot; title=&quot;JobManager can go to definite message sending loop when TaskManager registered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6341&quot;&gt;&lt;del&gt;FLINK-6341&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3745&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8eb4dd42a71d9830c91b3db824e3133ce3d35c08&lt;br/&gt;
Author: WangTaoTheTonic &amp;lt;wangtao111@huawei.com&amp;gt;&lt;br/&gt;
Date:   2017-04-20T12:28:10Z&lt;/p&gt;

&lt;p&gt;    Don&apos;t let JM fall into infinite loop&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15976712" author="githubbot" created="Thu, 20 Apr 2017 13:44:58 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for spotting the problem @WangTaoTheTonic. This is important to fix.&lt;/p&gt;

&lt;p&gt;    I think we cannot solve the problem as you&apos;ve done it, because you access actor state from outside of the actor&apos;s main thread. I think it would be better to introduce a resource manager connection id which we can use to distinguish whether we have to reconnect from a resource manager or whether it is an outdated `ReconnectResourceManager` message. We can do the check then in the handler for the `ReconnectResourceManager` message.&lt;/p&gt;</comment>
                            <comment id="15976714" author="githubbot" created="Thu, 20 Apr 2017 13:45:25 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745#discussion_r112456827&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745#discussion_r112456827&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -356,7 +356,12 @@ class JobManager(&lt;br/&gt;
             msg.resourceManager() ! decorateMessage(new TriggerRegistrationAtJobManager(self))&lt;br/&gt;
             // try again after some delay&lt;br/&gt;
             context.system.scheduler.scheduleOnce(2 seconds) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;self ! decorateMessage(msg)&lt;br/&gt;
    +          currentResourceManager match {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This access is problematic, because we&apos;re accessing actor state from within another thread.&lt;/p&gt;</comment>
                            <comment id="15980686" author="githubbot" created="Mon, 24 Apr 2017 03:39:17 +0000"  >&lt;p&gt;Github user WangTaoTheTonic commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @tillrohrmann What problem it will bring if we access `currentResourceManager` from another thread? It is a variable in JobManager and can be shared across multi threads, right? The new added code just read it and there&apos;s no cocurrency problem coming, i think.&lt;/p&gt;</comment>
                            <comment id="15980967" author="githubbot" created="Mon, 24 Apr 2017 10:18:15 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It is a problem because, the `currentResourceManager` is not volatile. Thus, you might miss some state changes in the future callback because of a cached value. Moreover, accessing mutable actor state from a different thread breaks the actor encapsulation and can lead to subtle race conditions and other synchronization bugs.&lt;/p&gt;</comment>
                            <comment id="15981090" author="githubbot" created="Mon, 24 Apr 2017 12:30:30 +0000"  >&lt;p&gt;Github user WangTaoTheTonic commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I see. Connection ID is added, please check if it&apos;s ok &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15988599" author="githubbot" created="Fri, 28 Apr 2017 10:23:07 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for your contribution @WangTaoTheTonic. Changes look good to me. Merging your PR.&lt;/p&gt;</comment>
                            <comment id="15989088" author="till.rohrmann" created="Fri, 28 Apr 2017 16:12:34 +0000"  >&lt;p&gt;Fixed via 238383926b762c1d47159a2b4dabe8fd59777307&lt;/p&gt;</comment>
                            <comment id="15989090" author="githubbot" created="Fri, 28 Apr 2017 16:13:23 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3745&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dv7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>