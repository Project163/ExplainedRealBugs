<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:24:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4207] WindowOperator becomes very slow with allowed lateness</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4207</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In this simple example the throughput (as measured by the count the window emits) becomes very low when an allowed lateness is set:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;WindowWordCount {

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();
		env.setStreamTimeCharacteristic(TimeCharacteristic.IngestionTime);
		env.setParallelism(1);

		env.addSource(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InfiniteTupleSource(100_000))
				.keyBy(0)
				.timeWindow(Time.seconds(3))
				.allowedLateness(Time.seconds(1))
				.reduce(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ReduceFunction&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt;() {
					@Override
					&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; reduce(Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; value1,
							Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; value2) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
						&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Tuple2.of(value1.f0, value1.f1 + value2.f1);
					}
				})
				.filter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FilterFunction&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt;() {
					&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; serialVersionUID = 1L;

					@Override
					&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; filter(Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; value) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
						&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value.f0.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;Tuple 0&quot;&lt;/span&gt;);
					}
				})
				.print();

		&lt;span class=&quot;code-comment&quot;&gt;// execute program
&lt;/span&gt;		env.execute(&lt;span class=&quot;code-quote&quot;&gt;&quot;WindowWordCount&quot;&lt;/span&gt;);
	}

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;InfiniteTupleSource &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ParallelSourceFunction&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; {
		&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; serialVersionUID = 1L;

		&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numGroups;

		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; InfiniteTupleSource(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numGroups) {
			&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.numGroups = numGroups;
		}

		@Override
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run(SourceContext&amp;lt;Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; out) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
			&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; index = 0;
			&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
				Tuple2&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; tuple = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tuple2&amp;lt;&amp;gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;Tuple &quot;&lt;/span&gt; + (index % numGroups), 1);
				out.collect(tuple);
				index++;
			}
		}

		@Override
		&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cancel() {
		}
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12989053">FLINK-4207</key>
            <summary>WindowOperator becomes very slow with allowed lateness</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkl0u">Kostas Kloudas</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Jul 2016 08:55:37 +0000</created>
                <updated>Thu, 28 Feb 2019 11:16:24 +0000</updated>
                            <resolved>Tue, 26 Jul 2016 21:59:20 +0000</resolved>
                                    <version>1.1.0</version>
                                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15374897" author="stephanewen" created="Wed, 13 Jul 2016 12:19:23 +0000"  >&lt;p&gt;Is the overhead in the&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&quot;onElement()&quot; processing?&lt;/li&gt;
	&lt;li&gt;the window triggering?&lt;/li&gt;
	&lt;li&gt;the window cleanups?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15375072" author="aljoscha" created="Wed, 13 Jul 2016 14:13:21 +0000"  >&lt;p&gt;It is somehow caused by the new cleanup timers. If the code in &lt;tt&gt;registerCleanupTimer&lt;/tt&gt; is commented out then it performs as before.&lt;/p&gt;</comment>
                            <comment id="15387644" author="githubbot" created="Thu, 21 Jul 2016 13:08:16 +0000"  >&lt;p&gt;GitHub user kl0u opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4207&quot; title=&quot;WindowOperator becomes very slow with allowed lateness&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4207&quot;&gt;&lt;del&gt;FLINK-4207&lt;/del&gt;&lt;/a&gt; WindowOperator becomes very slow with allowed lateness&lt;/p&gt;

&lt;p&gt;    Fixes the slowdown due to the allowedLateness.&lt;br/&gt;
    The problem was the deleteCleanupTimer that was called on cleanup() for each window.&lt;br/&gt;
    This was causing a traversal of the whole list of timers in order to delete the correct one.&lt;/p&gt;

&lt;p&gt;    Now we let the timer be processed as a regular timer (even if the state has already been cleaned) and if the state is already cleaned up then we do nothing and just ignore it.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/kl0u/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/kl0u/flink&lt;/a&gt; window_slowdown_inv&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2277&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 0454a211d7711d6ed484577e8e64bafb669336e5&lt;br/&gt;
Author: kl0u &amp;lt;kkloudas@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-07-18T09:37:06Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4207&quot; title=&quot;WindowOperator becomes very slow with allowed lateness&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4207&quot;&gt;&lt;del&gt;FLINK-4207&lt;/del&gt;&lt;/a&gt; WindowOperator becomes very slow with allowed lateness&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15391614" author="githubbot" created="Mon, 25 Jul 2016 09:41:10 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @aljoscha Can you review this today? This is a blocker for the 1.1 release.&lt;/p&gt;</comment>
                            <comment id="15391923" author="githubbot" created="Mon, 25 Jul 2016 13:54:16 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This doesn&apos;t work for some cases. Consider, when you change `testCleanupTimerWithEmptyListStateForTumblingWindows()` to this:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    	@Test&lt;br/&gt;
    	public void testCleanupTimerWithEmptyListStateForTumblingWindows() throws Exception &lt;/p&gt;
{
    		final int WINDOW_SIZE = 2;
    		final long LATENESS = 100;
    
    		TypeInformation&amp;lt;Tuple2&amp;lt;String, Integer&amp;gt;&amp;gt; inputType = TypeInfoParser.parse(&quot;Tuple2&amp;lt;String, Integer&amp;gt;&quot;);
    
    		ListStateDescriptor&amp;lt;Tuple2&amp;lt;String, Integer&amp;gt;&amp;gt; windowStateDesc =
    			new ListStateDescriptor&amp;lt;&amp;gt;(&quot;window-contents&quot;, inputType.createSerializer(new ExecutionConfig()));
    
    		WindowOperator&amp;lt;String, Tuple2&amp;lt;String, Integer&amp;gt;, Iterable&amp;lt;Tuple2&amp;lt;String, Integer&amp;gt;&amp;gt;, String, TimeWindow&amp;gt; operator =
    			new WindowOperator&amp;lt;&amp;gt;(
    				TumblingEventTimeWindows.of(Time.of(WINDOW_SIZE, TimeUnit.SECONDS)),
    				new TimeWindow.Serializer(),
    				new TupleKeySelector(),
    				BasicTypeInfo.STRING_TYPE_INFO.createSerializer(new ExecutionConfig()),
    				windowStateDesc,
    				new InternalIterableWindowFunction&amp;lt;&amp;gt;(new PassThroughFunction()),
    				new EventTimeTriggerAccum(LATENESS),
    				LATENESS);
    
    		OneInputStreamOperatorTestHarness&amp;lt;Tuple2&amp;lt;String, Integer&amp;gt;, String&amp;gt; testHarness =
    			new OneInputStreamOperatorTestHarness&amp;lt;&amp;gt;(operator);
    
    		testHarness.configureForKeyedStream(new TupleKeySelector(), BasicTypeInfo.STRING_TYPE_INFO);
    
    		operator.setInputType(inputType, new ExecutionConfig());
    		testHarness.open();
    
    		ConcurrentLinkedQueue&amp;lt;Object&amp;gt; expected = new ConcurrentLinkedQueue&amp;lt;&amp;gt;();
    
    		// normal element
    		testHarness.processElement(new StreamRecord&amp;lt;&amp;gt;(new Tuple2&amp;lt;&amp;gt;(&quot;key2&quot;, 1), 1000));
    		testHarness.processWatermark(new Watermark(1599));
    		testHarness.processWatermark(new Watermark(1999));
    		testHarness.processWatermark(new Watermark(2100));
    		testHarness.processWatermark(new Watermark(5000));
    
    		expected.add(new Watermark(1599));
    		expected.add(new StreamRecord&amp;lt;&amp;gt;(&quot;GOT: (key2,1)&quot;, 1999));
    		expected.add(new Watermark(1999)); // here it fires and purges
    		expected.add(new Watermark(2100)); // here is the cleanup timer
    		expected.add(new Watermark(5000));
    
    		System.out.println(&quot;OUTPUT&quot; + testHarness.getOutput());
    
    		TestHarnessUtil.assertOutputEqualsSorted(&quot;Output was not correct.&quot;, expected, testHarness.getOutput(), new Tuple2ResultSortComparator());
    		testHarness.close();
    	}
&lt;p&gt;    ```&lt;/p&gt;

&lt;p&gt;    with `EventTimeTriggerAccum` like this:&lt;br/&gt;
    ```&lt;br/&gt;
    	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A trigger that fires at the end of the window but does not&lt;/li&gt;
	&lt;li&gt;purge the state of the fired window. This is to test the state&lt;/li&gt;
	&lt;li&gt;garbage collection mechanism.&lt;br/&gt;
    	 */&lt;br/&gt;
    	public class EventTimeTriggerAccum extends Trigger&amp;lt;Object, TimeWindow&amp;gt; {&lt;br/&gt;
    		private static final long serialVersionUID = 1L;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    		private long cleanupTime;&lt;/p&gt;

&lt;p&gt;    		private EventTimeTriggerAccum() &lt;/p&gt;
{
    			cleanupTime = 0L;
    		}

&lt;p&gt;    		public EventTimeTriggerAccum(long cleanupTime) &lt;/p&gt;
{
    			this.cleanupTime = cleanupTime;
    		}

&lt;p&gt;    		@Override&lt;br/&gt;
    		public TriggerResult onElement(Object element, long timestamp, TimeWindow window, TriggerContext ctx) throws Exception {&lt;br/&gt;
    			if (window.maxTimestamp() &amp;lt;= ctx.getCurrentWatermark()) &lt;/p&gt;
{
    				// if the watermark is already past the window fire immediately
    				return TriggerResult.FIRE;
    			}
&lt;p&gt; else &lt;/p&gt;
{
    				ctx.registerEventTimeTimer(window.maxTimestamp());
    				return TriggerResult.CONTINUE;
    			}
&lt;p&gt;    		}&lt;/p&gt;

&lt;p&gt;    		@Override&lt;br/&gt;
    		public TriggerResult onEventTime(long time, TimeWindow window, TriggerContext ctx) &lt;/p&gt;
{
    			return time == window.maxTimestamp() || time == window.maxTimestamp() + cleanupTime ?
    				TriggerResult.FIRE_AND_PURGE :
    				TriggerResult.CONTINUE;
    		}

&lt;p&gt;    		@Override&lt;br/&gt;
    		public TriggerResult onProcessingTime(long time, TimeWindow window, TriggerContext ctx) throws Exception &lt;/p&gt;
{
    			return TriggerResult.CONTINUE;
    		}

&lt;p&gt;    		@Override&lt;br/&gt;
    		public void clear(TimeWindow window, TriggerContext ctx) throws Exception &lt;/p&gt;
{
    			ctx.deleteEventTimeTimer(window.maxTimestamp());
    		}

&lt;p&gt;    		@Override&lt;br/&gt;
    		public boolean canMerge() &lt;/p&gt;
{
    			return true;
    		}

&lt;p&gt;    		@Override&lt;br/&gt;
    		public TriggerResult onMerge(TimeWindow window,&lt;br/&gt;
    									 OnMergeContext ctx) &lt;/p&gt;
{
    			ctx.registerEventTimeTimer(window.maxTimestamp());
    			return TriggerResult.CONTINUE;
    		}

&lt;p&gt;    		@Override&lt;br/&gt;
    		public String toString() &lt;/p&gt;
{
    			return &quot;EventTimeTrigger()&quot;;
    		}
&lt;p&gt;    	}&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    and `PassThroughFunction` like this:&lt;br/&gt;
    ```&lt;br/&gt;
    	private class PassThroughFunction implements WindowFunction&amp;lt;Tuple2&amp;lt;String, Integer&amp;gt;, String, String, TimeWindow&amp;gt; {&lt;br/&gt;
    		private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;p&gt;    		@Override&lt;br/&gt;
    		public void apply(String k, TimeWindow window, Iterable&amp;lt;Tuple2&amp;lt;String, Integer&amp;gt;&amp;gt; input, Collector&amp;lt;String&amp;gt; out) throws Exception &lt;/p&gt;
{
    			out.collect(&quot;GOT: &quot; + Joiner.on(&quot;,&quot;).join(input));
    		}
&lt;p&gt;    	}&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    Essentially, we want to trigger the window on cleanup time only when new data arrived after the purge. No new data arrives but the window function is called anyways.&lt;/p&gt;

&lt;p&gt;    I&apos;m afraid the solution to this really is to change `FoldingState` and `ListState` to return `null` when there is no state available. (Instead of &quot;default value&quot; and &quot;empty iterable&quot; as it is now). &lt;/p&gt;</comment>
                            <comment id="15391927" author="githubbot" created="Mon, 25 Jul 2016 13:55:57 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277#discussion_r72067210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277#discussion_r72067210&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/operators/windowing/WindowOperator.java &amp;#8212;&lt;br/&gt;
    @@ -408,11 +410,22 @@ public void processWatermark(Watermark mark) throws Exception {&lt;br/&gt;
     				if (windowAssigner instanceof MergingWindowAssigner) {&lt;br/&gt;
     					mergingWindows = getMergingWindowSet();&lt;br/&gt;
     					W stateWindow = mergingWindows.getStateWindow(context.window);&lt;br/&gt;
    +					if (stateWindow == null) &lt;/p&gt;
{
    +						// then the window is already purged and this is a cleanup
    +						// timer set due to allowed lateness that has nothing to clean,
    +						// so it is safe to just ignore
    +						continue;
    +					}
&lt;p&gt;     					windowState = getPartitionedState(stateWindow, windowSerializer, windowStateDescriptor);&lt;br/&gt;
     				} else &lt;/p&gt;
{
     					windowState = getPartitionedState(context.window, windowSerializer, windowStateDescriptor);
     				}

&lt;p&gt;    +				if (windowState.get() == null) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This doubles the amount of accesses to the state. For example, for RocksDB that&apos;s two DB lookups instead of one. I think we can get the state contents once and pass that to `fireOrContinue()` instead of the state object. &lt;/p&gt;

&lt;p&gt;    Same for other instances of this snipped. &lt;/p&gt;</comment>
                            <comment id="15392172" author="githubbot" created="Mon, 25 Jul 2016 16:06:25 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277#discussion_r72092981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277#discussion_r72092981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/state/AppendingState.java &amp;#8212;&lt;br/&gt;
    @@ -46,8 +46,14 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;operator instance. If state partitioning is applied, the value returned&lt;/li&gt;
	&lt;li&gt;depends on the current operator input, as the operator maintains an&lt;/li&gt;
	&lt;li&gt;independent state for each partition.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;/li&gt;
	&lt;li&gt;* @return The operator state value corresponding to the current input.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;&lt;br/&gt;
    +	 *     &amp;lt;b&amp;gt;NOTE TO IMPLEMENTERS:&amp;lt;/b&amp;gt; if the state is empty, then this method&lt;br/&gt;
    +	 *     should return 
{@code null}.&lt;br/&gt;
    +	 * &amp;lt;/p&amp;gt;&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return The operator state value corresponding to the current input or {@code null}
&lt;p&gt;    +	 * is the state is empty.&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good idea to include this message!&lt;/p&gt;

&lt;p&gt;    There&apos;s a type, though, should be &quot;if the state is empty&quot; &#128521; &lt;/p&gt;</comment>
                            <comment id="15392176" author="githubbot" created="Mon, 25 Jul 2016 16:07:45 +0000"  >&lt;p&gt;Github user aljoscha commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277#discussion_r72093243&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277#discussion_r72093243&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/operators/windowing/MergingWindowSet.java &amp;#8212;&lt;br/&gt;
    @@ -80,8 +80,10 @@ public MergingWindowSet(MergingWindowAssigner&amp;lt;?, W&amp;gt; windowAssigner, ListState&amp;lt;Tu&lt;br/&gt;
     		this.windowAssigner = windowAssigner;&lt;br/&gt;
     		windows = new HashMap&amp;lt;&amp;gt;();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;for (Tuple2&amp;lt;W, W&amp;gt; window: state.get()) {&lt;/li&gt;
	&lt;li&gt;windows.put(window.f0, window.f1);&lt;br/&gt;
    +		if (state.get() != null) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Two `state.get()` calls, can be reduced to one.&lt;/p&gt;</comment>
                            <comment id="15392179" author="githubbot" created="Mon, 25 Jul 2016 16:09:16 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good now! I had some minor inline comments.&lt;/p&gt;</comment>
                            <comment id="15394487" author="githubbot" created="Tue, 26 Jul 2016 20:27:47 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15394558" author="githubbot" created="Tue, 26 Jul 2016 21:21:17 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2277&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2277&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Could you please close? And thanks for your work! &#128077; &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 16 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30wnr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>