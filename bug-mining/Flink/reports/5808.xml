<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:02:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-24054] Let SinkUpsertMaterializer emit +U instead of only +I</title>
                <link>https://issues.apache.org/jira/browse/FLINK-24054</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, &lt;tt&gt;SinkUpsertMaterializer&lt;/tt&gt; is not able to emit +U&apos;s but will always emit +I&apos;s. Thus, resulting changelogs are incorrect strictly speaking and only valid when treating +U and +I as similar changes in downstream operators.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13398213">FLINK-24054</key>
            <summary>Let SinkUpsertMaterializer emit +U instead of only +I</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="twalthr">Timo Walther</assignee>
                                    <reporter username="twalthr">Timo Walther</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 30 Aug 2021 12:16:30 +0000</created>
                <updated>Thu, 30 Sep 2021 11:51:56 +0000</updated>
                            <resolved>Thu, 30 Sep 2021 11:51:56 +0000</resolved>
                                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.3</fixVersion>
                                    <component>Table SQL / Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17407171" author="ykt836" created="Tue, 31 Aug 2021 08:22:04 +0000"  >&lt;p&gt;In most cases, +I and -D are easier to handle, and are equivalant with +U and -U&lt;/p&gt;

&lt;p&gt;Is it worth to treat this as blocker bug? I&apos;m not even sure if this is a bug.&lt;/p&gt;</comment>
                            <comment id="17407214" author="twalthr" created="Tue, 31 Aug 2021 10:12:02 +0000"  >&lt;p&gt;It really depends on the use case. For our current Kafka sink implementation, this might not be an issue. But strictly speaking the current behavior is incorrect. +I and +U might trigger different downstream logic. &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-table/flink-table-planner/src/test/java/org/apache/flink/table/planner/runtime/stream/sql/DataStreamJavaITCase.java#L643&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;See this example&lt;/a&gt; I had to modify the materialization logic because +U requires a look up by primary key, whereas +I should simply be forwarded.&lt;/p&gt;</comment>
                            <comment id="17407218" author="ykt836" created="Tue, 31 Aug 2021 10:19:15 +0000"  >&lt;p&gt;The example you gave is test, whose behavior could be changed &amp;amp; adopted easily.&#160;&lt;/p&gt;

&lt;p&gt;I think we need to think more with actual external systems, just like you said, kafka sink and others.&#160;&lt;/p&gt;</comment>
                            <comment id="17407231" author="twalthr" created="Tue, 31 Aug 2021 10:36:57 +0000"  >&lt;p&gt;In the first version, the test was failing because I did not perform a look up by key (why should I if it is just an insertion?). We recently exposed `toChangelogStream` and our changelog contains +I/+U/-U/-D for a reason. We could have discussed whether we only expose +I/+D when we introduced FLIP-95 but now we should adhere to our own semantics.&lt;/p&gt;</comment>
                            <comment id="17407237" author="arvid" created="Tue, 31 Aug 2021 10:44:04 +0000"  >&lt;p&gt;If the external system strictly follows +I key +I key, you will get a primary key violation. This would be the case if CDC is used to update a database. Having +I key +U key is correct and wouldn&apos;t require workarounds downstream. &lt;/p&gt;

&lt;p&gt;However, for kafka eliminating superfluous tombstones records is most important (e.g. what BufferedSinkFunction/ReducingSinkWriter is doing). So I&apos;m fine to solve this issue later. But it must be documented for now.&lt;/p&gt;</comment>
                            <comment id="17407735" author="ykt836" created="Wed, 1 Sep 2021 01:01:58 +0000"  >&lt;p&gt;You opinions also make sense in some cases. That&apos;s exactly what I tried to mean at the first place, whether to improve this issue seems more discussion and thoughts. I didn&apos;t understand why we category this one into a bug immediately and marked it as release blocker.&#160;&lt;/p&gt;</comment>
                            <comment id="17408627" author="twalthr" created="Thu, 2 Sep 2021 07:31:08 +0000"  >&lt;p&gt;Fixed in master: 35f63758cfdeb030fb5a7e7a819f2cf342e26cd2&lt;br/&gt;
Fixed in 1.14: cb7c41b5f98c491eb855c5f8f02469c80d42277d&lt;/p&gt;</comment>
                            <comment id="17408828" author="twalthr" created="Thu, 2 Sep 2021 13:35:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ykt836&quot; class=&quot;user-hover&quot; rel=&quot;ykt836&quot;&gt;ykt836&lt;/a&gt; sorry, I saw you comment to late. I just marked it as a blocker to fix it in this release that also introduced the SinkUpsertMaterializer. In the end, as you can see in the PR, the changes required were minimal.&lt;/p&gt;</comment>
                            <comment id="17422715" author="twalthr" created="Thu, 30 Sep 2021 11:51:56 +0000"  >&lt;p&gt;Fixed in 1.13: fa16e70774b516ddd499400d9cafa0400d314bfc&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310760">
                    <name>Testing</name>
                                                                <inwardlinks description="Discovered while testing">
                                        <issuelink>
            <issuekey id="13395631">FLINK-23835</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ueyw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>