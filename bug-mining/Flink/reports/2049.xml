<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:30:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7922] leastRestrictive in FlinkTypeFactory does not resolve composite type correctly</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7922</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;FlinkTypeFactory does not override the following function correctly:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def leastRestrictive(types: util.List[RelDataType]): RelDataType = {
  &lt;span class=&quot;code-comment&quot;&gt;//... 
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;dealing with SQL such as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;CASE&lt;/span&gt; 
  &lt;span class=&quot;code-keyword&quot;&gt;WHEN&lt;/span&gt; &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;CONDITION&lt;/span&gt;&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;THEN&lt;/span&gt; 
    &amp;lt;COMPOSITE_TYPE&amp;gt; 
  &lt;span class=&quot;code-keyword&quot;&gt;ELSE&lt;/span&gt; 
    &lt;span class=&quot;code-keyword&quot;&gt;NULL&lt;/span&gt; 
&lt;span class=&quot;code-keyword&quot;&gt;END&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;will trigger runtime exception. &lt;/p&gt;

&lt;p&gt;See following test sample for more details:&lt;br/&gt;
&lt;a href=&quot;https://github.com/walterddr/flink/commit/a5f2affc9bbbd50f06200f099c90597e519e9170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/walterddr/flink/commit/a5f2affc9bbbd50f06200f099c90597e519e9170&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13112045">FLINK-7922</key>
            <summary>leastRestrictive in FlinkTypeFactory does not resolve composite type correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rongr">Rong Rong</assignee>
                                    <reporter username="rongr">Rong Rong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Oct 2017 18:13:12 +0000</created>
                <updated>Thu, 19 Sep 2019 19:16:12 +0000</updated>
                            <resolved>Mon, 12 Mar 2018 15:42:26 +0000</resolved>
                                    <version>1.4.0</version>
                                    <fixVersion>1.3.4</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16227257" author="githubbot" created="Tue, 31 Oct 2017 18:16:17 +0000"  >&lt;p&gt;GitHub user walterddr opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4929&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7922&quot; title=&quot;leastRestrictive in FlinkTypeFactory does not resolve composite type correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7922&quot;&gt;&lt;del&gt;FLINK-7922&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Table API&amp;#93;&lt;/span&gt;make FlinkTypeFactory override leastRestrictive to work with Nullable composite types while using super class method to handle basic type &lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This pull request address usage of multiple composite type operation such as UNION or CASE WHEN where incorrect output RelDataType was generated due to the fact that Calcite automatically resolve result into basic type or Generic Relation Data Type with false nullability.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;br/&gt;
    Changed leastRestrictive function to resolve types with all identical typeinfomation directly instead of calling the super class method. &lt;br/&gt;
    Throw exception on ANY as we only support ANY with exact same types across all operands.&lt;br/&gt;
    Invoke super class if not correctly resolved.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;br/&gt;
    Integration test and unit test included to address UNION ALL and CASE WHEN.&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;br/&gt;
    no&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;br/&gt;
    no&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/walterddr/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/walterddr/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7922&quot; title=&quot;leastRestrictive in FlinkTypeFactory does not resolve composite type correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7922&quot;&gt;&lt;del&gt;FLINK-7922&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4929.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4929.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4929&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1f6a452be6233f5d18a80802f58b78baa708d15c&lt;br/&gt;
Author: Rong Rong &amp;lt;rongr@uber.com&amp;gt;&lt;br/&gt;
Date:   2017-10-31T18:05:38Z&lt;/p&gt;

&lt;p&gt;    make FlinkTypeFactory override leastRestrictive to work with composite but all equivalent types, include Nullable and Any typaes.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16227260" author="githubbot" created="Tue, 31 Oct 2017 18:17:07 +0000"  >&lt;p&gt;Github user walterddr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4929#discussion_r148083555&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4929#discussion_r148083555&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/test/scala/org/apache/flink/table/api/batch/sql/SetOperatorsTest.scala &amp;#8212;&lt;br/&gt;
    @@ -178,4 +182,54 @@ class SetOperatorsTest extends TableTestBase &lt;/p&gt;
{
           expected
         )
       }
&lt;p&gt;    +&lt;br/&gt;
    +  @Test&lt;br/&gt;
    +  def testUnionNullableTypes(): Unit = {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think this should also be added to stream API as well but I am not sure which test category it falls into.&lt;/p&gt;</comment>
                            <comment id="16243939" author="githubbot" created="Wed, 8 Nov 2017 13:33:34 +0000"  >&lt;p&gt;Github user fhueske commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4929&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the PR @walterddr. &lt;br/&gt;
    I&apos;ll add the test for the Streaming API and merge it.&lt;/p&gt;

&lt;p&gt;    Thanks, Fabian&lt;/p&gt;</comment>
                            <comment id="16244407" author="githubbot" created="Wed, 8 Nov 2017 17:43:28 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4929&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16244775" author="fhueske" created="Wed, 8 Nov 2017 21:48:26 +0000"  >&lt;p&gt;Fixed for 1.3.3 with eb2995762ea441e5fdc0097263b9eaa5dc674aa1&lt;br/&gt;
Fixed for 1.4.0 with 8c60f97a43defc57bb1bfaabdd6081b329db53b8&lt;br/&gt;
Fixed for 1.5.0 with 949ae79dad149a97f4703daa7e58d7fbd0957dac&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lp6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>