<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:48:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-18478] AvroDeserializationSchema does not work with types generated by avrohugger</title>
                <link>https://issues.apache.org/jira/browse/FLINK-18478</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The main problem is that the code in &lt;tt&gt;SpecificData.createSchema()&lt;/tt&gt; tries to reflectively read the &lt;tt&gt;SCHEMA$&lt;/tt&gt; field, that is normally there in Avro generated classes. However, avrohugger generates this field in a companion object, which the reflective Java code will therefore not find.&lt;/p&gt;

&lt;p&gt;This is also described in these ML threads:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://lists.apache.org/thread.html/5db58c7d15e4e9aaa515f935be3b342fe036e97d32e1fb0f0d1797ee@%3Cuser.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/5db58c7d15e4e9aaa515f935be3b342fe036e97d32e1fb0f0d1797ee@%3Cuser.flink.apache.org%3E&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://lists.apache.org/thread.html/cf1c5b8fa7f095739438807de9f2497e04ffe55237c5dea83355112d@%3Cuser.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/cf1c5b8fa7f095739438807de9f2497e04ffe55237c5dea83355112d@%3Cuser.flink.apache.org%3E&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13314764">FLINK-18478</key>
            <summary>AvroDeserializationSchema does not work with types generated by avrohugger</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="10200" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Not a Priority</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                            <label>auto-deprioritized-major</label>
                            <label>auto-deprioritized-minor</label>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 2 Jul 2020 18:53:54 +0000</created>
                <updated>Sat, 13 Nov 2021 10:38:40 +0000</updated>
                                                                            <component>Formats (JSON, Avro, Parquet, ORC, SequenceFile)</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17154642" author="aljoscha" created="Thu, 9 Jul 2020 14:50:24 +0000"  >&lt;p&gt;release-1.10: cf047a4d3357784705b0af2ec281cdefce278d7e&lt;br/&gt;
release-1.11: 66a6620bd1463af6293a8d742d59ac2eaf480bdd&lt;br/&gt;
master: b3e8fdebc66d094032427faf96b7a00f48ebd7a0&lt;/p&gt;</comment>
                            <comment id="17155125" author="georg.kf.heiler@gmail.com" created="Fri, 10 Jul 2020 05:02:55 +0000"  >&lt;p&gt;I have created a fresh local build of flink to test it. I can confirm that the initial issue is solved! However, it still fails with a similar issue:&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
 &lt;tt&gt;&lt;font color=&quot;#000000&quot;&gt;org.apache.avro.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;AvroRuntimeException&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;: &lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;Not&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt; a &lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;Specific&lt;/font&gt; &lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;: &lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;class&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt; $line12.$read$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$$iw$Tweet&lt;/font&gt;&lt;/tt&gt;&lt;br/&gt;
 &#160;&lt;br/&gt;
 &lt;font color=&quot;#000000&quot;&gt;I have created a reproducible example here &lt;a href=&quot;https://gist.github.com/geoHeil/5a5a4ae0ca2a8049617afa91acf40f89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/geoHeil/5a5a4ae0ca2a8049617afa91acf40f89&lt;/a&gt;&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#000000&quot;&gt;having pulled again this morning to fce502cbc481e97b951259ac9350d0e401c68774&lt;br/&gt;
 &lt;br/&gt;
 mvn clean package -DskipTests -Dfast -Dscala-2.11, the build fails with&lt;br/&gt;
 Could not resolve dependencies for project org.apache.flink:flink-dist_2.11:jar:1.12-SNAPSHOT&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#000000&quot;&gt;Where would I find the latest official snapshot build for download?&lt;/font&gt;&lt;/p&gt;</comment>
                            <comment id="17158218" author="aljoscha" created="Wed, 15 Jul 2020 14:26:27 +0000"  >&lt;p&gt;From the log you posted in the gist it seems that code is still using the Flink 1.11.0 version of &lt;tt&gt;AvroDeserializationSchema&lt;/tt&gt; which doesn&apos;t have the fix.&lt;/p&gt;

&lt;p&gt;You can try and use the snapshots repository and depend on version &lt;tt&gt;1.12-SNAPSHOT&lt;/tt&gt;. In maven you can do it by adding this repository:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;repositories&amp;gt;
	&amp;lt;repository&amp;gt;
		&amp;lt;id&amp;gt;apache.snapshots&amp;lt;/id&amp;gt;
		&amp;lt;name&amp;gt;Apache Development Snapshot Repository&amp;lt;/name&amp;gt;
		&amp;lt;url&amp;gt;https:&lt;span class=&quot;code-comment&quot;&gt;//repository.apache.org/content/repositories/snapshots/&amp;lt;/url&amp;gt;
&lt;/span&gt;		&amp;lt;releases&amp;gt;
			&amp;lt;enabled&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/enabled&amp;gt;
		&amp;lt;/releases&amp;gt;
		&amp;lt;snapshots&amp;gt;
			&amp;lt;enabled&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/enabled&amp;gt;
		&amp;lt;/snapshots&amp;gt;
	&amp;lt;/repository&amp;gt;
&amp;lt;/repositories&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17158523" author="georg.kf.heiler@gmail.com" created="Wed, 15 Jul 2020 16:49:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aljoscha&quot; class=&quot;user-hover&quot; rel=&quot;aljoscha&quot;&gt;aljoscha&lt;/a&gt; can I also download a nightly jar snapshot which is already packaged from somewhere? The `repositories` are helpful, but now the latest master branch still fails for the flink-python submodule.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17161370" author="aljoscha" created="Mon, 20 Jul 2020 16:40:21 +0000"  >&lt;p&gt;Now you can actually try the Flink 1.11.1 release candiate: &lt;a href=&quot;https://lists.apache.org/thread.html/r29ca31ff17e213465f839b5d20c039412234f0fb0faae06897967db9%40%3Cdev.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/r29ca31ff17e213465f839b5d20c039412234f0fb0faae06897967db9%40%3Cdev.flink.apache.org%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can build against the staged jars by putting this in a &lt;tt&gt;settings.xml&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;settings&amp;gt;
&amp;lt;activeProfiles&amp;gt;
&amp;lt;activeProfile&amp;gt;flink-1.11.1&amp;lt;/activeProfile&amp;gt;
&amp;lt;/activeProfiles&amp;gt;
&amp;lt;profiles&amp;gt;
&amp;lt;profile&amp;gt;
  &amp;lt;id&amp;gt;flink-1.11.1&amp;lt;/id&amp;gt;
  &amp;lt;repositories&amp;gt;
    &amp;lt;repository&amp;gt;
      &amp;lt;id&amp;gt;flink-1.11.1&amp;lt;/id&amp;gt;
      &amp;lt;url&amp;gt;
          https:&lt;span class=&quot;code-comment&quot;&gt;//repository.apache.org/content/repositories/orgapacheflink-1378/
&lt;/span&gt;      &amp;lt;/url&amp;gt;
    &amp;lt;/repository&amp;gt;
    &amp;lt;repository&amp;gt;
      &amp;lt;id&amp;gt;archetype&amp;lt;/id&amp;gt;
      &amp;lt;url&amp;gt;
          https:&lt;span class=&quot;code-comment&quot;&gt;//repository.apache.org/content/repositories/orgapacheflink-1378/
&lt;/span&gt;      &amp;lt;/url&amp;gt;
    &amp;lt;/repository&amp;gt;
  &amp;lt;/repositories&amp;gt;
&amp;lt;/profile&amp;gt;
&amp;lt;/profiles&amp;gt;
&amp;lt;/settings&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;And reference that in you maven commands via --settings path/to/settings.xml.&lt;/p&gt;</comment>
                            <comment id="17163347" author="georg.kf.heiler@gmail.com" created="Thu, 23 Jul 2020 08:44:25 +0000"  >&lt;p&gt;Great! I can confirm that the initial reflection-based error is solved now.&lt;/p&gt;

&lt;p&gt;However `&lt;font color=&quot;#008080&quot;&gt;GenericData&lt;/font&gt;` cannot be cast to type `scala.Product` for an now updated reproducible example of&#160;&lt;font color=&quot;#000000&quot;&gt; &lt;a href=&quot;https://gist.github.com/geoHeil/5a5a4ae0ca2a8049617afa91acf40f89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/geoHeil/5a5a4ae0ca2a8049617afa91acf40f89&lt;/a&gt;&lt;/font&gt;:&lt;/p&gt;

&lt;p&gt;```&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;java.lang.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;ClassCastException&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;: org.apache.avro.generic.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;GenericData$Record&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt; cannot be &lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;cast&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt; to scala.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;Product&lt;/font&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;ava.lang.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;ClassCastException&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;: org.apache.avro.generic.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;GenericData$Record&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt; cannot be &lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;cast&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt; to scala.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;Product&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.api.scala.typeutils.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;CaseClassSerializer&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.copy(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;CaseClassSerializer&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.scala:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;32&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.runtime.tasks.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;OperatorChain$CopyingChainingOutput&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.pushToOperator(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;OperatorChain&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;715&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.runtime.tasks.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;OperatorChain$CopyingChainingOutput&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;collect&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;OperatorChain&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;692&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.runtime.tasks.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;OperatorChain$CopyingChainingOutput&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;collect&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;OperatorChain&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;672&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.api.operators.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;CountingOutput&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;collect&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;CountingOutput&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;52&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.api.operators.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;CountingOutput&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;collect&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;CountingOutput&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;30&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.api.operators.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;StreamSourceContexts$NonTimestampContext&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#0000ff&quot;&gt;collect&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;StreamSourceContexts&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;104&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.api.operators.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;StreamSourceContexts$NonTimestampContext&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.collectWithTimestamp(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;StreamSourceContexts&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;111&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.connectors.kafka.internals.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;AbstractFetcher&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.emitRecordsWithTimestamps(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;AbstractFetcher&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;352&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-connector-kafka-base_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.connectors.kafka.internal.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;KafkaFetcher&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.partitionConsumerRecordsHandler(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;KafkaFetcher&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;185&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-connector-kafka_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.connectors.kafka.internal.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;KafkaFetcher&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.runFetchLoop(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;KafkaFetcher&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;141&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-connector-kafka_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.connectors.kafka.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;FlinkKafkaConsumerBase&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.run(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;FlinkKafkaConsumerBase&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;755&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-connector-kafka-base_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.api.operators.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;StreamSource&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.run(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;StreamSource&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;100&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.api.operators.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;StreamSource&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.run(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;StreamSource&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;63&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;&#160;&#160;&#160;&#160;at org.apache.flink.streaming.runtime.tasks.&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;SourceStreamTask$LegacySourceFunctionThread&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.run(&lt;/font&gt;&lt;font color=&quot;#008080&quot;&gt;SourceStreamTask&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.java:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;201&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;) ~[flink-dist_2.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;-&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.jar:&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1.11&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;.&lt;/font&gt;&lt;font color=&quot;#09885a&quot;&gt;1&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt;]&lt;/font&gt;&lt;br/&gt;
```&lt;/p&gt;</comment>
                            <comment id="17163801" author="aljoscha" created="Thu, 23 Jul 2020 17:24:51 +0000"  >&lt;p&gt;This is a simpler reproducer:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
object AvroBug {

  def main(args: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]): Unit = {

    val deserSchema = AvroDeserializationSchema.forSpecific(classOf[Tweet])
    val serSchema = AvroSerializationSchema.forSpecific(classOf[Tweet])

    val tweet = Tweet(Some(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;))

    val serializedTweet = serSchema.serialize(tweet)
    val deserializedTweet: Tweet = deserSchema.deserialize(serializedTweet)

    println(s&lt;span class=&quot;code-quote&quot;&gt;&quot;Tweet: $deserializedTweet&quot;&lt;/span&gt;)
  }

}

&lt;span class=&quot;code-comment&quot;&gt;/** MACHINE-GENERATED FROM AVRO SCHEMA. DO NOT EDIT DIRECTLY */&lt;/span&gt;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; scala.annotation.&lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt;

/**
 * Twitter tweet record limited to basic information
 * @param tweet_id &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;-assigned numeric tweet ID. Cannot be changed by the user.
 */
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Tweet(&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; tweet_id: Option[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]) &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; org.apache.avro.specific.SpecificRecordBase {
  def &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;() = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(None)
  def get(field$: Int): AnyRef = {
    (field$: @&lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt;) match {
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; 0 =&amp;gt; {
        tweet_id match {
          &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; Some(x) =&amp;gt; x
          &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; None =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        }
      }.asInstanceOf[AnyRef]
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _ =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.avro.AvroRuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bad index&quot;&lt;/span&gt;)
    }
  }
  def put(field$: Int, value: Any): Unit = {
    (field$: @&lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt;) match {
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; 0 =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.tweet_id = {
        value match {
          &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; =&amp;gt; None
          &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _ =&amp;gt; Some(value.toString)
        }
      }.asInstanceOf[Option[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]]
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; _ =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.avro.AvroRuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bad index&quot;&lt;/span&gt;)
    }
    ()
  }
  def getSchema: org.apache.avro.Schema = Tweet.SCHEMA$
}

object Tweet {
  val SCHEMA$ = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.avro.Schema.Parser().parse(&lt;span class=&quot;code-quote&quot;&gt;&quot;{\&quot;&lt;/span&gt;type\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;record\&lt;span class=&quot;code-quote&quot;&gt;&quot;,\&quot;&lt;/span&gt;name\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;Tweet\&lt;span class=&quot;code-quote&quot;&gt;&quot;,\&quot;&lt;/span&gt;namespace\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;com.github.geoheil.streamingreference\&lt;span class=&quot;code-quote&quot;&gt;&quot;,\&quot;&lt;/span&gt;doc\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;Twitter tweet record limited to basic information\&lt;span class=&quot;code-quote&quot;&gt;&quot;,\&quot;&lt;/span&gt;fields\&lt;span class=&quot;code-quote&quot;&gt;&quot;:[{\&quot;&lt;/span&gt;name\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;tweet_id\&lt;span class=&quot;code-quote&quot;&gt;&quot;,\&quot;&lt;/span&gt;type\&lt;span class=&quot;code-quote&quot;&gt;&quot;:[\&quot;&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;,\&quot;&lt;/span&gt;string\&lt;span class=&quot;code-quote&quot;&gt;&quot;],\&quot;&lt;/span&gt;doc\&lt;span class=&quot;code-quote&quot;&gt;&quot;:\&quot;&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;-assigned numeric tweet ID. Cannot be changed by the user.\&lt;span class=&quot;code-quote&quot;&gt;&quot;}]}&quot;&lt;/span&gt;)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem is that Avro will deserialize the Tweet as a &lt;tt&gt;GenericData$Record&lt;/tt&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; do you know if this is the expected behaviour here?&lt;/p&gt;

&lt;p&gt;Also, I found another problem while working on the reproducer: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18692&quot; title=&quot;AvroSerializationSchema does not work with types generated by avrohugger&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18692&quot;&gt;FLINK-18692&lt;/a&gt;. The example only works when this is fixed, by changing &lt;tt&gt;checkAvroInitialized()&lt;/tt&gt; in there to use&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
			SpecificData specificData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SpecificData(cl);
			Schema schema = AvroFactory.extractAvroSpecificSchema(recordClazz, specificData);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17164261" author="aljoscha" created="Fri, 24 Jul 2020 08:33:59 +0000"  >&lt;p&gt;So, the reason why it&apos;s deserializing the record as a generic record is that it cannot find the &lt;tt&gt;Tweet&lt;/tt&gt; class. If you put the class in the right Java/Scala package (&lt;tt&gt;com.github.geoheil.streamingreference&lt;/tt&gt; in your example) you will get one step further. Then it fails with this, though:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.avro.AvroRuntimeException: avro.shaded.com.google.common.util.concurrent.UncheckedExecutionException: org.apache.avro.AvroRuntimeException: Not a Specific class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.flink.streaming.scala.examples.windowing.Tweet
	at org.apache.avro.specific.SpecificData.getSchema(SpecificData.java:227)
	at org.apache.avro.specific.SpecificDatumReader.setSchema(SpecificDatumReader.java:74)
	at org.apache.flink.formats.avro.AvroDeserializationSchema.deserialize(AvroDeserializationSchema.java:134)
	at org.apache.flink.streaming.scala.examples.windowing.AvroBug$.main(WindowWordCount.scala:67)
	at org.apache.flink.streaming.scala.examples.windowing.AvroBug.main(WindowWordCount.scala)
Caused by: avro.shaded.com.google.common.util.concurrent.UncheckedExecutionException: org.apache.avro.AvroRuntimeException: Not a Specific class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.flink.streaming.scala.examples.windowing.Tweet
	at avro.shaded.com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2234)
	at avro.shaded.com.google.common.cache.LocalCache.get(LocalCache.java:3965)
	at avro.shaded.com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3969)
	at avro.shaded.com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4829)
	at org.apache.avro.specific.SpecificData.getSchema(SpecificData.java:225)
	... 4 more
Caused by: org.apache.avro.AvroRuntimeException: Not a Specific class: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.flink.streaming.scala.examples.windowing.Tweet
	at org.apache.avro.specific.SpecificData.createSchema(SpecificData.java:285)
	at org.apache.avro.specific.SpecificData$2.load(SpecificData.java:218)
	at org.apache.avro.specific.SpecificData$2.load(SpecificData.java:215)
	at avro.shaded.com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3568)
	at avro.shaded.com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2350)
	at avro.shaded.com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2313)
	at avro.shaded.com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2228)
	... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason here is that Avro-internal code tries to access the &lt;tt&gt;SCHEMA$&lt;/tt&gt; field, which is not there for avrohugger-generated classes. The field is in the companion object, but that&apos;s not the same as a &lt;tt&gt;static&lt;/tt&gt; the the class itself, which is what Avro expects.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; The problematic call is this in &lt;tt&gt;AvroDeserializationSchema&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
datumReader.setSchema(readerSchema);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;maybe we could get around this by creating encoders/serializers/whatnot differently but I&apos;m slowly getting a bit fed-up with avrohugger.&lt;/p&gt;</comment>
                            <comment id="17164263" author="dawidwys" created="Fri, 24 Jul 2020 08:39:45 +0000"  >&lt;p&gt;Yes I also got to the same conclusions yesterday. Generally speaking &lt;tt&gt;avrohugger&lt;/tt&gt; (or rather scala) does not work with avro native libraries. You never know what will blow up as some of the methods in avro simply do not work with &lt;tt&gt;avrohugger&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;We can workaround this particular problem in &lt;tt&gt;AvroDeserializationSchema&lt;/tt&gt; by passing the schema in the ctor of &lt;tt&gt;SpecificDatumReader&lt;/tt&gt;. Nevertheless we can not make it work with schema registry as we do not the method &lt;tt&gt;setSchema&lt;/tt&gt; to work...&lt;/p&gt;

&lt;p&gt;I&apos;d suggest to implement this fix (passing schema in a ctor of &lt;tt&gt;SpecificDatumReader&lt;/tt&gt;) for &lt;tt&gt;AvroDeserializationSchema&lt;/tt&gt;, but I&apos;d add a note that we discourage usage of avrohugger as it is incompatible with avro native libraries and we do not guarantee it works properly in all cases.&lt;/p&gt;</comment>
                            <comment id="17164392" author="georg.kf.heiler@gmail.com" created="Fri, 24 Jul 2020 11:48:39 +0000"  >&lt;p&gt;Could you recommend a tool where compatibility is fine, and preferably scala stays supported?&lt;/p&gt;</comment>
                            <comment id="17164456" author="sjwiesman" created="Fri, 24 Jul 2020 13:49:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=georg.kf.heiler%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;georg.kf.heiler@gmail.com&quot;&gt;georg.kf.heiler@gmail.com&lt;/a&gt; I&apos;m not sure you will find a Scala Avro tool that is truly compatible with the native Apache Avro java library. The reason is there is no way for scala code to generate Java statics, so any scala class will face this issue&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. My best recommendation is to just generate Avro Java POJOs and use them from scala. &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://docs.scala-lang.org/sips/static-members.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.scala-lang.org/sips/static-members.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17327752" author="flink-jira-bot" created="Thu, 22 Apr 2021 11:13:34 +0000"  >&lt;p&gt;This major issue is unassigned and itself and all of its Sub-Tasks have not been updated for 30 days. So, it has been labeled &quot;stale-major&quot;. If this ticket is indeed &quot;major&quot;, please either assign yourself or give an update. Afterwards, please remove the label. In 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17336143" author="flink-jira-bot" created="Thu, 29 Apr 2021 23:09:00 +0000"  >&lt;p&gt;This issue was labeled &quot;stale-major&quot; 7 ago and has not received any updates so it is being deprioritized. If this ticket is actually Major, please raise the priority and ask a committer to assign you the issue or revive the public discussion.&lt;/p&gt;</comment>
                            <comment id="17438633" author="flink-jira-bot" created="Thu, 4 Nov 2021 10:40:26 +0000"  >&lt;p&gt;I am the &lt;a href=&quot;https://github.com/apache/flink-jira-bot/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Flink Jira Bot&lt;/a&gt; and I help the community manage its development. I see this issues has been marked as Minor but is unassigned and neither itself nor its Sub-Tasks have been updated for 180 days. I have gone ahead and marked it &quot;stale-minor&quot;. If this ticket is still Minor, please either assign yourself or give an update. Afterwards, please remove the label or in 7 days the issue will be deprioritized.&lt;/p&gt;</comment>
                            <comment id="17443062" author="flink-jira-bot" created="Sat, 13 Nov 2021 10:38:40 +0000"  >&lt;p&gt;This issue was labeled &quot;stale-minor&quot; 7 days ago and has not received any updates so it is being deprioritized. If this ticket is actually Minor, please raise the priority and ask a committer to assign you the issue or revive the public discussion.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="13232993">FLINK-12501</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="13319006">FLINK-18692</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13319007">FLINK-18693</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0gey0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>