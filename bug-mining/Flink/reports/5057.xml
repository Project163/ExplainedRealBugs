<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20942] Digest of FLOAT literals throws UnsupportedOperationException</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20942</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The recent refactoring of Calcite&apos;s digests might have caused a regression for FLOAT literals. &lt;tt&gt;org.apache.calcite.rex.RexLiteral#appendAsJava&lt;/tt&gt; throws a UnsupportedOperationException for the following query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
def main(args: Array[&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;]): Unit = {
    val env = StreamExecutionEnvironment.getExecutionEnvironment
    val source = env.fromElements(
      (1.0f, 11.0f, 12.0f),
      (2.0f, 21.0f, 22.0f),
      (3.0f, 31.0f, 32.0f),
      (4.0f, 41.0f, 42.0f),
      (5.0f, 51.0f, 52.0f)
    )
    val settings = EnvironmentSettings.newInstance()
        .inStreamingMode()
        .useBlinkPlanner()
        .build()
    val tEnv = StreamTableEnvironment.create(env, settings)
    tEnv.createTemporaryView(&lt;span class=&quot;code-quote&quot;&gt;&quot;myTable&quot;&lt;/span&gt;, source, $(&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;), $(&lt;span class=&quot;code-quote&quot;&gt;&quot;f1&quot;&lt;/span&gt;), $(&lt;span class=&quot;code-quote&quot;&gt;&quot;f2&quot;&lt;/span&gt;))
    val query =
      &quot;&quot;&quot;
        |select * from myTable where id in (1.0, 2.0, 3.0)
        |&quot;&quot;&quot;.stripMargin
    tEnv.executeSql(query).print()
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.UnsupportedOperationException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.calcite.sql.type.SqlTypeName: FLOAT
	at org.apache.calcite.util.Util.needToImplement(Util.java:1075)
	at org.apache.calcite.rex.RexLiteral.appendAsJava(RexLiteral.java:703)
	at org.apache.calcite.rex.RexLiteral.toJavaString(RexLiteral.java:408)
	at org.apache.calcite.rex.RexLiteral.computeDigest(RexLiteral.java:276)
	at org.apache.calcite.rex.RexLiteral.&amp;lt;init&amp;gt;(RexLiteral.java:223)
	at org.apache.calcite.rex.RexLiteral.toLiteral(RexLiteral.java:737)
	at org.apache.calcite.rex.RexLiteral.lambda$printSarg$4(RexLiteral.java:710)
	at org.apache.calcite.util.RangeSets$Printer.singleton(RangeSets.java:397)
	at org.apache.calcite.util.RangeSets.forEach(RangeSets.java:237)
	at org.apache.calcite.util.Sarg.lambda$printTo$0(Sarg.java:110)
	at org.apache.calcite.linq4j.Ord.forEach(Ord.java:157)
	at org.apache.calcite.util.Sarg.printTo(Sarg.java:106)
	at org.apache.calcite.rex.RexLiteral.printSarg(RexLiteral.java:709)
	at org.apache.calcite.rex.RexLiteral.lambda$appendAsJava$1(RexLiteral.java:652)
	at org.apache.calcite.util.Util.asStringBuilder(Util.java:2502)
	at org.apache.calcite.rex.RexLiteral.appendAsJava(RexLiteral.java:651)
	at org.apache.calcite.rex.RexLiteral.toJavaString(RexLiteral.java:408)
	at org.apache.calcite.rex.RexLiteral.computeDigest(RexLiteral.java:276)
	at org.apache.calcite.rex.RexLiteral.&amp;lt;init&amp;gt;(RexLiteral.java:223)
	at org.apache.calcite.rex.RexBuilder.makeLiteral(RexBuilder.java:971)
	at org.apache.calcite.rex.RexBuilder.makeSearchArgumentLiteral(RexBuilder.java:1066)
	at org.apache.calcite.rex.RexSimplify$SargCollector.fix(RexSimplify.java:2786)
	at org.apache.calcite.rex.RexSimplify.lambda$simplifyOrs$6(RexSimplify.java:1843)
	at java.util.ArrayList.forEach(ArrayList.java:1257)
	at org.apache.calcite.rex.RexSimplify.simplifyOrs(RexSimplify.java:1843)
	at org.apache.calcite.rex.RexSimplify.simplifyOr(RexSimplify.java:1817)
	at org.apache.calcite.rex.RexSimplify.simplify(RexSimplify.java:313)
	at org.apache.calcite.rex.RexSimplify.simplifyUnknownAs(RexSimplify.java:282)
	at org.apache.calcite.rex.RexSimplify.simplify(RexSimplify.java:257)
	at org.apache.flink.table.planner.plan.utils.FlinkRexUtil$.simplify(FlinkRexUtil.scala:213)
	at org.apache.flink.table.planner.plan.rules.logical.SimplifyFilterConditionRule.simplify(SimplifyFilterConditionRule.scala:63)
	at org.apache.flink.table.planner.plan.rules.logical.SimplifyFilterConditionRule.onMatch(SimplifyFilterConditionRule.scala:46)
	at org.apache.calcite.plan.AbstractRelOptPlanner.fireRule(AbstractRelOptPlanner.java:333)
	at org.apache.calcite.plan.hep.HepPlanner.applyRule(HepPlanner.java:542)
	at org.apache.calcite.plan.hep.HepPlanner.applyRules(HepPlanner.java:407)
	at org.apache.calcite.plan.hep.HepPlanner.executeInstruction(HepPlanner.java:243)
	at org.apache.calcite.plan.hep.HepInstruction$RuleInstance.execute(HepInstruction.java:127)
	at org.apache.calcite.plan.hep.HepPlanner.executeProgram(HepPlanner.java:202)
	at org.apache.calcite.plan.hep.HepPlanner.findBestExp(HepPlanner.java:189)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkHepProgram.optimize(FlinkHepProgram.scala:69)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkHepRuleSetProgram.optimize(FlinkHepRuleSetProgram.scala:87)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram$$anonfun$optimize$1$$anonfun$apply$1.apply(FlinkGroupProgram.scala:63)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram$$anonfun$optimize$1$$anonfun$apply$1.apply(FlinkGroupProgram.scala:60)
	at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
	at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
	at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:891)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1334)
	at scala.collection.IterableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(IterableLike.scala:72)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
	at scala.collection.TraversableOnce$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foldLeft(TraversableOnce.scala:157)
	at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram$$anonfun$optimize$1.apply(FlinkGroupProgram.scala:60)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram$$anonfun$optimize$1.apply(FlinkGroupProgram.scala:55)
	at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
	at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
	at scala.collection.immutable.Range.foreach(Range.scala:160)
	at scala.collection.TraversableOnce$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foldLeft(TraversableOnce.scala:157)
	at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkGroupProgram.optimize(FlinkGroupProgram.scala:55)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram$$anonfun$optimize$1.apply(FlinkChainedProgram.scala:62)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram$$anonfun$optimize$1.apply(FlinkChainedProgram.scala:58)
	at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
	at scala.collection.TraversableOnce$$anonfun$foldLeft$1.apply(TraversableOnce.scala:157)
	at scala.collection.Iterator$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(Iterator.scala:891)
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1334)
	at scala.collection.IterableLike$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foreach(IterableLike.scala:72)
	at scala.collection.AbstractIterable.foreach(Iterable.scala:54)
	at scala.collection.TraversableOnce$&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;foldLeft(TraversableOnce.scala:157)
	at scala.collection.AbstractTraversable.foldLeft(Traversable.scala:104)
	at org.apache.flink.table.planner.plan.optimize.program.FlinkChainedProgram.optimize(FlinkChainedProgram.scala:57)
	at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.optimizeTree(StreamCommonSubGraphBasedOptimizer.scala:163)
	at org.apache.flink.table.planner.plan.optimize.StreamCommonSubGraphBasedOptimizer.doOptimize(StreamCommonSubGraphBasedOptimizer.scala:79)
	at org.apache.flink.table.planner.plan.optimize.CommonSubGraphBasedOptimizer.optimize(CommonSubGraphBasedOptimizer.scala:77)
	at org.apache.flink.table.planner.delegation.PlannerBase.optimize(PlannerBase.scala:286)
	at org.apache.flink.table.planner.delegation.PlannerBase.translate(PlannerBase.scala:165)
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.translate(TableEnvironmentImpl.java:1329)
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeInternal(TableEnvironmentImpl.java:707)
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeOperation(TableEnvironmentImpl.java:1107)
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeSql(TableEnvironmentImpl.java:666)
	at org.apache.flink.table.examples.scala.basics.WordCountTable$.main(WordCountTable.scala:59)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13351797">FLINK-20942</key>
            <summary>Digest of FLOAT literals throws UnsupportedOperationException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="danny0405">Danny Chen</assignee>
                                    <reporter username="twalthr">Timo Walther</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 12 Jan 2021 15:08:12 +0000</created>
                <updated>Fri, 28 May 2021 08:16:17 +0000</updated>
                            <resolved>Tue, 2 Feb 2021 10:17:59 +0000</resolved>
                                                    <fixVersion>1.12.2</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17263400" author="twalthr" created="Tue, 12 Jan 2021 15:10:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny0405&quot; class=&quot;user-hover&quot; rel=&quot;danny0405&quot;&gt;danny0405&lt;/a&gt; could you forward this issue to the Calcite community?&lt;/p&gt;</comment>
                            <comment id="17263401" author="twalthr" created="Tue, 12 Jan 2021 15:12:06 +0000"  >&lt;p&gt;Since this limits the usage of a commonly used data type, I would suggest to fix this in Flink in one of the next minor releases.&lt;/p&gt;</comment>
                            <comment id="17270006" author="danny0405" created="Fri, 22 Jan 2021 08:54:04 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; for reporting this issue, i would take a look and fix it soon ~&lt;/p&gt;</comment>
                            <comment id="17270032" author="danny0405" created="Fri, 22 Jan 2021 09:42:12 +0000"  >&lt;p&gt;Hmm, the root cause is that the new introduced `Sarg` tries to make literals recursively, for this example, it tries to create `RexLiteral`s with `FLOAT` as type name which is not possible from the normally SQL context, so, this expects to be a bug, let me see how to fix it quickly in Flink side.&lt;/p&gt;</comment>
                            <comment id="17272647" author="danny0405" created="Wed, 27 Jan 2021 08:05:12 +0000"  >&lt;p&gt;I have fired a fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/CALCITE-4479&quot; title=&quot;&amp;quot;vFloat in (1.0, 2.0)&amp;quot; throws UnsupportedOperationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CALCITE-4479&quot;&gt;&lt;del&gt;CALCITE-4479&lt;/del&gt;&lt;/a&gt; but i have no idea how to fix quickly in Flink side, should we copy the &lt;tt&gt;RexLiteral&lt;/tt&gt; then ? The class is huge ..&lt;/p&gt;</comment>
                            <comment id="17272883" author="twalthr" created="Wed, 27 Jan 2021 14:10:25 +0000"  >&lt;p&gt;Thanks for investigating this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=danny0405&quot; class=&quot;user-hover&quot; rel=&quot;danny0405&quot;&gt;danny0405&lt;/a&gt;. Once the fix has been merged in Calcite, I&apos;m fine with copying the class to the Flink side. We have done that with a lot of classes in the past, including bigger classes such as SqlValidator. We should create a subtask for removing it in the next Calcite upgrade.&lt;/p&gt;</comment>
                            <comment id="17274208" author="danny0405" created="Fri, 29 Jan 2021 07:39:29 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;, i have fired a fix via &lt;a href=&quot;https://github.com/apache/flink/pull/14801&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/14801&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17277014" author="twalthr" created="Tue, 2 Feb 2021 10:17:59 +0000"  >&lt;p&gt;Fixed in 1.13.0: 017bb12310dcf91e5439d5147a3a4f22ad40ba75&lt;br/&gt;
Fixed in 1.12.2: 3624a08082bf4d977f078274d8c97f5c55681ff5&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mibc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>