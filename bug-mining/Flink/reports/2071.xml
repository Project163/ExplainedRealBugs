<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-7451] Query fails when non-ascii characters are used in string literals</title>
                <link>https://issues.apache.org/jira/browse/FLINK-7451</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I found that using non-ascii characters in string literals causes calcite planner to throw the following exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.calcite.runtime.CalciteException: Failed to encode &lt;span class=&quot;code-quote&quot;&gt;&apos;%&#27979;&#35797;%&apos;&lt;/span&gt; in character set &lt;span class=&quot;code-quote&quot;&gt;&apos;ISO-8859-1&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The query is &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * FROM T WHERE f0 LIKE &lt;span class=&quot;code-quote&quot;&gt;&apos;%&#27979;&#35797;%&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason for the issue is that calcite uses latin encoding (&apos;ISO-8859-1&apos;) by default. In order to pass non-latin characters we should use unicode encoding as default.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13094723">FLINK-7451</key>
            <summary>Query fails when non-ascii characters are used in string literals</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jark">Jark Wu</assignee>
                                    <reporter username="jark">Jark Wu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Aug 2017 10:08:39 +0000</created>
                <updated>Wed, 15 Nov 2017 13:55:12 +0000</updated>
                            <resolved>Wed, 15 Nov 2017 13:55:12 +0000</resolved>
                                                    <fixVersion>1.4.0</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16127040" author="twalthr" created="Tue, 15 Aug 2017 10:17:03 +0000"  >&lt;p&gt;We had this issue recently on the ML. This should be fixed in Calcite&apos;s runtime functions.&lt;/p&gt;</comment>
                            <comment id="16127100" author="githubbot" created="Tue, 15 Aug 2017 11:32:10 +0000"  >&lt;p&gt;GitHub user wuchong opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4544&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7451&quot; title=&quot;Query fails when non-ascii characters are used in string literals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7451&quot;&gt;&lt;del&gt;FLINK-7451&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Support non-ascii character literals in Table API and SQL&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    The non-ascii characters in string literals causes calcite planner to throw the following exception:&lt;/p&gt;

&lt;p&gt;     ```&lt;br/&gt;
    Failed to encode &apos;%&#27979;&#35797;%&apos; in character set &apos;ISO-8859-1&apos;&lt;br/&gt;
    ```&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add default charset for FlinkTypeFactory&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added expression test for non-ascii literals&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? na&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/wuchong/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wuchong/flink&lt;/a&gt; non-ascii&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4544.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4544.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #4544&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 6013d2693a4eb3622dc1cbb7d27829ee5b566713&lt;br/&gt;
Author: Jark Wu &amp;lt;jark@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-08-15T11:24:57Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-7451&quot; title=&quot;Query fails when non-ascii characters are used in string literals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-7451&quot;&gt;&lt;del&gt;FLINK-7451&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Support non-ascii character literals in Table API and SQL&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16127223" author="jark" created="Tue, 15 Aug 2017 13:41:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt;, is it &lt;a href=&quot;https://issues.apache.org/jira/browse/CALCITE-1903&quot; title=&quot;Support charset in LIKE expression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CALCITE-1903&quot;&gt;CALCITE-1903&lt;/a&gt;?  It seems that Calcite didn&apos;t want to fix it, because it is not allowed in SQL? &lt;/p&gt;</comment>
                            <comment id="16139701" author="jark" created="Thu, 24 Aug 2017 07:23:01 +0000"  >&lt;p&gt;I found that we can add a &lt;tt&gt;_UTF16&lt;/tt&gt; prefix can fix the problem. Such as the following code works:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * FROM T WHERE f0 LIKE _UTF16&lt;span class=&quot;code-quote&quot;&gt;&apos;%&#27979;&#35797;%&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16178661" author="githubbot" created="Mon, 25 Sep 2017 07:21:23 +0000"  >&lt;p&gt;Github user haohui commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4544#discussion_r140703450&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4544#discussion_r140703450&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/calcite/FlinkTypeFactory.scala &amp;#8212;&lt;br/&gt;
    @@ -269,6 +272,10 @@ class FlinkTypeFactory(typeSystem: RelDataTypeSystem) extends JavaTypeFactoryImp&lt;/p&gt;

&lt;p&gt;         canonize(newType)&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  override def getDefaultCharset: Charset = {&lt;br/&gt;
    +    Charset.forName(ConversionUtil.NATIVE_UTF16_CHARSET_NAME)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Should we do UTF-8 by default?&lt;/p&gt;

&lt;p&gt;    You can just use `java.nio.charset.StandardCharsets.UTF_8` to avoid introducing additional dependency.&lt;/p&gt;</comment>
                            <comment id="16178740" author="githubbot" created="Mon, 25 Sep 2017 08:42:57 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4544#discussion_r140717599&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4544#discussion_r140717599&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/calcite/FlinkTypeFactory.scala &amp;#8212;&lt;br/&gt;
    @@ -269,6 +272,10 @@ class FlinkTypeFactory(typeSystem: RelDataTypeSystem) extends JavaTypeFactoryImp&lt;/p&gt;

&lt;p&gt;         canonize(newType)&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  override def getDefaultCharset: Charset = {&lt;br/&gt;
    +    Charset.forName(ConversionUtil.NATIVE_UTF16_CHARSET_NAME)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    +1 doesn&apos;t having UTF-8 everywhere solve all problems?&lt;/p&gt;</comment>
                            <comment id="16253305" author="githubbot" created="Wed, 15 Nov 2017 11:22:57 +0000"  >&lt;p&gt;Github user twalthr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4544&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I will finalize this PR and merge it.&lt;/p&gt;</comment>
                            <comment id="16253456" author="githubbot" created="Wed, 15 Nov 2017 13:44:07 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4544#discussion_r151128673&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4544#discussion_r151128673&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/calcite/FlinkTypeFactory.scala &amp;#8212;&lt;br/&gt;
    @@ -269,6 +272,10 @@ class FlinkTypeFactory(typeSystem: RelDataTypeSystem) extends JavaTypeFactoryImp&lt;/p&gt;

&lt;p&gt;         canonize(newType)&lt;br/&gt;
       }&lt;br/&gt;
    +&lt;br/&gt;
    +  override def getDefaultCharset: Charset = {&lt;br/&gt;
    +    Charset.forName(ConversionUtil.NATIVE_UTF16_CHARSET_NAME)&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Calcite only supports UTF-16, I guess because this is the default of Java Strings anyway.&lt;/p&gt;</comment>
                            <comment id="16253465" author="githubbot" created="Wed, 15 Nov 2017 13:50:23 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/4544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/4544&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16253474" author="twalthr" created="Wed, 15 Nov 2017 13:55:12 +0000"  >&lt;p&gt;Fixed in 1.5: c32fcbc2673233bb1c16a8b96fb2b7e88a55fdca &amp;amp; 9d34715747040352f6c0ca13c052763cd8049dad&lt;br/&gt;
Fixed in 1.4: 81e3a889116466037c59514b28312257005529c0 &amp;amp; 49aeb8f1d98fe99eaf97c3009ba23008652964e7&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3istr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>