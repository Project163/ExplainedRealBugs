<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:22:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-3554] Bounded sources should emit a Max Watermark when they are done</title>
                <link>https://issues.apache.org/jira/browse/FLINK-3554</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;For proper event time support in bounded sources, these sources should emit a final watermark before shutting down.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12945797">FLINK-3554</key>
            <summary>Bounded sources should emit a Max Watermark when they are done</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sewen">Stephan Ewen</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Mar 2016 10:31:26 +0000</created>
                <updated>Thu, 28 Feb 2019 11:15:38 +0000</updated>
                            <resolved>Tue, 1 Mar 2016 16:22:44 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15173563" author="stephanewen" created="Tue, 1 Mar 2016 10:35:00 +0000"  >&lt;p&gt;A good point to emit the &lt;tt&gt;Long.MAX_VALUE&lt;/tt&gt; watermark is in the source operator, after the &lt;tt&gt;run()&lt;/tt&gt; function has properly exited (that only ever happens on bounded sources).&lt;/p&gt;

&lt;p&gt;In addition, the operator must not be &lt;b&gt;stopped&lt;/b&gt; or &lt;b&gt;canceled&lt;/b&gt;.&lt;/p&gt;</comment>
                            <comment id="15173752" author="githubbot" created="Tue, 1 Mar 2016 13:34:03 +0000"  >&lt;p&gt;GitHub user StephanEwen opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3554&quot; title=&quot;Bounded sources should emit a Max Watermark when they are done&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3554&quot;&gt;&lt;del&gt;FLINK-3554&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; Emit a MAX Watermark after finite sources finished&lt;/p&gt;

&lt;p&gt;    Finite sources now emit a MAX_LONG watermark once they cleanly finished.&lt;/p&gt;

&lt;p&gt;    This prevents loss of pending windows over finite sources when they finish.&lt;/p&gt;

&lt;p&gt;    Canceling and stopping sources will NOT emit a MAX Watermark.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StephanEwen/incubator-flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StephanEwen/incubator-flink&lt;/a&gt; finite_max_watermark&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1750&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f3a255c5317d3e883e03ee73ac1737cda563d7ca&lt;br/&gt;
Author: Stephan Ewen &amp;lt;sewen@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-03-01T13:31:26Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-3554&quot; title=&quot;Bounded sources should emit a Max Watermark when they are done&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-3554&quot;&gt;&lt;del&gt;FLINK-3554&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; Emit a MAX Watermark after finite sources finished&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15173757" author="githubbot" created="Tue, 1 Mar 2016 13:37:40 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#discussion_r54566693&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#discussion_r54566693&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/StoppableStreamSource.java &amp;#8212;&lt;br/&gt;
    @@ -41,7 +41,14 @@ public StoppableStreamSource(SRC sourceFunction) &lt;/p&gt;
{
     		super(sourceFunction);
     	}

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Marks the source a stopped and calls &lt;/p&gt;
{@link StoppableFunction#stop()}
&lt;p&gt; on the user function.&lt;br/&gt;
    +	 */&lt;br/&gt;
     	public void stop() {&lt;br/&gt;
    +		// important: marking the source as stopped has to happen before the function is stopped.&lt;br/&gt;
    +		// the flag that tracks this status is volatile, to the memory model also guarantees&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    typo in comment: to =&amp;gt; so&lt;/p&gt;</comment>
                            <comment id="15173758" author="githubbot" created="Tue, 1 Mar 2016 13:37:51 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#discussion_r54566728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#discussion_r54566728&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/StreamSource.java &amp;#8212;&lt;br/&gt;
    @@ -66,19 +71,60 @@ public void run(final Object lockingObject, final Output&amp;lt;StreamRecord&amp;lt;OUT&amp;gt;&amp;gt; coll&lt;br/&gt;
     				throw new Exception(String.valueOf(timeCharacteristic));&lt;br/&gt;
     		}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;userFunction.run(ctx);&lt;br/&gt;
    -&lt;/li&gt;
	&lt;li&gt;ctx.close();&lt;br/&gt;
    +		// copy to a field to give the &apos;cancel()&apos; method access&lt;br/&gt;
    +		this.ctx = ctx;&lt;br/&gt;
    +		&lt;br/&gt;
    +		try 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +			userFunction.run(ctx);    +    +			// if we get here, then the user function either exited after being done (finite source)    +			// or the function was canceled or stopped. For the finite source case, we should emit    +			// a final watermark that indicates that we reached the end of event-time    +			if (!isCanceledOrStopped()) {
    +				ctx.emitWatermark(Watermark.MAX_WATERMARK);
    +			}    +		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt; finally &lt;/p&gt;
{
    +			// make sure that the context is closed in any case
    +			ctx.close();
    +		}
&lt;p&gt;     	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	public void cancel() {&lt;br/&gt;
    +		// important: marking the source as stopped has to happen before the function is stopped.&lt;br/&gt;
    +		// the flag that tracks this status is volatile, to the memory model also guarantees&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    typo in comment: to =&amp;gt; so&lt;/p&gt;</comment>
                            <comment id="15173761" author="githubbot" created="Tue, 1 Mar 2016 13:39:17 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#discussion_r54566902&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#discussion_r54566902&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/test/java/org/apache/flink/streaming/api/SourceFunctionTest.java &amp;#8212;&lt;br/&gt;
    @@ -61,9 +61,9 @@ public void generateSequenceTest() throws Exception &lt;/p&gt;
{
     		assertEquals(expectedList, actualList);
     	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Test&lt;/li&gt;
	&lt;li&gt;public void socketTextStreamTest() throws Exception {&lt;/li&gt;
	&lt;li&gt;// TODO: does not work because we cannot set the internal socket anymore&lt;br/&gt;
    +// TODO: does not work because we cannot set the internal socket anymore&lt;br/&gt;
    +//	@Test&lt;br/&gt;
    +//	public void socketTextStreamTest() throws Exception {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why not removing this test?&lt;/p&gt;</comment>
                            <comment id="15173773" author="githubbot" created="Tue, 1 Mar 2016 13:46:33 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-190729444&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-190729444&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Changes look good to me. Really good fix @StephanEwen &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; +1 for merging.&lt;/p&gt;</comment>
                            <comment id="15173794" author="githubbot" created="Tue, 1 Mar 2016 14:06:43 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-190735172&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-190735172&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1&lt;/p&gt;
</comment>
                            <comment id="15173823" author="githubbot" created="Tue, 1 Mar 2016 14:31:44 +0000"  >&lt;p&gt;Github user rmetzger commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-190742740&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-190742740&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks like the tests are failing&lt;/p&gt;</comment>
                            <comment id="15173866" author="githubbot" created="Tue, 1 Mar 2016 15:03:13 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-190757834&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-190757834&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Adjusting the tests now. Some were actually assuming the old (wrong) behavior.&lt;/p&gt;</comment>
                            <comment id="15173972" author="stephanewen" created="Tue, 1 Mar 2016 16:22:44 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;1.0.0 via 43e5975d5426e22eb4ef90e0f468bd7f6cd35736&lt;/li&gt;
	&lt;li&gt;1.1.0 via ff80dc042aff570b7de2b47697e432e18fce5856&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15173973" author="githubbot" created="Tue, 1 Mar 2016 16:23:03 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15175230" author="githubbot" created="Wed, 2 Mar 2016 07:57:49 +0000"  >&lt;p&gt;Github user wenlonglwl commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-191117579&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-191117579&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    WaterMark seems do not work well with count window ?&lt;/p&gt;</comment>
                            <comment id="15175663" author="githubbot" created="Wed, 2 Mar 2016 14:30:09 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-191260012&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-191260012&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi,&lt;br/&gt;
    what are you referring to? The watermark does not interact with count windows.&lt;/p&gt;</comment>
                            <comment id="15176939" author="githubbot" created="Thu, 3 Mar 2016 01:44:59 +0000"  >&lt;p&gt;Github user wenlonglwl commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-191534452&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-191534452&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    just want to remind, this dose not completely solve the problem of loss of pending windows over finite sources~ looking forward to the solutions~&lt;/p&gt;</comment>
                            <comment id="15177609" author="githubbot" created="Thu, 3 Mar 2016 10:16:32 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-191693706&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-191693706&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, you are right and we are thinking about it.&lt;/p&gt;</comment>
                            <comment id="15177614" author="githubbot" created="Thu, 3 Mar 2016 10:21:10 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-191694897&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-191694897&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    It is a matter of how we want to define the semantics.&lt;/p&gt;

&lt;p&gt;    For windows that do not depend on event time, should incomplete windows be emitted or not? There are arguments for both. So far, most users requested to not have incomplete windows emitted.&lt;/p&gt;</comment>
                            <comment id="15177619" author="githubbot" created="Thu, 3 Mar 2016 10:23:55 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-191695612&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-191695612&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, right now we favor correctness over completeness. For example in a Count window, if we emitted an unfinished count window then the count of the elements in the window would not be what the user specified.&lt;/p&gt;

&lt;p&gt;    For Event-Time windows we are correct in emitting a window upon arrival of the final Long.MAX_VALUE watermark.&lt;/p&gt;</comment>
                            <comment id="15177858" author="githubbot" created="Thu, 3 Mar 2016 14:19:02 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-191781217&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-191781217&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    So, the semantics are that at the end of a finite source, the &quot;end of event time&quot; is reached, which would make the emission of pending event time semantically correct.&lt;/p&gt;

&lt;p&gt;    So far there is nothing equivalent for processing time.&lt;/p&gt;</comment>
                            <comment id="15179690" author="githubbot" created="Fri, 4 Mar 2016 10:29:54 +0000"  >&lt;p&gt;Github user wenlonglwl commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-192224050&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-192224050&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In our production environment, window is used to make a small batch, for some operator that should be done in batch to improve the throughput, such as writing data to HBase, whether the count reach or not, is not significant, but no losing data is. I think this is a common user story.&lt;/p&gt;
</comment>
                            <comment id="15179764" author="githubbot" created="Fri, 4 Mar 2016 11:25:21 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-192241682&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-192241682&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Yes, that&apos;s  a problem. Could you maybe open an issue for that here: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In the meantime, I have a workaround for you. You can use a modified version of the CountTrigger:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    public class ClosingCountTrigger&amp;lt;W extends Window&amp;gt; extends Trigger&amp;lt;Object, W&amp;gt; {&lt;br/&gt;
    	private static final long serialVersionUID = 1L;&lt;/p&gt;

&lt;p&gt;    	private final long maxCount;&lt;/p&gt;

&lt;p&gt;    	private final ValueStateDescriptor&amp;lt;Long&amp;gt; stateDesc =&lt;br/&gt;
    			new ValueStateDescriptor&amp;lt;&amp;gt;(&quot;count&quot;, LongSerializer.INSTANCE, 0L);&lt;/p&gt;


&lt;p&gt;    	private ClosingCountTrigger(long maxCount) &lt;/p&gt;
{
    		this.maxCount = maxCount;
    	}

&lt;p&gt;    	@Override&lt;br/&gt;
    	public TriggerResult onElement(Object element, long timestamp, W window, TriggerContext ctx) throws IOException {&lt;br/&gt;
    		ValueState&amp;lt;Long&amp;gt; count = ctx.getPartitionedState(stateDesc);&lt;br/&gt;
    		long currentCount = count.value() + 1;&lt;br/&gt;
    		count.update(currentCount);&lt;br/&gt;
    		if (currentCount &amp;gt;= maxCount) &lt;/p&gt;
{
    			count.update(0L);
    			return TriggerResult.FIRE_AND_PURGE;
    		}

&lt;p&gt;    		// register timer for final watermark&lt;br/&gt;
    		ctx.registerEventTimeTimer(Long.MAX_VALUE);&lt;br/&gt;
    		return TriggerResult.CONTINUE;&lt;br/&gt;
    	}&lt;/p&gt;

&lt;p&gt;    	@Override&lt;br/&gt;
    	public TriggerResult onEventTime(long time, W window, TriggerContext ctx) &lt;/p&gt;
{
    		// final triggering
    		return TriggerResult.FIRE_AND_PURGE;
    	}

&lt;p&gt;    	@Override&lt;br/&gt;
    	public TriggerResult onProcessingTime(long time, W window, TriggerContext ctx) throws Exception &lt;/p&gt;
{
    		return TriggerResult.CONTINUE;
    	}

&lt;p&gt;    	@Override&lt;br/&gt;
    	public void clear(W window, TriggerContext ctx) throws Exception &lt;/p&gt;
{
    		ctx.getPartitionedState(stateDesc).clear();
    		ctx.deleteEventTimeTimer(Long.MAX_VALUE);
    	}

&lt;p&gt;    	@Override&lt;br/&gt;
    	public String toString() &lt;/p&gt;
{
    		return &quot;ClosingCountTrigger(&quot; +  maxCount + &quot;)&quot;;
    	}

&lt;p&gt;    	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Creates a trigger that fires once the number of elements in a pane reaches the given count.&lt;br/&gt;
    	 *&lt;/li&gt;
	&lt;li&gt;@param maxCount The count of elements at which to fire.&lt;/li&gt;
	&lt;li&gt;@param &amp;lt;W&amp;gt; The type of 
{@link Window Windows}
&lt;p&gt; on which this trigger can operate.&lt;br/&gt;
    	 */&lt;br/&gt;
    	public static &amp;lt;W extends Window&amp;gt; ClosingCountTrigger&amp;lt;W&amp;gt; of(long maxCount) &lt;/p&gt;
{
    		return new ClosingCountTrigger&amp;lt;&amp;gt;(maxCount);
    	}
&lt;p&gt;    }&lt;br/&gt;
    ```&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    you can use it like this:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    stream&lt;br/&gt;
        .keyBy(...)&lt;br/&gt;
        .window(GlobalWindows.create())&lt;br/&gt;
        .trigger(ClosingCountTrigger.of(&amp;lt;my count&amp;gt;)&lt;br/&gt;
        .apply() // or .reduce()&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    This will behave like the normal count trigger but also register a callback for the final `Long.MAX_VALUE` watermark. Then, when the final watermark arrives it will trigger one last window emission.&lt;/p&gt;</comment>
                            <comment id="15181638" author="githubbot" created="Sat, 5 Mar 2016 08:37:27 +0000"  >&lt;p&gt;Github user wenlonglwl commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/1750#issuecomment-192608229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/1750#issuecomment-192608229&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    got it~ 3q @aljoscha &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 37 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tyxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>