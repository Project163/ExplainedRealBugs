<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:20:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2371] AccumulatorLiveITCase fails</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2371</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;AccumulatorLiveITCase fails regularly (however, not in each run). The tests relies on timing (via sleep) which does not work well on Travis.&lt;/p&gt;

&lt;p&gt;See dev-list for more details: &lt;a href=&quot;https://mail-archives.apache.org/mod_mbox/flink-dev/201507.mbox/browser&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mail-archives.apache.org/mod_mbox/flink-dev/201507.mbox/browser&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AccumulatorLiveITCase.testProgram:106-&amp;gt;access$1100:68-&amp;gt;checkFlinkAccumulators:189&lt;/p&gt;</description>
                <environment></environment>
        <key id="12845842">FLINK-2371</key>
            <summary>AccumulatorLiveITCase fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mxm">Maximilian Michels</assignee>
                                    <reporter username="mjsax">Matthias J. Sax</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Jul 2015 09:24:49 +0000</created>
                <updated>Wed, 22 Jul 2015 10:02:29 +0000</updated>
                            <resolved>Tue, 21 Jul 2015 14:38:32 +0000</resolved>
                                                                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14633752" author="githubbot" created="Mon, 20 Jul 2015 16:09:22 +0000"  >&lt;p&gt;GitHub user mxm opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2371&quot; title=&quot;AccumulatorLiveITCase fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2371&quot;&gt;&lt;del&gt;FLINK-2371&lt;/del&gt;&lt;/a&gt; improve AccumulatorLiveITCase&lt;/p&gt;

&lt;p&gt;    Instead of using Thread.sleep() to synchronize the checks of the&lt;br/&gt;
    accumulator values, we rely on message passing here to synchronize the&lt;br/&gt;
    task process.&lt;/p&gt;

&lt;p&gt;    Therefore, we let the task process signal to the task manager that it&lt;br/&gt;
    has updated its accumulator values. The task manager lets the job&lt;br/&gt;
    manager know and sends out the heartbeat which contains the&lt;br/&gt;
    accumulators. When the job manager receives the accumulators and has&lt;br/&gt;
    been notified previously, it sends a message to the subscribed test case&lt;br/&gt;
    with the current accumulators.&lt;/p&gt;

&lt;p&gt;    This assures that all processes are always synchronized correctly and we&lt;br/&gt;
    can verify the live accumulator results correctly.&lt;/p&gt;

&lt;p&gt;    In the course of rewriting the test, I had to change two things in the&lt;br/&gt;
    implementation:&lt;/p&gt;

&lt;p&gt;    a) User accumulators are now immediately serialized as well. Otherwise,&lt;br/&gt;
    Akka does not serialize in local one VM setups and passes the live&lt;br/&gt;
    accumulator map through.&lt;/p&gt;

&lt;p&gt;    b) The asynchronous update of the accumulators can be disabled for&lt;br/&gt;
    tests. This was necessary because we cannot guarantee when the Future&lt;br/&gt;
    for updating the accumulators is executed. In real setups this is&lt;br/&gt;
    neglectable.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mxm/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mxm/flink&lt;/a&gt; live-accumulators&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #925&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 44687e783065a4157d2d3a695d9e94070ca6e8cd&lt;br/&gt;
Author: Maximilian Michels &amp;lt;mxm@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-07-20T09:55:11Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2371&quot; title=&quot;AccumulatorLiveITCase fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2371&quot;&gt;&lt;del&gt;FLINK-2371&lt;/del&gt;&lt;/a&gt; improve AccumulatorLiveITCase&lt;/p&gt;

&lt;p&gt;    Instead of using Thread.sleep() to synchronize the checks of the&lt;br/&gt;
    accumulator values, we rely on message passing here to synchronize the&lt;br/&gt;
    task process.&lt;/p&gt;

&lt;p&gt;    Therefore, we let the task process signal to the task manager that it&lt;br/&gt;
    has updated its accumulator values. The task manager lets the job&lt;br/&gt;
    manager know and sends out the heartbeat which contains the&lt;br/&gt;
    accumulators. When the job manager receives the accumulators and has&lt;br/&gt;
    been notified previously, it sends a message to the subscribed test case&lt;br/&gt;
    with the current accumulators.&lt;/p&gt;

&lt;p&gt;    This assures that all processes are always synchronized correctly and we&lt;br/&gt;
    can verify the live accumulator results correctly.&lt;/p&gt;

&lt;p&gt;    In the course of rewriting the test, I had to change two things in the&lt;br/&gt;
    implementation:&lt;/p&gt;

&lt;p&gt;    a) User accumulators are now immediately serialized as well. Otherwise,&lt;br/&gt;
    Akka does not serialize in local one VM setups and passes the live&lt;br/&gt;
    accumulator map through.&lt;/p&gt;

&lt;p&gt;    b) The asynchronous update of the accumulators can be disabled for&lt;br/&gt;
    tests. This was necessary because we cannot guarantee when the Future&lt;br/&gt;
    for updating the accumulators is executed. In real setups this is&lt;br/&gt;
    neglectable.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14634755" author="githubbot" created="Tue, 21 Jul 2015 08:24:16 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#discussion_r35079328&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#discussion_r35079328&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-tests/src/test/java/org/apache/flink/test/accumulators/AccumulatorLiveITCase.java &amp;#8212;&lt;br/&gt;
    @@ -109,125 +123,157 @@ public void testProgram() throws Exception {&lt;br/&gt;
     			ExecutionEnvironment env = new PlanExtractor();&lt;br/&gt;
     			DataSet&amp;lt;String&amp;gt; input = env.fromCollection(inputData);&lt;br/&gt;
     			input&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.flatMap(new Tokenizer())&lt;br/&gt;
     					.flatMap(new WaitingUDF())&lt;br/&gt;
     					.output(new WaitingOutputFormat());&lt;br/&gt;
     			env.execute();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/** Extract job graph **/&lt;br/&gt;
    +			// Extract job graph and set job id for the task to notify of accumulator changes.&lt;br/&gt;
     			JobGraph jobGraph = getOptimizedPlan(((PlanExtractor) env).plan);&lt;br/&gt;
    +			jobID = jobGraph.getJobID();&lt;br/&gt;
    +&lt;br/&gt;
    +			// register for accumulator changes&lt;br/&gt;
    +			jobManager.tell(new TestingJobManagerMessages.NotifyWhenAccumulatorChange(jobID), getRef());&lt;br/&gt;
    +			expectMsgEquals(true);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    When you wait for messages then this should always happen within a `within` block. Otherwise this might never terminate in a failure case.&lt;/p&gt;</comment>
                            <comment id="14634756" author="githubbot" created="Tue, 21 Jul 2015 08:24:43 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#discussion_r35079360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#discussion_r35079360&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-tests/src/test/java/org/apache/flink/test/accumulators/AccumulatorLiveITCase.java &amp;#8212;&lt;br/&gt;
    @@ -109,125 +123,157 @@ public void testProgram() throws Exception {&lt;br/&gt;
     			ExecutionEnvironment env = new PlanExtractor();&lt;br/&gt;
     			DataSet&amp;lt;String&amp;gt; input = env.fromCollection(inputData);&lt;br/&gt;
     			input&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.flatMap(new Tokenizer())&lt;br/&gt;
     					.flatMap(new WaitingUDF())&lt;br/&gt;
     					.output(new WaitingOutputFormat());&lt;br/&gt;
     			env.execute();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/** Extract job graph **/&lt;br/&gt;
    +			// Extract job graph and set job id for the task to notify of accumulator changes.&lt;br/&gt;
     			JobGraph jobGraph = getOptimizedPlan(((PlanExtractor) env).plan);&lt;br/&gt;
    +			jobID = jobGraph.getJobID();&lt;br/&gt;
    +&lt;br/&gt;
    +			// register for accumulator changes&lt;br/&gt;
    +			jobManager.tell(new TestingJobManagerMessages.NotifyWhenAccumulatorChange(jobID), getRef());&lt;br/&gt;
    +			expectMsgEquals(true);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +			// submit job&lt;br/&gt;
     			jobManager.tell(new JobManagerMessages.SubmitJob(jobGraph, false), getRef());&lt;br/&gt;
     			expectMsgClass(Status.Success.class);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Same here. Best if you nest all actor interaction in a `within` block.&lt;/p&gt;</comment>
                            <comment id="14634763" author="githubbot" created="Tue, 21 Jul 2015 08:28:30 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#discussion_r35079637&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#discussion_r35079637&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -400,20 +400,16 @@ class JobManager(&lt;br/&gt;
           import scala.collection.JavaConverters._&lt;br/&gt;
           sender ! RegisteredTaskManagers(instanceManager.getAllRegisteredInstances.asScala)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case Heartbeat(instanceID, metricsReport, accumulators) =&amp;gt;&lt;br/&gt;
    +    case Heartbeat(instanceID, metricsReport, accumulators, asyncAccumulatorUpdate) =&amp;gt;&lt;br/&gt;
           log.debug(s&quot;Received hearbeat message from $instanceID.&quot;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Future {&lt;/li&gt;
	&lt;li&gt;accumulators foreach {&lt;/li&gt;
	&lt;li&gt;case accumulators =&amp;gt;&lt;/li&gt;
	&lt;li&gt;currentJobs.get(accumulators.getJobID) match 
{
    -                case Some((jobGraph, jobInfo)) =&amp;gt;
    -                  jobGraph.updateAccumulators(accumulators)
    -                case None =&amp;gt;
    -                  // ignore accumulator values for old job
    -              }&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    +      if (asyncAccumulatorUpdate) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Mixing test code in your production code is IMO bad style. If you need synchronous execution, then start the actor with a `CallingThreadDispatcher` or overwrite this message in the `TestingJobManager`.&lt;/p&gt;</comment>
                            <comment id="14634766" author="githubbot" created="Tue, 21 Jul 2015 08:30:41 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#issuecomment-123212399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#issuecomment-123212399&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Is it bad that the accumulators are not serialized in a local setup? If not and you only want to test the serialization in a distributed setting, then you can also simply start the testing cluster with multiple `ActorSystems`. This should enforce serialization, if I&apos;m not mistaken.&lt;/p&gt;</comment>
                            <comment id="14634771" author="githubbot" created="Tue, 21 Jul 2015 08:35:18 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#issuecomment-123213630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#issuecomment-123213630&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    In the master, I only serialize the user-defined accumulators but not the Flink accumulators. As of this pull request, the accumulators are always serialized even in local setups. Starting multiple actor systems did not solve the problem because Akka always optimizes message passing in local one VM setups, i.e. it does not serialize objects even across actor systems.&lt;/p&gt;</comment>
                            <comment id="14634772" author="githubbot" created="Tue, 21 Jul 2015 08:37:37 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#discussion_r35080374&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#discussion_r35080374&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -400,20 +400,16 @@ class JobManager(&lt;br/&gt;
           import scala.collection.JavaConverters._&lt;br/&gt;
           sender ! RegisteredTaskManagers(instanceManager.getAllRegisteredInstances.asScala)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case Heartbeat(instanceID, metricsReport, accumulators) =&amp;gt;&lt;br/&gt;
    +    case Heartbeat(instanceID, metricsReport, accumulators, asyncAccumulatorUpdate) =&amp;gt;&lt;br/&gt;
           log.debug(s&quot;Received hearbeat message from $instanceID.&quot;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Future {&lt;/li&gt;
	&lt;li&gt;accumulators foreach {&lt;/li&gt;
	&lt;li&gt;case accumulators =&amp;gt;&lt;/li&gt;
	&lt;li&gt;currentJobs.get(accumulators.getJobID) match 
{
    -                case Some((jobGraph, jobInfo)) =&amp;gt;
    -                  jobGraph.updateAccumulators(accumulators)
    -                case None =&amp;gt;
    -                  // ignore accumulator values for old job
    -              }&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    +      if (asyncAccumulatorUpdate) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Thanks, I was looking for a way to make the future synchronous for my test setup. I will look into `CallingThreadDispatcher`. I&apos;m already overwriting this message in `TestingJobManager` but then I would have to insert duplicate code there &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14634773" author="githubbot" created="Tue, 21 Jul 2015 08:38:35 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#discussion_r35080434&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#discussion_r35080434&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-tests/src/test/java/org/apache/flink/test/accumulators/AccumulatorLiveITCase.java &amp;#8212;&lt;br/&gt;
    @@ -109,125 +123,157 @@ public void testProgram() throws Exception {&lt;br/&gt;
     			ExecutionEnvironment env = new PlanExtractor();&lt;br/&gt;
     			DataSet&amp;lt;String&amp;gt; input = env.fromCollection(inputData);&lt;br/&gt;
     			input&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;.flatMap(new Tokenizer())&lt;br/&gt;
     					.flatMap(new WaitingUDF())&lt;br/&gt;
     					.output(new WaitingOutputFormat());&lt;br/&gt;
     			env.execute();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;/** Extract job graph **/&lt;br/&gt;
    +			// Extract job graph and set job id for the task to notify of accumulator changes.&lt;br/&gt;
     			JobGraph jobGraph = getOptimizedPlan(((PlanExtractor) env).plan);&lt;br/&gt;
    +			jobID = jobGraph.getJobID();&lt;br/&gt;
    +&lt;br/&gt;
    +			// register for accumulator changes&lt;br/&gt;
    +			jobManager.tell(new TestingJobManagerMessages.NotifyWhenAccumulatorChange(jobID), getRef());&lt;br/&gt;
    +			expectMsgEquals(true);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Thanks, I&apos;ve added a timeout to each call of `expectMsgEquals` and `receive`.&lt;/p&gt;</comment>
                            <comment id="14634787" author="githubbot" created="Tue, 21 Jul 2015 08:46:07 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#discussion_r35081074&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#discussion_r35081074&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/jobmanager/JobManager.scala &amp;#8212;&lt;br/&gt;
    @@ -400,20 +400,16 @@ class JobManager(&lt;br/&gt;
           import scala.collection.JavaConverters._&lt;br/&gt;
           sender ! RegisteredTaskManagers(instanceManager.getAllRegisteredInstances.asScala)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;case Heartbeat(instanceID, metricsReport, accumulators) =&amp;gt;&lt;br/&gt;
    +    case Heartbeat(instanceID, metricsReport, accumulators, asyncAccumulatorUpdate) =&amp;gt;&lt;br/&gt;
           log.debug(s&quot;Received hearbeat message from $instanceID.&quot;)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Future {&lt;/li&gt;
	&lt;li&gt;accumulators foreach {&lt;/li&gt;
	&lt;li&gt;case accumulators =&amp;gt;&lt;/li&gt;
	&lt;li&gt;currentJobs.get(accumulators.getJobID) match 
{
    -                case Some((jobGraph, jobInfo)) =&amp;gt;
    -                  jobGraph.updateAccumulators(accumulators)
    -                case None =&amp;gt;
    -                  // ignore accumulator values for old job
    -              }&lt;/li&gt;
	&lt;li&gt;}&lt;/li&gt;
	&lt;li&gt;}(context.dispatcher)&lt;br/&gt;
    +      if (asyncAccumulatorUpdate) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    In the worst case, code duplication in the `TestingJobManager` seems to me the lesser of two evils.&lt;/p&gt;</comment>
                            <comment id="14634862" author="githubbot" created="Tue, 21 Jul 2015 09:43:40 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#issuecomment-123243258&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#issuecomment-123243258&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve updated the pull request:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add flag to FlinkMiniCluster to disabled asynchronous execution of futures via the CallingThreadDispatcher&lt;/li&gt;
	&lt;li&gt;revert changes to Heartbeat message that enabled explicit synchronous update of accumulators&lt;/li&gt;
	&lt;li&gt;update test to use synchronous execution mode for futures to receive accumulator updates immediately&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14634880" author="githubbot" created="Tue, 21 Jul 2015 09:56:44 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#discussion_r35086920&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#discussion_r35086920&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/minicluster/FlinkMiniCluster.scala &amp;#8212;&lt;br/&gt;
    @@ -51,10 +51,13 @@ import scala.concurrent.&lt;/p&gt;
{ExecutionContext, Future, Await}
&lt;p&gt;     abstract class FlinkMiniCluster(&lt;br/&gt;
         val userConfiguration: Configuration,&lt;br/&gt;
         val singleActorSystem: Boolean,&lt;br/&gt;
    +    val synchronousDispatcher: Boolean,&lt;br/&gt;
         val streamingMode: StreamingMode) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;def this(userConfiguration: Configuration, singleActorSystem: Boolean)&lt;/li&gt;
	&lt;li&gt;= this(userConfiguration, singleActorSystem, StreamingMode.BATCH_ONLY)&lt;br/&gt;
    +  def this(userConfiguration: Configuration,&lt;br/&gt;
    +           singleActorSystem: Boolean,&lt;br/&gt;
    +           synchronousDispatcher: Boolean)&lt;br/&gt;
    +       = this(userConfiguration, singleActorSystem, synchronousDispatcher, StreamingMode.BATCH_ONLY)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    I think the field `synchronousDispatcher` should not be part of the `FlinkMiniCluster`. The field seems to be only used for testing, referenced in `TestingCluster`, but the `FlinkMiniCluster` is also used to execute Flink programs locally.&lt;/p&gt;</comment>
                            <comment id="14634902" author="githubbot" created="Tue, 21 Jul 2015 10:12:03 +0000"  >&lt;p&gt;Github user mxm commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#discussion_r35087953&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#discussion_r35087953&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/scala/org/apache/flink/runtime/minicluster/FlinkMiniCluster.scala &amp;#8212;&lt;br/&gt;
    @@ -51,10 +51,13 @@ import scala.concurrent.&lt;/p&gt;
{ExecutionContext, Future, Await}
&lt;p&gt;     abstract class FlinkMiniCluster(&lt;br/&gt;
         val userConfiguration: Configuration,&lt;br/&gt;
         val singleActorSystem: Boolean,&lt;br/&gt;
    +    val synchronousDispatcher: Boolean,&lt;br/&gt;
         val streamingMode: StreamingMode) {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;def this(userConfiguration: Configuration, singleActorSystem: Boolean)&lt;/li&gt;
	&lt;li&gt;= this(userConfiguration, singleActorSystem, StreamingMode.BATCH_ONLY)&lt;br/&gt;
    +  def this(userConfiguration: Configuration,&lt;br/&gt;
    +           singleActorSystem: Boolean,&lt;br/&gt;
    +           synchronousDispatcher: Boolean)&lt;br/&gt;
    +       = this(userConfiguration, singleActorSystem, synchronousDispatcher, StreamingMode.BATCH_ONLY)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Good catch. I noticed that as well and already changed that before I saw your answer. Now only the `TestingCluster` is affected by the changes.&lt;/p&gt;</comment>
                            <comment id="14635011" author="githubbot" created="Tue, 21 Jul 2015 12:02:38 +0000"  >&lt;p&gt;Github user mxm commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#issuecomment-123283973&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#issuecomment-123283973&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the feedback. Merging this later on if there are no objections.&lt;/p&gt;</comment>
                            <comment id="14635167" author="githubbot" created="Tue, 21 Jul 2015 14:12:13 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925#issuecomment-123326290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925#issuecomment-123326290&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    +1, looks good&lt;/p&gt;</comment>
                            <comment id="14635188" author="githubbot" created="Tue, 21 Jul 2015 14:35:51 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/925&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/925&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14636624" author="mjsax" created="Wed, 22 Jul 2015 09:59:30 +0000"  >&lt;p&gt;Fixed test passed 10 Travis runs for me without failing. Seems to be stable now.&lt;/p&gt;</comment>
                            <comment id="14636632" author="mxm" created="Wed, 22 Jul 2015 10:02:29 +0000"  >&lt;p&gt;Good to hear &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hdnr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>