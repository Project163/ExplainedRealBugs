<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:39:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-11183] Heap/NonHeap memory metrics broken</title>
                <link>https://issues.apache.org/jira/browse/FLINK-11183</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Hello,&#160;&lt;/p&gt;

&lt;p&gt;After upgrading from Flink 1.5.3 to Flink 1.7.0 graphite metrics for memory started reporting wrong numbers. All the jobs are reporting the same memory used. Off heap memory, direct memory, mapped memory is almost the same across all our jobs, for heap memory used all jobs report memory used ~ 30mb? Is that even correct, we&apos;ve had jobs that die sporadically and it appears they are OOM-ing, but we can&apos;t really see it and verify it because of the metrics.&lt;/p&gt;

&lt;p&gt;Was there any major change to the metrics collection in flink-graphite-1.7.0?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;You can see from the screenshot that it appears all our jobs are using same memory.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13204862">FLINK-11183</key>
            <summary>Heap/NonHeap memory metrics broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="mariogeorgievft"> Mario Georgiev</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 17 Dec 2018 10:45:57 +0000</created>
                <updated>Tue, 19 Mar 2019 13:20:34 +0000</updated>
                            <resolved>Thu, 14 Mar 2019 09:02:55 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.3</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>Runtime / Metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16725716" author="zentol" created="Thu, 20 Dec 2018 09:44:32 +0000"  >&lt;p&gt;The graph you showed, is that the memory usage for taskmanagers or jobmanagers?&lt;br/&gt;
When you ran on 1.5.3, were you using legacy mode?&lt;/p&gt;

&lt;p&gt;No changes have been made to the GraphiteReporter. Regardless, to rule out the reporter you could try another reporter (like the SLF4jReporter) and see whether the values fit.&lt;/p&gt;

&lt;p&gt;One thing you could try is enabling the &lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-release-1.7/monitoring/metrics.html#system-resources&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;system resources metrics&lt;/a&gt;. It would be interesting to know whether these are different.&lt;/p&gt;</comment>
                            <comment id="16725734" author="zentol" created="Thu, 20 Dec 2018 10:09:43 +0000"  >&lt;p&gt;In a similar vein you can also check memory usage in the WebUI.&lt;/p&gt;</comment>
                            <comment id="16725735" author="mariogeorgievft" created="Thu, 20 Dec 2018 10:11:33 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;Using the System Metrics would be quite useless, because we have our taskmanagers/jobmanagers in docker. Using 1 Job Manager per Job and multiple Task Managers.&#160;&lt;/p&gt;



&lt;p&gt;This is the Grafana Query we are using, it should be relating to the taskmanagers?&lt;/p&gt;

&lt;p&gt;aliasByNode(HIDDEN.&lt;b&gt;-flink.$env.&lt;/b&gt;.&lt;b&gt;.HIDDEN.&lt;/b&gt;.Status.JVM.Memory.Heap.Used, 3, 11)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;On 1.5.3 the memory was shown correctly, we were not using legacy mode as far as i know.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16792462" author="zentol" created="Thu, 14 Mar 2019 09:02:55 +0000"  >&lt;p&gt;master: d9803ac0ff590f532a2553c96e0462d7b30c7435&lt;/p&gt;

&lt;p&gt;1.8: 977616242c5023021ac30a9be730e2989a18e6b8&lt;/p&gt;

&lt;p&gt;1.7: e10a98f56ed89d1a50c0a0c9cb6fc5ba0d8f190f&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12952029" name="memory.png" size="58072" author="mariogeorgievft" created="Mon, 17 Dec 2018 12:04:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u001l4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>