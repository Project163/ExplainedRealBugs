<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-29558] Use select count(*) from xxx; and get SQL syntax</title>
                <link>https://issues.apache.org/jira/browse/FLINK-29558</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Hi, I use flink sql to make kafka records to mysql.&lt;br/&gt;
so I create these 2 tables in flink sql,here is the mysql ,and I created the table in mysql before I did the insert action in flink sql.&lt;/p&gt;

&lt;p&gt;  CREATE TABLE mysql_MyUserTable (&lt;br/&gt;
  id STRING,&lt;br/&gt;
  name STRING,&lt;br/&gt;
  age STRING,&lt;br/&gt;
  status STRING,&lt;br/&gt;
  PRIMARY KEY (id) NOT ENFORCED&lt;br/&gt;
) WITH (&lt;br/&gt;
   &apos;connector&apos; = &apos;jdbc&apos;,&lt;br/&gt;
   &apos;url&apos; = &apos;jdbc:mysql://10.19.29.170:3306/fromflink152&apos;,&lt;br/&gt;
   &apos;table-name&apos; = &apos;users&apos;,&lt;br/&gt;
   &apos;username&apos; = &apos;root&apos;,&lt;br/&gt;
   &apos;password&apos; = &apos;******&apos;&lt;br/&gt;
);&lt;/p&gt;

&lt;p&gt;In mysql, I created database &quot;fromflink152&quot; then created the table like this way&lt;/p&gt;

&lt;p&gt; CREATE TABLE `users` (&lt;br/&gt;
  `id` varchar(64) NOT NULL DEFAULT &apos;&apos;,&lt;br/&gt;
  `name` varchar(255) DEFAULT NULL,&lt;br/&gt;
  `age` varchar(255) DEFAULT NULL,&lt;br/&gt;
  `status` varchar(255) DEFAULT NULL,&lt;br/&gt;
  PRIMARY KEY (`id`)&lt;br/&gt;
)  &lt;/p&gt;

&lt;p&gt;After executed insert sql,I found &apos;select * from mysql_MyUserTable&apos; can get correct result,but &#8217;select count(&amp;#42;) from mysql_MyUserTable&#8216;  or &#8217;select count(id) from mysql_MyUserTable&#8216; ,the collect job in flink app keep restarting again and again.The exception is:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13050230/13050230_image-2022-10-10-15-31-34-341.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;So I wonder which config that I missed about the table in flink or mysql side &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</description>
                <environment>&lt;p&gt;flink 1.15.2&lt;br/&gt;
CentOS Linux release 7.9.2009 (Core)&lt;br/&gt;
5.7.32-log MySQL Community Server (GPL)&lt;/p&gt;</environment>
        <key id="13485384">FLINK-29558</key>
            <summary>Use select count(*) from xxx; and get SQL syntax</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lincoln.86xy">lincoln lee</assignee>
                                    <reporter username="StarBoy1005">StarBoy1005</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 10 Oct 2022 07:37:32 +0000</created>
                <updated>Mon, 30 Jan 2023 08:12:48 +0000</updated>
                            <resolved>Mon, 30 Jan 2023 08:12:48 +0000</resolved>
                                    <version>1.15.3</version>
                                    <fixVersion>1.17.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17617037" author="martijnvisser" created="Thu, 13 Oct 2022 13:06:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=StarBoy1005&quot; class=&quot;user-hover&quot; rel=&quot;StarBoy1005&quot;&gt;StarBoy1005&lt;/a&gt; You should change your password as this was now shared publicly. &lt;/p&gt;

&lt;p&gt;The error that&apos;s being reported is coming from MySQL: have you verified that this syntax is compatible with your MySQL server? &lt;/p&gt;</comment>
                            <comment id="17617419" author="JIRAUSER289640" created="Fri, 14 Oct 2022 02:57:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; Thanks for the security notice.What&apos;s more, if I used flink sql to connect hudi or hive table(there do exist the table and some record in hudi or hive sides),execute sql like &apos;select  count(&amp;#42;) from table1;&apos; could get the correct result, but when do the save query  to mysql or Tidb(both connect by jdbc), the exception always show up,and I connected mysql by mysql client to check the table with same sql execution, &apos;select  count(&amp;#42;) from table1;&apos;  result is fine and correct.&lt;br/&gt;
If you never meet this situation,I guess the problem have some relation with mysql-connector-java**.jar in flink/lib &lt;/p&gt;</comment>
                            <comment id="17617427" author="JIRAUSER289640" created="Fri, 14 Oct 2022 03:25:52 +0000"  >&lt;p&gt;It seems not work when I exchange mysql-connector-java-**.jar    , neither mysql-connector-java-5.1.49.jar    nor   mysql-connector-java-8.0.29.jar .&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13050925/13050925_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17619304" author="martijnvisser" created="Tue, 18 Oct 2022 07:34:40 +0000"  >&lt;p&gt;Hive (and I assume Hudi, that I don&apos;t know for sure) use the Hive dialect for SQL. This can be different from the other JDBC dialects. &lt;/p&gt;</comment>
                            <comment id="17620171" author="jiabao.sun" created="Wed, 19 Oct 2022 10:01:59 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I did some tests to reproduce the problem. Maybe there is some problem when extracting the columns of the COUNT function.&lt;/p&gt;

&lt;p&gt;I have tried SUM and MAX function and the column can be extracted correctly.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13051173/13051173_image-2022-10-19-17-55-14-700.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17620378" author="martijnvisser" created="Wed, 19 Oct 2022 14:08:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=RocMarshal&quot; class=&quot;user-hover&quot; rel=&quot;RocMarshal&quot;&gt;RocMarshal&lt;/a&gt; Any thoughts on this?&lt;/p&gt;</comment>
                            <comment id="17620865" author="JIRAUSER289640" created="Thu, 20 Oct 2022 07:44:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jiabao.sun&quot; class=&quot;user-hover&quot; rel=&quot;jiabao.sun&quot;&gt;jiabao.sun&lt;/a&gt; Hi,if column like &apos;id&apos;,and &apos;id&apos; is the primary key ,then use select count(id) from xxx; can cause the problem.I guess some logic is not suit with JDBC situation.Maybe in StreamPhysicalRel  or something else&lt;/p&gt;</comment>
                            <comment id="17628222" author="JIRAUSER289640" created="Thu, 3 Nov 2022 09:40:48 +0000"  >&lt;p&gt;I tried flink 1.16.0 with the same env,now in sql-client can swiftly get the exception&#65306;&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Could not execute SQL statement. Reason:&lt;br/&gt;
java.sql.SQLSyntaxErrorException: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &apos;FROM `users1013a`&apos; at line 1&quot;  ,then the collect job just failed and never retry &lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13051744/13051744_image-2022-11-03-18-16-12-127.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17676845" author="JIRAUSER279823" created="Sat, 14 Jan 2023 05:48:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=StarBoy1005&quot; class=&quot;user-hover&quot; rel=&quot;StarBoy1005&quot;&gt;StarBoy1005&lt;/a&gt; It had been fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-27268&quot; title=&quot;build sql query error in JdbcDynamicTableSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-27268&quot;&gt;FLINK-27268&lt;/a&gt;, but i found a problem, when using flink sql like this &quot;SELECT COUNT( * ) FROM table&quot; or &quot;SELECT COUNT(1) FROM table&quot;, projection always return &apos;ROW&amp;lt;&amp;gt; NOT NULL&apos;, so it cause mysql connector transform to &quot;SELECT FROM table&quot;. After &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-27268&quot; title=&quot;build sql query error in JdbcDynamicTableSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-27268&quot;&gt;FLINK-27268&lt;/a&gt;, it transform to &quot;SELECT &apos;&apos; FROM table&quot;. But is it projection&apos;s bug? When projection can not match something, it will be return &apos;ROW&amp;lt;&amp;gt; NOT NULL&apos;. I think maybe not only mysql connector has this bug. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17677696" author="martijnvisser" created="Tue, 17 Jan 2023 09:37:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lincoln.86xy&quot; class=&quot;user-hover&quot; rel=&quot;lincoln.86xy&quot;&gt;lincoln.86xy&lt;/a&gt; Is this a ticket that fits for you? If so, could you have a look?&lt;/p&gt;</comment>
                            <comment id="17677758" author="lincoln.86xy" created="Tue, 17 Jan 2023 13:19:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=martijnvisser&quot; class=&quot;user-hover&quot; rel=&quot;martijnvisser&quot;&gt;martijnvisser&lt;/a&gt; I looked at the problem and it is indeed a planner bug, I&apos;ll fix it.&lt;/p&gt;</comment>
                            <comment id="17678042" author="lincoln.86xy" created="Wed, 18 Jan 2023 01:17:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt; Could you also take a look at this when you have time? There&apos;re several existing cases already tested the case  which select nothing from source, e.g., &quot;SELECT COUNT(1) FROM T&quot; in &lt;br/&gt;
 `org.apache.flink.table.planner.plan.stream.sql.TableSourceTest#testProjectWithoutInputRef`&lt;br/&gt;
and the expected plan is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;TestCase name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testProjectWithoutInputRef&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;Resource name=&lt;span class=&quot;code-quote&quot;&gt;&quot;sql&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;![CDATA[SELECT COUNT(1) FROM T]]&amp;gt;
    &amp;lt;/Resource&amp;gt;
    &amp;lt;Resource name=&lt;span class=&quot;code-quote&quot;&gt;&quot;ast&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;![CDATA[
LogicalAggregate(group=[{}], EXPR$0=[COUNT()])
+- LogicalProject($f0=[0])
   +- LogicalTableScan(table=[[default_catalog, default_database, T]])
]]&amp;gt;
    &amp;lt;/Resource&amp;gt;
    &amp;lt;Resource name=&lt;span class=&quot;code-quote&quot;&gt;&quot;optimized exec plan&quot;&lt;/span&gt;&amp;gt;
      &amp;lt;![CDATA[
GroupAggregate(select=[COUNT(*) AS EXPR$0])
+- Exchange(distribution=[single])
   +- TableSourceScan(table=[[default_catalog, default_database, T, project=[], metadata=[]]], fields=[])
]]&amp;gt;
    &amp;lt;/Resource&amp;gt;
  &amp;lt;/TestCase&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so is there any contract that connectors should follow in such cases&#65311;&lt;/p&gt;</comment>
                            <comment id="17681683" author="lincoln.86xy" created="Sun, 29 Jan 2023 05:52:48 +0000"  >&lt;p&gt;After discussed with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;, the problem is confirmed. I&apos;ve updated the pr to move on.&lt;/p&gt;</comment>
                            <comment id="17681938" author="lincoln.86xy" created="Mon, 30 Jan 2023 08:12:48 +0000"  >&lt;p&gt;fixed in master: 6d17ba8855683fb6c1f8291ff4bad1c9abc01cb9&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13050230" name="image-2022-10-10-15-31-34-341.png" size="97850" author="StarBoy1005" created="Mon, 10 Oct 2022 07:32:47 +0000"/>
                            <attachment id="13051173" name="image-2022-10-19-17-55-14-700.png" size="124923" author="jiabao.sun" created="Wed, 19 Oct 2022 09:55:16 +0000"/>
                            <attachment id="13051744" name="image-2022-11-03-18-16-12-127.png" size="48996" author="StarBoy1005" created="Thu, 3 Nov 2022 10:17:48 +0000"/>
                            <attachment id="13050925" name="screenshot-1.png" size="119701" author="StarBoy1005" created="Fri, 14 Oct 2022 03:25:40 +0000"/>
                            <attachment id="13051215" name="screenshot-2.png" size="211422" author="StarBoy1005" created="Thu, 20 Oct 2022 02:16:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z197oo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>