<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10801] Fix sql client integrate elasticsearch connector test failure</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10801</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;It usually reports :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
FAIL SQL Client Elasticsearch Upsert: Output hash mismatch. Got 6187222e109ee9222e6b2f117742070c, expected 982cb32908def9801e781381c1b8a8db.
head hexdump of actual:
0000000 { \n &lt;span class=&quot;code-quote&quot;&gt;&quot; h i t s &quot;&lt;/span&gt; : { \n 
0000010 &lt;span class=&quot;code-quote&quot;&gt;&quot; t o t a l &quot;&lt;/span&gt; : 3 , \n
0000020 &lt;span class=&quot;code-quote&quot;&gt;&quot; m a x _ s c o r e &quot;&lt;/span&gt; 
0000030 : 1 . 0 , \n &quot; h i t s
0000040 &quot; : [ \n { \n 
0000050 &lt;span class=&quot;code-quote&quot;&gt;&quot; _ i n d e x &quot;&lt;/span&gt; :
0000060 &lt;span class=&quot;code-quote&quot;&gt;&quot; m y _ u s e r s &quot;&lt;/span&gt; , \n 
0000070 &lt;span class=&quot;code-quote&quot;&gt;&quot; _ t y p e &quot;&lt;/span&gt; : &quot;
0000080 u s e r &lt;span class=&quot;code-quote&quot;&gt;&quot; , \n &quot;&lt;/span&gt;
0000090 _ i d &lt;span class=&quot;code-quote&quot;&gt;&quot; : &quot;&lt;/span&gt; 1 _ B o b &quot;
00000a0 , \n &quot; _ s c o r
00000b0 e &quot; : 1 . 0 , \n 
00000ba
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the actual hash means :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;hits&quot;&lt;/span&gt; : {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;total&quot;&lt;/span&gt; : 3,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;max_score&quot;&lt;/span&gt; : 1.0,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hits&quot;&lt;/span&gt; : [
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;my_users&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;1_Bob  &quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_score&quot;&lt;/span&gt; : 1.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_source&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt; : 1,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Bob  &quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_count&quot;&lt;/span&gt; : 1
        }
      },
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;my_users&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;22_Alice&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_score&quot;&lt;/span&gt; : 1.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_source&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt; : 22,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Alice&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_count&quot;&lt;/span&gt; : 1
        }
      },
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;my_users&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;42_Greg &quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_score&quot;&lt;/span&gt; : 1.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_source&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt; : 42,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Greg &quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_count&quot;&lt;/span&gt; : 3
        }
      }
    ]
  }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the expected hash code means :&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
  &lt;span class=&quot;code-quote&quot;&gt;&quot;hits&quot;&lt;/span&gt; : {
    &lt;span class=&quot;code-quote&quot;&gt;&quot;total&quot;&lt;/span&gt; : 3,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;max_score&quot;&lt;/span&gt; : 1.0,
    &lt;span class=&quot;code-quote&quot;&gt;&quot;hits&quot;&lt;/span&gt; : [
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;my_users&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;1_Bob  &quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_score&quot;&lt;/span&gt; : 1.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_source&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt; : 1,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Bob  &quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_count&quot;&lt;/span&gt; : 2
        }
      },
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;my_users&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;22_Alice&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_score&quot;&lt;/span&gt; : 1.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_source&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt; : 22,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Alice&quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_count&quot;&lt;/span&gt; : 1
        }
      },
      {
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_index&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;my_users&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_type&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;user&quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_id&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;42_Greg &quot;&lt;/span&gt;,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_score&quot;&lt;/span&gt; : 1.0,
        &lt;span class=&quot;code-quote&quot;&gt;&quot;_source&quot;&lt;/span&gt; : {
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_id&quot;&lt;/span&gt; : 42,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_name&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;Greg &quot;&lt;/span&gt;,
          &lt;span class=&quot;code-quote&quot;&gt;&quot;user_count&quot;&lt;/span&gt; : 3
        }
      }
    ]
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems that the user count for &quot;Bob&quot; is off by 1.&lt;/p&gt;

&lt;p&gt;The speculation is due to the premature acquisition of aggregated statistics from Elasticsearch.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13196459">FLINK-10801</key>
            <summary>Fix sql client integrate elasticsearch connector test failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pnowojski">Piotr Nowojski</assignee>
                                    <reporter username="yanghua">vinoyang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 6 Nov 2018 09:36:39 +0000</created>
                <updated>Fri, 9 Nov 2018 08:54:07 +0000</updated>
                            <resolved>Fri, 9 Nov 2018 08:54:07 +0000</resolved>
                                                    <fixVersion>1.7.0</fixVersion>
                                    <component>Test Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16678043" author="pnowojski" created="Wed, 7 Nov 2018 10:59:59 +0000"  >&lt;p&gt;I will take over this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yanghua&quot; class=&quot;user-hover&quot; rel=&quot;yanghua&quot;&gt;yanghua&lt;/a&gt; and will fix it without fixed &lt;tt&gt;sleep 20s&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16678077" author="yanghua" created="Wed, 7 Nov 2018 11:32:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; &#160;Ok, go ahead. I know that sleep 20s is not the best solution.&lt;/p&gt;</comment>
                            <comment id="16679756" author="githubbot" created="Thu, 8 Nov 2018 13:30:47 +0000"  >&lt;p&gt;pnowojski opened a new pull request #7060: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10801&quot; title=&quot;Fix sql client integrate elasticsearch connector test failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10801&quot;&gt;&lt;del&gt;FLINK-10801&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;e2e&amp;#93;&lt;/span&gt; Retry verify_result_hash in elastichsearch-common&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7060&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Instead of looping the verification until the expected number of results loop until we get the correct output. This tries to solve the problem of some records (aggregated? updated?) arriving later.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This is a change in end-to-end tests.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16679829" author="githubbot" created="Thu, 8 Nov 2018 14:24:48 +0000"  >&lt;p&gt;twalthr commented on a change in pull request #7060: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10801&quot; title=&quot;Fix sql client integrate elasticsearch connector test failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10801&quot;&gt;&lt;del&gt;FLINK-10801&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;e2e&amp;#93;&lt;/span&gt; Retry verify_result_hash in elastichsearch-common&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7060#discussion_r231904591&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7060#discussion_r231904591&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-end-to-end-tests/test-scripts/elasticsearch-common.sh&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -83,23 +83,33 @@ function verify_result_hash {&lt;br/&gt;
   local name=$1&lt;br/&gt;
   local index=$2&lt;br/&gt;
   local numRecords=$3&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;local hash=$4&lt;br/&gt;
+  local expectedHash=$4&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;while : ; do&lt;br/&gt;
+  local error_code=0&lt;br/&gt;
+&lt;br/&gt;
+  for i in 
{1..30}
&lt;p&gt;; do&lt;br/&gt;
+    echo &quot;Result verification attempt $i...&quot;&lt;br/&gt;
     curl &quot;localhost:9200/${index}/_search?q=*&amp;amp;pretty&quot; &amp;gt; $TEST_DATA_DIR/es_output || true&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if [ -n &quot;$(grep &quot;\&quot;total\&quot; : $numRecords&quot; $TEST_DATA_DIR/es_output)&quot; ]; then&lt;/li&gt;
	&lt;li&gt;break&lt;/li&gt;
	&lt;li&gt;else&lt;/li&gt;
	&lt;li&gt;echo &quot;Waiting for Elasticsearch records ...&quot;&lt;br/&gt;
+    # remove meta information&lt;br/&gt;
+    sed &apos;2,9d&apos; $TEST_DATA_DIR/es_output &amp;gt; $TEST_DATA_DIR/es_content&lt;br/&gt;
+&lt;br/&gt;
+    check_result_hash_no_exit &quot;$name&quot; $TEST_DATA_DIR/es_content &quot;$expectedHash&quot; || result=$?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Shouldn&apos;t `result=$?` be `error_code=$?`?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16679833" author="githubbot" created="Thu, 8 Nov 2018 14:29:24 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #7060: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10801&quot; title=&quot;Fix sql client integrate elasticsearch connector test failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10801&quot;&gt;&lt;del&gt;FLINK-10801&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;e2e&amp;#93;&lt;/span&gt; Retry verify_result_hash in elastichsearch-common&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7060#discussion_r231908066&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7060#discussion_r231908066&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-end-to-end-tests/test-scripts/elasticsearch-common.sh&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -83,23 +83,33 @@ function verify_result_hash {&lt;br/&gt;
   local name=$1&lt;br/&gt;
   local index=$2&lt;br/&gt;
   local numRecords=$3&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;local hash=$4&lt;br/&gt;
+  local expectedHash=$4&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;while : ; do&lt;br/&gt;
+  local error_code=0&lt;br/&gt;
+&lt;br/&gt;
+  for i in 
{1..30}
&lt;p&gt;; do&lt;br/&gt;
+    echo &quot;Result verification attempt $i...&quot;&lt;br/&gt;
     curl &quot;localhost:9200/${index}/_search?q=*&amp;amp;pretty&quot; &amp;gt; $TEST_DATA_DIR/es_output || true&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if [ -n &quot;$(grep &quot;\&quot;total\&quot; : $numRecords&quot; $TEST_DATA_DIR/es_output)&quot; ]; then&lt;/li&gt;
	&lt;li&gt;break&lt;/li&gt;
	&lt;li&gt;else&lt;/li&gt;
	&lt;li&gt;echo &quot;Waiting for Elasticsearch records ...&quot;&lt;br/&gt;
+    # remove meta information&lt;br/&gt;
+    sed &apos;2,9d&apos; $TEST_DATA_DIR/es_output &amp;gt; $TEST_DATA_DIR/es_content&lt;br/&gt;
+&lt;br/&gt;
+    check_result_hash_no_exit &quot;$name&quot; $TEST_DATA_DIR/es_content &quot;$expectedHash&quot; || result=$?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   good catch... I forgot to re-test failure case after renaming the variable&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16681084" author="githubbot" created="Fri, 9 Nov 2018 08:52:18 +0000"  >&lt;p&gt;pnowojski closed pull request #7060: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10801&quot; title=&quot;Fix sql client integrate elasticsearch connector test failure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10801&quot;&gt;&lt;del&gt;FLINK-10801&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;e2e&amp;#93;&lt;/span&gt; Retry verify_result_hash in elastichsearch-common&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/7060&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/7060&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-end-to-end-tests/test-scripts/common.sh b/flink-end-to-end-tests/test-scripts/common.sh&lt;br/&gt;
index 36cc0df142c..6b8bd061f15 100644&lt;br/&gt;
&amp;#8212; a/flink-end-to-end-tests/test-scripts/common.sh&lt;br/&gt;
+++ b/flink-end-to-end-tests/test-scripts/common.sh&lt;br/&gt;
@@ -451,6 +451,16 @@ function cancel_job {&lt;br/&gt;
 }&lt;/p&gt;

&lt;p&gt; function check_result_hash &lt;/p&gt;
{
+  local error_code=0
+  check_result_hash_no_exit &quot;$@&quot; || error_code=$?
+
+  if [ &quot;$error_code&quot; != &quot;0&quot; ]
+  then
+    exit $error_code
+  fi
+}
&lt;p&gt;+&lt;br/&gt;
+function check_result_hash_no_exit {&lt;br/&gt;
   local name=$1&lt;br/&gt;
   local outfile_prefix=$2&lt;br/&gt;
   local expected=$3&lt;br/&gt;
@@ -462,18 +472,19 @@ function check_result_hash {&lt;br/&gt;
     actual=$(LC_ALL=C sort $outfile_prefix* | md5sum | awk &apos;&lt;/p&gt;
{print $1}
&lt;p&gt;&apos;)&lt;br/&gt;
   else&lt;br/&gt;
     echo &quot;Neither &apos;md5&apos; nor &apos;md5sum&apos; binary available.&quot;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;exit 2&lt;br/&gt;
+    return 2&lt;br/&gt;
   fi&lt;br/&gt;
   if [[ &quot;$actual&quot; != &quot;$expected&quot; ]]&lt;br/&gt;
   then&lt;br/&gt;
     echo &quot;FAIL $name: Output hash mismatch.  Got $actual, expected $expected.&quot;&lt;br/&gt;
     echo &quot;head hexdump of actual:&quot;&lt;br/&gt;
     head $outfile_prefix* | hexdump -c&lt;/li&gt;
	&lt;li&gt;exit 1&lt;br/&gt;
+    return 1&lt;br/&gt;
   else&lt;br/&gt;
     echo &quot;pass $name&quot;&lt;/li&gt;
&lt;/ul&gt;
&lt;ol&gt;
	&lt;li&gt;Output files are left behind in /tmp&lt;br/&gt;
   fi&lt;br/&gt;
+  return 0&lt;br/&gt;
 }&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;This function starts the given number of task managers and monitors their processes.&lt;br/&gt;
diff --git a/flink-end-to-end-tests/test-scripts/elasticsearch-common.sh b/flink-end-to-end-tests/test-scripts/elasticsearch-common.sh&lt;br/&gt;
index 8bb9c42ab69..695905222f5 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-end-to-end-tests/test-scripts/elasticsearch-common.sh&lt;br/&gt;
+++ b/flink-end-to-end-tests/test-scripts/elasticsearch-common.sh&lt;br/&gt;
@@ -83,23 +83,34 @@ function verify_result_hash {&lt;br/&gt;
   local name=$1&lt;br/&gt;
   local index=$2&lt;br/&gt;
   local numRecords=$3&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;local hash=$4&lt;br/&gt;
+  local expectedHash=$4&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;while : ; do&lt;br/&gt;
+  for i in 
{1..30}
&lt;p&gt;+  do&lt;br/&gt;
+    local error_code=0&lt;br/&gt;
+&lt;br/&gt;
+    echo &quot;Result verification attempt $i...&quot;&lt;br/&gt;
     curl &quot;localhost:9200/${index}/_search?q=*&amp;amp;pretty&quot; &amp;gt; $TEST_DATA_DIR/es_output || true&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if [ -n &quot;$(grep &quot;\&quot;total\&quot; : $numRecords&quot; $TEST_DATA_DIR/es_output)&quot; ]; then&lt;/li&gt;
	&lt;li&gt;break&lt;/li&gt;
	&lt;li&gt;else&lt;/li&gt;
	&lt;li&gt;echo &quot;Waiting for Elasticsearch records ...&quot;&lt;br/&gt;
+    # remove meta information&lt;br/&gt;
+    sed &apos;2,9d&apos; $TEST_DATA_DIR/es_output &amp;gt; $TEST_DATA_DIR/es_content&lt;br/&gt;
+&lt;br/&gt;
+    check_result_hash_no_exit &quot;$name&quot; $TEST_DATA_DIR/es_content &quot;$expectedHash&quot; || error_code=$?&lt;br/&gt;
+&lt;br/&gt;
+    if [ &quot;$error_code&quot; != &quot;0&quot; ]&lt;br/&gt;
+    then&lt;br/&gt;
+      echo &quot;Result verification attempt $i has failed&quot;&lt;br/&gt;
       sleep 1&lt;br/&gt;
+    else&lt;br/&gt;
+      break&lt;br/&gt;
     fi&lt;br/&gt;
   done&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;# remove meta information&lt;/li&gt;
	&lt;li&gt;sed &apos;2,9d&apos; $TEST_DATA_DIR/es_output &amp;gt; $TEST_DATA_DIR/es_content&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;check_result_hash &quot;$name&quot; $TEST_DATA_DIR/es_content &quot;$hash&quot;&lt;br/&gt;
+  if [ &quot;$error_code&quot; != &quot;0&quot; ]&lt;br/&gt;
+  then&lt;br/&gt;
+    echo &quot;All result verification attempts have failed&quot;&lt;br/&gt;
+    exit $error_code&lt;br/&gt;
+  fi&lt;br/&gt;
 }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; function shutdown_elasticsearch_cluster {&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16681086" author="pnowojski" created="Fri, 9 Nov 2018 08:54:07 +0000"  >&lt;p&gt;merged commit eaa2959 into apache:master&lt;br/&gt;
merged commit 158e2c89e1 into apache:release-1.7&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s005u8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>