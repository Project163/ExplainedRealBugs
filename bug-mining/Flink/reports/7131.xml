<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:17:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30598] Wrong code generated for WatermarkGenerator because of inconsistent source type info when deserialized from exec plan</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30598</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;When compile from an exist exec plan which contains watermark declaration and it referred the metadata column, the generated code for WatermarkGenerator maybe wrong&lt;/p&gt;

&lt;p&gt;because currently `DynamicTableSourceSpec`.getTableSource passes the user defined schema to `SourceAbilitySpec` to perform optimization like projection/watermark pushdown, while optimization path from sql use a fixed reorder form: &quot;PHYSICAL COLUMNS + METADATA COLUMNS&quot;, this may cause the problem.&lt;/p&gt;

&lt;p&gt;a repro-case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testWatermarkPushDownWithMetadata() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-comment&quot;&gt;// to verify FLINK-: the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; declares metadata field first, without fix it will get a
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// wrong code generated by WatermarkGeneratorCodeGenerator which reference the incorrect
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// varchar column as the watermark field.
&lt;/span&gt;        createTestValuesSourceTable(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;MyTable&quot;&lt;/span&gt;,
                JavaScalaConversionUtil.toJava(TestData.data3WithTimestamp()),
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] {
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;ts timestamp(3) metadata&quot;&lt;/span&gt;,
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;,
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;b bigint&quot;&lt;/span&gt;,
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;c varchar&quot;&lt;/span&gt;,
                    &lt;span class=&quot;code-quote&quot;&gt;&quot;watermark &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ts as ts - interval &lt;span class=&quot;code-quote&quot;&gt;&apos;5&apos;&lt;/span&gt; second&quot;&lt;/span&gt;
                },
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;() {
                    {
                        put(&lt;span class=&quot;code-quote&quot;&gt;&quot;enable-watermark-push-down&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);
                        put(&lt;span class=&quot;code-quote&quot;&gt;&quot;readable-metadata&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ts:timestamp(3)&quot;&lt;/span&gt;);
                    }
                });

        File sinkPath =
                createTestCsvSinkTable(
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;MySink&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;a &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b bigint&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;c varchar&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;ts timestamp(3)&quot;&lt;/span&gt;);

        compileSqlAndExecutePlan(&lt;span class=&quot;code-quote&quot;&gt;&quot;insert into MySink select a, b, c, ts from MyTable where b = 3&quot;&lt;/span&gt;)
                .await();

        assertResult(
                Arrays.asList(
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;4,3,Hello world, how are you?,&quot;&lt;/span&gt; + toLocalDateTime(4000L),
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;5,3,I am fine.,&quot;&lt;/span&gt; + toLocalDateTime(5000L),
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;6,3,Luke Skywalker,&quot;&lt;/span&gt; + toLocalDateTime(6000L)),
                sinkPath);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the wrong code snippet(`row.getString(3)` should be a TimestampData):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; currentWatermark(org.apache.flink.table.data.RowData row) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
          
          org.apache.flink.table.data.binary.BinaryStringData field$19;
          &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isNull$19;
          org.apache.flink.table.data.binary.BinaryStringData field$21;
          &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isNull$22;
          org.apache.flink.table.data.TimestampData result$23;
          &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isNull$24;
          org.apache.flink.table.data.TimestampData result$25;
          
          isNull$19 = row.isNullAt(3);
          field$19 = org.apache.flink.table.data.binary.BinaryStringData.EMPTY_UTF8;
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isNull$19) {
            field$19 = ((org.apache.flink.table.data.binary.BinaryStringData) row.getString(3));
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</description>
                <environment></environment>
        <key id="13517158">FLINK-30598</key>
            <summary>Wrong code generated for WatermarkGenerator because of inconsistent source type info when deserialized from exec plan</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lincoln.86xy">lincoln lee</assignee>
                                    <reporter username="lincoln.86xy">lincoln lee</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sun, 8 Jan 2023 14:21:59 +0000</created>
                <updated>Thu, 6 Jul 2023 09:45:40 +0000</updated>
                            <resolved>Thu, 6 Jul 2023 09:45:40 +0000</resolved>
                                    <version>1.16.0</version>
                                    <fixVersion>1.18.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17656363" author="lincoln.86xy" created="Tue, 10 Jan 2023 01:38:04 +0000"  >&lt;p&gt;This issue has several dependencies to be resolved, pending for a while.&lt;/p&gt;</comment>
                            <comment id="17740529" author="lincoln.86xy" created="Thu, 6 Jul 2023 09:45:40 +0000"  >&lt;p&gt;fixed in master: d946eaac160748f39567818a221f25499fad84df&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ena0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>