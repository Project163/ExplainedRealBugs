<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:09:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-25958] OOME Checkpoints &amp; Savepoints were shown as COMPLETE in Flink UI</title>
                <link>https://issues.apache.org/jira/browse/FLINK-25958</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Flink job was running but the checkpoints &amp;amp; savepoints were failing all the time due to OOM Exception. However, the Flink UI showed COMPLETE for those checkpoints &amp;amp; savepoints.&lt;/p&gt;

&lt;p&gt;For example (checkpoint 39 &amp;amp; 40):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2022-01-27 02:41:39,969 INFO &#160;org.apache.flink.runtime.checkpoint.CheckpointCoordinator &#160; &#160;[] - Triggering checkpoint 39 (type=CHECKPOINT) @ 1643251299952 for job ab2217e5ce144087bbddf6bd6c3
668eb.
2022-01-27 02:43:19,678 WARN &#160;org.apache.flink.runtime.jobmaster.JobMaster &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; [] - Error while processing AcknowledgeCheckpoint message
org.apache.flink.runtime.checkpoint.CheckpointException: Could not complete the pending checkpoint 39. Failure reason: Failure to finalize checkpoint.
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.completePendingCheckpoint(CheckpointCoordinator.java:1227) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.receiveAcknowledgeMessage(CheckpointCoordinator.java:1072) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.scheduler.ExecutionGraphHandler.lambda$acknowledgeCheckpoint$1(ExecutionGraphHandler.java:89) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.scheduler.ExecutionGraphHandler.lambda$processCheckpointCoordinatorMessage$3(ExecutionGraphHandler.java:119) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-s
tream2]
&#160; &#160; &#160; &#160; at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]
&#160; &#160; &#160; &#160; at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]
&#160; &#160; &#160; &#160; at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]
&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]
&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]
&#160; &#160; &#160; &#160; at java.lang.Thread.run(Thread.java:829) [?:?]
Caused by: java.lang.IllegalArgumentException: Self-suppression not permitted
&#160; &#160; &#160; &#160; at java.lang.Throwable.addSuppressed(Throwable.java:1054) ~[?:?]
&#160; &#160; &#160; &#160; at org.apache.flink.util.InstantiationUtil.serializeObject(InstantiationUtil.java:627) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; at com.ververica.platform.flink.ha.kubernetes.KubernetesHaCheckpointStore.serializeCheckpoint(KubernetesHaCheckpointStore.java:204) ~[vvp-flink-ha-kubernetes-flink113-1.4-20211013.09
1138-2.jar:?]
&#160; &#160; &#160; &#160; at com.ververica.platform.flink.ha.kubernetes.KubernetesHaCheckpointStore.addCheckpoint(KubernetesHaCheckpointStore.java:83) ~[vvp-flink-ha-kubernetes-flink113-1.4-20211013.091138-2.
jar:?]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.completePendingCheckpoint(CheckpointCoordinator.java:1209) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; ... 9 more
Caused by: java.lang.OutOfMemoryError: Java heap space
2022-01-27 03:41:39,970 INFO &#160;org.apache.flink.runtime.checkpoint.CheckpointCoordinator &#160; &#160;[] - Triggering checkpoint 40 (type=CHECKPOINT) @ 1643254899952 for job ab2217e5ce144087bbddf6bd6c3
668eb.
2022-01-27 03:43:22,326 WARN &#160;org.apache.flink.runtime.jobmaster.JobMaster &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; [] - Error while processing AcknowledgeCheckpoint message
org.apache.flink.runtime.checkpoint.CheckpointException: Could not complete the pending checkpoint 40. Failure reason: Failure to finalize checkpoint.
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.completePendingCheckpoint(CheckpointCoordinator.java:1227) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.receiveAcknowledgeMessage(CheckpointCoordinator.java:1072) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.scheduler.ExecutionGraphHandler.lambda$acknowledgeCheckpoint$1(ExecutionGraphHandler.java:89) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.scheduler.ExecutionGraphHandler.lambda$processCheckpointCoordinatorMessage$3(ExecutionGraphHandler.java:119) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-s
tream2]
&#160; &#160; &#160; &#160; at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]
&#160; &#160; &#160; &#160; at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]
&#160; &#160; &#160; &#160; at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]
&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]
&#160; &#160; &#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]
&#160; &#160; &#160; &#160; at java.lang.Thread.run(Thread.java:829) [?:?]
Caused by: java.lang.IllegalArgumentException: Self-suppression not permitted
&#160; &#160; &#160; &#160; at java.lang.Throwable.addSuppressed(Throwable.java:1054) ~[?:?]
&#160; &#160; &#160; &#160; at org.apache.flink.util.InstantiationUtil.serializeObject(InstantiationUtil.java:627) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; at com.ververica.platform.flink.ha.kubernetes.KubernetesHaCheckpointStore.serializeCheckpoint(KubernetesHaCheckpointStore.java:204) ~[vvp-flink-ha-kubernetes-flink113-1.4-20211013.09
1138-2.jar:?]
&#160; &#160; &#160; &#160; at com.ververica.platform.flink.ha.kubernetes.KubernetesHaCheckpointStore.addCheckpoint(KubernetesHaCheckpointStore.java:83) ~[vvp-flink-ha-kubernetes-flink113-1.4-20211013.091138-2.jar:?]
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.checkpoint.CheckpointCoordinator.completePendingCheckpoint(CheckpointCoordinator.java:1209) ~[flink-dist_2.12-1.13.5-stream2.jar:1.13.5-stream2]
&#160; &#160; &#160; &#160; ... 9 more
Caused by: java.lang.OutOfMemoryError: Java heap space&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please find attached a screenshot of the Flink UI (both 39 &amp;amp; 40 were COMPLETE).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ververica Platform 2.6.2&lt;/p&gt;

&lt;p&gt;Flink 1.13.5&lt;/p&gt;</environment>
        <key id="13426594">FLINK-25958</key>
            <summary>OOME Checkpoints &amp; Savepoints were shown as COMPLETE in Flink UI</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="akalashnikov">Anton Kalashnikov</assignee>
                                    <reporter username="victorunique">Victor Xu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 4 Feb 2022 10:20:08 +0000</created>
                <updated>Thu, 3 Mar 2022 17:21:42 +0000</updated>
                            <resolved>Thu, 3 Mar 2022 17:21:42 +0000</resolved>
                                    <version>1.12.7</version>
                    <version>1.13.5</version>
                    <version>1.14.3</version>
                    <version>1.15.0</version>
                                    <fixVersion>1.15.0</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17486941" author="pnowojski" created="Fri, 4 Feb 2022 10:27:16 +0000"  >&lt;p&gt;It looks like the problem is caused by pre-mature reporting that the checkpoint is completed via &lt;tt&gt;PendingCheckpointStats#reportCompletedCheckpoint&lt;/tt&gt; call in &lt;tt&gt;PendingCheckpoint#finalizeCheckpoint&lt;/tt&gt;. That&apos;s when &lt;tt&gt;PendingCheckpoint&lt;/tt&gt; is converted to &lt;tt&gt;CompletedCheckpoint&lt;/tt&gt;, however this doesn&apos;t mean the checkpoint will indeed completed. For example adding to checkpoint store can still fail.&lt;/p&gt;

&lt;p&gt;It looks like there is no good reason behind this behaviour and it&apos;s just an unintentional artefact of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4410&quot; title=&quot;Report more information about operator checkpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4410&quot;&gt;&lt;del&gt;FLINK-4410&lt;/del&gt;&lt;/a&gt; changes, that added support for displaying failed/pending checkpoints stats.&lt;/p&gt;

&lt;p&gt;The most naive solution might be just moving &lt;tt&gt;PendingCheckpointStats#reportCompletedCheckpoint&lt;/tt&gt;  at the end of the checkpointing process. However one thing to consider is that this could indadvertedly create the opposite problem, where checkpoint has completed but failure while reporting fails to mark it as such.&lt;/p&gt;</comment>
                            <comment id="17500914" author="akalashnikov" created="Thu, 3 Mar 2022 17:21:32 +0000"  >&lt;p&gt;merge to master between:&lt;/p&gt;

&lt;p&gt;f57a5379ff9c108627d3c511414e7ea71a1a2a2f and fbfdb0e468356fe71826eb6b185ecda9bc8b1de3&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Since the behavior was changed a bit and this bug is not so critical. We decided that it doesn&apos;t make sense to backport it to older version.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="12997859">FLINK-4410</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13039662" name="JIRA-1.jpg" size="370543" author="victorunique" created="Fri, 4 Feb 2022 10:18:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0z97s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>