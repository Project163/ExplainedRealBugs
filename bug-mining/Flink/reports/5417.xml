<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:57:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-22574] Adaptive Scheduler: Can not cancel restarting job</title>
                <link>https://issues.apache.org/jira/browse/FLINK-22574</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I have a job in state RESTARTING. When I now issue a cancel RPC call, I get the following exception:&lt;/p&gt;

&lt;p&gt;Relevant trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.IllegalStateException: Assuming running execution graph 
 at org.apache.flink.util.Preconditions.checkState(Preconditions.java:193) 
 at org.apache.flink.runtime.scheduler.adaptive.StateWithExecutionGraph.(StateWithExecutionGraph.java:94) 
 at org.apache.flink.runtime.scheduler.adaptive.Canceling.(Canceling.java:41) 
 at org.apache.flink.runtime.scheduler.adaptive.Canceling$Factory.getState(Canceling.java:98) 
 at org.apache.flink.runtime.scheduler.adaptive.Canceling$Factory.getState(Canceling.java:72) 
 at org.apache.flink.runtime.scheduler.adaptive.AdaptiveScheduler.transitionToState(AdaptiveScheduler.java:1128) 
 at org.apache.flink.runtime.scheduler.adaptive.AdaptiveScheduler.goToCanceling(AdaptiveScheduler.java:802) 
 at org.apache.flink.runtime.scheduler.adaptive.Restarting.cancel(Restarting.java:74) 
 at org.apache.flink.runtime.scheduler.adaptive.AdaptiveScheduler.cancel(AdaptiveScheduler.java:453) 
 at org.apache.flink.runtime.jobmaster.JobMaster.cancel(JobMaster.java:417) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Full trace as reported in the UI:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.RestHandlerException: Job cancellation failed: Cancellation failed. 
 at org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.handler.job.JobCancellationHandler.lambda$handleRequest$0(JobCancellationHandler.java:127) 
 at java.util.concurrent.CompletableFuture.uniHandle(CompletableFuture.java:836) 
 at java.util.concurrent.CompletableFuture$UniHandle.tryFire(CompletableFuture.java:811) 
 at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) 
 at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990) 
 at org.apache.flink.runtime.rpc.akka.AkkaInvocationHandler.lambda$invokeRpc$0(AkkaInvocationHandler.java:234) 
 at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774) 
 at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750) 
 at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) 
 at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990) 
 at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:1079) 
 at akka.dispatch.OnComplete.internal(Future.scala:263) 
 at akka.dispatch.OnComplete.internal(Future.scala:261) 
 at akka.dispatch.japi$CallbackBridge.apply(Future.scala:191) 
 at akka.dispatch.japi$CallbackBridge.apply(Future.scala:188) 
 at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:60) 
 at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:73) 
 at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:68) 
 at scala.concurrent.impl.Promise$DefaultPromise.$anonfun$tryComplete$1(Promise.scala:284) 
 at scala.concurrent.impl.Promise$DefaultPromise.$anonfun$tryComplete$1$adapted(Promise.scala:284) 
 at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:284) 
 at akka.pattern.PromiseActorRef.$bang(AskSupport.scala:573) 
 at akka.pattern.PipeToSupport$PipeableFuture$$anonfun$pipeTo$1.applyOrElse(PipeToSupport.scala:23) 
 at akka.pattern.PipeToSupport$PipeableFuture$$anonfun$pipeTo$1.applyOrElse(PipeToSupport.scala:21) 
 at scala.concurrent.Future.$anonfun$andThen$1(Future.scala:532) 
 at scala.concurrent.impl.Promise.liftedTree1$1(Promise.scala:29) 
 at scala.concurrent.impl.Promise.$anonfun$transform$1(Promise.scala:29) 
 at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:60) 
 at akka.dispatch.BatchingExecutor$AbstractBatch.processBatch(BatchingExecutor.scala:55) 
 at akka.dispatch.BatchingExecutor$BlockableBatch.$anonfun$run$1(BatchingExecutor.scala:91) 
 at scala.runtime.java8.JFunction0$mcV$sp.apply(JFunction0$mcV$sp.java:12) 
 at scala.concurrent.BlockContext$.withBlockContext(BlockContext.scala:81) 
 at akka.dispatch.BatchingExecutor$BlockableBatch.run(BatchingExecutor.scala:91) 
 at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:40) 
 at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(ForkJoinExecutorConfigurator.scala:44) 
 at akka.dispatch.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260) 
 at akka.dispatch.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339) 
 at akka.dispatch.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979) 
 at akka.dispatch.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107) Caused by: org.apache.flink.util.FlinkException: Cancellation failed. 
 at org.apache.flink.runtime.jobmaster.JobMasterServiceLeadershipRunner.lambda$cancel$3(JobMasterServiceLeadershipRunner.java:197) 
 at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:884) 
 at java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:866) 
 at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) 
 at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990) 
 at org.apache.flink.runtime.rpc.akka.AkkaInvocationHandler.lambda$invokeRpc$0(AkkaInvocationHandler.java:234) 
 at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774) 
 at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750) 
 at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488) 
 at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990) 
 at org.apache.flink.runtime.concurrent.FutureUtils$1.onComplete(FutureUtils.java:1079) 
 at akka.dispatch.OnComplete.internal(Future.scala:263) 
 at akka.dispatch.OnComplete.internal(Future.scala:261) 
 at akka.dispatch.japi$CallbackBridge.apply(Future.scala:191) 
 at akka.dispatch.japi$CallbackBridge.apply(Future.scala:188) 
 at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:60) 
 at org.apache.flink.runtime.concurrent.Executors$DirectExecutionContext.execute(Executors.java:73) 
 at scala.concurrent.impl.CallbackRunnable.executeWithValue(Promise.scala:68) 
 at scala.concurrent.impl.Promise$DefaultPromise.$anonfun$tryComplete$1(Promise.scala:284) 
 at scala.concurrent.impl.Promise$DefaultPromise.$anonfun$tryComplete$1$adapted(Promise.scala:284) 
 at scala.concurrent.impl.Promise$DefaultPromise.tryComplete(Promise.scala:284) 
 at akka.pattern.PromiseActorRef.$bang(AskSupport.scala:573) 
 at akka.actor.ActorRef.tell(ActorRef.scala:126) 
 at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcInvocation(AkkaRpcActor.java:311) 
 at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:212) 
 at org.apache.flink.runtime.rpc.akka.FencedAkkaRpcActor.handleRpcMessage(FencedAkkaRpcActor.java:77) 
 at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleMessage(AkkaRpcActor.java:158) 
 at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:26) 
 at akka.japi.pf.UnitCaseStatement.apply(CaseStatements.scala:21) 
 at scala.PartialFunction.applyOrElse(PartialFunction.scala:123) 
 at scala.PartialFunction.applyOrElse$(PartialFunction.scala:122) 
 at akka.japi.pf.UnitCaseStatement.applyOrElse(CaseStatements.scala:21) 
 at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:171) 
 at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:172) 
 at scala.PartialFunction$OrElse.applyOrElse(PartialFunction.scala:172) 
 at akka.actor.Actor.aroundReceive(Actor.scala:517) 
 at akka.actor.Actor.aroundReceive$(Actor.scala:515) 
 at akka.actor.AbstractActor.aroundReceive(AbstractActor.scala:225) 
 at akka.actor.ActorCell.receiveMessage(ActorCell.scala:592) 
 at akka.actor.ActorCell.invoke(ActorCell.scala:561) 
 at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:258) 
 at akka.dispatch.Mailbox.run(Mailbox.scala:225) 
 at akka.dispatch.Mailbox.exec(Mailbox.scala:235) ... 4 more Caused by: java.lang.IllegalStateException: Assuming running execution graph 
 at org.apache.flink.util.Preconditions.checkState(Preconditions.java:193) 
 at org.apache.flink.runtime.scheduler.adaptive.StateWithExecutionGraph.(StateWithExecutionGraph.java:94) 
 at org.apache.flink.runtime.scheduler.adaptive.Canceling.(Canceling.java:41) 
 at org.apache.flink.runtime.scheduler.adaptive.Canceling$Factory.getState(Canceling.java:98) 
 at org.apache.flink.runtime.scheduler.adaptive.Canceling$Factory.getState(Canceling.java:72) 
 at org.apache.flink.runtime.scheduler.adaptive.AdaptiveScheduler.transitionToState(AdaptiveScheduler.java:1128) 
 at org.apache.flink.runtime.scheduler.adaptive.AdaptiveScheduler.goToCanceling(AdaptiveScheduler.java:802) 
 at org.apache.flink.runtime.scheduler.adaptive.Restarting.cancel(Restarting.java:74) 
 at org.apache.flink.runtime.scheduler.adaptive.AdaptiveScheduler.cancel(AdaptiveScheduler.java:453) 
 at org.apache.flink.runtime.jobmaster.JobMaster.cancel(JobMaster.java:417) 
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) 
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) 
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) 
 at java.lang.reflect.Method.invoke(Method.java:498) 
 at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcInvocation(AkkaRpcActor.java:305) ... 23 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Sorry for the poor stack trace formatting, I coped the stack trace from the UI)&lt;/p&gt;

&lt;p&gt;It seems that the Canceling state assumes we only transition into it from Executing (ExecutionGraph = RUNNING).&lt;/p&gt;

&lt;p&gt;In my opinion a job should be cancellable at all times, for example when a job is stuck in a restart loop, cancelling is the only way out (unless retries are exhausted).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13376787">FLINK-22574</key>
            <summary>Adaptive Scheduler: Can not cancel restarting job</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rmetzger">Robert Metzger</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 5 May 2021 12:04:46 +0000</created>
                <updated>Sat, 28 Aug 2021 11:21:55 +0000</updated>
                            <resolved>Thu, 13 May 2021 14:51:32 +0000</resolved>
                                    <version>1.13.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.1</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17340235" author="till.rohrmann" created="Thu, 6 May 2021 14:10:00 +0000"  >&lt;p&gt;Thanks for tackling this ticket &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt;. Please set it into progress when you start working on it.&lt;/p&gt;</comment>
                            <comment id="17343486" author="rmetzger" created="Wed, 12 May 2021 18:58:30 +0000"  >&lt;p&gt;Merged to master in &lt;a href=&quot;https://github.com/apache/flink/commit/02d30ace69dc18555a5085eccf70ee884e73a16e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/02d30ace69dc18555a5085eccf70ee884e73a16e&lt;/a&gt;&lt;br/&gt;
Merged to release-1.13 in &lt;a href=&quot;https://github.com/apache/flink/commit/25489aa0cc536f1551a0a887bdfc690824a24bd9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/commit/25489aa0cc536f1551a0a887bdfc690824a24bd9&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0qqy8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>