<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:16:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-30803] PyFlink mishandles script dependencies</title>
                <link>https://issues.apache.org/jira/browse/FLINK-30803</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;h2&gt;&lt;a name=&quot;Summary&quot;&gt;&lt;/a&gt;Summary&lt;/h2&gt;

&lt;p&gt;Since Flink 1.15, PyFlink is unable to run scripts that import scripts under other directories. For instance, if &lt;em&gt;main.py&lt;/em&gt; imports &lt;em&gt;job/word_count.py&lt;/em&gt;, PyFlink will fail due to not finding the &lt;em&gt;job&lt;/em&gt; directory.&lt;/p&gt;

&lt;p&gt;The issue seems to have started after a &lt;a href=&quot;https://github.com/apache/flink/commit/330aae0c6e0811f50888d17830f10f7a29efe7d7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;refactoring of &lt;em&gt;PythonDriver&lt;/em&gt;&lt;/a&gt; to address &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26847&quot; title=&quot;Command line option &amp;#39;-py&amp;#39; doesn&amp;#39;t work in YARN application mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26847&quot;&gt;&lt;del&gt;FLINK-26847&lt;/del&gt;&lt;/a&gt;. The path to the Python script is removed, which forces PyFlink to use the copy in its temporary directory. When files are copied to this directory, the original directory structure is not maintained and ends up breaking the imports.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;Testing&quot;&gt;&lt;/a&gt;Testing&lt;/h2&gt;

&lt;p&gt;To confirm the regression, I ran the attached application in both Flink 1.14.6 and 1.15.3 clusters.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Flink1.14.6&quot;&gt;&lt;/a&gt;Flink 1.14.6&lt;/h3&gt;

&lt;p&gt;Application was able to start after being submitted via CLI:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
% ./bin/flink run --python ~/sandbox/word_count_split/main.py
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.apache.flink.api.java.ClosureCleaner (file:/.../flink-1.14.6/lib/flink-dist_2.12-1.14.6.jar) to field java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.value
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.apache.flink.api.java.ClosureCleaner
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
Job has been submitted with JobID 6f7be21072384ca3a314af10860c4ba8 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Flink1.15.3&quot;&gt;&lt;/a&gt;Flink 1.15.3&lt;/h3&gt;

&lt;p&gt;Application did not start due to not finding the &lt;em&gt;job&lt;/em&gt; directory:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
% ./bin/flink run --python ~/sandbox/word_count_split/main.py
Traceback (most recent call last):
&#160; File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib64/python3.7/runpy.py&quot;&lt;/span&gt;, line 193, in _run_module_as_main
&#160; &#160; &lt;span class=&quot;code-quote&quot;&gt;&quot;__main__&quot;&lt;/span&gt;, mod_spec)
&#160; File &lt;span class=&quot;code-quote&quot;&gt;&quot;/usr/lib64/python3.7/runpy.py&quot;&lt;/span&gt;, line 85, in _run_code
&#160; &#160; exec(code, run_globals)
&#160; File &lt;span class=&quot;code-quote&quot;&gt;&quot;/tmp/pyflink/40c649c3-24af-46ef-ae27-e0019cb55769/3673dd18-adff-40e0-bb11-06a3f00ba29c/main.py&quot;&lt;/span&gt;, line 5, in &amp;lt;module&amp;gt;
&#160; &#160; from job.word_count &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; word_count
ModuleNotFoundError: No module named &lt;span class=&quot;code-quote&quot;&gt;&apos;job&apos;&lt;/span&gt;
org.apache.flink.client.program.ProgramAbortException: java.lang.RuntimeException: Python process exits with code: 1
&#160; &#160; &#160; &#160; at org.apache.flink.client.python.PythonDriver.main(PythonDriver.java:140)
&#160; &#160; &#160; &#160; at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
&#160; &#160; &#160; &#160; at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
&#160; &#160; &#160; &#160; at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
&#160; &#160; &#160; &#160; at java.base/java.lang.reflect.Method.invoke(Method.java:566)
&#160; &#160; &#160; &#160; at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:355)
&#160; &#160; &#160; &#160; at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:222)
&#160; &#160; &#160; &#160; at org.apache.flink.client.ClientUtils.executeProgram(ClientUtils.java:114)
&#160; &#160; &#160; &#160; at org.apache.flink.client.cli.CliFrontend.executeProgram(CliFrontend.java:841)
&#160; &#160; &#160; &#160; at org.apache.flink.client.cli.CliFrontend.run(CliFrontend.java:240)
&#160; &#160; &#160; &#160; at org.apache.flink.client.cli.CliFrontend.parseAndRun(CliFrontend.java:1085)
&#160; &#160; &#160; &#160; at org.apache.flink.client.cli.CliFrontend.lambda$main$10(CliFrontend.java:1163)
&#160; &#160; &#160; &#160; at org.apache.flink.runtime.security.contexts.NoOpSecurityContext.runSecured(NoOpSecurityContext.java:28)
&#160; &#160; &#160; &#160; at org.apache.flink.client.cli.CliFrontend.main(CliFrontend.java:1163)
Caused by: java.lang.RuntimeException: Python process exits with code: 1
&#160; &#160; &#160; &#160; at org.apache.flink.client.python.PythonDriver.main(PythonDriver.java:130)
&#160; &#160; &#160; &#160; ... 13 more &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13521780">FLINK-30803</key>
            <summary>PyFlink mishandles script dependencies</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dianfu">Dian Fu</assignee>
                                    <reporter username="nuafonso">Nuno Afonso</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 27 Jan 2023 15:04:12 +0000</created>
                <updated>Thu, 2 Feb 2023 06:13:02 +0000</updated>
                            <resolved>Thu, 2 Feb 2023 06:13:02 +0000</resolved>
                                    <version>1.16.0</version>
                    <version>1.15.2</version>
                    <version>1.15.3</version>
                                    <fixVersion>1.17.0</fixVersion>
                    <fixVersion>1.15.4</fixVersion>
                    <fixVersion>1.16.2</fixVersion>
                                    <component>API / Python</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17681392" author="JIRAUSER285455" created="Fri, 27 Jan 2023 15:56:38 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dianfu&quot; class=&quot;user-hover&quot; rel=&quot;dianfu&quot;&gt;dianfu&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I am wondering if you can provide some context about your changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26847&quot; title=&quot;Command line option &amp;#39;-py&amp;#39; doesn&amp;#39;t work in YARN application mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26847&quot;&gt;&lt;del&gt;FLINK-26847&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
The quickest fix would be to keep the path to the script, but it looks like it might revert the fix to YARN.&lt;/p&gt;

&lt;p&gt;Thank you,&lt;/p&gt;

&lt;p&gt;Nuno&lt;/p&gt;</comment>
                            <comment id="17681663" author="dianfu" created="Sun, 29 Jan 2023 03:14:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nuafonso&quot; class=&quot;user-hover&quot; rel=&quot;nuafonso&quot;&gt;nuafonso&lt;/a&gt;&lt;br/&gt;
Could you try if the following command works:&lt;br/&gt;
./bin/flink run --python ~/sandbox/word_count_split/main.py --pyFiles ~/sandbox/word_count_split&lt;/p&gt;</comment>
                            <comment id="17682203" author="JIRAUSER285455" created="Mon, 30 Jan 2023 17:37:24 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dianfu&quot; class=&quot;user-hover&quot; rel=&quot;dianfu&quot;&gt;dianfu&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Thank you for the quick reply.&lt;/p&gt;

&lt;p&gt;I can confirm that the application is able to run after adding the &lt;em&gt;--pyFiles&lt;/em&gt; argument.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[flink-1.15.3] &#160;
% ./bin/flink run --python ~/sandbox/word_count_split/main.py --pyFiles ~/sandbox/word_count_split
WARNING: An illegal reflective access operation has occurred
WARNING: Illegal reflective access by org.apache.flink.api.java.ClosureCleaner (file:/.../flink-1.15.3/lib/flink-dist-1.15.3.jar) to field java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.value
WARNING: Please consider reporting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to the maintainers of org.apache.flink.api.java.ClosureCleaner
WARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations
WARNING: All illegal access operations will be denied in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release
Job has been submitted with JobID b8e00aa7a58d1622cf8df25d414c8a0a&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thank you,&lt;/p&gt;

&lt;p&gt;Nuno&lt;/p&gt;</comment>
                            <comment id="17682412" author="dianfu" created="Tue, 31 Jan 2023 07:19:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nuafonso&quot; class=&quot;user-hover&quot; rel=&quot;nuafonso&quot;&gt;nuafonso&lt;/a&gt; Thanks for the confirmation. You could work around it using the above approach. I will figure out if there is a better way to handle this.&lt;/p&gt;</comment>
                            <comment id="17682550" author="dianfu" created="Tue, 31 Jan 2023 12:55:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nuafonso&quot; class=&quot;user-hover&quot; rel=&quot;nuafonso&quot;&gt;nuafonso&lt;/a&gt; Let me explain a bit more about the changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26847&quot; title=&quot;Command line option &amp;#39;-py&amp;#39; doesn&amp;#39;t work in YARN application mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26847&quot;&gt;&lt;del&gt;FLINK-26847&lt;/del&gt;&lt;/a&gt;. It&apos;s introduced to make sure `-py` works in YARN application mode. That&apos;s, users could submit PyFlink jobs using the following command:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/flink run-application -t yarn-application \
-Djobmanager.memory.process.size=1024m \
-Dtaskmanager.memory.process.size=1024m \
-Dyarn.application.name=&amp;lt;ApplicationName&amp;gt; \
-Dyarn.ship-files=/path/to/shipfiles \
-pyarch shipfiles/venv.zip \
-pyclientexec venv.zip/venv/bin/python3 \
-pyexec venv.zip/venv/bin/python3 \
-py shipfiles/word_count.py &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The reason is that, for &lt;b&gt;-py shipfiles/word_count.py&lt;/b&gt;, as it will create a temporary directory as the working directory of the Python process which is responsible to compile the job, so the path `shipfiles/word_count.py ` will not be found during compiling as it&apos;s not inside the working directory.&lt;/p&gt;

&lt;p&gt;After rethinking about this issue, I think a better approach would be let users to use `-pym` explicitly in YARN application mode. So I&apos;d like to revert the changes made in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26847&quot; title=&quot;Command line option &amp;#39;-py&amp;#39; doesn&amp;#39;t work in YARN application mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26847&quot;&gt;&lt;del&gt;FLINK-26847&lt;/del&gt;&lt;/a&gt;. After that, users should submit PyFlink jobs using the following command in YARN application mode:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/flink run-application -t yarn-application \
      -Djobmanager.memory.process.size=1024m \
      -Dtaskmanager.memory.process.size=1024m \
      -Dyarn.application.name=&amp;lt;ApplicationName&amp;gt; \
      -Dyarn.ship-files=/path/to/shipfiles \
      -pyarch shipfiles/venv.zip \
      -pyclientexec venv.zip/venv/bin/python3 \
      -pyexec venv.zip/venv/bin/python3 \
      -pyfs shipfiles \
      -pym word_count &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17683239" author="dianfu" created="Thu, 2 Feb 2023 06:13:02 +0000"  >&lt;p&gt;Fixed in:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master via&#160;68c78dcd0a17f3d13d82b09b61246808e85961c8&lt;/li&gt;
	&lt;li&gt;release-1.16 via&#160;592815cec5ed5f33ae503194fccfe88c7df2eaa5&lt;/li&gt;
	&lt;li&gt;release-1.15 via&#160;a2a7b664e827118c2d54a936e010c63b8acb2668&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="13054841" name="word_count_split.zip" size="2429" author="nuafonso" created="Fri, 27 Jan 2023 14:46:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ffls:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>