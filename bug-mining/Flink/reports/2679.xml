<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9878] IO worker threads BLOCKED on SSL Session Cache while CMS full gc</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9878</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, there is a JDK issue during garbage collection when the SSL session cache is not limited. We should allow the user to configure this and further (advanced) SSL parameters for fine-tuning to fix this and similar issues. In particular, the following parameters should be configurable:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSL session cache size&lt;/li&gt;
	&lt;li&gt;SSL session timeout&lt;/li&gt;
	&lt;li&gt;SSL handshake timeout&lt;/li&gt;
	&lt;li&gt;SSL close notify flush timeout&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
        <key id="13172684">FLINK-9878</key>
            <summary>IO worker threads BLOCKED on SSL Session Cache while CMS full gc</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkruber">Nico Kruber</assignee>
                                    <reporter username="nkruber">Nico Kruber</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 17 Jul 2018 15:04:17 +0000</created>
                <updated>Tue, 23 Oct 2018 08:48:50 +0000</updated>
                            <resolved>Mon, 22 Oct 2018 13:45:05 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.5.1</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.4</fixVersion>
                    <fixVersion>1.6.3</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Runtime / Network</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16547160" author="githubbot" created="Tue, 17 Jul 2018 22:20:01 +0000"  >&lt;p&gt;GitHub user NicoK opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This is mostly to tackle bugs like &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;&lt;br/&gt;
    (JDK issue during garbage collection when the SSL session cache is not limited).&lt;br/&gt;
    We add the following low-level configuration options for the user to fine-tune&lt;br/&gt;
    their system:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSL session cache size&lt;/li&gt;
	&lt;li&gt;SSL session timeout&lt;/li&gt;
	&lt;li&gt;SSL handshake timeout&lt;/li&gt;
	&lt;li&gt;SSL close notify flush timeout&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This is the PR for the `release-1.5` branch only - I&apos;ll create a separate one for `master` due to the changes of #6326.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add `security.ssl.session-cache-size` and `security.ssl.session-timeout` configuration parameters&lt;br/&gt;
    -&amp;gt; configure these for `SSLContext`s created by `SSLUtil`&lt;/li&gt;
	&lt;li&gt;add `security.ssl.handshake-timeout` and `security.ssl.close-notify-flush-timeout`&lt;br/&gt;
    -&amp;gt; configure these in the TM-communication channels via `NettyClient` and `NettyServer`&lt;/li&gt;
	&lt;li&gt;refactor `SSLUtils` so that we extract these configurations separately&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added configuration-verification test to `NettyClientServerSslTest`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;yes&lt;/b&gt;* (kind-of)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;docs + JavaDocs&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/NicoK/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/NicoK/flink&lt;/a&gt; flink-9878&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6355&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 9a19f64130837cba40c8f9b708aa98c002ae1a63&lt;br/&gt;
Author: Nico Kruber &amp;lt;nico@...&amp;gt;&lt;br/&gt;
Date:   2018-07-17T21:40:11Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;/p&gt;

&lt;p&gt;    This is mostly to tackle bugs like &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;&lt;br/&gt;
    (JDK issue during garbage collection when the SSL session cache is not limited).&lt;br/&gt;
    We add the following low-level configuration options for the user to fine-tune&lt;br/&gt;
    their system:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSL session cache size&lt;/li&gt;
	&lt;li&gt;SSL session timeout&lt;/li&gt;
	&lt;li&gt;SSL handshake timeout&lt;/li&gt;
	&lt;li&gt;SSL close notify flush timeout&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="16547419" author="githubbot" created="Wed, 18 Jul 2018 05:55:27 +0000"  >&lt;p&gt;Github user NicoK commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    about the travis error: I tried regenerating the configuration page from the sources but it does not change at all and the &quot;documentation outdated&quot; remains &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16547659" author="githubbot" created="Wed, 18 Jul 2018 10:21:00 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r203326103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r203326103&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java &amp;#8212;&lt;br/&gt;
    @@ -160,4 +160,41 @@&lt;br/&gt;
     		key(&quot;security.ssl.verify-hostname&quot;)&lt;br/&gt;
     			.defaultValue(true)&lt;br/&gt;
     			.withDescription(&quot;Flag to enable peer&#8217;s hostname verification during ssl handshake.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session cache size.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_CACHE_SIZE =&lt;br/&gt;
    +		key(&quot;security.ssl.session-cache-size&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The size of the cache used for storing SSL session objects. &quot;&lt;br/&gt;
    +				+ &quot;According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set &quot;&lt;br/&gt;
    +				+ &quot;this to an appropriate number to not run into a bug with stalling IO threads &quot;&lt;br/&gt;
    +				+ &quot;during garbage collection. (-1 = use system default).&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.session-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout during handshakes.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_HANDSHAKE_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.handshake-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) during SSL handshake. (-1 = use system default)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout after flushing the `close_notify` message.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.close-notify-flush-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    could you try removing the ` signs? let&apos;s see if that trips up the test.&lt;/p&gt;</comment>
                            <comment id="16547909" author="githubbot" created="Wed, 18 Jul 2018 14:40:36 +0000"  >&lt;p&gt;Github user NicoK commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r203405530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r203405530&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java &amp;#8212;&lt;br/&gt;
    @@ -160,4 +160,41 @@&lt;br/&gt;
     		key(&quot;security.ssl.verify-hostname&quot;)&lt;br/&gt;
     			.defaultValue(true)&lt;br/&gt;
     			.withDescription(&quot;Flag to enable peer&#8217;s hostname verification during ssl handshake.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session cache size.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_CACHE_SIZE =&lt;br/&gt;
    +		key(&quot;security.ssl.session-cache-size&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The size of the cache used for storing SSL session objects. &quot;&lt;br/&gt;
    +				+ &quot;According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set &quot;&lt;br/&gt;
    +				+ &quot;this to an appropriate number to not run into a bug with stalling IO threads &quot;&lt;br/&gt;
    +				+ &quot;during garbage collection. (-1 = use system default).&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.session-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout during handshakes.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_HANDSHAKE_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.handshake-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) during SSL handshake. (-1 = use system default)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout after flushing the `close_notify` message.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.close-notify-flush-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    could try - strangely though, this is working for e.g. `security.kerberos.login.contexts` although the desired effect (marking it as code) is not there...but that&apos;s a different problem.&lt;/p&gt;</comment>
                            <comment id="16548014" author="githubbot" created="Wed, 18 Jul 2018 16:05:12 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r203437995&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r203437995&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java &amp;#8212;&lt;br/&gt;
    @@ -160,4 +160,41 @@&lt;br/&gt;
     		key(&quot;security.ssl.verify-hostname&quot;)&lt;br/&gt;
     			.defaultValue(true)&lt;br/&gt;
     			.withDescription(&quot;Flag to enable peer&#8217;s hostname verification during ssl handshake.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session cache size.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_CACHE_SIZE =&lt;br/&gt;
    +		key(&quot;security.ssl.session-cache-size&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The size of the cache used for storing SSL session objects. &quot;&lt;br/&gt;
    +				+ &quot;According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set &quot;&lt;br/&gt;
    +				+ &quot;this to an appropriate number to not run into a bug with stalling IO threads &quot;&lt;br/&gt;
    +				+ &quot;during garbage collection. (-1 = use system default).&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.session-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout during handshakes.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_HANDSHAKE_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.handshake-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) during SSL handshake. (-1 = use system default)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout after flushing the `close_notify` message.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.close-notify-flush-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    it&apos;s not showing up as a code block since that only works for markdown; the description so far was plain-text.&lt;/p&gt;</comment>
                            <comment id="16548875" author="githubbot" created="Thu, 19 Jul 2018 06:48:49 +0000"  >&lt;p&gt;Github user NicoK commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r203617345&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r203617345&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java &amp;#8212;&lt;br/&gt;
    @@ -160,4 +160,41 @@&lt;br/&gt;
     		key(&quot;security.ssl.verify-hostname&quot;)&lt;br/&gt;
     			.defaultValue(true)&lt;br/&gt;
     			.withDescription(&quot;Flag to enable peer&#8217;s hostname verification during ssl handshake.&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session cache size.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_CACHE_SIZE =&lt;br/&gt;
    +		key(&quot;security.ssl.session-cache-size&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The size of the cache used for storing SSL session objects. &quot;&lt;br/&gt;
    +				+ &quot;According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set &quot;&lt;br/&gt;
    +				+ &quot;this to an appropriate number to not run into a bug with stalling IO threads &quot;&lt;br/&gt;
    +				+ &quot;during garbage collection. (-1 = use system default).&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.session-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout during handshakes.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_HANDSHAKE_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.handshake-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) during SSL handshake. (-1 = use system default)&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * SSL session timeout after flushing the `close_notify` message.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT =&lt;br/&gt;
    +		key(&quot;security.ssl.close-notify-flush-timeout&quot;)&lt;br/&gt;
    +			.defaultValue(-1)&lt;br/&gt;
    +			.withDescription(&quot;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    unfortunately yes&lt;/p&gt;

&lt;p&gt;    FYI: I found the difference:&lt;br/&gt;
    `The timeout (in ms) for flushing the close_notify that was triggered by closing a channel. If the close_notify was not flushed in the given timeout the channel will be closed  forcibly. (-1 = use system default)` vs. &lt;br/&gt;
    `The timeout (in ms) for flushing the close_notify that was triggered by closing a channel. If the close_notify was not flushed in the given timeout the channel will be closed forcibly. (-1 = use system default)`&lt;br/&gt;
    -&amp;gt; seems like a double-space is made a single space at some point...fixing...&lt;/p&gt;</comment>
                            <comment id="16549023" author="githubbot" created="Thu, 19 Jul 2018 09:05:16 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r203652194&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r203652194&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/ops/security-ssl.md &amp;#8212;&lt;br/&gt;
    @@ -33,6 +33,9 @@ SSL can be enabled for all network communication between Flink components. SSL k&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;*&lt;b&gt;akka.ssl.enabled&lt;/b&gt;*: SSL flag for akka based control connection between the Flink client, jobmanager and taskmanager&lt;/li&gt;
	&lt;li&gt;*&lt;b&gt;jobmanager.web.ssl.enabled&lt;/b&gt;*: Flag to enable https access to the jobmanager&apos;s web frontend&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +Please see the configuration page about the&lt;br/&gt;
    +&lt;span class=&quot;error&quot;&gt;&amp;#91;complete list of SSL configuration parameters&amp;#93;&lt;/span&gt;(&lt;tt&gt;site.baseurl&lt;/tt&gt;/ops/config.html#ssl-settings), in particular *&lt;b&gt;security.ssl.session-cache-size&lt;/b&gt;*.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    just a suggestion, you could also embed the entire table directly, see `Configuration.md` on how to do it.&lt;/p&gt;</comment>
                            <comment id="16549030" author="githubbot" created="Thu, 19 Jul 2018 09:07:47 +0000"  >&lt;p&gt;Github user NicoK commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r203652882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r203652882&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: docs/ops/security-ssl.md &amp;#8212;&lt;br/&gt;
    @@ -33,6 +33,9 @@ SSL can be enabled for all network communication between Flink components. SSL k&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;*&lt;b&gt;akka.ssl.enabled&lt;/b&gt;*: SSL flag for akka based control connection between the Flink client, jobmanager and taskmanager&lt;/li&gt;
	&lt;li&gt;*&lt;b&gt;jobmanager.web.ssl.enabled&lt;/b&gt;*: Flag to enable https access to the jobmanager&apos;s web frontend&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +Please see the configuration page about the&lt;br/&gt;
    +&lt;span class=&quot;error&quot;&gt;&amp;#91;complete list of SSL configuration parameters&amp;#93;&lt;/span&gt;(&lt;tt&gt;site.baseurl&lt;/tt&gt;/ops/config.html#ssl-settings), in particular *&lt;b&gt;security.ssl.session-cache-size&lt;/b&gt;*.&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    agreed, that would make sense&lt;/p&gt;</comment>
                            <comment id="16549049" author="githubbot" created="Thu, 19 Jul 2018 09:29:55 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r203657904&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r203657904&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java &amp;#8212;&lt;br/&gt;
    @@ -52,6 +55,7 @@&lt;/p&gt;

&lt;p&gt;     	private Bootstrap bootstrap;&lt;/p&gt;

&lt;p&gt;    +	private SSLUtils.SSLClientConfiguration clientSSLConfig;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    add `@Nullable`&lt;/p&gt;</comment>
                            <comment id="16549050" author="githubbot" created="Thu, 19 Jul 2018 09:29:55 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r203658272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r203658272&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java &amp;#8212;&lt;br/&gt;
    @@ -61,6 +62,7 @@&lt;/p&gt;

&lt;p&gt;     	private ChannelFuture bindFuture;&lt;/p&gt;

&lt;p&gt;    +	private SSLUtils.SSLServerConfiguration serverSSLConfig;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    add `@Nullable`&lt;/p&gt;</comment>
                            <comment id="16552546" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204324645&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204324645&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java &amp;#8212;&lt;br/&gt;
    @@ -175,7 +183,6 @@ ChannelFuture connect(final InetSocketAddress serverSocketAddress) {&lt;br/&gt;
     		bootstrap.handler(new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {&lt;br/&gt;
     			@Override&lt;br/&gt;
     			public void initChannel(SocketChannel channel) throws Exception {&lt;br/&gt;
    -&lt;br/&gt;
     				// SSL handler should be added first in the pipeline&lt;br/&gt;
     				if (clientSSLContext != null) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    `checkState(!clientSSLContext.isEmpty())`? How can it ever be null?&lt;/p&gt;</comment>
                            <comment id="16552547" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204300332&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204300332&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java &amp;#8212;&lt;br/&gt;
    @@ -52,6 +56,9 @@&lt;/p&gt;

&lt;p&gt;     	private Bootstrap bootstrap;&lt;/p&gt;

&lt;p&gt;    +	@Nullable&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Same argument as somewhere else: `Optional`.  You mark `clientSSLConfig` as nullable and never check it for not null. &lt;/p&gt;</comment>
                            <comment id="16552548" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204298813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204298813&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java &amp;#8212;&lt;br/&gt;
    @@ -189,23 +192,34 @@ public TransportType getTransportType() {&lt;br/&gt;
     		}&lt;br/&gt;
     	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLContext createClientSSLContext() throws Exception {&lt;br/&gt;
    +	@Nullable
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    `Optional` and ditto in other places. `@Nullable` is almost worthless without enforcing compile errors.&lt;/p&gt;</comment>
                            <comment id="16552549" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204325132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204325132&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java &amp;#8212;&lt;br/&gt;
    @@ -61,6 +63,9 @@&lt;/p&gt;

&lt;p&gt;     	private ChannelFuture bindFuture;&lt;/p&gt;

&lt;p&gt;    +	@Nullable&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Please deduplicate this code with `NettyClient`. Introduce `NettyBase`, `NettyInitializer` or sth like that&lt;/p&gt;</comment>
                            <comment id="16552550" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204326191&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204326191&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java &amp;#8212;&lt;br/&gt;
    @@ -163,80 +163,188 @@ public static void setSSLVerifyHostname(Configuration sslConfig, SSLParameters s&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates the SSL Context for the client if SSL is configured.&lt;br/&gt;
    +	 * Configuration settings and key/trustmanager instances to set up an SSL client connection.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class SSLClientConfiguration 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		public final String sslProtocolVersion;    +		public final TrustManagerFactory trustManagerFactory;    +		public final int sessionCacheSize;    +		public final int sessionTimeoutMs;    +		public final int handshakeTimeoutMs;    +		public final int closeNotifyFlushTimeoutMs;    +    +		public SSLClientConfiguration(    +				String sslProtocolVersion,    +				TrustManagerFactory trustManagerFactory,    +				int sessionCacheSize,    +				int sessionTimeoutMs,    +				int handshakeTimeoutMs,    +				int closeNotifyFlushTimeoutMs) {
    +			this.sslProtocolVersion = sslProtocolVersion;
    +			this.trustManagerFactory = trustManagerFactory;
    +			this.sessionCacheSize = sessionCacheSize;
    +			this.sessionTimeoutMs = sessionTimeoutMs;
    +			this.handshakeTimeoutMs = handshakeTimeoutMs;
    +			this.closeNotifyFlushTimeoutMs = closeNotifyFlushTimeoutMs;
    +		}    +	}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates necessary helper objects to use for creating an SSL Context for the client if SSL is&lt;br/&gt;
    +	 * configured.&lt;br/&gt;
     	 *&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param sslConfig&lt;/li&gt;
	&lt;li&gt;The application configuration&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return The SSLContext object which can be used by the ssl transport client&lt;/li&gt;
	&lt;li&gt;* 	       Returns null if SSL is disabled&lt;br/&gt;
    +	 * @return The SSLClientConfiguration object which can be used for creating some SSL context object;&lt;br/&gt;
    +	 * 	       returns &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; if SSL is disabled.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@throws Exception&lt;/li&gt;
	&lt;li&gt;Thrown if there is any misconfiguration&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Nullable&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SSLContext createSSLClientContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
    -&lt;br/&gt;
    +	public static SSLClientConfiguration createSSLClientConfiguration(Configuration sslConfig) throws Exception {&lt;br/&gt;
     		Preconditions.checkNotNull(sslConfig);&lt;/li&gt;
	&lt;li&gt;SSLContext clientSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		if (getSSLEnabled(sslConfig)) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    reverse if/else conditions and `Optional`&lt;br/&gt;
    ```&lt;br/&gt;
    if (!getSSLEnabled(...)) &lt;/p&gt;
{
      return Optional.empty();
    }</comment>
                            <comment id="16552551" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204301373&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204301373&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java &amp;#8212;&lt;br/&gt;
    @@ -52,6 +56,9 @@&lt;/p&gt;

&lt;p&gt;     	private Bootstrap bootstrap;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    `bootstrap` is nullable and not marked - change to `Optional`&lt;/p&gt;</comment>
                            <comment id="16552552" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204329262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204329262&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java &amp;#8212;&lt;br/&gt;
    @@ -249,14 +357,73 @@ public static SSLContext createSSLServerContext(Configuration sslConfig) throws&lt;/p&gt;

&lt;p&gt;     			// Set up key manager factory to use the server key store&lt;br/&gt;
     			KeyManagerFactory kmf = KeyManagerFactory.getInstance(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KeyManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
    +				KeyManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
     			kmf.init(ks, certPassword.toCharArray());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +			return new SSLServerConfiguration(&lt;br/&gt;
    +				sslProtocolVersion,&lt;br/&gt;
    +				sslCipherSuites,&lt;br/&gt;
    +				kmf,&lt;br/&gt;
    +				sessionCacheSize,&lt;br/&gt;
    +				sessionTimeoutMs,&lt;br/&gt;
    +				handshakeTimeoutMs,&lt;br/&gt;
    +				closeNotifyFlushTimeoutMs);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		return null;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates the SSL Context for the server assuming SSL is configured.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param sslConfig&lt;br/&gt;
    +	 *        The application configuration&lt;br/&gt;
    +	 * @return The SSLContext object which can be used by the ssl transport server&lt;br/&gt;
    +	 * @throws Exception&lt;br/&gt;
    +	 *         Thrown if there is any misconfiguration&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Nullable&lt;br/&gt;
    +	public static SSLContext createSSLServerContext(SSLServerConfiguration sslConfig) throws Exception {&lt;br/&gt;
    +		Preconditions.checkNotNull(sslConfig);&lt;br/&gt;
    +&lt;br/&gt;
    +		LOG.debug(&quot;Creating server SSL context from configuration&quot;);&lt;br/&gt;
    +		SSLContext serverSSLContext = SSLContext.getInstance(sslConfig.sslProtocolVersion);&lt;br/&gt;
    +		serverSSLContext.init(sslConfig.keyManagerFactory.getKeyManagers(), null, null);&lt;br/&gt;
    +		if (sslConfig.sessionCacheSize &amp;gt;= 0) &lt;/p&gt;
{
    +			serverSSLContext.getServerSessionContext().setSessionCacheSize(sslConfig.sessionCacheSize);
    +		}
&lt;p&gt;    +		if (sslConfig.sessionTimeoutMs &amp;gt;= 0) &lt;/p&gt;
{
    +			serverSSLContext.getServerSessionContext().setSessionTimeout(sslConfig.sessionTimeoutMs / 1000);
    +		}
&lt;p&gt;    +&lt;br/&gt;
    +		return serverSSLContext;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates the SSL Context for the server if SSL is configured.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param sslConfig&lt;br/&gt;
    +	 *        The application configuration&lt;br/&gt;
    +	 * @return The SSLContext object which can be used by the ssl transport server&lt;br/&gt;
    +	 * 	       Returns null if SSL is disabled&lt;br/&gt;
    +	 * @throws Exception&lt;br/&gt;
    +	 *         Thrown if there is any misconfiguration&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Nullable&lt;br/&gt;
    +	public static SSLContext createSSLServerContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
    +&lt;br/&gt;
    +		Preconditions.checkNotNull(sslConfig);&lt;br/&gt;
    +		SSLContext serverSSLContext = null;&lt;br/&gt;
    +&lt;br/&gt;
    +		if (getSSLEnabled(sslConfig)) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    ditto: reverse if branch and `Optional`&lt;/p&gt;</comment>
                            <comment id="16552553" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204328596&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204328596&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java &amp;#8212;&lt;br/&gt;
    @@ -163,80 +163,188 @@ public static void setSSLVerifyHostname(Configuration sslConfig, SSLParameters s&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates the SSL Context for the client if SSL is configured.&lt;br/&gt;
    +	 * Configuration settings and key/trustmanager instances to set up an SSL client connection.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class SSLClientConfiguration 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		public final String sslProtocolVersion;    +		public final TrustManagerFactory trustManagerFactory;    +		public final int sessionCacheSize;    +		public final int sessionTimeoutMs;    +		public final int handshakeTimeoutMs;    +		public final int closeNotifyFlushTimeoutMs;    +    +		public SSLClientConfiguration(    +				String sslProtocolVersion,    +				TrustManagerFactory trustManagerFactory,    +				int sessionCacheSize,    +				int sessionTimeoutMs,    +				int handshakeTimeoutMs,    +				int closeNotifyFlushTimeoutMs) {
    +			this.sslProtocolVersion = sslProtocolVersion;
    +			this.trustManagerFactory = trustManagerFactory;
    +			this.sessionCacheSize = sessionCacheSize;
    +			this.sessionTimeoutMs = sessionTimeoutMs;
    +			this.handshakeTimeoutMs = handshakeTimeoutMs;
    +			this.closeNotifyFlushTimeoutMs = closeNotifyFlushTimeoutMs;
    +		}    +	}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates necessary helper objects to use for creating an SSL Context for the client if SSL is&lt;br/&gt;
    +	 * configured.&lt;br/&gt;
     	 *&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param sslConfig&lt;/li&gt;
	&lt;li&gt;The application configuration&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return The SSLContext object which can be used by the ssl transport client&lt;/li&gt;
	&lt;li&gt;* 	       Returns null if SSL is disabled&lt;br/&gt;
    +	 * @return The SSLClientConfiguration object which can be used for creating some SSL context object;&lt;br/&gt;
    +	 * 	       returns &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; if SSL is disabled.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@throws Exception&lt;/li&gt;
	&lt;li&gt;Thrown if there is any misconfiguration&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Nullable&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SSLContext createSSLClientContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
    -&lt;br/&gt;
    +	public static SSLClientConfiguration createSSLClientConfiguration(Configuration sslConfig) throws Exception {&lt;br/&gt;
     		Preconditions.checkNotNull(sslConfig);&lt;/li&gt;
	&lt;li&gt;SSLContext clientSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		if (getSSLEnabled(sslConfig)) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LOG.debug(&quot;Creating client SSL context from configuration&quot;);&lt;br/&gt;
    +			LOG.debug(&quot;Creating client SSL configuration&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     			String trustStoreFilePath = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE);&lt;br/&gt;
     			String trustStorePassword = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD);&lt;br/&gt;
     			String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
    +			int sessionCacheSize = sslConfig.getInteger(SecurityOptions.SSL_SESSION_CACHE_SIZE);&lt;br/&gt;
    +			int sessionTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_SESSION_TIMEOUT);&lt;br/&gt;
    +			int handshakeTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_HANDSHAKE_TIMEOUT);&lt;br/&gt;
    +			int closeNotifyFlushTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT);&lt;/p&gt;

&lt;p&gt;     			Preconditions.checkNotNull(trustStoreFilePath, SecurityOptions.SSL_TRUSTSTORE.key() + &quot; was not configured.&quot;);&lt;br/&gt;
     			Preconditions.checkNotNull(trustStorePassword, SecurityOptions.SSL_TRUSTSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/p&gt;

&lt;p&gt;     			KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FileInputStream trustStoreFile = null;&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;trustStoreFile = new FileInputStream(new File(trustStoreFilePath));&lt;br/&gt;
    +			try (FileInputStream trustStoreFile = new FileInputStream(new File(trustStoreFilePath))) 
{
     				trustStore.load(trustStoreFile, trustStorePassword.toCharArray());
    -			}
&lt;p&gt; finally {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (trustStoreFile != null) 
{
    -					trustStoreFile.close();
    -				}
&lt;p&gt;     			}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     			TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(&lt;br/&gt;
     				TrustManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
     			trustManagerFactory.init(trustStore);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;clientSSLContext = SSLContext.getInstance(sslProtocolVersion);&lt;/li&gt;
	&lt;li&gt;clientSSLContext.init(null, trustManagerFactory.getTrustManagers(), null);&lt;br/&gt;
    +			return new SSLClientConfiguration(&lt;br/&gt;
    +				sslProtocolVersion,&lt;br/&gt;
    +				trustManagerFactory,&lt;br/&gt;
    +				sessionCacheSize,&lt;br/&gt;
    +				sessionTimeoutMs,&lt;br/&gt;
    +				handshakeTimeoutMs,&lt;br/&gt;
    +				closeNotifyFlushTimeoutMs);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		return null;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates the SSL Context for the client assuming SSL is configured.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param sslConfig&lt;br/&gt;
    +	 *        SSL configuration&lt;br/&gt;
    +	 * @return The SSLContext object which can be used by the ssl transport client&lt;br/&gt;
    +	 * @throws Exception&lt;br/&gt;
    +	 *         Thrown if there is any misconfiguration&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static SSLContext createSSLClientContext(SSLClientConfiguration sslConfig) throws Exception {&lt;br/&gt;
    +		Preconditions.checkNotNull(sslConfig);&lt;br/&gt;
    +&lt;br/&gt;
    +		LOG.debug(&quot;Creating client SSL context from configuration&quot;);&lt;br/&gt;
    +		SSLContext clientSSLContext = SSLContext.getInstance(sslConfig.sslProtocolVersion);&lt;br/&gt;
    +		clientSSLContext.init(null, sslConfig.trustManagerFactory.getTrustManagers(), null);&lt;br/&gt;
    +		if (sslConfig.sessionCacheSize &amp;gt;= 0) 
{
    +			clientSSLContext.getClientSessionContext().setSessionCacheSize(sslConfig.sessionCacheSize);
    +		}
&lt;p&gt;    +		if (sslConfig.sessionTimeoutMs &amp;gt;= 0) &lt;/p&gt;
{
    +			clientSSLContext.getClientSessionContext().setSessionTimeout(sslConfig.sessionTimeoutMs / 1000);
     		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return clientSSLContext;&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates the SSL Context for the server if SSL is configured.&lt;br/&gt;
    +	 * Creates the SSL Context for the client if SSL is configured.&lt;br/&gt;
     	 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param sslConfig&lt;/li&gt;
	&lt;li&gt;The application configuration&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return The SSLContext object which can be used by the ssl transport server&lt;br/&gt;
    +	 * @return The SSLContext object which can be used by the ssl transport client&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;Returns null if SSL is disabled&lt;/li&gt;
	&lt;li&gt;@throws Exception&lt;/li&gt;
	&lt;li&gt;Thrown if there is any misconfiguration&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Nullable&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SSLContext createSSLServerContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
    +	public static SSLContext createSSLClientContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
    +		Preconditions.checkNotNull(sslConfig);&lt;br/&gt;
    +		SSLContext clientSSLContext = null;&lt;br/&gt;
    +&lt;br/&gt;
    +		if (getSSLEnabled(sslConfig)) 
{
    +			SSLClientConfiguration clientConfiguration = createSSLClientConfiguration(sslConfig);
    +			clientSSLContext = createSSLClientContext(clientConfiguration);
    +		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +		return clientSSLContext;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Configuration settings and key/trustmanager instances to set up an SSL server connection.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class SSLServerConfiguration {&lt;br/&gt;
    +		public final String sslProtocolVersion;&lt;br/&gt;
    +		public final String[] ciphers;&lt;br/&gt;
    +		public final KeyManagerFactory keyManagerFactory;&lt;br/&gt;
    +		public final int sessionCacheSize;&lt;br/&gt;
    +		public final int sessionTimeoutMs;&lt;br/&gt;
    +		public final int handshakeTimeoutMs;&lt;br/&gt;
    +		public final int closeNotifyFlushTimeoutMs;&lt;br/&gt;
    +&lt;br/&gt;
    +		public SSLServerConfiguration(&lt;br/&gt;
    +				String sslProtocolVersion,&lt;br/&gt;
    +				String[] ciphers,&lt;br/&gt;
    +				KeyManagerFactory keyManagerFactory,&lt;br/&gt;
    +				int sessionCacheSize,&lt;br/&gt;
    +				int sessionTimeoutMs,&lt;br/&gt;
    +				int handshakeTimeoutMs,&lt;br/&gt;
    +				int closeNotifyFlushTimeoutMs) &lt;/p&gt;
{
    +			this.sslProtocolVersion = sslProtocolVersion;
    +			this.ciphers = ciphers;
    +			this.keyManagerFactory = keyManagerFactory;
    +			this.sessionCacheSize = sessionCacheSize;
    +			this.sessionTimeoutMs = sessionTimeoutMs;
    +			this.handshakeTimeoutMs = handshakeTimeoutMs;
    +			this.closeNotifyFlushTimeoutMs = closeNotifyFlushTimeoutMs;
    +		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates necessary helper objects to use for creating an SSL Context for the server if SSL is&lt;br/&gt;
    +	 * configured.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param sslConfig&lt;br/&gt;
    +	 *        The application configuration&lt;br/&gt;
    +	 * @return The SSLServerConfiguration object which can be used for creating some SSL context object;&lt;br/&gt;
    +	 * 	       returns &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; if SSL is disabled.&lt;br/&gt;
    +	 * @throws Exception&lt;br/&gt;
    +	 *         Thrown if there is any misconfiguration&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Nullable&lt;br/&gt;
    +	public static SSLServerConfiguration createSSLServerConfiguration(Configuration sslConfig) throws Exception {&lt;br/&gt;
     		Preconditions.checkNotNull(sslConfig);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLContext serverSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		if (getSSLEnabled(sslConfig)) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    1. ditto:&lt;br/&gt;
    ```&lt;br/&gt;
    if (!getSSLEnabled(sslConfig)) &lt;/p&gt;
{
      return Optional.empty();
    }
&lt;p&gt;    ```&lt;/p&gt;

&lt;p&gt;    2. possible ditto: code duplication. &lt;/p&gt;</comment>
                            <comment id="16552554" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204330930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204330930&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java &amp;#8212;&lt;br/&gt;
    @@ -65,6 +68,60 @@ public void testValidSslConnection() throws Exception &lt;/p&gt;
{
     
     		Channel ch = NettyTestUtil.connect(serverAndClient);
     
    +		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);
    +		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getHandshakeTimeoutMillis() &amp;gt;= 0);
    +		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getCloseNotifyTimeoutMillis() &amp;gt;= 0);
    +
    +		// should be able to send text data
    +		ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());
    +		assertTrue(ch.writeAndFlush(&quot;test&quot;).await().isSuccess());
    +
    +		NettyTestUtil.shutdown(serverAndClient);
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Verify valid (advanced) ssl configuration and connection.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testValidSslConnectionAdvanced() throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This is quite poor test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; With respect to `SESSION_CACHE_SIZE` and `SESSION_TIMEOUT` it tests only for &quot;not throwing any exception&quot;. If those properties are just ignored, the test will still pass. &lt;/p&gt;

&lt;p&gt;    Can we add some stress test that actually verifies the bug which this PR is trying to solve? Maybe stress test AND benchmark like `StreamNetworkThroughputBenchmarkTest#largeRemoteMode`?&lt;/p&gt;</comment>
                            <comment id="16552555" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204329756&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204329756&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java &amp;#8212;&lt;br/&gt;
    @@ -65,6 +68,60 @@ public void testValidSslConnection() throws Exception &lt;/p&gt;
{
     
     		Channel ch = NettyTestUtil.connect(serverAndClient);
     
    +		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);
    +		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getHandshakeTimeoutMillis() &amp;gt;= 0);
    +		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getCloseNotifyTimeoutMillis() &amp;gt;= 0);
    +
    +		// should be able to send text data
    +		ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());
    +		assertTrue(ch.writeAndFlush(&quot;test&quot;).await().isSuccess());
    +
    +		NettyTestUtil.shutdown(serverAndClient);
    +	}
&lt;p&gt;    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Verify valid (advanced) ssl configuration and connection.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@Test&lt;br/&gt;
    +	public void testValidSslConnectionAdvanced() throws Exception {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    please deduplicate code with `testValidSslConnection`&lt;/p&gt;</comment>
                            <comment id="16552556" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204328091&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204328091&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java &amp;#8212;&lt;br/&gt;
    @@ -163,80 +163,188 @@ public static void setSSLVerifyHostname(Configuration sslConfig, SSLParameters s&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates the SSL Context for the client if SSL is configured.&lt;br/&gt;
    +	 * Configuration settings and key/trustmanager instances to set up an SSL client connection.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class SSLClientConfiguration 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +		public final String sslProtocolVersion;    +		public final TrustManagerFactory trustManagerFactory;    +		public final int sessionCacheSize;    +		public final int sessionTimeoutMs;    +		public final int handshakeTimeoutMs;    +		public final int closeNotifyFlushTimeoutMs;    +    +		public SSLClientConfiguration(    +				String sslProtocolVersion,    +				TrustManagerFactory trustManagerFactory,    +				int sessionCacheSize,    +				int sessionTimeoutMs,    +				int handshakeTimeoutMs,    +				int closeNotifyFlushTimeoutMs) {
    +			this.sslProtocolVersion = sslProtocolVersion;
    +			this.trustManagerFactory = trustManagerFactory;
    +			this.sessionCacheSize = sessionCacheSize;
    +			this.sessionTimeoutMs = sessionTimeoutMs;
    +			this.handshakeTimeoutMs = handshakeTimeoutMs;
    +			this.closeNotifyFlushTimeoutMs = closeNotifyFlushTimeoutMs;
    +		}    +	}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates necessary helper objects to use for creating an SSL Context for the client if SSL is&lt;br/&gt;
    +	 * configured.&lt;br/&gt;
     	 *&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param sslConfig&lt;/li&gt;
	&lt;li&gt;The application configuration&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return The SSLContext object which can be used by the ssl transport client&lt;/li&gt;
	&lt;li&gt;* 	       Returns null if SSL is disabled&lt;br/&gt;
    +	 * @return The SSLClientConfiguration object which can be used for creating some SSL context object;&lt;br/&gt;
    +	 * 	       returns &amp;lt;tt&amp;gt;null&amp;lt;/tt&amp;gt; if SSL is disabled.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@throws Exception&lt;/li&gt;
	&lt;li&gt;Thrown if there is any misconfiguration&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Nullable&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SSLContext createSSLClientContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
    -&lt;br/&gt;
    +	public static SSLClientConfiguration createSSLClientConfiguration(Configuration sslConfig) throws Exception {&lt;br/&gt;
     		Preconditions.checkNotNull(sslConfig);&lt;/li&gt;
	&lt;li&gt;SSLContext clientSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		if (getSSLEnabled(sslConfig)) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;LOG.debug(&quot;Creating client SSL context from configuration&quot;);&lt;br/&gt;
    +			LOG.debug(&quot;Creating client SSL configuration&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     			String trustStoreFilePath = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE);&lt;br/&gt;
     			String trustStorePassword = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD);&lt;br/&gt;
     			String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
    +			int sessionCacheSize = sslConfig.getInteger(SecurityOptions.SSL_SESSION_CACHE_SIZE);&lt;br/&gt;
    +			int sessionTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_SESSION_TIMEOUT);&lt;br/&gt;
    +			int handshakeTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_HANDSHAKE_TIMEOUT);&lt;br/&gt;
    +			int closeNotifyFlushTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT);&lt;/p&gt;

&lt;p&gt;     			Preconditions.checkNotNull(trustStoreFilePath, SecurityOptions.SSL_TRUSTSTORE.key() + &quot; was not configured.&quot;);&lt;br/&gt;
     			Preconditions.checkNotNull(trustStorePassword, SecurityOptions.SSL_TRUSTSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/p&gt;

&lt;p&gt;     			KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FileInputStream trustStoreFile = null;&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;trustStoreFile = new FileInputStream(new File(trustStoreFilePath));&lt;br/&gt;
    +			try (FileInputStream trustStoreFile = new FileInputStream(new File(trustStoreFilePath))) 
{
     				trustStore.load(trustStoreFile, trustStorePassword.toCharArray());
    -			}
&lt;p&gt; finally {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (trustStoreFile != null) 
{
    -					trustStoreFile.close();
    -				}
&lt;p&gt;     			}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     			TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(&lt;br/&gt;
     				TrustManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
     			trustManagerFactory.init(trustStore);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;clientSSLContext = SSLContext.getInstance(sslProtocolVersion);&lt;/li&gt;
	&lt;li&gt;clientSSLContext.init(null, trustManagerFactory.getTrustManagers(), null);&lt;br/&gt;
    +			return new SSLClientConfiguration(&lt;br/&gt;
    +				sslProtocolVersion,&lt;br/&gt;
    +				trustManagerFactory,&lt;br/&gt;
    +				sessionCacheSize,&lt;br/&gt;
    +				sessionTimeoutMs,&lt;br/&gt;
    +				handshakeTimeoutMs,&lt;br/&gt;
    +				closeNotifyFlushTimeoutMs);&lt;br/&gt;
    +		}&lt;br/&gt;
    +&lt;br/&gt;
    +		return null;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Creates the SSL Context for the client assuming SSL is configured.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param sslConfig&lt;br/&gt;
    +	 *        SSL configuration&lt;br/&gt;
    +	 * @return The SSLContext object which can be used by the ssl transport client&lt;br/&gt;
    +	 * @throws Exception&lt;br/&gt;
    +	 *         Thrown if there is any misconfiguration&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static SSLContext createSSLClientContext(SSLClientConfiguration sslConfig) throws Exception {&lt;br/&gt;
    +		Preconditions.checkNotNull(sslConfig);&lt;br/&gt;
    +&lt;br/&gt;
    +		LOG.debug(&quot;Creating client SSL context from configuration&quot;);&lt;br/&gt;
    +		SSLContext clientSSLContext = SSLContext.getInstance(sslConfig.sslProtocolVersion);&lt;br/&gt;
    +		clientSSLContext.init(null, sslConfig.trustManagerFactory.getTrustManagers(), null);&lt;br/&gt;
    +		if (sslConfig.sessionCacheSize &amp;gt;= 0) 
{
    +			clientSSLContext.getClientSessionContext().setSessionCacheSize(sslConfig.sessionCacheSize);
    +		}
&lt;p&gt;    +		if (sslConfig.sessionTimeoutMs &amp;gt;= 0) &lt;/p&gt;
{
    +			clientSSLContext.getClientSessionContext().setSessionTimeout(sslConfig.sessionTimeoutMs / 1000);
     		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		return clientSSLContext;&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates the SSL Context for the server if SSL is configured.&lt;br/&gt;
    +	 * Creates the SSL Context for the client if SSL is configured.&lt;br/&gt;
     	 *&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;@param sslConfig&lt;/li&gt;
	&lt;li&gt;The application configuration&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* @return The SSLContext object which can be used by the ssl transport server&lt;br/&gt;
    +	 * @return The SSLContext object which can be used by the ssl transport client&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;Returns null if SSL is disabled&lt;/li&gt;
	&lt;li&gt;@throws Exception&lt;/li&gt;
	&lt;li&gt;Thrown if there is any misconfiguration&lt;br/&gt;
     	 */&lt;br/&gt;
     	@Nullable&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SSLContext createSSLServerContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
    +	public static SSLContext createSSLClientContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
    +		Preconditions.checkNotNull(sslConfig);&lt;br/&gt;
    +		SSLContext clientSSLContext = null;&lt;br/&gt;
    +&lt;br/&gt;
    +		if (getSSLEnabled(sslConfig)) 
{
    +			SSLClientConfiguration clientConfiguration = createSSLClientConfiguration(sslConfig);
    +			clientSSLContext = createSSLClientContext(clientConfiguration);
    +		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +		return clientSSLContext;&lt;br/&gt;
    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Configuration settings and key/trustmanager instances to set up an SSL server connection.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class SSLServerConfiguration {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Another code duplication. Extract common properties to `SSLClientServerCommonConfiguration`?&lt;/p&gt;</comment>
                            <comment id="16552557" author="githubbot" created="Mon, 23 Jul 2018 09:29:33 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r204336114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r204336114&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java &amp;#8212;&lt;br/&gt;
    @@ -163,80 +163,188 @@ public static void setSSLVerifyHostname(Configuration sslConfig, SSLParameters s&lt;br/&gt;
     	}&lt;/p&gt;

&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates the SSL Context for the client if SSL is configured.&lt;br/&gt;
    +	 * Configuration settings and key/trustmanager instances to set up an SSL client connection.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static class SSLClientConfiguration {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    What&apos;s the value of introducing `SSLClientConfiguration`? As far as I can tell, the only point is to provide accessors to `handshakeTimeoutMS` and `closeNotifyFlushTimeoutMs` in `NettyClient#connect`, but it complicates initialisation by introducing one more extra obligatory step. &lt;/p&gt;

&lt;p&gt;    Wouldn&apos;t it be better to wrap `SSLContext` with our class that provides those accessors? It seems like this would also remove the need for separate `SSLClientConfiguration` and `SSLServerConfiguration`, since all of theirs fields  except of `handshakeTimeoutMS` and `closeNotifyFlushTimeoutMs` are/should be private.&lt;/p&gt;</comment>
                            <comment id="16565415" author="githubbot" created="Wed, 1 Aug 2018 14:36:56 +0000"  >&lt;p&gt;NicoK commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r206905353&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r206905353&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -26,13 +26,16 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.string.StringDecoder;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.string.StringEncoder;&lt;br/&gt;
+import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;/p&gt;

&lt;p&gt; import org.junit.Assert;&lt;br/&gt;
 import org.junit.Test;&lt;/p&gt;

&lt;p&gt; import java.net.InetAddress;&lt;/p&gt;

&lt;p&gt;+import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertFalse;&lt;br/&gt;
+import static org.junit.Assert.assertNotNull;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   unused - remove!&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16569951" author="githubbot" created="Mon, 6 Aug 2018 09:39:28 +0000"  >&lt;p&gt;StephanEwen commented on issue #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#issuecomment-410649691&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#issuecomment-410649691&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Does it make sense to set some sane default values here, if Java&apos;s defaults are a bit insane?&lt;/p&gt;

&lt;p&gt;   For example:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Handshake timeout could be higher. We have seen that this helps overloaded systems.&lt;/li&gt;
	&lt;li&gt;Would it make sense to minimize session caches and timeout? We never reconnect a TPC connection trying to &quot;fast resume&quot; an SSL session.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16573164" author="githubbot" created="Wed, 8 Aug 2018 12:43:49 +0000"  >&lt;p&gt;NicoK commented on issue #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#issuecomment-411391874&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#issuecomment-411391874&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Yes, that makes sense and is marked as a follow-up task: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9879&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-9879&lt;/a&gt;&lt;br/&gt;
   -&amp;gt; it probably takes some experiments to find the right parameters and their implications. Intuitively, I would agree with the session cache and timeout...&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16578611" author="githubbot" created="Mon, 13 Aug 2018 16:53:53 +0000"  >&lt;p&gt;NicoK commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r209682805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r209682805&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -163,80 +163,188 @@ public static void setSSLVerifyHostname(Configuration sslConfig, SSLParameters s&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates the SSL Context for the client if SSL is configured.&lt;br/&gt;
+	 * Configuration settings and key/trustmanager instances to set up an SSL client connection.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static class SSLClientConfiguration {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   good idea - that makes the change even smaller&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16578629" author="githubbot" created="Mon, 13 Aug 2018 17:12:34 +0000"  >&lt;p&gt;NicoK commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r209682805&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r209682805&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -163,80 +163,188 @@ public static void setSSLVerifyHostname(Configuration sslConfig, SSLParameters s&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates the SSL Context for the client if SSL is configured.&lt;br/&gt;
+	 * Configuration settings and key/trustmanager instances to set up an SSL client connection.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static class SSLClientConfiguration {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   good idea - that makes the change even smaller...well, at least the important parts of the change &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16578643" author="githubbot" created="Mon, 13 Aug 2018 17:19:01 +0000"  >&lt;p&gt;NicoK commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r209690309&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r209690309&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -52,6 +56,9 @@&lt;/p&gt;

&lt;p&gt; 	private Bootstrap bootstrap;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   out of scope of this PR - there&apos;s also more around this package, if you wanted to mark/change these accordingly&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16578644" author="githubbot" created="Mon, 13 Aug 2018 17:19:09 +0000"  >&lt;p&gt;NicoK commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r209690309&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r209690309&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -52,6 +56,9 @@&lt;/p&gt;

&lt;p&gt; 	private Bootstrap bootstrap;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   out of scope of this PR - there&apos;s also even more around this package, if you wanted to mark/change these accordingly&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16578646" author="githubbot" created="Mon, 13 Aug 2018 17:20:02 +0000"  >&lt;p&gt;NicoK commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r209690587&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r209690587&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -175,7 +183,6 @@ ChannelFuture connect(final InetSocketAddress serverSocketAddress) {&lt;br/&gt;
 		bootstrap.handler(new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {&lt;br/&gt;
 			@Override&lt;br/&gt;
 			public void initChannel(SocketChannel channel) throws Exception {&lt;br/&gt;
-&lt;br/&gt;
 				// SSL handler should be added first in the pipeline&lt;br/&gt;
 				if (clientSSLContext != null) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   if SSL is disabled, for example&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16578653" author="githubbot" created="Mon, 13 Aug 2018 17:25:43 +0000"  >&lt;p&gt;NicoK commented on issue #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#issuecomment-412597634&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#issuecomment-412597634&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I pushed a rework of this PR which has a lighter footprint on the changes in SSLUtils by using a wrapper around `SSLContext` as @pnowojski suggested.&lt;/p&gt;

&lt;p&gt;   I kept all existing logic though, including the `@Nullable` fields (vs. `Optional`) for these reasons:&lt;br/&gt;
   1) there are already conflicts when applying this to `release-1.6` and I&apos;d like to keep the footprint small (some of the suggestions already make the diff bigger)&lt;br/&gt;
   2) there are several `null` checks which would need refactoring&lt;br/&gt;
   3) this seems to be out of scope of this PR, especially since no nullable field is added (any more)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582272" author="githubbot" created="Thu, 16 Aug 2018 09:38:57 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r210515882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r210515882&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -176,39 +176,43 @@ public static void setSSLVerifyHostname(Configuration sslConfig, SSLParameters s&lt;br/&gt;
 	public static SSLContext createSSLClientContext(Configuration sslConfig) throws Exception {&lt;/p&gt;

&lt;p&gt; 		Preconditions.checkNotNull(sslConfig);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLContext clientSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (getSSLEnabled(sslConfig)) {&lt;/li&gt;
	&lt;li&gt;LOG.debug(&quot;Creating client SSL context from configuration&quot;);&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;String trustStoreFilePath = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE);&lt;/li&gt;
	&lt;li&gt;String trustStorePassword = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD);&lt;/li&gt;
	&lt;li&gt;String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		if (!getSSLEnabled(sslConfig)) 
{
+			return null;
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Preconditions.checkNotNull(trustStoreFilePath, SecurityOptions.SSL_TRUSTSTORE.key() + &quot; was not configured.&quot;);&lt;/li&gt;
	&lt;li&gt;Preconditions.checkNotNull(trustStorePassword, SecurityOptions.SSL_TRUSTSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		LOG.debug(&quot;Creating client SSL context from configuration&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br/&gt;
+		String trustStoreFilePath = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE);&lt;br/&gt;
+		String trustStorePassword = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD);&lt;br/&gt;
+		String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		int sessionCacheSize = sslConfig.getInteger(SecurityOptions.SSL_SESSION_CACHE_SIZE);&lt;br/&gt;
+		int sessionTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_SESSION_TIMEOUT);&lt;br/&gt;
+		int handshakeTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_HANDSHAKE_TIMEOUT);&lt;br/&gt;
+		int closeNotifyFlushTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FileInputStream trustStoreFile = null;&lt;/li&gt;
	&lt;li&gt;try 
{
-				trustStoreFile = new FileInputStream(new File(trustStoreFilePath));
-				trustStore.load(trustStoreFile, trustStorePassword.toCharArray());
-			}
&lt;p&gt; finally {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (trustStoreFile != null) 
{
-					trustStoreFile.close();
-				}&lt;/li&gt;
	&lt;li&gt;}&lt;br/&gt;
+		Preconditions.checkNotNull(trustStoreFilePath, SecurityOptions.SSL_TRUSTSTORE.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		Preconditions.checkNotNull(trustStorePassword, SecurityOptions.SSL_TRUSTSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(&lt;/li&gt;
	&lt;li&gt;TrustManagerFactory.getDefaultAlgorithm());&lt;/li&gt;
	&lt;li&gt;trustManagerFactory.init(trustStore);&lt;br/&gt;
+		KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;clientSSLContext = SSLContext.getInstance(sslProtocolVersion);&lt;/li&gt;
	&lt;li&gt;clientSSLContext.init(null, trustManagerFactory.getTrustManagers(), null);&lt;br/&gt;
+		try (FileInputStream trustStoreFile = new FileInputStream(new File(trustStoreFilePath))) 
{
+			trustStore.load(trustStoreFile, trustStorePassword.toCharArray());
 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return clientSSLContext;&lt;br/&gt;
+		TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(&lt;br/&gt;
+			TrustManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
+		trustManagerFactory.init(trustStore);&lt;br/&gt;
+&lt;br/&gt;
+		javax.net.ssl.SSLContext clientSSLContext = javax.net.ssl.SSLContext.getInstance(sslProtocolVersion);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   `ctrl+c`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582273" author="githubbot" created="Thu, 16 Aug 2018 09:38:57 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r210531098&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r210531098&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -65,6 +68,60 @@ public void testValidSslConnection() throws Exception &lt;/p&gt;
{
 
 		Channel ch = NettyTestUtil.connect(serverAndClient);
 
+		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);
+		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getHandshakeTimeoutMillis() &amp;gt;= 0);
+		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getCloseNotifyTimeoutMillis() &amp;gt;= 0);
+
+		// should be able to send text data
+		ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());
+		assertTrue(ch.writeAndFlush(&quot;test&quot;).await().isSuccess());
+
+		NettyTestUtil.shutdown(serverAndClient);
+	}
&lt;p&gt;+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Verify valid (advanced) ssl configuration and connection.&lt;br/&gt;
+	 */&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testValidSslConnectionAdvanced() throws Exception {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Yes, you are right regarding `handshake-timeout` and `close-notify-flush-timeout`, but as I wrote previously, I do not see how `SESSION_CACHE_SIZE` and `SESSION_TIMEOUT` are tested at all. And regardless of that, it still would be better to add a stress test/benchmark for that. Depends how important this feature is... However if it&apos;s not important one could argue why even bother supporting this? &lt;/p&gt;

&lt;p&gt;   On a side note. Couldn&apos;t we provide some generic way to configure netty? Like passing any config option prefixed `taskmanager.netty.client` to taskmanager&apos;s netty client, without manually specifying and handling them by us?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582274" author="githubbot" created="Thu, 16 Aug 2018 09:38:57 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r210514431&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r210514431&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -190,7 +194,14 @@ public void initChannel(SocketChannel channel) throws Exception &lt;/p&gt;
{
 						sslEngine.setSSLParameters(newSSLParameters);
 					}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;channel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));&lt;br/&gt;
+					SslHandler sslHandler = new SslHandler(sslEngine);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   `ctrl+c`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582275" author="githubbot" created="Thu, 16 Aug 2018 09:38:57 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r210515985&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r210515985&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -225,38 +229,65 @@ public static SSLContext createSSLClientContext(Configuration sslConfig) throws&lt;br/&gt;
 	public static SSLContext createSSLServerContext(Configuration sslConfig) throws Exception {&lt;/p&gt;

&lt;p&gt; 		Preconditions.checkNotNull(sslConfig);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLContext serverSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (getSSLEnabled(sslConfig)) {&lt;/li&gt;
	&lt;li&gt;LOG.debug(&quot;Creating server SSL context from configuration&quot;);&lt;br/&gt;
+		if (!getSSLEnabled(sslConfig)) 
{
+			return null;
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String keystoreFilePath = sslConfig.getString(SecurityOptions.SSL_KEYSTORE);&lt;br/&gt;
+		LOG.debug(&quot;Creating server SSL context from configuration&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String keystorePassword = sslConfig.getString(SecurityOptions.SSL_KEYSTORE_PASSWORD);&lt;br/&gt;
+		String keystoreFilePath = sslConfig.getString(SecurityOptions.SSL_KEYSTORE);&lt;br/&gt;
+		String keystorePassword = sslConfig.getString(SecurityOptions.SSL_KEYSTORE_PASSWORD);&lt;br/&gt;
+		String certPassword = sslConfig.getString(SecurityOptions.SSL_KEY_PASSWORD);&lt;br/&gt;
+		String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		int sessionCacheSize = sslConfig.getInteger(SecurityOptions.SSL_SESSION_CACHE_SIZE);&lt;br/&gt;
+		int sessionTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_SESSION_TIMEOUT);&lt;br/&gt;
+		int handshakeTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_HANDSHAKE_TIMEOUT);&lt;br/&gt;
+		int closeNotifyFlushTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String certPassword = sslConfig.getString(SecurityOptions.SSL_KEY_PASSWORD);&lt;br/&gt;
+		Preconditions.checkNotNull(keystoreFilePath, SecurityOptions.SSL_KEYSTORE.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		Preconditions.checkNotNull(keystorePassword, SecurityOptions.SSL_KEYSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		Preconditions.checkNotNull(certPassword, SecurityOptions.SSL_KEY_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br/&gt;
+		try (FileInputStream keyStoreFile = new FileInputStream(new File(keystoreFilePath))) 
{
+			ks.load(keyStoreFile, keystorePassword.toCharArray());
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Preconditions.checkNotNull(keystoreFilePath, SecurityOptions.SSL_KEYSTORE.key() + &quot; was not configured.&quot;);&lt;/li&gt;
	&lt;li&gt;Preconditions.checkNotNull(keystorePassword, SecurityOptions.SSL_KEYSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/li&gt;
	&lt;li&gt;Preconditions.checkNotNull(certPassword, SecurityOptions.SSL_KEY_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		// Set up key manager factory to use the server key store&lt;br/&gt;
+		KeyManagerFactory kmf = KeyManagerFactory.getInstance(&lt;br/&gt;
+			KeyManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
+		kmf.init(ks, certPassword.toCharArray());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());&lt;/li&gt;
	&lt;li&gt;try (FileInputStream keyStoreFile = new FileInputStream(new File(keystoreFilePath))) 
{
-				ks.load(keyStoreFile, keystorePassword.toCharArray());
-			}
&lt;p&gt;+		// Initialize the SSLContext&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   `ctrl+v` as well?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582276" author="githubbot" created="Thu, 16 Aug 2018 09:38:57 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r210523907&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r210523907&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -225,38 +229,65 @@ public static SSLContext createSSLClientContext(Configuration sslConfig) throws&lt;br/&gt;
 	public static SSLContext createSSLServerContext(Configuration sslConfig) throws Exception {&lt;/p&gt;

&lt;p&gt; 		Preconditions.checkNotNull(sslConfig);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLContext serverSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (getSSLEnabled(sslConfig)) {&lt;/li&gt;
	&lt;li&gt;LOG.debug(&quot;Creating server SSL context from configuration&quot;);&lt;br/&gt;
+		if (!getSSLEnabled(sslConfig)) 
{
+			return null;
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String keystoreFilePath = sslConfig.getString(SecurityOptions.SSL_KEYSTORE);&lt;br/&gt;
+		LOG.debug(&quot;Creating server SSL context from configuration&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String keystorePassword = sslConfig.getString(SecurityOptions.SSL_KEYSTORE_PASSWORD);&lt;br/&gt;
+		String keystoreFilePath = sslConfig.getString(SecurityOptions.SSL_KEYSTORE);&lt;br/&gt;
+		String keystorePassword = sslConfig.getString(SecurityOptions.SSL_KEYSTORE_PASSWORD);&lt;br/&gt;
+		String certPassword = sslConfig.getString(SecurityOptions.SSL_KEY_PASSWORD);&lt;br/&gt;
+		String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		int sessionCacheSize = sslConfig.getInteger(SecurityOptions.SSL_SESSION_CACHE_SIZE);&lt;br/&gt;
+		int sessionTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_SESSION_TIMEOUT);&lt;br/&gt;
+		int handshakeTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_HANDSHAKE_TIMEOUT);&lt;br/&gt;
+		int closeNotifyFlushTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String certPassword = sslConfig.getString(SecurityOptions.SSL_KEY_PASSWORD);&lt;br/&gt;
+		Preconditions.checkNotNull(keystoreFilePath, SecurityOptions.SSL_KEYSTORE.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		Preconditions.checkNotNull(keystorePassword, SecurityOptions.SSL_KEYSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		Preconditions.checkNotNull(certPassword, SecurityOptions.SSL_KEY_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br/&gt;
+		try (FileInputStream keyStoreFile = new FileInputStream(new File(keystoreFilePath))) 
{
+			ks.load(keyStoreFile, keystorePassword.toCharArray());
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Preconditions.checkNotNull(keystoreFilePath, SecurityOptions.SSL_KEYSTORE.key() + &quot; was not configured.&quot;);&lt;/li&gt;
	&lt;li&gt;Preconditions.checkNotNull(keystorePassword, SecurityOptions.SSL_KEYSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/li&gt;
	&lt;li&gt;Preconditions.checkNotNull(certPassword, SecurityOptions.SSL_KEY_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		// Set up key manager factory to use the server key store&lt;br/&gt;
+		KeyManagerFactory kmf = KeyManagerFactory.getInstance(&lt;br/&gt;
+			KeyManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
+		kmf.init(ks, certPassword.toCharArray());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());&lt;/li&gt;
	&lt;li&gt;try (FileInputStream keyStoreFile = new FileInputStream(new File(keystoreFilePath))) 
{
-				ks.load(keyStoreFile, keystorePassword.toCharArray());
-			}
&lt;p&gt;+		// Initialize the SSLContext&lt;br/&gt;
+		javax.net.ssl.SSLContext serverSSLContext = javax.net.ssl.SSLContext.getInstance(sslProtocolVersion);&lt;br/&gt;
+		serverSSLContext.init(kmf.getKeyManagers(), null, null);&lt;br/&gt;
+		if (sessionCacheSize &amp;gt;= 0) &lt;/p&gt;
{
+			serverSSLContext.getServerSessionContext().setSessionCacheSize(sessionCacheSize);
+		}
&lt;p&gt;+		if (sessionTimeoutMs &amp;gt;= 0) &lt;/p&gt;
{
+			serverSSLContext.getServerSessionContext().setSessionTimeout(sessionTimeoutMs / 1000);
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Set up key manager factory to use the server key store&lt;/li&gt;
	&lt;li&gt;KeyManagerFactory kmf = KeyManagerFactory.getInstance(&lt;/li&gt;
	&lt;li&gt;KeyManagerFactory.getDefaultAlgorithm());&lt;/li&gt;
	&lt;li&gt;kmf.init(ks, certPassword.toCharArray());&lt;br/&gt;
+		return new SSLContext(serverSSLContext, handshakeTimeoutMs, closeNotifyFlushTimeoutMs);&lt;br/&gt;
+	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Initialize the SSLContext&lt;/li&gt;
	&lt;li&gt;serverSSLContext = SSLContext.getInstance(sslProtocolVersion);&lt;/li&gt;
	&lt;li&gt;serverSSLContext.init(kmf.getKeyManagers(), null, null);&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Wrapper around javax.net.ssl.SSLContext, adding SSL handshake and close notify timeouts&lt;br/&gt;
+	 * which cannot be set on the SSL context directly.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static class SSLContext {&lt;br/&gt;
+		public final javax.net.ssl.SSLContext sslContext;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   maybe make private and provide getters?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582277" author="githubbot" created="Thu, 16 Aug 2018 09:38:57 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r210529443&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r210529443&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -65,6 +68,60 @@ public void testValidSslConnection() throws Exception &lt;/p&gt;
{
 
 		Channel ch = NettyTestUtil.connect(serverAndClient);
 
+		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);
+		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getHandshakeTimeoutMillis() &amp;gt;= 0);
+		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getCloseNotifyTimeoutMillis() &amp;gt;= 0);
+
+		// should be able to send text data
+		ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());
+		assertTrue(ch.writeAndFlush(&quot;test&quot;).await().isSuccess());
+
+		NettyTestUtil.shutdown(serverAndClient);
+	}
&lt;p&gt;+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Verify valid (advanced) ssl configuration and connection.&lt;br/&gt;
+	 */&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testValidSslConnectionAdvanced() throws Exception {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This hasn&apos;t been addressed. Those tests differ only with expected values and passed `NettyConfig`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16582278" author="githubbot" created="Thu, 16 Aug 2018 09:38:57 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r210515177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r210515177&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -152,10 +154,17 @@ void init(final NettyProtocol protocol, NettyBufferPool nettyBufferPool) throws&lt;br/&gt;
 			@Override&lt;br/&gt;
 			public void initChannel(SocketChannel channel) throws Exception {&lt;br/&gt;
 				if (serverSSLContext != null) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLEngine sslEngine = serverSSLContext.createSSLEngine();&lt;br/&gt;
+					SSLEngine sslEngine = serverSSLContext.sslContext.createSSLEngine();&lt;br/&gt;
 					config.setSSLVerAndCipherSuites(sslEngine);&lt;br/&gt;
 					sslEngine.setUseClientMode(false);&lt;/li&gt;
	&lt;li&gt;channel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));&lt;br/&gt;
+					SslHandler sslHandler = new SslHandler(sslEngine);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   `ctrl+v` - please deduplicate this somehow and please do this in this PR, since this is the place where you introduce/make duplication worse.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16585836" author="githubbot" created="Mon, 20 Aug 2018 11:59:04 +0000"  >&lt;p&gt;NicoK commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r211235957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r211235957&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -65,6 +68,60 @@ public void testValidSslConnection() throws Exception &lt;/p&gt;
{
 
 		Channel ch = NettyTestUtil.connect(serverAndClient);
 
+		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);
+		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getHandshakeTimeoutMillis() &amp;gt;= 0);
+		assertTrue(&quot;default value should not be propagated&quot;, sslHandler.getCloseNotifyTimeoutMillis() &amp;gt;= 0);
+
+		// should be able to send text data
+		ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());
+		assertTrue(ch.writeAndFlush(&quot;test&quot;).await().isSuccess());
+
+		NettyTestUtil.shutdown(serverAndClient);
+	}
&lt;p&gt;+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Verify valid (advanced) ssl configuration and connection.&lt;br/&gt;
+	 */&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testValidSslConnectionAdvanced() throws Exception {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Actually, I found a way to verify that these two properties are also set - will update the test.&lt;/p&gt;

&lt;p&gt;   Do you think, a benchmark should be included in this PR or rather separately (it is not really related to these changes)? Also: only in `master`?&lt;/p&gt;

&lt;p&gt;   About the `taskmanager.netty.client` prefix: that sounds like a nice idea and could probably be extended to similar use cases with component-specific configurations. If you think, it&apos;s worth pursuing, can you open a JIRA ticket for this improvement?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16585873" author="githubbot" created="Mon, 20 Aug 2018 12:47:11 +0000"  >&lt;p&gt;NicoK commented on issue #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#issuecomment-414304457&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#issuecomment-414304457&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I updated the code but would do the de-duplication in `master` because of the (additional) merge conflicts I&apos;ll have there&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16586024" author="githubbot" created="Mon, 20 Aug 2018 14:40:31 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355#discussion_r211285792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355#discussion_r211285792&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -98,21 +86,48 @@ public void testValidSslConnectionAdvanced() throws Exception {&lt;br/&gt;
 		Channel ch = NettyTestUtil.connect(serverAndClient);&lt;/p&gt;

&lt;p&gt; 		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;assertEquals(sslHandler.getHandshakeTimeoutMillis(), handshakeTimeout);&lt;/li&gt;
	&lt;li&gt;assertEquals(sslHandler.getCloseNotifyTimeoutMillis(), closeNotifyFlushTimeout);&lt;br/&gt;
+		int handshakeTimeout = sslConfig.getInteger(SSL_HANDSHAKE_TIMEOUT);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   ```&lt;br/&gt;
   assertSslConfig(sslConfig.getInteger(SSL_HANDSHAKE_TIMEOUT), sslHandler.getHandshakeTimeoutMillis())&lt;br/&gt;
   ```&lt;br/&gt;
   and do:&lt;br/&gt;
   ```&lt;br/&gt;
   assertSslConfig(expected, actual) {&lt;br/&gt;
     if (expected != -1) &lt;/p&gt;
{
       assertEquals(expected, actual)
     }
&lt;p&gt;     else &lt;/p&gt;
{
       assertTrue(...);
     }
&lt;p&gt;   }&lt;br/&gt;
   ```&lt;br/&gt;
   in 4 places here? Maybe renaming it to `assertEqualsOrMinusAsDefaultValue`?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16586567" author="githubbot" created="Mon, 20 Aug 2018 21:53:15 +0000"  >&lt;p&gt;NicoK closed pull request #6355: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6355&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/docs/_includes/generated/security_configuration.html b/docs/_includes/generated/security_configuration.html&lt;br/&gt;
index cd682ecaf0f..357629473cd 100644&lt;br/&gt;
&amp;#8212; a/docs/_includes/generated/security_configuration.html&lt;br/&gt;
+++ b/docs/_includes/generated/security_configuration.html&lt;br/&gt;
@@ -12,11 +12,21 @@&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;&quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;The comma separated list of standard SSL algorithms to be supported. Read more &amp;#60;a href=&quot;http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#ciphersuites&quot;&amp;#62;here&amp;#60;/a&amp;#62;.&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.close-notify-flush-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a channel. If the `close_notify` was not flushed in the given timeout the channel will be closed forcibly. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.enabled&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;false&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;Turns on SSL for internal network communication. This can be optionally overridden by flags defined in different transport modules.&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.handshake-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) during SSL handshake. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.key-password&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;(none)&amp;lt;/td&amp;gt;&lt;br/&gt;
@@ -37,6 +47,16 @@&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;&quot;TLSv1.2&quot;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;The SSL protocol version to be supported for the ssl transport. Note that it doesn&#8217;t support comma separated list.&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.session-cache-size&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The size of the cache used for storing SSL session objects. According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set this to an appropriate number to not run into a bug with stalling IO threads during garbage collection. (-1 = use system default).&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.session-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.truststore&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;(none)&amp;lt;/td&amp;gt;&lt;br/&gt;
diff --git a/docs/ops/security-ssl.md b/docs/ops/security-ssl.md&lt;br/&gt;
index c2ba7df8849..a805238ae08 100644&lt;br/&gt;
&amp;#8212; a/docs/ops/security-ssl.md&lt;br/&gt;
+++ b/docs/ops/security-ssl.md&lt;br/&gt;
@@ -33,6 +33,10 @@ SSL can be enabled for all network communication between Flink components. SSL k&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;*&lt;b&gt;akka.ssl.enabled&lt;/b&gt;*: SSL flag for akka based control connection between the Flink client, jobmanager and taskmanager&lt;/li&gt;
	&lt;li&gt;*&lt;b&gt;jobmanager.web.ssl.enabled&lt;/b&gt;*: Flag to enable https access to the jobmanager&apos;s web frontend&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+### Complete List of SSL Options&lt;br/&gt;
+&lt;br/&gt;
+&lt;/p&gt;
{% include generated/security_configuration.html %}
&lt;p&gt;+&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Deploying Keystores and Truststores&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt; You need to have a Java Keystore generated and copied to each node in the Flink cluster. The common name or subject alternative names in the certificate should match the node&apos;s hostname and IP address. Keystores and truststores can be generated using the &lt;span class=&quot;error&quot;&gt;&amp;#91;keytool utility&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/8/docs/technotes/tools/unix/keytool.html&lt;/a&gt;). All Flink components should have read access to the keystore and truststore files.&lt;br/&gt;
diff --git a/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java b/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
index 0f25c6caf95..60a97643a4e 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
+++ b/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
@@ -160,4 +160,41 @@&lt;br/&gt;
 		key(&quot;security.ssl.verify-hostname&quot;)&lt;br/&gt;
 			.defaultValue(true)&lt;br/&gt;
 			.withDescription(&quot;Flag to enable peer&#8217;s hostname verification during ssl handshake.&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session cache size.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_CACHE_SIZE =&lt;br/&gt;
+		key(&quot;security.ssl.session-cache-size&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The size of the cache used for storing SSL session objects. &quot;&lt;br/&gt;
+				+ &quot;According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set &quot;&lt;br/&gt;
+				+ &quot;this to an appropriate number to not run into a bug with stalling IO threads &quot;&lt;br/&gt;
+				+ &quot;during garbage collection. (-1 = use system default).&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_SESSION_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.session-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout during handshakes.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_HANDSHAKE_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.handshake-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) during SSL handshake. (-1 = use system default)&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout after flushing the &amp;lt;tt&amp;gt;close_notify&amp;lt;/tt&amp;gt; message.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.close-notify-flush-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a &quot; +&lt;br/&gt;
+				&quot;channel. If the `close_notify` was not flushed in the given timeout the channel will be closed &quot; +&lt;br/&gt;
+				&quot;forcibly. (-1 = use system default)&quot;);&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java b/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
index 57f4718816c..30c4edf0155 100644&lt;br/&gt;
&amp;#8212; a/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
@@ -58,7 +58,7 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;-import javax.net.ssl.SSLContext;&lt;br/&gt;
+import javax.annotation.Nullable;&lt;br/&gt;
 import javax.net.ssl.SSLEngine;&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
@@ -104,7 +104,8 @@&lt;/p&gt;

&lt;p&gt; 	private final Map&amp;lt;Path, URL&amp;gt; paths = new HashMap&amp;lt;&amp;gt;();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final SSLContext serverSSLContext;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	private final SSLUtils.SSLContext serverSSLContext;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	public MesosArtifactServer(String prefix, String serverHostname, int configuredPort, Configuration config)&lt;br/&gt;
 		throws Exception {&lt;br/&gt;
@@ -139,7 +140,7 @@ protected void initChannel(SocketChannel ch) {&lt;/p&gt;

&lt;p&gt; 				// SSL should be the first handler in the pipeline&lt;br/&gt;
 				if (serverSSLContext != null) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLEngine sslEngine = serverSSLContext.createSSLEngine();&lt;br/&gt;
+					SSLEngine sslEngine = serverSSLContext.getSslContext().createSSLEngine();&lt;br/&gt;
 					SSLUtils.setSSLVerAndCipherSuites(sslEngine, sslConfig);&lt;br/&gt;
 					sslEngine.setUseClientMode(false);&lt;br/&gt;
 					ch.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));&lt;br/&gt;
diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
index f27ae0067d7..4323ad01168 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
@@ -92,7 +92,7 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-import javax.net.ssl.SSLContext;&lt;br/&gt;
+import javax.annotation.Nullable;&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
@@ -130,7 +130,8 @@&lt;br/&gt;
 	/** Service which retrieves the currently leading JobManager and opens a JobManagerGateway. */&lt;br/&gt;
 	private final LeaderGatewayRetriever&amp;lt;JobManagerGateway&amp;gt; retriever;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final SSLContext serverSSLContext;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	private final SSLUtils.SSLContext serverSSLContext;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private final CompletableFuture&amp;lt;String&amp;gt; localRestAddress = new CompletableFuture&amp;lt;&amp;gt;();&lt;/p&gt;

&lt;p&gt;diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
index 108f5c4595a..0484afdcc34 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
@@ -43,7 +43,7 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;-import javax.net.ssl.SSLContext;&lt;br/&gt;
+import javax.annotation.Nullable;&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
 import java.io.FileWriter;&lt;br/&gt;
@@ -90,7 +90,8 @@&lt;/p&gt;

&lt;p&gt; 	private final HistoryServerArchiveFetcher archiveFetcher;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final SSLContext serverSSLContext;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	private final SSLUtils.SSLContext serverSSLContext;&lt;br/&gt;
 	private WebFrontendBootstrap netty;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private final Object startupShutdownLock = new Object();&lt;br/&gt;
diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
index 740beaee1cb..c3148b73878 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
@@ -40,7 +40,7 @@&lt;/p&gt;

&lt;p&gt; import org.slf4j.Logger;&lt;/p&gt;

&lt;p&gt;-import javax.net.ssl.SSLContext;&lt;br/&gt;
+import javax.annotation.Nullable;&lt;br/&gt;
 import javax.net.ssl.SSLEngine;&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
@@ -55,7 +55,8 @@&lt;br/&gt;
 	private final Router router;&lt;br/&gt;
 	private final Logger log;&lt;br/&gt;
 	private final File uploadDir;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final SSLContext serverSSLContext;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	private final SSLUtils.SSLContext serverSSLContext;&lt;br/&gt;
 	private final ServerBootstrap bootstrap;&lt;br/&gt;
 	private final Channel serverChannel;&lt;br/&gt;
 	private final String restAddress;&lt;br/&gt;
@@ -64,7 +65,7 @@ public WebFrontendBootstrap(&lt;br/&gt;
 			Router router,&lt;br/&gt;
 			Logger log,&lt;br/&gt;
 			File directory,&lt;/li&gt;
	&lt;li&gt;SSLContext sslContext,&lt;br/&gt;
+			@Nullable SSLUtils.SSLContext sslContext,&lt;br/&gt;
 			String configuredAddress,&lt;br/&gt;
 			int configuredPort,&lt;br/&gt;
 			final Configuration config) throws InterruptedException, UnknownHostException {&lt;br/&gt;
@@ -81,7 +82,7 @@ protected void initChannel(SocketChannel ch) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				// SSL should be the first handler in the pipeline&lt;br/&gt;
 				if (serverSSLContext != null) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLEngine sslEngine = serverSSLContext.createSSLEngine();&lt;br/&gt;
+					SSLEngine sslEngine = serverSSLContext.getSslContext().createSSLEngine();&lt;br/&gt;
 					SSLUtils.setSSLVerAndCipherSuites(sslEngine, config);&lt;br/&gt;
 					sslEngine.setUseClientMode(false);&lt;br/&gt;
 					ch.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobClient.java b/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobClient.java&lt;br/&gt;
index 8e6b32811c2..4bf71779058 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobClient.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobClient.java&lt;br/&gt;
@@ -31,7 +31,6 @@&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import javax.annotation.Nullable;&lt;br/&gt;
-import javax.net.ssl.SSLContext;&lt;br/&gt;
 import javax.net.ssl.SSLParameters;&lt;br/&gt;
 import javax.net.ssl.SSLSocket;&lt;/p&gt;

&lt;p&gt;@@ -91,7 +90,7 @@ public BlobClient(InetSocketAddress serverAddress, Configuration clientConfig) t&lt;/p&gt;

&lt;p&gt; 		try {&lt;br/&gt;
 			// Check if ssl is enabled&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLContext clientSSLContext = null;&lt;br/&gt;
+			SSLUtils.SSLContext clientSSLContext = null;&lt;br/&gt;
 			if (clientConfig != null &amp;amp;&amp;amp;&lt;br/&gt;
 				clientConfig.getBoolean(BlobServerOptions.SSL_ENABLED)) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -102,7 +101,7 @@ public BlobClient(InetSocketAddress serverAddress, Configuration clientConfig) t&lt;/p&gt;

&lt;p&gt; 				LOG.info(&quot;Using ssl connection to the blob server&quot;);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLSocket sslSocket = (SSLSocket) clientSSLContext.getSocketFactory().createSocket(&lt;br/&gt;
+				SSLSocket sslSocket = (SSLSocket) clientSSLContext.getSslContext().getSocketFactory().createSocket(&lt;br/&gt;
 					serverAddress.getAddress(),&lt;br/&gt;
 					serverAddress.getPort());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobServer.java b/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobServer.java&lt;br/&gt;
index dd0155cbbdd..1a1b0da63dc 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobServer.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/blob/BlobServer.java&lt;br/&gt;
@@ -33,7 +33,6 @@&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt; import javax.annotation.Nullable;&lt;br/&gt;
-import javax.net.ssl.SSLContext;&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
 import java.io.FileNotFoundException;&lt;br/&gt;
@@ -79,7 +78,7 @@&lt;br/&gt;
 	private final ServerSocket serverSocket;&lt;/p&gt;

&lt;p&gt; 	/** The SSL server context if ssl is enabled for the connections. */&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final SSLContext serverSSLContext;&lt;br/&gt;
+	private final SSLUtils.SSLContext serverSSLContext;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	/** Blob Server configuration. */&lt;br/&gt;
 	private final Configuration blobServiceConfiguration;&lt;br/&gt;
@@ -196,7 +195,7 @@ public ServerSocket createSocket(int port) throws IOException &lt;/p&gt;
{
 					return new ServerSocket(port, finalBacklog);
 				}
&lt;p&gt; else &lt;/p&gt;
{
 					LOG.info(&quot;Enabling ssl for the blob server&quot;);
-					return serverSSLContext.getServerSocketFactory().createServerSocket(port, finalBacklog);
+					return serverSSLContext.getSslContext().getServerSocketFactory().createServerSocket(port, finalBacklog);
 				}
&lt;p&gt; 			}&lt;br/&gt;
 		});&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
index 5fb083d33ad..44561b0638f 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
@@ -18,6 +18,8 @@&lt;/p&gt;

&lt;p&gt; package org.apache.flink.runtime.io.network.netty;&lt;/p&gt;

&lt;p&gt;+import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
+&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.bootstrap.Bootstrap;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelException;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelFuture;&lt;br/&gt;
@@ -34,9 +36,10 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;-import javax.net.ssl.SSLContext;&lt;br/&gt;
+import javax.annotation.Nullable;&lt;br/&gt;
 import javax.net.ssl.SSLEngine;&lt;br/&gt;
 import javax.net.ssl.SSLParameters;&lt;br/&gt;
+&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
 import java.net.InetSocketAddress;&lt;/p&gt;

&lt;p&gt;@@ -52,7 +55,8 @@&lt;/p&gt;

&lt;p&gt; 	private Bootstrap bootstrap;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private SSLContext clientSSLContext = null;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	private SSLUtils.SSLContext clientSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	NettyClient(NettyConfig config) {&lt;br/&gt;
 		this.config = config;&lt;br/&gt;
@@ -178,7 +182,7 @@ public void initChannel(SocketChannel channel) throws Exception {&lt;/p&gt;

&lt;p&gt; 				// SSL handler should be added first in the pipeline&lt;br/&gt;
 				if (clientSSLContext != null) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLEngine sslEngine = clientSSLContext.createSSLEngine(&lt;br/&gt;
+					SSLEngine sslEngine = clientSSLContext.getSslContext().createSSLEngine(&lt;br/&gt;
 						serverSocketAddress.getAddress().getCanonicalHostName(),&lt;br/&gt;
 						serverSocketAddress.getPort());&lt;br/&gt;
 					sslEngine.setUseClientMode(true);&lt;br/&gt;
@@ -190,7 +194,14 @@ public void initChannel(SocketChannel channel) throws Exception 
{
 						sslEngine.setSSLParameters(newSSLParameters);
 					}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;channel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));&lt;br/&gt;
+					SslHandler sslHandler = new SslHandler(sslEngine);&lt;br/&gt;
+					if (clientSSLContext.getHandshakeTimeoutMs() &amp;gt;= 0) 
{
+						sslHandler.setHandshakeTimeoutMillis(clientSSLContext.getHandshakeTimeoutMs());
+					}
&lt;p&gt;+					if (clientSSLContext.getCloseNotifyFlushTimeoutMs() &amp;gt;= 0) &lt;/p&gt;
{
+						sslHandler.setCloseNotifyTimeoutMillis(clientSSLContext.getCloseNotifyFlushTimeoutMs());
+					}
&lt;p&gt;+					channel.pipeline().addLast(&quot;ssl&quot;, sslHandler);&lt;br/&gt;
 				}&lt;br/&gt;
 				channel.pipeline().addLast(protocol.getClientChannelHandlers());&lt;br/&gt;
 			}&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
index 18527c46a53..9b32ebbcd95 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
@@ -23,12 +23,14 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.TaskManagerOptions;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
+&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-import javax.net.ssl.SSLContext;&lt;br/&gt;
+import javax.annotation.Nullable;&lt;br/&gt;
 import javax.net.ssl.SSLEngine;&lt;br/&gt;
 import javax.net.ssl.SSLParameters;&lt;br/&gt;
+&lt;br/&gt;
 import java.net.InetAddress;&lt;/p&gt;

&lt;p&gt; import static org.apache.flink.util.Preconditions.checkArgument;&lt;br/&gt;
@@ -189,26 +191,13 @@ public TransportType getTransportType() {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLContext createClientSSLContext() throws Exception {&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;// Create SSL Context from config&lt;/li&gt;
	&lt;li&gt;SSLContext clientSSLContext = null;&lt;/li&gt;
	&lt;li&gt;if (getSSLEnabled()) 
{
-			clientSSLContext = SSLUtils.createSSLClientContext(config);
-		}
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;return clientSSLContext;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	public SSLUtils.SSLContext createClientSSLContext() throws Exception 
{
+		return SSLUtils.createSSLClientContext(config);
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLContext createServerSSLContext() throws Exception {&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;// Create SSL Context from config&lt;/li&gt;
	&lt;li&gt;SSLContext serverSSLContext = null;&lt;/li&gt;
	&lt;li&gt;if (getSSLEnabled()) 
{
-			serverSSLContext = SSLUtils.createSSLServerContext(config);
-		}
&lt;p&gt;-&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;return serverSSLContext;&lt;br/&gt;
+	public SSLUtils.SSLContext createServerSSLContext() throws Exception 
{
+		return SSLUtils.createSSLServerContext(config);
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	public boolean getSSLEnabled() {&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java&lt;br/&gt;
index c6d09d05499..f919ded9e3c 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;/p&gt;

&lt;p&gt; package org.apache.flink.runtime.io.network.netty;&lt;/p&gt;

&lt;p&gt;+import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.runtime.util.FatalExitExceptionHandler;&lt;/p&gt;

&lt;p&gt; import org.apache.flink.shaded.guava18.com.google.common.util.concurrent.ThreadFactoryBuilder;&lt;br/&gt;
@@ -36,7 +37,7 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;-import javax.net.ssl.SSLContext;&lt;br/&gt;
+import javax.annotation.Nullable;&lt;br/&gt;
 import javax.net.ssl.SSLEngine;&lt;/p&gt;

&lt;p&gt; import java.io.IOException;&lt;br/&gt;
@@ -61,7 +62,8 @@&lt;/p&gt;

&lt;p&gt; 	private ChannelFuture bindFuture;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private SSLContext serverSSLContext = null;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	private SSLUtils.SSLContext serverSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private InetSocketAddress localAddress;&lt;/p&gt;

&lt;p&gt;@@ -152,10 +154,17 @@ void init(final NettyProtocol protocol, NettyBufferPool nettyBufferPool) throws&lt;br/&gt;
 			@Override&lt;br/&gt;
 			public void initChannel(SocketChannel channel) throws Exception {&lt;br/&gt;
 				if (serverSSLContext != null) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLEngine sslEngine = serverSSLContext.createSSLEngine();&lt;br/&gt;
+					SSLEngine sslEngine = serverSSLContext.getSslContext().createSSLEngine();&lt;br/&gt;
 					config.setSSLVerAndCipherSuites(sslEngine);&lt;br/&gt;
 					sslEngine.setUseClientMode(false);&lt;/li&gt;
	&lt;li&gt;channel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));&lt;br/&gt;
+					SslHandler sslHandler = new SslHandler(sslEngine);&lt;br/&gt;
+					if (serverSSLContext.getHandshakeTimeoutMs() &amp;gt;= 0) 
{
+						sslHandler.setHandshakeTimeoutMillis(serverSSLContext.getHandshakeTimeoutMs());
+					}
&lt;p&gt;+					if (serverSSLContext.getCloseNotifyFlushTimeoutMs() &amp;gt;= 0) &lt;/p&gt;
{
+						sslHandler.setCloseNotifyTimeoutMillis(serverSSLContext.getCloseNotifyFlushTimeoutMs());
+					}
&lt;p&gt;+					channel.pipeline().addLast(&quot;ssl&quot;, sslHandler);&lt;br/&gt;
 				}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				channel.pipeline().addLast(protocol.getServerChannelHandlers());&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java b/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
index b574d30484f..69da666ab1d 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
@@ -113,7 +113,7 @@ private static SSLEngineFactory createSSLEngineFactory(&lt;br/&gt;
 		checkState(sslContext != null, &quot;%s it not enabled&quot;, SecurityOptions.SSL_ENABLED.key());&lt;/p&gt;

&lt;p&gt; 		return new SSLEngineFactory(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sslContext,&lt;br/&gt;
+			sslContext.getSslContext(),&lt;br/&gt;
 			getEnabledProtocols(config),&lt;br/&gt;
 			getEnabledCipherSuites(config),&lt;br/&gt;
 			clientMode);&lt;br/&gt;
@@ -176,39 +176,43 @@ public static void setSSLVerifyHostname(Configuration sslConfig, SSLParameters s&lt;br/&gt;
 	public static SSLContext createSSLClientContext(Configuration sslConfig) throws Exception {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		Preconditions.checkNotNull(sslConfig);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLContext clientSSLContext = null;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (getSSLEnabled(sslConfig)) {&lt;/li&gt;
	&lt;li&gt;LOG.debug(&quot;Creating client SSL context from configuration&quot;);&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;String trustStoreFilePath = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE);&lt;/li&gt;
	&lt;li&gt;String trustStorePassword = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD);&lt;/li&gt;
	&lt;li&gt;String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		if (!getSSLEnabled(sslConfig)) 
{
+			return null;
+		}&lt;br/&gt;
 &lt;br/&gt;
-			Preconditions.checkNotNull(trustStoreFilePath, SecurityOptions.SSL_TRUSTSTORE.key() + &quot; was not configured.&quot;);&lt;br/&gt;
-			Preconditions.checkNotNull(trustStorePassword, SecurityOptions.SSL_TRUSTSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		LOG.debug(&quot;Creating client SSL context from configuration&quot;);&lt;br/&gt;
 &lt;br/&gt;
-			KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br/&gt;
+		String trustStoreFilePath = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE);&lt;br/&gt;
+		String trustStorePassword = sslConfig.getString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD);&lt;br/&gt;
+		String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		int sessionCacheSize = sslConfig.getInteger(SecurityOptions.SSL_SESSION_CACHE_SIZE);&lt;br/&gt;
+		int sessionTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_SESSION_TIMEOUT);&lt;br/&gt;
+		int handshakeTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_HANDSHAKE_TIMEOUT);&lt;br/&gt;
+		int closeNotifyFlushTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT);&lt;br/&gt;
 &lt;br/&gt;
-			FileInputStream trustStoreFile = null;&lt;br/&gt;
-			try {
-				trustStoreFile = new FileInputStream(new File(trustStoreFilePath));
-				trustStore.load(trustStoreFile, trustStorePassword.toCharArray());
-			} finally {&lt;br/&gt;
-				if (trustStoreFile != null) {
-					trustStoreFile.close();
-				}&lt;br/&gt;
-			}&lt;br/&gt;
+		Preconditions.checkNotNull(trustStoreFilePath, SecurityOptions.SSL_TRUSTSTORE.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		Preconditions.checkNotNull(trustStorePassword, SecurityOptions.SSL_TRUSTSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
 &lt;br/&gt;
-			TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(&lt;br/&gt;
-				TrustManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
-			trustManagerFactory.init(trustStore);&lt;br/&gt;
+		KeyStore trustStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br/&gt;
 &lt;br/&gt;
-			clientSSLContext = SSLContext.getInstance(sslProtocolVersion);&lt;br/&gt;
-			clientSSLContext.init(null, trustManagerFactory.getTrustManagers(), null);&lt;br/&gt;
+		try (FileInputStream trustStoreFile = new FileInputStream(new File(trustStoreFilePath))) {
+			trustStore.load(trustStoreFile, trustStorePassword.toCharArray());
 		}&lt;br/&gt;
 &lt;br/&gt;
-		return clientSSLContext;&lt;br/&gt;
+		TrustManagerFactory trustManagerFactory = TrustManagerFactory.getInstance(&lt;br/&gt;
+			TrustManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
+		trustManagerFactory.init(trustStore);&lt;br/&gt;
+&lt;br/&gt;
+		javax.net.ssl.SSLContext clientSSLContext = javax.net.ssl.SSLContext.getInstance(sslProtocolVersion);&lt;br/&gt;
+		clientSSLContext.init(null, trustManagerFactory.getTrustManagers(), null);&lt;br/&gt;
+		if (sessionCacheSize &amp;gt;= 0) {
+			clientSSLContext.getClientSessionContext().setSessionCacheSize(sessionCacheSize);
+		}&lt;br/&gt;
+		if (sessionTimeoutMs &amp;gt;= 0) {
+			clientSSLContext.getClientSessionContext().setSessionTimeout(sessionTimeoutMs / 1000);
+		}&lt;br/&gt;
+		return new SSLContext(clientSSLContext, handshakeTimeoutMs, closeNotifyFlushTimeoutMs);&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
@@ -225,38 +229,77 @@ public static SSLContext createSSLClientContext(Configuration sslConfig) throws&lt;br/&gt;
 	public static SSLContext createSSLServerContext(Configuration sslConfig) throws Exception {&lt;br/&gt;
 &lt;br/&gt;
 		Preconditions.checkNotNull(sslConfig);&lt;br/&gt;
-		SSLContext serverSSLContext = null;&lt;br/&gt;
 &lt;br/&gt;
-		if (getSSLEnabled(sslConfig)) {&lt;br/&gt;
-			LOG.debug(&quot;Creating server SSL context from configuration&quot;);&lt;br/&gt;
+		if (!getSSLEnabled(sslConfig)) {+			return null;+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String keystoreFilePath = sslConfig.getString(SecurityOptions.SSL_KEYSTORE);&lt;br/&gt;
+		LOG.debug(&quot;Creating server SSL context from configuration&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String keystorePassword = sslConfig.getString(SecurityOptions.SSL_KEYSTORE_PASSWORD);&lt;br/&gt;
+		String keystoreFilePath = sslConfig.getString(SecurityOptions.SSL_KEYSTORE);&lt;br/&gt;
+		String keystorePassword = sslConfig.getString(SecurityOptions.SSL_KEYSTORE_PASSWORD);&lt;br/&gt;
+		String certPassword = sslConfig.getString(SecurityOptions.SSL_KEY_PASSWORD);&lt;br/&gt;
+		String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		int sessionCacheSize = sslConfig.getInteger(SecurityOptions.SSL_SESSION_CACHE_SIZE);&lt;br/&gt;
+		int sessionTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_SESSION_TIMEOUT);&lt;br/&gt;
+		int handshakeTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_HANDSHAKE_TIMEOUT);&lt;br/&gt;
+		int closeNotifyFlushTimeoutMs = sslConfig.getInteger(SecurityOptions.SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String certPassword = sslConfig.getString(SecurityOptions.SSL_KEY_PASSWORD);&lt;br/&gt;
+		Preconditions.checkNotNull(keystoreFilePath, SecurityOptions.SSL_KEYSTORE.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		Preconditions.checkNotNull(keystorePassword, SecurityOptions.SSL_KEYSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		Preconditions.checkNotNull(certPassword, SecurityOptions.SSL_KEY_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String sslProtocolVersion = sslConfig.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br/&gt;
+		try (FileInputStream keyStoreFile = new FileInputStream(new File(keystoreFilePath))) 
{
+			ks.load(keyStoreFile, keystorePassword.toCharArray());
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Preconditions.checkNotNull(keystoreFilePath, SecurityOptions.SSL_KEYSTORE.key() + &quot; was not configured.&quot;);&lt;/li&gt;
	&lt;li&gt;Preconditions.checkNotNull(keystorePassword, SecurityOptions.SSL_KEYSTORE_PASSWORD.key() + &quot; was not configured.&quot;);&lt;/li&gt;
	&lt;li&gt;Preconditions.checkNotNull(certPassword, SecurityOptions.SSL_KEY_PASSWORD.key() + &quot; was not configured.&quot;);&lt;br/&gt;
+		// Set up key manager factory to use the server key store&lt;br/&gt;
+		KeyManagerFactory kmf = KeyManagerFactory.getInstance(&lt;br/&gt;
+			KeyManagerFactory.getDefaultAlgorithm());&lt;br/&gt;
+		kmf.init(ks, certPassword.toCharArray());&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());&lt;/li&gt;
	&lt;li&gt;try (FileInputStream keyStoreFile = new FileInputStream(new File(keystoreFilePath))) 
{
-				ks.load(keyStoreFile, keystorePassword.toCharArray());
-			}
&lt;p&gt;+		// Initialize the SSLContext&lt;br/&gt;
+		javax.net.ssl.SSLContext serverSSLContext = javax.net.ssl.SSLContext.getInstance(sslProtocolVersion);&lt;br/&gt;
+		serverSSLContext.init(kmf.getKeyManagers(), null, null);&lt;br/&gt;
+		if (sessionCacheSize &amp;gt;= 0) &lt;/p&gt;
{
+			serverSSLContext.getServerSessionContext().setSessionCacheSize(sessionCacheSize);
+		}
&lt;p&gt;+		if (sessionTimeoutMs &amp;gt;= 0) &lt;/p&gt;
{
+			serverSSLContext.getServerSessionContext().setSessionTimeout(sessionTimeoutMs / 1000);
+		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Set up key manager factory to use the server key store&lt;/li&gt;
	&lt;li&gt;KeyManagerFactory kmf = KeyManagerFactory.getInstance(&lt;/li&gt;
	&lt;li&gt;KeyManagerFactory.getDefaultAlgorithm());&lt;/li&gt;
	&lt;li&gt;kmf.init(ks, certPassword.toCharArray());&lt;br/&gt;
+		return new SSLContext(serverSSLContext, handshakeTimeoutMs, closeNotifyFlushTimeoutMs);&lt;br/&gt;
+	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// Initialize the SSLContext&lt;/li&gt;
	&lt;li&gt;serverSSLContext = SSLContext.getInstance(sslProtocolVersion);&lt;/li&gt;
	&lt;li&gt;serverSSLContext.init(kmf.getKeyManagers(), null, null);&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Wrapper around javax.net.ssl.SSLContext, adding SSL handshake and close notify timeouts&lt;br/&gt;
+	 * which cannot be set on the SSL context directly.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static class SSLContext {&lt;br/&gt;
+		private final javax.net.ssl.SSLContext sslContext;&lt;br/&gt;
+		private final int handshakeTimeoutMs;&lt;br/&gt;
+		private final int closeNotifyFlushTimeoutMs;&lt;br/&gt;
+&lt;br/&gt;
+		public SSLContext(&lt;br/&gt;
+				javax.net.ssl.SSLContext sslContext,&lt;br/&gt;
+				int handshakeTimeoutMs,&lt;br/&gt;
+				int closeNotifyFlushTimeoutMs) 
{
+			this.sslContext = sslContext;
+			this.handshakeTimeoutMs = handshakeTimeoutMs;
+			this.closeNotifyFlushTimeoutMs = closeNotifyFlushTimeoutMs;
 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return serverSSLContext;&lt;br/&gt;
+		public javax.net.ssl.SSLContext getSslContext() 
{
+			return sslContext;
+		}
&lt;p&gt;+&lt;br/&gt;
+		public int getHandshakeTimeoutMs() &lt;/p&gt;
{
+			return handshakeTimeoutMs;
+		}
&lt;p&gt;+&lt;br/&gt;
+		public int getCloseNotifyFlushTimeoutMs() &lt;/p&gt;
{
+			return closeNotifyFlushTimeoutMs;
+		}
&lt;p&gt; 	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
index 33e004ebdf6..e7113ec6695 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; package org.apache.flink.runtime.io.network.netty;&lt;/p&gt;

&lt;p&gt;+import org.apache.flink.configuration.ConfigOption;&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.SecurityOptions;&lt;br/&gt;
 import org.apache.flink.util.NetUtils;&lt;br/&gt;
@@ -26,15 +27,27 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.string.StringDecoder;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.string.StringEncoder;&lt;br/&gt;
+import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;/p&gt;

&lt;p&gt; import org.junit.Assert;&lt;br/&gt;
 import org.junit.Test;&lt;/p&gt;

&lt;p&gt;+import javax.net.ssl.SSLSessionContext;&lt;br/&gt;
+&lt;br/&gt;
 import java.net.InetAddress;&lt;/p&gt;

&lt;p&gt;+import static org.apache.flink.configuration.SecurityOptions.SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_HANDSHAKE_TIMEOUT;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_SESSION_CACHE_SIZE;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_SESSION_TIMEOUT;&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertFalse;&lt;br/&gt;
+import static org.junit.Assert.assertNotNull;&lt;br/&gt;
 import static org.junit.Assert.assertTrue;&lt;/p&gt;

&lt;p&gt;+/**&lt;br/&gt;
+ * Tests for communication between &lt;/p&gt;
{@link NettyServer}
&lt;p&gt; and &lt;/p&gt;
{@link NettyClient}
&lt;p&gt; via SSL.&lt;br/&gt;
+ */&lt;br/&gt;
 public class NettyClientServerSslTest {&lt;/p&gt;

&lt;p&gt; 	/**&lt;br/&gt;
@@ -42,52 +55,76 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testValidSslConnection() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;NettyProtocol protocol = new NettyProtocol(null, null, true) {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public ChannelHandler[] getServerChannelHandlers() 
{
-				return new ChannelHandler[0];
-			}&lt;br/&gt;
+		testValidSslConnection(createSslConfig());&lt;br/&gt;
+	}&lt;br/&gt;
 &lt;br/&gt;
-			@Override&lt;br/&gt;
-			public ChannelHandler[] getClientChannelHandlers() {-				return new ChannelHandler[0];-			}&lt;/li&gt;
	&lt;li&gt;};&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Verify valid (advanced) ssl configuration and connection.&lt;br/&gt;
+	 */&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testValidSslConnectionAdvanced() throws Exception 
{
+		Configuration sslConfig = createSslConfig();
+		sslConfig.setInteger(SSL_SESSION_CACHE_SIZE, 1);
+		sslConfig.setInteger(SSL_SESSION_TIMEOUT, 1_000);
+		sslConfig.setInteger(SSL_HANDSHAKE_TIMEOUT, 1_000);
+		sslConfig.setInteger(SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT, 1_000);
+
+		testValidSslConnection(sslConfig);
+	}
&lt;p&gt;+&lt;br/&gt;
+	private void testValidSslConnection(Configuration sslConfig) throws Exception {&lt;br/&gt;
+		NettyProtocol protocol = getEmptyNettyProtocol();&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		NettyConfig nettyConfig = new NettyConfig(&lt;br/&gt;
 			InetAddress.getLoopbackAddress(),&lt;br/&gt;
 			NetUtils.getAvailablePort(),&lt;br/&gt;
 			NettyTestUtil.DEFAULT_SEGMENT_SIZE,&lt;br/&gt;
 			1,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;createSslConfig());&lt;br/&gt;
+			sslConfig);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		NettyTestUtil.NettyServerAndClient serverAndClient = NettyTestUtil.initServerAndClient(protocol, nettyConfig);&lt;/p&gt;

&lt;p&gt; 		Channel ch = NettyTestUtil.connect(serverAndClient);&lt;/p&gt;

&lt;p&gt;+		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_HANDSHAKE_TIMEOUT, sslHandler.getHandshakeTimeoutMillis());&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_CLOSE_NOTIFY_FLUSH_TIMEOUT, sslHandler.getCloseNotifyTimeoutMillis());&lt;br/&gt;
+&lt;br/&gt;
 		// should be able to send text data&lt;br/&gt;
 		ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());&lt;br/&gt;
 		assertTrue(ch.writeAndFlush(&quot;test&quot;).await().isSuccess());&lt;/p&gt;

&lt;p&gt;+		// session context is only be available after a session was setup -&amp;gt; this should be true after data was sent&lt;br/&gt;
+		SSLSessionContext sessionContext = sslHandler.engine().getSession().getSessionContext();&lt;br/&gt;
+		assertNotNull(&quot;bug in unit test setup: session context not available&quot;, sessionContext);&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_SESSION_CACHE_SIZE, sessionContext.getSessionCacheSize());&lt;br/&gt;
+		int sessionTimeout = sslConfig.getInteger(SSL_SESSION_TIMEOUT);&lt;br/&gt;
+		if (sessionTimeout != -1) &lt;/p&gt;
{
+			// session timeout config is in milliseconds but the context returns it in seconds
+			assertEquals(sessionTimeout / 1000, sessionContext.getSessionTimeout());
+		}
&lt;p&gt; else &lt;/p&gt;
{
+			assertTrue(&quot;default value (-1) should not be propagated&quot;, sessionContext.getSessionTimeout() &amp;gt;= 0);
+		}
&lt;p&gt;+&lt;br/&gt;
 		NettyTestUtil.shutdown(serverAndClient);&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private static void assertEqualsOrDefault(Configuration sslConfig, ConfigOption&amp;lt;Integer&amp;gt; option, long actual) {&lt;br/&gt;
+		long expected = sslConfig.getInteger(option);&lt;br/&gt;
+		if (expected != option.defaultValue()) &lt;/p&gt;
{
+			assertEquals(expected, actual);
+		}
&lt;p&gt; else &lt;/p&gt;
{
+			assertTrue(&quot;default value (&quot; + option.defaultValue() + &quot;) should not be propagated&quot;,
+				actual &amp;gt;= 0);
+		}
&lt;p&gt;+	}&lt;br/&gt;
+&lt;br/&gt;
 	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Verify failure on invalid ssl configuration.&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void testInvalidSslConfiguration() throws Exception {&lt;/li&gt;
	&lt;li&gt;NettyProtocol protocol = new NettyProtocol(null, null, true) {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public ChannelHandler[] getServerChannelHandlers() 
{
-				return new ChannelHandler[0];
-			}&lt;br/&gt;
-&lt;br/&gt;
-			@Override&lt;br/&gt;
-			public ChannelHandler[] getClientChannelHandlers() {-				return new ChannelHandler[0];-			}&lt;/li&gt;
	&lt;li&gt;};&lt;br/&gt;
+	public void testInvalidSslConfiguration() {&lt;br/&gt;
+		NettyProtocol protocol = getEmptyNettyProtocol();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		Configuration config = createSslConfig();&lt;br/&gt;
 		// Modify the keystore password to an incorrect one&lt;br/&gt;
@@ -116,17 +153,7 @@ public void testInvalidSslConfiguration() throws Exception {&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testSslHandshakeError() throws Exception {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;NettyProtocol protocol = new NettyProtocol(null, null, true) {&lt;/li&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public ChannelHandler[] getServerChannelHandlers() 
{
-				return new ChannelHandler[0];
-			}&lt;br/&gt;
-&lt;br/&gt;
-			@Override&lt;br/&gt;
-			public ChannelHandler[] getClientChannelHandlers() {-				return new ChannelHandler[0];-			}&lt;/li&gt;
	&lt;li&gt;};&lt;br/&gt;
+		NettyProtocol protocol = getEmptyNettyProtocol();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		Configuration config = createSslConfig();&lt;/p&gt;

&lt;p&gt;@@ -151,8 +178,7 @@ public void testSslHandshakeError() throws Exception &lt;/p&gt;
{
 		NettyTestUtil.shutdown(serverAndClient);
 	}

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private Configuration createSslConfig() throws Exception {&lt;br/&gt;
-&lt;br/&gt;
+	private Configuration createSslConfig() {&lt;br/&gt;
 		Configuration flinkConfig = new Configuration();&lt;br/&gt;
 		flinkConfig.setBoolean(SecurityOptions.SSL_ENABLED, true);&lt;br/&gt;
 		flinkConfig.setString(SecurityOptions.SSL_KEYSTORE, &quot;src/test/resources/local127.keystore&quot;);&lt;br/&gt;
@@ -162,4 +188,18 @@ private Configuration createSslConfig() throws Exception 
{
 		flinkConfig.setString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD, &quot;password&quot;);
 		return flinkConfig;
 	}
&lt;p&gt;+&lt;br/&gt;
+	private static NettyProtocol getEmptyNettyProtocol() {&lt;br/&gt;
+		return new NettyProtocol(null, null, true) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			@Override+			public ChannelHandler[] getServerChannelHandlers() {
+				return new ChannelHandler[0];
+			}&lt;br/&gt;
+&lt;br/&gt;
+			@Override&lt;br/&gt;
+			public ChannelHandler[] getClientChannelHandlers() {+				return new ChannelHandler[0];+			}+		}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;;&lt;br/&gt;
+	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
index 38c8ceeedf9..a5db40fd5af 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
@@ -24,7 +24,6 @@&lt;br/&gt;
 import org.junit.Assert;&lt;br/&gt;
 import org.junit.Test;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-import javax.net.ssl.SSLContext;&lt;br/&gt;
 import javax.net.ssl.SSLEngine;&lt;br/&gt;
 import javax.net.ssl.SSLServerSocket;&lt;/p&gt;

&lt;p&gt;@@ -33,6 +32,7 @@&lt;/p&gt;

&lt;p&gt; import static org.hamcrest.Matchers.contains;&lt;br/&gt;
 import static org.hamcrest.Matchers.containsInAnyOrder;&lt;br/&gt;
+import static org.junit.Assert.assertNotNull;&lt;br/&gt;
 import static org.junit.Assert.assertThat;&lt;/p&gt;

&lt;p&gt; /**&lt;br/&gt;
@@ -58,7 +58,7 @@ public void testCreateSSLClientContext() throws Exception &lt;/p&gt;
{
 		clientConfig.setString(SecurityOptions.SSL_TRUSTSTORE, &quot;src/test/resources/local127.truststore&quot;);
 		clientConfig.setString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD, &quot;password&quot;);
 
-		SSLContext clientContext = SSLUtils.createSSLClientContext(clientConfig);
+		SSLUtils.SSLContext clientContext = SSLUtils.createSSLClientContext(clientConfig);
 		Assert.assertNotNull(clientContext);
 	}

&lt;p&gt;@@ -71,7 +71,7 @@ public void testCreateSSLClientContextWithSSLDisabled() throws Exception &lt;/p&gt;
{
 		Configuration clientConfig = new Configuration();
 		clientConfig.setBoolean(SecurityOptions.SSL_ENABLED, false);
 
-		SSLContext clientContext = SSLUtils.createSSLClientContext(clientConfig);
+		SSLUtils.SSLContext clientContext = SSLUtils.createSSLClientContext(clientConfig);
 		Assert.assertNull(clientContext);
 	}

&lt;p&gt;@@ -87,7 +87,7 @@ public void testCreateSSLClientContextMisconfiguration() {&lt;br/&gt;
 		clientConfig.setString(SecurityOptions.SSL_TRUSTSTORE_PASSWORD, &quot;badpassword&quot;);&lt;/p&gt;

&lt;p&gt; 		try &lt;/p&gt;
{
-			SSLContext clientContext = SSLUtils.createSSLClientContext(clientConfig);
+			SSLUtils.SSLContext clientContext = SSLUtils.createSSLClientContext(clientConfig);
 			Assert.fail(&quot;SSL client context created even with bad SSL configuration &quot;);
 		}
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
 			// Exception here is valid&lt;br/&gt;
@@ -106,7 +106,7 @@ public void testCreateSSLServerContext() throws Exception &lt;/p&gt;
{
 		serverConfig.setString(SecurityOptions.SSL_KEYSTORE_PASSWORD, &quot;password&quot;);
 		serverConfig.setString(SecurityOptions.SSL_KEY_PASSWORD, &quot;password&quot;);
 
-		SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);
+		SSLUtils.SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);
 		Assert.assertNotNull(serverContext);
 	}

&lt;p&gt;@@ -119,7 +119,7 @@ public void testCreateSSLServerContextWithSSLDisabled() throws Exception &lt;/p&gt;
{
 		Configuration serverConfig = new Configuration();
 		serverConfig.setBoolean(SecurityOptions.SSL_ENABLED, false);
 
-		SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);
+		SSLUtils.SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);
 		Assert.assertNull(serverContext);
 	}

&lt;p&gt;@@ -136,7 +136,7 @@ public void testCreateSSLServerContextMisconfiguration() {&lt;br/&gt;
 		serverConfig.setString(SecurityOptions.SSL_KEY_PASSWORD, &quot;badpassword&quot;);&lt;/p&gt;

&lt;p&gt; 		try &lt;/p&gt;
{
-			SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);
+			SSLUtils.SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);
 			Assert.fail(&quot;SSL server context created even with bad SSL configuration &quot;);
 		}
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
 			// Exception here is valid&lt;br/&gt;
@@ -157,7 +157,7 @@ public void testCreateSSLServerContextWithMultiProtocols() {&lt;br/&gt;
 		serverConfig.setString(SecurityOptions.SSL_PROTOCOL, &quot;TLSv1,TLSv1.2&quot;);&lt;/p&gt;

&lt;p&gt; 		try &lt;/p&gt;
{
-			SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);
+			SSLUtils.SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);
 			Assert.fail(&quot;SSL server context created even with multiple protocols set &quot;);
 		}
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
 			// Exception here is valid&lt;br/&gt;
@@ -178,10 +178,9 @@ public void testSetSSLVersionAndCipherSuitesForSSLServerSocket() throws Exceptio&lt;br/&gt;
 		serverConfig.setString(SecurityOptions.SSL_PROTOCOL, &quot;TLSv1.1&quot;);&lt;br/&gt;
 		serverConfig.setString(SecurityOptions.SSL_ALGORITHMS, &quot;TLS_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA256&quot;);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);&lt;/li&gt;
	&lt;li&gt;ServerSocket socket = null;&lt;/li&gt;
	&lt;li&gt;try {&lt;/li&gt;
	&lt;li&gt;socket = serverContext.getServerSocketFactory().createServerSocket(0);&lt;br/&gt;
+		SSLUtils.SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);&lt;br/&gt;
+		assertNotNull(serverContext);&lt;br/&gt;
+		try (ServerSocket socket = serverContext.getSslContext().getServerSocketFactory().createServerSocket(0)) 
{
 
 			String[] protocols = ((SSLServerSocket) socket).getEnabledProtocols();
 			String[] algorithms = ((SSLServerSocket) socket).getEnabledCipherSuites();
@@ -198,10 +197,6 @@ public void testSetSSLVersionAndCipherSuitesForSSLServerSocket() throws Exceptio
 			Assert.assertEquals(2, algorithms.length);
 			Assert.assertTrue(algorithms[0].equals(&quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;) || algorithms[0].equals(&quot;TLS_RSA_WITH_AES_128_CBC_SHA256&quot;));
 			Assert.assertTrue(algorithms[1].equals(&quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;) || algorithms[1].equals(&quot;TLS_RSA_WITH_AES_128_CBC_SHA256&quot;));
-		}
&lt;p&gt; finally {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (socket != null) 
{
-				socket.close();
-			}
&lt;p&gt; 		}&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -219,8 +214,9 @@ public void testSetSSLVersionAndCipherSuitesForSSLEngine() throws Exception {&lt;br/&gt;
 		serverConfig.setString(SecurityOptions.SSL_PROTOCOL, &quot;TLSv1&quot;);&lt;br/&gt;
 		serverConfig.setString(SecurityOptions.SSL_ALGORITHMS, &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);&lt;/li&gt;
	&lt;li&gt;SSLEngine engine = serverContext.createSSLEngine();&lt;br/&gt;
+		SSLUtils.SSLContext serverContext = SSLUtils.createSSLServerContext(serverConfig);&lt;br/&gt;
+		assertNotNull(serverContext);&lt;br/&gt;
+		SSLEngine engine = serverContext.getSslContext().createSSLEngine();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		String[] protocols = engine.getEnabledProtocols();&lt;br/&gt;
 		String[] algorithms = engine.getEnabledCipherSuites();&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/rest/RestServerEndpointITCase.java b/flink-runtime/src/test/java/org/apache/flink/runtime/rest/RestServerEndpointITCase.java&lt;br/&gt;
index 93dbb5dc145..59db1630cce 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/rest/RestServerEndpointITCase.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/rest/RestServerEndpointITCase.java&lt;br/&gt;
@@ -164,9 +164,9 @@ public void setup() throws Exception {&lt;br/&gt;
 		config.setString(WebOptions.UPLOAD_DIR, temporaryFolder.newFolder().getCanonicalPath());&lt;/p&gt;

&lt;p&gt; 		defaultSSLContext = SSLContext.getDefault();&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final SSLContext sslClientContext = SSLUtils.createSSLClientContext(config);&lt;br/&gt;
+		final SSLUtils.SSLContext sslClientContext = SSLUtils.createSSLClientContext(config);&lt;br/&gt;
 		if (sslClientContext != null) 
{
-			SSLContext.setDefault(sslClientContext);
+			SSLContext.setDefault(sslClientContext.getSslContext());
 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		RestServerEndpointConfiguration serverConfig = RestServerEndpointConfiguration.fromConfiguration(config);&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16586571" author="nicok" created="Mon, 20 Aug 2018 21:55:23 +0000"  >&lt;p&gt;Fixed via:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`release-1.5`: 9e421a438dd830c6be72e5f13f855e68a82aef21&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(1.6 and master will get new forward-PRs)&lt;/p&gt;</comment>
                            <comment id="16649106" author="githubbot" created="Sat, 13 Oct 2018 20:36:19 +0000"  >&lt;p&gt;NicoK opened a new pull request #6838: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6838&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6838&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This is mostly to tackle bugs like &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;&lt;br/&gt;
   (JDK issue during garbage collection when the SSL session cache is not limited).&lt;br/&gt;
   We add the following low-level configuration options for the user to fine-tune&lt;br/&gt;
   their system, i.e. the Flink-internal communication:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SSL session cache size&lt;/li&gt;
	&lt;li&gt;SSL session timeout&lt;/li&gt;
	&lt;li&gt;SSL handshake timeout&lt;/li&gt;
	&lt;li&gt;SSL close notify flush timeout&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   FYI: I&apos;ll also merge this into `master` if accepted.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add `security.ssl.internal.session-cache-size` and `security.ssl.internal.session-timeout` configuration parameters&lt;br/&gt;
   -&amp;gt; configure these for `SSLContext`s created by `SSLUtil`&lt;/li&gt;
	&lt;li&gt;add `security.ssl.internal.handshake-timeout` and `security.ssl.internal.close-notify-flush-timeout`&lt;br/&gt;
   -&amp;gt; configure these for `SslHandler`s created by `SSLHandlerFactory` (previously `SSLEngineFactory`)&lt;/li&gt;
	&lt;li&gt;rename/refactor `SSLEngineFactory` to `SSLHandlerFactory` since no `SSLEngine` objects alone were actually needed, but only Netty&apos;s `SslHandler` (reduces code duplication which would be worse with this PR)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change added tests and can be verified as follows:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added configuration-verification test to `NettyClientServerSslTest`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The serializers: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: *&lt;b&gt;no&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? *&lt;b&gt;yes&lt;/b&gt;* (kind-of)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? *&lt;b&gt;docs + JavaDocs&lt;/b&gt;*&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16659005" author="nicok" created="Mon, 22 Oct 2018 13:45:05 +0000"  >&lt;p&gt;Also forward-ported to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;release-1.6: b0496f21d70cc1af15569f3632d7a58fd53b8f95&lt;/li&gt;
	&lt;li&gt;master: a59ce1ec895765ef56a1c55e0d21ab7beadaaad6&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16659288" author="githubbot" created="Mon, 22 Oct 2018 18:23:54 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6838: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6838#discussion_r226291127&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6838#discussion_r226291127&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -88,6 +90,7 @@&lt;/p&gt;

&lt;p&gt; 	private final HistoryServerArchiveFetcher archiveFetcher;&lt;/p&gt;

&lt;p&gt;+	@Nullable&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   `Optional`? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16659289" author="githubbot" created="Mon, 22 Oct 2018 18:23:54 +0000"  >&lt;p&gt;pnowojski commented on a change in pull request #6838: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6838#discussion_r226293240&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6838#discussion_r226293240&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/SSLHandlerFactory.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -36,29 +38,66 @@&lt;/p&gt;

&lt;p&gt; 	private final boolean clientMode;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final boolean clientAuthentication;&lt;br/&gt;
+	private final boolean clientAuthentication;&lt;br/&gt;
+&lt;br/&gt;
+	private final int handshakeTimeoutMs;&lt;br/&gt;
+&lt;br/&gt;
+	private final int closeNotifyFlushTimeoutMs;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngineFactory(&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Create a new SSLEngine factory.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   nit: comment is outdated (`SSLEngine`).&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16659376" author="githubbot" created="Mon, 22 Oct 2018 18:52:38 +0000"  >&lt;p&gt;NicoK commented on issue #6838: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6838#issuecomment-431836355&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6838#issuecomment-431836355&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   thanks @pnowojski for the update - looks like the rebase onto latest master will be the same changes I did for #6895 earlier - I&apos;ll use these, will address your comments and merge&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16659377" author="githubbot" created="Mon, 22 Oct 2018 18:52:46 +0000"  >&lt;p&gt;NicoK commented on a change in pull request #6838: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6838#discussion_r226988384&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6838#discussion_r226988384&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -88,6 +90,7 @@&lt;/p&gt;

&lt;p&gt; 	private final HistoryServerArchiveFetcher archiveFetcher;&lt;/p&gt;

&lt;p&gt;+	@Nullable&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   not changing that one with this PR, sorry&lt;/p&gt;

&lt;p&gt;   FYI: my IntelliJ is actually giving me a warning using `Optional` as a field or a method parameter.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16659401" author="githubbot" created="Mon, 22 Oct 2018 18:54:13 +0000"  >&lt;p&gt;NicoK closed pull request #6895: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6895&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6895&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/docs/_includes/generated/security_configuration.html b/docs/_includes/generated/security_configuration.html&lt;br/&gt;
index 680c1c02434..8999336926f 100644&lt;br/&gt;
&amp;#8212; a/docs/_includes/generated/security_configuration.html&lt;br/&gt;
+++ b/docs/_includes/generated/security_configuration.html&lt;br/&gt;
@@ -12,11 +12,21 @@&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;&quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;The comma separated list of standard SSL algorithms to be supported. Read more &amp;lt;a href=&quot;http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#ciphersuites&quot;&amp;gt;here&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.close-notify-flush-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a channel. If the `close_notify` was not flushed in the given timeout the channel will be closed forcibly. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.enabled&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;false&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;Turns on SSL for internal network communication. Optionally, specific components may override this through their own settings (rpc, data transport, REST, etc).&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.handshake-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) during SSL handshake. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.key-password&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;(none)&amp;lt;/td&amp;gt;&lt;br/&gt;
@@ -32,6 +42,16 @@&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;(none)&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;The secret to decrypt the keystore file for Flink&apos;s for Flink&apos;s internal endpoints (rpc, data transport, blob server).&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.session-cache-size&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The size of the cache used for storing SSL session objects. According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set this to an appropriate number to not run into a bug with stalling IO threads during garbage collection. (-1 = use system default).&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.session-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.truststore&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;(none)&amp;lt;/td&amp;gt;&lt;br/&gt;
diff --git a/docs/ops/security-ssl.md b/docs/ops/security-ssl.md&lt;br/&gt;
index 6ea686203ee..4e3716218d2 100644&lt;br/&gt;
&amp;#8212; a/docs/ops/security-ssl.md&lt;br/&gt;
+++ b/docs/ops/security-ssl.md&lt;br/&gt;
@@ -22,6 +22,9 @@ specific language governing permissions and limitations&lt;br/&gt;
 under the License.&lt;br/&gt;
 --&amp;gt;&lt;/p&gt;

&lt;p&gt;+* ToC&lt;br/&gt;
+{:toc}&lt;br/&gt;
+&lt;br/&gt;
 This page provides instructions on how to enable TLS/SSL authentication and encryption for network communication with and between Flink processes.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Internal and External Connectivity&lt;br/&gt;
@@ -37,7 +40,7 @@ For more flexibility, security for internal and external connectivity can be ena&lt;br/&gt;
   &amp;lt;img src=&quot;{{ site.baseurl }}/fig/ssl_internal_external.svg&quot; alt=&quot;Internal and External Connectivity&quot; style=&quot;width:75%; padding-top:10px; padding-bottom:10px;&quot; /&amp;gt;&lt;br/&gt;
 &amp;lt;/div&amp;gt;&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;
			&lt;ol&gt;
				&lt;li&gt;
				&lt;ol&gt;
					&lt;li&gt;Internal Connectivity&lt;br/&gt;
+### Internal Connectivity&lt;/li&gt;
				&lt;/ol&gt;
				&lt;/li&gt;
			&lt;/ol&gt;
			&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Internal connectivity includes:&lt;/p&gt;

&lt;p&gt;@@ -54,7 +57,7 @@ is not needed by any other party to interact with Flink, and can be simply added&lt;/p&gt;

&lt;p&gt; &lt;b&gt;Note: Because internal connections are mutually authenticated with shared certificates, Flink can skip hostname verification. This makes container-based setups easier.&lt;/b&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;
			&lt;ol&gt;
				&lt;li&gt;
				&lt;ol&gt;
					&lt;li&gt;External / REST Connectivity&lt;br/&gt;
+### External / REST Connectivity&lt;/li&gt;
				&lt;/ol&gt;
				&lt;/li&gt;
			&lt;/ol&gt;
			&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; All external connectivity is exposed via an HTTP/REST endpoint, used for example by the web UI and the CLI:&lt;/p&gt;

&lt;p&gt;@@ -71,7 +74,7 @@ Examples for proxies that Flink users have deployed are &lt;span class=&quot;error&quot;&gt;&amp;#91;Envoy Proxy&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://ww&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ww&lt;/a&gt;&lt;br/&gt;
 The rationale behind delegating authentication to a proxy is that such proxies offer a wide variety of authentication options and thus better integration into existing infrastructures.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;
			&lt;ol&gt;
				&lt;li&gt;
				&lt;ol&gt;
					&lt;li&gt;Queryable State&lt;br/&gt;
+### Queryable State&lt;/li&gt;
				&lt;/ol&gt;
				&lt;/li&gt;
			&lt;/ol&gt;
			&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Connections to the queryable state endpoints is currently not authenticated or encrypted.&lt;/p&gt;

&lt;p&gt;@@ -92,13 +95,13 @@ When `security.ssl.internal.enabled` is set to `true`, you can set the following&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`blob.service.ssl.enabled`: Transport of BLOBs from JobManager to TaskManager&lt;/li&gt;
	&lt;li&gt;`akka.ssl.enabled`: Akka-based RPC connections between JobManager / TaskManager / ResourceManager&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;
			&lt;ol&gt;
				&lt;li&gt;
				&lt;ol&gt;
					&lt;li&gt;Keystores and Truststores&lt;br/&gt;
+### Keystores and Truststores&lt;/li&gt;
				&lt;/ol&gt;
				&lt;/li&gt;
			&lt;/ol&gt;
			&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; The SSL configuration requires to configure a *&lt;b&gt;keystore&lt;/b&gt;* and a *&lt;b&gt;truststore&lt;/b&gt;&lt;b&gt;. The *keystore&lt;/b&gt; contains the public certificate&lt;br/&gt;
 (public key) and the private key, while the truststore contains the trusted certificates or the trusted authorities. Both stores&lt;br/&gt;
 need to be set up such that the truststore trusts the keystore&apos;s certificate.&lt;/p&gt;

&lt;p&gt;-*&lt;b&gt;Internal Connectivity&lt;/b&gt;*&lt;br/&gt;
+#### Internal Connectivity&lt;/p&gt;

&lt;p&gt; Because internal communication is mutually authenticated, keystore and truststore typically contain the same dedicated certificate.&lt;br/&gt;
 The certificate can use wild card hostnames or addresses, because the certificate is expected to be a shared secret and host&lt;br/&gt;
@@ -112,7 +115,7 @@ security.ssl.internal.truststore: /path/to/file.truststore&lt;br/&gt;
 security.ssl.internal.truststore-password: truststore_password&lt;/p&gt;
 {% endhighlight %}&lt;br/&gt;
 &lt;br/&gt;
-*&lt;b&gt;REST Endpoints (external connectivity)&lt;/b&gt;*&lt;br/&gt;
+#### REST Endpoints (external connectivity)&lt;br/&gt;
 &lt;br/&gt;
 For REST endpoints, by default the keystore is used by the server endpoint, and the truststore is used by the REST clients (including the CLI client)&lt;br/&gt;
 to accept the server&apos;s certificate. In the case where the REST keystore has a self-signed certificate, the truststore must trust that certificate directly.&lt;br/&gt;
@@ -130,8 +133,9 @@ security.ssl.rest.truststore-password: truststore_password&lt;br/&gt;
 security.ssl.rest.authentication-enabled: false&lt;br/&gt;
 {% endhighlight %}

&lt;p&gt;-*&lt;b&gt;IMPORTANT&lt;/b&gt;*&lt;br/&gt;
+### Cipher suites&lt;/p&gt;

&lt;p&gt;+&amp;lt;span class=&quot;label label-danger&quot;&amp;gt;IMPORTANT&amp;lt;/span&amp;gt;&lt;br/&gt;
 The &lt;span class=&quot;error&quot;&gt;&amp;#91;IETF RFC 7525&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://tools.ietf.org/html/rfc7525&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://tools.ietf.org/html/rfc7525&lt;/a&gt;) recommends to use a specific set of cipher suites for strong security.&lt;br/&gt;
 Because these cipher suites were not available on many setups out of the box, Flink&apos;s default value is set to a slightly&lt;br/&gt;
 weaker but more compatible cipher suite.&lt;br/&gt;
@@ -143,6 +147,9 @@ security.ssl.algorithms: TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_&lt;/p&gt;

&lt;p&gt; If these cipher suites are not supported on your setup, you will see that Flink processes will not be able to connect to each other.&lt;/p&gt;

&lt;p&gt;+### Complete List of SSL Options&lt;br/&gt;
+&lt;br/&gt;
+&lt;/p&gt;
{% include generated/security_configuration.html %}

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Creating and Deploying Keystores and Truststores&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;diff --git a/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java b/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
index be413cb7264..87ab1713215 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
+++ b/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
@@ -298,4 +298,47 @@&lt;br/&gt;
 		key(&quot;security.ssl.verify-hostname&quot;)&lt;br/&gt;
 			.defaultValue(true)&lt;br/&gt;
 			.withDescription(&quot;Flag to enable peer&#8217;s hostname verification during ssl handshake.&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	// ------------------------ ssl parameters --------------------------------&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session cache size.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_INTERNAL_SESSION_CACHE_SIZE =&lt;br/&gt;
+		key(&quot;security.ssl.internal.session-cache-size&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The size of the cache used for storing SSL session objects. &quot;&lt;br/&gt;
+				+ &quot;According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set &quot;&lt;br/&gt;
+				+ &quot;this to an appropriate number to not run into a bug with stalling IO threads &quot;&lt;br/&gt;
+				+ &quot;during garbage collection. (-1 = use system default).&quot;)&lt;br/&gt;
+		.withDeprecatedKeys(&quot;security.ssl.session-cache-size&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_INTERNAL_SESSION_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.internal.session-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&quot;)&lt;br/&gt;
+			.withDeprecatedKeys(&quot;security.ssl.session-timeout&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout during handshakes.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_INTERNAL_HANDSHAKE_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.internal.handshake-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) during SSL handshake. (-1 = use system default)&quot;)&lt;br/&gt;
+			.withDeprecatedKeys(&quot;security.ssl.handshake-timeout&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout after flushing the &amp;lt;tt&amp;gt;close_notify&amp;lt;/tt&amp;gt; message.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.internal.close-notify-flush-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a &quot; +&lt;br/&gt;
+				&quot;channel. If the `close_notify` was not flushed in the given timeout the channel will be closed &quot; +&lt;br/&gt;
+				&quot;forcibly. (-1 = use system default)&quot;)&lt;br/&gt;
+			.withDeprecatedKeys(&quot;security.ssl.close-notify-flush-timeout&quot;);&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java b/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
index 1fa2cd0ec5c..89a32f19caf 100644&lt;br/&gt;
&amp;#8212; a/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
@@ -24,7 +24,7 @@&lt;br/&gt;
 import org.apache.flink.core.fs.FileSystem;&lt;br/&gt;
 import org.apache.flink.core.fs.Path;&lt;br/&gt;
 import org.apache.flink.mesos.configuration.MesosOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.RoutedRequest;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.Router;&lt;br/&gt;
@@ -51,7 +51,6 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.HttpResponseStatus;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.HttpServerCodec;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.LastHttpContent;&lt;br/&gt;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedStream;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedWriteHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.util.CharsetUtil;&lt;br/&gt;
@@ -59,8 +58,6 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;-import javax.net.ssl.SSLEngine;&lt;br/&gt;
-&lt;br/&gt;
 import java.io.File;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
 import java.net.InetSocketAddress;&lt;br/&gt;
@@ -115,7 +112,7 @@ public MesosArtifactServer(String prefix, String serverHostname, int configuredP&lt;br/&gt;
 				MesosOptions.ARTIFACT_SERVER_SSL_ENABLED) &amp;amp;&amp;amp;&lt;br/&gt;
 				SSLUtils.isRestSSLEnabled(config);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final SSLEngineFactory sslFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslFactory;&lt;br/&gt;
 		if (enableSSL) {&lt;br/&gt;
 			LOG.info(&quot;Enabling ssl for the artifact server&quot;);&lt;br/&gt;
 			try {&lt;br/&gt;
@@ -138,8 +135,7 @@ protected void initChannel(SocketChannel ch) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				// SSL should be the first handler in the pipeline&lt;br/&gt;
 				if (sslFactory != null) &lt;/p&gt;
{
-					SSLEngine sslEngine = sslFactory.createSSLEngine();
-					ch.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));
+					ch.pipeline().addLast(&quot;ssl&quot;, sslFactory.createNettySSLHandler());
 				}

&lt;p&gt; 				ch.pipeline()&lt;br/&gt;
diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
index 5e2da2c2369..d0499ef990d 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
@@ -22,10 +22,10 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.WebOptions;&lt;br/&gt;
 import org.apache.flink.runtime.concurrent.ScheduledExecutor;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.jobmanager.MemoryArchivist;&lt;br/&gt;
 import org.apache.flink.runtime.jobmaster.JobManagerGateway;&lt;br/&gt;
 import org.apache.flink.runtime.leaderretrieval.LeaderRetrievalService;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.legacy.ExecutionGraphCache;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.legacy.backpressure.BackPressureStatsTrackerImpl;&lt;br/&gt;
@@ -181,7 +181,7 @@ public WebRuntimeMonitor(&lt;br/&gt;
 		// --------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 		// Config to enable https access to the web-ui&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final SSLEngineFactory sslFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslFactory;&lt;br/&gt;
 		final boolean enableSSL = SSLUtils.isRestSSLEnabled(config) &amp;amp;&amp;amp; config.getBoolean(WebOptions.SSL_ENABLED);&lt;br/&gt;
 		if (enableSSL) {&lt;br/&gt;
 			LOG.info(&quot;Enabling ssl for the web frontend&quot;);&lt;br/&gt;
diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
index 9f2e0671980..a93fe930fbc 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
@@ -26,7 +26,7 @@&lt;br/&gt;
 import org.apache.flink.core.fs.FileSystem;&lt;br/&gt;
 import org.apache.flink.core.fs.Path;&lt;br/&gt;
 import org.apache.flink.runtime.history.FsJobArchivist;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.legacy.JsonFactory;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.Router;&lt;br/&gt;
@@ -46,6 +46,8 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+import javax.annotation.Nullable;&lt;br/&gt;
+&lt;br/&gt;
 import java.io.File;&lt;br/&gt;
 import java.io.FileWriter;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
@@ -92,7 +94,8 @@&lt;/p&gt;

&lt;p&gt; 	private final HistoryServerArchiveFetcher archiveFetcher;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final SSLEngineFactory serverSSLFactory;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	private final SSLHandlerFactory serverSSLFactory;&lt;br/&gt;
 	private WebFrontendBootstrap netty;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private final Object startupShutdownLock = new Object();&lt;br/&gt;
diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
index 672fddb3eec..cf30fac156c 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
@@ -20,7 +20,7 @@&lt;/p&gt;

&lt;p&gt; import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.JobManagerOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.Router;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.RouterHandler;&lt;br/&gt;
 import org.apache.flink.runtime.webmonitor.HttpRequestHandler;&lt;br/&gt;
@@ -35,13 +35,11 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.SocketChannel;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.nio.NioServerSocketChannel;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.HttpServerCodec;&lt;br/&gt;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedWriteHandler;&lt;/p&gt;

&lt;p&gt; import org.slf4j.Logger;&lt;/p&gt;

&lt;p&gt; import javax.annotation.Nullable;&lt;br/&gt;
-import javax.net.ssl.SSLEngine;&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
 import java.net.InetAddress;&lt;br/&gt;
@@ -64,7 +62,7 @@ public WebFrontendBootstrap(&lt;br/&gt;
 			Router router,&lt;br/&gt;
 			Logger log,&lt;br/&gt;
 			File directory,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Nullable SSLEngineFactory serverSSLFactory,&lt;br/&gt;
+			@Nullable SSLHandlerFactory serverSSLFactory,&lt;br/&gt;
 			String configuredAddress,&lt;br/&gt;
 			int configuredPort,&lt;br/&gt;
 			final Configuration config) throws InterruptedException, UnknownHostException {&lt;br/&gt;
@@ -81,8 +79,7 @@ protected void initChannel(SocketChannel ch) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				// SSL should be the first handler in the pipeline&lt;br/&gt;
 				if (serverSSLFactory != null) &lt;/p&gt;
{
-					SSLEngine sslEngine = serverSSLFactory.createSSLEngine();
-					ch.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));
+					ch.pipeline().addLast(&quot;ssl&quot;, serverSSLFactory.createNettySSLHandler());
 				}

&lt;p&gt; 				ch.pipeline()&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
index ab999d4de8d..d7cad7fcd8e 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
@@ -18,8 +18,6 @@&lt;/p&gt;

&lt;p&gt; package org.apache.flink.runtime.io.network.netty;&lt;/p&gt;

&lt;p&gt;-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
-&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.bootstrap.Bootstrap;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelException;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelFuture;&lt;br/&gt;
@@ -37,7 +35,6 @@&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt; import javax.annotation.Nullable;&lt;br/&gt;
-import javax.net.ssl.SSLEngine;&lt;/p&gt;

&lt;p&gt; import java.io.IOException;&lt;br/&gt;
 import java.net.InetSocketAddress;&lt;br/&gt;
@@ -55,7 +52,7 @@&lt;br/&gt;
 	private Bootstrap bootstrap;&lt;/p&gt;

&lt;p&gt; 	@Nullable&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private SSLEngineFactory clientSSLFactory;&lt;br/&gt;
+	private SSLHandlerFactory clientSSLFactory;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	NettyClient(NettyConfig config) {&lt;br/&gt;
 		this.config = config;&lt;br/&gt;
@@ -181,11 +178,10 @@ public void initChannel(SocketChannel channel) throws Exception {&lt;/p&gt;

&lt;p&gt; 				// SSL handler should be added first in the pipeline&lt;br/&gt;
 				if (clientSSLFactory != null) &lt;/p&gt;
{
-					SSLEngine sslEngine = clientSSLFactory.createSSLEngine(
-						serverSocketAddress.getAddress().getCanonicalHostName(),
-						serverSocketAddress.getPort());
-
-					channel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));
+					SslHandler sslHandler = clientSSLFactory.createNettySSLHandler(
+							serverSocketAddress.getAddress().getCanonicalHostName(),
+							serverSocketAddress.getPort());
+					channel.pipeline().addLast(&quot;ssl&quot;, sslHandler);
 				}
&lt;p&gt; 				channel.pipeline().addLast(protocol.getClientChannelHandlers());&lt;br/&gt;
 			}&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
index 59971e1c5c1..4694c69385c 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
@@ -22,7 +22,6 @@&lt;br/&gt;
 import org.apache.flink.configuration.ConfigOptions;&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.TaskManagerOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;/p&gt;

&lt;p&gt; import org.slf4j.Logger;&lt;br/&gt;
@@ -191,14 +190,14 @@ public TransportType getTransportType() {&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	@Nullable&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngineFactory createClientSSLEngineFactory() throws Exception {&lt;br/&gt;
+	public SSLHandlerFactory createClientSSLEngineFactory() throws Exception 
{
 		return getSSLEnabled() ?
 				SSLUtils.createInternalClientSSLEngineFactory(config) :
 				null;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Nullable&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngineFactory createServerSSLEngineFactory() throws Exception {&lt;br/&gt;
+	public SSLHandlerFactory createServerSSLEngineFactory() throws Exception 
{
 		return getSSLEnabled() ?
 				SSLUtils.createInternalServerSSLEngineFactory(config) :
 				null;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java
index cc260c6ed9b..f818ff64016 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java
@@ -18,7 +18,6 @@
 
 package org.apache.flink.runtime.io.network.netty;
 
-import org.apache.flink.runtime.net.SSLEngineFactory;
 import org.apache.flink.runtime.util.FatalExitExceptionHandler;
 
 import org.apache.flink.shaded.guava18.com.google.common.util.concurrent.ThreadFactoryBuilder;
@@ -32,13 +31,10 @@
 import org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoopGroup;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.SocketChannel;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.nio.NioServerSocketChannel;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;
 
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import javax.net.ssl.SSLEngine;
-
 import java.io.IOException;
 import java.net.InetSocketAddress;
 import java.util.concurrent.ThreadFactory;
@@ -136,9 +132,9 @@ void init(final NettyProtocol protocol, NettyBufferPool nettyBufferPool) throws
 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		// SSL related configuration&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 		try 
{
-			sslEngineFactory = config.createServerSSLEngineFactory();
+			sslHandlerFactory = config.createServerSSLEngineFactory();
 		}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
 			throw new IOException(&quot;Failed to initialize SSL Context for the Netty Server&quot;, e);
 		}
&lt;p&gt;@@ -150,9 +146,8 @@ void init(final NettyProtocol protocol, NettyBufferPool nettyBufferPool) throws&lt;br/&gt;
 		bootstrap.childHandler(new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {&lt;br/&gt;
 			@Override&lt;br/&gt;
 			public void initChannel(SocketChannel channel) throws Exception {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (sslEngineFactory != null) {&lt;/li&gt;
	&lt;li&gt;SSLEngine sslEngine = sslEngineFactory.createSSLEngine();&lt;/li&gt;
	&lt;li&gt;channel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));&lt;br/&gt;
+				if (sslHandlerFactory != null) 
{
+					channel.pipeline().addLast(&quot;ssl&quot;, sslHandlerFactory.createNettySSLHandler());
 				}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				channel.pipeline().addLast(protocol.getServerChannelHandlers());&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLEngineFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/SSLHandlerFactory.java&lt;br/&gt;
similarity index 57%&lt;br/&gt;
rename from flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLEngineFactory.java&lt;br/&gt;
rename to flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/SSLHandlerFactory.java&lt;br/&gt;
index 68f60b81ace..583f0380c22 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLEngineFactory.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/SSLHandlerFactory.java&lt;br/&gt;
@@ -16,7 +16,9 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;limitations under the License.&lt;br/&gt;
  */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-package org.apache.flink.runtime.net;&lt;br/&gt;
+package org.apache.flink.runtime.io.network.netty;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;/p&gt;

&lt;p&gt; import javax.net.ssl.SSLContext;&lt;br/&gt;
 import javax.net.ssl.SSLEngine;&lt;br/&gt;
@@ -24,9 +26,9 @@&lt;br/&gt;
 import static java.util.Objects.requireNonNull;&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates and configures 
{@link SSLEngine}
&lt;p&gt; instances.&lt;br/&gt;
+ * Creates and configures &lt;/p&gt;
{@link SslHandler} instances.&lt;br/&gt;
  */&lt;br/&gt;
-public class SSLEngineFactory {&lt;br/&gt;
+public class SSLHandlerFactory {&lt;br/&gt;
 &lt;br/&gt;
 	private final SSLContext sslContext;&lt;br/&gt;
 &lt;br/&gt;
@@ -36,29 +38,66 @@&lt;br/&gt;
 &lt;br/&gt;
 	private final boolean clientMode;&lt;br/&gt;
 &lt;br/&gt;
-	final boolean clientAuthentication;&lt;br/&gt;
+	private final boolean clientAuthentication;&lt;br/&gt;
+&lt;br/&gt;
+	private final int handshakeTimeoutMs;&lt;br/&gt;
+&lt;br/&gt;
+	private final int closeNotifyFlushTimeoutMs;&lt;br/&gt;
 &lt;br/&gt;
-	public SSLEngineFactory(&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Create a new {@link SslHandler}
&lt;p&gt; factory.&lt;br/&gt;
+	 *&lt;br/&gt;
+	 * @param handshakeTimeoutMs&lt;br/&gt;
+	 * 		SSL session timeout during handshakes (-1 = use system default)&lt;br/&gt;
+	 * @param closeNotifyFlushTimeoutMs&lt;br/&gt;
+	 * 		SSL session timeout after flushing the &amp;lt;tt&amp;gt;close_notify&amp;lt;/tt&amp;gt; message (-1 = use system&lt;br/&gt;
+	 * 		default)&lt;br/&gt;
+	 */&lt;br/&gt;
+	public SSLHandlerFactory(&lt;br/&gt;
 			final SSLContext sslContext,&lt;br/&gt;
 			final String[] enabledProtocols,&lt;br/&gt;
 			final String[] enabledCipherSuites,&lt;br/&gt;
 			final boolean clientMode,&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;final boolean clientAuthentication) {&lt;br/&gt;
+			final boolean clientAuthentication,&lt;br/&gt;
+			final int handshakeTimeoutMs,&lt;br/&gt;
+			final int closeNotifyFlushTimeoutMs) 
{
 
 		this.sslContext = requireNonNull(sslContext, &quot;sslContext must not be null&quot;);
 		this.enabledProtocols = requireNonNull(enabledProtocols, &quot;enabledProtocols must not be null&quot;);
 		this.enabledCipherSuites = requireNonNull(enabledCipherSuites, &quot;cipherSuites must not be null&quot;);
 		this.clientMode = clientMode;
 		this.clientAuthentication = clientAuthentication;
+		this.handshakeTimeoutMs = handshakeTimeoutMs;
+		this.closeNotifyFlushTimeoutMs = closeNotifyFlushTimeoutMs;
+	}
&lt;p&gt;+&lt;br/&gt;
+	public SslHandler createNettySSLHandler() &lt;/p&gt;
{
+		return createNettySSLHandler(createSSLEngine());
+	}
&lt;p&gt;+&lt;br/&gt;
+	public SslHandler createNettySSLHandler(String hostname, int port) &lt;/p&gt;
{
+		return createNettySSLHandler(createSSLEngine(hostname, port));
+	}
&lt;p&gt;+&lt;br/&gt;
+	private SslHandler createNettySSLHandler(SSLEngine sslEngine) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+		SslHandler sslHandler = new SslHandler(sslEngine);+		if (handshakeTimeoutMs &amp;gt;= 0) {
+			sslHandler.setHandshakeTimeoutMillis(handshakeTimeoutMs);
+		}+		if (closeNotifyFlushTimeoutMs &amp;gt;= 0) {
+			sslHandler.setCloseNotifyFlushTimeoutMillis(closeNotifyFlushTimeoutMs);
+		}++		return sslHandler; 	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngine createSSLEngine() {&lt;br/&gt;
+	private SSLEngine createSSLEngine() 
{
 		final SSLEngine sslEngine = sslContext.createSSLEngine();
 		configureSSLEngine(sslEngine);
 		return sslEngine;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngine createSSLEngine(String hostname, int port) {&lt;br/&gt;
+	private SSLEngine createSSLEngine(String hostname, int port) {&lt;br/&gt;
 		final SSLEngine sslEngine = sslContext.createSSLEngine(hostname, port);&lt;br/&gt;
 		configureSSLEngine(sslEngine);&lt;br/&gt;
 		return sslEngine;&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/net/RedirectingSslHandler.java b/flink-runtime/src/main/java/org/apache/flink/runtime/net/RedirectingSslHandler.java&lt;br/&gt;
index 35e0f6cdd7e..0e6103de584 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/net/RedirectingSslHandler.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/net/RedirectingSslHandler.java&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; package org.apache.flink.runtime.net;&lt;/p&gt;

&lt;p&gt;+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.util.HandlerRedirectUtils;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.util.KeepAliveWrite;&lt;/p&gt;

&lt;p&gt;@@ -55,15 +56,15 @@&lt;/p&gt;

&lt;p&gt; 	@Nonnull private final String confRedirectBaseUrl;&lt;br/&gt;
 	@Nonnull private final CompletableFuture&amp;lt;String&amp;gt; redirectBaseUrl;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Nonnull private final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+	@Nonnull private final SSLHandlerFactory sslHandlerFactory;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	public RedirectingSslHandler(&lt;br/&gt;
 		@Nonnull String confRedirectHost,&lt;br/&gt;
 		@Nonnull CompletableFuture&amp;lt;String&amp;gt; redirectBaseUrl,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Nonnull SSLEngineFactory sslEngineFactory) {&lt;br/&gt;
+		@Nonnull SSLHandlerFactory sslHandlerFactory) 
{
 		this.confRedirectBaseUrl = &quot;https://&quot; + confRedirectHost + &quot;:&quot;;
 		this.redirectBaseUrl = redirectBaseUrl;
-		this.sslEngineFactory = sslEngineFactory;
+		this.sslHandlerFactory = sslHandlerFactory;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
@@ -77,7 +78,7 @@ protected void decode(ChannelHandlerContext context, ByteBuf in, List&amp;lt;Object&amp;gt; ou&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	private void handleSsl(ChannelHandlerContext context) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SslHandler sslHandler = new SslHandler(sslEngineFactory.createSSLEngine());&lt;br/&gt;
+		SslHandler sslHandler = sslHandlerFactory.createNettySSLHandler();&lt;br/&gt;
 		try 
{
 			context.pipeline().replace(this, SSL_HANDLER_NAME, sslHandler);
 		}
&lt;p&gt; catch (Throwable t) {&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java b/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
index e0b208d4b8d..c756fabbd0c 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
@@ -22,6 +22,7 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.IllegalConfigurationException;&lt;br/&gt;
 import org.apache.flink.configuration.SecurityOptions;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import javax.annotation.Nullable;&lt;br/&gt;
 import javax.net.ServerSocketFactory;&lt;br/&gt;
@@ -109,73 +110,81 @@ public static SocketFactory createSSLClientSocketFactory(Configuration config) t&lt;br/&gt;
 	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Creates a SSLEngineFactory to be used by internal communication server endpoints.&lt;br/&gt;
 	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SSLEngineFactory createInternalServerSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
+	public static SSLHandlerFactory createInternalServerSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
 		SSLContext sslContext = createInternalSSLContext(config);&lt;br/&gt;
 		if (sslContext == null) 
{
 			throw new IllegalConfigurationException(&quot;SSL is not enabled for internal communication.&quot;);
 		}&lt;br/&gt;
 &lt;br/&gt;
-		return new SSLEngineFactory(&lt;br/&gt;
+		return new SSLHandlerFactory(&lt;br/&gt;
 				sslContext,&lt;br/&gt;
 				getEnabledProtocols(config),&lt;br/&gt;
 				getEnabledCipherSuites(config),&lt;br/&gt;
 				false,&lt;br/&gt;
-				true);&lt;br/&gt;
+				true,&lt;br/&gt;
+				config.getInteger(SecurityOptions.SSL_INTERNAL_HANDSHAKE_TIMEOUT),&lt;br/&gt;
+				config.getInteger(SecurityOptions.SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT));&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
 	 * Creates a SSLEngineFactory to be used by internal communication client endpoints.&lt;br/&gt;
 	 */&lt;br/&gt;
-	public static SSLEngineFactory createInternalClientSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
+	public static SSLHandlerFactory createInternalClientSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
 		SSLContext sslContext = createInternalSSLContext(config);&lt;br/&gt;
 		if (sslContext == null) { 			throw new IllegalConfigurationException(&quot;SSL is not enabled for internal communication.&quot;); 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return new SSLEngineFactory(&lt;br/&gt;
+		return new SSLHandlerFactory(&lt;br/&gt;
 				sslContext,&lt;br/&gt;
 				getEnabledProtocols(config),&lt;br/&gt;
 				getEnabledCipherSuites(config),&lt;br/&gt;
 				true,&lt;/li&gt;
	&lt;li&gt;true);&lt;br/&gt;
+				true,&lt;br/&gt;
+				config.getInteger(SecurityOptions.SSL_INTERNAL_HANDSHAKE_TIMEOUT),&lt;br/&gt;
+				config.getInteger(SecurityOptions.SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT));&lt;br/&gt;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates a 
{@link SSLEngineFactory} to be used by the REST Servers.&lt;br/&gt;
+	 * Creates a {@link SSLHandlerFactory} to be used by the REST Servers.&lt;br/&gt;
 	 *&lt;br/&gt;
 	 * @param config The application configuration.&lt;br/&gt;
 	 */&lt;br/&gt;
-	public static SSLEngineFactory createRestServerSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
+	public static SSLHandlerFactory createRestServerSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
 		SSLContext sslContext = createRestServerSSLContext(config);&lt;br/&gt;
 		if (sslContext == null) {
 			throw new IllegalConfigurationException(&quot;SSL is not enabled for REST endpoints.&quot;);
 		}&lt;br/&gt;
 &lt;br/&gt;
-		return new SSLEngineFactory(&lt;br/&gt;
+		return new SSLHandlerFactory(&lt;br/&gt;
 				sslContext,&lt;br/&gt;
 				getEnabledProtocols(config),&lt;br/&gt;
 				getEnabledCipherSuites(config),&lt;br/&gt;
 				false,&lt;br/&gt;
-				isRestSSLAuthenticationEnabled(config));&lt;br/&gt;
+				isRestSSLAuthenticationEnabled(config),&lt;br/&gt;
+				-1,&lt;br/&gt;
+				-1);&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
-	 * Creates a {@link SSLEngineFactory}
&lt;p&gt; to be used by the REST Clients.&lt;br/&gt;
+	 * Creates a &lt;/p&gt;
{@link SSLHandlerFactory} to be used by the REST Clients.&lt;br/&gt;
 	 *&lt;br/&gt;
 	 * @param config The application configuration.&lt;br/&gt;
 	 */&lt;br/&gt;
-	public static SSLEngineFactory createRestClientSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
+	public static SSLHandlerFactory createRestClientSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
 		SSLContext sslContext = createRestClientSSLContext(config);&lt;br/&gt;
 		if (sslContext == null) {
 			throw new IllegalConfigurationException(&quot;SSL is not enabled for REST endpoints.&quot;);
 		}&lt;br/&gt;
 &lt;br/&gt;
-		return new SSLEngineFactory(&lt;br/&gt;
+		return new SSLHandlerFactory(&lt;br/&gt;
 				sslContext,&lt;br/&gt;
 				getEnabledProtocols(config),&lt;br/&gt;
 				getEnabledCipherSuites(config),&lt;br/&gt;
 				true,&lt;br/&gt;
-				isRestSSLAuthenticationEnabled(config));&lt;br/&gt;
+				isRestSSLAuthenticationEnabled(config),&lt;br/&gt;
+				-1,&lt;br/&gt;
+				-1);&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	private static String[] getEnabledProtocols(final Configuration config) {&lt;br/&gt;
@@ -194,7 +203,7 @@ public static SSLEngineFactory createRestClientSSLEngineFactory(final Configurat&lt;br/&gt;
 	 * of mutual authentication.&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	public static SSLContext createInternalSSLContext(Configuration config) throws Exception {&lt;br/&gt;
+	private static SSLContext createInternalSSLContext(Configuration config) throws Exception {&lt;br/&gt;
 		checkNotNull(config, &quot;config&quot;);&lt;br/&gt;
 &lt;br/&gt;
 		if (!isInternalSSLEnabled(config)) {&lt;br/&gt;
@@ -216,6 +225,8 @@ public static SSLContext createInternalSSLContext(Configuration config) throws E&lt;br/&gt;
 				config, SecurityOptions.SSL_INTERNAL_TRUSTSTORE_PASSWORD, SecurityOptions.SSL_TRUSTSTORE_PASSWORD);&lt;br/&gt;
 &lt;br/&gt;
 		String sslProtocolVersion = config.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		int sessionCacheSize = config.getInteger(SecurityOptions.SSL_INTERNAL_SESSION_CACHE_SIZE);&lt;br/&gt;
+		int sessionTimeoutMs = config.getInteger(SecurityOptions.SSL_INTERNAL_SESSION_TIMEOUT);&lt;br/&gt;
 &lt;br/&gt;
 		KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br/&gt;
 		try (InputStream keyStoreFile = Files.newInputStream(new File(keystoreFilePath).toPath())) {&lt;br/&gt;
@@ -235,6 +246,12 @@ public static SSLContext createInternalSSLContext(Configuration config) throws E&lt;br/&gt;
 &lt;br/&gt;
 		SSLContext sslContext = SSLContext.getInstance(sslProtocolVersion);&lt;br/&gt;
 		sslContext.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);&lt;br/&gt;
+		if (sessionCacheSize &amp;gt;= 0) {
+			sslContext.getClientSessionContext().setSessionCacheSize(sessionCacheSize);
+		}&lt;br/&gt;
+		if (sessionTimeoutMs &amp;gt;= 0) {
+			sslContext.getClientSessionContext().setSessionTimeout(sessionTimeoutMs / 1000);
+		}&lt;br/&gt;
 &lt;br/&gt;
 		return sslContext;&lt;br/&gt;
 	}&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClient.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClient.java&lt;br/&gt;
index d4c5e880bc7..a25b13cca7d 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClient.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClient.java&lt;br/&gt;
@@ -22,7 +22,7 @@&lt;br/&gt;
 import org.apache.flink.configuration.ConfigConstants;&lt;br/&gt;
 import org.apache.flink.configuration.RestOptions;&lt;br/&gt;
 import org.apache.flink.runtime.concurrent.FutureUtils;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.rest.messages.ErrorResponseBody;&lt;br/&gt;
 import org.apache.flink.runtime.rest.messages.MessageHeaders;&lt;br/&gt;
 import org.apache.flink.runtime.rest.messages.MessageParameters;&lt;br/&gt;
@@ -70,7 +70,6 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.multipart.DefaultHttpDataFactory;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.multipart.HttpPostRequestEncoder;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.multipart.MemoryAttribute;&lt;br/&gt;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedWriteHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.timeout.IdleStateEvent;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.timeout.IdleStateHandler;&lt;br/&gt;
@@ -116,14 +115,14 @@ public RestClient(RestClientConfiguration configuration, Executor executor) {&lt;br/&gt;
 		this.executor = Preconditions.checkNotNull(executor);&lt;br/&gt;
 		this.terminationFuture = new CompletableFuture&amp;lt;&amp;gt;();&lt;br/&gt;
 &lt;br/&gt;
-		final SSLEngineFactory sslEngineFactory = configuration.getSslEngineFactory();&lt;br/&gt;
+		final SSLHandlerFactory sslHandlerFactory = configuration.getSslHandlerFactory();&lt;br/&gt;
 		ChannelInitializer&amp;lt;SocketChannel&amp;gt; initializer = new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {&lt;br/&gt;
 			@Override&lt;br/&gt;
 			protected void initChannel(SocketChannel socketChannel) {&lt;br/&gt;
 				try {&lt;br/&gt;
 					// SSL should be the first handler in the pipeline&lt;br/&gt;
-					if (sslEngineFactory != null) {&lt;br/&gt;
-						socketChannel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngineFactory.createSSLEngine()));&lt;br/&gt;
+					if (sslHandlerFactory != null) {
+						socketChannel.pipeline().addLast(&quot;ssl&quot;, sslHandlerFactory.createNettySSLHandler());
 					}&lt;br/&gt;
 &lt;br/&gt;
 					socketChannel.pipeline()&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClientConfiguration.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClientConfiguration.java&lt;br/&gt;
index b70b1f81ab3..dbddc069c2e 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClientConfiguration.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClientConfiguration.java&lt;br/&gt;
@@ -20,7 +20,7 @@&lt;br/&gt;
 &lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.RestOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.util.ConfigurationException;&lt;br/&gt;
 import org.apache.flink.util.Preconditions;&lt;br/&gt;
@@ -36,7 +36,7 @@&lt;br/&gt;
 public final class RestClientConfiguration {&lt;br/&gt;
 &lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	private final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+	private final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 &lt;br/&gt;
 	private final long connectionTimeout;&lt;br/&gt;
 &lt;br/&gt;
@@ -45,12 +45,12 @@&lt;br/&gt;
 	private final int maxContentLength;&lt;br/&gt;
 &lt;br/&gt;
 	private RestClientConfiguration(&lt;br/&gt;
-			@Nullable final SSLEngineFactory sslEngineFactory,&lt;br/&gt;
+			@Nullable final SSLHandlerFactory sslHandlerFactory,&lt;br/&gt;
 			final long connectionTimeout,&lt;br/&gt;
 			final long idlenessTimeout,&lt;br/&gt;
 			final int maxContentLength) {&lt;br/&gt;
 		checkArgument(maxContentLength &amp;gt; 0, &quot;maxContentLength must be positive, was: %d&quot;, maxContentLength);&lt;br/&gt;
-		this.sslEngineFactory = sslEngineFactory;&lt;br/&gt;
+		this.sslHandlerFactory = sslHandlerFactory;&lt;br/&gt;
 		this.connectionTimeout = connectionTimeout;&lt;br/&gt;
 		this.idlenessTimeout = idlenessTimeout;&lt;br/&gt;
 		this.maxContentLength = maxContentLength;&lt;br/&gt;
@@ -62,8 +62,8 @@ private RestClientConfiguration(&lt;br/&gt;
 	 * @return SSLEngine that the REST client endpoint should use, or null if SSL was disabled&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	public SSLEngineFactory getSslEngineFactory() {&lt;br/&gt;
-		return sslEngineFactory;&lt;br/&gt;
+	public SSLHandlerFactory getSslHandlerFactory() {
+		return sslHandlerFactory;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
@@ -100,15 +100,15 @@ public int getMaxContentLength() {&lt;br/&gt;
 	public static RestClientConfiguration fromConfiguration(Configuration config) throws ConfigurationException {&lt;br/&gt;
 		Preconditions.checkNotNull(config);&lt;br/&gt;
 &lt;br/&gt;
-		final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 		if (SSLUtils.isRestSSLEnabled(config)) {&lt;br/&gt;
 			try {
-				sslEngineFactory = SSLUtils.createRestClientSSLEngineFactory(config);
+				sslHandlerFactory = SSLUtils.createRestClientSSLEngineFactory(config);
 			} catch (Exception e) {
 				throw new ConfigurationException(&quot;Failed to initialize SSLContext for the REST client&quot;, e);
 			}&lt;br/&gt;
 		} else {
-			sslEngineFactory = null;
+			sslHandlerFactory = null;
 		}&lt;br/&gt;
 &lt;br/&gt;
 		final long connectionTimeout = config.getLong(RestOptions.CONNECTION_TIMEOUT);&lt;br/&gt;
@@ -117,6 +117,6 @@ public static RestClientConfiguration fromConfiguration(Configuration config) th&lt;br/&gt;
 &lt;br/&gt;
 		int maxContentLength = config.getInteger(RestOptions.CLIENT_MAX_CONTENT_LENGTH);&lt;br/&gt;
 &lt;br/&gt;
-		return new RestClientConfiguration(sslEngineFactory, connectionTimeout, idlenessTimeout, maxContentLength);&lt;br/&gt;
+		return new RestClientConfiguration(sslHandlerFactory, connectionTimeout, idlenessTimeout, maxContentLength);&lt;br/&gt;
 	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java&lt;br/&gt;
index 068192cf794..8cf305c6c1b 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java&lt;br/&gt;
@@ -22,8 +22,8 @@&lt;br/&gt;
 import org.apache.flink.api.common.time.Time;&lt;br/&gt;
 import org.apache.flink.api.java.tuple.Tuple2;&lt;br/&gt;
 import org.apache.flink.runtime.concurrent.FutureUtils;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.RedirectingSslHandler;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.PipelineErrorHandler;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.RestHandlerSpecification;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.Router;&lt;br/&gt;
@@ -78,7 +78,7 @@&lt;br/&gt;
 	private final String restBindAddress;&lt;br/&gt;
 	private final int restBindPort;&lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	private final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+	private final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 	private final int maxContentLength;&lt;br/&gt;
 &lt;br/&gt;
 	protected final Path uploadDir;&lt;br/&gt;
@@ -99,7 +99,7 @@ public RestServerEndpoint(RestServerEndpointConfiguration configuration) throws&lt;br/&gt;
 		this.restAddress = configuration.getRestAddress();&lt;br/&gt;
 		this.restBindAddress = configuration.getRestBindAddress();&lt;br/&gt;
 		this.restBindPort = configuration.getRestBindPort();&lt;br/&gt;
-		this.sslEngineFactory = configuration.getSslEngineFactory();&lt;br/&gt;
+		this.sslHandlerFactory = configuration.getSslHandlerFactory();&lt;br/&gt;
 &lt;br/&gt;
 		this.uploadDir = configuration.getUploadDir();&lt;br/&gt;
 		createUploadDir(uploadDir, log);&lt;br/&gt;
@@ -157,9 +157,9 @@ protected void initChannel(SocketChannel ch) {&lt;br/&gt;
 					RouterHandler handler = new RouterHandler(router, responseHeaders);&lt;br/&gt;
 &lt;br/&gt;
 					// SSL should be the first handler in the pipeline&lt;br/&gt;
-					if (sslEngineFactory != null) {&lt;br/&gt;
+					if (sslHandlerFactory != null) {
 						ch.pipeline().addLast(&quot;ssl&quot;,
-							new RedirectingSslHandler(restAddress, restAddressFuture, sslEngineFactory));
+							new RedirectingSslHandler(restAddress, restAddressFuture, sslHandlerFactory));
 					}&lt;br/&gt;
 &lt;br/&gt;
 					ch.pipeline()&lt;br/&gt;
@@ -203,7 +203,7 @@ protected void initChannel(SocketChannel ch) {&lt;br/&gt;
 &lt;br/&gt;
 			final String protocol;&lt;br/&gt;
 &lt;br/&gt;
-			if (sslEngineFactory != null) {&lt;br/&gt;
+			if (sslHandlerFactory != null) {
 				protocol = &quot;https://&quot;;
 			} else {&lt;br/&gt;
 				protocol = &quot;http://&quot;;&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpointConfiguration.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpointConfiguration.java&lt;br/&gt;
index 561891f9276..5a54d206c99 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpointConfiguration.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpointConfiguration.java&lt;br/&gt;
@@ -21,7 +21,7 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.RestOptions;&lt;br/&gt;
 import org.apache.flink.configuration.WebOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.util.ConfigurationException;&lt;br/&gt;
 import org.apache.flink.util.Preconditions;&lt;br/&gt;
@@ -51,7 +51,7 @@&lt;br/&gt;
 	private final int restBindPort;&lt;br/&gt;
 &lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	private final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+	private final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 &lt;br/&gt;
 	private final Path uploadDir;&lt;br/&gt;
 &lt;br/&gt;
@@ -63,7 +63,7 @@ private RestServerEndpointConfiguration(&lt;br/&gt;
 			final String restAddress,&lt;br/&gt;
 			@Nullable String restBindAddress,&lt;br/&gt;
 			int restBindPort,&lt;br/&gt;
-			@Nullable SSLEngineFactory sslEngineFactory,&lt;br/&gt;
+			@Nullable SSLHandlerFactory sslHandlerFactory,&lt;br/&gt;
 			final Path uploadDir,&lt;br/&gt;
 			final int maxContentLength,&lt;br/&gt;
 			final Map&amp;lt;String, String&amp;gt; responseHeaders) {&lt;br/&gt;
@@ -74,7 +74,7 @@ private RestServerEndpointConfiguration(&lt;br/&gt;
 		this.restAddress = requireNonNull(restAddress);&lt;br/&gt;
 		this.restBindAddress = restBindAddress;&lt;br/&gt;
 		this.restBindPort = restBindPort;&lt;br/&gt;
-		this.sslEngineFactory = sslEngineFactory;&lt;br/&gt;
+		this.sslHandlerFactory = sslHandlerFactory;&lt;br/&gt;
 		this.uploadDir = requireNonNull(uploadDir);&lt;br/&gt;
 		this.maxContentLength = maxContentLength;&lt;br/&gt;
 		this.responseHeaders = Collections.unmodifiableMap(requireNonNull(responseHeaders));&lt;br/&gt;
@@ -111,8 +111,8 @@ public int getRestBindPort() {&lt;br/&gt;
 	 * @return SSLEngine that the REST server endpoint should use, or null if SSL was disabled&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	public SSLEngineFactory getSslEngineFactory() {&lt;br/&gt;
-		return sslEngineFactory;&lt;br/&gt;
+	public SSLHandlerFactory getSslHandlerFactory() {+		return sslHandlerFactory; 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
@@ -155,15 +155,15 @@ public static RestServerEndpointConfiguration fromConfiguration(Configuration co&lt;br/&gt;
 		final String restBindAddress = config.getString(RestOptions.BIND_ADDRESS);&lt;br/&gt;
 		final int port = config.getInteger(RestOptions.PORT);&lt;br/&gt;
 &lt;br/&gt;
-		final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 		if (SSLUtils.isRestSSLEnabled(config)) {&lt;br/&gt;
 			try {
-				sslEngineFactory = SSLUtils.createRestServerSSLEngineFactory(config);
+				sslHandlerFactory = SSLUtils.createRestServerSSLEngineFactory(config);
 			} catch (Exception e) {
 				throw new ConfigurationException(&quot;Failed to initialize SSLEngineFactory for REST server endpoint.&quot;, e);
 			}&lt;br/&gt;
 		} else {
-			sslEngineFactory = null;
+			sslHandlerFactory = null;
 		}&lt;br/&gt;
 &lt;br/&gt;
 		final Path uploadDir = Paths.get(&lt;br/&gt;
@@ -180,7 +180,7 @@ public static RestServerEndpointConfiguration fromConfiguration(Configuration co&lt;br/&gt;
 			restAddress,&lt;br/&gt;
 			restBindAddress,&lt;br/&gt;
 			port,&lt;br/&gt;
-			sslEngineFactory,&lt;br/&gt;
+			sslHandlerFactory,&lt;br/&gt;
 			uploadDir,&lt;br/&gt;
 			maxContentLength,&lt;br/&gt;
 			responseHeaders);&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
index c1fef146a9d..6ec7a235c3f 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;br/&gt;
 &lt;br/&gt;
 package org.apache.flink.runtime.io.network.netty;&lt;br/&gt;
 &lt;br/&gt;
+import org.apache.flink.configuration.ConfigOption;&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.SecurityOptions;&lt;br/&gt;
 import org.apache.flink.runtime.io.network.netty.NettyTestUtil.NettyServerAndClient;&lt;br/&gt;
@@ -29,13 +30,22 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.string.StringDecoder;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.string.StringEncoder;&lt;br/&gt;
+import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 &lt;br/&gt;
 import org.junit.Assert;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 &lt;br/&gt;
+import javax.net.ssl.SSLSessionContext;&lt;br/&gt;
+&lt;br/&gt;
 import java.net.InetAddress;&lt;br/&gt;
 &lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_INTERNAL_HANDSHAKE_TIMEOUT;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_INTERNAL_SESSION_CACHE_SIZE;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_INTERNAL_SESSION_TIMEOUT;&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertFalse;&lt;br/&gt;
+import static org.junit.Assert.assertNotNull;&lt;br/&gt;
 import static org.junit.Assert.assertTrue;&lt;br/&gt;
 &lt;br/&gt;
 /**&lt;br/&gt;
@@ -49,21 +59,65 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testValidSslConnection() throws Exception {
+		testValidSslConnection(createSslConfig());
+	}&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Verify valid (advanced) ssl configuration and connection.&lt;br/&gt;
+	 */&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testValidSslConnectionAdvanced() throws Exception {
+		Configuration sslConfig = createSslConfig();
+		sslConfig.setInteger(SSL_INTERNAL_SESSION_CACHE_SIZE, 1);
+		sslConfig.setInteger(SSL_INTERNAL_SESSION_TIMEOUT, 1_000);
+		sslConfig.setInteger(SSL_INTERNAL_HANDSHAKE_TIMEOUT, 1_000);
+		sslConfig.setInteger(SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT, 1_000);
+
+		testValidSslConnection(sslConfig);
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private void testValidSslConnection(Configuration sslConfig) throws Exception {&lt;br/&gt;
 		NettyProtocol protocol = new NoOpProtocol();&lt;br/&gt;
 &lt;br/&gt;
-		NettyConfig nettyConfig = createNettyConfig(createSslConfig());&lt;br/&gt;
+		NettyConfig nettyConfig = createNettyConfig(sslConfig);&lt;br/&gt;
 &lt;br/&gt;
 		NettyTestUtil.NettyServerAndClient serverAndClient = NettyTestUtil.initServerAndClient(protocol, nettyConfig);&lt;br/&gt;
 &lt;br/&gt;
 		Channel ch = NettyTestUtil.connect(serverAndClient);&lt;br/&gt;
 &lt;br/&gt;
+		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_INTERNAL_HANDSHAKE_TIMEOUT, sslHandler.getHandshakeTimeoutMillis());&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT, sslHandler.getCloseNotifyFlushTimeoutMillis());&lt;br/&gt;
+&lt;br/&gt;
 		// should be able to send text data&lt;br/&gt;
 		ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());&lt;br/&gt;
 		assertTrue(ch.writeAndFlush(&quot;test&quot;).await().isSuccess());&lt;br/&gt;
 &lt;br/&gt;
+		// session context is only be available after a session was setup -&amp;gt; this should be true after data was sent&lt;br/&gt;
+		SSLSessionContext sessionContext = sslHandler.engine().getSession().getSessionContext();&lt;br/&gt;
+		assertNotNull(&quot;bug in unit test setup: session context not available&quot;, sessionContext);&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_INTERNAL_SESSION_CACHE_SIZE, sessionContext.getSessionCacheSize());&lt;br/&gt;
+		int sessionTimeout = sslConfig.getInteger(SSL_INTERNAL_SESSION_TIMEOUT);&lt;br/&gt;
+		if (sessionTimeout != -1) {
+			// session timeout config is in milliseconds but the context returns it in seconds
+			assertEquals(sessionTimeout / 1000, sessionContext.getSessionTimeout());
+		} else {
+			assertTrue(&quot;default value (-1) should not be propagated&quot;, sessionContext.getSessionTimeout() &amp;gt;= 0);
+		}&lt;br/&gt;
+&lt;br/&gt;
 		NettyTestUtil.shutdown(serverAndClient);&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
+	private static void assertEqualsOrDefault(Configuration sslConfig, ConfigOption&amp;lt;Integer&amp;gt; option, long actual) {&lt;br/&gt;
+		long expected = sslConfig.getInteger(option);&lt;br/&gt;
+		if (expected != option.defaultValue()) {
+			assertEquals(expected, actual);
+		} else {
+			assertTrue(&quot;default value (&quot; + option.defaultValue() + &quot;) should not be propagated&quot;,
+				actual &amp;gt;= 0);
+		}&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
 	/**&lt;br/&gt;
 	 * Verify failure on invalid ssl configuration.&lt;br/&gt;
 	 */&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
index 9610e98b101..5031accb1a9 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
@@ -21,11 +21,13 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.IllegalConfigurationException;&lt;br/&gt;
 import org.apache.flink.configuration.SecurityOptions;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.util.TestLogger;&lt;br/&gt;
 &lt;br/&gt;
+import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
+&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 &lt;br/&gt;
-import javax.net.ssl.SSLEngine;&lt;br/&gt;
 import javax.net.ssl.SSLServerSocket;&lt;br/&gt;
 &lt;br/&gt;
 import java.net.ServerSocket;&lt;br/&gt;
@@ -124,7 +126,7 @@ public void testSocketFactoriesWhenSslDisabled() throws Exception {&lt;br/&gt;
 	public void testRESTClientSSL() throws Exception {
 		Configuration clientConfig = createRestSslConfigWithTrustStore();
 
-		SSLEngineFactory ssl = SSLUtils.createRestClientSSLEngineFactory(clientConfig);
+		SSLHandlerFactory ssl = SSLUtils.createRestClientSSLEngineFactory(clientConfig);
 		assertNotNull(ssl);
 	}&lt;br/&gt;
 &lt;br/&gt;
@@ -195,7 +197,7 @@ public void testRESTClientSSLWrongPassword() throws Exception {&lt;br/&gt;
 	public void testRESTServerSSL() throws Exception {
 		Configuration serverConfig = createRestSslConfigWithKeyStore();
 
-		SSLEngineFactory ssl = SSLUtils.createRestServerSSLEngineFactory(serverConfig);
+		SSLHandlerFactory ssl = SSLUtils.createRestServerSSLEngineFactory(serverConfig);
 		assertNotNull(ssl);
 	}&lt;br/&gt;
 &lt;br/&gt;
@@ -373,7 +375,7 @@ public void testSetSSLVersionAndCipherSuitesForSSLServerSocket() throws Exceptio&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
-	 * Tests that {@link SSLEngineFactory} is created correctly.&lt;br/&gt;
+	 * Tests that {@link SSLHandlerFactory}
&lt;p&gt; is created correctly.&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testCreateSSLEngineFactory() throws Exception {&lt;br/&gt;
@@ -383,14 +385,14 @@ public void testCreateSSLEngineFactory() throws Exception &lt;/p&gt;
{
 		serverConfig.setString(SecurityOptions.SSL_PROTOCOL, &quot;TLSv1&quot;);
 		serverConfig.setString(SecurityOptions.SSL_ALGORITHMS, &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;);
 
-		final SSLEngineFactory serverSSLEngineFactory = SSLUtils.createInternalServerSSLEngineFactory(serverConfig);
-		final SSLEngine sslEngine = serverSSLEngineFactory.createSSLEngine();
+		final SSLHandlerFactory serverSSLHandlerFactory = SSLUtils.createInternalServerSSLEngineFactory(serverConfig);
+		final SslHandler sslHandler = serverSSLHandlerFactory.createNettySSLHandler();
 
-		assertEquals(1, sslEngine.getEnabledProtocols().length);
-		assertEquals(&quot;TLSv1&quot;, sslEngine.getEnabledProtocols()[0]);
+		assertEquals(1, sslHandler.engine().getEnabledProtocols().length);
+		assertEquals(&quot;TLSv1&quot;, sslHandler.engine().getEnabledProtocols()[0]);
 
-		assertEquals(2, sslEngine.getEnabledCipherSuites().length);
-		assertThat(sslEngine.getEnabledCipherSuites(), arrayContainingInAnyOrder(
+		assertEquals(2, sslHandler.engine().getEnabledCipherSuites().length);
+		assertThat(sslHandler.engine().getEnabledCipherSuites(), arrayContainingInAnyOrder(
 				&quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA&quot;, &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;));
 	}&lt;/li&gt;
&lt;/ul&gt;






&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16660287" author="githubbot" created="Tue, 23 Oct 2018 08:48:50 +0000"  >&lt;p&gt;NicoK closed pull request #6838: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9878&quot; title=&quot;IO worker threads BLOCKED on SSL Session Cache while CMS full gc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9878&quot;&gt;&lt;del&gt;FLINK-9878&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;network&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl&amp;#93;&lt;/span&gt; add more low-level ssl options&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6838&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6838&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/docs/_includes/generated/security_configuration.html b/docs/_includes/generated/security_configuration.html&lt;br/&gt;
index 680c1c02434..8999336926f 100644&lt;br/&gt;
&amp;#8212; a/docs/_includes/generated/security_configuration.html&lt;br/&gt;
+++ b/docs/_includes/generated/security_configuration.html&lt;br/&gt;
@@ -12,11 +12,21 @@&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;&quot;TLS_RSA_WITH_AES_128_CBC_SHA&quot;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;The comma separated list of standard SSL algorithms to be supported. Read more &amp;lt;a href=&quot;http://docs.oracle.com/javase/8/docs/technotes/guides/security/StandardNames.html#ciphersuites&quot;&amp;gt;here&amp;lt;/a&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.close-notify-flush-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a channel. If the `close_notify` was not flushed in the given timeout the channel will be closed forcibly. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.enabled&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;false&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;Turns on SSL for internal network communication. Optionally, specific components may override this through their own settings (rpc, data transport, REST, etc).&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.handshake-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) during SSL handshake. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.key-password&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;(none)&amp;lt;/td&amp;gt;&lt;br/&gt;
@@ -32,6 +42,16 @@&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;(none)&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;The secret to decrypt the keystore file for Flink&apos;s for Flink&apos;s internal endpoints (rpc, data transport, blob server).&amp;lt;/td&amp;gt;&lt;br/&gt;
         &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.session-cache-size&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The size of the cache used for storing SSL session objects. According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set this to an appropriate number to not run into a bug with stalling IO threads during garbage collection. (-1 = use system default).&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
+        &amp;lt;tr&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.session-timeout&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;-1&amp;lt;/td&amp;gt;&lt;br/&gt;
+            &amp;lt;td&amp;gt;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&amp;lt;/td&amp;gt;&lt;br/&gt;
+        &amp;lt;/tr&amp;gt;&lt;br/&gt;
         &amp;lt;tr&amp;gt;&lt;br/&gt;
             &amp;lt;td&amp;gt;&amp;lt;h5&amp;gt;security.ssl.internal.truststore&amp;lt;/h5&amp;gt;&amp;lt;/td&amp;gt;&lt;br/&gt;
             &amp;lt;td style=&quot;word-wrap: break-word;&quot;&amp;gt;(none)&amp;lt;/td&amp;gt;&lt;br/&gt;
diff --git a/docs/ops/security-ssl.md b/docs/ops/security-ssl.md&lt;br/&gt;
index 6ea686203ee..4e3716218d2 100644&lt;br/&gt;
&amp;#8212; a/docs/ops/security-ssl.md&lt;br/&gt;
+++ b/docs/ops/security-ssl.md&lt;br/&gt;
@@ -22,6 +22,9 @@ specific language governing permissions and limitations&lt;br/&gt;
 under the License.&lt;br/&gt;
 --&amp;gt;&lt;/p&gt;

&lt;p&gt;+* ToC&lt;br/&gt;
+{:toc}&lt;br/&gt;
+&lt;br/&gt;
 This page provides instructions on how to enable TLS/SSL authentication and encryption for network communication with and between Flink processes.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Internal and External Connectivity&lt;br/&gt;
@@ -37,7 +40,7 @@ For more flexibility, security for internal and external connectivity can be ena&lt;br/&gt;
   &amp;lt;img src=&quot;{{ site.baseurl }}/fig/ssl_internal_external.svg&quot; alt=&quot;Internal and External Connectivity&quot; style=&quot;width:75%; padding-top:10px; padding-bottom:10px;&quot; /&amp;gt;&lt;br/&gt;
 &amp;lt;/div&amp;gt;&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;
			&lt;ol&gt;
				&lt;li&gt;
				&lt;ol&gt;
					&lt;li&gt;Internal Connectivity&lt;br/&gt;
+### Internal Connectivity&lt;/li&gt;
				&lt;/ol&gt;
				&lt;/li&gt;
			&lt;/ol&gt;
			&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Internal connectivity includes:&lt;/p&gt;

&lt;p&gt;@@ -54,7 +57,7 @@ is not needed by any other party to interact with Flink, and can be simply added&lt;/p&gt;

&lt;p&gt; &lt;b&gt;Note: Because internal connections are mutually authenticated with shared certificates, Flink can skip hostname verification. This makes container-based setups easier.&lt;/b&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;
			&lt;ol&gt;
				&lt;li&gt;
				&lt;ol&gt;
					&lt;li&gt;External / REST Connectivity&lt;br/&gt;
+### External / REST Connectivity&lt;/li&gt;
				&lt;/ol&gt;
				&lt;/li&gt;
			&lt;/ol&gt;
			&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; All external connectivity is exposed via an HTTP/REST endpoint, used for example by the web UI and the CLI:&lt;/p&gt;

&lt;p&gt;@@ -71,7 +74,7 @@ Examples for proxies that Flink users have deployed are &lt;span class=&quot;error&quot;&gt;&amp;#91;Envoy Proxy&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://ww&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ww&lt;/a&gt;&lt;br/&gt;
 The rationale behind delegating authentication to a proxy is that such proxies offer a wide variety of authentication options and thus better integration into existing infrastructures.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;
			&lt;ol&gt;
				&lt;li&gt;
				&lt;ol&gt;
					&lt;li&gt;Queryable State&lt;br/&gt;
+### Queryable State&lt;/li&gt;
				&lt;/ol&gt;
				&lt;/li&gt;
			&lt;/ol&gt;
			&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Connections to the queryable state endpoints is currently not authenticated or encrypted.&lt;/p&gt;

&lt;p&gt;@@ -92,13 +95,13 @@ When `security.ssl.internal.enabled` is set to `true`, you can set the following&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`blob.service.ssl.enabled`: Transport of BLOBs from JobManager to TaskManager&lt;/li&gt;
	&lt;li&gt;`akka.ssl.enabled`: Akka-based RPC connections between JobManager / TaskManager / ResourceManager&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;
			&lt;ol&gt;
				&lt;li&gt;
				&lt;ol&gt;
					&lt;li&gt;Keystores and Truststores&lt;br/&gt;
+### Keystores and Truststores&lt;/li&gt;
				&lt;/ol&gt;
				&lt;/li&gt;
			&lt;/ol&gt;
			&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; The SSL configuration requires to configure a *&lt;b&gt;keystore&lt;/b&gt;* and a *&lt;b&gt;truststore&lt;/b&gt;&lt;b&gt;. The *keystore&lt;/b&gt; contains the public certificate&lt;br/&gt;
 (public key) and the private key, while the truststore contains the trusted certificates or the trusted authorities. Both stores&lt;br/&gt;
 need to be set up such that the truststore trusts the keystore&apos;s certificate.&lt;/p&gt;

&lt;p&gt;-*&lt;b&gt;Internal Connectivity&lt;/b&gt;*&lt;br/&gt;
+#### Internal Connectivity&lt;/p&gt;

&lt;p&gt; Because internal communication is mutually authenticated, keystore and truststore typically contain the same dedicated certificate.&lt;br/&gt;
 The certificate can use wild card hostnames or addresses, because the certificate is expected to be a shared secret and host&lt;br/&gt;
@@ -112,7 +115,7 @@ security.ssl.internal.truststore: /path/to/file.truststore&lt;br/&gt;
 security.ssl.internal.truststore-password: truststore_password&lt;/p&gt;
 {% endhighlight %}&lt;br/&gt;
 &lt;br/&gt;
-*&lt;b&gt;REST Endpoints (external connectivity)&lt;/b&gt;*&lt;br/&gt;
+#### REST Endpoints (external connectivity)&lt;br/&gt;
 &lt;br/&gt;
 For REST endpoints, by default the keystore is used by the server endpoint, and the truststore is used by the REST clients (including the CLI client)&lt;br/&gt;
 to accept the server&apos;s certificate. In the case where the REST keystore has a self-signed certificate, the truststore must trust that certificate directly.&lt;br/&gt;
@@ -130,8 +133,9 @@ security.ssl.rest.truststore-password: truststore_password&lt;br/&gt;
 security.ssl.rest.authentication-enabled: false&lt;br/&gt;
 {% endhighlight %}

&lt;p&gt;-*&lt;b&gt;IMPORTANT&lt;/b&gt;*&lt;br/&gt;
+### Cipher suites&lt;/p&gt;

&lt;p&gt;+&amp;lt;span class=&quot;label label-danger&quot;&amp;gt;IMPORTANT&amp;lt;/span&amp;gt;&lt;br/&gt;
 The &lt;span class=&quot;error&quot;&gt;&amp;#91;IETF RFC 7525&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://tools.ietf.org/html/rfc7525&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://tools.ietf.org/html/rfc7525&lt;/a&gt;) recommends to use a specific set of cipher suites for strong security.&lt;br/&gt;
 Because these cipher suites were not available on many setups out of the box, Flink&apos;s default value is set to a slightly&lt;br/&gt;
 weaker but more compatible cipher suite.&lt;br/&gt;
@@ -143,6 +147,9 @@ security.ssl.algorithms: TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_&lt;/p&gt;

&lt;p&gt; If these cipher suites are not supported on your setup, you will see that Flink processes will not be able to connect to each other.&lt;/p&gt;

&lt;p&gt;+### Complete List of SSL Options&lt;br/&gt;
+&lt;br/&gt;
+&lt;/p&gt;
{% include generated/security_configuration.html %}

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Creating and Deploying Keystores and Truststores&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;diff --git a/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java b/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
index be413cb7264..87ab1713215 100644&lt;br/&gt;
&amp;#8212; a/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
+++ b/flink-core/src/main/java/org/apache/flink/configuration/SecurityOptions.java&lt;br/&gt;
@@ -298,4 +298,47 @@&lt;br/&gt;
 		key(&quot;security.ssl.verify-hostname&quot;)&lt;br/&gt;
 			.defaultValue(true)&lt;br/&gt;
 			.withDescription(&quot;Flag to enable peer&#8217;s hostname verification during ssl handshake.&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	// ------------------------ ssl parameters --------------------------------&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session cache size.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_INTERNAL_SESSION_CACHE_SIZE =&lt;br/&gt;
+		key(&quot;security.ssl.internal.session-cache-size&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The size of the cache used for storing SSL session objects. &quot;&lt;br/&gt;
+				+ &quot;According to &lt;a href=&quot;https://github.com/netty/netty/issues/832&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/netty/netty/issues/832&lt;/a&gt;, you should always set &quot;&lt;br/&gt;
+				+ &quot;this to an appropriate number to not run into a bug with stalling IO threads &quot;&lt;br/&gt;
+				+ &quot;during garbage collection. (-1 = use system default).&quot;)&lt;br/&gt;
+		.withDeprecatedKeys(&quot;security.ssl.session-cache-size&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_INTERNAL_SESSION_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.internal.session-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) for the cached SSL session objects. (-1 = use system default)&quot;)&lt;br/&gt;
+			.withDeprecatedKeys(&quot;security.ssl.session-timeout&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout during handshakes.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_INTERNAL_HANDSHAKE_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.internal.handshake-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) during SSL handshake. (-1 = use system default)&quot;)&lt;br/&gt;
+			.withDeprecatedKeys(&quot;security.ssl.handshake-timeout&quot;);&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * SSL session timeout after flushing the &amp;lt;tt&amp;gt;close_notify&amp;lt;/tt&amp;gt; message.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final ConfigOption&amp;lt;Integer&amp;gt; SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT =&lt;br/&gt;
+		key(&quot;security.ssl.internal.close-notify-flush-timeout&quot;)&lt;br/&gt;
+			.defaultValue(-1)&lt;br/&gt;
+			.withDescription(&quot;The timeout (in ms) for flushing the `close_notify` that was triggered by closing a &quot; +&lt;br/&gt;
+				&quot;channel. If the `close_notify` was not flushed in the given timeout the channel will be closed &quot; +&lt;br/&gt;
+				&quot;forcibly. (-1 = use system default)&quot;)&lt;br/&gt;
+			.withDeprecatedKeys(&quot;security.ssl.close-notify-flush-timeout&quot;);&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java b/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
index 1fa2cd0ec5c..89a32f19caf 100644&lt;br/&gt;
&amp;#8212; a/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/util/MesosArtifactServer.java&lt;br/&gt;
@@ -24,7 +24,7 @@&lt;br/&gt;
 import org.apache.flink.core.fs.FileSystem;&lt;br/&gt;
 import org.apache.flink.core.fs.Path;&lt;br/&gt;
 import org.apache.flink.mesos.configuration.MesosOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.RoutedRequest;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.Router;&lt;br/&gt;
@@ -51,7 +51,6 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.HttpResponseStatus;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.HttpServerCodec;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.LastHttpContent;&lt;br/&gt;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedStream;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedWriteHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.util.CharsetUtil;&lt;br/&gt;
@@ -59,8 +58,6 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt;-import javax.net.ssl.SSLEngine;&lt;br/&gt;
-&lt;br/&gt;
 import java.io.File;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
 import java.net.InetSocketAddress;&lt;br/&gt;
@@ -115,7 +112,7 @@ public MesosArtifactServer(String prefix, String serverHostname, int configuredP&lt;br/&gt;
 				MesosOptions.ARTIFACT_SERVER_SSL_ENABLED) &amp;amp;&amp;amp;&lt;br/&gt;
 				SSLUtils.isRestSSLEnabled(config);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final SSLEngineFactory sslFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslFactory;&lt;br/&gt;
 		if (enableSSL) {&lt;br/&gt;
 			LOG.info(&quot;Enabling ssl for the artifact server&quot;);&lt;br/&gt;
 			try {&lt;br/&gt;
@@ -138,8 +135,7 @@ protected void initChannel(SocketChannel ch) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				// SSL should be the first handler in the pipeline&lt;br/&gt;
 				if (sslFactory != null) &lt;/p&gt;
{
-					SSLEngine sslEngine = sslFactory.createSSLEngine();
-					ch.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));
+					ch.pipeline().addLast(&quot;ssl&quot;, sslFactory.createNettySSLHandler());
 				}

&lt;p&gt; 				ch.pipeline()&lt;br/&gt;
diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
index 39c8a3c0d03..0f067c0e2c3 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/WebRuntimeMonitor.java&lt;br/&gt;
@@ -23,10 +23,10 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.WebOptions;&lt;br/&gt;
 import org.apache.flink.runtime.concurrent.ScheduledExecutor;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.jobmanager.MemoryArchivist;&lt;br/&gt;
 import org.apache.flink.runtime.jobmaster.JobManagerGateway;&lt;br/&gt;
 import org.apache.flink.runtime.leaderretrieval.LeaderRetrievalService;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.WebHandler;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.job.checkpoints.CheckpointStatsCache;&lt;br/&gt;
@@ -231,7 +231,7 @@ public WebRuntimeMonitor(&lt;br/&gt;
 		// --------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt; 		// Config to enable https access to the web-ui&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final SSLEngineFactory sslFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslFactory;&lt;br/&gt;
 		final boolean enableSSL = SSLUtils.isRestSSLEnabled(config) &amp;amp;&amp;amp; config.getBoolean(WebOptions.SSL_ENABLED);&lt;br/&gt;
 		if (enableSSL) {&lt;br/&gt;
 			LOG.info(&quot;Enabling ssl for the web frontend&quot;);&lt;br/&gt;
diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
index 08914265591..5d65d64afa8 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/history/HistoryServer.java&lt;br/&gt;
@@ -26,7 +26,7 @@&lt;br/&gt;
 import org.apache.flink.core.fs.FileSystem;&lt;br/&gt;
 import org.apache.flink.core.fs.Path;&lt;br/&gt;
 import org.apache.flink.runtime.history.FsJobArchivist;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.legacy.DashboardConfigHandler;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.Router;&lt;br/&gt;
@@ -43,6 +43,8 @@&lt;br/&gt;
 import org.slf4j.Logger;&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+import javax.annotation.Nullable;&lt;br/&gt;
+&lt;br/&gt;
 import java.io.File;&lt;br/&gt;
 import java.io.FileWriter;&lt;br/&gt;
 import java.io.IOException;&lt;br/&gt;
@@ -88,7 +90,8 @@&lt;/p&gt;

&lt;p&gt; 	private final HistoryServerArchiveFetcher archiveFetcher;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private final SSLEngineFactory serverSSLFactory;&lt;br/&gt;
+	@Nullable&lt;br/&gt;
+	private final SSLHandlerFactory serverSSLFactory;&lt;br/&gt;
 	private WebFrontendBootstrap netty;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private final Object startupShutdownLock = new Object();&lt;br/&gt;
diff --git a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
index 672fddb3eec..cf30fac156c 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
+++ b/flink-runtime-web/src/main/java/org/apache/flink/runtime/webmonitor/utils/WebFrontendBootstrap.java&lt;br/&gt;
@@ -20,7 +20,7 @@&lt;/p&gt;

&lt;p&gt; import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.JobManagerOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.Router;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.RouterHandler;&lt;br/&gt;
 import org.apache.flink.runtime.webmonitor.HttpRequestHandler;&lt;br/&gt;
@@ -35,13 +35,11 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.SocketChannel;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.nio.NioServerSocketChannel;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.HttpServerCodec;&lt;br/&gt;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedWriteHandler;&lt;/p&gt;

&lt;p&gt; import org.slf4j.Logger;&lt;/p&gt;

&lt;p&gt; import javax.annotation.Nullable;&lt;br/&gt;
-import javax.net.ssl.SSLEngine;&lt;/p&gt;

&lt;p&gt; import java.io.File;&lt;br/&gt;
 import java.net.InetAddress;&lt;br/&gt;
@@ -64,7 +62,7 @@ public WebFrontendBootstrap(&lt;br/&gt;
 			Router router,&lt;br/&gt;
 			Logger log,&lt;br/&gt;
 			File directory,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Nullable SSLEngineFactory serverSSLFactory,&lt;br/&gt;
+			@Nullable SSLHandlerFactory serverSSLFactory,&lt;br/&gt;
 			String configuredAddress,&lt;br/&gt;
 			int configuredPort,&lt;br/&gt;
 			final Configuration config) throws InterruptedException, UnknownHostException {&lt;br/&gt;
@@ -81,8 +79,7 @@ protected void initChannel(SocketChannel ch) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				// SSL should be the first handler in the pipeline&lt;br/&gt;
 				if (serverSSLFactory != null) &lt;/p&gt;
{
-					SSLEngine sslEngine = serverSSLFactory.createSSLEngine();
-					ch.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));
+					ch.pipeline().addLast(&quot;ssl&quot;, serverSSLFactory.createNettySSLHandler());
 				}

&lt;p&gt; 				ch.pipeline()&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
index ab999d4de8d..d7cad7fcd8e 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyClient.java&lt;br/&gt;
@@ -18,8 +18,6 @@&lt;/p&gt;

&lt;p&gt; package org.apache.flink.runtime.io.network.netty;&lt;/p&gt;

&lt;p&gt;-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
-&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.bootstrap.Bootstrap;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelException;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelFuture;&lt;br/&gt;
@@ -37,7 +35,6 @@&lt;br/&gt;
 import org.slf4j.LoggerFactory;&lt;/p&gt;

&lt;p&gt; import javax.annotation.Nullable;&lt;br/&gt;
-import javax.net.ssl.SSLEngine;&lt;/p&gt;

&lt;p&gt; import java.io.IOException;&lt;br/&gt;
 import java.net.InetSocketAddress;&lt;br/&gt;
@@ -55,7 +52,7 @@&lt;br/&gt;
 	private Bootstrap bootstrap;&lt;/p&gt;

&lt;p&gt; 	@Nullable&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private SSLEngineFactory clientSSLFactory;&lt;br/&gt;
+	private SSLHandlerFactory clientSSLFactory;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	NettyClient(NettyConfig config) {&lt;br/&gt;
 		this.config = config;&lt;br/&gt;
@@ -181,11 +178,10 @@ public void initChannel(SocketChannel channel) throws Exception {&lt;/p&gt;

&lt;p&gt; 				// SSL handler should be added first in the pipeline&lt;br/&gt;
 				if (clientSSLFactory != null) &lt;/p&gt;
{
-					SSLEngine sslEngine = clientSSLFactory.createSSLEngine(
-						serverSocketAddress.getAddress().getCanonicalHostName(),
-						serverSocketAddress.getPort());
-
-					channel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));
+					SslHandler sslHandler = clientSSLFactory.createNettySSLHandler(
+							serverSocketAddress.getAddress().getCanonicalHostName(),
+							serverSocketAddress.getPort());
+					channel.pipeline().addLast(&quot;ssl&quot;, sslHandler);
 				}
&lt;p&gt; 				channel.pipeline().addLast(protocol.getClientChannelHandlers());&lt;br/&gt;
 			}&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
index 59971e1c5c1..4694c69385c 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyConfig.java&lt;br/&gt;
@@ -22,7 +22,6 @@&lt;br/&gt;
 import org.apache.flink.configuration.ConfigOptions;&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.TaskManagerOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;/p&gt;

&lt;p&gt; import org.slf4j.Logger;&lt;br/&gt;
@@ -191,14 +190,14 @@ public TransportType getTransportType() {&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	@Nullable&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngineFactory createClientSSLEngineFactory() throws Exception {&lt;br/&gt;
+	public SSLHandlerFactory createClientSSLEngineFactory() throws Exception 
{
 		return getSSLEnabled() ?
 				SSLUtils.createInternalClientSSLEngineFactory(config) :
 				null;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Nullable&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngineFactory createServerSSLEngineFactory() throws Exception {&lt;br/&gt;
+	public SSLHandlerFactory createServerSSLEngineFactory() throws Exception 
{
 		return getSSLEnabled() ?
 				SSLUtils.createInternalServerSSLEngineFactory(config) :
 				null;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java
index cc260c6ed9b..f818ff64016 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/NettyServer.java
@@ -18,7 +18,6 @@
 
 package org.apache.flink.runtime.io.network.netty;
 
-import org.apache.flink.runtime.net.SSLEngineFactory;
 import org.apache.flink.runtime.util.FatalExitExceptionHandler;
 
 import org.apache.flink.shaded.guava18.com.google.common.util.concurrent.ThreadFactoryBuilder;
@@ -32,13 +31,10 @@
 import org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoopGroup;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.SocketChannel;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.nio.NioServerSocketChannel;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;
 
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
-import javax.net.ssl.SSLEngine;
-
 import java.io.IOException;
 import java.net.InetSocketAddress;
 import java.util.concurrent.ThreadFactory;
@@ -136,9 +132,9 @@ void init(final NettyProtocol protocol, NettyBufferPool nettyBufferPool) throws
 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		// SSL related configuration&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 		try 
{
-			sslEngineFactory = config.createServerSSLEngineFactory();
+			sslHandlerFactory = config.createServerSSLEngineFactory();
 		}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
 			throw new IOException(&quot;Failed to initialize SSL Context for the Netty Server&quot;, e);
 		}
&lt;p&gt;@@ -150,9 +146,8 @@ void init(final NettyProtocol protocol, NettyBufferPool nettyBufferPool) throws&lt;br/&gt;
 		bootstrap.childHandler(new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {&lt;br/&gt;
 			@Override&lt;br/&gt;
 			public void initChannel(SocketChannel channel) throws Exception {&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if (sslEngineFactory != null) {&lt;/li&gt;
	&lt;li&gt;SSLEngine sslEngine = sslEngineFactory.createSSLEngine();&lt;/li&gt;
	&lt;li&gt;channel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngine));&lt;br/&gt;
+				if (sslHandlerFactory != null) 
{
+					channel.pipeline().addLast(&quot;ssl&quot;, sslHandlerFactory.createNettySSLHandler());
 				}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				channel.pipeline().addLast(protocol.getServerChannelHandlers());&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLEngineFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/SSLHandlerFactory.java&lt;br/&gt;
similarity index 57%&lt;br/&gt;
rename from flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLEngineFactory.java&lt;br/&gt;
rename to flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/SSLHandlerFactory.java&lt;br/&gt;
index 68f60b81ace..66d9466122f 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLEngineFactory.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/io/network/netty/SSLHandlerFactory.java&lt;br/&gt;
@@ -16,7 +16,9 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;limitations under the License.&lt;br/&gt;
  */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-package org.apache.flink.runtime.net;&lt;br/&gt;
+package org.apache.flink.runtime.io.network.netty;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;/p&gt;

&lt;p&gt; import javax.net.ssl.SSLContext;&lt;br/&gt;
 import javax.net.ssl.SSLEngine;&lt;br/&gt;
@@ -24,9 +26,9 @@&lt;br/&gt;
 import static java.util.Objects.requireNonNull;&lt;/p&gt;

&lt;p&gt; /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates and configures 
{@link SSLEngine}
&lt;p&gt; instances.&lt;br/&gt;
+ * Creates and configures &lt;/p&gt;
{@link SslHandler}
&lt;p&gt; instances.&lt;br/&gt;
  */&lt;br/&gt;
-public class SSLEngineFactory {&lt;br/&gt;
+public class SSLHandlerFactory {&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	private final SSLContext sslContext;&lt;/p&gt;

&lt;p&gt;@@ -36,29 +38,66 @@&lt;/p&gt;

&lt;p&gt; 	private final boolean clientMode;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final boolean clientAuthentication;&lt;br/&gt;
+	private final boolean clientAuthentication;&lt;br/&gt;
+&lt;br/&gt;
+	private final int handshakeTimeoutMs;&lt;br/&gt;
+&lt;br/&gt;
+	private final int closeNotifyFlushTimeoutMs;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngineFactory(&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Create a new SSLEngine factory.&lt;br/&gt;
+	 *&lt;br/&gt;
+	 * @param handshakeTimeoutMs&lt;br/&gt;
+	 * 		SSL session timeout during handshakes (-1 = use system default)&lt;br/&gt;
+	 * @param closeNotifyFlushTimeoutMs&lt;br/&gt;
+	 * 		SSL session timeout after flushing the &amp;lt;tt&amp;gt;close_notify&amp;lt;/tt&amp;gt; message (-1 = use system&lt;br/&gt;
+	 * 		default)&lt;br/&gt;
+	 */&lt;br/&gt;
+	public SSLHandlerFactory(&lt;br/&gt;
 			final SSLContext sslContext,&lt;br/&gt;
 			final String[] enabledProtocols,&lt;br/&gt;
 			final String[] enabledCipherSuites,&lt;br/&gt;
 			final boolean clientMode,&lt;/li&gt;
	&lt;li&gt;final boolean clientAuthentication) {&lt;br/&gt;
+			final boolean clientAuthentication,&lt;br/&gt;
+			final int handshakeTimeoutMs,&lt;br/&gt;
+			final int closeNotifyFlushTimeoutMs) 
{
 
 		this.sslContext = requireNonNull(sslContext, &quot;sslContext must not be null&quot;);
 		this.enabledProtocols = requireNonNull(enabledProtocols, &quot;enabledProtocols must not be null&quot;);
 		this.enabledCipherSuites = requireNonNull(enabledCipherSuites, &quot;cipherSuites must not be null&quot;);
 		this.clientMode = clientMode;
 		this.clientAuthentication = clientAuthentication;
+		this.handshakeTimeoutMs = handshakeTimeoutMs;
+		this.closeNotifyFlushTimeoutMs = closeNotifyFlushTimeoutMs;
+	}
&lt;p&gt;+&lt;br/&gt;
+	public SslHandler createNettySSLHandler() &lt;/p&gt;
{
+		return createNettySSLHandler(createSSLEngine());
+	}
&lt;p&gt;+&lt;br/&gt;
+	public SslHandler createNettySSLHandler(String hostname, int port) &lt;/p&gt;
{
+		return createNettySSLHandler(createSSLEngine(hostname, port));
+	}
&lt;p&gt;+&lt;br/&gt;
+	private SslHandler createNettySSLHandler(SSLEngine sslEngine) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+		SslHandler sslHandler = new SslHandler(sslEngine);+		if (handshakeTimeoutMs &amp;gt;= 0) {
+			sslHandler.setHandshakeTimeoutMillis(handshakeTimeoutMs);
+		}+		if (closeNotifyFlushTimeoutMs &amp;gt;= 0) {
+			sslHandler.setCloseNotifyFlushTimeoutMillis(closeNotifyFlushTimeoutMs);
+		}++		return sslHandler; 	}&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngine createSSLEngine() {&lt;br/&gt;
+	private SSLEngine createSSLEngine() 
{
 		final SSLEngine sslEngine = sslContext.createSSLEngine();
 		configureSSLEngine(sslEngine);
 		return sslEngine;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public SSLEngine createSSLEngine(String hostname, int port) {&lt;br/&gt;
+	private SSLEngine createSSLEngine(String hostname, int port) {&lt;br/&gt;
 		final SSLEngine sslEngine = sslContext.createSSLEngine(hostname, port);&lt;br/&gt;
 		configureSSLEngine(sslEngine);&lt;br/&gt;
 		return sslEngine;&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java b/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
index e0b208d4b8d..c756fabbd0c 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/net/SSLUtils.java&lt;br/&gt;
@@ -22,6 +22,7 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.IllegalConfigurationException;&lt;br/&gt;
 import org.apache.flink.configuration.SecurityOptions;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; import javax.annotation.Nullable;&lt;br/&gt;
 import javax.net.ServerSocketFactory;&lt;br/&gt;
@@ -109,73 +110,81 @@ public static SocketFactory createSSLClientSocketFactory(Configuration config) t&lt;br/&gt;
 	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Creates a SSLEngineFactory to be used by internal communication server endpoints.&lt;br/&gt;
 	 */&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public static SSLEngineFactory createInternalServerSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
+	public static SSLHandlerFactory createInternalServerSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
 		SSLContext sslContext = createInternalSSLContext(config);&lt;br/&gt;
 		if (sslContext == null) 
{
 			throw new IllegalConfigurationException(&quot;SSL is not enabled for internal communication.&quot;);
 		}&lt;br/&gt;
 &lt;br/&gt;
-		return new SSLEngineFactory(&lt;br/&gt;
+		return new SSLHandlerFactory(&lt;br/&gt;
 				sslContext,&lt;br/&gt;
 				getEnabledProtocols(config),&lt;br/&gt;
 				getEnabledCipherSuites(config),&lt;br/&gt;
 				false,&lt;br/&gt;
-				true);&lt;br/&gt;
+				true,&lt;br/&gt;
+				config.getInteger(SecurityOptions.SSL_INTERNAL_HANDSHAKE_TIMEOUT),&lt;br/&gt;
+				config.getInteger(SecurityOptions.SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT));&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
 	 * Creates a SSLEngineFactory to be used by internal communication client endpoints.&lt;br/&gt;
 	 */&lt;br/&gt;
-	public static SSLEngineFactory createInternalClientSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
+	public static SSLHandlerFactory createInternalClientSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
 		SSLContext sslContext = createInternalSSLContext(config);&lt;br/&gt;
 		if (sslContext == null) { 			throw new IllegalConfigurationException(&quot;SSL is not enabled for internal communication.&quot;); 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return new SSLEngineFactory(&lt;br/&gt;
+		return new SSLHandlerFactory(&lt;br/&gt;
 				sslContext,&lt;br/&gt;
 				getEnabledProtocols(config),&lt;br/&gt;
 				getEnabledCipherSuites(config),&lt;br/&gt;
 				true,&lt;/li&gt;
	&lt;li&gt;true);&lt;br/&gt;
+				true,&lt;br/&gt;
+				config.getInteger(SecurityOptions.SSL_INTERNAL_HANDSHAKE_TIMEOUT),&lt;br/&gt;
+				config.getInteger(SecurityOptions.SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT));&lt;br/&gt;
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Creates a 
{@link SSLEngineFactory} to be used by the REST Servers.&lt;br/&gt;
+	 * Creates a {@link SSLHandlerFactory} to be used by the REST Servers.&lt;br/&gt;
 	 *&lt;br/&gt;
 	 * @param config The application configuration.&lt;br/&gt;
 	 */&lt;br/&gt;
-	public static SSLEngineFactory createRestServerSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
+	public static SSLHandlerFactory createRestServerSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
 		SSLContext sslContext = createRestServerSSLContext(config);&lt;br/&gt;
 		if (sslContext == null) {
 			throw new IllegalConfigurationException(&quot;SSL is not enabled for REST endpoints.&quot;);
 		}&lt;br/&gt;
 &lt;br/&gt;
-		return new SSLEngineFactory(&lt;br/&gt;
+		return new SSLHandlerFactory(&lt;br/&gt;
 				sslContext,&lt;br/&gt;
 				getEnabledProtocols(config),&lt;br/&gt;
 				getEnabledCipherSuites(config),&lt;br/&gt;
 				false,&lt;br/&gt;
-				isRestSSLAuthenticationEnabled(config));&lt;br/&gt;
+				isRestSSLAuthenticationEnabled(config),&lt;br/&gt;
+				-1,&lt;br/&gt;
+				-1);&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
-	 * Creates a {@link SSLEngineFactory}
&lt;p&gt; to be used by the REST Clients.&lt;br/&gt;
+	 * Creates a &lt;/p&gt;
{@link SSLHandlerFactory} to be used by the REST Clients.&lt;br/&gt;
 	 *&lt;br/&gt;
 	 * @param config The application configuration.&lt;br/&gt;
 	 */&lt;br/&gt;
-	public static SSLEngineFactory createRestClientSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
+	public static SSLHandlerFactory createRestClientSSLEngineFactory(final Configuration config) throws Exception {&lt;br/&gt;
 		SSLContext sslContext = createRestClientSSLContext(config);&lt;br/&gt;
 		if (sslContext == null) {
 			throw new IllegalConfigurationException(&quot;SSL is not enabled for REST endpoints.&quot;);
 		}&lt;br/&gt;
 &lt;br/&gt;
-		return new SSLEngineFactory(&lt;br/&gt;
+		return new SSLHandlerFactory(&lt;br/&gt;
 				sslContext,&lt;br/&gt;
 				getEnabledProtocols(config),&lt;br/&gt;
 				getEnabledCipherSuites(config),&lt;br/&gt;
 				true,&lt;br/&gt;
-				isRestSSLAuthenticationEnabled(config));&lt;br/&gt;
+				isRestSSLAuthenticationEnabled(config),&lt;br/&gt;
+				-1,&lt;br/&gt;
+				-1);&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	private static String[] getEnabledProtocols(final Configuration config) {&lt;br/&gt;
@@ -194,7 +203,7 @@ public static SSLEngineFactory createRestClientSSLEngineFactory(final Configurat&lt;br/&gt;
 	 * of mutual authentication.&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	public static SSLContext createInternalSSLContext(Configuration config) throws Exception {&lt;br/&gt;
+	private static SSLContext createInternalSSLContext(Configuration config) throws Exception {&lt;br/&gt;
 		checkNotNull(config, &quot;config&quot;);&lt;br/&gt;
 &lt;br/&gt;
 		if (!isInternalSSLEnabled(config)) {&lt;br/&gt;
@@ -216,6 +225,8 @@ public static SSLContext createInternalSSLContext(Configuration config) throws E&lt;br/&gt;
 				config, SecurityOptions.SSL_INTERNAL_TRUSTSTORE_PASSWORD, SecurityOptions.SSL_TRUSTSTORE_PASSWORD);&lt;br/&gt;
 &lt;br/&gt;
 		String sslProtocolVersion = config.getString(SecurityOptions.SSL_PROTOCOL);&lt;br/&gt;
+		int sessionCacheSize = config.getInteger(SecurityOptions.SSL_INTERNAL_SESSION_CACHE_SIZE);&lt;br/&gt;
+		int sessionTimeoutMs = config.getInteger(SecurityOptions.SSL_INTERNAL_SESSION_TIMEOUT);&lt;br/&gt;
 &lt;br/&gt;
 		KeyStore keyStore = KeyStore.getInstance(KeyStore.getDefaultType());&lt;br/&gt;
 		try (InputStream keyStoreFile = Files.newInputStream(new File(keystoreFilePath).toPath())) {&lt;br/&gt;
@@ -235,6 +246,12 @@ public static SSLContext createInternalSSLContext(Configuration config) throws E&lt;br/&gt;
 &lt;br/&gt;
 		SSLContext sslContext = SSLContext.getInstance(sslProtocolVersion);&lt;br/&gt;
 		sslContext.init(kmf.getKeyManagers(), tmf.getTrustManagers(), null);&lt;br/&gt;
+		if (sessionCacheSize &amp;gt;= 0) {
+			sslContext.getClientSessionContext().setSessionCacheSize(sessionCacheSize);
+		}&lt;br/&gt;
+		if (sessionTimeoutMs &amp;gt;= 0) {
+			sslContext.getClientSessionContext().setSessionTimeout(sessionTimeoutMs / 1000);
+		}&lt;br/&gt;
 &lt;br/&gt;
 		return sslContext;&lt;br/&gt;
 	}&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClient.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClient.java&lt;br/&gt;
index 6aef080a348..c7614ba2fdf 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClient.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClient.java&lt;br/&gt;
@@ -22,7 +22,7 @@&lt;br/&gt;
 import org.apache.flink.configuration.ConfigConstants;&lt;br/&gt;
 import org.apache.flink.configuration.RestOptions;&lt;br/&gt;
 import org.apache.flink.runtime.concurrent.FutureUtils;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.rest.messages.ErrorResponseBody;&lt;br/&gt;
 import org.apache.flink.runtime.rest.messages.MessageHeaders;&lt;br/&gt;
 import org.apache.flink.runtime.rest.messages.MessageParameters;&lt;br/&gt;
@@ -68,7 +68,6 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.multipart.DefaultHttpDataFactory;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.multipart.HttpPostRequestEncoder;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.multipart.MemoryAttribute;&lt;br/&gt;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedWriteHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.timeout.IdleStateEvent;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.timeout.IdleStateHandler;&lt;br/&gt;
@@ -114,14 +113,14 @@ public RestClient(RestClientConfiguration configuration, Executor executor) {&lt;br/&gt;
 		this.executor = Preconditions.checkNotNull(executor);&lt;br/&gt;
 		this.terminationFuture = new CompletableFuture&amp;lt;&amp;gt;();&lt;br/&gt;
 &lt;br/&gt;
-		final SSLEngineFactory sslEngineFactory = configuration.getSslEngineFactory();&lt;br/&gt;
+		final SSLHandlerFactory sslHandlerFactory = configuration.getSslHandlerFactory();&lt;br/&gt;
 		ChannelInitializer&amp;lt;SocketChannel&amp;gt; initializer = new ChannelInitializer&amp;lt;SocketChannel&amp;gt;() {&lt;br/&gt;
 			@Override&lt;br/&gt;
 			protected void initChannel(SocketChannel socketChannel) {&lt;br/&gt;
 				try {&lt;br/&gt;
 					// SSL should be the first handler in the pipeline&lt;br/&gt;
-					if (sslEngineFactory != null) {&lt;br/&gt;
-						socketChannel.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngineFactory.createSSLEngine()));&lt;br/&gt;
+					if (sslHandlerFactory != null) {
+						socketChannel.pipeline().addLast(&quot;ssl&quot;, sslHandlerFactory.createNettySSLHandler());
 					}&lt;br/&gt;
 &lt;br/&gt;
 					socketChannel.pipeline()&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClientConfiguration.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClientConfiguration.java&lt;br/&gt;
index b70b1f81ab3..dbddc069c2e 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClientConfiguration.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestClientConfiguration.java&lt;br/&gt;
@@ -20,7 +20,7 @@&lt;br/&gt;
 &lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.RestOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.util.ConfigurationException;&lt;br/&gt;
 import org.apache.flink.util.Preconditions;&lt;br/&gt;
@@ -36,7 +36,7 @@&lt;br/&gt;
 public final class RestClientConfiguration {&lt;br/&gt;
 &lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	private final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+	private final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 &lt;br/&gt;
 	private final long connectionTimeout;&lt;br/&gt;
 &lt;br/&gt;
@@ -45,12 +45,12 @@&lt;br/&gt;
 	private final int maxContentLength;&lt;br/&gt;
 &lt;br/&gt;
 	private RestClientConfiguration(&lt;br/&gt;
-			@Nullable final SSLEngineFactory sslEngineFactory,&lt;br/&gt;
+			@Nullable final SSLHandlerFactory sslHandlerFactory,&lt;br/&gt;
 			final long connectionTimeout,&lt;br/&gt;
 			final long idlenessTimeout,&lt;br/&gt;
 			final int maxContentLength) {&lt;br/&gt;
 		checkArgument(maxContentLength &amp;gt; 0, &quot;maxContentLength must be positive, was: %d&quot;, maxContentLength);&lt;br/&gt;
-		this.sslEngineFactory = sslEngineFactory;&lt;br/&gt;
+		this.sslHandlerFactory = sslHandlerFactory;&lt;br/&gt;
 		this.connectionTimeout = connectionTimeout;&lt;br/&gt;
 		this.idlenessTimeout = idlenessTimeout;&lt;br/&gt;
 		this.maxContentLength = maxContentLength;&lt;br/&gt;
@@ -62,8 +62,8 @@ private RestClientConfiguration(&lt;br/&gt;
 	 * @return SSLEngine that the REST client endpoint should use, or null if SSL was disabled&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	public SSLEngineFactory getSslEngineFactory() {&lt;br/&gt;
-		return sslEngineFactory;&lt;br/&gt;
+	public SSLHandlerFactory getSslHandlerFactory() {
+		return sslHandlerFactory;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
@@ -100,15 +100,15 @@ public int getMaxContentLength() {&lt;br/&gt;
 	public static RestClientConfiguration fromConfiguration(Configuration config) throws ConfigurationException {&lt;br/&gt;
 		Preconditions.checkNotNull(config);&lt;br/&gt;
 &lt;br/&gt;
-		final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 		if (SSLUtils.isRestSSLEnabled(config)) {&lt;br/&gt;
 			try {
-				sslEngineFactory = SSLUtils.createRestClientSSLEngineFactory(config);
+				sslHandlerFactory = SSLUtils.createRestClientSSLEngineFactory(config);
 			} catch (Exception e) {
 				throw new ConfigurationException(&quot;Failed to initialize SSLContext for the REST client&quot;, e);
 			}&lt;br/&gt;
 		} else {
-			sslEngineFactory = null;
+			sslHandlerFactory = null;
 		}&lt;br/&gt;
 &lt;br/&gt;
 		final long connectionTimeout = config.getLong(RestOptions.CONNECTION_TIMEOUT);&lt;br/&gt;
@@ -117,6 +117,6 @@ public static RestClientConfiguration fromConfiguration(Configuration config) th&lt;br/&gt;
 &lt;br/&gt;
 		int maxContentLength = config.getInteger(RestOptions.CLIENT_MAX_CONTENT_LENGTH);&lt;br/&gt;
 &lt;br/&gt;
-		return new RestClientConfiguration(sslEngineFactory, connectionTimeout, idlenessTimeout, maxContentLength);&lt;br/&gt;
+		return new RestClientConfiguration(sslHandlerFactory, connectionTimeout, idlenessTimeout, maxContentLength);&lt;br/&gt;
 	}&lt;br/&gt;
 }&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java&lt;br/&gt;
index ab8278512c7..9a699a04fb3 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpoint.java&lt;br/&gt;
@@ -22,7 +22,7 @@&lt;br/&gt;
 import org.apache.flink.api.common.time.Time;&lt;br/&gt;
 import org.apache.flink.api.java.tuple.Tuple2;&lt;br/&gt;
 import org.apache.flink.runtime.concurrent.FutureUtils;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.PipelineErrorHandler;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.RestHandlerSpecification;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.router.Router;&lt;br/&gt;
@@ -41,7 +41,6 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.SocketChannel;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.socket.nio.NioServerSocketChannel;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.http.HttpServerCodec;&lt;br/&gt;
-import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.stream.ChunkedWriteHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultThreadFactory;&lt;br/&gt;
 &lt;br/&gt;
@@ -76,7 +75,7 @@&lt;br/&gt;
 	private final String restBindAddress;&lt;br/&gt;
 	private final int restBindPort;&lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	private final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+	private final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 	private final int maxContentLength;&lt;br/&gt;
 &lt;br/&gt;
 	protected final Path uploadDir;&lt;br/&gt;
@@ -96,7 +95,7 @@ public RestServerEndpoint(RestServerEndpointConfiguration configuration) throws&lt;br/&gt;
 		this.restAddress = configuration.getRestAddress();&lt;br/&gt;
 		this.restBindAddress = configuration.getRestBindAddress();&lt;br/&gt;
 		this.restBindPort = configuration.getRestBindPort();&lt;br/&gt;
-		this.sslEngineFactory = configuration.getSslEngineFactory();&lt;br/&gt;
+		this.sslHandlerFactory = configuration.getSslHandlerFactory();&lt;br/&gt;
 &lt;br/&gt;
 		this.uploadDir = configuration.getUploadDir();&lt;br/&gt;
 		createUploadDir(uploadDir, log);&lt;br/&gt;
@@ -155,8 +154,8 @@ protected void initChannel(SocketChannel ch) {&lt;br/&gt;
 					RouterHandler handler = new RouterHandler(router, responseHeaders);&lt;br/&gt;
 &lt;br/&gt;
 					// SSL should be the first handler in the pipeline&lt;br/&gt;
-					if (sslEngineFactory != null) {&lt;br/&gt;
-						ch.pipeline().addLast(&quot;ssl&quot;, new SslHandler(sslEngineFactory.createSSLEngine()));&lt;br/&gt;
+					if (sslHandlerFactory != null) {
+						ch.pipeline().addLast(&quot;ssl&quot;, sslHandlerFactory.createNettySSLHandler());
 					}&lt;br/&gt;
 &lt;br/&gt;
 					ch.pipeline()&lt;br/&gt;
@@ -200,7 +199,7 @@ protected void initChannel(SocketChannel ch) {&lt;br/&gt;
 &lt;br/&gt;
 			final String protocol;&lt;br/&gt;
 &lt;br/&gt;
-			if (sslEngineFactory != null) {&lt;br/&gt;
+			if (sslHandlerFactory != null) {
 				protocol = &quot;https://&quot;;
 			} else {&lt;br/&gt;
 				protocol = &quot;http://&quot;;&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpointConfiguration.java b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpointConfiguration.java&lt;br/&gt;
index 561891f9276..5a54d206c99 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpointConfiguration.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/rest/RestServerEndpointConfiguration.java&lt;br/&gt;
@@ -21,7 +21,7 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.RestOptions;&lt;br/&gt;
 import org.apache.flink.configuration.WebOptions;&lt;br/&gt;
-import org.apache.flink.runtime.net.SSLEngineFactory;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.net.SSLUtils;&lt;br/&gt;
 import org.apache.flink.util.ConfigurationException;&lt;br/&gt;
 import org.apache.flink.util.Preconditions;&lt;br/&gt;
@@ -51,7 +51,7 @@&lt;br/&gt;
 	private final int restBindPort;&lt;br/&gt;
 &lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	private final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+	private final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 &lt;br/&gt;
 	private final Path uploadDir;&lt;br/&gt;
 &lt;br/&gt;
@@ -63,7 +63,7 @@ private RestServerEndpointConfiguration(&lt;br/&gt;
 			final String restAddress,&lt;br/&gt;
 			@Nullable String restBindAddress,&lt;br/&gt;
 			int restBindPort,&lt;br/&gt;
-			@Nullable SSLEngineFactory sslEngineFactory,&lt;br/&gt;
+			@Nullable SSLHandlerFactory sslHandlerFactory,&lt;br/&gt;
 			final Path uploadDir,&lt;br/&gt;
 			final int maxContentLength,&lt;br/&gt;
 			final Map&amp;lt;String, String&amp;gt; responseHeaders) {&lt;br/&gt;
@@ -74,7 +74,7 @@ private RestServerEndpointConfiguration(&lt;br/&gt;
 		this.restAddress = requireNonNull(restAddress);&lt;br/&gt;
 		this.restBindAddress = restBindAddress;&lt;br/&gt;
 		this.restBindPort = restBindPort;&lt;br/&gt;
-		this.sslEngineFactory = sslEngineFactory;&lt;br/&gt;
+		this.sslHandlerFactory = sslHandlerFactory;&lt;br/&gt;
 		this.uploadDir = requireNonNull(uploadDir);&lt;br/&gt;
 		this.maxContentLength = maxContentLength;&lt;br/&gt;
 		this.responseHeaders = Collections.unmodifiableMap(requireNonNull(responseHeaders));&lt;br/&gt;
@@ -111,8 +111,8 @@ public int getRestBindPort() {&lt;br/&gt;
 	 * @return SSLEngine that the REST server endpoint should use, or null if SSL was disabled&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Nullable&lt;br/&gt;
-	public SSLEngineFactory getSslEngineFactory() {&lt;br/&gt;
-		return sslEngineFactory;&lt;br/&gt;
+	public SSLHandlerFactory getSslHandlerFactory() {+		return sslHandlerFactory; 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
@@ -155,15 +155,15 @@ public static RestServerEndpointConfiguration fromConfiguration(Configuration co&lt;br/&gt;
 		final String restBindAddress = config.getString(RestOptions.BIND_ADDRESS);&lt;br/&gt;
 		final int port = config.getInteger(RestOptions.PORT);&lt;br/&gt;
 &lt;br/&gt;
-		final SSLEngineFactory sslEngineFactory;&lt;br/&gt;
+		final SSLHandlerFactory sslHandlerFactory;&lt;br/&gt;
 		if (SSLUtils.isRestSSLEnabled(config)) {&lt;br/&gt;
 			try {
-				sslEngineFactory = SSLUtils.createRestServerSSLEngineFactory(config);
+				sslHandlerFactory = SSLUtils.createRestServerSSLEngineFactory(config);
 			} catch (Exception e) {
 				throw new ConfigurationException(&quot;Failed to initialize SSLEngineFactory for REST server endpoint.&quot;, e);
 			}&lt;br/&gt;
 		} else {
-			sslEngineFactory = null;
+			sslHandlerFactory = null;
 		}&lt;br/&gt;
 &lt;br/&gt;
 		final Path uploadDir = Paths.get(&lt;br/&gt;
@@ -180,7 +180,7 @@ public static RestServerEndpointConfiguration fromConfiguration(Configuration co&lt;br/&gt;
 			restAddress,&lt;br/&gt;
 			restBindAddress,&lt;br/&gt;
 			port,&lt;br/&gt;
-			sslEngineFactory,&lt;br/&gt;
+			sslHandlerFactory,&lt;br/&gt;
 			uploadDir,&lt;br/&gt;
 			maxContentLength,&lt;br/&gt;
 			responseHeaders);&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
index c1fef146a9d..6ec7a235c3f 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/io/network/netty/NettyClientServerSslTest.java&lt;br/&gt;
@@ -18,6 +18,7 @@&lt;br/&gt;
 &lt;br/&gt;
 package org.apache.flink.runtime.io.network.netty;&lt;br/&gt;
 &lt;br/&gt;
+import org.apache.flink.configuration.ConfigOption;&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.SecurityOptions;&lt;br/&gt;
 import org.apache.flink.runtime.io.network.netty.NettyTestUtil.NettyServerAndClient;&lt;br/&gt;
@@ -29,13 +30,22 @@&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.channel.ChannelHandler;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.string.StringDecoder;&lt;br/&gt;
 import org.apache.flink.shaded.netty4.io.netty.handler.codec.string.StringEncoder;&lt;br/&gt;
+import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
 &lt;br/&gt;
 import org.junit.Assert;&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 &lt;br/&gt;
+import javax.net.ssl.SSLSessionContext;&lt;br/&gt;
+&lt;br/&gt;
 import java.net.InetAddress;&lt;br/&gt;
 &lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_INTERNAL_HANDSHAKE_TIMEOUT;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_INTERNAL_SESSION_CACHE_SIZE;&lt;br/&gt;
+import static org.apache.flink.configuration.SecurityOptions.SSL_INTERNAL_SESSION_TIMEOUT;&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
 import static org.junit.Assert.assertFalse;&lt;br/&gt;
+import static org.junit.Assert.assertNotNull;&lt;br/&gt;
 import static org.junit.Assert.assertTrue;&lt;br/&gt;
 &lt;br/&gt;
 /**&lt;br/&gt;
@@ -49,21 +59,65 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testValidSslConnection() throws Exception {
+		testValidSslConnection(createSslConfig());
+	}&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Verify valid (advanced) ssl configuration and connection.&lt;br/&gt;
+	 */&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testValidSslConnectionAdvanced() throws Exception {
+		Configuration sslConfig = createSslConfig();
+		sslConfig.setInteger(SSL_INTERNAL_SESSION_CACHE_SIZE, 1);
+		sslConfig.setInteger(SSL_INTERNAL_SESSION_TIMEOUT, 1_000);
+		sslConfig.setInteger(SSL_INTERNAL_HANDSHAKE_TIMEOUT, 1_000);
+		sslConfig.setInteger(SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT, 1_000);
+
+		testValidSslConnection(sslConfig);
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private void testValidSslConnection(Configuration sslConfig) throws Exception {&lt;br/&gt;
 		NettyProtocol protocol = new NoOpProtocol();&lt;br/&gt;
 &lt;br/&gt;
-		NettyConfig nettyConfig = createNettyConfig(createSslConfig());&lt;br/&gt;
+		NettyConfig nettyConfig = createNettyConfig(sslConfig);&lt;br/&gt;
 &lt;br/&gt;
 		NettyTestUtil.NettyServerAndClient serverAndClient = NettyTestUtil.initServerAndClient(protocol, nettyConfig);&lt;br/&gt;
 &lt;br/&gt;
 		Channel ch = NettyTestUtil.connect(serverAndClient);&lt;br/&gt;
 &lt;br/&gt;
+		SslHandler sslHandler = (SslHandler) ch.pipeline().get(&quot;ssl&quot;);&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_INTERNAL_HANDSHAKE_TIMEOUT, sslHandler.getHandshakeTimeoutMillis());&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_INTERNAL_CLOSE_NOTIFY_FLUSH_TIMEOUT, sslHandler.getCloseNotifyFlushTimeoutMillis());&lt;br/&gt;
+&lt;br/&gt;
 		// should be able to send text data&lt;br/&gt;
 		ch.pipeline().addLast(new StringDecoder()).addLast(new StringEncoder());&lt;br/&gt;
 		assertTrue(ch.writeAndFlush(&quot;test&quot;).await().isSuccess());&lt;br/&gt;
 &lt;br/&gt;
+		// session context is only be available after a session was setup -&amp;gt; this should be true after data was sent&lt;br/&gt;
+		SSLSessionContext sessionContext = sslHandler.engine().getSession().getSessionContext();&lt;br/&gt;
+		assertNotNull(&quot;bug in unit test setup: session context not available&quot;, sessionContext);&lt;br/&gt;
+		assertEqualsOrDefault(sslConfig, SSL_INTERNAL_SESSION_CACHE_SIZE, sessionContext.getSessionCacheSize());&lt;br/&gt;
+		int sessionTimeout = sslConfig.getInteger(SSL_INTERNAL_SESSION_TIMEOUT);&lt;br/&gt;
+		if (sessionTimeout != -1) {
+			// session timeout config is in milliseconds but the context returns it in seconds
+			assertEquals(sessionTimeout / 1000, sessionContext.getSessionTimeout());
+		} else {
+			assertTrue(&quot;default value (-1) should not be propagated&quot;, sessionContext.getSessionTimeout() &amp;gt;= 0);
+		}&lt;br/&gt;
+&lt;br/&gt;
 		NettyTestUtil.shutdown(serverAndClient);&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
+	private static void assertEqualsOrDefault(Configuration sslConfig, ConfigOption&amp;lt;Integer&amp;gt; option, long actual) {&lt;br/&gt;
+		long expected = sslConfig.getInteger(option);&lt;br/&gt;
+		if (expected != option.defaultValue()) {
+			assertEquals(expected, actual);
+		} else {
+			assertTrue(&quot;default value (&quot; + option.defaultValue() + &quot;) should not be propagated&quot;,
+				actual &amp;gt;= 0);
+		}&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
 	/**&lt;br/&gt;
 	 * Verify failure on invalid ssl configuration.&lt;br/&gt;
 	 */&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
index 9610e98b101..5031accb1a9 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/net/SSLUtilsTest.java&lt;br/&gt;
@@ -21,11 +21,13 @@&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
 import org.apache.flink.configuration.IllegalConfigurationException;&lt;br/&gt;
 import org.apache.flink.configuration.SecurityOptions;&lt;br/&gt;
+import org.apache.flink.runtime.io.network.netty.SSLHandlerFactory;&lt;br/&gt;
 import org.apache.flink.util.TestLogger;&lt;br/&gt;
 &lt;br/&gt;
+import org.apache.flink.shaded.netty4.io.netty.handler.ssl.SslHandler;&lt;br/&gt;
+&lt;br/&gt;
 import org.junit.Test;&lt;br/&gt;
 &lt;br/&gt;
-import javax.net.ssl.SSLEngine;&lt;br/&gt;
 import javax.net.ssl.SSLServerSocket;&lt;br/&gt;
 &lt;br/&gt;
 import java.net.ServerSocket;&lt;br/&gt;
@@ -124,7 +126,7 @@ public void testSocketFactoriesWhenSslDisabled() throws Exception {&lt;br/&gt;
 	public void testRESTClientSSL() throws Exception {
 		Configuration clientConfig = createRestSslConfigWithTrustStore();
 
-		SSLEngineFactory ssl = SSLUtils.createRestClientSSLEngineFactory(clientConfig);
+		SSLHandlerFactory ssl = SSLUtils.createRestClientSSLEngineFactory(clientConfig);
 		assertNotNull(ssl);
 	}&lt;br/&gt;
 &lt;br/&gt;
@@ -195,7 +197,7 @@ public void testRESTClientSSLWrongPassword() throws Exception {&lt;br/&gt;
 	public void testRESTServerSSL() throws Exception {
 		Configuration serverConfig = createRestSslConfigWithKeyStore();
 
-		SSLEngineFactory ssl = SSLUtils.createRestServerSSLEngineFactory(serverConfig);
+		SSLHandlerFactory ssl = SSLUtils.createRestServerSSLEngineFactory(serverConfig);
 		assertNotNull(ssl);
 	}&lt;br/&gt;
 &lt;br/&gt;
@@ -373,7 +375,7 @@ public void testSetSSLVersionAndCipherSuitesForSSLServerSocket() throws Exceptio&lt;br/&gt;
 	}&lt;br/&gt;
 &lt;br/&gt;
 	/**&lt;br/&gt;
-	 * Tests that {@link SSLEngineFactory} is created correctly.&lt;br/&gt;
+	 * Tests that {@link SSLHandlerFactory}
&lt;p&gt; is created correctly.&lt;br/&gt;
 	 */&lt;br/&gt;
 	@Test&lt;br/&gt;
 	public void testCreateSSLEngineFactory() throws Exception {&lt;br/&gt;
@@ -383,14 +385,14 @@ public void testCreateSSLEngineFactory() throws Exception &lt;/p&gt;
{
 		serverConfig.setString(SecurityOptions.SSL_PROTOCOL, &quot;TLSv1&quot;);
 		serverConfig.setString(SecurityOptions.SSL_ALGORITHMS, &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;);
 
-		final SSLEngineFactory serverSSLEngineFactory = SSLUtils.createInternalServerSSLEngineFactory(serverConfig);
-		final SSLEngine sslEngine = serverSSLEngineFactory.createSSLEngine();
+		final SSLHandlerFactory serverSSLHandlerFactory = SSLUtils.createInternalServerSSLEngineFactory(serverConfig);
+		final SslHandler sslHandler = serverSSLHandlerFactory.createNettySSLHandler();
 
-		assertEquals(1, sslEngine.getEnabledProtocols().length);
-		assertEquals(&quot;TLSv1&quot;, sslEngine.getEnabledProtocols()[0]);
+		assertEquals(1, sslHandler.engine().getEnabledProtocols().length);
+		assertEquals(&quot;TLSv1&quot;, sslHandler.engine().getEnabledProtocols()[0]);
 
-		assertEquals(2, sslEngine.getEnabledCipherSuites().length);
-		assertThat(sslEngine.getEnabledCipherSuites(), arrayContainingInAnyOrder(
+		assertEquals(2, sslHandler.engine().getEnabledCipherSuites().length);
+		assertThat(sslHandler.engine().getEnabledCipherSuites(), arrayContainingInAnyOrder(
 				&quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA&quot;, &quot;TLS_DHE_RSA_WITH_AES_128_CBC_SHA256&quot;));
 	}&lt;/li&gt;
&lt;/ul&gt;






&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13172688">FLINK-9879</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vzdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>