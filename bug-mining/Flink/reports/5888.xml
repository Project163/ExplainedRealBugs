<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:06:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-23385] Fix nullability of COALESCE</title>
                <link>https://issues.apache.org/jira/browse/FLINK-23385</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;EDIT: Simpler case:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SELECT COALESCE(REGEXP_EXTRACT(&lt;span class=&quot;code-quote&quot;&gt;&apos;22&apos;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&apos;[A-Z]+&apos;&lt;/span&gt;),&lt;span class=&quot;code-quote&quot;&gt;&apos;-&apos;&lt;/span&gt;);
[ERROR] Could not execute SQL statement. Reason:
org.apache.flink.table.api.TableException: Column &lt;span class=&quot;code-quote&quot;&gt;&apos;EXPR$0&apos;&lt;/span&gt; is NOT NULL, however, a &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value is being written into it. You can set job configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;table.exec.sink.not-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;-enforcer&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;drop&apos;&lt;/span&gt; to suppress &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; exception and drop such records silently.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When using&#160;REGEXP_EXTRACT on NOT NULL column I&apos;m getting following exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select COALESCE(REGEXP_EXTRACT(test, &lt;span class=&quot;code-quote&quot;&gt;&apos;[A-Z]+&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-&apos;&lt;/span&gt;) from test limit 10

[ERROR] Could not execute SQL statement. Reason:
org.apache.flink.table.api.TableException: Column &lt;span class=&quot;code-quote&quot;&gt;&apos;EXPR$0&apos;&lt;/span&gt; is NOT NULL, however, a &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; value is being written into it. You can set job configuration &lt;span class=&quot;code-quote&quot;&gt;&apos;table.exec.sink.not-&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;-enforcer&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;drop&apos;&lt;/span&gt; to suppress &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; exception and drop such records silently.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the reason is that nullability of result is wrongly calculated.&lt;br/&gt;
 Example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table test (
     test STRING NOT NULL
) WITH (
    &lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;datagen&apos;&lt;/span&gt;
);

explain select COALESCE(REGEXP_EXTRACT(test, &lt;span class=&quot;code-quote&quot;&gt;&apos;[A-Z]+&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-&apos;&lt;/span&gt;) from test

== Abstract Syntax Tree ==
LogicalProject(EXPR$0=[REGEXP_EXTRACT($0, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;[A-Z]+&apos;&lt;/span&gt;)])
+- LogicalTableScan(table=[[default_catalog, default_database, test]])== Optimized Physical Plan ==
Calc(select=[REGEXP_EXTRACT(test, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;[A-Z]+&apos;&lt;/span&gt;) AS EXPR$0])
+- TableSourceScan(table=[[default_catalog, default_database, test]], fields=[test])== Optimized Execution Plan ==
Calc(select=[REGEXP_EXTRACT(test, _UTF-16LE&lt;span class=&quot;code-quote&quot;&gt;&apos;[A-Z]+&apos;&lt;/span&gt;) AS EXPR$0])
+- TableSourceScan(table=[[default_catalog, default_database, test]], fields=[test])&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As you can see Flink is removing COALESCE from query which is wrong.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Same for view (null = false):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create view v as select COALESCE(REGEXP_EXTRACT(test, &lt;span class=&quot;code-quote&quot;&gt;&apos;[A-Z]+&apos;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&apos;-&apos;&lt;/span&gt;) from test

describe v;
+--------+--------+-------+-----+--------+-----------+
|   name |   type |  &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; | key | extras | watermark |
+--------+--------+-------+-----+--------+-----------+
| EXPR$0 | STRING | &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; |     |        |           |
+--------+--------+-------+-----+--------+-----------+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13389640">FLINK-23385</key>
            <summary>Fix nullability of COALESCE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="slinkydeveloper">Francesco Guardiani</assignee>
                                    <reporter username="maver1ck">Maciej Bry&#324;ski</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 14 Jul 2021 14:21:41 +0000</created>
                <updated>Thu, 23 Sep 2021 08:50:59 +0000</updated>
                            <resolved>Thu, 23 Sep 2021 08:50:59 +0000</resolved>
                                    <version>1.13.1</version>
                                    <fixVersion>1.15.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="17380655" author="maver1ck" created="Wed, 14 Jul 2021 14:39:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yanghua&quot; class=&quot;user-hover&quot; rel=&quot;yanghua&quot;&gt;yanghua&lt;/a&gt;&#160;as the author maybe you can help ?&#160;&lt;/p&gt;</comment>
                            <comment id="17380675" author="maver1ck" created="Wed, 14 Jul 2021 15:07:16 +0000"  >&lt;p&gt;Simpler case added.&lt;/p&gt;</comment>
                            <comment id="17380681" author="yanghua" created="Wed, 14 Jul 2021 15:19:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=maver1ck&quot; class=&quot;user-hover&quot; rel=&quot;maver1ck&quot;&gt;maver1ck&lt;/a&gt;&#160;Sorry, I am no longer interested in the Flink project.&lt;/p&gt;</comment>
                            <comment id="17380714" author="twalthr" created="Wed, 14 Jul 2021 16:06:40 +0000"  >&lt;p&gt;&lt;tt&gt;COALESCE&lt;/tt&gt; might be the issue here. Did you try &lt;tt&gt;IFNULL&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="17380744" author="maver1ck" created="Wed, 14 Jul 2021 16:53:20 +0000"  >&lt;p&gt;IFNULL is working.&lt;/p&gt;</comment>
                            <comment id="17381070" author="twalthr" created="Thu, 15 Jul 2021 06:20:50 +0000"  >&lt;p&gt;I renamed the issue. There are a couple of functions that have an invalid type inference.&lt;/p&gt;</comment>
                            <comment id="17382009" author="wenlong.lwl" created="Fri, 16 Jul 2021 11:53:38 +0000"  >&lt;p&gt;hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; I think the root cause of the issue is the return type of REGEXP_EXTRACT should be force nullable instead of  depending on input type, introduce by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13783&quot; title=&quot;Implement type inference for string functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-13783&quot;&gt;&lt;del&gt;FLINK-13783&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17419048" author="dawidwys" created="Thu, 23 Sep 2021 08:50:59 +0000"  >&lt;p&gt;Fixed in f074642a0d3c51dc82b2837510719f8d51c9d872&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0sy2w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>