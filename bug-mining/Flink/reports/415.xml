<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:19:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2076] Bug in re-openable hash join</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2076</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;It happens deterministically in my machine with the following setup:&lt;/p&gt;

&lt;p&gt;TaskManager:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;heap size: 512m&lt;/li&gt;
	&lt;li&gt;network buffers: 4096&lt;/li&gt;
	&lt;li&gt;slots: 32&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Job:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ConnectedComponents&lt;/li&gt;
	&lt;li&gt;100k vertices&lt;/li&gt;
	&lt;li&gt;1.2m edges&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;--&amp;gt; this gives around 260 m Flink managed memory, across 32 slots is 8MB per slot, with several mem consumers in the job, makes the iterative hash join out-of-core&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.RuntimeException: Hash Join bug in memory management: 
Memory buffers leaked.
	at org.apache.flink.runtime.operators.hash.MutableHashTable.buildTableFromSpilledPartition(MutableHashTable.java:733)
	at org.apache.flink.runtime.operators.hash.MutableHashTable.prepareNextPartition(MutableHashTable.java:508)
	at org.apache.flink.runtime.operators.hash.ReOpenableMutableHashTable.prepareNextPartition(ReOpenableMutableHashTable.java:167)
	at org.apache.flink.runtime.operators.hash.MutableHashTable.nextRecord(MutableHashTable.java:541)
	at org.apache.flink.runtime.operators.hash.NonReusingBuildSecondHashMatchIterator.callWithNextKey(NonReusingBuildSecondHashMatchIterator.java:102)
	at org.apache.flink.runtime.operators.AbstractCachedBuildSideMatchDriver.run(AbstractCachedBuildSideMatchDriver.java:155)
	at org.apache.flink.runtime.operators.RegularPactTask.run(RegularPactTask.java:496)
	at org.apache.flink.runtime.iterative.task.AbstractIterativePactTask.run(AbstractIterativePactTask.java:139)
	at org.apache.flink.runtime.iterative.task.IterationIntermediatePactTask.run(IterationIntermediatePactTask.java:92)
	at org.apache.flink.runtime.operators.RegularPactTask.invoke(RegularPactTask.java:362)
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:560)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12831917">FLINK-2076</key>
            <summary>Bug in re-openable hash join</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chiwanpark">Chiwan Park</assignee>
                                    <reporter username="sewen">Stephan Ewen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 May 2015 19:13:52 +0000</created>
                <updated>Thu, 4 Jun 2015 11:29:18 +0000</updated>
                            <resolved>Thu, 4 Jun 2015 11:29:18 +0000</resolved>
                                    <version>0.9</version>
                                    <fixVersion>0.9</fixVersion>
                                    <component>Runtime / Task</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14566148" author="githubbot" created="Sat, 30 May 2015 19:03:48 +0000"  >&lt;p&gt;GitHub user chiwanpark opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/751&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/751&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2076&quot; title=&quot;Bug in re-openable hash join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2076&quot;&gt;&lt;del&gt;FLINK-2076&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Fix memory leakage in MutableHashTable&lt;/p&gt;

&lt;p&gt;    Hi. This PR contains a bug fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2076&quot; title=&quot;Bug in re-openable hash join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2076&quot;&gt;&lt;del&gt;FLINK-2076&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2076&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-2076&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;    When `prepareNextPartition` method runs with some pending partitions, the memory leakage can occur at `memory.add(getNextBuffer())` statement (Line 515, 516). In common case, there are extra memory spaces for hash table so first and second call of `getNextBuffer()` return memory segment.&lt;/p&gt;

&lt;p&gt;    But in extreme case such as a case described in JIRA, the second call of `getNextBuffer()` can return null and this null makes the memory leakage.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/chiwanpark/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/chiwanpark/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2076&quot; title=&quot;Bug in re-openable hash join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2076&quot;&gt;&lt;del&gt;FLINK-2076&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/751.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/751.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #751&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit e9aa4d9a1ca36178f3f860b1997d5f92ada51c3f&lt;br/&gt;
Author: Chiwan Park &amp;lt;chiwanpark@icloud.com&amp;gt;&lt;br/&gt;
Date:   2015-05-30T18:27:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2076&quot; title=&quot;Bug in re-openable hash join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2076&quot;&gt;&lt;del&gt;FLINK-2076&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;runtime&amp;#93;&lt;/span&gt; Fix memory leakage in MutableHashTable&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14566817" author="githubbot" created="Sun, 31 May 2015 23:07:23 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/751#issuecomment-107255722&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/751#issuecomment-107255722&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks, this looks like some seriously great debugging! Very nice &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;    It would be great if you could add a test that produces the error without the fix, and validates that the fix resolved it. I would guess that you have a setup that produced this error (for debugging). Can you add this as a test?&lt;/p&gt;

&lt;p&gt;    Also, can we change the fix such that it adds a second memory segment, if it is non-null? That would help maintain the performance characteristics of the current code. I vaguely remember that there was a reason to add two memory segments (that code was written quite a while ago and I should have put more comments into the code).&lt;/p&gt;
</comment>
                            <comment id="14566894" author="githubbot" created="Mon, 1 Jun 2015 02:39:00 +0000"  >&lt;p&gt;Github user chiwanpark commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/751#issuecomment-107287836&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/751#issuecomment-107287836&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I was debugging with ConnectedComponents example and found the bug caused by null memory segment. I tried adding a test case to test re-openable hash table with small memory a moment ago. But I found another memory leakage not related to null memory segment. (All memory segments are not null)&lt;/p&gt;

&lt;p&gt;    I think that more investigation is needed. I&apos;ll update this PR when I fix the bug.&lt;/p&gt;</comment>
                            <comment id="14567143" author="githubbot" created="Mon, 1 Jun 2015 10:36:33 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/751#issuecomment-107392568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/751#issuecomment-107392568&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Awesome, thanks a lot @chiwanpark &lt;/p&gt;</comment>
                            <comment id="14567296" author="githubbot" created="Mon, 1 Jun 2015 13:39:59 +0000"  >&lt;p&gt;Github user chiwanpark commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/751#issuecomment-107478713&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/751#issuecomment-107478713&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I fixed the bug related to non-null memory segment. The bug was caused by non-clearing `writeBehindBuffersAvailable` variable in `close()` method of `MutableHashTable` class. I added a test case for this bug.&lt;/p&gt;

&lt;p&gt;    I have a problem for creating a test case to test the bug related to null memory segment. I think that it is related to parallelism also. If I run ConnectedComponents example with parallelism 1, the bug not occurs. So I cannot reproduce the state without ConnectedComponents example. &lt;/p&gt;</comment>
                            <comment id="14572509" author="githubbot" created="Thu, 4 Jun 2015 10:26:19 +0000"  >&lt;p&gt;Github user StephanEwen commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/751#issuecomment-108830359&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/751#issuecomment-108830359&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good, thanks a lot!&lt;/p&gt;

&lt;p&gt;    Will merge this...&lt;/p&gt;</comment>
                            <comment id="14572572" author="githubbot" created="Thu, 4 Jun 2015 11:28:37 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/751&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/751&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14572575" author="stephanewen" created="Thu, 4 Jun 2015 11:29:18 +0000"  >&lt;p&gt;Fixed and merged in 1559701f451e76944ba016f942c22fa8a022bcde&lt;/p&gt;

&lt;p&gt;Thanks for the patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f2e7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>