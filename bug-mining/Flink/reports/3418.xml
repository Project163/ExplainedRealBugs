<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:42:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-13184] Starting a TaskExecutor blocks the YarnResourceManager&apos;s main thread</title>
                <link>https://issues.apache.org/jira/browse/FLINK-13184</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, YarnResourceManager starts all task executors in main thread. This could cause RM to become unresponsive when launching a large number of TEs (e.g. &amp;gt; 1000) because it involves blocking I/O operations (writing files to HDFS, communicating with the node manager using a synchronous &lt;tt&gt;NMClient&lt;/tt&gt;). As a consequence, TE registration/heartbeat timeouts can occur and Flink might allocate too many excessive containers (see &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-12342&quot; title=&quot;Yarn Resource Manager Acquires Too Many Containers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-12342&quot;&gt;&lt;del&gt;FLINK-12342&lt;/del&gt;&lt;/a&gt;) because it cannot process the &lt;tt&gt;YarnResourceManager#onContainersAllocated&lt;/tt&gt; calls.&lt;/p&gt;

&lt;p&gt;There are different solution approaches but the end goal should be to not execute any blocking calls in the &lt;tt&gt;ResourceManager&apos;s&lt;/tt&gt; main thread:&lt;/p&gt;

&lt;p&gt;1. Start the TaskExecutors from a different thread (potentially thread pool) which is responsible for uploading the files and communicating with the NodeManager&lt;br/&gt;
2. Don&apos;t upload files (avoid blocking file system operations) and use the &lt;tt&gt;NMClientAsync&lt;/tt&gt; for the communication with Yarn&apos;s &lt;tt&gt;NodeManager&lt;/tt&gt;.&lt;br/&gt;
3. Upload files in a separate I/O thread and use the &lt;tt&gt;NMClientAsync&lt;/tt&gt; for the communication with Yarn&apos;s &lt;tt&gt;NodeManager&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13244006">FLINK-13184</key>
            <summary>Starting a TaskExecutor blocks the YarnResourceManager&apos;s main thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="wangyang0918">Yang Wang</assignee>
                                    <reporter username="xtsong">Xintong Song</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 10 Jul 2019 03:30:19 +0000</created>
                <updated>Fri, 28 Feb 2020 10:46:27 +0000</updated>
                            <resolved>Wed, 20 Nov 2019 09:03:51 +0000</resolved>
                                    <version>1.8.1</version>
                    <version>1.9.0</version>
                    <version>1.10.0</version>
                                    <fixVersion>1.8.3</fixVersion>
                    <fixVersion>1.9.2</fixVersion>
                    <fixVersion>1.10.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>13</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="16883040" author="qiluo" created="Thu, 11 Jul 2019 14:48:16 +0000"  >&lt;p&gt;Below are the TM error log in this case:&lt;br/&gt;
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
2019-07-09 13:56:59,110 INFO org.apache.flink.runtime.taskexecutor.TaskExecutor - Connecting to ResourceManager akka.tcp://flink@xxx/user/resourcemanager(00000000000000000000000000000000). 2019-07-09 14:00:01,138 INFO org.apache.flink.runtime.taskexecutor.TaskExecutor - Could not resolve ResourceManager address akka.tcp://flink@xxx/user/resourcemanager, retrying in 10000 ms: Ask timed out on [ActorSelection&lt;span class=&quot;error&quot;&gt;&amp;#91;Anchor(akka.tcp://flink@xxx/), Path(/user/resourcemanager)&amp;#93;&lt;/span&gt;] after &lt;span class=&quot;error&quot;&gt;&amp;#91;182000 ms&amp;#93;&lt;/span&gt;. Sender&lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt; sent message of type &quot;akka.actor.Identify&quot;.. 2019-07-09 14:01:59,137 ERROR org.apache.flink.runtime.taskexecutor.TaskExecutor - Fatal error occurred in TaskExecutor akka.tcp://flink@xxx/user/taskmanager_0. org.apache.flink.runtime.taskexecutor.exceptions.RegistrationTimeoutException: Could not register at the ResourceManager within the specified maximum registration duration 300000 ms. This indicates a problem with this instance. Terminating now. at org.apache.flink.runtime.taskexecutor.TaskExecutor.registrationTimeout(TaskExecutor.java:1023) at org.apache.flink.runtime.taskexecutor.TaskExecutor.lambda$startRegistrationTimeout$3(TaskExecutor.java:1009) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRunAsync(AkkaRpcActor.java:332) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.handleRpcMessage(AkkaRpcActor.java:158) at org.apache.flink.runtime.rpc.akka.AkkaRpcActor.onReceive(AkkaRpcActor.java:142) at akka.actor.UntypedActor$$anonfun$receive$1.applyOrElse(UntypedActor.scala:165) at akka.actor.Actor$class.aroundReceive(Actor.scala:502) at akka.actor.UntypedActor.aroundReceive(UntypedActor.scala:95) at akka.actor.ActorCell.receiveMessage(ActorCell.scala:526) at akka.actor.ActorCell.invoke(ActorCell.scala:495) at akka.dispatch.Mailbox.processMailbox(Mailbox.scala:257) at akka.dispatch.Mailbox.run(Mailbox.scala:224) at akka.dispatch.Mailbox.exec(Mailbox.scala:234) at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260) at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339) at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979) at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)&lt;/p&gt;</comment>
                            <comment id="16969086" author="till.rohrmann" created="Thu, 7 Nov 2019 09:35:18 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt; let&apos;s continue our discussion of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14582&quot; title=&quot;Do not upload {uuid}-taskmanager-conf.yaml for each task manager container&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14582&quot;&gt;&lt;del&gt;FLINK-14582&lt;/del&gt;&lt;/a&gt; here.&lt;/p&gt;</comment>
                            <comment id="16971079" author="fly_in_gis" created="Sun, 10 Nov 2019 09:29:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;`NMClientAsync` use a internal thread pool to execute all the container launch event. When we call `startContainerAsync`, it just put a event to the blocking queue. So replacing the `NMClient` to `NMClientAsync` will not take many unknown implications. Also I will run more tests in our yarn cluster.&lt;/p&gt;

&lt;p&gt;I think using dynamic properties instead of uploading a hdfs file is better. We have some big flink applications with more than 5000 containers. Even we use a thread pool to upload the config file to hdfs, it will still be very slow. Since the config for task manager and config uploaded by flink client have a small difference, so using dynamic properties is reasonable.&lt;/p&gt;</comment>
                            <comment id="16972049" author="hequn8128" created="Tue, 12 Nov 2019 04:06:43 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; I&apos;m preparing for the release of 1.8.3. Do you think it is a blocker for 1.8.3? Would be great to have your opinions here.&lt;/p&gt;</comment>
                            <comment id="16977978" author="tison" created="Wed, 20 Nov 2019 01:31:46 +0000"  >&lt;p&gt;master via a90520cbe0958545d2d0e4cb552d3c763b4031f0&lt;br/&gt;
master via 404dede5e80a284112187cfe49bb6fc5f4eb2964&lt;/p&gt;

&lt;p&gt;1.9 via 3c0849998d9f56a6321ba3e79c247336685196c0&lt;br/&gt;
1.9 via 1f1f9a3b5c09b9bf275bf26976569db84dff5e2a&lt;/p&gt;

&lt;p&gt;1.8 via 15ca8f06bf083bb4869dcd121ca07d747c8fa4af&lt;br/&gt;
1.8 via 46e22ceaedb8e4d5750a7aca9e7d3b35b08fd19c&lt;/p&gt;</comment>
                            <comment id="16978221" author="tison" created="Wed, 20 Nov 2019 09:03:51 +0000"  >&lt;p&gt;Thanks for your working &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fly_in_gis&quot; class=&quot;user-hover&quot; rel=&quot;fly_in_gis&quot;&gt;fly_in_gis&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13248998">FLINK-13590</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13161084">FLINK-9410</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13265473">FLINK-14582</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13230359">FLINK-12342</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13272244">FLINK-15053</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04ijk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>