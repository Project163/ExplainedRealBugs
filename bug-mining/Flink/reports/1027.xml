<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:23:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2733] ZooKeeperLeaderElectionTest.testZooKeeperReelection fails</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2733</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I observed a test failure in this run: &lt;a href=&quot;https://travis-ci.org/rmetzger/flink/jobs/81571914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/rmetzger/flink/jobs/81571914&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;testZooKeeperReelection(org.apache.flink.runtime.leaderelection.ZooKeeperLeaderElectionTest)  Time elapsed: 109.794 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: expected:&amp;lt;d6e0ee70-5192-4d44-8989-09f8425feecc&amp;gt; but was:&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;gt;
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failNotEquals(Assert.java:743)
	at org.junit.Assert.assertEquals(Assert.java:118)
	at org.junit.Assert.assertEquals(Assert.java:144)
	at org.apache.flink.runtime.leaderelection.ZooKeeperLeaderElectionTest.testZooKeeperReelection(ZooKeeperLeaderElectionTest.java:171)


Results :

Failed tests: 
  ZooKeeperLeaderElectionTest.testZooKeeperReelection:171 expected:&amp;lt;d6e0ee70-5192-4d44-8989-09f8425feecc&amp;gt; but was:&amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12895444">FLINK-2733</key>
            <summary>ZooKeeperLeaderElectionTest.testZooKeeperReelection fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="rmetzger">Robert Metzger</reporter>
                        <labels>
                            <label>test-stability</label>
                    </labels>
                <created>Tue, 22 Sep 2015 13:18:37 +0000</created>
                <updated>Thu, 14 Sep 2017 13:29:32 +0000</updated>
                            <resolved>Thu, 14 Sep 2017 13:29:32 +0000</resolved>
                                    <version>0.10.0</version>
                                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15316557" author="till.rohrmann" created="Mon, 6 Jun 2016 14:32:45 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://s3.amazonaws.com/archive.travis-ci.org/jobs/134215896/log.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://s3.amazonaws.com/archive.travis-ci.org/jobs/134215896/log.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15316636" author="till.rohrmann" created="Mon, 6 Jun 2016 15:23:06 +0000"  >&lt;p&gt;The problem seems to be a connection loss to the &lt;tt&gt;ZooKeeper&lt;/tt&gt; testing server. Two curator clients lose their connection to the testing server. I suspect that the testing listener is one of the affected components. As a consequence the testing listener is no longer notified about the changing leader election and the test fails.&lt;/p&gt;

&lt;p&gt;I assume that this has something to do with the Travis instances and the resouce consumption, since I couldn&apos;t reproduce the problem locally. I propose to decrease the number of concurrently connected instances and to increase the connection timeout in order to harden the test case.&lt;/p&gt;</comment>
                            <comment id="15320990" author="stephanewen" created="Wed, 8 Jun 2016 17:20:12 +0000"  >&lt;p&gt;Upon connection loss, can the client not try to reconnect?&lt;br/&gt;
Is this something that can happe in the proper flink runtime as well?&lt;/p&gt;</comment>
                            <comment id="15331453" author="githubbot" created="Wed, 15 Jun 2016 09:43:09 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2103&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2733&quot; title=&quot;ZooKeeperLeaderElectionTest.testZooKeeperReelection fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2733&quot;&gt;&lt;del&gt;FLINK-2733&lt;/del&gt;&lt;/a&gt; Harden ZooKeeperLeaderElectionTest&lt;/p&gt;

&lt;p&gt;    Hardens ZooKeeperElectionTest by allowing the testing listener to return&lt;br/&gt;
    out-dated leader information. This can happen if the ZooKeeper connection&lt;br/&gt;
    was suspended and the new leader information has not been sent to the&lt;br/&gt;
    testing listener. In this case, the testing listener will be queried again&lt;br/&gt;
    to return the actual leader information.&lt;/p&gt;

&lt;p&gt;    Add debug statements to ZooKeeperLeaderElectionTest.testZooKeeperReelection&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; fixZooKeeperLeaderElectionTest&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2103.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2103.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2103&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 37127ed6ad198d010c81b4c725c2dd14a8b11872&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-06-06T15:18:59Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2733&quot; title=&quot;ZooKeeperLeaderElectionTest.testZooKeeperReelection fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2733&quot;&gt;&lt;del&gt;FLINK-2733&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Harden ZooKeeperLeaderElectionTest&lt;/p&gt;

&lt;p&gt;    Hardens ZooKeeperElectionTest by allowing the testing listener to return&lt;br/&gt;
    out-dated leader information. This can happen if the ZooKeeper connection&lt;br/&gt;
    was suspended and the new leader information has not been sent to the&lt;br/&gt;
    testing listener. In this case, the testing listener will be queried again&lt;br/&gt;
    to return the actual leader information.&lt;/p&gt;

&lt;p&gt;    Add debug statements to ZooKeeperLeaderElectionTest.testZooKeeperReelection&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15331478" author="till.rohrmann" created="Wed, 15 Jun 2016 10:07:30 +0000"  >&lt;p&gt;I think my analysis was not correct. I checked and of course Curator will try to reconnect to ZooKeeper if the connection is lost. The problem was the following (hopefully I got it right this time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The test uses a leader retrieval service to find out which of the current leader contenders is the leader. Assume contender 0 is granted the leadership and the leader retrieval service is informed about it. Shortly afterwards, the contender 0 is revoked the leadership but the retrieval service is not yet informed about it. The test now compares the leader session id of the retrieval service with the contender whose address was returned. Since the leadership was revoked, the leader session id returned by the contender is null. That&apos;s the problem. I modified the test to allow false positive leaders being returned from the leader retrieval service.&lt;/p&gt;</comment>
                            <comment id="15335970" author="githubbot" created="Fri, 17 Jun 2016 12:48:45 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2103&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Ran 10 Travis builds and couldn&apos;t reproduce the ZooKeeperLeaderElectionTest failure. Thus, I assume that this PR fixes/hardens the test case. Will merge it now.&lt;/p&gt;</comment>
                            <comment id="15335974" author="till.rohrmann" created="Fri, 17 Jun 2016 12:51:02 +0000"  >&lt;p&gt;Fixed via 1a6bab3ef76805685044cf4521e32315169f9033&lt;/p&gt;</comment>
                            <comment id="15335976" author="githubbot" created="Fri, 17 Jun 2016 12:51:23 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2103&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2103&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15835901" author="tonycox" created="Tue, 24 Jan 2017 09:30:38 +0000"  >&lt;p&gt;still fails &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;testZooKeeperReelection(org.apache.flink.runtime.leaderelection.ZooKeeperLeaderElectionTest)  Time elapsed: 301.035 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.junit.Assert.fail(Assert.java:86)
	at org.junit.Assert.assertTrue(Assert.java:41)
	at org.junit.Assert.assertFalse(Assert.java:64)
	at org.junit.Assert.assertFalse(Assert.java:74)
	at org.apache.flink.runtime.leaderelection.ZooKeeperLeaderElectionTest.testZooKeeperReelection(ZooKeeperLeaderElectionTest.java:197)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; &lt;br/&gt;
&lt;a href=&quot;https://travis-ci.org/tonycox/flink/jobs/194440336&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/tonycox/flink/jobs/194440336&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16166301" author="till.rohrmann" created="Thu, 14 Sep 2017 13:29:19 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tonycox&quot; class=&quot;user-hover&quot; rel=&quot;tonycox&quot;&gt;tonycox&lt;/a&gt;, you actually did not use the fixed code when observing the test failure. Will close the issue therefore.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12976855">FLINK-4030</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lefr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>