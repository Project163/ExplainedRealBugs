<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:56:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-12351] AsyncWaitOperator should deep copy StreamElement when object reuse is enabled</title>
                <link>https://issues.apache.org/jira/browse/FLINK-12351</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently, AsyncWaitOperator directly put the input StreamElement into &lt;tt&gt;StreamElementQueue&lt;/tt&gt;. But when object reuse is enabled, the StreamElement is reused, which means the element in &lt;tt&gt;StreamElementQueue&lt;/tt&gt; will be modified. As a result, the output of AsyncWaitOperator might be wrong.&lt;/p&gt;

&lt;p&gt;An easy way to fix this might be deep copy the input StreamElement when object reuse is enabled, like this: &lt;a href=&quot;https://github.com/apache/flink/blob/blink/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/async/AsyncWaitOperator.java#L209&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/blink/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/async/AsyncWaitOperator.java#L209&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13230519">FLINK-12351</key>
            <summary>AsyncWaitOperator should deep copy StreamElement when object reuse is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jark">Jark Wu</assignee>
                                    <reporter username="jark">Jark Wu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>stale-assigned</label>
                    </labels>
                <created>Sun, 28 Apr 2019 03:39:16 +0000</created>
                <updated>Fri, 28 May 2021 09:13:16 +0000</updated>
                            <resolved>Sat, 24 Apr 2021 13:58:42 +0000</resolved>
                                                    <fixVersion>1.14.0</fixVersion>
                    <fixVersion>1.13.1</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16827861" author="aitozi" created="Sun, 28 Apr 2019 08:44:44 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I checked the objectuse config in other operator just now. Found that it&apos;s mostly been checked in batch related operator. Is only AsyncWaitOperator affected?  But i think other operator may be affected too. If user use the object reuse feature without paying attention to the side effect of the changes on the object as the doc of ExecutionConfig#enableObjectReuse say, the result may be unpredictable. Or we have to enable objectReuse to operator level to let user config the behaviour of the operator individually, what&apos;s your idea?&lt;/p&gt;</comment>
                            <comment id="16828869" author="jark" created="Mon, 29 Apr 2019 01:28:58 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aitozi&quot; class=&quot;user-hover&quot; rel=&quot;aitozi&quot;&gt;aitozi&lt;/a&gt;, I think fix the bug in AsyncWaitOperator and enable objectReuse on operator level are two orthogonal problems. We can create another JIRA to discuss the operator level object reuse problem.&lt;/p&gt;

&lt;p&gt;Currently, I only find the AsyncWaitOperator is affected, because it doesn&apos;t deep copy input record before put it into heap buffer (Java ArrayDeque).&lt;/p&gt;

&lt;p&gt;IMO, no matter object reuse is enabled or not, the AsyncWaitOperator should output the same result, because it&apos;s the framework code not user code.&lt;/p&gt;

&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;, what do you think about this? If you don&apos;t object, I can create a PR for this.&lt;/p&gt;</comment>
                            <comment id="16829072" author="till.rohrmann" created="Mon, 29 Apr 2019 09:42:38 +0000"  >&lt;p&gt;Go ahead with fixing this problem &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16829245" author="rmetzger" created="Mon, 29 Apr 2019 13:09:26 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;, thanks a lot for opening a ticket in the FLINK bug tracker. I just manually assigned the ticket to a component.&lt;/p&gt;

&lt;p&gt;For future tickets, please remember to always assign a new issue to a component, so that the component owner can pick it up.&lt;/p&gt;</comment>
                            <comment id="16829298" author="jark" created="Mon, 29 Apr 2019 14:22:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rmetzger&quot; class=&quot;user-hover&quot; rel=&quot;rmetzger&quot;&gt;rmetzger&lt;/a&gt; Thanks for the reminder. &lt;/p&gt;</comment>
                            <comment id="17180209" author="wenlong.lwl" created="Wed, 19 Aug 2020 02:10:30 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt; I think we may need to fix this issue in 1.11, it may be  a regression for 1.11. &lt;/p&gt;

&lt;p&gt;Before 1.11, AsyncWaitOperator is not chainnable because of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-13063&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;FLINK-13063&lt;/a&gt;, all of input records are new created from network inputs, so this bug would not be triggerred.&lt;/p&gt;

&lt;p&gt;In 1.11, AsyncWaitOperator is chainnable again(&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16219&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;FLINK-16219&lt;/a&gt;), this bug would affect the result when object reuse is enabled. &lt;/p&gt;</comment>
                            <comment id="17180304" author="till.rohrmann" created="Wed, 19 Aug 2020 06:51:21 +0000"  >&lt;p&gt;Thanks for reporting this issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wenlong.lwl&quot; class=&quot;user-hover&quot; rel=&quot;wenlong.lwl&quot;&gt;wenlong.lwl&lt;/a&gt;. Pulling in &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=AHeise&quot; class=&quot;user-hover&quot; rel=&quot;AHeise&quot;&gt;AHeise&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; who worked on &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16219&quot; title=&quot;Make AsyncWaitOperator chainable again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16219&quot;&gt;&lt;del&gt;FLINK-16219&lt;/del&gt;&lt;/a&gt; and who might be able to tell more about the implications of this change.&lt;/p&gt;</comment>
                            <comment id="17180345" author="pnowojski" created="Wed, 19 Aug 2020 07:49:50 +0000"  >&lt;p&gt;I think this is a valid concern. I&apos;m not sure how much performance impact matters here (probably not much judging by the common AsyncWaitOperator usecases). We we could try to avoid the deepcopy overhead when the operator is the head of the chain, but I&apos;m not sure how elegant would it be to depend on such behaviour.&lt;/p&gt;</comment>
                            <comment id="17181081" author="wenlong.lwl" created="Thu, 20 Aug 2020 09:56:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pnowojski&quot; class=&quot;user-hover&quot; rel=&quot;pnowojski&quot;&gt;pnowojski&lt;/a&gt; As I known, it is easy to get whether the op is the head of chain by: StreamConfig#isChainStart&lt;/p&gt;</comment>
                            <comment id="17181094" author="pnowojski" created="Thu, 20 Aug 2020 10:30:37 +0000"  >&lt;p&gt;Yes that&apos;s true. I was more worried about relaying on an assumption that network stack is not re using the records in any way. But maybe this is not big of an issue and could be guarded by some unit test for `AsyncWaitOperator`.&lt;/p&gt;</comment>
                            <comment id="17323295" author="flink-jira-bot" created="Fri, 16 Apr 2021 11:10:37 +0000"  >&lt;p&gt;This issue is assigned but has not received an update in 7 days so it has been labeled &quot;stale-assigned&quot;. If you are still working on the issue, please give an update and remove the label. If you are no longer working on the issue, please unassign so someone else may work on it. In 7 days the issue will be automatically unassigned.&lt;/p&gt;</comment>
                            <comment id="17331239" author="jark" created="Sat, 24 Apr 2021 13:58:42 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: a4dcd91455d94c7500ce761aa6aa4337cb552b67&lt;/li&gt;
	&lt;li&gt;release-1.13: 253553062a6c944bac174af0804fd192d550b97f&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z027io:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>