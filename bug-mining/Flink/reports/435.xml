<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:19:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-2221] Checkpoints to &quot;file://&quot; are not cleaned up</title>
                <link>https://issues.apache.org/jira/browse/FLINK-2221</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;If you think about it, this could never work. The state handle cleanup logic happens purely on the JobManager. So what happens is that the TaskManagers create state in some directory, let&apos;s say /tmp/checkpoints, on the TaskManager. For cleanup, the JobManager gets the state handle and calls discard (on the JobManager), this tries to cleanup the state in /tmp/checkpoints, but of course, there is nothing there since we are still on the JobManager.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12837839">FLINK-2221</key>
            <summary>Checkpoints to &quot;file://&quot; are not cleaned up</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Jun 2015 13:42:49 +0000</created>
                <updated>Wed, 2 Oct 2019 17:44:25 +0000</updated>
                            <resolved>Thu, 13 Oct 2016 12:18:55 +0000</resolved>
                                                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14586052" author="gyfora" created="Mon, 15 Jun 2015 13:50:03 +0000"  >&lt;p&gt;Does the cleanup work for HDFS and other distributed file systems that the JM sees?&lt;/p&gt;</comment>
                            <comment id="14586060" author="aljoscha" created="Mon, 15 Jun 2015 13:54:04 +0000"  >&lt;p&gt;Yes, for those it seems to work, although I&apos;m a bit afraid about name clashes. The name of the checkpoint file should also include the operator-id, name and parallel subtask is.&lt;/p&gt;</comment>
                            <comment id="14586066" author="gyfora" created="Mon, 15 Jun 2015 14:00:36 +0000"  >&lt;p&gt;For the time being let&apos;s assume that the JM can actually execute the discard logic. Using &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt; is useless anyways.&lt;/p&gt;</comment>
                            <comment id="14586078" author="mbalassi" created="Mon, 15 Jun 2015 14:07:46 +0000"  >&lt;p&gt;So the current architecture has the assumption that the JobManager has access to the checkpoint files the same way a TaskManager does. We should make this more clear for the user.&lt;/p&gt;

&lt;p&gt;An additional fragility factor can be that the file state provider simply adds a random string to the directory name and expects it to be an unused name, or simply overwrites it. It is highly unlikely that this behaviur would cause a trouble, but let us still avoid it. Let me add a quick fix for the latter issue.&lt;/p&gt;</comment>
                            <comment id="14586091" author="aljoscha" created="Mon, 15 Jun 2015 14:16:22 +0000"  >&lt;p&gt;Then we should add it to the configuration, that the user should not user &lt;a href=&quot;file://&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file://&lt;/a&gt; there when running on a cluster.&lt;/p&gt;</comment>
                            <comment id="14586119" author="uce" created="Mon, 15 Jun 2015 14:36:49 +0000"  >&lt;p&gt;@Marton: how are you fixing this? Check and retry with a different name?&lt;/p&gt;

&lt;p&gt;I think it is a valid use case to do the checkpoints on the local FS. I will sync with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt; and look into this later.&lt;/p&gt;</comment>
                            <comment id="14586126" author="gyfora" created="Mon, 15 Jun 2015 14:41:02 +0000"  >&lt;p&gt;A workaround would be to actually discard the state where it was created. But this adds a large overhead of sending state handles around.&lt;/p&gt;</comment>
                            <comment id="14586134" author="mbalassi" created="Mon, 15 Jun 2015 14:47:33 +0000"  >&lt;p&gt;We can go down the check and retry route, but as it is distributed systems that is still not safe. My current approach is to add some prefix consisting of jobname, datetime, operatorname and parallel instance name that makes it more unique. Or we could also generate a UUID.&lt;/p&gt;</comment>
                            <comment id="14586148" author="mbalassi" created="Mon, 15 Jun 2015 15:00:34 +0000"  >&lt;p&gt;After a bit more careful consideration and checking other parts of the code I feel that it does not make sense to implement this. A clash in twenty byte long random string has to be enough.&lt;/p&gt;</comment>
                            <comment id="14586154" author="mbalassi" created="Mon, 15 Jun 2015 15:02:40 +0000"  >&lt;p&gt;Ok, so for the release I am adding some documentation, highlighting that the local flesystem should not be used as a state backend in a distributed setting. We might address the issue later.&lt;/p&gt;</comment>
                            <comment id="14586311" author="githubbot" created="Mon, 15 Jun 2015 16:55:59 +0000"  >&lt;p&gt;GitHub user mbalassi opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/839&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2221&quot; title=&quot;Checkpoints to &amp;quot;file://&amp;quot; are not cleaned up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2221&quot;&gt;&lt;del&gt;FLINK-2221&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;docs&amp;#93;&lt;/span&gt; Docs for not using local filesystem on the cluste&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;r as state backup&lt;/p&gt;

&lt;p&gt;    This is just a clear documentation of the problem for the 0.9 release.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mbalassi/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mbalassi/flink&lt;/a&gt; flink-2221&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/839.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/839.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #839&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 79f0db81c8eda3296bc0f42f9191ea2d0790132c&lt;br/&gt;
Author: mbalassi &amp;lt;mbalassi@apache.org&amp;gt;&lt;br/&gt;
Date:   2015-06-15T16:53:08Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2221&quot; title=&quot;Checkpoints to &amp;quot;file://&amp;quot; are not cleaned up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-2221&quot;&gt;&lt;del&gt;FLINK-2221&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;docs&amp;#93;&lt;/span&gt; Docs for not using local filesystem on the cluster as state backup&lt;/p&gt;

&lt;p&gt;    This is just a clear documentation of the problem for the 0.9 release.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14586450" author="githubbot" created="Mon, 15 Jun 2015 18:27:03 +0000"  >&lt;p&gt;Github user aljoscha commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/839#issuecomment-112161893&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/839#issuecomment-112161893&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good +1&lt;/p&gt;</comment>
                            <comment id="14587872" author="githubbot" created="Tue, 16 Jun 2015 11:03:00 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/839&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14587883" author="mbalassi" created="Tue, 16 Jun 2015 11:14:45 +0000"  >&lt;p&gt;A documentation for 0.9 has been pushed, the issue itself remains open. We should discuss whether this architecture is desirable.&lt;/p&gt;</comment>
                            <comment id="14595044" author="githubbot" created="Sun, 21 Jun 2015 13:07:21 +0000"  >&lt;p&gt;Github user mbalassi commented on the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/747#issuecomment-113898364&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/747#issuecomment-113898364&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the design outline guys, it looks great. Two minor comments in terms of implementation:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Let us make some more emphasis on the architecture of discarding or compaction old checkpoint data. This seems a minor issue, but we have seen during the recent release testing that it has implications. &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; In the current version the `JobManager` discards old state, so it needs access to it. If I understand it correctly that behavior is intact after this PR.&lt;/li&gt;
	&lt;li&gt;API: `KeyedDataStream` should be feasible if we really make it a more general version of data stream. The interplay with windowed and connected streams is interesting. The reason why e.g. a windowed and grouping fits nicely is that the windowed groups contain only elements from one group. You propose the same design for keyed streams as well?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-2221&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-2221&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15569386" author="stephanewen" created="Wed, 12 Oct 2016 17:45:49 +0000"  >&lt;p&gt;I would like to close this as &quot;won&apos;t fix&quot;, because it is expected. In a distributed system, checkpointing to locations that are only locally accessible cannot work.&lt;/p&gt;

&lt;p&gt;Supporting &quot;file://&quot; is still valid, because many NFS-like filesystems would be addressed via that scheme.&lt;/p&gt;</comment>
                            <comment id="15571757" author="aljoscha" created="Thu, 13 Oct 2016 12:18:21 +0000"  >&lt;p&gt;+1 for &quot;won&apos;t fix&quot; (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="15571759" author="aljoscha" created="Thu, 13 Oct 2016 12:18:55 +0000"  >&lt;p&gt;This is the expected behaviour. As mentioned in the discussion.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2g1r3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>