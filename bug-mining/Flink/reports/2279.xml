<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:32:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-8854] Mapping of SchemaValidator.deriveFieldMapping() is incorrect.</title>
                <link>https://issues.apache.org/jira/browse/FLINK-8854</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The field mapping returned by &lt;tt&gt;SchemaValidator.deriveFieldMapping()&lt;/tt&gt; is not correct.&lt;/p&gt;

&lt;p&gt;It should not only include all fields of the table schema, but also all fields of the format schema (mapped to themselves). Otherwise, it is not possible to use a timestamp extractor on a field that is not in table schema. &lt;/p&gt;

&lt;p&gt;For example this configuration would fail:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
sources:
  - name: TaxiRides
    schema:
      - name: rideId
        type: LONG
      - name: rowTime
        type: TIMESTAMP
        rowtime:
          timestamps:
            type: &lt;span class=&quot;code-quote&quot;&gt;&quot;from-field&quot;&lt;/span&gt;
            from: &lt;span class=&quot;code-quote&quot;&gt;&quot;rideTime&quot;&lt;/span&gt;
          watermarks:
            type: &lt;span class=&quot;code-quote&quot;&gt;&quot;periodic-bounded&quot;&lt;/span&gt;
            delay: &lt;span class=&quot;code-quote&quot;&gt;&quot;60000&quot;&lt;/span&gt;
    connector:
      ....
    format:
      property-version: 1
      type: json
      schema: &lt;span class=&quot;code-quote&quot;&gt;&quot;ROW(rideId LONG, rideTime TIMESTAMP)&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;because &lt;tt&gt;rideTime&lt;/tt&gt; is not in the table schema.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13142387">FLINK-8854</key>
            <summary>Mapping of SchemaValidator.deriveFieldMapping() is incorrect.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="twalthr">Timo Walther</assignee>
                                    <reporter username="fhueske">Fabian Hueske</reporter>
                        <labels>
                    </labels>
                <created>Sun, 4 Mar 2018 18:51:36 +0000</created>
                <updated>Thu, 15 Mar 2018 16:49:52 +0000</updated>
                            <resolved>Fri, 9 Mar 2018 13:02:30 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16391163" author="githubbot" created="Thu, 8 Mar 2018 12:15:50 +0000"  >&lt;p&gt;GitHub user twalthr opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8854&quot; title=&quot;Mapping of SchemaValidator.deriveFieldMapping() is incorrect.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8854&quot;&gt;&lt;del&gt;FLINK-8854&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Fix schema mapping with time attributes&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This PR fixes the invalid field mapping and improves the mapping of time attributes in general.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;`SchemaValidator.deriveFieldMapping()` and `SchemaValidator.deriveFormatFields()`&lt;/li&gt;
&lt;/ul&gt;



&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Existing tests extended&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? JavaDocs&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/twalthr/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/twalthr/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8854&quot; title=&quot;Mapping of SchemaValidator.deriveFieldMapping() is incorrect.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8854&quot;&gt;&lt;del&gt;FLINK-8854&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5662&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 45c1ca57b65004fa973b663e441848ab228ade3e&lt;br/&gt;
Author: Timo Walther &amp;lt;twalthr@...&amp;gt;&lt;br/&gt;
Date:   2018-03-08T10:51:38Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-8854&quot; title=&quot;Mapping of SchemaValidator.deriveFieldMapping() is incorrect.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-8854&quot;&gt;&lt;del&gt;FLINK-8854&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; Fix schema mapping with time attributes&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16392843" author="githubbot" created="Fri, 9 Mar 2018 12:53:04 +0000"  >&lt;p&gt;Github user twalthr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Merging...&lt;/p&gt;</comment>
                            <comment id="16392850" author="githubbot" created="Fri, 9 Mar 2018 12:58:22 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16392857" author="twalthr" created="Fri, 9 Mar 2018 13:02:30 +0000"  >&lt;p&gt;Fixed in 1.6.0: c531486288caf5241cdf7f0f00f087f3ce82239f&lt;br/&gt;
Fixed in 1.5.0: a75815aae4362dee0470345e0209096e503dc1ef&lt;/p&gt;</comment>
                            <comment id="16392913" author="githubbot" created="Fri, 9 Mar 2018 14:06:09 +0000"  >&lt;p&gt;Github user xccui commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173455747&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173455747&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/descriptors/SchemaValidator.scala &amp;#8212;&lt;br/&gt;
    @@ -198,14 +205,20 @@ object SchemaValidator {&lt;br/&gt;
           val isProctime = properties&lt;br/&gt;
             .getOptionalBoolean(s&quot;$SCHEMA.$i.$SCHEMA_PROCTIME&quot;)&lt;br/&gt;
             .orElse(false)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val isRowtime = properties&lt;/li&gt;
	&lt;li&gt;.containsKey(s&quot;$SCHEMA.$i.$ROWTIME_TIMESTAMPS_TYPE&quot;)&lt;br/&gt;
    +      val tsType = s&quot;$SCHEMA.$i.$ROWTIME_TIMESTAMPS_TYPE&quot;&lt;br/&gt;
    +      val isRowtime = properties.containsKey(tsType)&lt;br/&gt;
           if (!isProctime &amp;amp;&amp;amp; !isRowtime) 
{
             // check for a aliasing
             val fieldName = properties.getOptionalString(s&quot;$SCHEMA.$i.$SCHEMA_FROM&quot;)
               .orElse(n)
             builder.field(fieldName, t)
           }
&lt;p&gt;    +      // only use the rowtime attribute if it references a field&lt;br/&gt;
    +      else if (isRowtime &amp;amp;&amp;amp;&lt;br/&gt;
    +          properties.getString(tsType) == ROWTIME_TIMESTAMPS_TYPE_VALUE_FROM_FIELD) {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    What if the user uses the custom extractor to define his/her own `ExistingField` extractor that references a field?&lt;/p&gt;</comment>
                            <comment id="16392933" author="githubbot" created="Fri, 9 Mar 2018 14:34:13 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173465435&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173465435&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/descriptors/SchemaValidator.scala &amp;#8212;&lt;br/&gt;
    @@ -198,14 +205,20 @@ object SchemaValidator {&lt;br/&gt;
           val isProctime = properties&lt;br/&gt;
             .getOptionalBoolean(s&quot;$SCHEMA.$i.$SCHEMA_PROCTIME&quot;)&lt;br/&gt;
             .orElse(false)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;val isRowtime = properties&lt;/li&gt;
	&lt;li&gt;.containsKey(s&quot;$SCHEMA.$i.$ROWTIME_TIMESTAMPS_TYPE&quot;)&lt;br/&gt;
    +      val tsType = s&quot;$SCHEMA.$i.$ROWTIME_TIMESTAMPS_TYPE&quot;&lt;br/&gt;
    +      val isRowtime = properties.containsKey(tsType)&lt;br/&gt;
           if (!isProctime &amp;amp;&amp;amp; !isRowtime) 
{
             // check for a aliasing
             val fieldName = properties.getOptionalString(s&quot;$SCHEMA.$i.$SCHEMA_FROM&quot;)
               .orElse(n)
             builder.field(fieldName, t)
           }
&lt;p&gt;    +      // only use the rowtime attribute if it references a field&lt;br/&gt;
    +      else if (isRowtime &amp;amp;&amp;amp;&lt;br/&gt;
    +          properties.getString(tsType) == ROWTIME_TIMESTAMPS_TYPE_VALUE_FROM_FIELD) {&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    You are right, we should declare `ExistingField` `final`. In the custom extractor case, a user has to supply the format manually. Maybe we will need an explanation logic in the future such that a user can see how the derived format looks like and if it makes sense to declare it explicitly.&lt;/p&gt;</comment>
                            <comment id="16392937" author="githubbot" created="Fri, 9 Mar 2018 14:41:21 +0000"  >&lt;p&gt;Github user twalthr commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the comments @xccui. It&apos;s never to late for feedback. Sorry, maybe I merged this too quickly. We still need to call `builder.forJsonSchema()` if the schema contains a `proctime` attribute. The most common use case will be to extend the format by time attributes. With your approach the format would contain an additional timestamp that is definitely not part of the format schema.&lt;/p&gt;</comment>
                            <comment id="16393985" author="githubbot" created="Sat, 10 Mar 2018 02:49:52 +0000"  >&lt;p&gt;Github user xccui commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the explanation, @twalthr! I&apos;ll update the PR and resolve the conflicts caused.&lt;/p&gt;</comment>
                            <comment id="16395187" author="githubbot" created="Mon, 12 Mar 2018 12:53:22 +0000"  >&lt;p&gt;Github user xccui commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173784883&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173784883&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/descriptors/SchemaValidator.scala &amp;#8212;&lt;br/&gt;
    @@ -148,6 +148,13 @@ object SchemaValidator {&lt;/p&gt;

&lt;p&gt;         val schema = properties.getTableSchema(SCHEMA)&lt;/p&gt;

&lt;p&gt;    +    // add all source fields first because rowtime might reference one of them&lt;br/&gt;
    +    toScala(sourceSchema).map(_.getColumnNames).foreach { names =&amp;gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Hi @twalthr, can we check the used `TimestampExtractor` here? Specifically, if it&apos;s an `ExistingField`, we only included the target fields; if it&apos;s a `StreamRecordTimestamp` we don&apos;t include extra fields; and only if it&apos;s a custom extractor we include all the source fields.&lt;/p&gt;</comment>
                            <comment id="16395195" author="githubbot" created="Mon, 12 Mar 2018 12:59:31 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173786510&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173786510&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/descriptors/SchemaValidator.scala &amp;#8212;&lt;br/&gt;
    @@ -148,6 +148,13 @@ object SchemaValidator {&lt;/p&gt;

&lt;p&gt;         val schema = properties.getTableSchema(SCHEMA)&lt;/p&gt;

&lt;p&gt;    +    // add all source fields first because rowtime might reference one of them&lt;br/&gt;
    +    toScala(sourceSchema).map(_.getColumnNames).foreach { names =&amp;gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes @xccui, we could change the logic like this. Do you have cases where we need such behavior?&lt;/p&gt;</comment>
                            <comment id="16395220" author="githubbot" created="Mon, 12 Mar 2018 13:15:53 +0000"  >&lt;p&gt;Github user xccui commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173791129&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173791129&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/descriptors/SchemaValidator.scala &amp;#8212;&lt;br/&gt;
    @@ -148,6 +148,13 @@ object SchemaValidator {&lt;/p&gt;

&lt;p&gt;         val schema = properties.getTableSchema(SCHEMA)&lt;/p&gt;

&lt;p&gt;    +    // add all source fields first because rowtime might reference one of them&lt;br/&gt;
    +    toScala(sourceSchema).map(_.getColumnNames).foreach { names =&amp;gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Not really. I was justing refactoring #5610. For convenience, I used the existing class `org.apache.flink.formats.avro.generated.User` in a test case, but it gets so many fields to be mapped. &#128516; &lt;/p&gt;</comment>
                            <comment id="16395455" author="githubbot" created="Mon, 12 Mar 2018 16:20:20 +0000"  >&lt;p&gt;Github user xccui commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173857218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173857218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-libraries/flink-table/src/main/scala/org/apache/flink/table/descriptors/SchemaValidator.scala &amp;#8212;&lt;br/&gt;
    @@ -148,6 +148,13 @@ object SchemaValidator {&lt;/p&gt;

&lt;p&gt;         val schema = properties.getTableSchema(SCHEMA)&lt;/p&gt;

&lt;p&gt;    +    // add all source fields first because rowtime might reference one of them&lt;br/&gt;
    +    toScala(sourceSchema).map(_.getColumnNames).foreach { names =&amp;gt;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think we should first remove the added source fields before adding the explicit mappings with the following snippet. &lt;br/&gt;
    ```&lt;br/&gt;
    // add explicit mapping&lt;br/&gt;
    case Some(source) =&amp;gt;&lt;br/&gt;
        // should add mapping.remove(source)&lt;br/&gt;
        mapping.put(name, source)&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16395467" author="githubbot" created="Mon, 12 Mar 2018 16:30:48 +0000"  >&lt;p&gt;Github user xccui commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173860901&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173860901&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-base/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaJsonTableSourceFactoryTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -89,9 +94,10 @@ private void testTableSource(FormatDescriptor format) {&lt;br/&gt;
     		// construct table source using a builder&lt;/p&gt;

&lt;p&gt;     		final Map&amp;lt;String, String&amp;gt; tableJsonMapping = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +		tableJsonMapping.put(&quot;name&quot;, &quot;name&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This &quot;name&quot; to &quot;name&quot; mapping should not exist since we&apos;ve already explicitly defined the &quot;fruit-name&quot; to &quot;name&quot; mapping.&lt;/p&gt;</comment>
                            <comment id="16395476" author="githubbot" created="Mon, 12 Mar 2018 16:37:44 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173863375&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173863375&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-base/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaJsonTableSourceFactoryTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -89,9 +94,10 @@ private void testTableSource(FormatDescriptor format) {&lt;br/&gt;
     		// construct table source using a builder&lt;/p&gt;

&lt;p&gt;     		final Map&amp;lt;String, String&amp;gt; tableJsonMapping = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +		tableJsonMapping.put(&quot;name&quot;, &quot;name&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The question is what should a rowtime attribute field (or a custom extractor) reference? The input or the current schema? I think it should reference the input thus all fields (even the renamed ones) need to be present in the mapping.&lt;/p&gt;</comment>
                            <comment id="16395545" author="githubbot" created="Mon, 12 Mar 2018 17:23:40 +0000"  >&lt;p&gt;Github user xccui commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173879267&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173879267&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-base/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaJsonTableSourceFactoryTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -89,9 +94,10 @@ private void testTableSource(FormatDescriptor format) {&lt;br/&gt;
     		// construct table source using a builder&lt;/p&gt;

&lt;p&gt;     		final Map&amp;lt;String, String&amp;gt; tableJsonMapping = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +		tableJsonMapping.put(&quot;name&quot;, &quot;name&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Well, according to the current implementation, you are right. But I still feel uncomfortable about that since we actually mix the physical schema (format schema) and the logical schema (table schema) into the same map. Do you think it&apos;s necessary to make some changes here?&lt;/p&gt;</comment>
                            <comment id="16395556" author="githubbot" created="Mon, 12 Mar 2018 17:28:57 +0000"  >&lt;p&gt;Github user twalthr commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173881141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173881141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-base/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaJsonTableSourceFactoryTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -89,9 +94,10 @@ private void testTableSource(FormatDescriptor format) {&lt;br/&gt;
     		// construct table source using a builder&lt;/p&gt;

&lt;p&gt;     		final Map&amp;lt;String, String&amp;gt; tableJsonMapping = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +		tableJsonMapping.put(&quot;name&quot;, &quot;name&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    @fhueske what do you think about this whole mapping business?&lt;/p&gt;</comment>
                            <comment id="16395581" author="githubbot" created="Mon, 12 Mar 2018 17:49:26 +0000"  >&lt;p&gt;Github user xccui commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5662#discussion_r173888555&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5662#discussion_r173888555&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-base/src/test/java/org/apache/flink/streaming/connectors/kafka/KafkaJsonTableSourceFactoryTestBase.java &amp;#8212;&lt;br/&gt;
    @@ -89,9 +94,10 @@ private void testTableSource(FormatDescriptor format) {&lt;br/&gt;
     		// construct table source using a builder&lt;/p&gt;

&lt;p&gt;     		final Map&amp;lt;String, String&amp;gt; tableJsonMapping = new HashMap&amp;lt;&amp;gt;();&lt;br/&gt;
    +		tableJsonMapping.put(&quot;name&quot;, &quot;name&quot;);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    physical schema ==mapping=&amp;gt; &quot;intermediate schema&quot; ==timestamp extraction and projection=&amp;gt; logical schema&lt;br/&gt;
    ```&lt;br/&gt;
    Maybe we should consider eliminating the &quot;intermedia schema&quot; in the future?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qufj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>