<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:31:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-5506] Java 8 - CommunityDetection.java:158 - java.lang.NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/FLINK-5506</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Reporting this here as per Vasia&apos;s advice.&lt;br/&gt;
I am having the following problem while trying out the org.apache.flink.graph.library.CommunityDetection algorithm of the Gelly API (Java).&lt;/p&gt;

&lt;p&gt;Specs: JDK 1.8.0_102 x64&lt;br/&gt;
Apache Flink: 1.1.4&lt;/p&gt;

&lt;p&gt;Suppose I have a very small (I tried an example with 38 vertices as well) dataset stored in a tab-separated file 3-vertex.tsv:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
#id1 id2 score
0    1    0
0    2    0
0    3    0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is just a central vertex with 3 neighbors (disconnected between themselves).&lt;br/&gt;
I am loading the dataset and executing the algorithm with the following code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Load the data from the .tsv file.
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; DataSet&amp;lt;Tuple3&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt;&amp;gt; edgeTuples = env.readCsvFile(inputPath)
                .fieldDelimiter(&lt;span class=&quot;code-quote&quot;&gt;&quot;\t&quot;&lt;/span&gt;) &lt;span class=&quot;code-comment&quot;&gt;// node IDs are separated by spaces
&lt;/span&gt;                .ignoreComments(&lt;span class=&quot;code-quote&quot;&gt;&quot;#&quot;&lt;/span&gt;)  &lt;span class=&quot;code-comment&quot;&gt;// comments start with &lt;span class=&quot;code-quote&quot;&gt;&quot;%&quot;&lt;/span&gt;
&lt;/span&gt;                .types(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.class, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.class, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.class);

&lt;span class=&quot;code-comment&quot;&gt;// Generate a graph and add reverse edges (undirected).
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Graph&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt; graph = Graph.fromTupleDataSet(edgeTuples, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MapFunction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;() {
            &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; serialVersionUID = 8713516577419451509L;
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; map(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; value) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value;
            }
        },
env).getUndirected();

&lt;span class=&quot;code-comment&quot;&gt;// CommunityDetection parameters.
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; hopAttenuationDelta = 0.5d;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; iterationCount = 10;

&lt;span class=&quot;code-comment&quot;&gt;// Prepare and trigger the execution.
&lt;/span&gt;DataSet&amp;lt;Vertex&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;&amp;gt; vs = graph.run(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; org.apache.flink.graph.library.CommunityDetection&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt;(iterationCount, hopAttenuationDelta)).getVertices();

vs.print();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#8203;Running this code throws the following exception&#8203; (check the bold line):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#8203;org.apache.flink.runtime.client.JobExecutionException: Job execution failed.
    at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$8.apply$mcV$sp(JobManager.scala:805)
    at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$8.apply(JobManager.scala:751)
    at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$8.apply(JobManager.scala:751)
    at scala.concurrent.impl.Future$PromiseCompletingRunnable.liftedTree1$1(Future.scala:24)
    at scala.concurrent.impl.Future$PromiseCompletingRunnable.run(Future.scala:24)
    at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:41)
    at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:401)
    at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
    at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.pollAndExecAll(ForkJoinPool.java:1253)
    at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1346)
    at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
    at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
Caused by: java.lang.NullPointerException
    at org.apache.flink.graph.library.CommunityDetection$VertexLabelUpdater.updateVertex(CommunityDetection.java:158)
    at org.apache.flink.graph.spargel.ScatterGatherIteration$GatherUdfSimpleVV.coGroup(ScatterGatherIteration.java:389)
    at org.apache.flink.runtime.operators.CoGroupWithSolutionSetSecondDriver.run(CoGroupWithSolutionSetSecondDriver.java:218)
    at org.apache.flink.runtime.operators.BatchTask.run(BatchTask.java:486)
    at org.apache.flink.runtime.iterative.task.AbstractIterativeTask.run(AbstractIterativeTask.java:146)
    at org.apache.flink.runtime.iterative.task.IterationTailTask.run(IterationTailTask.java:107)
    at org.apache.flink.runtime.operators.BatchTask.invoke(BatchTask.java:351)
    at org.apache.flink.runtime.taskmanager.Task.run(Task.java:642)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)&#8203;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#8203;After a further look, I set a breakpoint (Eclipse IDE debugging) at the line in bold:&lt;/p&gt;

&lt;p&gt;org.apache.flink.graph.library.CommunityDetection.java (source code accessed automatically by Maven)&lt;br/&gt;
// find the highest score of maxScoreLabel&lt;br/&gt;
double highestScore = labelsWithHighestScore.get(maxScoreLabel);&#8203;&lt;/p&gt;

&lt;p&gt;&#8203;- maxScoreLabel has the value 3.&#8203;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;labelsWithHighestScore was initialized as: Map&amp;lt;Long, Double&amp;gt; labelsWithHighestScore = new TreeMap&amp;lt;&amp;gt;();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;labelsWithHighestScore is a TreeMap&amp;lt;Long, Double&amp;gt; and has the values:&lt;/li&gt;
&lt;/ul&gt;


{0=0.0}
&lt;p&gt;null&lt;br/&gt;
null&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;0=0.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
null&lt;br/&gt;
1&#8203;&lt;/p&gt;

&lt;p&gt;&#8203;It seems that the value 3 should have been added to that &#8203;labelsWithHighestScore some time during execution, but because it wasn&apos;t, an exception is thrown.&lt;/p&gt;

&lt;p&gt;In the mailing list, Vasia speculates that the problem is that the implementation assumes that labelsWithHighestScores contains the vertex itself as initial label.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13035200">FLINK-5506</key>
            <summary>Java 8 - CommunityDetection.java:158 - java.lang.NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="greghogan">Greg Hogan</assignee>
                                    <reporter username="mcoimbra">Miguel E. Coimbra</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>starter</label>
                    </labels>
                <created>Mon, 16 Jan 2017 11:48:02 +0000</created>
                <updated>Tue, 1 Nov 2022 09:37:22 +0000</updated>
                            <resolved>Thu, 28 Dec 2017 13:48:00 +0000</resolved>
                                    <version>1.1.4</version>
                    <version>1.3.2</version>
                    <version>1.4.1</version>
                                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.0</fixVersion>
                                    <component>Library / Graph Processing</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>8</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="7200">2h</timeoriginalestimate>
                            <timeestimate seconds="7200">2h</timeestimate>
                                        <comments>
                            <comment id="15971390" author="nssalian" created="Mon, 17 Apr 2017 17:48:36 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mcoimbra&quot; class=&quot;user-hover&quot; rel=&quot;mcoimbra&quot;&gt;mcoimbra&lt;/a&gt; is this still an issue?&lt;/p&gt;</comment>
                            <comment id="16182713" author="luma" created="Wed, 27 Sep 2017 15:12:21 +0000"  >&lt;p&gt;Same problem here with Scala 2.11.8 and Flink 1.3.2:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
val env = ExecutionEnvironment.getExecutionEnvironment
val vertices = env.fromElements((1, 1L), (2, 2L)).map(node =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Vertex[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;](node._1, node._2))
val edges = env.fromElements((1, 2, 1.0d), ((2, 1, 1.0d))).map(edge =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Edge[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;](edge._1, edge._2, edge._3))
val graph: Graph[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;] = Graph.fromDataSet(vertices, edges, env)
val graphWithFinalLabels = graph.run(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CommunityDetection[&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;](10, 0.5))
graphWithFinalLabels.getVertices.print()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.flink.runtime.client.JobExecutionException: Job execution failed.&#160;at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$6.apply$mcV$sp(JobManager.scala:933)&#160;at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$6.apply(JobManager.scala:876)&#160;at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$6.apply(JobManager.scala:876)&#160;at scala.concurrent.impl.Future$PromiseCompletingRunnable.liftedTree1$1(Future.scala:24)&#160;at scala.concurrent.impl.Future$PromiseCompletingRunnable.run(Future.scala:24)&#160;at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:40)&#160;at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:397)&#160;at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)&#160;at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)&#160;at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)&#160;at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)Caused by: java.lang.NullPointerException&#160;at org.apache.flink.graph.library.CommunityDetection$VertexLabelUpdater.updateVertex(CommunityDetection.java:158)&#160;at org.apache.flink.graph.spargel.ScatterGatherIteration$GatherUdfSimpleVV.coGroup(ScatterGatherIteration.java:389)&#160;at org.apache.flink.runtime.operators.CoGroupWithSolutionSetSecondDriver.run(CoGroupWithSolutionSetSecondDriver.java:218)&#160;at org.apache.flink.runtime.operators.BatchTask.run(BatchTask.java:490)&#160;at org.apache.flink.runtime.iterative.task.AbstractIterativeTask.run(AbstractIterativeTask.java:146)&#160;at org.apache.flink.runtime.iterative.task.IterationTailTask.run(IterationTailTask.java:107)&#160;at org.apache.flink.runtime.operators.BatchTask.invoke(BatchTask.java:355)&#160;at org.apache.flink.runtime.taskmanager.Task.run(Task.java:702)&#160;at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16271183" author="hadjinik" created="Wed, 29 Nov 2017 17:37:25 +0000"  >&lt;p&gt;Same issue here. I am running:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;font color=&quot;red&quot;&gt;return &lt;font color=&quot;#205081&quot;&gt;&lt;/font&gt;graph&lt;/font&gt;.run(new CommunityDetection&amp;lt;&amp;gt;(MAX_ITERATIONS_FOR_SEGMENTATION, DELTA))&lt;font color=&quot;&quot;&gt;}}&lt;br/&gt;
&lt;br/&gt;
where my &lt;b&gt;graph&lt;/b&gt; is of type:{{&lt;font color=&quot;#205081&quot;&gt;&lt;/font&gt;Graph&amp;lt;String, Long, Double&amp;gt;&lt;/font&gt;&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;b&gt;graph&lt;/b&gt; is generated with: &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&lt;font color=&quot;#14892c&quot;&gt;Graph.fromDataSet(env.fromCollection(vertices), env.fromCollection(edges), env);&lt;/font&gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;where &lt;b&gt;vertices&lt;/b&gt; are:&lt;tt&gt;&lt;font color=&quot;#14892c&quot;&gt; List&amp;lt;Vertex&amp;lt;String, Long&amp;gt;&amp;gt; vertices&lt;/font&gt;&lt;/tt&gt;&lt;br/&gt;
and edges:{{ &lt;font color=&quot;#14892c&quot;&gt;Set&amp;lt;Edge&amp;lt;String, Double&amp;gt;&amp;gt; edges&lt;/font&gt;}}&lt;/p&gt;

&lt;p&gt;It is worth noting that I am intentionally creating a vertices with distinct Long ids to create List&amp;lt;Vertex&amp;lt;String, Long&amp;gt;&amp;gt; vertices. After running the code I am getting the below &lt;b&gt;nullPointerException&lt;/b&gt;: &lt;br/&gt;
----------------------------&lt;br/&gt;
org.apache.flink.runtime.client.JobExecutionException: Job execution failed.&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$7.apply$mcV$sp(JobManager.scala:933)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$7.apply(JobManager.scala:876)&lt;br/&gt;
	at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$7.apply(JobManager.scala:876)&lt;br/&gt;
	at scala.concurrent.impl.Future$PromiseCompletingRunnable.liftedTree1$1(Future.scala:24)&lt;br/&gt;
	at scala.concurrent.impl.Future$PromiseCompletingRunnable.run(Future.scala:24)&lt;br/&gt;
	at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:40)&lt;br/&gt;
	at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:397)&lt;br/&gt;
	at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)&lt;br/&gt;
	at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)&lt;br/&gt;
	at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)&lt;br/&gt;
	at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at &lt;b&gt;&lt;font color=&quot;#d04437&quot;&gt;org.apache.flink.graph.library.CommunityDetection$VertexLabelUpdater.updateVertex(CommunityDetection.java:158&lt;/font&gt;&lt;/b&gt;)&lt;br/&gt;
	at org.apache.flink.graph.spargel.ScatterGatherIteration$GatherUdfSimpleVV.coGroup(ScatterGatherIteration.java:389)&lt;br/&gt;
	at org.apache.flink.runtime.operators.CoGroupWithSolutionSetSecondDriver.run(CoGroupWithSolutionSetSecondDriver.java:218)&lt;br/&gt;
	at org.apache.flink.runtime.operators.BatchTask.run(BatchTask.java:490)&lt;br/&gt;
	at org.apache.flink.runtime.iterative.task.AbstractIterativeTask.run(AbstractIterativeTask.java:146)&lt;br/&gt;
	at org.apache.flink.runtime.iterative.task.IterationTailTask.run(IterationTailTask.java:107)&lt;br/&gt;
	at org.apache.flink.runtime.operators.BatchTask.invoke(BatchTask.java:355)&lt;br/&gt;
	at org.apache.flink.runtime.taskmanager.Task.run(Task.java:702)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;

&lt;p&gt;Is there a quick fix for this? e.g. initialising vertices directly using their ids as both their ids and values as per Vasia&apos;s advice? Has anyone solved this? Anything else I can try before this is resolved?&lt;/p&gt;</comment>
                            <comment id="16273261" author="rmetzger" created="Thu, 30 Nov 2017 19:37:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=greghogan&quot; class=&quot;user-hover&quot; rel=&quot;greghogan&quot;&gt;greghogan&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vkalavri&quot; class=&quot;user-hover&quot; rel=&quot;vkalavri&quot;&gt;vkalavri&lt;/a&gt; do you have an idea how to work around or resolve this issue?&lt;/p&gt;</comment>
                            <comment id="16274340" author="vkalavri" created="Fri, 1 Dec 2017 12:46:17 +0000"  >&lt;p&gt;I only had a quick look at the code; I will need to re-read the paper to make sure the algorithm semantics are correct with the following:&lt;br/&gt;
I believe the problem is line 147 in &lt;tt&gt;CommunityDetection.java&lt;/tt&gt;. The code assumes we have received only positive scores, while negative ones are indeed possible. Changing this line to &lt;tt&gt;double maxScore = -Double.MAX_VALUE;&lt;/tt&gt; should fix it.&lt;/p&gt;</comment>
                            <comment id="16274596" author="hadjinik" created="Fri, 1 Dec 2017 16:38:37 +0000"  >&lt;p&gt;Just to note that I have tried running the algorithm with different graph types, e.g. using Graph&amp;lt;Long, Long, Double&amp;gt; but I keep hitting against the same error message. &lt;/p&gt;

&lt;p&gt;Looking into the source code I can see that necessary precautions are taken to guarantee that:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;labelsWithHighestScore.get(maxScoreLabel);&#8203;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;won&apos;t be null. So, this possibly suggests that it&apos;s an issue concerned with asychronous calls to the thread, i.e. the getter is somehow called prior initialisation of &lt;tt&gt;labelsWithHighestScoret&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Hope this helps,&lt;/p&gt;

&lt;p&gt;Christos&lt;/p&gt;</comment>
                            <comment id="16279261" author="githubbot" created="Tue, 5 Dec 2017 22:04:48 +0000"  >&lt;p&gt;GitHub user greghogan opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5506&quot; title=&quot;Java 8 - CommunityDetection.java:158 - java.lang.NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5506&quot;&gt;&lt;del&gt;FLINK-5506&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;gelly&amp;#93;&lt;/span&gt; Fix CommunityDetection NullPointerException&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This fixes a regression which can result in `NullPointerException` when running the `CommunityDetection` algorithm. When a new highest valued label had a negative summed value the lookup was performed on the old label value which did not necessarily exist in the dictionary.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;replaced `Double.MIN_VALUE` with the intended (and original) `-Double.MAX_VALUE`&lt;/li&gt;
	&lt;li&gt;added `Graph#mapVertices` and `Graph#mapEdges` variants accepting `TypeHint` rather than `TypeInformation`; this seemed useful when using Java 8 lambdas which require explicit type definition with OpenJDK&lt;/li&gt;
	&lt;li&gt;added additional tests for `CommunityDetection`&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    `CommunityDetectionTest#testWithSingletonEdgeGraph` is a user supplied example which fails without the bug fix.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (*&lt;b&gt;not applicable&lt;/b&gt;* / docs / JavaDocs / not documented)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/greghogan/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/greghogan/flink&lt;/a&gt; 5506_communitydetection_nullpointerexception&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5126.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5126.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5126&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8d57371616a742ba29548192d5d8a4018cafd26b&lt;br/&gt;
Author: Greg Hogan &amp;lt;code@greghogan.com&amp;gt;&lt;br/&gt;
Date:   2017-12-05T17:36:18Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;gelly&amp;#93;&lt;/span&gt; Graph API mapVertices/mapEdges with TypeHint&lt;/p&gt;

&lt;p&gt;commit 8c131b42cfa95df34333a9ca733c9337f75695ba&lt;br/&gt;
Author: Greg Hogan &amp;lt;code@greghogan.com&amp;gt;&lt;br/&gt;
Date:   2017-12-05T17:38:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5506&quot; title=&quot;Java 8 - CommunityDetection.java:158 - java.lang.NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-5506&quot;&gt;&lt;del&gt;FLINK-5506&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;gelly&amp;#93;&lt;/span&gt; Fix CommunityDetection NullPointerException&lt;/p&gt;

&lt;p&gt;    Double.MIN_VALUE != min(double)&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16290667" author="hadjinik" created="Thu, 14 Dec 2017 10:16:07 +0000"  >&lt;p&gt;I have manually changed the source code as per @greghogan pull requests and the pipeline now works like a charm. &lt;/p&gt;

&lt;p&gt;Thanks for the help @greghogan, @vasia. &lt;/p&gt;</comment>
                            <comment id="16293052" author="githubbot" created="Fri, 15 Dec 2017 19:10:28 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Just a comment on the use of `TypeHint`:&lt;/p&gt;

&lt;p&gt;    In the `DataSet` and `DataStream` API, we typically pass `TypeInformation` when offering an explicit way to describe the type. The reason is that `TypeInformation` is the core class to describe types, and when you pick up the type from somewhere to pass it on, you get a `TypeInformation`.&lt;/p&gt;

&lt;p&gt;    The `TypeHint` class is used as a trick to create a `TypeInformation` by capturing the parameters through creating an anonymous subclass. In some way, one could always use `new TypeHint&amp;lt;Tuple2&amp;lt;Long, String&amp;gt;&amp;gt;(){}.getTypeInfo()`, but for convenience, some methods accept directly a `TypeHint`, mainly the `returns(...)` method.&lt;/p&gt;

&lt;p&gt;    If you take `TypeHint` directly as a parameter, it becomes hard to pass the type if you for example obtain it from another `DataSet` via the `getType()` method.&lt;/p&gt;</comment>
                            <comment id="16298563" author="githubbot" created="Wed, 20 Dec 2017 14:18:47 +0000"  >&lt;p&gt;Github user greghogan commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StephanEwen thanks for the tip. I&apos;ll remove the added `TypeHint` methods and commit to 1.4 and 1.5.&lt;/p&gt;</comment>
                            <comment id="16301828" author="githubbot" created="Fri, 22 Dec 2017 19:14:14 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5126&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16305458" author="greghogan" created="Thu, 28 Dec 2017 13:48:00 +0000"  >&lt;p&gt;master: a355df6e33f402beac01c2908cb0c64cfeccadb2&lt;br/&gt;
release-1.4: 96051e516bdc114b04c5a3cbb75874c420e27e7b&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 46 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38rcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>