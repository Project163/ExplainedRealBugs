<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:33:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9295] FlinkKafkaProducer011 sometimes throws ProducerFencedExceptions when in EXACTLY_ONCE mode</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9295</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;FlinkKafkaProducer011&lt;/tt&gt; can throw &lt;tt&gt;ProducerFencedExceptions&lt;/tt&gt; if multiple sinks are used within the same sub-task.&#160; This can happen when operator-chaining results in two different sinks in the same topology being chained into a task, and thus into each of its sub-tasks.&lt;/p&gt;

&lt;p&gt;The problem is&#160;that &lt;tt&gt;TransactionIdsGenerator&lt;/tt&gt;&#160;only takes into account the task name, the subtask index, the number of subtasks, and a couple of other things.&#160; All the attributes are the same between different &lt;tt&gt;FlinkKafkaProducer011s&lt;/tt&gt;&#160;within the same sub-task, so they get the same transaction ids and one of them ends up failing.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13156905">FLINK-9295</key>
            <summary>FlinkKafkaProducer011 sometimes throws ProducerFencedExceptions when in EXACTLY_ONCE mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pnowojski">Piotr Nowojski</assignee>
                                    <reporter username="facboy">Christopher Ng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 May 2018 16:24:19 +0000</created>
                <updated>Tue, 22 May 2018 11:56:59 +0000</updated>
                            <resolved>Tue, 22 May 2018 11:56:59 +0000</resolved>
                                    <version>1.4.2</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16468761" author="githubbot" created="Wed, 9 May 2018 12:17:50 +0000"  >&lt;p&gt;GitHub user pnowojski opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9295&quot; title=&quot;FlinkKafkaProducer011 sometimes throws ProducerFencedExceptions when in EXACTLY_ONCE mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9295&quot;&gt;&lt;del&gt;FLINK-9295&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Fix transactional.id collisions for FlinkKafkaProducer011&lt;/p&gt;

&lt;p&gt;    Previously if there were two completely independent FlinkKafkaProducer011 data sinks in the job graph, their transactional.id would collide with one another. Fix is to use operator&apos;s unique ID as well along task name and subtask id.&lt;/p&gt;

&lt;p&gt;    In order to do that, operator&apos;s unique ID has to be exposed to UDF via `RuntimeContext`.&lt;/p&gt;

&lt;p&gt;    This change is backward compatible for recovering from older savepoints, since transactional.ids generated by the old generator still will be used after restoring from state.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Please check individual commit messages&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change adds a new `FlinkKafaProducer011` test case that covers bug fix.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (*&lt;b&gt;yes&lt;/b&gt;* / no)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (*&lt;b&gt;yes&lt;/b&gt;* / no)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable / docs / *&lt;b&gt;JavaDocs&lt;/b&gt;* / not documented)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/pnowojski/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pnowojski/flink&lt;/a&gt; f9295&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #5977&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f7ee017f7e87d96182c859ad4c7849e93785e3e9&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@...&amp;gt;&lt;br/&gt;
Date:   2018-05-09T09:12:18Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Introduce MockEnvironmentBuilder to deduplicate MockEnvironment constructors&lt;/p&gt;

&lt;p&gt;commit c19c56205846c13ef33f436ea49eabd5eb670408&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@...&amp;gt;&lt;br/&gt;
Date:   2018-05-09T09:29:18Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;tests&amp;#93;&lt;/span&gt; Reduce mockito usage in tests&lt;/p&gt;

&lt;p&gt;commit fa5bc99c3029f6fe4b772ee9b0f73dd42fcc445a&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@...&amp;gt;&lt;br/&gt;
Date:   2018-05-08T15:46:29Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9316&quot; title=&quot;Expose operator unique ID to the user defined functions in DataStream .&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9316&quot;&gt;&lt;del&gt;FLINK-9316&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;streaming&amp;#93;&lt;/span&gt; Expose operator&apos;s unique ID in DataStream programs&lt;/p&gt;

&lt;p&gt;    This allows to uniquely and stably across multiple job submissions identify operators.&lt;br/&gt;
    Previously two different operators that were executed by tasks that had the same name&lt;br/&gt;
    were indistinguishable.&lt;/p&gt;

&lt;p&gt;commit fe34837a820b8c3db0b758a2a1cdcafaed1813e8&lt;br/&gt;
Author: Piotr Nowojski &amp;lt;piotr.nowojski@...&amp;gt;&lt;br/&gt;
Date:   2018-05-08T15:49:31Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9295&quot; title=&quot;FlinkKafkaProducer011 sometimes throws ProducerFencedExceptions when in EXACTLY_ONCE mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9295&quot;&gt;&lt;del&gt;FLINK-9295&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Fix two transactional.id collisions for FlinkKafkaProducer011&lt;/p&gt;

&lt;p&gt;    Previously if there were two completely independent FlinkKafkaProducer011 data sinks&lt;br/&gt;
    in the job graph, their transactional.id would collide with one another. Fix is to&lt;br/&gt;
    use operator&apos;s unique ID as well along task name and subtask id.&lt;/p&gt;

&lt;p&gt;    This change requires backwardcompatibility check for recovering from older savepoints.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16469980" author="githubbot" created="Thu, 10 May 2018 06:32:24 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r187250723&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r187250723&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/test/java/org/apache/flink/streaming/util/MockStreamConfig.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,35 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
    + * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
    + * this work for additional information regarding copyright ownership.&lt;br/&gt;
    + * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
    + * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
    + * the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.streaming.util;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.base.IntSerializer;&lt;br/&gt;
    +import org.apache.flink.configuration.Configuration;&lt;br/&gt;
    +import org.apache.flink.runtime.jobgraph.OperatorID;&lt;br/&gt;
    +import org.apache.flink.streaming.api.graph.StreamConfig;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Handy mock for &lt;/p&gt;
{@link StreamConfig}
&lt;p&gt;.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class MockStreamConfig extends StreamConfig {&lt;br/&gt;
    +	public MockStreamConfig() {&lt;br/&gt;
    +		super(new Configuration());&lt;br/&gt;
    +&lt;br/&gt;
    +		setTypeSerializerIn1(IntSerializer.INSTANCE);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    not sure about this one. I would expect a `MockStreamConfig` to be generally usable, but this one can mess things up in regards to serializers. I&apos;d just remove the mocking and replace it with &lt;br/&gt;
    ```&lt;br/&gt;
    StreamConfig streamConfig = new StreamConfig();&lt;br/&gt;
    streamConfig.setTypeSerializerIn1(IntSerializer.INSTANCE);&lt;br/&gt;
    ```&lt;/p&gt;</comment>
                            <comment id="16471789" author="githubbot" created="Fri, 11 May 2018 11:52:31 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r187592761&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r187592761&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-streaming-java/src/test/java/org/apache/flink/streaming/util/MockStreamConfig.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,35 @@&lt;br/&gt;
    +/*&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
    + * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
    + * this work for additional information regarding copyright ownership.&lt;br/&gt;
    + * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
    + * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
    + * the License.  You may obtain a copy of the License at&lt;br/&gt;
    + *&lt;br/&gt;
    + *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
    + *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
    + * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
    + * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
    + * See the License for the specific language governing permissions and&lt;br/&gt;
    + * limitations under the License.&lt;br/&gt;
    + */&lt;br/&gt;
    +&lt;br/&gt;
    +package org.apache.flink.streaming.util;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.flink.api.common.typeutils.base.IntSerializer;&lt;br/&gt;
    +import org.apache.flink.configuration.Configuration;&lt;br/&gt;
    +import org.apache.flink.runtime.jobgraph.OperatorID;&lt;br/&gt;
    +import org.apache.flink.streaming.api.graph.StreamConfig;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * Handy mock for &lt;/p&gt;
{@link StreamConfig}
&lt;p&gt;.&lt;br/&gt;
    + */&lt;br/&gt;
    +public class MockStreamConfig extends StreamConfig {&lt;br/&gt;
    +	public MockStreamConfig() {&lt;br/&gt;
    +		super(new Configuration());&lt;br/&gt;
    +&lt;br/&gt;
    +		setTypeSerializerIn1(IntSerializer.INSTANCE);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Good point, fixed.&lt;/p&gt;</comment>
                            <comment id="16472055" author="githubbot" created="Fri, 11 May 2018 14:59:06 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r187640541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r187640541&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/functions/RuntimeContext.java &amp;#8212;&lt;br/&gt;
    @@ -71,6 +71,17 @@&lt;br/&gt;
     	@PublicEvolving&lt;br/&gt;
     	MetricGroup getMetricGroup();&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Returned value is guaranteed to be unique between operators within the same job and to be&lt;br/&gt;
    +	 * stable and the same across job submissions.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;This operation is currently only supported in Streaming (DataStream) contexts.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return String representation of the operator&apos;s unique id.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@PublicEvolving&lt;br/&gt;
    +	String getOperatorUniqueID();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Rather than adding this here and failing for &lt;b&gt;DataSet&lt;/b&gt; programs, hoe about adding this to `StreamingRuntimeContext` and casting inside the Kafka Producer? Not super pretty, but nicer than having something that looks like a pretty generic concept (operator id) throwing an exception in a whole class of programs (batch jobs). This problem should go away anyways with the batch / streaming unification later.&lt;/p&gt;</comment>
                            <comment id="16472056" author="githubbot" created="Fri, 11 May 2018 14:59:07 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r187639708&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r187639708&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -837,7 +837,7 @@ public void initializeState(FunctionInitializationContext context) throws Except&lt;br/&gt;
     		nextTransactionalIdHintState = context.getOperatorStateStore().getUnionListState(&lt;br/&gt;
     			NEXT_TRANSACTIONAL_ID_HINT_DESCRIPTOR);&lt;br/&gt;
     		transactionalIdsGenerator = new TransactionalIdsGenerator(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getRuntimeContext().getTaskName(),&lt;br/&gt;
    +			getRuntimeContext().getTaskName() + &quot;-&quot; + getRuntimeContext().getOperatorUniqueID(),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    You could probably use only the Operator ID here - the task name does not add to the uniqueness. Unless the purpose of the task name is &quot;human readability&quot; in log files or metrics.&lt;/p&gt;</comment>
                            <comment id="16472085" author="githubbot" created="Fri, 11 May 2018 15:17:48 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r187645022&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r187645022&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-connectors/flink-connector-kafka-0.11/src/main/java/org/apache/flink/streaming/connectors/kafka/FlinkKafkaProducer011.java &amp;#8212;&lt;br/&gt;
    @@ -837,7 +837,7 @@ public void initializeState(FunctionInitializationContext context) throws Except&lt;br/&gt;
     		nextTransactionalIdHintState = context.getOperatorStateStore().getUnionListState(&lt;br/&gt;
     			NEXT_TRANSACTIONAL_ID_HINT_DESCRIPTOR);&lt;br/&gt;
     		transactionalIdsGenerator = new TransactionalIdsGenerator(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getRuntimeContext().getTaskName(),&lt;br/&gt;
    +			getRuntimeContext().getTaskName() + &quot;-&quot; + getRuntimeContext().getOperatorUniqueID(),
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Yes, I wanted to keep the task name for the readability reasons.&lt;/p&gt;</comment>
                            <comment id="16472086" author="githubbot" created="Fri, 11 May 2018 15:17:48 +0000"  >&lt;p&gt;Github user pnowojski commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r187646041&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r187646041&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/functions/RuntimeContext.java &amp;#8212;&lt;br/&gt;
    @@ -71,6 +71,17 @@&lt;br/&gt;
     	@PublicEvolving&lt;br/&gt;
     	MetricGroup getMetricGroup();&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Returned value is guaranteed to be unique between operators within the same job and to be&lt;br/&gt;
    +	 * stable and the same across job submissions.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;This operation is currently only supported in Streaming (DataStream) contexts.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return String representation of the operator&apos;s unique id.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@PublicEvolving&lt;br/&gt;
    +	String getOperatorUniqueID();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Probably better solution from the perspective of this particular use case, but do the UDF&apos;s have an access to `StreamingRuntimeContext`? If not, casting requirement would be huge blocker for any users from using this, thus making this almost a private API.&lt;/p&gt;

&lt;p&gt;    However I do not mind one way or the other.&lt;/p&gt;

&lt;p&gt;    PS, There are already operations/methods that do not work in streaming/batch&lt;/p&gt;</comment>
                            <comment id="16475494" author="githubbot" created="Tue, 15 May 2018 08:34:20 +0000"  >&lt;p&gt;Github user tzulitai commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r188205000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r188205000&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/functions/RuntimeContext.java &amp;#8212;&lt;br/&gt;
    @@ -71,6 +71,17 @@&lt;br/&gt;
     	@PublicEvolving&lt;br/&gt;
     	MetricGroup getMetricGroup();&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Returned value is guaranteed to be unique between operators within the same job and to be&lt;br/&gt;
    +	 * stable and the same across job submissions.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;This operation is currently only supported in Streaming (DataStream) contexts.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return String representation of the operator&apos;s unique id.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@PublicEvolving&lt;br/&gt;
    +	String getOperatorUniqueID();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I&apos;m slightly leaning towards Stephan&apos;s suggestion, which I also agree is the better solution for this case.&lt;/p&gt;

&lt;p&gt;    It might be ok to have this as a &quot;hidden&quot; API for now anyways, since 1) it is marked `@PublicEvolving`, and 2) the API was added in quite a short timeframe.&lt;br/&gt;
    If we want this fix in 1.5, I wouldn&apos;t suggest &quot;fully&quot; exposing it.&lt;/p&gt;</comment>
                            <comment id="16475540" author="githubbot" created="Tue, 15 May 2018 09:24:59 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r188220497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r188220497&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/functions/RuntimeContext.java &amp;#8212;&lt;br/&gt;
    @@ -71,6 +71,17 @@&lt;br/&gt;
     	@PublicEvolving&lt;br/&gt;
     	MetricGroup getMetricGroup();&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Returned value is guaranteed to be unique between operators within the same job and to be&lt;br/&gt;
    +	 * stable and the same across job submissions.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;This operation is currently only supported in Streaming (DataStream) contexts.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return String representation of the operator&apos;s unique id.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@PublicEvolving&lt;br/&gt;
    +	String getOperatorUniqueID();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I slightly prefer the current approach. Looking at other methods, this seems to be the &quot;established&quot; way for methods that do not exist in batch. Why mixing up two different ways of dealing with them? &lt;/p&gt;</comment>
                            <comment id="16475542" author="githubbot" created="Tue, 15 May 2018 09:26:53 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r188221002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r188221002&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/functions/RuntimeContext.java &amp;#8212;&lt;br/&gt;
    @@ -71,6 +71,17 @@&lt;br/&gt;
     	@PublicEvolving&lt;br/&gt;
     	MetricGroup getMetricGroup();&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Returned value is guaranteed to be unique between operators within the same job and to be&lt;br/&gt;
    +	 * stable and the same across job submissions.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;This operation is currently only supported in Streaming (DataStream) contexts.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return String representation of the operator&apos;s unique id.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@PublicEvolving&lt;br/&gt;
    +	String getOperatorUniqueID();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Different point here, I think we would usually like to return `OperatorID` here and not string, but it is probably in a wrong module. When moving `OperatorID` seems to much, I would suggest to call the method something like `getOperatorIDAsString` to make this a bit more explicit.&lt;/p&gt;</comment>
                            <comment id="16475543" author="githubbot" created="Tue, 15 May 2018 09:27:10 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Overall LGTM &#128077; &lt;/p&gt;</comment>
                            <comment id="16477855" author="githubbot" created="Wed, 16 May 2018 18:22:58 +0000"  >&lt;p&gt;Github user StephanEwen commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977#discussion_r188725700&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977#discussion_r188725700&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/api/common/functions/RuntimeContext.java &amp;#8212;&lt;br/&gt;
    @@ -71,6 +71,17 @@&lt;br/&gt;
     	@PublicEvolving&lt;br/&gt;
     	MetricGroup getMetricGroup();&lt;/p&gt;

&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * Returned value is guaranteed to be unique between operators within the same job and to be&lt;br/&gt;
    +	 * stable and the same across job submissions.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * &amp;lt;p&amp;gt;This operation is currently only supported in Streaming (DataStream) contexts.&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @return String representation of the operator&apos;s unique id.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	@PublicEvolving&lt;br/&gt;
    +	String getOperatorUniqueID();&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I am still much in favor of not exposing this in the RuntimeContext:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Having the state accesses in the RuntimeContext was a necessity of that moment, because there was no `initializeState()` and it is crucial to be exposed to users.&lt;/li&gt;
	&lt;li&gt;This operatorID is not crucial to be exposed to users, hence a very different case to me.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It is super easy to expose it later, it is much harder (even if marked as PublicEvolving) to hide it later. For a quick move, not exposing an addition publicly should always be the default choice, also beyond this specific case here.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="16478962" author="githubbot" created="Thu, 17 May 2018 12:09:42 +0000"  >&lt;p&gt;Github user pnowojski commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I have removed `getOperatorUniqueID()` from `RuntimeContext` and our `FlinkKafkaProducer011` is now casting `RuntimeContext` to `StreamingRuntimeContext`.&lt;/p&gt;</comment>
                            <comment id="16483627" author="githubbot" created="Tue, 22 May 2018 08:11:05 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the update @pnowojski.&lt;br/&gt;
    Changes LGTM, +1.&lt;/p&gt;

&lt;p&gt;    Merging this ..&lt;/p&gt;</comment>
                            <comment id="16483664" author="githubbot" created="Tue, 22 May 2018 08:45:38 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/5977&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/5977&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16483758" author="tzulitai" created="Tue, 22 May 2018 10:21:02 +0000"  >&lt;p&gt;Merged, via&lt;/p&gt;

&lt;p&gt;1.6.0 -&#160;9b7493d143add477fbfd230ea312270b26e45d85&lt;br/&gt;
1.5.1 -&#160;9d0cd5848d2eb620263dbb65c8ceb611fa440875&lt;/p&gt;</comment>
                            <comment id="16483831" author="pnowojski" created="Tue, 22 May 2018 11:56:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=facboy&quot; class=&quot;user-hover&quot; rel=&quot;facboy&quot;&gt;facboy&lt;/a&gt; I&apos;m closing the issue. Once 1.5.0 is released, you can make sure that the problem do not appear again.&#160;&#160;&lt;/p&gt;

&lt;p&gt;Thanks again for reporting the problem.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tzulitai&quot; class=&quot;user-hover&quot; rel=&quot;tzulitai&quot;&gt;tzulitai&lt;/a&gt;, because of canceled 1.5.0 RC4&#160;vote, this issue will make it to the 1.5.0 after all &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13157932">FLINK-9316</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tb7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>