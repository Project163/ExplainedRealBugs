<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9762] CoreOptions.TMP_DIRS wrongly managed on Yarn</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9762</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The issue on Yarn is that it is impossible to have different LOCAL_DIRS on JobManager and TaskManager, despite LOCAL_DIRS value depends on the container.&lt;/p&gt;

&lt;p&gt;The issue is that CoreOptions.TMP_DIRS is configured to the default value during JobManager initialization and added to the configuration object. When TaskManager is launched the appropriate configuration object is cloned with LOCAL_DIRS which makes sense only for Job Manager container. When YARN container with TaskManager from his point of view CoreOptions.TMP_DIRS is always equal either to path in flink.yml or to the or to the LOCAL_DIRS of Job Manager (default behaviour). Is TaskManager&#8217;s container do not have an access to another folders, that folders allocated by YARN TaskManager cannot be started.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13170237">FLINK-9762</key>
            <summary>CoreOptions.TMP_DIRS wrongly managed on Yarn</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Oleksandr Nitavskyi">Oleksandr Nitavskyi</assignee>
                                    <reporter username="Oleksandr Nitavskyi">Oleksandr Nitavskyi</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 5 Jul 2018 10:51:25 +0000</created>
                <updated>Tue, 24 Jul 2018 16:34:08 +0000</updated>
                            <resolved>Thu, 19 Jul 2018 11:42:19 +0000</resolved>
                                    <version>1.5.0</version>
                                    <fixVersion>1.5.2</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16536737" author="githubbot" created="Mon, 9 Jul 2018 09:55:15 +0000"  >&lt;p&gt;GitHub user JTaky opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9762&quot; title=&quot;CoreOptions.TMP_DIRS wrongly managed on Yarn&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9762&quot;&gt;&lt;del&gt;FLINK-9762&lt;/del&gt;&lt;/a&gt; CoreOptions.TMP_DIRS (&apos;io.tmp.dirs&apos;) wrongly managed on Yarn&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    Currently TMP_DIRS (io.tmp.dirs) option has a bug in case of default behaviour on Yarn platform:&lt;br/&gt;
    If not value has been set via parameter on Yarn platform the env value &apos;LOCAL_DIRS&apos; is used on Application Master.&lt;br/&gt;
    When task manager is started this &apos;LOCAL_DIRS&apos; is passed to the TaskManager, so TaskManager do not understand that he needs to have a default behaviour.&lt;br/&gt;
    The proposed ~&lt;sub&gt;hack&lt;/sub&gt;~ fix is to remove TMP_DIRS value in case if default behaviour is required before starting TaskManager.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul&gt;
	&lt;li&gt;Extract method which set &lt;em&gt;io.tmp.dirs&lt;/em&gt; configuration value&lt;/li&gt;
	&lt;li&gt;Fix configuration pass to TaskManager (*&lt;b&gt;I am not sure what is the best way to implement this&lt;/b&gt;*):
	&lt;ul&gt;
		&lt;li&gt;Add a new flag, saying &lt;em&gt;io.tmp.dirs&lt;/em&gt; is value has been overridden&lt;/li&gt;
		&lt;li&gt;If &lt;em&gt;io.tmp.dirs&lt;/em&gt; has &lt;b&gt;not&lt;/b&gt; been overridden we remove &lt;em&gt;io.tmp.dirs&lt;/em&gt; remove config value, by setting the empty value (should we remove? clone without a given key?)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Correction of the documentation&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    This change is already covered by existing tests, such as MiniClusterResource for Mesos part.&lt;br/&gt;
    1. I do not see a way to test launching of the TaskManager with a correct configuration.&lt;br/&gt;
    2. A unit test documenting specific logic of TMP_DIRS managing is added: BootstrapToolsTest#testSetTmpDirectoriesConfig&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): no&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: no&lt;/li&gt;
	&lt;li&gt;The serializers: no&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): no&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: no&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: no&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? no&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/JTaky/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/JTaky/flink&lt;/a&gt; tmpDirs&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6284&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d0c0bf7682843947bd1cfdf27775eb75c2864232&lt;br/&gt;
Author: Oleksandr Nitavskyi &amp;lt;o.nitavskyi@...&amp;gt;&lt;br/&gt;
Date:   2018-07-02T07:42:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9762&quot; title=&quot;CoreOptions.TMP_DIRS wrongly managed on Yarn&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9762&quot;&gt;&lt;del&gt;FLINK-9762&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; Extract method: tmp dirs setting&lt;/p&gt;

&lt;p&gt;commit 99bdeb924a2bf91eab39462ac8253ee79dcb1137&lt;br/&gt;
Author: Oleksandr Nitavskyi &amp;lt;o.nitavskyi@...&amp;gt;&lt;br/&gt;
Date:   2018-07-02T08:06:56Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9762&quot; title=&quot;CoreOptions.TMP_DIRS wrongly managed on Yarn&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9762&quot;&gt;&lt;del&gt;FLINK-9762&lt;/del&gt;&lt;/a&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;yarn&amp;#93;&lt;/span&gt; Fix TMP_DIRS configuration passing&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;HACK: Instead of removing set value as empty&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;commit 2fd5754209508e082e4678e8605a25e3d25f8209&lt;br/&gt;
Author: Oleksandr Nitavskyi &amp;lt;o.nitavskyi@...&amp;gt;&lt;br/&gt;
Date:   2018-07-09T09:15:14Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9762&quot; title=&quot;CoreOptions.TMP_DIRS wrongly managed on Yarn&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9762&quot;&gt;&lt;del&gt;FLINK-9762&lt;/del&gt;&lt;/a&gt; correct documenatation for &apos;io.tmp.dirs&apos; config&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16538442" author="githubbot" created="Tue, 10 Jul 2018 11:40:48 +0000"  >&lt;p&gt;Github user yanghua commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    find related test error, please recheck~&lt;/p&gt;</comment>
                            <comment id="16541869" author="githubbot" created="Thu, 12 Jul 2018 16:10:08 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202075077&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202075077&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java &amp;#8212;&lt;br/&gt;
    @@ -181,12 +181,17 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The config parameter defining the directories for temporary files, separated by&lt;/li&gt;
	&lt;li&gt;&quot;,&quot;, &quot;|&quot;, or the system&apos;s 
{@link java.io.File#pathSeparator}
&lt;p&gt;.&lt;br/&gt;
     	 */&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Documentation.OverrideDefault(&quot;System.getProperty(\&quot;java.io.tmpdir\&quot;)&quot;)&lt;br/&gt;
    +	@Documentation.OverrideDefault(&quot;&apos;LOCAL_DIRS&apos; on Yarn and &apos;_FLINK_TMP_DIR&apos; on Mesos.&quot;)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    We should also keep saying that in the standalone mode we use `System.getProperty(&quot;java.io.tmpdir&quot;)`&lt;/p&gt;</comment>
                            <comment id="16541870" author="githubbot" created="Thu, 12 Jul 2018 16:10:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202082557&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202082557&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/BootstrapTools.java &amp;#8212;&lt;br/&gt;
    @@ -467,4 +471,22 @@ public static String getStartCommand(String template,&lt;br/&gt;
     		}&lt;br/&gt;
     		return template;&lt;br/&gt;
     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Set temporary configuration directories if necesary&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param configuration flink config to patch&lt;br/&gt;
    +	 * @param defaultDirs in case no tmp directories is set, next directories will be applied&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void setTmpDirectoriesConfig(Configuration configuration, String defaultDirs){&lt;br/&gt;
    +		if (configuration.contains(CoreOptions.TMP_DIRS) &amp;amp;&amp;amp; !configuration.getString(CoreOptions.TMP_DIRS).isEmpty()) {&lt;br/&gt;
    +			LOG.info(&quot;Overriding Fink&apos;s temporary file directories with those &quot; +&lt;br/&gt;
    +				&quot;specified in the Flink config: &quot; + configuration.getValue(CoreOptions.TMP_DIRS));&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Should use logging placeholder `{}`&lt;/p&gt;</comment>
                            <comment id="16541871" author="githubbot" created="Thu, 12 Jul 2018 16:10:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202084291&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202084291&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/BootstrapTools.java &amp;#8212;&lt;br/&gt;
    @@ -467,4 +471,22 @@ public static String getStartCommand(String template,&lt;br/&gt;
     		}&lt;br/&gt;
     		return template;&lt;br/&gt;
     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Set temporary configuration directories if necesary&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param configuration flink config to patch&lt;br/&gt;
    +	 * @param defaultDirs in case no tmp directories is set, next directories will be applied&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void setTmpDirectoriesConfig(Configuration configuration, String defaultDirs){&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Should we maybe call it `updateTmpDirectoriesInConfiguration`?&lt;/p&gt;</comment>
                            <comment id="16541872" author="githubbot" created="Thu, 12 Jul 2018 16:10:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202090987&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202090987&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -473,8 +474,13 @@ private ContainerLaunchContext createTaskExecutorLaunchContext(Resource resource&lt;/p&gt;

&lt;p&gt;     		log.debug(&quot;TaskManager configuration: {}&quot;, flinkConfig);&lt;/p&gt;

&lt;p&gt;    +		Configuration taskManagerConfig = flinkConfig.clone();&lt;br/&gt;
    +		if (!flinkConfig.containsKey(CoreOptions.TMP_DIRS_OVERRIDDEN))&lt;/p&gt;
{
    +			taskManagerConfig.setString(CoreOptions.TMP_DIRS, &quot;&quot;);	// HACK: emulate removal for the given key
    +		}
&lt;p&gt;    +&lt;br/&gt;
     		ContainerLaunchContext taskExecutorLaunchContext = Utils.createTaskExecutorContext(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkConfig,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    here we should keep the `flinkConfig` and instead replace the 5th argument with `taskManagerConfig` because it is this `Configuration` which is given to the new `TaskManager` container.&lt;/p&gt;</comment>
                            <comment id="16541873" author="githubbot" created="Thu, 12 Jul 2018 16:10:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202087890&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202087890&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -473,8 +474,13 @@ private ContainerLaunchContext createTaskExecutorLaunchContext(Resource resource&lt;/p&gt;

&lt;p&gt;     		log.debug(&quot;TaskManager configuration: {}&quot;, flinkConfig);&lt;/p&gt;

&lt;p&gt;    +		Configuration taskManagerConfig = flinkConfig.clone();&lt;br/&gt;
    +		if (!flinkConfig.containsKey(CoreOptions.TMP_DIRS_OVERRIDDEN))&lt;/p&gt;
{
    +			taskManagerConfig.setString(CoreOptions.TMP_DIRS, &quot;&quot;);	// HACK: emulate removal for the given key
    +		}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Replace with `BootstratpTools#cloneConfiguration(Configuration)` in order to reduce code duplication.&lt;/p&gt;</comment>
                            <comment id="16541874" author="githubbot" created="Thu, 12 Jul 2018 16:10:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202087570&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202087570&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/BootstrapTools.java &amp;#8212;&lt;br/&gt;
    @@ -250,6 +250,10 @@ public static Configuration generateTaskManagerConfiguration(&lt;br/&gt;
     			cfg.setInteger(TaskManagerOptions.NUM_TASK_SLOTS, numSlots);&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		if (!baseConfig.containsKey(CoreOptions.TMP_DIRS_OVERRIDDEN))&lt;/p&gt;
{
    +			cfg.setString(CoreOptions.TMP_DIRS, &quot;&quot;);	// HACK: emulate removal for the given key
    +		}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I would suggest to add a `BootstratpTools#cloneConfiguration(Configuration)` method which clones the given `Configuration` and resets all node specific fields. One of these fields is `CoreOptions#TMP_DIRS`. This means if `USE_LOCAL_DEFAULT_TMP_DIRS` is true, then we clear the `TMP_DIRS` option. We actually need for that a `Configuration#clear(ConfigOption)` method which removes the option entry from `Configuration#confData`. Otherwise we might risk that we don&apos;t use the TMP_DIRS default value but instead `&quot;&quot;` if there are no local default tmp dirs.&lt;/p&gt;</comment>
                            <comment id="16541875" author="githubbot" created="Thu, 12 Jul 2018 16:10:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202086059&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202086059&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java &amp;#8212;&lt;br/&gt;
    @@ -181,12 +181,17 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The config parameter defining the directories for temporary files, separated by&lt;/li&gt;
	&lt;li&gt;&quot;,&quot;, &quot;|&quot;, or the system&apos;s 
{@link java.io.File#pathSeparator}
&lt;p&gt;.&lt;br/&gt;
     	 */&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Documentation.OverrideDefault(&quot;System.getProperty(\&quot;java.io.tmpdir\&quot;)&quot;)&lt;br/&gt;
    +	@Documentation.OverrideDefault(&quot;&apos;LOCAL_DIRS&apos; on Yarn and &apos;_FLINK_TMP_DIR&apos; on Mesos.&quot;)&lt;br/&gt;
     	public static final ConfigOption&amp;lt;String&amp;gt; TMP_DIRS =&lt;br/&gt;
     		key(&quot;io.tmp.dirs&quot;)&lt;br/&gt;
     			.defaultValue(System.getProperty(&quot;java.io.tmpdir&quot;))&lt;br/&gt;
     			.withDeprecatedKeys(&quot;taskmanager.tmp.dirs&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * String key, which says if variable `java.io.tmpdir` has been overridden for the cluster.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final String TMP_DIRS_OVERRIDDEN = &quot;io.tmp.dirs.overridden&quot;;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Let&apos;s make this a proper `ConfigOption&amp;lt;Boolean&amp;gt;` with name `USE_LOCAL_DEFAULT_TMP_DIRS` key name `internal.io.tmp.dirs.use-local-default`&lt;/p&gt;</comment>
                            <comment id="16541876" author="githubbot" created="Thu, 12 Jul 2018 16:10:09 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202087987&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202087987&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -473,8 +474,13 @@ private ContainerLaunchContext createTaskExecutorLaunchContext(Resource resource&lt;/p&gt;

&lt;p&gt;     		log.debug(&quot;TaskManager configuration: {}&quot;, flinkConfig);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    log the `flinkConfig` after cloning/resetting partial values.&lt;/p&gt;</comment>
                            <comment id="16542924" author="githubbot" created="Fri, 13 Jul 2018 11:29:43 +0000"  >&lt;p&gt;Github user JTaky commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202321582&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202321582&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/BootstrapTools.java &amp;#8212;&lt;br/&gt;
    @@ -467,4 +471,22 @@ public static String getStartCommand(String template,&lt;br/&gt;
     		}&lt;br/&gt;
     		return template;&lt;br/&gt;
     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Set temporary configuration directories if necesary&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param configuration flink config to patch&lt;br/&gt;
    +	 * @param defaultDirs in case no tmp directories is set, next directories will be applied&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void setTmpDirectoriesConfig(Configuration configuration, String defaultDirs){&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16542925" author="githubbot" created="Fri, 13 Jul 2018 11:29:44 +0000"  >&lt;p&gt;Github user JTaky commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202321585&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202321585&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/BootstrapTools.java &amp;#8212;&lt;br/&gt;
    @@ -467,4 +471,22 @@ public static String getStartCommand(String template,&lt;br/&gt;
     		}&lt;br/&gt;
     		return template;&lt;br/&gt;
     	}&lt;br/&gt;
    +&lt;br/&gt;
    +	/**&lt;br/&gt;
    +	 * Set temporary configuration directories if necesary&lt;br/&gt;
    +	 *&lt;br/&gt;
    +	 * @param configuration flink config to patch&lt;br/&gt;
    +	 * @param defaultDirs in case no tmp directories is set, next directories will be applied&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static void setTmpDirectoriesConfig(Configuration configuration, String defaultDirs){&lt;br/&gt;
    +		if (configuration.contains(CoreOptions.TMP_DIRS) &amp;amp;&amp;amp; !configuration.getString(CoreOptions.TMP_DIRS).isEmpty()) {&lt;br/&gt;
    +			LOG.info(&quot;Overriding Fink&apos;s temporary file directories with those &quot; +&lt;br/&gt;
    +				&quot;specified in the Flink config: &quot; + configuration.getValue(CoreOptions.TMP_DIRS));&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16542926" author="githubbot" created="Fri, 13 Jul 2018 11:29:48 +0000"  >&lt;p&gt;Github user JTaky commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202321593&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202321593&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java &amp;#8212;&lt;br/&gt;
    @@ -181,12 +181,17 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The config parameter defining the directories for temporary files, separated by&lt;/li&gt;
	&lt;li&gt;&quot;,&quot;, &quot;|&quot;, or the system&apos;s 
{@link java.io.File#pathSeparator}
&lt;p&gt;.&lt;br/&gt;
     	 */&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Documentation.OverrideDefault(&quot;System.getProperty(\&quot;java.io.tmpdir\&quot;)&quot;)&lt;br/&gt;
    +	@Documentation.OverrideDefault(&quot;&apos;LOCAL_DIRS&apos; on Yarn and &apos;_FLINK_TMP_DIR&apos; on Mesos.&quot;)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16545480" author="githubbot" created="Mon, 16 Jul 2018 16:59:08 +0000"  >&lt;p&gt;Github user JTaky commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202755897&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202755897&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -473,8 +474,13 @@ private ContainerLaunchContext createTaskExecutorLaunchContext(Resource resource&lt;/p&gt;

&lt;p&gt;     		log.debug(&quot;TaskManager configuration: {}&quot;, flinkConfig);&lt;/p&gt;

&lt;p&gt;    +		Configuration taskManagerConfig = flinkConfig.clone();&lt;br/&gt;
    +		if (!flinkConfig.containsKey(CoreOptions.TMP_DIRS_OVERRIDDEN))&lt;/p&gt;
{
    +			taskManagerConfig.setString(CoreOptions.TMP_DIRS, &quot;&quot;);	// HACK: emulate removal for the given key
    +		}
&lt;p&gt;    +&lt;br/&gt;
     		ContainerLaunchContext taskExecutorLaunchContext = Utils.createTaskExecutorContext(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;flinkConfig,
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    done. Thank you very much!&lt;br/&gt;
    Since you seem fine with this hacky approach I have tested and made stable the last PR on our Yarn cluster.&lt;/p&gt;</comment>
                            <comment id="16545481" author="githubbot" created="Mon, 16 Jul 2018 16:59:11 +0000"  >&lt;p&gt;Github user JTaky commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202755913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202755913&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -473,8 +474,13 @@ private ContainerLaunchContext createTaskExecutorLaunchContext(Resource resource&lt;/p&gt;

&lt;p&gt;     		log.debug(&quot;TaskManager configuration: {}&quot;, flinkConfig);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16545487" author="githubbot" created="Mon, 16 Jul 2018 17:01:08 +0000"  >&lt;p&gt;Github user JTaky commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202756519&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202756519&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-core/src/main/java/org/apache/flink/configuration/CoreOptions.java &amp;#8212;&lt;br/&gt;
    @@ -181,12 +181,17 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The config parameter defining the directories for temporary files, separated by&lt;/li&gt;
	&lt;li&gt;&quot;,&quot;, &quot;|&quot;, or the system&apos;s 
{@link java.io.File#pathSeparator}
&lt;p&gt;.&lt;br/&gt;
     	 */&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Documentation.OverrideDefault(&quot;System.getProperty(\&quot;java.io.tmpdir\&quot;)&quot;)&lt;br/&gt;
    +	@Documentation.OverrideDefault(&quot;&apos;LOCAL_DIRS&apos; on Yarn and &apos;_FLINK_TMP_DIR&apos; on Mesos.&quot;)&lt;br/&gt;
     	public static final ConfigOption&amp;lt;String&amp;gt; TMP_DIRS =&lt;br/&gt;
     		key(&quot;io.tmp.dirs&quot;)&lt;br/&gt;
     			.defaultValue(System.getProperty(&quot;java.io.tmpdir&quot;))&lt;br/&gt;
     			.withDeprecatedKeys(&quot;taskmanager.tmp.dirs&quot;);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    +	/**&lt;br/&gt;
    +	 * String key, which says if variable `java.io.tmpdir` has been overridden for the cluster.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	public static final String TMP_DIRS_OVERRIDDEN = &quot;io.tmp.dirs.overridden&quot;;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    done&lt;/p&gt;</comment>
                            <comment id="16545488" author="githubbot" created="Mon, 16 Jul 2018 17:01:13 +0000"  >&lt;p&gt;Github user JTaky commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202756536&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202756536&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/clusterframework/BootstrapTools.java &amp;#8212;&lt;br/&gt;
    @@ -250,6 +250,10 @@ public static Configuration generateTaskManagerConfiguration(&lt;br/&gt;
     			cfg.setInteger(TaskManagerOptions.NUM_TASK_SLOTS, numSlots);&lt;br/&gt;
     		}&lt;/p&gt;

&lt;p&gt;    +		if (!baseConfig.containsKey(CoreOptions.TMP_DIRS_OVERRIDDEN))&lt;/p&gt;
{
    +			cfg.setString(CoreOptions.TMP_DIRS, &quot;&quot;);	// HACK: emulate removal for the given key
    +		}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Agree, magic values are the dirtiest way.&lt;br/&gt;
    Will go with a &apos;clear&apos; (probably remove, in order to mimic java collection API) method.&lt;/p&gt;

&lt;p&gt;    Didn&apos;t get the point with clone method.  Is it in order to factorize this 4 lines or do you want to make it generic and use for all custom settings? In such case we should extract list of predicates per each configuration which looks quite complex as an API&lt;/p&gt;</comment>
                            <comment id="16545489" author="githubbot" created="Mon, 16 Jul 2018 17:01:42 +0000"  >&lt;p&gt;Github user JTaky commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284#discussion_r202756696&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284#discussion_r202756696&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java &amp;#8212;&lt;br/&gt;
    @@ -473,8 +474,13 @@ private ContainerLaunchContext createTaskExecutorLaunchContext(Resource resource&lt;/p&gt;

&lt;p&gt;     		log.debug(&quot;TaskManager configuration: {}&quot;, flinkConfig);&lt;/p&gt;

&lt;p&gt;    +		Configuration taskManagerConfig = flinkConfig.clone();&lt;br/&gt;
    +		if (!flinkConfig.containsKey(CoreOptions.TMP_DIRS_OVERRIDDEN))&lt;/p&gt;
{
    +			taskManagerConfig.setString(CoreOptions.TMP_DIRS, &quot;&quot;);	// HACK: emulate removal for the given key
    +		}
&lt;p&gt;    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    same question as before &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; didn&apos;t get the idea&lt;/p&gt;</comment>
                            <comment id="16549064" author="githubbot" created="Thu, 19 Jul 2018 09:45:01 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6284&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16549164" author="till.rohrmann" created="Thu, 19 Jul 2018 11:42:19 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;master:&lt;br/&gt;
6bdec86e31d82d7c38d2509a039a1a03ab9f246e&lt;br/&gt;
ec28f92ffd042308494d9661a38ab462738611aa&lt;/p&gt;

&lt;p&gt;1.6.0:&lt;br/&gt;
fcd266fb439aa9288d6114d9bfb1e22011588d74&lt;br/&gt;
877cd7ef6e8a876a2a3579d0761bc2d160a4daf4&lt;/p&gt;

&lt;p&gt;1.5.2:&lt;br/&gt;
221a2b3833634065c13492ce141a8ba674e630d6&lt;br/&gt;
b505e52e3e4e3824b0f75c977b090c6d6cd24c62&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13174139">FLINK-9939</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vkk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>