<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:48:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-18688] ProjectionCodeGenerator#generateProjectionExpression should remove for loop optimization</title>
                <link>https://issues.apache.org/jira/browse/FLINK-18688</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;If too many fields of the same type are projected, &lt;tt&gt;ProjectionCodeGenerator#generateProjectionExpression&lt;/tt&gt; currently performs a &quot;for loop optimization&quot; which, instead of generating code separately for each field, they&apos;ll be squashed into a for loop.&lt;/p&gt;

&lt;p&gt;However, if the indices of the fields with the same type are not continuous, this optimization will not write fields in index ascending order. This is not acceptable because &lt;tt&gt;BinaryWriter&lt;/tt&gt; expects the users to write fields in index ascending order (that is to say, we &lt;b&gt;have to&lt;/b&gt; first write field 0, then field 1, then...), otherwise the variable length area of the two binary rows with same data might be different. Although we can use &lt;tt&gt;getXX&lt;/tt&gt; methods of &lt;tt&gt;BinaryRow&lt;/tt&gt; to get the fields correctly, states for streaming jobs compare state keys with binary bits, not with the contents of the keys. So we need to make sure the binary bits of the binary rows be the same if two rows contain the same data.&lt;/p&gt;

&lt;p&gt;What&apos;s worse, as the current implementation of &lt;tt&gt;ProjectionCodeGenerator#generateProjectionExpression&lt;/tt&gt; uses a scala &lt;tt&gt;HashMap&lt;/tt&gt;, the key order of the map might be different on different workers; Even if the projection does not meet the condition to be optimized, it will still be affected by this bug.&lt;/p&gt;

&lt;p&gt;What I suggest is to simply remove this optimization. Because if we still want this optimization, we have to make sure that the fields of the same type have continuous order, which is a very strict and rare condition.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13318934">FLINK-18688</key>
            <summary>ProjectionCodeGenerator#generateProjectionExpression should remove for loop optimization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="TsReaper">Caizhi Weng</assignee>
                                    <reporter username="TsReaper">Caizhi Weng</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Thu, 23 Jul 2020 12:42:48 +0000</created>
                <updated>Mon, 10 Aug 2020 08:09:10 +0000</updated>
                            <resolved>Mon, 10 Aug 2020 08:09:10 +0000</resolved>
                                    <version>1.11.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Table SQL / Runtime</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17163583" author="jark" created="Thu, 23 Jul 2020 13:38:48 +0000"  >&lt;p&gt;It seems that &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-18687&quot; title=&quot;ProjectionCodeGenerator#generateProjectionExpression should remove for loop optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-18687&quot;&gt;&lt;del&gt;FLINK-18687&lt;/del&gt;&lt;/a&gt; is a duplicate issue?&lt;/p&gt;</comment>
                            <comment id="17174166" author="lzljs3620320" created="Mon, 10 Aug 2020 08:09:10 +0000"  >&lt;p&gt;master:&#160;6d72cc0e35f41c4e1e28b57406e2cadd60c8fccf&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13318932">FLINK-18687</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0h4ls:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>