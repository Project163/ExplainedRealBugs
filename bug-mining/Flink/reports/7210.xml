<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:18:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-32751] DistinctAggregateITCaseBase.testMultiDistinctAggOnDifferentColumn got stuck on AZP</title>
                <link>https://issues.apache.org/jira/browse/FLINK-32751</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;This build hangs &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51955&amp;amp;view=logs&amp;amp;j=ce3801ad-3bd5-5f06-d165-34d37e757d90&amp;amp;t=5e4d9387-1dcc-5885-a901-90469b7e6d2f&amp;amp;l=14399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=51955&amp;amp;view=logs&amp;amp;j=ce3801ad-3bd5-5f06-d165-34d37e757d90&amp;amp;t=5e4d9387-1dcc-5885-a901-90469b7e6d2f&amp;amp;l=14399&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Aug 04 03:03:47 &quot;ForkJoinPool-1-worker-51&quot; #28 daemon prio=5 os_prio=0 cpu=49342.66ms elapsed=3079.49s tid=0x00007f67ccdd0000 nid=0x5234 waiting on condition  [0x00007f6791a19000]
Aug 04 03:03:47    java.lang.Thread.State: WAITING (parking)
Aug 04 03:03:47 	at jdk.internal.misc.Unsafe.park(java.base@11.0.19/Native Method)
Aug 04 03:03:47 	- parking to wait for  &amp;lt;0x00000000ad3b1fb8&amp;gt; (a java.util.concurrent.CompletableFuture$Signaller)
Aug 04 03:03:47 	at java.util.concurrent.locks.LockSupport.park(java.base@11.0.19/LockSupport.java:194)
Aug 04 03:03:47 	at java.util.concurrent.CompletableFuture$Signaller.block(java.base@11.0.19/CompletableFuture.java:1796)
Aug 04 03:03:47 	at java.util.concurrent.ForkJoinPool.managedBlock(java.base@11.0.19/ForkJoinPool.java:3118)
Aug 04 03:03:47 	at java.util.concurrent.CompletableFuture.waitingGet(java.base@11.0.19/CompletableFuture.java:1823)
Aug 04 03:03:47 	at java.util.concurrent.CompletableFuture.get(java.base@11.0.19/CompletableFuture.java:1998)
Aug 04 03:03:47 	at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.sendRequest(CollectResultFetcher.java:171)
Aug 04 03:03:47 	at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.next(CollectResultFetcher.java:129)
Aug 04 03:03:47 	at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.nextResultFromFetcher(CollectResultIterator.java:106)
Aug 04 03:03:47 	at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.hasNext(CollectResultIterator.java:80)
Aug 04 03:03:47 	at org.apache.flink.table.planner.connectors.CollectDynamicSink$CloseableRowIteratorWrapper.hasNext(CollectDynamicSink.java:222)
Aug 04 03:03:47 	at java.util.Iterator.forEachRemaining(java.base@11.0.19/Iterator.java:132)
Aug 04 03:03:47 	at org.apache.flink.util.CollectionUtil.iteratorToList(CollectionUtil.java:122)
Aug 04 03:03:47 	at org.apache.flink.table.planner.runtime.utils.BatchTestBase.executeQuery(BatchTestBase.scala:309)
Aug 04 03:03:47 	at org.apache.flink.table.planner.runtime.utils.BatchTestBase.check(BatchTestBase.scala:145)
Aug 04 03:03:47 	at org.apache.flink.table.planner.runtime.utils.BatchTestBase.checkResult(BatchTestBase.scala:109)
Aug 04 03:03:47 	at org.apache.flink.table.planner.runtime.batch.sql.agg.DistinctAggregateITCaseBase.testMultiDistinctAggOnDifferentColumn(DistinctAggregateITCaseBase.scala:97)
~~
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it is very likely that it is an old issue&lt;br/&gt;
the similar case was mentioned for 1.11.0 and closed because of lack of occurrences &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-16923&quot; title=&quot;DistinctAggregateITCaseBase.testSingleDistinctAggOnMultiColumnsWithGroupingSets gets stuck&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-16923&quot;&gt;&lt;del&gt;FLINK-16923&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and another similar one &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22100&quot; title=&quot;BatchFileSystemITCaseBase.testPartialDynamicPartition fail because of no output for 900 seconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22100&quot;&gt;&lt;del&gt;FLINK-22100&lt;/del&gt;&lt;/a&gt; which was marked as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21996&quot; title=&quot;Transient RPC failure without TaskManager failure can lead to split assignment loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21996&quot;&gt;&lt;del&gt;FLINK-21996&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13546105">FLINK-32751</key>
            <summary>DistinctAggregateITCaseBase.testMultiDistinctAggOnDifferentColumn got stuck on AZP</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mapohl">Matthias Pohl</assignee>
                                    <reporter username="Sergey Nuyanzin">Sergey Nuyanzin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Fri, 4 Aug 2023 07:11:18 +0000</created>
                <updated>Wed, 30 Aug 2023 05:33:49 +0000</updated>
                            <resolved>Wed, 30 Aug 2023 05:33:49 +0000</resolved>
                                    <version>1.18.0</version>
                    <version>1.16.3</version>
                    <version>1.17.2</version>
                    <version>1.19.0</version>
                                    <fixVersion>1.18.0</fixVersion>
                    <fixVersion>1.16.3</fixVersion>
                    <fixVersion>1.17.2</fixVersion>
                    <fixVersion>1.19.0</fixVersion>
                                    <component>Table SQL / API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17751105" author="mapohl" created="Fri, 4 Aug 2023 12:27:06 +0000"  >&lt;p&gt;The actual test failure happened in &lt;tt&gt;SortDistinctAggregateITCase#testMultiDistinctAggOnDifferentColumn&lt;/tt&gt; which derives the test from &lt;tt&gt;DistinctAggregateITCaseBase&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;FYI: This can be determined by looking at the surefire reporting which prints that &lt;tt&gt;HashDistinctAggregateITCase&lt;/tt&gt; completed but &lt;tt&gt;SortDistinctAggregateITCase&lt;/tt&gt; didn&apos;t.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[...]
Aug 04 02:12:29 02:12:29.073 [INFO] Running org.apache.flink.table.planner.runtime.batch.sql.agg.SortDistinctAggregateITCase
[...]
Aug 04 02:19:04 02:19:04.720 [INFO] Running org.apache.flink.table.planner.runtime.batch.sql.agg.HashDistinctAggregateITCase
Aug 04 02:20:38 02:20:38.255 [INFO] Tests run: 23, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 93.527 s - in org.apache.flink.table.planner.runtime.batch.sql.agg.HashDistinctAggregateITCase
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue we&apos;re seeing seems to be independent of the actual test, though.&lt;/p&gt;

&lt;p&gt;The timeout happens when the &lt;tt&gt;CollectDynamicSink&lt;/tt&gt; tries to request more data through the Dispatcher which forwards the request. Unfortunately, we don&apos;t have any logs from the Dispatcher side of that request. Therefore, we cannot reliably say where the request halted.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Sergey+Nuyanzin&quot; class=&quot;user-hover&quot; rel=&quot;Sergey Nuyanzin&quot;&gt;Sergey Nuyanzin&lt;/a&gt; had a point when pointing out that there are multiple other past Jira issues (&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-20254&quot; title=&quot;HiveTableSourceITCase.testStreamPartitionReadByCreateTime times out&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-20254&quot;&gt;&lt;del&gt;FLINK-20254&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22129&quot; title=&quot;OrcFileSystemITCase hangs on azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22129&quot;&gt;&lt;del&gt;FLINK-22129&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22181&quot; title=&quot;SourceNAryInputChainingITCase hangs on azure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22181&quot;&gt;&lt;del&gt;FLINK-22181&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-22100&quot; title=&quot;BatchFileSystemITCaseBase.testPartialDynamicPartition fail because of no output for 900 seconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-22100&quot;&gt;&lt;del&gt;FLINK-22100&lt;/del&gt;&lt;/a&gt;) that had a similar stacktrace. These Jiras were handled as duplicates of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21996&quot; title=&quot;Transient RPC failure without TaskManager failure can lead to split assignment loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21996&quot;&gt;&lt;del&gt;FLINK-21996&lt;/del&gt;&lt;/a&gt; which was a bug in RPC layer with messages being swallowed. In the end, it&apos;s strange that the request wasn&apos;t completed in some way due to the &lt;tt&gt;MiniCluster&lt;/tt&gt; having been shut down.&lt;/p&gt;

&lt;p&gt;There should be an error being thrown when trying to get the RPC endpoint for the dispatcher (through &lt;a href=&quot;https://github.com/apache/flink/blob/c6997c97c575d334679915c328792b8a3067cfb5/flink-runtime/src/main/java/org/apache/flink/runtime/webmonitor/retriever/LeaderGatewayRetriever.java#L49&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LeaderGatewayRetriever#getFuture&lt;/a&gt;) or for the JobMaster (through &lt;a href=&quot;https://github.com/apache/flink/blob/c6d58e17e8ce736a062234e1558ac8d7b65990ef/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java#L1455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Dispatcher#getJobMaster&lt;/a&gt;) which we don&apos;t see. That makes it more likely that the RPC request/response was swallowed.&lt;/p&gt;</comment>
                            <comment id="17752017" author="mapohl" created="Tue, 8 Aug 2023 12:14:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; had another guess: &lt;tt&gt;CollectResultFetcher.sendRequest&lt;/tt&gt; (which is the call that doesn&apos;t get back even while the cluster is shutdown) triggers the&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Dispatcher#deliverCoordinationRequestToCoordinator
	&lt;ul&gt;
		&lt;li&gt;JobMaster#deliverCoordinationRequestToCoordinator
		&lt;ul&gt;
			&lt;li&gt;JobMaster#sendRequestToCoordinator
			&lt;ul&gt;
				&lt;li&gt;SchedulerNG#deliverCoordinationRequestToCoordinator
				&lt;ul&gt;
					&lt;li&gt;OperatorCoordinatorHandler#deliverCoordinationRequestToCoordinator
					&lt;ul&gt;
						&lt;li&gt;CollectSinkOperatorCoordinator#handleCoordinationRequest&lt;/li&gt;
					&lt;/ul&gt;
					&lt;/li&gt;
				&lt;/ul&gt;
				&lt;/li&gt;
			&lt;/ul&gt;
			&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The latter one submits the request handling to an &lt;tt&gt;executorService&lt;/tt&gt; which is owned by the coordinator. This &lt;tt&gt;executorService&lt;/tt&gt; is shut down as part of the coordinator&apos;s close mechanism using the &lt;tt&gt;shutdown&lt;/tt&gt; call. Any already submitted task is not stopped but continues to operator while the MiniCluster shutdown is happening (where the RPC system is shut down as well in the end). There is some chance that the task got executed but the RPC system is shut down in the mean time. Any completion of future within &lt;tt&gt;CollectSinkOperatorCoordinator#handleRequestImpl&lt;/tt&gt; might be lost when the RPC system is shut down.&lt;/p&gt;

&lt;p&gt;I&apos;m gonna go ahead and try to come up with a test scenario for this issue. If we conclude that this reasoning makes sense, it would mean that Jira issue isn&apos;t blocking the 1.18 release. That problem exists also in older versions of Flink.&lt;/p&gt;</comment>
                            <comment id="17752373" author="mapohl" created="Wed, 9 Aug 2023 10:54:18 +0000"  >&lt;p&gt;I played around a bit more with the test and I&apos;m not convinced that the issue is the shutdown procedure. AFAIU, &lt;tt&gt;CollectSinkOperatorCoordinator#handleRequestImpl&lt;/tt&gt; would immediately fail if the &lt;tt&gt;CollectSinkOperatorCoordinator#close&lt;/tt&gt; is triggered because it closes the socket connection which would cause an error while reading from the socket&apos;s inputstream. The future should be completed in the catch block of &lt;tt&gt;CollectSinkOperatorCoordinator#handleRequestImpl&lt;/tt&gt; (even if the cluster is shut down in the mean time).&lt;/p&gt;

&lt;p&gt;Enabling more logs in the local test execution also reveals that the response through the &lt;tt&gt;CollectSinkOperatorCoordinator&lt;/tt&gt; is rarely filled with data. But the test itself succeeds anyway. &lt;del&gt;That seems odd: I&apos;m wondering whether there&apos;s another path that sends out the data to the client.&lt;/del&gt; The JobClient does, indeed, collect the results after the job terminated in a separated branch in &lt;a href=&quot;https://github.com/apache/flink/blob/8119411addd9c82c15bab8480e7b35b8e6394d43/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/collect/CollectResultFetcher.java#L118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CollectResultFetcher#next()&lt;/a&gt;. The corresponding data is coming from the CollectSinkFunction where it collects all the outstanding data while closing the function (see &lt;a href=&quot;https://github.com/apache/flink/blob/5ae8cb0503449b07f76d0ab621c3e81734496b26/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/collect/CollectSinkFunction.java#L304&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CollectSinkFunction#accululateFinalResults&lt;/a&gt;).&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=renqs&quot; class=&quot;user-hover&quot; rel=&quot;renqs&quot;&gt;renqs&lt;/a&gt; do you have someone who can look into that issue from the runtime perspective?&lt;/p&gt;</comment>
                            <comment id="17752393" author="mapohl" created="Wed, 9 Aug 2023 11:50:47 +0000"  >&lt;p&gt;Some other findings:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The thread dump doesn&apos;t contain the &lt;tt&gt;collect-sink-operator-coordinator-executor-thread-pool&lt;/tt&gt; thread pool which gives the indication that the &lt;tt&gt;CollectSinkOperatorCoordinator&lt;/tt&gt; executorService was actually shut down.&lt;/li&gt;
	&lt;li&gt;The Socket is never established (i.e. &quot;Sink connection established&quot; doesn&apos;t show up in the logs; see &lt;a href=&quot;https://github.com/apache/flink/blob/bedcc3f7b5c0fc184953d3c1a969f03887db2cae/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/collect/CollectSinkOperatorCoordinator.java#L136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CollectSinkOperatorCoordinator:136&lt;/a&gt;) which might indicate that the connect call could have also been blocked. The &lt;tt&gt;connect&lt;/tt&gt; itself is called without a timeout (value: 0) which makes the connect possibly block forever. But that contradicts the item above where we claimed that the corresponding thread &lt;tt&gt;collect-sink-operator-coordinator-executor-thread-pool&lt;/tt&gt; isn&apos;t listed in the thread dump anymore.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m gonna go ahead and provide the PR that hopefully improves the logging of this scenario a bit more.&lt;/p&gt;</comment>
                            <comment id="17752444" author="mapohl" created="Wed, 9 Aug 2023 15:12:55 +0000"  >&lt;p&gt;I checked whether &lt;tt&gt;Socket#connect&lt;/tt&gt; (see &lt;a href=&quot;https://github.com/apache/flink/blob/e110b0318d66c741ca0f609ec661ddaea599379c/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/collect/CollectSinkOperatorCoordinator.java#L165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CollectSinkOperatorCoordinator:165&lt;/a&gt;) might block the thread execution if there&apos;s no &lt;tt&gt;ServerSocket&lt;/tt&gt; waiting for a connection. But the call still fails with a &lt;tt&gt;ConnectException&lt;/tt&gt; if there&apos;s no &lt;tt&gt;ServerSocket&lt;/tt&gt; listening on the given port. That would have been the only guess why the request didn&apos;t complete.&lt;/p&gt;</comment>
                            <comment id="17754085" author="mapohl" created="Mon, 14 Aug 2023 12:41:16 +0000"  >&lt;p&gt;There was another test error with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-29642&quot; title=&quot;MySqlCatalogITCase.testWithoutCatalogDB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-29642&quot;&gt;&lt;del&gt;FLINK-29642&lt;/del&gt;&lt;/a&gt; reported that has the same stacktrace: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=42011&amp;amp;view=logs&amp;amp;j=dbe51908-4958-5c8c-9557-e10952d4259d&amp;amp;t=55d11a16-067d-538d-76a3-4c096a3a8e24&amp;amp;l=15625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=42011&amp;amp;view=logs&amp;amp;j=dbe51908-4958-5c8c-9557-e10952d4259d&amp;amp;t=55d11a16-067d-538d-76a3-4c096a3a8e24&amp;amp;l=15625&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[...]
Oct 14 02:18:03 &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; #1 prio=5 os_prio=0 tid=0x00007fa9bc00b800 nid=0x3528 waiting on condition [0x00007fa9c54e3000]
Oct 14 02:18:03    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
Oct 14 02:18:03 	at sun.misc.Unsafe.park(Native Method)
Oct 14 02:18:03 	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x00000000aaae6cd0&amp;gt; (a java.util.concurrent.CompletableFuture$Signaller)
Oct 14 02:18:03 	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
Oct 14 02:18:03 	at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1707)
Oct 14 02:18:03 	at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)
Oct 14 02:18:03 	at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1742)
Oct 14 02:18:03 	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908)
Oct 14 02:18:03 	at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.sendRequest(CollectResultFetcher.java:170)
Oct 14 02:18:03 	at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.next(CollectResultFetcher.java:129)
Oct 14 02:18:03 	at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.nextResultFromFetcher(CollectResultIterator.java:106)
Oct 14 02:18:03 	at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.hasNext(CollectResultIterator.java:80)
Oct 14 02:18:03 	at org.apache.flink.table.planner.connectors.CollectDynamicSink$CloseableRowIteratorWrapper.hasNext(CollectDynamicSink.java:222)
Oct 14 02:18:03 	at java.util.Iterator.forEachRemaining(Iterator.java:115)
Oct 14 02:18:03 	at org.apache.flink.util.CollectionUtil.iteratorToList(CollectionUtil.java:115)
Oct 14 02:18:03 	at org.apache.flink.connector.jdbc.catalog.MySqlCatalogITCase.testWithoutCatalogDB(MySqlCatalogITCase.java:309)
[...] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17756703" author="mapohl" created="Mon, 21 Aug 2023 07:23:08 +0000"  >&lt;p&gt;I merged the changes into the branches:&lt;/p&gt;

&lt;p&gt;master (1.18): b5b1340f91d6cd2deb563eb67d8cbb3d1852544d&lt;br/&gt;
1.17: 8da9d50235776e41901b19c0f226f2826f03650e&lt;br/&gt;
1.16: ee6fbd0c4a9e3ee1b30872389829a284b1c6e215&lt;/p&gt;

&lt;p&gt;It&apos;s not a fix but rather a change in how issues are logged in production for the &lt;tt&gt;CollectSinkOperatorCoordinator&lt;/tt&gt;. I&apos;m gonna keep this issue open in case we run into this problem again.&lt;/p&gt;</comment>
                            <comment id="17758464" author="mapohl" created="Thu, 24 Aug 2023 09:20:46 +0000"  >&lt;p&gt;It happened again: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52570&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=15116&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52570&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=15116&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This time it happened in the &lt;tt&gt;FunctionITCase&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Aug 24 06:21:16 &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; #1 prio=5 os_prio=0 tid=0x00007f94d000b800 nid=0x78b2 waiting on condition [0x00007f94d8e99000]
Aug 24 06:21:16 &#160; &#160;java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at sun.misc.Unsafe.park(Native Method)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; - parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &#160;&amp;lt;0x00000000a6078ec0&amp;gt; (a java.util.concurrent.CompletableFuture$Signaller)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1707)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1742)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.sendRequest(CollectResultFetcher.java:171)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.next(CollectResultFetcher.java:129)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.nextResultFromFetcher(CollectResultIterator.java:106)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.hasNext(CollectResultIterator.java:80)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at org.apache.flink.table.planner.connectors.CollectDynamicSink$CloseableRowIteratorWrapper.hasNext(CollectDynamicSink.java:222)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at java.util.Iterator.forEachRemaining(Iterator.java:115)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at org.apache.flink.util.CollectionUtil.iteratorToList(CollectionUtil.java:122)
Aug 24 06:21:16 &#160; &#160; &#160; &#160; at org.apache.flink.table.planner.runtime.stream.sql.FunctionITCase.testSpecializedFunctionWithExpressionEvaluation(FunctionITCase.java:1257)
[...]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17758482" author="sergey nuyanzin" created="Thu, 24 Aug 2023 09:53:51 +0000"  >&lt;p&gt;also happened for 1.17&lt;br/&gt;
&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52566&amp;amp;view=logs&amp;amp;j=a9db68b9-a7e0-54b6-0f98-010e0aff39e2&amp;amp;t=cdd32e0b-6047-565b-c58f-14054472f1be&amp;amp;l=12876&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52566&amp;amp;view=logs&amp;amp;j=a9db68b9-a7e0-54b6-0f98-010e0aff39e2&amp;amp;t=cdd32e0b-6047-565b-c58f-14054472f1be&amp;amp;l=12876&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Aug 24 08:47:25 &quot;ForkJoinPool-1-worker-0&quot; #34 daemon prio=5 os_prio=0 tid=0x00007efde5632000 nid=0x72747 waiting on condition [0x00007efdd88c9000]
Aug 24 08:47:25    java.lang.Thread.State: WAITING (parking)
Aug 24 08:47:25 	at sun.misc.Unsafe.park(Native Method)
Aug 24 08:47:25 	- parking to wait for  &amp;lt;0x00000000a7385b78&amp;gt; (a java.util.concurrent.CompletableFuture$Signaller)
Aug 24 08:47:25 	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
Aug 24 08:47:25 	at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1707)
Aug 24 08:47:25 	at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3313)
Aug 24 08:47:25 	at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1742)
Aug 24 08:47:25 	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908)
Aug 24 08:47:25 	at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.sendRequest(CollectResultFetcher.java:170)
Aug 24 08:47:25 	at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.next(CollectResultFetcher.java:129)
Aug 24 08:47:25 	at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.nextResultFromFetcher(CollectResultIterator.java:106)
Aug 24 08:47:25 	at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.hasNext(CollectResultIterator.java:80)
Aug 24 08:47:25 	at org.apache.flink.table.planner.connectors.CollectDynamicSink$CloseableRowIteratorWrapper.hasNext(CollectDynamicSink.java:222)
Aug 24 08:47:25 	at java.util.Iterator.forEachRemaining(Iterator.java:115)
Aug 24 08:47:25 	at org.apache.flink.table.planner.functions.BuiltInAggregateFunctionTestBase.materializeResult(BuiltInAggregateFunctionTestBase.java:121)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17758486" author="sergey nuyanzin" created="Thu, 24 Aug 2023 10:00:20 +0000"  >&lt;p&gt;and for 1.16:&lt;br/&gt;
&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52565&amp;amp;view=logs&amp;amp;j=f2c100be-250b-5e85-7bbe-176f68fcddc5&amp;amp;t=05efd11e-5400-54a4-0d27-a4663be008a9&amp;amp;l=15322&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52565&amp;amp;view=logs&amp;amp;j=f2c100be-250b-5e85-7bbe-176f68fcddc5&amp;amp;t=05efd11e-5400-54a4-0d27-a4663be008a9&amp;amp;l=15322&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Aug 24 03:18:51 &quot;main&quot; #1 prio=5 os_prio=0 tid=0x00007f9da400b800 nid=0x72f5 waiting on condition [0x00007f9dad338000]
Aug 24 03:18:51    java.lang.Thread.State: WAITING (parking)
Aug 24 03:18:51 	at sun.misc.Unsafe.park(Native Method)
Aug 24 03:18:51 	- parking to wait for  &amp;lt;0x00000000c2cc4b60&amp;gt; (a java.util.concurrent.CompletableFuture$Signaller)
Aug 24 03:18:51 	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)
Aug 24 03:18:51 	at java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1707)
Aug 24 03:18:51 	at java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3323)
Aug 24 03:18:51 	at java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1742)
Aug 24 03:18:51 	at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1908)
Aug 24 03:18:51 	at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.sendRequest(CollectResultFetcher.java:170)
Aug 24 03:18:51 	at org.apache.flink.streaming.api.operators.collect.CollectResultFetcher.next(CollectResultFetcher.java:129)
Aug 24 03:18:51 	at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.nextResultFromFetcher(CollectResultIterator.java:106)
Aug 24 03:18:51 	at org.apache.flink.streaming.api.operators.collect.CollectResultIterator.hasNext(CollectResultIterator.java:80)
Aug 24 03:18:51 	at org.apache.flink.table.planner.connectors.CollectDynamicSink$CloseableRowIteratorWrapper.hasNext(CollectDynamicSink.java:222)
Aug 24 03:18:51 	at java.util.Iterator.forEachRemaining(Iterator.java:115)
Aug 24 03:18:51 	at org.apache.flink.util.CollectionUtil.iteratorToList(CollectionUtil.java:115)
Aug 24 03:18:51 	at org.apache.flink.table.planner.runtime.utils.BatchTestBase.executeQuery(BatchTestBase.scala:308)
Aug 24 03:18:51 	at org.apache.flink.table.planner.runtime.utils.BatchTestBase.check(BatchTestBase.scala:144)
Aug 24 03:18:51 	at org.apache.flink.table.planner.runtime.utils.BatchTestBase.checkResult(BatchTestBase.scala:108)
Aug 24 03:18:51 	at org.apache.flink.table.planner.runtime.batch.sql.agg.AggregateReduceGroupingITCase.testAggWithCube(AggregateReduceGroupingITCase.scala:523)
Aug 24 03:18:51 	
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17758489" author="mapohl" created="Thu, 24 Aug 2023 10:06:30 +0000"  >&lt;p&gt;The &lt;tt&gt;BuiltInAggregateFunctionTestBase&lt;/tt&gt; failure in 1.17 mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-32751?focusedCommentId=17758482&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17758482&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Sergey&apos;s comment&lt;/a&gt; and the &lt;tt&gt;MySqlCatalogITCase&lt;/tt&gt; failure that happened in Oct 2022 (mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-32751?focusedCommentId=17754085&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17754085&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;this comment&lt;/a&gt;) &lt;del&gt;might indicate that it&apos;s at least not a blocker for 1.18.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Even though it is concerning that the error appears three times in a short period now. And the fix that was applied should cancel all requests while shutting down the &lt;tt&gt;executorService&lt;/tt&gt;. I&apos;m gonna have another look.&lt;/p&gt;</comment>
                            <comment id="17758494" author="mapohl" created="Thu, 24 Aug 2023 10:13:36 +0000"  >&lt;p&gt;Ok, I&apos;m raising this issue to become a blocker again. The amount of time it appears now is worrying. It might be related to our fix that we put in all the branches.&lt;/p&gt;</comment>
                            <comment id="17758560" author="sergey nuyanzin" created="Thu, 24 Aug 2023 12:34:10 +0000"  >&lt;p&gt;another from today&apos;s master &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52591&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52591&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758562" author="sergey nuyanzin" created="Thu, 24 Aug 2023 12:35:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52543&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=12436&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52543&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=12436&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758565" author="sergey nuyanzin" created="Thu, 24 Aug 2023 12:37:15 +0000"  >&lt;p&gt;1.17: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52514&amp;amp;view=logs&amp;amp;j=4eda0b4a-bd0d-521a-0916-8285b9be9bb5&amp;amp;t=2ff6d5fa-53a6-53ac-bff7-fa524ea361a9&amp;amp;l=13893&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52514&amp;amp;view=logs&amp;amp;j=4eda0b4a-bd0d-521a-0916-8285b9be9bb5&amp;amp;t=2ff6d5fa-53a6-53ac-bff7-fa524ea361a9&amp;amp;l=13893&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758567" author="sergey nuyanzin" created="Thu, 24 Aug 2023 12:39:23 +0000"  >&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52479&amp;amp;view=logs&amp;amp;j=a9db68b9-a7e0-54b6-0f98-010e0aff39e2&amp;amp;t=cdd32e0b-6047-565b-c58f-14054472f1be&amp;amp;l=14155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52479&amp;amp;view=logs&amp;amp;j=a9db68b9-a7e0-54b6-0f98-010e0aff39e2&amp;amp;t=cdd32e0b-6047-565b-c58f-14054472f1be&amp;amp;l=14155&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758568" author="sergey nuyanzin" created="Thu, 24 Aug 2023 12:43:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52512&amp;amp;view=logs&amp;amp;j=bf5e383b-9fd3-5f02-ca1c-8f788e2e76d3&amp;amp;t=85189c57-d8a0-5c9c-b61d-fc05cfac62cf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52512&amp;amp;view=logs&amp;amp;j=bf5e383b-9fd3-5f02-ca1c-8f788e2e76d3&amp;amp;t=85189c57-d8a0-5c9c-b61d-fc05cfac62cf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758569" author="sergey nuyanzin" created="Thu, 24 Aug 2023 12:45:05 +0000"  >&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52513&amp;amp;view=logs&amp;amp;j=a9db68b9-a7e0-54b6-0f98-010e0aff39e2&amp;amp;t=cdd32e0b-6047-565b-c58f-14054472f1be&amp;amp;l=14143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52513&amp;amp;view=logs&amp;amp;j=a9db68b9-a7e0-54b6-0f98-010e0aff39e2&amp;amp;t=cdd32e0b-6047-565b-c58f-14054472f1be&amp;amp;l=14143&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758846" author="mapohl" created="Fri, 25 Aug 2023 06:32:15 +0000"  >&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52582&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=14446&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52582&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=14446&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758878" author="sergey nuyanzin" created="Fri, 25 Aug 2023 08:23:40 +0000"  >&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52623&amp;amp;view=logs&amp;amp;j=a57e0635-3fad-5b08-57c7-a4142d7d6fa9&amp;amp;t=2ef0effc-1da1-50e5-c2bd-aab434b1c5b7&amp;amp;l=13839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52623&amp;amp;view=logs&amp;amp;j=a57e0635-3fad-5b08-57c7-a4142d7d6fa9&amp;amp;t=2ef0effc-1da1-50e5-c2bd-aab434b1c5b7&amp;amp;l=13839&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758983" author="sergey nuyanzin" created="Fri, 25 Aug 2023 09:35:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52634&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=15261&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52634&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=15261&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17758986" author="mapohl" created="Fri, 25 Aug 2023 09:56:43 +0000"  >&lt;p&gt;There&apos;s a race condition between closing the coordinator (which closes the socket and set the corresponding field to &lt;tt&gt;null&lt;/tt&gt;) and handling a request where a socket is opened again if the corresponding socket field is null. If the close call happens after a new request is submitted but before the null check in the request handling happens, a new Socket will be created that&apos;s never closed but doesn&apos;t get any data, anymore. That results in the response never returning.&lt;/p&gt;

&lt;p&gt;This race condition was also able to happen prior to the changes we introduced in the merges documented in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-32751?focusedCommentId=17756703&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-17756703&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;the comment above&lt;/a&gt;. I&apos;m still puzzled why this issue starts to appear more frequently now. The main difference (besides the log output refactoring) was to change from &lt;tt&gt;shutdown&lt;/tt&gt; to &lt;tt&gt;shutdownNow&lt;/tt&gt; for the executor service and when the &lt;tt&gt;closeConnection&lt;/tt&gt; call happened (before or after the shutdown). I would have expected that we run into this issue more often with the &lt;tt&gt;closeConnection&lt;/tt&gt; call happening before the shutdown of the &lt;tt&gt;ExecutorService&lt;/tt&gt; (which is how it was implemented before the recent changes) because there&apos;s a higher chance for the socket to be recreated. I still have to investigate that one.&lt;/p&gt;

&lt;p&gt;But I&apos;m working on a fix now with more elaborate unit testing of the class.&lt;/p&gt;</comment>
                            <comment id="17759093" author="mapohl" created="Fri, 25 Aug 2023 15:53:17 +0000"  >&lt;p&gt;I provided a PR with the fix (see &lt;a href=&quot;https://github.com/apache/flink/pull/23296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/23296&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="17759491" author="sergey nuyanzin" created="Mon, 28 Aug 2023 08:22:25 +0000"  >&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52644&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=14472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52644&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=14472&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759493" author="sergey nuyanzin" created="Mon, 28 Aug 2023 08:23:37 +0000"  >&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52667&amp;amp;view=logs&amp;amp;j=9cada3cb-c1d3-5621-16da-0f718fb86602&amp;amp;t=c67e71ed-6451-5d26-8920-5a8cf9651901&amp;amp;l=28282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52667&amp;amp;view=logs&amp;amp;j=9cada3cb-c1d3-5621-16da-0f718fb86602&amp;amp;t=c67e71ed-6451-5d26-8920-5a8cf9651901&amp;amp;l=28282&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759494" author="sergey nuyanzin" created="Mon, 28 Aug 2023 08:25:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52666&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=12115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52666&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=12115&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759508" author="sergey nuyanzin" created="Mon, 28 Aug 2023 08:57:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52680&amp;amp;view=logs&amp;amp;j=bf5e383b-9fd3-5f02-ca1c-8f788e2e76d3&amp;amp;t=85189c57-d8a0-5c9c-b61d-fc05cfac62cf&amp;amp;l=28413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52680&amp;amp;view=logs&amp;amp;j=bf5e383b-9fd3-5f02-ca1c-8f788e2e76d3&amp;amp;t=85189c57-d8a0-5c9c-b61d-fc05cfac62cf&amp;amp;l=28413&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759511" author="sergey nuyanzin" created="Mon, 28 Aug 2023 08:58:58 +0000"  >&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52681&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=14351&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52681&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=14351&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759512" author="sergey nuyanzin" created="Mon, 28 Aug 2023 09:00:14 +0000"  >&lt;p&gt;1.17: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52682&amp;amp;view=logs&amp;amp;j=a9db68b9-a7e0-54b6-0f98-010e0aff39e2&amp;amp;t=cdd32e0b-6047-565b-c58f-14054472f1be&amp;amp;l=12892&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52682&amp;amp;view=logs&amp;amp;j=a9db68b9-a7e0-54b6-0f98-010e0aff39e2&amp;amp;t=cdd32e0b-6047-565b-c58f-14054472f1be&amp;amp;l=12892&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759515" author="sergey nuyanzin" created="Mon, 28 Aug 2023 09:02:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52692&amp;amp;view=logs&amp;amp;j=f2c100be-250b-5e85-7bbe-176f68fcddc5&amp;amp;t=05efd11e-5400-54a4-0d27-a4663be008a9&amp;amp;l=12799&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52692&amp;amp;view=logs&amp;amp;j=f2c100be-250b-5e85-7bbe-176f68fcddc5&amp;amp;t=05efd11e-5400-54a4-0d27-a4663be008a9&amp;amp;l=12799&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759516" author="sergey nuyanzin" created="Mon, 28 Aug 2023 09:03:37 +0000"  >&lt;p&gt;1.16: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52693&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=16951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52693&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=16951&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759518" author="sergey nuyanzin" created="Mon, 28 Aug 2023 09:05:19 +0000"  >&lt;p&gt;1.17: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52694&amp;amp;view=logs&amp;amp;j=f2c100be-250b-5e85-7bbe-176f68fcddc5&amp;amp;t=05efd11e-5400-54a4-0d27-a4663be008a9&amp;amp;l=13268&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52694&amp;amp;view=logs&amp;amp;j=f2c100be-250b-5e85-7bbe-176f68fcddc5&amp;amp;t=05efd11e-5400-54a4-0d27-a4663be008a9&amp;amp;l=13268&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759849" author="mapohl" created="Tue, 29 Aug 2023 07:04:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52740&amp;amp;view=logs&amp;amp;j=3e4dd1a2-fe2f-5e5d-a581-48087e718d53&amp;amp;t=b4612f28-e3b5-5853-8a8b-610ae894217a&amp;amp;l=29248&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52740&amp;amp;view=logs&amp;amp;j=3e4dd1a2-fe2f-5e5d-a581-48087e718d53&amp;amp;t=b4612f28-e3b5-5853-8a8b-610ae894217a&amp;amp;l=29248&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17759851" author="mapohl" created="Tue, 29 Aug 2023 07:07:35 +0000"  >&lt;p&gt;All from the same CI run:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52741&amp;amp;view=logs&amp;amp;j=f2c100be-250b-5e85-7bbe-176f68fcddc5&amp;amp;t=05efd11e-5400-54a4-0d27-a4663be008a9&amp;amp;l=13816&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52741&amp;amp;view=logs&amp;amp;j=f2c100be-250b-5e85-7bbe-176f68fcddc5&amp;amp;t=05efd11e-5400-54a4-0d27-a4663be008a9&amp;amp;l=13816&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52741&amp;amp;view=logs&amp;amp;j=de826397-1924-5900-0034-51895f69d4b7&amp;amp;t=f311e913-93a2-5a37-acab-4a63e1328f94&amp;amp;l=15359&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52741&amp;amp;view=logs&amp;amp;j=de826397-1924-5900-0034-51895f69d4b7&amp;amp;t=f311e913-93a2-5a37-acab-4a63e1328f94&amp;amp;l=15359&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52741&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=14788&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=52741&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&amp;amp;l=14788&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17760246" author="mapohl" created="Wed, 30 Aug 2023 05:33:49 +0000"  >&lt;p&gt;master (1.19):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;5b8c4a74521410ca0391d63614c7a7da0b7f365d (actual fix)&lt;/li&gt;
	&lt;li&gt;d343a0bc79b0c85c845d0011d29404567f28dd0a (improved testability)&lt;br/&gt;
1.18:&lt;/li&gt;
	&lt;li&gt;750311755b55ea2abf3313798453dcfefc36675a (actual fix)&lt;/li&gt;
	&lt;li&gt;848183c6dcd16c0c6a9766a2a4ea64c4a923040e (improved testability)&lt;br/&gt;
1.17:&lt;/li&gt;
	&lt;li&gt;b6e4cc58adceb2de78d6cad0a794a3e24b43f896 (actual fix)&lt;/li&gt;
	&lt;li&gt;abb5d7583232d72375019fb673334e72890f84e0 (improved testability)&lt;br/&gt;
1.16:&lt;/li&gt;
	&lt;li&gt;68af78571df6d4f0512bc2dda8b84f80f09adc3c (actual fix)&lt;/li&gt;
	&lt;li&gt;ebcd8654f75d1eaabe139cc5779b670737d1bbe7 (improved testability)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13486309">FLINK-29642</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13367996">FLINK-21996</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13295531">FLINK-16923</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13369241">FLINK-22100</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 10 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1jl34:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>