<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:40:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-13044] Shading of AWS SDK in flink-s3-fs-hadoop results in ClassNotFoundExceptions</title>
                <link>https://issues.apache.org/jira/browse/FLINK-13044</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&#160;The current&#160;build configuration shades the AWS SDK into &lt;tt&gt;flink-s3-fs-hadoop.jar&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Due to &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-156&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MSHAD-156&lt;/a&gt; the shading itself does not only add the classes to the JAR but also alters the string literal &lt;tt&gt;PACKAGE_PREFIXES_TO_SHADE&lt;/tt&gt; in &lt;tt&gt;org.apache.flink.fs.s3hadoop.S3FileSystemFactory&lt;/tt&gt; from &lt;tt&gt;com.amazonaws.&lt;/tt&gt; to &lt;tt&gt;org.apache.flink.fs.s3base.shaded.com.amazonaws&lt;/tt&gt; - which causes settings like &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;fs.s3a.aws.credentials.provider: com.amazonaws.auth.DefaultAWSCredentialsProviderChain&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to not be remapped properly as the &lt;tt&gt;startsWith&lt;/tt&gt; in &lt;tt&gt;org.apache.flink.fs.s3.common.HadoopConfigLoader.shadeClassConfig()&lt;/tt&gt; doesn&apos;t match the beginning of the FQCN.&lt;/p&gt;

&lt;p&gt;This is a known issue in the Maven shade plugin (see &lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-156&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MSHAD-156&lt;/a&gt;) - a possible workaround is named in the ticket, too.&lt;/p&gt;

&lt;p&gt;This issue is only visible looking into the compiled &lt;tt&gt;class&lt;/tt&gt; file after the shading happened!&lt;/p&gt;

&lt;p&gt;Fixing the &lt;tt&gt;PACKAGE_PREFIXES_TO_SHADE&lt;/tt&gt; value alone doesn&apos;t help as based on &lt;tt&gt;FLINK_SHADING_PREFIX&lt;/tt&gt; the FQCN is assembled as &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.flink.fs.s3hadoop.shaded.com.amazonaws.auth.DefaultAWSCredentialsProviderChain&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; which can&apos;t be found either;&lt;br/&gt;
the class is located at &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.flink.fs.s3base.shaded.com.amazonaws.auth.DefaultAWSCredentialsProviderChain&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="13242504">FLINK-13044</key>
            <summary>Shading of AWS SDK in flink-s3-fs-hadoop results in ClassNotFoundExceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chesnay">Chesnay Schepler</assignee>
                                    <reporter username="zeeman">Sebastian J.</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 1 Jul 2019 12:40:36 +0000</created>
                <updated>Wed, 2 Oct 2019 17:44:25 +0000</updated>
                            <resolved>Tue, 6 Aug 2019 19:44:40 +0000</resolved>
                                    <version>1.8.0</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>FileSystems</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16882139" author="stephanewen" created="Wed, 10 Jul 2019 14:47:21 +0000"  >&lt;p&gt;We can in theory drop shading of the filesystems all together now, and instead put them in the plugins folder of Flink.&lt;br/&gt;
That also gives class loader isolation and avoid class path pollution, and does not require an shading.&lt;/p&gt;

&lt;p&gt;Because this is very new, we did not want to drop shading instantly, in case users still put the file system into &quot;/lib&quot;.&lt;/p&gt;

&lt;p&gt;As a workaround, you could comment out the class relocation part of the build, and put the resulting artifacts into &quot;/plugins&quot;.&lt;br/&gt;
That should do the trick.&lt;/p&gt;

&lt;p&gt;I hope that we will drop the evil shading magic completely from 1.10.&lt;/p&gt;</comment>
                            <comment id="16882955" author="zeeman" created="Thu, 11 Jul 2019 13:29:05 +0000"  >&lt;p&gt;Glad to hear the plan for 1.10 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sewen&quot; class=&quot;user-hover&quot; rel=&quot;sewen&quot;&gt;sewen&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;May I ask what the best approach is for us to live with a vanilla Flink till then?&lt;br/&gt;
Any chance to get &lt;tt&gt;PR#9071&lt;/tt&gt; in a (1.9.x?) patch release? &lt;br/&gt;
TBH, having a non-code-modified version in production is our ultimate goal.&lt;/p&gt;</comment>
                            <comment id="16882974" author="stephanewen" created="Thu, 11 Jul 2019 13:45:08 +0000"  >&lt;p&gt;This is clearly a bug and should be fixed in 1.9.0&lt;/p&gt;</comment>
                            <comment id="16892515" author="till.rohrmann" created="Thu, 25 Jul 2019 07:55:43 +0000"  >&lt;p&gt;Could you please move this issue into &quot;In Progress&quot; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zeeman&quot; class=&quot;user-hover&quot; rel=&quot;zeeman&quot;&gt;zeeman&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16901409" author="zentol" created="Tue, 6 Aug 2019 19:44:40 +0000"  >&lt;p&gt;master: 5e5f5bec72d30397253fc1f11105ca385ca8681f&lt;br/&gt;
1.9: 16f519a1e7efae9210725f741c27a647ac3f3271 &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13249198">FLINK-13602</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13131263">FLINK-8439</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12807936">MSHADE-156</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311024" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>External issue ID</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/MSHADE-156&quot; title=&quot;shade plugin is transforming also strings that are not supposed to be transformed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MSHADE-156&quot;&gt;MSHADE-156&lt;/a&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://issues.apache.org/jira/browse/MSHADE-156]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0g1v:c</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>