<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:41:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-11843] Dispatcher fails to recover jobs if leader change happens during JobManagerRunner termination</title>
                <link>https://issues.apache.org/jira/browse/FLINK-11843</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The &lt;tt&gt;Dispatcher&lt;/tt&gt; fails to recover jobs if a leader change happens during the &lt;tt&gt;JobManagerRunner&lt;/tt&gt; termination of the previous run. The problem is that we schedule the start future of the recovered &lt;tt&gt;JobGraph&lt;/tt&gt; using the &lt;tt&gt;MainThreadExecutor&lt;/tt&gt; and additionally require that this future is completed before any other recovery operation from a subsequent leadership session is executed. If now the leadership changes, the &lt;tt&gt;MainThreadExecutor&lt;/tt&gt; will be invalidated and the scheduled future will never be completed.&lt;/p&gt;

&lt;p&gt;The relevant ML thread: &lt;a href=&quot;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/1-7-1-job-stuck-in-suspended-state-td26439.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-flink-user-mailing-list-archive.2336050.n4.nabble.com/1-7-1-job-stuck-in-suspended-state-td26439.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13219946">FLINK-11843</key>
            <summary>Dispatcher fails to recover jobs if leader change happens during JobManagerRunner termination</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="trohrmann">Till Rohrmann</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 6 Mar 2019 15:32:27 +0000</created>
                <updated>Tue, 19 May 2020 14:29:40 +0000</updated>
                            <resolved>Fri, 25 Oct 2019 15:38:33 +0000</resolved>
                                    <version>1.7.2</version>
                    <version>1.8.0</version>
                    <version>1.9.0</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>14</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16813562" author="azagrebin" created="Tue, 9 Apr 2019 15:49:41 +0000"  >&lt;p&gt;As discussed in&#160;&lt;a href=&quot;https://github.com/apache/flink/pull/7889&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&#160;for&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11665&quot; title=&quot;Flink fails to remove JobGraph from ZK even though it reports it did&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11665&quot;&gt;&lt;del&gt;FLINK-11665&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11665&quot; title=&quot;Flink fails to remove JobGraph from ZK even though it reports it did&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11665&quot;&gt;&lt;del&gt;FLINK-11665&lt;/del&gt;&lt;/a&gt;&#160;can be also resolved by the more proper Dispatcher/LeaderStore lifecycle addressed in the scope of this issue&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11843&quot; title=&quot;Dispatcher fails to recover jobs if leader change happens during JobManagerRunner termination&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-11843&quot;&gt;&lt;del&gt;FLINK-11843&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16813582" author="till.rohrmann" created="Tue, 9 Apr 2019 16:06:52 +0000"  >&lt;p&gt;The problem actually not only occurs if the termination of the &lt;tt&gt;JobManagerRunner&lt;/tt&gt; but also if the startup of a &lt;tt&gt;JobManagerRunner&lt;/tt&gt; takes too long (e.g. if the state restore from ZooKeeper takes longer due to connection problems). The effect is the same: Due to the blocking nature of the &lt;tt&gt;JobManagerRunner&lt;/tt&gt; instantiation we do execute it in a separate thread. After the creation has completed we splice the execution back into the main thread by using the &lt;tt&gt;MainThreadExecutor&lt;/tt&gt; in order to update the internal &lt;tt&gt;Dispatcher&lt;/tt&gt; fields. If the executor has been invalidated in the meantime, then it will never be executed and &lt;tt&gt;Dispatcher#recoveryOperation&lt;/tt&gt; will never get completed.&lt;/p&gt;</comment>
                            <comment id="16827280" author="basharaj" created="Fri, 26 Apr 2019 20:19:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; do you have an update on when this issue will be fixed? we are currently impacted by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-11665&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-11665&lt;/a&gt; which this ticket should cover. &lt;/p&gt;</comment>
                            <comment id="16829047" author="till.rohrmann" created="Mon, 29 Apr 2019 09:14:48 +0000"  >&lt;p&gt;I&apos;m still working on this. I hope to get it fixed in the next 2-3 weeks. Sorry I was a bit sidetracked by other efforts.&lt;/p&gt;</comment>
                            <comment id="16885782" author="till.rohrmann" created="Tue, 16 Jul 2019 02:22:15 +0000"  >&lt;p&gt;Made this a critial issue for 1.9.0 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tzulitai&quot; class=&quot;user-hover&quot; rel=&quot;tzulitai&quot;&gt;tzulitai&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ykt836&quot; class=&quot;user-hover&quot; rel=&quot;ykt836&quot;&gt;ykt836&lt;/a&gt;. Let&apos;s see whether we can fix it for the upcoming release.&lt;/p&gt;</comment>
                            <comment id="16886119" author="ykt836" created="Tue, 16 Jul 2019 13:43:58 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16887694" author="tison" created="Thu, 18 Jul 2019 06:55:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt; in the attached mail you said &quot;As a consequence the created future from the 2nd leadership will never be executed.&quot;&lt;/p&gt;

&lt;p&gt;I suspect that the previous main thread executor was invalidated but still the created future would be executed but failed for a mismatch fencing token? In this case there would be an error instead of stuck. I&apos;m curious why the future was never executed instead of executed and produced an error.(UPDATE: gotcha that we schedule the start future in the MainThreadExecutor and if leader changes, the action failed but not exception returned because it is a &lt;tt&gt;tell&lt;/tt&gt; and thus the future never completed)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt; could you please share the log here or send to me?&lt;/p&gt;</comment>
                            <comment id="16888172" author="stevenz3wu" created="Thu, 18 Jul 2019 17:14:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Tison&quot; class=&quot;user-hover&quot; rel=&quot;tison&quot;&gt;Tison&lt;/a&gt; where do I email you the log?&lt;/p&gt;</comment>
                            <comment id="16888402" author="tison" created="Thu, 18 Jul 2019 23:38:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenz3wu&quot; class=&quot;user-hover&quot; rel=&quot;stevenz3wu&quot;&gt;stevenz3wu&lt;/a&gt; I have sent an email to you :- )&lt;/p&gt;</comment>
                            <comment id="16959863" author="till.rohrmann" created="Fri, 25 Oct 2019 15:38:33 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;1c2097e716&lt;br/&gt;
32a3e5a6a0&lt;br/&gt;
035c6a1a2e&lt;br/&gt;
401f5f3970&lt;br/&gt;
7fcb64bf76&lt;br/&gt;
e3f202698f&lt;br/&gt;
06e79c8eb5&lt;br/&gt;
717b77c665&lt;br/&gt;
78583463e8&lt;br/&gt;
1f2969357c&lt;br/&gt;
cdd0c29102&lt;br/&gt;
a5438ca696&lt;br/&gt;
a805f1b299&lt;br/&gt;
c8675858f3&lt;br/&gt;
4e9dd7f788&lt;br/&gt;
a123c8f50a&lt;br/&gt;
2d3426f332&lt;br/&gt;
a17b9c0a3e&lt;br/&gt;
9bf06697a5&lt;br/&gt;
7851cb6966&lt;br/&gt;
c1f67ef1f2&lt;br/&gt;
c5dee3141c&lt;br/&gt;
7a23e02832&lt;br/&gt;
b6128ca6c8&lt;br/&gt;
8467acc100&lt;br/&gt;
cb5fba5bba&lt;br/&gt;
f67349db10&lt;br/&gt;
358d46c784&lt;br/&gt;
07c5b720fc&lt;br/&gt;
0b9382bb3b&lt;br/&gt;
90db87ddb9&lt;br/&gt;
9d447ada31&lt;br/&gt;
7956a14c4e&lt;br/&gt;
d734ac0bc6&lt;br/&gt;
637a6e9eae&lt;br/&gt;
431e2a0423&lt;br/&gt;
89e9b6f000&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13224546">FLINK-12048</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13216772">FLINK-11665</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z00eu0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>