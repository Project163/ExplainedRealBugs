<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:20:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-35803] ResumeCheckpointManuallyITCase fails with checkpoint file merging</title>
                <link>https://issues.apache.org/jira/browse/FLINK-35803</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=60807&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&amp;amp;l=8905&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=60807&amp;amp;view=logs&amp;amp;j=5c8e7682-d68f-54d1-16a2-a09310218a49&amp;amp;t=86f654fa-ab48-5c1a-25f4-7e7f6afb9bba&amp;amp;l=8905&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Test: ResumeCheckpointManuallyITCase.testExternalizedIncrementalRocksDBCheckpointsWithLocalRecoveryZookeeper&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;FileNotFoundException happens when restoring from checkpoint that enabled file merging.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure the file is deleted unpectedly by flink code or CI is unstable.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13585283">FLINK-35803</key>
            <summary>ResumeCheckpointManuallyITCase fails with checkpoint file merging</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zakelly">Zakelly Lan</assignee>
                                    <reporter username="fanrui">Rui Fan</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 10 Jul 2024 08:45:48 +0000</created>
                <updated>Mon, 2 Sep 2024 09:25:55 +0000</updated>
                            <resolved>Thu, 11 Jul 2024 02:31:36 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.20.0</version>
                                    <fixVersion>1.20.0</fixVersion>
                    <fixVersion>2.0-preview</fixVersion>
                                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17864555" author="fanrui" created="Wed, 10 Jul 2024 08:49:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;Zakelly&lt;/a&gt; , I&apos;m not sure whether the file is deleted due to &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-35784&quot; title=&quot;The cp file-merging directory not properly registered in SharedStateRegistry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-35784&quot;&gt;&lt;del&gt;FLINK-35784&lt;/del&gt;&lt;/a&gt;. Could you please help take a look? thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m still testing on my Mac for now, and try to reproduce this failure. I will update here once I have any progress.&lt;/p&gt;</comment>
                            <comment id="17864557" author="zakelly" created="Wed, 10 Jul 2024 08:54:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fanrui&quot; class=&quot;user-hover&quot; rel=&quot;fanrui&quot;&gt;fanrui&lt;/a&gt; Thanks for letting me know. I&apos;ll take a look&lt;/p&gt;</comment>
                            <comment id="17864565" author="fanrui" created="Wed, 10 Jul 2024 09:21:17 +0000"  >&lt;p&gt;I&apos;m very sure this CI failure isn&apos;t caused by CI unstable, the file merging or test code have bug. I enable the CheckpointingOptions.FILE_MERGING_ENABLED, and 2 tests fail when RestoreMode is CLAIM.&lt;/p&gt;

&lt;p&gt;My local is master branch, as i understand, the file-merging related code in 1.20 is same with master. So I think this failure will happen in 1.20 as well. So I upgrade this Jira to Blocker.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13070038/13070038_image-2024-07-10-17-19-00-916.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17864571" author="fanrui" created="Wed, 10 Jul 2024 09:35:30 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zakelly&quot; class=&quot;user-hover&quot; rel=&quot;zakelly&quot;&gt;zakelly&lt;/a&gt; , I wanna provide more information to help you troubleshooting.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m sure this failure is caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-35784&quot; title=&quot;The cp file-merging directory not properly registered in SharedStateRegistry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-35784&quot;&gt;&lt;del&gt;FLINK-35784&lt;/del&gt;&lt;/a&gt;. Because ResumeCheckpointManuallyITCase works well after I revert &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-35784&quot; title=&quot;The cp file-merging directory not properly registered in SharedStateRegistry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-35784&quot;&gt;&lt;del&gt;FLINK-35784&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I guess &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-35784&quot; title=&quot;The cp file-merging directory not properly registered in SharedStateRegistry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-35784&quot;&gt;&lt;del&gt;FLINK-35784&lt;/del&gt;&lt;/a&gt; doesn&apos;t work with rocksdb incremental checkpoint. I run ResumeCheckpointManuallyITCase locally multiple times, I found all failed tests are related to rocksdb incremental checkpoint&lt;/p&gt;</comment>
                            <comment id="17864572" author="weijie guo" created="Wed, 10 Jul 2024 09:36:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=60798&amp;amp;view=logs&amp;amp;j=2c3cbe13-dee0-5837-cf47-3053da9a8a78&amp;amp;t=b78d9d30-509a-5cea-1fef-db7abaa325ae&amp;amp;l=9405&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=60798&amp;amp;view=logs&amp;amp;j=2c3cbe13-dee0-5837-cf47-3053da9a8a78&amp;amp;t=b78d9d30-509a-5cea-1fef-db7abaa325ae&amp;amp;l=9405&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17864584" author="zakelly" created="Wed, 10 Jul 2024 10:20:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fanrui&quot; class=&quot;user-hover&quot; rel=&quot;fanrui&quot;&gt;fanrui&lt;/a&gt; Thanks for you infomation!&lt;/p&gt;

&lt;p&gt;After some debugging, I found it actually is an old bug of file-merging about referencing the wrong file that is already cleaned by CLAIM mode. It happens when the thrid job tries to restore and read a cp file from the first job (which is already deleted by the second job of course). Before &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-35784&quot; title=&quot;The cp file-merging directory not properly registered in SharedStateRegistry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-35784&quot;&gt;&lt;del&gt;FLINK-35784&lt;/del&gt;&lt;/a&gt;, the files are not deleted properly, so this bug is covered up. And the reason why the AZP for &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-35784&quot; title=&quot;The cp file-merging directory not properly registered in SharedStateRegistry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-35784&quot;&gt;&lt;del&gt;FLINK-35784&lt;/del&gt;&lt;/a&gt;&apos;s PR passed is that, the cp files are deleted by async io threads, so it happens that the third job read the wrong files before their deletion.&lt;/p&gt;

&lt;p&gt;I&apos;ll prepare the fix.&lt;/p&gt;</comment>
                            <comment id="17864874" author="zakelly" created="Thu, 11 Jul 2024 02:31:26 +0000"  >&lt;p&gt;Merged into master via: 2cad54846510db63254c503e6d9d44b6b5ddc124&lt;br/&gt;
1.20 via: 2309ab319dc273fd10270ceefe44e766ad43e893&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13585478">FLINK-35821</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13070038" name="image-2024-07-10-17-19-00-916.png" size="774882" author="fanrui" created="Wed, 10 Jul 2024 09:19:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1q914:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>