<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:40:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-12038] YARNITCase stalls on travis</title>
                <link>https://issues.apache.org/jira/browse/FLINK-12038</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://travis-ci.org/apache/flink/jobs/511932978&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/apache/flink/jobs/511932978&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13224311">FLINK-12038</key>
            <summary>YARNITCase stalls on travis</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tiemsn">shuai.xu</assignee>
                                    <reporter username="chesnay">Chesnay Schepler</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 27 Mar 2019 13:45:03 +0000</created>
                <updated>Tue, 30 Jul 2019 11:52:25 +0000</updated>
                            <resolved>Tue, 30 Jul 2019 11:52:25 +0000</resolved>
                                    <version>1.9.0</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>Deployment / YARN</component>
                    <component>Tests</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16886925" author="tiemsn" created="Wed, 17 Jul 2019 11:01:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;, I think this is caused by&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/YARN-2853&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/YARN-2853&lt;/a&gt;&#160;of yarn 2.4. In the end of the case, it try to kill the application while YarnResourceManager will unregisterAM to yarn. I think we could fix it by adding a check for the application state before killing it, what do you think?&lt;/p&gt;</comment>
                            <comment id="16888062" author="azagrebin" created="Thu, 18 Jul 2019 15:17:33 +0000"  >&lt;p&gt;I tried to loop the test on my travis. It is re-produceable:&#160;&lt;a href=&quot;https://travis-ci.org/azagrebin/flink/builds/557947981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/azagrebin/flink/builds/557947981&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tiemsn&quot; class=&quot;user-hover&quot; rel=&quot;tiemsn&quot;&gt;tiemsn&lt;/a&gt; Have you tried this approach with waiting of the application state and looping it on Travis?&lt;br/&gt;
It does not look like this test actually tries to&#160;unregisterAM (found it only in YarnResourceManager#internalDeregisterApplication).&lt;br/&gt;
At least the debugger does not stop there.&lt;br/&gt;
I guess it was the original reason to kill app because it is blocking instead of shutting down the cluster asynchronously over REST and wait somehow for the shutdown which&#160;might be an option.&lt;/p&gt;</comment>
                            <comment id="16888482" author="tiemsn" created="Fri, 19 Jul 2019 03:30:22 +0000"  >&lt;p&gt;This failure can be easily re-produced in my local machine. I enabled the logs of YARN, and found the reason.&#160;You can find the log of unregisterAM in jobmanager.log. When the job is finished, it will try to unregisterAM to YARN. In fact, it is not necessary to call killApplication, as the whole YARN mini cluster will be closed in the tearDown of test case.&#160;&lt;/p&gt;

&lt;p&gt;The bellowing is part of logs of job master:&lt;/p&gt;

&lt;p&gt;2019-07-16 18:20:34,376 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Source: Custom Source (1/2) (e13567c7f2d7a389c74f4583a67e34e8) switched from SCHEDULED to DEPLOYING.&lt;br/&gt;
2019-07-16 18:20:34,376 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Deploying Source: Custom Source (1/2) (attempt #0) to container_1563272405568_0001_01_000002 @ e011239174096.et15sqa (dataPort=42072)&lt;br/&gt;
2019-07-16 18:20:34,404 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Source: Custom Source (2/2) (fc3d9d65a75eabaf00d7d9372d2b9884) switched from SCHEDULED to DEPLOYING.&lt;br/&gt;
2019-07-16 18:20:34,405 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Deploying Source: Custom Source (2/2) (attempt #0) to container_1563272405568_0001_01_000003 @ e011239174096.et15sqa (dataPort=41793)&lt;br/&gt;
2019-07-16 18:20:34,405 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Sink: Unnamed (1/2) (65db57ac7166e0a96a3c5318bb262fb0) switched from SCHEDULED to DEPLOYING.&lt;br/&gt;
2019-07-16 18:20:34,414 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Deploying Sink: Unnamed (1/2) (attempt #0) to container_1563272405568_0001_01_000003 @ e011239174096.et15sqa (dataPort=41793)&lt;br/&gt;
2019-07-16 18:20:34,447 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Sink: Unnamed (2/2) (22c3e0c0fd37dd00e75fcf855e2a6ca4) switched from SCHEDULED to DEPLOYING.&lt;br/&gt;
2019-07-16 18:20:34,447 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Deploying Sink: Unnamed (2/2) (attempt #0) to container_1563272405568_0001_01_000002 @ e011239174096.et15sqa (dataPort=42072)&lt;br/&gt;
2019-07-16 18:20:34,897 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Source: Custom Source (1/2) (e13567c7f2d7a389c74f4583a67e34e8) switched from DEPLOYING to RUNNING.&lt;br/&gt;
2019-07-16 18:20:34,949 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Source: Custom Source (2/2) (fc3d9d65a75eabaf00d7d9372d2b9884) switched from DEPLOYING to RUNNING.&lt;br/&gt;
2019-07-16 18:20:35,056 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Sink: Unnamed (1/2) (65db57ac7166e0a96a3c5318bb262fb0) switched from DEPLOYING to RUNNING.&lt;br/&gt;
2019-07-16 18:20:35,067 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Sink: Unnamed (2/2) (22c3e0c0fd37dd00e75fcf855e2a6ca4) switched from DEPLOYING to RUNNING.&lt;br/&gt;
2019-07-16 18:20:35,450 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Source: Custom Source (2/2) (fc3d9d65a75eabaf00d7d9372d2b9884) switched from RUNNING to FINISHED.&lt;br/&gt;
2019-07-16 18:20:35,480 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Source: Custom Source (1/2) (e13567c7f2d7a389c74f4583a67e34e8) switched from RUNNING to FINISHED.&lt;br/&gt;
2019-07-16 18:20:35,494 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Sink: Unnamed (2/2) (22c3e0c0fd37dd00e75fcf855e2a6ca4) switched from RUNNING to FINISHED.&lt;br/&gt;
2019-07-16 18:20:35,508 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Sink: Unnamed (1/2) (65db57ac7166e0a96a3c5318bb262fb0) switched from RUNNING to FINISHED.&lt;br/&gt;
2019-07-16 18:20:35,513 INFO org.apache.flink.runtime.executiongraph.ExecutionGraph - Job Flink Streaming Job (2f9313ea4fd33bef68111ed380a2ae1b) switched from state RUNNING to FINISHED.&lt;br/&gt;
2019-07-16 18:20:35,513 INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator - Stopping checkpoint coordinator for job 2f9313ea4fd33bef68111ed380a2ae1b.&lt;br/&gt;
2019-07-16 18:20:35,513 INFO org.apache.flink.runtime.checkpoint.StandaloneCompletedCheckpointStore - Shutting down&lt;br/&gt;
2019-07-16 18:20:35,564 INFO org.apache.flink.runtime.dispatcher.MiniDispatcher - Job 2f9313ea4fd33bef68111ed380a2ae1b reached globally terminal state FINISHED.&lt;br/&gt;
2019-07-16 18:20:35,573 INFO org.apache.flink.runtime.jobmaster.JobMaster - Stopping the JobMaster for job Flink Streaming Job(2f9313ea4fd33bef68111ed380a2ae1b).&lt;br/&gt;
2019-07-16 18:20:35,664 INFO org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl - Suspending SlotPool.&lt;br/&gt;
2019-07-16 18:20:35,666 INFO org.apache.flink.runtime.jobmaster.JobMaster - Close ResourceManager connection 165d22977dc31b3b410489789fdc1050: JobManager is shutting down..&lt;br/&gt;
2019-07-16 18:20:35,668 INFO org.apache.flink.runtime.jobmaster.slotpool.SlotPoolImpl - Stopping SlotPool.&lt;br/&gt;
2019-07-16 18:20:35,668 INFO org.apache.flink.yarn.YarnResourceManager - Disconnect job manager 00000000000000000000000000000000@akka.tcp://flink@e011239174096.et15sqa:50088/user/jobmanager_0 for job 2f9313ea4fd33bef68111ed380a2ae1b from the resource manager.&lt;br/&gt;
2019-07-16 18:20:35,681 INFO org.apache.flink.runtime.jobmaster.JobManagerRunner - JobManagerRunner already shutdown.&lt;br/&gt;
2019-07-16 18:20:36,844 INFO org.apache.flink.runtime.entrypoint.ClusterEntrypoint - Shutting YarnJobClusterEntrypoint down with application status SUCCEEDED. Diagnostics null.&lt;br/&gt;
2019-07-16 18:20:36,844 INFO org.apache.flink.runtime.jobmaster.MiniDispatcherRestEndpoint - Shutting down rest endpoint.&lt;br/&gt;
2019-07-16 18:20:36,889 INFO org.apache.flink.runtime.jobmaster.MiniDispatcherRestEndpoint - Removing cache directory /tmp/flink-web-0b120d31-7130-4fcb-bfa8-699abdd5b81e/flink-web-ui&lt;br/&gt;
2019-07-16 18:20:36,890 INFO org.apache.flink.runtime.jobmaster.MiniDispatcherRestEndpoint - &lt;a href=&quot;http://e011239174096.et15sqa:38342&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://e011239174096.et15sqa:38342&lt;/a&gt; lost leadership&lt;br/&gt;
2019-07-16 18:20:36,892 INFO org.apache.flink.runtime.jobmaster.MiniDispatcherRestEndpoint - Shut down complete.&lt;br/&gt;
2019-07-16 18:20:36,895 INFO org.apache.flink.yarn.YarnResourceManager - Shut down cluster because application is in SUCCEEDED, diagnostics null.&lt;br/&gt;
2019-07-16 18:20:36,896 INFO org.apache.flink.yarn.YarnResourceManager - &lt;font color=&quot;#FF0000&quot;&gt;Unregister application from the YARN Resource Manager with final status SUCCEEDED.&lt;/font&gt;&lt;br/&gt;
2019-07-16 18:20:36,981 INFO org.apache.hadoop.yarn.client.api.impl.AMRMClientImpl - Waiting for application to be successfully unregistered.&lt;/p&gt;</comment>
                            <comment id="16888946" author="azagrebin" created="Fri, 19 Jul 2019 14:54:20 +0000"  >&lt;p&gt;True, I see it also in JM logs.&lt;/p&gt;

&lt;p&gt;I looped again the test on Travis with the previously suggested fix where the test waits for yarn app FINISHED state with a&#160;timeout.&lt;br/&gt;
 &lt;a href=&quot;https://travis-ci.org/azagrebin/flink/builds/560969859&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://travis-ci.org/azagrebin/flink/builds/560969859&lt;/a&gt;&lt;br/&gt;
The&#160;CI fails due to overall timeout because loop has too many iterations but the test does not fail as previously after couple of iterations. I think the fix works.&lt;/p&gt;

&lt;p&gt;The waiting&#160;does not take long. Then there is no need to kill the app in this case, only if normal shutdown does not reach&#160;FINISHED within a&#160;timeout which would again signal that there is some problem. I think it is a cleaner&#160;approach. I would see the yarn mini cluster shutdown in the&#160;@AfterClass test method as an emergency cleanup.&lt;/p&gt;</comment>
                            <comment id="16890844" author="azagrebin" created="Tue, 23 Jul 2019 09:37:00 +0000"  >&lt;p&gt;Thanks for adjusting the PR &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tiemsn&quot; class=&quot;user-hover&quot; rel=&quot;tiemsn&quot;&gt;tiemsn&lt;/a&gt;. I will review it.&lt;/p&gt;</comment>
                            <comment id="16896056" author="till.rohrmann" created="Tue, 30 Jul 2019 11:52:25 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;1.10.0: 36d9a756343b41f7fd3123dff8bd2bb5737b6e26&lt;br/&gt;
1.9.0: 420f6cac29bf795f524a40bca60adb46edfa6e3a&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z015p4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>