<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:43:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14701] Slot leaks if SharedSlotOversubscribedException happens</title>
                <link>https://issues.apache.org/jira/browse/FLINK-14701</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;If a &lt;tt&gt;SharedSlotOversubscribedException&lt;/tt&gt; happens, the &lt;tt&gt;MultiTaskSlot&lt;/tt&gt; will release some of its child &lt;tt&gt;SingleTaskSlot&lt;/tt&gt;. The triggered releasing will trigger a re-allocation of the task slot right inside &lt;tt&gt;SingleTaskSlot#release(...)&lt;/tt&gt;. So that a previous allocation in &lt;tt&gt;SloSharingManager#allTaskSlots&lt;/tt&gt; will be replaced by the new allocation because they share the same &lt;tt&gt;slotRequestId&lt;/tt&gt;.&lt;br/&gt;
However, the &lt;tt&gt;SingleTaskSlot#release(...)&lt;/tt&gt; will then invoke &lt;tt&gt;MultiTaskSlot#releaseChild&lt;/tt&gt; to release the previous allocation with the &lt;tt&gt;slotRequestId&lt;/tt&gt;, which will unexpectedly remove the new allocation from the &lt;tt&gt;SloSharingManager&lt;/tt&gt;.&lt;br/&gt;
In this way, slot leak happens because the pending slot request is not tracked by the &lt;tt&gt;SloSharingManager&lt;/tt&gt; and cannot be released when its payload terminates.&lt;/p&gt;

&lt;p&gt;A test case &lt;tt&gt;testNoSlotLeakOnSharedSlotOversubscribedException&lt;/tt&gt; which exhibits this issue can be found in this &lt;a href=&quot;https://github.com/zhuzhurk/flink/commit/9024e2e9eb4bd17f371896d6dbc745bc9e585e14&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;commit&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The slot leak blocks the TPC-DS queries on flink 1.10, see &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14674&quot; title=&quot;some tpc-ds query hang in scheduled stage for long time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14674&quot;&gt;&lt;del&gt;FLINK-14674&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;To solve it, I&apos;d propose to strengthen the &lt;tt&gt;MultiTaskSlot#releaseChild&lt;/tt&gt; to only remove its true child task slot from the &lt;tt&gt;SloSharingManager&lt;/tt&gt;, i.e. add a check &lt;tt&gt;if (child == allTaskSlots.get(child.getSlotRequestId()))&lt;/tt&gt; before invoking &lt;tt&gt;allTaskSlots.remove(child.getSlotRequestId())&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13267414">FLINK-14701</key>
            <summary>Slot leaks if SharedSlotOversubscribedException happens</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhuzh">Zhu Zhu</assignee>
                                    <reporter username="zhuzh">Zhu Zhu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 11 Nov 2019 07:29:27 +0000</created>
                <updated>Fri, 24 Jan 2020 10:39:04 +0000</updated>
                            <resolved>Fri, 24 Jan 2020 10:39:04 +0000</resolved>
                                    <version>1.9.2</version>
                                    <fixVersion>1.9.2</fixVersion>
                    <fixVersion>1.10.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16971359" author="zhuzh" created="Mon, 11 Nov 2019 07:35:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;, what do you think of the issue and the proposed solution?&lt;br/&gt;
This issue also happens in 1.9 so I think we also need the fix there.&lt;/p&gt;</comment>
                            <comment id="16981117" author="zhuzh" created="Sun, 24 Nov 2019 16:02:43 +0000"  >&lt;p&gt;This issue is not critical now since &lt;tt&gt;SharedSlotOversubscribedException&lt;/tt&gt; is removed in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-14314&quot; title=&quot;Allocate shared slot resources respecting the resources of all vertices in the group&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-14314&quot;&gt;&lt;del&gt;FLINK-14314&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
However, the proposed change is still valid to avoid similar issue to happen in the future.&lt;br/&gt;
The proposed change is small, at no cost nor risk. So I&apos;d still like to have the proposed change for &lt;tt&gt;MultiTaskSlot#releaseChild&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17016536" author="zhuzh" created="Thu, 16 Jan 2020 04:08:02 +0000"  >&lt;p&gt;Reopen this issue since it&apos;s still a issue in 1.9 and we should fix it.&lt;/p&gt;</comment>
                            <comment id="17021656" author="hequn8128" created="Thu, 23 Jan 2020 01:27:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhuzh&quot; class=&quot;user-hover&quot; rel=&quot;zhuzh&quot;&gt;zhuzh&lt;/a&gt; Hi, could I move this issue to 1.9.3 as it is not critical? The release of 1.9.2 is very close. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17021741" author="zhuzh" created="Thu, 23 Jan 2020 03:51:19 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hequn8128&quot; class=&quot;user-hover&quot; rel=&quot;hequn8128&quot;&gt;hequn8128&lt;/a&gt;, it is still a critical issue (slot leak) for 1.9. It is not critical for 1.10 because some feature changes fixed it in a different way, however the issue still exists in 1.9.&lt;/p&gt;</comment>
                            <comment id="17022102" author="till.rohrmann" created="Thu, 23 Jan 2020 13:42:06 +0000"  >&lt;p&gt;I&apos;m looking forward to the days where we finally get rid of the &lt;tt&gt;SlotSharingManager&lt;/tt&gt; and of all other related issues caused by the dynamic slot sharing model.&lt;/p&gt;</comment>
                            <comment id="17022849" author="till.rohrmann" created="Fri, 24 Jan 2020 10:39:04 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;master: bd5901f3351d1f70a8b0edcfee8015f91b099f3a&lt;br/&gt;
1.10.0: 27d4cc4b66bf7485d5d26660f9640a1e8862a9c2&lt;br/&gt;
1.9.2: 0bdd21a36136538b554d7e4bd7ce80bc3c461596&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13267073">FLINK-14674</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08gi8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>