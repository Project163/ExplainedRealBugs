<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:28:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-6662] ClassNotFoundException: o.a.f.r.j.t.JobSnapshottingSettings recovering job</title>
                <link>https://issues.apache.org/jira/browse/FLINK-6662</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Running flink mesos on 1.3-release branch, I&apos;m seeing the following error on appmaster startup:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2017-05-22 15:32:45.946 [flink-akka.actor.default-dispatcher-17] WARN  o.a.flink.mesos.runtime.clusterframework.MesosJobManager  - Failed to recover job 088027410f1a628e7dfc59dc23df3ded.
java.lang.Exception: Failed to retrieve the submitted job graph from state handle.
        at org.apache.flink.runtime.jobmanager.ZooKeeperSubmittedJobGraphStore.recoverJobGraph(ZooKeeperSubmittedJobGraphStore.java:186)
        at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$1$$anonfun$apply$mcV$sp$1.apply$mcV$sp(JobManager.scala:536)
        at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$1$$anonfun$apply$mcV$sp$1.apply(JobManager.scala:533)
        at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$1$$anonfun$apply$mcV$sp$1.apply(JobManager.scala:533)
        at scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)
        at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$1.apply$mcV$sp(JobManager.scala:533)
        at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$1.apply(JobManager.scala:529)
        at org.apache.flink.runtime.jobmanager.JobManager$$anonfun$handleMessage$1$$anonfun$applyOrElse$1.apply(JobManager.scala:529)
        at scala.concurrent.impl.Future$PromiseCompletingRunnable.liftedTree1$1(Future.scala:24)
        at scala.concurrent.impl.Future$PromiseCompletingRunnable.run(Future.scala:24)
        at akka.dispatch.TaskInvocation.run(AbstractDispatcher.scala:40)
        at akka.dispatch.ForkJoinExecutorConfigurator$AkkaForkJoinTask.exec(AbstractDispatcher.scala:397)
        at scala.concurrent.forkjoin.ForkJoinTask.doExec(ForkJoinTask.java:260)
        at scala.concurrent.forkjoin.ForkJoinPool$WorkQueue.runTask(ForkJoinPool.java:1339)
        at scala.concurrent.forkjoin.ForkJoinPool.runWorker(ForkJoinPool.java:1979)
        at scala.concurrent.forkjoin.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:107)
Caused by: java.lang.ClassNotFoundException: org.apache.flink.runtime.jobgraph.tasks.JobSnapshottingSettings
        at java.net.URLClassLoader.findClass(URLClassLoader.java:381)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:424)
        at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:335)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        at java.lang.Class.forName0(Native Method)
        at java.lang.Class.forName(Class.java:348)
        at org.apache.flink.util.InstantiationUtil$ClassLoaderObjectInputStream.resolveClass(InstantiationUtil.java:64)
        at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1826)
        at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1713)
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2000)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2245)
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2169)
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2027)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
        at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:2245)
        at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:2169)
        at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:2027)
        at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1535)
        at java.io.ObjectInputStream.readObject(ObjectInputStream.java:422)
        at org.apache.flink.util.InstantiationUtil.deserializeObject(InstantiationUtil.java:305)
        at org.apache.flink.runtime.state.RetrievableStreamStateHandle.retrieveState(RetrievableStreamStateHandle.java:58)
        at org.apache.flink.runtime.jobmanager.ZooKeeperSubmittedJobGraphStore.recoverJobGraph(ZooKeeperSubmittedJobGraphStore.java:184)
        ... 15 common frames omitted
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13073918">FLINK-6662</key>
            <summary>ClassNotFoundException: o.a.f.r.j.t.JobSnapshottingSettings recovering job</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="trohrmann">Till Rohrmann</assignee>
                                    <reporter username="jstehler">Jared Stehler</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 May 2017 16:05:12 +0000</created>
                <updated>Thu, 28 Feb 2019 14:01:07 +0000</updated>
                            <resolved>Tue, 23 May 2017 18:30:38 +0000</resolved>
                                    <version>1.3.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Deployment / Mesos</component>
                    <component>Runtime / Coordination</component>
                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16019909" author="stephanewen" created="Mon, 22 May 2017 17:54:32 +0000"  >&lt;p&gt;Are you trying to let a Flink 1.3 recover a pending Job from an earlier Flink version via a high-availability setup?&lt;/p&gt;

&lt;p&gt;That pattern is not supported - Framework version upgrades should go through savepoints, and not through ZooKeeper.&lt;br/&gt;
A fair point is, though, that this should be reported as an explicit exception, not simply a &lt;tt&gt;ClassNotFoundException&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16019911" author="stephanewen" created="Mon, 22 May 2017 17:55:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann@apache.org&quot;&gt;trohrmann@apache.org&lt;/a&gt; What do you think about this issue?&lt;/p&gt;</comment>
                            <comment id="16019914" author="jstehler" created="Mon, 22 May 2017 17:58:04 +0000"  >&lt;p&gt;Yup, was just booting a new flink on 1.3 over an existing 1.2 setup, so the system was attempting recovery on startup. I can clear out the zk references and redeploy.&lt;/p&gt;</comment>
                            <comment id="16020788" author="till.rohrmann" created="Tue, 23 May 2017 08:18:18 +0000"  >&lt;p&gt;+1 for improving the exception message. I will add a `ClassNotFoundException` handler and output a better error message.&lt;/p&gt;</comment>
                            <comment id="16021206" author="githubbot" created="Tue, 23 May 2017 13:46:44 +0000"  >&lt;p&gt;GitHub user tillrohrmann opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3972&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3972&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6662&quot; title=&quot;ClassNotFoundException: o.a.f.r.j.t.JobSnapshottingSettings recovering job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6662&quot;&gt;&lt;del&gt;FLINK-6662&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;errMsg&amp;#93;&lt;/span&gt; Improve error message if recovery from RetrievableStateHandles fails&lt;/p&gt;

&lt;p&gt;    When recovering state from a ZooKeeperStateHandleStore it can happen that the deserialization&lt;br/&gt;
    fails, because one tries to recover state from an old Flink version which is not compatible.&lt;br/&gt;
    In this case we should output a better error message such that the user can easily spot the&lt;br/&gt;
    problem.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tillrohrmann/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tillrohrmann/flink&lt;/a&gt; improveErrorMessages&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3972.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3972.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #3972&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 31d099c4768f1ee8dfbecfd8eddc6f05842425e6&lt;br/&gt;
Author: Till Rohrmann &amp;lt;trohrmann@apache.org&amp;gt;&lt;br/&gt;
Date:   2017-05-23T13:42:38Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-6662&quot; title=&quot;ClassNotFoundException: o.a.f.r.j.t.JobSnapshottingSettings recovering job&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-6662&quot;&gt;&lt;del&gt;FLINK-6662&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;errMsg&amp;#93;&lt;/span&gt; Improve error message if recovery from RetrievableStateHandles fails&lt;/p&gt;

&lt;p&gt;    When recovering state from a ZooKeeperStateHandleStore it can happen that the deserialization&lt;br/&gt;
    fails, because one tries to recover state from an old Flink version which is not compatible.&lt;br/&gt;
    In this case we should output a better error message such that the user can easily spot the&lt;br/&gt;
    problem.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16021337" author="githubbot" created="Tue, 23 May 2017 15:32:25 +0000"  >&lt;p&gt;Github user zentol commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3972#discussion_r118026253&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3972#discussion_r118026253&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/ZooKeeperCompletedCheckpointStore.java &amp;#8212;&lt;br/&gt;
    @@ -376,8 +377,14 @@ private static CompletedCheckpoint retrieveCompletedCheckpoint(Tuple2&amp;lt;Retrievabl&lt;/p&gt;

&lt;p&gt;     		try &lt;/p&gt;
{
     			return stateHandlePath.f0.retrieveState();
    -		}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
    -			throw new FlinkException(&quot;Could not retrieve checkpoint &quot; + checkpointId + &quot;. The state handle seems to be broken.&quot;, e);
    +		}
&lt;p&gt; catch (ClassNotFoundException cnfe) &lt;/p&gt;
{
    +			throw new FlinkException(&quot;Could not retrieve checkpoint &quot; + checkpointId + &quot; from state handle under &quot; +
    +				stateHandlePath.f1 + &quot;. This indicates that you are trying to recover from state written by an &quot; +
    +				&quot;older Flink version which is not compatible. Try cleaning the state handle store.&quot;, cnfe);
    +		}
&lt;p&gt; catch (IOException ioe) {&lt;br/&gt;
    +			throw new FlinkException(&quot;Could not retrieve &quot; + checkpointId + &quot; worker from state handle under &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    shouldn&apos;t this say `Could not retrieve checkpoint &quot; + checkpointId + &quot; from state handle under` like in case of an CNFE?&lt;/p&gt;</comment>
                            <comment id="16021589" author="githubbot" created="Tue, 23 May 2017 18:22:13 +0000"  >&lt;p&gt;Github user tillrohrmann commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3972#discussion_r118068470&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3972#discussion_r118068470&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/ZooKeeperCompletedCheckpointStore.java &amp;#8212;&lt;br/&gt;
    @@ -376,8 +377,14 @@ private static CompletedCheckpoint retrieveCompletedCheckpoint(Tuple2&amp;lt;Retrievabl&lt;/p&gt;

&lt;p&gt;     		try &lt;/p&gt;
{
     			return stateHandlePath.f0.retrieveState();
    -		}
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
    -			throw new FlinkException(&quot;Could not retrieve checkpoint &quot; + checkpointId + &quot;. The state handle seems to be broken.&quot;, e);
    +		}
&lt;p&gt; catch (ClassNotFoundException cnfe) &lt;/p&gt;
{
    +			throw new FlinkException(&quot;Could not retrieve checkpoint &quot; + checkpointId + &quot; from state handle under &quot; +
    +				stateHandlePath.f1 + &quot;. This indicates that you are trying to recover from state written by an &quot; +
    +				&quot;older Flink version which is not compatible. Try cleaning the state handle store.&quot;, cnfe);
    +		}
&lt;p&gt; catch (IOException ioe) {&lt;br/&gt;
    +			throw new FlinkException(&quot;Could not retrieve &quot; + checkpointId + &quot; worker from state handle under &quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Yes, a copy &amp;amp; paste error from my side. I will correct it.&lt;/p&gt;</comment>
                            <comment id="16021591" author="githubbot" created="Tue, 23 May 2017 18:22:23 +0000"  >&lt;p&gt;Github user tillrohrmann commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3972&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3972&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @zentol.&lt;/p&gt;</comment>
                            <comment id="16021599" author="githubbot" created="Tue, 23 May 2017 18:25:55 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/3972&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/3972&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16021610" author="till.rohrmann" created="Tue, 23 May 2017 18:30:38 +0000"  >&lt;p&gt;1.4.0: ac6e5c9a03177ad18899e27c8877efb0c9211842&lt;br/&gt;
1.3.0: d552b34470748de803a999c2c4c1557c49b30045&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fb13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>