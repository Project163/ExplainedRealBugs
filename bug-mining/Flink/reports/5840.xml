<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:05:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-23611] YARNSessionCapacitySchedulerITCase.testVCoresAreSetCorrectlyAndJobManagerHostnameAreShownInWebInterfaceAndDynamicPropertiesAndYarnApplicationNameAndTaskManagerSlots hangs on azure</title>
                <link>https://issues.apache.org/jira/browse/FLINK-23611</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=21439&amp;amp;view=logs&amp;amp;j=245e1f2e-ba5b-5570-d689-25ae21e5302f&amp;amp;t=e7f339b2-a7c3-57d9-00af-3712d4b15354&amp;amp;l=28959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=21439&amp;amp;view=logs&amp;amp;j=245e1f2e-ba5b-5570-d689-25ae21e5302f&amp;amp;t=e7f339b2-a7c3-57d9-00af-3712d4b15354&amp;amp;l=28959&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13393363">FLINK-23611</key>
            <summary>YARNSessionCapacitySchedulerITCase.testVCoresAreSetCorrectlyAndJobManagerHostnameAreShownInWebInterfaceAndDynamicPropertiesAndYarnApplicationNameAndTaskManagerSlots hangs on azure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="xtsong">Xintong Song</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Wed, 4 Aug 2021 02:57:06 +0000</created>
                <updated>Fri, 16 Jun 2023 09:02:23 +0000</updated>
                            <resolved>Fri, 30 Sep 2022 08:23:11 +0000</resolved>
                                    <version>1.14.0</version>
                    <version>1.12.5</version>
                                    <fixVersion>1.16.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17400143" author="xintongsong" created="Tue, 17 Aug 2021 05:15:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=22329&amp;amp;view=logs&amp;amp;j=8fd975ef-f478-511d-4997-6f15fe8a1fd3&amp;amp;t=494f6362-8ffa-5ff8-9158-c7f00e541279&amp;amp;l=32779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=22329&amp;amp;view=logs&amp;amp;j=8fd975ef-f478-511d-4997-6f15fe8a1fd3&amp;amp;t=494f6362-8ffa-5ff8-9158-c7f00e541279&amp;amp;l=32779&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17404208" author="mapohl" created="Wed, 25 Aug 2021 06:48:49 +0000"  >&lt;p&gt;For documentation: The actual timeout is probably happening because we&apos;re waiting forever to for the YARN Session Cluster Thread to finalize (see &lt;a href=&quot;https://github.com/apache/flink/blob/646ff2d36f40704f5dca017b8fffed78bd51b307/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionCapacitySchedulerITCase.java#L357&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;YARNSessionCapacitySchedulerITCase:357&lt;/a&gt;). The link in the issue description doesn&apos;t help at all since it doesn&apos;t provide any artifacts, unfortenately. The &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23611?focusedCommentId=17400143&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17400143&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;2nd link shared in the previous comment&lt;/a&gt; is a bit more verbose:&lt;/p&gt;

&lt;p&gt;The run fails due to a &lt;tt&gt;ConnectionException&lt;/tt&gt; in the main method of the submitted job (which is, strangely, only showing up in the &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=22329&amp;amp;view=logs&amp;amp;j=8fd975ef-f478-511d-4997-6f15fe8a1fd3&amp;amp;t=494f6362-8ffa-5ff8-9158-c7f00e541279&amp;amp;l=32843&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;AzureCI UI&lt;/a&gt; and raw logs but not in the watchdog artifact of the build)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.flink.client.program.ProgramInvocationException: The main method caused an error: Failed to execute job &lt;span class=&quot;code-quote&quot;&gt;&apos;Windowed Join Example&apos;&lt;/span&gt;.
	at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:372)
	at org.apache.flink.client.program.PackagedProgram.invokeInteractiveModeForExecution(PackagedProgram.java:222)
	at org.apache.flink.client.ClientUtils.executeProgram(ClientUtils.java:114)
	at org.apache.flink.client.cli.CliFrontend.executeProgram(CliFrontend.java:812)
	at org.apache.flink.client.cli.CliFrontend.run(CliFrontend.java:246)
	at org.apache.flink.client.cli.CliFrontend.parseAndRun(CliFrontend.java:1054)
	at org.apache.flink.yarn.YarnTestBase$Runner.run(YarnTestBase.java:1141)
Caused by: org.apache.flink.util.FlinkException: Failed to execute job &lt;span class=&quot;code-quote&quot;&gt;&apos;Windowed Join Example&apos;&lt;/span&gt;.
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.executeAsync(StreamExecutionEnvironment.java:2056)
	at org.apache.flink.client.program.StreamContextEnvironment.executeAsync(StreamContextEnvironment.java:135)
	at org.apache.flink.client.program.StreamContextEnvironment.execute(StreamContextEnvironment.java:76)
	at org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.execute(StreamExecutionEnvironment.java:1917)
	at org.apache.flink.streaming.examples.join.WindowJoin.main(WindowJoin.java:88)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.apache.flink.client.program.PackagedProgram.callMainMethod(PackagedProgram.java:355)
	... 6 more
Caused by: org.apache.flink.runtime.client.JobSubmissionException: Failed to submit JobGraph.
	at org.apache.flink.client.program.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RestClusterClient.lambda$submitJob$9(RestClusterClient.java:402)
	at java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:884)
	at java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:866)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)
	at org.apache.flink.util.concurrent.FutureUtils.lambda$retryOperationWithDelay$9(FutureUtils.java:399)
	at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)
	at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750)
	at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)
	at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)
	at org.apache.flink.runtime.&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;.RestClient.lambda$submitRequest$1(RestClient.java:476)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:578)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:571)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:550)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:491)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:616)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:609)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.DefaultPromise.tryFailure(DefaultPromise.java:117)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.fulfillConnectPromise(AbstractNioChannel.java:321)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:337)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:707)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)
	at org.apache.flink.shaded.netty4.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: org.apache.flink.util.concurrent.FutureUtils$RetryException: Could not complete the operation. &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of retries has been exhausted.
	at org.apache.flink.util.concurrent.FutureUtils.lambda$retryOperationWithDelay$9(FutureUtils.java:395)
	... 21 more
Caused by: java.util.concurrent.CompletionException: org.apache.flink.shaded.netty4.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:8081
	at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)
	at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)
	at java.util.concurrent.CompletableFuture.uniCompose(CompletableFuture.java:957)
	at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:940)
	... 19 more
Caused by: org.apache.flink.shaded.netty4.io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:8081
Caused by: java.net.ConnectException: Connection refused
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)
	at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:716)
	at org.apache.flink.shaded.netty4.io.netty.channel.socket.nio.NioSocketChannel.doFinishConnect(NioSocketChannel.java:330)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.AbstractNioChannel$AbstractNioUnsafe.finishConnect(AbstractNioChannel.java:334)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:707)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581)
	at org.apache.flink.shaded.netty4.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)
	at org.apache.flink.shaded.netty4.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)
	at org.apache.flink.shaded.netty4.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17404209" author="mapohl" created="Wed, 25 Aug 2021 06:51:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=22329&amp;amp;view=logs&amp;amp;j=8fd975ef-f478-511d-4997-6f15fe8a1fd3&amp;amp;t=494f6362-8ffa-5ff8-9158-c7f00e541279&amp;amp;l=32930&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;The thread dump shows&lt;/a&gt; that the YARN Session Cluster thread is stuck in the loop and is not interrupted:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;Frontend (CLI/YARN Client) runner thread (startWithArgs()).&quot;&lt;/span&gt; #1731 prio=5 os_prio=0 tid=0x00007fedee5b0800 nid=0x682b waiting on condition [0x00007fe9bc670000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (sleeping)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method)
	at org.apache.flink.yarn.cli.FlinkYarnSessionCli.repStep(FlinkYarnSessionCli.java:934)
	at org.apache.flink.yarn.cli.FlinkYarnSessionCli.runInteractiveCli(FlinkYarnSessionCli.java:910)
	at org.apache.flink.yarn.cli.FlinkYarnSessionCli.run(FlinkYarnSessionCli.java:657)
	at org.apache.flink.yarn.YarnTestBase$Runner.run(YarnTestBase.java:1132)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17404237" author="till.rohrmann" created="Wed, 25 Aug 2021 07:14:27 +0000"  >&lt;p&gt;Is &lt;tt&gt;localhost/127.0.0.1:8081&lt;/tt&gt; where Flink&apos;s REST endpoint runs?&lt;/p&gt;</comment>
                            <comment id="17404239" author="mapohl" created="Wed, 25 Aug 2021 07:16:37 +0000"  >&lt;p&gt;Another piece that I still don&apos;t fully understand is an assert error provided in the &lt;tt&gt;mvn-1.log&lt;/tt&gt; of the 2nd build&apos;s artifacts:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
22:44:46,572 [Frontend (CLI/YARN Client) runner thread (startWithArgs()).] INFO  org.apache.flink.yarn.YarnTestBase                           [] - Runner stopped with exception
java.lang.AssertionError: The YARN session returned with unexpected value=1 expected=0
        at org.junit.Assert.fail(Assert.java:89) ~[junit-4.13.2.jar:4.13.2]
        at org.apache.flink.yarn.YarnTestBase$Runner.run(YarnTestBase.java:1154) [test-classes/:?]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It indicates that we endup in &lt;a href=&quot;https://github.com/apache/flink/blob/6e156bdbddc4cbdc0b79d469a7bfdb2e45071f12/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java#L1153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this if condition in YarnTestBase:1153&lt;/a&gt;. The &lt;a href=&quot;https://github.com/apache/flink/blob/6e156bdbddc4cbdc0b79d469a7bfdb2e45071f12/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YarnTestBase.java#L1132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;FlinkYarnSessionCli.run&lt;/a&gt; call returned &lt;tt&gt;1&lt;/tt&gt;. The &lt;a href=&quot;https://github.com/apache/flink/blob/ad47fe246f7416c5685d1a38b8b8fb44ec503e86/flink-yarn/src/main/java/org/apache/flink/yarn/cli/FlinkYarnSessionCli.java#L560-L685&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;corresponding implementation is of this method&lt;/a&gt; only returns &lt;tt&gt;0&lt;/tt&gt; or fails with Exceptions, though.&lt;/p&gt;
</comment>
                            <comment id="17404253" author="mapohl" created="Wed, 25 Aug 2021 07:35:50 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Is localhost/127.0.0.1:8081 where Flink&apos;s REST endpoint runs?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, the YARN tests are using the default Flink configuration.&lt;/p&gt;</comment>
                            <comment id="17404290" author="till.rohrmann" created="Wed, 25 Aug 2021 09:02:57 +0000"  >&lt;p&gt;Then this could indicate that the Flink application could not be started on the &lt;tt&gt;YarnMiniCluster&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17404598" author="mapohl" created="Wed, 25 Aug 2021 16:51:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=trohrmann&quot; class=&quot;user-hover&quot; rel=&quot;trohrmann&quot;&gt;trohrmann&lt;/a&gt;&apos;s suspicion sounds like the most reasonable one for this issue. It&apos;s hard to investigate due to the missing Hadoop logs. I was able to reproduce the &lt;tt&gt;returnValue&lt;/tt&gt; assertion mentioned above.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;returnValue&lt;/tt&gt; is actually different, because the assertion is called multiple times: Once for the YARN Session Cluster deployment and once for the job submission. It was a bit misleading when debugging the code because both calls used the same code base and the same Thread name. I cleaned up the code a bit and added different Thread names as part of this refactoring. I hesitated to refactor even more. There is no necessity to run the Job submission in a separate thread. We always wait for the Thread to return. And for the cases, where we didn&apos;t, we should. That was the timeout we ran into as part of the test failure: The cluster didn&apos;t come up (at least that&apos;s our assumption for now). Hence, the subsequent job submission failed with a &lt;tt&gt;returnValue&lt;/tt&gt; of &lt;tt&gt;1&lt;/tt&gt; which caused the &lt;tt&gt;AssertionError&lt;/tt&gt; we observed.&lt;/p&gt;</comment>
                            <comment id="17404949" author="mapohl" created="Thu, 26 Aug 2021 05:33:25 +0000"  >&lt;p&gt;We ran into a timeout because of the YARN Session cluster&apos;s&#160;&lt;a href=&quot;https://github.com/XComp/flink/blob/646ff2d36f40704f5dca017b8fffed78bd51b307/flink-yarn-tests/src/test/java/org/apache/flink/yarn/YARNSessionCapacitySchedulerITCase.java#L357&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;join&lt;/a&gt;&#160;call waiting for the thread to finish (see&#160;&lt;tt&gt;jps-traces.0&lt;/tt&gt;):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; #1 prio=5 os_prio=0 tid=0x00007fedec00b800 nid=0x52d6 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007fedf5f8b000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.join(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:1252)
        - locked &amp;lt;0x0000000095e06048&amp;gt; (a org.apache.flink.yarn.YarnTestBase$Runner)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.join(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:1326)
        at org.apache.flink.yarn.YARNSessionCapacitySchedulerITCase.lambda$testVCoresAreSetCorrectlyAndJobManagerHostnameAreShownInWebInterfaceAndDynamicPropertiesAndYarnApplicationNameAndTaskManagerSlots$3(YARNSessionCapacitySchedulerITCase.java:357)
        at org.apache.flink.yarn.YARNSessionCapacitySchedulerITCase$$Lambda$492/592858578.run(Unknown Source)
        at org.apache.flink.yarn.YarnTestBase.runTest(YarnTestBase.java:288)
        at org.apache.flink.yarn.YARNSessionCapacitySchedulerITCase.testVCoresAreSetCorrectlyAndJobManagerHostnameAreShownInWebInterfaceAndDynamicPropertiesAndYarnApplicationNameAndTaskManagerSlots(YARNSessionCapacitySchedulerITCase.java:293)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
[...] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This &lt;tt&gt;join&lt;/tt&gt; command should have gotten back due to &lt;tt&gt;sendStop&lt;/tt&gt; call that was triggered beforehand.&lt;/p&gt;

&lt;p&gt;The job submission thread seem to have terminated. Only one Thread having the name &quot;Frontend (CLI/YARN Client) runner thread (startWithArgs()).&quot; is listed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;Frontend (CLI/YARN Client) runner thread (startWithArgs()).&quot;&lt;/span&gt; #1731 prio=5 os_prio=0 tid=0x00007fedee5b0800 nid=0x682b waiting on condition [0x00007fe9bc670000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (sleeping)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method)
        at org.apache.flink.yarn.cli.FlinkYarnSessionCli.repStep(FlinkYarnSessionCli.java:934)
        at org.apache.flink.yarn.cli.FlinkYarnSessionCli.runInteractiveCli(FlinkYarnSessionCli.java:910)
        at org.apache.flink.yarn.cli.FlinkYarnSessionCli.run(FlinkYarnSessionCli.java:657)
        at org.apache.flink.yarn.YarnTestBase$Runner.run(YarnTestBase.java:1132) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I have to do another round to double-check but I guess the stop call never reached the thread because the previous failure of the job submission Runner resetted the System input/output streams which cut off the communication between the &lt;tt&gt;main&lt;/tt&gt; and the YARN Session Cluster Thread as well.&lt;/p&gt;</comment>
                            <comment id="17405735" author="mapohl" created="Fri, 27 Aug 2021 10:32:51 +0000"  >&lt;p&gt;As a summary, I wasn&apos;t able to verify System input/output stream reset locally. But it shouldn&apos;t have an effect on the test since the Runner instances still hold a reference to the actual `PrintStream` instances being used for the &quot;stop&quot; command.&lt;/p&gt;

&lt;p&gt;We are not able to investigate anything on the Flink side due to the missing Flink logs. Our guess is that the join made the test halt forever. AzureCI killed the JVM at the end. The after-test log collection couldn&apos;t be executed.&lt;/p&gt;

&lt;p&gt;I added timeouts for the job submission and the YARN Session Cluster shutdown trigger. Additionally, I added some additional logs and fixed a minor bug.&lt;/p&gt;</comment>
                            <comment id="17410878" author="xintongsong" created="Tue, 7 Sep 2021 02:07:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23560&amp;amp;view=logs&amp;amp;j=8fd975ef-f478-511d-4997-6f15fe8a1fd3&amp;amp;t=494f6362-8ffa-5ff8-9158-c7f00e541279&amp;amp;l=33076&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=23560&amp;amp;view=logs&amp;amp;j=8fd975ef-f478-511d-4997-6f15fe8a1fd3&amp;amp;t=494f6362-8ffa-5ff8-9158-c7f00e541279&amp;amp;l=33076&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17411262" author="zentol" created="Tue, 7 Sep 2021 14:09:47 +0000"  >&lt;p&gt;Debugging improved in:&lt;br/&gt;
master: 74cdcd720488431958f70d8adfe6f20e36747e05&lt;br/&gt;
1.14: 6472d5b76f134d77ec9724bc6fecf2ebf019d06a&lt;br/&gt;
1.13: 30fca11d13359870e9d5f3308d7c1b41ca2e607f&lt;br/&gt;
1.12: c1844b19c1d4df2619f1dd43fa661cc0209ce8e5&lt;/p&gt;</comment>
                            <comment id="17411793" author="mapohl" created="Wed, 8 Sep 2021 08:42:21 +0000"  >&lt;p&gt;I&apos;m unassigning myself. Let&apos;s see whether we can get some more meaningful information out with the changes to the log configuration. The test should fail earlier now and Flink logs should be archived.&lt;/p&gt;</comment>
                            <comment id="17414150" author="mapohl" created="Mon, 13 Sep 2021 11:31:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgergely&quot; class=&quot;user-hover&quot; rel=&quot;mgergely&quot;&gt;mgergely&lt;/a&gt; Are these kind of rarer test instabilities something you monitor and are able to pick up as well?&lt;/p&gt;</comment>
                            <comment id="17425976" author="xintongsong" created="Fri, 8 Oct 2021 06:07:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=24807&amp;amp;view=logs&amp;amp;j=298e20ef-7951-5965-0e79-ea664ddc435e&amp;amp;t=d4c90338-c843-57b0-3232-10ae74f00347&amp;amp;l=30159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=24807&amp;amp;view=logs&amp;amp;j=298e20ef-7951-5965-0e79-ea664ddc435e&amp;amp;t=d4c90338-c843-57b0-3232-10ae74f00347&amp;amp;l=30159&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17440967" author="till.rohrmann" created="Tue, 9 Nov 2021 08:15:15 +0000"  >&lt;p&gt;Another instance: &lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=26167&amp;amp;view=logs&amp;amp;j=fc5181b0-e452-5c8f-68de-1097947f6483&amp;amp;t=995c650b-6573-581c-9ce6-7ad4cc038461&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=26167&amp;amp;view=logs&amp;amp;j=fc5181b0-e452-5c8f-68de-1097947f6483&amp;amp;t=995c650b-6573-581c-9ce6-7ad4cc038461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17440968" author="till.rohrmann" created="Tue, 9 Nov 2021 08:15:45 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; maybe the new debug logs help analyzing the problem now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13540353">FLINK-32366</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0tl1k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>