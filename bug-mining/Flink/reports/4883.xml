<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:51:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20314] Empty Calc is not removed by CalcRemoveRule</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20314</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;My DDL&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not exists t_order(
id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; PRIMARY KEY comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#35746;&#21333;id&apos;&lt;/span&gt;,
timestamps bigint comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#35746;&#21333;&#21019;&#24314;&#26102;&#38388;&apos;&lt;/span&gt;,
orderInformationId string comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#35746;&#21333;&#20449;&#24687;ID&apos;&lt;/span&gt;,
userId string comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#29992;&#25143;ID&apos;&lt;/span&gt;,
categoryId &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#21830;&#21697;&#31867;&#21035;&apos;&lt;/span&gt;,
productId &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#21830;&#21697;ID&apos;&lt;/span&gt;,
price decimal(10,2) comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#21333;&#20215;&apos;&lt;/span&gt;,
productCount &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#36141;&#20080;&#25968;&#37327;&apos;&lt;/span&gt;,
priceSum decimal(10,2) comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#35746;&#21333;&#24635;&#20215;&apos;&lt;/span&gt;,
shipAddress string comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#21830;&#23478;&#22320;&#22336;&apos;&lt;/span&gt;,
receiverAddress string comment &lt;span class=&quot;code-quote&quot;&gt;&apos;&#25910;&#36135;&#22320;&#22336;&apos;&lt;/span&gt;,
ts AS TO_TIMESTAMP(FROM_UNIXTIME(timestamps/1000)),
WATERMARK FOR ts AS ts - INTERVAL &lt;span class=&quot;code-quote&quot;&gt;&apos;3&apos;&lt;/span&gt; SECOND
)with(
&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;debezium-avro-confluent&apos;&lt;/span&gt;, 
&lt;span class=&quot;code-quote&quot;&gt;&apos;debezium-avro-confluent.schema-registry.url&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//hostname:8081&apos;&lt;/span&gt;,
&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;ods.userAnalysis.order&apos;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&apos;properties.bootstrap.servers&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;hostname:9092&apos;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&apos;properties.group.id&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;flink-analysis&apos;&lt;/span&gt;,
&lt;span class=&quot;code-quote&quot;&gt;&apos;scan.startup.mode&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;latest-offset&apos;&lt;/span&gt;
)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;query is ok&#160; when using the following SQLs&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select * from&#160;t_order&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select&#160;receiverAddress from&#160;t_order&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select
id,
timestamps,
orderInformationId,
userId,
categoryId,
productId,
price,
productCount,
priceSum,
shipAddress
from t_order&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but when I add the &lt;b&gt;receiveraddress&lt;/b&gt; field to the third sql like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select
id,
timestamps,
orderInformationId,
userId,
categoryId,
productId,
price,
productCount,
priceSum,
shipAddress,
receiverAddress
from t_order
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it throws an exception&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.flink.table.api.TableException: This calc has no useful projection and no filter. It should be removed by CalcRemoveRule.Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.flink.table.api.TableException: This calc has no useful projection and no filter. It should be removed by CalcRemoveRule. at org.apache.flink.table.planner.codegen.CalcCodeGenerator$.generateProcessCode(CalcCodeGenerator.scala:166) at org.apache.flink.table.planner.codegen.CalcCodeGenerator$.generateCalcOperator(CalcCodeGenerator.scala:59) at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecCalc.translateToPlanInternal(StreamExecCalc.scala:84) at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecCalc.translateToPlanInternal(StreamExecCalc.scala:39) at org.apache.flink.table.planner.plan.nodes.exec.ExecNode.translateToPlan(ExecNode.scala:59) at org.apache.flink.table.planner.plan.nodes.exec.ExecNode.translateToPlan$(ExecNode.scala:57) at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecCalcBase.translateToPlan(StreamExecCalcBase.scala:38) at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecLegacySink.translateToTransformation(StreamExecLegacySink.scala:158) at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecLegacySink.translateToPlanInternal(StreamExecLegacySink.scala:82) at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecLegacySink.translateToPlanInternal(StreamExecLegacySink.scala:48) at org.apache.flink.table.planner.plan.nodes.exec.ExecNode.translateToPlan(ExecNode.scala:59) at org.apache.flink.table.planner.plan.nodes.exec.ExecNode.translateToPlan$(ExecNode.scala:57) at org.apache.flink.table.planner.plan.nodes.physical.stream.StreamExecLegacySink.translateToPlan(StreamExecLegacySink.scala:48) at org.apache.flink.table.planner.delegation.StreamPlanner.$anonfun$translateToPlan$1(StreamPlanner.scala:66) at scala.collection.TraversableLike.$anonfun$map$1(TraversableLike.scala:233) at scala.collection.Iterator.foreach(Iterator.scala:937) at scala.collection.Iterator.foreach$(Iterator.scala:937) at scala.collection.AbstractIterator.foreach(Iterator.scala:1425) at scala.collection.IterableLike.foreach(IterableLike.scala:70) at scala.collection.IterableLike.foreach$(IterableLike.scala:69) at scala.collection.AbstractIterable.foreach(Iterable.scala:54) at scala.collection.TraversableLike.map(TraversableLike.scala:233) at scala.collection.TraversableLike.map$(TraversableLike.scala:226) at scala.collection.AbstractTraversable.map(Traversable.scala:104) at org.apache.flink.table.planner.delegation.StreamPlanner.translateToPlan(StreamPlanner.scala:65) at org.apache.flink.table.planner.delegation.PlannerBase.translate(PlannerBase.scala:167) at org.apache.flink.table.api.internal.TableEnvironmentImpl.translate(TableEnvironmentImpl.java:1261) at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeInternal(TableEnvironmentImpl.java:702) at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeOperation(TableEnvironmentImpl.java:1065) at org.apache.flink.table.api.internal.TableEnvironmentImpl.executeSql(TableEnvironmentImpl.java:664) at com.bugboy.analysis.AnalysisCase$.main(AnalysisCase.scala:161) at com.bugboy.analysis.AnalysisCase.main(AnalysisCase.scala)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13342277">FLINK-20314</key>
            <summary>Empty Calc is not removed by CalcRemoveRule</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fsk119">Shengkai Fang</assignee>
                                    <reporter username="bugboy">bugboy</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Tue, 24 Nov 2020 05:41:36 +0000</created>
                <updated>Thu, 26 Nov 2020 01:57:26 +0000</updated>
                            <resolved>Thu, 26 Nov 2020 01:57:26 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                    <component>Table SQL / API</component>
                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17237958" author="nicholasjiang" created="Tue, 24 Nov 2020 08:40:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bugboy&quot; class=&quot;user-hover&quot; rel=&quot;bugboy&quot;&gt;bugboy&lt;/a&gt;, please translate your description of issue to English.&lt;/p&gt;</comment>
                            <comment id="17238113" author="hailong wang" created="Tue, 24 Nov 2020 13:16:23 +0000"  >&lt;p&gt;This is for we push watermark acrossing&#160;`FlinkLogicalCalc`, and the computed column is also push down to `TableScan`. Then the calc projection list is the same with tableScan output fields.&lt;/p&gt;

&lt;p&gt;Maybe we can add a rule to remove `FlinkLogicalCalc` after `PushWatermarkIntoTableSourceScanAcrossCalcRule` like `CalcRemoveRule` ?&lt;/p&gt;</comment>
                            <comment id="17238132" author="jark" created="Tue, 24 Nov 2020 13:42:31 +0000"  >&lt;p&gt;Yes. I think so. cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=godfreyhe&quot; class=&quot;user-hover&quot; rel=&quot;godfreyhe&quot;&gt;godfreyhe&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17238474" author="fsk119" created="Wed, 25 Nov 2020 02:56:17 +0000"  >&lt;p&gt;Please assign it to me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; . I will fix it.&lt;/p&gt;</comment>
                            <comment id="17239005" author="godfreyhe" created="Thu, 26 Nov 2020 01:57:26 +0000"  >&lt;p&gt;master: 4cc1da96e88ddc6166181a7f83c891761db283a1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0kvfs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>