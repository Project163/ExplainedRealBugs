<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4731] HeapKeyedStateBackend restoring broken for scale-in</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4731</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Restoring the HeapKeyedStateBackend is broken in case that parallelism is reduced. The restore method is overwriting previously restored state.&lt;/p&gt;

&lt;p&gt;We should also add scale-in testing to the RescalingITCase.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13009477">FLINK-4731</key>
            <summary>HeapKeyedStateBackend restoring broken for scale-in</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srichter">Stefan Richter</assignee>
                                    <reporter username="srichter">Stefan Richter</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Oct 2016 09:04:26 +0000</created>
                <updated>Fri, 7 Oct 2016 12:16:33 +0000</updated>
                            <resolved>Fri, 7 Oct 2016 12:16:33 +0000</resolved>
                                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Runtime / State Backends</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15544833" author="githubbot" created="Tue, 4 Oct 2016 09:08:01 +0000"  >&lt;p&gt;GitHub user StefanRRichter opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4731&quot; title=&quot;HeapKeyedStateBackend restoring broken for scale-in&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4731&quot;&gt;&lt;del&gt;FLINK-4731&lt;/del&gt;&lt;/a&gt; Bugfix for HeapKeyedStateBackend scale-in and additional tests in RescalingITCase&lt;/p&gt;

&lt;p&gt;    Restoring the HeapKeyedStateBackend was broken in case that parallelism is reduced. The restore method was overwriting previously restored state.&lt;/p&gt;

&lt;p&gt;    Added scale-in testing to the RescalingITCase to catch problems like this in the future.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/StefanRRichter/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/StefanRRichter/flink&lt;/a&gt; stream-keyed-state&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2584&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 12a981ee478ec6cd29d768c5e4166aad97e6e06b&lt;br/&gt;
Author: Stefan Richter &amp;lt;s.richter@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2016-10-02T12:15:48Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Make KeyGroupsStateHandle implement StreamStateHandle&lt;/p&gt;

&lt;p&gt;commit 91f76867df790eba9fec793f4e276b7b05aebb6c&lt;br/&gt;
Author: Stefan Richter &amp;lt;s.richter@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2016-10-02T09:30:59Z&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;hotfix&amp;#93;&lt;/span&gt; Minor cleanup in FlinkKafkaConsumerBase and Test&lt;/p&gt;

&lt;p&gt;commit a7614c1b583f220dcc78a8130494552bc085a13f&lt;br/&gt;
Author: Stefan Richter &amp;lt;s.richter@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2016-10-02T12:19:37Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4730&quot; title=&quot;Introduce CheckpointMetaData&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4730&quot;&gt;&lt;del&gt;FLINK-4730&lt;/del&gt;&lt;/a&gt; Introducing CheckpointMetaData&lt;/p&gt;

&lt;p&gt;commit c29804d95e5baa52f6ce47a7a1546ec3797fa9d2&lt;br/&gt;
Author: Stefan Richter &amp;lt;s.richter@data-artisans.com&amp;gt;&lt;br/&gt;
Date:   2016-10-02T14:56:41Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4731&quot; title=&quot;HeapKeyedStateBackend restoring broken for scale-in&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4731&quot;&gt;&lt;del&gt;FLINK-4731&lt;/del&gt;&lt;/a&gt; Bugfix for HeapKeyedStateBackend scale-in and additional tests in RescalingITCase&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15552271" author="githubbot" created="Thu, 6 Oct 2016 15:42:11 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82211023&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82211023&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactory.java &amp;#8212;&lt;br/&gt;
    @@ -297,7 +296,7 @@ public StreamStateHandle closeAndGetHandle() throws IOException {&lt;br/&gt;
     					if (outStream == null &amp;amp;&amp;amp; pos &amp;lt;= localStateThreshold) {&lt;br/&gt;
     						closed = true;&lt;br/&gt;
     						byte[] bytes = Arrays.copyOf(writeBuffer, pos);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return new ByteStreamStateHandle(bytes);&lt;br/&gt;
    +						return new ByteStreamStateHandle(String.valueOf(createStatePath()), bytes);
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Why don&apos;t we do `createStatePath().toString()`? We actually don&apos;t want a non-unique `&quot;null&quot;` String here in case that `createStatePath()` returns `null` (which it shouldn&apos;t anyways).&lt;/p&gt;</comment>
                            <comment id="15552272" author="githubbot" created="Thu, 6 Oct 2016 15:42:11 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82211497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82211497&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/savepoint/SavepointV1Serializer.java &amp;#8212;&lt;br/&gt;
    @@ -290,6 +290,7 @@ public static void serializeStreamStateHandle(StreamStateHandle stateHandle, Dat&lt;br/&gt;
     		} else if (stateHandle instanceof ByteStreamStateHandle) {&lt;br/&gt;
     			dos.writeByte(BYTE_STREAM_STATE_HANDLE);&lt;br/&gt;
     			ByteStreamStateHandle byteStreamStateHandle = (ByteStreamStateHandle) stateHandle;&lt;br/&gt;
    +			dos.writeUTF(byteStreamStateHandle.getHandleName());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think it&apos;s OK that we don&apos;t change the format version (e.g. to v2) when we change the serialization format in a snapshot version right? Since 1.1 the version was already updated, which is fine.&lt;/p&gt;</comment>
                            <comment id="15552273" author="githubbot" created="Thu, 6 Oct 2016 15:42:11 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82216509&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82216509&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/heap/HeapKeyedStateBackend.java &amp;#8212;&lt;br/&gt;
    @@ -259,28 +263,29 @@ public void restorePartitionedState(List&amp;lt;KeyGroupsStateHandle&amp;gt; state) throws Exc&lt;/p&gt;

&lt;p&gt;     			try {&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fsDataInputStream = keyGroupsHandle.getStateHandle().openInputStream();&lt;br/&gt;
    +				fsDataInputStream = keyGroupsHandle.openInputStream();&lt;br/&gt;
     				cancelStreamRegistry.registerClosable(fsDataInputStream);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     				DataInputViewStreamWrapper inView = new DataInputViewStreamWrapper(fsDataInputStream);&lt;/p&gt;

&lt;p&gt;     				int numKvStates = inView.readShort();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Map&amp;lt;Integer, String&amp;gt; kvStatesById = new HashMap&amp;lt;&amp;gt;(numKvStates);&lt;br/&gt;
    -&lt;br/&gt;
     				for (int i = 0; i &amp;lt; numKvStates; ++i) {&lt;br/&gt;
     					String stateName = inView.readUTF();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TypeSerializer namespaceSerializer =&lt;br/&gt;
    +					TypeSerializer&amp;lt;?&amp;gt; namespaceSerializer =&lt;br/&gt;
     							InstantiationUtil.deserializeObject(fsDataInputStream, userCodeClassLoader);&lt;/li&gt;
	&lt;li&gt;TypeSerializer stateSerializer =&lt;br/&gt;
    +					TypeSerializer&amp;lt;?&amp;gt; stateSerializer =&lt;br/&gt;
     							InstantiationUtil.deserializeObject(fsDataInputStream, userCodeClassLoader);&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;StateTable&amp;lt;K, ?, ?&amp;gt; stateTable = new StateTable(stateSerializer,&lt;/li&gt;
	&lt;li&gt;namespaceSerializer,&lt;/li&gt;
	&lt;li&gt;keyGroupRange);&lt;/li&gt;
	&lt;li&gt;stateTables.put(stateName, stateTable);&lt;/li&gt;
	&lt;li&gt;kvStatesById.put(i, stateName);&lt;br/&gt;
    +					StateTable&amp;lt;K, ?, ?&amp;gt; stateTable = stateTables.get(stateName);&lt;br/&gt;
    +&lt;br/&gt;
    +					if (null == stateTable) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Let&apos;s add a comment here that it is important to check for previously restored state first.&lt;/p&gt;</comment>
                            <comment id="15552274" author="githubbot" created="Thu, 6 Oct 2016 15:42:11 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82211635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82211635&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactory.java &amp;#8212;&lt;br/&gt;
    @@ -219,7 +218,7 @@ public void write(byte[] b, int off, int len) throws IOException {&lt;/p&gt;

&lt;p&gt;     		@Override&lt;br/&gt;
     		public long getPos() throws IOException {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return outStream == null ? pos : outStream.getPos();&lt;br/&gt;
    +			return pos + (outStream == null ? 0 : outStream.getPos());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This was buggy before then? Is there a test for this?&lt;/p&gt;</comment>
                            <comment id="15552275" author="githubbot" created="Thu, 6 Oct 2016 15:42:11 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82217757&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82217757&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/memory/ByteStreamStateHandle.java &amp;#8212;&lt;br/&gt;
    @@ -20,62 +20,49 @@&lt;/p&gt;

&lt;p&gt;     import org.apache.flink.core.fs.FSDataInputStream;&lt;br/&gt;
     import org.apache.flink.runtime.state.StreamStateHandle;&lt;br/&gt;
    -import org.apache.flink.util.InstantiationUtil;&lt;br/&gt;
     import org.apache.flink.util.Preconditions;&lt;/p&gt;

&lt;p&gt;     import java.io.IOException;&lt;br/&gt;
    -import java.io.Serializable;&lt;br/&gt;
    -import java.util.Arrays;&lt;/p&gt;

&lt;p&gt;     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A state handle that contains stream state in a byte array.&lt;br/&gt;
      */&lt;br/&gt;
     public class ByteStreamStateHandle implements StreamStateHandle {&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final long serialVersionUID = -5280226231200217594L;&lt;br/&gt;
    +	private static final long serialVersionUID = -5280226231202517594L;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* the state data&lt;br/&gt;
    +	 * The state data.&lt;br/&gt;
     	 */&lt;br/&gt;
     	protected final byte[] data;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	/**&lt;br/&gt;
    +	 * A unique name of by which this state handle is identified and compared. Like a filename, all&lt;br/&gt;
    +	 * &lt;/p&gt;
{@link ByteStreamStateHandle}
&lt;p&gt; with the exact same name must also have the exact same content in data.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	protected final String handleName;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Is this meant to be an optimization for `equals/hashCode`? If yes, has it been an issue before? &lt;/p&gt;</comment>
                            <comment id="15552276" author="githubbot" created="Thu, 6 Oct 2016 15:42:11 +0000"  >&lt;p&gt;Github user uce commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82213262&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82213262&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-tests/src/test/java/org/apache/flink/test/checkpointing/RescalingITCase.java &amp;#8212;&lt;br/&gt;
    @@ -663,28 +826,42 @@ public Integer snapshotState(long checkpointId, long checkpointTimestamp) throws&lt;br/&gt;
     		public void restoreState(Integer state) throws Exception &lt;/p&gt;
{
     			counter = state;
     		}
&lt;p&gt;    +	}&lt;br/&gt;
    +&lt;br/&gt;
    +	private static class PartitionedStateSource extends StateSourceBase implements ListCheckpointed&amp;lt;Integer&amp;gt; {&lt;br/&gt;
    +&lt;br/&gt;
    +		private static final long serialVersionUID = -359715965103593462L;&lt;br/&gt;
    +		private static final int NUM_PARTITIONS = 7;&lt;br/&gt;
    +&lt;br/&gt;
    +		private static int[] CHECK_CORRECT_SNAPSHOT;&lt;br/&gt;
    +		private static int[] CHECK_CORRECT_RESTORE;&lt;/p&gt;

&lt;p&gt;     		@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void run(SourceContext&amp;lt;Integer&amp;gt; ctx) throws Exception {&lt;/li&gt;
	&lt;li&gt;final Object lock = ctx.getCheckpointLock();&lt;br/&gt;
    +		public List&amp;lt;Integer&amp;gt; snapshotState(long checkpointId, long timestamp) throws Exception {&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;while (running) {&lt;/li&gt;
	&lt;li&gt;synchronized (lock) 
{
    -					counter++;
    +			CHECK_CORRECT_SNAPSHOT[getRuntimeContext().getIndexOfThisSubtask()] = counter;
     
    -					ctx.collect(counter * getRuntimeContext().getIndexOfThisSubtask());
    -				}
&lt;p&gt;    +			int div = counter / NUM_PARTITIONS;&lt;br/&gt;
    +			int mod = counter % NUM_PARTITIONS;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Thread.sleep(2);&lt;/li&gt;
	&lt;li&gt;if(counter == 10) {&lt;/li&gt;
	&lt;li&gt;workStartedLatch.countDown();&lt;br/&gt;
    +			List&amp;lt;Integer&amp;gt; split = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
    +			for (int i = 0; i &amp;lt; NUM_PARTITIONS; ++i) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {    +				int partitionValue = div;    +				if (mod &amp;gt; 0) {
    +					--mod;
    +					++partitionValue;
     				}    +				split.add(partitionValue);     			}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;    +			return split;&lt;br/&gt;
     		}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     		@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public void cancel() {&lt;/li&gt;
	&lt;li&gt;running = false;&lt;br/&gt;
    +		public void restoreState(List&amp;lt;Integer&amp;gt; state) throws Exception {&lt;br/&gt;
    +			for(Integer v : state) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    Missing whitespace after `for`&lt;/p&gt;</comment>
                            <comment id="15552302" author="githubbot" created="Thu, 6 Oct 2016 15:52:00 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82221108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82221108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/filesystem/FsCheckpointStreamFactory.java &amp;#8212;&lt;br/&gt;
    @@ -219,7 +218,7 @@ public void write(byte[] b, int off, int len) throws IOException {&lt;/p&gt;

&lt;p&gt;     		@Override&lt;br/&gt;
     		public long getPos() throws IOException {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return outStream == null ? pos : outStream.getPos();&lt;br/&gt;
    +			return pos + (outStream == null ? 0 : outStream.getPos());
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    It was buggy before and I think there are in general no tests for this inner class.&lt;/p&gt;</comment>
                            <comment id="15552313" author="githubbot" created="Thu, 6 Oct 2016 15:54:04 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82221594&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82221594&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/checkpoint/savepoint/SavepointV1Serializer.java &amp;#8212;&lt;br/&gt;
    @@ -290,6 +290,7 @@ public static void serializeStreamStateHandle(StreamStateHandle stateHandle, Dat&lt;br/&gt;
     		} else if (stateHandle instanceof ByteStreamStateHandle) {&lt;br/&gt;
     			dos.writeByte(BYTE_STREAM_STATE_HANDLE);&lt;br/&gt;
     			ByteStreamStateHandle byteStreamStateHandle = (ByteStreamStateHandle) stateHandle;&lt;br/&gt;
    +			dos.writeUTF(byteStreamStateHandle.getHandleName());&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    I think so, too. It will be changed again soon.&lt;/p&gt;</comment>
                            <comment id="15552325" author="githubbot" created="Thu, 6 Oct 2016 15:58:40 +0000"  >&lt;p&gt;Github user StefanRRichter commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584#discussion_r82222653&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584#discussion_r82222653&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: flink-runtime/src/main/java/org/apache/flink/runtime/state/memory/ByteStreamStateHandle.java &amp;#8212;&lt;br/&gt;
    @@ -20,62 +20,49 @@&lt;/p&gt;

&lt;p&gt;     import org.apache.flink.core.fs.FSDataInputStream;&lt;br/&gt;
     import org.apache.flink.runtime.state.StreamStateHandle;&lt;br/&gt;
    -import org.apache.flink.util.InstantiationUtil;&lt;br/&gt;
     import org.apache.flink.util.Preconditions;&lt;/p&gt;

&lt;p&gt;     import java.io.IOException;&lt;br/&gt;
    -import java.io.Serializable;&lt;br/&gt;
    -import java.util.Arrays;&lt;/p&gt;

&lt;p&gt;     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A state handle that contains stream state in a byte array.&lt;br/&gt;
      */&lt;br/&gt;
     public class ByteStreamStateHandle implements StreamStateHandle {&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private static final long serialVersionUID = -5280226231200217594L;&lt;br/&gt;
    +	private static final long serialVersionUID = -5280226231202517594L;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	/**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* the state data&lt;br/&gt;
    +	 * The state data.&lt;br/&gt;
     	 */&lt;br/&gt;
     	protected final byte[] data;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     	/**&lt;br/&gt;
    +	 * A unique name of by which this state handle is identified and compared. Like a filename, all&lt;br/&gt;
    +	 * &lt;/p&gt;
{@link ByteStreamStateHandle}
&lt;p&gt; with the exact same name must also have the exact same content in data.&lt;br/&gt;
    +	 */&lt;br/&gt;
    +	protected final String handleName;&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    The problem before was, that two ByteStreamStateHandle were considered equal + same hash code if their byte[] had the same content. However, like with files, it should be possible two have two handles with the same content that are not considered as equal (e.g. some tests created the same content for different handles and deduplicated some handles away because of this). From this point of view, the string mimics a &quot;file name&quot;.&lt;/p&gt;</comment>
                            <comment id="15552347" author="githubbot" created="Thu, 6 Oct 2016 16:07:10 +0000"  >&lt;p&gt;Github user StefanRRichter commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks a lot for the review Ufuk! I addressed your comments (see my responses also).&lt;/p&gt;</comment>
                            <comment id="15554520" author="githubbot" created="Fri, 7 Oct 2016 08:29:18 +0000"  >&lt;p&gt;Github user uce commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks! Looks good to merge. Just had one follow up comment before doing so.&lt;/p&gt;</comment>
                            <comment id="15554937" author="githubbot" created="Fri, 7 Oct 2016 12:16:30 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2584&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2584&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15554938" author="uce" created="Fri, 7 Oct 2016 12:16:33 +0000"  >&lt;p&gt;Fixed in 8d953bf (master).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34el3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>