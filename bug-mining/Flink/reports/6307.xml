<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:09:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-26555] Missing close in FileSystemJobResultStore</title>
                <link>https://issues.apache.org/jira/browse/FLINK-26555</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;FileSystemJobResultStore.createDirtyResultInternal&lt;/tt&gt; does not close the opened &lt;tt&gt;OutputStream&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13432901">FLINK-26555</key>
            <summary>Missing close in FileSystemJobResultStore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mapohl">Matthias Pohl</assignee>
                                    <reporter username="mapohl">Matthias Pohl</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 9 Mar 2022 16:08:11 +0000</created>
                <updated>Thu, 31 Mar 2022 12:14:04 +0000</updated>
                            <resolved>Thu, 10 Mar 2022 08:35:29 +0000</resolved>
                                    <version>1.15.0</version>
                                    <fixVersion>1.15.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17504089" author="mapohl" created="Thu, 10 Mar 2022 08:35:29 +0000"  >&lt;p&gt;master: 281b8e744dd2f8677d41d9e97c9b8ceeeddff450&lt;/p&gt;</comment>
                            <comment id="17515188" author="tanyuxin" created="Thu, 31 Mar 2022 09:16:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; , hello, about the issue, we encountered an exception as follows. Could you please help take a look?&lt;/p&gt;

&lt;p&gt;When a job is finished in a session cluster, the job result may flush failed.&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13041828/13041828_image-2022-03-31-16-43-56-322.png&quot; height=&quot;423&quot; width=&quot;819&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mapper.writeValue(os, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JsonJobResultEntry(jobResultEntry)); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;About this line in the patch, I checked the source code and found it called the method&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._writeValueAndClose(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.createGenerator(out, JsonEncoding.UTF8), value); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;and an &lt;em&gt;UTF8JsonGenerator&lt;/em&gt; is inited and used.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; void _writeValueAndClose(JsonGenerator g, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    SerializationConfig cfg = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getSerializationConfig();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cfg.isEnabled(SerializationFeature.CLOSE_CLOSEABLE) &amp;amp;&amp;amp; value &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Closeable) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._writeCloseable(g, value, cfg);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._serializerProvider(cfg).serializeValue(g, value);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception var5) {
            ClassUtil.closeOnFailAndThrowAsIOE(g, var5);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }

        g.close();
    }
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &lt;em&gt;UTF8JsonGenerator#close&lt;/em&gt; will be called finally and I found the OutputStream may be closed in the method when some features of Json generator is enabled.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    ...
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._outputStream != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._ioContext.isResourceManaged() &amp;amp;&amp;amp; !&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isEnabled(Feature.AUTO_CLOSE_TARGET)) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isEnabled(Feature.FLUSH_PASSED_TO_STREAM)) {
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._outputStream.flush();
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;._outputStream.close();
        }
    }
    ...
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If the output stream is closed after&#160;&lt;em&gt;writeValue&lt;/em&gt;, the above &lt;em&gt;ClosedChannelException&lt;/em&gt;&#160;may be thrown when calling the &lt;em&gt;flush&lt;/em&gt; method added.&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
os.flush(); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I found this patch has changed &#160;the initialization of the output stream to the try-with-resource mode. Generally, the data will be flushed before the file system is closed. Could we delete this line of code&#160; &lt;em&gt;os.flush();&lt;/em&gt; to avoid the exception?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; , WDYT about the exception and could you help take a look when having free time? If I missed something, please correct it at any time. Thanks very much.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17515221" author="mapohl" created="Thu, 31 Mar 2022 10:14:48 +0000"  >&lt;p&gt;Thanks for sharing, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tanyuxin&quot; class=&quot;user-hover&quot; rel=&quot;tanyuxin&quot;&gt;tanyuxin&lt;/a&gt;. How come the flag &lt;tt&gt;CLOSE_CLOSEABLE&lt;/tt&gt; is enabled? It&apos;s not enabled within the Flink code. We haven&apos;t experienced something like that during our tests.&lt;/p&gt;</comment>
                            <comment id="17515226" author="mapohl" created="Thu, 31 Mar 2022 10:26:02 +0000"  >&lt;p&gt;Ok, that seems to be the default behavior: &lt;a href=&quot;https://fasterxml.github.io/jackson-databind/javadoc/2.7/com/fasterxml/jackson/databind/ObjectMapper.html#writeValue(java.io.OutputStream,%20java.lang.Object&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://fasterxml.github.io/jackson-databind/javadoc/2.7/com/fasterxml/jackson/databind/ObjectMapper.html#writeValue(java.io.OutputStream,%20java.lang.Object&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="17515227" author="mapohl" created="Thu, 31 Mar 2022 10:30:47 +0000"  >&lt;p&gt;I created &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-26957&quot; title=&quot;FileSystemJobResultStore calls flush on an already closed OutputStream &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-26957&quot;&gt;&lt;del&gt;FLINK-26957&lt;/del&gt;&lt;/a&gt; as a follow-up to cover this issue.&lt;/p&gt;</comment>
                            <comment id="17515289" author="tanyuxin" created="Thu, 31 Mar 2022 12:14:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mapohl&quot; class=&quot;user-hover&quot; rel=&quot;mapohl&quot;&gt;mapohl&lt;/a&gt; Thanks for your quick reply. We are looking forward to the follow-up issue being resolved.&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13436863">FLINK-26957</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13419213">FLINK-25431</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13041828" name="image-2022-03-31-16-43-56-322.png" size="1814568" author="tanyuxin" created="Thu, 31 Mar 2022 08:43:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z10bx4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>