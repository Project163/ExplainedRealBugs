<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:45:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-17313] Validation error when insert decimal/varchar with precision into sink using TypeInformation of row</title>
                <link>https://issues.apache.org/jira/browse/FLINK-17313</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Test code like follwing(in blink planner):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
		tEnv.sqlUpdate(&lt;span class=&quot;code-quote&quot;&gt;&quot;create table randomSource (&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;		a varchar(10),&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;		b decimal(20,2)&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;	) with (&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;		&lt;span class=&quot;code-quote&quot;&gt;&apos;type&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;random&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;		&lt;span class=&quot;code-quote&quot;&gt;&apos;count&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;10&apos;&lt;/span&gt;&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;	)&quot;&lt;/span&gt;);
		tEnv.sqlUpdate(&lt;span class=&quot;code-quote&quot;&gt;&quot;create table printSink (&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;		a varchar(10),&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;		b decimal(22,2),&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;	) with (&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;	&lt;span class=&quot;code-quote&quot;&gt;&apos;type&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;print&apos;&lt;/span&gt;&quot;&lt;/span&gt; +
						&lt;span class=&quot;code-quote&quot;&gt;&quot;	)&quot;&lt;/span&gt;);
		tEnv.sqlUpdate(&lt;span class=&quot;code-quote&quot;&gt;&quot;insert into printSink select * from randomSource&quot;&lt;/span&gt;);
		tEnv.execute(&quot;&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Print TableSink implements UpsertStreamTableSink and it&apos;s getReocrdType is as following:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TypeInformation&amp;lt;Row&amp;gt; getRecordType() {
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getTableSchema().toRowType();
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Varchar column validation exception is:&lt;/p&gt;

&lt;p&gt;org.apache.flink.table.api.ValidationException: Type VARCHAR(10) of table field &apos;a&apos; does not match with the physical type STRING of the &apos;a&apos; field of the TableSink consumed type.&lt;/p&gt;

&lt;p&gt;	at org.apache.flink.table.utils.TypeMappingUtils.lambda$checkPhysicalLogicalTypeCompatible$4(TypeMappingUtils.java:165)&lt;br/&gt;
	at org.apache.flink.table.utils.TypeMappingUtils$1.defaultMethod(TypeMappingUtils.java:278)&lt;br/&gt;
	at org.apache.flink.table.utils.TypeMappingUtils$1.defaultMethod(TypeMappingUtils.java:255)&lt;br/&gt;
	at org.apache.flink.table.types.logical.utils.LogicalTypeDefaultVisitor.visit(LogicalTypeDefaultVisitor.java:67)&lt;br/&gt;
	at org.apache.flink.table.types.logical.VarCharType.accept(VarCharType.java:157)&lt;br/&gt;
	at org.apache.flink.table.utils.TypeMappingUtils.checkIfCompatible(TypeMappingUtils.java:255)&lt;br/&gt;
	at org.apache.flink.table.utils.TypeMappingUtils.checkPhysicalLogicalTypeCompatible(TypeMappingUtils.java:161)&lt;br/&gt;
	at org.apache.flink.table.planner.sinks.TableSinkUtils$$anonfun$validateLogicalPhysicalTypesCompatible$1.apply$mcVI$sp(TableSinkUtils.scala:315)&lt;br/&gt;
	at scala.collection.immutable.Range.foreach$mVc$sp(Range.scala:160)&lt;br/&gt;
	at org.apache.flink.table.planner.sinks.TableSinkUtils$.validateLogicalPhysicalTypesCompatible(TableSinkUtils.scala:308)&lt;br/&gt;
	at org.apache.flink.table.planner.delegation.PlannerBase$$anonfun$2.apply(PlannerBase.scala:195)&lt;br/&gt;
	at org.apache.flink.table.planner.delegation.PlannerBase$$anonfun$2.apply(PlannerBase.scala:191)&lt;br/&gt;
	at scala.Option.map(Option.scala:146)&lt;br/&gt;
	at org.apache.flink.table.planner.delegation.PlannerBase.translateToRel(PlannerBase.scala:191)&lt;br/&gt;
	at org.apache.flink.table.planner.delegation.PlannerBase$$anonfun$1.apply(PlannerBase.scala:150)&lt;br/&gt;
	at org.apache.flink.table.planner.delegation.PlannerBase$$anonfun$1.apply(PlannerBase.scala:150)&lt;br/&gt;
	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)&lt;br/&gt;
	at scala.collection.TraversableLike$$anonfun$map$1.apply(TraversableLike.scala:234)&lt;br/&gt;
	at scala.collection.Iterator$class.foreach(Iterator.scala:891)&lt;br/&gt;
	at scala.collection.AbstractIterator.foreach(Iterator.scala:1334)&lt;br/&gt;
	at scala.collection.IterableLike$class.foreach(IterableLike.scala:72)&lt;br/&gt;
	at scala.collection.AbstractIterable.foreach(Iterable.scala:54)&lt;br/&gt;
	at scala.collection.TraversableLike$class.map(TraversableLike.scala:234)&lt;br/&gt;
	at scala.collection.AbstractTraversable.map(Traversable.scala:104)&lt;br/&gt;
	at org.apache.flink.table.planner.delegation.PlannerBase.translate(PlannerBase.scala:150)&lt;br/&gt;
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.translate(TableEnvironmentImpl.java:863)&lt;br/&gt;
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.translateAndClearBuffer(TableEnvironmentImpl.java:855)&lt;br/&gt;
	at org.apache.flink.table.api.internal.TableEnvironmentImpl.execute(TableEnvironmentImpl.java:822)&lt;/p&gt;

&lt;p&gt;Other type validation exception is similar, I dig into and think it&apos;s caused by TypeMappingUtils#checkPhysicalLogicalTypeCompatible. It seems that the method doesn&apos;t consider the different physical and logical type validation logic of source and sink:   logical type should be able to cover the physical type in source, but physical type should be able to cover the logic type in sink vice verse. Besides, the decimal type should be taken more carefully, when target type is Legacy(Decimal), it should be able to accept any precision decimal type.&lt;/p&gt;



</description>
                <environment></environment>
        <key id="13300139">FLINK-17313</key>
            <summary>Validation error when insert decimal/varchar with precision into sink using TypeInformation of row</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="Terry1897">Terry Wang</assignee>
                                    <reporter username="Terry1897">Terry Wang</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 22 Apr 2020 03:10:59 +0000</created>
                <updated>Tue, 5 May 2020 18:06:36 +0000</updated>
                            <resolved>Mon, 27 Apr 2020 09:26:36 +0000</resolved>
                                                    <fixVersion>1.10.1</fixVersion>
                    <fixVersion>1.11.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17089251" author="terry1897" created="Wed, 22 Apr 2020 03:17:12 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ykt836&quot; class=&quot;user-hover&quot; rel=&quot;ykt836&quot;&gt;ykt836&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;Please have a look on this issue.&lt;/p&gt;</comment>
                            <comment id="17089258" author="terry1897" created="Wed, 22 Apr 2020 03:38:23 +0000"  >&lt;p&gt;I open a &lt;a href=&quot;https://github.com/apache/flink/pull/11848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/11848&lt;/a&gt; to help understanding and solve this validation exception.&lt;/p&gt;</comment>
                            <comment id="17089300" author="jark" created="Wed, 22 Apr 2020 05:34:22 +0000"  >&lt;p&gt;I think the root cause is that you are using the legacy type information which can&apos;t connect to planner smoothly. &lt;br/&gt;
Because of the complexity, we don&apos;t plan to support new type system for UpsertStreamTableSink. But will fully support new system for FLIP-95 new sink interface. I think your problem will be solved once FLIP-95 is finished. &lt;/p&gt;</comment>
                            <comment id="17089326" author="terry1897" created="Wed, 22 Apr 2020 06:18:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;  I agree with you that new sink interface of FLIP-95 can work normally, but there still a lot of connector that use the old interface. It&apos;s harmless to support such compatibility and useful for users who can not migrate their connector in time, right?&lt;/p&gt;</comment>
                            <comment id="17089331" author="dawidwys" created="Wed, 22 Apr 2020 06:28:16 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Terry1897&quot; class=&quot;user-hover&quot; rel=&quot;Terry1897&quot;&gt;Terry1897&lt;/a&gt; First of all I do agree type system rework is not finished yet and has more rough edges than we would like. This is one of such cases.&lt;/p&gt;

&lt;p&gt;I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; here. UpsertStreamTableSink does not support the new type system. Therefore it can support only the types that originate from the old type system. Therefore e.g. &lt;tt&gt;VARCHAR(10)&lt;/tt&gt; or &lt;tt&gt;DECIMAL&lt;/tt&gt; with precision are not supported in this case. As Jark has already said it should be fixed with FLIP-95.&lt;/p&gt;</comment>
                            <comment id="17089338" author="lzljs3620320" created="Wed, 22 Apr 2020 06:35:38 +0000"  >&lt;p&gt;A work-around way is here:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-15469&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-15469&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If this is not so hacky, maybe we can consider it.&lt;/p&gt;

&lt;p&gt;CC: &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=docete&quot; class=&quot;user-hover&quot; rel=&quot;docete&quot;&gt;docete&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17089350" author="wenlong.lwl" created="Wed, 22 Apr 2020 06:49:49 +0000"  >&lt;p&gt;hi, all, the ticket is trying to fix the bug of the validation of PhysicalDataType and LogicalDataType of TableSink only, I think it is much more clear and clean, worth to consider to fix. Currently the validation on sink reuses the validation on source while they should be different actually.&lt;/p&gt;</comment>
                            <comment id="17089357" author="terry1897" created="Wed, 22 Apr 2020 07:02:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lzljs3620320&quot; class=&quot;user-hover&quot; rel=&quot;lzljs3620320&quot;&gt;lzljs3620320&lt;/a&gt; There isn&apos;t much need to introduce a new interface in TableSink to solve this ticket. Just as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wenlong.lwl&quot; class=&quot;user-hover&quot; rel=&quot;wenlong.lwl&quot;&gt;wenlong.lwl&lt;/a&gt; said, it&apos;s a validation bug causing connectors using old TableSink can not work normmaly.&lt;/p&gt;</comment>
                            <comment id="17089361" author="dawidwys" created="Wed, 22 Apr 2020 07:07:39 +0000"  >&lt;p&gt;The validation does not distinguish validation of source and sink. It validates that a logical type can be mapped to a physical type. The proposed fix (&lt;a href=&quot;https://github.com/apache/flink/pull/11848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/11848&lt;/a&gt;) breaks that. It treats a logical as physical type for sinks. &lt;/p&gt;

&lt;p&gt;The purpose of this class is to check that a schema from DDL (the logical schema) matches the physical schema of the source(the purpose of that schema is primarily to provide bridging classes). Those schemas must match exactly. That said I don&apos;t think this is a valid solution.&lt;/p&gt;</comment>
                            <comment id="17089362" author="terry1897" created="Wed, 22 Apr 2020 07:08:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; The types that originate form the old type system of varcahr(10)/decimal(22, 2)/timestamp(3) is String/legacy(Decimal)/timestamp(3) and should be able to accept corresponding logical type in ddl, which is also the &lt;a href=&quot;https://github.com/apache/flink/pull/11848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt; aims to solve.&lt;/p&gt;</comment>
                            <comment id="17089366" author="dawidwys" created="Wed, 22 Apr 2020 07:13:07 +0000"  >&lt;p&gt;That is incorrect. Old type system does not support &lt;tt&gt;varchar(10)/decimal(22, 2)&lt;/tt&gt;. It should&apos;ve failed earlier.&lt;/p&gt;

&lt;p&gt;In the old type system we support only DECIMAL(38,18) and STRING(=VARCHAR(Long.MAX))&lt;/p&gt;</comment>
                            <comment id="17089370" author="terry1897" created="Wed, 22 Apr 2020 07:17:47 +0000"  >&lt;p&gt;I think you may misunderstand my fix. Source and sink should be in two different validation logic. If the logical type defined in ddl can be consumed by physical type of table sink returned, why we must match those two schema exactly, and the check logic is a relaxed check :  &lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/types/logical/utils/LogicalTypeCasts.java#L232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-table/flink-table-common/src/main/java/org/apache/flink/table/types/logical/utils/LogicalTypeCasts.java#L232&lt;/a&gt;. I don&apos;t know if I express clearly, let me know if u have more questions . &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17089371" author="terry1897" created="Wed, 22 Apr 2020 07:20:50 +0000"  >&lt;p&gt;We can not forbid using old-style TableSink in sql, and the old-style TableSink can consume DECIMAL(38,18) and STRING(=VARCHAR(Long.MAX)) type. So it make sense to pass the check while logical type is varchar(10)/decimal(22,2)&lt;/p&gt;</comment>
                            <comment id="17089382" author="wenlong.lwl" created="Wed, 22 Apr 2020 07:26:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; I think it is not necessary that the schema of logical schema and physical schema should be matched exactly:&lt;/p&gt;

&lt;p&gt;Currently, we allow a column in source : logical type varchar(10), while pyshical type is varchar(5), see `CastAvoidanceChecker` used in the compatible check. &lt;br/&gt;
The requirement on source is that: we need to be able convert a physical record of source to internal record according to physicalDataType and LogicalDataType. &lt;/p&gt;

&lt;p&gt;On sinks, the requirements should be reversed: we need to be able convert an internal record to a physical record for sink: so  we can allow a column of sink whose Logical type is varchar(5) but physical type is varchar(10).&lt;/p&gt;

&lt;p&gt;On validation: we has an validation to make sure that the schema of source query of a sink match the logical type, the validation between logical type and physical can be much more loose I think.&lt;/p&gt;</comment>
                            <comment id="17089411" author="dawidwys" created="Wed, 22 Apr 2020 07:45:28 +0000"  >&lt;p&gt;I must admit I have not fully understood the change in the beginning. I was not aware of introduction of the &lt;tt&gt;supportsAvoidingCast&lt;/tt&gt; in that method before. Having understood that now I think it&apos;s fine to add the bidirectional check.&lt;/p&gt;

&lt;p&gt;I am still skeptical about allowing any precision for &lt;tt&gt;DECIMAL&lt;/tt&gt; type for legacy decimal type. Such conversions might require a cast.  Unless we discard our previous assumptions that &lt;tt&gt;LEGACY DECIMAL = DECIMAL(38,18)&lt;/tt&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17089472" author="wenlong.lwl" created="Wed, 22 Apr 2020 08:54:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; Regarding LEGACY DECIMAL, I think it is a special case good to support: the physical presentation  of LAGECY DECIMAL is BigDecimal, can support any precision and scale, so allow such conversion will not break anything actually and the final precision and scale of the output BigDecimal still limited by logical data type so no data with error precision will be generated. &lt;/p&gt;

&lt;p&gt;What&apos;s more, with such support we can easily fill up the support of decimal in all kinds of sink with old interface. &lt;/p&gt;</comment>
                            <comment id="17089484" author="jark" created="Wed, 22 Apr 2020 09:05:50 +0000"  >&lt;p&gt;I still think the root cause is &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-15469&quot; title=&quot;Update UpsertStreamTableSink and RetractStreamTableSink and related interface to new type system&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-15469&quot;&gt;&lt;del&gt;FLINK-15469&lt;/del&gt;&lt;/a&gt;. And the proposed way in the PR is just a workaround. &lt;/p&gt;

&lt;p&gt;The purpose of &lt;tt&gt;TypeMappingUtils.checkPhysicalLogicalTypeCompatible&lt;/tt&gt; should check the logical and physical types are compatible, i.e. types are equal but ignore field names. It is used to guarantee the sink connector complies with the DDL. If the connector wants to support precision, then it has to use new type system, not the legacy TypeInformation which loses the precision. &lt;/p&gt;

&lt;p&gt;Any precision mismatch in the logical and physical types should fail (except legacy decimal), so I think &lt;tt&gt;supportsAvoidingCast&lt;/tt&gt; here is a mistake and should use something more strict. The &lt;tt&gt;supportsAvoidingCast&lt;/tt&gt; should be used in checks for query schema to sink schema. &lt;/p&gt;</comment>
                            <comment id="17089489" author="dawidwys" created="Wed, 22 Apr 2020 09:17:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt; What you are describing was the original purpose of this class. Introduction of the &lt;tt&gt;supportsAvoidingCast&lt;/tt&gt; changed it a bit. Since the change it lets some of mismatches pass through. E.g. DDL can define VARCHAR(2) and Source can produce VARCHAR(1). Moreover if we say that the use of &lt;tt&gt;supportsAvoidingCast&lt;/tt&gt; is valid here than the bug described by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Terry1897&quot; class=&quot;user-hover&quot; rel=&quot;Terry1897&quot;&gt;Terry1897&lt;/a&gt; stands. For sink we should call the &lt;tt&gt;supportsAvoidingCast&lt;/tt&gt; with reversed arguments.&lt;/p&gt;

&lt;p&gt;I am not sure how we should proceed further with it.&lt;/p&gt;</comment>
                            <comment id="17089491" author="jark" created="Wed, 22 Apr 2020 09:19:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt;, Yes, my point is that the change from &lt;tt&gt;areTypeCompatible&lt;/tt&gt; to &lt;tt&gt;supportsAvoidingCast&lt;/tt&gt; changes the behavior of this class, and I think that&apos;s wrong.&lt;/p&gt;</comment>
                            <comment id="17089530" author="terry1897" created="Wed, 22 Apr 2020 10:21:46 +0000"  >&lt;p&gt;supportsAvoidingCast method behavior looks right to me, relaxed check will improve user experience of old-style connector and don&apos;t affect the correctness.&lt;/p&gt;</comment>
                            <comment id="17089565" author="twalthr" created="Wed, 22 Apr 2020 11:15:50 +0000"  >&lt;p&gt;I&apos;m also fine with the proposed PR. The bug around &lt;tt&gt;supportsAvoidingCast&lt;/tt&gt; should definitely be fixed. And if it helps for legacy connectors, we can also be more lenient around decimal. However, we should not start relaxing new behavior in FLIP-95. Changing the precision and scale of a decimal type will result in completely different data. No user wants that and it is also very hard to debug. Luckily with FLIP-95, the sink must completely implement the schema of the catalog table. There is no possibility of having a mismatch because there is no `getProducedDataType()`.&lt;/p&gt;</comment>
                            <comment id="17089590" author="dawidwys" created="Wed, 22 Apr 2020 11:40:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; raised a good point that this method will not be used for the new sources. &lt;/p&gt;

&lt;p&gt;In principle this should not be necessary, if we had a more consistent handling of supported types in DDL and sources/sinks. Nevertheless I think we can relax it here for now to make the old &amp;lt;&amp;gt; new type system integration a bit smoother. &lt;/p&gt;

&lt;p&gt;That said I am also fine with the suggested fix.&lt;/p&gt;
</comment>
                            <comment id="17090326" author="dawidwys" created="Thu, 23 Apr 2020 07:07:30 +0000"  >&lt;p&gt;What is your opinion &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;? I do agree with what you said in principle. The relaxing proposed in the PR does not stretch the assumptions too much and mainly aims to improve support the old types, which truth be told did not care about any precision. Still it verifies that none of the mismatches require a cast. If you are ok with it I will take care of the PR.&lt;/p&gt;</comment>
                            <comment id="17090453" author="jark" created="Thu, 23 Apr 2020 09:55:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dwysakowicz&quot; class=&quot;user-hover&quot; rel=&quot;dwysakowicz&quot;&gt;dwysakowicz&lt;/a&gt; Thanks for taking case of this PR. I&apos;m also fine with the proposed PR. &lt;/p&gt;</comment>
                            <comment id="17093242" author="dawidwys" created="Mon, 27 Apr 2020 09:26:36 +0000"  >&lt;p&gt;Fixed in aed8c1957a706c35d824c598e2d610d897059c36&lt;/p&gt;</comment>
                            <comment id="17100150" author="dawidwys" created="Tue, 5 May 2020 18:06:36 +0000"  >&lt;p&gt;Fixed in 1.10.1: ff7b4f6f0e073477b7a93dbda8243e7fc8647f50&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 28 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dxb4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>