<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:25:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-4155] Get Kafka producer partition info in open method instead of constructor</title>
                <link>https://issues.apache.org/jira/browse/FLINK-4155</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;Currently the Flink Kafka producer does not really do any error handling if something is wrong with the partition metadata as it is serialized with the user function.&lt;/p&gt;

&lt;p&gt;This means that in some cases the job can go into an error loop when using the checkpoints. Getting the partition info in the open method would solve this problem (like restarting from a savepoint which re-runs the constructor).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12986908">FLINK-4155</key>
            <summary>Get Kafka producer partition info in open method instead of constructor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tzulitai">Tzu-Li (Gordon) Tai</assignee>
                                    <reporter username="gyfora">Gyula Fora</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Jul 2016 18:36:57 +0000</created>
                <updated>Tue, 22 Nov 2016 16:19:08 +0000</updated>
                            <resolved>Tue, 22 Nov 2016 16:19:08 +0000</resolved>
                                    <version>1.0.3</version>
                    <version>1.1.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15363959" author="rmetzger" created="Wed, 6 Jul 2016 08:24:13 +0000"  >&lt;p&gt;I agree that we should change this.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4023&quot; title=&quot;Move Kafka consumer partition discovery from constructor to open()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4023&quot;&gt;&lt;del&gt;FLINK-4023&lt;/del&gt;&lt;/a&gt; is related.&lt;/p&gt;</comment>
                            <comment id="15389028" author="tzulitai" created="Fri, 22 Jul 2016 06:44:40 +0000"  >&lt;p&gt;Solving this together with &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4022&quot; title=&quot;Partition discovery / regex topic subscription for the Kafka consumer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4022&quot;&gt;&lt;del&gt;FLINK-4022&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15597660" author="githubbot" created="Sat, 22 Oct 2016 11:03:08 +0000"  >&lt;p&gt;GitHub user tzulitai opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4155&quot; title=&quot;Get Kafka producer partition info in open method instead of constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4155&quot;&gt;&lt;del&gt;FLINK-4155&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Move partition list fetching  to open() for Kafka Producers&lt;/p&gt;

&lt;p&gt;    The fetched partition list from Kafka in `open()` is sorted by partition id&lt;br/&gt;
    so that subtasks will have the same list across failures. To compensate the original&lt;br/&gt;
    use of a `KafkaProducer` instantiation in the constructor to eagerly&lt;br/&gt;
    ensure that required producer configs are provided, we check that at least&lt;br/&gt;
    the bootstrap servers are set.&lt;/p&gt;

&lt;p&gt;    This change also includes:&lt;br/&gt;
    1. Refactoring of `AtLeastOnceProducerTest` for a more complete suite of tests on `FlinkKafkaProducerBase`.&lt;br/&gt;
    2. Directly instantiate a `FlinkKafkaProducerBase` in the Kafka table sink tests, instead of mocking (had to be mocked before because of the `KafkaProducer` in the constructor).&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tzulitai/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tzulitai/flink&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4155&quot; title=&quot;Get Kafka producer partition info in open method instead of constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4155&quot;&gt;&lt;del&gt;FLINK-4155&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2681&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c8f152037f2f6c31be2b24613ddad8dd1881e631&lt;br/&gt;
Author: Tzu-Li (Gordon) Tai &amp;lt;tzulitai@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-10-21T06:23:58Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4155&quot; title=&quot;Get Kafka producer partition info in open method instead of constructor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-4155&quot;&gt;&lt;del&gt;FLINK-4155&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;kafka&amp;#93;&lt;/span&gt; Move partition list fetching  to open() for Kafka producers&lt;/p&gt;

&lt;p&gt;    The fetched partition list from Kafka in open() is sorted by partition id&lt;br/&gt;
    so that subtasks will have the same list across failures. To compensate the original&lt;br/&gt;
    use of the KafkaProducer instantiation in the constructor to eagerly&lt;br/&gt;
    ensure that required producer configs are provided, we check that at least&lt;br/&gt;
    the bootstrap servers are set.&lt;/p&gt;

&lt;p&gt;    This change also includes refactoring of AtLeastOnceProducerTest for a more&lt;br/&gt;
    complete suite of tests on FlinkKafkaProducerBase.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15608079" author="githubbot" created="Wed, 26 Oct 2016 10:25:40 +0000"  >&lt;p&gt;Github user StephanEwen commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Looks good to me. I think it would be good if @rmetzger also had a look.&lt;/p&gt;

&lt;p&gt;    Concerning the Table sink tests and the mocking of the producer: Do these tests need a Kafka cluster running at all? They are just a think layer on top of the producer, which should be covered with Unit tests and not need a Kafka cluster.&lt;/p&gt;</comment>
                            <comment id="15617872" author="githubbot" created="Sat, 29 Oct 2016 10:10:19 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    @StephanEwen I think it makes sense to convert the table sink / source tests to unit tests that simply check they are using the Kafka consumer / producers correctly. Will include as part of this PR.&lt;/p&gt;</comment>
                            <comment id="15683507" author="githubbot" created="Mon, 21 Nov 2016 12:51:09 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Did you refactor the table tests? If not, we can also merge this PR as is and file a follow up JIRA.&lt;br/&gt;
    One other thing I thought about while looking over the PR: We need the partition list only for the partitioner.&lt;br/&gt;
    So we actually need to do the getPartitions() call only if a partitioner has been set.&lt;/p&gt;

&lt;p&gt;    The PR is +1 to merge. Its up to you if you are doing the getPartition() call conditional with the PR, or whether we do it in a separate PR.&lt;/p&gt;</comment>
                            <comment id="15686810" author="githubbot" created="Tue, 22 Nov 2016 13:54:00 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks for the review @rmetzger.&lt;/p&gt;

&lt;p&gt;    No, actually I haven&apos;t refactored the table tests yet. I&apos;ll file up the follow-up JIRAs mentioned in the comments, and merge the PR as is.&lt;/p&gt;</comment>
                            <comment id="15686983" author="githubbot" created="Tue, 22 Nov 2016 15:11:22 +0000"  >&lt;p&gt;Github user rmetzger commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Cool, thx.&lt;/p&gt;</comment>
                            <comment id="15687092" author="githubbot" created="Tue, 22 Nov 2016 15:53:04 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15687145" author="githubbot" created="Tue, 22 Nov 2016 16:15:10 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Actually, IIRC, @twalthr already converted the table tests to unit tests in &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-4745&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-4745&lt;/a&gt;. So, right now the table tests are already unit tests without running a Kafka cluster.&lt;/p&gt;

&lt;p&gt;    The only change regarding the table tests in this PR is that on the producer side (table sink), the producer had to be mocked because of the previous partition fetching in the constructor; this PR merely changes the mocking to directly instantiating.&lt;/p&gt;</comment>
                            <comment id="15687149" author="githubbot" created="Tue, 22 Nov 2016 16:16:15 +0000"  >&lt;p&gt;Github user tzulitai commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/2681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/2681&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Follow-up JIRA for conditional partition fetching:&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-5128&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FLINK-5128&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15687157" author="tzulitai" created="Tue, 22 Nov 2016 16:18:45 +0000"  >&lt;p&gt;Resolved for master with &lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/flink/commit/1f9c0cf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/flink/commit/1f9c0cf&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12975818">FLINK-4023</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30jxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>