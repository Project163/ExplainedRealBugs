<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:58:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-23573] Tests fail with AdaptiveScheduler due to exceptions in logs trying to offer slots after JobMaster shutdown</title>
                <link>https://issues.apache.org/jira/browse/FLINK-23573</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=20267&amp;amp;view=logs&amp;amp;j=4dd4dbdd-1802-5eb7-a518-6acd9d24d0fc&amp;amp;t=8d6b4dd3-4ca1-5611-1743-57a7d76b395a&amp;amp;l=412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=20267&amp;amp;view=logs&amp;amp;j=4dd4dbdd-1802-5eb7-a518-6acd9d24d0fc&amp;amp;t=8d6b4dd3-4ca1-5611-1743-57a7d76b395a&amp;amp;l=412&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=20396&amp;amp;view=logs&amp;amp;j=4dd4dbdd-1802-5eb7-a518-6acd9d24d0fc&amp;amp;t=8d6b4dd3-4ca1-5611-1743-57a7d76b395a&amp;amp;l=2390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=20396&amp;amp;view=logs&amp;amp;j=4dd4dbdd-1802-5eb7-a518-6acd9d24d0fc&amp;amp;t=8d6b4dd3-4ca1-5611-1743-57a7d76b395a&amp;amp;l=2390&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=20454&amp;amp;view=logs&amp;amp;j=4dd4dbdd-1802-5eb7-a518-6acd9d24d0fc&amp;amp;t=8d6b4dd3-4ca1-5611-1743-57a7d76b395a&amp;amp;l=371&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=20454&amp;amp;view=logs&amp;amp;j=4dd4dbdd-1802-5eb7-a518-6acd9d24d0fc&amp;amp;t=8d6b4dd3-4ca1-5611-1743-57a7d76b395a&amp;amp;l=371&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=21228&amp;amp;view=logs&amp;amp;j=4dd4dbdd-1802-5eb7-a518-6acd9d24d0fc&amp;amp;t=7c4a8fb8-eeee-5a77-f518-4176bfae300b&amp;amp;l=2437&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=21228&amp;amp;view=logs&amp;amp;j=4dd4dbdd-1802-5eb7-a518-6acd9d24d0fc&amp;amp;t=7c4a8fb8-eeee-5a77-f518-4176bfae300b&amp;amp;l=2437&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The test failed due to exceptions in logs. I executed the following command from flink-end-to-end-tests/test-scripts/common.sh on the logs, and it points to the RecipientUnreachableException in TM logs. The problem is that, TM received extra slot requests from RM after the tasks are finished and slots are freed, while the JobMaster it tried to offer slots to had already shutdown.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ grep -rv &lt;span class=&quot;code-quote&quot;&gt;&quot;GroupCoordinatorNotAvailableException&quot;&lt;/span&gt; . \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;RetriableCommitFailedException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;NoAvailableBrokersException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;Async Kafka commit failed&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;DisconnectException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot connect to ResourceManager right now&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;AskTimeoutException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;WARN  akka.remote.transport.netty.NettyTransport&quot;&lt;/span&gt; \
   | grep -v  &lt;span class=&quot;code-quote&quot;&gt;&quot;WARN  org.apache.flink.shaded.akka.org.jboss.netty.channel.DefaultChannelPipeline&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&apos;INFO.*AWSErrorCode&apos;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;RejectedExecutionException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;CancellationException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;An exception was thrown by an exception handler&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.yarn.exceptions.YarnException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.conf.Configuration&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoClassDefFoundError: org/apache/hadoop/yarn/exceptions/YarnException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.NoClassDefFoundError: org/apache/hadoop/conf/Configuration&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.Exception: Execution was suspended&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;java.io.InvalidClassException: org.apache.flink.formats.avro.typeutils.AvroSerializer&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;Caused by: java.lang.Exception: JobManager is shutting down&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.Exception: Artificial failure&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.checkpoint.CheckpointException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;org.elasticsearch.ElasticsearchException&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;Elasticsearch exception&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.flink.runtime.JobException: Recovery is suppressed&quot;&lt;/span&gt; \
   | grep -v &lt;span class=&quot;code-quote&quot;&gt;&quot;WARN  akka.remote.ReliableDeliverySupervisor&quot;&lt;/span&gt; \
   | grep -i &lt;span class=&quot;code-quote&quot;&gt;&quot;exception&quot;&lt;/span&gt;
./flink-vsts-taskexecutor-0-fv-az217-107.log:org.apache.flink.runtime.rpc.exceptions.RecipientUnreachableException: Could not send message [RemoteFencedMessage(00000000000000000000000000000000, RemoteRpcInvocation(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.offerSlots(ResourceID, Collection, Time)))] from sender [Actor[akka.tcp:&lt;span class=&quot;code-comment&quot;&gt;//flink@10.1.0.175:38955/temp/$0b]] to recipient [Actor[akka://flink/user/rpc/jobmanager_2#1483449133]], because the recipient is unreachable. This can either mean that the recipient has been terminated or that the remote RpcService is currently not reachable.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13392983">FLINK-23573</key>
            <summary>Tests fail with AdaptiveScheduler due to exceptions in logs trying to offer slots after JobMaster shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xtsong">Xintong Song</assignee>
                                    <reporter username="xtsong">Xintong Song</reporter>
                        <labels>
                            <label>pull-request-available</label>
                            <label>test-stability</label>
                    </labels>
                <created>Mon, 2 Aug 2021 04:11:48 +0000</created>
                <updated>Sat, 28 Aug 2021 13:06:56 +0000</updated>
                            <resolved>Tue, 3 Aug 2021 01:34:29 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.14.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17391288" author="xintongsong" created="Mon, 2 Aug 2021 04:13:23 +0000"  >&lt;p&gt;The tests can be easily fixed by adding the `RecipientUnreachableException` to the whitelist. However, IIUC the problem should not happen after &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21751&quot; title=&quot;Improve handling of freed slots if final requirement message is in flight&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21751&quot;&gt;&lt;del&gt;FLINK-21751&lt;/del&gt;&lt;/a&gt;. Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt; can check if everything works as expected before we add it to the whitelist.&lt;/p&gt;</comment>
                            <comment id="17391466" author="zentol" created="Mon, 2 Aug 2021 09:40:49 +0000"  >&lt;p&gt;If I remember correctly then this behavior is expected. &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-21751&quot; title=&quot;Improve handling of freed slots if final requirement message is in flight&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-21751&quot;&gt;&lt;del&gt;FLINK-21751&lt;/del&gt;&lt;/a&gt; did not really fix the race condition; it just made sure the slots are released properly/faster than they usually would in the case of a JM shutdown.&lt;br/&gt;
This looks more of a side-effect of &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-23202&quot; title=&quot;RpcService should fail result futures if messages could not be sent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-23202&quot;&gt;&lt;del&gt;FLINK-23202&lt;/del&gt;&lt;/a&gt; with which we actively listen for messages that could not be delivered.&lt;/p&gt;

&lt;p&gt;I&apos;d say it is fine to add it to the whitelist. I would imagine this can occur in any case during the shutdown of the cluster if at exactly that time some communication is initiated (e.g., heartbeats).&lt;/p&gt;</comment>
                            <comment id="17391523" author="xintongsong" created="Mon, 2 Aug 2021 11:27:54 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chesnay&quot; class=&quot;user-hover&quot; rel=&quot;chesnay&quot;&gt;chesnay&lt;/a&gt;. I&apos;ll add it to the whitelist.&lt;/p&gt;</comment>
                            <comment id="17391854" author="xintongsong" created="Tue, 3 Aug 2021 01:34:30 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master (1.14): e45723b503b9cc793317a6cad7c0d4c8075c0d16&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13364676">FLINK-21751</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0tipc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>