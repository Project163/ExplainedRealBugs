<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:34:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-9857] Processing-time timers fire too early</title>
                <link>https://issues.apache.org/jira/browse/FLINK-9857</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;The firing of processing-time timers is off by one. This leads to problems in edge cases, as discovered &lt;a href=&quot;https://lists.apache.org/thread.html/e49748fa5fa1c9217b9dfb65eea7a37af1f2895c769528e77a1a93fa@%3Cuser.flink.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here (mailing list)&lt;/a&gt; when elements arrive at the timestamp that is the end of the window.&lt;/p&gt;

&lt;p&gt;The problem is &lt;a href=&quot;https://github.com/apache/flink/blob/79b38f8f9a79b917d525842cf46087c5b8c40f3d/flink-streaming-java/src/main/java/org/apache/flink/streaming/api/operators/HeapInternalTimerService.java#L231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here (github)&lt;/a&gt;. For event-time, we fire timers when the watermark is &amp;gt;= the timestamp, this is correct because a watermark T says that we will not see elements with a timestamp smaller or equal to T. For processing time, a time of T does not say that we won&apos;t see an element with timestamp T, which makes processing-time timers fire one ms too early.&lt;/p&gt;

&lt;p&gt;I think we can fix it by turning that &lt;tt&gt;&amp;lt;=&lt;/tt&gt; into a &lt;tt&gt;&amp;lt;&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13172349">FLINK-9857</key>
            <summary>Processing-time timers fire too early</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aljoscha">Aljoscha Krettek</assignee>
                                    <reporter username="aljoscha">Aljoscha Krettek</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 16 Jul 2018 09:34:14 +0000</created>
                <updated>Mon, 12 Jul 2021 13:00:26 +0000</updated>
                            <resolved>Tue, 17 Jul 2018 12:55:31 +0000</resolved>
                                    <version>1.3.4</version>
                    <version>1.4.2</version>
                    <version>1.5.1</version>
                    <version>1.6.0</version>
                                    <fixVersion>1.5.2</fixVersion>
                    <fixVersion>1.6.0</fixVersion>
                                    <component>API / DataStream</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16545004" author="aljoscha" created="Mon, 16 Jul 2018 09:41:16 +0000"  >&lt;p&gt;We can fix this at one of two places:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;tt&gt;SystemProcessingTimeService&lt;/tt&gt; service, by moving firing of timers back by 1 ms&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;HeapInternalTimerService&lt;/tt&gt;, which uses &lt;tt&gt;SystemProcessingTimeService&lt;/tt&gt; but is one level higher in the layer of abstractions&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16545286" author="aljoscha" created="Mon, 16 Jul 2018 14:57:34 +0000"  >&lt;p&gt;On a side note: even if we change this off-by-one bug, I think there can still be races because current processing time is queried using System.currentTimeMillis() and we set timers using a ScheduledThreadPoolExecutor (currently). If there&apos;s any race between those two you can also get weird results.&lt;/p&gt;

&lt;p&gt;For these reasons, I would always suggest to go with event time or ingestion time, but I think the latter is currently not possible with the Table API/SQL.&lt;/p&gt;</comment>
                            <comment id="16546184" author="githubbot" created="Tue, 17 Jul 2018 08:29:27 +0000"  >&lt;p&gt;GitHub user aljoscha opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6348&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9857&quot; title=&quot;Processing-time timers fire too early&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9857&quot;&gt;&lt;del&gt;FLINK-9857&lt;/del&gt;&lt;/a&gt; Delay firing of processing-time timers by 1 ms&lt;/p&gt;

&lt;p&gt;    Description from Jira issue:&lt;/p&gt;

&lt;p&gt;    ```&lt;br/&gt;
    The firing of processing-time timers is off by one. This leads to problems in edge cases, as discovered here (mailing list) when elements arrive at the timestamp that is the end of the window.&lt;br/&gt;
    The problem is here (github). For event-time, we fire timers when the watermark is &amp;gt;= the timestamp, this is correct because a watermark T says that we will not see elements with a timestamp smaller or equal to T. For processing time, a time of T does not say that we won&apos;t see an element with timestamp T, which makes processing-time timers fire one ms too early.&lt;br/&gt;
    I think we can fix it by turning that &amp;lt;= into a &amp;lt;.&lt;br/&gt;
    ```&lt;/p&gt;

&lt;p&gt;    I&apos;m afraid there are no tests for this behaviour and there can&apos;t be tests for the new behaviour since we&apos;re dealing with processing time here.&lt;/p&gt;

&lt;p&gt;    R: @StephanEwen &lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/aljoscha/flink&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/aljoscha/flink&lt;/a&gt; jira-9857-fix-system-processing-service&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6348.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6348.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #6348&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 914e9cf41b46bb4457b37ee789d3239a11740ee7&lt;br/&gt;
Author: Aljoscha Krettek &amp;lt;aljoscha.krettek@...&amp;gt;&lt;br/&gt;
Date:   2018-07-16T13:58:07Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-9857&quot; title=&quot;Processing-time timers fire too early&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-9857&quot;&gt;&lt;del&gt;FLINK-9857&lt;/del&gt;&lt;/a&gt; Delay firing of processing-time timers by 1 ms&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16546541" author="githubbot" created="Tue, 17 Jul 2018 12:52:07 +0000"  >&lt;p&gt;Github user aljoscha commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6348&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I quickly talked to @StephanEwen directly and he agreed the fix is good so I&apos;m merging.&lt;/p&gt;</comment>
                            <comment id="16546548" author="githubbot" created="Tue, 17 Jul 2018 12:54:40 +0000"  >&lt;p&gt;Github user aljoscha closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/flink/pull/6348&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6348&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16546553" author="aljoscha" created="Tue, 17 Jul 2018 12:55:31 +0000"  >&lt;p&gt;Fixed on master in&lt;br/&gt;
690bc370e19d8003add4e41c05acfb4dccc662b4&lt;/p&gt;

&lt;p&gt;Fixed on release-1.6 in&lt;br/&gt;
ffeb978260c0ce770911183ff042e502724a3fd3&lt;/p&gt;

&lt;p&gt;Fixed on release-1.5 in&lt;br/&gt;
726f1cce32ed3f0f7c04c289f2d089438ecdaae6&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13387055">FLINK-23208</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3vxav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>