<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:52:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-20947] Idle source doesn&apos;t work when pushing watermark into the source</title>
                <link>https://issues.apache.org/jira/browse/FLINK-20947</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;I use table sql to create stream with kafka source, and write data from Kafka into a Hive partitioned table.&lt;/p&gt;

&lt;p&gt;The following sql to create kafka table:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// code placeholder
&lt;/span&gt;tableEnv.executeSql(
    &lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE stream_tmp.kafka_tmp (`messageId` STRING, `message_type` STRING,`payload` STRING,`timestamp` BIGINT, &quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot;  procTime AS PROCTIME(),&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot;  eventTime AS TO_TIMESTAMP(FROM_UNIXTIME(`timestamp` / 1000,&lt;span class=&quot;code-quote&quot;&gt;&apos;yyyy-MM-dd HH:mm:ss&apos;&lt;/span&gt;)),&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot;  WATERMARK FOR eventTime AS eventTime - INTERVAL &lt;span class=&quot;code-quote&quot;&gt;&apos;15&apos;&lt;/span&gt; SECOND )&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot;  WITH (&lt;span class=&quot;code-quote&quot;&gt;&apos;connector&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;kafka&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;topic&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;XXX-topic&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.bootstrap.servers&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;kafka-server:9092&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;properties.group.id&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;XXX-group_id&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;scan.startup.mode&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;latest-offset&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;format&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;json&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;json.fail-on-missing-field&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;json.ignore-parse-errors&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&lt;/span&gt; )&quot;&lt;/span&gt;
            );&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&#160;&lt;/p&gt;

&lt;p&gt;And, the following sql to create Hive table:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// code placeholder
&lt;/span&gt;tableEnv.executeSql(
     &lt;span class=&quot;code-quote&quot;&gt;&quot;CREATE TABLE hive_tmp.kafka_hive_tmp (`message_id` STRING,`message_type` STRING,`payload` STRING,`event_ts` BIGINT ) &quot;&lt;/span&gt; +
             &lt;span class=&quot;code-quote&quot;&gt;&quot; PARTITIONED BY (ts_date STRING,ts_hour STRING, ts_minute STRING)&quot;&lt;/span&gt; +
             &lt;span class=&quot;code-quote&quot;&gt;&quot; STORED AS PARQUET TBLPROPERTIES (&quot;&lt;/span&gt; +
             &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.partition-commit.trigger&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;partition-time&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
             &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.partition-commit.delay&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;1 min&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
             &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.partition-commit.policy.kind&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;metastore,success-file&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
             &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;sink.partition-commit.success-file.name&apos;&lt;/span&gt;=&lt;span class=&quot;code-quote&quot;&gt;&apos;_SUCCESS&apos;&lt;/span&gt;,&quot;&lt;/span&gt; +
             &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-quote&quot;&gt;&apos;partition.time-extractor.timestamp-pattern&apos;&lt;/span&gt; = &lt;span class=&quot;code-quote&quot;&gt;&apos;$ts_date $ts_hour:$ts_minute:00&apos;&lt;/span&gt;)&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For the kafka topic used above,&#160; which has&#160;multi partitions,&#160; with some of the partitions there&apos;s data coming in, while other partitions with no data coming.&lt;/p&gt;

&lt;p&gt;I noticed that there&apos;s config &quot;&lt;em&gt;table.exec.source.idle-timeout&lt;/em&gt;&quot; can handle the situation for the &quot;idle&quot; source partition, but event though set this config, it still cannot trigger the Hive partition commit (that means the &quot;_SUCCESS&quot; file will not be created for the partition).&lt;/p&gt;

&lt;p&gt;After do the analysis for this issue, find the root cause is that the watermark for the &quot;idle&quot; partition will not advance, which cause the Hive partition cannot be committed.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13351911">FLINK-20947</key>
            <summary>Idle source doesn&apos;t work when pushing watermark into the source</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fsk119">Shengkai Fang</assignee>
                                    <reporter username="weijiaxu">Weijia Xu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Wed, 13 Jan 2021 02:59:36 +0000</created>
                <updated>Fri, 28 May 2021 08:07:04 +0000</updated>
                            <resolved>Tue, 26 Jan 2021 11:48:02 +0000</resolved>
                                    <version>1.12.0</version>
                                    <fixVersion>1.12.2</fixVersion>
                    <fixVersion>1.13.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17263885" author="jark" created="Wed, 13 Jan 2021 04:40:23 +0000"  >&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; could you help to check whether the idle timeout works for the push downed watermark?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=weijiaxu&quot; class=&quot;user-hover&quot; rel=&quot;weijiaxu&quot;&gt;weijiaxu&lt;/a&gt; could you share the explain result of your query?&lt;/p&gt;</comment>
                            <comment id="17263895" author="weijiaxu" created="Wed, 13 Jan 2021 05:15:54 +0000"  >&lt;p&gt;I think the root cause is the watermark for the &quot;idle&quot; partition will not advance, the reason why this happens, is because when set the&#160;&quot;&lt;em&gt;table.exec.source.idle-timeout&lt;/em&gt;&quot;, and the idle timeout value is valid, the watermark strategy that enriched with idleness detection should be updated, but actually not (after checking from the source code)&lt;/p&gt;

&lt;p&gt;source code class:&#160; &lt;em&gt;PushWatermarkIntoTableSourceScanRuleBase.java&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17263907" author="jark" created="Wed, 13 Jan 2021 06:19:33 +0000"  >&lt;p&gt;Good catch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=weijiaxu&quot; class=&quot;user-hover&quot; rel=&quot;weijiaxu&quot;&gt;weijiaxu&lt;/a&gt;! I think you are right. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt; will help to fix this. We should think about how to add a good test for this. It is not test covered when supporting the watermark pushdown. &lt;/p&gt;</comment>
                            <comment id="17264020" author="weijiaxu" created="Wed, 13 Jan 2021 09:51:50 +0000"  >&lt;p&gt;My pleasure,&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I think fix this issue is easy, what&apos;s more important, as you said, need setup the test for certain scenarios.&lt;/p&gt;

&lt;p&gt;If I can be involved in the discussion for how to setup the test and learn more about this ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17264104" author="jark" created="Wed, 13 Jan 2021 12:03:19 +0000"  >&lt;p&gt;1. I find that we don&apos;t have watermark pushdown with idle timeout *&lt;b&gt;plan test&lt;/b&gt;*. We need add one into &lt;tt&gt;PushWatermarkIntoTableSourceScanRuleTest&lt;/tt&gt;.&lt;br/&gt;
2. We can add an IT case in &lt;tt&gt;KafkaTableITCase&lt;/tt&gt;, &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;prepare 2 partitions, each with several messages. The last event time in the first partition is &lt;tt&gt;2021-01-13 20:00:00&lt;/tt&gt;, the last event time in the second partition is &lt;tt&gt;2021-01-13 19:30:00&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;window query on the source with tumbling 1 hour&lt;/li&gt;
	&lt;li&gt;the query should have output with window [19:00, 20:00) which means the watermark has reached 20:00.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17266708" author="fsk119" created="Sun, 17 Jan 2021 06:49:31 +0000"  >&lt;p&gt;Sorry for the late response. I think the tests works like the rule test in `PushPartitionIntoTableSourceScanRule`. I will fix it soon.&lt;/p&gt;</comment>
                            <comment id="17270226" author="jark" created="Fri, 22 Jan 2021 15:42:56 +0000"  >&lt;p&gt;Fixed in &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master: 90e680c9c579b2ffa1ca93ad7dfbaa5502dd8701&lt;/li&gt;
	&lt;li&gt;release-1.12: 13aa323aaa6e3920765a5a7a01ad8e25f9ae59ad&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17270227" author="jark" created="Fri, 22 Jan 2021 15:43:52 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=weijiaxu&quot; class=&quot;user-hover&quot; rel=&quot;weijiaxu&quot;&gt;weijiaxu&lt;/a&gt;, we have fixed this problem in master branch. Could you help to check whether this resolve your problem if you have time?&lt;/p&gt;</comment>
                            <comment id="17271146" author="weijiaxu" created="Mon, 25 Jan 2021 08:21:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jark&quot; class=&quot;user-hover&quot; rel=&quot;jark&quot;&gt;jark&lt;/a&gt;&#160;&amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fsk119&quot; class=&quot;user-hover&quot; rel=&quot;fsk119&quot;&gt;fsk119&lt;/a&gt;, just applied the latest fix and it worked as what we expected. Thanks for your effort.&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mj0o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>