<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:40:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-13241] YarnResourceManager does not handle slot allocations in certain cases</title>
                <link>https://issues.apache.org/jira/browse/FLINK-13241</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In the case that a job allocates a few slots&#160;first and after a period allocates some other slots. The YarnResourceManager&#160;seems to receive and ignore the latter&#160;slot requests.&lt;/p&gt;

&lt;p&gt;To produce this issue, we can create a job with 2 vertices in different shared groups, as shown below:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12974498/12974498_17_37_05__07_12_2019.jpg&quot; height=&quot;127&quot; width=&quot;433&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Slot allocation for map2&#160;vertex&#160;happens after the source vertex acquires slots to decide its location, thus to meet the input constraints.&lt;/p&gt;

&lt;p&gt;YarnResourceManager can receive slot requests for map2, but&#160;seems&#160;not to handle it and the job will hang there&#160;waiting for resources.&lt;/p&gt;

&lt;p&gt;In my observation, this issue does not happen&#160;on Flink(Version: 1.9-SNAPSHOT, Rev:3bc322a, Date:26.06.2019 @ 17:28:51 CST). It should be a new issue after that.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13244565">FLINK-13241</key>
            <summary>YarnResourceManager does not handle slot allocations in certain cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xtsong">Xintong Song</assignee>
                                    <reporter username="zhuzh">Zhu Zhu</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Fri, 12 Jul 2019 09:44:33 +0000</created>
                <updated>Thu, 24 Oct 2019 14:37:02 +0000</updated>
                            <resolved>Tue, 30 Jul 2019 11:52:17 +0000</resolved>
                                    <version>1.9.0</version>
                                    <fixVersion>1.9.0</fixVersion>
                                    <component>Deployment / YARN</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="16883763" author="till.rohrmann" created="Fri, 12 Jul 2019 12:32:04 +0000"  >&lt;p&gt;Thanks for reporting this issue. Could you please share the corresponding logs of the failed runs &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhuzh&quot; class=&quot;user-hover&quot; rel=&quot;zhuzh&quot;&gt;zhuzh&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="16883824" author="xintongsong" created="Fri, 12 Jul 2019 13:44:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=till.rohrmann&quot; class=&quot;user-hover&quot; rel=&quot;till.rohrmann&quot;&gt;till.rohrmann&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhuzh&quot; class=&quot;user-hover&quot; rel=&quot;zhuzh&quot;&gt;zhuzh&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Quick updates on discoveries so far.&lt;/p&gt;

&lt;p&gt;I found that the resource manager failed to match registered slots to the pending task manager slots. The first round pending slots&#160;are not completed by the registered slots, however the pending requests still get allocated on the registered slots through the code path `handleFreeSlot`, which also unassigned the request from the pending task slot. As result,&#160;the free pending task slots are left in the slot manager while there is actually no pending slots. That prevent the resource manager from requesting new containers for the second round slot requests.&lt;/p&gt;

&lt;p&gt;The registered slots are not matched with pending task manager slots because&#160;managed memory size in&#160;resource profiles do not exactly match. Could be small errors during megabytes and bytes conversions. I&apos;ll continue debugging on this.&lt;/p&gt;</comment>
                            <comment id="16883887" author="till.rohrmann" created="Fri, 12 Jul 2019 15:02:11 +0000"  >&lt;p&gt;Thanks for looking into this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xintongsong&quot; class=&quot;user-hover&quot; rel=&quot;xintongsong&quot;&gt;xintongsong&lt;/a&gt;. Keep us posted what you find.&lt;/p&gt;</comment>
                            <comment id="16883894" author="stephanewen" created="Fri, 12 Jul 2019 15:08:12 +0000"  >&lt;p&gt;I would vote to calculate with bytes everywhere.&lt;br/&gt;
It would be simplest if we started using &lt;tt&gt;MemorySize&lt;/tt&gt; instead of longs.&lt;br/&gt;
That has the advantage that we always keep bytes internally (no rounding error and loss) but can still give users a way to configure bigger units like megabytes.&lt;/p&gt;</comment>
                            <comment id="16884257" author="xintongsong" created="Sat, 13 Jul 2019 00:58:41 +0000"  >&lt;p&gt;Turns out it&apos;s not a bytes/megabytes converting issue.&lt;/p&gt;

&lt;p&gt;We explicitly set the exact managed memory size into configuration on RM side, to avoid TM calculating managed memory&#160;from&#160;fraction&#160;and uncertain JVM free memory. However, we were setting the wrong configuration instance.&#160;In YarnResourceManager constructor, we copied the configuration instance because we are going to alter it. But we altered the original configuration instead of the copied one which is used by TM.&lt;/p&gt;

&lt;p&gt;I&apos;ve opened a PR to fix it, and same problem for Mesos.&lt;/p&gt;</comment>
                            <comment id="16896054" author="till.rohrmann" created="Tue, 30 Jul 2019 11:52:17 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;1.10.0: 01f8c3508140988dcff7e3a72bf1b483db8f79f5&lt;br/&gt;
1.9.0: b4697f7e41acfb6b76bb7a67d9d19bc577a023c5&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13248825">FLINK-13579</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13256478">FLINK-14074</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12974498" name="17_37_05__07_12_2019.jpg" size="84587" author="zhuzh" created="Fri, 12 Jul 2019 09:38:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z04lwg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>