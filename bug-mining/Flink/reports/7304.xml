<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 21:19:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-33666] MergeTableLikeUtil uses different constraint name than Schema</title>
                <link>https://issues.apache.org/jira/browse/FLINK-33666</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;&lt;tt&gt;MergeTableLikeUtil&lt;/tt&gt; uses a different algorithm to name constraints than &lt;tt&gt;Schema&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;Schema&lt;/tt&gt; includes the column names.&lt;br/&gt;
&lt;tt&gt;MergeTableLikeUtil&lt;/tt&gt; uses a hashCode which means it might depend on JVM specifics.&lt;/p&gt;

&lt;p&gt;For consistency we should use the same algorithm. I propose to use &lt;tt&gt;Schema&lt;/tt&gt;&apos;s logic.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13559577">FLINK-33666</key>
            <summary>MergeTableLikeUtil uses different constraint name than Schema</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeyhunkarimov">Jeyhun Karimov</assignee>
                                    <reporter username="twalthr">Timo Walther</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 27 Nov 2023 15:20:53 +0000</created>
                <updated>Thu, 14 Dec 2023 19:14:26 +0000</updated>
                            <resolved>Thu, 7 Dec 2023 08:45:36 +0000</resolved>
                                    <version>1.18.0</version>
                                    <fixVersion>1.19.0</fixVersion>
                                    <component>Table SQL / Planner</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17793590" author="jeyhunkarimov" created="Wed, 6 Dec 2023 09:26:45 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; can you please assign this task to me or give me access to self-assign tasks?&lt;/p&gt;</comment>
                            <comment id="17794086" author="twalthr" created="Thu, 7 Dec 2023 08:41:36 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeyhunkarimov&quot; class=&quot;user-hover&quot; rel=&quot;jeyhunkarimov&quot;&gt;jeyhunkarimov&lt;/a&gt; for working on this.&lt;/p&gt;</comment>
                            <comment id="17794088" author="twalthr" created="Thu, 7 Dec 2023 08:45:36 +0000"  >&lt;p&gt;Fixed in master: ca1c7ce48127472a7c7965099f8a7227549f09df&lt;/p&gt;</comment>
                            <comment id="17794460" author="JIRAUSER284726" created="Thu, 7 Dec 2023 22:43:43 +0000"  >&lt;p&gt;This change seems to prevent `org.apache.flink.table.api.internal.TableEnvironmentImpl.loadPlan` from working on Compiled Plans which used the previous method.&#160;&#160;&lt;/p&gt;

&lt;p&gt;The PR changes restore test plans which should never be updated.&#160;&#160;&lt;/p&gt;

&lt;p&gt;I was able to see this since &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bvarghese&quot; class=&quot;user-hover&quot; rel=&quot;bvarghese&quot;&gt;bvarghese&lt;/a&gt;&apos;s separate PR was merged to master today and it failed CI here:&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=55321&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://dev.azure.com/apache-flink/apache-flink/_build/results?buildId=55321&amp;amp;view=logs&amp;amp;j=0c940707-2659-5648-cbe6-a1ad63045f0a&amp;amp;t=075c2716-8010-5565-fe08-3c4bb45824a4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17796862" author="twalthr" created="Thu, 14 Dec 2023 18:09:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jhughes&quot; class=&quot;user-hover&quot; rel=&quot;jhughes&quot;&gt;jhughes&lt;/a&gt; was this issue resolved? Was it just a problem of the test base? What was the complete exception stack trace?&lt;/p&gt;</comment>
                            <comment id="17796882" author="JIRAUSER284726" created="Thu, 14 Dec 2023 19:14:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=twalthr&quot; class=&quot;user-hover&quot; rel=&quot;twalthr&quot;&gt;twalthr&lt;/a&gt; Yes, the issue has been resolved.&lt;/p&gt;

&lt;p&gt;The issue was a change in expectations around PK.&#160; From offline conversations, you assured me that the change is ok and will not impact folks using compiled plans.&#160; I think we are good.&lt;/p&gt;

&lt;p&gt;An example stack trace is:&lt;/p&gt;

&lt;p&gt;```&lt;br/&gt;
Dec 07 13:49:11 13:49:11.037 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; org.apache.flink.table.planner.plan.nodes.exec.stream.GroupAggregateRestoreTest.testRestore(TableTestProgram, ExecNodeMetadata)&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; Time elapsed: 0.17 s &amp;lt;&amp;lt;&amp;lt; ERROR! &lt;br/&gt;
Dec 07 13:49:11 org.apache.flink.table.api.TableException: Cannot load Plan from file &apos;/__w/1/s/flink-table/flink-table-planner/src/test/resources/restore-tests/stream-exec-group-aggregate_1/group-aggregate-simple/plan/group-aggregate-simple.json&apos;. &lt;br/&gt;
Dec 07 13:49:11 at org.apache.flink.table.api.internal.TableEnvironmentImpl.loadPlan(TableEnvironmentImpl.java:760) &lt;br/&gt;
Dec 07 13:49:11 at org.apache.flink.table.planner.plan.nodes.exec.testutils.RestoreTestBase.testRestore(RestoreTestBase.java:279)&lt;br/&gt;
....&lt;/p&gt;

&lt;p&gt;Dec 07 13:49:11 Caused by: org.apache.flink.shaded.jackson2.com.fasterxml.jackson.databind.JsonMappingException: The schema of table &apos;default_catalog.default_database.sink_t&apos; from the persisted plan does not match the schema loaded from the catalog: &apos;( &lt;br/&gt;
Dec 07 13:49:11 `b` BIGINT NOT NULL, &lt;br/&gt;
Dec 07 13:49:11 `cnt` BIGINT, &lt;br/&gt;
Dec 07 13:49:11 `avg_a` DOUBLE, &lt;br/&gt;
Dec 07 13:49:11 `min_c` STRING, &lt;br/&gt;
Dec 07 13:49:11 CONSTRAINT `PK_129` PRIMARY KEY (`b`) NOT ENFORCED &lt;br/&gt;
Dec 07 13:49:11 )&apos; != &apos;( &lt;br/&gt;
Dec 07 13:49:11 `b` BIGINT NOT NULL, &lt;br/&gt;
Dec 07 13:49:11 `cnt` BIGINT, &lt;br/&gt;
Dec 07 13:49:11 `avg_a` DOUBLE, &lt;br/&gt;
Dec 07 13:49:11 `min_c` STRING, &lt;br/&gt;
Dec 07 13:49:11 CONSTRAINT `PK_b` PRIMARY KEY (`b`) NOT ENFORCED &lt;br/&gt;
Dec 07 13:49:11 )&apos;. Make sure the table schema in the catalog is still identical. (through reference chain: org.apache.flink.table.planner.plan.nodes.exec.serde.JsonPlanGraph&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;nodes&amp;quot;&amp;#93;&lt;/span&gt;&lt;del&gt;&amp;gt;java.util.ArrayList&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt;&lt;/del&gt;&amp;gt;org.apache.flink.table.planner.plan.nodes.exec.stream.StreamExecSink&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;dynamicTableSink&amp;quot;&amp;#93;&lt;/span&gt;-&amp;gt;org.apache.flink.table.planner.plan.nodes.exec.spec.DynamicTableSinkSpec&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;table&amp;quot;&amp;#93;&lt;/span&gt;) &lt;br/&gt;
...&lt;br/&gt;
```&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 47 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1lvh4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>