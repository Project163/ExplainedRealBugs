<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:35:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-10135] Certain cluster-level metrics are no longer exposed</title>
                <link>https://issues.apache.org/jira/browse/FLINK-10135</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://ci.apache.org/projects/flink/flink-docs-release-1.5/monitoring/metrics.html#cluster&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;the documentation for metrics&lt;/a&gt; in the Flink 1.5.0 release, it says that the following metrics are reported by the JobManager:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;numRegisteredTaskManagers
numRunningJobs
taskSlotsAvailable
taskSlotsTotal
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the job manager REST endpoint (&lt;tt&gt;http://&amp;lt;job-manager&amp;gt;:8081/jobmanager/metrics&lt;/tt&gt;), those metrics don&apos;t appear.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13178717">FLINK-10135</key>
            <summary>Certain cluster-level metrics are no longer exposed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yanghua">vinoyang</assignee>
                                    <reporter username="fwiffo">Joey Echeverria</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Mon, 13 Aug 2018 22:09:58 +0000</created>
                <updated>Thu, 28 Feb 2019 14:00:52 +0000</updated>
                            <resolved>Mon, 15 Oct 2018 16:26:16 +0000</resolved>
                                    <version>1.5.0</version>
                    <version>1.6.0</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.5.5</fixVersion>
                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>1.7.0</fixVersion>
                                    <component>Runtime / Coordination</component>
                    <component>Runtime / Metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16609650" author="pedromrchaves" created="Mon, 10 Sep 2018 18:31:42 +0000"  >&lt;p&gt;I&apos;m currently on version1.5.3 and am experiencing the same issue. I&apos;ve listed all of the available metrics via jmxterm and I get the following output.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$&amp;gt;domains&#160;
#following domains are available&#160;
JMImplementation&#160;
com.sun.management&#160;
java.lang&#160;
java.nio&#160;
java.util.logging&#160;
org.apache.flink.jobmanager.Status.JVM.CPU.Load&#160;
org.apache.flink.jobmanager.Status.JVM.CPU.Time&#160;
org.apache.flink.jobmanager.Status.JVM.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.ClassesLoaded&#160;
org.apache.flink.jobmanager.Status.JVM.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.ClassesUnloaded&#160;
org.apache.flink.jobmanager.Status.JVM.GarbageCollector.PS_MarkSweep.Count&#160;
org.apache.flink.jobmanager.Status.JVM.GarbageCollector.PS_MarkSweep.Time&#160;
org.apache.flink.jobmanager.Status.JVM.GarbageCollector.PS_Scavenge.Count&#160;
org.apache.flink.jobmanager.Status.JVM.GarbageCollector.PS_Scavenge.Time&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Direct.Count&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Direct.MemoryUsed&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Direct.TotalCapacity&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Heap.Committed&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Heap.Max&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Heap.Used&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Mapped.Count&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Mapped.MemoryUsed&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.Mapped.TotalCapacity&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.NonHeap.Committed&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.NonHeap.Max&#160;
org.apache.flink.jobmanager.Status.JVM.Memory.NonHeap.Used&#160;
org.apache.flink.jobmanager.Status.JVM.Threads.Count&#160;
org.apache.flink.jobmanager.job.downtime&#160;
org.apache.flink.jobmanager.job.fullRestarts&#160;
org.apache.flink.jobmanager.job.lastCheckpointAlignmentBuffered&#160;
org.apache.flink.jobmanager.job.lastCheckpointDuration&#160;
org.apache.flink.jobmanager.job.lastCheckpointExternalPath&#160;
org.apache.flink.jobmanager.job.lastCheckpointRestoreTimestamp&#160;
org.apache.flink.jobmanager.job.lastCheckpointSize&#160;
org.apache.flink.jobmanager.job.numberOfCompletedCheckpoints&#160;
org.apache.flink.jobmanager.job.numberOfFailedCheckpoints&#160;
org.apache.flink.jobmanager.job.numberOfInProgressCheckpoints&#160;
org.apache.flink.jobmanager.job.restartingTime&#160;
org.apache.flink.jobmanager.job.totalNumberOfCheckpoints&#160;
org.apache.flink.jobmanager.job.uptime
&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16610023" author="yanghua" created="Tue, 11 Sep 2018 02:16:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=PedroMrChaves&quot; class=&quot;user-hover&quot; rel=&quot;PedroMrChaves&quot;&gt;PedroMrChaves&lt;/a&gt; thanks for details, I am processing this issue. Since Flink 1.5+ some metrics were not been added into JM metrics group.&lt;/p&gt;</comment>
                            <comment id="16616263" author="githubbot" created="Sat, 15 Sep 2018 11:07:02 +0000"  >&lt;p&gt;yanghua opened a new pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702&lt;/a&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;What is the purpose of the change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   &lt;b&gt;This pull request fixed job manager does not report the cluster-level metrics&lt;/b&gt;&lt;/p&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Brief change log&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Fixed job manager does not report the cluster-level metrics&lt;/b&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Verifying this change&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;   This change is already covered by existing tests, such as &lt;b&gt;TestingRestfulGateway#requestMultipleJobsOverview&lt;/b&gt;.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Does this pull request potentially affect one of the following parts:&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Dependencies (does it add or upgrade a dependency): (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The public API, i.e., is any changed class annotated with `@Public(Evolving)`: (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;The serializers: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The runtime per-record code paths (performance sensitive): (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;Anything that affects deployment or recovery: JobManager (and its components), Checkpointing, Yarn/Mesos, ZooKeeper: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
	&lt;li&gt;The S3 file system connector: (yes / *&lt;b&gt;no&lt;/b&gt;* / don&apos;t know)&lt;/li&gt;
&lt;/ul&gt;


&lt;ol&gt;
	&lt;li&gt;
	&lt;ol&gt;
		&lt;li&gt;Documentation&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Does this pull request introduce a new feature? (yes / *&lt;b&gt;no&lt;/b&gt;*)&lt;/li&gt;
	&lt;li&gt;If yes, how is the feature documented? (not applicable / docs / JavaDocs / *&lt;b&gt;not documented&lt;/b&gt;*)&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16618665" author="githubbot" created="Tue, 18 Sep 2018 08:14:18 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-422299024&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-422299024&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @GJL @tillrohrmann @dawidwys  can you review this PR?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619250" author="githubbot" created="Tue, 18 Sep 2018 15:12:38 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r218472914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r218472914&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/webmonitor/RestfulGateway.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -111,6 +112,14 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	CompletableFuture&amp;lt;ClusterOverview&amp;gt; requestClusterOverview(@RpcTimeout Time timeout);&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * Requests the all the jobs overview.&lt;br/&gt;
+	 *&lt;br/&gt;
+	 * @param timeout for the asynchronous operation&lt;br/&gt;
+	 * @return Future containing the status overview&lt;br/&gt;
+	 */&lt;br/&gt;
+	CompletableFuture&amp;lt;JobsOverview&amp;gt; requestMultipleJobsOverview(Time timeout);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Add `@RpcTimeout`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619251" author="githubbot" created="Tue, 18 Sep 2018 15:12:38 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r218461569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r218461569&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -467,6 +467,22 @@ private JobManagerRunner startJobManagerRunner(JobManagerRunner jobManagerRunner&lt;br/&gt;
 			});&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	@Override&lt;br/&gt;
+	public CompletableFuture&amp;lt;JobsOverview&amp;gt; requestMultipleJobsOverview(Time timeout) {&lt;br/&gt;
+		final List&amp;lt;CompletableFuture&amp;lt;Optional&amp;lt;JobStatus&amp;gt;&amp;gt;&amp;gt; optionalJobInformation = queryJobMastersForInformation(&lt;br/&gt;
+			(JobMasterGateway jobMasterGateway) -&amp;gt; jobMasterGateway.requestJobStatus(timeout));&lt;br/&gt;
+&lt;br/&gt;
+		CompletableFuture&amp;lt;Collection&amp;lt;Optional&amp;lt;JobStatus&amp;gt;&amp;gt;&amp;gt; allOptionalJobsFuture = FutureUtils.combineAll(optionalJobInformation);&lt;br/&gt;
+&lt;br/&gt;
+		CompletableFuture&amp;lt;Collection&amp;lt;JobStatus&amp;gt;&amp;gt; allJobsFuture = allOptionalJobsFuture.thenApply(this::flattenOptionalCollection);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I would simplify as&lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   		return allOptionalJobsFuture&lt;br/&gt;
   			.thenApply(this::flattenOptionalCollection)&lt;br/&gt;
   			.thenApply(JobsOverview::create);&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619252" author="githubbot" created="Tue, 18 Sep 2018 15:12:39 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r218464627&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r218464627&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/ClusterEntrypoint.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -554,6 +559,63 @@ private Configuration generateClusterConfiguration(Configuration configuration)&lt;br/&gt;
 		return resultConfiguration;&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void instantiateJobManagerOverviewMetrics(MetricGroup jobManagerMetricGroup) {&lt;br/&gt;
+		long defaultTimeoutValue = configuration.getLong(RestOptions.CONNECTION_TIMEOUT);&lt;br/&gt;
+		Time defaultRequestTimeout = Time.milliseconds(defaultTimeoutValue);&lt;br/&gt;
+&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&quot;taskSlotsAvailable&quot;, () -&amp;gt; {&lt;br/&gt;
+			try {&lt;br/&gt;
+				return new Long(&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I would prefer&lt;br/&gt;
   `return (long) resourceManager.requestResourceOverview(defaultRequestTimeout).get().getNumberTaskManagers();`. There are more instances of this case below.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619253" author="githubbot" created="Tue, 18 Sep 2018 15:12:39 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r218473613&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r218473613&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/webmonitor/TestingDispatcherGateway.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -70,25 +71,26 @@ public TestingDispatcherGateway() {&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	public TestingDispatcherGateway(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String address,&lt;/li&gt;
	&lt;li&gt;String hostname,&lt;/li&gt;
	&lt;li&gt;String restAddress,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;Acknowledge&amp;gt;&amp;gt; cancelJobFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;Acknowledge&amp;gt;&amp;gt; stopJobFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;? extends AccessExecutionGraph&amp;gt;&amp;gt; requestJobFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;JobResult&amp;gt;&amp;gt; requestJobResultFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;JobStatus&amp;gt;&amp;gt; requestJobStatusFunction,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;MultipleJobsDetails&amp;gt;&amp;gt; requestMultipleJobDetailsSupplier,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;ClusterOverview&amp;gt;&amp;gt; requestClusterOverviewSupplier,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;Collection&amp;lt;String&amp;gt;&amp;gt;&amp;gt; requestMetricQueryServicePathsSupplier,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;Collection&amp;lt;Tuple2&amp;lt;ResourceID, String&amp;gt;&amp;gt;&amp;gt;&amp;gt; requestTaskManagerMetricQueryServicePathsSupplier,&lt;/li&gt;
	&lt;li&gt;BiFunction&amp;lt;JobID, JobVertexID, CompletableFuture&amp;lt;OperatorBackPressureStatsResponse&amp;gt;&amp;gt; requestOperatorBackPressureStatsFunction,&lt;/li&gt;
	&lt;li&gt;BiFunction&amp;lt;JobID, String, CompletableFuture&amp;lt;String&amp;gt;&amp;gt; triggerSavepointFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobGraph, CompletableFuture&amp;lt;Acknowledge&amp;gt;&amp;gt; submitFunction,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;Collection&amp;lt;JobID&amp;gt;&amp;gt;&amp;gt; listFunction,&lt;/li&gt;
	&lt;li&gt;int blobServerPort,&lt;/li&gt;
	&lt;li&gt;DispatcherId fencingToken,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;ArchivedExecutionGraph&amp;gt;&amp;gt; requestArchivedJobFunction) {&lt;br/&gt;
+		String address,&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Unrelated formatting changes.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619254" author="githubbot" created="Tue, 18 Sep 2018 15:12:39 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r218473753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r218473753&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/webmonitor/TestingRestfulGateway.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -100,24 +104,26 @@ public TestingRestfulGateway() &lt;/p&gt;
{
 			DEFAULT_REQUEST_METRIC_QUERY_SERVICE_PATHS_SUPPLIER,
 			DEFAULT_REQUEST_TASK_MANAGER_METRIC_QUERY_SERVICE_PATHS_SUPPLIER,
 			DEFAULT_REQUEST_OPERATOR_BACK_PRESSURE_STATS_SUPPLIER,
-			DEFAULT_TRIGGER_SAVEPOINT_FUNCTION);
+			DEFAULT_TRIGGER_SAVEPOINT_FUNCTION,
+			DEFAULT_REQUEST_MULTIPLE_JOBS_OVERVIEW_SUPPLIER);
 	}

&lt;p&gt; 	public TestingRestfulGateway(&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String address,&lt;/li&gt;
	&lt;li&gt;String hostname,&lt;/li&gt;
	&lt;li&gt;String restAddress,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;Acknowledge&amp;gt;&amp;gt; cancelJobFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;Acknowledge&amp;gt;&amp;gt; stopJobFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;? extends AccessExecutionGraph&amp;gt;&amp;gt; requestJobFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;JobResult&amp;gt;&amp;gt; requestJobResultFunction,&lt;/li&gt;
	&lt;li&gt;Function&amp;lt;JobID, CompletableFuture&amp;lt;JobStatus&amp;gt;&amp;gt; requestJobStatusFunction,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;MultipleJobsDetails&amp;gt;&amp;gt; requestMultipleJobDetailsSupplier,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;ClusterOverview&amp;gt;&amp;gt; requestClusterOverviewSupplier,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;Collection&amp;lt;String&amp;gt;&amp;gt;&amp;gt; requestMetricQueryServicePathsSupplier,&lt;/li&gt;
	&lt;li&gt;Supplier&amp;lt;CompletableFuture&amp;lt;Collection&amp;lt;Tuple2&amp;lt;ResourceID, String&amp;gt;&amp;gt;&amp;gt;&amp;gt; requestTaskManagerMetricQueryServicePathsSupplier,&lt;/li&gt;
	&lt;li&gt;BiFunction&amp;lt;JobID, JobVertexID, CompletableFuture&amp;lt;OperatorBackPressureStatsResponse&amp;gt;&amp;gt; requestOperatorBackPressureStatsFunction,&lt;/li&gt;
	&lt;li&gt;BiFunction&amp;lt;JobID, String, CompletableFuture&amp;lt;String&amp;gt;&amp;gt; triggerSavepointFunction) {&lt;br/&gt;
+		String address,&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   Unrelated formatting changes.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619255" author="githubbot" created="Tue, 18 Sep 2018 15:12:39 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r218463063&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r218463063&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/ClusterEntrypoint.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -554,6 +559,63 @@ private Configuration generateClusterConfiguration(Configuration configuration)&lt;br/&gt;
 		return resultConfiguration;&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void instantiateJobManagerOverviewMetrics(MetricGroup jobManagerMetricGroup) {&lt;br/&gt;
+		long defaultTimeoutValue = configuration.getLong(RestOptions.CONNECTION_TIMEOUT);&lt;br/&gt;
+		Time defaultRequestTimeout = Time.milliseconds(defaultTimeoutValue);&lt;br/&gt;
+&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&quot;taskSlotsAvailable&quot;, () -&amp;gt; {&lt;br/&gt;
+			try &lt;/p&gt;
{
+				return new Long(
+					resourceManager.requestResourceOverview(defaultRequestTimeout).get().getNumberFreeSlots()
+				);
+			}
&lt;p&gt; catch (InterruptedException e) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   We should be nice and reset the interrupted flag whenever we catch the `InterruptedException` via `Thread.currentThread().interrupt()`. Please note that there are more instances of this further down.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619256" author="githubbot" created="Tue, 18 Sep 2018 15:12:39 +0000"  >&lt;p&gt;StefanRRichter commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r218462636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r218462636&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/webmonitor/RestfulGateway.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -111,6 +112,14 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	CompletableFuture&amp;lt;ClusterOverview&amp;gt; requestClusterOverview(@RpcTimeout Time timeout);&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * Requests the all the jobs overview.&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I suggest somethiing like &quot;Requests an overview for all jobs&quot;, and then why not also name it `requestOverviewForAllJobs`?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619304" author="githubbot" created="Tue, 18 Sep 2018 15:42:23 +0000"  >&lt;p&gt;yanghua commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r218486848&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r218486848&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/webmonitor/RestfulGateway.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -111,6 +112,14 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	CompletableFuture&amp;lt;ClusterOverview&amp;gt; requestClusterOverview(@RpcTimeout Time timeout);&lt;/p&gt;

&lt;p&gt;+	/**&lt;br/&gt;
+	 * Requests the all the jobs overview.&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Because I saw the implementation of `requestClusterOverview ` combines the completed jobs&apos; overview, but this method would not contains so I refer to `requestMultipleJobDetails`. All right, it seems there is no problem about the &quot;all&quot;. Will change it.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16619369" author="githubbot" created="Tue, 18 Sep 2018 16:40:41 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-422464334&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-422464334&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @StefanRRichter thanks for your review suggestion, I have refactored the PR. I have tried to test `requestOverviewForAllJobs` in `DispatcherTest`, but always throw akka timeout : &lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   Caused by: akka.pattern.AskTimeoutException: Ask timed out on &lt;a href=&quot;#-798214439]&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Actor[akka://flink/user/dispatcher_testJobRecovery#-798214439]&lt;/a&gt; after &lt;span class=&quot;error&quot;&gt;&amp;#91;10000 ms&amp;#93;&lt;/span&gt;. Sender&lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt; sent message of type &quot;org.apache.flink.runtime.rpc.messages.LocalFencedMessage&quot;.&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   I replace the method with `requestClusterOverview`, the result is the same exception. So I do not know how to test it. It seems there is not a case can be refer to. So can you give a little hint? thanks.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16622330" author="githubbot" created="Thu, 20 Sep 2018 16:50:48 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-423254893&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-423254893&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @StefanRRichter I have tried to add a test case for reporting job manager metrics, can you review this?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16625517" author="githubbot" created="Mon, 24 Sep 2018 08:23:34 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r219757762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r219757762&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-metrics/flink-metrics-slf4j/src/test/java/org/apache/flink/metrics/slf4j/JobManagerMetricsTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,106 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.metrics.slf4j;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.ConfigConstants;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.MetricRegistryConfiguration;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.MetricRegistryImpl;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
+import org.apache.flink.util.TestLogger;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertTrue;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * The test class for metrics report by job manager.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsTest extends TestLogger {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Why are we testing runtime functionality in the slf4j module? This should be tested in flink-runtime with a simple reporter.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16625525" author="githubbot" created="Mon, 24 Sep 2018 08:32:01 +0000"  >&lt;p&gt;yanghua commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r219760167&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r219760167&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-metrics/flink-metrics-slf4j/src/test/java/org/apache/flink/metrics/slf4j/JobManagerMetricsTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,106 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.metrics.slf4j;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.ConfigConstants;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.MetricRegistryConfiguration;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.MetricRegistryImpl;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
+import org.apache.flink.util.TestLogger;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertTrue;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * The test class for metrics report by job manager.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsTest extends TestLogger {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Oh chesnay I haven&apos;t seen you for a few days. I have tried testing `requestOverviewForAllJobs`, but it didn&apos;t work. I didn&apos;t find a sample for testing `requestClusterOverview` for reference. So, I just tried to test the indicator itself separately. Can you give me some hints or any way to refer to it?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16627163" author="githubbot" created="Tue, 25 Sep 2018 11:06:13 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-424300796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-424300796&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @zentol updated the PR.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16631621" author="githubbot" created="Fri, 28 Sep 2018 09:41:44 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-425382053&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-425382053&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @StefanRRichter can you review it?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16633862" author="githubbot" created="Mon, 1 Oct 2018 11:18:58 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r221573282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r221573282&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,134 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.ConfigConstants;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * The test class for metrics report by job manager.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsTest {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This isn&apos;t testing anything.&lt;/p&gt;

&lt;p&gt;   What we want to ensure is that these metrics don&apos;t disappear again, and optionally that the values are correct. For this you have to actually start runtime components, which could be done with a `MiniCluster` (that is also configured to use the TestReporter) and have the reporter search for the desired metrics.&lt;br/&gt;
   The `SystemResourcesMetricsITCase` may be a useful reference&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16633863" author="githubbot" created="Mon, 1 Oct 2018 11:19:13 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r221573282&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r221573282&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,134 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.ConfigConstants;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * The test class for metrics report by job manager.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsTest {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This isn&apos;t testing anything.&lt;/p&gt;

&lt;p&gt;   What we want to ensure is that these metrics don&apos;t disappear again, and optionally that the values are correct. For this you have to actually start runtime components, which could be done with a `MiniCluster` (that is also configured to use the TestReporter) and have the reporter search for the desired metrics.&lt;br/&gt;
   The `SystemResourcesMetricsITCase` may be a useful reference.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16634174" author="githubbot" created="Mon, 1 Oct 2018 15:08:48 +0000"  >&lt;p&gt;yanghua commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r221645630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r221645630&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,134 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.ConfigConstants;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.AfterClass;&lt;br/&gt;
+import org.junit.BeforeClass;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * The test class for metrics report by job manager.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsTest {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   OK. Thanks, I will try it.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642082" author="githubbot" created="Mon, 8 Oct 2018 16:18:06 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-427895003&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-427895003&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @zentol I have changed the test case, please review it again, thanks.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642333" author="githubbot" created="Mon, 8 Oct 2018 19:13:49 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223467705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223467705&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,221 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.client.program.MiniClusterClient;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.execution.Environment;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobGraph;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobStatus;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobVertex;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.tasks.AbstractInvokable;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Assume;&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+import java.util.concurrent.CountDownLatch;&lt;br/&gt;
+import java.util.concurrent.ExecutionException;&lt;br/&gt;
+import java.util.concurrent.TimeUnit;&lt;br/&gt;
+&lt;br/&gt;
+import static org.apache.flink.configuration.MetricOptions.REPORTERS_LIST;&lt;br/&gt;
+import static org.hamcrest.MatcherAssert.assertThat;&lt;br/&gt;
+import static org.hamcrest.Matchers.equalTo;&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_AVAILABLE = &quot;taskSlotsAvailable&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_TOTAL = &quot;taskSlotsTotal&quot;;&lt;br/&gt;
+	private static final String NUM_REGISTERED_TASK_MANAGERS = &quot;numRegisteredTaskManagers&quot;;&lt;br/&gt;
+	private static final String NUM_RUNNING_JOBS = &quot;numRunningJobs&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static CountDownLatch invokeLatch;&lt;br/&gt;
+&lt;br/&gt;
+	private MiniClusterClient clusterClient;&lt;br/&gt;
+	private JobGraph jobGraph;&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception {&lt;br/&gt;
+		invokeLatch = new CountDownLatch(1);&lt;br/&gt;
+&lt;br/&gt;
+		Assume.assumeTrue(&lt;br/&gt;
+			&quot;ClusterClient is not an instance of MiniClusterClient&quot;,&lt;br/&gt;
+			MINI_CLUSTER_RESOURCE.getClusterClient() instanceof MiniClusterClient);&lt;br/&gt;
+&lt;br/&gt;
+		clusterClient = (MiniClusterClient) MINI_CLUSTER_RESOURCE.getClusterClient();&lt;br/&gt;
+		clusterClient.setDetached(true);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   You could simplify this section by simple defining a job that has a blocking UDF and executing it in a separate thread.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642334" author="githubbot" created="Mon, 8 Oct 2018 19:13:49 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223469702&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223469702&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,221 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.client.program.MiniClusterClient;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.execution.Environment;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobGraph;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobStatus;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobVertex;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.tasks.AbstractInvokable;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Assume;&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+import java.util.concurrent.CountDownLatch;&lt;br/&gt;
+import java.util.concurrent.ExecutionException;&lt;br/&gt;
+import java.util.concurrent.TimeUnit;&lt;br/&gt;
+&lt;br/&gt;
+import static org.apache.flink.configuration.MetricOptions.REPORTERS_LIST;&lt;br/&gt;
+import static org.hamcrest.MatcherAssert.assertThat;&lt;br/&gt;
+import static org.hamcrest.Matchers.equalTo;&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_AVAILABLE = &quot;taskSlotsAvailable&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_TOTAL = &quot;taskSlotsTotal&quot;;&lt;br/&gt;
+	private static final String NUM_REGISTERED_TASK_MANAGERS = &quot;numRegisteredTaskManagers&quot;;&lt;br/&gt;
+	private static final String NUM_RUNNING_JOBS = &quot;numRunningJobs&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static CountDownLatch invokeLatch;&lt;br/&gt;
+&lt;br/&gt;
+	private MiniClusterClient clusterClient;&lt;br/&gt;
+	private JobGraph jobGraph;&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception &lt;/p&gt;
{
+		invokeLatch = new CountDownLatch(1);
+
+		Assume.assumeTrue(
+			&quot;ClusterClient is not an instance of MiniClusterClient&quot;,
+			MINI_CLUSTER_RESOURCE.getClusterClient() instanceof MiniClusterClient);
+
+		clusterClient = (MiniClusterClient) MINI_CLUSTER_RESOURCE.getClusterClient();
+		clusterClient.setDetached(true);
+
+		jobGraph = new JobGraph();
+
+		final JobVertex vertex = new JobVertex(&quot;testVertex&quot;);
+		vertex.setInvokableClass(NoOpBlockingInvokable.class);
+		jobGraph.addVertex(vertex);
+
+		clusterClient.submitJob(jobGraph, ClassLoader.getSystemClassLoader());
+		invokeLatch.await(60, TimeUnit.SECONDS);
+		waitForJob();
+	}
&lt;p&gt;+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testJobManagerMetrics() throws Exception {&lt;br/&gt;
+		assertEquals(1, TestReporter.OPENED_REPORTERS.size());&lt;br/&gt;
+		TestReporter reporter = TestReporter.OPENED_REPORTERS.iterator().next();&lt;br/&gt;
+&lt;br/&gt;
+		List&amp;lt;String&amp;gt; expectedPatterns = getExpectedPatterns();&lt;br/&gt;
+&lt;br/&gt;
+		Collection&amp;lt;String&amp;gt; gaugeNames = reporter.getGauges().values();&lt;br/&gt;
+&lt;br/&gt;
+		for (String expectedPattern : expectedPatterns) {&lt;br/&gt;
+			boolean found = false;&lt;br/&gt;
+			for (String gaugeName : gaugeNames) {&lt;br/&gt;
+				if (gaugeName.matches(expectedPattern)) &lt;/p&gt;
{
+					found = true;
+				}
&lt;p&gt;+			}&lt;br/&gt;
+			if (!found) &lt;/p&gt;
{
+				fail(String.format(&quot;Failed to find gauge [%s] in registered gauges [%s]&quot;,
+					expectedPattern, gaugeNames));
+			}
&lt;p&gt;+		}&lt;br/&gt;
+&lt;br/&gt;
+		for (Map.Entry&amp;lt;Gauge&amp;lt;?&amp;gt;, String&amp;gt; entry : reporter.getGauges().entrySet()) {&lt;br/&gt;
+			if (entry.getValue().contains(TASK_SLOTS_AVAILABLE)) &lt;/p&gt;
{
+				assertEquals(0L, entry.getKey().getValue());
+			}
&lt;p&gt; else if (entry.getValue().contains(TASK_SLOTS_TOTAL)) &lt;/p&gt;
{
+				assertEquals(1L, entry.getKey().getValue());
+			} else if (entry.getValue().contains(NUM_REGISTERED_TASK_MANAGERS)) {+				assertEquals(1L, entry.getKey().getValue());+			}
&lt;p&gt; else if (entry.getValue().contains(NUM_RUNNING_JOBS)) &lt;/p&gt;
{
+				assertEquals(1L, entry.getKey().getValue());
+			}
&lt;p&gt;+		}&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private static Configuration getConfiguration() &lt;/p&gt;
{
+		Configuration configuration = new Configuration();
+		configuration.setString(REPORTERS_LIST, &quot;test_reporter&quot;);
+		configuration.setString(&quot;metrics.reporter.test_reporter.class&quot;, TestReporter.class.getName());
+		return configuration;
+	}
&lt;p&gt;+&lt;br/&gt;
+	private void waitForJob() throws Exception {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This method should be called `waitForJobRunning()`; however this entire logic can be implemented more nicely with a &lt;span class=&quot;error&quot;&gt;&amp;#91;BlockerSync&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/flink/blob/master/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/core/testutils/BlockerSync.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/blob/master/flink-test-utils-parent/flink-test-utils-junit/src/main/java/org/apache/flink/core/testutils/BlockerSync.java&lt;/a&gt;) anyway. The UDF would wait until the test thread calls `block`, and then you reverse this for unblocking the thread.&lt;/p&gt;

&lt;p&gt;   This method could then be removed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642335" author="githubbot" created="Mon, 8 Oct 2018 19:13:49 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223466964&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223466964&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -909,6 +926,70 @@ private void clearDispatcherState() &lt;/p&gt;
{
 		terminateJobManagerRunners();
 	}

&lt;p&gt;+	private void instantiateJobManagerOverviewMetrics(MetricGroup jobManagerMetricGroup) {&lt;br/&gt;
+		long defaultTimeoutValue = configuration.getLong(RestOptions.CONNECTION_TIMEOUT);&lt;br/&gt;
+		Time defaultRequestTimeout = Time.milliseconds(defaultTimeoutValue);&lt;br/&gt;
+&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&quot;taskSlotsAvailable&quot;, () -&amp;gt; {&lt;br/&gt;
+			try &lt;/p&gt;
{
+				return (long) resourceManagerGateway
+					.requestResourceOverview(defaultRequestTimeout)
+					.get()
+					.getNumberFreeSlots();
+			}
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
+				Thread.currentThread().interrupt();
+			} catch (ExecutionException e) {
+				log.error(&quot;Request resource overview occurs exception.&quot;, e);
+			}&lt;br/&gt;
+&lt;br/&gt;
+			return 0L;&lt;br/&gt;
+		});&lt;br/&gt;
+&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&quot;taskSlotsTotal&quot;, () -&amp;gt; {&lt;br/&gt;
+			try {
+				return (long) resourceManagerGateway
+					.requestResourceOverview(defaultRequestTimeout)
+					.get()
+					.getNumberRegisteredSlots();
+			} catch (InterruptedException e) {+				Thread.currentThread().interrupt();+			}
&lt;p&gt; catch (ExecutionException e) &lt;/p&gt;
{
+				log.error(&quot;Request resource overview occurs exception.&quot;, e);
+			}&lt;br/&gt;
+&lt;br/&gt;
+			return 0L;&lt;br/&gt;
+		});&lt;br/&gt;
+&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&quot;numRegisteredTaskManagers&quot;, () -&amp;gt; {&lt;br/&gt;
+			try {
+				return (long) resourceManagerGateway
+					.requestResourceOverview(defaultRequestTimeout)
+					.get()
+					.getNumberTaskManagers();
+			} catch (InterruptedException e) {
+				Thread.currentThread().interrupt();
+			} catch (ExecutionException e) {+				log.error(&quot;Request resource overview occurs exception.&quot;, e);+			}
&lt;p&gt;+&lt;br/&gt;
+			return 0L;&lt;br/&gt;
+		});&lt;br/&gt;
+&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&quot;numRunningJobs&quot;, () -&amp;gt; {&lt;br/&gt;
+			try {&lt;br/&gt;
+				return (long) requestOverviewForAllJobs(defaultRequestTimeout)&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This results in a wave of RPC calls to every single JM. Would it not be feasible to simple count the number of job IDs contained in `jobManagerRunnerFutures`?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642336" author="githubbot" created="Mon, 8 Oct 2018 19:13:50 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223465173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223465173&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -909,6 +926,70 @@ private void clearDispatcherState() &lt;/p&gt;
{
 		terminateJobManagerRunners();
 	}

&lt;p&gt;+	private void instantiateJobManagerOverviewMetrics(MetricGroup jobManagerMetricGroup) {&lt;br/&gt;
+		long defaultTimeoutValue = configuration.getLong(RestOptions.CONNECTION_TIMEOUT);&lt;br/&gt;
+		Time defaultRequestTimeout = Time.milliseconds(defaultTimeoutValue);&lt;br/&gt;
+&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&quot;taskSlotsAvailable&quot;, () -&amp;gt; {&lt;br/&gt;
+			try {&lt;br/&gt;
+				return (long) resourceManagerGateway&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This method results in 3 separate RPC calls being made every time metrics are being requested. If the dispatcher cannot reasonably provide this information then they should be exposed at the resource manager instead.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642337" author="githubbot" created="Mon, 8 Oct 2018 19:13:50 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223466071&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223466071&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -909,6 +926,70 @@ private void clearDispatcherState() &lt;/p&gt;
{
 		terminateJobManagerRunners();
 	}

&lt;p&gt;+	private void instantiateJobManagerOverviewMetrics(MetricGroup jobManagerMetricGroup) {&lt;br/&gt;
+		long defaultTimeoutValue = configuration.getLong(RestOptions.CONNECTION_TIMEOUT);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This is not an appropriate timeout as this is completely unrelated to the REST API.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642338" author="githubbot" created="Mon, 8 Oct 2018 19:13:50 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223468630&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223468630&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,221 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.client.program.MiniClusterClient;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.execution.Environment;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobGraph;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobStatus;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobVertex;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.tasks.AbstractInvokable;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Assume;&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+import java.util.concurrent.CountDownLatch;&lt;br/&gt;
+import java.util.concurrent.ExecutionException;&lt;br/&gt;
+import java.util.concurrent.TimeUnit;&lt;br/&gt;
+&lt;br/&gt;
+import static org.apache.flink.configuration.MetricOptions.REPORTERS_LIST;&lt;br/&gt;
+import static org.hamcrest.MatcherAssert.assertThat;&lt;br/&gt;
+import static org.hamcrest.Matchers.equalTo;&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_AVAILABLE = &quot;taskSlotsAvailable&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_TOTAL = &quot;taskSlotsTotal&quot;;&lt;br/&gt;
+	private static final String NUM_REGISTERED_TASK_MANAGERS = &quot;numRegisteredTaskManagers&quot;;&lt;br/&gt;
+	private static final String NUM_RUNNING_JOBS = &quot;numRunningJobs&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static CountDownLatch invokeLatch;&lt;br/&gt;
+&lt;br/&gt;
+	private MiniClusterClient clusterClient;&lt;br/&gt;
+	private JobGraph jobGraph;&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception &lt;/p&gt;
{
+		invokeLatch = new CountDownLatch(1);
+
+		Assume.assumeTrue(
+			&quot;ClusterClient is not an instance of MiniClusterClient&quot;,
+			MINI_CLUSTER_RESOURCE.getClusterClient() instanceof MiniClusterClient);
+
+		clusterClient = (MiniClusterClient) MINI_CLUSTER_RESOURCE.getClusterClient();
+		clusterClient.setDetached(true);
+
+		jobGraph = new JobGraph();
+
+		final JobVertex vertex = new JobVertex(&quot;testVertex&quot;);
+		vertex.setInvokableClass(NoOpBlockingInvokable.class);
+		jobGraph.addVertex(vertex);
+
+		clusterClient.submitJob(jobGraph, ClassLoader.getSystemClassLoader());
+		invokeLatch.await(60, TimeUnit.SECONDS);
+		waitForJob();
+	}
&lt;p&gt;+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testJobManagerMetrics() throws Exception {&lt;br/&gt;
+		assertEquals(1, TestReporter.OPENED_REPORTERS.size());&lt;br/&gt;
+		TestReporter reporter = TestReporter.OPENED_REPORTERS.iterator().next();&lt;br/&gt;
+&lt;br/&gt;
+		List&amp;lt;String&amp;gt; expectedPatterns = getExpectedPatterns();&lt;br/&gt;
+&lt;br/&gt;
+		Collection&amp;lt;String&amp;gt; gaugeNames = reporter.getGauges().values();&lt;br/&gt;
+&lt;br/&gt;
+		for (String expectedPattern : expectedPatterns) {&lt;br/&gt;
+			boolean found = false;&lt;br/&gt;
+			for (String gaugeName : gaugeNames) {&lt;br/&gt;
+				if (gaugeName.matches(expectedPattern)) &lt;/p&gt;
{
+					found = true;
+				}
&lt;p&gt;+			}&lt;br/&gt;
+			if (!found) &lt;/p&gt;
{
+				fail(String.format(&quot;Failed to find gauge [%s] in registered gauges [%s]&quot;,
+					expectedPattern, gaugeNames));
+			}
&lt;p&gt;+		}&lt;br/&gt;
+&lt;br/&gt;
+		for (Map.Entry&amp;lt;Gauge&amp;lt;?&amp;gt;, String&amp;gt; entry : reporter.getGauges().entrySet()) {&lt;br/&gt;
+			if (entry.getValue().contains(TASK_SLOTS_AVAILABLE)) &lt;/p&gt;
{
+				assertEquals(0L, entry.getKey().getValue());
+			}
&lt;p&gt; else if (entry.getValue().contains(TASK_SLOTS_TOTAL)) &lt;/p&gt;
{
+				assertEquals(1L, entry.getKey().getValue());
+			} else if (entry.getValue().contains(NUM_REGISTERED_TASK_MANAGERS)) {+				assertEquals(1L, entry.getKey().getValue());+			}
&lt;p&gt; else if (entry.getValue().contains(NUM_RUNNING_JOBS)) &lt;/p&gt;
{
+				assertEquals(1L, entry.getKey().getValue());
+			}
&lt;p&gt;+		}&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private static Configuration getConfiguration() &lt;/p&gt;
{
+		Configuration configuration = new Configuration();
+		configuration.setString(REPORTERS_LIST, &quot;test_reporter&quot;);
+		configuration.setString(&quot;metrics.reporter.test_reporter.class&quot;, TestReporter.class.getName());
+		return configuration;
+	}
&lt;p&gt;+&lt;br/&gt;
+	private void waitForJob() throws Exception {&lt;br/&gt;
+		for (int i = 0; i &amp;lt; 60; i++) {&lt;br/&gt;
+			try {&lt;br/&gt;
+				final JobStatus jobStatus = clusterClient.getJobStatus(jobGraph.getJobID()).get(60, TimeUnit.SECONDS);&lt;br/&gt;
+				assertThat(jobStatus.isGloballyTerminalState(), equalTo(false));&lt;br/&gt;
+				if (jobStatus == JobStatus.RUNNING) &lt;/p&gt;
{
+					return;
+				}
&lt;p&gt;+			} catch (ExecutionException ignored) &lt;/p&gt;
{
+				// JobManagerRunner is not yet registered in Dispatcher
+			}
&lt;p&gt;+			Thread.sleep(1000);&lt;br/&gt;
+		}&lt;br/&gt;
+		throw new AssertionError(&quot;Job did not become running within timeout.&quot;);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   use `fail()` instead&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642339" author="githubbot" created="Mon, 8 Oct 2018 19:13:50 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223468454&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223468454&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,221 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.client.program.MiniClusterClient;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.execution.Environment;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobGraph;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobStatus;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobVertex;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.tasks.AbstractInvokable;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Assume;&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+import java.util.concurrent.CountDownLatch;&lt;br/&gt;
+import java.util.concurrent.ExecutionException;&lt;br/&gt;
+import java.util.concurrent.TimeUnit;&lt;br/&gt;
+&lt;br/&gt;
+import static org.apache.flink.configuration.MetricOptions.REPORTERS_LIST;&lt;br/&gt;
+import static org.hamcrest.MatcherAssert.assertThat;&lt;br/&gt;
+import static org.hamcrest.Matchers.equalTo;&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_AVAILABLE = &quot;taskSlotsAvailable&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_TOTAL = &quot;taskSlotsTotal&quot;;&lt;br/&gt;
+	private static final String NUM_REGISTERED_TASK_MANAGERS = &quot;numRegisteredTaskManagers&quot;;&lt;br/&gt;
+	private static final String NUM_RUNNING_JOBS = &quot;numRunningJobs&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static CountDownLatch invokeLatch;&lt;br/&gt;
+&lt;br/&gt;
+	private MiniClusterClient clusterClient;&lt;br/&gt;
+	private JobGraph jobGraph;&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception &lt;/p&gt;
{
+		invokeLatch = new CountDownLatch(1);
+
+		Assume.assumeTrue(
+			&quot;ClusterClient is not an instance of MiniClusterClient&quot;,
+			MINI_CLUSTER_RESOURCE.getClusterClient() instanceof MiniClusterClient);
+
+		clusterClient = (MiniClusterClient) MINI_CLUSTER_RESOURCE.getClusterClient();
+		clusterClient.setDetached(true);
+
+		jobGraph = new JobGraph();
+
+		final JobVertex vertex = new JobVertex(&quot;testVertex&quot;);
+		vertex.setInvokableClass(NoOpBlockingInvokable.class);
+		jobGraph.addVertex(vertex);
+
+		clusterClient.submitJob(jobGraph, ClassLoader.getSystemClassLoader());
+		invokeLatch.await(60, TimeUnit.SECONDS);
+		waitForJob();
+	}
&lt;p&gt;+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testJobManagerMetrics() throws Exception {&lt;br/&gt;
+		assertEquals(1, TestReporter.OPENED_REPORTERS.size());&lt;br/&gt;
+		TestReporter reporter = TestReporter.OPENED_REPORTERS.iterator().next();&lt;br/&gt;
+&lt;br/&gt;
+		List&amp;lt;String&amp;gt; expectedPatterns = getExpectedPatterns();&lt;br/&gt;
+&lt;br/&gt;
+		Collection&amp;lt;String&amp;gt; gaugeNames = reporter.getGauges().values();&lt;br/&gt;
+&lt;br/&gt;
+		for (String expectedPattern : expectedPatterns) {&lt;br/&gt;
+			boolean found = false;&lt;br/&gt;
+			for (String gaugeName : gaugeNames) {&lt;br/&gt;
+				if (gaugeName.matches(expectedPattern)) &lt;/p&gt;
{
+					found = true;
+				}
&lt;p&gt;+			}&lt;br/&gt;
+			if (!found) &lt;/p&gt;
{
+				fail(String.format(&quot;Failed to find gauge [%s] in registered gauges [%s]&quot;,
+					expectedPattern, gaugeNames));
+			}
&lt;p&gt;+		}&lt;br/&gt;
+&lt;br/&gt;
+		for (Map.Entry&amp;lt;Gauge&amp;lt;?&amp;gt;, String&amp;gt; entry : reporter.getGauges().entrySet()) {&lt;br/&gt;
+			if (entry.getValue().contains(TASK_SLOTS_AVAILABLE)) &lt;/p&gt;
{
+				assertEquals(0L, entry.getKey().getValue());
+			}
&lt;p&gt; else if (entry.getValue().contains(TASK_SLOTS_TOTAL)) &lt;/p&gt;
{
+				assertEquals(1L, entry.getKey().getValue());
+			} else if (entry.getValue().contains(NUM_REGISTERED_TASK_MANAGERS)) {+				assertEquals(1L, entry.getKey().getValue());+			}
&lt;p&gt; else if (entry.getValue().contains(NUM_RUNNING_JOBS)) &lt;/p&gt;
{
+				assertEquals(1L, entry.getKey().getValue());
+			}
&lt;p&gt;+		}&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private static Configuration getConfiguration() {&lt;br/&gt;
+		Configuration configuration = new Configuration();&lt;br/&gt;
+		configuration.setString(REPORTERS_LIST, &quot;test_reporter&quot;);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   this configuration setting is not necessary anymore, reporter names are automatically detected&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16642854" author="githubbot" created="Tue, 9 Oct 2018 06:14:17 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428072796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428072796&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @zentol Thanks for your suggestion, I have updated the implementation, please review it again.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643065" author="githubbot" created="Tue, 9 Oct 2018 09:57:20 +0000"  >&lt;p&gt;zentol commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428133115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428133115&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This looks a lot better, the majority of my comments are for minor things, but we&apos;ve now run into a concurrency issue. All `RpcEndpoints` (i.e. DIspatcher, ResourceManager, etc) assume to run in a single thread (the &quot;main-thread&quot;), but metrics are accessed by another one. We have to either make sure that all operations are safe in this scenario, or &lt;em&gt;somehow&lt;/em&gt; (@tillrohrmann?) defer the access to the main-thread.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643067" author="githubbot" created="Tue, 9 Oct 2018 09:57:35 +0000"  >&lt;p&gt;zentol edited a comment on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428133115&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428133115&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   This looks a lot better, the majority of my comments are for minor things, but we&apos;ve now run into a concurrency issue. All `RpcEndpoints` (i.e. DIspatcher, ResourceManager, etc) assume to run in a single thread (the &quot;main-thread&quot;), but metrics are accessed by a separate one. We have to either make sure that all operations are safe in this scenario, or &lt;em&gt;somehow&lt;/em&gt; (@tillrohrmann?) defer the access to the main-thread.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643137" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223627773&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223627773&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -909,6 +913,11 @@ private void clearDispatcherState() &lt;/p&gt;
{
 		terminateJobManagerRunners();
 	}

&lt;p&gt;+	private void registerJobSpecificMetrics(MetricGroup jobManagerMetricGroup) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   the name is slightly misleading; I would expect this to register metrics about a particular job(s). It would be fine to call this `registerDispatcherMetrics`.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643138" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223628696&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223628696&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/clusterframework/ResourceManagerTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -524,7 +525,8 @@ public void testHeartbeatTimeoutWithTaskExecutor() throws Exception {&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				jobLeaderIdService,&lt;br/&gt;
 				new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler);&lt;br/&gt;
+				testingFatalErrorHandler,&lt;br/&gt;
+				mock(JobManagerMetricGroup.class));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   replace mock (see above)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643139" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223626809&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223626809&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -298,7 +301,8 @@ protected void closeTaskManagerConnection(ResourceID resourceID, Exception cause&lt;br/&gt;
 					mesosServices,&lt;br/&gt;
 					rmServices.mesosConfig,&lt;br/&gt;
 					tmParams,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;containerSpecification&lt;br/&gt;
+					containerSpecification,&lt;br/&gt;
+					mock(JobManagerMetricGroup.class)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   There is no need for the mock, you can use `UnregisteredMetricGroups#createUnregisteredJobManagerMetricGroup()` instead.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643140" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223627081&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223627081&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerFactory.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -62,7 +63,17 @@ public MesosResourceManagerFactory(@Nonnull MesosServices mesosServices, @Nonnul&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public ResourceManager&amp;lt;RegisteredMesosWorkerNode&amp;gt; createResourceManager(Configuration configuration, ResourceID resourceId, RpcService rpcService, HighAvailabilityServices highAvailabilityServices, HeartbeatServices heartbeatServices, MetricRegistry metricRegistry, FatalErrorHandler fatalErrorHandler, ClusterInformation clusterInformation, @Nullable String webInterfaceUrl) throws Exception {&lt;br/&gt;
+	public ResourceManager&amp;lt;RegisteredMesosWorkerNode&amp;gt; createResourceManager(&lt;br/&gt;
+		Configuration configuration,&lt;br/&gt;
+		ResourceID resourceId,&lt;br/&gt;
+		RpcService rpcService,&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   please indent the arguments by another tab to separate them from the constructor body.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643141" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223629021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223629021&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTaskExecutorTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -212,7 +213,8 @@ private StandaloneResourceManager createAndStartResourceManager(LeaderElectionSe&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				jobLeaderIdService,&lt;br/&gt;
 				new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fatalErrorHandler);&lt;br/&gt;
+				fatalErrorHandler,&lt;br/&gt;
+				mock(JobManagerMetricGroup.class));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   replace mock (see above)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643142" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223629046&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223629046&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -90,7 +93,8 @@ public void testRequestTaskManagerInfo() throws Exception {&lt;br/&gt;
 			slotManager,&lt;br/&gt;
 			NoOpMetricRegistry.INSTANCE,&lt;br/&gt;
 			jobLeaderIdService,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler);&lt;br/&gt;
+			testingFatalErrorHandler,&lt;br/&gt;
+			mock(JobManagerMetricGroup.class));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   replace mock (see above)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643143" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223629234&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223629234&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-yarn/src/test/java/org/apache/flink/yarn/YarnResourceManagerTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -248,6 +251,7 @@ protected void runAsync(final Runnable runnable) {&lt;br/&gt;
 		public NMClient mockNMClient = mock(NMClient.class);&lt;br/&gt;
 		public AMRMClientAsync&amp;lt;AMRMClient.ContainerRequest&amp;gt; mockResourceManagerClient =&lt;br/&gt;
 				mock(AMRMClientAsync.class);&lt;br/&gt;
+		public JobManagerMetricGroup mockJMMetricGroup = mock(JobManagerMetricGroup.class);&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   replace mock (see above)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643144" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223628712&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223628712&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/clusterframework/ResourceManagerTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -622,7 +624,8 @@ public void testHeartbeatTimeoutWithJobManager() throws Exception {&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				jobLeaderIdService,&lt;br/&gt;
 				new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler);&lt;br/&gt;
+				testingFatalErrorHandler,&lt;br/&gt;
+				mock(JobManagerMetricGroup.class));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   replace mock (see above)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643145" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223628759&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223628759&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerJobMasterTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -291,7 +292,8 @@ private ResourceManager createAndStartResourceManager(&lt;br/&gt;
 			metricRegistry,&lt;br/&gt;
 			jobLeaderIdService,&lt;br/&gt;
 			new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fatalErrorHandler);&lt;br/&gt;
+			fatalErrorHandler,&lt;br/&gt;
+			mock(JobManagerMetricGroup.class));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   replace mock (see above)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643146" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223629091&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223629091&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -149,7 +150,8 @@ public void testSlotAllocation() throws Exception {&lt;br/&gt;
 			metricRegistry,&lt;br/&gt;
 			jobLeaderIdService,&lt;br/&gt;
 			new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler);&lt;br/&gt;
+			testingFatalErrorHandler,&lt;br/&gt;
+			mock(JobManagerMetricGroup.class));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   replace mock (see above)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643147" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223628530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223628530&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -97,6 +98,7 @@&lt;br/&gt;
 	DispatcherGateway, LeaderContender, SubmittedJobGraphStore.SubmittedJobGraphListener {&lt;/p&gt;

&lt;p&gt; 	public static final String DISPATCHER_NAME = &quot;dispatcher&quot;;&lt;br/&gt;
+	public static final String NUM_RUNNING_JOBS_METRIC_NAME = &quot;numRunningJobs&quot;;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   The `MetricNames` class contains various metric names and is quite useful, let&apos;s move this one (and the ones from the resource manager) there as well.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643148" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223630544&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223630544&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -734,6 +744,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() {&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&lt;br/&gt;
+			TASK_SLOTS_AVAILABLE_METRIC_NAME,&lt;br/&gt;
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   are these operations thread-safe? The RM (and Dispatcher for that manner) are single-threaded internally, but metrics are queried from another thread.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643149" author="githubbot" created="Tue, 9 Oct 2018 11:18:22 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223628724&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223628724&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerHATest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -93,7 +94,8 @@ public void confirmLeaderSessionID(UUID leaderId) {&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				resourceManagerRuntimeServices.getJobLeaderIdService(),&lt;br/&gt;
 				new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler) {&lt;br/&gt;
+				testingFatalErrorHandler,&lt;br/&gt;
+				mock(JobManagerMetricGroup.class)) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; Review comment:&lt;br/&gt;
   replace mock (see above)&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643231" author="githubbot" created="Tue, 9 Oct 2018 12:13:12 +0000"  >&lt;p&gt;yanghua commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223673598&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223673598&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -734,6 +744,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() {&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&lt;br/&gt;
+			TASK_SLOTS_AVAILABLE_METRIC_NAME,&lt;br/&gt;
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   @zentol There may be problems with read inconsistencies here. But I think the impact is small:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;If RM and Dispatcher are single-threaded, there will be no concurrent modification problems here;&lt;/li&gt;
	&lt;li&gt;The indicator is periodically extracted (inconsistent is only a short period of one cycle) and its value does not play any decision role in Flink (should be tolerable?)&lt;/li&gt;
	&lt;li&gt;Considering the frequency of metric extraction, if we provide related synchronization mechanisms, performance will be reduced and complexity will be increased.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;   What do you think?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643391" author="githubbot" created="Tue, 9 Oct 2018 13:03:35 +0000"  >&lt;p&gt;tillrohrmann commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223690671&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223690671&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -734,6 +744,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() {&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&lt;br/&gt;
+			TASK_SLOTS_AVAILABLE_METRIC_NAME,&lt;br/&gt;
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I think it should be okish to call these methods from a different thread. All of them simply return the size of a `HashMap`. In the worst case, we would report a little bit stale data. The main danger I see is that the implementations of `SlotManager` might change, which makes this no longer hold true.&lt;/p&gt;

&lt;p&gt;   If we wanted to make it &quot;thread-safe&quot;, then we would need to make the access call inside of the `MainThreadExecutor`:&lt;br/&gt;
   ```&lt;br/&gt;
   jobManagerMetricGroup.gauge(&lt;br/&gt;
   	MetricNames.TASK_SLOTS_AVAILABLE,&lt;br/&gt;
   	() -&amp;gt; callAsync(() -&amp;gt; slotManager.getNumberFreeSlots(), timeout).get());&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;   However, this might be an overkill at the moment.&lt;/p&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643458" author="githubbot" created="Tue, 9 Oct 2018 13:49:40 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223708300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223708300&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTest.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -44,6 +45,8 @@&lt;br/&gt;
 import java.util.concurrent.CompletableFuture;&lt;br/&gt;
 import java.util.concurrent.ExecutionException;&lt;/p&gt;

&lt;p&gt;+import static org.mockito.Mockito.mock;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   unused&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643461" author="githubbot" created="Tue, 9 Oct 2018 13:50:21 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223708568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223708568&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/test/java/org/apache/flink/runtime/webmonitor/TestingRestfulGateway.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -281,6 +283,11 @@ public Builder setRequestClusterOverviewSupplier(Supplier&amp;lt;CompletableFuture&amp;lt;Clus&lt;br/&gt;
 			return this;&lt;br/&gt;
 		}&lt;/p&gt;

&lt;p&gt;+		public Builder setRequestOverviewForAllJobsSupplier(Supplier&amp;lt;CompletableFuture&amp;lt;JobsOverview&amp;gt;&amp;gt; requestOverviewForAllJobsSupplier) {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   We should be able to remove this now.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643470" author="githubbot" created="Tue, 9 Oct 2018 13:56:37 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223711096&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223711096&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -734,6 +744,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() {&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&lt;br/&gt;
+			TASK_SLOTS_AVAILABLE_METRIC_NAME,&lt;br/&gt;
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   yes, my concern was primarily over the long-term. This also becomes relevant if new metrics are added, which will follow a similar pattern as existing ones that don&apos;t worry about concurrency.&lt;/p&gt;

&lt;p&gt;   However, @tillrohrmann&apos;s solution isn&apos;t even overkill enough, as it could result in exceptions being thrown by metrics (in case of a timeout) which generally shouldn&apos;t happen. So we&apos;d have to cache the previous result and return that in case of a timeout.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16643536" author="githubbot" created="Tue, 9 Oct 2018 14:48:25 +0000"  >&lt;p&gt;yanghua commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223734016&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223734016&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -734,6 +744,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() {&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&lt;br/&gt;
+			TASK_SLOTS_AVAILABLE_METRIC_NAME,&lt;br/&gt;
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   @zentol So, I should accept this solution?&lt;/p&gt;

&lt;p&gt;   &amp;gt; So we&apos;d have to cache the previous result and return that in case of a timeout.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644591" author="githubbot" created="Wed, 10 Oct 2018 07:46:14 +0000"  >&lt;p&gt;tillrohrmann commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223968230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223968230&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -734,6 +744,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() {&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&lt;br/&gt;
+			TASK_SLOTS_AVAILABLE_METRIC_NAME,&lt;br/&gt;
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   I think this problem might occur at other places as well. Thus, at some point it might be helpful to either add some tooling to do exactly what @zentol proposed or to make the metric system work with asynchronous metrics.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644641" author="githubbot" created="Wed, 10 Oct 2018 08:43:17 +0000"  >&lt;p&gt;yanghua commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r223985494&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r223985494&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -734,6 +744,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() {&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&lt;br/&gt;
+			TASK_SLOTS_AVAILABLE_METRIC_NAME,&lt;br/&gt;
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   @tillrohrmann so, Your suggestion is that we will not solve it in this PR, right?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644770" author="githubbot" created="Wed, 10 Oct 2018 10:02:12 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r224013715&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r224013715&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -734,6 +744,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() {&lt;br/&gt;
+		jobManagerMetricGroup.gauge(&lt;br/&gt;
+			TASK_SLOTS_AVAILABLE_METRIC_NAME,&lt;br/&gt;
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   Solving this issue would be overkill for this PR, I agree.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644788" author="githubbot" created="Wed, 10 Oct 2018 10:32:06 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428522177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428522177&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @zentol I have already adopted your previous review suggestions. Does it still need other modifications?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644799" author="githubbot" created="Wed, 10 Oct 2018 10:40:39 +0000"  >&lt;p&gt;zentol commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428525230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428525230&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I believe you haven&apos;t addressed my comments regarding the  `JobManagerMetricsITCase`.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644800" author="githubbot" created="Wed, 10 Oct 2018 10:40:58 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r224024368&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r224024368&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,186 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.client.program.MiniClusterClient;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.core.testutils.BlockerSync;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobGraph;&lt;br/&gt;
+import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.sink.PrintSinkFunction;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.source.SourceFunction;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Assume;&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_AVAILABLE = &quot;taskSlotsAvailable&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_TOTAL = &quot;taskSlotsTotal&quot;;&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   use constants in `MetricNames` instead&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644801" author="githubbot" created="Wed, 10 Oct 2018 10:41:24 +0000"  >&lt;p&gt;zentol commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428525410&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428525410&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   oh wait you did, Ill take another look.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644803" author="githubbot" created="Wed, 10 Oct 2018 10:42:40 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r224024794&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r224024794&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,186 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.client.program.MiniClusterClient;&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.core.testutils.BlockerSync;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.jobgraph.JobGraph;&lt;br/&gt;
+import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.sink.PrintSinkFunction;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.source.SourceFunction;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Assume;&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_AVAILABLE = &quot;taskSlotsAvailable&quot;;&lt;br/&gt;
+	private static final String TASK_SLOTS_TOTAL = &quot;taskSlotsTotal&quot;;&lt;br/&gt;
+	private static final String NUM_REGISTERED_TASK_MANAGERS = &quot;numRegisteredTaskManagers&quot;;&lt;br/&gt;
+	private static final String NUM_RUNNING_JOBS = &quot;numRunningJobs&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static final BlockerSync sync = new BlockerSync();&lt;br/&gt;
+&lt;br/&gt;
+	private MiniClusterClient clusterClient;&lt;br/&gt;
+	private JobGraph jobGraph;&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception {&lt;br/&gt;
+		Assume.assumeTrue(&lt;br/&gt;
+			&quot;ClusterClient is not an instance of MiniClusterClient&quot;,&lt;br/&gt;
+			MINI_CLUSTER_RESOURCE.getClusterClient() instanceof MiniClusterClient);&lt;br/&gt;
+&lt;br/&gt;
+		clusterClient = (MiniClusterClient) MINI_CLUSTER_RESOURCE.getClusterClient();&lt;br/&gt;
+		clusterClient.setDetached(true);&lt;br/&gt;
+&lt;br/&gt;
+		StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   you can put this job ad an `execute()` call into a separate thread and wait in the main test thread. then you don&apos;t have to create a jobgraph or use the cluster client.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644868" author="githubbot" created="Wed, 10 Oct 2018 11:45:43 +0000"  >&lt;p&gt;yanghua commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r224041358&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r224041358&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,179 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.core.testutils.BlockerSync;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.client.JobExecutionException;&lt;br/&gt;
+import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.sink.PrintSinkFunction;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.source.SourceFunction;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static final BlockerSync sync = new BlockerSync();&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception {&lt;br/&gt;
+		Thread jobExecuteThread = new Thread(() -&amp;gt; {&lt;br/&gt;
+&lt;br/&gt;
+			StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();&lt;br/&gt;
+			env.addSource(new SourceFunction&amp;lt;String&amp;gt;() {&lt;br/&gt;
+&lt;br/&gt;
+				@Override&lt;br/&gt;
+				public void run(SourceContext&amp;lt;String&amp;gt; ctx) throws Exception &lt;/p&gt;
{
+					sync.block();
+				}
&lt;p&gt;+&lt;br/&gt;
+				@Override&lt;br/&gt;
+				public void cancel() &lt;/p&gt;
{
+					sync.releaseBlocker();
+				}
&lt;p&gt;+&lt;br/&gt;
+			}).addSink(new PrintSinkFunction());&lt;br/&gt;
+&lt;br/&gt;
+			try {&lt;br/&gt;
+				env.execute();&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   @zentol what about this implementation?&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644889" author="githubbot" created="Wed, 10 Oct 2018 12:02:06 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r224043289&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r224043289&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,180 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.core.testutils.BlockerSync;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.client.JobExecutionException;&lt;br/&gt;
+import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.sink.PrintSinkFunction;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.source.SourceFunction;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   add `extends TestLogger`&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644890" author="githubbot" created="Wed, 10 Oct 2018 12:02:06 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r224045256&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r224045256&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,180 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.core.testutils.BlockerSync;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.client.JobExecutionException;&lt;br/&gt;
+import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.sink.PrintSinkFunction;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.source.SourceFunction;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static final BlockerSync sync = new BlockerSync();&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception {&lt;br/&gt;
+		Thread jobExecuteThread = new Thread(() -&amp;gt; {&lt;br/&gt;
+&lt;br/&gt;
+			StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();&lt;br/&gt;
+			env.addSource(new SourceFunction&amp;lt;String&amp;gt;() {&lt;br/&gt;
+&lt;br/&gt;
+				@Override&lt;br/&gt;
+				public void run(SourceContext&amp;lt;String&amp;gt; ctx) throws Exception &lt;/p&gt;
{
+					sync.block();
+				}
&lt;p&gt;+&lt;br/&gt;
+				@Override&lt;br/&gt;
+				public void cancel() &lt;/p&gt;
{
+					sync.releaseBlocker();
+				}
&lt;p&gt;+&lt;br/&gt;
+			}).addSink(new PrintSinkFunction());&lt;br/&gt;
+&lt;br/&gt;
+			try &lt;/p&gt;
{
+				env.execute();
+			}
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
+				if (!(e instanceof JobExecutionException)) &lt;/p&gt;
{
+					fail(&quot;Execution job failed, reason : &quot; + e.getMessage());
+				}
&lt;p&gt;+			}&lt;br/&gt;
+&lt;br/&gt;
+		});&lt;br/&gt;
+&lt;br/&gt;
+		jobExecuteThread.start();&lt;br/&gt;
+		sync.awaitBlocker();&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   should should `join()` (or in the case of `CheckedThread`, `sync()`) on the job executing thread to ensure the job is finished before shutting down the cluster.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644891" author="githubbot" created="Wed, 10 Oct 2018 12:02:06 +0000"  >&lt;p&gt;zentol commented on a change in pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#discussion_r224046238&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#discussion_r224046238&lt;/a&gt;&lt;/p&gt;



&lt;p&gt; ##########&lt;br/&gt;
 File path: flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
 ##########&lt;br/&gt;
 @@ -0,0 +1,180 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.core.testutils.BlockerSync;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.runtime.client.JobExecutionException;&lt;br/&gt;
+import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.sink.PrintSinkFunction;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.source.SourceFunction;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static final BlockerSync sync = new BlockerSync();&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception {&lt;br/&gt;
+		Thread jobExecuteThread = new Thread(() -&amp;gt; {&lt;br/&gt;
+&lt;br/&gt;
+			StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();&lt;br/&gt;
+			env.addSource(new SourceFunction&amp;lt;String&amp;gt;() {&lt;br/&gt;
+&lt;br/&gt;
+				@Override&lt;br/&gt;
+				public void run(SourceContext&amp;lt;String&amp;gt; ctx) throws Exception &lt;/p&gt;
{
+					sync.block();
+				}
&lt;p&gt;+&lt;br/&gt;
+				@Override&lt;br/&gt;
+				public void cancel() &lt;/p&gt;
{
+					sync.releaseBlocker();
+				}
&lt;p&gt;+&lt;br/&gt;
+			}).addSink(new PrintSinkFunction());&lt;br/&gt;
+&lt;br/&gt;
+			try &lt;/p&gt;
{
+				env.execute();
+			}
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
+				if (!(e instanceof JobExecutionException)) {&lt;br/&gt;
+					fail(&quot;Execution job failed, reason : &quot; + e.getMessage());&lt;/p&gt;

&lt;p&gt; Review comment:&lt;br/&gt;
   This won&apos;t have the effect you probably intended, as it will not fail the test. You can use a Flink `CheckedThread` to achieve this, and `sync()` at the end of the test.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16644901" author="githubbot" created="Wed, 10 Oct 2018 12:21:19 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428550406&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428550406&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @zentol thanks, updated.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16646213" author="githubbot" created="Thu, 11 Oct 2018 09:51:56 +0000"  >&lt;p&gt;tillrohrmann commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428893823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428893823&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   There is a merge conflict with `ResourceManager`.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16646316" author="githubbot" created="Thu, 11 Oct 2018 11:38:49 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-428923003&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-428923003&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @tillrohrmann fixed the conflicts.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16647365" author="githubbot" created="Fri, 12 Oct 2018 03:19:12 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-429191342&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-429191342&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I saw some errors not related to this PR change, from `flink-s3-fs-hadoop`. cc @tillrohrmann  and @zentol &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16647366" author="githubbot" created="Fri, 12 Oct 2018 03:19:52 +0000"  >&lt;p&gt;yanghua edited a comment on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-429191342&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-429191342&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   I saw some compile errors not related to this PR change which caused Travis failed  from `flink-s3-fs-hadoop`. cc @tillrohrmann  and @zentol &lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16647370" author="githubbot" created="Fri, 12 Oct 2018 03:22:18 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-429191782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-429191782&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   display here then I will try to trigger Travis rebuild : &lt;/p&gt;

&lt;p&gt;   ```&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.1:compile (default-compile) on project flink-s3-fs-base: Compilation failure: Compilation failure:&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/travis/build/apache/flink/flink-filesystems/flink-s3-fs-base/src/main/java/org/apache/flink/fs/s3/common/writer/S3RecoverableFsDataOutputStream.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;38,1&amp;#93;&lt;/span&gt; cannot find symbol&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; symbol:   static S3_MULTIPART_MIN_PART_SIZE&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; location: class&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/travis/build/apache/flink/flink-filesystems/flink-s3-fs-base/src/main/java/org/apache/flink/fs/s3/common/writer/S3RecoverableWriter.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;38,1&amp;#93;&lt;/span&gt; cannot find symbol&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; symbol:   static S3_MULTIPART_MIN_PART_SIZE&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; location: class&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/travis/build/apache/flink/flink-filesystems/flink-s3-fs-base/src/main/java/org/apache/flink/fs/s3/common/writer/S3RecoverableWriter.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;137,57&amp;#93;&lt;/span&gt; cannot find symbol&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; symbol:   variable S3_MULTIPART_MIN_PART_SIZE&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; location: class org.apache.flink.fs.s3.common.writer.S3RecoverableWriter&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/travis/build/apache/flink/flink-filesystems/flink-s3-fs-base/src/main/java/org/apache/flink/fs/s3/common/writer/S3RecoverableMultipartUploadFactory.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;137,72&amp;#93;&lt;/span&gt; toHadoopPath(org.apache.flink.core.fs.Path) is not public in org.apache.flink.runtime.fs.hdfs.HadoopFileSystem; cannot be accessed from outside package&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/travis/build/apache/flink/flink-filesystems/flink-s3-fs-base/src/main/java/org/apache/flink/fs/s3/common/writer/S3RecoverableFsDataOutputStream.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;234,57&amp;#93;&lt;/span&gt; cannot find symbol&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; symbol:   variable S3_MULTIPART_MIN_PART_SIZE&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; location: class org.apache.flink.fs.s3.common.writer.S3RecoverableFsDataOutputStream&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/travis/build/apache/flink/flink-filesystems/flink-s3-fs-base/src/main/java/org/apache/flink/fs/s3/common/writer/S3RecoverableFsDataOutputStream.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;252,57&amp;#93;&lt;/span&gt; cannot find symbol&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; symbol:   variable S3_MULTIPART_MIN_PART_SIZE&lt;br/&gt;
   17:18:24.891 &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; location: class org.apache.flink.fs.s3.common.writer.S3RecoverableFsDataOutputStream&lt;br/&gt;
   ```&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16647741" author="githubbot" created="Fri, 12 Oct 2018 10:09:01 +0000"  >&lt;p&gt;tillrohrmann commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-429275735&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-429275735&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   There is currently a problem with the `HadoopS3RecoverableWriterExceptionTest`. @kl0u is fixing it. Once this is done, please rebase onto the latest master.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16648683" author="githubbot" created="Sat, 13 Oct 2018 01:54:30 +0000"  >&lt;p&gt;yanghua commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-429502056&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-429502056&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   @tillrohrmann rebased and all checks have passed.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16649003" author="githubbot" created="Sat, 13 Oct 2018 15:55:40 +0000"  >&lt;p&gt;zentol commented on issue #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702#issuecomment-429552733&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702#issuecomment-429552733&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Ill merge this on monday and start looking into backporting this to 1.5 and 1.6.&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16649752" author="githubbot" created="Mon, 15 Oct 2018 05:43:35 +0000"  >&lt;p&gt;zentol closed pull request #6702: &lt;a href=&quot;https://issues.apache.org/jira/browse/FLINK-10135&quot; title=&quot;Certain cluster-level metrics are no longer exposed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FLINK-10135&quot;&gt;&lt;del&gt;FLINK-10135&lt;/del&gt;&lt;/a&gt; The JobManager does not report the cluster-level metrics&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/flink/pull/6702&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/flink/pull/6702&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManager.java b/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManager.java&lt;br/&gt;
index 89d0cfd3452..ae51a2027e8 100644&lt;br/&gt;
&amp;#8212; a/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManager.java&lt;br/&gt;
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManager.java&lt;br/&gt;
@@ -50,6 +50,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.JobLeaderIdService;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManager;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.exceptions.ResourceManagerException;&lt;br/&gt;
@@ -165,7 +166,8 @@ public MesosResourceManager(&lt;br/&gt;
 			MesosConfiguration mesosConfig,&lt;br/&gt;
 			MesosTaskManagerParameters taskManagerParameters,&lt;br/&gt;
 			ContainerSpecification taskManagerContainerSpec,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Nullable String webUiUrl) {&lt;br/&gt;
+			@Nullable String webUiUrl,&lt;br/&gt;
+			JobManagerMetricGroup jobManagerMetricGroup) 
{
 		super(
 			rpcService,
 			resourceManagerEndpointId,
@@ -176,7 +178,8 @@ public MesosResourceManager(
 			metricRegistry,
 			jobLeaderIdService,
 			clusterInformation,
-			fatalErrorHandler);
+			fatalErrorHandler,
+			jobManagerMetricGroup);
 
 		this.mesosServices = Preconditions.checkNotNull(mesosServices);
 		this.actorSystem = Preconditions.checkNotNull(mesosServices.getLocalActorSystem());
diff --git a/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerFactory.java b/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerFactory.java
index 9582e9f2e23..f53ffb301a8 100644
--- a/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerFactory.java
+++ b/flink-mesos/src/main/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerFactory.java
@@ -27,6 +27,7 @@
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;
 import org.apache.flink.runtime.metrics.MetricRegistry;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;
 import org.apache.flink.runtime.resourcemanager.ResourceManager;
 import org.apache.flink.runtime.resourcemanager.ResourceManagerFactory;
 import org.apache.flink.runtime.resourcemanager.ResourceManagerRuntimeServices;
@@ -62,7 +63,17 @@ public MesosResourceManagerFactory(@Nonnull MesosServices mesosServices, @Nonnul
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public ResourceManager&amp;lt;RegisteredMesosWorkerNode&amp;gt; createResourceManager(Configuration configuration, ResourceID resourceId, RpcService rpcService, HighAvailabilityServices highAvailabilityServices, HeartbeatServices heartbeatServices, MetricRegistry metricRegistry, FatalErrorHandler fatalErrorHandler, ClusterInformation clusterInformation, @Nullable String webInterfaceUrl) throws Exception 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+	public ResourceManager&amp;lt;RegisteredMesosWorkerNode&amp;gt; createResourceManager(+			Configuration configuration,+			ResourceID resourceId,+			RpcService rpcService,+			HighAvailabilityServices highAvailabilityServices,+			HeartbeatServices heartbeatServices,+			MetricRegistry metricRegistry,+			FatalErrorHandler fatalErrorHandler,+			ClusterInformation clusterInformation,+			@Nullable String webInterfaceUrl,+			JobManagerMetricGroup jobManagerMetricGroup) throws Exception {
 		final ResourceManagerRuntimeServicesConfiguration rmServicesConfiguration = ResourceManagerRuntimeServicesConfiguration.fromConfiguration(configuration);
 		final ResourceManagerRuntimeServices rmRuntimeServices = ResourceManagerRuntimeServices.fromConfiguration(
 			rmServicesConfiguration,
@@ -85,6 +96,7 @@ public MesosResourceManagerFactory(@Nonnull MesosServices mesosServices, @Nonnul
 			schedulerConfiguration,
 			taskManagerParameters,
 			taskManagerContainerSpec,
-			webInterfaceUrl);
+			webInterfaceUrl,
+			jobManagerMetricGroup);
 	} }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;diff --git a/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerTest.java b/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerTest.java&lt;br/&gt;
index 94bc860a85c..5c9aa468d86 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerTest.java&lt;br/&gt;
+++ b/flink-mesos/src/test/java/org/apache/flink/mesos/runtime/clusterframework/MesosResourceManagerTest.java&lt;br/&gt;
@@ -57,6 +57,8 @@&lt;br/&gt;
 import org.apache.flink.runtime.messages.Acknowledge;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistryImpl;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
 import org.apache.flink.runtime.registration.RegistrationResponse;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.JobLeaderIdService;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManagerId;&lt;br/&gt;
@@ -172,7 +174,8 @@ public TestingMesosResourceManager(&lt;br/&gt;
 			MesosServices mesosServices,&lt;br/&gt;
 			MesosConfiguration mesosConfig,&lt;br/&gt;
 			MesosTaskManagerParameters taskManagerParameters,&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;ContainerSpecification taskManagerContainerSpec) {&lt;br/&gt;
+			ContainerSpecification taskManagerContainerSpec,&lt;br/&gt;
+			JobManagerMetricGroup jobManagerMetricGroup) 
{
 			super(
 				rpcService,
 				resourceManagerEndpointId,
@@ -189,7 +192,8 @@ public TestingMesosResourceManager(
 				mesosConfig,
 				taskManagerParameters,
 				taskManagerContainerSpec,
-				null);
+				null,
+				jobManagerMetricGroup);
 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		@Override&lt;br/&gt;
@@ -298,8 +302,8 @@ protected void closeTaskManagerConnection(ResourceID resourceID, Exception cause&lt;br/&gt;
 					mesosServices,&lt;br/&gt;
 					rmServices.mesosConfig,&lt;br/&gt;
 					tmParams,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;containerSpecification&lt;/li&gt;
	&lt;li&gt;);&lt;br/&gt;
+					containerSpecification,&lt;br/&gt;
+					UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			// TaskExecutors&lt;br/&gt;
 			task1Executor = mockTaskExecutor(task1);&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
index a1da2131e48..f15ea5bc314 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/dispatcher/Dispatcher.java&lt;br/&gt;
@@ -23,6 +23,7 @@&lt;br/&gt;
 import org.apache.flink.api.common.time.Time;&lt;br/&gt;
 import org.apache.flink.api.java.tuple.Tuple2;&lt;br/&gt;
 import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.metrics.MetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.blob.BlobServer;&lt;br/&gt;
 import org.apache.flink.runtime.checkpoint.Checkpoints;&lt;br/&gt;
 import org.apache.flink.runtime.client.JobSubmissionException;&lt;br/&gt;
@@ -53,6 +54,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.messages.webmonitor.JobDetails;&lt;br/&gt;
 import org.apache.flink.runtime.messages.webmonitor.JobsOverview;&lt;br/&gt;
 import org.apache.flink.runtime.messages.webmonitor.MultipleJobsDetails;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.MetricNames;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManagerGateway;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceOverview;&lt;br/&gt;
@@ -230,6 +232,8 @@ public void start() throws Exception &lt;/p&gt;
{
 
 		submittedJobGraphStore.start(this);
 		leaderElectionService.start(this);
+
+		registerDispatcherMetrics(jobManagerMetricGroup);
 	}

&lt;p&gt; 	//------------------------------------------------------&lt;br/&gt;
@@ -909,6 +913,11 @@ private void clearDispatcherState() &lt;/p&gt;
{
 		terminateJobManagerRunners();
 	}

&lt;p&gt;+	private void registerDispatcherMetrics(MetricGroup jobManagerMetricGroup) &lt;/p&gt;
{
+		jobManagerMetricGroup.gauge(MetricNames.NUM_RUNNING_JOBS,
+			() -&amp;gt; (long) jobManagerRunnerFutures.size());
+	}
&lt;p&gt;+&lt;br/&gt;
 	/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Callback method when current resourceManager loses leadership.&lt;br/&gt;
 	 */&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/component/AbstractDispatcherResourceManagerComponentFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/component/AbstractDispatcherResourceManagerComponentFactory.java&lt;br/&gt;
index 043ccecf422..c09c41bb2ec 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/component/AbstractDispatcherResourceManagerComponentFactory.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/entrypoint/component/AbstractDispatcherResourceManagerComponentFactory.java&lt;br/&gt;
@@ -149,6 +149,11 @@ public AbstractDispatcherResourceManagerComponentFactory(&lt;br/&gt;
 			log.debug(&quot;Starting Dispatcher REST endpoint.&quot;);&lt;br/&gt;
 			webMonitorEndpoint.start();&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+			jobManagerMetricGroup = MetricUtils.instantiateJobManagerMetricGroup(&lt;br/&gt;
+				metricRegistry,&lt;br/&gt;
+				rpcService.getAddress(),&lt;br/&gt;
+				ConfigurationUtils.getSystemResourceMetricsProbingInterval(configuration));&lt;br/&gt;
+&lt;br/&gt;
 			resourceManager = resourceManagerFactory.createResourceManager(&lt;br/&gt;
 				configuration,&lt;br/&gt;
 				ResourceID.generate(),&lt;br/&gt;
@@ -158,12 +163,8 @@ public AbstractDispatcherResourceManagerComponentFactory(&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				fatalErrorHandler,&lt;br/&gt;
 				new ClusterInformation(rpcService.getAddress(), blobServer.getPort()),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;webMonitorEndpoint.getRestBaseUrl());&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;jobManagerMetricGroup = MetricUtils.instantiateJobManagerMetricGroup(&lt;/li&gt;
	&lt;li&gt;metricRegistry,&lt;/li&gt;
	&lt;li&gt;rpcService.getAddress(),&lt;/li&gt;
	&lt;li&gt;ConfigurationUtils.getSystemResourceMetricsProbingInterval(configuration));&lt;br/&gt;
+				webMonitorEndpoint.getRestBaseUrl(),&lt;br/&gt;
+				jobManagerMetricGroup);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			final HistoryServerArchivist historyServerArchivist = HistoryServerArchivist.createHistoryServerArchivist(configuration, webMonitorEndpoint);&lt;/p&gt;

&lt;p&gt;diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/MetricNames.java b/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/MetricNames.java&lt;br/&gt;
index c106c391e46..dfa82f15381 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/MetricNames.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/metrics/MetricNames.java&lt;br/&gt;
@@ -52,4 +52,9 @@ private MetricNames() &lt;/p&gt;
{
 	public static final String IO_CURRENT_INPUT_1_WATERMARK = &quot;currentInput1Watermark&quot;;
 	public static final String IO_CURRENT_INPUT_2_WATERMARK = &quot;currentInput2Watermark&quot;;
 	public static final String IO_CURRENT_OUTPUT_WATERMARK = &quot;currentOutputWatermark&quot;;
+
+	public static final String NUM_RUNNING_JOBS = &quot;numRunningJobs&quot;;
+	public static final String TASK_SLOTS_AVAILABLE = &quot;taskSlotsAvailable&quot;;
+	public static final String TASK_SLOTS_TOTAL = &quot;taskSlotsTotal&quot;;
+	public static final String NUM_REGISTERED_TASK_MANAGERS = &quot;numRegisteredTaskManagers&quot;;
 }
&lt;p&gt;diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/minicluster/MiniCluster.java b/flink-runtime/src/main/java/org/apache/flink/runtime/minicluster/MiniCluster.java&lt;br/&gt;
index 58341ad496c..3fc7007f9c5 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/minicluster/MiniCluster.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/minicluster/MiniCluster.java&lt;br/&gt;
@@ -241,6 +241,10 @@ public void start() throws Exception {&lt;/p&gt;

&lt;p&gt; 				LOG.info(&quot;Starting Metrics Registry&quot;);&lt;br/&gt;
 				metricRegistry = createMetricRegistry(configuration);&lt;br/&gt;
+				this.jobManagerMetricGroup = MetricUtils.instantiateJobManagerMetricGroup(&lt;br/&gt;
+					metricRegistry,&lt;br/&gt;
+					&quot;localhost&quot;,&lt;br/&gt;
+					ConfigurationUtils.getSystemResourceMetricsProbingInterval(configuration));&lt;/p&gt;

&lt;p&gt; 				final RpcService jobManagerRpcService;&lt;br/&gt;
 				final RpcService resourceManagerRpcService;&lt;br/&gt;
@@ -309,7 +313,8 @@ public void start() throws Exception {&lt;br/&gt;
 					heartbeatServices,&lt;br/&gt;
 					metricRegistry,&lt;br/&gt;
 					resourceManagerRpcService,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;new ClusterInformation(&quot;localhost&quot;, blobServer.getPort()));&lt;br/&gt;
+					new ClusterInformation(&quot;localhost&quot;, blobServer.getPort()),&lt;br/&gt;
+					jobManagerMetricGroup);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				blobCacheService = new BlobCacheService(&lt;br/&gt;
 					configuration, haServices.createBlobStore(), new InetSocketAddress(InetAddress.getLocalHost(), blobServer.getPort())&lt;br/&gt;
@@ -365,11 +370,6 @@ public void start() throws Exception {&lt;br/&gt;
 				// bring up the dispatcher that launches JobManagers when jobs submitted&lt;br/&gt;
 				LOG.info(&quot;Starting job dispatcher(s) for JobManger&quot;);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;this.jobManagerMetricGroup = MetricUtils.instantiateJobManagerMetricGroup(&lt;/li&gt;
	&lt;li&gt;metricRegistry,&lt;/li&gt;
	&lt;li&gt;&quot;localhost&quot;,&lt;/li&gt;
	&lt;li&gt;ConfigurationUtils.getSystemResourceMetricsProbingInterval(configuration));&lt;br/&gt;
-&lt;br/&gt;
 				final HistoryServerArchivist historyServerArchivist = HistoryServerArchivist.createHistoryServerArchivist(configuration, dispatcherRestEndpoint);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				dispatcher = new StandaloneDispatcher(&lt;br/&gt;
@@ -765,7 +765,8 @@ protected ResourceManagerRunner startResourceManager(&lt;br/&gt;
 			HeartbeatServices heartbeatServices,&lt;br/&gt;
 			MetricRegistry metricRegistry,&lt;br/&gt;
 			RpcService resourceManagerRpcService,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ClusterInformation clusterInformation) throws Exception {&lt;br/&gt;
+			ClusterInformation clusterInformation,&lt;br/&gt;
+			JobManagerMetricGroup jobManagerMetricGroup) throws Exception {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		final ResourceManagerRunner resourceManagerRunner = new ResourceManagerRunner(&lt;br/&gt;
 			ResourceID.generate(),&lt;br/&gt;
@@ -775,7 +776,8 @@ protected ResourceManagerRunner startResourceManager(&lt;br/&gt;
 			haServices,&lt;br/&gt;
 			heartbeatServices,&lt;br/&gt;
 			metricRegistry,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;clusterInformation);&lt;br/&gt;
+			clusterInformation,&lt;br/&gt;
+			jobManagerMetricGroup);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			resourceManagerRunner.start();&lt;/p&gt;

&lt;p&gt;diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
index b66921fce20..cd4281e11cf 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManager.java&lt;br/&gt;
@@ -46,7 +46,9 @@&lt;br/&gt;
 import org.apache.flink.runtime.leaderelection.LeaderContender;&lt;br/&gt;
 import org.apache.flink.runtime.leaderelection.LeaderElectionService;&lt;br/&gt;
 import org.apache.flink.runtime.messages.Acknowledge;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.MetricNames;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.registration.RegistrationResponse;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.exceptions.ResourceManagerException;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.exceptions.UnknownTaskExecutorException;&lt;br/&gt;
@@ -135,6 +137,8 @@&lt;/p&gt;

&lt;p&gt; 	private final ClusterInformation clusterInformation;&lt;/p&gt;

&lt;p&gt;+	private final JobManagerMetricGroup jobManagerMetricGroup;&lt;br/&gt;
+&lt;br/&gt;
 	/** The service to elect a ResourceManager leader. */&lt;br/&gt;
 	private LeaderElectionService leaderElectionService;&lt;/p&gt;

&lt;p&gt;@@ -159,7 +163,8 @@ public ResourceManager(&lt;br/&gt;
 			MetricRegistry metricRegistry,&lt;br/&gt;
 			JobLeaderIdService jobLeaderIdService,&lt;br/&gt;
 			ClusterInformation clusterInformation,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FatalErrorHandler fatalErrorHandler) {&lt;br/&gt;
+			FatalErrorHandler fatalErrorHandler,&lt;br/&gt;
+			JobManagerMetricGroup jobManagerMetricGroup) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		super(rpcService, resourceManagerEndpointId);&lt;/p&gt;

&lt;p&gt;@@ -170,6 +175,7 @@ public ResourceManager(&lt;br/&gt;
 		this.jobLeaderIdService = checkNotNull(jobLeaderIdService);&lt;br/&gt;
 		this.clusterInformation = checkNotNull(clusterInformation);&lt;br/&gt;
 		this.fatalErrorHandler = checkNotNull(fatalErrorHandler);&lt;br/&gt;
+		this.jobManagerMetricGroup = checkNotNull(jobManagerMetricGroup);&lt;/p&gt;

&lt;p&gt; 		this.taskManagerHeartbeatManager = heartbeatServices.createHeartbeatManagerSender(&lt;br/&gt;
 			resourceId,&lt;br/&gt;
@@ -215,6 +221,8 @@ public void start() throws Exception {&lt;br/&gt;
 		} catch (Exception e) &lt;/p&gt;
{
 			throw new ResourceManagerException(&quot;Could not start the job leader id service.&quot;, e);
 		}
&lt;p&gt;+&lt;br/&gt;
+		registerSlotAndTaskExecutorMetrics();&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt; 	@Override&lt;br/&gt;
@@ -742,6 +750,18 @@ public void requestHeartbeat(ResourceID resourceID, Void payload) {&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;+	private void registerSlotAndTaskExecutorMetrics() &lt;/p&gt;
{
+		jobManagerMetricGroup.gauge(
+			MetricNames.TASK_SLOTS_AVAILABLE,
+			() -&amp;gt; (long) slotManager.getNumberFreeSlots());
+		jobManagerMetricGroup.gauge(
+			MetricNames.TASK_SLOTS_TOTAL,
+			() -&amp;gt; (long) slotManager.getNumberRegisteredSlots());
+		jobManagerMetricGroup.gauge(
+			MetricNames.NUM_REGISTERED_TASK_MANAGERS,
+			() -&amp;gt; (long) taskExecutors.size());
+	}
&lt;p&gt;+&lt;br/&gt;
 	private void clearStateInternal() &lt;/p&gt;
{
 		jobManagerRegistrations.clear();
 		jmResourceIdRegistrations.clear();
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManagerFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManagerFactory.java
index 91a7b267594..7f70058e355 100644
--- a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManagerFactory.java
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManagerFactory.java
@@ -25,6 +25,7 @@
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;
 import org.apache.flink.runtime.metrics.MetricRegistry;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;
 import org.apache.flink.runtime.rpc.FatalErrorHandler;
 import org.apache.flink.runtime.rpc.RpcService;
 
@@ -46,5 +47,6 @@
 		MetricRegistry metricRegistry,
 		FatalErrorHandler fatalErrorHandler,
 		ClusterInformation clusterInformation,
-		@Nullable String webInterfaceUrl) throws Exception;
+		@Nullable String webInterfaceUrl,
+		JobManagerMetricGroup jobManagerMetricGroup) throws Exception;
 }
&lt;p&gt;diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManagerRunner.java b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManagerRunner.java&lt;br/&gt;
index 072c2f2b5e6..495410237e3 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManagerRunner.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/ResourceManagerRunner.java&lt;br/&gt;
@@ -24,6 +24,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.FatalErrorHandler;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.RpcService;&lt;br/&gt;
 import org.apache.flink.util.AutoCloseableAsync;&lt;br/&gt;
@@ -56,7 +57,8 @@ public ResourceManagerRunner(&lt;br/&gt;
 			final HighAvailabilityServices highAvailabilityServices,&lt;br/&gt;
 			final HeartbeatServices heartbeatServices,&lt;br/&gt;
 			final MetricRegistry metricRegistry,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final ClusterInformation clusterInformation) throws Exception {&lt;br/&gt;
+			final ClusterInformation clusterInformation,&lt;br/&gt;
+			final JobManagerMetricGroup jobManagerMetricGroup) throws Exception 
{
 
 		Preconditions.checkNotNull(resourceId);
 		Preconditions.checkNotNull(configuration);
@@ -82,7 +84,8 @@ public ResourceManagerRunner(
 			metricRegistry,
 			resourceManagerRuntimeServices.getJobLeaderIdService(),
 			clusterInformation,
-			this);
+			this,
+			jobManagerMetricGroup);
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	public ResourceManagerGateway getResourceManageGateway() {&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/StandaloneResourceManager.java b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/StandaloneResourceManager.java&lt;br/&gt;
index 064c2d361d2..9b409b3df9c 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/StandaloneResourceManager.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/StandaloneResourceManager.java&lt;br/&gt;
@@ -25,6 +25,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.exceptions.ResourceManagerException;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.FatalErrorHandler;&lt;br/&gt;
@@ -53,7 +54,8 @@ public StandaloneResourceManager(&lt;br/&gt;
 			MetricRegistry metricRegistry,&lt;br/&gt;
 			JobLeaderIdService jobLeaderIdService,&lt;br/&gt;
 			ClusterInformation clusterInformation,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FatalErrorHandler fatalErrorHandler) {&lt;br/&gt;
+			FatalErrorHandler fatalErrorHandler,&lt;br/&gt;
+			JobManagerMetricGroup jobManagerMetricGroup) 
{
 		super(
 			rpcService,
 			resourceManagerEndpointId,
@@ -64,7 +66,8 @@ public StandaloneResourceManager(
 			metricRegistry,
 			jobLeaderIdService,
 			clusterInformation,
-			fatalErrorHandler);
+			fatalErrorHandler,
+			jobManagerMetricGroup);
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
diff --git a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/StandaloneResourceManagerFactory.java b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/StandaloneResourceManagerFactory.java&lt;br/&gt;
index c8e314f659c..bfe74041fc6 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/StandaloneResourceManagerFactory.java&lt;br/&gt;
+++ b/flink-runtime/src/main/java/org/apache/flink/runtime/resourcemanager/StandaloneResourceManagerFactory.java&lt;br/&gt;
@@ -25,6 +25,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.FatalErrorHandler;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.RpcService;&lt;/p&gt;

&lt;p&gt;@@ -46,7 +47,8 @@&lt;br/&gt;
 			MetricRegistry metricRegistry,&lt;br/&gt;
 			FatalErrorHandler fatalErrorHandler,&lt;br/&gt;
 			ClusterInformation clusterInformation,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Nullable String webInterfaceUrl) throws Exception 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			@Nullable String webInterfaceUrl,+			JobManagerMetricGroup jobManagerMetricGroup) throws Exception {
 		final ResourceManagerRuntimeServicesConfiguration resourceManagerRuntimeServicesConfiguration = ResourceManagerRuntimeServicesConfiguration.fromConfiguration(configuration);
 		final ResourceManagerRuntimeServices resourceManagerRuntimeServices = ResourceManagerRuntimeServices.fromConfiguration(
 			resourceManagerRuntimeServicesConfiguration,
@@ -63,6 +65,7 @@
 			metricRegistry,
 			resourceManagerRuntimeServices.getJobLeaderIdService(),
 			clusterInformation,
-			fatalErrorHandler);
+			fatalErrorHandler,
+			jobManagerMetricGroup);
 	} }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/clusterframework/ResourceManagerTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/clusterframework/ResourceManagerTest.java&lt;br/&gt;
index 3c1f3dab246..abc31b3d9d3 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-runtime/src/test/java/org/apache/flink/runtime/clusterframework/ResourceManagerTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/clusterframework/ResourceManagerTest.java&lt;br/&gt;
@@ -46,6 +46,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.messages.Acknowledge;&lt;br/&gt;
 import org.apache.flink.runtime.messages.JobManagerMessages;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistryImpl;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
 import org.apache.flink.runtime.registration.RegistrationResponse;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.JobLeaderIdService;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManagerGateway;&lt;br/&gt;
@@ -524,7 +525,8 @@ public void testHeartbeatTimeoutWithTaskExecutor() throws Exception {&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				jobLeaderIdService,&lt;br/&gt;
 				new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;testingFatalErrorHandler);&lt;br/&gt;
+				testingFatalErrorHandler,&lt;br/&gt;
+				UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			resourceManager.start();&lt;/p&gt;

&lt;p&gt;@@ -622,7 +624,8 @@ public void testHeartbeatTimeoutWithJobManager() throws Exception {&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				jobLeaderIdService,&lt;br/&gt;
 				new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler);&lt;br/&gt;
+				testingFatalErrorHandler,&lt;br/&gt;
+				UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			resourceManager.start();&lt;/p&gt;

&lt;p&gt;diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerHATest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerHATest.java&lt;br/&gt;
index b8dee83ed46..f2810a83379 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerHATest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerHATest.java&lt;br/&gt;
@@ -26,6 +26,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.TestingHighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.leaderelection.TestingLeaderElectionService;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistryImpl;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.slotmanager.SlotManagerConfiguration;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.RpcService;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.TestingRpcService;&lt;br/&gt;
@@ -93,7 +94,8 @@ public void confirmLeaderSessionID(UUID leaderId) {&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				resourceManagerRuntimeServices.getJobLeaderIdService(),&lt;br/&gt;
 				new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler) {&lt;br/&gt;
+				testingFatalErrorHandler,&lt;br/&gt;
+				UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup()) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 				@Override&lt;br/&gt;
 				public void revokeLeadership() &lt;/p&gt;
{
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerJobMasterTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerJobMasterTest.java
index 3e630e1bef6..b01ff18ed34 100644
--- a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerJobMasterTest.java
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerJobMasterTest.java
@@ -34,6 +34,7 @@
 import org.apache.flink.runtime.leaderretrieval.SettableLeaderRetrievalService;
 import org.apache.flink.runtime.leaderretrieval.LeaderRetrievalService;
 import org.apache.flink.runtime.metrics.MetricRegistryImpl;
+import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;
 import org.apache.flink.runtime.resourcemanager.exceptions.ResourceManagerException;
 import org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager;
 import org.apache.flink.runtime.rpc.FatalErrorHandler;
@@ -291,7 +292,8 @@ private ResourceManager createAndStartResourceManager(
 			metricRegistry,
 			jobLeaderIdService,
 			new ClusterInformation(&quot;localhost&quot;, 1234),
-			fatalErrorHandler);
+			fatalErrorHandler,
+			UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup());
 		resourceManager.start();
 		return resourceManager;
 	}
&lt;p&gt;diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTaskExecutorTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTaskExecutorTest.java&lt;br/&gt;
index 535271ae105..aa70afdf390 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTaskExecutorTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTaskExecutorTest.java&lt;br/&gt;
@@ -28,6 +28,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.leaderelection.LeaderElectionService;&lt;br/&gt;
 import org.apache.flink.runtime.leaderelection.TestingLeaderElectionService;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistryImpl;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
 import org.apache.flink.runtime.registration.RegistrationResponse;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager;&lt;br/&gt;
 import org.apache.flink.runtime.rest.messages.taskmanager.TaskManagerInfo;&lt;br/&gt;
@@ -212,7 +213,8 @@ private StandaloneResourceManager createAndStartResourceManager(LeaderElectionSe&lt;br/&gt;
 				metricRegistry,&lt;br/&gt;
 				jobLeaderIdService,&lt;br/&gt;
 				new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fatalErrorHandler);&lt;br/&gt;
+				fatalErrorHandler,&lt;br/&gt;
+				UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		resourceManager.start();&lt;/p&gt;

&lt;p&gt;diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTest.java b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTest.java&lt;br/&gt;
index a1f6227be02..08be4270480 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTest.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/ResourceManagerTest.java&lt;br/&gt;
@@ -24,6 +24,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.instance.HardwareDescription;&lt;br/&gt;
 import org.apache.flink.runtime.leaderelection.TestingLeaderElectionService;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.NoOpMetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
 import org.apache.flink.runtime.registration.RegistrationResponse;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager;&lt;br/&gt;
 import org.apache.flink.runtime.rest.messages.taskmanager.TaskManagerInfo;&lt;br/&gt;
@@ -90,7 +91,8 @@ public void testRequestTaskManagerInfo() throws Exception {&lt;br/&gt;
 			slotManager,&lt;br/&gt;
 			NoOpMetricRegistry.INSTANCE,&lt;br/&gt;
 			jobLeaderIdService,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler);&lt;br/&gt;
+			testingFatalErrorHandler,&lt;br/&gt;
+			UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		resourceManager.start();&lt;/p&gt;

&lt;p&gt;diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/TestingResourceManager.java b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/TestingResourceManager.java&lt;br/&gt;
index e8207019a32..3fdc8ce2c20 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/TestingResourceManager.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/resourcemanager/TestingResourceManager.java&lt;br/&gt;
@@ -25,6 +25,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.exceptions.ResourceManagerException;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.slotmanager.SlotManager;&lt;br/&gt;
 import org.apache.flink.runtime.rpc.FatalErrorHandler;&lt;br/&gt;
@@ -49,7 +50,8 @@ public TestingResourceManager(&lt;br/&gt;
 			SlotManager slotManager,&lt;br/&gt;
 			MetricRegistry metricRegistry,&lt;br/&gt;
 			JobLeaderIdService jobLeaderIdService,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;FatalErrorHandler fatalErrorHandler) {&lt;br/&gt;
+			FatalErrorHandler fatalErrorHandler,&lt;br/&gt;
+			JobManagerMetricGroup jobManagerMetricGroup) 
{
 		super(
 			rpcService,
 			resourceManagerEndpointId,
@@ -60,7 +62,8 @@ public TestingResourceManager(
 			metricRegistry,
 			jobLeaderIdService,
 			new ClusterInformation(&quot;localhost&quot;, 1234),
-			fatalErrorHandler);
+			fatalErrorHandler,
+			jobManagerMetricGroup);
 	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorITCase.java b/flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorITCase.java&lt;br/&gt;
index 1081fd159dd..d2b976f9a74 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorITCase.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/taskexecutor/TaskExecutorITCase.java&lt;br/&gt;
@@ -149,7 +149,8 @@ public void testSlotAllocation() throws Exception {&lt;br/&gt;
 			metricRegistry,&lt;br/&gt;
 			jobLeaderIdService,&lt;br/&gt;
 			new ClusterInformation(&quot;localhost&quot;, 1234),&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;testingFatalErrorHandler);&lt;br/&gt;
+			testingFatalErrorHandler,&lt;br/&gt;
+			UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup());&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		final TaskManagerServices taskManagerServices = new TaskManagerServicesBuilder()&lt;br/&gt;
 			.setTaskManagerLocation(taskManagerLocation)&lt;br/&gt;
diff --git a/flink-runtime/src/test/java/org/apache/flink/runtime/webmonitor/TestingRestfulGateway.java b/flink-runtime/src/test/java/org/apache/flink/runtime/webmonitor/TestingRestfulGateway.java&lt;br/&gt;
index 09af236f65a..e97966c4d14 100644&lt;br/&gt;
&amp;#8212; a/flink-runtime/src/test/java/org/apache/flink/runtime/webmonitor/TestingRestfulGateway.java&lt;br/&gt;
+++ b/flink-runtime/src/test/java/org/apache/flink/runtime/webmonitor/TestingRestfulGateway.java&lt;br/&gt;
@@ -29,6 +29,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.jobmaster.JobResult;&lt;br/&gt;
 import org.apache.flink.runtime.messages.Acknowledge;&lt;br/&gt;
 import org.apache.flink.runtime.messages.webmonitor.ClusterOverview;&lt;br/&gt;
+import org.apache.flink.runtime.messages.webmonitor.JobsOverview;&lt;br/&gt;
 import org.apache.flink.runtime.messages.webmonitor.MultipleJobsDetails;&lt;br/&gt;
 import org.apache.flink.runtime.rest.handler.legacy.backpressure.OperatorBackPressureStatsResponse;&lt;/p&gt;

&lt;p&gt;@@ -222,6 +223,7 @@ public static Builder newBuilder() {&lt;br/&gt;
 		protected Function&amp;lt;JobID, CompletableFuture&amp;lt;JobStatus&amp;gt;&amp;gt; requestJobStatusFunction;&lt;br/&gt;
 		protected Supplier&amp;lt;CompletableFuture&amp;lt;MultipleJobsDetails&amp;gt;&amp;gt; requestMultipleJobDetailsSupplier;&lt;br/&gt;
 		protected Supplier&amp;lt;CompletableFuture&amp;lt;ClusterOverview&amp;gt;&amp;gt; requestClusterOverviewSupplier;&lt;br/&gt;
+		protected Supplier&amp;lt;CompletableFuture&amp;lt;JobsOverview&amp;gt;&amp;gt; requestOverviewForAllJobsSupplier;&lt;br/&gt;
 		protected Supplier&amp;lt;CompletableFuture&amp;lt;Collection&amp;lt;String&amp;gt;&amp;gt;&amp;gt; requestMetricQueryServicePathsSupplier;&lt;br/&gt;
 		protected Supplier&amp;lt;CompletableFuture&amp;lt;Collection&amp;lt;Tuple2&amp;lt;ResourceID, String&amp;gt;&amp;gt;&amp;gt;&amp;gt; requestTaskManagerMetricQueryServicePathsSupplier;&lt;br/&gt;
 		protected BiFunction&amp;lt;JobID, JobVertexID, CompletableFuture&amp;lt;OperatorBackPressureStatsResponse&amp;gt;&amp;gt; requestOperatorBackPressureStatsFunction;&lt;br/&gt;
diff --git a/flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java b/flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
new file mode 100644&lt;br/&gt;
index 00000000000..bd70cadda0f&lt;br/&gt;
&amp;#8212; /dev/null&lt;br/&gt;
+++ b/flink-tests/src/test/java/org/apache/flink/runtime/metrics/JobManagerMetricsITCase.java&lt;br/&gt;
@@ -0,0 +1,181 @@&lt;br/&gt;
+/*&lt;br/&gt;
+ * Licensed to the Apache Software Foundation (ASF) under one or more&lt;br/&gt;
+ * contributor license agreements.  See the NOTICE file distributed with&lt;br/&gt;
+ * this work for additional information regarding copyright ownership.&lt;br/&gt;
+ * The ASF licenses this file to You under the Apache License, Version 2.0&lt;br/&gt;
+ * (the &quot;License&quot;); you may not use this file except in compliance with&lt;br/&gt;
+ * the License.  You may obtain a copy of the License at&lt;br/&gt;
+ *&lt;br/&gt;
+ *    &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
+ *&lt;br/&gt;
+ * Unless required by applicable law or agreed to in writing, software&lt;br/&gt;
+ * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;br/&gt;
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;br/&gt;
+ * See the License for the specific language governing permissions and&lt;br/&gt;
+ * limitations under the License.&lt;br/&gt;
+ */&lt;br/&gt;
+&lt;br/&gt;
+package org.apache.flink.runtime.metrics;&lt;br/&gt;
+&lt;br/&gt;
+import org.apache.flink.configuration.Configuration;&lt;br/&gt;
+import org.apache.flink.core.testutils.BlockerSync;&lt;br/&gt;
+import org.apache.flink.core.testutils.CheckedThread;&lt;br/&gt;
+import org.apache.flink.metrics.Gauge;&lt;br/&gt;
+import org.apache.flink.metrics.MetricConfig;&lt;br/&gt;
+import org.apache.flink.metrics.reporter.AbstractReporter;&lt;br/&gt;
+import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.sink.PrintSinkFunction;&lt;br/&gt;
+import org.apache.flink.streaming.api.functions.source.SourceFunction;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResource;&lt;br/&gt;
+import org.apache.flink.test.util.MiniClusterResourceConfiguration;&lt;br/&gt;
+import org.apache.flink.util.TestLogger;&lt;br/&gt;
+&lt;br/&gt;
+import org.junit.Before;&lt;br/&gt;
+import org.junit.ClassRule;&lt;br/&gt;
+import org.junit.Test;&lt;br/&gt;
+&lt;br/&gt;
+import java.util.ArrayList;&lt;br/&gt;
+import java.util.Collection;&lt;br/&gt;
+import java.util.List;&lt;br/&gt;
+import java.util.Map;&lt;br/&gt;
+import java.util.Set;&lt;br/&gt;
+import java.util.concurrent.ConcurrentHashMap;&lt;br/&gt;
+&lt;br/&gt;
+import static org.junit.Assert.assertEquals;&lt;br/&gt;
+import static org.junit.Assert.fail;&lt;br/&gt;
+&lt;br/&gt;
+/**&lt;br/&gt;
+ * Integration tests for proper initialization of the job manager metrics.&lt;br/&gt;
+ */&lt;br/&gt;
+public class JobManagerMetricsITCase extends TestLogger {&lt;br/&gt;
+&lt;br/&gt;
+	private static final String JOB_MANAGER_METRICS_PREFIX = &quot;localhost.jobmanager.&quot;;&lt;br/&gt;
+&lt;br/&gt;
+	private static final BlockerSync sync = new BlockerSync();&lt;br/&gt;
+&lt;br/&gt;
+	private CheckedThread jobExecuteThread;&lt;br/&gt;
+&lt;br/&gt;
+	@ClassRule&lt;br/&gt;
+	public static final MiniClusterResource MINI_CLUSTER_RESOURCE = new MiniClusterResource(&lt;br/&gt;
+		new MiniClusterResourceConfiguration.Builder()&lt;br/&gt;
+			.setConfiguration(getConfiguration())&lt;br/&gt;
+			.setNumberTaskManagers(1)&lt;br/&gt;
+			.setNumberSlotsPerTaskManager(1)&lt;br/&gt;
+			.build());&lt;br/&gt;
+&lt;br/&gt;
+	@Before&lt;br/&gt;
+	public void setUp() throws Exception {&lt;br/&gt;
+		jobExecuteThread = new CheckedThread() {&lt;br/&gt;
+&lt;br/&gt;
+			@Override&lt;br/&gt;
+			public void go() throws Exception {&lt;br/&gt;
+				StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();&lt;br/&gt;
+				env.addSource(new SourceFunction&amp;lt;String&amp;gt;() {&lt;br/&gt;
+&lt;br/&gt;
+					@Override&lt;br/&gt;
+					public void run(SourceContext&amp;lt;String&amp;gt; ctx) throws Exception &lt;/p&gt;
{
+						sync.block();
+					}
&lt;p&gt;+&lt;br/&gt;
+					@Override&lt;br/&gt;
+					public void cancel() &lt;/p&gt;
{
+						sync.releaseBlocker();
+					}
&lt;p&gt;+&lt;br/&gt;
+				}).addSink(new PrintSinkFunction());&lt;br/&gt;
+&lt;br/&gt;
+				env.execute();&lt;br/&gt;
+			}&lt;br/&gt;
+&lt;br/&gt;
+		};&lt;br/&gt;
+&lt;br/&gt;
+		jobExecuteThread.start();&lt;br/&gt;
+		sync.awaitBlocker();&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	@Test&lt;br/&gt;
+	public void testJobManagerMetrics() throws Exception {&lt;br/&gt;
+		assertEquals(1, TestReporter.OPENED_REPORTERS.size());&lt;br/&gt;
+		TestReporter reporter = TestReporter.OPENED_REPORTERS.iterator().next();&lt;br/&gt;
+&lt;br/&gt;
+		List&amp;lt;String&amp;gt; expectedPatterns = getExpectedPatterns();&lt;br/&gt;
+&lt;br/&gt;
+		Collection&amp;lt;String&amp;gt; gaugeNames = reporter.getGauges().values();&lt;br/&gt;
+&lt;br/&gt;
+		for (String expectedPattern : expectedPatterns) {&lt;br/&gt;
+			boolean found = false;&lt;br/&gt;
+			for (String gaugeName : gaugeNames) {&lt;br/&gt;
+				if (gaugeName.matches(expectedPattern)) &lt;/p&gt;
{
+					found = true;
+				}
&lt;p&gt;+			}&lt;br/&gt;
+			if (!found) &lt;/p&gt;
{
+				fail(String.format(&quot;Failed to find gauge [%s] in registered gauges [%s]&quot;,
+					expectedPattern, gaugeNames));
+			}
&lt;p&gt;+		}&lt;br/&gt;
+&lt;br/&gt;
+		for (Map.Entry&amp;lt;Gauge&amp;lt;?&amp;gt;, String&amp;gt; entry : reporter.getGauges().entrySet()) {&lt;br/&gt;
+			if (entry.getValue().contains(MetricNames.TASK_SLOTS_AVAILABLE)) &lt;/p&gt;
{
+				assertEquals(0L, entry.getKey().getValue());
+			}
&lt;p&gt; else if (entry.getValue().contains(MetricNames.TASK_SLOTS_TOTAL)) &lt;/p&gt;
{
+				assertEquals(1L, entry.getKey().getValue());
+			} else if (entry.getValue().contains(MetricNames.NUM_REGISTERED_TASK_MANAGERS)) {+				assertEquals(1L, entry.getKey().getValue());+			}
&lt;p&gt; else if (entry.getValue().contains(MetricNames.NUM_RUNNING_JOBS)) &lt;/p&gt;
{
+				assertEquals(1L, entry.getKey().getValue());
+			}
&lt;p&gt;+		}&lt;br/&gt;
+&lt;br/&gt;
+		sync.releaseBlocker();&lt;br/&gt;
+		jobExecuteThread.sync();&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	private static Configuration getConfiguration() &lt;/p&gt;
{
+		Configuration configuration = new Configuration();
+		configuration.setString(&quot;metrics.reporter.test_reporter.class&quot;, TestReporter.class.getName());
+		return configuration;
+	}
&lt;p&gt;+&lt;br/&gt;
+	private static List&amp;lt;String&amp;gt; getExpectedPatterns() {&lt;br/&gt;
+		String[] expectedGauges = new String[]&lt;/p&gt;
{
+			MetricNames.TASK_SLOTS_AVAILABLE,
+			MetricNames.TASK_SLOTS_TOTAL,
+			MetricNames.NUM_REGISTERED_TASK_MANAGERS,
+			MetricNames.NUM_RUNNING_JOBS
+		}
&lt;p&gt;;&lt;br/&gt;
+&lt;br/&gt;
+		List&amp;lt;String&amp;gt; patterns = new ArrayList&amp;lt;&amp;gt;();&lt;br/&gt;
+		for (String expectedGauge : expectedGauges) &lt;/p&gt;
{
+			patterns.add(JOB_MANAGER_METRICS_PREFIX + expectedGauge);
+		}
&lt;p&gt;+&lt;br/&gt;
+		return patterns;&lt;br/&gt;
+	}&lt;br/&gt;
+&lt;br/&gt;
+	/**&lt;br/&gt;
+	 * Test metric reporter that exposes registered metrics.&lt;br/&gt;
+	 */&lt;br/&gt;
+	public static final class TestReporter extends AbstractReporter {&lt;br/&gt;
+		public static final Set&amp;lt;TestReporter&amp;gt; OPENED_REPORTERS = ConcurrentHashMap.newKeySet();&lt;br/&gt;
+&lt;br/&gt;
+		@Override&lt;br/&gt;
+		public String filterCharacters(String input) &lt;/p&gt;
{
+			return input;
+		}
&lt;p&gt;+&lt;br/&gt;
+		@Override&lt;br/&gt;
+		public void open(MetricConfig config) &lt;/p&gt;
{
+			OPENED_REPORTERS.add(this);
+		}
&lt;p&gt;+&lt;br/&gt;
+		@Override&lt;br/&gt;
+		public void close() &lt;/p&gt;
{
+			OPENED_REPORTERS.remove(this);
+		}
&lt;p&gt;+&lt;br/&gt;
+		public Map&amp;lt;Gauge&amp;lt;?&amp;gt;, String&amp;gt; getGauges() &lt;/p&gt;
{
+			return gauges;
+		}
&lt;p&gt;+	}&lt;br/&gt;
+}&lt;br/&gt;
diff --git a/flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java b/flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java&lt;br/&gt;
index 2a43b8b7f1a..6ff5cd66487 100644&lt;br/&gt;
&amp;#8212; a/flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java&lt;br/&gt;
+++ b/flink-yarn/src/main/java/org/apache/flink/yarn/YarnResourceManager.java&lt;br/&gt;
@@ -32,6 +32,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.JobLeaderIdService;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManager;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.exceptions.ResourceManagerException;&lt;br/&gt;
@@ -131,7 +132,8 @@ public YarnResourceManager(&lt;br/&gt;
 			JobLeaderIdService jobLeaderIdService,&lt;br/&gt;
 			ClusterInformation clusterInformation,&lt;br/&gt;
 			FatalErrorHandler fatalErrorHandler,&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Nullable String webInterfaceUrl) {&lt;br/&gt;
+			@Nullable String webInterfaceUrl,&lt;br/&gt;
+			JobManagerMetricGroup jobManagerMetricGroup) {&lt;br/&gt;
 		super(&lt;br/&gt;
 			rpcService,&lt;br/&gt;
 			resourceManagerEndpointId,&lt;br/&gt;
@@ -142,7 +144,8 @@ public YarnResourceManager(&lt;br/&gt;
 			metricRegistry,&lt;br/&gt;
 			jobLeaderIdService,&lt;br/&gt;
 			clusterInformation,&lt;/li&gt;
	&lt;li&gt;fatalErrorHandler);&lt;br/&gt;
+			fatalErrorHandler,&lt;br/&gt;
+			jobManagerMetricGroup);&lt;br/&gt;
 		this.flinkConfig  = flinkConfig;&lt;br/&gt;
 		this.yarnConfig = new YarnConfiguration();&lt;br/&gt;
 		this.env = env;&lt;br/&gt;
diff --git a/flink-yarn/src/main/java/org/apache/flink/yarn/entrypoint/YarnResourceManagerFactory.java b/flink-yarn/src/main/java/org/apache/flink/yarn/entrypoint/YarnResourceManagerFactory.java&lt;br/&gt;
index bfd1b4a07ed..fc7c4e48e6a 100644
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-yarn/src/main/java/org/apache/flink/yarn/entrypoint/YarnResourceManagerFactory.java&lt;br/&gt;
+++ b/flink-yarn/src/main/java/org/apache/flink/yarn/entrypoint/YarnResourceManagerFactory.java&lt;br/&gt;
@@ -24,6 +24,7 @@&lt;br/&gt;
 import org.apache.flink.runtime.heartbeat.HeartbeatServices;&lt;br/&gt;
 import org.apache.flink.runtime.highavailability.HighAvailabilityServices;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManager;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManagerFactory;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManagerRuntimeServices;&lt;br/&gt;
@@ -51,7 +52,8 @@&lt;br/&gt;
 			MetricRegistry metricRegistry,&lt;br/&gt;
 			FatalErrorHandler fatalErrorHandler,&lt;br/&gt;
 			ClusterInformation clusterInformation,&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;@Nullable String webInterfaceUrl) throws Exception 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+			@Nullable String webInterfaceUrl,+			JobManagerMetricGroup jobManagerMetricGroup) throws Exception {
 		final ResourceManagerRuntimeServicesConfiguration rmServicesConfiguration = ResourceManagerRuntimeServicesConfiguration.fromConfiguration(configuration);
 		final ResourceManagerRuntimeServices rmRuntimeServices = ResourceManagerRuntimeServices.fromConfiguration(
 			rmServicesConfiguration,
@@ -71,6 +73,7 @@
 			rmRuntimeServices.getJobLeaderIdService(),
 			clusterInformation,
 			fatalErrorHandler,
-			webInterfaceUrl);
+			webInterfaceUrl,
+			jobManagerMetricGroup);
 	} }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;diff --git a/flink-yarn/src/test/java/org/apache/flink/yarn/YarnResourceManagerTest.java b/flink-yarn/src/test/java/org/apache/flink/yarn/YarnResourceManagerTest.java&lt;br/&gt;
index a7d4f43672d..d41d42d7a05 100644&lt;/p&gt;
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;a/flink-yarn/src/test/java/org/apache/flink/yarn/YarnResourceManagerTest.java&lt;br/&gt;
+++ b/flink-yarn/src/test/java/org/apache/flink/yarn/YarnResourceManagerTest.java&lt;br/&gt;
@@ -39,6 +39,8 @@&lt;br/&gt;
 import org.apache.flink.runtime.messages.Acknowledge;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.MetricRegistry;&lt;br/&gt;
 import org.apache.flink.runtime.metrics.NoOpMetricRegistry;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.JobManagerMetricGroup;&lt;br/&gt;
+import org.apache.flink.runtime.metrics.groups.UnregisteredMetricGroups;&lt;br/&gt;
 import org.apache.flink.runtime.registration.RegistrationResponse;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.JobLeaderIdService;&lt;br/&gt;
 import org.apache.flink.runtime.resourcemanager.ResourceManagerGateway;&lt;br/&gt;
@@ -177,7 +179,8 @@ public void teardown() throws Exception {&lt;br/&gt;
 				FatalErrorHandler fatalErrorHandler,&lt;br/&gt;
 				@Nullable String webInterfaceUrl,&lt;br/&gt;
 				AMRMClientAsync&amp;lt;AMRMClient.ContainerRequest&amp;gt; mockResourceManagerClient,&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;NMClient mockNMClient) {&lt;br/&gt;
+				NMClient mockNMClient,&lt;br/&gt;
+				JobManagerMetricGroup jobManagerMetricGroup) {&lt;br/&gt;
 			super(&lt;br/&gt;
 				rpcService,&lt;br/&gt;
 				resourceManagerEndpointId,&lt;br/&gt;
@@ -191,7 +194,8 @@ public void teardown() throws Exception 
{
 				jobLeaderIdService,
 				clusterInformation,
 				fatalErrorHandler,
-				webInterfaceUrl);
+				webInterfaceUrl,
+				jobManagerMetricGroup);
 			this.mockNMClient = mockNMClient;
 			this.mockResourceManagerClient = mockResourceManagerClient;
 		}
&lt;p&gt;@@ -248,6 +252,8 @@ protected void runAsync(final Runnable runnable) {&lt;br/&gt;
 		public NMClient mockNMClient = mock(NMClient.class);&lt;br/&gt;
 		public AMRMClientAsync&amp;lt;AMRMClient.ContainerRequest&amp;gt; mockResourceManagerClient =&lt;br/&gt;
 				mock(AMRMClientAsync.class);&lt;br/&gt;
+		public JobManagerMetricGroup mockJMMetricGroup =&lt;br/&gt;
+				UnregisteredMetricGroups.createUnregisteredJobManagerMetricGroup();&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Create mock RM dependencies.&lt;br/&gt;
@@ -274,7 +280,8 @@ protected void runAsync(final Runnable runnable) 
{
 							testingFatalErrorHandler,
 							null,
 							mockResourceManagerClient,
-							mockNMClient);
+							mockNMClient,
+							mockJMMetricGroup);
 		}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 		/**&lt;/p&gt;




&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16649753" author="zentol" created="Mon, 15 Oct 2018 05:44:07 +0000"  >&lt;p&gt;master: 4ff6483f367591b894726ed1874c813c786b588a&lt;/p&gt;</comment>
                            <comment id="16650441" author="zentol" created="Mon, 15 Oct 2018 16:26:16 +0000"  >&lt;p&gt;1.6: 5b5d95334a91bf7d51a8c02c0d168a6d4ad006e9&lt;br/&gt;
1.5: d09d06a0b53fec0d681eaa8e788f7984f5318191&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13184537">FLINK-10322</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x09z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>