<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Tue Nov 11 20:51:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FLINK-14076] &apos;ClassNotFoundException: KafkaException&apos; on Flink v1.9 w/ checkpointing</title>
                <link>https://issues.apache.org/jira/browse/FLINK-14076</link>
                <project id="12315522" key="FLINK">Flink</project>
                    <description>&lt;p&gt;A Flink job that worked with checkpointing on a Flink v1.8.0 cluster fails on a Flink v1.9.0 cluster with checkpointing. It works on a Flink v1.9.0 cluster&#160;&lt;em&gt;without&lt;/em&gt;&#160;checkpointing. It is specifically &lt;em&gt;enabling checkpointing&#160;on v1.9.0&lt;/em&gt; that causes the JM to start throwing ClassNotFoundExceptions. Full stacktrace:&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12980335/12980335_error.txt&quot; title=&quot;error.txt attached to FLINK-14076&quot;&gt;error.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The job reads from Kafka via FlinkKafkaConsumer and writes to Kafka via FlinkKafkaProducer.&lt;/p&gt;

&lt;p&gt;The jobmanagers and taskmanagers are standalone.&lt;/p&gt;

&lt;p&gt;The exception is being raised deep in some Flink serialization code, so I&apos;m not sure how to go about stepping through this in a debugger. The issue is happening in an internal repository at my job, but I can try to get a minimal repro on GitHub if it&apos;s not obvious from the error message alone what&apos;s broken.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13256702">FLINK-14076</key>
            <summary>&apos;ClassNotFoundException: KafkaException&apos; on Flink v1.9 w/ checkpointing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdm2212">Jeffrey Martin</assignee>
                                    <reporter username="jdm2212">Jeffrey Martin</reporter>
                        <labels>
                            <label>pull-request-available</label>
                    </labels>
                <created>Sat, 14 Sep 2019 21:26:35 +0000</created>
                <updated>Fri, 25 Oct 2019 05:03:41 +0000</updated>
                            <resolved>Tue, 24 Sep 2019 17:21:06 +0000</resolved>
                                    <version>1.9.0</version>
                                    <fixVersion>1.9.1</fixVersion>
                    <fixVersion>1.10.0</fixVersion>
                                    <component>Connectors / Kafka</component>
                    <component>Runtime / Checkpointing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="600">10m</timespent>
                                <comments>
                            <comment id="16931704" author="jdm2212" created="Tue, 17 Sep 2019 17:54:09 +0000"  >&lt;p&gt;It looks like this is due to a KafkaException getting thrown while Flink is trying to checkpoint. The KafkaException gets wrapped in a &apos;DeclineCheckpoint&apos; and sent back to the JobManager. The JobManager can&apos;t deserialize it because the JobManager&apos;s classpath does not include org.apache.kafka:kafka-clients by default.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Gonna dig in some more and see if I can figure out which exception is at fault.&lt;/p&gt;</comment>
                            <comment id="16931775" author="jdm2212" created="Tue, 17 Sep 2019 19:56:58 +0000"  >&lt;p&gt;Confirmed: the issue is that FlinkKafkaProducer#checkErroneous throws a wrapped KafkaException, which causes a ClassNotFoundException when it hits the JobManager. Not sure how/why this is different on Flink v1.9 vs v1.8.&lt;/p&gt;</comment>
                            <comment id="16932737" author="jdm2212" created="Wed, 18 Sep 2019 18:37:03 +0000"  >&lt;p&gt;Two steps to get the JobManager to stay happy:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;add &apos;org.apache.kafka:kafka-clients:2.2.0&apos; (and all its transitive deps) to the JM and TM classpaths&lt;/li&gt;
	&lt;li&gt;add this config entry in the JM and TM:&#160;&lt;em&gt;classloader.parent-first-patterns.additional: &quot;org.apache.kafka.;org.apache.commons.&quot;&lt;/em&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The first one is necessary to allow JM to deserialize exceptions from failed checkpoints. The second one is necessary to ensure that all code uses those jars and there aren&apos;t conflicts of the form &quot;can&apos;t assign &lt;em&gt;LinkedMap from TM classpath&lt;/em&gt; to field of type &lt;em&gt;LinkedMap from task classpath&lt;/em&gt;&quot;&lt;/p&gt;</comment>
                            <comment id="16935296" author="terry1897" created="Sun, 22 Sep 2019 12:08:36 +0000"  >&lt;p&gt;This problem  is caused by TM and JM jar package environment inconsistent or jar loaded behavior inconsistent in nature.&lt;br/&gt;
Maybe the behavior  of standalone cluster&#8217;s dynamic class loader changed in flink 1.9 since you mentioned that your program run normally in flink 1.8.&lt;/p&gt;</comment>
                            <comment id="16937016" author="till.rohrmann" created="Tue, 24 Sep 2019 17:21:07 +0000"  >&lt;p&gt;Fixed via&lt;/p&gt;

&lt;p&gt;1.10.0: 2bcf5094919a0b3e6db99efcea0b259826f59ad0&lt;br/&gt;
1.9.1: 9ee42ec6b009f1c4da7265851e23cfaa45f4c83a&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                            <outwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13264222">FLINK-14519</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12980335" name="error.txt" size="8467" author="jdm2212" created="Sat, 14 Sep 2019 21:01:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06nag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>