{"url":"https://api.github.com/repos/phax/jcodemodel/issues/71","repository_url":"https://api.github.com/repos/phax/jcodemodel","labels_url":"https://api.github.com/repos/phax/jcodemodel/issues/71/labels{/name}","comments_url":"https://api.github.com/repos/phax/jcodemodel/issues/71/comments","events_url":"https://api.github.com/repos/phax/jcodemodel/issues/71/events","html_url":"https://github.com/phax/jcodemodel/issues/71","id":499775739,"node_id":"MDU6SXNzdWU0OTk3NzU3Mzk=","number":71,"title":"[proposal] check class name against keywords and java.lang","user":{"login":"guiguilechat","id":26408407,"node_id":"MDQ6VXNlcjI2NDA4NDA3","avatar_url":"https://avatars.githubusercontent.com/u/26408407?v=4","gravatar_id":"","url":"https://api.github.com/users/guiguilechat","html_url":"https://github.com/guiguilechat","followers_url":"https://api.github.com/users/guiguilechat/followers","following_url":"https://api.github.com/users/guiguilechat/following{/other_user}","gists_url":"https://api.github.com/users/guiguilechat/gists{/gist_id}","starred_url":"https://api.github.com/users/guiguilechat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guiguilechat/subscriptions","organizations_url":"https://api.github.com/users/guiguilechat/orgs","repos_url":"https://api.github.com/users/guiguilechat/repos","events_url":"https://api.github.com/users/guiguilechat/events{/privacy}","received_events_url":"https://api.github.com/users/guiguilechat/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":55904943,"node_id":"MDU6TGFiZWw1NTkwNDk0Mw==","url":"https://api.github.com/repos/phax/jcodemodel/labels/enhancement","name":"enhancement","color":"84b6eb","default":true,"description":null}],"state":"closed","locked":false,"assignee":{"login":"phax","id":196219,"node_id":"MDQ6VXNlcjE5NjIxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/196219?v=4","gravatar_id":"","url":"https://api.github.com/users/phax","html_url":"https://github.com/phax","followers_url":"https://api.github.com/users/phax/followers","following_url":"https://api.github.com/users/phax/following{/other_user}","gists_url":"https://api.github.com/users/phax/gists{/gist_id}","starred_url":"https://api.github.com/users/phax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/phax/subscriptions","organizations_url":"https://api.github.com/users/phax/orgs","repos_url":"https://api.github.com/users/phax/repos","events_url":"https://api.github.com/users/phax/events{/privacy}","received_events_url":"https://api.github.com/users/phax/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"phax","id":196219,"node_id":"MDQ6VXNlcjE5NjIxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/196219?v=4","gravatar_id":"","url":"https://api.github.com/users/phax","html_url":"https://github.com/phax","followers_url":"https://api.github.com/users/phax/followers","following_url":"https://api.github.com/users/phax/following{/other_user}","gists_url":"https://api.github.com/users/phax/gists{/gist_id}","starred_url":"https://api.github.com/users/phax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/phax/subscriptions","organizations_url":"https://api.github.com/users/phax/orgs","repos_url":"https://api.github.com/users/phax/repos","events_url":"https://api.github.com/users/phax/events{/privacy}","received_events_url":"https://api.github.com/users/phax/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":10,"created_at":"2019-09-28T13:53:28Z","updated_at":"2019-10-08T15:56:02Z","closed_at":"2019-10-08T14:26:50Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Keywords\r\n\r\nsee #70 for the keywords \r\n\r\n# java.lang\r\n\r\n## Issue \r\n\r\nThis is an issue because this package is already imported and as such not referenced to.\r\n\r\nTypically if I create a my.package.Object class and then I create a method \r\n\r\n    @Override\r\n    boolean equals(java.lang.Object other) \r\n\r\nThe object other actually refers to the class I am crating, and not the java.lang.Object class.\r\nThis issue literally happened to me when compiling against a openapi web service that produces \"Object\" responses.\r\n\r\n## Detection\r\n\r\nThis issue is very complicated : since the java reflection works bottom-up, that is the classes know their package but the package doesn't know its classes, it's difficult to find if the class exists without a java.lang.class.forName(\"java.lang.\"+sName), with trycatch around. This expensive call requires to cache the result in a hasmap<String, Boolean>\r\n\r\nhere is my code\r\n\r\n\tprivate static final HashMap<String, Boolean> resolvedJavaLangNames = new HashMap<>();\r\n\t\r\n         /**\r\n\t * check if a name already represents a class in the java.lang package. eg\r\n\t * String should return true, but LeetH4X0R should not.\r\n\t * \r\n\t * @param className\r\n\t *          name to test\r\n\t * @return the existence of such a class in the java.lang (cached)\r\n\t */\r\n\tpublic static boolean isJavaLangClass(String className) {\r\n\t\tif (resolvedJavaLangNames.containsKey(className)) {\r\n\t\t\treturn resolvedJavaLangNames.get(className);\r\n\t\t}\r\n\t\tboolean isJavaLang = true;\r\n\t\ttry {\r\n\t\t\tClass.forName(\"java.lang.\" + className);\r\n\t\t} catch (Exception e) {\r\n\t\t\tisJavaLang = false;\r\n\t\t}\r\n\t\tresolvedJavaLangNames.put(className, isJavaLang);\r\n\t\treturn isJavaLang;\r\n\t}\r\n\r\nLooking at how fast it is to use JCodeModel, I consider the use of synchronization to be worthless (I usually don't and thus would have synced over the hashmap in the method)\r\n\r\nIt should check for specific exception (security exception means I can't tell)\r\n\r\n## Reaction\r\n\r\nIn the case the class C is in java.lang already, two possibilities : \r\n- internally mark the class C as javaLangMisleading, so that all call to a java.lang.C are specifically written as such\r\n- throw an exception (bad - unless in the option)\r\n\r\nIMO both should be available. mark the class C as misleading , AND allow users to avoid this with a compilation option.\r\n\r\nEspecially, I'm not sure how to make the misleading part, since the writing of the class names may be done without the knowledge of where that name is used.","closed_by":{"login":"phax","id":196219,"node_id":"MDQ6VXNlcjE5NjIxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/196219?v=4","gravatar_id":"","url":"https://api.github.com/users/phax","html_url":"https://github.com/phax","followers_url":"https://api.github.com/users/phax/followers","following_url":"https://api.github.com/users/phax/following{/other_user}","gists_url":"https://api.github.com/users/phax/gists{/gist_id}","starred_url":"https://api.github.com/users/phax/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/phax/subscriptions","organizations_url":"https://api.github.com/users/phax/orgs","repos_url":"https://api.github.com/users/phax/repos","events_url":"https://api.github.com/users/phax/events{/privacy}","received_events_url":"https://api.github.com/users/phax/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/phax/jcodemodel/issues/71/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/phax/jcodemodel/issues/71/timeline","performed_via_github_app":null,"state_reason":"completed"}