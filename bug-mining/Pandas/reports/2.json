{"url":"https://api.github.com/repos/pandas-dev/pandas/issues/54033","repository_url":"https://api.github.com/repos/pandas-dev/pandas","labels_url":"https://api.github.com/repos/pandas-dev/pandas/issues/54033/labels{/name}","comments_url":"https://api.github.com/repos/pandas-dev/pandas/issues/54033/comments","events_url":"https://api.github.com/repos/pandas-dev/pandas/issues/54033/events","html_url":"https://github.com/pandas-dev/pandas/issues/54033","id":1793165696,"node_id":"I_kwDOAA0YD85q4YmA","number":54033,"title":"ENH: series.is_constant","user":{"login":"sbrugman","id":9756388,"node_id":"MDQ6VXNlcjk3NTYzODg=","avatar_url":"https://avatars.githubusercontent.com/u/9756388?v=4","gravatar_id":"","url":"https://api.github.com/users/sbrugman","html_url":"https://github.com/sbrugman","followers_url":"https://api.github.com/users/sbrugman/followers","following_url":"https://api.github.com/users/sbrugman/following{/other_user}","gists_url":"https://api.github.com/users/sbrugman/gists{/gist_id}","starred_url":"https://api.github.com/users/sbrugman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sbrugman/subscriptions","organizations_url":"https://api.github.com/users/sbrugman/orgs","repos_url":"https://api.github.com/users/sbrugman/repos","events_url":"https://api.github.com/users/sbrugman/events{/privacy}","received_events_url":"https://api.github.com/users/sbrugman/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":76812,"node_id":"MDU6TGFiZWw3NjgxMg==","url":"https://api.github.com/repos/pandas-dev/pandas/labels/Enhancement","name":"Enhancement","color":"4E9A06","default":false,"description":null},{"id":1357732944,"node_id":"MDU6TGFiZWwxMzU3NzMyOTQ0","url":"https://api.github.com/repos/pandas-dev/pandas/labels/Series","name":"Series","color":"8dd5fc","default":false,"description":"Series data structure"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-07-07T09:33:08Z","updated_at":"2023-07-12T15:40:27Z","closed_at":"2023-07-12T15:40:26Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Feature Type\r\n\r\n- [X] Adding new functionality to pandas\r\n\r\n- [ ] Changing existing functionality in pandas\r\n\r\n- [ ] Removing existing functionality in pandas\r\n\r\n\r\n### Problem Description\r\n\r\nPandas Series have a property [`is_unique`](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.is_unique.html) that returns true iff all values are distinct. \r\n\r\nIn practice, one often needs to know if a Series is constant. Getting a functional result when series do not contain nans is straight forward: `(series.values[0] == series.values).all()`. However, [in the wild](https://github.com/search?q=%22nunique%28%29+%3D%3D+1%22+language%3APython+&type=code) we observe that users often simply write `series.nunique() == 1`. This approach is more costly for larger series, as it first computes the number of unique values before comparing.\r\n\r\nMy assumption is that introducing a dedicated `is_constant` property will help users choose the more performant option. Another assumption is that its acceptable that all-nan series are somewhat slower.\r\n\r\n![perf_short_circuit](https://github.com/pandas-dev/pandas/assets/9756388/88986548-b121-46ce-9dde-328ce2da92d6)\r\n\r\n```python\r\ndef setup(n):\r\n    return pd.Series(list(range(n)))\r\n```\r\n\r\n![perf_worst](https://github.com/pandas-dev/pandas/assets/9756388/0409dcd6-4d1c-4144-85f6-5a44c575ff27)\r\n\r\n```python\r\ndef setup(n):\r\n    return pd.Series([1] * (n - 1) + [2])\r\n```\r\n\r\n### Feature Description\r\n\r\n```python\r\n@property\r\ndef is_constant():\r\n    if v.shape[0] == 0:\r\n        return False\r\n    return (v[0] == v).all()\r\n```\r\n\r\n(based on `is_unique` and `nunique`, in the absence of nans)\r\n\r\nTo extend to NA values:\r\nIf `dropna=True`: add `v = remove_na_arraylike(v)`\r\nIf  `dropna=False`: add `or not pd.notna(v).any()` (note: differs from `np.unique` for `pd.NA` and `np.nan` mixed series by lack of disambiguation between the two)\r\n\r\n### Alternative Solutions\r\n\r\nRecommend the approach above for `series.nunique() == 1` patterns in the documentation ([here](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.Series.nunique.html))\r\n\r\n### Additional Context\r\n\r\n_No response_","closed_by":{"login":"mroeschke","id":10647082,"node_id":"MDQ6VXNlcjEwNjQ3MDgy","avatar_url":"https://avatars.githubusercontent.com/u/10647082?v=4","gravatar_id":"","url":"https://api.github.com/users/mroeschke","html_url":"https://github.com/mroeschke","followers_url":"https://api.github.com/users/mroeschke/followers","following_url":"https://api.github.com/users/mroeschke/following{/other_user}","gists_url":"https://api.github.com/users/mroeschke/gists{/gist_id}","starred_url":"https://api.github.com/users/mroeschke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mroeschke/subscriptions","organizations_url":"https://api.github.com/users/mroeschke/orgs","repos_url":"https://api.github.com/users/mroeschke/repos","events_url":"https://api.github.com/users/mroeschke/events{/privacy}","received_events_url":"https://api.github.com/users/mroeschke/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pandas-dev/pandas/issues/54033/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pandas-dev/pandas/issues/54033/timeline","performed_via_github_app":null,"state_reason":"completed"}