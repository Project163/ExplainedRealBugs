{"url":"https://api.github.com/repos/pandas-dev/pandas/issues/54564","repository_url":"https://api.github.com/repos/pandas-dev/pandas","labels_url":"https://api.github.com/repos/pandas-dev/pandas/issues/54564/labels{/name}","comments_url":"https://api.github.com/repos/pandas-dev/pandas/issues/54564/comments","events_url":"https://api.github.com/repos/pandas-dev/pandas/issues/54564/events","html_url":"https://github.com/pandas-dev/pandas/issues/54564","id":1852099915,"node_id":"I_kwDOAA0YD85uZM1L","number":54564,"title":"BUG: pd.read_excel with engine \"xlrd\" fails when a cell contains NaN/inf","user":{"login":"burnpanck","id":1310437,"node_id":"MDQ6VXNlcjEzMTA0Mzc=","avatar_url":"https://avatars.githubusercontent.com/u/1310437?v=4","gravatar_id":"","url":"https://api.github.com/users/burnpanck","html_url":"https://github.com/burnpanck","followers_url":"https://api.github.com/users/burnpanck/followers","following_url":"https://api.github.com/users/burnpanck/following{/other_user}","gists_url":"https://api.github.com/users/burnpanck/gists{/gist_id}","starred_url":"https://api.github.com/users/burnpanck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burnpanck/subscriptions","organizations_url":"https://api.github.com/users/burnpanck/orgs","repos_url":"https://api.github.com/users/burnpanck/repos","events_url":"https://api.github.com/users/burnpanck/events{/privacy}","received_events_url":"https://api.github.com/users/burnpanck/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":76811,"node_id":"MDU6TGFiZWw3NjgxMQ==","url":"https://api.github.com/repos/pandas-dev/pandas/labels/Bug","name":"Bug","color":"e10c02","default":false,"description":null},{"id":2822342,"node_id":"MDU6TGFiZWwyODIyMzQy","url":"https://api.github.com/repos/pandas-dev/pandas/labels/Missing-data","name":"Missing-data","color":"d7e102","default":false,"description":"np.nan, pd.NaT, pd.NA, dropna, isnull, interpolate"},{"id":47232590,"node_id":"MDU6TGFiZWw0NzIzMjU5MA==","url":"https://api.github.com/repos/pandas-dev/pandas/labels/IO%20SQL","name":"IO SQL","color":"5319e7","default":false,"description":"to_sql, read_sql, read_sql_query"},{"id":49254273,"node_id":"MDU6TGFiZWw0OTI1NDI3Mw==","url":"https://api.github.com/repos/pandas-dev/pandas/labels/IO%20Excel","name":"IO Excel","color":"bfe5bf","default":false,"description":"read_excel, to_excel"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pandas-dev/pandas/milestones/109","html_url":"https://github.com/pandas-dev/pandas/milestone/109","labels_url":"https://api.github.com/repos/pandas-dev/pandas/milestones/109/labels","id":9785210,"node_id":"MI_kwDOAA0YD84AlU96","number":109,"title":"2.2","description":"on-merge: backport to 2.2.x","creator":{"login":"lithomas1","id":47963215,"node_id":"MDQ6VXNlcjQ3OTYzMjE1","avatar_url":"https://avatars.githubusercontent.com/u/47963215?v=4","gravatar_id":"","url":"https://api.github.com/users/lithomas1","html_url":"https://github.com/lithomas1","followers_url":"https://api.github.com/users/lithomas1/followers","following_url":"https://api.github.com/users/lithomas1/following{/other_user}","gists_url":"https://api.github.com/users/lithomas1/gists{/gist_id}","starred_url":"https://api.github.com/users/lithomas1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lithomas1/subscriptions","organizations_url":"https://api.github.com/users/lithomas1/orgs","repos_url":"https://api.github.com/users/lithomas1/repos","events_url":"https://api.github.com/users/lithomas1/events{/privacy}","received_events_url":"https://api.github.com/users/lithomas1/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":899,"state":"closed","created_at":"2023-08-13T07:21:54Z","updated_at":"2024-07-26T08:04:45Z","due_on":"2024-01-17T08:00:00Z","closed_at":"2024-01-22T18:13:53Z"},"comments":4,"created_at":"2023-08-15T20:41:22Z","updated_at":"2023-08-21T18:40:17Z","closed_at":"2023-08-21T18:40:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Pandas version checks\r\n\r\n- [X] I have checked that this issue has not already been reported.\r\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\r\n- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\r\n\r\n\r\n### Reproducible Example\r\n\r\n```python\r\nimport tempfile\r\nfrom pathlib import Path\r\n\r\nimport numpy as np\r\nimport pandas as pd\r\n# xlwt is just needed to conveniently create a test-case here\r\nimport xlwt\r\n\r\ninp = np.r_[:3,np.nan].reshape(2,2)\r\nprint(d)\r\nwb = xlwt.Workbook()\r\nws = wb.add_sheet('Sheet')\r\nfor (i,j),v in np.ndenumerate(inp):\r\n    ws.write(i,j,v)\r\nwith tempfile.TemporaryDirectory() as tdir:\r\n    fn = str(Path(tdir)/\".xls\")\r\n    wb.save(fn)\r\n    out = pd.read_excel(fn, engine=\"xlrd\")\r\n```\r\n\r\n\r\n### Issue Description\r\n\r\nNote that a very similar issue was reported previously: #33853.\r\nHowever, that one relaed to the `openpyxl` engine and was thus closed as to be fixed upstream.\r\nIt appears that pandas does however vendor `xlrd` (and there is no issue tracker on the xlrd repo), so I believe this issue belongs here.\r\n\r\n`pd.read_excel` with `engine=\"xlrd\"` (as required to read `xls` files) fails when the input document contains infinity values:\r\n\r\n```\r\n...\r\nFile ~/.pyenv/versions/3.11.3/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/pandas/io/excel/_xlrd.py:109, in XlrdReader.get_sheet_data.<locals>._parse_cell(cell_contents, cell_typ)\r\n    105     cell_contents = bool(cell_contents)\r\n    106 elif cell_typ == XL_CELL_NUMBER:\r\n    107     # GH5394 - Excel 'numbers' are always floats\r\n    108     # it's a minimal perf hit and less surprising\r\n--> 109     val = int(cell_contents)\r\n    110     if val == cell_contents:\r\n    111         cell_contents = val\r\n\r\nValueError: cannot convert float NaN to integer\r\n```\r\n\r\n### Expected Behavior\r\n\r\n`pd.read_excel` should succeed.\r\n\r\n### Installed Versions\r\n\r\n<details>\r\n\r\nINSTALLED VERSIONS\r\n------------------\r\ncommit           : 0f437949513225922d851e9581723d82120684a6\r\npython           : 3.11.3.final.0\r\npython-bits      : 64\r\nOS               : Darwin\r\nOS-release       : 22.5.0\r\nVersion          : Darwin Kernel Version 22.5.0: Thu Jun  8 22:22:20 PDT 2023; root:xnu-8796.121.3~7/RELEASE_ARM64_T6000\r\nmachine          : arm64\r\nprocessor        : arm\r\nbyteorder        : little\r\nLC_ALL           : de_CH.UTF-8\r\nLANG             : en_GB.UTF-8\r\nLOCALE           : de_CH.UTF-8\r\n\r\npandas           : 2.0.3\r\nnumpy            : 1.23.5\r\npytz             : 2023.3\r\ndateutil         : 2.8.2\r\nsetuptools       : 65.5.0\r\npip              : 23.1.2\r\nCython           : 0.29.34\r\npytest           : 7.3.1\r\nhypothesis       : None\r\nsphinx           : None\r\nblosc            : None\r\nfeather          : None\r\nxlsxwriter       : 3.1.2\r\nlxml.etree       : None\r\nhtml5lib         : 1.1\r\npymysql          : None\r\npsycopg2         : None\r\njinja2           : 3.1.2\r\nIPython          : 8.12.0\r\npandas_datareader: None\r\nbs4              : 4.12.2\r\nbottleneck       : None\r\nbrotli           : None\r\nfastparquet      : None\r\nfsspec           : None\r\ngcsfs            : None\r\nmatplotlib       : 3.7.1\r\nnumba            : 0.57.0\r\nnumexpr          : 2.8.4\r\nodfpy            : None\r\nopenpyxl         : 3.1.2\r\npandas_gbq       : None\r\npyarrow          : 11.0.0\r\npyreadstat       : None\r\npyxlsb           : None\r\ns3fs             : None\r\nscipy            : 1.10.1\r\nsnappy           : None\r\nsqlalchemy       : None\r\ntables           : None\r\ntabulate         : None\r\nxarray           : 2023.4.2\r\nxlrd             : 2.0.1\r\nzstandard        : None\r\ntzdata           : 2023.3\r\nqtpy             : None\r\npyqt5            : None\r\n\r\n</details>\r\n","closed_by":{"login":"mroeschke","id":10647082,"node_id":"MDQ6VXNlcjEwNjQ3MDgy","avatar_url":"https://avatars.githubusercontent.com/u/10647082?v=4","gravatar_id":"","url":"https://api.github.com/users/mroeschke","html_url":"https://github.com/mroeschke","followers_url":"https://api.github.com/users/mroeschke/followers","following_url":"https://api.github.com/users/mroeschke/following{/other_user}","gists_url":"https://api.github.com/users/mroeschke/gists{/gist_id}","starred_url":"https://api.github.com/users/mroeschke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mroeschke/subscriptions","organizations_url":"https://api.github.com/users/mroeschke/orgs","repos_url":"https://api.github.com/users/mroeschke/repos","events_url":"https://api.github.com/users/mroeschke/events{/privacy}","received_events_url":"https://api.github.com/users/mroeschke/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pandas-dev/pandas/issues/54564/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pandas-dev/pandas/issues/54564/timeline","performed_via_github_app":null,"state_reason":"completed"}