{"url":"https://api.github.com/repos/pandas-dev/pandas/issues/59429","repository_url":"https://api.github.com/repos/pandas-dev/pandas","labels_url":"https://api.github.com/repos/pandas-dev/pandas/issues/59429/labels{/name}","comments_url":"https://api.github.com/repos/pandas-dev/pandas/issues/59429/comments","events_url":"https://api.github.com/repos/pandas-dev/pandas/issues/59429/events","html_url":"https://github.com/pandas-dev/pandas/issues/59429","id":2451652706,"node_id":"I_kwDOAA0YD86SIUBi","number":59429,"title":"BUG: stacked bar graphs show invalid label position due to invalid rectangle bottom when data is 0","user":{"login":"KinzigFlyer","id":43356610,"node_id":"MDQ6VXNlcjQzMzU2NjEw","avatar_url":"https://avatars.githubusercontent.com/u/43356610?v=4","gravatar_id":"","url":"https://api.github.com/users/KinzigFlyer","html_url":"https://github.com/KinzigFlyer","followers_url":"https://api.github.com/users/KinzigFlyer/followers","following_url":"https://api.github.com/users/KinzigFlyer/following{/other_user}","gists_url":"https://api.github.com/users/KinzigFlyer/gists{/gist_id}","starred_url":"https://api.github.com/users/KinzigFlyer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KinzigFlyer/subscriptions","organizations_url":"https://api.github.com/users/KinzigFlyer/orgs","repos_url":"https://api.github.com/users/KinzigFlyer/repos","events_url":"https://api.github.com/users/KinzigFlyer/events{/privacy}","received_events_url":"https://api.github.com/users/KinzigFlyer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":76811,"node_id":"MDU6TGFiZWw3NjgxMQ==","url":"https://api.github.com/repos/pandas-dev/pandas/labels/Bug","name":"Bug","color":"e10c02","default":false,"description":null},{"id":2413328,"node_id":"MDU6TGFiZWwyNDEzMzI4","url":"https://api.github.com/repos/pandas-dev/pandas/labels/Visualization","name":"Visualization","color":"8AE234","default":false,"description":"plotting"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pandas-dev/pandas/milestones/102","html_url":"https://github.com/pandas-dev/pandas/milestone/102","labels_url":"https://api.github.com/repos/pandas-dev/pandas/milestones/102/labels","id":9021906,"node_id":"MI_kwDOAA0YD84AianS","number":102,"title":"3.0","description":"","creator":{"login":"jbrockmendel","id":8078968,"node_id":"MDQ6VXNlcjgwNzg5Njg=","avatar_url":"https://avatars.githubusercontent.com/u/8078968?v=4","gravatar_id":"","url":"https://api.github.com/users/jbrockmendel","html_url":"https://github.com/jbrockmendel","followers_url":"https://api.github.com/users/jbrockmendel/followers","following_url":"https://api.github.com/users/jbrockmendel/following{/other_user}","gists_url":"https://api.github.com/users/jbrockmendel/gists{/gist_id}","starred_url":"https://api.github.com/users/jbrockmendel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbrockmendel/subscriptions","organizations_url":"https://api.github.com/users/jbrockmendel/orgs","repos_url":"https://api.github.com/users/jbrockmendel/repos","events_url":"https://api.github.com/users/jbrockmendel/events{/privacy}","received_events_url":"https://api.github.com/users/jbrockmendel/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":18,"closed_issues":2308,"state":"open","created_at":"2023-02-08T18:16:49Z","updated_at":"2025-11-08T20:40:33Z","due_on":null,"closed_at":null},"comments":11,"created_at":"2024-08-06T20:37:42Z","updated_at":"2024-11-07T21:32:56Z","closed_at":"2024-11-07T21:32:56Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Pandas version checks\n\n- [X] I have checked that this issue has not already been reported.\n\n- [X] I have confirmed this bug exists on the [latest version](https://pandas.pydata.org/docs/whatsnew/index.html) of pandas.\n\n- [X] I have confirmed this bug exists on the [main branch](https://pandas.pydata.org/docs/dev/getting_started/install.html#installing-the-development-version-of-pandas) of pandas.\n\n\n### Reproducible Example\n\n```python\nimport pandas as pd\r\nimport matplotlib.pyplot as plt\r\npermutations = [(a,b,c) for a in range(2) for b in range(2) for c in range(3)]\r\ndata = [\r\n    {'i': i, 'a':a, 'b':b, 'c':c, 't': a+b+c}\r\n    for i, (a,b,c) in enumerate(permutations)\r\n]\r\ndf = pd.DataFrame.from_dict(data)\r\nax = df[['a','b', 'c']].plot.bar(stacked=True)\r\nbl = ax.bar_label(ax.containers[-1], df['t'])\r\nplt.show()\n```\n\n\n### Issue Description\n\nif the top part of the stacked plot has data value 0, the bar-label does not appear on top, but at the bottom of the bar.\r\n![grafik](https://github.com/user-attachments/assets/2c839adf-44e6-445e-bba5-0af33eef04af)\r\n\r\nFurther debugging shows that all bars with data = 0 have their y position set to 0.0. They should have the top of the bar below as their bottom = y.\n\n### Expected Behavior\n\nBar-Labels should be positioned on top for all stacks.\r\n\r\n![grafik](https://github.com/user-attachments/assets/58c5bc3d-1e21-41bc-8804-f2f5516ae593)\r\n\r\nthis behaviour can be produced by correcting the y positions of the defective bars\r\n\r\n```\r\ndef correct_stack(container, info=False):\r\n    \"\"\" correct the y positions of stacked bars with 0 height\r\n\r\n    This is needed because the y position is calculated wrongly when data value is 0 on stacked bars created by Pandas plot.bar.\r\n    \"\"\"\r\n    # Attention, since we start at row 1, r shows to the row below - which we need\r\n    for r, row in enumerate(container[1:]):\r\n        for b, bar in enumerate(row):\r\n            (my_x, my_y), my_height = bar.xy, bar.get_height()\r\n            # note that r show to the bar below the current bar, and c is the stack\r\n            support = container[r][b]    # this is the bar we are resting on top of\r\n            (s_x, s_y), s_height = support.xy, support.get_height()\r\n            if info:\r\n                print(f\"bar at row: {r+1}, col: {b}: ({my_x}, {my_y}) - {my_height} resting on top of ({s_x, s_y}) - {s_height}\")\r\n            if my_y < s_y + s_height:\r\n                print(f\"bar at row: {r+1}, col: {b}: {my_y = } is lower than expected {s_y + s_height}\")\r\n                bar.xy = (my_x, s_y + s_height)\r\n\r\nax2 = df[['a','b','c']].plot.bar(stacked=True)\r\ncorrect_stack(ax2.containers)\r\nbl = ax2.bar_label(ax2.containers[-1], df['t'])\r\nplt.show()\r\n```\r\n\n\n### Installed Versions\n\nINSTALLED VERSIONS\r\n------------------\r\ncommit                : d9cdd2ee5a58015ef6f4d15c7226110c9aab8140\r\npython                : 3.11.9.final.0\r\npython-bits           : 64\r\nOS                    : Windows\r\nOS-release            : 10\r\nVersion               : 10.0.22631\r\nmachine               : AMD64\r\nprocessor             : Intel64 Family 6 Model 186 Stepping 2, GenuineIntel\r\nbyteorder             : little\r\nLC_ALL                : None\r\nLANG                  : None\r\nLOCALE                : de_DE.cp1252\r\n\r\npandas                : 2.2.2\r\nnumpy                 : 2.0.1\r\npytz                  : 2024.1\r\ndateutil              : 2.9.0.post0\r\nsetuptools            : 65.5.0\r\npip                   : 24.2\r\nCython                : None\r\npytest                : None\r\nhypothesis            : None\r\nsphinx                : None\r\nblosc                 : None\r\nfeather               : None\r\nxlsxwriter            : None\r\nlxml.etree            : None\r\nhtml5lib              : None\r\npymysql               : None\r\npsycopg2              : None\r\njinja2                : 3.1.4\r\nIPython               : 8.26.0\r\npandas_datareader     : None\r\nadbc-driver-postgresql: None\r\nadbc-driver-sqlite    : None\r\nbs4                   : 4.12.3\r\nbottleneck            : None\r\ndataframe-api-compat  : None\r\nfastparquet           : None\r\nfsspec                : None\r\ngcsfs                 : None\r\nmatplotlib            : 3.9.1\r\nnumba                 : None\r\nnumexpr               : None\r\nodfpy                 : None\r\nopenpyxl              : None\r\npandas_gbq            : None\r\npyarrow               : None\r\npyreadstat            : None\r\npython-calamine       : None\r\npyxlsb                : None\r\ns3fs                  : None\r\nscipy                 : 1.14.0\r\nsqlalchemy            : None\r\ntables                : None\r\ntabulate              : None\r\nxarray                : None\r\nxlrd                  : None\r\nzstandard             : None\r\ntzdata                : 2024.1\r\nqtpy                  : None\r\npyqt5                 : None\r\n","closed_by":{"login":"rhshadrach","id":45562402,"node_id":"MDQ6VXNlcjQ1NTYyNDAy","avatar_url":"https://avatars.githubusercontent.com/u/45562402?v=4","gravatar_id":"","url":"https://api.github.com/users/rhshadrach","html_url":"https://github.com/rhshadrach","followers_url":"https://api.github.com/users/rhshadrach/followers","following_url":"https://api.github.com/users/rhshadrach/following{/other_user}","gists_url":"https://api.github.com/users/rhshadrach/gists{/gist_id}","starred_url":"https://api.github.com/users/rhshadrach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rhshadrach/subscriptions","organizations_url":"https://api.github.com/users/rhshadrach/orgs","repos_url":"https://api.github.com/users/rhshadrach/repos","events_url":"https://api.github.com/users/rhshadrach/events{/privacy}","received_events_url":"https://api.github.com/users/rhshadrach/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pandas-dev/pandas/issues/59429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pandas-dev/pandas/issues/59429/timeline","performed_via_github_app":null,"state_reason":"completed"}