diff --git a/src/main/java/one/util/streamex/DoubleStreamEx.java b/src/main/java/one/util/streamex/DoubleStreamEx.java
index e70d7c5..fc20298 100644
--- a/src/main/java/one/util/streamex/DoubleStreamEx.java
+++ b/src/main/java/one/util/streamex/DoubleStreamEx.java
@@ -252,7 +252,7 @@ public class DoubleStreamEx implements DoubleStream {
      * @since 0.4.1
      */
     public DoubleStreamEx mapFirst(DoubleUnaryOperator mapper) {
-        return boxed().mapFirst(mapper::applyAsDouble).mapToDouble(Double::doubleValue);
+        return delegate(new PairSpliterator.PSOfDouble((a, b) -> b, mapper, stream.spliterator(), PairSpliterator.MODE_MAP_FIRST));
     }
 
     /**
@@ -271,7 +271,7 @@ public class DoubleStreamEx implements DoubleStream {
      * @since 0.4.1
      */
     public DoubleStreamEx mapLast(DoubleUnaryOperator mapper) {
-        return boxed().mapLast(mapper::applyAsDouble).mapToDouble(Double::doubleValue);
+        return delegate(new PairSpliterator.PSOfDouble((a, b) -> a, mapper, stream.spliterator(), PairSpliterator.MODE_MAP_LAST));
     }
 
     @Override
@@ -1320,7 +1320,7 @@ public class DoubleStreamEx implements DoubleStream {
      * @since 0.2.1
      */
     public DoubleStreamEx pairMap(DoubleBinaryOperator mapper) {
-        return delegate(new PairSpliterator.PSOfDouble(mapper, stream.spliterator()));
+        return delegate(new PairSpliterator.PSOfDouble(mapper, null, stream.spliterator(), PairSpliterator.MODE_PAIRS));
     }
 
     /**
diff --git a/src/main/java/one/util/streamex/IntStreamEx.java b/src/main/java/one/util/streamex/IntStreamEx.java
index bcf4a78..aa928ac 100644
--- a/src/main/java/one/util/streamex/IntStreamEx.java
+++ b/src/main/java/one/util/streamex/IntStreamEx.java
@@ -1504,7 +1504,7 @@ public class IntStreamEx implements IntStream {
      * @since 0.2.1
      */
     public IntStreamEx pairMap(IntBinaryOperator mapper) {
-        return delegate(new PairSpliterator.PSOfInt(mapper, stream.spliterator()));
+        return delegate(new PairSpliterator.PSOfInt(mapper, null, stream.spliterator(), PairSpliterator.MODE_PAIRS));
     }
 
     /**
@@ -1619,7 +1619,7 @@ public class IntStreamEx implements IntStream {
      * @since 0.4.1
      */
     public IntStreamEx mapFirst(IntUnaryOperator mapper) {
-        return mapToObj(Integer::new).mapFirst(mapper::applyAsInt).mapToInt(Integer::intValue);
+        return delegate(new PairSpliterator.PSOfInt((a, b) -> b, mapper, stream.spliterator(), PairSpliterator.MODE_MAP_FIRST));
     }
 
     /**
@@ -1638,7 +1638,7 @@ public class IntStreamEx implements IntStream {
      * @since 0.4.1
      */
     public IntStreamEx mapLast(IntUnaryOperator mapper) {
-        return mapToObj(Integer::new).mapLast(mapper::applyAsInt).mapToInt(Integer::intValue);
+        return delegate(new PairSpliterator.PSOfInt((a, b) -> a, mapper, stream.spliterator(), PairSpliterator.MODE_MAP_LAST));
     }
 
     /**
diff --git a/src/main/java/one/util/streamex/LongStreamEx.java b/src/main/java/one/util/streamex/LongStreamEx.java
index 27cc0a9..941d53b 100644
--- a/src/main/java/one/util/streamex/LongStreamEx.java
+++ b/src/main/java/one/util/streamex/LongStreamEx.java
@@ -281,7 +281,7 @@ public class LongStreamEx implements LongStream {
      * @since 0.4.1
      */
     public LongStreamEx mapFirst(LongUnaryOperator mapper) {
-        return mapToObj(Long::new).mapFirst(mapper::applyAsLong).mapToLong(Long::longValue);
+        return delegate(new PairSpliterator.PSOfLong((a, b) -> b, mapper, stream.spliterator(), PairSpliterator.MODE_MAP_FIRST));
     }
 
     /**
@@ -300,7 +300,7 @@ public class LongStreamEx implements LongStream {
      * @since 0.4.1
      */
     public LongStreamEx mapLast(LongUnaryOperator mapper) {
-        return mapToObj(Long::new).mapLast(mapper::applyAsLong).mapToLong(Long::longValue);
+        return delegate(new PairSpliterator.PSOfLong((a, b) -> a, mapper, stream.spliterator(), PairSpliterator.MODE_MAP_LAST));
     }
 
     @Override
@@ -1347,7 +1347,7 @@ public class LongStreamEx implements LongStream {
      * @since 0.2.1
      */
     public LongStreamEx pairMap(LongBinaryOperator mapper) {
-        return delegate(new PairSpliterator.PSOfLong(mapper, stream.spliterator()));
+        return delegate(new PairSpliterator.PSOfLong(mapper, null, stream.spliterator(), PairSpliterator.MODE_PAIRS));
     }
 
     /**
diff --git a/src/main/java/one/util/streamex/PairSpliterator.java b/src/main/java/one/util/streamex/PairSpliterator.java
index 4ed3bac..119112e 100644
--- a/src/main/java/one/util/streamex/PairSpliterator.java
+++ b/src/main/java/one/util/streamex/PairSpliterator.java
@@ -21,10 +21,14 @@ import java.util.function.BiFunction;
 import java.util.function.Consumer;
 import java.util.function.DoubleBinaryOperator;
 import java.util.function.DoubleConsumer;
+import java.util.function.DoubleUnaryOperator;
+import java.util.function.Function;
 import java.util.function.IntBinaryOperator;
 import java.util.function.IntConsumer;
+import java.util.function.IntUnaryOperator;
 import java.util.function.LongBinaryOperator;
 import java.util.function.LongConsumer;
+import java.util.function.LongUnaryOperator;
 
 import static one.util.streamex.StreamExInternals.*;
 
@@ -33,16 +37,21 @@ import static one.util.streamex.StreamExInternals.*;
  */
 /* package */abstract class PairSpliterator<T, S extends Spliterator<T>, R, SS extends PairSpliterator<T, S, R, SS>>
         implements Spliterator<R>, Cloneable {
+    static final int MODE_PAIRS = 0;
+    static final int MODE_MAP_FIRST = 1;
+    static final int MODE_MAP_LAST = 2;
+    
     private static Sink<?> EMPTY = new Sink<>(null);
     // Common lock for all the derived spliterators
-    private final Object lock = new Object();
+    final Object lock = new Object();
+    final int mode;
     S source;
     @SuppressWarnings("unchecked")
     Sink<T> left = (Sink<T>) EMPTY;
     @SuppressWarnings("unchecked")
     Sink<T> right = (Sink<T>) EMPTY;
 
-    private static final class Sink<T> {
+    static final class Sink<T> {
         Sink<T> other;
         private T payload = none();
         private final Object lock;
@@ -107,8 +116,20 @@ import static one.util.streamex.StreamExInternals.*;
         }
     }
 
-    PairSpliterator(S source) {
+    PairSpliterator(S source, int mode, T headTail) {
         this.source = source;
+        this.mode = mode;
+        if(mode != MODE_PAIRS) {
+            Sink<T> sink = new Sink<>(this.lock);
+            Sink<T> other = new Sink<>(this.lock);
+            sink.other = other;
+            other.other = sink;
+            other.push(headTail, null, true);
+            if(mode == MODE_MAP_FIRST)
+                this.left = sink;
+            else
+                this.right = sink;
+        }
     }
 
     @Override
@@ -154,16 +175,28 @@ import static one.util.streamex.StreamExInternals.*;
         }
     }
 
-    static final class PSOfRef<T, R> extends PairSpliterator<T, Spliterator<T>, R, PSOfRef<T, R>> implements
+    static class PSOfRef<T, R> extends PairSpliterator<T, Spliterator<T>, R, PSOfRef<T, R>> implements
             Consumer<T> {
+        private static final Object HEAD_TAIL = new Object();
+
         private final BiFunction<? super T, ? super T, ? extends R> mapper;
         private T cur;
 
-        public PSOfRef(BiFunction<? super T, ? super T, ? extends R> mapper, Spliterator<T> source) {
-            super(source);
+        PSOfRef(BiFunction<? super T, ? super T, ? extends R> mapper, Spliterator<T> source) {
+            super(source, MODE_PAIRS, null);
             this.mapper = mapper;
         }
 
+        // Must be called only if T == R
+        @SuppressWarnings("unchecked")
+        PSOfRef(Function<? super T, ? extends R> mapper, Spliterator<T> source, boolean first) {
+            super(source, first ? MODE_MAP_FIRST : MODE_MAP_LAST, (T)HEAD_TAIL);
+            BiFunction<? super T, ? super T, ?> m = first ? 
+                    ((a, b) -> a == HEAD_TAIL ? mapper.apply(b) : (T)b) :
+                    ((a, b) -> b == HEAD_TAIL ? mapper.apply(a) : (T)a);
+            this.mapper = (BiFunction<? super T, ? super T, ? extends R>) m;
+        }
+
         @Override
         public void accept(T t) {
             cur = t;
@@ -212,20 +245,29 @@ import static one.util.streamex.StreamExInternals.*;
     static final class PSOfInt extends PairSpliterator<Integer, Spliterator.OfInt, Integer, PSOfInt> implements
             Spliterator.OfInt, IntConsumer {
         private final IntBinaryOperator mapper;
+        private final IntUnaryOperator unaryMapper;
         private int cur;
 
-        public PSOfInt(IntBinaryOperator mapper, Spliterator.OfInt source) {
-            super(source);
+        PSOfInt(IntBinaryOperator mapper, IntUnaryOperator unaryMapper, Spliterator.OfInt source, int mode) {
+            super(source, mode, null);
             this.mapper = mapper;
+            this.unaryMapper = unaryMapper;
         }
-
+        
         @Override
         public void accept(int t) {
             cur = t;
         }
 
         private BiConsumer<Integer, Integer> fn(IntConsumer action) {
-            return (a, b) -> action.accept(mapper.applyAsInt(a, b));
+            switch(mode) {
+            case MODE_MAP_FIRST:
+                return (a, b) -> action.accept(a == null ? unaryMapper.applyAsInt(b) : b);
+            case MODE_MAP_LAST:
+                return (a, b) -> action.accept(b == null ? unaryMapper.applyAsInt(a) : a);
+            default:
+                return (a, b) -> action.accept(mapper.applyAsInt(a, b));
+            }
         }
 
         @Override
@@ -267,11 +309,13 @@ import static one.util.streamex.StreamExInternals.*;
     static final class PSOfLong extends PairSpliterator<Long, Spliterator.OfLong, Long, PSOfLong> implements
             Spliterator.OfLong, LongConsumer {
         private final LongBinaryOperator mapper;
+        private final LongUnaryOperator unaryMapper;
         private long cur;
 
-        public PSOfLong(LongBinaryOperator mapper, Spliterator.OfLong source) {
-            super(source);
+        PSOfLong(LongBinaryOperator mapper, LongUnaryOperator unaryMapper, Spliterator.OfLong source, int mode) {
+            super(source, mode, null);
             this.mapper = mapper;
+            this.unaryMapper = unaryMapper;
         }
 
         @Override
@@ -280,7 +324,14 @@ import static one.util.streamex.StreamExInternals.*;
         }
 
         private BiConsumer<Long, Long> fn(LongConsumer action) {
-            return (a, b) -> action.accept(mapper.applyAsLong(a, b));
+            switch(mode) {
+            case MODE_MAP_FIRST:
+                return (a, b) -> action.accept(a == null ? unaryMapper.applyAsLong(b) : b);
+            case MODE_MAP_LAST:
+                return (a, b) -> action.accept(b == null ? unaryMapper.applyAsLong(a) : a);
+            default:
+                return (a, b) -> action.accept(mapper.applyAsLong(a, b));
+            }
         }
 
         @Override
@@ -322,11 +373,13 @@ import static one.util.streamex.StreamExInternals.*;
     static final class PSOfDouble extends PairSpliterator<Double, Spliterator.OfDouble, Double, PSOfDouble> implements
             Spliterator.OfDouble, DoubleConsumer {
         private final DoubleBinaryOperator mapper;
+        private final DoubleUnaryOperator unaryMapper;
         private double cur;
 
-        public PSOfDouble(DoubleBinaryOperator mapper, Spliterator.OfDouble source) {
-            super(source);
+        PSOfDouble(DoubleBinaryOperator mapper, DoubleUnaryOperator unaryMapper, Spliterator.OfDouble source, int mode) {
+            super(source, mode, null);
             this.mapper = mapper;
+            this.unaryMapper = unaryMapper;
         }
 
         @Override
@@ -335,7 +388,14 @@ import static one.util.streamex.StreamExInternals.*;
         }
 
         private BiConsumer<Double, Double> fn(DoubleConsumer action) {
-            return (a, b) -> action.accept(mapper.applyAsDouble(a, b));
+            switch(mode) {
+            case MODE_MAP_FIRST:
+                return (a, b) -> action.accept(a == null ? unaryMapper.applyAsDouble(b) : b);
+            case MODE_MAP_LAST:
+                return (a, b) -> action.accept(b == null ? unaryMapper.applyAsDouble(a) : a);
+            default:
+                return (a, b) -> action.accept(mapper.applyAsDouble(a, b));
+            }
         }
 
         @Override
diff --git a/src/main/java/one/util/streamex/StreamEx.java b/src/main/java/one/util/streamex/StreamEx.java
index 12eea9c..dc94d78 100644
--- a/src/main/java/one/util/streamex/StreamEx.java
+++ b/src/main/java/one/util/streamex/StreamEx.java
@@ -206,15 +206,7 @@ public class StreamEx<T> extends AbstractStreamEx<T, StreamEx<T>> {
      * @since 0.4.1
      */
     public StreamEx<T> mapFirst(Function<? super T, ? extends T> mapper) {
-        // Cannot reuse NONE object here as the object appears in the stream and
-        // might become visible to other pipeline steps
-        // thus new Object is necessary every time
-        @SuppressWarnings("unchecked")
-        T first = (T) new Object();
-        Stream<T> none = Stream.of(first);
-        return strategy().newStreamEx(
-            delegate(new PairSpliterator.PSOfRef<T, T>((a, b) -> (a == first ? mapper.apply(b) : b), Stream.concat(
-                none, stream).spliterator())));
+        return strategy().newStreamEx(delegate(new PairSpliterator.PSOfRef<>(mapper, stream.spliterator(), true)));
     }
 
     /**
@@ -233,15 +225,7 @@ public class StreamEx<T> extends AbstractStreamEx<T, StreamEx<T>> {
      * @since 0.4.1
      */
     public StreamEx<T> mapLast(Function<? super T, ? extends T> mapper) {
-        // Cannot reuse NONE object here as the object appears in the stream and
-        // might become visible to other pipeline steps
-        // thus new Object is necessary every time
-        @SuppressWarnings("unchecked")
-        T last = (T) new Object();
-        Stream<T> none = Stream.of(last);
-        return strategy().newStreamEx(
-            delegate(new PairSpliterator.PSOfRef<T, T>((a, b) -> (b == last ? mapper.apply(a) : a), Stream.concat(
-                stream, none).spliterator())));
+        return strategy().newStreamEx(delegate(new PairSpliterator.PSOfRef<>(mapper, stream.spliterator(), false)));
     }
 
     /**
diff --git a/src/test/java/one/util/streamex/IntStreamExTest.java b/src/test/java/one/util/streamex/IntStreamExTest.java
index 7b87387..7bd0926 100644
--- a/src/test/java/one/util/streamex/IntStreamExTest.java
+++ b/src/test/java/one/util/streamex/IntStreamExTest.java
@@ -41,6 +41,8 @@ import java.util.stream.Collectors;
 import java.util.stream.IntStream;
 import java.util.stream.StreamSupport;
 
+import static one.util.streamex.TestHelpers.*;
+
 import org.junit.Test;
 
 import static org.junit.Assert.*;
@@ -620,8 +622,11 @@ public class IntStreamExTest {
         String str = "testString";
         assertEquals("TestString", IntStreamEx.ofCodePoints(str).mapFirst(Character::toUpperCase).codePointsToString());
 
-        assertArrayEquals(new int[] { -1, 2, 3, 4, 7 }, IntStreamEx.of(1, 2, 3, 4, 5).mapFirst(x -> x - 2).mapLast(
-            x -> x + 2).toArray());
+        streamEx(() -> StreamEx.of(1, 2, 3, 4, 5), s -> {
+            assertArrayEquals(new int[] { -3, 2, 3, 4, 9 }, s.get().mapToInt(Integer::intValue).mapFirst(x -> x - 2)
+                    .mapLast(x -> x + 2).mapFirst(x -> x - 2)
+                    .mapLast(x -> x + 2).toArray());
+        });
     }
 
     @Test
diff --git a/src/test/java/one/util/streamex/PairSpliteratorTest.java b/src/test/java/one/util/streamex/PairSpliteratorTest.java
index 50a9d56..e3473cb 100644
--- a/src/test/java/one/util/streamex/PairSpliteratorTest.java
+++ b/src/test/java/one/util/streamex/PairSpliteratorTest.java
@@ -34,11 +34,24 @@ public class PairSpliteratorTest {
     @Test
     public void testSpliterator() {
         int[] ints = IntStreamEx.of(new Random(1), 100).toArray();
-        checkSpliterator("pair", () -> new PairSpliterator.PSOfRef<>((a, b) -> (a - b), Arrays.spliterator(ints)));
-        checkSpliterator("pair", () -> new PairSpliterator.PSOfInt((a, b) -> (a - b), Arrays.spliterator(ints)));
         long[] longs = LongStreamEx.of(new Random(1), 100).toArray();
-        checkSpliterator("pair", () -> new PairSpliterator.PSOfLong((a, b) -> (a - b), Arrays.spliterator(longs)));
         double[] doubles = DoubleStreamEx.of(new Random(1), 100).toArray();
-        checkSpliterator("pair", () -> new PairSpliterator.PSOfDouble((a, b) -> (a - b), Arrays.spliterator(doubles)));
+
+        checkSpliterator("ref", () -> new PairSpliterator.PSOfRef<>((a, b) -> (a - b), Arrays.spliterator(ints)));
+        checkSpliterator("int", () -> new PairSpliterator.PSOfInt((a, b) -> (a - b), null, Arrays.spliterator(ints), PairSpliterator.MODE_PAIRS));
+        checkSpliterator("long", () -> new PairSpliterator.PSOfLong((a, b) -> (a - b), null, Arrays.spliterator(longs), PairSpliterator.MODE_PAIRS));
+        checkSpliterator("double", () -> new PairSpliterator.PSOfDouble((a, b) -> (a - b), null, Arrays.spliterator(doubles), PairSpliterator.MODE_PAIRS));
+        
+        // mapFirst
+        checkSpliterator("ref", () -> new PairSpliterator.PSOfRef<>(a -> a + 2, Arrays.spliterator(ints), false));
+        checkSpliterator("int", () -> new PairSpliterator.PSOfInt((a, b) -> b, a -> a+2, Arrays.spliterator(ints), PairSpliterator.MODE_MAP_FIRST));
+        checkSpliterator("long", () -> new PairSpliterator.PSOfLong((a, b) -> b, a -> a+2, Arrays.spliterator(longs), PairSpliterator.MODE_MAP_FIRST));
+        checkSpliterator("double", () -> new PairSpliterator.PSOfDouble((a, b) -> b, a -> a+2, Arrays.spliterator(doubles), PairSpliterator.MODE_MAP_FIRST));
+        
+        // mapLast
+        checkSpliterator("ref", () -> new PairSpliterator.PSOfRef<>(a -> a + 2, Arrays.spliterator(ints), false));
+        checkSpliterator("int", () -> new PairSpliterator.PSOfInt((a, b) -> a, a -> a+2, Arrays.spliterator(ints), PairSpliterator.MODE_MAP_LAST));
+        checkSpliterator("long", () -> new PairSpliterator.PSOfLong((a, b) -> a, a -> a+2, Arrays.spliterator(longs), PairSpliterator.MODE_MAP_LAST));
+        checkSpliterator("double", () -> new PairSpliterator.PSOfDouble((a, b) -> a, a -> a+2, Arrays.spliterator(doubles), PairSpliterator.MODE_MAP_LAST));
     }
 }
diff --git a/src/test/java/one/util/streamex/StreamExTest.java b/src/test/java/one/util/streamex/StreamExTest.java
index 86c0409..8ae0796 100644
--- a/src/test/java/one/util/streamex/StreamExTest.java
+++ b/src/test/java/one/util/streamex/StreamExTest.java
@@ -1448,9 +1448,16 @@ public class StreamExTest {
     public void testMapFirstLast() {
         streamEx(() -> StreamEx.of(0, 343, 999), s -> assertEquals(asList(2, 343, 997), s.get().mapFirst(x -> x + 2)
                 .mapLast(x -> x - 2).toList()));
-        streamEx(() -> IntStreamEx.range(1000).boxed(), s -> assertEquals(asList(2, 343, 997), s.get().filter(
-            x -> x == 0 || x == 343 || x == 999).mapFirst(x -> x + 2).mapLast(x -> x - 2).toList()));
-        Supplier<Stream<Integer>> base = () -> IntStreamEx.range(50).boxed().foldLeft(StreamEx.of(0),
+        streamEx(() -> IntStreamEx.range(1000).boxed(), s -> {
+            assertEquals(asList(2, 343, 997), s.get().filter(
+                x -> x == 0 || x == 343 || x == 999).mapFirst(x -> x + 2).mapLast(x -> x - 2).toList());
+            assertEquals(asList(4, 343, 997), s.get().filter(x -> x == 0 || x == 343 || x == 999).mapFirst(x -> x + 2)
+                    .mapFirst(x -> x + 2).mapLast(x -> x - 2).toList());
+        });
+        Supplier<Stream<Integer>> base = () -> IntStreamEx.rangeClosed(49, 0, -1).boxed().foldLeft(StreamEx.of(0),
+            (stream, i) -> stream.prepend(i).mapFirst(x -> x + 2));
+        streamEx(base, s -> assertEquals(IntStreamEx.range(2, 52).boxed().append(0).toList(), s.get().toList()));
+        base = () -> IntStreamEx.range(50).boxed().foldLeft(StreamEx.of(0),
             (stream, i) -> stream.append(i).mapLast(x -> x + 2));
         streamEx(base, s -> assertEquals(IntStreamEx.range(2, 52).boxed().prepend(0).toList(), s.get().toList()));
         streamEx(asList("red", "green", "blue", "orange")::stream, s -> assertEquals("red, green, blue, or orange", s
