diff --git a/src/test/java/one/util/streamex/StreamExHeadTailTest.java b/src/test/java/one/util/streamex/StreamExHeadTailTest.java
index dee8abb..52279b5 100644
--- a/src/test/java/one/util/streamex/StreamExHeadTailTest.java
+++ b/src/test/java/one/util/streamex/StreamExHeadTailTest.java
@@ -102,6 +102,11 @@ public class StreamExHeadTailTest {
             return peek(tail, consumer).prepend(head);
         });
     }
+    
+    // Stream.flatMap (TSO)
+    static <T, R> StreamEx<R> flatMap(StreamEx<T> input, Function<T, Stream<R>> mapper) {
+        return input.headTail((head, tail) -> flatMap(tail, mapper).prepend(mapper.apply(head)));
+    }
 
     // Stream.sorted
     static <T> StreamEx<T> sorted(StreamEx<T> input) {
@@ -402,6 +407,8 @@ public class StreamExHeadTailTest {
         // 1+2+...+10000
         assertEquals(50005000, (int) limit(scanLeft(StreamEx.iterate(1, x -> x + 1), Integer::sum), 10000).reduce(
             (a, b) -> b).get());
+        assertEquals(50005000, (int) limit(flatMap(StreamEx.iterate(1, x -> x + 3), x -> StreamEx.of(x, x + 1, x + 2)),
+            10000).reduce(Integer::sum).get());
         assertEquals(asList(50005000), skip(
             appendReduction(IntStreamEx.rangeClosed(1, 10000).boxed(), 0, Integer::sum), 10000).toList());
         AtomicInteger sum = new AtomicInteger();
