diff --git a/src/main/java/one/util/streamex/StreamContext.java b/src/main/java/one/util/streamex/StreamContext.java
index afa6137..aa3074b 100644
--- a/src/main/java/one/util/streamex/StreamContext.java
+++ b/src/main/java/one/util/streamex/StreamContext.java
@@ -87,10 +87,7 @@ import static one.util.streamex.StreamExInternals.*;
 
     StreamContext onClose(Runnable r) {
         StreamContext context = detach();
-        if (context.closeHandler == null)
-            context.closeHandler = r;
-        else
-            context.closeHandler = compose(context.closeHandler, r);
+        context.closeHandler = compose(context.closeHandler, r);
         return context;
     }
 
@@ -102,7 +99,9 @@ import static one.util.streamex.StreamExInternals.*;
         }
     }
 
-    private static Runnable compose(Runnable r1, Runnable r2) {
+    static Runnable compose(Runnable r1, Runnable r2) {
+        if(r1 == null)
+            return r2;
         return () -> {
             try {
                 r1.run();
diff --git a/src/main/java/one/util/streamex/TreeSpliterator.java b/src/main/java/one/util/streamex/TreeSpliterator.java
index 61d8c22..634b640 100644
--- a/src/main/java/one/util/streamex/TreeSpliterator.java
+++ b/src/main/java/one/util/streamex/TreeSpliterator.java
@@ -35,6 +35,8 @@ import static one.util.streamex.StreamExInternals.*;
 /* package */ abstract class TreeSpliterator<T, U> extends CloneableSpliterator<U, TreeSpliterator<T, U>> implements Consumer<T> {
     T cur;
     List<PairBox<Spliterator<T>, Stream<T>>> spliterators;
+    Runnable closeHandler = null;
+    long size = Long.MAX_VALUE;
 
     TreeSpliterator(T root) {
         this.cur = root;
@@ -75,8 +77,10 @@ import static one.util.streamex.StreamExInternals.*;
         if(spliterators == null) {
             spliterators = new ArrayList<>();
             Stream<T> stream = getStart();
-            if(stream != null)
-                spliterators.add(new PairBox<>(stream.spliterator(), stream));
+            if(stream != null) {
+                spliterators.add(new PairBox<>(stream.parallel().spliterator(), null));
+                closeHandler = stream::close;
+            }
             return new ConstSpliterator.OfRef<>(getStartElement(), 1, true);
         }
         int size = spliterators.size();
@@ -87,14 +91,17 @@ import static one.util.streamex.StreamExInternals.*;
         if(prefix == null)
             return null;
         TreeSpliterator<T, U> clone = doClone();
+        clone.size /= 2;
+        this.size -= clone.size;
         clone.spliterators = new ArrayList<>();
         clone.spliterators.add(new PairBox<>(prefix, null));
+        closeHandler = StreamContext.compose(closeHandler, clone::close);
         return clone;
     }
     
     @Override
     public long estimateSize() {
-        return Long.MAX_VALUE;
+        return size;
     }
 
     @Override
@@ -112,7 +119,19 @@ import static one.util.streamex.StreamExInternals.*;
             Throwable t = null;
             for(int i=spliterators.size()-1; i>=0; i--) {
                 try {
-                    spliterators.get(i).b.close();
+                    Stream<T> stream = spliterators.get(i).b;
+                    if(stream != null)
+                        stream.close();
+                } catch (Error | RuntimeException e) {
+                    if(t == null)
+                        t = e;
+                    else
+                        t.addSuppressed(e);
+                }
+            }
+            if(closeHandler != null) {
+                try {
+                    closeHandler.run();
                 } catch (Error | RuntimeException e) {
                     if(t == null)
                         t = e;
diff --git a/src/test/java/one/util/streamex/StreamExTest.java b/src/test/java/one/util/streamex/StreamExTest.java
index 40ed65b..c409bb9 100644
--- a/src/test/java/one/util/streamex/StreamExTest.java
+++ b/src/test/java/one/util/streamex/StreamExTest.java
@@ -949,6 +949,14 @@ public class StreamExTest {
         public Stream<TreeNode> elements() {
             return nodes.stream();
         }
+        
+        static CompositeNode createTestData() {
+            CompositeNode r = new CompositeNode("root");
+            r.add(new CompositeNode("childA").add(new TreeNode("grandA1")).add(new TreeNode("grandA2")));
+            r.add(new CompositeNode("childB").add(new TreeNode("grandB1")));
+            r.add(new TreeNode("childC"));
+            return r;
+        }
     }
 
     @Test
@@ -961,10 +969,7 @@ public class StreamExTest {
         assertEquals("aa,bbbb,cc,ddd,e,fff,ggg", ofTree.select(String.class).joining(","));
         assertEquals(14, StreamEx.ofTree(input, List.class, List::stream).select(List.class).mapToInt(List::size).sum());
 
-        CompositeNode r = new CompositeNode("root");
-        r.add(new CompositeNode("childA").add(new TreeNode("grandA1")).add(new TreeNode("grandA2")));
-        r.add(new CompositeNode("childB").add(new TreeNode("grandB1")));
-        r.add(new TreeNode("childC"));
+        CompositeNode r = CompositeNode.createTestData();
         
         streamEx(r::flatStream, s -> {
             assertEquals("root,childA,grandA1,grandA2,childB,grandB1,childC", s.get().joining(","));
@@ -972,6 +977,22 @@ public class StreamExTest {
             assertEquals(Optional.empty(), s.get().findFirst(tn -> tn.title.contains("C1")).map(tn -> tn.title));
         });
         
+        streamEx(() -> StreamEx.ofTree("", (String str) -> str.length() >= 3 ? null : Stream.of("a", "b").map(
+            str::concat)), supplier -> {
+            assertEquals(Arrays.asList("", "a", "aa", "aaa", "aab", "ab", "aba", "abb", "b", "ba", "baa", "bab", "bb",
+                "bba", "bbb"), supplier.get().toList());
+            assertEquals(Arrays.asList("a", "b", "aa", "ab", "ba", "bb", "aaa", "aab", "aba", "abb", "baa", "bab",
+                "bba", "bbb"), supplier.get().sortedByInt(String::length).without("").toList());
+        });
+        
+        assertEquals(1000001, StreamEx.ofTree("x",
+            s -> s.equals("x") ? IntStreamEx.range(1000000).mapToObj(String::valueOf) : null).parallel().count());
+    }
+
+    @Test
+    public void testOfTreeClose() {
+        CompositeNode r = CompositeNode.createTestData();
+        
         r.flatStream().close(); // should not fail
         
         List<Consumer<StreamEx<TreeNode>>> tests = Arrays.<Consumer<StreamEx<TreeNode>>>asList(
@@ -1019,17 +1040,26 @@ public class StreamExTest {
                 assertEquals("root", ex.getSuppressed()[0].getMessage());
             }
             assertTrue(catched);
+
+            catched = false;
+            try (StreamEx<TreeNode> closableTree = StreamEx.ofTree(r, CompositeNode.class, cn -> cn.elements().onClose(
+                () -> {
+                    if (!cn.title.equals("childA"))
+                        throw new InternalError(cn.title);
+                })).parallel()) {
+                test.accept(closableTree);
+            }
+            catch(InternalError ex) {
+                catched = true;
+                assertEquals(1, ex.getSuppressed().length);
+                assertTrue(ex.getSuppressed()[0] instanceof InternalError);
+                assertEquals(StreamEx.of("childB", "root").toSet(), StreamEx.of(ex.getMessage(),
+                    ex.getSuppressed()[0].getMessage()).toSet());
+            }
+            assertTrue(catched);
         }
-        
-        streamEx(() -> StreamEx.ofTree("", (String str) -> str.length() >= 3 ? null : Stream.of("a", "b").map(
-            str::concat)), supplier -> {
-            assertEquals(Arrays.asList("", "a", "aa", "aaa", "aab", "ab", "aba", "abb", "b", "ba", "baa", "bab", "bb",
-                "bba", "bbb"), supplier.get().toList());
-            assertEquals(Arrays.asList("a", "b", "aa", "ab", "ba", "bb", "aaa", "aab", "aba", "abb", "baa", "bab",
-                "bba", "bbb"), supplier.get().sortedByInt(String::length).without("").toList());
-        });
     }
-
+    
     @Test
     public void testCross() {
         assertEquals("a-1, a-2, a-3, b-1, b-2, b-3, c-1, c-2, c-3", StreamEx.of("a", "b", "c").cross(1, 2, 3).join("-")
