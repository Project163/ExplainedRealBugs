diff --git a/src/main/java/javax/util/streamex/StreamEx.java b/src/main/java/javax/util/streamex/StreamEx.java
index 9c42c34..813d808 100644
--- a/src/main/java/javax/util/streamex/StreamEx.java
+++ b/src/main/java/javax/util/streamex/StreamEx.java
@@ -196,18 +196,26 @@ public class StreamEx<T> extends AbstractStreamEx<T, StreamEx<T>> {
     }
 
     public StreamEx<T> mapFirst(Function<? super T, ? extends T> mapper) {
+        // Cannot reuse NONE object here as the object appears in the stream and
+        // might become visible to other pipeline steps
+        // thus new Object is necessary every time
         @SuppressWarnings("unchecked")
-        Stream<T> none = Stream.of((T)NONE);
+        T first = (T) new Object();
+        Stream<T> none = Stream.of(first);
         return strategy().newStreamEx(
-            delegate(new PairSpliterator.PSOfRef<T, T>((a, b) -> (a == NONE ? mapper.apply(b) : b), Stream.concat(
+            delegate(new PairSpliterator.PSOfRef<T, T>((a, b) -> (a == first ? mapper.apply(b) : b), Stream.concat(
                 none, stream).spliterator())));
     }
 
     public StreamEx<T> mapLast(Function<? super T, ? extends T> mapper) {
+        // Cannot reuse NONE object here as the object appears in the stream and
+        // might become visible to other pipeline steps
+        // thus new Object is necessary every time
         @SuppressWarnings("unchecked")
-        Stream<T> none = Stream.of((T)NONE);
+        T last = (T) new Object();
+        Stream<T> none = Stream.of(last);
         return strategy().newStreamEx(
-            delegate(new PairSpliterator.PSOfRef<T, T>((a, b) -> (b == NONE ? mapper.apply(a) : a), Stream.concat(
+            delegate(new PairSpliterator.PSOfRef<T, T>((a, b) -> (b == last ? mapper.apply(a) : a), Stream.concat(
                 stream, none).spliterator())));
     }
     
diff --git a/src/test/java/javax/util/streamex/DoubleStreamExTest.java b/src/test/java/javax/util/streamex/DoubleStreamExTest.java
index 297d35b..40fb6a0 100644
--- a/src/test/java/javax/util/streamex/DoubleStreamExTest.java
+++ b/src/test/java/javax/util/streamex/DoubleStreamExTest.java
@@ -61,7 +61,8 @@ public class DoubleStreamExTest {
         assertArrayEquals(new double[] { 1, 1, 1, 1 }, DoubleStreamEx.generate(() -> 1).limit(4).toArray(), 0.0);
         assertArrayEquals(new double[] { 1, 1, 1, 1 }, DoubleStreamEx.constant(1.0, 4).toArray(), 0.0);
         assertEquals(10, DoubleStreamEx.of(new Random(), 10).count());
-        assertArrayEquals(DoubleStreamEx.of(new Random(1), 10).toArray(), DoubleStreamEx.of(new Random(1)).limit(10).toArray(), 0.0);
+        assertArrayEquals(DoubleStreamEx.of(new Random(1), 10).toArray(), DoubleStreamEx.of(new Random(1)).limit(10)
+                .toArray(), 0.0);
         assertTrue(DoubleStreamEx.of(new Random(), 100, 1, 10).allMatch(x -> x >= 1 && x < 10));
         assertArrayEquals(DoubleStreamEx.of(new Random(1), 100, 1, 10).toArray(),
             DoubleStreamEx.of(new Random(1), 1, 10).limit(100).toArray(), 0.0);
@@ -122,7 +123,7 @@ public class DoubleStreamExTest {
 
         assertTrue(DoubleStreamEx.of(1, 2, 3).spliterator().hasCharacteristics(Spliterator.ORDERED));
         assertFalse(DoubleStreamEx.of(1, 2, 3).unordered().spliterator().hasCharacteristics(Spliterator.ORDERED));
-        
+
         OfDouble iterator = DoubleStreamEx.of(1.0, 2.0, 3.0).iterator();
         assertEquals(1.0, iterator.next(), 0.0);
         assertEquals(2.0, iterator.next(), 0.0);
@@ -142,7 +143,7 @@ public class DoubleStreamExTest {
         assertEquals("1:.:5:2:2:.:3:3:.:2:0:.:9",
             DoubleStreamEx.of(1.5, 22.3, 3.2, 0.9).flatMapToObj(x -> StreamEx.split(String.valueOf(x), ""))
                     .joining(":"));
-        
+
         assertArrayEquals(new double[] { 0.0, 0.0, 1.0, 0.0, 1.0, 2.0 },
             DoubleStreamEx.of(1, 2, 3).flatMap(x -> IntStreamEx.range((int) x).asDoubleStream()).toArray(), 0.0);
     }
@@ -150,7 +151,8 @@ public class DoubleStreamExTest {
     @Test
     public void testPrepend() {
         assertArrayEquals(new double[] { -1, 0, 1, 2, 3 }, DoubleStreamEx.of(1, 2, 3).prepend(-1, 0).toArray(), 0.0);
-        assertArrayEquals(new double[] { -1, 0, 1, 2, 3 }, DoubleStreamEx.of(1, 2, 3).prepend(DoubleStream.of(-1, 0)).toArray(), 0.0);
+        assertArrayEquals(new double[] { -1, 0, 1, 2, 3 }, DoubleStreamEx.of(1, 2, 3).prepend(DoubleStream.of(-1, 0))
+                .toArray(), 0.0);
         DoubleStreamEx s = DoubleStreamEx.of(1, 2, 3);
         assertSame(s, s.prepend());
     }
@@ -158,7 +160,8 @@ public class DoubleStreamExTest {
     @Test
     public void testAppend() {
         assertArrayEquals(new double[] { 1, 2, 3, 4, 5 }, DoubleStreamEx.of(1, 2, 3).append(4, 5).toArray(), 0.0);
-        assertArrayEquals(new double[] { 1, 2, 3, 4, 5 }, DoubleStreamEx.of(1, 2, 3).append(DoubleStream.of(4, 5)).toArray(), 0.0);
+        assertArrayEquals(new double[] { 1, 2, 3, 4, 5 }, DoubleStreamEx.of(1, 2, 3).append(DoubleStream.of(4, 5))
+                .toArray(), 0.0);
         DoubleStreamEx s = DoubleStreamEx.of(1, 2, 3);
         assertSame(s, s.append());
     }
@@ -208,7 +211,7 @@ public class DoubleStreamExTest {
     @Test
     public void testMinMax() {
         assertFalse(DoubleStreamEx.empty().maxBy(Double::valueOf).isPresent());
-        assertFalse(DoubleStreamEx.empty().maxByLong(x -> (long)x).isPresent());
+        assertFalse(DoubleStreamEx.empty().maxByLong(x -> (long) x).isPresent());
         assertEquals(9,
             IntStreamEx.range(5, 12).asDoubleStream().max((a, b) -> String.valueOf(a).compareTo(String.valueOf(b)))
                     .getAsDouble(), 0.0);
@@ -233,9 +236,9 @@ public class DoubleStreamExTest {
         DoubleToLongFunction longKey = x -> String.valueOf(x).length();
         DoubleUnaryOperator doubleKey = x -> String.valueOf(x).length();
         DoubleFunction<Integer> objKey = x -> String.valueOf(x).length();
-        List<Function<DoubleStreamEx, OptionalDouble>> minFns = Arrays.asList(is -> is.minByInt(intKey), 
+        List<Function<DoubleStreamEx, OptionalDouble>> minFns = Arrays.asList(is -> is.minByInt(intKey),
             is -> is.minByLong(longKey), is -> is.minByDouble(doubleKey), is -> is.minBy(objKey));
-        List<Function<DoubleStreamEx, OptionalDouble>> maxFns = Arrays.asList(is -> is.maxByInt(intKey), 
+        List<Function<DoubleStreamEx, OptionalDouble>> maxFns = Arrays.asList(is -> is.maxByInt(intKey),
             is -> is.maxByLong(longKey), is -> is.maxByDouble(doubleKey), is -> is.maxBy(objKey));
         minFns.forEach(fn -> assertEquals(1, fn.apply(s.get()).getAsDouble(), 0.0));
         minFns.forEach(fn -> assertEquals(1, fn.apply(s.get().parallel()).getAsDouble(), 0.0));
@@ -310,22 +313,24 @@ public class DoubleStreamExTest {
             DoubleStreamEx.iterate(0, i -> i + 1).parallel().skipOrdered(1).greater(0).boxed().findAny(i -> i == 500)
                     .get(), 0.0);
     }
-    
+
     @Test
     public void testTakeWhile() {
-        assertArrayEquals(LongStreamEx.range(100).asDoubleStream().toArray(), DoubleStreamEx.iterate(0, i -> i+1).takeWhile(i -> i<100).toArray(), 0.0);
-        assertEquals(0, DoubleStreamEx.iterate(0, i -> i+1).takeWhile(i -> i<0).count());
-        assertEquals(1, DoubleStreamEx.of(1, 3, 2).takeWhile(i -> i<3).count());
-        assertEquals(3, DoubleStreamEx.of(1, 2, 3).takeWhile(i -> i<100).count());
+        assertArrayEquals(LongStreamEx.range(100).asDoubleStream().toArray(), DoubleStreamEx.iterate(0, i -> i + 1)
+                .takeWhile(i -> i < 100).toArray(), 0.0);
+        assertEquals(0, DoubleStreamEx.iterate(0, i -> i + 1).takeWhile(i -> i < 0).count());
+        assertEquals(1, DoubleStreamEx.of(1, 3, 2).takeWhile(i -> i < 3).count());
+        assertEquals(3, DoubleStreamEx.of(1, 2, 3).takeWhile(i -> i < 100).count());
     }
-    
+
     @Test
     public void testDropWhile() {
-        assertArrayEquals(new double[] {5,6,7,8,9,10,11,12,13,14}, LongStreamEx.range(100).asDoubleStream().dropWhile(i -> i % 10 < 5).limit(10).toArray(), 0.0);
+        assertArrayEquals(new double[] { 5, 6, 7, 8, 9, 10, 11, 12, 13, 14 }, LongStreamEx.range(100).asDoubleStream()
+                .dropWhile(i -> i % 10 < 5).limit(10).toArray(), 0.0);
         assertEquals(100, LongStreamEx.range(100).asDoubleStream().sorted().dropWhile(i -> i % 10 < 0).count());
         assertEquals(0, LongStreamEx.range(100).asDoubleStream().dropWhile(i -> i % 10 < 10).count());
     }
-    
+
     @Test
     public void testIndexOf() {
         assertEquals(11, LongStreamEx.range(50, 100).asDoubleStream().indexOf(x -> x > 60).getAsLong());
@@ -344,4 +349,10 @@ public class DoubleStreamExTest {
         assertEquals(144, DoubleStreamEx.of(1, 2, 3).foldLeft(0.0, accumulator), 144);
         assertEquals(144, DoubleStreamEx.of(1, 2, 3).parallel().foldLeft(0.0, accumulator), 144);
     }
+
+    @Test
+    public void testMapFirstLast() {
+        assertArrayEquals(new double[] { -1, 2, 3, 4, 7 }, DoubleStreamEx.of(1, 2, 3, 4, 5).mapFirst(x -> x - 2.0)
+                .mapLast(x -> x + 2.0).toArray(), 0.0);
+    }
 }
diff --git a/src/test/java/javax/util/streamex/IntStreamExTest.java b/src/test/java/javax/util/streamex/IntStreamExTest.java
index af9fb90..6422b50 100644
--- a/src/test/java/javax/util/streamex/IntStreamExTest.java
+++ b/src/test/java/javax/util/streamex/IntStreamExTest.java
@@ -87,14 +87,14 @@ public class IntStreamExTest {
 
         assertArrayEquals(new int[] { 1, 5, 3 }, IntStreamEx.of(Spliterators.spliterator(new int[] { 1, 5, 3 }, 0))
                 .toArray());
-        
+
         BitSet bs = new BitSet();
         bs.set(1);
         bs.set(3);
         bs.set(5);
-		assertArrayEquals(new int[] { 1, 3, 5 }, IntStreamEx.of(bs).toArray());
+        assertArrayEquals(new int[] { 1, 3, 5 }, IntStreamEx.of(bs).toArray());
     }
-    
+
     @Test
     public void testRangeStep() {
         assertArrayEquals(new int[] { 0 }, IntStreamEx.range(0, 1000, 100000).toArray());
@@ -137,16 +137,16 @@ public class IntStreamExTest {
         assertEquals(0, IntStreamEx.range(0, 1000, -2).count());
         assertEquals(0, IntStreamEx.range(0, 0, -2).count());
         assertEquals(0, IntStreamEx.range(0, 0, 2).count());
-        
+
         assertEquals(0, IntStreamEx.range(0, Integer.MIN_VALUE, 2).spliterator().getExactSizeIfKnown());
         assertEquals(0, IntStreamEx.range(0, Integer.MAX_VALUE, -2).spliterator().getExactSizeIfKnown());
     }
-    
+
     @Test(expected = IllegalArgumentException.class)
     public void testRangeIllegalStep() {
         IntStreamEx.range(0, 1000, 0);
     }
-    
+
     @Test
     public void testRangeClosedStep() {
         assertArrayEquals(new int[] { 0 }, IntStreamEx.rangeClosed(0, 1000, 100000).toArray());
@@ -267,14 +267,14 @@ public class IntStreamExTest {
         assertEquals(2, iterator.nextInt());
         assertEquals(3, iterator.nextInt());
         assertFalse(iterator.hasNext());
-        
-		List<Integer> list = new ArrayList<>();
-		IntStreamEx.range(10).parallel().forEachOrdered(x -> list.add(x));
-		assertEquals(Arrays.asList(0, 1, 2, 3, 4, 5, 6, 7, 8, 9), list);
-		
-		assertTrue(IntStreamEx.empty().noneMatch(x -> true));
-		assertFalse(IntStreamEx.of(1).noneMatch(x -> true));
-		assertTrue(IntStreamEx.of(1).noneMatch(x -> false));
+
+        List<Integer> list = new ArrayList<>();
+        IntStreamEx.range(10).parallel().forEachOrdered(x -> list.add(x));
+        assertEquals(Arrays.asList(0, 1, 2, 3, 4, 5, 6, 7, 8, 9), list);
+
+        assertTrue(IntStreamEx.empty().noneMatch(x -> true));
+        assertFalse(IntStreamEx.of(1).noneMatch(x -> true));
+        assertTrue(IntStreamEx.of(1).noneMatch(x -> false));
     }
 
     @Test
@@ -295,8 +295,8 @@ public class IntStreamExTest {
         double[] fractions = IntStreamEx.range(1, 5)
                 .flatMapToDouble(i -> IntStreamEx.range(1, i).mapToDouble(j -> ((double) j) / i)).toArray();
         assertArrayEquals(new double[] { 1 / 2.0, 1 / 3.0, 2 / 3.0, 1 / 4.0, 2 / 4.0, 3 / 4.0 }, fractions, 0.000001);
-        
-        assertArrayEquals(new int[] {0, 0, 1, 0, 1, 2}, IntStreamEx.of(1, 2, 3).flatMap(IntStreamEx::range).toArray());
+
+        assertArrayEquals(new int[] { 0, 0, 1, 0, 1, 2 }, IntStreamEx.of(1, 2, 3).flatMap(IntStreamEx::range).toArray());
     }
 
     @Test
@@ -419,16 +419,16 @@ public class IntStreamExTest {
         IntToLongFunction longKey = x -> String.valueOf(x).length();
         IntToDoubleFunction doubleKey = x -> String.valueOf(x).length();
         IntFunction<Integer> objKey = x -> String.valueOf(x).length();
-        List<Function<IntStreamEx, OptionalInt>> minFns = Arrays.asList(is -> is.minByInt(intKey), 
+        List<Function<IntStreamEx, OptionalInt>> minFns = Arrays.asList(is -> is.minByInt(intKey),
             is -> is.minByLong(longKey), is -> is.minByDouble(doubleKey), is -> is.minBy(objKey));
-        List<Function<IntStreamEx, OptionalInt>> maxFns = Arrays.asList(is -> is.maxByInt(intKey), 
+        List<Function<IntStreamEx, OptionalInt>> maxFns = Arrays.asList(is -> is.maxByInt(intKey),
             is -> is.maxByLong(longKey), is -> is.maxByDouble(doubleKey), is -> is.maxBy(objKey));
         minFns.forEach(fn -> assertEquals(1, fn.apply(s.get()).getAsInt()));
         minFns.forEach(fn -> assertEquals(1, fn.apply(s.get().parallel()).getAsInt()));
         maxFns.forEach(fn -> assertEquals(120, fn.apply(s.get()).getAsInt()));
         maxFns.forEach(fn -> assertEquals(120, fn.apply(s.get().parallel()).getAsInt()));
     }
-    
+
     private IntStreamEx dropLast(IntStreamEx s) {
         return s.pairMap((a, b) -> a);
     }
@@ -572,35 +572,37 @@ public class IntStreamExTest {
         assertEquals(expected, IntStreamEx.iterate(0, i -> i + 1).skipOrdered(1).greater(0).limit(99).boxed()
                 .parallel().toSet());
     }
-    
+
     @Test
     public void testTakeWhile() {
-        assertArrayEquals(IntStreamEx.range(100).toArray(), IntStreamEx.iterate(0, i -> i+1).takeWhile(i -> i<100).toArray());
-        assertEquals(0, IntStreamEx.iterate(0, i -> i+1).takeWhile(i -> i<0).count());
-        assertEquals(1, IntStreamEx.of(1, 3, 2).takeWhile(i -> i<3).count());
-        assertEquals(3, IntStreamEx.of(1, 2, 3).takeWhile(i -> i<100).count());
+        assertArrayEquals(IntStreamEx.range(100).toArray(), IntStreamEx.iterate(0, i -> i + 1).takeWhile(i -> i < 100)
+                .toArray());
+        assertEquals(0, IntStreamEx.iterate(0, i -> i + 1).takeWhile(i -> i < 0).count());
+        assertEquals(1, IntStreamEx.of(1, 3, 2).takeWhile(i -> i < 3).count());
+        assertEquals(3, IntStreamEx.of(1, 2, 3).takeWhile(i -> i < 100).count());
     }
-    
+
     @Test
     public void testDropWhile() {
-        assertArrayEquals(new int[] {5,6,7,8,9,10,11,12,13,14}, IntStreamEx.range(100).dropWhile(i -> i % 10 < 5).limit(10).toArray());
+        assertArrayEquals(new int[] { 5, 6, 7, 8, 9, 10, 11, 12, 13, 14 },
+            IntStreamEx.range(100).dropWhile(i -> i % 10 < 5).limit(10).toArray());
         assertEquals(100, IntStreamEx.range(100).dropWhile(i -> i % 10 < 0).count());
         assertEquals(0, IntStreamEx.range(100).dropWhile(i -> i % 10 < 10).count());
     }
-    
+
     @Test
     public void testIndexOf() {
         assertEquals(5, IntStreamEx.range(50, 100).indexOf(55).getAsLong());
         assertFalse(IntStreamEx.range(50, 100).indexOf(200).isPresent());
         assertEquals(5, IntStreamEx.range(50, 100).parallel().indexOf(55).getAsLong());
         assertFalse(IntStreamEx.range(50, 100).parallel().indexOf(200).isPresent());
-        
+
         assertEquals(11, IntStreamEx.range(50, 100).indexOf(x -> x > 60).getAsLong());
         assertFalse(IntStreamEx.range(50, 100).indexOf(x -> x < 0).isPresent());
         assertEquals(11, IntStreamEx.range(50, 100).parallel().indexOf(x -> x > 60).getAsLong());
         assertFalse(IntStreamEx.range(50, 100).parallel().indexOf(x -> x < 0).isPresent());
     }
-    
+
     @Test
     public void testFoldLeft() {
         // non-associative
@@ -611,11 +613,14 @@ public class IntStreamExTest {
         assertEquals(144, IntStreamEx.rangeClosed(1, 3).foldLeft(0, accumulator));
         assertEquals(144, IntStreamEx.rangeClosed(1, 3).parallel().foldLeft(0, accumulator));
     }
-    
+
     @Test
-    public void testMapFirst() {
+    public void testMapFirstLast() {
         // capitalize
         String str = "testString";
         assertEquals("TestString", IntStreamEx.ofCodePoints(str).mapFirst(Character::toUpperCase).codePointsToString());
+
+        assertArrayEquals(new int[] { -1, 2, 3, 4, 7 },
+            IntStreamEx.of(1, 2, 3, 4, 5).mapFirst(x -> x - 2).mapLast(x -> x + 2).toArray());
     }
 }
diff --git a/src/test/java/javax/util/streamex/LongStreamExTest.java b/src/test/java/javax/util/streamex/LongStreamExTest.java
index ed46dda..7954790 100644
--- a/src/test/java/javax/util/streamex/LongStreamExTest.java
+++ b/src/test/java/javax/util/streamex/LongStreamExTest.java
@@ -233,8 +233,7 @@ public class LongStreamExTest {
                     .toArray());
 
         String expected = LongStreamEx.range(200).boxed()
-                .flatMap(i -> LongStreamEx.range(0, i).<String> mapToObj(j -> i + ":" + j))
-                .joining("/");
+                .flatMap(i -> LongStreamEx.range(0, i).<String> mapToObj(j -> i + ":" + j)).joining("/");
         String res = LongStreamEx.range(200).flatMapToObj(i -> LongStreamEx.range(i).mapToObj(j -> i + ":" + j))
                 .joining("/");
         String parallel = LongStreamEx.range(200).parallel()
@@ -305,7 +304,7 @@ public class LongStreamExTest {
         assertArrayEquals(new long[] { 0, 3, 6, 1, 4, 7, 2, 5, 8 },
             LongStreamEx.range(0, 9).sortedByLong(i -> i % 3 * 3 + i / 3).toArray());
         assertArrayEquals(new long[] { 0, 4, 8, 1, 5, 9, 2, 6, 3, 7 },
-            LongStreamEx.range(0, 10).sortedByInt(i -> (int)i % 4).toArray());
+            LongStreamEx.range(0, 10).sortedByInt(i -> (int) i % 4).toArray());
         assertArrayEquals(new long[] { 10, 11, 5, 6, 7, 8, 9 }, LongStreamEx.range(5, 12).sortedBy(String::valueOf)
                 .toArray());
         assertArrayEquals(new long[] { Long.MAX_VALUE, 1000, 1, 0, -10, Long.MIN_VALUE },
@@ -402,20 +401,20 @@ public class LongStreamExTest {
         assertEquals(100, LongStreamEx.range(100).dropWhile(i -> i % 10 < 0).count());
         assertEquals(0, LongStreamEx.range(100).dropWhile(i -> i % 10 < 10).count());
     }
-    
+
     @Test
     public void testIndexOf() {
         assertEquals(5, LongStreamEx.range(50, 100).indexOf(55).getAsLong());
         assertFalse(LongStreamEx.range(50, 100).indexOf(200).isPresent());
         assertEquals(5, LongStreamEx.range(50, 100).parallel().indexOf(55).getAsLong());
         assertFalse(LongStreamEx.range(50, 100).parallel().indexOf(200).isPresent());
-        
+
         assertEquals(11, LongStreamEx.range(50, 100).indexOf(x -> x > 60).getAsLong());
         assertFalse(LongStreamEx.range(50, 100).indexOf(x -> x < 0).isPresent());
         assertEquals(11, LongStreamEx.range(50, 100).parallel().indexOf(x -> x > 60).getAsLong());
         assertFalse(LongStreamEx.range(50, 100).parallel().indexOf(x -> x < 0).isPresent());
     }
-    
+
     @Test
     public void testFoldLeft() {
         // non-associative
@@ -426,4 +425,10 @@ public class LongStreamExTest {
         assertEquals(144, LongStreamEx.rangeClosed(1, 3).foldLeft(0L, accumulator));
         assertEquals(144, LongStreamEx.rangeClosed(1, 3).parallel().foldLeft(0L, accumulator));
     }
+
+    @Test
+    public void testMapFirstLast() {
+        assertArrayEquals(new long[] { -1, 2, 3, 4, 7 },
+            LongStreamEx.of(1, 2, 3, 4, 5).mapFirst(x -> x - 2L).mapLast(x -> x + 2L).toArray());
+    }
 }
diff --git a/src/test/java/javax/util/streamex/StreamExTest.java b/src/test/java/javax/util/streamex/StreamExTest.java
index a7a963d..8143b8e 100644
--- a/src/test/java/javax/util/streamex/StreamExTest.java
+++ b/src/test/java/javax/util/streamex/StreamExTest.java
@@ -1473,4 +1473,20 @@ public class StreamExTest {
             assertEquals(9, StreamEx.of(input).parallel().indexOf(9).getAsLong());
         }
     }
+    
+    @Test
+    public void testMapFirstLast() {
+        for(StreamExSupplier<Integer> s : streamEx(() -> StreamEx.of(0, 343, 999))) {
+            assertEquals(s.toString(), Arrays.asList(2, 343, 997), s.get()
+                    .mapFirst(x -> x + 2).mapLast(x -> x - 2).toList());
+        }
+        for(StreamExSupplier<Integer> s : streamEx(() -> IntStreamEx.range(1000).boxed())) {
+            assertEquals(s.toString(), Arrays.asList(2, 343, 997), s.get().filter(x -> x == 0 || x == 343 || x == 999)
+                .mapFirst(x -> x + 2).mapLast(x -> x - 2).toList());
+        }
+        for (StreamExSupplier<Integer> s : streamEx(() -> IntStreamEx.range(50).boxed()
+                .foldLeft(StreamEx.of(0), (stream, i) -> stream.append(i).mapLast(x -> x + 2)))) {
+            assertEquals(s.toString(), IntStreamEx.range(2, 52).boxed().prepend(0).toList(), s.get().toList());
+        }
+    }
 }
