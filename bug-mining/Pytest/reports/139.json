{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/5358","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5358/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5358/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5358/events","html_url":"https://github.com/pytest-dev/pytest/issues/5358","id":451156869,"node_id":"MDU6SXNzdWU0NTExNTY4Njk=","number":5358,"title":"pytest 4.6.0 breaks matplotlib test gathering with `TypeError: cannot unpack non-iterable NoneType object`","user":{"login":"jkseppan","id":92814,"node_id":"MDQ6VXNlcjkyODE0","avatar_url":"https://avatars.githubusercontent.com/u/92814?v=4","gravatar_id":"","url":"https://api.github.com/users/jkseppan","html_url":"https://github.com/jkseppan","followers_url":"https://api.github.com/users/jkseppan/followers","following_url":"https://api.github.com/users/jkseppan/following{/other_user}","gists_url":"https://api.github.com/users/jkseppan/gists{/gist_id}","starred_url":"https://api.github.com/users/jkseppan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jkseppan/subscriptions","organizations_url":"https://api.github.com/users/jkseppan/orgs","repos_url":"https://api.github.com/users/jkseppan/repos","events_url":"https://api.github.com/users/jkseppan/events{/privacy}","received_events_url":"https://api.github.com/users/jkseppan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":265779499,"node_id":"MDU6TGFiZWwyNjU3Nzk0OTk=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/status:%20critical","name":"status: critical","color":"e11d21","default":false,"description":"grave problem or usability issue that affects lots of users"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-06-02T05:58:34Z","updated_at":"2019-06-04T09:29:28Z","closed_at":"2019-06-02T15:51:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This build: https://travis-ci.org/matplotlib/matplotlib/jobs/540086010 passed fine, with pytest 4.5.0. The next build from the same code, initiated via cron and using pytest 4.6.0: https://travis-ci.org/matplotlib/matplotlib/jobs/540212001 failed with\r\n\r\n```\r\nCalling pytest with the following arguments: -raR --maxfail=50 --timeout=300 --durations=25 --cov-report= --cov=lib -n 2 --log-level=DEBUG\r\n============================= test session starts ==============================\r\nplatform linux -- Python 3.7.1, pytest-4.6.0, py-1.7.0, pluggy-0.12.0\r\nrootdir: /home/travis/build/matplotlib/matplotlib, inifile: pytest.ini, testpaths: lib\r\nplugins: forked-1.0.2, cov-2.7.1, rerunfailures-7.0, xdist-1.28.0, timeout-1.3.3, faulthandler-1.6.0\r\ntimeout: 300.0s\r\ntimeout method: signal\r\ntimeout func_only: False\r\ngw0 I / gw1 I\r\ngw0 [5784] / gw1 [5784]\r\n...\r\n_______ ERROR collecting lib/matplotlib/tests/test_constrainedlayout.py ________\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/py/_path/local.py:668: in pyimport\r\n    __import__(modname)\r\n<frozen importlib._bootstrap>:983: in _find_and_load\r\n    ???\r\n<frozen importlib._bootstrap>:963: in _find_and_load_unlocked\r\n    ???\r\n<frozen importlib._bootstrap>:902: in _find_spec\r\n    ???\r\n<frozen importlib._bootstrap>:876: in _find_spec_legacy\r\n    ???\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:169: in find_module\r\n    source_stat, co = _rewrite_test(self.config, fn_pypath)\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:404: in _rewrite_test\r\n    rewrite_asserts(tree, fn, config)\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:453: in rewrite_asserts\r\n    AssertionRewriter(module_path, config).run(mod)\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:701: in run\r\n    new.extend(self.visit(child))\r\n/opt/python/3.7.1/lib/python3.7/ast.py:262: in visit\r\n    return visitor(node)\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:828: in visit_Assert\r\n    top_condition, explanation = self.visit(assert_.test)\r\nE   TypeError: cannot unpack non-iterable NoneType object\r\n_______ ERROR collecting lib/matplotlib/tests/test_constrainedlayout.py ________\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/py/_path/local.py:668: in pyimport\r\n    __import__(modname)\r\n<frozen importlib._bootstrap>:983: in _find_and_load\r\n    ???\r\n<frozen importlib._bootstrap>:963: in _find_and_load_unlocked\r\n    ???\r\n<frozen importlib._bootstrap>:902: in _find_spec\r\n    ???\r\n<frozen importlib._bootstrap>:876: in _find_spec_legacy\r\n    ???\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:169: in find_module\r\n    source_stat, co = _rewrite_test(self.config, fn_pypath)\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:404: in _rewrite_test\r\n    rewrite_asserts(tree, fn, config)\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:453: in rewrite_asserts\r\n    AssertionRewriter(module_path, config).run(mod)\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:701: in run\r\n    new.extend(self.visit(child))\r\n/opt/python/3.7.1/lib/python3.7/ast.py:262: in visit\r\n    return visitor(node)\r\n../../../virtualenv/python3.7.1/lib/python3.7/site-packages/_pytest/assertion/rewrite.py:828: in visit_Assert\r\n    top_condition, explanation = self.visit(assert_.test)\r\nE   TypeError: cannot unpack non-iterable NoneType object\r\n____________ ERROR collecting lib/matplotlib/tests/test_mathtext.py ____________\r\nIn test_mathtext_rendering: 1 parameter sets specified, with different number of ids: 83\r\n```\r\n\r\nThe operating system is Ubuntu 16.04.6 LTS (xenial).\r\n\r\nI don't know how to unpack the line numbers for the breaking tests from the above, but [test_constrainedlayout.py](https://github.com/matplotlib/matplotlib/blob/master/lib/matplotlib/tests/test_constrainedlayout.py) has the following asserts:\r\n\r\n```\r\n    assert all(ax.get_position().extents == ax2.get_position().extents)\r\n    assert all(ax.get_position().extents == ax2.get_position().extents)\r\n    np.testing.assert_allclose(extents0, extents1)\r\n    np.testing.assert_allclose(extents0, extents1)\r\n```\r\n\r\nIn addition, there are multiple tests using matplotlib's `@image_comparison` decorator, but there are so many of those all over the codebase that I think then we'd see much more failures.\r\n\r\n<!--\r\nThanks for submitting an issue!\r\n\r\nHere's a quick checklist for what to provide:\r\n-->\r\n\r\n- [x] a detailed description of the bug or suggestion\r\n- [ ] output of `pip list` from the virtual environment you are using\r\n- [x] pytest and operating system versions\r\n- [ ] minimal example if possible","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/5358/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5358/timeline","performed_via_github_app":null,"state_reason":"completed"}