{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/6497","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6497/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6497/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6497/events","html_url":"https://github.com/pytest-dev/pytest/issues/6497","id":551684931,"node_id":"MDU6SXNzdWU1NTE2ODQ5MzE=","number":6497,"title":"Fixture fails with \"module\" scope and numpy array as value","user":{"login":"kohr-h","id":5030250,"node_id":"MDQ6VXNlcjUwMzAyNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5030250?v=4","gravatar_id":"","url":"https://api.github.com/users/kohr-h","html_url":"https://github.com/kohr-h","followers_url":"https://api.github.com/users/kohr-h/followers","following_url":"https://api.github.com/users/kohr-h/following{/other_user}","gists_url":"https://api.github.com/users/kohr-h/gists{/gist_id}","starred_url":"https://api.github.com/users/kohr-h/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kohr-h/subscriptions","organizations_url":"https://api.github.com/users/kohr-h/orgs","repos_url":"https://api.github.com/users/kohr-h/repos","events_url":"https://api.github.com/users/kohr-h/events{/privacy}","received_events_url":"https://api.github.com/users/kohr-h/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":604021555,"node_id":"MDU6TGFiZWw2MDQwMjE1NTU=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20fixtures","name":"topic: fixtures","color":"5319e7","default":false,"description":"anything involving fixtures directly or indirectly"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-01-17T23:55:54Z","updated_at":"2020-01-28T23:54:15Z","closed_at":"2020-01-28T23:54:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Minimal failing example:\r\n\r\n```py\r\nimport numpy as np\r\nimport pytest\r\n\r\n@pytest.fixture(scope=\"module\", params=[0, np.ones(2)])\r\ndef my_fixture(request):\r\n    return request.param\r\n\r\ndef test_stuff(my_fixture):\r\n    pass\r\n```\r\n\r\n`pytest` output:\r\n\r\n```\r\n=============================================== test session starts ================================================\r\nplatform linux -- Python 3.8.1, pytest-5.3.3, py-1.8.1, pluggy-0.13.1\r\nrootdir: /home/hkohr/git\r\ncollected 2 items                                                                                                  \r\n\r\ntmp.py .E                                                                                                    [100%]\r\n\r\n====================================================== ERRORS ======================================================\r\n____________________________________ ERROR at setup of test_stuff[my_fixture1] _____________________________________\r\n\r\ncls = <class '_pytest.runner.CallInfo'>, func = <function call_runtest_hook.<locals>.<lambda> at 0x7f8b16fb03a0>\r\nwhen = 'setup', reraise = (<class '_pytest.outcomes.Exit'>, <class 'KeyboardInterrupt'>)\r\n\r\n    @classmethod\r\n    def from_call(cls, func, when, reraise=None) -> \"CallInfo\":\r\n        #: context of invocation: one of \"setup\", \"call\",\r\n        #: \"teardown\", \"memocollect\"\r\n        start = time()\r\n        excinfo = None\r\n        try:\r\n>           result = func()\r\n\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/runner.py:235: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/runner.py:208: in <lambda>\r\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/pluggy/hooks.py:286: in __call__\r\n    return self._hookexec(self, self.get_hookimpls(), kwargs)\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/pluggy/manager.py:93: in _hookexec\r\n    return self._inner_hookexec(hook, methods, kwargs)\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/pluggy/manager.py:84: in <lambda>\r\n    self._inner_hookexec = lambda hook, methods, kwargs: hook.multicall(\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/runner.py:120: in pytest_runtest_setup\r\n    item.session._setupstate.prepare(item)\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/runner.py:365: in prepare\r\n    col.setup()\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/python.py:1449: in setup\r\n    fixtures.fillfixtures(self)\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/fixtures.py:294: in fillfixtures\r\n    request._fillfixtures()\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/fixtures.py:473: in _fillfixtures\r\n    item.funcargs[argname] = self.getfixturevalue(argname)\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/fixtures.py:483: in getfixturevalue\r\n    return self._get_active_fixturedef(argname).cached_result[0]\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/fixtures.py:499: in _get_active_fixturedef\r\n    self._compute_fixture_value(fixturedef)\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/fixtures.py:580: in _compute_fixture_value\r\n    fixturedef.execute(request=subrequest)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <FixtureDef argname='my_fixture' scope='module' baseid='tmp.py'>\r\nrequest = <SubRequest 'my_fixture' for <Function test_stuff[my_fixture1]>>\r\n\r\n    def execute(self, request):\r\n        for argname in self._dependee_fixture_argnames(request):\r\n            fixturedef = request._get_active_fixturedef(argname)\r\n            if argname != \"request\":\r\n                fixturedef.addfinalizer(functools.partial(self.finish, request=request))\r\n    \r\n        my_cache_key = self.cache_key(request)\r\n        cached_result = getattr(self, \"cached_result\", None)\r\n        if cached_result is not None:\r\n            result, cache_key, err = cached_result\r\n>           if my_cache_key == cache_key:\r\nE           ValueError: The truth value of an array with more than one element is ambiguous. Use a.any() or a.all()\r\n\r\n../miniconda/envs/tmp/lib/python3.8/site-packages/_pytest/fixtures.py:895: ValueError\r\n============================================ 1 passed, 1 error in 0.35s ============================================\r\n```\r\nI'm not sure if there's a good way to fix this. If not, perhaps the docs should mention that arrays should not be used as parameter values, or only with function scope.","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/6497/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6497/timeline","performed_via_github_app":null,"state_reason":"completed"}