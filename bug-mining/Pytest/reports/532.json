{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13409","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13409/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13409/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13409/events","html_url":"https://github.com/pytest-dev/pytest/issues/13409","id":3045724118,"node_id":"I_kwDOAjwLdc61ig_W","number":13409,"title":"Deprecate iterables which are not collections (e.g. generators) for tests parametrization","user":{"login":"steadyfirmness","id":67721812,"node_id":"MDQ6VXNlcjY3NzIxODEy","avatar_url":"https://avatars.githubusercontent.com/u/67721812?v=4","gravatar_id":"","url":"https://api.github.com/users/steadyfirmness","html_url":"https://github.com/steadyfirmness","followers_url":"https://api.github.com/users/steadyfirmness/followers","following_url":"https://api.github.com/users/steadyfirmness/following{/other_user}","gists_url":"https://api.github.com/users/steadyfirmness/gists{/gist_id}","starred_url":"https://api.github.com/users/steadyfirmness/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/steadyfirmness/subscriptions","organizations_url":"https://api.github.com/users/steadyfirmness/orgs","repos_url":"https://api.github.com/users/steadyfirmness/repos","events_url":"https://api.github.com/users/steadyfirmness/events{/privacy}","received_events_url":"https://api.github.com/users/steadyfirmness/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":659419768,"node_id":"MDU6TGFiZWw2NTk0MTk3Njg=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20deprecation","name":"type: deprecation","color":"e99695","default":false,"description":"feature that will be removed in the future"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2025-05-07T11:58:28Z","updated_at":"2025-11-08T18:18:10Z","closed_at":"2025-11-08T18:18:10Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Description:\nWhen using a generator function as the data source for a parameterized test, the second call to pytest.main() fails with an ID mismatch error. The test works correctly on the first run but fails on subsequent runs.\n\n# How to reproduce:\n\nCreate a test file with the following content:\n```\nimport pytest\n\ndef data_generator():\n    yield 1\n    yield 2\n\n@pytest.mark.parametrize(\"bar\", data_generator(), ids=lambda x: f\"dynamic_{x}\")\ndef test_foo(bar):\n    pass\n\nif __name__ == '__main__':\n    base_cmd = [\n        \"-q\",\n        \"--collect-only\"\n    ]\n    pytest.main(base_cmd)  # First run - works\n    pytest.main(base_cmd)  # Second run - fails\n```\nRun the test file\n\n# Actual behavior:\nFirst run succeeds:\n```\ntests/test_bar.py::test_foo[dynamic_1]\ntests/test_bar.py::test_foo[dynamic_2]\n```\nSecond run fails with:\n```\nERROR collecting tests/test_bar.py\nIn test_foo: 1 parameter sets specified, with different number of ids: 2\n```\n# Expected behavior:\nBoth runs should successfully collect and run the tests with the same parameter sets.\n\n# Versions:\n\nPython: 3.11\n\npytest: 8.3.5\n\nOS: macos\n\n# Additional context:\nThe issue appears to be related to the generator being exhausted after the first run. When the test collection happens again in the second pytest.main() call, the generator has already been consumed, leading to the ID mismatch error.\n\nA workaround is to convert the generator to a list:\n\n```\n@pytest.mark.parametrize(\"bar\", list(data_generator()), ids=lambda x: f\"dynamic_{x}\")\n```\nHowever, this defeats the purpose of using a generator for memory efficiency with large datasets.","closed_by":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13409/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13409/timeline","performed_via_github_app":null,"state_reason":"completed"}