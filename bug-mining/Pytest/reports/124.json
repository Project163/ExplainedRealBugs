{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/4772","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4772/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4772/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4772/events","html_url":"https://github.com/pytest-dev/pytest/issues/4772","id":409238025,"node_id":"MDU6SXNzdWU0MDkyMzgwMjU=","number":4772,"title":"more_itertools throws SyntaxError when pytest installed via setuptools","user":{"login":"dzieciou","id":7452788,"node_id":"MDQ6VXNlcjc0NTI3ODg=","avatar_url":"https://avatars.githubusercontent.com/u/7452788?v=4","gravatar_id":"","url":"https://api.github.com/users/dzieciou","html_url":"https://github.com/dzieciou","followers_url":"https://api.github.com/users/dzieciou/followers","following_url":"https://api.github.com/users/dzieciou/following{/other_user}","gists_url":"https://api.github.com/users/dzieciou/gists{/gist_id}","starred_url":"https://api.github.com/users/dzieciou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dzieciou/subscriptions","organizations_url":"https://api.github.com/users/dzieciou/orgs","repos_url":"https://api.github.com/users/dzieciou/repos","events_url":"https://api.github.com/users/dzieciou/events{/privacy}","received_events_url":"https://api.github.com/users/dzieciou/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-02-12T10:55:26Z","updated_at":"2019-02-12T11:40:42Z","closed_at":"2019-02-12T11:40:42Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I have the following minimal `setup.py`:\r\n\r\n```python\r\n    import setuptools\r\n    \r\n    setuptools.setup(\r\n        setup_requires=['pytest-runner'],\r\n        tests_require=['mock', 'pytest'],\r\n        test_suite='tests',\r\n        python_requires='>=2.7',\r\n    )\r\n```\r\n\r\nwhen running it with \r\n\r\n```bash\r\n    python setup.py test\r\n```\r\n\r\nI keep getting the following error:\r\n\r\n```\r\nTraceback (most recent call last):   File \"setup.py\", line 8, in\r\n\r\n    <module>\r\n        python_requires='>=2.7',   File \"/Users/project/tmp/env/lib/python2.7/site-packages/setuptools/__init__.py\",\r\n    line 145, in setup\r\n        return distutils.core.setup(**attrs)   File \"/usr/local/Cellar/python@2/2.7.15_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/distutils/core.py\",\r\n    line 151, in setup\r\n        dist.run_commands()   File \"/usr/local/Cellar/python@2/2.7.15_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/distutils/dist.py\",\r\n    line 953, in run_commands\r\n        self.run_command(cmd)   File \"/usr/local/Cellar/python@2/2.7.15_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/distutils/dist.py\",\r\n    line 972, in run_command\r\n        cmd_obj.run()   File \"/Users/project/tmp/.eggs/pytest_runner-4.2-py2.7.egg/ptr.py\",\r\n    line 176, in run\r\n        return self.run_tests()   File \"/Users/project/tmp/.eggs/pytest_runner-4.2-py2.7.egg/ptr.py\",\r\n    line 187, in run_tests\r\n        result_code = __import__('pytest').main()   File \"/Users/project/tmp/.eggs/pytest-4.2.0-py2.7.egg/pytest.py\",\r\n    line 14, in <module>\r\n        from _pytest.fixtures import fillfixtures as _fillfuncargs   File \"/Users/project/tmp/.eggs/pytest-4.2.0-py2.7.egg/_pytest/fixtures.py\",\r\n    line 16, in <module>\r\n        from more_itertools import flatten   File \"build/bdist.macosx-10.13-x86_64/egg/more_itertools/__init__.py\", line\r\n    1, in <module  File\r\n    \"/Users/project/tmp/.eggs/more_itertools-6.0.0-py2.7.egg/more_itertools/more.py\",\r\n    line 329\r\n        def _collate(*iterables, key=lambda a: a, reverse=False):\r\n                                   ^ SyntaxError: invalid syntax\r\n```\r\n\r\nThe problem appears also in the tests of more_itertools that are executed during first run, when setup tools installs test dependencies:\r\n\r\n```\r\n    Downloading\r\n    https://files.pythonhosted.org/packages/dd/f4/cdfbb6f07f767e0cd8a11b16adfecc735b6eb87dbebda026ce8898e1cc22/more-itertools-6.0.0.tar.gz#sha256=590044e3942351a1bdb1de960b739ff4ce277960f2425ad4509446dbace8d9d1\r\n    Best match: more-itertools 6.0.0 Processing\r\n    more-itertools-6.0.0.tar.gz Writing\r\n    /var/folders/lq/c1ll7pqx7rb28p7m_8wz3h2d0r0mws/T/easy_install-Auek5Z/more-itertools-6.0.0/setup.cfg\r\n    Running more-itertools-6.0.0/setup.py -q bdist_egg --dist-dir\r\n    /var/folders/lq/c1ll7pqx7rb28p7m_8wz3h2d0r0mws/T/easy_install-Auek5Z/more-itertools-6.0.0/egg-dist-tmp-I3ic_t\r\n    warning: no files found matching 'fabfile.py'   File\r\n    \"build/bdist.macosx-10.13-x86_64/egg/more_itertools/tests/test_more.py\",\r\n    line 892\r\n        print(item, file=f)\r\n                        ^ SyntaxError: invalid syntax\r\n    \r\n      File \"build/bdist.macosx-10.13-x86_64/egg/more_itertools/more.py\",\r\n    line 329\r\n        def _collate(*iterables, key=lambda a: a, reverse=False):\r\n                                   ^ SyntaxError: invalid syntax\r\n    \r\n    zip_safe flag not set; analyzing archive contents... Copying\r\n    more_itertools-6.0.0-py2.7.egg to /Users/project/tmp/.eggs\r\n    \r\n    Installed /Users/project/tmp/.eggs/more_itertools-6.0.0-py2.7.egg\r\n```\r\n\r\nThe problem does not happen when I install more_itertools with\r\n\r\n```bash\r\n    pip install more_itertools\r\n```\r\n\r\nMy environment\r\n\r\n```bash\r\n(env) MBP-OK-32:tmp maciej.gawinecki$ pip list\r\nPackage    Version\r\n---------- -------\r\npip        19.0.2\r\nsetuptools 40.8.0\r\nwheel      0.33.0\r\n(env) MBP-OK-32:tmp maciej.gawinecki$ Python --version\r\nPython 2.7.15\r\n```\r\n\r\nMacOS HighSierra version 10.13.6 \r\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/4772/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4772/timeline","performed_via_github_app":null,"state_reason":"completed"}