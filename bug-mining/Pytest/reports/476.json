{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13026","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13026/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13026/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13026/events","html_url":"https://github.com/pytest-dev/pytest/issues/13026","id":2718190594,"node_id":"I_kwDOAjwLdc6iBEwC","number":13026,"title":"Upgrade pytest from 8.3.3 to 8.3.4 triggers `AttributeError: module 'code' has no attribute '__path__'. Did you mean: '__all__'?`","user":{"login":"petervandenabeele","id":55656,"node_id":"MDQ6VXNlcjU1NjU2","avatar_url":"https://avatars.githubusercontent.com/u/55656?v=4","gravatar_id":"","url":"https://api.github.com/users/petervandenabeele","html_url":"https://github.com/petervandenabeele","followers_url":"https://api.github.com/users/petervandenabeele/followers","following_url":"https://api.github.com/users/petervandenabeele/following{/other_user}","gists_url":"https://api.github.com/users/petervandenabeele/gists{/gist_id}","starred_url":"https://api.github.com/users/petervandenabeele/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/petervandenabeele/subscriptions","organizations_url":"https://api.github.com/users/petervandenabeele/orgs","repos_url":"https://api.github.com/users/petervandenabeele/repos","events_url":"https://api.github.com/users/petervandenabeele/events{/privacy}","received_events_url":"https://api.github.com/users/petervandenabeele/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-12-04T16:01:22Z","updated_at":"2024-12-07T13:41:56Z","closed_at":"2024-12-07T13:41:56Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"- [x] a detailed description of the bug or problem you are having\r\n\r\nI have a number of pytest tests that used to work in 8.3.3.\r\n\r\nSince I upgraded to pytest 8.3.4, these tests fail reliably in 2 different projects.\r\n(see details below).\r\n\r\n- [x] output of `pip list` from the virtual environment you are using\r\n\r\n```\r\npoetry run pip list\r\nPackage                   Version\r\n------------------------- --------------\r\nanyio                     4.6.2.post1\r\nappnope                   0.1.4\r\nargon2-cffi               23.1.0\r\nargon2-cffi-bindings      21.2.0\r\narrow                     1.3.0\r\nasttokens                 3.0.0\r\nasync-lru                 2.0.4\r\nattrs                     24.2.0\r\nbabel                     2.16.0\r\nbeautifulsoup4            4.12.3\r\nblack                     24.10.0\r\nbleach                    6.2.0\r\nboto3                     1.35.74\r\nbotocore                  1.35.74\r\nbuild                     1.2.2.post1\r\nCacheControl              0.14.0\r\ncertifi                   2024.8.30\r\ncffi                      1.17.1\r\ncharset-normalizer        3.4.0\r\ncleo                      2.1.0\r\nclick                     8.1.7\r\ncomm                      0.2.2\r\ncrashtest                 0.4.1\r\ndebugpy                   1.8.9\r\ndecorator                 5.1.1\r\ndefusedxml                0.7.1\r\ndistlib                   0.3.9\r\ndulwich                   0.21.7\r\nexecuting                 2.1.0\r\nfastjsonschema            2.21.1\r\nfilelock                  3.16.1\r\nfqdn                      1.5.1\r\nh11                       0.14.0\r\nhttpcore                  1.0.7\r\nhttpx                     0.28.0\r\nidna                      3.10\r\niniconfig                 2.0.0\r\ninstaller                 0.7.0\r\nipykernel                 6.29.5\r\nipython                   8.30.0\r\nisoduration               20.11.0\r\njaraco.classes            3.4.0\r\njedi                      0.19.2\r\nJinja2                    3.1.4\r\njmespath                  1.0.1\r\njson5                     0.10.0\r\njsonpointer               3.0.0\r\njsonschema                4.23.0\r\njsonschema-specifications 2024.10.1\r\njupyter_client            8.6.3\r\njupyter_core              5.7.2\r\njupyter-events            0.10.0\r\njupyter-lsp               2.2.5\r\njupyter_server            2.14.2\r\njupyter_server_terminals  0.5.3\r\njupyterlab                4.3.2\r\njupyterlab_pygments       0.3.0\r\njupyterlab_server         2.27.3\r\nkeyring                   24.3.1\r\nMarkupSafe                3.0.2\r\nmatplotlib-inline         0.1.7\r\nmistune                   3.0.2\r\nmore-itertools            10.5.0\r\nmsgpack                   1.1.0\r\nmypy-extensions           1.0.0\r\nnbclient                  0.10.1\r\nnbconvert                 7.16.4\r\nnbformat                  5.10.4\r\nnest-asyncio              1.6.0\r\nnotebook_shim             0.2.4\r\nnumpy                     2.1.3\r\noverrides                 7.7.0\r\npackaging                 24.2\r\npandas                    2.2.3\r\npandocfilters             1.5.1\r\nparso                     0.8.4\r\npathspec                  0.12.1\r\npexpect                   4.9.0\r\npip                       24.2\r\npkginfo                   1.11.2\r\nplatformdirs              4.3.6\r\nplotly                    5.24.1\r\npluggy                    1.5.0\r\npoetry                    1.8.4\r\npoetry-core               1.9.1\r\npoetry-plugin-export      1.8.0\r\nprometheus_client         0.21.1\r\nprompt_toolkit            3.0.48\r\npsutil                    6.1.0\r\nptyprocess                0.7.0\r\npure_eval                 0.2.3\r\npycparser                 2.22\r\nPygments                  2.18.0\r\npyproject_hooks           1.2.0\r\npytest                    8.3.3\r\npython-dateutil           2.9.0.post0\r\npython-json-logger        2.0.7\r\npytz                      2024.2\r\nPyYAML                    6.0.2\r\npyzmq                     26.2.0\r\nRapidFuzz                 3.10.1\r\nreferencing               0.35.1\r\nrequests                  2.32.3\r\nrequests-toolbelt         1.0.0\r\nrfc3339-validator         0.1.4\r\nrfc3986-validator         0.1.1\r\nrpds-py                   0.22.3\r\ns3transfer                0.10.4\r\nSend2Trash                1.8.3\r\nsetuptools                75.6.0\r\nshellingham               1.5.4\r\nsix                       1.16.0\r\nsniffio                   1.3.1\r\nsoupsieve                 2.6\r\nstack-data                0.6.3\r\ntenacity                  9.0.0\r\nterminado                 0.18.1\r\ntinycss2                  1.4.0\r\ntokenize_rt               6.1.0\r\ntomlkit                   0.13.2\r\ntornado                   6.4.2\r\ntraitlets                 5.14.3\r\ntrove-classifiers         2024.10.21.16\r\ntypes-python-dateutil     2.9.0.20241003\r\ntzdata                    2024.2\r\nuri-template              1.3.0\r\nurllib3                   2.2.3\r\nvirtualenv                20.27.1\r\nwcwidth                   0.2.13\r\nwebcolors                 24.11.1\r\nwebencodings              0.5.1\r\nwebsocket-client          1.8.0\r\nxattr                     1.1.0\r\n```\r\n\r\n- [x] pytest and operating system versions\r\n\r\n```\r\npytest 8.3.4\r\nMac OS X updated\r\npython 3.13.0\r\n```\r\n\r\nMaybe related to this code below:\r\n\r\n**[tool.pytest.ini_options]\r\naddopts = [\r\n    \"--import-mode=importlib\",\r\n]\r\npythonpath = \"code\"**\r\n\r\n\r\n```\r\n✗ cat pyproject.toml\r\n[tool.poetry]\r\nname = \"...\"\r\nversion = \"0.1.0\"\r\ndescription = \"Analysis for ...\"\r\nauthors = [\"Peter Vandenabeele <peter.vandenabeele@...>\"]\r\nlicense = \"Proprietary\"\r\nreadme = \"README.md\"\r\npackage-mode = false\r\n\r\n[tool.poetry.dependencies]\r\npython = \"^3.13\"\r\nnumpy = \"^2.1.2\"\r\npandas = \"^2.2.3\"\r\njupyterlab = \"^4.2.5\"\r\nboto3 = \"^1.35.51\"\r\nplotly = \"^5.24.1\"\r\n\r\n[tool.poetry.group.dev.dependencies]\r\npytest = \"8.3.4\"  # FAILS with 8.3.4 ;  SUCCESS with 8.3.3 \r\nblack = {version=\"*\", extras=[\"jupyter\"]}\r\n\r\n[tool.pytest.ini_options]\r\naddopts = [\r\n    \"--import-mode=importlib\",\r\n]\r\npythonpath = \"code\"\r\n\r\n[build-system]\r\nrequires = [\"poetry-core\"]\r\nbuild-backend = \"poetry.core.masonry.api\"\r\n```\r\n\r\n- [x] minimal example if possible\r\n\r\n```\r\n___________________________________________ ERROR collecting code/tests/..._test.py ___________________________________________\r\n<frozen importlib._bootstrap_external>:1564: in find_spec\r\n    ???\r\n<frozen importlib._bootstrap_external>:1362: in __init__\r\n    ???\r\n<frozen importlib._bootstrap_external>:1378: in _get_parent_path\r\n    ???\r\nE   AttributeError: module 'code' has no attribute '__path__'. Did you mean: '__all__'?\r\n======================================================== short test summary info =========================================================\r\nERROR code/tests/....._test.py - AttributeError: module 'code' has no attribute '__path__'. Did you mean: '__all__'?\r\nsame 2/4\r\nsame 3/4\r\nsame 4/4\r\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 4 errors during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n=========================================================== 4 errors in 0.09s ============================================================\r\n\r\n✗ vim pyproject.toml  # CHANGE pytest back to 8.3.3\r\n\r\n✗ poetry lock\r\nUpdating dependencies\r\nResolving dependencies... (4.0s)\r\nWriting lock file\r\n\r\n✗ poetry install\r\nInstalling dependencies from lock file\r\n\r\nPackage operations: 0 installs, 1 update, 0 removals\r\n\r\n  - Downgrading pytest (8.3.4 -> 8.3.3)\r\n\r\n✗ pytest\r\n========================================================== test session starts ===========================================================\r\nplatform darwin -- Python 3.13.0, pytest-8.3.3, pluggy-1.5.0\r\nrootdir: /Users/peter_v/BF/github/...\r\nconfigfile: pyproject.toml\r\nplugins: anyio-4.6.2.post1\r\ncollected 58 items\r\n\r\ncode/tests/..._test.py ..                                                                                         [  3%]\r\ncode/tests/..._test.py ......                                                                                        [ 13%]\r\ncode/tests/..._test.py ..............                                                                              [ 37%]\r\ncode/tests/..._test.py ....................................                                                             [100%]\r\n\r\n=========================================================== 58 passed in 0.39s ===========================================================\r\n```","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13026/timeline","performed_via_github_app":null,"state_reason":"completed"}