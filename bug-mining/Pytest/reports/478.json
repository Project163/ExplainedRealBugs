{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13112","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13112/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13112/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13112/events","html_url":"https://github.com/pytest-dev/pytest/issues/13112","id":2771686631,"node_id":"I_kwDOAjwLdc6lNJTn","number":13112,"title":"Pytest's self tests are failing with pygments v2.19.0","user":{"login":"Sillocan","id":1627865,"node_id":"MDQ6VXNlcjE2Mjc4NjU=","avatar_url":"https://avatars.githubusercontent.com/u/1627865?v=4","gravatar_id":"","url":"https://api.github.com/users/Sillocan","html_url":"https://github.com/Sillocan","followers_url":"https://api.github.com/users/Sillocan/followers","following_url":"https://api.github.com/users/Sillocan/following{/other_user}","gists_url":"https://api.github.com/users/Sillocan/gists{/gist_id}","starred_url":"https://api.github.com/users/Sillocan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sillocan/subscriptions","organizations_url":"https://api.github.com/users/Sillocan/orgs","repos_url":"https://api.github.com/users/Sillocan/repos","events_url":"https://api.github.com/users/Sillocan/events{/privacy}","received_events_url":"https://api.github.com/users/Sillocan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2025-01-07T00:52:01Z","updated_at":"2025-01-08T17:04:17Z","closed_at":"2025-01-08T17:04:17Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nThanks for submitting an issue!\r\n\r\nQuick check-list while reporting bugs:\r\n-->\r\n\r\n- [x] a detailed description of the bug or problem you are having\r\n- [x] output of `pip list` from the virtual environment you are using\r\n- [x] pytest and operating system versions\r\n- [x] minimal example if possible\r\n\r\n# Description\r\n\r\nWhen running tox, I am seeing 4 test failures in `test_terminal.py`. I am not seeing these errors when I pin `pygments>=2.7.2,<2.19.0`. I suspect pygments is giving invalid control characters for resetting text formatting. I'm going to open a issue over there in a second.\r\n\r\nI'm using Centos, but have also confirmed the issue on ubuntu 20 and debian 12. I've also confirmed it on python 3.13, 3.12, and 3.8.\r\n\r\nSpecific tests failing:\r\n```\r\n=================================================================================== short test summary info ===================================================================================\r\nFAILED testing/test_terminal.py::test_color_yes - Failed: fnmatch: '\\x1b[[]1m=*= test session starts =*=\\x1b[[]0m'\r\nFAILED testing/test_terminal.py::TestCodeHighlight::test_code_highlight_simple - Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nFAILED testing/test_terminal.py::TestCodeHighlight::test_code_highlight_continuation - Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nFAILED testing/test_terminal.py::TestCodeHighlight::test_code_highlight_custom_theme - Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nXPASS testing/_py/test_local.py::TestLocalPath::test_make_numbered_dir_multiprocess_safe - #11603\r\n```\r\n\r\n# How to recreate\r\n\r\n1. Remove .tox folder to ensure clean run with no cached inputs\r\n3. Run `tox -e py312`\r\n\r\n# Tox output\r\n\r\n<details>\r\n\r\n```\r\n<user>@:~/git-workspaces/pytest$ uv tool run --python=3.12 tox run -e py312 --list-dependencies                                                                              \r\n.pkg: install_requires> python -I -m pip install 'setuptools-scm[toml]>=6.2.3' 'setuptools>=61'\r\n.pkg: _optional_hooks> python /home/<user>/.cache/uv/archive-v0/CQu4szLQA3RcUPX2NK6AM/lib/python3.12/site-packages/pyproject_api/_backend.py True setuptools.build_meta\r\n.pkg: get_requires_for_build_sdist> python /home/<user>/.cache/uv/archive-v0/CQu4szLQA3RcUPX2NK6AM/lib/python3.12/site-packages/pyproject_api/_backend.py True setuptools.build_meta\r\n.pkg: get_requires_for_build_editable> python /home/<user>/.cache/uv/archive-v0/CQu4szLQA3RcUPX2NK6AM/lib/python3.12/site-packages/pyproject_api/_backend.py True setuptools.build_meta\r\n.pkg: freeze> python -m pip freeze --all\r\n.pkg: packaging==24.2,pip==24.3.1,setuptools==75.7.0,setuptools-scm==8.1.0\r\n.pkg: build_sdist> python /home/<user>/.cache/uv/archive-v0/CQu4szLQA3RcUPX2NK6AM/lib/python3.12/site-packages/pyproject_api/_backend.py True setuptools.build_meta\r\npy312: install_package_deps> python -I -m pip install argcomplete 'attrs>=19.2' 'colorama; sys_platform == \"win32\"' 'exceptiongroup>=1.0.0rc8; python_version < \"3.11\"' 'hypothesis>=3.56' iniconfig mock packaging 'pluggy<2,>=1.5' 'pygments>=2.7.2' requests setuptools 'tomli>=1; python_version < \"3.11\"' xmlschema\r\npy312: install_package> python -I -m pip install --force-reinstall --no-deps /home/<user>/git-workspaces/pytest/.tox/.tmp/package/1/pytest-8.3.4.tar.gz\r\npy312: freeze> python -m pip freeze --all\r\npy312: argcomplete==3.5.3,attrs==24.3.0,certifi==2024.12.14,charset-normalizer==3.4.1,elementpath==4.7.0,hypothesis==6.123.4,idna==3.10,iniconfig==2.0.0,mock==5.1.0,packaging==24.2,pip==24.3.1,pluggy==1.5.0,Pygments==2.19.1,pytest @ file:///home/<user>/git-workspaces/pytest/.tox/.tmp/package/1/pytest-8.3.4.tar.gz#sha256=9026cce8eccca1572dc638b9bb2696fff62816778492485d39b9d9346b566833,requests==2.32.3,setuptools==75.7.0,sortedcontainers==2.4.0,urllib3==2.3.0,xmlschema==3.4.3\r\npy312: commands[0]> pytest\r\n===================================================================================== test session starts =====================================================================================\r\nplatform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0\r\ncachedir: .tox/py312/.pytest_cache\r\nrootdir: /home/<user>/git-workspaces/pytest\r\nconfigfile: pyproject.toml\r\ntestpaths: testing\r\nplugins: hypothesis-6.123.4\r\ncollected 3753 items                                                                                                                                                                          \r\n\r\ntesting/_py/test_local.py .................................................................ss..............s.................x.....Xs.....................................sssssss...... [  4%]\r\n......................x...                                                                                                                                                              [  4%]\r\ntesting/acceptance_test.py .....                                                                                                                                                        [  5%]\r\ntesting/code/test_code.py .................                                                                                                                                             [  5%]\r\ntesting/code/test_excinfo.py .................s.......s..............................................................................................................................   [  9%]\r\ntesting/code/test_source.py .......................................................                                                                                                     [ 10%]\r\ntesting/deprecated_test.py ..........                                                                                                                                                   [ 11%]\r\ntesting/freeze/tests/test_doctest.txt .                                                                                                                                                 [ 11%]\r\ntesting/freeze/tests/test_trivial.py ..                                                                                                                                                 [ 11%]\r\ntesting/io/test_pprint.py ......................................                                                                                                                        [ 12%]\r\ntesting/io/test_saferepr.py .............                                                                                                                                               [ 12%]\r\ntesting/io/test_terminalwriter.py .................................................                                                                                                     [ 13%]\r\ntesting/io/test_wcwidth.py .................                                                                                                                                            [ 14%]\r\ntesting/logging/test_fixture.py ...................                                                                                                                                     [ 14%]\r\ntesting/logging/test_formatter.py ....                                                                                                                                                  [ 15%]\r\ntesting/logging/test_reporting.py ..                                                                                                                                                    [ 15%]\r\ntesting/python/approx.py .sss..sssss.......................................sssssss................ss..........                                                                          [ 17%]\r\ntesting/python/collect.py ..                                                                                                                                                            [ 17%]\r\ntesting/python/fixtures.py ...........                                                                                                                                                  [ 17%]\r\ntesting/python/integration.py ....                                                                                                                                                      [ 17%]\r\ntesting/python/metafunc.py .........................................                                                                                                                    [ 18%]\r\ntesting/python/raises.py ........................                                                                                                                                       [ 19%]\r\ntesting/test_argcomplete.py ..                                                                                                                                                          [ 19%]\r\ntesting/test_assertion.py .........................................................................                                                                                     [ 21%]\r\ntesting/test_assertrewrite.py ................................................                                                                                                          [ 22%]\r\ntesting/test_capture.py .............................................................s..                                                                                                [ 24%]\r\ntesting/test_collection.py ..                                                                                                                                                           [ 24%]\r\ntesting/test_compat.py ...........                                                                                                                                                      [ 24%]\r\ntesting/test_config.py .............................................................                                                                                                    [ 26%]\r\ntesting/test_conftest.py ...........                                                                                                                                                    [ 26%]\r\ntesting/test_debugging.py .                                                                                                                                                             [ 26%]\r\ntesting/test_doctest.py .............                                                                                                                                                   [ 27%]\r\ntesting/test_entry_points.py .                                                                                                                                                          [ 27%]\r\ntesting/test_faulthandler.py ...                                                                                                                                                        [ 27%]\r\ntesting/test_findpaths.py ..............s...                                                                                                                                            [ 27%]\r\ntesting/test_helpconfig.py .                                                                                                                                                            [ 27%]\r\ntesting/test_junitxml.py ....                                                                                                                                                           [ 27%]\r\ntesting/test_legacypath.py ....                                                                                                                                                         [ 28%]\r\ntesting/test_main.py .....                                                                                                                                                              [ 28%]\r\ntesting/test_mark.py ..............                                                                                                                                                     [ 28%]\r\ntesting/test_mark_expression.py ............................................................................................................................................            [ 32%]\r\ntesting/test_monkeypatch.py ...............................                                                                                                                             [ 33%]\r\ntesting/test_nodes.py ....                                                                                                                                                              [ 33%]\r\ntesting/test_parseopt.py .............................                                                                                                                                  [ 33%]\r\ntesting/test_pastebin.py ....                                                                                                                                                           [ 34%]\r\ntesting/test_pluginmanager.py .........                                                                                                                                                 [ 34%]\r\ntesting/test_pytester.py .....................                                                                                                                                          [ 34%]\r\ntesting/test_recwarn.py .........................................................                                                                                                       [ 36%]\r\ntesting/test_runner.py ...............                                                                                                                                                  [ 36%]\r\ntesting/test_scope.py ....                                                                                                                                                              [ 36%]\r\ntesting/test_skipping.py .                                                                                                                                                              [ 36%]\r\ntesting/test_stash.py .                                                                                                                                                                 [ 36%]\r\ntesting/test_terminal.py .......................................                                                                                                                        [ 37%]\r\ntesting/test_tmpdir.py ...s...............                                                                                                                                              [ 38%]\r\ntesting/test_warning_types.py ..............                                                                                                                                            [ 38%]\r\ntesting/test_warnings.py .                                                                                                                                                              [ 38%]\r\ntesting/acceptance_test.py ......................................................x....................s.                                                                                [ 40%]\r\ntesting/code/test_excinfo.py .............sssssssss......                                                                                                                               [ 41%]\r\ntesting/deprecated_test.py ....                                                                                                                                                         [ 41%]\r\ntesting/examples/test_issue519.py .                                                                                                                                                     [ 41%]\r\ntesting/logging/test_fixture.py ........                                                                                                                                                [ 42%]\r\ntesting/logging/test_reporting.py ..................................................                                                                                                    [ 43%]\r\ntesting/python/approx.py .                                                                                                                                                              [ 43%]\r\ntesting/python/collect.py ...............................................................................                                                                               [ 45%]\r\ntesting/python/fixtures.py ........................................................................x................................................................................... [ 49%]\r\n.....................s.......                                                                                                                                                           [ 50%]\r\ntesting/python/integration.py ...............                                                                                                                                           [ 50%]\r\ntesting/python/metafunc.py .................................................................                                                                                            [ 52%]\r\ntesting/python/raises.py ....                                                                                                                                                           [ 52%]\r\ntesting/python/show_fixtures_per_test.py ........                                                                                                                                       [ 52%]\r\ntesting/test_assertion.py ................................................                                                                                                              [ 54%]\r\ntesting/test_assertrewrite.py ..................................................................                                                                                        [ 55%]\r\ntesting/test_cacheprovider.py .........................................................                                                                                                 [ 57%]\r\ntesting/test_capture.py ......x....................................                                                                                                                     [ 58%]\r\ntesting/test_collection.py ................x............................................s................s..                                                                            [ 60%]\r\ntesting/test_compat.py ..                                                                                                                                                               [ 60%]\r\ntesting/test_config.py ..................x......................................................................................................................                        [ 64%]\r\ntesting/test_conftest.py .............s.............................                                                                                                                    [ 65%]\r\ntesting/test_debugging.py .............                                                                                                                                                 [ 65%]\r\ntesting/test_doctest.py ................................................................x...............................................................                                [ 69%]\r\ntesting/test_error_diffs.py ............                                                                                                                                                [ 69%]\r\ntesting/test_faulthandler.py ...                                                                                                                                                        [ 69%]\r\ntesting/test_helpconfig.py ........                                                                                                                                                     [ 69%]\r\ntesting/test_junitxml.py ..................................................................................................s...s........................                                [ 73%]\r\ntesting/test_legacypath.py ..........                                                                                                                                                   [ 73%]\r\ntesting/test_link_resolve.py .                                                                                                                                                          [ 73%]\r\ntesting/test_main.py ..............                                                                                                                                                     [ 73%]\r\ntesting/test_mark.py ......................................................................x.................                                                                           [ 76%]\r\ntesting/test_monkeypatch.py ....                                                                                                                                                        [ 76%]\r\ntesting/test_nodes.py ....                                                                                                                                                              [ 76%]\r\ntesting/test_parseopt.py .                                                                                                                                                              [ 76%]\r\ntesting/test_pastebin.py ...                                                                                                                                                            [ 76%]\r\ntesting/test_pathlib.py ............................................................s.........................................                                                          [ 79%]\r\ntesting/test_pluginmanager.py ....s............                                                                                                                                         [ 79%]\r\ntesting/test_pytester.py x........................                                                                                                                                      [ 80%]\r\ntesting/test_python_path.py .....                                                                                                                                                       [ 80%]\r\ntesting/test_recwarn.py .....                                                                                                                                                           [ 80%]\r\ntesting/test_reports.py ..................                                                                                                                                              [ 81%]\r\ntesting/test_runner.py ........................x...........................                                                                                                             [ 82%]\r\ntesting/test_runner_xunit.py .............                                                                                                                                              [ 82%]\r\ntesting/test_session.py ..........................                                                                                                                                      [ 83%]\r\ntesting/test_setuponly.py ..........................                                                                                                                                    [ 84%]\r\ntesting/test_setupplan.py ...                                                                                                                                                           [ 84%]\r\ntesting/test_skipping.py .........................................................................................                                                                      [ 86%]\r\ntesting/test_stepwise.py ..............                                                                                                                                                 [ 87%]\r\ntesting/test_terminal.py .................................................s..............F..........................................sss......s....FFF......................             [ 91%]\r\ntesting/test_threadexception.py ....                                                                                                                                                    [ 91%]\r\ntesting/test_tmpdir.py ....................                                                                                                                                             [ 91%]\r\ntesting/test_unittest.py ......................sssssss.................................s............                                                                                    [ 93%]\r\ntesting/test_unraisableexception.py ....                                                                                                                                                [ 93%]\r\ntesting/test_warning_types.py .                                                                                                                                                         [ 93%]\r\ntesting/test_warnings.py ...................sss..........                                                                                                                               [ 94%]\r\ntesting/acceptance_test.py .....                                                                                                                                                        [ 94%]\r\ntesting/python/collect.py .                                                                                                                                                             [ 94%]\r\ntesting/python/fixtures.py ..                                                                                                                                                           [ 94%]\r\ntesting/test_assertion.py ............                                                                                                                                                  [ 95%]\r\ntesting/test_assertrewrite.py .........                                                                                                                                                 [ 95%]\r\ntesting/test_capture.py ........................                                                                                                                                        [ 96%]\r\ntesting/test_collection.py ...                                                                                                                                                          [ 96%]\r\ntesting/test_compat.py s                                                                                                                                                                [ 96%]\r\ntesting/test_config.py ..                                                                                                                                                               [ 96%]\r\ntesting/test_debugging.py sssssssssss.ssssssssssssssss.sss....ssss.sss                                                                                                                  [ 97%]\r\ntesting/test_faulthandler.py ..s.                                                                                                                                                       [ 97%]\r\ntesting/test_helpconfig.py ..                                                                                                                                                           [ 97%]\r\ntesting/test_legacypath.py .                                                                                                                                                            [ 97%]\r\ntesting/test_meta.py ...................................................................                                                                                                [ 99%]\r\ntesting/test_pytester.py ....s                                                                                                                                                          [ 99%]\r\ntesting/test_recwarn.py .                                                                                                                                                               [ 99%]\r\ntesting/test_reports.py .                                                                                                                                                               [ 99%]\r\ntesting/test_terminal.py ss..                                                                                                                                                           [ 99%]\r\ntesting/test_unittest.py s.                                                                                                                                                             [ 99%]\r\ntesting/test_warnings.py .........                                                                                                                                                      [100%]\r\n\r\n========================================================================================== FAILURES ===========================================================================================\r\n_______________________________________________________________________________________ test_color_yes ________________________________________________________________________________________\r\n\r\npytester = <Pytester PosixPath('/tmp/pytest-of-<user>/pytest-19/test_color_yes0')>, color_mapping = <class 'conftest.color_mapping.<locals>.ColorMapping'>\r\n\r\n    def test_color_yes(pytester: Pytester, color_mapping) -> None:\r\n        p1 = pytester.makepyfile(\r\n            \"\"\"\r\n            def fail():\r\n                assert 0\r\n    \r\n            def test_this():\r\n                fail()\r\n            \"\"\"\r\n        )\r\n        result = pytester.runpytest(\"--color=yes\", str(p1))\r\n>       result.stdout.fnmatch_lines(\r\n            color_mapping.format_for_fnmatch(\r\n                [\r\n                    \"{bold}=*= test session starts =*={reset}\",\r\n                    \"collected 1 item\",\r\n                    \"\",\r\n                    \"test_color_yes.py {red}F{reset}{red} * [100%]{reset}\",\r\n                    \"\",\r\n                    \"=*= FAILURES =*=\",\r\n                    \"{red}{bold}_*_ test_this _*_{reset}\",\r\n                    \"\",\r\n                    \"    {reset}{kw}def{hl-reset} {function}test_this{hl-reset}():{endline}\",\r\n                    \">       fail(){endline}\",\r\n                    \"\",\r\n                    \"{bold}{red}test_color_yes.py{reset}:5: \",\r\n                    \"_ _ * _ _*\",\r\n                    \"\",\r\n                    \"    {reset}{kw}def{hl-reset} {function}fail{hl-reset}():{endline}\",\r\n                    \">       {kw}assert{hl-reset} {number}0{hl-reset}{endline}\",\r\n                    \"{bold}{red}E       assert 0{reset}\",\r\n                    \"\",\r\n                    \"{bold}{red}test_color_yes.py{reset}:2: AssertionError\",\r\n                    \"{red}=*= {red}{bold}1 failed{reset}{red} in *s{reset}{red} =*={reset}\",\r\n                ]\r\n            )\r\n        )\r\nE       Failed: fnmatch: '\\x1b[[]1m=*= test session starts =*=\\x1b[[]0m'\r\nE          with: '\\x1b[1m============================= test session starts ==============================\\x1b[0m'\r\nE       nomatch: 'collected 1 item'\r\nE           and: 'platform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0'\r\nE           and: 'rootdir: /tmp/pytest-of-<user>/pytest-19/test_color_yes0'\r\nE       exact match: 'collected 1 item'\r\nE       exact match: ''\r\nE       fnmatch: 'test_color_yes.py \\x1b[[]31mF\\x1b[[]0m\\x1b[[]31m * [[]100%]\\x1b[[]0m'\r\nE          with: 'test_color_yes.py \\x1b[31mF\\x1b[0m\\x1b[31m                                                      [100%]\\x1b[0m'\r\nE       exact match: ''\r\nE       fnmatch: '=*= FAILURES =*='\r\nE          with: '=================================== FAILURES ==================================='\r\nE       fnmatch: '\\x1b[[]31m\\x1b[[]1m_*_ test_this _*_\\x1b[[]0m'\r\nE          with: '\\x1b[31m\\x1b[1m__________________________________ test_this ___________________________________\\x1b[0m'\r\nE       exact match: ''\r\nE       nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_this\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nE           and: '    \\x1b[0m\\x1b[94mdef\\x1b[39;49;00m\\x1b[90m \\x1b[39;49;00m\\x1b[92mtest_this\\x1b[39;49;00m():\\x1b[90m\\x1b[39;49;00m'\r\nE           and: '>       fail()\\x1b[90m\\x1b[39;49;00m'\r\nE           and: ''\r\nE           and: '\\x1b[1m\\x1b[31mtest_color_yes.py\\x1b[0m:5: '\r\nE           and: '_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ '\r\nE           and: ''\r\nE           and: '    \\x1b[0m\\x1b[94mdef\\x1b[39;49;00m\\x1b[90m \\x1b[39;49;00m\\x1b[92mfail\\x1b[39;49;00m():\\x1b[90m\\x1b[39;49;00m'\r\nE           and: '>       \\x1b[94massert\\x1b[39;49;00m \\x1b[94m0\\x1b[39;49;00m\\x1b[90m\\x1b[39;49;00m'\r\nE           and: '\\x1b[1m\\x1b[31mE       assert 0\\x1b[0m'\r\nE           and: ''\r\nE           and: '\\x1b[1m\\x1b[31mtest_color_yes.py\\x1b[0m:2: AssertionError'\r\nE           and: '\\x1b[36m\\x1b[1m=========================== short test summary info ============================\\x1b[0m'\r\nE           and: '\\x1b[31mFAILED\\x1b[0m test_color_yes.py::\\x1b[1mtest_this\\x1b[0m - assert 0'\r\nE           and: '\\x1b[31m============================== \\x1b[31m\\x1b[1m1 failed\\x1b[0m\\x1b[31m in 0.01s\\x1b[0m\\x1b[31m ===============================\\x1b[0m'\r\nE       remains unmatched: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_this\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\n\r\n/home/<user>/git-workspaces/pytest/testing/test_terminal.py:1291: Failed\r\n------------------------------------------------------------------------------------ Captured stdout call -------------------------------------------------------------------------------------\r\n============================= test session starts ==============================\r\nplatform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0\r\nrootdir: /tmp/pytest-of-<user>/pytest-19/test_color_yes0\r\ncollected 1 item\r\n\r\ntest_color_yes.py F                                                      [100%]\r\n\r\n=================================== FAILURES ===================================\r\n__________________________________ test_this ___________________________________\r\n\r\n    def test_this():\r\n>       fail()\r\n\r\ntest_color_yes.py:5: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\n    def fail():\r\n>       assert 0\r\nE       assert 0\r\n\r\ntest_color_yes.py:2: AssertionError\r\n=========================== short test summary info ============================\r\nFAILED test_color_yes.py::test_this - assert 0\r\n============================== 1 failed in 0.01s ===============================\r\n________________________________________________________________________ TestCodeHighlight.test_code_highlight_simple _________________________________________________________________________\r\n\r\nself = <test_terminal.TestCodeHighlight object at 0x7fa80e0ecfe0>, pytester = <Pytester PosixPath('/tmp/pytest-of-<user>/pytest-19/test_code_highlight_simple0')>\r\ncolor_mapping = <class 'conftest.color_mapping.<locals>.ColorMapping'>\r\n\r\n    def test_code_highlight_simple(self, pytester: Pytester, color_mapping) -> None:\r\n        pytester.makepyfile(\r\n            \"\"\"\r\n            def test_foo():\r\n                assert 1 == 10\r\n        \"\"\"\r\n        )\r\n        result = pytester.runpytest(\"--color=yes\")\r\n>       result.stdout.fnmatch_lines(\r\n            color_mapping.format_for_fnmatch(\r\n                [\r\n                    \"    {reset}{kw}def{hl-reset} {function}test_foo{hl-reset}():{endline}\",\r\n                    \">       {kw}assert{hl-reset} {number}1{hl-reset} == {number}10{hl-reset}{endline}\",\r\n                    \"{bold}{red}E       assert 1 == 10{reset}\",\r\n                ]\r\n            )\r\n        )\r\nE       Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nE           and: '\\x1b[1m============================= test session starts ==============================\\x1b[0m'\r\nE           and: 'platform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0'\r\nE           and: 'rootdir: /tmp/pytest-of-<user>/pytest-19/test_code_highlight_simple0'\r\nE           and: 'collected 1 item'\r\nE           and: ''\r\nE           and: 'test_code_highlight_simple.py \\x1b[31mF\\x1b[0m\\x1b[31m                                          [100%]\\x1b[0m'\r\nE           and: ''\r\nE           and: '=================================== FAILURES ==================================='\r\nE           and: '\\x1b[31m\\x1b[1m___________________________________ test_foo ___________________________________\\x1b[0m'\r\nE           and: ''\r\nE           and: '    \\x1b[0m\\x1b[94mdef\\x1b[39;49;00m\\x1b[90m \\x1b[39;49;00m\\x1b[92mtest_foo\\x1b[39;49;00m():\\x1b[90m\\x1b[39;49;00m'\r\nE           and: '>       \\x1b[94massert\\x1b[39;49;00m \\x1b[94m1\\x1b[39;49;00m == \\x1b[94m10\\x1b[39;49;00m\\x1b[90m\\x1b[39;49;00m'\r\nE           and: '\\x1b[1m\\x1b[31mE       assert 1 == 10\\x1b[0m'\r\nE           and: ''\r\nE           and: '\\x1b[1m\\x1b[31mtest_code_highlight_simple.py\\x1b[0m:2: AssertionError'\r\nE           and: '\\x1b[36m\\x1b[1m=========================== short test summary info ============================\\x1b[0m'\r\nE           and: '\\x1b[31mFAILED\\x1b[0m test_code_highlight_simple.py::\\x1b[1mtest_foo\\x1b[0m - assert 1 == 10'\r\nE           and: '\\x1b[31m============================== \\x1b[31m\\x1b[1m1 failed\\x1b[0m\\x1b[31m in 0.01s\\x1b[0m\\x1b[31m ===============================\\x1b[0m'\r\nE       remains unmatched: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\n\r\n/home/<user>/git-workspaces/pytest/testing/test_terminal.py:2585: Failed\r\n------------------------------------------------------------------------------------ Captured stdout call -------------------------------------------------------------------------------------\r\n============================= test session starts ==============================\r\nplatform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0\r\nrootdir: /tmp/pytest-of-<user>/pytest-19/test_code_highlight_simple0\r\ncollected 1 item\r\n\r\ntest_code_highlight_simple.py F                                          [100%]\r\n\r\n=================================== FAILURES ===================================\r\n___________________________________ test_foo ___________________________________\r\n\r\n    def test_foo():\r\n>       assert 1 == 10\r\nE       assert 1 == 10\r\n\r\ntest_code_highlight_simple.py:2: AssertionError\r\n=========================== short test summary info ============================\r\nFAILED test_code_highlight_simple.py::test_foo - assert 1 == 10\r\n============================== 1 failed in 0.01s ===============================\r\n_____________________________________________________________________ TestCodeHighlight.test_code_highlight_continuation ______________________________________________________________________\r\n\r\nself = <test_terminal.TestCodeHighlight object at 0x7fa80e0ed1f0>, pytester = <Pytester PosixPath('/tmp/pytest-of-<user>/pytest-19/test_code_highlight_continuation0')>\r\ncolor_mapping = <class 'conftest.color_mapping.<locals>.ColorMapping'>\r\n\r\n    def test_code_highlight_continuation(\r\n        self, pytester: Pytester, color_mapping\r\n    ) -> None:\r\n        pytester.makepyfile(\r\n            \"\"\"\r\n            def test_foo():\r\n                print('''\r\n                '''); assert 0\r\n        \"\"\"\r\n        )\r\n        result = pytester.runpytest(\"--color=yes\")\r\n    \r\n>       result.stdout.fnmatch_lines(\r\n            color_mapping.format_for_fnmatch(\r\n                [\r\n                    \"    {reset}{kw}def{hl-reset} {function}test_foo{hl-reset}():{endline}\",\r\n                    \"        {print}print{hl-reset}({str}'''{hl-reset}{str}{hl-reset}\",\r\n                    \">   {str}    {hl-reset}{str}'''{hl-reset}); {kw}assert{hl-reset} {number}0{hl-reset}{endline}\",\r\n                    \"{bold}{red}E       assert 0{reset}\",\r\n                ]\r\n            )\r\n        )\r\nE       Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nE           and: '\\x1b[1m============================= test session starts ==============================\\x1b[0m'\r\nE           and: 'platform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0'\r\nE           and: 'rootdir: /tmp/pytest-of-<user>/pytest-19/test_code_highlight_continuation0'\r\nE           and: 'collected 1 item'\r\nE           and: ''\r\nE           and: 'test_code_highlight_continuation.py \\x1b[31mF\\x1b[0m\\x1b[31m                                    [100%]\\x1b[0m'\r\nE           and: ''\r\nE           and: '=================================== FAILURES ==================================='\r\nE           and: '\\x1b[31m\\x1b[1m___________________________________ test_foo ___________________________________\\x1b[0m'\r\nE           and: ''\r\nE           and: '    \\x1b[0m\\x1b[94mdef\\x1b[39;49;00m\\x1b[90m \\x1b[39;49;00m\\x1b[92mtest_foo\\x1b[39;49;00m():\\x1b[90m\\x1b[39;49;00m'\r\nE           and: \"        \\x1b[96mprint\\x1b[39;49;00m(\\x1b[33m'''\\x1b[39;49;00m\\x1b[33m\\x1b[39;49;00m\"\r\nE           and: \">   \\x1b[33m    \\x1b[39;49;00m\\x1b[33m'''\\x1b[39;49;00m); \\x1b[94massert\\x1b[39;49;00m \\x1b[94m0\\x1b[39;49;00m\\x1b[90m\\x1b[39;49;00m\"\r\nE           and: '\\x1b[1m\\x1b[31mE       assert 0\\x1b[0m'\r\nE           and: ''\r\nE           and: '\\x1b[1m\\x1b[31mtest_code_highlight_continuation.py\\x1b[0m:3: AssertionError'\r\nE           and: '----------------------------- Captured stdout call -----------------------------'\r\nE           and: ''\r\nE           and: '    '\r\nE           and: '\\x1b[36m\\x1b[1m=========================== short test summary info ============================\\x1b[0m'\r\nE           and: '\\x1b[31mFAILED\\x1b[0m test_code_highlight_continuation.py::\\x1b[1mtest_foo\\x1b[0m - assert 0'\r\nE           and: '\\x1b[31m============================== \\x1b[31m\\x1b[1m1 failed\\x1b[0m\\x1b[31m in 0.01s\\x1b[0m\\x1b[31m ===============================\\x1b[0m'\r\nE       remains unmatched: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\n\r\n/home/<user>/git-workspaces/pytest/testing/test_terminal.py:2607: Failed\r\n------------------------------------------------------------------------------------ Captured stdout call -------------------------------------------------------------------------------------\r\n============================= test session starts ==============================\r\nplatform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0\r\nrootdir: /tmp/pytest-of-<user>/pytest-19/test_code_highlight_continuation0\r\ncollected 1 item\r\n\r\ntest_code_highlight_continuation.py F                                    [100%]\r\n\r\n=================================== FAILURES ===================================\r\n___________________________________ test_foo ___________________________________\r\n\r\n    def test_foo():\r\n        print('''\r\n>       '''); assert 0\r\nE       assert 0\r\n\r\ntest_code_highlight_continuation.py:3: AssertionError\r\n----------------------------- Captured stdout call -----------------------------\r\n\r\n    \r\n=========================== short test summary info ============================\r\nFAILED test_code_highlight_continuation.py::test_foo - assert 0\r\n============================== 1 failed in 0.01s ===============================\r\n_____________________________________________________________________ TestCodeHighlight.test_code_highlight_custom_theme ______________________________________________________________________\r\n\r\nself = <test_terminal.TestCodeHighlight object at 0x7fa80e0ed430>, pytester = <Pytester PosixPath('/tmp/pytest-of-<user>/pytest-19/test_code_highlight_custom_theme0')>\r\ncolor_mapping = <class 'conftest.color_mapping.<locals>.ColorMapping'>, monkeypatch = <_pytest.monkeypatch.MonkeyPatch object at 0x7fa80c3dda90>\r\n\r\n    def test_code_highlight_custom_theme(\r\n        self, pytester: Pytester, color_mapping, monkeypatch: MonkeyPatch\r\n    ) -> None:\r\n        pytester.makepyfile(\r\n            \"\"\"\r\n            def test_foo():\r\n                assert 1 == 10\r\n        \"\"\"\r\n        )\r\n        monkeypatch.setenv(\"PYTEST_THEME\", \"solarized-dark\")\r\n        monkeypatch.setenv(\"PYTEST_THEME_MODE\", \"dark\")\r\n        result = pytester.runpytest(\"--color=yes\")\r\n>       result.stdout.fnmatch_lines(\r\n            color_mapping.format_for_fnmatch(\r\n                [\r\n                    \"    {reset}{kw}def{hl-reset} {function}test_foo{hl-reset}():{endline}\",\r\n                    \">       {kw}assert{hl-reset} {number}1{hl-reset} == {number}10{hl-reset}{endline}\",\r\n                    \"{bold}{red}E       assert 1 == 10{reset}\",\r\n                ]\r\n            )\r\n        )\r\nE       Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nE           and: '\\x1b[1m============================= test session starts ==============================\\x1b[0m'\r\nE           and: 'platform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0'\r\nE           and: 'rootdir: /tmp/pytest-of-<user>/pytest-19/test_code_highlight_custom_theme0'\r\nE           and: 'collected 1 item'\r\nE           and: ''\r\nE           and: 'test_code_highlight_custom_theme.py \\x1b[31mF\\x1b[0m\\x1b[31m                                    [100%]\\x1b[0m'\r\nE           and: ''\r\nE           and: '=================================== FAILURES ==================================='\r\nE           and: '\\x1b[31m\\x1b[1m___________________________________ test_foo ___________________________________\\x1b[0m'\r\nE           and: ''\r\nE           and: '    \\x1b[0m\\x1b[94mdef\\x1b[39;49;00m\\x1b[90m \\x1b[39;49;00m\\x1b[92mtest_foo\\x1b[39;49;00m():\\x1b[90m\\x1b[39;49;00m'\r\nE           and: '>       \\x1b[94massert\\x1b[39;49;00m \\x1b[94m1\\x1b[39;49;00m == \\x1b[94m10\\x1b[39;49;00m\\x1b[90m\\x1b[39;49;00m'\r\nE           and: '\\x1b[1m\\x1b[31mE       assert 1 == 10\\x1b[0m'\r\nE           and: ''\r\nE           and: '\\x1b[1m\\x1b[31mtest_code_highlight_custom_theme.py\\x1b[0m:2: AssertionError'\r\nE           and: '\\x1b[36m\\x1b[1m=========================== short test summary info ============================\\x1b[0m'\r\nE           and: '\\x1b[31mFAILED\\x1b[0m test_code_highlight_custom_theme.py::\\x1b[1mtest_foo\\x1b[0m - assert 1 == 10'\r\nE           and: '\\x1b[31m============================== \\x1b[31m\\x1b[1m1 failed\\x1b[0m\\x1b[31m in 0.01s\\x1b[0m\\x1b[31m ===============================\\x1b[0m'\r\nE       remains unmatched: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\n\r\n/home/<user>/git-workspaces/pytest/testing/test_terminal.py:2630: Failed\r\n------------------------------------------------------------------------------------ Captured stdout call -------------------------------------------------------------------------------------\r\n============================= test session starts ==============================\r\nplatform linux -- Python 3.12.5, pytest-8.3.4, pluggy-1.5.0\r\nrootdir: /tmp/pytest-of-<user>/pytest-19/test_code_highlight_custom_theme0\r\ncollected 1 item\r\n\r\ntest_code_highlight_custom_theme.py F                                    [100%]\r\n\r\n=================================== FAILURES ===================================\r\n___________________________________ test_foo ___________________________________\r\n\r\n    def test_foo():\r\n>       assert 1 == 10\r\nE       assert 1 == 10\r\n\r\ntest_code_highlight_custom_theme.py:2: AssertionError\r\n=========================== short test summary info ============================\r\nFAILED test_code_highlight_custom_theme.py::test_foo - assert 1 == 10\r\n============================== 1 failed in 0.01s ===============================\r\n=========================================================================================== XPASSES ===========================================================================================\r\n=================================================================================== short test summary info ===================================================================================\r\nFAILED testing/test_terminal.py::test_color_yes - Failed: fnmatch: '\\x1b[[]1m=*= test session starts =*=\\x1b[[]0m'\r\nFAILED testing/test_terminal.py::TestCodeHighlight::test_code_highlight_simple - Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nFAILED testing/test_terminal.py::TestCodeHighlight::test_code_highlight_continuation - Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nFAILED testing/test_terminal.py::TestCodeHighlight::test_code_highlight_custom_theme - Failed: nomatch: '    \\x1b[[]0m\\x1b[[]94mdef\\x1b[[]39;49;00m \\x1b[[]92mtest_foo\\x1b[[]39;49;00m():\\x1b[[]90m\\x1b[[]39;49;00m'\r\nXPASS testing/_py/test_local.py::TestLocalPath::test_make_numbered_dir_multiprocess_safe - #11603\r\n======================================================= 4 failed, 3627 passed, 110 skipped, 11 xfailed, 1 xpassed in 147.69s (0:02:27) ========================================================\r\npy312: exit 1 (148.30 seconds) /home/<user>/git-workspaces/pytest> pytest pid=2583682\r\n  py312: FAIL code 1 (163.94=setup[15.64]+cmd[148.30] seconds)\r\n  evaluation failed :( (164.06 seconds)\r\n```\r\n\r\n</details>\r\n\r\n---\r\n\r\n*(Edited by @The-Compiler to fold away the lengthy output)*\r\n","closed_by":{"login":"The-Compiler","id":625793,"node_id":"MDQ6VXNlcjYyNTc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/625793?v=4","gravatar_id":"","url":"https://api.github.com/users/The-Compiler","html_url":"https://github.com/The-Compiler","followers_url":"https://api.github.com/users/The-Compiler/followers","following_url":"https://api.github.com/users/The-Compiler/following{/other_user}","gists_url":"https://api.github.com/users/The-Compiler/gists{/gist_id}","starred_url":"https://api.github.com/users/The-Compiler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/The-Compiler/subscriptions","organizations_url":"https://api.github.com/users/The-Compiler/orgs","repos_url":"https://api.github.com/users/The-Compiler/repos","events_url":"https://api.github.com/users/The-Compiler/events{/privacy}","received_events_url":"https://api.github.com/users/The-Compiler/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13112/timeline","performed_via_github_app":null,"state_reason":"completed"}