{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13376","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13376/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13376/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13376/events","html_url":"https://github.com/pytest-dev/pytest/issues/13376","id":2996754102,"node_id":"I_kwDOAjwLdc6ynta2","number":13376,"title":"Bug in _pytest.compat.getfuncargnames() corrupts fixture handling for test methods w/ positional-only self parameter","user":{"login":"purplezimmermann","id":23742275,"node_id":"MDQ6VXNlcjIzNzQyMjc1","avatar_url":"https://avatars.githubusercontent.com/u/23742275?v=4","gravatar_id":"","url":"https://api.github.com/users/purplezimmermann","html_url":"https://github.com/purplezimmermann","followers_url":"https://api.github.com/users/purplezimmermann/followers","following_url":"https://api.github.com/users/purplezimmermann/following{/other_user}","gists_url":"https://api.github.com/users/purplezimmermann/gists{/gist_id}","starred_url":"https://api.github.com/users/purplezimmermann/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/purplezimmermann/subscriptions","organizations_url":"https://api.github.com/users/purplezimmermann/orgs","repos_url":"https://api.github.com/users/purplezimmermann/repos","events_url":"https://api.github.com/users/purplezimmermann/events{/privacy}","received_events_url":"https://api.github.com/users/purplezimmermann/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-04-15T15:01:21Z","updated_at":"2025-04-18T21:18:38Z","closed_at":"2025-04-18T21:18:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\nThanks for submitting an issue!\n\nQuick check-list while reporting bugs:\n-->\n\n- [x] a detailed description of the bug or problem you are having\n- _Doesn't depend on specific packages_ [ ] output of `pip list` from the virtual environment you are using\n- _Isn't related to specific Pytest versions_ [ ] pytest and operating system versions\n- [x] minimal example if possible\n\n### Basic example\n\n**Passing:**\n\n```python\nimport pytest\n\n@pytest.fixture\ndef value_fixture():\n    return 'value'\n\nclass TestClass:\n\n    def test_value(self, value_fixture):\n        assert value_fixture == 'value'\n```\n\n**Failing:**\n\n```python\nimport pytest\n\n\n@pytest.fixture\ndef value_fixture():\n    return 'value'\n\n\nclass TestClass:\n\n    def test_value(self, /, value_fixture):\n        assert value_fixture == 'value'\n```\n\n* Result:\n\n```python\npyfuncitem = <Function test_value>\n\n    @hookimpl(trylast=True)\n    def pytest_pyfunc_call(pyfuncitem: Function) -> object | None:\n        testfunction = pyfuncitem.obj\n        if is_async_function(testfunction):\n            async_fail(pyfuncitem.nodeid)\n        funcargs = pyfuncitem.funcargs\n        testargs = {arg: funcargs[arg] for arg in pyfuncitem._fixtureinfo.argnames}\n>       result = testfunction(**testargs)\n                 ^^^^^^^^^^^^^^^^^^^^^^^^\nE       TypeError: TestClass.test_value() missing 1 required positional argument: 'value_fixture'\n```\n\n### Reason\n\n`_pytest.compat.getfuncargnames()` collects keyword-callable parameters as fixture-receiving arguments:\n\nhttps://github.com/pytest-dev/pytest/blob/103b2b67b015b5f677eef471c3d34706b5efedaa/src/_pytest/compat.py#L134-L142\n\nThen it removes the first one – supposedly `'self'` – if given `function` is a non-static method:\n\nhttps://github.com/pytest-dev/pytest/blob/103b2b67b015b5f677eef471c3d34706b5efedaa/src/_pytest/compat.py#L149-L157\n\nYet, if `'self'` is defined as positional only, it wasn't contained in `arg_names` before removal ...\n\n\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13376/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13376/timeline","performed_via_github_app":null,"state_reason":"completed"}