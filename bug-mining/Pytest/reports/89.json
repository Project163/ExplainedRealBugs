{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/4221","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4221/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4221/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4221/events","html_url":"https://github.com/pytest-dev/pytest/issues/4221","id":373235005,"node_id":"MDU6SXNzdWUzNzMyMzUwMDU=","number":4221,"title":"Captured warnings missing file and test that triggered them in Pytest >=3.8.0","user":{"login":"CAM-Gerlach","id":17051931,"node_id":"MDQ6VXNlcjE3MDUxOTMx","avatar_url":"https://avatars.githubusercontent.com/u/17051931?v=4","gravatar_id":"","url":"https://api.github.com/users/CAM-Gerlach","html_url":"https://github.com/CAM-Gerlach","followers_url":"https://api.github.com/users/CAM-Gerlach/followers","following_url":"https://api.github.com/users/CAM-Gerlach/following{/other_user}","gists_url":"https://api.github.com/users/CAM-Gerlach/gists{/gist_id}","starred_url":"https://api.github.com/users/CAM-Gerlach/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CAM-Gerlach/subscriptions","organizations_url":"https://api.github.com/users/CAM-Gerlach/orgs","repos_url":"https://api.github.com/users/CAM-Gerlach/repos","events_url":"https://api.github.com/users/CAM-Gerlach/events{/privacy}","received_events_url":"https://api.github.com/users/CAM-Gerlach/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":315571544,"node_id":"MDU6TGFiZWwzMTU1NzE1NDQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20regression","name":"type: regression","color":"f7c6c7","default":false,"description":"indicates a problem that was introduced in a release which was working previously"},{"id":615327396,"node_id":"MDU6TGFiZWw2MTUzMjczOTY=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20warnings","name":"plugin: warnings","color":"fef2c0","default":false,"description":"related to the warnings builtin plugin"}],"state":"closed","locked":false,"assignee":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2018-10-23T22:51:44Z","updated_at":"2018-10-25T06:26:02Z","closed_at":"2018-10-25T06:26:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In pytest >= 3.8.0 (3.6.2-3..7.4 confirmed to not have this problem, while 3.8.0-3.9.1 all do), captured warnings are missing a very crucial piece of information: the file and test that originally triggered them. In a large codebase like that of the Spyder IDE (of which I'm a developer) that relies on pytest for its testing framework (as well as integrating support within the IDE), with hundreds of files and thousands of tests its crippling to only see the file and line in whatever third party dependency actually issued the warning, rather than also including the actual test and file. Most likely, this has something to do with the changes in #3251 . However, I don't see how this isn't a serious regression since it makes DeprecationWarnings and the like all but useless in most circumstances, save for manually hunting through the code for what might have triggered it.\r\n\r\nThis occurs across the Spyder codebase when tested on e.g. a Windows 8.1 x64 machine running under Anaconda (nominally 5.2.0), and on both Python 3.6 and Python 3.7 at least; the only difference in environments that trigger it is simply an upgrade/downgrade of Pytest to 3.8.0/3.7.4 respectively. I tested it on a minimal example project as well, Here's the module, ``eggs``, to be tested:\r\n\r\n```python\r\nimport warnings\r\n\r\ndef foo(spam):\r\n    message = \"This is foo: \" + str(spam)\r\n    warnings.warn(\"This is a test warning\")\r\n    print(message)\r\n    return message\r\n```\r\n\r\nand here's the test file:\r\n\r\n```python\r\nimport pytest\r\nimport eggs\r\n\r\ndef test_foo():\r\n    expected_message = \"This is foo: bar\"\r\n    actual_message = eggs.foo(\"bar\")\r\n    assert actual_message == expected_message\r\n    \r\nif __name__ == \"__main__\":\r\n    pytest.main()\r\n```\r\n\r\nHere's the pytest output for the 3.7.4 case:\r\n\r\n```\r\n(base) C:\\Users\\C. A. M. Gerlach\\Documents\\dev\\TestPackage>pytest ham/tests/test_eggs.py -vv -rw\r\n============================= test session starts =============================\r\nplatform win32 -- Python 3.6.6, pytest-3.7.4, py-1.5.3, pluggy-0.8.0 -- C:\\Anaconda3\\python.exe\r\ncachedir: .pytest_cache\r\nPyQt5 5.9.2 -- Qt runtime 5.9.6 -- Qt compiled 5.9.4\r\nrootdir: C:\\Users\\C. A. M. Gerlach\\Documents\\dev\\TestPackage, inifile:\r\nplugins: timeout-1.2.1, remotedata-0.2.1, qt-2.1.0, openfiles-0.3.0, mock-1.6.3, doctestplus-0.1.3, cov-2.4.0, arraydiff-0.2, hypothesis-3.38.5, flaky-3.3.0\r\ncollected 1 item\r\n\r\nham/tests/test_eggs.py::test_foo PASSED                                  [100%]\r\n===Flaky Test Report===\r\n\r\n\r\n===End Flaky Test Report===\r\n\r\n============================== warnings summary ===============================\r\nham/tests/test_eggs.py::test_foo\r\n  C:\\Users\\C. A. M. Gerlach\\Documents\\dev\\TestPackage\\ham\\eggs.py:7: UserWarning: This is a test warning\r\n    warnings.warn(\"This is a test warning\")\r\n\r\n-- Docs: https://docs.pytest.org/en/latest/warnings.html\r\n==================== 1 passed, 1 warnings in 0.06 seconds =====================\r\n```\r\n\r\nand for 3.8.0:\r\n\r\n```\r\n(base) C:\\Users\\C. A. M. Gerlach\\Documents\\dev\\TestPackage>pytest ham/tests/test_eggs.py -vv -rw\r\n============================= test session starts =============================\r\nplatform win32 -- Python 3.6.6, pytest-3.8.0, py-1.5.3, pluggy-0.8.0 -- C:\\Anaconda3\\python.exe\r\ncachedir: .pytest_cache\r\nPyQt5 5.9.2 -- Qt runtime 5.9.6 -- Qt compiled 5.9.4\r\nrootdir: C:\\Users\\C. A. M. Gerlach\\Documents\\dev\\TestPackage, inifile:\r\nplugins: timeout-1.2.1, remotedata-0.2.1, qt-2.1.0, openfiles-0.3.0, mock-1.6.3, doctestplus-0.1.3, cov-2.4.0, arraydiff-0.2, hypothesis-3.38.5, flaky-3.3.0\r\ncollected 1 item\r\n\r\nham/tests/test_eggs.py::test_foo PASSED                                  [100%]\r\n===Flaky Test Report===\r\n\r\n\r\n===End Flaky Test Report===\r\n\r\n============================== warnings summary ===============================\r\nC:\\Users\\C. A. M. Gerlach\\Documents\\dev\\TestPackage\\ham\\eggs.py:7: UserWarning: This is a test warning\r\n  warnings.warn(\"This is a test warning\")\r\n\r\n-- Docs: https://docs.pytest.org/en/latest/warnings.html\r\n==================== 1 passed, 1 warnings in 0.03 seconds =====================\r\n```\r\n\r\nThanks.","closed_by":{"login":"RonnyPfannschmidt","id":156838,"node_id":"MDQ6VXNlcjE1NjgzOA==","avatar_url":"https://avatars.githubusercontent.com/u/156838?v=4","gravatar_id":"","url":"https://api.github.com/users/RonnyPfannschmidt","html_url":"https://github.com/RonnyPfannschmidt","followers_url":"https://api.github.com/users/RonnyPfannschmidt/followers","following_url":"https://api.github.com/users/RonnyPfannschmidt/following{/other_user}","gists_url":"https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}","starred_url":"https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RonnyPfannschmidt/subscriptions","organizations_url":"https://api.github.com/users/RonnyPfannschmidt/orgs","repos_url":"https://api.github.com/users/RonnyPfannschmidt/repos","events_url":"https://api.github.com/users/RonnyPfannschmidt/events{/privacy}","received_events_url":"https://api.github.com/users/RonnyPfannschmidt/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/4221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4221/timeline","performed_via_github_app":null,"state_reason":"completed"}