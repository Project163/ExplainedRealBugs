{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12308","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12308/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12308/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12308/events","html_url":"https://github.com/pytest-dev/pytest/issues/12308","id":2291046311,"node_id":"I_kwDOAjwLdc6Ijpen","number":12308,"title":"Error: EACCES: permission denied, scandir .pytest_cache with 8.2.0","user":{"login":"danyeaw","id":10014976,"node_id":"MDQ6VXNlcjEwMDE0OTc2","avatar_url":"https://avatars.githubusercontent.com/u/10014976?v=4","gravatar_id":"","url":"https://api.github.com/users/danyeaw","html_url":"https://github.com/danyeaw","followers_url":"https://api.github.com/users/danyeaw/followers","following_url":"https://api.github.com/users/danyeaw/following{/other_user}","gists_url":"https://api.github.com/users/danyeaw/gists{/gist_id}","starred_url":"https://api.github.com/users/danyeaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danyeaw/subscriptions","organizations_url":"https://api.github.com/users/danyeaw/orgs","repos_url":"https://api.github.com/users/danyeaw/repos","events_url":"https://api.github.com/users/danyeaw/events{/privacy}","received_events_url":"https://api.github.com/users/danyeaw/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":224851915,"node_id":"MDU6TGFiZWwyMjQ4NTE5MTU=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20cache","name":"plugin: cache","color":"c7def8","default":false,"description":"related to the cache builtin plugin"},{"id":315571544,"node_id":"MDU6TGFiZWwzMTU1NzE1NDQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20regression","name":"type: regression","color":"f7c6c7","default":false,"description":"indicates a problem that was introduced in a release which was working previously"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2024-05-11T19:57:32Z","updated_at":"2024-05-15T10:20:03Z","closed_at":"2024-05-15T07:57:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"- [X] a detailed description of the bug or problem you are having\r\n- [X] output of `pip list` from the virtual environment you are using\r\n- [X] pytest and operating system versions\r\n- [X] minimal example if possible\r\n\r\nWhen upgrading to Pytest 8.2.0, I was getting a `Error: The template is not valid. .github/workflows/full-build.yml (Line: 92, Col: 16): hashFiles('**/poetry.lock') failed. Fail to hash files under directory '/home/runner/work/gaphor/gaphor'`. When I turned on debug mode on the runner, it looks like the error is caused by an access issue with .pytest_cache which could be a regression caused by https://github.com/pytest-dev/pytest/pull/12168.\r\n\r\nOS: Fedora 39 Docker running on Ubuntu 22.04 VM\r\nPython: Python 3.11.9\r\nPytest: 8.2.0\r\n\r\nThe error happens during the Post Use Dependency Cache step with actions/cache@0c45773b623bea8c8e75f6c82b208c3cf94ea4f9.\r\n\r\nThe larger traceback is:\r\n```\r\n##[debug]..Evaluating hashFiles:\r\n##[debug]....Evaluating String:\r\n##[debug]....=> '**/poetry.lock'\r\n##[debug]Search root directory: '/home/runner/work/gaphor/gaphor'\r\n##[debug]Search pattern: '**/poetry.lock'\r\n##[debug]Starting process:\r\n##[debug]  File name: '/home/runner/runners/2.316.1/externals/node16/bin/node'\r\n##[debug]  Arguments: '\"/home/runner/runners/2.316.1/bin/hashFiles\"'\r\n##[debug]  Working directory: '/home/runner/work/gaphor/gaphor'\r\n##[debug]  Require exit code zero: 'False'\r\n##[debug]  Encoding web name:  ; code page: ''\r\n##[debug]  Force kill process on cancellation: 'False'\r\n##[debug]  Redirected STDIN: 'False'\r\n##[debug]  Persist current code page: 'False'\r\n##[debug]  Keep redirected STDIN open: 'False'\r\n##[debug]  High priority process: 'False'\r\n##[debug]Updated oom_score_adj to 500 for PID: 4319.\r\n##[debug]Process started with process id 4319, waiting for process exit.\r\n##[debug]Match Pattern: **/poetry.lock\r\n##[debug]::debug::followSymbolicLinks 'false'\r\n##[debug]::debug::followSymbolicLinks 'false'\r\n##[debug]::debug::implicitDescendants 'true'\r\n##[debug]::debug::matchDirectories 'true'\r\n##[debug]::debug::omitBrokenSymbolicLinks 'true'\r\n##[debug]::debug::Search path '/home/runner/work/gaphor/gaphor'\r\n##[debug][Error: EACCES: permission denied, scandir '/home/runner/work/gaphor/gaphor/.pytest_cache'] {\r\n##[debug]  errno: -13,\r\n##[debug]  code: 'EACCES',\r\n##[debug]  syscall: 'scandir',\r\n##[debug]  path: '/home/runner/work/gaphor/gaphor/.pytest_cache'\r\n##[debug]}\r\n##[debug]STDOUT/STDERR stream read finished.\r\n##[debug]STDOUT/STDERR stream read finished.\r\n##[debug]Finished process 4319 with exit code 1, and elapsed time 00:00:00.0692324.\r\n##[debug].github/workflows/full-build.yml (Line: 92, Col: 16):\r\nError: The template is not valid. .github/workflows/full-build.yml (Line: 92, Col: 16): hashFiles('**/poetry.lock') failed. Fail to hash files under directory '/home/runner/work/gaphor/gaphor'\r\n```\r\n\r\nThe full run is here: https://github.com/gaphor/gaphor/actions/runs/8976797623/job/24855725418\r\n\r\nThe output of pip list for this environment is:\r\n\r\n```\r\nPackage                       Version   Editable project location\r\n----------------------------- --------- -------------------------\r\nalabaster                     0.7.16\r\nasttokens                     2.4.1\r\nattrs                         23.2.0\r\nBabel                         2.15.0\r\nBabelGladeExtractor           0.7.0\r\nbeautifulsoup4                4.12.3\r\nbetter-exceptions             0.3.3\r\ncertifi                       2024.2.2\r\ncfgv                          3.4.0\r\ncharset-normalizer            3.3.2\r\nclick                         8.1.7\r\ncomm                          0.2.1\r\ncoverage                      7.4.3\r\ndebugpy                       1.8.1\r\ndecorator                     5.1.1\r\ndefusedxml                    0.7.1\r\ndistlib                       0.3.8\r\ndocutils                      0.20.1\r\ndulwich                       0.22.1\r\nexceptiongroup                1.2.0\r\nexecuting                     2.0.1\r\nfastjsonschema                2.19.1\r\nfilelock                      3.13.1\r\nfuro                          2024.1.29\r\ngaphas                        4.0.0\r\ngaphor                        2.25.1    /home/dan/Projects/gaphor\r\ngeneric                       1.1.2\r\ngreenlet                      3.0.3\r\nhypothesis                    6.100.5\r\nidentify                      2.5.35\r\nidna                          3.7\r\nimagesize                     1.4.1\r\nimportlib-metadata            7.0.1\r\niniconfig                     2.0.0\r\nipykernel                     6.29.3\r\nipython                       8.24.0\r\njedi                          0.19.1\r\nJinja2                        3.1.3\r\njsonschema                    4.21.1\r\njsonschema-specifications     2023.12.1\r\njupyter-cache                 1.0.0\r\njupyter_client                8.6.0\r\njupyter_core                  5.7.1\r\nmarkdown-it-py                3.0.0\r\nMarkupSafe                    2.1.5\r\nmatplotlib-inline             0.1.6\r\nmdit-py-plugins               0.4.0\r\nmdurl                         0.1.2\r\nmyst-nb                       1.1.0\r\nmyst-parser                   2.0.0\r\nnbclient                      0.9.0\r\nnbformat                      5.9.2\r\nnest-asyncio                  1.6.0\r\nnodeenv                       1.8.0\r\npackaging                     23.2\r\nparso                         0.8.3\r\npastel                        0.2.1\r\npexpect                       4.9.0\r\npillow                        10.3.0\r\npip                           24.0\r\nplatformdirs                  4.2.0\r\npluggy                        1.5.0\r\npoethepoet                    0.26.1\r\npre-commit                    3.7.0\r\nprompt-toolkit                3.0.43\r\npsutil                        5.9.8\r\nptyprocess                    0.7.0\r\npure-eval                     0.2.2\r\npycairo                       1.26.0\r\npydot                         2.0.0\r\nPygments                      2.17.2\r\nPyGObject                     3.48.2\r\npyparsing                     3.1.1\r\npytest                        8.2.0\r\npytest-archon                 0.0.6\r\npytest-cov                    5.0.0\r\npytest-randomly               3.15.0\r\npython-dateutil               2.8.2\r\nPyYAML                        6.0.1\r\npyzmq                         25.1.2\r\nreferencing                   0.33.0\r\nrequests                      2.31.0\r\nrpds-py                       0.18.0\r\nsetuptools                    69.1.1\r\nsix                           1.16.0\r\nsnowballstemmer               2.2.0\r\nsortedcontainers              2.4.0\r\nsoupsieve                     2.5\r\nSphinx                        7.3.7\r\nsphinx-basic-ng               1.0.0b2\r\nsphinx-copybutton             0.5.2\r\nsphinx-intl                   2.2.0\r\nsphinxcontrib-applehelp       1.0.8\r\nsphinxcontrib-devhelp         1.0.6\r\nsphinxcontrib-htmlhelp        2.0.5\r\nsphinxcontrib-jsmath          1.0.1\r\nsphinxcontrib-qthelp          1.0.7\r\nsphinxcontrib-serializinghtml 1.1.10\r\nSQLAlchemy                    2.0.27\r\nstack-data                    0.6.3\r\ntabulate                      0.9.0\r\ntinycss2                      1.3.0\r\ntomli                         2.0.1\r\ntornado                       6.4\r\ntraitlets                     5.14.1\r\ntyping_extensions             4.10.0\r\nurllib3                       2.2.1\r\nvirtualenv                    20.25.1\r\nwcwidth                       0.2.13\r\nwebencodings                  0.5.1\r\nxdoctest                      1.1.3\r\nzipp                          3.17.0\r\n```","closed_by":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12308/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12308/timeline","performed_via_github_app":null,"state_reason":"completed"}