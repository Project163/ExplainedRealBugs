{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3498","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3498/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3498/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3498/events","html_url":"https://github.com/pytest-dev/pytest/issues/3498","id":325817362,"node_id":"MDU6SXNzdWUzMjU4MTczNjI=","number":3498,"title":"3.6.0 breaks usefixtures when using unittest/unittest2","user":{"login":"owenleonard","id":393849,"node_id":"MDQ6VXNlcjM5Mzg0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/393849?v=4","gravatar_id":"","url":"https://api.github.com/users/owenleonard","html_url":"https://github.com/owenleonard","followers_url":"https://api.github.com/users/owenleonard/followers","following_url":"https://api.github.com/users/owenleonard/following{/other_user}","gists_url":"https://api.github.com/users/owenleonard/gists{/gist_id}","starred_url":"https://api.github.com/users/owenleonard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/owenleonard/subscriptions","organizations_url":"https://api.github.com/users/owenleonard/orgs","repos_url":"https://api.github.com/users/owenleonard/repos","events_url":"https://api.github.com/users/owenleonard/events{/privacy}","received_events_url":"https://api.github.com/users/owenleonard/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":315571544,"node_id":"MDU6TGFiZWwzMTU1NzE1NDQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20regression","name":"type: regression","color":"f7c6c7","default":false,"description":"indicates a problem that was introduced in a release which was working previously"},{"id":346031262,"node_id":"MDU6TGFiZWwzNDYwMzEyNjI=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20unittest","name":"plugin: unittest","color":"006b75","default":false,"description":"related to the unittest integration builtin plugin"},{"id":604254876,"node_id":"MDU6TGFiZWw2MDQyNTQ4NzY=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20marks","name":"topic: marks","color":"b60205","default":false,"description":"related to marks, either the general marks or builtin"}],"state":"closed","locked":false,"assignee":{"login":"RonnyPfannschmidt","id":156838,"node_id":"MDQ6VXNlcjE1NjgzOA==","avatar_url":"https://avatars.githubusercontent.com/u/156838?v=4","gravatar_id":"","url":"https://api.github.com/users/RonnyPfannschmidt","html_url":"https://github.com/RonnyPfannschmidt","followers_url":"https://api.github.com/users/RonnyPfannschmidt/followers","following_url":"https://api.github.com/users/RonnyPfannschmidt/following{/other_user}","gists_url":"https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}","starred_url":"https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RonnyPfannschmidt/subscriptions","organizations_url":"https://api.github.com/users/RonnyPfannschmidt/orgs","repos_url":"https://api.github.com/users/RonnyPfannschmidt/repos","events_url":"https://api.github.com/users/RonnyPfannschmidt/events{/privacy}","received_events_url":"https://api.github.com/users/RonnyPfannschmidt/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"RonnyPfannschmidt","id":156838,"node_id":"MDQ6VXNlcjE1NjgzOA==","avatar_url":"https://avatars.githubusercontent.com/u/156838?v=4","gravatar_id":"","url":"https://api.github.com/users/RonnyPfannschmidt","html_url":"https://github.com/RonnyPfannschmidt","followers_url":"https://api.github.com/users/RonnyPfannschmidt/followers","following_url":"https://api.github.com/users/RonnyPfannschmidt/following{/other_user}","gists_url":"https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}","starred_url":"https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RonnyPfannschmidt/subscriptions","organizations_url":"https://api.github.com/users/RonnyPfannschmidt/orgs","repos_url":"https://api.github.com/users/RonnyPfannschmidt/repos","events_url":"https://api.github.com/users/RonnyPfannschmidt/events{/privacy}","received_events_url":"https://api.github.com/users/RonnyPfannschmidt/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":7,"created_at":"2018-05-23T18:11:04Z","updated_at":"2018-05-24T16:51:21Z","closed_at":"2018-05-24T16:51:21Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Thanks for submitting an issue!\r\n\r\nHere's a quick checklist in what to include:\r\n\r\n- [x] Include a detailed description of the bug or suggestion\r\n`@pytest.mark.usefixtures()` on test cases in classes that inherit from unittest.TestCase and unittest2.TestCase no longer works.  The fixtures are completely ignored.\r\n\r\nGiven your README.rst says `Can run unittest (or trial), nose test suites out of the box;`, I'm assuming this is an appropriate bug to file.\r\n\r\n- [x] `pip list` of the virtual environment you are using\r\nIn both venvs, I installed pytest and unittest2.  The remaining packages are just dependencies\r\n\r\npython 3.6.3\r\n```\r\nOwens-MacBook-Pro:bug owen$ pip list\r\nPackage        Version\r\n-------------- -------\r\natomicwrites   1.1.5\r\nattrs          18.1.0\r\nlinecache2     1.0.0\r\nmore-itertools 4.1.0\r\npip            10.0.1\r\npluggy         0.6.0\r\npy             1.5.3\r\npytest         3.6.0\r\nsetuptools     39.2.0\r\nsix            1.11.0\r\ntraceback2     1.4.0\r\nunittest2      1.1.0\r\nwheel          0.31.1\r\n```\r\n\r\npython 2.7.10\r\n```\r\nOwens-MacBook-Pro:bug owen$ pip list\r\nPackage        Version\r\n-------------- -------\r\natomicwrites   1.1.5\r\nattrs          18.1.0\r\nfuncsigs       1.0.2\r\nlinecache2     1.0.0\r\nmore-itertools 4.1.0\r\npip            10.0.1\r\npluggy         0.6.0\r\npy             1.5.3\r\npytest         3.6.0\r\nsetuptools     39.2.0\r\nsix            1.11.0\r\ntraceback2     1.4.0\r\nunittest2      1.1.0\r\nwheel          0.31.1\r\n```\r\n- [x] pytest and operating system versions\r\npytest 3.6.0 \r\nmacOS High Sierra 10.13.4\r\n\r\n- [x] Minimal example if possible\r\n\r\nconftest.py\r\n```python\r\nimport pytest\r\n\r\n\r\n@pytest.fixture(scope='function')\r\ndef fixture1():\r\n    print(\"in fixture1\")\r\n    yield\r\n\r\n\r\n@pytest.fixture(scope='function')\r\ndef fixture2():\r\n    print(\"in fixture2\")\r\n    yield\r\n```\r\n\r\ntests.py\r\n```python\r\nimport pytest\r\n# import unittest\r\n# import unittest2\r\n\r\n\r\n# class Tests(unittest.TestCase):\r\n# class Tests(unittest2.TestCase):\r\nclass Tests(object):\r\n\r\n    @pytest.mark.usefixtures(\"fixture1\")\r\n    def test_one(self):\r\n        print(\"inside test_one\")\r\n\r\n    @pytest.mark.usefixtures(\"fixture1\", \"fixture2\")\r\n    def test_two(self):\r\n        print(\"inside test_two\")\r\n```\r\n\r\nResults identical between python 2.7.10 and 3.6.3:\r\n\r\nusing `class Tests(object)`\r\n```\r\nOwens-MacBook-Pro:bug owen$ pytest -s tests.py\r\n=============================== test session starts ===============================\r\nplatform darwin -- Python 2.7.10, pytest-3.6.0, py-1.5.3, pluggy-0.6.0\r\nrootdir: /Users/owen/repos/sandbox/bug, inifile:\r\ncollected 2 items\r\n\r\ntests.py in fixture1\r\ninside test_one\r\n.in fixture1\r\nin fixture2\r\ninside test_two\r\n.\r\n\r\n============================ 2 passed in 0.02 seconds =============================\r\n```\r\n\r\nusing `class Tests(unittest.TestCase)`\r\n```\r\nOwens-MacBook-Pro:bug owen$ pytest -s tests.py\r\n=============================== test session starts ===============================\r\nplatform darwin -- Python 2.7.10, pytest-3.6.0, py-1.5.3, pluggy-0.6.0\r\nrootdir: /Users/owen/repos/sandbox/bug, inifile:\r\ncollected 2 items\r\n\r\ntests.py inside test_one\r\n.inside test_two\r\n.\r\n\r\n============================ 2 passed in 0.01 seconds =============================\r\n```\r\nNotice `in fixture1` and `in fixture2` is not printed\r\n\r\nusing `class Tests(unittest2.TestCase)`\r\n```\r\nOwens-MacBook-Pro:bug owen$ pytest -s tests.py\r\n=============================== test session starts ===============================\r\nplatform darwin -- Python 2.7.10, pytest-3.6.0, py-1.5.3, pluggy-0.6.0\r\nrootdir: /Users/owen/repos/sandbox/bug, inifile:\r\ncollected 2 items\r\n\r\ntests.py inside test_one\r\n.inside test_two\r\n.\r\n\r\n============================ 2 passed in 0.04 seconds =============================\r\n```\r\nNotice `in fixture1` and `in fixture2` is not printed\r\n\r\n\r\nI also installed pytest 3.5.1 instead of 3.6.0 to show it was working before using unittest2:\r\n```\r\nOwens-MacBook-Pro:bug owen$ pytest -s tests.py\r\n=============================== test session starts ===============================\r\nplatform darwin -- Python 2.7.10, pytest-3.5.1, py-1.5.3, pluggy-0.6.0\r\nrootdir: /Users/owen/repos/sandbox/bug, inifile:\r\ncollected 2 items\r\n\r\ntests.py running fixture1\r\ninside test_one\r\n.running fixture1\r\nrunning fixture2\r\ninside test_two\r\n.\r\n\r\n============================ 2 passed in 0.02 seconds =============================\r\n```","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3498/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3498/timeline","performed_via_github_app":null,"state_reason":"completed"}