[{"actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-02T12:53:06Z","updated_at":"2023-10-02T12:53:06Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/scverse/anndata/issues/1151","repository_url":"https://api.github.com/repos/scverse/anndata","labels_url":"https://api.github.com/repos/scverse/anndata/issues/1151/labels{/name}","comments_url":"https://api.github.com/repos/scverse/anndata/issues/1151/comments","events_url":"https://api.github.com/repos/scverse/anndata/issues/1151/events","html_url":"https://github.com/scverse/anndata/pull/1151","id":1921571973,"node_id":"PR_kwDOBfZ26c5bp55d","number":1151,"title":"Moving source directory to src/anndata","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":4863677089,"node_id":"LA_kwDOBfZ26c8AAAABIeXSoQ","url":"https://api.github.com/repos/scverse/anndata/labels/dev%20process","name":"dev process","color":"89C81A","default":false,"description":""},{"id":5797766728,"node_id":"LA_kwDOBfZ26c8AAAABWZLmSA","url":"https://api.github.com/repos/scverse/anndata/labels/run-gpu-ci","name":"run-gpu-ci","color":"2D6C18","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/scverse/anndata/milestones/19","html_url":"https://github.com/scverse/anndata/milestone/19","labels_url":"https://api.github.com/repos/scverse/anndata/milestones/19/labels","id":10665905,"node_id":"MI_kwDOBfZ26c4Aor-x","number":19,"title":"0.10.7","description":"on-merge: backport to 0.10.x","creator":{"login":"ivirshup","id":8238804,"node_id":"MDQ6VXNlcjgyMzg4MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/8238804?v=4","gravatar_id":"","url":"https://api.github.com/users/ivirshup","html_url":"https://github.com/ivirshup","followers_url":"https://api.github.com/users/ivirshup/followers","following_url":"https://api.github.com/users/ivirshup/following{/other_user}","gists_url":"https://api.github.com/users/ivirshup/gists{/gist_id}","starred_url":"https://api.github.com/users/ivirshup/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivirshup/subscriptions","organizations_url":"https://api.github.com/users/ivirshup/orgs","repos_url":"https://api.github.com/users/ivirshup/repos","events_url":"https://api.github.com/users/ivirshup/events{/privacy}","received_events_url":"https://api.github.com/users/ivirshup/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":33,"state":"closed","created_at":"2024-03-11T10:32:11Z","updated_at":"2024-04-09T11:29:39Z","due_on":null,"closed_at":"2024-04-09T11:29:39Z"},"comments":13,"created_at":"2023-10-02T09:37:23Z","updated_at":"2024-05-02T09:43:53Z","closed_at":"2024-04-09T10:54:28Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":100038377,"node_id":"MDEwOlJlcG9zaXRvcnkxMDAwMzgzNzc=","name":"anndata","full_name":"scverse/anndata","private":false,"owner":{"login":"scverse","id":95305807,"node_id":"O_kgDOBa5ATw","avatar_url":"https://avatars.githubusercontent.com/u/95305807?v=4","gravatar_id":"","url":"https://api.github.com/users/scverse","html_url":"https://github.com/scverse","followers_url":"https://api.github.com/users/scverse/followers","following_url":"https://api.github.com/users/scverse/following{/other_user}","gists_url":"https://api.github.com/users/scverse/gists{/gist_id}","starred_url":"https://api.github.com/users/scverse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scverse/subscriptions","organizations_url":"https://api.github.com/users/scverse/orgs","repos_url":"https://api.github.com/users/scverse/repos","events_url":"https://api.github.com/users/scverse/events{/privacy}","received_events_url":"https://api.github.com/users/scverse/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/scverse/anndata","description":"Annotated data.","fork":false,"url":"https://api.github.com/repos/scverse/anndata","forks_url":"https://api.github.com/repos/scverse/anndata/forks","keys_url":"https://api.github.com/repos/scverse/anndata/keys{/key_id}","collaborators_url":"https://api.github.com/repos/scverse/anndata/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/scverse/anndata/teams","hooks_url":"https://api.github.com/repos/scverse/anndata/hooks","issue_events_url":"https://api.github.com/repos/scverse/anndata/issues/events{/number}","events_url":"https://api.github.com/repos/scverse/anndata/events","assignees_url":"https://api.github.com/repos/scverse/anndata/assignees{/user}","branches_url":"https://api.github.com/repos/scverse/anndata/branches{/branch}","tags_url":"https://api.github.com/repos/scverse/anndata/tags","blobs_url":"https://api.github.com/repos/scverse/anndata/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/scverse/anndata/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/scverse/anndata/git/refs{/sha}","trees_url":"https://api.github.com/repos/scverse/anndata/git/trees{/sha}","statuses_url":"https://api.github.com/repos/scverse/anndata/statuses/{sha}","languages_url":"https://api.github.com/repos/scverse/anndata/languages","stargazers_url":"https://api.github.com/repos/scverse/anndata/stargazers","contributors_url":"https://api.github.com/repos/scverse/anndata/contributors","subscribers_url":"https://api.github.com/repos/scverse/anndata/subscribers","subscription_url":"https://api.github.com/repos/scverse/anndata/subscription","commits_url":"https://api.github.com/repos/scverse/anndata/commits{/sha}","git_commits_url":"https://api.github.com/repos/scverse/anndata/git/commits{/sha}","comments_url":"https://api.github.com/repos/scverse/anndata/comments{/number}","issue_comment_url":"https://api.github.com/repos/scverse/anndata/issues/comments{/number}","contents_url":"https://api.github.com/repos/scverse/anndata/contents/{+path}","compare_url":"https://api.github.com/repos/scverse/anndata/compare/{base}...{head}","merges_url":"https://api.github.com/repos/scverse/anndata/merges","archive_url":"https://api.github.com/repos/scverse/anndata/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/scverse/anndata/downloads","issues_url":"https://api.github.com/repos/scverse/anndata/issues{/number}","pulls_url":"https://api.github.com/repos/scverse/anndata/pulls{/number}","milestones_url":"https://api.github.com/repos/scverse/anndata/milestones{/number}","notifications_url":"https://api.github.com/repos/scverse/anndata/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/scverse/anndata/labels{/name}","releases_url":"https://api.github.com/repos/scverse/anndata/releases{/id}","deployments_url":"https://api.github.com/repos/scverse/anndata/deployments","created_at":"2017-08-11T14:10:06Z","updated_at":"2025-11-07T18:35:23Z","pushed_at":"2025-11-07T15:20:28Z","git_url":"git://github.com/scverse/anndata.git","ssh_url":"git@github.com:scverse/anndata.git","clone_url":"https://github.com/scverse/anndata.git","svn_url":"https://github.com/scverse/anndata","homepage":"http://anndata.readthedocs.io","size":6481,"stargazers_count":681,"watchers_count":681,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":177,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":270,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["anndata","bioinformatics","data-science","machine-learning","scanpy","scverse","transcriptomics"],"visibility":"public","forks":177,"open_issues":270,"watchers":681,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/scverse/anndata/pulls/1151","html_url":"https://github.com/scverse/anndata/pull/1151","diff_url":"https://github.com/scverse/anndata/pull/1151.diff","patch_url":"https://github.com/scverse/anndata/pull/1151.patch","merged_at":"2024-04-09T10:54:27Z"},"body":"Supersedes #1128","reactions":{"url":"https://api.github.com/repos/scverse/anndata/issues/1151/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/scverse/anndata/issues/1151/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":10594385512,"node_id":"LE_lADOAjwLdc5yjT_-zwAAAAJ3eX5o","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/10594385512","actor":{"login":"Zac-HD","id":12229877,"node_id":"MDQ6VXNlcjEyMjI5ODc3","avatar_url":"https://avatars.githubusercontent.com/u/12229877?v=4","gravatar_id":"","url":"https://api.github.com/users/Zac-HD","html_url":"https://github.com/Zac-HD","followers_url":"https://api.github.com/users/Zac-HD/followers","following_url":"https://api.github.com/users/Zac-HD/following{/other_user}","gists_url":"https://api.github.com/users/Zac-HD/gists{/gist_id}","starred_url":"https://api.github.com/users/Zac-HD/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Zac-HD/subscriptions","organizations_url":"https://api.github.com/users/Zac-HD/orgs","repos_url":"https://api.github.com/users/Zac-HD/repos","events_url":"https://api.github.com/users/Zac-HD/events{/privacy}","received_events_url":"https://api.github.com/users/Zac-HD/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-10-09T18:31:56Z","label":{"name":"topic: collection","color":"006b75"},"performed_via_github_app":null},{"actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-03T09:33:32Z","updated_at":"2023-11-03T09:33:32Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/scverse/scanpy/issues/2729","repository_url":"https://api.github.com/repos/scverse/scanpy","labels_url":"https://api.github.com/repos/scverse/scanpy/issues/2729/labels{/name}","comments_url":"https://api.github.com/repos/scverse/scanpy/issues/2729/comments","events_url":"https://api.github.com/repos/scverse/scanpy/issues/2729/events","html_url":"https://github.com/scverse/scanpy/issues/2729","id":1975783302,"node_id":"I_kwDOBMnt3c51xA-G","number":2729,"title":"Switch our doctest handing to pytest-doctestplus","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":678767439,"node_id":"MDU6TGFiZWw2Nzg3Njc0Mzk=","url":"https://api.github.com/repos/scverse/scanpy/labels/Area%20-%20Documentation%20%F0%9F%93%92","name":"Area - Documentation ðŸ“’","color":"C2E0C6","default":false,"description":""},{"id":2633344106,"node_id":"MDU6TGFiZWwyNjMzMzQ0MTA2","url":"https://api.github.com/repos/scverse/scanpy/labels/Development%20Process%20%F0%9F%9A%80","name":"Development Process ðŸš€","color":"5A9239","default":false,"description":""}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-11-03T09:33:31Z","updated_at":"2024-12-16T11:09:19Z","closed_at":null,"author_association":"MEMBER","type":{"id":16125044,"node_id":"IT_kwDOBa5AT84A9gx0","name":"Enhancement","description":"A request, idea, or new functionality","color":"blue","created_at":"2024-02-11T19:55:28Z","updated_at":"2024-07-26T14:17:13Z","is_enabled":true},"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":80342493,"node_id":"MDEwOlJlcG9zaXRvcnk4MDM0MjQ5Mw==","name":"scanpy","full_name":"scverse/scanpy","private":false,"owner":{"login":"scverse","id":95305807,"node_id":"O_kgDOBa5ATw","avatar_url":"https://avatars.githubusercontent.com/u/95305807?v=4","gravatar_id":"","url":"https://api.github.com/users/scverse","html_url":"https://github.com/scverse","followers_url":"https://api.github.com/users/scverse/followers","following_url":"https://api.github.com/users/scverse/following{/other_user}","gists_url":"https://api.github.com/users/scverse/gists{/gist_id}","starred_url":"https://api.github.com/users/scverse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scverse/subscriptions","organizations_url":"https://api.github.com/users/scverse/orgs","repos_url":"https://api.github.com/users/scverse/repos","events_url":"https://api.github.com/users/scverse/events{/privacy}","received_events_url":"https://api.github.com/users/scverse/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/scverse/scanpy","description":"Single-cell analysis in Python. Scales to >100M cells.","fork":false,"url":"https://api.github.com/repos/scverse/scanpy","forks_url":"https://api.github.com/repos/scverse/scanpy/forks","keys_url":"https://api.github.com/repos/scverse/scanpy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/scverse/scanpy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/scverse/scanpy/teams","hooks_url":"https://api.github.com/repos/scverse/scanpy/hooks","issue_events_url":"https://api.github.com/repos/scverse/scanpy/issues/events{/number}","events_url":"https://api.github.com/repos/scverse/scanpy/events","assignees_url":"https://api.github.com/repos/scverse/scanpy/assignees{/user}","branches_url":"https://api.github.com/repos/scverse/scanpy/branches{/branch}","tags_url":"https://api.github.com/repos/scverse/scanpy/tags","blobs_url":"https://api.github.com/repos/scverse/scanpy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/scverse/scanpy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/scverse/scanpy/git/refs{/sha}","trees_url":"https://api.github.com/repos/scverse/scanpy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/scverse/scanpy/statuses/{sha}","languages_url":"https://api.github.com/repos/scverse/scanpy/languages","stargazers_url":"https://api.github.com/repos/scverse/scanpy/stargazers","contributors_url":"https://api.github.com/repos/scverse/scanpy/contributors","subscribers_url":"https://api.github.com/repos/scverse/scanpy/subscribers","subscription_url":"https://api.github.com/repos/scverse/scanpy/subscription","commits_url":"https://api.github.com/repos/scverse/scanpy/commits{/sha}","git_commits_url":"https://api.github.com/repos/scverse/scanpy/git/commits{/sha}","comments_url":"https://api.github.com/repos/scverse/scanpy/comments{/number}","issue_comment_url":"https://api.github.com/repos/scverse/scanpy/issues/comments{/number}","contents_url":"https://api.github.com/repos/scverse/scanpy/contents/{+path}","compare_url":"https://api.github.com/repos/scverse/scanpy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/scverse/scanpy/merges","archive_url":"https://api.github.com/repos/scverse/scanpy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/scverse/scanpy/downloads","issues_url":"https://api.github.com/repos/scverse/scanpy/issues{/number}","pulls_url":"https://api.github.com/repos/scverse/scanpy/pulls{/number}","milestones_url":"https://api.github.com/repos/scverse/scanpy/milestones{/number}","notifications_url":"https://api.github.com/repos/scverse/scanpy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/scverse/scanpy/labels{/name}","releases_url":"https://api.github.com/repos/scverse/scanpy/releases{/id}","deployments_url":"https://api.github.com/repos/scverse/scanpy/deployments","created_at":"2017-01-29T11:31:11Z","updated_at":"2025-11-07T17:35:27Z","pushed_at":"2025-11-07T17:35:24Z","git_url":"git://github.com/scverse/scanpy.git","ssh_url":"git@github.com:scverse/scanpy.git","clone_url":"https://github.com/scverse/scanpy.git","svn_url":"https://github.com/scverse/scanpy","homepage":"https://scanpy.readthedocs.io","size":43680,"stargazers_count":2248,"watchers_count":2248,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":false,"forks_count":675,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":560,"license":{"key":"bsd-3-clause","name":"BSD 3-Clause \"New\" or \"Revised\" License","spdx_id":"BSD-3-Clause","url":"https://api.github.com/licenses/bsd-3-clause","node_id":"MDc6TGljZW5zZTU="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["anndata","bioinformatics","data-science","machine-learning","python","scanpy","scverse","transcriptomics","visualize-data"],"visibility":"public","forks":675,"open_issues":560,"watchers":2248,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### What kind of feature would you like to request?\n\nOther?\n\n### Please describe your wishes\n\nDepends on\r\n\r\n- https://github.com/scientific-python/pytest-doctestplus/issues/229\r\n- https://github.com/scientific-python/pytest-doctestplus/issues/231\r\n- https://github.com/pytest-dev/pytest/issues/11475\r\n  - And after that one has been fixed, Iâ€™m sure doctestplus also needs to adjust to it.","reactions":{"url":"https://api.github.com/repos/scverse/scanpy/issues/2729/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/scverse/scanpy/issues/2729/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1850954248","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1850954248","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1850954248,"node_id":"IC_kwDOAjwLdc5uU1II","user":{"login":"richardxia","id":1002748,"node_id":"MDQ6VXNlcjEwMDI3NDg=","avatar_url":"https://avatars.githubusercontent.com/u/1002748?v=4","gravatar_id":"","url":"https://api.github.com/users/richardxia","html_url":"https://github.com/richardxia","followers_url":"https://api.github.com/users/richardxia/followers","following_url":"https://api.github.com/users/richardxia/following{/other_user}","gists_url":"https://api.github.com/users/richardxia/gists{/gist_id}","starred_url":"https://api.github.com/users/richardxia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richardxia/subscriptions","organizations_url":"https://api.github.com/users/richardxia/orgs","repos_url":"https://api.github.com/users/richardxia/repos","events_url":"https://api.github.com/users/richardxia/events{/privacy}","received_events_url":"https://api.github.com/users/richardxia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-11T21:56:37Z","updated_at":"2023-12-11T21:56:37Z","body":"I just wanted to add that we are hitting this issue as well, but we _are_ using editable installs, so it looks like this issue affects both the case with editable and non-editable installs of the project source files.\r\n\r\nJust to be clear, our project is:\r\n\r\n- an editable installation\r\n- has a `src/` layout\r\n- puts non-doctest tests outside the application code, in a `tests/` directory that is a sibling to the `src/` directory\r\n- uses `--import-mode=importlib`\r\n- (attempts to) use `--doctest-modules`\r\n\r\nWe more or less exactly follow the suggested layout and settings in https://docs.pytest.org/en/7.1.x/explanation/goodpractices.html#tests-outside-application-code, and everything was working fine until attempting to run doctests within the application code using `--doctest-modules`.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1850954248/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"richardxia","id":1002748,"node_id":"MDQ6VXNlcjEwMDI3NDg=","avatar_url":"https://avatars.githubusercontent.com/u/1002748?v=4","gravatar_id":"","url":"https://api.github.com/users/richardxia","html_url":"https://github.com/richardxia","followers_url":"https://api.github.com/users/richardxia/followers","following_url":"https://api.github.com/users/richardxia/following{/other_user}","gists_url":"https://api.github.com/users/richardxia/gists{/gist_id}","starred_url":"https://api.github.com/users/richardxia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richardxia/subscriptions","organizations_url":"https://api.github.com/users/richardxia/orgs","repos_url":"https://api.github.com/users/richardxia/repos","events_url":"https://api.github.com/users/richardxia/events{/privacy}","received_events_url":"https://api.github.com/users/richardxia/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-03T11:02:31Z","updated_at":"2024-01-03T11:02:31Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11759","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11759/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11759/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11759/events","html_url":"https://github.com/pytest-dev/pytest/issues/11759","id":2062696740,"node_id":"I_kwDOAjwLdc568kEk","number":11759,"title":"Pytest 8.0.0rc1 stopped respecting usefixtures marker applied in pytest_itemcollected","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":240592808,"node_id":"MDU6TGFiZWwyNDA1OTI4MDg=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20doctests","name":"plugin: doctests","color":"fad8c7","default":false,"description":"related to the doctests builtin plugin"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pytest-dev/pytest/milestones/35","html_url":"https://github.com/pytest-dev/pytest/milestone/35","labels_url":"https://api.github.com/repos/pytest-dev/pytest/milestones/35/labels","id":5503484,"node_id":"MDk6TWlsZXN0b25lNTUwMzQ4NA==","number":35,"title":"8.0","description":"","creator":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":11,"state":"closed","created_at":"2020-06-05T11:56:50Z","updated_at":"2024-04-14T12:35:09Z","due_on":null,"closed_at":"2024-04-14T12:35:09Z"},"comments":5,"created_at":"2024-01-02T16:58:32Z","updated_at":"2024-01-15T11:59:47Z","closed_at":"2024-01-15T11:59:47Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":37489525,"node_id":"MDEwOlJlcG9zaXRvcnkzNzQ4OTUyNQ==","name":"pytest","full_name":"pytest-dev/pytest","private":false,"owner":{"login":"pytest-dev","id":8897583,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg4OTc1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/8897583?v=4","gravatar_id":"","url":"https://api.github.com/users/pytest-dev","html_url":"https://github.com/pytest-dev","followers_url":"https://api.github.com/users/pytest-dev/followers","following_url":"https://api.github.com/users/pytest-dev/following{/other_user}","gists_url":"https://api.github.com/users/pytest-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/pytest-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pytest-dev/subscriptions","organizations_url":"https://api.github.com/users/pytest-dev/orgs","repos_url":"https://api.github.com/users/pytest-dev/repos","events_url":"https://api.github.com/users/pytest-dev/events{/privacy}","received_events_url":"https://api.github.com/users/pytest-dev/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/pytest-dev/pytest","description":"The pytest framework makes it easy to write small tests, yet scales to support complex functional testing","fork":false,"url":"https://api.github.com/repos/pytest-dev/pytest","forks_url":"https://api.github.com/repos/pytest-dev/pytest/forks","keys_url":"https://api.github.com/repos/pytest-dev/pytest/keys{/key_id}","collaborators_url":"https://api.github.com/repos/pytest-dev/pytest/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/pytest-dev/pytest/teams","hooks_url":"https://api.github.com/repos/pytest-dev/pytest/hooks","issue_events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/events{/number}","events_url":"https://api.github.com/repos/pytest-dev/pytest/events","assignees_url":"https://api.github.com/repos/pytest-dev/pytest/assignees{/user}","branches_url":"https://api.github.com/repos/pytest-dev/pytest/branches{/branch}","tags_url":"https://api.github.com/repos/pytest-dev/pytest/tags","blobs_url":"https://api.github.com/repos/pytest-dev/pytest/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/pytest-dev/pytest/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/pytest-dev/pytest/git/refs{/sha}","trees_url":"https://api.github.com/repos/pytest-dev/pytest/git/trees{/sha}","statuses_url":"https://api.github.com/repos/pytest-dev/pytest/statuses/{sha}","languages_url":"https://api.github.com/repos/pytest-dev/pytest/languages","stargazers_url":"https://api.github.com/repos/pytest-dev/pytest/stargazers","contributors_url":"https://api.github.com/repos/pytest-dev/pytest/contributors","subscribers_url":"https://api.github.com/repos/pytest-dev/pytest/subscribers","subscription_url":"https://api.github.com/repos/pytest-dev/pytest/subscription","commits_url":"https://api.github.com/repos/pytest-dev/pytest/commits{/sha}","git_commits_url":"https://api.github.com/repos/pytest-dev/pytest/git/commits{/sha}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/comments{/number}","issue_comment_url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments{/number}","contents_url":"https://api.github.com/repos/pytest-dev/pytest/contents/{+path}","compare_url":"https://api.github.com/repos/pytest-dev/pytest/compare/{base}...{head}","merges_url":"https://api.github.com/repos/pytest-dev/pytest/merges","archive_url":"https://api.github.com/repos/pytest-dev/pytest/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/pytest-dev/pytest/downloads","issues_url":"https://api.github.com/repos/pytest-dev/pytest/issues{/number}","pulls_url":"https://api.github.com/repos/pytest-dev/pytest/pulls{/number}","milestones_url":"https://api.github.com/repos/pytest-dev/pytest/milestones{/number}","notifications_url":"https://api.github.com/repos/pytest-dev/pytest/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/pytest-dev/pytest/labels{/name}","releases_url":"https://api.github.com/repos/pytest-dev/pytest/releases{/id}","deployments_url":"https://api.github.com/repos/pytest-dev/pytest/deployments","created_at":"2015-06-15T20:28:27Z","updated_at":"2025-11-09T16:32:44Z","pushed_at":"2025-11-09T09:33:29Z","git_url":"git://github.com/pytest-dev/pytest.git","ssh_url":"git@github.com:pytest-dev/pytest.git","clone_url":"https://github.com/pytest-dev/pytest.git","svn_url":"https://github.com/pytest-dev/pytest","homepage":"https://pytest.org","size":37842,"stargazers_count":13254,"watchers_count":13254,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":2933,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":953,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","python","test","testing","unit-testing"],"visibility":"public","forks":2933,"open_issues":953,"watchers":13254,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"<!--\r\nThanks for submitting an issue!\r\n\r\nQuick check-list while reporting bugs:\r\n-->\r\n\r\n- [x] a detailed description of the bug or problem you are having\r\n- [x] output of `pip list` from the virtual environment you are using\r\n- [x] pytest and operating system versions\r\n- [x] minimal example if possible\r\n\r\nIn Pytest 7, adding a `pytest.mark.usefixtures` marker to a `pytest.Item` in `pytest_itemcollected` resulted in that marker being respected. With Pytest 8, thatâ€™s not the case.\r\n\r\nThe reproducer sets up two environments, one with Pytest 7.x, one with Pytest 8.0.0rc1, and runs a test suite:\r\n\r\n# [reproducer](https://gist.github.com/flying-sheep/4ef2072763da268b1b1953e102ad21f1)\r\n\r\n```console\r\n$ hatch run test\r\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 7 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n============================== test session starts ==============================\r\nplatform linux -- Python 3.11.6, pytest-7.4.3, pluggy-1.3.0 -- .../7/bin/python\r\ncachedir: .pytest_cache\r\nrootdir: .../pytest-8-doctests\r\ncollected 2 items                                                               \r\n\r\ntest_warnings.py::test_warnings.has_doctest PASSED                        [ 50%]\r\ntest_warnings.py::test_warn PASSED                                        [100%]\r\n\r\n=============================== 2 passed in 0.01s ===============================\r\n```\r\n```console\r\nâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ 8 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n============================== test session starts ==============================\r\nplatform linux -- Python 3.11.6, pytest-8.0.0rc1, pluggy-1.3.0 -- .../8/bin/python\r\ncachedir: .pytest_cache\r\nrootdir: .../pytest-8-doctests\r\ncollected 2 items                                                               \r\n\r\ntest_warnings.py::test_warnings.has_doctest FAILED                        [ 50%]\r\ntest_warnings.py::test_warn PASSED                                        [100%]\r\n\r\n=================================== FAILURES ====================================\r\n______________________ [doctest] test_warnings.has_doctest ______________________\r\n007 Doctest!\r\n008     \r\n009     >>> import warnings\r\n010     >>> warnings.warn(\"Hi!\", FutureWarning)\r\nUNEXPECTED EXCEPTION: FutureWarning('Hi!')\r\nTraceback (most recent call last):\r\n  File \"/usr/lib/python3.11/doctest.py\", line 1351, in __run\r\n    exec(compile(example.source, filename, \"single\",\r\n  File \"<doctest test_warnings.has_doctest[1]>\", line 1, in <module>\r\nFutureWarning: Hi!\r\n.../pytest-8-doctests/test_warnings.py:10: UnexpectedException\r\n============================ short test summary info ============================\r\nFAILED test_warnings.py::test_warnings.has_doctest\r\n========================== 1 failed, 1 passed in 0.01s ==========================\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11759/timeline","performed_via_github_app":null,"state_reason":"not_planned"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1888922393","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1888922393","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1888922393,"node_id":"IC_kwDOAjwLdc5wlqsZ","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T11:26:10Z","updated_at":"2024-01-12T11:26:10Z","body":"Yeah, could this please be added to the 8.0 milestone?\r\n\r\nThis might require a new setting or some breaking change, so this is the ideal moment","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1888922393/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1888936450","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1888936450","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1888936450,"node_id":"IC_kwDOAjwLdc5wluIC","user":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T11:36:24Z","updated_at":"2024-01-12T11:36:24Z","body":"Does it work better if you use `pytest --doctest-modules --import-mode=importlib --pyargs my.package`?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1888936450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889032483","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1889032483","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1889032483,"node_id":"IC_kwDOAjwLdc5wmFkj","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T12:18:24Z","updated_at":"2024-01-12T12:46:07Z","body":"~~Actually yes! Itâ€™s getting really complicated though:~~\r\n\r\n```toml\r\n[tool.pytest.ini_options]\r\naddopts = [\r\n    \"--strict-markers\",\r\n    \"--doctest-modules\",\r\n    \"--pyargs\",\r\n]\r\ntestpaths = [\r\n    \"anndata\", # doctests in docstrings (module name due to --pyargs)\r\n    \"./src/anndata/tests\", # unit tests\r\n    \"./docs/concatenation.rst\", # further doctests\r\n]\r\n```\r\n\r\n~~and then in `src/anndata/tests/conftest.py` a `collect_ignore = [\"helpers.py\"]`. But it works.~~","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889032483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889050829","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1889050829","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1889050829,"node_id":"IC_kwDOAjwLdc5wmKDN","user":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T12:26:38Z","updated_at":"2024-01-12T12:26:38Z","body":"In the issue subject you write `--import-mode=importlib` but you are *not* using that right?\r\n\r\nIf you give me a bit of instructions how to reproduce this locally, I can take a look.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889050829/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889090884","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1889090884","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1889090884,"node_id":"IC_kwDOAjwLdc5wmT1E","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T12:42:47Z","updated_at":"2024-01-12T13:14:57Z","body":"Sorry, I muddled my project (https://github.com/scverse/anndata/pull/1151) too much with this issue. Iâ€™m trying to be clear now.\r\n\r\nAdding `--import-mode=importlib` to the above results in this:\r\n\r\n```\r\nE   ModuleNotFoundError: No module named\r\n  'home.phil..local.share.hatch.[â€¦].site-packages.anndata._core';\r\n  'home.phil..local.share.hatch.[â€¦].site-packages.anndata' is not a package\r\n```\r\n\r\nWhat needs to work for this issue to be considered fixed:\r\n\r\n```\r\n+ src/my_module/__init__.py  # containing a doctest\r\n+ tests/test_basic.py\r\n```\r\n\r\n```toml\r\n[build-system]\r\nbuild-backend = \"hatchling.build\"\r\nrequires = [\"hatchling\", \"hatch-vcs\"]\r\n\r\n[project]\r\nname = \"my_module\"\r\nversion = \"0.1.0\"\r\n\r\n[tool.pytest.ini_options]\r\naddopts = [\r\n    \"--import-mode=importlib\",\r\n    \"--strict-markers\",\r\n    \"--doctest-modules\",\r\n    \"--pyargs\",\r\n]\r\ntestpaths = [\r\n    \"my_module\",  # or without `--pyargs`: \"./src/my_module\"\r\n    \"./tests\",\r\n]\r\n```\r\n\r\n<details><summary>What would be nice if it worked for migrating our project:</summary>\r\n\r\n```\r\n+ src/my_module/\r\n  + __init__.py  # containing a doctest\r\n  + tests/\r\n    + conftest.py  # containing `collect_ignore = [\"helpers.py\"]`\r\n    + helpers.py\r\n    + test_basic.py\r\n```\r\n\r\n```toml\r\n...\r\n\r\n[tool.pytest.ini_options]\r\naddopts = [\r\n    \"--import-mode=importlib\",\r\n    \"--strict-markers\",\r\n    \"--doctest-modules\",\r\n    \"--pyargs\",\r\n]\r\ntestpaths = [\r\n    \"my_module\",\r\n    \"./src/my_module/tests\",\r\n]\r\n```\r\n\r\n</details>","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889090884/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889184478","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1889184478","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1889184478,"node_id":"IC_kwDOAjwLdc5wmqre","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T13:18:37Z","updated_at":"2024-01-12T15:12:04Z","body":"Very weird, I just canâ€™t find a good reproducer. In our project, it fails: https://dev.azure.com/scverse/anndata/_build/results?buildId=5213&view=logs&jobId=5ea502cf-d418-510c-3b5f-c4ba606ae534&j=5ea502cf-d418-510c-3b5f-c4ba606ae534&t=5091afe0-1787-5ef7-c6a1-ce6dc06b30a7\r\n\r\n```\r\nplatform linux -- Python 3.11.7, pytest-7.4.4, pluggy-1.3.0\r\nrootdir: /home/vsts/work/1/s\r\nconfigfile: pyproject.toml\r\ntestpaths: anndata, ./src/anndata/tests, ./docs/concatenation.rst\r\nplugins: xdist-3.5.0, memray-1.5.0, anyio-4.2.0, cov-4.1.0\r\ncollected 3028 items / 20 errors\r\n\r\n==================================== ERRORS ====================================\r\n__________________________ ERROR collecting utils.py ___________________________\r\n/opt/hostedtoolcache/Python/3.11.7/x64/lib/python3.11/site-packages/anndata/utils.py:13: in <module>\r\n    from ._core.sparse_dataset import BaseCompressedSparseDataset\r\nE   ModuleNotFoundError: No module named 'opt.hostedtoolcache.Python.3.11.7.x64.lib.python3.11.site-packages.anndata._core'; 'opt.hostedtoolcache.Python.3.11.7.x64.lib.python3.11.site-packages.anndata' is not a package\r\n__________________ ERROR collecting _core/aligned_mapping.py ___________________\r\n/opt/hostedtoolcache/Python/3.11.7/x64/lib/python3.11/site-packages/anndata/_core/aligned_mapping.py:23: in <module>\r\n    from ..utils import deprecated, dim_len, ensure_df_homogeneous, warn_once\r\nE   ImportError: cannot import name 'deprecated' from 'opt.hostedtoolcache.Python.3.11.7.x64.lib.python3.11.site-packages.anndata.utils' (/opt/hostedtoolcache/Python/3.11.7/x64/lib/python3.11/site-packages/anndata/utils.py)\r\n...\r\n```\r\n\r\nbut using the â€œreproducerâ€ I so confidently outlined above, everything works.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889184478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889629749","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1889629749","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1889629749,"node_id":"IC_kwDOAjwLdc5woXY1","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T16:45:26Z","updated_at":"2024-01-12T16:54:24Z","body":"OK, I minified the repo somewhat. I assume the problem is that even with `--pyargs`, pytest tries to import the module with weird names while running doctest.\r\n\r\nhttps://github.com/flying-sheep/pytest-doctest-import-mismatch\r\n\r\nI see errors like this:\r\n\r\n```pytb\r\n____ ERROR collecting _core/merge.py ____\r\n/home/phil/.local/share/hatch/env/virtual/anndata/kX3YdB0h/anndata/lib/python3.11/site-packages/anndata/_core/merge.py:28: in <module>\r\n   from ..compat import _map_cat_to_str\r\nE   ModuleNotFoundError: No module named 'home.phil..local.share.hatch.env.virtual.anndata.kX3YdB0h.anndata.lib.python3.11.site-packages.anndata.compat'; 'home.phil..local.share.hatch.env.virtual.anndata.kX3YdB0h.anndata.lib.python3.11.site-packages.anndata' is not a package\r\n____ ERROR collecting _core/raw.py ____\r\n/home/phil/.local/share/hatch/env/virtual/anndata/kX3YdB0h/anndata/lib/python3.11/site-packages/anndata/_core/raw.py:9: in <module>\r\n   from .aligned_mapping import AxisArrays\r\nE   ImportError: cannot import name 'AxisArrays' from 'home.phil..local.share.hatch.env.virtual.anndata.kX3YdB0h.anndata.lib.python3.11.site-packages.anndata._core.aligned_mapping' (/home/phil/.local/share/hatch/env/virtual/anndata/kX3YdB0h/anndata/lib/python3.11/site-packages/anndata/_core/aligned_mapping.py)\r\n```\r\n\r\nThe reproducer is by no means minimal yet, and I can make it smaller for sure, but maybe itâ€™s helpful before i get to that already.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889629749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889860216","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1889860216","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1889860216,"node_id":"IC_kwDOAjwLdc5wpPp4","user":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T19:46:18Z","updated_at":"2024-01-12T19:46:18Z","body":"(First, consider editing the original post to point to the reproduction; the `ImportPathMismatchError` error stated there *cannot* happen in `--import-mode=importlib` so it's quite confusing).\r\n\r\nThanks for creating a reproduction. I tried it now. I was able to reproduce with pytest 7.4, but with pytest main it works (only if using venv name `venv` instead of `.venv` -- see below). I bisected the fix to commit 194a782e3817ee9f4f77a7a61ec68d25b3b08250 which is also included in 8.0.0rc1.\r\n\r\nHowever, there's an issue I noticed: If the path contains dots, e.g. `.venv` and `python3.11` in this case, then `--import-mode=importlib` fails like this:\r\n\r\n<details><summary>Dot problem</summary>\r\n<p>\r\n\r\n```\r\n__________________________________________________ ERROR collecting .venv/lib/python3.11/site-packages/anndata/__init__.py ___________________________________________________\r\n.venv/lib/python3.11/site-packages/anndata/__init__.py:11: in <module>\r\n    from ._core.anndata import AnnData\r\nE   ValueError: Empty module name\r\n________________________________________________ ERROR collecting .venv/lib/python3.11/site-packages/anndata/_core/access.py _________________________________________________\r\n/usr/lib/python3.11/importlib/__init__.py:121: in import_module\r\n    raise TypeError(msg.format(name))\r\nE   TypeError: the 'package' argument is required to perform a relative import for '.venv.lib.python3.11.site-packages'\r\n____________________________________________ ERROR collecting .venv/lib/python3.11/site-packages/anndata/_core/aligned_mapping.py ____________________________________________\r\n/usr/lib/python3.11/importlib/__init__.py:121: in import_module\r\n    raise TypeError(msg.format(name))\r\nE   TypeError: the 'package' argument is required to perform a relative import for '.venv.lib.python3.11.site-packages'\r\n________________________________________________ ERROR collecting .venv/lib/python3.11/site-packages/anndata/_core/anndata.py ________________________________________________\r\n/usr/lib/python3.11/importlib/__init__.py:121: in import_module\r\n    raise TypeError(msg.format(name))\r\nE   TypeError: the 'package' argument is required to perform a relative import for '.venv.lib.python3.11.site-packages'\r\n_________________________________________________ ERROR collecting .venv/lib/python3.11/site-packages/anndata/_core/merge.py _________________________________________________\r\n/usr/lib/python3.11/importlib/__init__.py:121: in import_module\r\n    raise TypeError(msg.format(name))\r\nE   TypeError: the 'package' argument is required to perform a relative import for '.venv.lib.python3.11.site-packages'\r\n_____________________________________________________ ERROR collecting .venv/lib/python3.11/site-packages/anndata/tests ______________________________________________________\r\n/usr/lib/python3.11/importlib/__init__.py:121: in import_module\r\n    raise TypeError(msg.format(name))\r\nE   TypeError: the 'package' argument is required to perform a relative import for '.venv.lib.python3.11.site-packages.anndata.tests'\r\n```\r\n\r\n</p>\r\n</details> \r\n\r\n Python module names (individual components) cannot contain dots, and the `--import-mode=importlib` code does stuff like `module_name.split(\".\")`.\r\n\r\nI tried \"escaping\" the dots by replacing them with `_dot_`, which allows things to continue, however then it fails like this:\r\n\r\n<details><summary>Exec module problem</summary>\r\n<p>\r\n\r\n```\r\nself = <DoctestModule __init__.py>\r\n\r\n    def collect(self) -> Iterable[DoctestItem]:\r\n        import doctest\r\n    \r\n        class MockAwareDocTestFinder(doctest.DocTestFinder):\r\n            \"\"\"A hackish doctest finder that overrides stdlib internals to fix a stdlib bug.\r\n    \r\n            https://github.com/pytest-dev/pytest/issues/3456\r\n            https://bugs.python.org/issue25532\r\n            \"\"\"\r\n    \r\n            def _find_lineno(self, obj, source_lines):\r\n                \"\"\"Doctest code does not take into account `@property`, this\r\n                is a hackish way to fix it. https://bugs.python.org/issue17446\r\n    \r\n                Wrapped Doctests will need to be unwrapped so the correct\r\n                line number is returned. This will be reported upstream. #8796\r\n                \"\"\"\r\n                if isinstance(obj, property):\r\n                    obj = getattr(obj, \"fget\", obj)\r\n    \r\n                if hasattr(obj, \"__wrapped__\"):\r\n                    # Get the main obj in case of it being wrapped\r\n                    obj = inspect.unwrap(obj)\r\n    \r\n                # Type ignored because this is a private function.\r\n                return super()._find_lineno(  # type:ignore[misc]\r\n                    obj,\r\n                    source_lines,\r\n                )\r\n    \r\n            def _find(\r\n                self, tests, obj, name, module, source_lines, globs, seen\r\n            ) -> None:\r\n                if _is_mocked(obj):\r\n                    return\r\n                with _patch_unwrap_mock_aware():\r\n                    # Type ignored because this is a private function.\r\n                    super()._find(  # type:ignore[misc]\r\n                        tests, obj, name, module, source_lines, globs, seen\r\n                    )\r\n    \r\n            if sys.version_info < (3, 13):\r\n    \r\n                def _from_module(self, module, object):\r\n                    \"\"\"`cached_property` objects are never considered a part\r\n                    of the 'current module'. As such they are skipped by doctest.\r\n                    Here we override `_from_module` to check the underlying\r\n                    function instead. https://github.com/python/cpython/issues/107995\r\n                    \"\"\"\r\n                    if isinstance(object, functools.cached_property):\r\n                        object = object.func\r\n    \r\n                    # Type ignored because this is a private function.\r\n                    return super()._from_module(module, object)  # type: ignore[misc]\r\n    \r\n            else:  # pragma: no cover\r\n                pass\r\n    \r\n        if self.path.name == \"conftest.py\":\r\n            module = self.config.pluginmanager._importconftest(\r\n                self.path,\r\n                self.config.getoption(\"importmode\"),\r\n                rootpath=self.config.rootpath,\r\n            )\r\n        else:\r\n            try:\r\n>               module = import_path(\r\n                    self.path,\r\n                    root=self.config.rootpath,\r\n                    mode=self.config.getoption(\"importmode\"),\r\n                )\r\n\r\n../../src/pytest/src/_pytest/doctest.py:569: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\np = PosixPath('/home/ran/tmp/pytest-doctest-import-mismatch/.venv/lib/python3.11/site-packages/anndata/__init__.py')\r\n\r\n    def import_path(\r\n        p: Union[str, \"os.PathLike[str]\"],\r\n        *,\r\n        mode: Union[str, ImportMode] = ImportMode.prepend,\r\n        root: Path,\r\n    ) -> ModuleType:\r\n        \"\"\"Import and return a module from the given path, which can be a file (a module) or\r\n        a directory (a package).\r\n    \r\n        The import mechanism used is controlled by the `mode` parameter:\r\n    \r\n        * `mode == ImportMode.prepend`: the directory containing the module (or package, taking\r\n          `__init__.py` files into account) will be put at the *start* of `sys.path` before\r\n          being imported with `importlib.import_module`.\r\n    \r\n        * `mode == ImportMode.append`: same as `prepend`, but the directory will be appended\r\n          to the end of `sys.path`, if not already in `sys.path`.\r\n    \r\n        * `mode == ImportMode.importlib`: uses more fine control mechanisms provided by `importlib`\r\n          to import the module, which avoids having to muck with `sys.path` at all. It effectively\r\n          allows having same-named test modules in different places.\r\n    \r\n        :param root:\r\n            Used as an anchor when mode == ImportMode.importlib to obtain\r\n            a unique name for the module being imported so it can safely be stored\r\n            into ``sys.modules``.\r\n    \r\n        :raises ImportPathMismatchError:\r\n            If after importing the given `path` and the module `__file__`\r\n            are different. Only raised in `prepend` and `append` modes.\r\n        \"\"\"\r\n        mode = ImportMode(mode)\r\n    \r\n        path = Path(p)\r\n    \r\n        if not path.exists():\r\n            raise ImportError(path)\r\n    \r\n        if mode is ImportMode.importlib:\r\n            module_name = module_name_from_path(path, root)\r\n            with contextlib.suppress(KeyError):\r\n                return sys.modules[module_name]\r\n    \r\n            for meta_importer in sys.meta_path:\r\n                spec = meta_importer.find_spec(module_name, [str(path.parent)])\r\n                if spec is not None:\r\n                    break\r\n            else:\r\n                spec = importlib.util.spec_from_file_location(module_name, str(path))\r\n    \r\n            if spec is None:\r\n                raise ImportError(f\"Can't find module {module_name} at location {path}\")\r\n            mod = importlib.util.module_from_spec(spec)\r\n            sys.modules[module_name] = mod\r\n>           spec.loader.exec_module(mod)  # type: ignore[union-attr]\r\n\r\n../../src/pytest/src/_pytest/pathlib.py:540: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <_frozen_importlib_external.SourceFileLoader object at 0x7feac0a280d0>\r\nmodule = <module '_dot_venv.lib.python3_dot_11.site-packages.anndata' from '/home/ran/tmp/pytest-doctest-import-mismatch/.venv/lib/python3.11/site-packages/anndata/__init__.py'>\r\n\r\n>   ???\r\n\r\n<frozen importlib._bootstrap_external>:940: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nf = <built-in function exec>\r\nargs = (<code object <module> at 0x7feac0c24ff0, file \"/home/ran/tmp/pytest-doctest-import-mismatch/.venv/lib/python3.11/site...__file__': '/home/ran/tmp/pytest-doctest-import-mismatch/.venv/lib/python3.11/site-packages/anndata/__init__.py', ...})\r\nkwds = {}\r\n\r\n>   ???\r\n\r\n<frozen importlib._bootstrap>:241: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\n    \"\"\"Annotated multivariate observation data.\"\"\"\r\n    from __future__ import annotations\r\n    \r\n    # Allowing notes to be added to exceptions. See: https://github.com/scverse/anndata/issues/868\r\n    import sys\r\n    \r\n    if sys.version_info < (3, 11):\r\n        # Backport package for exception groups\r\n        import exceptiongroup  # noqa: F401\r\n    \r\n>   from ._core.anndata import AnnData\r\nE   ModuleNotFoundError: No module named '_dot_venv'\r\n\r\n.venv/lib/python3.11/site-packages/anndata/__init__.py:11: ModuleNotFoundError\r\n```\r\n\r\n\r\n</p>\r\n</details>\r\n\r\nThis is possibly another problem with `--import-mode=importlib`; if I swap the order of the `exec_module` and the `insert_missing_modules` statements then it does work, but I'm not familiar enough the code to know if it's correct.\r\n\r\n@nicoddemus Do you have any idea about this?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1889860216/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":11473203659,"node_id":"MEE_lADOAjwLdc5yjT_-zwAAAAKr2zHL","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11473203659","actor":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-01-12T19:46:19Z","performed_via_github_app":null},{"id":11473203669,"node_id":"SE_lADOAjwLdc5yjT_-zwAAAAKr2zHV","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11473203669","actor":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-01-12T19:46:19Z","performed_via_github_app":null},{"id":11487328646,"node_id":"RTE_lADOAjwLdc5yjT_-zwAAAAKssrmG","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11487328646","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2024-01-15T11:55:40Z","rename":{"from":"ImportMismatchError when using `pip install` without `-e`, `--doctest-modules`, a `src/` layout, and `--import-mode=importlib`","to":"ModuleNotFoundError when using `pip install` without `-e`, `--doctest-modules`, a `src/` layout, and `--import-mode=importlib`"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1892038086","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1892038086","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1892038086,"node_id":"IC_kwDOAjwLdc5wxjXG","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T12:02:55Z","updated_at":"2024-01-15T12:02:55Z","body":"> First, consider editing the original post to point to the reproduction; the ImportPathMismatchError error stated there cannot happen in --import-mode=importlib so it's quite confusing\r\n\r\nfixed\r\n\r\n> Thanks for creating a reproduction. I tried it now. I was able to reproduce with pytest 7.4, but with pytest main it works \r\n\r\nWell, unless Iâ€™m missing something, the same package is still imported twice with this approach, right?\r\n\r\nWhich might cause problems similar to https://github.com/pytest-dev/pytest/issues/11306 when the two versions try to access some shared resource. (e.g. letâ€™s say they both open a database connection or write a file on import time â€“ not super good style, but possible)","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1892038086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1912052447","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1912052447","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1912052447,"node_id":"IC_kwDOAjwLdc5x95rf","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-26T13:15:39Z","updated_at":"2024-01-26T13:15:39Z","body":"@nicoddemus any idea?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1912052447/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":11608809452,"node_id":"MEE_lADOAjwLdc5yjT_-zwAAAAKz8F_s","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11608809452","actor":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-01-26T13:15:40Z","performed_via_github_app":null},{"id":11608809461,"node_id":"SE_lADOAjwLdc5yjT_-zwAAAAKz8F_1","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11608809461","actor":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-01-26T13:15:40Z","performed_via_github_app":null},{"id":11702087595,"node_id":"RTE_lADOAjwLdc5yjT_-zwAAAAK5f6-r","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11702087595","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2024-02-05T10:49:35Z","rename":{"from":"ModuleNotFoundError when using `pip install` without `-e`, `--doctest-modules`, a `src/` layout, and `--import-mode=importlib`","to":"ModuleNotFoundError when using `pip install` with `--doctest-modules`, a `src/` layout, `--import-mode=importlib`, and without `-e`"},"performed_via_github_app":null},{"id":11702106189,"node_id":"RTE_lADOAjwLdc5yjT_-zwAAAAK5f_hN","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11702106189","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2024-02-05T10:51:07Z","rename":{"from":"ModuleNotFoundError when using `pip install` with `--doctest-modules`, a `src/` layout, `--import-mode=importlib`, and without `-e`","to":"ModuleNotFoundError when using `--doctest-modules`, a `src/` layout, and `--import-mode=importlib` (and no editable mode install)"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1926730600","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1926730600","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1926730600,"node_id":"IC_kwDOAjwLdc5y15No","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-05T11:05:54Z","updated_at":"2024-02-05T11:05:54Z","body":"I think no â€œescapingâ€ hackery is necessary. We run `pytest --pyargs <modulename>`, so the parent module of any doctest should start with `<modulename>` and not `_dot_venv` or `opt.hostedtoolcache.Python*site-packages`.\r\n\r\nSo how about we just infer the correct module name of the parent module using `sys.path` by enforcing that it matches the module name supplied using `--pyargs`?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1926730600/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-05T15:10:21Z","updated_at":"2024-02-05T15:10:21Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11931","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11931/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11931/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11931/events","html_url":"https://github.com/pytest-dev/pytest/pull/11931","id":2118792637,"node_id":"PR_kwDOAjwLdc5mCWFf","number":11931,"title":"Use shortest module name for importlib imports","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-02-05T15:10:21Z","updated_at":"2024-02-18T12:09:46Z","closed_at":"2024-02-18T12:09:46Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":37489525,"node_id":"MDEwOlJlcG9zaXRvcnkzNzQ4OTUyNQ==","name":"pytest","full_name":"pytest-dev/pytest","private":false,"owner":{"login":"pytest-dev","id":8897583,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg4OTc1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/8897583?v=4","gravatar_id":"","url":"https://api.github.com/users/pytest-dev","html_url":"https://github.com/pytest-dev","followers_url":"https://api.github.com/users/pytest-dev/followers","following_url":"https://api.github.com/users/pytest-dev/following{/other_user}","gists_url":"https://api.github.com/users/pytest-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/pytest-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pytest-dev/subscriptions","organizations_url":"https://api.github.com/users/pytest-dev/orgs","repos_url":"https://api.github.com/users/pytest-dev/repos","events_url":"https://api.github.com/users/pytest-dev/events{/privacy}","received_events_url":"https://api.github.com/users/pytest-dev/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/pytest-dev/pytest","description":"The pytest framework makes it easy to write small tests, yet scales to support complex functional testing","fork":false,"url":"https://api.github.com/repos/pytest-dev/pytest","forks_url":"https://api.github.com/repos/pytest-dev/pytest/forks","keys_url":"https://api.github.com/repos/pytest-dev/pytest/keys{/key_id}","collaborators_url":"https://api.github.com/repos/pytest-dev/pytest/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/pytest-dev/pytest/teams","hooks_url":"https://api.github.com/repos/pytest-dev/pytest/hooks","issue_events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/events{/number}","events_url":"https://api.github.com/repos/pytest-dev/pytest/events","assignees_url":"https://api.github.com/repos/pytest-dev/pytest/assignees{/user}","branches_url":"https://api.github.com/repos/pytest-dev/pytest/branches{/branch}","tags_url":"https://api.github.com/repos/pytest-dev/pytest/tags","blobs_url":"https://api.github.com/repos/pytest-dev/pytest/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/pytest-dev/pytest/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/pytest-dev/pytest/git/refs{/sha}","trees_url":"https://api.github.com/repos/pytest-dev/pytest/git/trees{/sha}","statuses_url":"https://api.github.com/repos/pytest-dev/pytest/statuses/{sha}","languages_url":"https://api.github.com/repos/pytest-dev/pytest/languages","stargazers_url":"https://api.github.com/repos/pytest-dev/pytest/stargazers","contributors_url":"https://api.github.com/repos/pytest-dev/pytest/contributors","subscribers_url":"https://api.github.com/repos/pytest-dev/pytest/subscribers","subscription_url":"https://api.github.com/repos/pytest-dev/pytest/subscription","commits_url":"https://api.github.com/repos/pytest-dev/pytest/commits{/sha}","git_commits_url":"https://api.github.com/repos/pytest-dev/pytest/git/commits{/sha}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/comments{/number}","issue_comment_url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments{/number}","contents_url":"https://api.github.com/repos/pytest-dev/pytest/contents/{+path}","compare_url":"https://api.github.com/repos/pytest-dev/pytest/compare/{base}...{head}","merges_url":"https://api.github.com/repos/pytest-dev/pytest/merges","archive_url":"https://api.github.com/repos/pytest-dev/pytest/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/pytest-dev/pytest/downloads","issues_url":"https://api.github.com/repos/pytest-dev/pytest/issues{/number}","pulls_url":"https://api.github.com/repos/pytest-dev/pytest/pulls{/number}","milestones_url":"https://api.github.com/repos/pytest-dev/pytest/milestones{/number}","notifications_url":"https://api.github.com/repos/pytest-dev/pytest/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/pytest-dev/pytest/labels{/name}","releases_url":"https://api.github.com/repos/pytest-dev/pytest/releases{/id}","deployments_url":"https://api.github.com/repos/pytest-dev/pytest/deployments","created_at":"2015-06-15T20:28:27Z","updated_at":"2025-11-09T16:32:44Z","pushed_at":"2025-11-09T09:33:29Z","git_url":"git://github.com/pytest-dev/pytest.git","ssh_url":"git@github.com:pytest-dev/pytest.git","clone_url":"https://github.com/pytest-dev/pytest.git","svn_url":"https://github.com/pytest-dev/pytest","homepage":"https://pytest.org","size":37842,"stargazers_count":13254,"watchers_count":13254,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":2933,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":953,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","python","test","testing","unit-testing"],"visibility":"public","forks":2933,"open_issues":953,"watchers":13254,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/pytest-dev/pytest/pulls/11931","html_url":"https://github.com/pytest-dev/pytest/pull/11931","diff_url":"https://github.com/pytest-dev/pytest/pull/11931.diff","patch_url":"https://github.com/pytest-dev/pytest/pull/11931.patch","merged_at":null},"body":"<!--\nThanks for submitting a PR, your contribution is really appreciated!\n\nHere is a quick checklist that should be present in PRs.\n\n- [x] Include documentation when adding new features.\n- [x] Include new tests or update existing tests when applicable.\n- [X] Allow maintainers to push and squash when merging my commits. Please uncheck this if you prefer to squash the commits yourself.\n\nIf this change fixes an issue, please:\n\n- [x] Add text like ``closes #XYZW`` to the PR description and/or commits (where ``XYZW`` is the issue number). See the [github docs](https://help.github.com/en/github/managing-your-work-on-github/linking-a-pull-request-to-an-issue#linking-a-pull-request-to-an-issue-using-a-keyword) for more information.\n\nUnless your change is trivial or a small documentation fix (e.g., a typo or reword of a small section) please:\n\n- [ ] Create a new changelog file in the `changelog` folder, with a name like `<ISSUE NUMBER>.<TYPE>.rst`. See [changelog/README.rst](https://github.com/pytest-dev/pytest/blob/main/changelog/README.rst) for details.\n\n  Write sentences in the **past or present tense**, examples:\n\n  * *Improved verbose diff output with sequences.*\n  * *Terminal summary statistics now use multiple colors.*\n\n  Also make sure to end the sentence with a `.`.\n\n- [ ] Add yourself to `AUTHORS` in alphabetical order.\n-->\n\n\nCloses #11475","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11931/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11931/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"actor":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-06T23:25:52Z","updated_at":"2024-02-06T23:25:52Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11941","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11941/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11941/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11941/events","html_url":"https://github.com/pytest-dev/pytest/pull/11941","id":2121751278,"node_id":"PR_kwDOAjwLdc5mMgiW","number":11941,"title":"doctest: fix autouse fixtures possibly not getting picked up","user":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-02-06T22:08:11Z","updated_at":"2024-02-07T20:09:32Z","closed_at":"2024-02-07T20:09:18Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":37489525,"node_id":"MDEwOlJlcG9zaXRvcnkzNzQ4OTUyNQ==","name":"pytest","full_name":"pytest-dev/pytest","private":false,"owner":{"login":"pytest-dev","id":8897583,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg4OTc1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/8897583?v=4","gravatar_id":"","url":"https://api.github.com/users/pytest-dev","html_url":"https://github.com/pytest-dev","followers_url":"https://api.github.com/users/pytest-dev/followers","following_url":"https://api.github.com/users/pytest-dev/following{/other_user}","gists_url":"https://api.github.com/users/pytest-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/pytest-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pytest-dev/subscriptions","organizations_url":"https://api.github.com/users/pytest-dev/orgs","repos_url":"https://api.github.com/users/pytest-dev/repos","events_url":"https://api.github.com/users/pytest-dev/events{/privacy}","received_events_url":"https://api.github.com/users/pytest-dev/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/pytest-dev/pytest","description":"The pytest framework makes it easy to write small tests, yet scales to support complex functional testing","fork":false,"url":"https://api.github.com/repos/pytest-dev/pytest","forks_url":"https://api.github.com/repos/pytest-dev/pytest/forks","keys_url":"https://api.github.com/repos/pytest-dev/pytest/keys{/key_id}","collaborators_url":"https://api.github.com/repos/pytest-dev/pytest/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/pytest-dev/pytest/teams","hooks_url":"https://api.github.com/repos/pytest-dev/pytest/hooks","issue_events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/events{/number}","events_url":"https://api.github.com/repos/pytest-dev/pytest/events","assignees_url":"https://api.github.com/repos/pytest-dev/pytest/assignees{/user}","branches_url":"https://api.github.com/repos/pytest-dev/pytest/branches{/branch}","tags_url":"https://api.github.com/repos/pytest-dev/pytest/tags","blobs_url":"https://api.github.com/repos/pytest-dev/pytest/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/pytest-dev/pytest/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/pytest-dev/pytest/git/refs{/sha}","trees_url":"https://api.github.com/repos/pytest-dev/pytest/git/trees{/sha}","statuses_url":"https://api.github.com/repos/pytest-dev/pytest/statuses/{sha}","languages_url":"https://api.github.com/repos/pytest-dev/pytest/languages","stargazers_url":"https://api.github.com/repos/pytest-dev/pytest/stargazers","contributors_url":"https://api.github.com/repos/pytest-dev/pytest/contributors","subscribers_url":"https://api.github.com/repos/pytest-dev/pytest/subscribers","subscription_url":"https://api.github.com/repos/pytest-dev/pytest/subscription","commits_url":"https://api.github.com/repos/pytest-dev/pytest/commits{/sha}","git_commits_url":"https://api.github.com/repos/pytest-dev/pytest/git/commits{/sha}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/comments{/number}","issue_comment_url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments{/number}","contents_url":"https://api.github.com/repos/pytest-dev/pytest/contents/{+path}","compare_url":"https://api.github.com/repos/pytest-dev/pytest/compare/{base}...{head}","merges_url":"https://api.github.com/repos/pytest-dev/pytest/merges","archive_url":"https://api.github.com/repos/pytest-dev/pytest/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/pytest-dev/pytest/downloads","issues_url":"https://api.github.com/repos/pytest-dev/pytest/issues{/number}","pulls_url":"https://api.github.com/repos/pytest-dev/pytest/pulls{/number}","milestones_url":"https://api.github.com/repos/pytest-dev/pytest/milestones{/number}","notifications_url":"https://api.github.com/repos/pytest-dev/pytest/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/pytest-dev/pytest/labels{/name}","releases_url":"https://api.github.com/repos/pytest-dev/pytest/releases{/id}","deployments_url":"https://api.github.com/repos/pytest-dev/pytest/deployments","created_at":"2015-06-15T20:28:27Z","updated_at":"2025-11-09T16:32:44Z","pushed_at":"2025-11-09T09:33:29Z","git_url":"git://github.com/pytest-dev/pytest.git","ssh_url":"git@github.com:pytest-dev/pytest.git","clone_url":"https://github.com/pytest-dev/pytest.git","svn_url":"https://github.com/pytest-dev/pytest","homepage":"https://pytest.org","size":37842,"stargazers_count":13254,"watchers_count":13254,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":2933,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":953,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","python","test","testing","unit-testing"],"visibility":"public","forks":2933,"open_issues":953,"watchers":13254,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/pytest-dev/pytest/pulls/11941","html_url":"https://github.com/pytest-dev/pytest/pull/11941","diff_url":"https://github.com/pytest-dev/pytest/pull/11941.diff","patch_url":"https://github.com/pytest-dev/pytest/pull/11941.patch","merged_at":"2024-02-07T20:09:18Z"},"body":"Fix #11929. There is also a prerequisite commit, please see the commit message.","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11941/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11941/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1937043670","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1937043670","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1937043670,"node_id":"IC_kwDOAjwLdc5zdPDW","user":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-10T15:26:47Z","updated_at":"2024-02-10T15:28:55Z","body":"Sorry for the long post, spent the last 3 hours working on this and I'm afraid there's no simple \"fix\" for this case.\r\n\r\n\r\nThe short answer is that pytest uses `--import-mode=importlib` for all imports, not only tests and conftests as originally intended.\r\n\r\nThe introduction of `importlib` mode was meant to give an alternative to the other modes so that:\r\n\r\n1. pytest does not need change `sys.path` to import tests and conftest files.\r\n2. Different test modules can have the same base name, without `__init__.py` files.\r\n\r\n(Full explanation [in the docs](https://docs.pytest.org/en/stable/explanation/pythonpath.html#import-modes)).\r\n\r\nOn a non-src layout:\r\n\r\n\r\n```\r\npkg/__init__.py\r\ntests/\r\n  test_foo.py\r\n```\r\n\r\n\r\nOne of the reasons why changing `sys.path` is problematic in this case is because it will add `.` to the root directory to import the tests under `tests`, which has the side effect of making `pkg` also importable. This can hide problems when trying to test the installed package in `.venv`, because now we are actually testing the local sources as they are reachable through `sys.path` during testing, instead of the installed packages in `.venv`.\r\n\r\n\r\nOn `src` layouts:\r\n\r\n```\r\nsrc/pkg/__init__.py\r\ntests/\r\n  test_foo.py\r\n```\r\n\r\nThis is not a problem: adding `.` to `sys.path` does not make `pkg` importable, so `import pkg` will import from the `.venv` as desired.\r\n\r\n\r\nThe reproducer repository is using `importlib` mode, I'm guessing because of reason 2 (duplicated test names), or perhaps because at one point we recommended using `importlib` intending to turn it into the default, however since then we realized this is not possible, as it brings it has its own drawbacks.\r\n\r\n@flying-sheep, by changing your configuration slightly I was able to make your reproduce run without problems in pytest `main` and in `7.4.4`:\r\n\r\n* Exclude `conftest.py` files from being installed: they should be imported by pytest directly.\r\n* Drop `importlib`, as you are using `src` layout. If the problem is due to duplicated test names, just adding `__init__.py` on the folders with the duplicated tests solves it.\r\n```pytest\r\nÎ» pytest\r\n======================== test session starts ========================\r\nplatform win32 -- Python 3.11.5, pytest-7.4.4, pluggy-1.4.0\r\nrootdir: e:\\projects\\pytest-doctest-import-mismatch\r\nconfigfile: pyproject.toml\r\ntestpaths: anndata, ./src/anndata/tests\r\ncollected 6 items\r\n\r\n.env311\\Lib\\site-packages\\anndata\\utils.py .                   [ 16%]\r\n.env311\\Lib\\site-packages\\anndata\\_core\\anndata.py ..          [ 50%]\r\n.env311\\Lib\\site-packages\\anndata\\_core\\merge.py ..            [ 83%]\r\nsrc\\anndata\\tests\\test_base.py .                               [100%]\r\n\r\n========================= warnings summary ==========================\r\n```\r\n\r\nHere's the diff:\r\n\r\n```diff\r\ndiff --git a/pyproject.toml b/pyproject.toml\r\nindex 81389c5..d15f40a 100644\r\n--- a/pyproject.toml\r\n+++ b/pyproject.toml\r\n@@ -21,12 +21,12 @@ dependencies = [\r\n \r\n [tool.hatch.build]\r\n exclude = [\r\n+    'src/anndata/tests/conftest.py',\r\n     'src/anndata/tests/test_*.py',\r\n ]\r\n \r\n [tool.pytest.ini_options]\r\n addopts = [\r\n-    '--import-mode=importlib',\r\n     '--doctest-modules',\r\n     '--pyargs',\r\n ]\r\n```\r\n\r\n\r\nFollows is a long description of the overall problem.\r\n\r\n---\r\n\r\nThe introduction of `importlib` mode was meant to give an alternative to the other modes so that:\r\n\r\n1. pytest does not need change `sys.path` to import tests and conftest files.\r\n2. Different test modules can have the same base name, without `__init__.py` files.\r\n\r\n(Full explanation [in the docs](https://docs.pytest.org/en/stable/explanation/pythonpath.html#import-modes)).\r\n\r\nOne important thing in that description is *test modules and *conftests*. \r\n\r\nBefore we introduced the `importlib` mode, all modules *directly* imported by pytest used the same function, `import_path`, which changes `sys.path` to import a module in case it is not already importable. \"All modules\" in the majority means tests and conftests (as user application code is imported indirectly through these), but it also includes user application code in some cases, doctests being one case relevant here.\r\n\r\nThe `importlib` mode works by assuming it is importing a module that cannot be reached from `sys.path` through the normal means, a common example being the `tests` directory layout at the root of the package, where we have a test file `tests/foo/bar/test_foo.py` without any `__init__.py` files within. It is not importable because `tests` is not reachable from `sys.path`, and we also do not want to change it.\r\n\r\nTo import that file, we:\r\n\r\n1. Try to come up with a \"module name\" for it based on its full path and root, so for the file `tests/foo/bar/test_foo.py` we make up an non-existing module name `\"tests.foo.bar.test_foo\"`. This module name will be unique, and not conflict with other test modules named `test_foo.py` in the same suite, as they will be in a different directory and will be assigned a different module name using the same mechanism (`\"tests.schema.test_foo\"` for example).\r\n\r\n2. Import the module using its full path using `importlib.importmodule`, and then place that module in `sys.modules` with the `module_name` we determined above.\r\n\r\nThis works well when used to import just test modules and conftests, but will create divergences when used import application code. In the reproducer repo, we are trying to import `anndata` using `importlib` mode, so it ends up being imported as a module named using the logic described above, however it *is* reachable through `sys.path` and we probably should import it using the normal mechanisms.\r\n\r\nProbably one solution is to revisit all places where we manually import modules, and possibly use \"importlib\" (when configured) for tests+conftests or fallback to the other mechanisms for normal modules, but this feels *extremely* risky given the millions of test suites out there.\r\n\r\nThe `importlib` mode was intended to solve avoid changing `sys.path`/\"ImportMismatch\" errors, but particularly if I knew all the problems/details it involves, I would just recommend other solutions:\r\n\r\n1. pytest changes `sys.path` and it is testing the local copy? Switch to `src` layout.\r\n2. Test module names with the same? Add `__init__.py` files in your tests turning them into packages.\r\n\r\nBut here we are. \r\n\r\nI'm not sure how to proceed here. Perhaps we can right away add a warning on `--doctest-modules` that it might be problematic to use together with `--import-mode=importlib`.\r\n\r\nI will spend some more time trying to see if there's a simple and safe solution to this general mess.\r\n\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1937043670/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":11765057520,"node_id":"MEE_lADOAjwLdc5yjT_-zwAAAAK9QIfw","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11765057520","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2024-02-10T15:26:49Z","performed_via_github_app":null},{"id":11765057525,"node_id":"SE_lADOAjwLdc5yjT_-zwAAAAK9QIf1","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/11765057525","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2024-02-10T15:26:49Z","performed_via_github_app":null},{"actor":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-10T15:42:36Z","updated_at":"2024-02-10T15:42:36Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11960","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11960/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11960/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11960/events","html_url":"https://github.com/pytest-dev/pytest/issues/11960","id":2128077067,"node_id":"I_kwDOAjwLdc5-1-EL","number":11960,"title":"I'm sad and tire of the way PyTest handles sys.path","user":{"login":"Ark-kun","id":1829149,"node_id":"MDQ6VXNlcjE4MjkxNDk=","avatar_url":"https://avatars.githubusercontent.com/u/1829149?v=4","gravatar_id":"","url":"https://api.github.com/users/Ark-kun","html_url":"https://github.com/Ark-kun","followers_url":"https://api.github.com/users/Ark-kun/followers","following_url":"https://api.github.com/users/Ark-kun/following{/other_user}","gists_url":"https://api.github.com/users/Ark-kun/gists{/gist_id}","starred_url":"https://api.github.com/users/Ark-kun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ark-kun/subscriptions","organizations_url":"https://api.github.com/users/Ark-kun/orgs","repos_url":"https://api.github.com/users/Ark-kun/repos","events_url":"https://api.github.com/users/Ark-kun/events{/privacy}","received_events_url":"https://api.github.com/users/Ark-kun/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-02-10T03:47:51Z","updated_at":"2024-02-10T15:42:47Z","closed_at":"2024-02-10T12:47:54Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":37489525,"node_id":"MDEwOlJlcG9zaXRvcnkzNzQ4OTUyNQ==","name":"pytest","full_name":"pytest-dev/pytest","private":false,"owner":{"login":"pytest-dev","id":8897583,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg4OTc1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/8897583?v=4","gravatar_id":"","url":"https://api.github.com/users/pytest-dev","html_url":"https://github.com/pytest-dev","followers_url":"https://api.github.com/users/pytest-dev/followers","following_url":"https://api.github.com/users/pytest-dev/following{/other_user}","gists_url":"https://api.github.com/users/pytest-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/pytest-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pytest-dev/subscriptions","organizations_url":"https://api.github.com/users/pytest-dev/orgs","repos_url":"https://api.github.com/users/pytest-dev/repos","events_url":"https://api.github.com/users/pytest-dev/events{/privacy}","received_events_url":"https://api.github.com/users/pytest-dev/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/pytest-dev/pytest","description":"The pytest framework makes it easy to write small tests, yet scales to support complex functional testing","fork":false,"url":"https://api.github.com/repos/pytest-dev/pytest","forks_url":"https://api.github.com/repos/pytest-dev/pytest/forks","keys_url":"https://api.github.com/repos/pytest-dev/pytest/keys{/key_id}","collaborators_url":"https://api.github.com/repos/pytest-dev/pytest/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/pytest-dev/pytest/teams","hooks_url":"https://api.github.com/repos/pytest-dev/pytest/hooks","issue_events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/events{/number}","events_url":"https://api.github.com/repos/pytest-dev/pytest/events","assignees_url":"https://api.github.com/repos/pytest-dev/pytest/assignees{/user}","branches_url":"https://api.github.com/repos/pytest-dev/pytest/branches{/branch}","tags_url":"https://api.github.com/repos/pytest-dev/pytest/tags","blobs_url":"https://api.github.com/repos/pytest-dev/pytest/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/pytest-dev/pytest/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/pytest-dev/pytest/git/refs{/sha}","trees_url":"https://api.github.com/repos/pytest-dev/pytest/git/trees{/sha}","statuses_url":"https://api.github.com/repos/pytest-dev/pytest/statuses/{sha}","languages_url":"https://api.github.com/repos/pytest-dev/pytest/languages","stargazers_url":"https://api.github.com/repos/pytest-dev/pytest/stargazers","contributors_url":"https://api.github.com/repos/pytest-dev/pytest/contributors","subscribers_url":"https://api.github.com/repos/pytest-dev/pytest/subscribers","subscription_url":"https://api.github.com/repos/pytest-dev/pytest/subscription","commits_url":"https://api.github.com/repos/pytest-dev/pytest/commits{/sha}","git_commits_url":"https://api.github.com/repos/pytest-dev/pytest/git/commits{/sha}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/comments{/number}","issue_comment_url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments{/number}","contents_url":"https://api.github.com/repos/pytest-dev/pytest/contents/{+path}","compare_url":"https://api.github.com/repos/pytest-dev/pytest/compare/{base}...{head}","merges_url":"https://api.github.com/repos/pytest-dev/pytest/merges","archive_url":"https://api.github.com/repos/pytest-dev/pytest/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/pytest-dev/pytest/downloads","issues_url":"https://api.github.com/repos/pytest-dev/pytest/issues{/number}","pulls_url":"https://api.github.com/repos/pytest-dev/pytest/pulls{/number}","milestones_url":"https://api.github.com/repos/pytest-dev/pytest/milestones{/number}","notifications_url":"https://api.github.com/repos/pytest-dev/pytest/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/pytest-dev/pytest/labels{/name}","releases_url":"https://api.github.com/repos/pytest-dev/pytest/releases{/id}","deployments_url":"https://api.github.com/repos/pytest-dev/pytest/deployments","created_at":"2015-06-15T20:28:27Z","updated_at":"2025-11-09T16:32:44Z","pushed_at":"2025-11-09T09:33:29Z","git_url":"git://github.com/pytest-dev/pytest.git","ssh_url":"git@github.com:pytest-dev/pytest.git","clone_url":"https://github.com/pytest-dev/pytest.git","svn_url":"https://github.com/pytest-dev/pytest","homepage":"https://pytest.org","size":37842,"stargazers_count":13254,"watchers_count":13254,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":2933,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":953,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","python","test","testing","unit-testing"],"visibility":"public","forks":2933,"open_issues":953,"watchers":13254,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"The sun has long set, but I'm still sitting in my chair after all the hours fighting with PyTest. PyTest surely is magical, but when the magic does not work as intended, it can drive you mad like a company's \"voice assistant\" that does not help you, but also does not let you talk to a human. Sometimes I really long for Python's unittest way of doing what the user asks.\r\n\r\nOur tests system is complex. Everything happens remotely. I'm not running pytest, the system does. The system runs pytest program and allows me to specify CLI args.\r\n\r\nHere is our dir structure\r\n\r\n```\r\nthird_party/\r\nâ”œâ”€ databricks_cli/\r\nâ”‚  â”œâ”€ __init__.py\r\nâ”‚  â”œâ”€ ...\r\nâ”‚  â”œâ”€ tests/\r\nâ”‚  â”‚  â”œâ”€ __init__.py\r\nâ”‚  â”‚  â”œâ”€ conftest.py\r\nâ”‚  â”‚  â”œâ”€ utils.py\r\nâ”‚  â”‚  â”œâ”€ group_foo/\r\nâ”‚  â”‚  â”‚  â”œâ”€ __init__.py\r\nâ”‚  â”‚  â”‚  â”œâ”€ test_foo.py\r\n```\r\n\r\n`test_foo.py`:\r\n```\r\nfrom tests import utils\r\nE   ModuleNotFoundError: No module named 'tests'\r\n```\r\n\r\nAlso\r\n```\r\n    from tests import conftest\r\nE   ModuleNotFoundError: No module named 'tests'\r\n```\r\n\r\nAlso\r\n```\r\n    import conftest\r\nE   ModuleNotFoundError: No module named 'conftest'\r\n```\r\n\r\n\r\nWhen I do the equivalent of `cd \"third_party/databricks_cli\" && pytest`, the `sys.path` only has `third_party`, not `third_party/databricks_cli`.\r\n\r\nWhen I do the equivalent of `cd \"third_party/databricks_cli/tests\" && pytest`, the `sys.path` only has `third_party`, not `third_party/databricks_cli`.\r\n\r\n\r\n`unittest` has `--start-directory` and `--top-level-directory` and changing them results in actual changes.\r\n\r\nWherever I run, there are only walls.\r\nI know that using `python -m pytest` instead of `pytest` would solve the issue. But I cannot replace the `pytest`  command executable.\r\nI see people trying to use `rootdir` to affect `sys.path`. The documentation now tells in bold letters that's wrong. https://github.com/pytest-dev/pytest/issues/4594\r\nI was hopeful when I saw that a PR added a `pythonpath` option. https://github.com/pytest-dev/pytest/pull/9134 I tried `pytest --override-ini='pythonpath=foo'`, but this option is not really working for me and some other users: https://github.com/pytest-dev/pytest/issues/11311 And it looks like `pythonpath` is not really `PYTHONPATH`. Back to square one.\r\n\r\nI feel powerless. There seems to be nothing I can do to change the PyTests's `sys.path` behaviors.\r\n\r\nA simple thing. Adding current directory to `sys.path`. Impossible.\r\n\r\nI'm sad and tired. Thank you for listening. You can close this bug as \"works as intended\" now.\r\n","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11960/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11960/timeline","performed_via_github_app":null,"state_reason":"not_planned"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1938281189","html_url":"https://github.com/pytest-dev/pytest/issues/11475#issuecomment-1938281189","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11475","id":1938281189,"node_id":"IC_kwDOAjwLdc5zh9Ll","user":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-12T09:10:38Z","updated_at":"2024-02-12T09:11:48Z","body":"Maybe I missed it when reading your summary, but isnâ€™t my PR a simple and safe solution?\r\n\r\nIt gets rid of this iffy strategy:\r\n\r\n> Try to come up with a \"module name\" for it based on its full path and root, so for the file tests/foo/bar/test_foo.py we make up an non-existing module name \"tests.foo.bar.test_foo\".\r\n\r\nwhenever some module *does* live below one of the `sys.path` entries.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1938281189/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"flying-sheep","id":291575,"node_id":"MDQ6VXNlcjI5MTU3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/291575?v=4","gravatar_id":"","url":"https://api.github.com/users/flying-sheep","html_url":"https://github.com/flying-sheep","followers_url":"https://api.github.com/users/flying-sheep/followers","following_url":"https://api.github.com/users/flying-sheep/following{/other_user}","gists_url":"https://api.github.com/users/flying-sheep/gists{/gist_id}","starred_url":"https://api.github.com/users/flying-sheep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flying-sheep/subscriptions","organizations_url":"https://api.github.com/users/flying-sheep/orgs","repos_url":"https://api.github.com/users/flying-sheep/repos","events_url":"https://api.github.com/users/flying-sheep/events{/privacy}","received_events_url":"https://api.github.com/users/flying-sheep/received_events","type":"User","user_view_type":"public","site_admin":false}}]