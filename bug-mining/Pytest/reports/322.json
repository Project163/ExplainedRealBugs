{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/6267","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6267/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6267/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6267/events","html_url":"https://github.com/pytest-dev/pytest/issues/6267","id":527639244,"node_id":"MDU6SXNzdWU1Mjc2MzkyNDQ=","number":6267,"title":"Avoid truncation when it makes the output longer","user":{"login":"douglasbagnall","id":131030,"node_id":"MDQ6VXNlcjEzMTAzMA==","avatar_url":"https://avatars.githubusercontent.com/u/131030?v=4","gravatar_id":"","url":"https://api.github.com/users/douglasbagnall","html_url":"https://github.com/douglasbagnall","followers_url":"https://api.github.com/users/douglasbagnall/followers","following_url":"https://api.github.com/users/douglasbagnall/following{/other_user}","gists_url":"https://api.github.com/users/douglasbagnall/gists{/gist_id}","starred_url":"https://api.github.com/users/douglasbagnall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/douglasbagnall/subscriptions","organizations_url":"https://api.github.com/users/douglasbagnall/orgs","repos_url":"https://api.github.com/users/douglasbagnall/repos","events_url":"https://api.github.com/users/douglasbagnall/events{/privacy}","received_events_url":"https://api.github.com/users/douglasbagnall/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849195,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTU=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20enhancement","name":"type: enhancement","color":"84b6eb","default":false,"description":"new feature or API change, should be merged into features branch"},{"id":702619195,"node_id":"MDU6TGFiZWw3MDI2MTkxOTU=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20rewrite","name":"topic: rewrite","color":"0e8a16","default":false,"description":"related to the assertion rewrite mechanism"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-11-24T02:27:44Z","updated_at":"2022-12-17T13:24:47Z","closed_at":"2022-12-17T13:24:47Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Pytest version 3.10.1, also seen on Ubuntu 19.04:\r\n\r\nWith `-v`, when the output of a failure is close to the truncation limit, verbosity is *increased*, and the extra words are not useful. In short, this:\r\n\r\n```\r\n$ py.test-3 -v | wc\r\n     60     269    3287\r\n$ py.test-3 -vv | wc\r\n     59     272    3292\r\n```\r\nIn addition the  truncation message is misleading in the number of truncated lines. With `-v`:\r\n\r\n```\r\nE       assert b'<!DOCTYPE H...cation.</p>\\n' == b'{}'\r\nE         At index 0 diff: 60 != 123\r\nE         Left contains more items, first extra item: 68\r\nE         Full diff:\r\nE         + b'{}'\r\nE         - (b'<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\\n<title>500 Inter'\r\nE         -  b'nal Server Error</title>\\n<h1>Internal Server Error</h1>\\n<p>The server en'\r\nE         -  b'countered an internal error and was unable to complete your request.  Either'...\r\nE         \r\nE         ...Full output truncated (2 lines hidden), use '-vv' to show\r\n```\r\n\r\nWith `-vv`:\r\n\r\n```\r\nE       assert b'<!DOCTYPE H...cation.</p>\\n' == b'{}'\r\nE         At index 0 diff: 60 != 123\r\nE         Left contains more items, first extra item: 68\r\nE         Full diff:\r\nE         + b'{}'\r\nE         - (b'<!DOCTYPE HTML PUBLIC \"-//W3C//DTD HTML 3.2 Final//EN\">\\n<title>500 Inter'\r\nE         -  b'nal Server Error</title>\\n<h1>Internal Server Error</h1>\\n<p>The server en'\r\nE         -  b'countered an internal error and was unable to complete your request.  Either'\r\nE         -  b' the server is overloaded or there is an error in the application.</p>\\n')\r\n```\r\n\r\nThat looks *one* extra line to me, not two. Possibly lines are counted by splitting on `\\n`, and the message has a terminating `\\n`, technically leaving an empty line at the end -- but this empty line is not shown in the `-vv` output.\r\n\r\nit would be better for pytest to print the one line of error, rather than the two lines making an inaccurate claim about the truncation.\r\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/6267/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6267/timeline","performed_via_github_app":null,"state_reason":"completed"}