{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/5202","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5202/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5202/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5202/events","html_url":"https://github.com/pytest-dev/pytest/issues/5202","id":440065100,"node_id":"MDU6SXNzdWU0NDAwNjUxMDA=","number":5202,"title":"Invalid XML schema for <properties> tags in JUnit reports ","user":{"login":"danilomendesdias","id":18462435,"node_id":"MDQ6VXNlcjE4NDYyNDM1","avatar_url":"https://avatars.githubusercontent.com/u/18462435?v=4","gravatar_id":"","url":"https://api.github.com/users/danilomendesdias","html_url":"https://github.com/danilomendesdias","followers_url":"https://api.github.com/users/danilomendesdias/followers","following_url":"https://api.github.com/users/danilomendesdias/following{/other_user}","gists_url":"https://api.github.com/users/danilomendesdias/gists{/gist_id}","starred_url":"https://api.github.com/users/danilomendesdias/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danilomendesdias/subscriptions","organizations_url":"https://api.github.com/users/danilomendesdias/orgs","repos_url":"https://api.github.com/users/danilomendesdias/repos","events_url":"https://api.github.com/users/danilomendesdias/events{/privacy}","received_events_url":"https://api.github.com/users/danilomendesdias/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":530707992,"node_id":"MDU6TGFiZWw1MzA3MDc5OTI=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20junitxml","name":"plugin: junitxml","color":"c5def5","default":false,"description":"related to the junitxml builtin plugin"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-05-03T14:12:49Z","updated_at":"2019-05-11T16:27:27Z","closed_at":"2019-05-11T16:27:27Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The problem:\r\n\r\nJUnit breaks when it reads an XML generated by pytest if plugins make use of  `record-property`. This behavior happens with newer versions of  hypothesis (https://github.com/HypothesisWorks/hypothesis/issues/1935).\r\n\r\n```\r\n[xUnit] [ERROR] - The result file '/somewhere/tests/pytests.xml' for the metric 'JUnit' is not valid. The result file has been skipped.\r\n```\r\n\r\nIn fact, as already mentioned in https://github.com/pytest-dev/pytest/issues/1126#issuecomment-484581283,  `record-property` is adding `<properties>` inside `<testcase>` which seems to be wrong (it should be inside `<testsuite>`). See: https://github.com/windyroad/JUnit-Schema/blob/master/JUnit.xsd .\r\n\r\nIt happens with all junit families.\r\n\r\nReproducing:\r\n\r\n```\r\n$ pip list\r\nPackage        Version \r\n-------------- --------\r\napipkg         1.5     \r\natomicwrites   1.3.0   \r\nattrs          19.1.0  \r\ncertifi        2019.3.9\r\nexecnet        1.6.0   \r\nhypothesis     4.18.3  \r\nmore-itertools 4.3.0   \r\npip            19.1    \r\npluggy         0.9.0   \r\npy             1.8.0   \r\npytest         4.4.1   \r\npytest-forked  1.0.2   \r\npytest-xdist   1.28.0  \r\nsetuptools     41.0.1  \r\nsix            1.12.0  \r\nwheel          0.33.1 \r\n```\r\n\r\n`test_xml_generation.py`\r\n```\r\nfrom hypothesis import given, strategies\r\n\r\n\r\n@given(x=strategies.integers(1, 10,))\r\ndef test_xml_generation(x):\r\n    assert 1 <= x <= 10\r\n```\r\n\r\n```\r\n$ pytest --junitxml=report.xml\r\n```\r\n\r\n`report.xml`\r\n```\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<testsuite errors=\"0\" failures=\"0\" name=\"pytest\" skipped=\"0\" tests=\"1\" time=\"0.211\">\r\n    <testcase classname=\"test_xml_generation\" file=\"test_xml_generation.py\" line=\"3\" name=\"test_xml_generation\"\r\n              time=\"0.074\">\r\n        <properties>\r\n            <property name=\"hypothesis-stats\"\r\n                      value=\"[&apos;test_xml_generation.py::test_xml_generation:&apos;, &apos;&apos;, &apos;  - 100 passing examples, 0 failing examples, 0 invalid examples&apos;, &apos;  - Typical runtimes: &lt; 1ms&apos;, &apos;  - Fraction of time spent in data generation: ~ 49%&apos;, &apos;  - Stopped because settings.max_examples=100&apos;, &apos;&apos;]\"/>\r\n        </properties>\r\n    </testcase>\r\n</testsuite>\r\n```\r\n\r\nI was trying to create a PR to fix this, but when I saw https://github.com/pytest-dev/pytest/blob/7dcd9bf5add337686ec6f2ee81b24e8424319dba/src/_pytest/junitxml.py code I realized that what is needed to do could have more implications that I though. I think that nobody uses this feature with JUnit (as it breaks) and removing that is something to think about.\r\n\r\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/5202/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5202/timeline","performed_via_github_app":null,"state_reason":"completed"}