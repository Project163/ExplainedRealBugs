{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13530","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13530/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13530/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13530/events","html_url":"https://github.com/pytest-dev/pytest/issues/13530","id":3153749714,"node_id":"I_kwDOAjwLdc67-mbS","number":13530,"title":"pytest.approx(Decimal(...)) Causes decimal.FloatOperation in __repr__ (pytest 8.4.0+)","user":{"login":"rishid","id":197948,"node_id":"MDQ6VXNlcjE5Nzk0OA==","avatar_url":"https://avatars.githubusercontent.com/u/197948?v=4","gravatar_id":"","url":"https://api.github.com/users/rishid","html_url":"https://github.com/rishid","followers_url":"https://api.github.com/users/rishid/followers","following_url":"https://api.github.com/users/rishid/following{/other_user}","gists_url":"https://api.github.com/users/rishid/gists{/gist_id}","starred_url":"https://api.github.com/users/rishid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rishid/subscriptions","organizations_url":"https://api.github.com/users/rishid/orgs","repos_url":"https://api.github.com/users/rishid/repos","events_url":"https://api.github.com/users/rishid/events{/privacy}","received_events_url":"https://api.github.com/users/rishid/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2025-06-17T14:37:29Z","updated_at":"2025-06-22T16:41:17Z","closed_at":"2025-06-22T16:41:17Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"pytest.approx() with decimal.Decimal objects triggers a decimal.FloatOperation error when the ApproxDecimal object's __repr__ method is called (e.g., during print() or assertion formatting).\n\nThis happens because ApproxDecimal.__repr__ compares its Decimal tolerance with hardcoded float literals (like 1e-3, 1e3). When the decimal context traps FloatOperations (to maintain Decimal precision), these implicit float-Decimal comparisons raise an error.\n\nThis issue started with pytest version 8.4.0 and seems related to changes from [Issue #13010](https://github.com/pytest-dev/pytest/issues/13010).\n\nPytest 8.4.0\nPython 3.13.2\nUbuntu 24.04 LTS\n\n```python\n# test_decimal_approx.py\nimport decimal\n\nimport pytest\n\ndecimal.getcontext().traps[decimal.FloatOperation] = True\n\n\ndef test_decimal_approx_repr_issue():\n    \"\"\"Reproduces the decimal.FloatOperation error from pytest.approx(Decimal)'s repr.\"\"\"\n    approx_obj = pytest.approx(decimal.Decimal(\"2.60\"))\n    print(f\"Attempting to represent pytest.approx(Decimal): {approx_obj}\")  # Triggers the bug\n    assert decimal.Decimal(\"2.600001\") == approx_obj\n\n\n# You can run this test with:\n# python -m pytest test_decimal_approx.py\n```\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13530/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13530/timeline","performed_via_github_app":null,"state_reason":"completed"}