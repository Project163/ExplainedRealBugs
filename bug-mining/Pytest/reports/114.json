{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3456","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3456/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3456/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3456/events","html_url":"https://github.com/pytest-dev/pytest/issues/3456","id":321179300,"node_id":"MDU6SXNzdWUzMjExNzkzMDA=","number":3456,"title":"`--doctest-modules` causes `py.test` to consume all memory and then crash","user":{"login":"tadams42","id":664505,"node_id":"MDQ6VXNlcjY2NDUwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/664505?v=4","gravatar_id":"","url":"https://api.github.com/users/tadams42","html_url":"https://github.com/tadams42","followers_url":"https://api.github.com/users/tadams42/followers","following_url":"https://api.github.com/users/tadams42/following{/other_user}","gists_url":"https://api.github.com/users/tadams42/gists{/gist_id}","starred_url":"https://api.github.com/users/tadams42/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tadams42/subscriptions","organizations_url":"https://api.github.com/users/tadams42/orgs","repos_url":"https://api.github.com/users/tadams42/repos","events_url":"https://api.github.com/users/tadams42/events{/privacy}","received_events_url":"https://api.github.com/users/tadams42/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":240592808,"node_id":"MDU6TGFiZWwyNDA1OTI4MDg=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20doctests","name":"plugin: doctests","color":"fad8c7","default":false,"description":"related to the doctests builtin plugin"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2018-05-08T13:09:09Z","updated_at":"2019-01-10T21:13:46Z","closed_at":"2019-01-10T21:13:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"WARNING: Please don't run code sample from below, it can block / crash your machine. Instead, use Vagrant machine for testing it. \r\n\r\nSo, on Ubuntu 17.10 , Python 3.6:\r\n\r\n~~~sh\r\nmkdir foobar\r\ncd foobar\r\nmkdir src\r\nmkdir tests\r\nmkdir docs\r\npython3 -mvenv .venv\r\nsource .venv/bin/activate\r\npip install -U pip wheel\r\npip install \"pytest>=3.0.0\"\r\n\r\ncat <<EOT > setup.cfg\r\n[tool:pytest]\r\nnorecursedirs = .git tmp* .hg .venv .tox .eggs\r\ntestpaths = tests docs src\r\naddopts =\r\n    -r=xEfsw\r\n    --strict\r\n    --ignore=docs/conf.py\r\n    --ignore=setup.py\r\n    --ignore=.eggs\r\n    --doctest-modules\r\n    --doctest-glob=*.rst\r\n    --tb=short\r\n    --color=auto\r\nEOT\r\n\r\necho \"from unittest.mock import Mock, call\" > tests/test_with_mock_package.py\r\n~~~\r\n\r\nRunning `py.test` will cause it to consume all RAM it can get and then either kernel will kill it or system will start swapping wildly until it blocks completely.\r\n\r\nTo make above thing work:\r\n\r\n~~~diff\r\n--- setup.cfg   2018-05-08 13:03:47.058679203 +0000\r\n+++ setup.cfg.new       2018-05-08 13:09:46.650678324 +0000\r\n@@ -7,7 +7,7 @@\r\n     --ignore=docs/conf.py\r\n     --ignore=setup.py\r\n     --ignore=.eggs\r\n-    --doctest-modules\r\n+    # --doctest-modules\r\n     --doctest-glob=*.rst\r\n     --tb=short\r\n     --color=auto\r\n~~~\r\n\r\nAfter which:\r\n\r\n~~~\r\n$ py.test\r\n============================================================ test session starts ============================================================\r\nplatform linux -- Python 3.6.3, pytest-3.5.1, py-1.5.3, pluggy-0.6.0\r\nrootdir: /home/vagrant/foobar, inifile: setup.cfg\r\ncollected 0 items\r\n\r\n======================================================= no tests ran in 0.01 seconds ========================================================\r\n~~~","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3456/timeline","performed_via_github_app":null,"state_reason":"completed"}