[{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1505555231","html_url":"https://github.com/pytest-dev/pytest/issues/10903#issuecomment-1505555231","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10903","id":1505555231,"node_id":"IC_kwDOAjwLdc5ZvPMf","user":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T16:12:16Z","updated_at":"2023-04-12T16:12:16Z","body":"As discussed in the linked discussion, this is a regression from PR #10772.\r\n\r\nThis issue can be reduced to the following:\r\n\r\n```py\r\ndef test():\r\n    __tracebackhide__ = True\r\n    1 / 0\r\n```\r\n\r\nthis crashes with `INTERNALERROR> IndexError: list index out of range` as reported above.\r\n\r\nThe code handling exception formatting is definitely broken in how it handles `__cause__`/`__context__` exceptions. The \"main\" exception goes through the Node `_prunetraceback` code, which then passes `tbfilter=False` because it's \"pruned already\", but that neglects the chained exceptions entirely.\r\n\r\nThe way #10772 handled it is to use `getcrashentry()` being None as a proxy for omitting the exception. I don't believe this is the correct way to do it, instead we need to have the main and chained exceptions go through the same pruning code so that everything is consistent.\r\n\r\nFurther, we need to decide what *should* happen in the reproduction above, where *all* frames in the exception are hidden -- do we show the top frame anyway (status quo), show some special message, or just show nothing?\r\n\r\nFor now, I am going to send a PR reverting 431ec6d34ef99d80f90b330876ed6231144a3ce7 because whatever the fix is, it's not going to be very simple and should go into the next feature release.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1505555231/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8987603849,"node_id":"REFE_lADOAjwLdc5jOtcOzwAAAAIXs_OJ","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/8987603849","actor":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"90412827c3c87ceb1a903743110f0b892f13feec","commit_url":"https://api.github.com/repos/bluetech/pytest/commits/90412827c3c87ceb1a903743110f0b892f13feec","created_at":"2023-04-12T16:24:07Z","performed_via_github_app":null},{"actor":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T16:24:43Z","updated_at":"2023-04-12T16:24:43Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/10904","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10904/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10904/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10904/events","html_url":"https://github.com/pytest-dev/pytest/pull/10904","id":1664872450,"node_id":"PR_kwDOAjwLdc5OJoXk","number":10904,"title":"Revert \"Correctly handle tracebackhide for chained exceptions (#10772)\"","user":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-04-12T16:24:43Z","updated_at":"2023-04-13T12:26:29Z","closed_at":"2023-04-13T11:51:58Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":37489525,"node_id":"MDEwOlJlcG9zaXRvcnkzNzQ4OTUyNQ==","name":"pytest","full_name":"pytest-dev/pytest","private":false,"owner":{"login":"pytest-dev","id":8897583,"node_id":"MDEyOk9yZ2FuaXphdGlvbjg4OTc1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/8897583?v=4","gravatar_id":"","url":"https://api.github.com/users/pytest-dev","html_url":"https://github.com/pytest-dev","followers_url":"https://api.github.com/users/pytest-dev/followers","following_url":"https://api.github.com/users/pytest-dev/following{/other_user}","gists_url":"https://api.github.com/users/pytest-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/pytest-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pytest-dev/subscriptions","organizations_url":"https://api.github.com/users/pytest-dev/orgs","repos_url":"https://api.github.com/users/pytest-dev/repos","events_url":"https://api.github.com/users/pytest-dev/events{/privacy}","received_events_url":"https://api.github.com/users/pytest-dev/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/pytest-dev/pytest","description":"The pytest framework makes it easy to write small tests, yet scales to support complex functional testing","fork":false,"url":"https://api.github.com/repos/pytest-dev/pytest","forks_url":"https://api.github.com/repos/pytest-dev/pytest/forks","keys_url":"https://api.github.com/repos/pytest-dev/pytest/keys{/key_id}","collaborators_url":"https://api.github.com/repos/pytest-dev/pytest/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/pytest-dev/pytest/teams","hooks_url":"https://api.github.com/repos/pytest-dev/pytest/hooks","issue_events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/events{/number}","events_url":"https://api.github.com/repos/pytest-dev/pytest/events","assignees_url":"https://api.github.com/repos/pytest-dev/pytest/assignees{/user}","branches_url":"https://api.github.com/repos/pytest-dev/pytest/branches{/branch}","tags_url":"https://api.github.com/repos/pytest-dev/pytest/tags","blobs_url":"https://api.github.com/repos/pytest-dev/pytest/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/pytest-dev/pytest/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/pytest-dev/pytest/git/refs{/sha}","trees_url":"https://api.github.com/repos/pytest-dev/pytest/git/trees{/sha}","statuses_url":"https://api.github.com/repos/pytest-dev/pytest/statuses/{sha}","languages_url":"https://api.github.com/repos/pytest-dev/pytest/languages","stargazers_url":"https://api.github.com/repos/pytest-dev/pytest/stargazers","contributors_url":"https://api.github.com/repos/pytest-dev/pytest/contributors","subscribers_url":"https://api.github.com/repos/pytest-dev/pytest/subscribers","subscription_url":"https://api.github.com/repos/pytest-dev/pytest/subscription","commits_url":"https://api.github.com/repos/pytest-dev/pytest/commits{/sha}","git_commits_url":"https://api.github.com/repos/pytest-dev/pytest/git/commits{/sha}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/comments{/number}","issue_comment_url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments{/number}","contents_url":"https://api.github.com/repos/pytest-dev/pytest/contents/{+path}","compare_url":"https://api.github.com/repos/pytest-dev/pytest/compare/{base}...{head}","merges_url":"https://api.github.com/repos/pytest-dev/pytest/merges","archive_url":"https://api.github.com/repos/pytest-dev/pytest/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/pytest-dev/pytest/downloads","issues_url":"https://api.github.com/repos/pytest-dev/pytest/issues{/number}","pulls_url":"https://api.github.com/repos/pytest-dev/pytest/pulls{/number}","milestones_url":"https://api.github.com/repos/pytest-dev/pytest/milestones{/number}","notifications_url":"https://api.github.com/repos/pytest-dev/pytest/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/pytest-dev/pytest/labels{/name}","releases_url":"https://api.github.com/repos/pytest-dev/pytest/releases{/id}","deployments_url":"https://api.github.com/repos/pytest-dev/pytest/deployments","created_at":"2015-06-15T20:28:27Z","updated_at":"2025-11-09T16:32:44Z","pushed_at":"2025-11-09T09:33:29Z","git_url":"git://github.com/pytest-dev/pytest.git","ssh_url":"git@github.com:pytest-dev/pytest.git","clone_url":"https://github.com/pytest-dev/pytest.git","svn_url":"https://github.com/pytest-dev/pytest","homepage":"https://pytest.org","size":37842,"stargazers_count":13254,"watchers_count":13254,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":2933,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":953,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest","python","test","testing","unit-testing"],"visibility":"public","forks":2933,"open_issues":953,"watchers":13254,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/pytest-dev/pytest/pulls/10904","html_url":"https://github.com/pytest-dev/pytest/pull/10904","diff_url":"https://github.com/pytest-dev/pytest/pull/10904.diff","patch_url":"https://github.com/pytest-dev/pytest/pull/10904.patch","merged_at":"2023-04-13T11:51:58Z"},"body":"This reverts commit 431ec6d34ef99d80f90b330876ed6231144a3ce7.\r\n\r\nFix #10903.\r\nReopen #1904.\r\n\r\n<!--\r\nThanks for submitting a PR, your contribution is really appreciated!\r\n\r\nHere is a quick checklist that should be present in PRs.\r\n\r\n- [ ] Include documentation when adding new features.\r\n- [ ] Include new tests or update existing tests when applicable.\r\n- [X] Allow maintainers to push and squash when merging my commits. Please uncheck this if you prefer to squash the commits yourself.\r\n\r\nIf this change fixes an issue, please:\r\n\r\n- [ ] Add text like ``closes #XYZW`` to the PR description and/or commits (where ``XYZW`` is the issue number). See the [github docs](https://help.github.com/en/github/managing-your-work-on-github/linking-a-pull-request-to-an-issue#linking-a-pull-request-to-an-issue-using-a-keyword) for more information.\r\n\r\nUnless your change is trivial or a small documentation fix (e.g., a typo or reword of a small section) please:\r\n\r\n- [ ] Create a new changelog file in the `changelog` folder, with a name like `<ISSUE NUMBER>.<TYPE>.rst`. See [changelog/README.rst](https://github.com/pytest-dev/pytest/blob/main/changelog/README.rst) for details.\r\n\r\n  Write sentences in the **past or present tense**, examples:\r\n\r\n  * *Improved verbose diff output with sequences.*\r\n  * *Terminal summary statistics now use multiple colors.*\r\n\r\n  Also make sure to end the sentence with a `.`.\r\n\r\n- [ ] Add yourself to `AUTHORS` in alphabetical order.\r\n-->\r\n","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/10904/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10904/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1505771103","html_url":"https://github.com/pytest-dev/pytest/issues/10903#issuecomment-1505771103","issue_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10903","id":1505771103,"node_id":"IC_kwDOAjwLdc5ZwD5f","user":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T18:55:06Z","updated_at":"2023-04-12T18:55:06Z","body":"Also relevant: accd962c9f88dbd5b2b0eef6efe7bf6fe5444b29 issue #1604","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/comments/1505771103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8995993251,"node_id":"CE_lADOAjwLdc5jOtcOzwAAAAIYM_aj","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/8995993251","actor":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2023-04-13T11:51:59Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"Xyphenore","id":53941443,"node_id":"MDQ6VXNlcjUzOTQxNDQz","avatar_url":"https://avatars.githubusercontent.com/u/53941443?v=4","gravatar_id":"","url":"https://api.github.com/users/Xyphenore","html_url":"https://github.com/Xyphenore","followers_url":"https://api.github.com/users/Xyphenore/followers","following_url":"https://api.github.com/users/Xyphenore/following{/other_user}","gists_url":"https://api.github.com/users/Xyphenore/gists{/gist_id}","starred_url":"https://api.github.com/users/Xyphenore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xyphenore/subscriptions","organizations_url":"https://api.github.com/users/Xyphenore/orgs","repos_url":"https://api.github.com/users/Xyphenore/repos","events_url":"https://api.github.com/users/Xyphenore/events{/privacy}","received_events_url":"https://api.github.com/users/Xyphenore/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-14T18:50:04Z","updated_at":"2023-04-14T18:50:04Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/Lemmons/pytest-raises/issues/29","repository_url":"https://api.github.com/repos/Lemmons/pytest-raises","labels_url":"https://api.github.com/repos/Lemmons/pytest-raises/issues/29/labels{/name}","comments_url":"https://api.github.com/repos/Lemmons/pytest-raises/issues/29/comments","events_url":"https://api.github.com/repos/Lemmons/pytest-raises/issues/29/events","html_url":"https://github.com/Lemmons/pytest-raises/issues/29","id":1665937553,"node_id":"I_kwDOAz5um85jTDCR","number":29,"title":"Receive INTERNAL Error if no exception is thrown","user":{"login":"Xyphenore","id":53941443,"node_id":"MDQ6VXNlcjUzOTQxNDQz","avatar_url":"https://avatars.githubusercontent.com/u/53941443?v=4","gravatar_id":"","url":"https://api.github.com/users/Xyphenore","html_url":"https://github.com/Xyphenore","followers_url":"https://api.github.com/users/Xyphenore/followers","following_url":"https://api.github.com/users/Xyphenore/following{/other_user}","gists_url":"https://api.github.com/users/Xyphenore/gists{/gist_id}","starred_url":"https://api.github.com/users/Xyphenore/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xyphenore/subscriptions","organizations_url":"https://api.github.com/users/Xyphenore/orgs","repos_url":"https://api.github.com/users/Xyphenore/repos","events_url":"https://api.github.com/users/Xyphenore/events{/privacy}","received_events_url":"https://api.github.com/users/Xyphenore/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-04-13T08:11:36Z","updated_at":"2023-04-14T18:50:05Z","closed_at":"2023-04-14T18:50:04Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":54423195,"node_id":"MDEwOlJlcG9zaXRvcnk1NDQyMzE5NQ==","name":"pytest-raises","full_name":"Lemmons/pytest-raises","private":false,"owner":{"login":"Lemmons","id":2343674,"node_id":"MDQ6VXNlcjIzNDM2NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/2343674?v=4","gravatar_id":"","url":"https://api.github.com/users/Lemmons","html_url":"https://github.com/Lemmons","followers_url":"https://api.github.com/users/Lemmons/followers","following_url":"https://api.github.com/users/Lemmons/following{/other_user}","gists_url":"https://api.github.com/users/Lemmons/gists{/gist_id}","starred_url":"https://api.github.com/users/Lemmons/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lemmons/subscriptions","organizations_url":"https://api.github.com/users/Lemmons/orgs","repos_url":"https://api.github.com/users/Lemmons/repos","events_url":"https://api.github.com/users/Lemmons/events{/privacy}","received_events_url":"https://api.github.com/users/Lemmons/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/Lemmons/pytest-raises","description":"An implementation of pytest.raises as a pytest.mark fixture","fork":false,"url":"https://api.github.com/repos/Lemmons/pytest-raises","forks_url":"https://api.github.com/repos/Lemmons/pytest-raises/forks","keys_url":"https://api.github.com/repos/Lemmons/pytest-raises/keys{/key_id}","collaborators_url":"https://api.github.com/repos/Lemmons/pytest-raises/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/Lemmons/pytest-raises/teams","hooks_url":"https://api.github.com/repos/Lemmons/pytest-raises/hooks","issue_events_url":"https://api.github.com/repos/Lemmons/pytest-raises/issues/events{/number}","events_url":"https://api.github.com/repos/Lemmons/pytest-raises/events","assignees_url":"https://api.github.com/repos/Lemmons/pytest-raises/assignees{/user}","branches_url":"https://api.github.com/repos/Lemmons/pytest-raises/branches{/branch}","tags_url":"https://api.github.com/repos/Lemmons/pytest-raises/tags","blobs_url":"https://api.github.com/repos/Lemmons/pytest-raises/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/Lemmons/pytest-raises/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/Lemmons/pytest-raises/git/refs{/sha}","trees_url":"https://api.github.com/repos/Lemmons/pytest-raises/git/trees{/sha}","statuses_url":"https://api.github.com/repos/Lemmons/pytest-raises/statuses/{sha}","languages_url":"https://api.github.com/repos/Lemmons/pytest-raises/languages","stargazers_url":"https://api.github.com/repos/Lemmons/pytest-raises/stargazers","contributors_url":"https://api.github.com/repos/Lemmons/pytest-raises/contributors","subscribers_url":"https://api.github.com/repos/Lemmons/pytest-raises/subscribers","subscription_url":"https://api.github.com/repos/Lemmons/pytest-raises/subscription","commits_url":"https://api.github.com/repos/Lemmons/pytest-raises/commits{/sha}","git_commits_url":"https://api.github.com/repos/Lemmons/pytest-raises/git/commits{/sha}","comments_url":"https://api.github.com/repos/Lemmons/pytest-raises/comments{/number}","issue_comment_url":"https://api.github.com/repos/Lemmons/pytest-raises/issues/comments{/number}","contents_url":"https://api.github.com/repos/Lemmons/pytest-raises/contents/{+path}","compare_url":"https://api.github.com/repos/Lemmons/pytest-raises/compare/{base}...{head}","merges_url":"https://api.github.com/repos/Lemmons/pytest-raises/merges","archive_url":"https://api.github.com/repos/Lemmons/pytest-raises/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/Lemmons/pytest-raises/downloads","issues_url":"https://api.github.com/repos/Lemmons/pytest-raises/issues{/number}","pulls_url":"https://api.github.com/repos/Lemmons/pytest-raises/pulls{/number}","milestones_url":"https://api.github.com/repos/Lemmons/pytest-raises/milestones{/number}","notifications_url":"https://api.github.com/repos/Lemmons/pytest-raises/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/Lemmons/pytest-raises/labels{/name}","releases_url":"https://api.github.com/repos/Lemmons/pytest-raises/releases{/id}","deployments_url":"https://api.github.com/repos/Lemmons/pytest-raises/deployments","created_at":"2016-03-21T21:13:49Z","updated_at":"2022-07-05T14:11:39Z","pushed_at":"2023-09-29T23:02:55Z","git_url":"git://github.com/Lemmons/pytest-raises.git","ssh_url":"git@github.com:Lemmons/pytest-raises.git","clone_url":"https://github.com/Lemmons/pytest-raises.git","svn_url":"https://github.com/Lemmons/pytest-raises","homepage":"","size":56,"stargazers_count":19,"watchers_count":19,"language":"Python","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":8,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":4,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":8,"open_issues":4,"watchers":19,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Hello, good plugin, I like it.\r\nI have an INTERNAL ERROR with pytest 7.2.2 - 7.3.0 with the plugin pytest-raises.\r\n\r\nIf I decorate a test with '@pytest.mark.raises(exception=Exception)', where Exception can be any type of exception.\r\nIf this test finishes without raising an exception, pytest prints **INTERNAL ERROR** and **stop** the execution with code 3.\r\n\r\nA basic example of broken test\r\n```python\r\nimport pytest\r\n\r\n@pytest.mark.raises(exception=Exception)\r\ndef test_not_raises_exception() -> None:\r\n    assert True\r\n```\r\n\r\n<details>\r\n    <summary>Traceback</summary>\r\n\r\n```\r\nINTERNALERROR> Traceback (most recent call last):\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/main.py\", line 269, in wrap_session\r\nINTERNALERROR>     session.exitstatus = doit(config, session) or 0\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/main.py\", line 323, in _main\r\nINTERNALERROR>     config.hook.pytest_runtestloop(session=session)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_hooks.py\", line 265, in __call__\r\nINTERNALERROR>     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_manager.py\", line 80, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_callers.py\", line 60, in _multicall\r\nINTERNALERROR>     return outcome.get_result()\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_result.py\", line 60, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_callers.py\", line 39, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/main.py\", line 348, in pytest_runtestloop\r\nINTERNALERROR>     item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_hooks.py\", line 265, in __call__\r\nINTERNALERROR>     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_manager.py\", line 80, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_callers.py\", line 60, in _multicall\r\nINTERNALERROR>     return outcome.get_result()\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_result.py\", line 60, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_callers.py\", line 39, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/runner.py\", line 114, in pytest_runtest_protocol\r\nINTERNALERROR>     runtestprotocol(item, nextitem=nextitem)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/runner.py\", line 133, in runtestprotocol\r\nINTERNALERROR>     reports.append(call_and_report(item, \"call\", log))\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/runner.py\", line 224, in call_and_report\r\nINTERNALERROR>     report: TestReport = hook.pytest_runtest_makereport(item=item, call=call)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_hooks.py\", line 265, in __call__\r\nINTERNALERROR>     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_manager.py\", line 80, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_callers.py\", line 55, in _multicall\r\nINTERNALERROR>     gen.send(outcome)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/skipping.py\", line 266, in pytest_runtest_makereport\r\nINTERNALERROR>     rep = outcome.get_result()\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_result.py\", line 60, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/pluggy/_callers.py\", line 39, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/runner.py\", line 368, in pytest_runtest_makereport\r\nINTERNALERROR>     return TestReport.from_item_and_call(item, call)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/reports.py\", line 363, in from_item_and_call\r\nINTERNALERROR>     longrepr = item.repr_failure(excinfo)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/python.py\", line 1833, in repr_failure\r\nINTERNALERROR>     return self._repr_failure_py(excinfo, style=style)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/nodes.py\", line 484, in _repr_failure_py\r\nINTERNALERROR>     return excinfo.getrepr(\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/_code/code.py\", line 671, in getrepr\r\nINTERNALERROR>     return fmt.repr_excinfo(self)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/_code/code.py\", line 987, in repr_excinfo\r\nINTERNALERROR>     return ExceptionChainRepr(repr_chain)\r\nINTERNALERROR>   File \"/home/xyf/test_raises/.venv/lib/python3.9/site-packages/_pytest/_code/code.py\", line 1039, in __init__\r\nINTERNALERROR>     reprtraceback=chain[-1][0],\r\nINTERNALERROR> IndexError: list index out of range\r\n\r\nProcess finished with exit code 3\r\n```\r\n\r\n</details>\r\n\r\nThe problem is present only if no exception is thrown.\r\nThen the exception raised line 84 'raise ExceptionClass(failure_message)' in '\\_pytest_raises_validation' is hidden because '\\_\\_tracebackhide\\_\\_' is True.\r\nIf in the function '\\_pytest_fail_by_mark_or_set_excinfo' '\\_\\_tracebackhide\\_\\_' is set to False, pytest does not stop the execution, but the traceback is bad.\r\n\r\n<details>\r\n    <summary>Bad Traceback</summary>\r\n\r\n```\r\nitem = <Function test_not_raises_exception>\r\noutcome = <pluggy._result._Result object at 0x7fc688f3e4f0>\r\nmarker_name = 'raises'\r\nExceptionClass = <class 'pytest_raises.pytest_raises.ExpectedException'>\r\nfailure_message = \"Expected exception <class 'Exception'>, but it did not raise\"\r\ntraceback = None\r\n\r\n    def _pytest_fail_by_mark_or_set_excinfo(item, outcome, marker_name, ExceptionClass, failure_message, traceback):\r\n        \"\"\"\r\n        Defer a test failure to a later stage, or set ``excinfo`` of ``outcome``, depending\r\n        on ``marker_name``.  This function should only be called for test items that have\r\n        failed -- the end result of calling this function for *any* ``item`` / ``outcome``\r\n        is that the test will fail.\r\n    \r\n        .. warning::\r\n    \r\n            **This is a \"private\" function not intended to be called directly by external projects!**\r\n    \r\n        Depending on the stage at which this function is called, one of two actions will\r\n        be performed:\r\n    \r\n        1. ``marker_name='setup_raises'``: a \"secret\" marker will be added to ``item``\r\n           indicating that the test failed.  This marker is then checked at a later stage\r\n           when it is safe to fail.  See documentation for :func:`_pytest_raises_validation`\r\n           for more information.\r\n        2. ``marker_name='raises'``: the ``outcome.excinfo`` will be populated with an\r\n           exception traceback that will eventually (through ``pytest``) mark the test as\r\n           failed.\r\n    \r\n        **Parameters**\r\n    \r\n        ``item``\r\n            The ``pytest`` test item, e.g., what is supplied to\r\n            ``pytest_runtest_setup(item)`` or ``pytest_runtest_call(item)``.\r\n    \r\n        ``outcome``\r\n            The ``pytest`` test outcome for the ``@pytest.hookimpl(hookwrapper=True)`` hook\r\n            wrappers, where ``outcome = yield``.\r\n    \r\n        ``marker_name``\r\n            The string marker name.  Values are **assumed** to be ``'setup_raises'`` or\r\n            ``'raises'`` **only**.\r\n    \r\n            - ``'setup_raises'``: call originates from ``pytest_runtest_setup`` hook wrapper.\r\n            - ``'raises'``: call originates from ``pytest_runtest_call`` hook wrapper.\r\n    \r\n        ``ExceptionClass``\r\n            The exception class to re-raise.  Expected to be :class:`ExpectedException` or\r\n            :class:`ExpectedMessage`, but not strictly required.\r\n    \r\n        ``failure_message``\r\n            The string failure message to mark with or re-raise, depending on the value\r\n            of ``marker_name``.\r\n    \r\n        ``traceback``\r\n            The traceback information if available, ``None`` otherwise.\r\n        \"\"\"\r\n        # pylint: disable=unused-variable\r\n        __tracebackhide__ = False\r\n        if marker_name == 'setup_raises':\r\n            # In the later stage when `fail` is called, it is nice to \"simulate\" an\r\n            # exception by putting the expected exception class's name as a prefix.\r\n            failure_message = '{}: {}'.format(ExceptionClass.__name__, failure_message)\r\n            item.add_marker(pytest.mark.setup_raises_expected_exc_or_message_not_found(failure_message))\r\n        else:  # marker_name == 'raises'\r\n            # Avoid \"while handling exception another exception occurred\" scenarios.\r\n            if issubclass(ExceptionClass, PytestRaisesUsageError):\r\n                failure_message = '{}: {}'.format(ExceptionClass.__name__, failure_message)\r\n                pytest.fail(failure_message, pytrace=False)\r\n            else:\r\n                try:\r\n>                   raise ExceptionClass(failure_message)\r\nE                   pytest_raises.pytest_raises.ExpectedException: Expected exception <class 'Exception'>, but it did not raise\r\n\r\n.venv/lib/python3.9/site-packages/pytest_raises/pytest_raises.py:84: ExpectedException\r\n\r\n```\r\n\r\n</details>\r\n\r\nI don't know how to fix this problem.\r\n\r\nI have installed this dependencies:\r\nPython = 3.9.5\r\ncoverage = \"^7.1.0\"\r\npytest = \"<8.0.0\"\r\npytest-asyncio = \"<1.0.0\"\r\npytest-cov = \"^4.0.0\"\r\npytest-raises = \"<1.0.0\"\r\npytest-xdist = {extras = [\"psutil\"], version = \"^3.2.1\"}\r\npytest-rich = \"^0.1.1\"\r\npytest-timer = \"^0.0.11\"\r\nattrs = \"^22.2.0\"","reactions":{"url":"https://api.github.com/repos/Lemmons/pytest-raises/issues/29/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/Lemmons/pytest-raises/issues/29/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":9116511765,"node_id":"REFE_lADOAjwLdc5jOtcOzwAAAAIfYu4V","url":"https://api.github.com/repos/pytest-dev/pytest/issues/events/9116511765","actor":{"login":"jaypikay","id":1150952,"node_id":"MDQ6VXNlcjExNTA5NTI=","avatar_url":"https://avatars.githubusercontent.com/u/1150952?v=4","gravatar_id":"","url":"https://api.github.com/users/jaypikay","html_url":"https://github.com/jaypikay","followers_url":"https://api.github.com/users/jaypikay/followers","following_url":"https://api.github.com/users/jaypikay/following{/other_user}","gists_url":"https://api.github.com/users/jaypikay/gists{/gist_id}","starred_url":"https://api.github.com/users/jaypikay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaypikay/subscriptions","organizations_url":"https://api.github.com/users/jaypikay/orgs","repos_url":"https://api.github.com/users/jaypikay/repos","events_url":"https://api.github.com/users/jaypikay/events{/privacy}","received_events_url":"https://api.github.com/users/jaypikay/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5c5ca77fb46ee0194200fa532e1b25e974de0ffb","commit_url":"https://api.github.com/repos/jaypikay/doxy/commits/5c5ca77fb46ee0194200fa532e1b25e974de0ffb","created_at":"2023-04-27T16:14:16Z","performed_via_github_app":null}]