{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3539","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3539/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3539/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3539/events","html_url":"https://github.com/pytest-dev/pytest/issues/3539","id":329533842,"node_id":"MDU6SXNzdWUzMjk1MzM4NDI=","number":3539,"title":"Reload does not work with assertion rewritten modules","user":{"login":"iwanb","id":4035835,"node_id":"MDQ6VXNlcjQwMzU4MzU=","avatar_url":"https://avatars.githubusercontent.com/u/4035835?v=4","gravatar_id":"","url":"https://api.github.com/users/iwanb","html_url":"https://github.com/iwanb","followers_url":"https://api.github.com/users/iwanb/followers","following_url":"https://api.github.com/users/iwanb/following{/other_user}","gists_url":"https://api.github.com/users/iwanb/gists{/gist_id}","starred_url":"https://api.github.com/users/iwanb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iwanb/subscriptions","organizations_url":"https://api.github.com/users/iwanb/orgs","repos_url":"https://api.github.com/users/iwanb/repos","events_url":"https://api.github.com/users/iwanb/events{/privacy}","received_events_url":"https://api.github.com/users/iwanb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":702619195,"node_id":"MDU6TGFiZWw3MDI2MTkxOTU=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20rewrite","name":"topic: rewrite","color":"0e8a16","default":false,"description":"related to the assertion rewrite mechanism"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-06-05T16:29:47Z","updated_at":"2018-09-23T16:17:57Z","closed_at":"2018-09-23T16:17:57Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Importing a module with assertion rewrite enabled, changing the code and then reloading the module (with reload or imp.reload) does not pick up the changes.\r\n\r\nA fix was done in 2.7.0 but AFAIK it is wrong:\r\nhttps://docs.pytest.org/en/latest/changelog.html#id456\r\nIn _pytest/assertion/rewrite.py, load_module should indeed use the module from sys.modules, but it should also load the code again (overwriting the module dict):\r\nhttps://docs.python.org/3/library/importlib.html#importlib.abc.Loader.load_module\r\n\r\nI wrote a testcase and a possible fix here (but I'm not that familiar with the code):\r\nhttps://github.com/iwanb/pytest/commit/c78569bc9261e4d992d3906ca55cae7bf325ff5b\r\n\r\nI can do a pull request if it looks ok to you.","closed_by":{"login":"RonnyPfannschmidt","id":156838,"node_id":"MDQ6VXNlcjE1NjgzOA==","avatar_url":"https://avatars.githubusercontent.com/u/156838?v=4","gravatar_id":"","url":"https://api.github.com/users/RonnyPfannschmidt","html_url":"https://github.com/RonnyPfannschmidt","followers_url":"https://api.github.com/users/RonnyPfannschmidt/followers","following_url":"https://api.github.com/users/RonnyPfannschmidt/following{/other_user}","gists_url":"https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}","starred_url":"https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RonnyPfannschmidt/subscriptions","organizations_url":"https://api.github.com/users/RonnyPfannschmidt/orgs","repos_url":"https://api.github.com/users/RonnyPfannschmidt/repos","events_url":"https://api.github.com/users/RonnyPfannschmidt/events{/privacy}","received_events_url":"https://api.github.com/users/RonnyPfannschmidt/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3539/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3539/timeline","performed_via_github_app":null,"state_reason":"completed"}