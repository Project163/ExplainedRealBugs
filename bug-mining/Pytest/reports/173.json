{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/6290","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6290/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6290/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6290/events","html_url":"https://github.com/pytest-dev/pytest/issues/6290","id":530436727,"node_id":"MDU6SXNzdWU1MzA0MzY3Mjc=","number":6290,"title":"'--cache-clear' option to regenerate the cache folder is missing some files","user":{"login":"luizyao","id":30592265,"node_id":"MDQ6VXNlcjMwNTkyMjY1","avatar_url":"https://avatars.githubusercontent.com/u/30592265?v=4","gravatar_id":"","url":"https://api.github.com/users/luizyao","html_url":"https://github.com/luizyao","followers_url":"https://api.github.com/users/luizyao/followers","following_url":"https://api.github.com/users/luizyao/following{/other_user}","gists_url":"https://api.github.com/users/luizyao/gists{/gist_id}","starred_url":"https://api.github.com/users/luizyao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luizyao/subscriptions","organizations_url":"https://api.github.com/users/luizyao/orgs","repos_url":"https://api.github.com/users/luizyao/repos","events_url":"https://api.github.com/users/luizyao/events{/privacy}","received_events_url":"https://api.github.com/users/luizyao/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849196,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTY=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/status:%20help%20wanted","name":"status: help wanted","color":"159818","default":false,"description":"developers would like help from experts on this topic"},{"id":224851915,"node_id":"MDU6TGFiZWwyMjQ4NTE5MTU=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20cache","name":"plugin: cache","color":"c7def8","default":false,"description":"related to the cache builtin plugin"},{"id":240426349,"node_id":"MDU6TGFiZWwyNDA0MjYzNDk=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/good%20first%20issue","name":"good first issue","color":"bfe5bf","default":true,"description":"easy issue that is friendly to new contributor"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2019-11-29T17:06:49Z","updated_at":"2019-12-01T13:37:23Z","closed_at":"2019-12-01T13:37:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Description\r\nBefore I used `--cache-clear` option, my cache folder looked like this:\r\n\r\n```bash\r\n.pytest_cache/\r\n├── .gitignore\r\n├── CACHEDIR.TAG\r\n├── README.md\r\n└── v\r\n    └── cache\r\n        ├── nodeids\r\n        └── stepwise\r\n\r\n2 directories, 5 files\r\n```\r\n\r\nthen I add `--cache-clear` option to re-execute, my cache folder looks like this：\r\n\r\n```bash\r\n.pytest_cache/\r\n└── v\r\n    └── cache\r\n        ├── nodeids\r\n        └── stepwise\r\n\r\n2 directories, 2 files\r\n```\r\n\r\nThree files are missing: `.gitignore` `CACHEDIR.TAG` and `README.md`.\r\n\r\nThis lets me commit files that I don't want to upload while using `git commit`.\r\n\r\n# Question\r\nI check the `src/_pytest/cacheprovider.py` file in source codes.\r\n\r\n```python\r\n    @classmethod\r\n    def for_config(cls, config):\r\n        cachedir = cls.cache_dir_from_config(config)\r\n        if config.getoption(\"cacheclear\") and cachedir.exists():\r\n            rm_rf(cachedir)\r\n            cachedir.mkdir()\r\n        return cls(cachedir, config)\r\n```\r\n\r\nI think this issue is caused by this line: `cachedir.mkdir()`, it will make `cache_dir_exists_already` `True`, so that `_ensure_supporting_files` function not to be called.\r\n\r\n```python\r\n       try:\r\n            if path.parent.is_dir():\r\n                cache_dir_exists_already = True\r\n            else:\r\n                cache_dir_exists_already = self._cachedir.exists()\r\n                path.parent.mkdir(exist_ok=True, parents=True)\r\n        except (IOError, OSError):\r\n            self.warn(\"could not create cache path {path}\", path=path)\r\n            return\r\n        if not cache_dir_exists_already:\r\n            self._ensure_supporting_files()\r\n``` \r\n\r\nI  don't understand why this operation was added. Is there anything else I don't know about it？","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/6290/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/6290/timeline","performed_via_github_app":null,"state_reason":"completed"}