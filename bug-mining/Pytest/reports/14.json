{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3074","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3074/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3074/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3074/events","html_url":"https://github.com/pytest-dev/pytest/issues/3074","id":285780052,"node_id":"MDU6SXNzdWUyODU3ODAwNTI=","number":3074,"title":"AttributeError: 'Function' object has no attribute '_skipped_by_mark'","user":{"login":"elliterate","id":6326,"node_id":"MDQ6VXNlcjYzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/6326?v=4","gravatar_id":"","url":"https://api.github.com/users/elliterate","html_url":"https://github.com/elliterate","followers_url":"https://api.github.com/users/elliterate/followers","following_url":"https://api.github.com/users/elliterate/following{/other_user}","gists_url":"https://api.github.com/users/elliterate/gists{/gist_id}","starred_url":"https://api.github.com/users/elliterate/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elliterate/subscriptions","organizations_url":"https://api.github.com/users/elliterate/orgs","repos_url":"https://api.github.com/users/elliterate/repos","events_url":"https://api.github.com/users/elliterate/events{/privacy}","received_events_url":"https://api.github.com/users/elliterate/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":315571544,"node_id":"MDU6TGFiZWwzMTU1NzE1NDQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20regression","name":"type: regression","color":"f7c6c7","default":false,"description":"indicates a problem that was introduced in a release which was working previously"},{"id":763820991,"node_id":"MDU6TGFiZWw3NjM4MjA5OTE=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20logging","name":"plugin: logging","color":"ff5432","default":false,"description":"related to the logging builtin plugin"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-01-03T19:07:51Z","updated_at":"2018-01-06T15:56:08Z","closed_at":"2018-01-06T15:56:08Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"If test execution aborts before the skipping module's `pytest_runtest_setup` hook executes (e.g., via `pytest.skip()` in an earlier setup hook), the skipping module's `pytest_runtest_makereport` hook fails with:\r\n\r\n```\r\nAttributeError: 'Function' object has no attribute '_skipped_by_mark'\r\n```\r\n\r\nThe skipping module's reporting hook assumes that its setup hook executed and thus that it is safe to read the `_skipped_by_mark` attribute on the test item. If test execution aborts in an earlier setup hook, however, this assumption will be incorrect and its reporting hook will fail.\r\n\r\nNote: This error is the same as seen in #2982 and #2974, but, unlike those issues, is not masking a separate, root error: it _is_ the root error.\r\n\r\n# Example\r\n\r\n## Setup\r\n\r\n```\r\n$ python --version\r\nPython 3.6.1\r\n```\r\n\r\n```\r\n$ pip list\r\nattrs (17.4.0)\r\npip (9.0.1)\r\npluggy (0.6.0)\r\npy (1.5.2)\r\npytest (3.3.1)\r\nsetuptools (38.2.5)\r\nsix (1.11.0)\r\nwheel (0.30.0)\r\n```\r\n\r\nNote: Also fails on pytest 3.3.0. Succeeds on pytest 3.2.5.\r\n\r\n## Scenario\r\n\r\n### `conftest.py`\r\n```python\r\nimport pytest\r\n\r\n@pytest.hookimpl(tryfirst=True)\r\ndef pytest_runtest_setup(item):\r\n    pytest.skip(\"manually skipped\")\r\n```\r\n\r\n### `test_skip.py`\r\n```python\r\ndef test_skipped():\r\n    assert False, \"test should be skipped\"\r\n```\r\n\r\n## Results\r\n\r\n```\r\n$ py.test\r\n======================================================== test session starts ========================================================\r\nplatform darwin -- Python 3.6.1, pytest-3.3.1, py-1.5.2, pluggy-0.6.0\r\nrootdir: $HOME/src/skipping, inifile:\r\ncollected 1 item\r\n\r\ntest_skip.py\r\nINTERNALERROR> Traceback (most recent call last):\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/_pytest/main.py\", line 103, in wrap_session\r\nINTERNALERROR>     session.exitstatus = doit(config, session) or 0\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/_pytest/main.py\", line 141, in _main\r\nINTERNALERROR>     config.hook.pytest_runtestloop(session=session)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 617, in __call__\r\nINTERNALERROR>     return self._hookexec(self, self._nonwrappers + self._wrappers, kwargs)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 222, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook, methods, kwargs)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 216, in <lambda>\r\nINTERNALERROR>     firstresult=hook.spec_opts.get('firstresult'),\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/callers.py\", line 201, in _multicall\r\nINTERNALERROR>     return outcome.get_result()\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/callers.py\", line 76, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/callers.py\", line 180, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/_pytest/main.py\", line 164, in pytest_runtestloop\r\nINTERNALERROR>     item.config.hook.pytest_runtest_protocol(item=item, nextitem=nextitem)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 617, in __call__\r\nINTERNALERROR>     return self._hookexec(self, self._nonwrappers + self._wrappers, kwargs)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 222, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook, methods, kwargs)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 216, in <lambda>\r\nINTERNALERROR>     firstresult=hook.spec_opts.get('firstresult'),\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/callers.py\", line 201, in _multicall\r\nINTERNALERROR>     return outcome.get_result()\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/callers.py\", line 76, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/callers.py\", line 180, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/_pytest/runner.py\", line 62, in pytest_runtest_protocol\r\nINTERNALERROR>     runtestprotocol(item, nextitem=nextitem)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/_pytest/runner.py\", line 70, in runtestprotocol\r\nINTERNALERROR>     rep = call_and_report(item, \"setup\", log)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/_pytest/runner.py\", line 157, in call_and_report\r\nINTERNALERROR>     report = hook.pytest_runtest_makereport(item=item, call=call)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 617, in __call__\r\nINTERNALERROR>     return self._hookexec(self, self._nonwrappers + self._wrappers, kwargs)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 222, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook, methods, kwargs)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/__init__.py\", line 216, in <lambda>\r\nINTERNALERROR>     firstresult=hook.spec_opts.get('firstresult'),\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/pluggy/callers.py\", line 196, in _multicall\r\nINTERNALERROR>     gen.send(outcome)\r\nINTERNALERROR>   File \"$HOME/.envs/skipping/lib/python3.6/site-packages/_pytest/skipping.py\", line 264, in pytest_runtest_makereport\r\nINTERNALERROR>     elif item._skipped_by_mark and rep.skipped and type(rep.longrepr) is tuple:\r\nINTERNALERROR> AttributeError: 'Function' object has no attribute '_skipped_by_mark'\r\n\r\n=================================================== no tests ran in 0.01 seconds ====================================================\r\n```","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3074/timeline","performed_via_github_app":null,"state_reason":"completed"}