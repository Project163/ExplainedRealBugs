{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3057","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3057/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3057/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3057/events","html_url":"https://github.com/pytest-dev/pytest/issues/3057","id":284105099,"node_id":"MDU6SXNzdWUyODQxMDUwOTk=","number":3057,"title":"Dynamically adding fixture with getfixturevalue and fixturenames behavior","user":{"login":"benjaminrigaud","id":1983087,"node_id":"MDQ6VXNlcjE5ODMwODc=","avatar_url":"https://avatars.githubusercontent.com/u/1983087?v=4","gravatar_id":"","url":"https://api.github.com/users/benjaminrigaud","html_url":"https://github.com/benjaminrigaud","followers_url":"https://api.github.com/users/benjaminrigaud/followers","following_url":"https://api.github.com/users/benjaminrigaud/following{/other_user}","gists_url":"https://api.github.com/users/benjaminrigaud/gists{/gist_id}","starred_url":"https://api.github.com/users/benjaminrigaud/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benjaminrigaud/subscriptions","organizations_url":"https://api.github.com/users/benjaminrigaud/orgs","repos_url":"https://api.github.com/users/benjaminrigaud/repos","events_url":"https://api.github.com/users/benjaminrigaud/events{/privacy}","received_events_url":"https://api.github.com/users/benjaminrigaud/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":240496914,"node_id":"MDU6TGFiZWwyNDA0OTY5MTQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20parametrize","name":"topic: parametrize","color":"fbca04","default":false,"description":"related to @pytest.mark.parametrize"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-12-22T08:40:42Z","updated_at":"2018-10-04T12:21:23Z","closed_at":"2018-10-04T12:21:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\r\n\r\nI would like to know if there is a pattern to dynamically configure a fixture from another fixture such as it would be available in the fixturenames list.\r\n\r\nI tried something like that:\r\n\r\n```python\r\n\r\nimport pytest\r\n\r\n\r\n@pytest.fixture\r\ndef mode_b_only(request):\r\n    print 'mode_b_only'\r\n\r\n\r\n@pytest.fixture\r\ndef setup(request):\r\n    print 'setup', request.fixturenames\r\n    if 'mode_b_only' in request.fixturenames:\r\n        pass  # do something\r\n\r\n\r\n@pytest.fixture(scope='function', params=[\r\n    'mode_a',\r\n    # disabled by default\r\n    # 'mode_b',\r\n    # 'mode_c',\r\n])\r\n@pytest.mark.early\r\ndef two(request):\r\n    print 'two'\r\n\r\n    if request.param == 'mode_b':\r\n        request.getfixturevalue('mode_b_only')\r\n\r\n    return request.param\r\n\r\n\r\ndef test_default(two, setup):\r\n    pass\r\n\r\n\r\n@pytest.mark.parametrize('two', ['mode_a', 'mode_b'], indirect=True)\r\ndef test_a_and_b(two, setup):\r\n    pass\r\n\r\n```\r\n\r\nUnfortunately, `setup` doesn't see `mode_b_only` fixture in `request.fixturenames` when executing `test_a_and_b[mode_b]`\r\n\r\n```\r\ntests/test_fixtures.py::test_default[mode_a] two\r\nsetup ['two', 'setup', 'request']\r\nPASSED\r\n\r\ntests/test_fixtures.py::test_a_and_b[mode_a] two\r\nsetup ['two', 'setup', 'request']\r\nPASSED\r\n\r\ntests/test_fixtures.py::test_a_and_b[mode_b] two\r\nmode_b_only\r\nsetup ['two', 'setup', 'request']\r\nPASSED\r\n\r\n```\r\n\r\nIs there any way to make it work or some patterns to do that differently?\r\nIn my case, setup is an external fixture I have to override & tweak its behavior.\r\n\r\npytest==3.3.1 under Ubuntu\r\n\r\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3057/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3057/timeline","performed_via_github_app":null,"state_reason":"completed"}