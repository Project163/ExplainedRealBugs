{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12544","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12544/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12544/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12544/events","html_url":"https://github.com/pytest-dev/pytest/issues/12544","id":2379617584,"node_id":"I_kwDOAjwLdc6N1hUw","number":12544,"title":"Support venv detection on Windows with mingw Python","user":{"login":"lazka","id":991986,"node_id":"MDQ6VXNlcjk5MTk4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/991986?v=4","gravatar_id":"","url":"https://api.github.com/users/lazka","html_url":"https://github.com/lazka","followers_url":"https://api.github.com/users/lazka/followers","following_url":"https://api.github.com/users/lazka/following{/other_user}","gists_url":"https://api.github.com/users/lazka/gists{/gist_id}","starred_url":"https://api.github.com/users/lazka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lazka/subscriptions","organizations_url":"https://api.github.com/users/lazka/orgs","repos_url":"https://api.github.com/users/lazka/repos","events_url":"https://api.github.com/users/lazka/events{/privacy}","received_events_url":"https://api.github.com/users/lazka/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":240426349,"node_id":"MDU6TGFiZWwyNDA0MjYzNDk=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/good%20first%20issue","name":"good first issue","color":"bfe5bf","default":true,"description":"easy issue that is friendly to new contributor"},{"id":7137474399,"node_id":"LA_kwDOAjwLdc8AAAABqW03Xw","url":"https://api.github.com/repos/pytest-dev/pytest/labels/platform:%20mingw","name":"platform: mingw","color":"27F67B","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"zachsnicker","id":174099534,"node_id":"U_kgDOCmCMTg","avatar_url":"https://avatars.githubusercontent.com/u/174099534?v=4","gravatar_id":"","url":"https://api.github.com/users/zachsnicker","html_url":"https://github.com/zachsnicker","followers_url":"https://api.github.com/users/zachsnicker/followers","following_url":"https://api.github.com/users/zachsnicker/following{/other_user}","gists_url":"https://api.github.com/users/zachsnicker/gists{/gist_id}","starred_url":"https://api.github.com/users/zachsnicker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zachsnicker/subscriptions","organizations_url":"https://api.github.com/users/zachsnicker/orgs","repos_url":"https://api.github.com/users/zachsnicker/repos","events_url":"https://api.github.com/users/zachsnicker/events{/privacy}","received_events_url":"https://api.github.com/users/zachsnicker/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"zachsnicker","id":174099534,"node_id":"U_kgDOCmCMTg","avatar_url":"https://avatars.githubusercontent.com/u/174099534?v=4","gravatar_id":"","url":"https://api.github.com/users/zachsnicker","html_url":"https://github.com/zachsnicker","followers_url":"https://api.github.com/users/zachsnicker/followers","following_url":"https://api.github.com/users/zachsnicker/following{/other_user}","gists_url":"https://api.github.com/users/zachsnicker/gists{/gist_id}","starred_url":"https://api.github.com/users/zachsnicker/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zachsnicker/subscriptions","organizations_url":"https://api.github.com/users/zachsnicker/orgs","repos_url":"https://api.github.com/users/zachsnicker/repos","events_url":"https://api.github.com/users/zachsnicker/events{/privacy}","received_events_url":"https://api.github.com/users/zachsnicker/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2024-06-28T05:36:30Z","updated_at":"2024-06-28T21:30:53Z","closed_at":"2024-06-28T21:30:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### What's the problem this feature will solve?\r\n\r\nCurrently pytest checks platform depended paths in a directory to see if it might be a venv: https://github.com/pytest-dev/pytest/blob/0ed2d79457b499119693588b71233db957e972c0/src/_pytest/main.py#L370-L387\r\n\r\nThis works fine with the official CPython releases, but the mingw Python on Windows uses the Unix layout, which looks like this, despite being on Windows:\r\n\r\n```console\r\n$ tree -L 1 .venv\r\n.venv\r\n├── bin\r\n├── include\r\n├── lib\r\n└── pyvenv.cfg\r\n```\r\n\r\nThis results in pytest trying to collect tests in venv files by default.\r\n\r\n#### Describe the solution you'd like\r\n\r\nI can see three solutions to this:\r\n\r\n1) Check for both bin/Scripts\r\n\r\n2) First check for the existence of \"pyvenv.cfg\", which should be in every venv on every platform\r\n\r\n3) Replace the current logic and just check for \"pyvenv.cfg\". \"pyvenv.cfg\" was introduced in Python 3.3 with the venv module, so it might be enough to assume it exists in every venv. Maybe I'm missing something though.\r\n\r\n**Note:** I'm happy to create a PR for any of the above solutions.","closed_by":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12544/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12544/timeline","performed_via_github_app":null,"state_reason":"completed"}