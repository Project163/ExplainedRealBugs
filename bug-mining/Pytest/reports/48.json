{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3854","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3854/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3854/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3854/events","html_url":"https://github.com/pytest-dev/pytest/issues/3854","id":352903707,"node_id":"MDU6SXNzdWUzNTI5MDM3MDc=","number":3854,"title":"PyTest 3.7 duplicating tests during collection","user":{"login":"DanielSchiavini","id":2369243,"node_id":"MDQ6VXNlcjIzNjkyNDM=","avatar_url":"https://avatars.githubusercontent.com/u/2369243?v=4","gravatar_id":"","url":"https://api.github.com/users/DanielSchiavini","html_url":"https://github.com/DanielSchiavini","followers_url":"https://api.github.com/users/DanielSchiavini/followers","following_url":"https://api.github.com/users/DanielSchiavini/following{/other_user}","gists_url":"https://api.github.com/users/DanielSchiavini/gists{/gist_id}","starred_url":"https://api.github.com/users/DanielSchiavini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DanielSchiavini/subscriptions","organizations_url":"https://api.github.com/users/DanielSchiavini/orgs","repos_url":"https://api.github.com/users/DanielSchiavini/repos","events_url":"https://api.github.com/users/DanielSchiavini/events{/privacy}","received_events_url":"https://api.github.com/users/DanielSchiavini/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":240511492,"node_id":"MDU6TGFiZWwyNDA1MTE0OTI=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20collection","name":"topic: collection","color":"006b75","default":false,"description":"related to the collection phase"},{"id":315571544,"node_id":"MDU6TGFiZWwzMTU1NzE1NDQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20regression","name":"type: regression","color":"f7c6c7","default":false,"description":"indicates a problem that was introduced in a release which was working previously"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-08-22T11:01:36Z","updated_at":"2018-08-25T16:15:42Z","closed_at":"2018-08-25T13:44:09Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"After upgrading to pytest 3.7, our projects suddently are collecting each test twice.\r\nAll tests run 2 times and the total percentage in the end of the run is between 33% and 55%.\r\n\r\nI managed to create a small project to reproduce the issue:\r\n[testpytest.zip](https://github.com/pytest-dev/pytest/files/2310018/testpytest.zip)\r\n\r\nEmpty files:\r\n`./__init__.py`\r\n`./lib/__init__.py`\r\n`./lib/tests/__init__.py`\r\n`./tests/__init__.py`\r\n\r\nTest files:\r\n`./lib/tests/TestPyTest.py`\r\n`./tests/TestPyTest.py`\r\n```\r\nfrom unittest import TestCase\r\nclass TestPyTest(TestCase):\r\n    def test(self):\r\n        pass\r\n```\r\n\r\n`./pytest.ini`\r\n```\r\n[pytest]\r\ntestpaths = .\r\npython_files = Test*.py\r\npython_classes = Test\r\npython_functions = test\r\n```\r\n\r\n`./Dockerfile`\r\n```\r\nFROM python:3.7 AS base\r\nWORKDIR /usr/src/app\r\n\r\nFROM base AS pytest36\r\nRUN pip install pytest==3.6.4\r\nADD . .\r\nRUN ENV_NAME=testing pytest\r\n\r\nFROM base AS pytest37\r\nRUN pip install pytest==3.7\r\nADD . .\r\nRUN ENV_NAME=testing pytest\r\n```\r\n\r\nOutput of `docker build .`:\r\n```\r\n[...]\r\nStep 4/10 : RUN pip install pytest==3.6.4\r\n ---> Using cache\r\n ---> 31c440fd1976\r\nStep 5/10 : ADD . .\r\n ---> aa1d7f89c771\r\nStep 6/10 : RUN ENV_NAME=testing pytest\r\n ---> Running in 72af6d63f895\r\n============================= test session starts ==============================\r\nplatform linux -- Python 3.7.0, pytest-3.6.4, py-1.5.4, pluggy-0.7.1\r\nrootdir: /usr/src/app, inifile: pytest.ini\r\ncollected 2 items\r\n\r\nlib/tests/TestPyTest.py .                                                [ 50%]\r\ntests/TestPyTest.py .                                                    [100%]\r\n\r\n=========================== 2 passed in 0.04 seconds ===========================\r\nRemoving intermediate container 72af6d63f895\r\n ---> d843066e44ea\r\nStep 7/10 : FROM base AS pytest37\r\n ---> 22d8eec60ce2\r\nStep 8/10 : RUN pip install pytest==3.7\r\n ---> Using cache\r\n ---> d05ea16fa3f3\r\nStep 9/10 : ADD . .\r\n ---> a8b18ec3669b\r\nStep 10/10 : RUN ENV_NAME=testing pytest\r\n ---> Running in 9d5b48e1beb0\r\n============================= test session starts ==============================\r\nplatform linux -- Python 3.7.0, pytest-3.7.0, py-1.5.4, pluggy-0.7.1\r\nrootdir: /usr/src/app, inifile: pytest.ini\r\ncollected 3 items\r\n\r\nlib/tests/TestPyTest.py ..                                               [ 33%]\r\ntests/TestPyTest.py .\r\n\r\n=========================== 3 passed in 0.04 seconds ===========================\r\nRemoving intermediate container 9d5b48e1beb0\r\n ---> 1affcfd67144\r\nSuccessfully built 1affcfd67144\r\nSuccessfully tagged pytest:latest\r\n\r\n```\r\n\r\nNote how pytest 3.6.4 correctly finds 2 tests, while pytest 3.7 collects 3 tests and reports a total of 33% run.\r\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/3854/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/3854/timeline","performed_via_github_app":null,"state_reason":"completed"}