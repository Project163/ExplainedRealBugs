{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/9432","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9432/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9432/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9432/events","html_url":"https://github.com/pytest-dev/pytest/issues/9432","id":1087226653,"node_id":"I_kwDOAjwLdc5AzcMd","number":9432,"title":"[prerelease] pytest.TmpdirFactory is not importable anymore","user":{"login":"The-Compiler","id":625793,"node_id":"MDQ6VXNlcjYyNTc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/625793?v=4","gravatar_id":"","url":"https://api.github.com/users/The-Compiler","html_url":"https://github.com/The-Compiler","followers_url":"https://api.github.com/users/The-Compiler/followers","following_url":"https://api.github.com/users/The-Compiler/following{/other_user}","gists_url":"https://api.github.com/users/The-Compiler/gists{/gist_id}","starred_url":"https://api.github.com/users/The-Compiler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/The-Compiler/subscriptions","organizations_url":"https://api.github.com/users/The-Compiler/orgs","repos_url":"https://api.github.com/users/The-Compiler/repos","events_url":"https://api.github.com/users/The-Compiler/events{/privacy}","received_events_url":"https://api.github.com/users/The-Compiler/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":315571544,"node_id":"MDU6TGFiZWwzMTU1NzE1NDQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20regression","name":"type: regression","color":"f7c6c7","default":false,"description":"indicates a problem that was introduced in a release which was working previously"},{"id":692891970,"node_id":"MDU6TGFiZWw2OTI4OTE5NzA=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20tmpdir","name":"plugin: tmpdir","color":"bfd4f2","default":false,"description":"related to the tmpdir builtin plugin"},{"id":2204302783,"node_id":"MDU6TGFiZWwyMjA0MzAyNzgz","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20typing","name":"topic: typing","color":"605dc6","default":false,"description":"type-annotation issue"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pytest-dev/pytest/milestones/38","html_url":"https://github.com/pytest-dev/pytest/milestone/38","labels_url":"https://api.github.com/repos/pytest-dev/pytest/milestones/38/labels","id":6457781,"node_id":"MDk6TWlsZXN0b25lNjQ1Nzc4MQ==","number":38,"title":"7.0","description":"","creator":{"login":"RonnyPfannschmidt","id":156838,"node_id":"MDQ6VXNlcjE1NjgzOA==","avatar_url":"https://avatars.githubusercontent.com/u/156838?v=4","gravatar_id":"","url":"https://api.github.com/users/RonnyPfannschmidt","html_url":"https://github.com/RonnyPfannschmidt","followers_url":"https://api.github.com/users/RonnyPfannschmidt/followers","following_url":"https://api.github.com/users/RonnyPfannschmidt/following{/other_user}","gists_url":"https://api.github.com/users/RonnyPfannschmidt/gists{/gist_id}","starred_url":"https://api.github.com/users/RonnyPfannschmidt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RonnyPfannschmidt/subscriptions","organizations_url":"https://api.github.com/users/RonnyPfannschmidt/orgs","repos_url":"https://api.github.com/users/RonnyPfannschmidt/repos","events_url":"https://api.github.com/users/RonnyPfannschmidt/events{/privacy}","received_events_url":"https://api.github.com/users/RonnyPfannschmidt/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":59,"state":"closed","created_at":"2021-02-21T22:42:25Z","updated_at":"2022-06-14T10:35:15Z","due_on":null,"closed_at":"2022-06-14T10:35:15Z"},"comments":6,"created_at":"2021-12-22T22:18:18Z","updated_at":"2021-12-27T13:03:05Z","closed_at":"2021-12-27T13:03:05Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Discovered in https://github.com/ClearcodeHQ/pytest-postgresql/issues/533#issuecomment-999567968 via #9415:\r\n\r\nDoing e.g. `python3 -c \"import pytest; pytest.TempdirFactory\"` fails since  5e883f51959f900fcf985493ce2d09e07bad7e00. This is a bit similar to #9396, but #9400 won't help with this one.\r\n\r\nTest modules often use `pytest.TempdirFactory` for type annotations - in fact, that's why [that was added](https://docs.pytest.org/en/stable/changelog.html#improvements) in 6.2.0.\r\n\r\nHowever, it being set from a plugin means that:\r\n\r\na) Test modules aren't even importable anymore outside of pytest - in case of `pytest-postgresql`, this [breaks an importability check](https://github.com/ClearcodeHQ/pytest-postgresql/runs/4607221002?check_suite_focus=true), but I can imagine various other things breaking...\r\nb) Perhaps more importantly, static analysis in IDEs or tools like mypy [aren't aware anymore](https://github.com/ClearcodeHQ/pytest-postgresql/runs/4607221090?check_suite_focus=true) that the attribute exists - however, after all, that's *the whole point* of it existing, and [lots of projects use it that way](https://sourcegraph.com/search?q=context:global+:%5C+*%28pytest%5C.%29%3FTempdirFactory+lang:python+-file:pytester.py&patternType=regexp). (Some import it from `_pytest.tmpdir`, probably because they did that before 6.2.0 - I'm not too worried about those, they knew what they're in for)\r\n\r\nReproducer:\r\n\r\n```python\r\nfrom pytest import TempdirFactory\r\n\r\ndef test_nothing(tmpdir: TempdirFactory):\r\n    pass\r\n```\r\n\r\nFails with mypy:\r\n\r\n```\r\ntest_x.py:1: error: Module \"pytest\" has no attribute \"TempdirFactory\"; maybe \"TempPathFactory\"?\r\nFound 1 error in 1 file (checked 1 source file)\r\n```\r\n\r\nWhat to do? I suppose as a stop-gap until we want to distribute the plugin independently from pytest, we could import the class from the plugin or so?","closed_by":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/9432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9432/timeline","performed_via_github_app":null,"state_reason":"completed"}