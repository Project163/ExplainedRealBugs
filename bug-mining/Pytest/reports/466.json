{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12497","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12497/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12497/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12497/events","html_url":"https://github.com/pytest-dev/pytest/issues/12497","id":2364566231,"node_id":"I_kwDOAjwLdc6M8GrX","number":12497,"title":"[Python 3.13.0b2] `test_pdb_used_outside_test` and `test_pdb_used_in_generate_tests` are failing with Python 3.13","user":{"login":"hrnciar","id":13086088,"node_id":"MDQ6VXNlcjEzMDg2MDg4","avatar_url":"https://avatars.githubusercontent.com/u/13086088?v=4","gravatar_id":"","url":"https://api.github.com/users/hrnciar","html_url":"https://github.com/hrnciar","followers_url":"https://api.github.com/users/hrnciar/followers","following_url":"https://api.github.com/users/hrnciar/following{/other_user}","gists_url":"https://api.github.com/users/hrnciar/gists{/gist_id}","starred_url":"https://api.github.com/users/hrnciar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hrnciar/subscriptions","organizations_url":"https://api.github.com/users/hrnciar/orgs","repos_url":"https://api.github.com/users/hrnciar/repos","events_url":"https://api.github.com/users/hrnciar/events{/privacy}","received_events_url":"https://api.github.com/users/hrnciar/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1269801373,"node_id":"MDU6TGFiZWwxMjY5ODAxMzcz","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20selftests","name":"type: selftests","color":"5319e7","default":false,"description":"a problem in the tests of pytest"}],"state":"closed","locked":false,"assignee":{"login":"The-Compiler","id":625793,"node_id":"MDQ6VXNlcjYyNTc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/625793?v=4","gravatar_id":"","url":"https://api.github.com/users/The-Compiler","html_url":"https://github.com/The-Compiler","followers_url":"https://api.github.com/users/The-Compiler/followers","following_url":"https://api.github.com/users/The-Compiler/following{/other_user}","gists_url":"https://api.github.com/users/The-Compiler/gists{/gist_id}","starred_url":"https://api.github.com/users/The-Compiler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/The-Compiler/subscriptions","organizations_url":"https://api.github.com/users/The-Compiler/orgs","repos_url":"https://api.github.com/users/The-Compiler/repos","events_url":"https://api.github.com/users/The-Compiler/events{/privacy}","received_events_url":"https://api.github.com/users/The-Compiler/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"The-Compiler","id":625793,"node_id":"MDQ6VXNlcjYyNTc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/625793?v=4","gravatar_id":"","url":"https://api.github.com/users/The-Compiler","html_url":"https://github.com/The-Compiler","followers_url":"https://api.github.com/users/The-Compiler/followers","following_url":"https://api.github.com/users/The-Compiler/following{/other_user}","gists_url":"https://api.github.com/users/The-Compiler/gists{/gist_id}","starred_url":"https://api.github.com/users/The-Compiler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/The-Compiler/subscriptions","organizations_url":"https://api.github.com/users/The-Compiler/orgs","repos_url":"https://api.github.com/users/The-Compiler/repos","events_url":"https://api.github.com/users/The-Compiler/events{/privacy}","received_events_url":"https://api.github.com/users/The-Compiler/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":7,"created_at":"2024-06-20T14:12:32Z","updated_at":"2024-10-13T16:00:56Z","closed_at":"2024-10-13T16:00:56Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello, `test_pdb_used_outside_test` and `test_pdb_used_in_generate_tests` are failing with Python 3.13 beta 2 on Fedora Rawhide. The same error was observed also with pytest 7.4.3.\r\n~~~~\r\n+ /builddir/build/BUILD/pytest-8.2.2-build/BUILDROOT/usr/bin/pytest testing --timeout=30 -n auto -rs\r\n============================= test session starts ==============================\r\nplatform linux -- Python 3.13.0b2, pytest-8.2.2, pluggy-1.5.0\r\nrootdir: /builddir/build/BUILD/pytest-8.2.2-build/pytest-8.2.2\r\nconfigfile: pyproject.toml\r\nplugins: timeout-2.3.1, xdist-3.6.1, hypothesis-6.98.8\r\ntimeout: 30.0s\r\ntimeout method: signal\r\ntimeout func_only: False\r\ncreated: 2/2 workers\r\n2 workers [3663 items]\r\n\r\n........................................................................ [  1%]\r\n......................................................ss................ [  3%]\r\n............s...................................................x....... [  5%]\r\n........................................................................ [  7%]\r\n....................................Xs.................................. [  9%]\r\n...sssssss............................x................................. [ 11%]\r\n........................................................................ [ 13%]\r\n........................................................................ [ 15%]\r\n........................................................................ [ 17%]\r\n........................................................................ [ 19%]\r\n........................................................................ [ 21%]\r\n........................................................................ [ 23%]\r\n.............s.......................................................... [ 25%]\r\n........................................................................ [ 27%]\r\n...........................................s............................ [ 29%]\r\n........................................................................ [ 31%]\r\n..........................s............................................. [ 33%]\r\n........................................................................ [ 35%]\r\n........................................................................ [ 37%]\r\n........................................................................ [ 39%]\r\n........................................................................ [ 41%]\r\n.x.............................................s........................ [ 43%]\r\n.........sssss.ssss..................................................... [ 45%]\r\n........................................................................ [ 47%]\r\n........................................................................ [ 49%]\r\n........................................................................ [ 51%]\r\n......................................................................... [ 53%]\r\n.x........................................................x............. [ 55%]\r\n......................................................................x. [ 57%]\r\n........................................................................ [ 58%]\r\n..........................s............................................s [ 60%]\r\n................................................................x....... [ 62%]\r\n........................................................................ [ 64%]\r\n.................................s.x.................................... [ 66%]\r\n........................................................................ [ 68%]\r\n........................................................................ [ 70%]\r\n........................................................................ [ 72%]\r\n.................................................x...................... [ 74%]\r\n........................................................................ [ 76%]\r\n.............................................................s.......... [ 78%]\r\n...............................................s.......................x [ 80%]\r\n........................x............................................... [ 82%]\r\n........................................................................ [ 84%]\r\n........................................................................ [ 86%]\r\n........................................................................ [ 88%]\r\n........................................................................ [ 90%]\r\n......................................................................... [ 92%]\r\n............................s........................................... [ 94%]\r\n..sss...........................x......................................s [ 96%]\r\n......X....XX..s...................................x.................... [ 98%]\r\n.............................................xX....FF........            [100%]\r\n=================================== FAILURES ===================================\r\n______________________ TestPDB.test_pdb_used_outside_test ______________________\r\n[gw1] linux -- Python 3.13.0 /usr/bin/python3\r\n\r\nself = <test_debugging.TestPDB object at 0x7f9fbabf6d50>\r\npytester = <Pytester PosixPath('/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_pdb_used_outside_test0')>\r\n\r\n    def test_pdb_used_outside_test(self, pytester: Pytester) -> None:\r\n        p1 = pytester.makepyfile(\r\n            \"\"\"\r\n            import pytest\r\n            pytest.set_trace()\r\n            x = 5\r\n        \"\"\"\r\n        )\r\n        child = pytester.spawn(f\"{sys.executable} {p1}\")\r\n>       child.expect(\"x = 5\")\r\n\r\n/builddir/build/BUILD/pytest-8.2.2-build/pytest-8.2.2/testing/test_debugging.py:771: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n/usr/lib/python3.13/site-packages/pexpect/spawnbase.py:354: in expect\r\n    return self.expect_list(compiled_pattern_list,\r\n/usr/lib/python3.13/site-packages/pexpect/spawnbase.py:383: in expect_list\r\n    return exp.expect_loop(timeout)\r\n/usr/lib/python3.13/site-packages/pexpect/expect.py:181: in expect_loop\r\n    return self.timeout(e)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <pexpect.expect.Expecter object at 0x7f9fa1526510>\r\nerr = TIMEOUT('Timeout exceeded.')\r\n\r\n    def timeout(self, err=None):\r\n        spawn = self.spawn\r\n    \r\n        spawn.before = spawn._before.getvalue()\r\n        spawn.after = TIMEOUT\r\n        index = self.searcher.timeout_index\r\n        if index >= 0:\r\n            spawn.match = TIMEOUT\r\n            spawn.match_index = index\r\n            return index\r\n        else:\r\n            spawn.match = None\r\n            spawn.match_index = None\r\n            msg = str(spawn)\r\n            msg += '\\nsearcher: %s' % self.searcher\r\n            if err is not None:\r\n                msg = str(err) + '\\n' + msg\r\n    \r\n            exc = TIMEOUT(msg)\r\n            exc.__cause__ = None    # in Python 3.x we can use \"raise exc from None\"\r\n>           raise exc\r\nE           pexpect.exceptions.TIMEOUT: Timeout exceeded.\r\nE           <pexpect.pty_spawn.spawn object at 0x7f9fa1526900>\r\nE           command: /usr/bin/python3\r\nE           args: ['/usr/bin/python3', '/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_pdb_used_outside_test0/test_pdb_used_outside_test.py']\r\nE           buffer (last 100 chars): b'est_pdb_used_outside_test0/test_pdb_used_outside_test.py(2)<module>()\\r\\n-> pytest.set_trace()\\r\\n(Pdb) '\r\nE           before (last 100 chars): b'est_pdb_used_outside_test0/test_pdb_used_outside_test.py(2)<module>()\\r\\n-> pytest.set_trace()\\r\\n(Pdb) '\r\nE           after: <class 'pexpect.exceptions.TIMEOUT'>\r\nE           match: None\r\nE           match_index: None\r\nE           exitstatus: None\r\nE           flag_eof: False\r\nE           pid: 1483\r\nE           child_fd: 18\r\nE           closed: False\r\nE           timeout: 10.0\r\nE           delimiter: <class 'pexpect.exceptions.EOF'>\r\nE           logfile: <_io.BufferedWriter name='/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_pdb_used_outside_test0/spawn.out'>\r\nE           logfile_read: None\r\nE           logfile_send: None\r\nE           maxread: 2000\r\nE           ignorecase: False\r\nE           searchwindowsize: None\r\nE           delaybeforesend: 0.05\r\nE           delayafterclose: 0.1\r\nE           delayafterterminate: 0.1\r\nE           searcher: searcher_re:\r\nE               0: re.compile(b'x = 5')\r\n\r\n/usr/lib/python3.13/site-packages/pexpect/expect.py:144: TIMEOUT\r\n___________________ TestPDB.test_pdb_used_in_generate_tests ____________________\r\n[gw1] linux -- Python 3.13.0 /usr/bin/python3\r\n\r\nself = <test_debugging.TestPDB object at 0x7f9fbabf6df0>\r\npytester = <Pytester PosixPath('/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_pdb_used_in_generate_tests0')>\r\n\r\n    def test_pdb_used_in_generate_tests(self, pytester: Pytester) -> None:\r\n        p1 = pytester.makepyfile(\r\n            \"\"\"\r\n            import pytest\r\n            def pytest_generate_tests(metafunc):\r\n                pytest.set_trace()\r\n                x = 5\r\n            def test_foo(a):\r\n                pass\r\n        \"\"\"\r\n        )\r\n        child = pytester.spawn_pytest(str(p1))\r\n>       child.expect(\"x = 5\")\r\n\r\n/builddir/build/BUILD/pytest-8.2.2-build/pytest-8.2.2/testing/test_debugging.py:788: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n/usr/lib/python3.13/site-packages/pexpect/spawnbase.py:354: in expect\r\n    return self.expect_list(compiled_pattern_list,\r\n/usr/lib/python3.13/site-packages/pexpect/spawnbase.py:383: in expect_list\r\n    return exp.expect_loop(timeout)\r\n/usr/lib/python3.13/site-packages/pexpect/expect.py:181: in expect_loop\r\n    return self.timeout(e)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nself = <pexpect.expect.Expecter object at 0x7f9fa135d010>\r\nerr = TIMEOUT('Timeout exceeded.')\r\n\r\n    def timeout(self, err=None):\r\n        spawn = self.spawn\r\n    \r\n        spawn.before = spawn._before.getvalue()\r\n        spawn.after = TIMEOUT\r\n        index = self.searcher.timeout_index\r\n        if index >= 0:\r\n            spawn.match = TIMEOUT\r\n            spawn.match_index = index\r\n            return index\r\n        else:\r\n            spawn.match = None\r\n            spawn.match_index = None\r\n            msg = str(spawn)\r\n            msg += '\\nsearcher: %s' % self.searcher\r\n            if err is not None:\r\n                msg = str(err) + '\\n' + msg\r\n    \r\n            exc = TIMEOUT(msg)\r\n            exc.__cause__ = None    # in Python 3.x we can use \"raise exc from None\"\r\n>           raise exc\r\nE           pexpect.exceptions.TIMEOUT: Timeout exceeded.\r\nE           <pexpect.pty_spawn.spawn object at 0x7f9fa135ecf0>\r\nE           command: /usr/bin/python3\r\nE           args: ['/usr/bin/python3', '-mpytest', '--basetemp=/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_pdb_used_in_generate_tests0/temp-pexpect', '/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_pdb_used_in_generate_tests0/test_pdb_used_in_generate_tests.py']\r\nE           buffer (last 100 chars): b'e_tests0/test_pdb_used_in_generate_tests.py(3)pytest_generate_tests()\\r\\n-> pytest.set_trace()\\r\\n(Pdb) '\r\nE           before (last 100 chars): b'e_tests0/test_pdb_used_in_generate_tests.py(3)pytest_generate_tests()\\r\\n-> pytest.set_trace()\\r\\n(Pdb) '\r\nE           after: <class 'pexpect.exceptions.TIMEOUT'>\r\nE           match: None\r\nE           match_index: None\r\nE           exitstatus: None\r\nE           flag_eof: False\r\nE           pid: 1484\r\nE           child_fd: 19\r\nE           closed: False\r\nE           timeout: 10.0\r\nE           delimiter: <class 'pexpect.exceptions.EOF'>\r\nE           logfile: <_io.BufferedWriter name='/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_pdb_used_in_generate_tests0/spawn.out'>\r\nE           logfile_read: None\r\nE           logfile_send: None\r\nE           maxread: 2000\r\nE           ignorecase: False\r\nE           searchwindowsize: None\r\nE           delaybeforesend: 0.05\r\nE           delayafterclose: 0.1\r\nE           delayafterterminate: 0.1\r\nE           searcher: searcher_re:\r\nE               0: re.compile(b'x = 5')\r\n\r\n/usr/lib/python3.13/site-packages/pexpect/expect.py:144: TIMEOUT\r\n=========================== short test summary info ============================\r\nSKIPPED [1] testing/_py/test_local.py:464: sys.version_info < (3,6)\r\nSKIPPED [1] testing/_py/test_local.py:469: sys.version_info < (3,6)\r\nSKIPPED [1] testing/_py/test_local.py:669: case-insensitive only on windows\r\nSKIPPED [1] testing/_py/test_local.py:890: condition: not (sys.platform == 'win32' or getattr(os, '_name', None) == 'nt')\r\nSKIPPED [1] testing/_py/test_local.py:1242: condition: not (sys.platform == 'win32' or getattr(os, '_name', None) == 'nt')\r\nSKIPPED [1] testing/_py/test_local.py:1248: condition: not (sys.platform == 'win32' or getattr(os, '_name', None) == 'nt')\r\nSKIPPED [1] testing/_py/test_local.py:1260: condition: not (sys.platform == 'win32' or getattr(os, '_name', None) == 'nt')\r\nSKIPPED [1] testing/_py/test_local.py:1266: condition: not (sys.platform == 'win32' or getattr(os, '_name', None) == 'nt')\r\nSKIPPED [1] testing/_py/test_local.py:1271: condition: not (sys.platform == 'win32' or getattr(os, '_name', None) == 'nt')\r\nSKIPPED [1] testing/_py/test_local.py:1279: condition: not (sys.platform == 'win32' or getattr(os, '_name', None) == 'nt')\r\nSKIPPED [1] testing/_py/test_local.py:1286: condition: not (sys.platform == 'win32' or getattr(os, '_name', None) == 'nt')\r\nSKIPPED [1] testing/test_tmpdir.py:359: win only\r\nSKIPPED [1] testing/test_capture.py:1435: only on windows\r\nSKIPPED [1] testing/test_findpaths.py:142: condition: sys.platform != 'win32'\r\nSKIPPED [1] testing/acceptance_test.py:1424: Test is not isolated\r\nSKIPPED [9] testing/code/test_excinfo.py:1678: could not import 'exceptiongroup': No module named 'exceptiongroup'\r\nSKIPPED [1] ../BUILDROOT/usr/lib/python3.13/site-packages/_pytest/pathlib.py:473: symlinks not supported: [Errno 17] File exists: '/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_collect_symlink_dir0/symlink_dir' -> '/tmp/pytest-of-mockbuild/pytest-0/popen-gw1/test_collect_symlink_dir0/dir'\r\nSKIPPED [1] testing/test_collection.py:1784: Windows only\r\nSKIPPED [1] testing/test_conftest.py:397: only relevant for case-insensitive file systems\r\nSKIPPED [1] testing/test_pathlib.py:547: Windows only\r\nSKIPPED [1] testing/test_pluginmanager.py:108: requires a case-insensitive file system\r\nSKIPPED [1] testing/test_unittest.py:1326: could not import 'asynctest': No module named 'asynctest'\r\nSKIPPED [3] testing/test_warnings.py:518: not relevant until pytest 9.0\r\nSKIPPED [1] testing/test_compat.py:97: coroutine removed\r\nSKIPPED [1] testing/test_faulthandler.py:72: sometimes crashes on CI (#7022)\r\n= 2 failed, 3607 passed, 35 skipped, 14 xfailed, 5 xpassed in 115.37s (0:01:55) =\r\n~~~~\r\n","closed_by":{"login":"The-Compiler","id":625793,"node_id":"MDQ6VXNlcjYyNTc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/625793?v=4","gravatar_id":"","url":"https://api.github.com/users/The-Compiler","html_url":"https://github.com/The-Compiler","followers_url":"https://api.github.com/users/The-Compiler/followers","following_url":"https://api.github.com/users/The-Compiler/following{/other_user}","gists_url":"https://api.github.com/users/The-Compiler/gists{/gist_id}","starred_url":"https://api.github.com/users/The-Compiler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/The-Compiler/subscriptions","organizations_url":"https://api.github.com/users/The-Compiler/orgs","repos_url":"https://api.github.com/users/The-Compiler/repos","events_url":"https://api.github.com/users/The-Compiler/events{/privacy}","received_events_url":"https://api.github.com/users/The-Compiler/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12497/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12497/timeline","performed_via_github_app":null,"state_reason":"completed"}