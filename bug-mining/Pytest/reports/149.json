{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/5578","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5578/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5578/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5578/events","html_url":"https://github.com/pytest-dev/pytest/issues/5578","id":465395430,"node_id":"MDU6SXNzdWU0NjUzOTU0MzA=","number":5578,"title":"pytest raises TypeError on parsing a specific test case","user":{"login":"ResidentMario","id":3466341,"node_id":"MDQ6VXNlcjM0NjYzNDE=","avatar_url":"https://avatars.githubusercontent.com/u/3466341?v=4","gravatar_id":"","url":"https://api.github.com/users/ResidentMario","html_url":"https://github.com/ResidentMario","followers_url":"https://api.github.com/users/ResidentMario/followers","following_url":"https://api.github.com/users/ResidentMario/following{/other_user}","gists_url":"https://api.github.com/users/ResidentMario/gists{/gist_id}","starred_url":"https://api.github.com/users/ResidentMario/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ResidentMario/subscriptions","organizations_url":"https://api.github.com/users/ResidentMario/orgs","repos_url":"https://api.github.com/users/ResidentMario/repos","events_url":"https://api.github.com/users/ResidentMario/events{/privacy}","received_events_url":"https://api.github.com/users/ResidentMario/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":224853076,"node_id":"MDU6TGFiZWwyMjQ4NTMwNzY=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20reporting","name":"topic: reporting","color":"fef2c0","default":false,"description":"related to terminal output and user-facing messages and errors"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-07-08T18:18:54Z","updated_at":"2019-07-09T22:12:06Z","closed_at":"2019-07-09T22:12:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The following sequence of commands creates an environment with `pytest` installed which fails repeatably on execution:\r\n\r\n```bash\r\nconda create --name missingno-dev seaborn pytest jupyter pandas scipy\r\nconda activate missingno-dev\r\ngit clone https://github.com/ResidentMario/missingno.git\r\ncd missingno\r\npip install -e .\r\ncd tests\r\npytest viz_tests.py\r\n```\r\n\r\nThe error text is:\r\n\r\n```\r\n(missingno-dev) Alexs-MacBook:tests alex$ pytest viz_tests.py \r\n============================= test session starts ==============================\r\nplatform darwin -- Python 3.7.3, pytest-5.0.1, py-1.8.0, pluggy-0.12.0\r\nMatplotlib: 3.1.1\r\nFreetype: 2.10.0\r\nrootdir: /Users/alex/Desktop/missingno\r\nplugins: mpl-0.10\r\ncollected 0 items                                                              \r\nINTERNALERROR> Traceback (most recent call last):\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/main.py\", line 213, in wrap_session\r\nINTERNALERROR>     session.exitstatus = doit(config, session) or 0\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/main.py\", line 256, in _main\r\nINTERNALERROR>     config.hook.pytest_collection(session=session)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/hooks.py\", line 289, in __call__\r\nINTERNALERROR>     return self._hookexec(self, self.get_hookimpls(), kwargs)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/manager.py\", line 87, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook, methods, kwargs)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/manager.py\", line 81, in <lambda>\r\nINTERNALERROR>     firstresult=hook.spec.opts.get(\"firstresult\") if hook.spec else False,\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/callers.py\", line 208, in _multicall\r\nINTERNALERROR>     return outcome.get_result()\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/callers.py\", line 80, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/callers.py\", line 187, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/main.py\", line 266, in pytest_collection\r\nINTERNALERROR>     return session.perform_collect()\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/main.py\", line 459, in perform_collect\r\nINTERNALERROR>     items = self._perform_collect(args, genitems)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/main.py\", line 498, in _perform_collect\r\nINTERNALERROR>     self.items.extend(self.genitems(node))\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/main.py\", line 717, in genitems\r\nINTERNALERROR>     rep = collect_one_node(node)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/runner.py\", line 368, in collect_one_node\r\nINTERNALERROR>     rep = ihook.pytest_make_collect_report(collector=collector)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/hooks.py\", line 289, in __call__\r\nINTERNALERROR>     return self._hookexec(self, self.get_hookimpls(), kwargs)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/manager.py\", line 87, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook, methods, kwargs)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/manager.py\", line 81, in <lambda>\r\nINTERNALERROR>     firstresult=hook.spec.opts.get(\"firstresult\") if hook.spec else False,\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/callers.py\", line 203, in _multicall\r\nINTERNALERROR>     gen.send(outcome)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/capture.py\", line 203, in pytest_make_collect_report\r\nINTERNALERROR>     rep = outcome.get_result()\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/callers.py\", line 80, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/pluggy/callers.py\", line 187, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/runner.py\", line 266, in pytest_make_collect_report\r\nINTERNALERROR>     collector.nodeid, outcome, longrepr, getattr(call, \"result\", None)\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/runner.py\", line 210, in result\r\nINTERNALERROR>     raise AttributeError(\"{!r} has no valid result\".format(self))\r\nINTERNALERROR>   File \"/Users/alex/miniconda3/envs/missingno-dev/lib/python3.7/site-packages/_pytest/runner.py\", line 238, in __repr__\r\nINTERNALERROR>     when=self.when, value=value, status=status\r\nINTERNALERROR> TypeError: __str__ returned non-string (type function)\r\n```\r\n\r\nThe test case which is causing this error is the following one (all other test cases work as expected):\r\n\r\n```python\r\nclass TestGeoplot(unittest.TestCase):\r\n    \"\"\"Integration tests only. The main function operations are handled by and tested in the `geoplot` package.\"\"\"\r\n\r\n    def setUp(self):\r\n        np.random.seed(42)\r\n        simple_df = pd.DataFrame((np.random.random((20, 10))), columns=range(0, 10))\r\n        simple_df = simple_df.add_prefix(\"r\")\r\n        self.x_y_df = simple_df\r\n\r\n    # @pytest.mark.mpl_image_compare\r\n    @pytest.xfail\r\n    def test_geoplot_quadtree(self):\r\n        msno.geoplot(self.x_y_df, x='r0', y='r1')\r\n        return plt.gcf()\r\n```\r\n\r\nThis isn't a failure in the library code (e.g. in `missingno`) because neither the test code nor the `setUp` code ever gets executed&mdash;`pytest` raises an internal error before it gets that far.\r\n\r\n`conda list` output is:\r\n\r\n```\r\n(missingno-dev) Alexs-MacBook:tests alex$ conda list\r\n# packages in environment at /Users/alex/miniconda3/envs/missingno-dev:\r\n#\r\n# Name                    Version                   Build  Channel\r\nappnope                   0.1.0                 py37_1000    conda-forge\r\natomicwrites              1.3.0                      py_0    conda-forge\r\nattrs                     19.1.0                     py_0    conda-forge\r\nbackcall                  0.1.0                      py_0    conda-forge\r\nbleach                    3.1.0                      py_0    conda-forge\r\nbzip2                     1.0.6             h1de35cc_1002    conda-forge\r\nca-certificates           2019.6.16            hecc5488_0    conda-forge\r\ncertifi                   2019.6.16                py37_0    conda-forge\r\ncycler                    0.10.0                     py_1    conda-forge\r\ndbus                      1.13.6               h2f22bb5_0    conda-forge\r\ndecorator                 4.4.0                      py_0    conda-forge\r\ndefusedxml                0.5.0                      py_1    conda-forge\r\nentrypoints               0.3                   py37_1000    conda-forge\r\nexpat                     2.2.5             h6de7cb9_1003    conda-forge\r\nfreetype                  2.10.0               h24853df_0    conda-forge\r\ngettext                   0.19.8.1          h46ab8bc_1002    conda-forge\r\nglib                      2.58.3            h9d45998_1001    conda-forge\r\nicu                       58.2              h0a44026_1000    conda-forge\r\nimportlib_metadata        0.18                     py37_0    conda-forge\r\nipykernel                 5.1.1            py37h24bf2e0_0    conda-forge\r\nipython                   7.6.1            py37h5ca1d4c_0    conda-forge\r\nipython_genutils          0.2.0                      py_1    conda-forge\r\nipywidgets                7.5.0                      py_0    conda-forge\r\njedi                      0.14.0                   py37_0    conda-forge\r\njinja2                    2.10.1                     py_0    conda-forge\r\njpeg                      9c                h1de35cc_1001    conda-forge\r\njsonschema                3.0.1                    py37_0    conda-forge\r\njupyter                   1.0.0                      py_2    conda-forge\r\njupyter_client            5.3.0                      py_0    conda-forge\r\njupyter_console           6.0.0                      py_0    conda-forge\r\njupyter_core              4.4.0                      py_0    conda-forge\r\nkiwisolver                1.1.0            py37h770b8ee_0    conda-forge\r\nlibblas                   3.8.0               10_openblas    conda-forge\r\nlibcblas                  3.8.0               10_openblas    conda-forge\r\nlibcxx                    8.0.0                         4    conda-forge\r\nlibcxxabi                 8.0.0                         4    conda-forge\r\nlibffi                    3.2.1             h6de7cb9_1006    conda-forge\r\nlibgfortran               3.0.1                         0    conda-forge\r\nlibiconv                  1.15              h01d97ff_1005    conda-forge\r\nliblapack                 3.8.0               10_openblas    conda-forge\r\nlibopenblas               0.3.6                hd44dcd8_4    conda-forge\r\nlibpng                    1.6.37               h2573ce8_0    conda-forge\r\nlibsodium                 1.0.16            h1de35cc_1001    conda-forge\r\nmarkupsafe                1.1.1            py37h1de35cc_0    conda-forge\r\nmatplotlib-base           3.1.1            py37h3a684a6_0    conda-forge\r\nmissingno                 0.4.1                     dev_0    <develop>\r\nmistune                   0.8.4           py37h1de35cc_1000    conda-forge\r\nmore-itertools            7.1.0                      py_0    conda-forge\r\nnbconvert                 5.5.0                      py_0    conda-forge\r\nnbformat                  4.4.0                      py_1    conda-forge\r\nncurses                   6.1               h0a44026_1002    conda-forge\r\nnose                      1.3.7                    pypi_0    pypi\r\nnotebook                  5.7.8                    py37_1    conda-forge\r\nnumpy                     1.16.4           py37h6b0580a_0    conda-forge\r\nopenblas                  0.3.6                hd44dcd8_4    conda-forge\r\nopenssl                   1.1.1b               h01d97ff_2    conda-forge\r\npackaging                 19.0                       py_0    conda-forge\r\npandas                    0.24.2           py37h86efe34_0    conda-forge\r\npandoc                    2.7.3                         0    conda-forge\r\npandocfilters             1.4.2                      py_1    conda-forge\r\nparso                     0.5.0                      py_0    conda-forge\r\npatsy                     0.5.1                      py_0    conda-forge\r\npcre                      8.41              h0a44026_1003    conda-forge\r\npexpect                   4.7.0                    py37_0    conda-forge\r\npickleshare               0.7.5                 py37_1000    conda-forge\r\npip                       19.1.1                   py37_0    conda-forge\r\npluggy                    0.12.0                     py_0    conda-forge\r\nprometheus_client         0.7.1                      py_0    conda-forge\r\nprompt_toolkit            2.0.9                      py_0    conda-forge\r\nptyprocess                0.6.0                   py_1001    conda-forge\r\npy                        1.8.0                      py_0    conda-forge\r\npygments                  2.4.2                      py_0    conda-forge\r\npyparsing                 2.4.0                      py_0    conda-forge\r\npyqt                      5.9.2            py37h2a560b1_0    conda-forge\r\npyrsistent                0.15.3           py37h01d97ff_0    conda-forge\r\npytest                    5.0.1                    py37_0    conda-forge\r\npytest-mpl                0.10                     pypi_0    pypi\r\npython                    3.7.3                h93065d6_1    conda-forge\r\npython-dateutil           2.8.0                      py_0    conda-forge\r\npytz                      2019.1                     py_0    conda-forge\r\npyzmq                     18.0.2           py37h2d07e9b_0    conda-forge\r\nqt                        5.9.7                h93ee506_2    conda-forge\r\nqtconsole                 4.5.1                      py_0    conda-forge\r\nreadline                  8.0                  hcfe32e1_0    conda-forge\r\nscipy                     1.3.0            py37hab3da7d_0    conda-forge\r\nseaborn                   0.9.0                      py_1    conda-forge\r\nsend2trash                1.5.0                      py_0    conda-forge\r\nsetuptools                41.0.1                   py37_0    conda-forge\r\nsip                       4.19.8          py37h0a44026_1000    conda-forge\r\nsix                       1.12.0                py37_1000    conda-forge\r\nsqlite                    3.28.0               hb7d70f7_1    conda-forge\r\nstatsmodels               0.10.0           py37heacc8b8_0    conda-forge\r\nterminado                 0.8.2                    py37_0    conda-forge\r\ntestpath                  0.4.2                   py_1001    conda-forge\r\ntk                        8.6.9             h2573ce8_1002    conda-forge\r\ntornado                   6.0.3            py37h01d97ff_0    conda-forge\r\ntraitlets                 4.3.2                 py37_1000    conda-forge\r\nwcwidth                   0.1.7                      py_1    conda-forge\r\nwebencodings              0.5.1                      py_1    conda-forge\r\nwheel                     0.33.4                   py37_0    conda-forge\r\nwidgetsnbextension        3.5.0                    py37_0    conda-forge\r\nxz                        5.2.4             h1de35cc_1001    conda-forge\r\nzeromq                    4.3.1             h0a44026_1000    conda-forge\r\nzipp                      0.5.1                      py_0    conda-forge\r\nzlib                      1.2.11            h1de35cc_1004    conda-forge\r\n```\r\n\r\nThis is using `conda 4.7.5` and `pip 19.1.1`.","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/5578/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/5578/timeline","performed_via_github_app":null,"state_reason":"completed"}