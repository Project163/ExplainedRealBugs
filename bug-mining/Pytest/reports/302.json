{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/9791","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9791/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9791/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9791/events","html_url":"https://github.com/pytest-dev/pytest/issues/9791","id":1174137151,"node_id":"I_kwDOAjwLdc5F--k_","number":9791,"title":"Error when running debugging using pytest in IDE with geopandas","user":{"login":"arengel","id":14152953,"node_id":"MDQ6VXNlcjE0MTUyOTUz","avatar_url":"https://avatars.githubusercontent.com/u/14152953?v=4","gravatar_id":"","url":"https://api.github.com/users/arengel","html_url":"https://github.com/arengel","followers_url":"https://api.github.com/users/arengel/followers","following_url":"https://api.github.com/users/arengel/following{/other_user}","gists_url":"https://api.github.com/users/arengel/gists{/gist_id}","starred_url":"https://api.github.com/users/arengel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arengel/subscriptions","organizations_url":"https://api.github.com/users/arengel/orgs","repos_url":"https://api.github.com/users/arengel/repos","events_url":"https://api.github.com/users/arengel/events{/privacy}","received_events_url":"https://api.github.com/users/arengel/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-03-19T01:23:55Z","updated_at":"2022-06-27T12:58:39Z","closed_at":"2022-06-27T12:58:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I ran into an error today while running a test in debug mode using PyCharm (I found the same issue on VS Code as well) when geopandas is imported. Outside of debug mode it seems to work fine. I've also found that downgrading pytest to 6.2.4 resolves the issue.\r\n\r\nI was able to reproduce the problem by setting up a test environment using conda: A simple test script with a breakpoint set at the assert statement produces the error below\r\n\r\n`conda create --name test --channel=conda-forge python pytest geopandas`\r\n\r\nToday when I set it up that command resulted in the following version being installed (full list of packages installed below):\r\n`python=3.10.2\r\npytest=7.1.1\r\ngeopandas=0.10.2`\r\n\r\nI am using an ARM Mac running macOS 12.3, I've also gotten the same result on an Intel Mac macOS 11.6.4.\r\n\r\n```python \r\nimport geopandas\r\n\r\n\r\ndef test_pytest_and_geopandas():\r\n    assert False\r\n```\r\nA simple test script with a breakpoint set at the assert statement like that above produces the following error if the test is run in debug mode in PyCharm:\r\n```\r\nINTERNALERROR> Traceback (most recent call last):\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/_pytest/main.py\", line 268, in wrap_session\r\nINTERNALERROR>     session.exitstatus = doit(config, session) or 0\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/_pytest/main.py\", line 321, in _main\r\nINTERNALERROR>     config.hook.pytest_collection(session=session)\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_hooks.py\", line 265, in __call__\r\nINTERNALERROR>     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_manager.py\", line 80, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_callers.py\", line 60, in _multicall\r\nINTERNALERROR>     return outcome.get_result()\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_result.py\", line 60, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_callers.py\", line 39, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/_pytest/main.py\", line 332, in pytest_collection\r\nINTERNALERROR>     session.perform_collect()\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/_pytest/main.py\", line 644, in perform_collect\r\nINTERNALERROR>     self.ihook.pytest_collectreport(report=rep)\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_hooks.py\", line 265, in __call__\r\nINTERNALERROR>     return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_manager.py\", line 80, in _hookexec\r\nINTERNALERROR>     return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_callers.py\", line 60, in _multicall\r\nINTERNALERROR>     return outcome.get_result()\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_result.py\", line 60, in get_result\r\nINTERNALERROR>     raise ex[1].with_traceback(ex[2])\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/pluggy/_callers.py\", line 39, in _multicall\r\nINTERNALERROR>     res = hook_impl.function(*args)\r\nINTERNALERROR>   File \"/Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/teamcity/pytest_plugin.py\", line 328, in pytest_collectreport\r\nINTERNALERROR>     self.report_test_failure(test_id, report)\r\nINTERNALERROR>   File \"/Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/teamcity/pytest_plugin.py\", line 223, in report_test_failure\r\nINTERNALERROR>     self.ensure_test_start_reported(test_id)\r\nINTERNALERROR>   File \"/Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/teamcity/pytest_plugin.py\", line 186, in ensure_test_start_reported\r\nINTERNALERROR>     self.teamcity.testStarted(test_id, flowId=test_id, captureStandardOutput=capture_standard_output, metainfo=metainfo)\r\nINTERNALERROR>   File \"/Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/_jb_runner_tools.py\", line 181, in testStarted\r\nINTERNALERROR>     commands = _TREE_MANAGER_HOLDER.manager.level_opened(self._test_to_list(testName), _write_start_message)\r\nINTERNALERROR>   File \"/Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/_jb_runner_tools.py\", line 51, in manager\r\nINTERNALERROR>     self._fill_manager()\r\nINTERNALERROR>   File \"/Applications/PyCharm.app/Contents/plugins/python/helpers/pycharm/_jb_runner_tools.py\", line 59, in _fill_manager\r\nINTERNALERROR>     from _jb_serial_tree_manager import SerialTreeManager\r\nINTERNALERROR>   File \"<frozen importlib._bootstrap>\", line 1027, in _find_and_load\r\nINTERNALERROR>   File \"<frozen importlib._bootstrap>\", line 1002, in _find_and_load_unlocked\r\nINTERNALERROR>   File \"<frozen importlib._bootstrap>\", line 945, in _find_spec\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/_pytest/assertion/rewrite.py\", line 92, in find_spec\r\nINTERNALERROR>     if self._early_rewrite_bailout(name, state):\r\nINTERNALERROR>   File \"/Users/aengel/miniconda3/envs/test/lib/python3.10/site-packages/_pytest/assertion/rewrite.py\", line 193, in _early_rewrite_bailout\r\nINTERNALERROR>     path = PurePath(os.path.sep.join(parts) + \".py\")\r\nINTERNALERROR> AttributeError: module 'posixpath' has no attribute 'sep'\r\n```\r\nor VS Code\r\n```\r\ntests[/test_addl.py:10](): in <module>\r\n    import geopandas\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/geopandas/__init__.py:1](): in <module>\r\n    from geopandas._config import options  # noqa\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/geopandas/_config.py:109](): in <module>\r\n    default_value=_default_use_pygeos(),\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/geopandas/_config.py:95](): in _default_use_pygeos\r\n    import geopandas._compat as compat\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/geopandas/_compat.py:9](): in <module>\r\n    import pyproj\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/pyproj/__init__.py:93](): in <module>\r\n    pyproj.network.set_ca_bundle_path()\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/pyproj/network.py:51](): in set_ca_bundle_path\r\n    ca_bundle_path = certifi.where()\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/certifi/core.py:36](): in where\r\n    _CACERT_CTX = get_path(\"certifi\", \"cacert.pem\")\r\n.[./../miniconda3/envs/test/lib/python3.10/importlib/resources.py:119](): in path\r\n    reader = _common.get_resource_reader(_common.get_package(package))\r\n.[./../miniconda3/envs/test/lib/python3.10/importlib/_common.py:52](): in get_resource_reader\r\n    return reader(spec.name)  # type: ignore\r\n<frozen importlib._bootstrap_external>:548: in _check_name_wrapper\r\n    ???\r\n<frozen importlib._bootstrap_external>:1081: in get_resource_reader\r\n    ???\r\n<frozen importlib._bootstrap>:1027: in _find_and_load\r\n    ???\r\n<frozen importlib._bootstrap>:1002: in _find_and_load_unlocked\r\n    ???\r\n<frozen importlib._bootstrap>:945: in _find_spec\r\n    ???\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:92](): in find_spec\r\n    if self._early_rewrite_bailout(name, state):\r\n.[./../miniconda3/envs/test/lib/python3.10/site-packages/_pytest/assertion/rewrite.py:193](): in _early_rewrite_bailout\r\n    path = PurePath(os.path.sep.join(parts) + \".py\")\r\nE   AttributeError: module 'posixpath' has no attribute 'sep'\r\n```\r\n\r\n\r\n\r\n```\r\nPackage            Version\r\n------------------ ------------\r\nattrs              21.4.0\r\nbranca             0.4.2\r\nbrotlipy           0.7.0\r\ncertifi            2021.10.8\r\ncffi               1.15.0\r\ncharset-normalizer 2.0.12\r\nclick              8.0.4\r\nclick-plugins      1.1.1\r\ncligj              0.7.2\r\ncryptography       36.0.1\r\ncycler             0.11.0\r\nFiona              1.8.21\r\nfolium             0.12.1.post1\r\nfonttools          4.31.1\r\nGDAL               3.4.2\r\ngeopandas          0.10.2\r\nidna               3.3\r\niniconfig          1.1.1\r\nJinja2             3.0.3\r\njoblib             1.1.0\r\nkiwisolver         1.4.0\r\nmapclassify        2.4.3\r\nMarkupSafe         2.1.1\r\nmatplotlib         3.5.1\r\nmunch              2.5.0\r\nmunkres            1.1.4\r\nnetworkx           2.7.1\r\nnumpy              1.22.3\r\npackaging          21.3\r\npandas             1.4.1\r\nPillow             9.0.1\r\npip                22.0.4\r\npluggy             1.0.0\r\npy                 1.11.0\r\npycparser          2.21\r\npyOpenSSL          22.0.0\r\npyparsing          3.0.7\r\npyproj             3.3.0\r\nPySocks            1.7.1\r\npytest             7.1.1\r\npython-dateutil    2.8.2\r\npytz               2021.3\r\nrequests           2.27.1\r\nRtree              0.9.7\r\nscikit-learn       1.0.2\r\nscipy              1.8.0\r\nsetuptools         60.10.0\r\nShapely            1.8.0\r\nsix                1.16.0\r\nthreadpoolctl      3.1.0\r\ntomli              2.0.1\r\nunicodedata2       14.0.0\r\nurllib3            1.26.9\r\nwheel              0.37.1\r\nxyzservices        2022.3.0\r\n```","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/9791/reactions","total_count":6,"+1":6,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9791/timeline","performed_via_github_app":null,"state_reason":"completed"}