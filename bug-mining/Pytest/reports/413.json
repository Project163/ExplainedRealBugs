{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12039","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12039/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12039/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12039/events","html_url":"https://github.com/pytest-dev/pytest/issues/12039","id":2157578471,"node_id":"I_kwDOAjwLdc6Amgjn","number":12039,"title":"Pytest 8.0.2 may collect tests multiple times under Windows","user":{"login":"mrbean-bremen","id":4623701,"node_id":"MDQ6VXNlcjQ2MjM3MDE=","avatar_url":"https://avatars.githubusercontent.com/u/4623701?v=4","gravatar_id":"","url":"https://api.github.com/users/mrbean-bremen","html_url":"https://github.com/mrbean-bremen","followers_url":"https://api.github.com/users/mrbean-bremen/followers","following_url":"https://api.github.com/users/mrbean-bremen/following{/other_user}","gists_url":"https://api.github.com/users/mrbean-bremen/gists{/gist_id}","starred_url":"https://api.github.com/users/mrbean-bremen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrbean-bremen/subscriptions","organizations_url":"https://api.github.com/users/mrbean-bremen/orgs","repos_url":"https://api.github.com/users/mrbean-bremen/repos","events_url":"https://api.github.com/users/mrbean-bremen/events{/privacy}","received_events_url":"https://api.github.com/users/mrbean-bremen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2024-02-27T20:52:31Z","updated_at":"2024-03-03T12:41:33Z","closed_at":"2024-03-03T12:41:32Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm not quite sure if this is a bug, or a problem with the test or GitHub Actions, but since version 8.0.2 a test in `pytest-order` fails in the CI under Windows, which worked fine in 8.0.1 and previous versions. Linux and macOS tests are not affected.\r\n\r\nPytest run environment in the CI:\r\n```\r\nplatform win32 -- Python 3.11.8, pytest-8.0.2, pluggy-1.4.0 -- D:\\a\\pytest-order\\pytest-order\\.tox\\py311-pytest80\\Scripts\\python.EXE\r\ncachedir: .tox\\py311-pytest80\\.pytest_cache\r\nrootdir: D:\\a\\pytest-order\\pytest-order\r\nplugins: cov-2.9.0, dependency-0.6.0, mock-3.12.0, xdist-3.5.0\r\n```\r\nThe same happens for Python 3.8 - 3.12.\r\n\r\nThe [actual test](https://github.com/pytest-dev/pytest-order/blob/main/tests/test_xdist_handling.py) should collect 6 items (3 tests per test module, in 2 modules) that are created in the directory provided by the `tempdir` fixture, \r\nbut collects 24 tests in the CI instead. Locally, it works as expected.\r\n\r\nChecking the failed tests revealed that the tests have been collected from different locations. The tempdir had been at:\r\n`C:\\\\Users\\\\runneradmin\\\\AppData\\\\Local\\\\Temp\\\\pytest-of-runneradmin\\\\pytest-9\\\\test_xdist_ordering0` \r\n(for a specific run), but the same tests have been discovered with a test ID with just the qualified test name, and additionally with the test IDs:\r\n`::::Users::runneradmin::AppData::Local::Temp::pytest-of-runneradmin::pytest-9:::xxx` and \r\n`::::Documents and Settings::runneradmin::AppData::Local::Temp::pytest-of-runneradmin::pytest-9::xxx`,\r\nwhich are most likely aliases.\r\n\r\nI haven't dug into this yet, but I suspect it may have something to do with the fix for [the problem with short paths](https://github.com/pytest-dev/pytest/issues/11895).\r\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12039/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12039/timeline","performed_via_github_app":null,"state_reason":"completed"}