{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11311","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11311/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11311/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11311/events","html_url":"https://github.com/pytest-dev/pytest/issues/11311","id":1849777738,"node_id":"I_kwDOAjwLdc5uQV5K","number":11311,"title":"AssertionError triggered by `pytest --override-ini='pythonpath=foo'`","user":{"login":"miccoli","id":6403904,"node_id":"MDQ6VXNlcjY0MDM5MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/6403904?v=4","gravatar_id":"","url":"https://api.github.com/users/miccoli","html_url":"https://github.com/miccoli","followers_url":"https://api.github.com/users/miccoli/followers","following_url":"https://api.github.com/users/miccoli/following{/other_user}","gists_url":"https://api.github.com/users/miccoli/gists{/gist_id}","starred_url":"https://api.github.com/users/miccoli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/miccoli/subscriptions","organizations_url":"https://api.github.com/users/miccoli/orgs","repos_url":"https://api.github.com/users/miccoli/repos","events_url":"https://api.github.com/users/miccoli/events{/privacy}","received_events_url":"https://api.github.com/users/miccoli/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":705853693,"node_id":"MDU6TGFiZWw3MDU4NTM2OTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20config","name":"topic: config","color":"006b75","default":false,"description":"related to config handling, argument parsing and config file"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2023-08-14T13:27:12Z","updated_at":"2024-02-14T18:53:29Z","closed_at":"2024-02-14T18:53:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Description\r\n\r\nThe option `--override-ini='pythonpath=foo'` may trigger an `AssertionError`.\r\n\r\n## Minimal example\r\n\r\nRunning `pytest --override-ini='pythonpath=foo'` in an *empty* directory fails with\r\n```\r\nTraceback (most recent call last):\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 1495, in getini\r\n    return self._inicache[name]\r\n           ~~~~~~~~~~~~~~^^^^^^\r\nKeyError: 'pythonpath'\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"/Users/miccoli/.pyenv/versions/_pytest_bug/bin/pytest\", line 8, in <module>\r\n    sys.exit(console_main())\r\n             ^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 189, in console_main\r\n    code = main()\r\n           ^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 147, in main\r\n    config = _prepareconfig(args, plugins)\r\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 328, in _prepareconfig\r\n    config = pluginmanager.hook.pytest_cmdline_parse(\r\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_hooks.py\", line 433, in __call__\r\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_manager.py\", line 112, in _hookexec\r\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_callers.py\", line 133, in _multicall\r\n    teardown[0].send(outcome)\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/helpconfig.py\", line 103, in pytest_cmdline_parse\r\n    config: Config = outcome.get_result()\r\n                     ^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_result.py\", line 108, in get_result\r\n    raise exc.with_traceback(exc.__traceback__)\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_callers.py\", line 80, in _multicall\r\n    res = hook_impl.function(*args)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 1075, in pytest_cmdline_parse\r\n    self.parse(args)\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 1425, in parse\r\n    self._preparse(args, addopts=addopts)\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 1327, in _preparse\r\n    self.hook.pytest_load_initial_conftests(\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_hooks.py\", line 433, in __call__\r\n    return self._hookexec(self.name, self._hookimpls, kwargs, firstresult)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_manager.py\", line 112, in _hookexec\r\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_callers.py\", line 155, in _multicall\r\n    return outcome.get_result()\r\n           ^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_result.py\", line 108, in get_result\r\n    raise exc.with_traceback(exc.__traceback__)\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/pluggy/_callers.py\", line 80, in _multicall\r\n    res = hook_impl.function(*args)\r\n          ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/python_path.py\", line 15, in pytest_load_initial_conftests\r\n    for path in reversed(early_config.getini(\"pythonpath\")):\r\n                         ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 1497, in getini\r\n    self._inicache[name] = val = self._getini(name)\r\n                                 ^^^^^^^^^^^^^^^^^^\r\n  File \"/Users/miccoli/.pyenv/versions/3.11.4/envs/_pytest_bug/lib/python3.11/site-packages/_pytest/config/__init__.py\", line 1540, in _getini\r\n    assert self.inipath is not None\r\n           ^^^^^^^^^^^^^^^^^^^^^^^^\r\nAssertionError\r\n```\r\n\r\n## Output of `pip list` and enviornment\r\n\r\n```\r\nPackage    Version\r\n---------- -------\r\niniconfig  2.0.0\r\npackaging  23.1\r\npip        23.2.1\r\npluggy     1.2.0\r\npytest     7.4.0\r\nsetuptools 65.5.0\r\n```\r\n\r\nRun on `macOS-13.2.1-x86_64-i386-64bit`, but same problem also on linux.\r\n\r\n## Context\r\n\r\nI stumbled in this error while building a python package for Arch: instead of using\r\n```bash\r\ncheck(){\r\n    cd \"$_name-$pkgver\"\r\n    PYTHONPATH=src pytest\r\n}\r\n```\r\nI tried \r\n```bash\r\ncheck(){\r\n    cd \"$_name-$pkgver\"\r\n    pytest -o pythonpath=src\r\n}\r\n```\r\nwhich fails with the above traceback.\r\n\r\nI replicated the problem on a MacOs stripped down venv just to be sure that it is not related to the ArchLinux build env, which is quite complicated.\r\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11311/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11311/timeline","performed_via_github_app":null,"state_reason":"completed"}