{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/9608","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9608/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9608/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9608/events","html_url":"https://github.com/pytest-dev/pytest/issues/9608","id":1124611590,"node_id":"I_kwDOAjwLdc5DCDYG","number":9608,"title":"No module importlib.readers breaks pytest==7.0.0 with python 3.9","user":{"login":"kdelee","id":29239279,"node_id":"MDQ6VXNlcjI5MjM5Mjc5","avatar_url":"https://avatars.githubusercontent.com/u/29239279?v=4","gravatar_id":"","url":"https://api.github.com/users/kdelee","html_url":"https://github.com/kdelee","followers_url":"https://api.github.com/users/kdelee/followers","following_url":"https://api.github.com/users/kdelee/following{/other_user}","gists_url":"https://api.github.com/users/kdelee/gists{/gist_id}","starred_url":"https://api.github.com/users/kdelee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kdelee/subscriptions","organizations_url":"https://api.github.com/users/kdelee/orgs","repos_url":"https://api.github.com/users/kdelee/repos","events_url":"https://api.github.com/users/kdelee/events{/privacy}","received_events_url":"https://api.github.com/users/kdelee/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":315571544,"node_id":"MDU6TGFiZWwzMTU1NzE1NDQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20regression","name":"type: regression","color":"f7c6c7","default":false,"description":"indicates a problem that was introduced in a release which was working previously"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2022-02-04T20:59:26Z","updated_at":"2022-02-12T00:44:21Z","closed_at":"2022-02-08T13:57:49Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nThanks for submitting an issue!\r\n\r\nQuick check-list while reporting bugs:\r\n-->\r\n\r\nMy project is using python 3.9 and we hit this today when 7.0.0 released:\r\nhttps://github.com/pytest-dev/pytest/blob/5eb4d6977cf3604070172af018e84dc2d4cbcdee/src/_pytest/assertion/rewrite.py#L279-L283\r\nBecause this import does not seem to be working/reference existing code\r\n```\r\n/var/lib/awx/venv/awx/lib64/python3.9/site-packages/_pytest/assertion/rewrite.py:283: in get_resource_reader\r\n    from importlib.readers import FileReader\r\nE   ModuleNotFoundError: No module named 'importlib.readers'\r\n```\r\nIf you'd like to see where this is happening on our CI, I'm pretty sure you can see the logs for the `api-test` stage here https://github.com/ansible/awx/runs/5072172116?check_suite_focus=true\r\n\r\n\r\n\r\nDowngrading pytest fixes the issue, so it seems to a problem exclusively in 7.0.0 right now.\r\n\r\n- [x] a detailed description of the bug or problem you are having\r\n- [x] output of `pip list` from the virtual environment you are using [piplist.txt](https://github.com/pytest-dev/pytest/files/8006185/piplist.txt)\r\n- [x] pytest==7.0.0 \r\n- [x] CentOS Stream release 9 \r\n- [x] minimal example if possible\r\n\r\nThis minimal reproducer re-creates the error:\r\nsay we have `broken.py` with the following contents\r\n```\r\nfrom pip._internal.req import parse_requirements\r\n\r\n\r\ndef test_broken():\r\n    assert True\r\n```\r\n\r\nthen running `pytest broken.py` results in\r\n```\r\n==================================================================================== test session starts =====================================================================================\r\nplatform linux -- Python 3.9.10, pytest-7.0.0, pluggy-1.0.0\r\ndjango: settings: awx.settings.development (from ini)\r\nrootdir: /awx_devel, configfile: pytest.ini\r\nplugins: mock-1.11.1, forked-1.4.0, django-4.5.2, xdist-1.34.0, cov-3.0.0, timeout-2.1.0\r\ncollected 0 items / 1 error                                                                                                                                                                  \r\n\r\n=========================================================================================== ERRORS ===========================================================================================\r\n_________________________________________________________________________________ ERROR collecting broken.py _________________________________________________________________________________\r\nImportError while importing test module '/awx_devel/broken.py'.\r\nHint: make sure your test modules/packages have valid Python names.\r\nTraceback:\r\n/usr/lib64/python3.9/importlib/__init__.py:127: in import_module\r\n    return _bootstrap._gcd_import(name[level:], package, level)\r\nbroken.py:1: in <module>\r\n    from pip._internal.req import parse_requirements\r\n/var/lib/awx/venv/awx/lib64/python3.9/site-packages/pip/_internal/req/__init__.py:5: in <module>\r\n    from pip._internal.utils.logging import indent_log\r\n/var/lib/awx/venv/awx/lib64/python3.9/site-packages/pip/_internal/utils/logging.py:23: in <module>\r\n    from pip._internal.exceptions import DiagnosticPipError\r\n/var/lib/awx/venv/awx/lib64/python3.9/site-packages/pip/_internal/exceptions.py:13: in <module>\r\n    from pip._vendor.requests.models import Request, Response\r\n/var/lib/awx/venv/awx/lib64/python3.9/site-packages/pip/_vendor/requests/__init__.py:135: in <module>\r\n    from . import utils\r\n/var/lib/awx/venv/awx/lib64/python3.9/site-packages/pip/_vendor/requests/utils.py:42: in <module>\r\n    DEFAULT_CA_BUNDLE_PATH = certs.where()\r\n/var/lib/awx/venv/awx/lib64/python3.9/site-packages/pip/_vendor/certifi/core.py:50: in where\r\n    _CACERT_CTX = get_path(\"pip._vendor.certifi\", \"cacert.pem\")\r\n/usr/lib64/python3.9/importlib/resources.py:161: in path\r\n    reader = _get_resource_reader(_get_package(package))\r\n/usr/lib64/python3.9/importlib/resources.py:76: in _get_resource_reader\r\n    spec.loader.get_resource_reader(spec.name))\r\nE   ModuleNotFoundError: No module named 'importlib.readers'\r\n================================================================================== short test summary info ===================================================================================\r\nERROR broken.py\r\n!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! Interrupted: 1 error during collection !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n================================================================================ 5 warnings, 1 error in 1.15s ================================================================================\r\n```\r\n\r\n\r\n","closed_by":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/9608/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/9608/timeline","performed_via_github_app":null,"state_reason":"completed"}