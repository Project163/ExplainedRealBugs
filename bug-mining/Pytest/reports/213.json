{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/7514","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/7514/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/7514/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/7514/events","html_url":"https://github.com/pytest-dev/pytest/issues/7514","id":660790086,"node_id":"MDU6SXNzdWU2NjA3OTAwODY=","number":7514,"title":"Mutation in parameterized value is seen across repeated calls of the test-case","user":{"login":"ankostis","id":501585,"node_id":"MDQ6VXNlcjUwMTU4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/501585?v=4","gravatar_id":"","url":"https://api.github.com/users/ankostis","html_url":"https://github.com/ankostis","followers_url":"https://api.github.com/users/ankostis/followers","following_url":"https://api.github.com/users/ankostis/following{/other_user}","gists_url":"https://api.github.com/users/ankostis/gists{/gist_id}","starred_url":"https://api.github.com/users/ankostis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ankostis/subscriptions","organizations_url":"https://api.github.com/users/ankostis/orgs","repos_url":"https://api.github.com/users/ankostis/repos","events_url":"https://api.github.com/users/ankostis/events{/privacy}","received_events_url":"https://api.github.com/users/ankostis/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849198,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTg=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20question","name":"type: question","color":"cc317c","default":false,"description":"general question, might be closed after 2 weeks of inactivity"},{"id":240496914,"node_id":"MDU6TGFiZWwyNDA0OTY5MTQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20parametrize","name":"topic: parametrize","color":"fbca04","default":false,"description":"related to @pytest.mark.parametrize"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2020-07-19T11:52:15Z","updated_at":"2020-07-19T16:19:58Z","closed_at":"2020-07-19T14:51:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"(couldn't find any relevant issue but #237)\r\nI'm running a parameterized test-case with a mutable parameter `param_dict` that gets modified in the test-case code\r\n(the param has a single value, for simplicity).\r\nThe test-case runs twice due to some other parameter, `run_twice`.\r\nThe modification leaks to the next test-case run;  \r\nis that on purpose?\r\n\r\n```python\r\nimport pytest\r\n\r\n@pytest.fixture(params=[0, 1])\r\ndef run_twice(request):\r\n    pass\r\n\r\n\r\n@pytest.mark.parametrize(\"param_dict\", [[1]])  # this parameter leaks across runs\r\ndef test_mutate_params(param_dict, run_twice):\r\n    assert param_dict == [1]\r\n    # mutation seen from subsequent test-case run.\r\n    del param_dict[0]\r\n```\r\n...which passes only the 1st time:\r\n```\r\nplatform linux -- Python 3.8.3, pytest-5.3.5, py-1.9.0, pluggy-0.13.1\r\nrootdir: ../pytest-mutate_params\r\nplugins: cov-2.8.1, xonsh-0.9.18\r\ncollected 2 items                                                                                                                                             \r\n\r\ntest_mutate_param.py .F                                                                                                                                 [100%]\r\n\r\n================================== FAILURES ==================================\r\n______________________ test_mutate_params[1-param_dict0] _____________________\r\n\r\nparam_dict = [], fixt = None\r\n\r\n    @pytest.mark.parametrize(\"param_dict\", [[1]])\r\n    def test_mutate_params(param_dict, run_twice):\r\n>       assert param_dict == [1]\r\nE       assert [] == [1]\r\nE         Right contains one more item: 1\r\nE         Use -v to get the full diff\r\n\r\ntest_mutate_param.py:12: AssertionError\r\n========================= 1 failed, 1 passed in 0.03s =========================\r\n\r\n``` \r\n\r\n## Environment\r\n```\r\n$ pip list | grep pytest\r\npytest                             5.3.5\r\npytest-cov                         2.8.1\r\n```\r\nLinux, but i guess it doesn't make a difference.","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/7514/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/7514/timeline","performed_via_github_app":null,"state_reason":"completed"}