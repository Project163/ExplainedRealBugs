{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12765","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12765/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12765/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12765/events","html_url":"https://github.com/pytest-dev/pytest/issues/12765","id":2501205612,"node_id":"I_kwDOAjwLdc6VFV5s","number":12765,"title":"Customisable truncation limits","user":{"login":"zhukoff-pavel","id":48322035,"node_id":"MDQ6VXNlcjQ4MzIyMDM1","avatar_url":"https://avatars.githubusercontent.com/u/48322035?v=4","gravatar_id":"","url":"https://api.github.com/users/zhukoff-pavel","html_url":"https://github.com/zhukoff-pavel","followers_url":"https://api.github.com/users/zhukoff-pavel/followers","following_url":"https://api.github.com/users/zhukoff-pavel/following{/other_user}","gists_url":"https://api.github.com/users/zhukoff-pavel/gists{/gist_id}","starred_url":"https://api.github.com/users/zhukoff-pavel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhukoff-pavel/subscriptions","organizations_url":"https://api.github.com/users/zhukoff-pavel/orgs","repos_url":"https://api.github.com/users/zhukoff-pavel/repos","events_url":"https://api.github.com/users/zhukoff-pavel/events{/privacy}","received_events_url":"https://api.github.com/users/zhukoff-pavel/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2024-09-02T15:19:06Z","updated_at":"2024-09-21T13:00:57Z","closed_at":"2024-09-21T13:00:57Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi! \r\nI've recently encountered a problem regarding basic truncation limits.\r\n\r\n### What's the problem this feature will solve?\r\n[Truncation method](https://github.com/pytest-dev/pytest/blob/main/src/_pytest/assertion/truncate.py#L36-L37) allows to set custom `max_lines`, `max_chars`, but this mechanism is not used in its only call [here](https://github.com/pytest-dev/pytest/blob/main/src/_pytest/assertion/truncate.py#L24), even when `max_length` (I guess it is used as a synonym to `max_chars`) can be specified in `truncate_if_required`.\r\nHowever, `truncate_if_required` is not called with any length parameter (see [this invocation](https://github.com/pytest-dev/pytest/blob/main/src/_pytest/assertion/__init__.py#L156)).\r\n\r\nIn its basic form, it produces quite small diff, that may not be as intelligible as it is expected to be :(\r\n\r\n#### Example\r\ntest.py file: \r\n```py\r\nstring_a = \"\"\"\r\nCode sample:\r\ndef a():\r\n    print(10000) #comment\r\n    do_something()\r\n\r\ndef b():\r\n    print(100000) #comment\r\n    do_something()\r\n\"\"\"\r\n\r\nstring_b = \"\"\"\r\nCode sample:\r\ndef a():\r\n    print(10000) # comment\r\n    do_something()\r\n\r\ndef b():\r\n    print(100000) # comment\r\n    do_something()\r\n\"\"\"\r\n\r\ndef test():\r\n    assert string_a == string_b\r\n\r\n```\r\n\r\nThis results in \r\n\r\n```\r\n% pytest test.py\r\n============================================================================================== test session starts ==============================================================================================\r\nplatform darwin -- Python 3.12.3, pytest-8.3.2, pluggy-1.5.0\r\nrootdir: <root-dir>\r\ncollected 1 item                                                                                                                                                                                                \r\n\r\ntest.py F                                                                                                                                                                                                 [100%]\r\n\r\n=================================================================================================== FAILURES ====================================================================================================\r\n_____________________________________________________________________________________________________ test ______________________________________________________________________________________________________\r\n\r\n    def test():\r\n>       assert string_a == string_b\r\nE       AssertionError: assert '\\nCode sampl...something()\\n' == '\\nCode sampl...something()\\n'\r\nE         \r\nE           \r\nE           Code sample:\r\nE           def a():\r\nE         -     print(10000) # comment\r\nE         ?                   -\r\nE         +     print(10000) #comment...\r\nE         \r\nE         ...Full output truncated (7 lines hidden), use '-vv' to show\r\n\r\ntest.py:26: AssertionError\r\n============================================================================================ short test summary info ============================================================================================\r\nFAILED test.py::test - AssertionError: assert '\\nCode sampl...something()\\n' == '\\nCode sampl...something()\\n'\r\n=============================================================================================== 1 failed in 0.01s ===============================================================================================\r\n                                                                                                      \r\n```\r\nAs seen here, second diff is hidden, when it appears in full diff (with `-vv` flag specified) (see below):\r\n\r\n```\r\n    def test():\r\n>       assert string_a == string_b\r\nE       AssertionError: assert '\\nCode sample:\\ndef a():\\n    print(10000) #comment\\n    do_something()\\n\\ndef b():\\n    print(100000) #comment\\n    do_something()\\n' == '\\nCode sample:\\ndef a():\\n    print(10000) # comment\\n    do_something()\\n\\ndef b():\\n    print(100000) # comment\\n    do_something()\\n'\r\nE         \r\nE           \r\nE           Code sample:\r\nE           def a():\r\nE         -     print(10000) # comment\r\nE         ?                   -\r\nE         +     print(10000) #comment\r\nE               do_something()\r\nE           \r\nE           def b():\r\nE         -     print(100000) # comment\r\nE         ?                    -\r\nE         +     print(100000) #comment\r\nE               do_something()\r\n\r\ntest.py:24: AssertionError\r\n``` \r\n\r\n### Describe the solution you'd like\r\n\r\nSome solutions are as follows: \r\n1. Increase the threshold of truncation (e.g. to 16 lines and respectively, to 16 * 80 chars), but this is still not customisable.\r\n2. Make those limits customizable (for example, with CLI flags (`--truncation-limit-lines` and `--truncation-limit-chars` or something like that). \r\n\r\n### Additional solutions\r\nThis may be surpassed by adding `-vv` flag, however, there are some problems with this mode, for example, #8998.\r\n","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/12765/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/12765/timeline","performed_via_github_app":null,"state_reason":"completed"}