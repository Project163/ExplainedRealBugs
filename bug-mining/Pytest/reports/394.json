{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11758","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11758/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11758/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11758/events","html_url":"https://github.com/pytest-dev/pytest/issues/11758","id":2062664672,"node_id":"I_kwDOAjwLdc568cPg","number":11758,"title":"Bug with prerelease pytest","user":{"login":"larsoner","id":2365790,"node_id":"MDQ6VXNlcjIzNjU3OTA=","avatar_url":"https://avatars.githubusercontent.com/u/2365790?v=4","gravatar_id":"","url":"https://api.github.com/users/larsoner","html_url":"https://github.com/larsoner","followers_url":"https://api.github.com/users/larsoner/followers","following_url":"https://api.github.com/users/larsoner/following{/other_user}","gists_url":"https://api.github.com/users/larsoner/gists{/gist_id}","starred_url":"https://api.github.com/users/larsoner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larsoner/subscriptions","organizations_url":"https://api.github.com/users/larsoner/orgs","repos_url":"https://api.github.com/users/larsoner/repos","events_url":"https://api.github.com/users/larsoner/events{/privacy}","received_events_url":"https://api.github.com/users/larsoner/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849193,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":"problem that needs to be addressed"},{"id":224853076,"node_id":"MDU6TGFiZWwyMjQ4NTMwNzY=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20reporting","name":"topic: reporting","color":"fef2c0","default":false,"description":"related to terminal output and user-facing messages and errors"}],"state":"closed","locked":false,"assignee":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/pytest-dev/pytest/milestones/35","html_url":"https://github.com/pytest-dev/pytest/milestone/35","labels_url":"https://api.github.com/repos/pytest-dev/pytest/milestones/35/labels","id":5503484,"node_id":"MDk6TWlsZXN0b25lNTUwMzQ4NA==","number":35,"title":"8.0","description":"","creator":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":11,"state":"closed","created_at":"2020-06-05T11:56:50Z","updated_at":"2024-04-14T12:35:09Z","due_on":null,"closed_at":"2024-04-14T12:35:09Z"},"comments":2,"created_at":"2024-01-02T16:36:41Z","updated_at":"2024-01-03T07:38:31Z","closed_at":"2024-01-03T07:38:30Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nThanks for submitting an issue!\r\n\r\nQuick check-list while reporting bugs:\r\n-->\r\n\r\n- [x] a detailed description of the bug or problem you are having\r\n- [x] output of `pip list` from the virtual environment you are using\r\n- [x] pytest and operating system versions\r\n- [ ] minimal example if possible\r\n\r\nIn our prerelease CIs we now get an internal error with 8.0.0rc1:\r\n\r\nhttps://github.com/mne-tools/mne-python/actions/runs/7387584833/job/20096612938?pr=12330#step:15:4411\r\n\r\n```\r\n_______________________________ test_dir_warning _______________________________\r\nmne/_fiff/tests/test_meas_info.py:355: in test_dir_warning\r\n    read_info(ctf_fname)\r\n<decorator-gen-34>:12: in read_info\r\n    ???\r\nmne/_fiff/meas_info.py:2045: in read_info\r\n    fname = _check_fname(fname, must_exist=True, overwrite=\"read\")\r\n<decorator-gen-0>:12: in _check_fname\r\n    ???\r\nmne/utils/check.py:255: in _check_fname\r\n    raise OSError(\r\nE   OSError: Need a file for File but found a directory at /home/runner/mne_data/MNE-testing-data/CTF/testdata_ctf.ds\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n    tw._write_source(source_lines, indents)\r\n  File \"/opt/hostedtoolcache/Python/3.11.7/x64/lib/python3.11/site-packages/_pytest/_io/terminalwriter.py\", line 193, in _write_source\r\n    new_lines = self._highlight(source).splitlines()\r\n                ^^^^^^^^^^^^^^^^^^^^^^^\r\n  File \"/opt/hostedtoolcache/Python/3.11.7/x64/lib/python3.11/site-packages/_pytest/_io/terminalwriter.py\", line 228, in _highlight\r\n    if highlighted[-1] == \"\\n\" and source[-1] != \"\\n\":\r\n                                   ~~~~~~^^^^\r\nIndexError: string index out of range\r\nError: Process completed with exit code 1.\r\n```\r\nThat's on Linux, but locally I can reproduce on reproduce on macOS arm64 as well:\r\n```\r\n$ pytest mne/_fiff/tests/test_meas_info.py --pdb\r\n...\r\nINTERNALERROR>   File \"/Users/larsoner/Applications/MNE-Python/1.6.0_0/.mne-python/lib/python3.11/site-packages/_pytest/reports.py\", line 88, in toterminal\r\nINTERNALERROR>     longrepr_terminal.toterminal(out)\r\nINTERNALERROR>   File \"/Users/larsoner/Applications/MNE-Python/1.6.0_0/.mne-python/lib/python3.11/site-packages/_pytest/_code/code.py\", line 1140, in toterminal\r\nINTERNALERROR>     element[0].toterminal(tw)\r\nINTERNALERROR>   File \"/Users/larsoner/Applications/MNE-Python/1.6.0_0/.mne-python/lib/python3.11/site-packages/_pytest/_code/code.py\", line 1170, in toterminal\r\nINTERNALERROR>     entry.toterminal(tw)\r\nINTERNALERROR>   File \"/Users/larsoner/Applications/MNE-Python/1.6.0_0/.mne-python/lib/python3.11/site-packages/_pytest/_code/code.py\", line 1257, in toterminal\r\nINTERNALERROR>     self._write_entry_lines(tw)\r\nINTERNALERROR>   File \"/Users/larsoner/Applications/MNE-Python/1.6.0_0/.mne-python/lib/python3.11/site-packages/_pytest/_code/code.py\", line 1247, in _write_entry_lines\r\nINTERNALERROR>     tw._write_source(source_lines, indents)\r\nINTERNALERROR>   File \"/Users/larsoner/Applications/MNE-Python/1.6.0_0/.mne-python/lib/python3.11/site-packages/_pytest/_io/terminalwriter.py\", line 193, in _write_source\r\nINTERNALERROR>     new_lines = self._highlight(source).splitlines()\r\nINTERNALERROR>                 ^^^^^^^^^^^^^^^^^^^^^^^\r\nINTERNALERROR>   File \"/Users/larsoner/Applications/MNE-Python/1.6.0_0/.mne-python/lib/python3.11/site-packages/_pytest/_io/terminalwriter.py\", line 228, in _highlight\r\nINTERNALERROR>     if highlighted[-1] == \"\\n\" and source[-1] != \"\\n\":\r\nINTERNALERROR>                                    ~~~~~~^^^^\r\nINTERNALERROR> IndexError: string index out of range\r\n\r\n>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>> PDB post_mortem (IO-capturing turned off) >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\r\n> /Users/larsoner/Applications/MNE-Python/1.6.0_0/.mne-python/lib/python3.11/site-packages/_pytest/_io/terminalwriter.py(228)_highlight()\r\n-> if highlighted[-1] == \"\\n\" and source[-1] != \"\\n\":\r\n(Pdb) p source\r\n''\r\n(Pdb) \r\n```\r\nNot really minimal (at all!) and it's not trivial to get the MNE tests running locally, so let me know if additional debugging at my end would be helpful. But maybe it's enough to know that `source` has length zero so `source[-1]` will fail here?\r\n\r\nEnv info:\r\n```\r\n$ pip list | grep pytest\r\npytest                        8.0.0rc1\r\npytest-cov                    4.1.0\r\npytest-harvest                1.10.4\r\npytest-qt                     4.2.0\r\npytest-timeout                2.2.0\r\n```","closed_by":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/11758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/11758/timeline","performed_via_github_app":null,"state_reason":"completed"}