{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/4675","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4675/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4675/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4675/events","html_url":"https://github.com/pytest-dev/pytest/issues/4675","id":402669029,"node_id":"MDU6SXNzdWU0MDI2NjkwMjk=","number":4675,"title":"dataclasses/attrs rich comparison should be recursive","user":{"login":"bluetech","id":1223550,"node_id":"MDQ6VXNlcjEyMjM1NTA=","avatar_url":"https://avatars.githubusercontent.com/u/1223550?v=4","gravatar_id":"","url":"https://api.github.com/users/bluetech","html_url":"https://github.com/bluetech","followers_url":"https://api.github.com/users/bluetech/followers","following_url":"https://api.github.com/users/bluetech/following{/other_user}","gists_url":"https://api.github.com/users/bluetech/gists{/gist_id}","starred_url":"https://api.github.com/users/bluetech/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bluetech/subscriptions","organizations_url":"https://api.github.com/users/bluetech/orgs","repos_url":"https://api.github.com/users/bluetech/repos","events_url":"https://api.github.com/users/bluetech/events{/privacy}","received_events_url":"https://api.github.com/users/bluetech/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":224849195,"node_id":"MDU6TGFiZWwyMjQ4NDkxOTU=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20enhancement","name":"type: enhancement","color":"84b6eb","default":false,"description":"new feature or API change, should be merged into features branch"},{"id":323103543,"node_id":"MDU6TGFiZWwzMjMxMDM1NDM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20feature-branch","name":"type: feature-branch","color":"0052cc","default":false,"description":"new feature or API change, should be merged into features branch"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2019-01-24T11:44:00Z","updated_at":"2020-06-09T18:01:36Z","closed_at":"2020-06-09T18:01:36Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The rich comparison added in #3776 is very helpful (relieved from having to wrap with `attr.asdict(...)` in many cases). However it only works well for one nesting level.\r\n\r\nFor example:\r\n\r\n```python\r\nimport attr\r\n\r\n@attr.s\r\nclass Cog:\r\n    color = attr.ib()\r\n\r\n@attr.s\r\nclass Wheel:\r\n    cog1 = attr.ib()\r\n    cog2 = attr.ib()\r\n\r\n@attr.s\r\nclass Bike:\r\n    wheel1 = attr.ib()\r\n    wheel2 = attr.ib()\r\n\r\ndef test_example():\r\n    wheel = Wheel(cog1=Cog(color='red'), cog2=Cog(color='yellow'))\r\n    bike1 = Bike(wheel1=wheel, wheel2=wheel)\r\n    different_wheel = attr.evolve(wheel, cog1=Cog(color='blue'))\r\n    bike2 = Bike(wheel1=wheel, wheel2=different_wheel)\r\n    assert bike1 == bike2\r\n```\r\n\r\nThe output is with `pytest -vv` is:\r\n\r\n```\r\nx.py:22: in test_example\r\n    assert bike1 == bike2\r\nE   AssertionError: assert Bike(wheel1=W...or='yellow'))) == Bike(wheel1=Wh...or='yellow')))\r\nE     Matching attributes:\r\nE     ['wheel1']\r\nE     Differing attributes:\r\nE     wheel2: Wheel(cog1=Cog(color='red'), cog2=Cog(color='yellow')) != Wheel(cog1=Cog(color='blue'), cog2=Cog(color='yellow'))\r\n```\r\n\r\nIn this small example it is still possible to see the difference, but with very large nested structures, you can see it will get very hard to see the difference. Ideally, the comparison would be recursive, such that only the `Bike -> wheel1 -> cog2 -> color` difference in the example would be shown.\r\n\r\n- `pip list` of the virtual environment you are using\r\n\r\n```\r\nPackage        Version\r\n-------------- -------\r\natomicwrites   1.2.1  \r\nattrs          18.2.0 \r\nmore-itertools 5.0.0  \r\npip            18.1   \r\npluggy         0.8.1  \r\npy             1.7.0  \r\npytest         4.1.1  \r\nsetuptools     40.6.2 \r\nsix            1.12.0 \r\n```\r\n\r\n- pytest and operating system versions\r\n\r\n```\r\nThis is pytest version 4.1.1, imported from /home/ran/work/innorail/venv/lib/python3.5/site-packages/pytest.py\r\nsetuptools registered plugins:\r\n  pytest-pythonpath-0.7.3 at /home/ran/work/innorail/venv/lib/python3.5/site-packages/pytest_pythonpath.py\r\n  pytest-env-0.6.2 at /home/ran/work/innorail/venv/lib/python3.5/site-packages/pytest_env/plugin.py\r\n  pytest-django-3.4.5 at /home/ran/work/innorail/venv/lib/python3.5/site-packages/pytest_django/plugin.py\r\n```\r\n\r\n```\r\nLinux 4.20.0-arch1-1-ARCH #1 SMP PREEMPT Mon Dec 24 03:00:40 UTC 2018 x86_64 GNU/Linux\r\n```","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/4675/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/4675/timeline","performed_via_github_app":null,"state_reason":"completed"}