{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13816","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13816/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13816/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13816/events","html_url":"https://github.com/pytest-dev/pytest/issues/13816","id":3517842389,"node_id":"I_kwDOAjwLdc7RrgPV","number":13816,"title":"`pytest.approx` gives confusing error when dictionaries have different keys","user":{"login":"cmnemoi","id":63333367,"node_id":"MDQ6VXNlcjYzMzMzMzY3","avatar_url":"https://avatars.githubusercontent.com/u/63333367?v=4","gravatar_id":"","url":"https://api.github.com/users/cmnemoi","html_url":"https://github.com/cmnemoi","followers_url":"https://api.github.com/users/cmnemoi/followers","following_url":"https://api.github.com/users/cmnemoi/following{/other_user}","gists_url":"https://api.github.com/users/cmnemoi/gists{/gist_id}","starred_url":"https://api.github.com/users/cmnemoi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmnemoi/subscriptions","organizations_url":"https://api.github.com/users/cmnemoi/orgs","repos_url":"https://api.github.com/users/cmnemoi/repos","events_url":"https://api.github.com/users/cmnemoi/events{/privacy}","received_events_url":"https://api.github.com/users/cmnemoi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-10-15T12:36:55Z","updated_at":"2025-11-01T21:00:36Z","closed_at":"2025-11-01T21:00:36Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello,\n\nWhile working on #12444, I used `pytest.approx` to compare two dictionaries with different keys. \nThe error message is pretty confusing. Instead of telling me that the keys don't match, I get an `AssertionError` with a representation issue and a `KeyError` for the missing key.\n\n**What I expected:** A clearer message saying the dictionaries have different keys, something like: \"comparison failed. dictionary has different keys: expected (a, c), got (a, b)\".\n\n**What I got instead:**\n```\nAssertionError: assert approx({'a': ... 4 Â± 4.0e-06}) == {'a': 1, 'c': 3}\n\n(pytest_assertion plugin: representation of details failed: /home/cmnemoi/code/repro_bugs/.venv/lib/python3.13/site-packages/_pytest/python_api.py:271: KeyError: 'b'.\n Probably an object has a faulty __repr__.)\n```\n\n## How to reproduce\n```python\nimport pytest\n\ndef test_approx_dicts_with_mismatch_on_keys() -> None:\n    expected = {\"a\": 1, \"c\": 3}\n    actual = {\"a\": 1, \"b\": 4}\n\n    assert pytest.approx(actual) == expected\n```\n\n## Environment\n\n- **pytest version**: 8.4.2\n- **Operating System**: Pop_OS! 22.04 (GNU/Linux)\n\n## Installed Packages\n```\nPackage                 Version   Editable project location\n----------------------- --------- -----------------------------\nannotated-types         0.7.0\ncertifi                 2025.10.5\ncharset-normalizer      3.4.4\nclick                   8.1.8\nclick-option-group      0.5.9\ncoverage                7.10.7\nDeprecated              1.2.18\ndotty-dict              1.3.1\nfilelock                3.20.0\ngitdb                   4.0.12\nGitPython               3.1.45\nidna                    3.11\nimportlib_resources     6.5.2\niniconfig               2.1.0\nJinja2                  3.1.6\nmarkdown-it-py          4.0.0\nMarkupSafe              3.0.3\nmdurl                   0.1.2\nmypy                    1.18.2\nmypy_extensions         1.1.0\npackaging               25.0\npathspec                0.12.1\npip                     25.2\npluggy                  1.6.0\npydantic                2.12.2\npydantic_core           2.41.4\nPygments                2.19.2\npytest                  8.4.2\npytest-cov              7.0.0\npytest-mypy             1.0.1\npytest-watcher          0.4.3\npython-gitlab           6.4.0\npython-semantic-release 10.4.1\nrequests                2.32.5\nrequests-toolbelt       1.0.1\nrich                    14.2.0\nruff                    0.14.0\nshellingham             1.5.4\nsmmap                   5.0.2\ntomlkit                 0.13.3\ntyping_extensions       4.15.0\ntyping-inspection       0.4.2\nurllib3                 2.5.0\nwatchdog                6.0.0\nwrapt                   1.17.3\n```","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/13816/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/13816/timeline","performed_via_github_app":null,"state_reason":"completed"}