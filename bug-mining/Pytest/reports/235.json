{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/8456","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/8456/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/8456/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/8456/events","html_url":"https://github.com/pytest-dev/pytest/issues/8456","id":833601030,"node_id":"MDU6SXNzdWU4MzM2MDEwMzA=","number":8456,"title":"required_plugins false-positive with prereleases of plugins","user":{"login":"The-Compiler","id":625793,"node_id":"MDQ6VXNlcjYyNTc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/625793?v=4","gravatar_id":"","url":"https://api.github.com/users/The-Compiler","html_url":"https://github.com/The-Compiler","followers_url":"https://api.github.com/users/The-Compiler/followers","following_url":"https://api.github.com/users/The-Compiler/following{/other_user}","gists_url":"https://api.github.com/users/The-Compiler/gists{/gist_id}","starred_url":"https://api.github.com/users/The-Compiler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/The-Compiler/subscriptions","organizations_url":"https://api.github.com/users/The-Compiler/orgs","repos_url":"https://api.github.com/users/The-Compiler/repos","events_url":"https://api.github.com/users/The-Compiler/events{/privacy}","received_events_url":"https://api.github.com/users/The-Compiler/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":705853693,"node_id":"MDU6TGFiZWw3MDU4NTM2OTM=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/topic:%20config","name":"topic: config","color":"006b75","default":false,"description":"related to config handling, argument parsing and config file"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-03-17T10:02:27Z","updated_at":"2021-03-21T21:51:12Z","closed_at":"2021-03-21T21:51:12Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"With a pytest.ini like\r\n\r\n```ini\r\n[pytest]\r\nrequired_plugins = pytest-qt pytest-bdd\r\n```\r\n\r\nwhen those plugins are installed from VCS, pytest doesn't seem to detect `pytest-qt` (and some others), while `pytest-bdd` (and some others) are fine.\r\n\r\nTo reproduce:\r\n\r\n```console\r\n$ python3 -m venv .venv\r\n$ .venv/bin/pip install -qU pip setuptools wheel\r\n$ .venv/bin/pip install pytest git+https://github.com/pytest-dev/pytest-qt.git git+https://github.com/pytest-dev/pytest-bdd.git\r\n[...]\r\nSuccessfully installed [...] packaging-20.9 parse-1.19.0 [...] pluggy-0.13.1 py-1.10.0 [...] pytest-6.2.2 pytest-bdd-4.0.2 pytest-qt-3.3.1.dev71+g1fbdd94 [...]\r\n\r\n$ cat > pytest.ini\r\n[pytest]\r\nrequired_plugins = pytest-qt pytest-bdd\r\n\r\n$ ./.venv/bin/pytest   \r\nERROR: Missing required plugins: pytest-qt\r\n\r\n$ .venv/bin/pip freeze                  \r\n[...]\r\npytest-bdd @ git+https://github.com/pytest-dev/pytest-bdd.git@5d58fe3bbbf38d2408701f4876281a3440890522\r\npytest-qt @ git+https://github.com/pytest-dev/pytest-qt.git@1fbdd944d33c49662894661b4071fb641a681b21\r\n[...]\r\n```\r\n\r\nLooking at it with a debugger, apparently this condition:\r\n\r\nhttps://github.com/pytest-dev/pytest/blob/dd3709718de683a10361e7f5b1f882164b1fa391/src/_pytest/config/__init__.py#L1280\r\n\r\nworks fine for pytest-bdd:\r\n\r\n```\r\n> .../_pytest/config/__init__.py(1273)_validate_plugins()\r\n-> try:\r\n(Pdb) required_plugin\r\n'pytest-bdd'\r\n\r\n(Pdb) n\r\n> .../_pytest/config/__init__.py(1281)_validate_plugins()\r\n-> elif Version(plugin_dist_info[spec.name]) not in spec.specifier:\r\n\r\n(Pdb) plugin_dist_info[spec.name]\r\n'4.0.2'\r\n\r\n(Pdb) spec.specifier\r\n<SpecifierSet('')>\r\n\r\n(Pdb) plugin_dist_info[spec.name] in spec.specifier\r\nTrue\r\n```\r\n\r\nbut not pytest-qt:\r\n\r\n```\r\n(Pdb) required_plugin\r\n'pytest-qt'\r\n\r\n(Pdb) n\r\n> .../_pytest/config/__init__.py(1281)_validate_plugins()\r\n-> elif Version(plugin_dist_info[spec.name]) not in spec.specifier:\r\n\r\n(Pdb) plugin_dist_info[spec.name]\r\n'3.3.1.dev71+g1fbdd94'\r\n\r\n(Pdb) spec.specifier\r\n<SpecifierSet('')>\r\n\r\n(Pdb) plugin_dist_info[spec.name] in spec.specifier\r\nFalse\r\n\r\n(Pdb) n\r\n> /home/florian/proj/pytest/src/_pytest/config/__init__.py(1282)_validate_plugins()\r\n-> missing_plugins.append(required_plugin)\r\n```\r\n\r\nI'm not sure why that is - I suspect setuptools-scm comes into play somehow?\r\n","closed_by":{"login":"The-Compiler","id":625793,"node_id":"MDQ6VXNlcjYyNTc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/625793?v=4","gravatar_id":"","url":"https://api.github.com/users/The-Compiler","html_url":"https://github.com/The-Compiler","followers_url":"https://api.github.com/users/The-Compiler/followers","following_url":"https://api.github.com/users/The-Compiler/following{/other_user}","gists_url":"https://api.github.com/users/The-Compiler/gists{/gist_id}","starred_url":"https://api.github.com/users/The-Compiler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/The-Compiler/subscriptions","organizations_url":"https://api.github.com/users/The-Compiler/orgs","repos_url":"https://api.github.com/users/The-Compiler/repos","events_url":"https://api.github.com/users/The-Compiler/events{/privacy}","received_events_url":"https://api.github.com/users/The-Compiler/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/8456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/8456/timeline","performed_via_github_app":null,"state_reason":"completed"}