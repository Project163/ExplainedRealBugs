{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/10502","repository_url":"https://api.github.com/repos/pytest-dev/pytest","labels_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10502/labels{/name}","comments_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10502/comments","events_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10502/events","html_url":"https://github.com/pytest-dev/pytest/issues/10502","id":1451081060,"node_id":"I_kwDOAjwLdc5Wfb1k","number":10502,"title":"`tmp_path_retention_policy` crash when skipping from fixture","user":{"login":"The-Compiler","id":625793,"node_id":"MDQ6VXNlcjYyNTc5Mw==","avatar_url":"https://avatars.githubusercontent.com/u/625793?v=4","gravatar_id":"","url":"https://api.github.com/users/The-Compiler","html_url":"https://github.com/The-Compiler","followers_url":"https://api.github.com/users/The-Compiler/followers","following_url":"https://api.github.com/users/The-Compiler/following{/other_user}","gists_url":"https://api.github.com/users/The-Compiler/gists{/gist_id}","starred_url":"https://api.github.com/users/The-Compiler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/The-Compiler/subscriptions","organizations_url":"https://api.github.com/users/The-Compiler/orgs","repos_url":"https://api.github.com/users/The-Compiler/repos","events_url":"https://api.github.com/users/The-Compiler/events{/privacy}","received_events_url":"https://api.github.com/users/The-Compiler/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":265779499,"node_id":"MDU6TGFiZWwyNjU3Nzk0OTk=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/status:%20critical","name":"status: critical","color":"e11d21","default":false,"description":"grave problem or usability issue that affects lots of users"},{"id":315571544,"node_id":"MDU6TGFiZWwzMTU1NzE1NDQ=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/type:%20regression","name":"type: regression","color":"f7c6c7","default":false,"description":"indicates a problem that was introduced in a release which was working previously"},{"id":692891970,"node_id":"MDU6TGFiZWw2OTI4OTE5NzA=","url":"https://api.github.com/repos/pytest-dev/pytest/labels/plugin:%20tmpdir","name":"plugin: tmpdir","color":"bfd4f2","default":false,"description":"related to the tmpdir builtin plugin"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-11-16T08:01:30Z","updated_at":"2022-11-23T13:48:32Z","closed_at":"2022-11-23T13:48:32Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"With #10442, this:\r\n\r\n```python\r\nimport pytest\r\n\r\n\r\n@pytest.fixture\r\ndef fixt(tmp_path):\r\n    pytest.skip()\r\n\r\n\r\ndef test_fixt(fixt):\r\n    pass\r\n```\r\n\r\nresults in:\r\n\r\n```\r\n________________________ ERROR at teardown of test_fixt ________________________\r\n\r\ncls = <class '_pytest.runner.CallInfo'>\r\nfunc = <function call_runtest_hook.<locals>.<lambda> at 0x7f0e90dab760>\r\nwhen = 'teardown'\r\nreraise = (<class '_pytest.outcomes.Exit'>, <class 'KeyboardInterrupt'>)\r\n\r\n    @classmethod\r\n    def from_call(\r\n        cls,\r\n        func: \"Callable[[], TResult]\",\r\n        when: \"Literal['collect', 'setup', 'call', 'teardown']\",\r\n        reraise: Optional[\r\n            Union[Type[BaseException], Tuple[Type[BaseException], ...]]\r\n        ] = None,\r\n    ) -> \"CallInfo[TResult]\":\r\n        \"\"\"Call func, wrapping the result in a CallInfo.\r\n    \r\n        :param func:\r\n            The function to call. Called without arguments.\r\n        :param when:\r\n            The phase in which the function is called.\r\n        :param reraise:\r\n            Exception or exceptions that shall propagate if raised by the\r\n            function, instead of being wrapped in the CallInfo.\r\n        \"\"\"\r\n        excinfo = None\r\n        start = timing.time()\r\n        precise_start = timing.perf_counter()\r\n        try:\r\n>           result: Optional[TResult] = func()\r\n\r\nsrc/_pytest/runner.py:342: \r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\nsrc/_pytest/runner.py:263: in <lambda>\r\n    lambda: ihook(item=item, **kwds), when=when, reraise=reraise\r\n.venv/lib/python3.10/site-packages/pluggy/_hooks.py:265: in __call__\r\n    return self._hookexec(self.name, self.get_hookimpls(), kwargs, firstresult)\r\n.venv/lib/python3.10/site-packages/pluggy/_manager.py:80: in _hookexec\r\n    return self._inner_hookexec(hook_name, methods, kwargs, firstresult)\r\nsrc/_pytest/runner.py:183: in pytest_runtest_teardown\r\n    item.session._setupstate.teardown_exact(nextitem)\r\nsrc/_pytest/runner.py:538: in teardown_exact\r\n    raise exceptions[0]\r\nsrc/_pytest/runner.py:527: in teardown_exact\r\n    fin()\r\nsrc/_pytest/fixtures.py:684: in <lambda>\r\n    subrequest.node.addfinalizer(lambda: fixturedef.finish(request=subrequest))\r\nsrc/_pytest/fixtures.py:1036: in finish\r\n    raise exc\r\nsrc/_pytest/fixtures.py:1029: in finish\r\n    func()\r\nsrc/_pytest/fixtures.py:916: in _teardown_yield_fixture\r\n    next(it)\r\n_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ \r\n\r\nrequest = <SubRequest 'tmp_path' for <Function test_fixt>>\r\ntmp_path_factory = TempPathFactory(_given_basetemp=None, _trace=<pluggy._tracing.TagTracerSub object at 0x7f0e91345780>, _basetemp=PosixPath('/tmp/pytest-of-florian/pytest-29'), _retention_count=3, _retention_policy='failed')\r\n\r\n    @fixture\r\n    def tmp_path(\r\n        request: FixtureRequest, tmp_path_factory: TempPathFactory\r\n    ) -> Generator[Path, None, None]:\r\n        \"\"\"Return a temporary directory path object which is unique to each test\r\n        function invocation, created as a sub directory of the base temporary\r\n        directory.\r\n    \r\n        By default, a new base temporary directory is created each test session,\r\n        and old bases are removed after 3 sessions, to aid in debugging. If\r\n        ``--basetemp`` is used then it is cleared each session. See :ref:`base\r\n        temporary directory`.\r\n    \r\n        The returned object is a :class:`pathlib.Path` object.\r\n        \"\"\"\r\n    \r\n        path = _mk_tmp(request, tmp_path_factory)\r\n        yield path\r\n    \r\n        # Remove the tmpdir if the policy is \"failed\" and the test passed.\r\n        tmp_path_factory: TempPathFactory = request.session.config._tmp_path_factory  # type: ignore\r\n        policy = tmp_path_factory._retention_policy\r\n>       if policy == \"failed\" and request.node._tmp_path_result_call.passed:\r\nE       AttributeError: 'Function' object has no attribute '_tmp_path_result_call'. Did you mean: '_tmp_path_result_setup'?\r\n\r\nsrc/_pytest/tmpdir.py:276: AttributeError\r\n```\r\n\r\ncc @yusuke-kadowaki ","closed_by":{"login":"nicoddemus","id":1085180,"node_id":"MDQ6VXNlcjEwODUxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1085180?v=4","gravatar_id":"","url":"https://api.github.com/users/nicoddemus","html_url":"https://github.com/nicoddemus","followers_url":"https://api.github.com/users/nicoddemus/followers","following_url":"https://api.github.com/users/nicoddemus/following{/other_user}","gists_url":"https://api.github.com/users/nicoddemus/gists{/gist_id}","starred_url":"https://api.github.com/users/nicoddemus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicoddemus/subscriptions","organizations_url":"https://api.github.com/users/nicoddemus/orgs","repos_url":"https://api.github.com/users/nicoddemus/repos","events_url":"https://api.github.com/users/nicoddemus/events{/privacy}","received_events_url":"https://api.github.com/users/nicoddemus/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pytest-dev/pytest/issues/10502/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/pytest-dev/pytest/issues/10502/timeline","performed_via_github_app":null,"state_reason":"completed"}