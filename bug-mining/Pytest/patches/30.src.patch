diff --git a/_pytest/assertion/rewrite.py b/_pytest/assertion/rewrite.py
index 0499a792f..c72f4c981 100644
--- a/_pytest/assertion/rewrite.py
+++ b/_pytest/assertion/rewrite.py
@@ -265,10 +265,7 @@ def _write_pyc(state, co, source_stat, pyc):
             mtime = int(source_stat.mtime)
             size = source_stat.size & 0xFFFFFFFF
             fp.write(struct.pack("<ll", mtime, size))
-            if six.PY2:
-                marshal.dump(co, fp.file)
-            else:
-                marshal.dump(co, fp)
+            fp.write(marshal.dumps(co))
     except EnvironmentError as e:
         state.trace("error writing pyc file at %s: errno=%s" % (pyc, e.errno))
         # we ignore any failure to write the cache file
diff --git a/changelog/3503.bugfix.rst b/changelog/3503.bugfix.rst
new file mode 100644
index 000000000..e3ffdfaaf
--- /dev/null
+++ b/changelog/3503.bugfix.rst
@@ -0,0 +1 @@
+Fix assertion rewriter compatibility with libraries that monkey patch ``file`` objects.
