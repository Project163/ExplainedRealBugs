<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:26:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-303] CurveFitter.fit(ParametricRealFunction, double[]) used with LevenbergMarquardtOptimizer throws ArrayIndexOutOfBoundsException when double[] length &gt; 1 (AbstractLeastSquaresOptimizer.java:187)</title>
                <link>https://issues.apache.org/jira/browse/MATH-303</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;CurveFitter.fit(ParametricRealFunction, double[]) throws ArrayIndexOutOfBoundsException at AbstractLeastSquaresOptimizer.java:187 when used with the  LevenbergMarquardtOptimizer  and the length of the initial guess array is greater than 1.  The code will run if the initialGuess array is of length 1, but then CurveFitter.fit() just returns the same value as the initialGuess array (I&apos;ll file this as a separate issue).  Here is my example code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;CurveFitter with LevenbergMarquardtOptimizer and SimpleInverseFunction&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  LevenbergMarquardtOptimizer optimizer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LevenbergMarquardtOptimizer();
  CurveFitter fitter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CurveFitter(optimizer);
  fitter.addObservedPoint(2.805d, 0.6934785852953367d);
  fitter.addObservedPoint(2.74333333333333d, 0.6306772025518496d);
  fitter.addObservedPoint(1.655d, 0.9474675497289684);
  fitter.addObservedPoint(1.725d, 0.9013594835804194d);
  SimpleInverseFunction sif = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleInverseFunction(); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; provided below
&lt;/span&gt;  &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] initialguess = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[2];
  initialguess[0] = 1.0d;
  initialguess[1] = .5d;
  &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] bestCoefficients = fitter.fit(sif, initialguess); &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;---- &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; exception here
&lt;/span&gt;
    /**
     * This is my implementation of ParametricRealFunction
     * Implements y = ax^-1 + b &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; use with an Apache CurveFitter implementation
      */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SimpleInverseFunction &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ParametricRealFunction
    {
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; value(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; x, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] doubles) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FunctionEvaluationException
        {
            &lt;span class=&quot;code-comment&quot;&gt;//y = ax^-1 + b
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] must include at least 1 but not more than 2 coefficients.&quot;&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(doubles == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || doubles.length ==0 || doubles.length &amp;gt; 2) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FunctionEvaluationException(doubles);
            &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; a = doubles[0];
            &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; b = 0;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(doubles.length &amp;gt;= 2) b = doubles[1];
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; a * &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.pow(x, -1d) + b;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] gradient(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; x, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] doubles) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; FunctionEvaluationException
        {
            &lt;span class=&quot;code-comment&quot;&gt;//derivative: -ax^-2
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] must include at least 1 but not more than 2 coefficients.&quot;&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(doubles == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || doubles.length ==0 || doubles.length &amp;gt; 2) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FunctionEvaluationException(doubles);
            &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; a = doubles[0];
            &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; b = 0;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(doubles.length &amp;gt;= 2) b = doubles[1];
            &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; derivative = -a * &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.pow(x, -2d);
            &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[]gradientVector = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[1];
            gradientVector[0] = derivative;
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; gradientVector; 
        }
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;This is the resulting stack trace:&lt;/p&gt;

&lt;p&gt;java.lang.ArrayIndexOutOfBoundsException: 1&lt;br/&gt;
	at org.apache.commons.math.optimization.general.AbstractLeastSquaresOptimizer.updateJacobian(AbstractLeastSquaresOptimizer.java:187)&lt;br/&gt;
	at org.apache.commons.math.optimization.general.LevenbergMarquardtOptimizer.doOptimize(LevenbergMarquardtOptimizer.java:241)&lt;br/&gt;
	at org.apache.commons.math.optimization.general.AbstractLeastSquaresOptimizer.optimize(AbstractLeastSquaresOptimizer.java:346)&lt;br/&gt;
	at org.apache.commons.math.optimization.fitting.CurveFitter.fit(CurveFitter.java:134)&lt;br/&gt;
	at com.yieldsoftware.analyticstest.tasks.ppcbidder.CurveFittingTest.testFitnessRankCurveIntercept(CurveFittingTest.java:181)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java, Linux Ubuntu 9.04 (64 bit)&lt;/p&gt;</environment>
        <key id="12438498">MATH-303</key>
            <summary>CurveFitter.fit(ParametricRealFunction, double[]) used with LevenbergMarquardtOptimizer throws ArrayIndexOutOfBoundsException when double[] length &gt; 1 (AbstractLeastSquaresOptimizer.java:187)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ddrummond">Daren Drummond</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Oct 2009 21:20:17 +0000</created>
                <updated>Wed, 14 Apr 2010 00:07:56 +0000</updated>
                            <resolved>Sun, 27 Dec 2009 17:19:25 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12794704" author="luc" created="Sun, 27 Dec 2009 17:19:25 +0000"  >&lt;p&gt;The problem is not in the solver but in the implementation of the gradient method in your SimpleInverseFunction class. The length of the returned array must match the length of the second argument to the method (which is called parameters in the interface and doubles in your class). In your implementation, the array always has length 1 since it is created by statement:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[]gradientVector = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[1];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also note that the value of the gradient is wrong. The gradient vector is computed with respect to the parameters (which is the reason why lengths must match), not with respect to the independent variable x. So for a function with two parameters p&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; / x + p&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, the gradient is &lt;/p&gt;
{ 1/x, 1 }
&lt;p&gt; and not &lt;/p&gt;
{ -p[0]/x^2, 0 }
&lt;p&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>150487</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 47 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rvaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>