<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:26:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-349] Dangerous code in &quot;PoissonDistributionImpl&quot;</title>
                <link>https://issues.apache.org/jira/browse/MATH-349</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;In the following excerpt from class &quot;PoissonDistributionImpl&quot;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;PoissonDistributionImpl.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; PoissonDistributionImpl(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; p, NormalDistribution z) {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;();
        setNormal(z);
        setMean(p);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(1) Overridable methods are called within the constructor.&lt;br/&gt;
(2) The reference &quot;z&quot; is stored and modified within the class.&lt;/p&gt;

&lt;p&gt;I&apos;ve encountered problem (1) in several classes while working on issue 348. In those cases, in order to remove potential problems, I copied/pasted the body of the &quot;setter&quot; methods inside the constructor but I think that a more elegant solution would be to remove the &quot;setters&quot; altogether (i.e. make the classes immutable).&lt;br/&gt;
Problem (2) can also create unexpected behaviour. Is it really necessary to pass the &quot;NormalDistribution&quot; object; can&apos;t it be always created within the class?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12458249">MATH-349</key>
            <summary>Dangerous code in &quot;PoissonDistributionImpl&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="erans">Gilles Sadowski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Mar 2010 15:15:19 +0000</created>
                <updated>Wed, 23 Mar 2011 19:59:37 +0000</updated>
                            <resolved>Sun, 26 Sep 2010 21:55:34 +0000</resolved>
                                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12842271" author="psteitz" created="Sat, 6 Mar 2010 15:49:19 +0000"  >&lt;p&gt;The reason this constructor exists is to allow users to plug in an alternative normal distribution implementation to be used in computing normal approximations.  I don&apos;t see 1) as a serious issue, but I am +1 on deprecating the setters with aim to make this class immutable in 3.0.  2) is a harder problem, as there is no requirement that a NormalDistribution be clonable.   I see three solutions, none of which are particularly appealing:&lt;/p&gt;

&lt;p&gt;1) leave as is and specify in the javadoc that z is going to be modified&lt;br/&gt;
2) change the implementation to avoid changing the parameters of z &lt;br/&gt;
3) deprecate the constructor altogether&lt;/p&gt;

&lt;p&gt;I vote for 1) + 3) - update the javadoc, but deprecate.  If we get complaints before 3.0, we can reconsider; otherwise eliminate in 3.0&lt;/p&gt;</comment>
                            <comment id="12842729" author="erans" created="Mon, 8 Mar 2010 16:48:22 +0000"  >&lt;p&gt;Problem (1)&lt;br/&gt;
In principle, it is not safe to call overridable methods in the constructor, so, if only to promote coding quality, can I implement private (&quot;helper&quot;) setter methods that shall be called from within the constructors and from the public setters?&lt;/p&gt;

&lt;p&gt;Problem (2)&lt;br/&gt;
In &quot;PoissonDistributionImpl.java&quot;, there is this code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;PoissonDistributionImpl.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; PoissonDistributionImpl(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; p, NormalDistribution z) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;();
    setNormal(z);
    setMean(p);
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setMean(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; p) {
    &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.mean = p;
    normal.setMean(p);
    normal.setStandardDeviation(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.sqrt(p));
}

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setNormal(NormalDistribution value) {
    normal = value;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the constructor, the code makes sure that the &quot;mean&quot; of this class and the mean of the &quot;normal&quot; object are consistent.&lt;br/&gt;
But there is no such guarantee anymore when calling the &quot;setNormal&quot; method. &lt;span class=&quot;error&quot;&gt;&amp;#91;The comment warns the user that he is responsible for setting the right parameter in &amp;quot;value&amp;quot; but this is far from fool-proof...&amp;#93;&lt;/span&gt;&lt;/p&gt;
</comment>
                            <comment id="12842750" author="psteitz" created="Mon, 8 Mar 2010 17:45:01 +0000"  >&lt;p&gt;I agree that both (1) and (2) are problems.  The private helpers would be OK to address (1), but I am also OK with deprecating the setters and just setting the fields directly (per &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-348&quot; title=&quot;Indirect access to instance variables&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-348&quot;&gt;&lt;del&gt;MATH-348&lt;/del&gt;&lt;/a&gt;) in the constructor.  As stated above, I am also +1 on deprecating the pluggability of the normal impl, which will (eventually) address (2).  I guess to address (2) now we either need to modify setNormal to update the parameters of the normal instance as setMean does or change the normal approximation implementation to not depend on the parameters of the distribution (which addresses the problem of z being updated).  Its probably easiest and best in the long term to take the first approach, documenting the fact that z is going to be updated (both in setNormal and constructor javadoc).&lt;/p&gt;</comment>
                            <comment id="12843031" author="erans" created="Tue, 9 Mar 2010 13:02:00 +0000"  >&lt;p&gt;Issue is partially fixed (removed the consistency problem) in revision 920852.&lt;br/&gt;
Setters were marked as deprecated.&lt;/p&gt;</comment>
                            <comment id="12843047" author="psteitz" created="Tue, 9 Mar 2010 13:46:21 +0000"  >&lt;p&gt;Issue (2) in the bug description remains open.  I think we should leave this issue open until we have a solution for this.  As stated above, I can see two ways to fix this:&lt;/p&gt;

&lt;p&gt;a) modify the normal approximation implementation so that it does not change the parameters of z&lt;br/&gt;
b) eliminate pluggability of z (i.e., deprecate and then remove the constructor that accepts a normal instance as a parameter)&lt;/p&gt;

&lt;p&gt;a) could be accomplished in 2.x, but it would complicate the code and could be bad for numerics.  My vote is for b) - add a warning (about safety as well as deprecation), deprecate now and if we get no complaints before 3.0, remove then.   Leave the issue open with fix version 3.0.&lt;/p&gt;</comment>
                            <comment id="12843052" author="erans" created="Tue, 9 Mar 2010 14:07:40 +0000"  >&lt;p&gt;The same kind of problem also exists in &quot;ChiSquaredDistributionImpl.java&quot;.&lt;br/&gt;
In both classes, the constructor that takes the distribution as a parameter has been deprecated.&lt;/p&gt;</comment>
                            <comment id="12843146" author="psteitz" created="Tue, 9 Mar 2010 15:22:58 +0000"  >&lt;p&gt;Sorry,  I missed the constructor deprecations in r920852&lt;/p&gt;</comment>
                            <comment id="12843171" author="psteitz" created="Tue, 9 Mar 2010 15:25:40 +0000"  >&lt;p&gt;Leaving open until deprecated constructors are removed in 3.0.&lt;/p&gt;</comment>
                            <comment id="12914889" author="erans" created="Sat, 25 Sep 2010 23:07:48 +0000"  >&lt;p&gt;&lt;tt&gt;PoissonDistributionImpl&lt;/tt&gt; made immutable in revision 1001331.&lt;/p&gt;</comment>
                            <comment id="12915051" author="erans" created="Sun, 26 Sep 2010 21:54:19 +0000"  >&lt;p&gt;&lt;tt&gt;ChiSquaredDistributionImpl&lt;/tt&gt; made immutable in revision 1001533.&lt;/p&gt;</comment>
                            <comment id="12915052" author="erans" created="Sun, 26 Sep 2010 21:55:34 +0000"  >&lt;p&gt;Removed deprecated code.  Classes are now immutable.&lt;/p&gt;</comment>
                            <comment id="13010327" author="luc" created="Wed, 23 Mar 2011 19:59:37 +0000"  >&lt;p&gt;Closing issue as it was included in version 2.2, which has been released&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>150517</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rv0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160668</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>