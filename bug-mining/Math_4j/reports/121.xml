<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:26:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-388] ODE integrator: different size needed for state vector and tolerance error vector dimension</title>
                <link>https://issues.apache.org/jira/browse/MATH-388</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;The user should be allowed to chose a tolerance vector dimension different from the state vector dimension.&lt;br/&gt;
For example, using the FirstOrderIntegratorWithJacibians, we don&apos;t want to set some tolerance error for the jacobian part in order to not interfere with the main state vector integration.&lt;br/&gt;
This is really a problem with the dimension of the tolerance vector, there is no work-around assigning some particular value to the tolerance vector.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12469625">MATH-388</key>
            <summary>ODE integrator: different size needed for state vector and tolerance error vector dimension</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="luc">Luc Maisonobe</assignee>
                                    <reporter username="pparraud">Pascal Parraud</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Jul 2010 15:35:41 +0000</created>
                <updated>Wed, 23 Mar 2011 20:12:32 +0000</updated>
                            <resolved>Fri, 23 Jul 2010 09:04:16 +0000</resolved>
                                                    <fixVersion>2.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12889970" author="luc" created="Mon, 19 Jul 2010 18:52:11 +0000"  >&lt;p&gt;This issue is in some sense related to &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-380&quot; title=&quot;Need to (re)initialize dYdY0 for multiple integrate with FirstOrderIntegratorWithJacobians&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-380&quot;&gt;&lt;del&gt;MATH-380&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I intend to completely change the way to solve ODE problems with Jacobians soon using a much better architecture (the current implementation is really bad).&lt;br/&gt;
I will however encounter the exact same problem with the new architecture so need to solve &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-388&quot; title=&quot;ODE integrator: different size needed for state vector and tolerance error vector dimension&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-388&quot;&gt;&lt;del&gt;MATH-388&lt;/del&gt;&lt;/a&gt; before &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-380&quot; title=&quot;Need to (re)initialize dYdY0 for multiple integrate with FirstOrderIntegratorWithJacobians&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-380&quot;&gt;&lt;del&gt;MATH-380&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The simple Initial Value Problem is:&lt;br/&gt;
   y(t0) = y0&lt;br/&gt;
   y&apos;(t) = f(t,y)&lt;br/&gt;
its solution is a function y(t)&lt;/p&gt;

&lt;p&gt;Here, we want to integrate at the same time this problem and an extension of this problem which is:&lt;br/&gt;
   dy(t0)/dy0      = Jy0&lt;br/&gt;
   dy(t0)/dp       = Jp0&lt;br/&gt;
   d&lt;span class=&quot;error&quot;&gt;&amp;#91;dy(t)/dy~0~&amp;#93;&lt;/span&gt;/dt = one variational equation&lt;br/&gt;
   d&lt;span class=&quot;error&quot;&gt;&amp;#91;dy(t)/dp&amp;#93;&lt;/span&gt;/dt  = another variational equation&lt;/p&gt;

&lt;p&gt;So we end up with a very large state vector containing the initial y and also two jacobians. As an example, in some orbit determination problems the size of the initial y vector is 7 and the size of the extended y can be 7 + (7 * 7) + (7 * 2) = 70.&lt;/p&gt;

&lt;p&gt;However, we want to compute the step sizes and error estimation only on the first 7 parameters, not the 63 final ones.&lt;/p&gt;

&lt;p&gt;The dimension of the state vector is specified by the user who implements the FirstOrderDifferentialEquations method and hence provides a getDimension() method. There is no way now to say: my problem is dimension 70 but error should only be computed on the first 7 components of the vector.&lt;/p&gt;

&lt;p&gt;So we need to add a getErrorDimension() or getMainProblemDimension() or something like that. In the example above, this new method would return 7 and the existing getDimension would return 70. The ODE integrators have to be changed (this is a simple change) to use the appropriate dimension in the various loops.&lt;/p&gt;

&lt;p&gt;Adding the new method in the FirstOrderDifferentialEquations is bad because it breaks compatibility on user code (the interface is explicitly here to be implemented by users as it represents the problem they want our integrators to solve). I would suggest to extend the interface using something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ExtendedFirstOrderDifferentialEquations.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; ExtendedFirstOrderDifferentialEquations
  &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; FirstOrderDifferentialEquations {

    /** Return the dimension of the main problem.
      * &amp;lt;p&amp;gt;
      * The main problem represent the first part of an ODE state
      * and the error estimations and adaptive step size computation
      * should be done on &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; first part only, not on the &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; part
      * of the state which represent an extension of the main problem.
      * &amp;lt;/p&amp;gt;
      * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; dimension of the main problem, must be lesser than or
      * equal to the {@link #getDimension() total dimension}
      */
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getMainProblemDimension();

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then ODE integrators would have to check if the user provided FirstOrderDifferentialEquations implements only the base interface or the extended interface. In the former case, getDimension() would be used for both state dimension and error dimension, in the later case the appropriate method would be used for each loop.&lt;/p&gt;

&lt;p&gt;This is the only solution I see that is backaward compatible. It implies putting in our integrators code statements like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; errorDimension;
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (equations &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ExtendedFirstOrderDifferentialEquations) {
    errorDimension = equations.getDimension();
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    ExtendedFirstOrderDifferentialEquations extEq =  (ExtendedFirstOrderDifferentialEquations) equations;
    errorDimension = extEq.getMainProblemDimension();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is not really elegant, but I don&apos;t see another way yet.&lt;/p&gt;

&lt;p&gt;One problem is that some adventurous users may have implemented their own ODE integrators and would not include this new feature, because basically the requirements for an integrator are only defined in terms of FirstOrderDifferentialEquations not on the proposed new ExtendedFirstOrderDifferentialEquations. However, this is not an incompatible change: these custom integrator currently use the complete dimension to compute size, and they would still do it. So this problem is probably not important (and I&apos;m pretty sure noone as attempted yet to implement their own integrators from scratch).&lt;/p&gt;

&lt;p&gt;What do other developers think ?&lt;/p&gt;</comment>
                            <comment id="12890472" author="luc" created="Tue, 20 Jul 2010 21:51:05 +0000"  >&lt;p&gt;Could you check whether this patch solves the problem or not ?&lt;br/&gt;
You should have your ODE implement ExtendedFirstOrderDifferentialEquations instead of FirstOrderDifferentialEquations, so you would need to add an implementation for the getMainDimension method.&lt;br/&gt;
I did not have the time to do any verification by myself except running existing tests that do not use this new interface. So there may be some problems with the patch, mainly things like ArrayIndexOutOfBoundsException, so use this with care.&lt;/p&gt;

&lt;p&gt;I will wait for your feedback before checking this in the subversion repository.&lt;/p&gt;</comment>
                            <comment id="12890725" author="pparraud" created="Wed, 21 Jul 2010 13:27:25 +0000"  >&lt;p&gt;After a few tests, the patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;seems ok for DormandPrince853Integrator,&lt;/li&gt;
	&lt;li&gt;seems ok for  GraggBulirschStoerIntegrator, with 2 fixes :
	&lt;ul&gt;
		&lt;li&gt;in GraggBulirschStoerIntegrator, y0.length changed into scale.length (or mainSetDimension) at lines 712 &amp;amp; 716 ( integrate method),&lt;/li&gt;
		&lt;li&gt;in GraggBulirschStoerStepInterpolator, currentState.length changed into scale.length at lines 302 &amp;amp; 306 (estimateErrror method),&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;needs to be tested for others integrators.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And, waiting for a new architecture, ODEWithJacobians &amp;amp; ParameterizedODE classes should extend ExtendedFirstOrderDifferentialEquations instead of FirstOrderDifferentialEquations.&lt;/p&gt;</comment>
                            <comment id="12891527" author="luc" created="Fri, 23 Jul 2010 09:04:16 +0000"  >&lt;p&gt;fixed in subversion repository as of r919963&lt;br/&gt;
Note that ODEWithJacobians &amp;amp; ParameterizedODE classes still don&apos;t implement ExtendedFirstOrderDifferentialEquations, they should remain simple at user level, it is the MappingWrapper private class inside FirstOrderIntegratorWithJacobians that implements the extended set of equations.&lt;/p&gt;</comment>
                            <comment id="13010356" author="luc" created="Wed, 23 Mar 2011 20:12:32 +0000"  >&lt;p&gt;Closing issue as it was included in version 2.2, which has been released&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12449981" name="math-388.patch" size="16582" author="luc" created="Tue, 20 Jul 2010 21:51:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34186</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rurz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160630</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>