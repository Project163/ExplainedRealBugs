<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:26:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-370] NaN in &quot;equals&quot; methods</title>
                <link>https://issues.apache.org/jira/browse/MATH-370</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;In &quot;MathUtils&quot;, some &quot;equals&quot; methods will return true if both argument are NaN.&lt;br/&gt;
Unless I&apos;m mistaken, this contradicts the IEEE standard.&lt;/p&gt;

&lt;p&gt;If nobody objects, I&apos;m going to make the changes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12463970">MATH-370</key>
            <summary>NaN in &quot;equals&quot; methods</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erans">Gilles Sadowski</assignee>
                                    <reporter username="erans">Gilles Sadowski</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 May 2010 11:32:37 +0000</created>
                <updated>Wed, 23 Mar 2011 20:05:24 +0000</updated>
                            <resolved>Wed, 1 Sep 2010 13:47:58 +0000</resolved>
                                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12865171" author="luc" created="Fri, 7 May 2010 14:31:34 +0000"  >&lt;p&gt;I really think this is intentional and the fact that NaN != Nan was known to the people who did that.&lt;br/&gt;
For example, the javadoc for Complex.equals (&lt;a href=&quot;http://commons.apache.org/math/apidocs/org/apache/commons/math/complex/Complex.html#equals%28java.lang.Object%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/math/apidocs/org/apache/commons/math/complex/Complex.html#equals%28java.lang.Object%29&lt;/a&gt;) explicitly warns about behavior for NaN.&lt;br/&gt;
So on the one one changing this would break compatibility with respect to a documented behavior and on the other hand it would bring compatibility with IEEE arithmetic.&lt;br/&gt;
I&apos;m sure there is a good reason for the current status, but I don&apos;t know it.&lt;/p&gt;</comment>
                            <comment id="12865236" author="erans" created="Fri, 7 May 2010 17:00:53 +0000"  >&lt;p&gt;The Javadocs for &quot;Float&quot; and &quot;Double&quot; also indicate the special behaviour for NaN in a number object.  Nevertheless, the &lt;em&gt;primitive&lt;/em&gt; types are compliant with IEEE. Hence, there is an inconsistency between the &quot;equals&quot; methods in &quot;MathUtils&quot; and the behaviour of the JVM.&lt;/p&gt;</comment>
                            <comment id="12865376" author="psteitz" created="Sat, 8 May 2010 01:41:30 +0000"  >&lt;p&gt;-1 for the change.  It will break some internal things and likely some user applications that depend on the documented behavior.  The reason that these methods exist is to be able to handle NaNs and treat them as equal.&lt;/p&gt;</comment>
                            <comment id="12865443" author="erans" created="Sat, 8 May 2010 11:10:43 +0000"  >&lt;p&gt;But &lt;em&gt;why&lt;/em&gt;?&lt;br/&gt;
By this I mean, how to explain to someone that CM does not comply with IEEE?&lt;/p&gt;

&lt;p&gt;Also, please point me to the internal things likely to break, so that I have a chance to understand the usefulness of the behaviour.&lt;/p&gt;</comment>
                            <comment id="12865468" author="psteitz" created="Sat, 8 May 2010 14:00:27 +0000"  >&lt;p&gt;The method Mathutils.equals(double, double) was implemented for the reason that in some cases, users may wish to treat doubles with NaN values as equal.  The internal classes that use it are the equals methods for statistics and statistical aggregates.  When these classes were defined, we decided that we would treat two statistics or statistical aggregates as equal iff they had the same values, including NaNs.  So for example, two StatisticalSummaryValues instances are equal iff they report the same values for all statistics, with NaNs treated as &quot;the same value.&quot;  The MathUtils.equals(double, double) method was introduced as a convenience method to do this kind of comparison.  I guess we could (deprecate and) change the name if it makes it look like all of our computations are defining equals that way, which is certainly not the case.  In general, we do try to follow IEEE754.  We agreed early on that we would carefully document how NaNs are treated throughout Commons Math.  We have slipped a little over the years, but in the case of this method and the classes that use it, the documentation is clear.&lt;/p&gt;

&lt;p&gt;Sorry I misunderstood the point of the issue here.  I now get your point that naming the method &quot;equals&quot; makes it look like we are re-defining equals for primitive doubles, which is not our intent.  So maybe we deprecate the equals method and rename something like &quot;equalsIncludingNaN&quot; or something simpler?&lt;/p&gt;</comment>
                            <comment id="12865720" author="erans" created="Mon, 10 May 2010 10:14:33 +0000"  >&lt;p&gt;Well, the first impression I got from looking at those methods in &quot;MathUtils&quot; was indeed that they provide the &quot;right&quot; way to compare primitive doubles. Now, the right way for most users dealing with numerical codes should arguably be IEEE754-compliant.  So, unless we can explain that the way CM handles NaN is somehow more useful than what the IEEE standard defines, CM should at least provide &quot;equals&quot; utility methods that stick to the standard.&lt;br/&gt;
I understand the usefulness of the current implementation in the examples which you gave, but as a matter of principle this usage is second in priority (from a user perspective): it is mainly internal to CM.&lt;br/&gt;
Maybe, we should create a &quot;util.internal&quot; package where (CM) developer-utilities methods would live, whereas &quot;util&quot; would contain the functions which users are most likely looking for.  I think that it would be clearer (e.g. it would avoid dealing with long names such as &quot;equalsIncludingNaN&quot;).  What do you think?&lt;/p&gt;</comment>
                            <comment id="12865724" author="psteitz" created="Mon, 10 May 2010 10:32:46 +0000"  >&lt;p&gt;I use the equals method and the array version in some of my  code that uses &lt;span class=&quot;error&quot;&gt;&amp;#91;math&amp;#93;&lt;/span&gt; (pretty much the same basic use case as above) and I suspect it is possible that other users do as well, so I would prefer to keep a renamed version of it available publicly, if consensus is we need to rename it.  The fact that it is defined at all should be a flag to users that there is something different going on, at least in the &amp;lt;double, double&amp;gt; case.  Note that the &amp;lt;double, double, double&amp;gt; and &amp;lt;double, double, int&amp;gt; versions are also &quot;different&quot; from the JDK; but there is no possibility for confusion of intent for them.&lt;/p&gt;</comment>
                            <comment id="12865729" author="erans" created="Mon, 10 May 2010 10:55:40 +0000"  >&lt;p&gt;I did not say that there should be private methods, unavailable to users of CM. Just that different packages would make it clear that some methods intend to implement common/standard functions while others are more special-purpose or could deviate from standard definitions.&lt;/p&gt;</comment>
                            <comment id="12866111" author="erans" created="Tue, 11 May 2010 09:52:08 +0000"  >&lt;p&gt;OK, maybe it is not necessary to introduce a new package.&lt;br/&gt;
Then, let&apos;s implement the proposed name change (&quot;equalsIncludingNaN&quot;).&lt;/p&gt;

&lt;p&gt;&amp;gt; Note that the &amp;lt;double, double, double&amp;gt; and &amp;lt;double, double, int&amp;gt; versions are also &quot;different&quot; from the JDK;&lt;br/&gt;
&amp;gt; but there is no possibility for confusion of intent for them.&lt;/p&gt;

&lt;p&gt;I do not agree. The point is there will be a confusion because the JDK treats &quot;Double&quot; and &quot;double&quot; &lt;em&gt;differently&lt;/em&gt; wrt NaN whereas those &quot;equals&quot; methods handle NaN &lt;em&gt;similarly&lt;/em&gt; to what happens with &quot;Double&quot;.&lt;/p&gt;

&lt;p&gt;In my (maybe naive) opinion, all this NaN business is not really important because the equality test itself doesn&apos;t make sense when a NaN is passed as arguments (meaning something went wrong previously).&lt;br/&gt;
However, there is this IEEE754 &lt;em&gt;standard&lt;/em&gt; saying that NaN is not equal to NaN. Hence, to avoid confusion, the &quot;equals&quot; methods should comply with it.  And, for all of them, we can add the special-purpose variant in the longer-named ones.&lt;/p&gt;

&lt;p&gt;Agreed?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;If so, I&amp;#39;m willing to make the changes and hunt for all the occurrences of &amp;quot;equals&amp;quot; with the current semantics and replace them with &amp;quot;equalsIncludingNaN&amp;quot;.&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="12866120" author="psteitz" created="Tue, 11 May 2010 10:15:57 +0000"  >&lt;p&gt;I am fine with deprecating and changing the name of MathUtils.equals(double, double) to &quot;equalsIncludingNaN&quot; or &quot;equalsN&quot;.   I see no reason to change the names or modify the behavior of any of the other equals methods in MathUtils.&lt;/p&gt;</comment>
                            <comment id="12866129" author="erans" created="Tue, 11 May 2010 11:15:28 +0000"  >&lt;p&gt;&amp;gt; I see no reason to change the names or modify the behavior of any of the other equals methods in MathUtils. &lt;/p&gt;

&lt;p&gt;Maybe because the other &quot;equals&quot; methods also consider that NaN == NaN which contradicts IEEE !&lt;/p&gt;

&lt;p&gt;Where people need to treat all NaN values as equal, they will use one of the &quot;equalsIncludingNaN&quot;, otherwise they will use one of the &quot;equals&quot; methods (and get an IEEE754-compliant result wrt to NaN values).&lt;/p&gt;</comment>
                            <comment id="12866253" author="psteitz" created="Tue, 11 May 2010 18:32:25 +0000"  >&lt;p&gt;Which methods exactly are you talking about?  &lt;/p&gt;</comment>
                            <comment id="12866296" author="erans" created="Tue, 11 May 2010 19:42:40 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; x, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; y) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.isNaN(x) &amp;amp;&amp;amp; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.isNaN(y)) || x == y;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; x, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; y, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; eps) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; equals(x, y) || (&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(y - x) &amp;lt;= eps);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] x, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] y) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((x == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) || (y == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !((x == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) ^ (y == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;));
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (x.length != y.length) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; x.length; ++i) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!equals(x[i], y[i])) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; x, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; y, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxUlps) {
    &lt;span class=&quot;code-comment&quot;&gt;// Check that &lt;span class=&quot;code-quote&quot;&gt;&quot;maxUlps&quot;&lt;/span&gt; is non-negative and small enough so that the
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; NAN won&apos;t compare as equal to anything.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; maxUlps &amp;gt; 0 &amp;amp;&amp;amp; maxUlps &amp;lt; NAN_GAP;

    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; xInt = &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.doubleToLongBits(x);
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; yInt = &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.doubleToLongBits(y);

    &lt;span class=&quot;code-comment&quot;&gt;// Make lexicographically ordered as a two&apos;s-complement integer.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (xInt &amp;lt; 0) {
        xInt = SGN_MASK - xInt;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (yInt &amp;lt; 0) {
        yInt = SGN_MASK - yInt;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(xInt - yInt) &amp;lt;= maxUlps;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The first assumes that NaN == NaN; the next two use the first; the last one also returns &lt;tt&gt;true&lt;/tt&gt; when both arguments are NaN.&lt;/p&gt;

&lt;p&gt;I propose that these &quot;equals&quot; will return &lt;tt&gt;false&lt;/tt&gt; when one or the other argument is NaN (or contains a NaN for the array variant), and to create for each one an &quot;equalsIncludingNaN&quot; variant that will behave as the current code of &quot;equals&quot;.&lt;br/&gt;
All occurrences of &quot;equals&quot; currently in CM will be replaced by &quot;equalsIncludingNaN&quot; so that no semantics change will happen.&lt;br/&gt;
CM will stay consistent and be compliant.&lt;/p&gt;</comment>
                            <comment id="12866321" author="erans" created="Tue, 11 May 2010 20:42:26 +0000"  >&lt;p&gt;Actually, I think that the first of the above &quot;equals&quot; should be replaced by:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; x, &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; y) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; equals(x, y, 1);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I.e. calling the fourth form (when it is replaced by the IEEE-compliant version).&lt;/p&gt;</comment>
                            <comment id="12867900" author="psteitz" created="Sat, 15 May 2010 19:09:05 +0000"  >&lt;p&gt;Looking carefully at the uses inside &lt;span class=&quot;error&quot;&gt;&amp;#91;math&amp;#93;&lt;/span&gt; and reviewing my own uses, I agree now that the original definitions of equals(double, double) and equals(double, double, double) were incorrect, or I guess I should say &quot;unfortunate.&quot;  Regarding equals(double, double), I don&apos;t see why we need that at all - just deprecate and replace by &quot;equalsN&quot; or somesuch or remove it altogether in 3.0. The uses of equals(double, double, double)  in the linear package should NOT identify NaNs, so these would benefit from changing behavior.  The uses in the stats package of the array version are OK, I think - i.e., I think it is a legitimate definition of equals for a stats reporting object to identify stats that report NaNs in the same places.&lt;/p&gt;

&lt;p&gt;So the question is what to do.  I don&apos;t think we can change the contracts or delete methods in point releases, so the reasonable thing to do is to &lt;/p&gt;

&lt;p&gt;1) deprecate equals(double, double) &lt;br/&gt;
2) Make a note in the javadoc for equals(double[], double[]) and equals(double, double, double) indicating that in version 3.0 these methods will handle NaNs differently.&lt;br/&gt;
3) Fix equals(double, double, int).  This method does not use equals(double, double) and does not specify how NaNs are handled in its javadoc, so it can be fixed.&lt;/p&gt;</comment>
                            <comment id="12869542" author="erans" created="Thu, 20 May 2010 09:57:17 +0000"  >&lt;p&gt;&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; Regarding equals(double, double), I don&apos;t see why we need that at all &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;As I noted in the previous comment, this version of an equality test seems to make sense, from a numerical perspective, if it&apos;s implemented by using the &quot;equals(double,double,int)&quot; method (introduced according to &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-264&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MATH-264&lt;/a&gt;) where the third argument is set to 1): It means that there is no floating point number in the range of real numbers defined by the first and second arguments.&lt;/p&gt;

&lt;p&gt;Practically, I&apos;ve now modified all the &quot;equals&quot; methods (so that NaN != NaN) and for each one, I&apos;ve also implemented an &quot;equalsIncludingNaN&quot; version (for which NaN == NaN).&lt;br/&gt;
In the &quot;stat&quot; package, wherever &quot;equals&quot; was used, I replaced it with &quot;equalsIncludingNaN&quot;.&lt;br/&gt;
I modified the junit tests (&quot;mutatis mutandis&quot;) and they all pass.&lt;/p&gt;

&lt;p&gt;I don&apos;t think it&apos;s worth waiting v3.0 to introduce those changes, for the following reasons:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The change is non-breaking wrt usage of the code in package &quot;stat&quot;, or any other code that was using &quot;equals&quot;.&lt;/li&gt;
	&lt;li&gt;No functionality is removed (i.e. the &quot;equalsIncludingNaN&quot; provide the same behaviour as previously provided by the corresponding &quot;equals&quot; methods).&lt;/li&gt;
	&lt;li&gt;For a direct user of &quot;equals&quot;, the change is, in principle, breaking but only in the single case where he relies on NaNs being equal. How likely is it that expecting such a behaviour is &lt;b&gt;not&lt;/b&gt; wrong (i.e. comparing the results of computations that produced meaningless values)?&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;To further alleviate the (marginal) risk of the last point, couldn&apos;t we make a poll on the &quot;user&quot; ML, so that people can make a case if they really need the time to a major version change in order to adapt to this modification?&lt;/p&gt;</comment>
                            <comment id="12870395" author="psteitz" created="Sun, 23 May 2010 13:46:14 +0000"  >&lt;p&gt;Regarding equals(double, double), it looks like what you are proposing is yet another version of equals that is not exactly what is defined in the spec.  Do I have that right?  In that case, like the current version, it should have a different name.  Or does the spec imply that equals should behave this way and the JDK not quite deliver it?&lt;/p&gt;

&lt;p&gt;I sympathize with the desire to change the definitions of the other methods now; but while we did not quite live up to this in 2.1, .x versions are supposed to be drop-in replacements, so we should not be changing behavior of methods unless they are not meeting their documented contracts and in this case, what we are seeing as &quot;bugged&quot; are the contracts, so I think we need to deprecate  equals(double, double) and fix the others in 3.0, with the exception of equals(double, double, int), which does not specify NaN behavior.  We can introduce the new &quot;equalsN&quot; versions now and note the changed behavior in the javadoc for the &quot;equals&quot; versions.  We can also introduce the new version of equals(double, double) that you are describing with a new name.&lt;/p&gt;</comment>
                            <comment id="12877041" author="erans" created="Wed, 9 Jun 2010 10:47:08 +0000"  >&lt;p&gt;Changes partially implemented in r952949. &lt;span class=&quot;error&quot;&gt;&amp;#91;Hopefully not breaking compatibility.&amp;#93;&lt;/span&gt;&lt;br/&gt;
Methods &quot;equalsIncludingNaN&quot; have been added and used internally (in the classes of the &quot;stat.descriptive&quot; package) instead of the now deprecated &quot;equals&quot; methods. Those should change semantics in release 3.0.&lt;/p&gt;</comment>
                            <comment id="12905025" author="erans" created="Wed, 1 Sep 2010 13:47:58 +0000"  >&lt;p&gt;Revision 991535.&lt;/p&gt;</comment>
                            <comment id="13010339" author="luc" created="Wed, 23 Mar 2011 20:05:24 +0000"  >&lt;p&gt;Closing issue as it was included in version 2.2, which has been released&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>150530</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ruvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160648</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>