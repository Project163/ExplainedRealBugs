<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:28:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-942] DiscreteDistribution.sample(int) may throw an exception if first element of singletons of sub-class type</title>
                <link>https://issues.apache.org/jira/browse/MATH-942</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;Creating an array with &lt;tt&gt;Array.newInstance(singletons.get(0).getClass(), sampleSize)&lt;/tt&gt; in DiscreteDistribution.sample(int) is risky. An exception will be thrown if:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;singleons.get(0)&lt;/tt&gt; is of type T1, an sub-class of T, and&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;DiscreteDistribution.sample()&lt;/tt&gt; returns an object which is of type T, but not of type T1.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;List&amp;lt;Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;,&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt;&amp;gt; list = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt;&amp;gt;();
list.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;() {}, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(0)));
list.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;() {}, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(1)));
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DiscreteDistribution&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;(list).sample(1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attaching a patch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12636190">MATH-942</key>
            <summary>DiscreteDistribution.sample(int) may throw an exception if first element of singletons of sub-class type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="wydrych">Piotr Wydrych</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Mar 2013 15:05:04 +0000</created>
                <updated>Sun, 7 Apr 2013 09:20:25 +0000</updated>
                            <resolved>Sun, 10 Mar 2013 12:02:31 +0000</resolved>
                                                    <fixVersion>3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13597980" author="luc" created="Sat, 9 Mar 2013 15:41:46 +0000"  >&lt;p&gt;We have encountered the same kind of issue with Field implementations. For this reason, we have added the method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; FieldElement&amp;lt;T&amp;gt;&amp;gt; getRuntimeClass();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in the interface, so appropriate objects can be created (this is what is used in the buildArray method in MathArrays). However, we cannot do the same here because we want to allow any class in the distribution, not only implementations of one of our interfaces.&lt;/p&gt;

&lt;p&gt;Passing the runtime class as an argument to the distribution would work, but seems also cumbersome.&lt;/p&gt;

&lt;p&gt;I am a bit reluctant to use Object[] as your patch, though. Are you sure it would always work? I know type erasure occurs, but with your patch, we mainly apply it ourselves. Is it safe?&lt;/p&gt;</comment>
                            <comment id="13598071" author="wydrych" created="Sat, 9 Mar 2013 22:17:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;I am a bit reluctant to use Object[] as your patch, though. Are you sure it would always work? I know type erasure occurs, but with your patch, we mainly apply it ourselves. Is it safe?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I did some reading, scanning other generics classes code, and testing. It seems that there are two proper ways to do it:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;return &lt;tt&gt;Object[]&lt;/tt&gt;, or&lt;/li&gt;
	&lt;li&gt;return &lt;tt&gt;List&amp;lt;T&amp;gt;&lt;/tt&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I suggest returning &lt;tt&gt;Object[]&lt;/tt&gt;, like &lt;tt&gt;ArrayList.toArray()&lt;/tt&gt;. I&apos;ve attached an updated patch.&lt;/p&gt;

&lt;p&gt;Then, the following code will work:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;X {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
        List&amp;lt;Pair&amp;lt;X, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt;&amp;gt; list = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Pair&amp;lt;X, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt;&amp;gt;();
        list.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pair&amp;lt;X, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; X(), &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(1)));
        X[] xarr;
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] oarr;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            xarr = (X[]) &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DiscreteDistribution&amp;lt;X&amp;gt;(list).sample(1);
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Expected ClassCastException&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ClassCastException e) {
        }
        oarr = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DiscreteDistribution&amp;lt;X&amp;gt;(list).sample(1);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13598217" author="luc" created="Sun, 10 Mar 2013 12:02:31 +0000"  >&lt;p&gt;Fixed in subversion repository as of r1454840.&lt;/p&gt;

&lt;p&gt;Thanks for the report and for the patch.&lt;/p&gt;</comment>
                            <comment id="13598225" author="tn" created="Sun, 10 Mar 2013 12:41:14 +0000"  >&lt;p&gt;What do you think about the following extension:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    /**
     * Generate a random sample from the distribution.
     * &amp;lt;p&amp;gt;
     * If the requested samples fit in the specified array, it is returned
     * therein. Otherwise, a new array is allocated with the runtime type of
     * the specified array and the size of this collection.
     *
     * @param sampleSize the number of random values to generate.
     * @param array the array to populate.
     * @return an array representing the random sample.
     * @throws NotStrictlyPositiveException if {@code sampleSize} is not
     * positive.
     * @throws IllegalArgumentException if {@code array} is null
     */
    public T[] sample(int sampleSize, final T[] array) throws NotStrictlyPositiveException {
        if (sampleSize &amp;lt;= 0) {
            throw new NotStrictlyPositiveException(LocalizedFormats.NUMBER_OF_SAMPLES,
                    sampleSize);
        }

        if (array == null) {
            throw new IllegalArgumentException(&quot;array may not be null&quot;);
        }

        T[] out;
        if (array.length &amp;lt; sampleSize) {
            @SuppressWarnings(&quot;unchecked&quot;) // safe as both are of type T
            final T[] unchecked = (T[]) Array.newInstance(array.getClass().getComponentType(), sampleSize);
            out = unchecked;
        } else {
            out = array;
        }

        for (int i = 0; i &amp;lt; sampleSize; i++) {
            out[i] = sample();
        }

        return out;

    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Similar to the toArray(T[]) methods of Collections, a user could already provide an array which is used if the sample size fits into it, otherwise it is created in a type-safe way, and the return-type is of T[] so that a user does not have to do a cast.&lt;/p&gt;</comment>
                            <comment id="13598226" author="tn" created="Sun, 10 Mar 2013 12:43:17 +0000"  >&lt;p&gt;The other sample(int sampleSize) method could stay there too. So a user has the choice.&lt;/p&gt;</comment>
                            <comment id="13598227" author="luc" created="Sun, 10 Mar 2013 12:50:12 +0000"  >&lt;p&gt;This seems a good idea to me.&lt;/p&gt;</comment>
                            <comment id="13624835" author="luc" created="Sun, 7 Apr 2013 09:20:25 +0000"  >&lt;p&gt;Closing issue as version 3.2 has been released on 2013-04-06.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12572933" name="DiscreteDistribution.java.patch" size="1348" author="wydrych" created="Sat, 9 Mar 2013 22:17:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>316682</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1in8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>317024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>