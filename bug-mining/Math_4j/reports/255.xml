<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:27:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-701] Seeding a default RNG</title>
                <link>https://issues.apache.org/jira/browse/MATH-701</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;In &quot;RandomDataImpl&quot;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; RandomGenerator getRan() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rand == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        rand = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JDKRandomGenerator();
        rand.setSeed(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis());
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rand;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The conditional branch is used by &quot;sample()&quot; in &quot;AbstractContinuousDistribution&quot;.&lt;/p&gt;

&lt;p&gt;When several &quot;...Distribution&quot; objects are instantiated in a short time interval, they are seeded with the same value.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12530041">MATH-701</key>
            <summary>Seeding a default RNG</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erans">Gilles Sadowski</assignee>
                                    <reporter username="erans">Gilles Sadowski</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Nov 2011 13:26:43 +0000</created>
                <updated>Sat, 24 Mar 2012 16:16:47 +0000</updated>
                            <resolved>Sat, 5 Nov 2011 06:50:22 +0000</resolved>
                                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13143287" author="mikl" created="Thu, 3 Nov 2011 16:31:22 +0000"  >&lt;p&gt;I see your point, but at the same time it might be difficult to deal with correctly. One work-around is to use the serialVersionUID field together with System.currentTimeMillis(), but I am not sure if that is a good idea nor how well it can be implemented.&lt;/p&gt;</comment>
                            <comment id="13143300" author="erans" created="Thu, 3 Nov 2011 16:43:16 +0000"  >&lt;p&gt;No, my point was that the seeding should just be removed: When several distribution objects are instantiated, we usually don&apos;t want the samples to be the same...&lt;/p&gt;</comment>
                            <comment id="13143322" author="psteitz" created="Thu, 3 Nov 2011 17:09:28 +0000"  >&lt;p&gt;I agree that there is a problem here; but I would solve it in AbstractContinuousDistribution by passing a seeded generator to the RandomDataImpl constructor.  The code above is for the default case where no generator has been supplied or set.  For sampling, a Well generator would be a better choice.&lt;/p&gt;</comment>
                            <comment id="13143559" author="erans" created="Thu, 3 Nov 2011 22:10:11 +0000"  >&lt;p&gt;IIRC we discarded the solution of passing a RNG in the distribution&apos;s constructor because the &quot;sample&quot; methods was construed as syntactic sugar in order to access the &quot;RandomData&quot; functionality from within the &quot;...Distribution&quot; classes.&lt;br/&gt;
It was also argued that people who would use this API (instead of directly instantiating a &quot;RandomDataImpl&quot; object) would be satisfied with a default RNG, whatever was deemed the best choice by the CM developers. Thus, if another generator is indeed better, we should just plug it in instead of the current &quot;JDKRandomGenerator&quot;.&lt;br/&gt;
In the same line of argument, the possibility of seeding was also supposed to be given up in exchange for a &quot;sample&quot; API at the distribution level.&lt;/p&gt;

&lt;p&gt;In &quot;AbstractContinuousDistribution&quot;, we have:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RandomDataImpl randomData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomDataImpl();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In effect, there is no reason not to replace that statement with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RandomDataImpl randomData = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomDataImpl(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Well44497a());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As as side note: I don&apos;t understand why there is a default constructor in &quot;RandomDataImpl&quot;; since all the methods need a RNG, it does not make much sense to allow the object to be constructed without one!&lt;/p&gt;

&lt;p&gt;Second side note: Why not separate the &quot;secure&quot; alternatives into another implementation? There would be &quot;RandomData&quot; (with a &quot;nextHexString&quot; method) and a &quot;SecureRandomData&quot; (also with a &quot;nextHexString&quot; method, instead of the current &quot;nextSecureHexString&quot;).&lt;/p&gt;

&lt;p&gt;Back to this report&apos;s issue: The parent class &quot;AbstractWell&quot; seems to suffer from the same problem because the default constructor calls &lt;tt&gt;System.currentTimeMillis()&lt;/tt&gt;.&lt;br/&gt;
We should have a look at how &quot;java.util.Random&quot; seeds its default instances so that they can claim (excerpt form Javadoc):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;This constructor sets the seed of the random number generator to a value very likely to be
distinct from any other invocation of this constructor.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13143706" author="psteitz" created="Fri, 4 Nov 2011 02:43:49 +0000"  >&lt;p&gt;+1 to changing the default in the RandomDataImpl to a Well generator (documenting this)&lt;br/&gt;
+1 as well to trying to find a better default seed (documenting how it works).  Harmony still belongs to us, so we can certainly look at / imitate the impl there.&lt;/p&gt;

&lt;p&gt;The reason that the argumentless constructor exists is to allow users to accept the default generator. The lazy initialization idiom was chosen because in some cases, users may choose to invoke the setter instead of passing a generator as a constructor argument.  This is an older style no longer in use much in &lt;span class=&quot;error&quot;&gt;&amp;#91;math&amp;#93;&lt;/span&gt;.  I would be OK getting rid of this - i.e., having the argumentless constructor take the hit to create a default instance.&lt;/p&gt;

&lt;p&gt;-0 for separating out the secure stuff.  RandomDataImpl is an aggregate class that bundles a lot of commonly used random data generation methods.  Just as the random generator is pluggable, so is the secure random generator, which makes the class convenient to use for applications that require both kinds of random values.  I think its simpler and more convenient to bundle things as they are.  Of course, I have been using this class for a long time, so I may not be the best judge of what is simplest / easiest to use.&lt;/p&gt;</comment>
                            <comment id="13143870" author="sebb@apache.org" created="Fri, 4 Nov 2011 09:40:44 +0000"  >&lt;p&gt;If lazy init is dropped, then the rand field can be made final.&lt;/p&gt;

&lt;p&gt;Can secRand be made final? This would mean dropping setSecureAlgorithm() in favour of an extra ctor.&lt;br/&gt;
Since secRand is not always needed, this is an argument for making the secure stuff a sub-class.&lt;br/&gt;
Alternatively, IODH could perhaps be used with secRand.&lt;/p&gt;</comment>
                            <comment id="13143944" author="erans" created="Fri, 4 Nov 2011 12:10:04 +0000"  >&lt;ul&gt;
	&lt;li&gt;From Harmony&apos;s implementation of &quot;java.util.Random&quot;:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Random() {
    setSeed(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() + hashCode());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I&apos;d also prefer setting both RNGs at construction.&lt;br/&gt;
A user would have to write
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SecureRandom secRand = SecureRandom.getInstance(algorithm, provider);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in his application&apos;s code, and that would make it clearer for him why and how an exception can be generated (and that CM&apos;s code is not the cause of it).&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I also favour a new &quot;SecureRandomDataImpl&quot; as a subclass of &quot;RandomDataImpl&quot;; the constructor would be something like:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SecureRandomDataImpl(SecureRandom rng) {
    &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(rng);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This would ensure that &lt;em&gt;all&lt;/em&gt; the &lt;tt&gt;next...&lt;/tt&gt; methods use a secure RNG, whereas currently only some of the accessors have a secure alternative (e.g. &quot;nextGaussian&quot; is not using &quot;secRand&quot;). This would be less confusing without requiring long explanations...&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13144122" author="psteitz" created="Fri, 4 Nov 2011 16:23:33 +0000"  >&lt;p&gt;I just committed (r1197626) a) change to Well generator as default for non-secure generator b) seeding like the Harmony code.  Can we resolve this and take the refactoring discussion to the dev list?&lt;/p&gt;</comment>
                            <comment id="13144161" author="erans" created="Fri, 4 Nov 2011 16:59:29 +0000"  >&lt;p&gt;Okay for the design discussion! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;But don&apos;t resolve just yet.&lt;br/&gt;
To avoid nasty surprises, I think that the &quot;AbstractWell&quot; (maybe others?) should be modified so that default constructors are all seeded similarly.&lt;br/&gt;
&quot;RandomDataImpl&quot; as a &quot;user&quot; of the RNG should not have to worry how to best seed the generator.&lt;/p&gt;</comment>
                            <comment id="13144170" author="psteitz" created="Fri, 4 Nov 2011 17:09:47 +0000"  >&lt;p&gt;I thought about changing the default seeding in AbstractWell and agree that would be a good idea.  I still like to supply the seed explicitly and document it in RandomDataImpl, though, so users of that class know exactly what they are getting by default.  There is a little wrinkle here, too that keeping the seeding expressed and documented in RandomDataImpl makes easier to keep track of.  If we ever implement hashcode in RandomDataImpl (or the Well generators), things could get messed up if it does not separate generator instances the way the system identity haschcode does.&lt;/p&gt;</comment>
                            <comment id="13144613" author="psteitz" created="Sat, 5 Nov 2011 06:50:23 +0000"  >&lt;p&gt;Changes to WELL, MersenneTwister committed in r1197896.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12534185">MATH-720</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215900</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aotj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60294</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>