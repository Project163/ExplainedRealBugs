<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:28:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-868] Default sigma for CMAESOptimizer is wrong when using bounds</title>
                <link>https://issues.apache.org/jira/browse/MATH-868</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;The documentation suggests setting inputSigma to 1/3 the range you are fitting over.  However, in CMAESOptimizer.initializeCMA() if boundaries are specified the sigmaArray is by default assigned a value of 0.3 divided by the range.  If the user had specified the inputSigma to be 0.3 of the range (as suggested by the docs) then sigmaArray would have been assigned the value of 0.3.  Thus, it looks like the 0.3 should not be divided by the range, only a user-specified inputSigma should get divided by the range.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608714">MATH-868</key>
            <summary>Default sigma for CMAESOptimizer is wrong when using bounds</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="11">Done</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fhess">Frank Hess</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Sep 2012 23:47:26 +0000</created>
                <updated>Tue, 7 Jun 2016 20:50:16 +0000</updated>
                            <resolved>Tue, 7 Jun 2016 20:50:16 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13461128" author="erans" created="Sat, 22 Sep 2012 11:51:04 +0000"  >&lt;p&gt;IIUC, the &quot;inputSigma&quot; should never be divided by the &quot;range&quot; but rather should be enforced to lie in the (0, 1) interval (and the documentation should suggest that &quot;0.3&quot; is a good default, and the value that is used when the user did not pass an &quot;inputSigma&quot; argument).&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13461294" author="erans" created="Sat, 22 Sep 2012 23:48:09 +0000"  >&lt;p&gt;While running the code which you provided in &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-867&quot; title=&quot;CMAESOptimizer with bounds fits finely near lower bound and coarsely near upper bound. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-867&quot;&gt;&lt;del&gt;MATH-867&lt;/del&gt;&lt;/a&gt;, I noticed that having an &quot;inputSigma&quot; either much larger or much smaller than 0.3 gives even worse results for that test (both when the optimum is near the lower bound and whne it&apos;s near the upper bound).&lt;br/&gt;
From this, I&apos;d suspect that the code is correct (always divided by the range), but that the documentation is wrong to suggest multiplying 0.3 by the range as a good value for &quot;inputSigma&quot;.&lt;/p&gt;

&lt;p&gt;I propose to modify the doc of &quot;inputSigma&quot;, indicating that it should be about 0.3.&lt;br/&gt;
That looks strange, and the problem may well lie deeper (in how constraints are taken into account). Unless you have a test case, there isn&apos;t much more I can do, unfortunately.&lt;/p&gt;</comment>
                            <comment id="13461775" author="fhess" created="Mon, 24 Sep 2012 12:54:41 +0000"  >&lt;p&gt;I found an older ticket on this: &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-702&quot; title=&quot;CMA-ES optimizer input sigma should not be normalized by user&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-702&quot;&gt;&lt;del&gt;MATH-702&lt;/del&gt;&lt;/a&gt;.  Apparently, the intent is for inputSigma to be in the same units as the other parameters (not normalized to the interval zero to one).  I can confirm when I play with the &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-867&quot; title=&quot;CMAESOptimizer with bounds fits finely near lower bound and coarsely near upper bound. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-867&quot;&gt;&lt;del&gt;MATH-867&lt;/del&gt;&lt;/a&gt; test it does worse with sigma that are much less than or greater than 1, I&apos;m not sure what that means.&lt;/p&gt;</comment>
                            <comment id="13461777" author="fhess" created="Mon, 24 Sep 2012 13:03:17 +0000"  >&lt;p&gt;Also, in the Matlab code from &lt;a href=&quot;http://www.lri.fr/~hansen&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.lri.fr/~hansen&lt;/a&gt; I found a place where he defaults the sigma to 0.3 times the range:&lt;/p&gt;

&lt;p&gt;insigma = 0.3*(ubounds-lbounds);&lt;/p&gt;</comment>
                            <comment id="13466352" author="erans" created="Sat, 29 Sep 2012 22:52:43 +0000"  >&lt;p&gt;The fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-867&quot; title=&quot;CMAESOptimizer with bounds fits finely near lower bound and coarsely near upper bound. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-867&quot;&gt;&lt;del&gt;MATH-867&lt;/del&gt;&lt;/a&gt; probably fixes this issue too.&lt;br/&gt;
What do you think?&lt;/p&gt;</comment>
                            <comment id="13466829" author="fhess" created="Mon, 1 Oct 2012 14:19:46 +0000"  >&lt;p&gt;After the &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-867&quot; title=&quot;CMAESOptimizer with bounds fits finely near lower bound and coarsely near upper bound. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-867&quot;&gt;&lt;del&gt;MATH-867&lt;/del&gt;&lt;/a&gt; fix, it defaults inputSigma to 0.3 regardless of boundaries.  This is effectively the same as the behavior I originally reported in this bug.  I&apos;m okay with that though, as the simpler code no longer makes it look like it is trying to do something fancier.  I suggest the class be given a public DEFAULT_INPUTSIGMA constant equal to 0.3 (like the class&apos;s other DEFAULT_XXX constants) to make it explicit and documented what the default is.&lt;/p&gt;</comment>
                            <comment id="13466912" author="erans" created="Mon, 1 Oct 2012 16:26:35 +0000"  >&lt;p&gt;Quoting Nikolaus Hansen (from issue &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-867&quot; title=&quot;CMAESOptimizer with bounds fits finely near lower bound and coarsely near upper bound. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-867&quot;&gt;&lt;del&gt;MATH-867&lt;/del&gt;&lt;/a&gt;):&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Points beyond, say, startpoint + 10*sigma are not likely to be sampled in the beginning.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Codes I write typically don&apos;t accept a default value for inputSigma, &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I wonder whether it wouldn&apos;t be better to not have a default, i.e. deprecate the constructors that do not require the values to be specified.&lt;/p&gt;

&lt;p&gt;The situation is even worse, I see now, in that &quot;inputSigma&quot; should not be passed at all at construction because it depends on the number of parameters and on their scale (values of the upper and lower bounds), whereas the interface to the CM optimizers was designed to allow multiple &quot;optimize&quot; calls to the &lt;em&gt;same&lt;/em&gt; optimizer with&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;different functions (even with a different number of parameters),&lt;/li&gt;
	&lt;li&gt;different start points,&lt;/li&gt;
	&lt;li&gt;different boundaries.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All these arguments are passed with the call to &quot;optimize&quot;. Ideally the &quot;inputSigma&quot; argument should be specified at that level too. But it can&apos;t because it&apos;s not (and cannot be) part of the general interface.&lt;br/&gt;
A solution to this API problem would be welcome for 4.0.&lt;/p&gt;</comment>
                            <comment id="13466999" author="fhess" created="Mon, 1 Oct 2012 17:43:50 +0000"  >&lt;p&gt;Well, the SimplexOptimizer handles this issue by having a &quot;setSimplex&quot; method which can be called before each call to optimize.  CMAESOptimizer could have a &quot;setInputSigma&quot; method.&lt;/p&gt;</comment>
                            <comment id="13467227" author="erans" created="Mon, 1 Oct 2012 21:51:11 +0000"  >&lt;p&gt;I think that it is the best we can do for now.&lt;/p&gt;</comment>
                            <comment id="13476103" author="erans" created="Mon, 15 Oct 2012 12:22:56 +0000"  >&lt;p&gt;Actually, &lt;a href=&quot;https://issues.apache.org/jira/browse/MATH-874&quot; title=&quot;New API for optimizers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MATH-874&quot;&gt;&lt;del&gt;MATH-874&lt;/del&gt;&lt;/a&gt; provides a solution to make the API uniform.&lt;/p&gt;</comment>
                            <comment id="13478931" author="erans" created="Thu, 18 Oct 2012 11:53:44 +0000"  >&lt;p&gt;Coming back to the issue the default value for sigma.&lt;br/&gt;
Currently, it is thus still 0.3 but IIUC, this might be a very bad default if the range of the parameters is large and the initial guess is far from the optimum (cf. Nikolaus&apos;s advice that it should be about one third of the initial search volume).&lt;br/&gt;
Nikolaus also mentioned that providing a default might simply not be a good idea at all.&lt;/p&gt;

&lt;p&gt;Hence I&apos;d suggest that if &quot;inputSigma&quot; is null, an exception be thrown (instead of making up a possibly meaningless default).&lt;br/&gt;
Unfortunately, that will break some applications (if they use the constructors without the &quot;inputSigma&quot; argument). Could the current behaviour (not specifying &quot;inputSigma&quot;) be considered buggy enough to warrant a compatibility breaking?&lt;/p&gt;</comment>
                            <comment id="13480048" author="erans" created="Fri, 19 Oct 2012 14:24:37 +0000"  >&lt;p&gt;Code and unit tests updated in revision 1400108.&lt;/p&gt;

&lt;p&gt;Further changes postponed until preparation of 4.0 (see code marked with &quot;XXX&quot;).&lt;/p&gt;</comment>
                            <comment id="15319374" author="erans" created="Tue, 7 Jun 2016 20:50:16 +0000"  >&lt;p&gt;There is no code marked with &quot;XXX&quot; anymore.&lt;br/&gt;
Thus, I guess that the issue should have been closed earlier.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12609820">MATH-872</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241567</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i028p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11010</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>