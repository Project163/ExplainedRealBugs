<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:26:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-320] NaN singular value from SVD</title>
                <link>https://issues.apache.org/jira/browse/MATH-320</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;The following jython code&lt;br/&gt;
Start code&lt;/p&gt;

&lt;p&gt;from org.apache.commons.math.linear import *&lt;/p&gt;

&lt;p&gt;Alist = [&lt;span class=&quot;error&quot;&gt;&amp;#91;1.0, 2.0, 3.0&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;2.0,3.0,4.0&amp;#93;&lt;/span&gt;,&lt;span class=&quot;error&quot;&gt;&amp;#91;3.0,5.0,7.0&amp;#93;&lt;/span&gt;]&lt;/p&gt;

&lt;p&gt;A = Array2DRowRealMatrix(Alist)&lt;/p&gt;

&lt;p&gt;decomp = SingularValueDecompositionImpl(A)&lt;/p&gt;

&lt;p&gt;print decomp.getSingularValues()&lt;/p&gt;

&lt;p&gt;End code&lt;/p&gt;

&lt;p&gt;prints&lt;br/&gt;
array(&apos;d&apos;, &lt;span class=&quot;error&quot;&gt;&amp;#91;11.218599757513008, 0.3781791648535976, nan&amp;#93;&lt;/span&gt;)&lt;br/&gt;
The last singular value should be something very close to 0 since the matrix&lt;br/&gt;
is rank deficient.  When i use the result from getSolver() to solve a system, i end &lt;br/&gt;
up with a bunch of NaNs in the solution.  I assumed i would get back a least squares solution.&lt;/p&gt;

&lt;p&gt;Does this SVD implementation require that the matrix be full rank?  If so, then i would expect&lt;br/&gt;
an exception to be thrown from the constructor or one of the methods.&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Linux (Ubuntu 9.10) java version &quot;1.6.0_16&quot;&lt;/p&gt;</environment>
        <key id="12440296">MATH-320</key>
            <summary>NaN singular value from SVD</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dieterv77">Dieter Vandenbussche</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Nov 2009 15:42:34 +0000</created>
                <updated>Thu, 23 Jun 2011 20:02:56 +0000</updated>
                            <resolved>Thu, 31 Dec 2009 17:55:04 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12776063" author="luc" created="Tue, 10 Nov 2009 20:23:02 +0000"  >&lt;p&gt;This is a real new bug, thanks for reporting it.&lt;/p&gt;

&lt;p&gt;Before I look more precisely at it, could you do a quick check for me ?&lt;/p&gt;

&lt;p&gt;If at the end of the SingularValueDecompositionImpl constructor, around line 118 in the java source file you change from:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  singularValues[i] = Math.sqrt(singularValues[i]);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  singularValues[i] = Math.sqrt(Math.max(0, singularValues[i]));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;does the problem still appear on singular values and does the solver work properly ?&lt;/p&gt;</comment>
                            <comment id="12776449" author="dieterv77" created="Wed, 11 Nov 2009 13:37:27 +0000"  >&lt;p&gt;Yes, making that change fixes the singular values, printing the singular values now gives&lt;/p&gt;

&lt;p&gt;array(&apos;d&apos;, &lt;span class=&quot;error&quot;&gt;&amp;#91;11.218599757513008, 0.3781791648535976, 0.0&amp;#93;&lt;/span&gt;)&lt;/p&gt;

&lt;p&gt;The unittests for the project still pass as well.&lt;/p&gt;

&lt;p&gt;However, now the solve fails with a SinularMatrixException&lt;/p&gt;

&lt;p&gt;Traceback (most recent call last):&lt;br/&gt;
  File &quot;testdecomp.py&quot;, line 14, in &amp;lt;module&amp;gt;&lt;br/&gt;
    soln = solver.solve(&lt;span class=&quot;error&quot;&gt;&amp;#91;5.0, 6.0,7.0&amp;#93;&lt;/span&gt;)&lt;br/&gt;
	at org.apache.commons.math.linear.SingularValueDecompositionImpl$Solver.solve(SingularValueDecompositionImpl.java:371)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;/p&gt;

&lt;p&gt;org.apache.commons.math.linear.SingularMatrixException: org.apache.commons.math.linear.SingularMatrixException: matrix is singular&lt;/p&gt;

&lt;p&gt;This confuses me, i guess i&apos;m assuming incorrectly that if the solve method can solve in the least squares sense, then it should be&lt;br/&gt;
able to handle singular matrices.  Is that just a restriction on the current solve methods and if so, are there plans to relax that restriction?&lt;/p&gt;

&lt;p&gt;thanks very much for your time&lt;/p&gt;</comment>
                            <comment id="12776462" author="luc" created="Wed, 11 Nov 2009 14:21:59 +0000"  >&lt;p&gt;The method should solve the problem in the least square sense.&lt;br/&gt;
The fact it does not do it is not a restriction, it&apos;s a bug.&lt;br/&gt;
I&apos;ll have a look at it&lt;/p&gt;</comment>
                            <comment id="12792062" author="axelclk" created="Thu, 17 Dec 2009 18:43:44 +0000"  >
&lt;p&gt;Is this a similar problem for the getU() method?&lt;/p&gt;

&lt;p&gt;  public void testU() {&lt;br/&gt;
      double[][] testMatrix = {&lt;br/&gt;
          &lt;/p&gt;
{ 1.0 , 2.0 },&lt;br/&gt;
          { 1.0 , 2.0 }
&lt;p&gt; };&lt;br/&gt;
      SingularValueDecompositionImpl svd =&lt;br/&gt;
          new SingularValueDecompositionImpl(MatrixUtils.createRealMatrix(testMatrix));&lt;br/&gt;
// wrong result:&lt;br/&gt;
      assertEquals(&quot;Array2DRowRealMatrix{{-0.7071067811865472,NaN},{-0.7071067811865475,NaN}}&quot;, svd.getU().toString());&lt;br/&gt;
    }&lt;/p&gt;</comment>
                            <comment id="12792132" author="luc" created="Thu, 17 Dec 2009 21:21:11 +0000"  >&lt;p&gt;The two issues are probably related.&lt;br/&gt;
I&apos;ll look at both cases.&lt;/p&gt;</comment>
                            <comment id="12795490" author="luc" created="Wed, 30 Dec 2009 23:27:04 +0000"  >&lt;p&gt;A first round on fixing this bug has been committed in the subversion repository as of r894735.&lt;br/&gt;
Axel example is confirmed to be an occurrence of the same bug as Dieter example.&lt;/p&gt;

&lt;p&gt;The SVD is now computed either as a compact SVD (only positive singular values considered) or as a truncated SVD&lt;br/&gt;
(max number of singular values to consider is user-specified). The solver simply applies the pseudo-inverse.&lt;/p&gt;

&lt;p&gt;The fix is not considered complete yet because I think that the results provided by the solver are not really the ones&lt;br/&gt;
that give the smallest residuals. See for example the commented out parts of testMath320A in&lt;br/&gt;
SingularValueSolverTest.  Could you check this, please ?&lt;/p&gt;</comment>
                            <comment id="12795591" author="axelclk" created="Thu, 31 Dec 2009 11:57:52 +0000"  >&lt;p&gt;This statement should print the values of the original matrix approximately:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
  &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(svd.getU().multiply(svd.getS()).multiply(svd.getVT()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;This is true for&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMath320A() {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;but not for&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testMath320B() {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;For reference values try wolfram alpha:&lt;br/&gt;
N[SingularValueDecomposition&lt;span class=&quot;error&quot;&gt;&amp;#91;{{1,2},{1,2}}&amp;#93;&lt;/span&gt;]&lt;/p&gt;</comment>
                            <comment id="12795606" author="luc" created="Thu, 31 Dec 2009 14:47:19 +0000"  >&lt;p&gt;Thanks for the hint Axel!&lt;br/&gt;
The print statement is even not satisfying for testMath320A, the approximation is really too bad. I would expect about 13 exact figures, not 1 or 2.&lt;br/&gt;
The problem seems to be related to matrix U which is not correct. In fact, it is even not unitary (i.e. U^T^.U is not the identity matrix).&lt;br/&gt;
I&apos;ll look at this.&lt;/p&gt;</comment>
                            <comment id="12795628" author="luc" created="Thu, 31 Dec 2009 17:55:04 +0000"  >&lt;p&gt;This should be fixed in subversion repository now (r894908).&lt;br/&gt;
Thanks for reporting the bug and sorry for the delay.&lt;/p&gt;</comment>
                            <comment id="13054069" author="gsteri1" created="Thu, 23 Jun 2011 20:02:56 +0000"  >&lt;p&gt;Did anyone notice that the 3rd eigenvalue is negative? On my box the eigenvalue is -2.1028862676867717E-14. I am not sure what the fix was, but whatever problems existed still persist. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34206</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 22 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rv6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160696</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>