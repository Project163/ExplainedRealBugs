<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:27:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-722] [math] Complex Tanh for &quot;big&quot; numbers</title>
                <link>https://issues.apache.org/jira/browse/MATH-722</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;In Complex.java the tanh is computed with the following formula:&lt;/p&gt;

&lt;p&gt;tanh(a + bi) = sinh(2a)/(cosh(2a)+cos(2b)) + &lt;span class=&quot;error&quot;&gt;&amp;#91;sin(2b)/(cosh(2a)+cos(2b))&amp;#93;&lt;/span&gt;i&lt;/p&gt;

&lt;p&gt;The problem that I&apos;m finding is that as soon as &quot;a&quot; is a &quot;big&quot; number,&lt;br/&gt;
both sinh(2a) and cosh(2a) are infinity and then the method tanh returns in&lt;br/&gt;
the real part NaN (infinity/infinity) when it should return 1.0.&lt;/p&gt;

&lt;p&gt;Wouldn&apos;t it be appropiate to add something as in the FastMath library??:&lt;/p&gt;

&lt;p&gt;if (real&amp;gt;20.0){&lt;br/&gt;
      return createComplex(1.0, 0.0);&lt;br/&gt;
}&lt;br/&gt;
if (real&amp;lt;-20.0){&lt;br/&gt;
      return createComplex(-1.0, 0.0);&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;Best regards,&lt;/p&gt;

&lt;p&gt;JBB&lt;/p&gt;</description>
                <environment>&lt;p&gt;I&apos;m working with Eclipse 3.6.2 on Windows XP, but the bug is Enviroment independent&lt;/p&gt;</environment>
        <key id="12534547">MATH-722</key>
            <summary>[math] Complex Tanh for &quot;big&quot; numbers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="celestin">Sebastien Brisard</assignee>
                                    <reporter username="jbbpopo">Juan Barandiaran</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Fri, 9 Dec 2011 21:34:40 +0000</created>
                <updated>Sat, 24 Mar 2012 16:16:50 +0000</updated>
                            <resolved>Fri, 27 Jan 2012 07:01:40 +0000</resolved>
                                    <version>2.2</version>
                                    <fixVersion>3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="900">0.25h</timeoriginalestimate>
                            <timeestimate seconds="900">0.25h</timeestimate>
                                        <comments>
                            <comment id="13167068" author="celestin" created="Sun, 11 Dec 2011 08:35:52 +0000"  >&lt;p&gt;Even when a is not large enough to cause overflows, I&apos;m not sure the general expression used is quite accurate (because &lt;tt&gt;cosh(2 * a)&lt;/tt&gt; and &lt;tt&gt;sinh(2 * a)&lt;/tt&gt; are very close, but not equal). I&apos;ve often come accross this issue, and found that reverting to exponential representation (keeping only the exponentials with negative argument) was much better behaved.&lt;/p&gt;

&lt;p&gt;In the present case, maybe the following representation of the real part&lt;br/&gt;
&lt;tt&gt;(1 - exp(-4 * a)) / (1 + 2 * exp(-2 * a) * cos(2 * b) + exp(-4 * a))&lt;/tt&gt;&lt;br/&gt;
would avoid overflows (for &lt;tt&gt;a &amp;gt; 0&lt;/tt&gt;, while remaining fairly accurate (otherwise, the threshold needs to be tuned).&lt;/p&gt;

&lt;p&gt;Similar expressions can be derived for &lt;tt&gt;a &amp;lt; 0&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;br/&gt;
S&#233;bastien&lt;/p&gt;</comment>
                            <comment id="13167071" author="luc" created="Sun, 11 Dec 2011 09:18:31 +0000"  >&lt;p&gt;Very good idea S&#233;bastien. Using stable formulas according to argument size is surely a good thing. We can also use FastMath.expm1() both in numerator and denominator, it will improve accuracy when a is close to 0.&lt;/p&gt;</comment>
                            <comment id="13194419" author="celestin" created="Fri, 27 Jan 2012 03:55:18 +0000"  >&lt;p&gt;I&apos;ve run some tests comparing the two formulas: I didn&apos;t notice any major difference. Therefore I suggest to stick with the existing formula.&lt;br/&gt;
Meanwhile, the fix proposed by Juan must be implemented. It can be proved mathematically that for any value of &lt;tt&gt;b&lt;/tt&gt;, the value of &lt;tt&gt;tanh(a + i * b)&lt;/tt&gt; is within one ulp of 1.0 for &lt;tt&gt;abs(a) &amp;gt; 18.9&lt;/tt&gt;, so the proposed threshold (20.0) is fairly safe, and consistent with other parts of CM. Note that the same fix must be implemented for &lt;tt&gt;tan&lt;/tt&gt; also.&lt;/p&gt;</comment>
                            <comment id="13194521" author="celestin" created="Fri, 27 Jan 2012 07:01:40 +0000"  >&lt;p&gt;Changes proposed by Juan committed in &lt;tt&gt;r1236548&lt;/tt&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220269</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aopz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60278</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>