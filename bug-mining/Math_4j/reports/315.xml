<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:27:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[MATH-803] Bugs in RealVector.ebeMultiply(RealVector) and ebeDivide(RealVector)</title>
                <link>https://issues.apache.org/jira/browse/MATH-803</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;&lt;tt&gt;OpenMapRealVector.ebeMultiply(RealVector)&lt;/tt&gt; and &lt;tt&gt;OpenMapRealVector.ebeDivide(RealVector)&lt;/tt&gt; return wrong values when one entry of the specified &lt;tt&gt;RealVector&lt;/tt&gt; is nan or infinity. The bug is easy to understand. Here is the current implementation of &lt;tt&gt;ebeMultiply&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; OpenMapRealVector ebeMultiply(RealVector v) {
        checkVectorDimensions(v.getDimension());
        OpenMapRealVector res = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OpenMapRealVector(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
        Iterator iter = entries.iterator();
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (iter.hasNext()) {
            iter.advance();
            res.setEntry(iter.key(), iter.value() * v.getEntry(iter.key()));
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; res;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The assumption is that for any double &lt;tt&gt;x&lt;/tt&gt;, &lt;tt&gt;x * 0d == 0d&lt;/tt&gt; holds, which is not true. The bug is easy enough to identify, but more complex to solve. The only solution I can come up with is to loop through &lt;b&gt;all&lt;/b&gt; entries of v (instead of those entries which correspond to non-zero entries of this). I&apos;m afraid about performance losses.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12560058">MATH-803</key>
            <summary>Bugs in RealVector.ebeMultiply(RealVector) and ebeDivide(RealVector)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="celestin">Sebastien Brisard</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Jun 2012 18:51:33 +0000</created>
                <updated>Mon, 19 May 2014 15:13:24 +0000</updated>
                            <resolved>Thu, 20 Feb 2014 15:58:58 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13292413" author="celestin" created="Sat, 9 Jun 2012 19:03:11 +0000"  >&lt;p&gt;In &lt;tt&gt;r1348485&lt;/tt&gt;, &lt;tt&gt;RealVectorAbstractTest&lt;/tt&gt; include unit tests illustrating this bug.&lt;/p&gt;</comment>
                            <comment id="13292525" author="luc" created="Sun, 10 Jun 2012 14:01:18 +0000"  >&lt;p&gt;Perhaps we should use a post-processing branch to handle infinite or spacial values:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// current implementation looping over non-zero instance elements goes here
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (v.isNaN() || v.isInfinite()) {
  &lt;span class=&quot;code-comment&quot;&gt;// post-processing loop, to handle 0 * infinity and 0 * NaN cases
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; v.getDimension(); ++v) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.isInfinite(v.getElement(i)) || &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.isNaN(v.getElement(i)) {
       res.setEntry(i, &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;.NaN);
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This could be fast only if isNaN() and isInfinite() results are cached and the same vector is reused, otherwise the outer if statement should be removed and the post-processing should be done in all cases.&lt;/p&gt;</comment>
                            <comment id="13292642" author="celestin" created="Mon, 11 Jun 2012 05:12:58 +0000"  >&lt;p&gt;I&apos;m going to implement the suggested post-processing for the time being; this should solve the bug. Caching of isNaN() and isInfinite() is postponed.&lt;/p&gt;</comment>
                            <comment id="13292648" author="celestin" created="Mon, 11 Jun 2012 05:43:22 +0000"  >&lt;p&gt;I think this does not work for &lt;tt&gt;ebeDivide(RealVector)&lt;/tt&gt;. In this case, I suggest to revert to naive implementation (loop through all entries).&lt;/p&gt;</comment>
                            <comment id="13399146" author="celestin" created="Fri, 22 Jun 2012 06:05:19 +0000"  >&lt;p&gt;Changed the title of the ticket, since the scope of this bug is much broader. Indeed, it affects &lt;tt&gt;RealVector.ebeMultiply(RealVector)&lt;/tt&gt; and &lt;tt&gt;RealVector.ebeDivide(RealVector)&lt;/tt&gt; as soon as the &lt;tt&gt;RealVector&lt;/tt&gt; passed as a parameter is sparse, see examples below&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;for &lt;tt&gt;ebeMultiply()&lt;/tt&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RealVector v1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayRealVector(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] { 1d });
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RealVector v2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OpenMapRealVector(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] { -0d });
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RealVector w = v1.ebeMultiply(v2);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(1d / w.getEntry(0));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;prints &lt;tt&gt;Infinity&lt;/tt&gt;, instead of &lt;tt&gt;-Infinity&lt;/tt&gt; (because the sign is lost in &lt;tt&gt;v2&lt;/tt&gt;). This means that &lt;tt&gt;w&lt;/tt&gt; holds &lt;tt&gt;+0d&lt;/tt&gt; instead of &lt;tt&gt;-0d&lt;/tt&gt;.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;for &lt;tt&gt;ebeDivide()&lt;/tt&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RealVector v1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayRealVector(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] { 1d });
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RealVector v2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OpenMapRealVector(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[] { -0d });
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RealVector w = v1.ebeDivide(v2);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(w.getEntry(0));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;prints &lt;tt&gt;Infinity&lt;/tt&gt;, instead of &lt;tt&gt;-Infinity&lt;/tt&gt;.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13399150" author="celestin" created="Fri, 22 Jun 2012 06:09:55 +0000"  >&lt;p&gt;According to this &lt;a href=&quot;http://markmail.org/thread/4evd6dcyrh2yc2bs&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;thread&lt;/a&gt;, &lt;tt&gt;ebeMultiply&lt;/tt&gt; and &lt;tt&gt;ebeDivide&lt;/tt&gt; are deprecated.&lt;/p&gt;</comment>
                            <comment id="13399177" author="celestin" created="Fri, 22 Jun 2012 07:08:36 +0000"  >&lt;p&gt;Methods are deprecated in &lt;tt&gt;r1352782&lt;/tt&gt;, and unit tests are skipped (they are kept for reference). Issue is to remain open until the methods are removed in version 4.0.&lt;/p&gt;</comment>
                            <comment id="13907109" author="luc" created="Thu, 20 Feb 2014 15:58:58 +0000"  >&lt;p&gt;Methods undeprecated in r1570246.&lt;br/&gt;
The test cases have been adapted, and the fact we force 0 * x = 0 even for NaNs and infinities is considered acceptable now, as it is similar to standard practive for sparse linear algebra libraries.&lt;/p&gt;</comment>
                            <comment id="14001801" author="luc" created="Mon, 19 May 2014 15:13:24 +0000"  >&lt;p&gt;Closing all resolved issue now available in released 3.3 version.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241596</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i028vj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11039</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>