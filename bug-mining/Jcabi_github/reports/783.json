{"url":"https://api.github.com/repos/jcabi/jcabi-github/issues/1366","repository_url":"https://api.github.com/repos/jcabi/jcabi-github","labels_url":"https://api.github.com/repos/jcabi/jcabi-github/issues/1366/labels{/name}","comments_url":"https://api.github.com/repos/jcabi/jcabi-github/issues/1366/comments","events_url":"https://api.github.com/repos/jcabi/jcabi-github/issues/1366/events","html_url":"https://github.com/jcabi/jcabi-github/issues/1366","id":305789901,"node_id":"MDU6SXNzdWUzMDU3ODk5MDE=","number":1366,"title":"Bug: asymetrical processing of asset contents between MkReleaseAssets.upload() and MkReleaseAsset.raw()","user":{"login":"llorllale","id":2019896,"node_id":"MDQ6VXNlcjIwMTk4OTY=","avatar_url":"https://avatars.githubusercontent.com/u/2019896?v=4","gravatar_id":"","url":"https://api.github.com/users/llorllale","html_url":"https://github.com/llorllale","followers_url":"https://api.github.com/users/llorllale/followers","following_url":"https://api.github.com/users/llorllale/following{/other_user}","gists_url":"https://api.github.com/users/llorllale/gists{/gist_id}","starred_url":"https://api.github.com/users/llorllale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/llorllale/subscriptions","organizations_url":"https://api.github.com/users/llorllale/orgs","repos_url":"https://api.github.com/users/llorllale/repos","events_url":"https://api.github.com/users/llorllale/events{/privacy}","received_events_url":"https://api.github.com/users/llorllale/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":64697495,"node_id":"MDU6TGFiZWw2NDY5NzQ5NQ==","url":"https://api.github.com/repos/jcabi/jcabi-github/labels/bug","name":"bug","color":"fc2929","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2018-03-16T03:22:26Z","updated_at":"2018-03-24T10:24:15Z","closed_at":"2018-03-24T10:08:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Context**\r\n`MkReleaseAssets.upload()` stores the bytes as-is (in string form), while `MkReleaseAsset.raw()` will process the string with [DatatypeConverter.parseBase64Binary()](https://docs.oracle.com/javase/8/docs/api/javax/xml/bind/DatatypeConverter.html#parseBase64Binary-java.lang.String-). This despite the fact that `MkReleaseAssets` never encoded the bytes to base64 in the first place.\r\n\r\n**Problem**\r\nThe contents returned by `MkReleaseAsset` will not match the expected bytes for any non-trivial input of bytes. This is because `DatatypeConverter.parseBase64Binary` will silently drop invalid characters as per the Base64 spec without throwing an error, and thus when you decode those bytes you'll end up with a different sequence of bytes.\r\n\r\n**Test**\r\n```java\r\n    @Test\r\n    public void test() throws Exception {\r\n        final String test = \"This is a test asset.\";\r\n        final ReleaseAsset asset = new MkGithub().randomRepo().releases()\r\n          .create(\"v1.0\")\r\n          .assets()\r\n          .upload(test.getBytes(), \"type\", \"name\");\r\n        MatcherAssert.assertThat(\r\n            DatatypeConverter.printBase64Binary(IOUtils.toByteArray(asset.raw())),\r\n            Matchers.is(test)\r\n        );\r\n    }\r\n```\r\nTest error:\r\n```\r\njava.lang.AssertionError: \r\nExpected: is \"This is a test asset.\"\r\n     but: was \"Thisisatestasset\"\r\n```\r\n\r\n**References**\r\n* [RFC-4648](http://www.rfc-editor.org/rfc/rfc4648.txt) Table 1: The Base 64 Alphabet\r\n* [StackOverflow](https://stackoverflow.com/a/30708382/1623885)","closed_by":{"login":"llorllale","id":2019896,"node_id":"MDQ6VXNlcjIwMTk4OTY=","avatar_url":"https://avatars.githubusercontent.com/u/2019896?v=4","gravatar_id":"","url":"https://api.github.com/users/llorllale","html_url":"https://github.com/llorllale","followers_url":"https://api.github.com/users/llorllale/followers","following_url":"https://api.github.com/users/llorllale/following{/other_user}","gists_url":"https://api.github.com/users/llorllale/gists{/gist_id}","starred_url":"https://api.github.com/users/llorllale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/llorllale/subscriptions","organizations_url":"https://api.github.com/users/llorllale/orgs","repos_url":"https://api.github.com/users/llorllale/repos","events_url":"https://api.github.com/users/llorllale/events{/privacy}","received_events_url":"https://api.github.com/users/llorllale/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/jcabi/jcabi-github/issues/1366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/jcabi/jcabi-github/issues/1366/timeline","performed_via_github_app":null,"state_reason":"completed"}