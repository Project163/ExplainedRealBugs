{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1596","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/1596/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/1596/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/1596/events","html_url":"https://github.com/pydantic/pydantic/issues/1596","id":630422841,"node_id":"MDU6SXNzdWU2MzA0MjI4NDE=","number":1596,"title":"Callables are attached as bound methods when used as default args","user":{"login":"dgjustice","id":5085779,"node_id":"MDQ6VXNlcjUwODU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/5085779?v=4","gravatar_id":"","url":"https://api.github.com/users/dgjustice","html_url":"https://github.com/dgjustice","followers_url":"https://api.github.com/users/dgjustice/followers","following_url":"https://api.github.com/users/dgjustice/following{/other_user}","gists_url":"https://api.github.com/users/dgjustice/gists{/gist_id}","starred_url":"https://api.github.com/users/dgjustice/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dgjustice/subscriptions","organizations_url":"https://api.github.com/users/dgjustice/orgs","repos_url":"https://api.github.com/users/dgjustice/repos","events_url":"https://api.github.com/users/dgjustice/events{/privacy}","received_events_url":"https://api.github.com/users/dgjustice/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-06-04T00:39:09Z","updated_at":"2021-02-11T11:39:10Z","closed_at":"2021-02-11T11:39:10Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Bug\r\n\r\nMethods used as default args to Callable are attached as bound methods of the BaseModel class.  Things work fine if you pass the method as an argument to the constructor.  One workaround (if you must have a default arg) is to pass the method as a `functools.partial` object.\r\n\r\nOutput of `python -c \"import pydantic.utils; print(pydantic.utils.version_info())\"`:\r\n```\r\n             pydantic version: 1.5.1\r\n            pydantic compiled: True\r\n                 install path: /usr/local/lib/python3.7/site-packages/pydantic\r\n               python version: 3.7.7 (default, May 20 2020, 21:10:21)  [GCC 8.3.0]\r\n                     platform: Linux-4.19.76-linuxkit-x86_64-with-debian-10.4\r\n     optional deps. installed: ['typing-extensions']\r\n```\r\n\r\n### Test\r\n\r\n```py\r\nfrom pydantic import BaseModel\r\nimport typing as t\r\nfrom functools import partial\r\n\r\ndef bar(*args):\r\n    print(f\"bar args: {args}\")\r\n\r\nclass Foo(BaseModel):\r\n    callback: t.Callable[[int], int]\r\n    method: t.Callable[..., t.Any] = bar\r\n\r\nm = Foo(callback=lambda x: x)\r\nprint(m.callback(42))\r\nprint(m.method)\r\nm.method(42)\r\nprint(f\"\\n\\n{'#' * 42}\\n\\n\")\r\n\r\nclass Foo2(BaseModel):\r\n    callback: t.Callable[[int], int]\r\n    method: t.Callable[..., t.Any]  # no default\r\n\r\nn = Foo2(callback=lambda x: x, method=bar)  # This works fine\r\nprint(n.callback(42))\r\nprint(n.method)\r\nn.method(42)\r\nprint(f\"\\n\\n{'#' * 42}\\n\\n\")\r\n\r\nclass Foo3(BaseModel):\r\n    callback: t.Callable[[int], int]\r\n    method: t.Callable[..., t.Any] = partial(bar)  # workaround\r\n\r\no = Foo3(callback=lambda x: x)\r\nprint(o.callback(42))\r\nprint(o.method)\r\no.method(42)\r\n```\r\n\r\n### Output\r\n\r\n```shell\r\n# python foo.py \r\n42\r\n<bound method bar of Foo(callback=<function <lambda> at 0x7f596462b9e0>)>\r\nbar args: (Foo(callback=<function <lambda> at 0x7f596462b9e0>), 42)\r\n\r\n\r\n##########################################\r\n\r\n\r\n42\r\n<function bar at 0x7f5964621dd0>\r\nbar args: (42,)\r\n\r\n\r\n##########################################\r\n\r\n\r\n42\r\nfunctools.partial(<function bar at 0x7f5964621dd0>)\r\nbar args: (42,)\r\n```\r\n","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1596/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/1596/timeline","performed_via_github_app":null,"state_reason":"completed"}