{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1857","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/1857/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/1857/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/1857/events","html_url":"https://github.com/pydantic/pydantic/issues/1857","id":682784378,"node_id":"MDU6SXNzdWU2ODI3ODQzNzg=","number":1857,"title":"Regression in OpenAPI schema generation with multiple Enums having the same name but different enum members","user":{"login":"pboehm","id":665684,"node_id":"MDQ6VXNlcjY2NTY4NA==","avatar_url":"https://avatars.githubusercontent.com/u/665684?v=4","gravatar_id":"","url":"https://api.github.com/users/pboehm","html_url":"https://github.com/pboehm","followers_url":"https://api.github.com/users/pboehm/followers","following_url":"https://api.github.com/users/pboehm/following{/other_user}","gists_url":"https://api.github.com/users/pboehm/gists{/gist_id}","starred_url":"https://api.github.com/users/pboehm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pboehm/subscriptions","organizations_url":"https://api.github.com/users/pboehm/orgs","repos_url":"https://api.github.com/users/pboehm/repos","events_url":"https://api.github.com/users/pboehm/events{/privacy}","received_events_url":"https://api.github.com/users/pboehm/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-08-20T14:56:16Z","updated_at":"2021-03-24T15:24:34Z","closed_at":"2021-01-02T09:33:37Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Bug\r\n\r\nOutput of `python -c \"import pydantic.utils; print(pydantic.utils.version_info())\"`:\r\n```\r\n             pydantic version: 1.6.1\r\n            pydantic compiled: True\r\n                 install path: /Users/philipp/Downloads/env/lib/python3.7/site-packages/pydantic\r\n               python version: 3.7.6 (default, Dec 30 2019, 19:38:28)  [Clang 11.0.0 (clang-1100.0.33.16)]\r\n                     platform: Darwin-19.3.0-x86_64-i386-64bit\r\n     optional deps. installed: []\r\n```\r\n\r\nAt first, thank you all for this incredible piece of software!\r\n\r\nAs of #1432 enums are included as separate models and and are referenced in all locations. In the case of multiple enums with the same name but different enum members, located in different modules, only one of these enums is included in the OpenAPI schema.\r\n\r\nFile `other.py`:\r\n\r\n```py\r\nfrom enum import Enum\r\n\r\nfrom pydantic import BaseModel\r\n\r\n\r\nclass SomeEnum(str, Enum):\r\n    d = \"d\"\r\n    e = \"e\"\r\n    f = \"f\"\r\n\r\n\r\nclass SomeOtherModel(BaseModel):\r\n    some_enum: SomeEnum\r\n```\r\n\r\nFile `main.py`:\r\n\r\n```py\r\nfrom enum import Enum\r\n\r\nfrom pydantic import BaseModel\r\n\r\nfrom other import SomeOtherModel\r\n\r\n\r\nclass SomeEnum(str, Enum):\r\n    a = \"a\"\r\n    b = \"b\"\r\n    c = \"c\"\r\n\r\n\r\nclass MainModel(BaseModel):\r\n    some_enum: SomeEnum\r\n    some_other_model: SomeOtherModel\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    print(MainModel.schema_json())\r\n```\r\n\r\nExecuting `main.py` produces the following schema:\r\n\r\n```\r\n{\r\n  \"title\": \"MainModel\",\r\n  \"type\": \"object\",\r\n  \"properties\": {\r\n    \"some_enum\": {\r\n      \"$ref\": \"#/definitions/SomeEnum\"\r\n    },\r\n    \"some_other_model\": {\r\n      \"$ref\": \"#/definitions/SomeOtherModel\"\r\n    }\r\n  },\r\n  \"required\": [\r\n    \"some_enum\",\r\n    \"some_other_model\"\r\n  ],\r\n  \"definitions\": {\r\n    \"SomeEnum\": {\r\n      \"title\": \"SomeEnum\",\r\n      \"description\": \"An enumeration.\",\r\n      \"enum\": [\r\n        \"d\",\r\n        \"e\",\r\n        \"f\"\r\n      ],\r\n      \"type\": \"string\"\r\n    },\r\n    \"SomeOtherModel\": {\r\n      \"title\": \"SomeOtherModel\",\r\n      \"type\": \"object\",\r\n      \"properties\": {\r\n        \"some_enum\": {\r\n          \"$ref\": \"#/definitions/SomeEnum\"\r\n        }\r\n      },\r\n      \"required\": [\r\n        \"some_enum\"\r\n      ]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nOnly the Enum from `other.py` is included and the schema now contains invalid supported enum values for `MainModel.some_enum`.\r\n\r\nBefore #1432 this works as expected because the enum values are included as-is. Ideally `pydantic` should handle this case by prefixing different enums with the same name in the OpenAPI schema. I've applied a workaround to my application code by changing the name of conflicting enums but I only detected this new behaviour by having a CI Pipeline step that checks for breaking OpenAPI changes.","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1857/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/1857/timeline","performed_via_github_app":null,"state_reason":"completed"}