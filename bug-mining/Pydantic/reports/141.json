{"url":"https://api.github.com/repos/pydantic/pydantic/issues/2138","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/2138/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/2138/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/2138/events","html_url":"https://github.com/pydantic/pydantic/issues/2138","id":747698643,"node_id":"MDU6SXNzdWU3NDc2OTg2NDM=","number":2138,"title":"`underscore_attrs_are_private` breaks generics","user":{"login":"andres-insaurralde","id":61736390,"node_id":"MDQ6VXNlcjYxNzM2Mzkw","avatar_url":"https://avatars.githubusercontent.com/u/61736390?v=4","gravatar_id":"","url":"https://api.github.com/users/andres-insaurralde","html_url":"https://github.com/andres-insaurralde","followers_url":"https://api.github.com/users/andres-insaurralde/followers","following_url":"https://api.github.com/users/andres-insaurralde/following{/other_user}","gists_url":"https://api.github.com/users/andres-insaurralde/gists{/gist_id}","starred_url":"https://api.github.com/users/andres-insaurralde/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andres-insaurralde/subscriptions","organizations_url":"https://api.github.com/users/andres-insaurralde/orgs","repos_url":"https://api.github.com/users/andres-insaurralde/repos","events_url":"https://api.github.com/users/andres-insaurralde/events{/privacy}","received_events_url":"https://api.github.com/users/andres-insaurralde/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2020-11-20T18:11:12Z","updated_at":"2020-11-30T17:54:09Z","closed_at":"2020-11-30T17:54:09Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Checks\r\n\r\n* [x] I added a descriptive title to this issue\r\n* [x] I have searched (google, github) for similar issues and couldn't find anything\r\n* [x] I have read and followed [the docs](https://pydantic-docs.helpmanual.io/) and still think this is a bug\r\n\r\n# Bug\r\n\r\nOutput of `python -c \"import pydantic.utils; print(pydantic.utils.version_info())\"`:\r\n```\r\n             pydantic version: 1.7.2\r\n            pydantic compiled: False\r\n                 install path: /nix/store/4snc9a6ywd1m75z7k5v863h9kl3s38dy-python3.7-pydantic-1.7.2/lib/python3.7/site-packages/pydantic\r\n               python version: 3.7.7 (default, Mar 10 2020, 06:34:06)  [GCC 9.3.0]\r\n                     platform: Linux-4.15.0-123-generic-x86_64-with-debian-buster-sid\r\n     optional deps. installed: ['typing-extensions', 'email-validator']\r\n\r\n```\r\n\r\n----\r\n\r\nThe `underscore_attrs_are_private` config option seems to break generics. In particular, it seems to be messing up with the model's `__orig_bases__`, which ends up causing a `TypeError` in `typing.Generic`. Unfortunately, I'm not familiar enough with Pydantic's code to pinpoint the exact root of the issue.\r\n\r\nTo reproduce:\r\n\r\n```py\r\nfrom pydantic.generics import GenericModel\r\nfrom typing import TypeVar, Generic\r\n\r\nT = TypeVar('T')\r\n\r\nclass Model(GenericModel, Generic[T]): \r\n\t\r\n\tclass Config:\r\n\t\tunderscore_attrs_are_private = True\r\n\r\n\tvalue: T\r\n```\r\n\r\nOutput:\r\n\r\n```python\r\nTypeError                                 Traceback (most recent call last)\r\n<ipython-input-17-86d3af5f0365> in <module>\r\n----> 1 class Model(GenericModel, Generic[T]):\r\n      2     class Config:\r\n      3         underscore_attrs_are_private = True\r\n      4     id: T\r\n      5 \r\n\r\n/nix/store/5mlyrz5jm75dbjd92wsq89b9lsd0bhww-python3-3.7.7-env/lib/python3.7/site-packages/pydantic/main.py in __new__(mcs, name, bases, namespace, **kwargs)\r\n    322         }\r\n    323 \r\n--> 324         cls = super().__new__(mcs, name, bases, new_namespace, **kwargs)\r\n    325         # set __signature__ attr only for model class, but not for its instances\r\n    326         cls.__signature__ = ClassAttribute('__signature__', generate_model_signature(cls.__init__, fields, config))\r\n\r\n/nix/store/k2w1idz2vdag50xl88113845mr74z823-python3-3.7.7/lib/python3.7/abc.py in __new__(mcls, name, bases, namespace, **kwargs)\r\n    124         \"\"\"\r\n    125         def __new__(mcls, name, bases, namespace, **kwargs):\r\n--> 126             cls = super().__new__(mcls, name, bases, namespace, **kwargs)\r\n    127             _abc_init(cls)\r\n    128             return cls\r\n\r\n/nix/store/k2w1idz2vdag50xl88113845mr74z823-python3-3.7.7/lib/python3.7/typing.py in __init_subclass__(cls, *args, **kwargs)\r\n    848         tvars = []\r\n    849         if '__orig_bases__' in cls.__dict__:\r\n--> 850             error = Generic in cls.__orig_bases__\r\n    851         else:\r\n    852             error = Generic in cls.__bases__ and cls.__name__ != '_Protocol'\r\n\r\nTypeError: argument of type 'member_descriptor' is not iterable\r\n\r\n```\r\n\r\n----\r\n\r\nRemoving `underscore_attrs_are_private` or setting it to `False` makes it work as expected. Using `PrivateAttr` instead of the config option works well too.","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/2138/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/2138/timeline","performed_via_github_app":null,"state_reason":"completed"}