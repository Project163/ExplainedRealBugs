{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1736","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/1736/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/1736/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/1736/events","html_url":"https://github.com/pydantic/pydantic/issues/1736","id":659410957,"node_id":"MDU6SXNzdWU2NTk0MTA5NTc=","number":1736,"title":"Nested Models with optional members fail on 1.6.1","user":{"login":"roycollins","id":19690437,"node_id":"MDQ6VXNlcjE5NjkwNDM3","avatar_url":"https://avatars.githubusercontent.com/u/19690437?v=4","gravatar_id":"","url":"https://api.github.com/users/roycollins","html_url":"https://github.com/roycollins","followers_url":"https://api.github.com/users/roycollins/followers","following_url":"https://api.github.com/users/roycollins/following{/other_user}","gists_url":"https://api.github.com/users/roycollins/gists{/gist_id}","starred_url":"https://api.github.com/users/roycollins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roycollins/subscriptions","organizations_url":"https://api.github.com/users/roycollins/orgs","repos_url":"https://api.github.com/users/roycollins/repos","events_url":"https://api.github.com/users/roycollins/events{/privacy}","received_events_url":"https://api.github.com/users/roycollins/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-07-17T16:38:42Z","updated_at":"2020-10-08T19:26:31Z","closed_at":"2020-10-08T19:26:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Bug\r\n\r\nDefining a model with Optional nested recursive submodels is throwing a required value error when validating the model.  The nested models also contain nested submodels that container other recursive models potentially.  This works on 1.6.0 and all versions prior that we have been using the last year. It only breaks when we move to version 1.6.1\r\n\r\nHere is a sample of the model that we are using with basic one letter named attributes.\r\n```\r\nclass Spec(BaseModel):\r\n    spec_fields: List[str] = Field(..., alias=\"fields\")\r\n    filter: Optional[str]\r\n    sort: Optional[str]\r\n\r\n\r\nclass PSpec(Spec):\r\n    g: Optional[GSpec]\r\n\r\nclass GSpec(Spec):\r\n    p: Optional[PSpec]\r\n\r\nclass Filter(BaseModel):\r\n    g: Optional[GSpec]\r\n    p: Optional[PSpec]\r\n```\r\n\r\nTrying with the following values will generate an error\r\n```\r\n        data = {\"p\": {\"sort\": \"some_field:asc\", \"fields\": []}}\r\n        result = Filter(**data)\r\n```\r\nThe error generated is:\r\n```\r\nE   pydantic.error_wrappers.ValidationError: 1 validation error for Filter\r\nE   p -> g\r\nE     field required (type=value_error.missing)\r\n```\r\n\r\nIt seems to be disregarding the Optional attribute for GSpec field in the nested PSpec model.\r\nSame code on 1.6.0 works as expected.\r\n\r\nThanks!\r\n\r\n\r\n\r\n\r\n\r\nOutput of `python -c \"import pydantic.utils; print(pydantic.utils.version_info())\"`:\r\n```\r\npydantic version: 1.6.1\r\n            pydantic compiled: True\r\n                 install path: /Users/..../.local/share/virtualenvs/..../lib/python3.7/site-packages/pydantic\r\n               python version: 3.7.3 (default, Mar 27 2019, 09:23:15)  [Clang 10.0.1 (clang-1001.0.46.3)]\r\n                     platform: Darwin-19.5.0-x86_64-i386-64bit\r\n     optional deps. installed: ['typing-extensions', 'email-validator']\r\n```\r\n<!-- or if you're using pydantic prior to v1.3, manually include: OS, python version and pydantic version -->\r\n\r\n<!-- Please read the [docs](https://pydantic-docs.helpmanual.io/) and search through issues to\r\nconfirm your bug hasn't already been reported. -->\r\n\r\n<!-- Where possible please include a self-contained code snippet describing your bug: -->\r\n\r\n```py\r\nimport pydantic\r\n\r\n...\r\n```\r\n","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1736/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/1736/timeline","performed_via_github_app":null,"state_reason":"completed"}