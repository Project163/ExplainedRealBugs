{"url":"https://api.github.com/repos/pydantic/pydantic/issues/620","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/620/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/620/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/620/events","html_url":"https://github.com/pydantic/pydantic/issues/620","id":460924490,"node_id":"MDU6SXNzdWU0NjA5MjQ0OTA=","number":620,"title":"const validation with list gives unexpected error","user":{"login":"hmvp","id":1734544,"node_id":"MDQ6VXNlcjE3MzQ1NDQ=","avatar_url":"https://avatars.githubusercontent.com/u/1734544?v=4","gravatar_id":"","url":"https://api.github.com/users/hmvp","html_url":"https://github.com/hmvp","followers_url":"https://api.github.com/users/hmvp/followers","following_url":"https://api.github.com/users/hmvp/following{/other_user}","gists_url":"https://api.github.com/users/hmvp/gists{/gist_id}","starred_url":"https://api.github.com/users/hmvp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hmvp/subscriptions","organizations_url":"https://api.github.com/users/hmvp/orgs","repos_url":"https://api.github.com/users/hmvp/repos","events_url":"https://api.github.com/users/hmvp/events{/privacy}","received_events_url":"https://api.github.com/users/hmvp/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"},{"id":597426505,"node_id":"MDU6TGFiZWw1OTc0MjY1MDU=","url":"https://api.github.com/repos/pydantic/pydantic/labels/help%20wanted","name":"help wanted","color":"128A0C","default":true,"description":"Pull Request welcome"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2019-06-26T11:50:32Z","updated_at":"2019-09-17T17:30:58Z","closed_at":"2019-09-17T17:30:58Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Feature Request | Bug\r\n\r\nFor bugs/questions:\r\n* OS: Linux\r\n* Python version `import sys; print(sys.version)`: 3.7.3\r\n* Pydantic version `import pydantic; print(pydantic.VERSION)`: 0.29\r\n\r\nI expect the following test (not yet in code base) to succeed\r\n\r\n```py\r\ndef test_const_list_with_wrong_value():\r\n    class SubModel(BaseModel):\r\n        b: int\r\n\r\n    class Model(BaseModel):\r\n        a: List[SubModel] = Schema([{\"b\": 1}, {\"b\": 2}, {\"b\": 3}], const=True)\r\n\r\n    with pytest.raises(ValidationError) as exc_info:\r\n        Model(a=[{\"b\": 3}, {\"b\": 1}, {\"b\": 2}])\r\n\r\n    assert exc_info.value.errors() == [\r\n        {\r\n            'ctx': {'const': SubModel(b=1), 'given': SubModel(b=3)},\r\n            'loc': ('a', 0),\r\n            'msg': \"expected constant value {'b': 1}\",\r\n            'type': 'value_error.const',\r\n        },\r\n        {\r\n            'ctx': {'const': SubModel(b=2), 'given': SubModel(b=1)},\r\n            'loc': ('a', 1),\r\n            'msg': \"expected constant value {'b': 2}\",\r\n            'type': 'value_error.const',\r\n        },\r\n        {\r\n            'ctx': {'const': SubModel(b=3), 'given': SubModel(b=2)},\r\n            'loc': ('a', 2),\r\n            'msg': \"expected constant value {'b': 3}\",\r\n            'type': 'value_error.const',\r\n        },\r\n    ]\r\n```\r\nHowever it fails with:\r\n\r\n```\r\nE       assert [{'ctx': {'co...error.const'}] == [{'ctx': {'con...error.const'}]\r\nE         At index 0 diff: {'loc': ('a', 0), 'msg': \"expected constant value [{'b': 1}, {'b': 2}, {'b': 3}]\", 'type': 'value_error.const', 'ctx': {'given': <SubModel b=3>, 'const': [{'b': 1}, {'b': 2}, {'b': 3}]}} != {'ctx': {'const': <SubModel b=1>, 'given': <SubModel b=3>}, 'loc': ('a', 0), 'msg': \"expected constant value {'b': 1}\", 'type': 'value_error.const'}\r\nE         Full diff:\r\nE         - [{'ctx': {'const': [{'b': 1}, {'b': 2}, {'b': 3}], 'given': <SubModel b=3>},\r\nE         + [{'ctx': {'const': <SubModel b=1>, 'given': <SubModel b=3>},\r\nE         'loc': ('a', 0),\r\nE         -   'msg': \"expected constant value [{'b': 1}, {'b': 2}, {'b': 3}]\",\r\nE         ?                                   -        ---------------------\r\nE         +   'msg': \"expected constant value {'b': 1}\",\r\nE         'type': 'value_error.const'},\r\nE         -  {'ctx': {'const': [{'b': 1}, {'b': 2}, {'b': 3}], 'given': <SubModel b=1>},\r\nE         +  {'ctx': {'const': <SubModel b=2>, 'given': <SubModel b=1>},\r\nE         'loc': ('a', 1),\r\nE         -   'msg': \"expected constant value [{'b': 1}, {'b': 2}, {'b': 3}]\",\r\nE         ?                                   -      ----------  -----------\r\nE         +   'msg': \"expected constant value {'b': 2}\",\r\nE         'type': 'value_error.const'},\r\nE         -  {'ctx': {'const': [{'b': 1}, {'b': 2}, {'b': 3}], 'given': <SubModel b=2>},\r\nE         +  {'ctx': {'const': <SubModel b=3>, 'given': <SubModel b=2>},\r\nE         'loc': ('a', 2),\r\nE         -   'msg': \"expected constant value [{'b': 1}, {'b': 2}, {'b': 3}]\",\r\nE         ?                                   -      --------------------  -\r\nE         +   'msg': \"expected constant value {'b': 3}\",\r\nE         'type': 'value_error.const'}]\r\n```\r\n\r\nThe issue here is that the error contains the complete list value as expected value while the error is per sub field (and the expected value is the sub field only):\r\n\r\n```\r\n        {\r\n            'ctx': {'const': [{'b': 1}, {'b': 2}, {'b': 3}], 'given': SubModel(b=3)},\r\n            'loc': ('a', 0),\r\n            'msg': \"expected constant value [{'b': 1}, {'b': 2}, {'b': 3}]\",\r\n            'type': 'value_error.const',\r\n        },\r\n```","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/620/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/620/timeline","performed_via_github_app":null,"state_reason":"completed"}