{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1710","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/1710/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/1710/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/1710/events","html_url":"https://github.com/pydantic/pydantic/issues/1710","id":655218232,"node_id":"MDU6SXNzdWU2NTUyMTgyMzI=","number":1710,"title":"Pydantic 1.6 does not validate nested models when using a default_factory","user":{"login":"jlowin","id":153965,"node_id":"MDQ6VXNlcjE1Mzk2NQ==","avatar_url":"https://avatars.githubusercontent.com/u/153965?v=4","gravatar_id":"","url":"https://api.github.com/users/jlowin","html_url":"https://github.com/jlowin","followers_url":"https://api.github.com/users/jlowin/followers","following_url":"https://api.github.com/users/jlowin/following{/other_user}","gists_url":"https://api.github.com/users/jlowin/gists{/gist_id}","starred_url":"https://api.github.com/users/jlowin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlowin/subscriptions","organizations_url":"https://api.github.com/users/jlowin/orgs","repos_url":"https://api.github.com/users/jlowin/repos","events_url":"https://api.github.com/users/jlowin/events{/privacy}","received_events_url":"https://api.github.com/users/jlowin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-07-11T14:26:00Z","updated_at":"2022-01-03T16:30:27Z","closed_at":"2020-07-15T19:23:19Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Bug\r\n\r\nOutput of `python -c \"import pydantic.utils; print(pydantic.utils.version_info())\"`:\r\n```\r\n             pydantic version: 1.6\r\n            pydantic compiled: True\r\n                 install path: /usr/local/Caskroom/miniconda/base/envs/server/lib/python3.8/site-packages/pydantic\r\n               python version: 3.8.3 (default, Jul  2 2020, 11:26:31)  [Clang 10.0.0 ]\r\n                     platform: macOS-10.15.5-x86_64-i386-64bit\r\n     optional deps. installed: ['typing-extensions']\r\n```\r\n\r\nI'm aware that [validation does not apply to default values](https://github.com/samuelcolvin/pydantic/issues/1488), but it appears that it is no longer applied to *user-provided* values that have a default factory value, either. If this is expected, I'm not sure if I saw it in the documentation or changelog. \r\n\r\n```py\r\nfrom pydantic import BaseModel, Field\r\nfrom typing import List\r\n\r\nclass Child(BaseModel):\r\n    x: int\r\n\r\nclass Parent(BaseModel):\r\n    children: List[Child] = Field(default_factory=list)\r\n\r\n\r\np = Parent(children=[{'x':1}, {'y':2}])\r\n```\r\n\r\nIn Pydantic 1.5.1, an error is raised because the second child fails to validate (it is missing required value 'x')\r\n\r\nIn Pydantic 1.6, the Parent object is instantiated successfully and contains two dicts:\r\n\r\n```py\r\nprint(p)\r\n# children=[{'x': 1}, {'y': 2}]\r\n```\r\n\r\nTo avoid this and recover the expected behavior, `validate_all` must be set on the `Parent` class. However, since I'm providing the child value, I'm surprised that I had to ask for it to be validated. ","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1710/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/1710/timeline","performed_via_github_app":null,"state_reason":"completed"}