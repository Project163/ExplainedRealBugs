{"url":"https://api.github.com/repos/pydantic/pydantic/issues/5622","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/5622/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/5622/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/5622/events","html_url":"https://github.com/pydantic/pydantic/issues/5622","id":1687660685,"node_id":"I_kwDOBWBCuM5kl6iN","number":5622,"title":"BaseModel only matches other BaseModel's (not even unittest.mock.ANY)","user":{"login":"UlfurOrn","id":48811972,"node_id":"MDQ6VXNlcjQ4ODExOTcy","avatar_url":"https://avatars.githubusercontent.com/u/48811972?v=4","gravatar_id":"","url":"https://api.github.com/users/UlfurOrn","html_url":"https://github.com/UlfurOrn","followers_url":"https://api.github.com/users/UlfurOrn/followers","following_url":"https://api.github.com/users/UlfurOrn/following{/other_user}","gists_url":"https://api.github.com/users/UlfurOrn/gists{/gist_id}","starred_url":"https://api.github.com/users/UlfurOrn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/UlfurOrn/subscriptions","organizations_url":"https://api.github.com/users/UlfurOrn/orgs","repos_url":"https://api.github.com/users/UlfurOrn/repos","events_url":"https://api.github.com/users/UlfurOrn/events{/privacy}","received_events_url":"https://api.github.com/users/UlfurOrn/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":5233082176,"node_id":"LA_kwDOBWBCuM8AAAABN-p_QA","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V2","name":"bug V2","color":"ee0701","default":false,"description":"Bug related to Pydantic V2"}],"state":"closed","locked":false,"assignee":{"login":"dmontagu","id":35119617,"node_id":"MDQ6VXNlcjM1MTE5NjE3","avatar_url":"https://avatars.githubusercontent.com/u/35119617?v=4","gravatar_id":"","url":"https://api.github.com/users/dmontagu","html_url":"https://github.com/dmontagu","followers_url":"https://api.github.com/users/dmontagu/followers","following_url":"https://api.github.com/users/dmontagu/following{/other_user}","gists_url":"https://api.github.com/users/dmontagu/gists{/gist_id}","starred_url":"https://api.github.com/users/dmontagu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmontagu/subscriptions","organizations_url":"https://api.github.com/users/dmontagu/orgs","repos_url":"https://api.github.com/users/dmontagu/repos","events_url":"https://api.github.com/users/dmontagu/events{/privacy}","received_events_url":"https://api.github.com/users/dmontagu/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dmontagu","id":35119617,"node_id":"MDQ6VXNlcjM1MTE5NjE3","avatar_url":"https://avatars.githubusercontent.com/u/35119617?v=4","gravatar_id":"","url":"https://api.github.com/users/dmontagu","html_url":"https://github.com/dmontagu","followers_url":"https://api.github.com/users/dmontagu/followers","following_url":"https://api.github.com/users/dmontagu/following{/other_user}","gists_url":"https://api.github.com/users/dmontagu/gists{/gist_id}","starred_url":"https://api.github.com/users/dmontagu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmontagu/subscriptions","organizations_url":"https://api.github.com/users/dmontagu/orgs","repos_url":"https://api.github.com/users/dmontagu/repos","events_url":"https://api.github.com/users/dmontagu/events{/privacy}","received_events_url":"https://api.github.com/users/dmontagu/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2023-04-27T23:02:09Z","updated_at":"2023-05-03T17:08:15Z","closed_at":"2023-05-03T17:08:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Initial Checks\n\n- [X] I confirm that I'm using Pydantic V2 installed directly from the `main` branch, or equivalent\n\n### Description\n\nI've encountered some unexpected behavior while using Pydantic 2.0, specifically with the `__eq__` method in the `BaseModel` class. The current implementation of the method causes it to not match anything other than instances of `BaseModel`. This behavior might cause issues when using custom validation classes, e.g. `unittest.mock.ANY`.\r\n\r\nHere's the code snippet of the `__eq__` method in Pydantic's `BaseModel`:\r\n```python\r\ndef __eq__(self, other) -> bool:\r\n    if not isinstance(other, BaseModel):\r\n        return False\r\n    ...\r\n```\r\n\r\nThis implementation checks whether the `other` object is an instance of `BaseModel`, and immediately returns `False` if it is not. Due to this, when comparing a `BaseModel` instance with custom validation classes, like `unittest.mock.ANY`, the comparison will always return `False`.\r\n\r\nWhile I understand that this check is in place to ensure that only instances of `BaseModel` can be compared (and potentially for performance), it would be helpful to have a more flexible implementation that allows compatibility with custom validation classes.\r\n\r\nAlso I do not want to simply reorder the comparison since then pytest will display the expected and actual results in the opposite order of what I want.\r\n\r\n**Possible solution:**\r\n\r\nOne potential solution is to update the `__eq__` method in `BaseModel` to delegate the comparison to the `other` object if it is not an instance of `BaseModel`:\r\n\r\n```python\r\ndef __eq__(self, other) -> bool:\r\n    if not isinstance(other, BaseModel):\r\n        return NotImplemented\r\n```\r\n\r\nBy returning `NotImplemented`, we allow Python to delegate the comparison to the `other` object's `__eq__` method. If that method is capable of handling the comparison with a `BaseModel` instance, it will return the appropriate result. This makes the comparison more flexible and compatible with custom validation classes.\r\n\r\nWith this change, users can implement their own custom validation classes and handle comparisons with `BaseModel` instances in the custom class's `__eq__` method:\r\n```python\r\nclass CustomValidationClass:\r\n    def __eq__(self, other) -> bool:\r\n        if isinstance(other, BaseModel):\r\n            # Implement custom comparison logic here\r\n            ...\r\n```\r\n\r\nPerformance wise I don't think this will affect much. In the case of BaseModel's it has no change. For other types it may need to do a few more steps but nothing considerable (I have not performed any benchmarks in this regard).\r\n\r\nIf this solution or others turn out to have bad effects, performance wise or in some other way, is it possible to add a config option to enable this?\r\n\r\nPlease let me know if you have any questions or require further information on this issue. Thank you for creating this awesome project :pray:\r\n\r\n**Side Note:**\r\nI orginally discovered this kink with a Custom Validation class for Pydantic V1. The Custom Validation class would check for an instance of BaseModel. However the implementation in V1 first converts the model to a dict so it was no longer an instance of BaseModel and failed the test.\n\n### Example Code\n\n```Python\nfrom unittest.mock import ANY\r\n\r\nfrom pydantic import BaseModel\r\n\r\n\r\nclass MyModel(BaseModel):\r\n    foo: str\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    assert MyModel(foo=\"bar\") == ANY\n```\n\n\n### Python, Pydantic & OS Version\n\n```Text\npydantic version: 2.0a3\r\npydantic-core version: 0.25.0 release build profile\r\ninstall path: /Users/ulfur/projects/pydantic-test/.venv/lib/python3.10/site-packages/pydantic\r\npython version: 3.10.1 (v3.10.1:2cd268a3a9, Dec  6 2021, 14:28:59) [Clang 13.0.0 (clang-1300.0.29.3)]\r\nplatform: macOS-12.5.1-arm64-arm-64bit\r\noptional deps. installed: ['typing-extensions']\n```\n","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/5622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/5622/timeline","performed_via_github_app":null,"state_reason":"completed"}