{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1209","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/1209/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/1209/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/1209/events","html_url":"https://github.com/pydantic/pydantic/issues/1209","id":560565648,"node_id":"MDU6SXNzdWU1NjA1NjU2NDg=","number":1209,"title":"Extra allOf keys in translation of Unions to OpenAPI schema when Field is used","user":{"login":"chriswmackey","id":5567574,"node_id":"MDQ6VXNlcjU1Njc1NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/5567574?v=4","gravatar_id":"","url":"https://api.github.com/users/chriswmackey","html_url":"https://github.com/chriswmackey","followers_url":"https://api.github.com/users/chriswmackey/followers","following_url":"https://api.github.com/users/chriswmackey/following{/other_user}","gists_url":"https://api.github.com/users/chriswmackey/gists{/gist_id}","starred_url":"https://api.github.com/users/chriswmackey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chriswmackey/subscriptions","organizations_url":"https://api.github.com/users/chriswmackey/orgs","repos_url":"https://api.github.com/users/chriswmackey/repos","events_url":"https://api.github.com/users/chriswmackey/events{/privacy}","received_events_url":"https://api.github.com/users/chriswmackey/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"},{"id":597426505,"node_id":"MDU6TGFiZWw1OTc0MjY1MDU=","url":"https://api.github.com/repos/pydantic/pydantic/labels/help%20wanted","name":"help wanted","color":"128A0C","default":true,"description":"Pull Request welcome"}],"state":"closed","locked":false,"assignee":{"login":"dmontagu","id":35119617,"node_id":"MDQ6VXNlcjM1MTE5NjE3","avatar_url":"https://avatars.githubusercontent.com/u/35119617?v=4","gravatar_id":"","url":"https://api.github.com/users/dmontagu","html_url":"https://github.com/dmontagu","followers_url":"https://api.github.com/users/dmontagu/followers","following_url":"https://api.github.com/users/dmontagu/following{/other_user}","gists_url":"https://api.github.com/users/dmontagu/gists{/gist_id}","starred_url":"https://api.github.com/users/dmontagu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmontagu/subscriptions","organizations_url":"https://api.github.com/users/dmontagu/orgs","repos_url":"https://api.github.com/users/dmontagu/repos","events_url":"https://api.github.com/users/dmontagu/events{/privacy}","received_events_url":"https://api.github.com/users/dmontagu/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"dmontagu","id":35119617,"node_id":"MDQ6VXNlcjM1MTE5NjE3","avatar_url":"https://avatars.githubusercontent.com/u/35119617?v=4","gravatar_id":"","url":"https://api.github.com/users/dmontagu","html_url":"https://github.com/dmontagu","followers_url":"https://api.github.com/users/dmontagu/followers","following_url":"https://api.github.com/users/dmontagu/following{/other_user}","gists_url":"https://api.github.com/users/dmontagu/gists{/gist_id}","starred_url":"https://api.github.com/users/dmontagu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmontagu/subscriptions","organizations_url":"https://api.github.com/users/dmontagu/orgs","repos_url":"https://api.github.com/users/dmontagu/repos","events_url":"https://api.github.com/users/dmontagu/events{/privacy}","received_events_url":"https://api.github.com/users/dmontagu/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2020-02-05T18:58:37Z","updated_at":"2020-04-30T17:56:12Z","closed_at":"2020-04-30T17:56:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Bug\r\n\r\nOutput of `python -c \"import pydantic.utils; print(pydantic.utils.version_info())\"`:\r\n```\r\npydantic version: 1.4\r\n            pydantic compiled: False\r\n                 install path: C:\\Users\\chris\\AppData\\Local\\Programs\\Python\\Python37-32\\Lib\\site-packages\\pydantic\r\n               python version: 3.7.1 (v3.7.1:260ec2c36a, Oct 20 2018, 14:05:16) [MSC v.1915 32 bit (Intel)]\r\n                     platform: Windows-10-10.0.18362-SP0\r\n     optional deps. installed: []\r\n```\r\n## Description\r\nMy teammates and I debated this for a bit but we're fairly confident that we're experiencing a bug, though it could just be a misunderstanding of how the translation to OpenAPI schema is intended to happen. We can at least say that we couldn't find any other issues on this github addressing it or samples in the docs about our case.\r\n\r\nSpecifically, when we run the following sample:\r\n```\r\nfrom pydantic import BaseModel, Field\r\nfrom typing import Union\r\nfrom pprint import pprint\r\n\r\nclass TestClassA(BaseModel):\r\n    pass\r\n\r\nclass TestClassB(BaseModel):\r\n    pass\r\n\r\nclass TestClassC(BaseModel):\r\n    a: Union[TestClassA, TestClassB]\r\n\r\npprint(TestClassC.schema())\r\n\r\n```\r\n... we get the expected result:\r\n```\r\n{'definitions': {'TestClassA': {'properties': {},\r\n                                'title': 'TestClassA',\r\n                                'type': 'object'},\r\n                 'TestClassB': {'properties': {},\r\n                                'title': 'TestClassB',\r\n                                'type': 'object'}},\r\n 'properties': {'a': {'anyOf': [{'$ref': '#/definitions/TestClassA'},\r\n                                {'$ref': '#/definitions/TestClassB'}],\r\n                      'title': 'A'}},\r\n 'required': ['a'],\r\n 'title': 'TestClassC',\r\n 'type': 'object'}\r\n```\r\n\r\nHowever, when we change `TestClassC` to be the following:\r\n```\r\nclass TestClassC(BaseModel):\r\n    a: Union[TestClassA, TestClassB] = Field(..., description='description...')\r\n```\r\n... we get the following:\r\n```\r\n{'definitions': {'TestClassA': {'properties': {},\r\n                                'title': 'TestClassA',\r\n                                'type': 'object'},\r\n                 'TestClassB': {'properties': {},\r\n                                'title': 'TestClassB',\r\n                                'type': 'object'}},\r\n 'properties': {'a': {'anyOf': [{'allOf': [{'$ref': '#/definitions/TestClassA'}]},\r\n                                {'allOf': [{'$ref': '#/definitions/TestClassB'}]}],\r\n                      'description': 'description...',\r\n                      'title': 'A'}},\r\n 'required': ['a'],\r\n 'title': 'TestClassC',\r\n 'type': 'object'}\r\n```\r\nTake particular note of the additional `'allOf'` keys under the `'properties'`\r\n\r\nWe get the same additional `'allOf'` keys if we change `TestClassC` to be the following:\r\n```\r\nclass TestClassC(BaseModel):\r\n    a: Union[TestClassA, TestClassB] = TestClassA()\r\n```\r\n\r\nRight now, we're using a workaround with the `schema_extra` capability to get rid of these extra `allOf` keys but this seemed a bit hacky to us. If these `allOf` keys are the result of a bug, we're happy to provide more test cases that trigger it if that would help. Or, if there's a better way to get rid of it these extra keys that we overlooked, we're happy to help documenting it in any way that we can so others like us don't get confused. Thank you for taking the time to read this issue and for the incredibly useful package!","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1209/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/1209/timeline","performed_via_github_app":null,"state_reason":"completed"}