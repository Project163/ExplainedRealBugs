{"url":"https://api.github.com/repos/pydantic/pydantic/issues/696","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/696/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/696/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/696/events","html_url":"https://github.com/pydantic/pydantic/issues/696","id":474500595,"node_id":"MDU6SXNzdWU0NzQ1MDA1OTU=","number":696,"title":"[Bug] Regression in ValidationError serializarion with Enums","user":{"login":"jcugat","id":488594,"node_id":"MDQ6VXNlcjQ4ODU5NA==","avatar_url":"https://avatars.githubusercontent.com/u/488594?v=4","gravatar_id":"","url":"https://api.github.com/users/jcugat","html_url":"https://github.com/jcugat","followers_url":"https://api.github.com/users/jcugat/followers","following_url":"https://api.github.com/users/jcugat/following{/other_user}","gists_url":"https://api.github.com/users/jcugat/gists{/gist_id}","starred_url":"https://api.github.com/users/jcugat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcugat/subscriptions","organizations_url":"https://api.github.com/users/jcugat/orgs","repos_url":"https://api.github.com/users/jcugat/repos","events_url":"https://api.github.com/users/jcugat/events{/privacy}","received_events_url":"https://api.github.com/users/jcugat/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-07-30T10:20:52Z","updated_at":"2019-07-31T08:13:20Z","closed_at":"2019-07-31T08:13:12Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- Questions, Feature Requests, and Bug Reports are all welcome -->\r\n<!-- delete as applicable: -->\r\n# Bug\r\n\r\nFor bugs/questions:\r\n* OS: macOS Mojave 10.14.5 (18F132)\r\n* Python version `import sys; print(sys.version)`: 3.6.8\r\n* Pydantic version `import pydantic; print(pydantic.VERSION)`: 0.31\r\n\r\nThis is a minimal snippet to reproduce it:\r\n\r\n```py\r\nfrom enum import Enum\r\nfrom pydantic import BaseModel, Extra, ValidationError\r\n\r\nclass MyEnum(str, Enum):\r\n    VALID = \"VALID\"\r\n\r\nclass Foo(BaseModel):\r\n    bar: MyEnum\r\n\r\ntry:\r\n    Foo(bar=\"INVALID\")\r\nexcept ValidationError as e:\r\n    print(e.json())\r\n```\r\n\r\nAnd the stacktrace:\r\n\r\n```\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 2, in <module>\r\n  File \"/Users/josepcugat/.pyenv/versions/current/lib/python3.6/site-packages/pydantic/main.py\", line 276, in __init__\r\n    values, fields_set, _ = validate_model(__pydantic_self__, data)\r\n  File \"/Users/josepcugat/.pyenv/versions/current/lib/python3.6/site-packages/pydantic/main.py\", line 790, in validate_model\r\n    raise ValidationError(errors)\r\npydantic.error_wrappers.ValidationError: 1 validation error\r\nbar\r\n  value is not a valid enumeration member; permitted: 'VALID' (type=type_error.enum; enum_type=<enum 'MyEnum'>)\r\n\r\nDuring handling of the above exception, another exception occurred:\r\n\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 4, in <module>\r\n  File \"/Users/josepcugat/.pyenv/versions/current/lib/python3.6/site-packages/pydantic/error_wrappers.py\", line 62, in json\r\n    return json.dumps(self.errors(), indent=indent)\r\n  File \"/Users/josepcugat/.pyenv/versions/3.6.8/lib/python3.6/json/__init__.py\", line 238, in dumps\r\n    **kw).encode(obj)\r\n  File \"/Users/josepcugat/.pyenv/versions/3.6.8/lib/python3.6/json/encoder.py\", line 201, in encode\r\n    chunks = list(chunks)\r\n  File \"/Users/josepcugat/.pyenv/versions/3.6.8/lib/python3.6/json/encoder.py\", line 428, in _iterencode\r\n    yield from _iterencode_list(o, _current_indent_level)\r\n  File \"/Users/josepcugat/.pyenv/versions/3.6.8/lib/python3.6/json/encoder.py\", line 325, in _iterencode_list\r\n    yield from chunks\r\n  File \"/Users/josepcugat/.pyenv/versions/3.6.8/lib/python3.6/json/encoder.py\", line 404, in _iterencode_dict\r\n    yield from chunks\r\n  File \"/Users/josepcugat/.pyenv/versions/3.6.8/lib/python3.6/json/encoder.py\", line 404, in _iterencode_dict\r\n    yield from chunks\r\n  File \"/Users/josepcugat/.pyenv/versions/3.6.8/lib/python3.6/json/encoder.py\", line 437, in _iterencode\r\n    o = _default(o)\r\n  File \"/Users/josepcugat/.pyenv/versions/3.6.8/lib/python3.6/json/encoder.py\", line 180, in default\r\n    o.__class__.__name__)\r\nTypeError: Object of type 'EnumMeta' is not JSON serializable\r\n```\r\n\r\nUsing pydantic 0.30.1 works as expected:\r\n\r\n```\r\n>>> from enum import Enum\r\n>>> from pydantic import BaseModel, Extra, ValidationError\r\n>>>\r\n>>> class MyEnum(str, Enum):\r\n...     VALID = \"VALID\"\r\n...\r\n>>> class Foo(BaseModel):\r\n...     bar: MyEnum\r\n...\r\n>>> try:\r\n...     Foo(bar=\"INVALID\")\r\n... except ValidationError as e:\r\n...     print(e.json())\r\n...\r\n[\r\n  {\r\n    \"loc\": [\r\n      \"bar\"\r\n    ],\r\n    \"msg\": \"value is not a valid enumeration member\",\r\n    \"type\": \"type_error.enum\"\r\n  }\r\n]\r\n```\r\n\r\nI suspect it has something to do with https://github.com/samuelcolvin/pydantic/pull/673 since now we are trying to serialize the `ctx` property of the error.","closed_by":{"login":"samuelcolvin","id":4039449,"node_id":"MDQ6VXNlcjQwMzk0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/4039449?v=4","gravatar_id":"","url":"https://api.github.com/users/samuelcolvin","html_url":"https://github.com/samuelcolvin","followers_url":"https://api.github.com/users/samuelcolvin/followers","following_url":"https://api.github.com/users/samuelcolvin/following{/other_user}","gists_url":"https://api.github.com/users/samuelcolvin/gists{/gist_id}","starred_url":"https://api.github.com/users/samuelcolvin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samuelcolvin/subscriptions","organizations_url":"https://api.github.com/users/samuelcolvin/orgs","repos_url":"https://api.github.com/users/samuelcolvin/repos","events_url":"https://api.github.com/users/samuelcolvin/events{/privacy}","received_events_url":"https://api.github.com/users/samuelcolvin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/696/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/696/timeline","performed_via_github_app":null,"state_reason":"completed"}