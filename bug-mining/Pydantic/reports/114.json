{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1155","repository_url":"https://api.github.com/repos/pydantic/pydantic","labels_url":"https://api.github.com/repos/pydantic/pydantic/issues/1155/labels{/name}","comments_url":"https://api.github.com/repos/pydantic/pydantic/issues/1155/comments","events_url":"https://api.github.com/repos/pydantic/pydantic/issues/1155/events","html_url":"https://github.com/pydantic/pydantic/issues/1155","id":546736535,"node_id":"MDU6SXNzdWU1NDY3MzY1MzU=","number":1155,"title":"Validator ignoring 'always=True' on optional fields on inheritance","user":{"login":"gaja-dev","id":59643062,"node_id":"MDQ6VXNlcjU5NjQzMDYy","avatar_url":"https://avatars.githubusercontent.com/u/59643062?v=4","gravatar_id":"","url":"https://api.github.com/users/gaja-dev","html_url":"https://github.com/gaja-dev","followers_url":"https://api.github.com/users/gaja-dev/followers","following_url":"https://api.github.com/users/gaja-dev/following{/other_user}","gists_url":"https://api.github.com/users/gaja-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/gaja-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaja-dev/subscriptions","organizations_url":"https://api.github.com/users/gaja-dev/orgs","repos_url":"https://api.github.com/users/gaja-dev/repos","events_url":"https://api.github.com/users/gaja-dev/events{/privacy}","received_events_url":"https://api.github.com/users/gaja-dev/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":597426502,"node_id":"MDU6TGFiZWw1OTc0MjY1MDI=","url":"https://api.github.com/repos/pydantic/pydantic/labels/bug%20V1","name":"bug V1","color":"ee0701","default":false,"description":"Bug related to Pydantic V1.X"},{"id":597426505,"node_id":"MDU6TGFiZWw1OTc0MjY1MDU=","url":"https://api.github.com/repos/pydantic/pydantic/labels/help%20wanted","name":"help wanted","color":"128A0C","default":true,"description":"Pull Request welcome"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-01-08T09:18:33Z","updated_at":"2020-12-17T10:10:04Z","closed_at":"2020-12-17T10:10:04Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Possible Bug\r\n\r\n**Validator seems to ignore the 'always' parameter on inheritance since pydantic >= 1.2**\r\n\r\nI had a running code that uses inheritance on the models with an enforced field that is used to decide if other optional fields will be checked, or not. This worked well until I updated to pydantic 1.3. Further testing shows that the code fails since pydantic 1.2. So there seem to be some changes from 1.1 to 1.2 that leads to this issue.\r\n\r\nUnfortunately I could not find a previous issue, or documentation hint that explains this deviating behavior to me.\r\n\r\nIf I missed something in the doc, please give me a hint and excuse my issue. Otherwise, I would be thankful if someone could fix this, or explain how the intended behavior can be achieved on pydantic >=1.2\r\n\r\nPlease find an example code and corresponding output below.\r\n\r\nOutput of `python -c \"import pydantic.utils; print(pydantic.utils.version_info())\"`:\r\n```\r\npydantic version: 1.3\r\npydantic compiled: False\r\ninstall path: [...]\\python_pydantic-ni4Wh3vY\\Lib\\site-packages\\pydantic\r\npython version: 3.6.8 (tags/v3.6.8:3c6b436a57, Dec 24 2018, 00:16:47) [MSC v.1916 64 bit (AMD64)]\r\nplatform: Windows-10-10.0.18362-SP0\r\noptional deps. installed: []\r\n```\r\n\r\nHere is an example code to reproduce this issue and below that, the corresponding output on pydantic 1.1 and >=1.2:\r\n```py\r\nimport typing\r\n\r\nimport pydantic\r\n\r\nclass A(pydantic.BaseModel):\r\n\r\n    must_validate: bool\r\n\r\n    class Config:\r\n        extra = pydantic.Extra.ignore\r\n\r\n\r\nclass B(pydantic.BaseModel):\r\n\r\n    value_a: typing.Optional[str] = None\r\n    value_b: typing.Optional[str] = None\r\n\r\n    class Config:\r\n        extra = pydantic.Extra.ignore\r\n\r\nclass C(B, A):\r\n\r\n    @pydantic.validator(\"value_a\", \"value_b\", always=True)\r\n    def validate_if_enforced(cls, value, values):\r\n        if \"must_validate\" in values and values[\"must_validate\"]:\r\n            if not value:\r\n                raise ValueError(\"must be set if 'must_validate' is True\")\r\n        return value\r\n    \r\n    class Config:\r\n        extra = pydantic.Extra.forbid\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    success_data = {\r\n        \"must_validate\": True,\r\n        \"value_a\": \"foo\",\r\n        \"value_b\": \"bar\",\r\n    }\r\n\r\n    fail_data = {\r\n        \"must_validate\": True,\r\n        \"value_a\": \"foo\",\r\n    }\r\n\r\n    try:\r\n        success = C.parse_obj(success_data)\r\n        print(success.dict())\r\n\r\n        fail = C.parse_obj(fail_data)\r\n        print(fail.dict())\r\n    except pydantic.ValidationError as exc:\r\n        print(exc)\r\n...\r\n```\r\n\r\nOutput on **pydantic 1.1** (This is the intended behavior!)\r\n```\r\n{'must_validate': True, 'value_a': 'foo', 'value_b': 'bar'}\r\n1 validation error for C\r\nvalue_b\r\n  must be set if 'must_validate' is True (type=value_error)\r\n```\r\n\r\nOutput on **pydantic >=1.2**\r\n```\r\n{'must_validate': True, 'value_a': 'foo', 'value_b': 'bar'}\r\n{'must_validate': True, 'value_a': 'foo', 'value_b': None}\r\n```","closed_by":{"login":"PrettyWood","id":18406791,"node_id":"MDQ6VXNlcjE4NDA2Nzkx","avatar_url":"https://avatars.githubusercontent.com/u/18406791?v=4","gravatar_id":"","url":"https://api.github.com/users/PrettyWood","html_url":"https://github.com/PrettyWood","followers_url":"https://api.github.com/users/PrettyWood/followers","following_url":"https://api.github.com/users/PrettyWood/following{/other_user}","gists_url":"https://api.github.com/users/PrettyWood/gists{/gist_id}","starred_url":"https://api.github.com/users/PrettyWood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PrettyWood/subscriptions","organizations_url":"https://api.github.com/users/PrettyWood/orgs","repos_url":"https://api.github.com/users/PrettyWood/repos","events_url":"https://api.github.com/users/PrettyWood/events{/privacy}","received_events_url":"https://api.github.com/users/PrettyWood/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pydantic/pydantic/issues/1155/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pydantic/pydantic/issues/1155/timeline","performed_via_github_app":null,"state_reason":"completed"}