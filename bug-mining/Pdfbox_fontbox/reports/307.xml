<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:50:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4749] Text Extraction leads to weird result - toUnicodeCMap is &apos;AdHoc-UCS&apos;</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4749</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I consider the attached PDF. I consider the text on the first page:&lt;/p&gt;

&lt;p&gt;&quot;Am F&#228;hrweg&quot;&lt;/p&gt;

&lt;p&gt;It appears the code for the first character &apos;A&apos; is 65 and is parsed correctly, while the code for the fourth character &apos;F&apos; is 70 which is parsed as a &apos;c&apos;.&lt;/p&gt;

&lt;p&gt;org.apache.pdfbox.pdmodel.font.PDFont.toUnicode(int) relies on a CMap named &apos;AdHoc-UCS&apos; which mapping in :&lt;/p&gt;

{129=&#252;, 3= , 8=%, 9=&amp;amp;, 11=(, 12=), 15=,, 16=-, 17=., 18=/, 19=0, 20=1, 21=2, 22=3, 23=4, 24=5, 25=6, 26=7, 27=8, 28=9, 29=:, 34=?, 36=A, 37=B, 38=C, 39=D, 40=E, 41=F, 42=G, 43=H, 44=I, 46=K, 47=L, 48=M, 49=N, 50=O, 51=P, 53=R, 54=S, 55=T, 56=U, 57=V, 58=W, 59=X, 61=Z, 68=a, 69=b, 70=c, 71=d, 72=e, 73=f, 74=g, 75=h, 76=i, 78=k, 79=l, 80=m, 81=n, 82=o, 83=p, 85=r, 86=s, 87=t, 88=u, 89=v, 90=w, 93=z, 95=|, 108=&#228;, 124=&#246;}

&lt;p&gt;-&amp;gt; &apos;A&apos; is parsed as &apos;A&apos; as it is out of the mapping of CMap, while &apos;F&apos; conflicts the entry mapping 70 to c.&lt;/p&gt;

&lt;p&gt;The document is correctly parsed in Acrobat Reader.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13280702">PDFBOX-4749</key>
            <summary>Text Extraction leads to weird result - toUnicodeCMap is &apos;AdHoc-UCS&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="blasd">Benoit Lacelle</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jan 2020 09:50:52 +0000</created>
                <updated>Fri, 18 Aug 2023 05:46:10 +0000</updated>
                            <resolved>Tue, 3 Nov 2020 16:24:25 +0000</resolved>
                                    <version>2.0.18</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17020114" author="blasd" created="Tue, 21 Jan 2020 10:19:51 +0000"  >&lt;p&gt;It seems related to &lt;a href=&quot;https://stackoverflow.com/questions/45895768/pdfbox-2-0-7-extracttext-not-working-but-1-8-13-does-and-pdfreader-as-well&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/45895768/pdfbox-2-0-7-extracttext-not-working-but-1-8-13-does-and-pdfreader-as-well&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17020194" author="mkl" created="Tue, 21 Jan 2020 12:42:14 +0000"  >&lt;p&gt;Indeed, it looks like the example document shows the same error as the document in that SO question.&lt;/p&gt;

&lt;p&gt;Please be aware, though, that the document here does not only have fonts with that &lt;b&gt;Encoding&lt;/b&gt; / &lt;b&gt;ToUnicode&lt;/b&gt; mismatch but other fonts, too. Thus, the proposal in my answer to that question (to remove the &lt;b&gt;ToUnicode&lt;/b&gt; entry from all fonts) for the document here must be refined to only remove the &lt;b&gt;ToUnicode&lt;/b&gt; maps from fonts with single-byte encoding, e.g. &lt;b&gt;WinAnsiEncoding&lt;/b&gt;.&lt;/p&gt;</comment>
                            <comment id="17020290" author="blasd" created="Tue, 21 Jan 2020 15:08:40 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt;. I&apos;m not comfortable enough to be able to detect automatically &apos;fonts with single-byte encoding&apos;.&lt;/p&gt;

&lt;p&gt;We process PDFs from various sources, they I can not preprocess systematically all PDFs. In fact, given the font, I check manually if it misbehaves on code 65 and 70; if yes, I remove the ToUnicode maps as you suggested in the SOF ticket. This way, I hope to detect automatically all these documents. It can be noted that in my case, like in the SOF case, the issue happened on a German document.&lt;/p&gt;</comment>
                            <comment id="17021253" author="mkl" created="Wed, 22 Jan 2020 16:32:41 +0000"  >&lt;p&gt;While indeed the document here is weird to start with and offers a &lt;b&gt;ToUnicode&lt;/b&gt; map that is a complete mismatch with the &lt;b&gt;Encoding&lt;/b&gt;, there also is an error in PDFBox: The &lt;b&gt;ToUnicode&lt;/b&gt; map clearly is a mapping of double-byte values to Unicode code points while the &lt;b&gt;Encoding&lt;/b&gt; just as clearly is a single-byte encoding. Thus, it is an error that PDFBox uses the &lt;b&gt;ToUnicode&lt;/b&gt; mapping at all.&lt;/p&gt;</comment>
                            <comment id="17021300" author="blasd" created="Wed, 22 Jan 2020 17:25:46 +0000"  >&lt;p&gt;Thanks for the info. Have you insights about when a fixed release be available ? (I might be able to help, but not to handle the whole thing as, as stated earlier, I do not master all related aspects).&lt;/p&gt;</comment>
                            <comment id="17021317" author="tilman" created="Wed, 22 Jan 2020 17:41:57 +0000"  >&lt;p&gt;The file is gone and I didn&apos;t save it.&lt;/p&gt;</comment>
                            <comment id="17021342" author="blasd" created="Wed, 22 Jan 2020 18:12:15 +0000"  >&lt;p&gt;It is back. I would rather not letting it available here idnefinitely. Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="17021362" author="tilman" created="Wed, 22 Jan 2020 18:21:25 +0000"  >&lt;p&gt;got it&lt;/p&gt;</comment>
                            <comment id="17021364" author="tilman" created="Wed, 22 Jan 2020 18:22:32 +0000"  >&lt;p&gt;Targeting to 2.0.19 so that we don&apos;t forget. This doesn&apos;t mean that this specific problem will be fixed.&lt;/p&gt;</comment>
                            <comment id="17021374" author="tilman" created="Wed, 22 Jan 2020 18:34:36 +0000"  >&lt;p&gt;I just tested manually removing /ToUnicode and yes now the text extraction is good.&lt;/p&gt;</comment>
                            <comment id="17021444" author="tilman" created="Wed, 22 Jan 2020 19:55:21 +0000"  >&lt;p&gt;I had a look, and I don&apos;t see a quick solution - CMap doesn&apos;t offer anything to tell whether the content is single byte or not. Besides, &quot;9.10.2 Mapping Character Codes to Unicode Values&quot; mentions the ToUnicode CMap first.&lt;/p&gt;</comment>
                            <comment id="17064242" author="lehmi" created="Sun, 22 Mar 2020 11:32:58 +0000"  >&lt;p&gt;I&apos;m going to extend CMap not to mixup one-btye and two-byte encodings&lt;/p&gt;</comment>
                            <comment id="17092701" author="jira-bot" created="Sun, 26 Apr 2020 12:46:43 +0000"  >&lt;p&gt;Commit 1877020 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877020&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877020&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4749&quot; title=&quot;Text Extraction leads to weird result - toUnicodeCMap is &amp;#39;AdHoc-UCS&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4749&quot;&gt;&lt;del&gt;PDFBOX-4749&lt;/del&gt;&lt;/a&gt;: preserve the origin byte length of all mappings&lt;/p&gt;</comment>
                            <comment id="17092702" author="jira-bot" created="Sun, 26 Apr 2020 12:50:26 +0000"  >&lt;p&gt;Commit 1877021 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877021&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877021&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4749&quot; title=&quot;Text Extraction leads to weird result - toUnicodeCMap is &amp;#39;AdHoc-UCS&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4749&quot;&gt;&lt;del&gt;PDFBOX-4749&lt;/del&gt;&lt;/a&gt;: pass the origin byte length to get a proper to unicode mapping&lt;/p&gt;</comment>
                            <comment id="17092706" author="lehmi" created="Sun, 26 Apr 2020 13:01:42 +0000"  >&lt;p&gt;I&apos;ve added support for the origin byte length of all mappings of a CMap. In the end those work correct if the origin length of the input value is available. PDFBox converts the byte value to an integer in an early stage of the parsing process so that the information of the origin code length is lost. We should consider to refactor that part of the code. However I&apos;ve found a way to estimate the origin code length for the given issue so that the mapping works.&lt;/p&gt;

&lt;p&gt;I&apos;d appreciate any feedback&lt;/p&gt;</comment>
                            <comment id="17092725" author="tilman" created="Sun, 26 Apr 2020 14:03:15 +0000"  >&lt;p&gt;Works fine for me, and there is an improvement for the file of &lt;a href=&quot;https://github.com/mozilla/pdf.js/issues/11768&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PDF.js issue 11768&lt;/a&gt;, the &quot;II&quot; after &quot;Task&quot; wasn&apos;t there before.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13001232/13001232_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17092734" author="lehmi" created="Sun, 26 Apr 2020 14:32:54 +0000"  >&lt;p&gt;Thanks for the fast feedback. I didn&apos;t expect to many cases with improvements as this improvement/fix addresses some corner cases. However, good to hear there are some.&lt;/p&gt;</comment>
                            <comment id="17094853" author="jira-bot" created="Tue, 28 Apr 2020 20:21:24 +0000"  >&lt;p&gt;Commit 1877143 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877143&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4749&quot; title=&quot;Text Extraction leads to weird result - toUnicodeCMap is &amp;#39;AdHoc-UCS&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4749&quot;&gt;&lt;del&gt;PDFBOX-4749&lt;/del&gt;&lt;/a&gt;: remove unused import&lt;/p&gt;</comment>
                            <comment id="17225521" author="lehmi" created="Tue, 3 Nov 2020 16:24:25 +0000"  >&lt;p&gt;Looks like we are done here. The mentioned refactoring can be done later.&lt;/p&gt;</comment>
                            <comment id="17230940" author="jira-bot" created="Thu, 12 Nov 2020 21:08:00 +0000"  >&lt;p&gt;Commit 1883368 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1883368&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1883368&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4749&quot; title=&quot;Text Extraction leads to weird result - toUnicodeCMap is &amp;#39;AdHoc-UCS&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4749&quot;&gt;&lt;del&gt;PDFBOX-4749&lt;/del&gt;&lt;/a&gt;: add tests&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12991561" name="PDFBOX-4749-reduced.pdf" size="5832" author="tilman" created="Wed, 22 Jan 2020 18:49:54 +0000"/>
                            <attachment id="13001232" name="screenshot-1.png" size="4634" author="tilman" created="Sun, 26 Apr 2020 14:03:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0aprs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>