<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:49:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2824] ArrayIndexOutOfBoundsException in GlyfSimpleDescript.readFlags() when multithreading</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2824</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;From Kenneth K. in the mailing list:&lt;/p&gt;

&lt;p&gt;I have a client application that convert pdf documents into single page tiff images.  Since the user export large quantities of documents I use a multithreaded approach.  Each thread loads it own document and converts the pages one by one.&lt;br/&gt;
The pdf file is serialized to the client thread and then each thread executes the following code.  If I only use 1 thread there is no problem.  I checked to make sure objects are shared between threads.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            docin = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(documentResult.getImage().getContent()),&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;==docin)
              &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Exception(&lt;span class=&quot;code-quote&quot;&gt;&quot;Invalid PDF document or an occured during retrieval&quot;&lt;/span&gt;);
               &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numPages = docin.getNumberOfPages();
                     &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; strPath = getPath(numPages);
                     &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; iPage = 0;
            PDFRenderer renderer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(docin);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0;i&amp;lt;numPages;i++)
            {
              PDPage page = docin.getPage(i);
              PDRectangle rect = page.getMediaBox();
              BufferedImage pageImage = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
              pageImage = renderer.renderImageWithDPI(i, 200f, ImageType.BINARY);
              ...
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Array index out of range: 8
       at org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:202)
       at org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:77)
       at org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)
       at org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161)
       at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForGID(TTFGlyph2D.java:140)
       at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForCharacterCode(TTFGlyph2D.java:92)
       at org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:333)
       at org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:314)
       at org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:731)
       at org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:690)
       at org.apache.pdfbox.rendering.PageDrawer.showText(PageDrawer.java:296)
       at org.apache.pdfbox.contentstream.PDFStreamEngine.showTextStrings(PDFStreamEngine.java:600)
       at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowTextAdjusted.process(ShowTextAdjusted.java:38)
       at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:802)
       at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:464)
       at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:438)
       at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:149)
       at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:179)
       at org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
       at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
       at org.apache.pdfbox.rendering.PDFRenderer.renderImageWithDPI(PDFRenderer.java:95)
       at org.ilsos.cm.export.client.rmi.workers.Pdf2SinglePageTiff.processResult(Pdf2SinglePageTiff.java:142)
       at org.ilsos.cm.export.client.rmi.ExportWorker.run(ExportWorker.java:72)
       at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:784)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12835497">PDFBOX-2824</key>
            <summary>ArrayIndexOutOfBoundsException in GlyfSimpleDescript.readFlags() when multithreading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>multithreading</label>
                    </labels>
                <created>Thu, 4 Jun 2015 19:27:44 +0000</created>
                <updated>Thu, 17 Mar 2016 19:06:51 +0000</updated>
                            <resolved>Fri, 12 Jun 2015 18:40:09 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>FontBox</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14573436" author="tilman" created="Thu, 4 Jun 2015 19:29:13 +0000"  >&lt;p&gt;I have the same problem, sometimes, when doing a build (I wanted to post it before, but had other things to do), I have more files than the standard build.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;....\bugzilla858109.pdf
Tests run: 21, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 10.558 sec &amp;lt;&amp;lt;&amp;lt; FAILURE! - in org.apache.pdfbox.rendering.TestRendering
render[AXSH02.pdf](org.apache.pdfbox.rendering.TestRendering)  Time elapsed: 0.665 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.ArrayIndexOutOfBoundsException: 45
	at org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:202)
	at org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:77)
	at org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)
	at org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161)
	at org.apache.fontbox.ttf.TrueTypeFont.getPath(TrueTypeFont.java:608)
	at org.apache.pdfbox.pdmodel.font.PDType1Font.getPath(PDType1Font.java:469)
	at org.apache.pdfbox.rendering.Type1Glyph2D.getPathForCharacterCode(Type1Glyph2D.java:67)
	at org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:359)
	at org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:340)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:758)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:717)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showTextString(PDFStreamEngine.java:587)
	at org.apache.pdfbox.rendering.PageDrawer.showTextString(PageDrawer.java:289)
	at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowText.process(ShowText.java:44)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:829)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:490)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:456)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:167)
	at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:180)
	at org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:69)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:56)
	at org.apache.pdfbox.rendering.TestRendering.render(TestRendering.java:80)

Running org.apache.pdfbox.text.TestTextStripper
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14575153" author="jahewson" created="Fri, 5 Jun 2015 20:05:01 +0000"  >&lt;p&gt;FontBox&apos;s fonts are some of the few classes in PDFBox which are required to be thread safe. This is because ExternalFonts is static and caches them.&lt;/p&gt;

&lt;p&gt;This issue would appear to be a corrupted reader in TrueTypeFont, which is not necessarily due to the method in the stack trace (some other method could be performing unsynchronized access to the same reader). However the culprit will be somewhere in TrueTypeFont or its table reading classes.&lt;/p&gt;

&lt;p&gt;Can we get a stack dump of every thread?&lt;/p&gt;</comment>
                            <comment id="14575759" author="tilman" created="Sat, 6 Jun 2015 14:50:55 +0000"  >&lt;p&gt;I added this code just before the place where it happens:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (index &amp;gt;= flags.length || index + i &amp;gt;= flags.length)
{ &lt;span class=&quot;code-comment&quot;&gt;// PDFBOX-2824
&lt;/span&gt;                        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (StackTraceElement[] stea : &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.getAllStackTraces().values())
                        {
                            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (StackTraceElement ste : stea)
                            {
                                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(ste);
                            }
                            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println();
                        }
}
                    flags[index + i] = flags[index];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And then did many builds, until it happened (note that all line numbers in GlyfSimpleDescript.java are one line higher than in the trunk, because of an extra import I forgot to delete):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;sun.misc.Unsafe.park(Native Method)
java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2082)
java.util.concurrent.ThreadPoolExecutor.awaitTermination(ThreadPoolExecutor.java:1468)
org.apache.pdfbox.ParallelParameterized$FixedThreadPoolScheduler.finished(ParallelParameterized.java:63)
org.junit.runners.ParentRunner.runChildren(ParentRunner.java:295)
org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
org.junit.runners.ParentRunner.run(ParentRunner.java:363)
org.apache.maven.surefire.junit4.JUnit4Provider.execute(JUnit4Provider.java:264)
org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:153)
org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:124)
org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:200)
org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:153)
org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:103)

java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:503)
java.lang.ref.Reference$ReferenceHandler.run(Reference.java:133)

sun.java2d.cmm.kcms.CMM.cmmGetNumComponents(Native Method)
sun.java2d.cmm.kcms.ICC_Transform.getNumOutComponents(ICC_Transform.java:110)
sun.java2d.cmm.kcms.pelArrayInfo.initInfo(ICC_Transform.java:976)
sun.java2d.cmm.kcms.pelArrayInfo.&amp;lt;init&amp;gt;(ICC_Transform.java:949)
sun.java2d.cmm.kcms.ICC_Transform.colorConvert(ICC_Transform.java:841)
java.awt.color.ICC_ColorSpace.toRGB(ICC_ColorSpace.java:182)
org.apache.pdfbox.pdmodel.graphics.color.PDDeviceRGB.toRGB(PDDeviceRGB.java:82)
org.apache.pdfbox.pdmodel.graphics.shading.ShadingContext.convertToRGB(ShadingContext.java:142)
org.apache.pdfbox.pdmodel.graphics.shading.TriangleBasedShadingContext.evalFunctionAndConvertToRGB(TriangleBasedShadingContext.java:167)
org.apache.pdfbox.pdmodel.graphics.shading.TriangleBasedShadingContext.calcPixelTable(TriangleBasedShadingContext.java:121)
org.apache.pdfbox.pdmodel.graphics.shading.GouraudShadingContext.calcPixelTable(GouraudShadingContext.java:111)
org.apache.pdfbox.pdmodel.graphics.shading.TriangleBasedShadingContext.createPixelTable(TriangleBasedShadingContext.java:80)
org.apache.pdfbox.pdmodel.graphics.shading.Type4ShadingContext.&amp;lt;init&amp;gt;(Type4ShadingContext.java:65)
org.apache.pdfbox.pdmodel.graphics.shading.Type4ShadingPaint.createContext(Type4ShadingPaint.java:66)
sun.java2d.pipe.AlphaPaintPipe.startSequence(AlphaPaintPipe.java:83)
sun.java2d.pipe.SpanShapeRenderer$Composite.startSequence(SpanShapeRenderer.java:56)
sun.java2d.pipe.SpanShapeRenderer.renderSpans(SpanShapeRenderer.java:194)
sun.java2d.pipe.SpanShapeRenderer.fill(SpanShapeRenderer.java:116)
sun.java2d.pipe.ValidatePipe.fill(ValidatePipe.java:160)
sun.java2d.SunGraphics2D.fill(SunGraphics2D.java:2468)
org.apache.pdfbox.rendering.PageDrawer.fillPath(PageDrawer.java:606)
org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.graphics.FillNonZeroRule.process(FillNonZeroRule.java:36)
org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:829)
org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:490)
org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:456)
org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:167)
org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:180)
org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:69)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:56)
org.apache.pdfbox.rendering.TestRendering.render(TestRendering.java:80)
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
java.lang.reflect.Method.invoke(Method.java:606)
org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
org.junit.runners.ParentRunner.run(ParentRunner.java:363)
org.junit.runners.Suite.runChild(Suite.java:128)
org.junit.runners.Suite.runChild(Suite.java:27)
org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
java.util.concurrent.FutureTask.run(FutureTask.java:262)
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)

java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.dumpThreads(Native Method)
java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.getAllStackTraces(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:1640)
org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:205)
org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:78)
org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)
org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161)
org.apache.fontbox.ttf.TrueTypeFont.getPath(TrueTypeFont.java:608)
org.apache.pdfbox.pdmodel.font.PDType1Font.getPath(PDType1Font.java:469)
org.apache.pdfbox.rendering.Type1Glyph2D.getPathForCharacterCode(Type1Glyph2D.java:67)
org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:359)
org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:340)
org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:758)
org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:717)
org.apache.pdfbox.contentstream.PDFStreamEngine.showTextString(PDFStreamEngine.java:587)
org.apache.pdfbox.rendering.PageDrawer.showTextString(PageDrawer.java:289)
org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowText.process(ShowText.java:44)
org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:829)
org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:490)
org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:456)
org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:167)
org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:180)
org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:69)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:56)
org.apache.pdfbox.rendering.TestRendering.render(TestRendering.java:80)
sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
java.lang.reflect.Method.invoke(Method.java:606)
org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
org.junit.runners.ParentRunner.run(ParentRunner.java:363)
org.junit.runners.Suite.runChild(Suite.java:128)
org.junit.runners.Suite.runChild(Suite.java:27)
org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
java.util.concurrent.FutureTask.run(FutureTask.java:262)
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)

java.io.RandomAccessFile.read0(Native Method)
java.io.RandomAccessFile.read(RandomAccessFile.java:330)
java.io.RandomAccessFile.readUnsignedShort(RandomAccessFile.java:767)
org.apache.fontbox.ttf.RAFDataStream.readUnsignedShort(RAFDataStream.java:117)
org.apache.fontbox.ttf.HorizontalMetricsTable.read(HorizontalMetricsTable.java:56)
org.apache.fontbox.ttf.TrueTypeFont.readTable(TrueTypeFont.java:361)
org.apache.fontbox.ttf.TrueTypeFont.getHorizontalMetrics(TrueTypeFont.java:225)
org.apache.fontbox.ttf.TrueTypeFont.getAdvanceWidth(TrueTypeFont.java:420)
org.apache.fontbox.ttf.TrueTypeFont.getWidth(TrueTypeFont.java:631)
org.apache.pdfbox.pdmodel.font.PDType1Font.getWidthFromFont(PDType1Font.java:339)
org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:365)
org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:340)
org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:758)
org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:717)
org.apache.pdfbox.contentstream.PDFStreamEngine.showTextString(PDFStreamEngine.java:587)
org.apache.pdfbox.rendering.PageDrawer.showTextString(PageDrawer.java:289)
org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowText.process(ShowText.java:44)
org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:829)
org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:490)
org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:456)
org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:167)
org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:180)
org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:69)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:56)
org.apache.pdfbox.rendering.TestRendering.render(TestRendering.java:80)
sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
java.lang.reflect.Method.invoke(Method.java:606)
org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
org.junit.runners.ParentRunner.run(ParentRunner.java:363)
org.junit.runners.Suite.runChild(Suite.java:128)
org.junit.runners.Suite.runChild(Suite.java:27)
org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
java.util.concurrent.FutureTask.run(FutureTask.java:262)
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)



java.io.RandomAccessFile.read0(Native Method)
java.io.RandomAccessFile.read(RandomAccessFile.java:330)
org.apache.fontbox.ttf.RAFDataStream.read(RAFDataStream.java:106)
org.apache.fontbox.ttf.TTFDataStream.readUnsignedByteArray(TTFDataStream.java:161)
org.apache.fontbox.ttf.GlyfDescript.readInstructions(GlyfDescript.java:117)
org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:77)
org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)
org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161)
org.apache.fontbox.ttf.GlyfCompositeDescript.getGlypDescription(GlyfCompositeDescript.java:270)
org.apache.fontbox.ttf.GlyfCompositeDescript.getYCoordinate(GlyfCompositeDescript.java:176)
org.apache.fontbox.ttf.GlyphRenderer.describe(GlyphRenderer.java:74)
org.apache.fontbox.ttf.GlyphRenderer.getPath(GlyphRenderer.java:56)
org.apache.fontbox.ttf.GlyphData.getPath(GlyphData.java:114)
org.apache.fontbox.ttf.TrueTypeFont.getPath(TrueTypeFont.java:615)
org.apache.pdfbox.pdmodel.font.PDType1Font.getPath(PDType1Font.java:469)
org.apache.pdfbox.rendering.Type1Glyph2D.getPathForCharacterCode(Type1Glyph2D.java:67)
org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:359)
org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:340)
org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:758)
org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:717)
org.apache.pdfbox.contentstream.PDFStreamEngine.showTextStrings(PDFStreamEngine.java:627)
org.apache.pdfbox.rendering.PageDrawer.showTextStrings(PageDrawer.java:297)
org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowTextAdjusted.process(ShowTextAdjusted.java:38)
org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:829)
org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:490)
org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:456)
org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:167)
org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:180)
org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:69)
org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:56)
org.apache.pdfbox.rendering.TestRendering.render(TestRendering.java:80)
sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
java.lang.reflect.Method.invoke(Method.java:606)
org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
org.junit.runners.ParentRunner.run(ParentRunner.java:363)
org.junit.runners.Suite.runChild(Suite.java:128)
org.junit.runners.Suite.runChild(Suite.java:27)
org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
java.util.concurrent.FutureTask.run(FutureTask.java:262)
java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)

java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)
java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)
java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209)

java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:135)
java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:151)
sun.java2d.Disposer.run(Disposer.java:145)
java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14576069" author="jahewson" created="Sun, 7 Jun 2015 02:03:21 +0000"  >&lt;p&gt;So there are multiple threads calling into the TTF code, we started with:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:205)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;which leaves us with:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.fontbox.ttf.HorizontalMetricsTable.read(HorizontalMetricsTable.java:56)&lt;/li&gt;
	&lt;li&gt;org.apache.fontbox.ttf.GlyfDescript.readInstructions(GlyfDescript.java:117)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;or something lower down the two stack traces of those methods.&lt;/p&gt;</comment>
                            <comment id="14576075" author="jahewson" created="Sun, 7 Jun 2015 02:17:40 +0000"  >&lt;p&gt;However, each of those stack traces include synchronized methods, so we don&apos;t seem to have a problem there. I&apos;d welcome some thoughts on this, could we be sharing readers? The TTF code is something which predates pretty much all of our current committers.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:205)&lt;br/&gt;
org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:78)&lt;br/&gt;
org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)&lt;br/&gt;
org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161) &amp;lt;=== synchronized&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;
&lt;p&gt;org.apache.fontbox.ttf.HorizontalMetricsTable.read(HorizontalMetricsTable.java:56)&lt;br/&gt;
org.apache.fontbox.ttf.TrueTypeFont.readTable(TrueTypeFont.java:361)&lt;br/&gt;
org.apache.fontbox.ttf.TrueTypeFont.getHorizontalMetrics(TrueTypeFont.java:225) &amp;lt;=== synchronized&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;
&lt;p&gt;org.apache.fontbox.ttf.GlyfDescript.readInstructions(GlyfDescript.java:117)&lt;br/&gt;
org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:77)&lt;br/&gt;
org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)&lt;br/&gt;
org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161) &amp;lt;=== synchronized&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14576224" author="lehmi" created="Sun, 7 Jun 2015 12:52:24 +0000"  >&lt;p&gt;I&apos;m not sure if this is related or even necessary but shouldn&apos;t &lt;em&gt;tables&lt;/em&gt; within &lt;em&gt;TrueTypeFont&lt;/em&gt; be a thread safe Hashtable instead of a not thread safe HashMap? That map is exposed/accessed by several non synchronized methods.&lt;/p&gt;</comment>
                            <comment id="14580444" author="tilman" created="Wed, 10 Jun 2015 12:23:26 +0000"  >&lt;p&gt;I changed it and the problem still happens &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14580641" author="tilman" created="Wed, 10 Jun 2015 15:26:50 +0000"  >&lt;p&gt;I was able to reproduce it easier by setting cores in ParallelParametrized to 8 and then run TestRendering (I have more files in the test directories than in the official build).&lt;/p&gt;

&lt;p&gt;So I did some testing with some misc changes:&lt;/p&gt;

&lt;p&gt;synchronized TrueTypeFont.getPath() - &lt;del&gt;no&lt;/del&gt; crash&lt;br/&gt;
synchronized the else part in that method - crash&lt;br/&gt;
synchronized GlyphData getGlyph(int gid) in GlyphTable.java - crash&lt;br/&gt;
synchronized around &quot;glyph = getGlyph().getGlyph(gid);&quot; - crash&lt;br/&gt;
synchronized int nameToGID(String name) - crash&lt;br/&gt;
use a Hashtable instead of a HashMap for &quot;tables&quot; - crash&lt;br/&gt;
use a ConcurrentHashMap instead of a HashMap for &quot;tables&quot; - crash&lt;br/&gt;
synchronize everything in TrueTypeFont.getPath except the first line - &lt;del&gt;no&lt;/del&gt; crash&lt;br/&gt;
set cache in Type1Glyph2D as Hashtable - crash&lt;br/&gt;
synchronized segment below &quot;todo&quot; in Type1Glyph2D.getPathForCharacterCode - &lt;del&gt;no&lt;/del&gt; crash&lt;/p&gt;

&lt;p&gt;&lt;del&gt;From a logical point of view, synchronizing the &quot;todo: can this happen?&quot; segment at Type1Glyph2D.getPathForCharacterCode() makes the most sense, looking and writing into a cache should be done carefully when in parallel. But the question is, did I find the real cause, or would it still happen with e.g. 32 threads on a fast system with many similar files?&lt;/del&gt;&lt;/p&gt;</comment>
                            <comment id="14580658" author="ssteiner1" created="Wed, 10 Jun 2015 15:38:13 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2439&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PDFBOX-2439&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14580692" author="tilman" created="Wed, 10 Jun 2015 15:55:52 +0000"  >&lt;p&gt;Yes that is exactly the same problem. I&apos;m sorry it didn&apos;t get enough attention, I see I was there as a watcher but probably forgot about it.&lt;/p&gt;</comment>
                            <comment id="14580715" author="tilman" created="Wed, 10 Jun 2015 16:09:18 +0000"  >&lt;p&gt;And yes, GlyphTable.cache is never populated. Probably should be at the end of the &quot;else&quot; segment of getGlyph().&lt;/p&gt;</comment>
                            <comment id="14580814" author="jahewson" created="Wed, 10 Jun 2015 17:06:05 +0000"  >&lt;blockquote&gt;
&lt;p&gt;From a logical point of view, synchronizing the &quot;todo: can this happen?&quot; segment at Type1Glyph2D.getPathForCharacterCode() makes the most sense,&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;Nope, it&apos;s the thread safe TrueTypeFont class&apos; job to be, well, thread safe. Its callers should not be making up for its deficiencies.&lt;/p&gt;

&lt;p&gt;One remaining angle: are we sure that the reader passed to TrueTypeFont is not being shared? FileSystemFontProvider would be responsible for that.&lt;/p&gt;</comment>
                            <comment id="14580853" author="jahewson" created="Wed, 10 Jun 2015 17:30:34 +0000"  >&lt;p&gt;It&apos;s not necessary because &lt;em&gt;tables&lt;/em&gt; is effectively read-only after parsing is complete. So it&apos;s ok to share it after that.&lt;/p&gt;</comment>
                            <comment id="14580891" author="tilman" created="Wed, 10 Jun 2015 18:02:54 +0000"  >&lt;p&gt;bad news - synchronizing TrueTypeFont.getPath() doesn&apos;t help. I&apos;m now able to reproduce the effect most of the time with 8 threads and the file annots.pdf, to be found with google, or e.g. here&lt;br/&gt;
&lt;a href=&quot;https://github.com/PaperCutSoftware/GhostTrap/blob/master/tests/input/annots.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/PaperCutSoftware/GhostTrap/blob/master/tests/input/annots.pdf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14580917" author="kenneyil" created="Wed, 10 Jun 2015 18:26:41 +0000"  >&lt;p&gt;Added the synchronized keyword the getPath method of TrueTypeFont.java and still got the error.  Below in the stack trace you can see the three threads error out.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 62558
java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 8
	at org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:202)
	at org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:77)
	at org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)
	at org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161)
	at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForGID(TTFGlyph2D.java:140)
	at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForCharacterCode(TTFGlyph2D.java:92)
	at org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:333)
	at org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:314)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:731)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:690)
	at org.apache.pdfbox.rendering.PageDrawer.showText(PageDrawer.java:296)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showTextStrings(PDFStreamEngine.java:600)
	at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowTextAdjusted.process(ShowTextAdjusted.java:38)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:802)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:464)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:438)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:149)
	at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:179)
	at org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImageWithDPI(PDFRenderer.java:95)
	at org.ilsos.cm.export.client.workers.Pdf2SinglePageTiff.processResult(Pdf2SinglePageTiff.java:139)
	at org.ilsos.cm.export.client.ExportWorker.run(ExportWorker.java:69)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:784)
	at org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:202)
	at org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:77)
	at org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)
	at org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161)
	at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForGID(TTFGlyph2D.java:140)
	at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForCharacterCode(TTFGlyph2D.java:92)
	at org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:333)
	at org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:314)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:731)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:690)
	at org.apache.pdfbox.rendering.PageDrawer.showText(PageDrawer.java:296)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showTextStrings(PDFStreamEngine.java:600)
	at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowTextAdjusted.process(ShowTextAdjusted.java:38)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:802)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:464)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:438)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:149)
	at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:179)
	at org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImageWithDPI(PDFRenderer.java:95)
	at org.ilsos.cm.export.client.workers.Pdf2SinglePageTiff.processResult(Pdf2SinglePageTiff.java:139)
	at org.ilsos.cm.export.client.ExportWorker.run(ExportWorker.java:69)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:784)
java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 8
	at org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:202)
	at org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:77)
	at org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)
	at org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161)
	at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForGID(TTFGlyph2D.java:140)
	at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForCharacterCode(TTFGlyph2D.java:92)
	at org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:333)
	at org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:314)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:731)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:690)
	at org.apache.pdfbox.rendering.PageDrawer.showText(PageDrawer.java:296)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showTextStrings(PDFStreamEngine.java:600)
	at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowTextAdjusted.process(ShowTextAdjusted.java:38)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:802)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:464)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:438)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:149)
	at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:179)
	at org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImageWithDPI(PDFRenderer.java:95)
	at org.ilsos.cm.export.client.workers.Pdf2SinglePageTiff.processResult(Pdf2SinglePageTiff.java:139)
	at org.ilsos.cm.export.client.ExportWorker.run(ExportWorker.java:69)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:784)
java.lang.ArrayIndexOutOfBoundsException: Array index out of range: 62558
	at org.apache.fontbox.ttf.GlyfSimpleDescript.readFlags(GlyfSimpleDescript.java:202)
	at org.apache.fontbox.ttf.GlyfSimpleDescript.&amp;lt;init&amp;gt;(GlyfSimpleDescript.java:77)
	at org.apache.fontbox.ttf.GlyphData.initData(GlyphData.java:58)
	at org.apache.fontbox.ttf.GlyphTable.getGlyph(GlyphTable.java:161)
	at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForGID(TTFGlyph2D.java:140)
	at org.apache.pdfbox.rendering.TTFGlyph2D.getPathForCharacterCode(TTFGlyph2D.java:92)
	at org.apache.pdfbox.rendering.PageDrawer.drawGlyph2D(PageDrawer.java:333)
	at org.apache.pdfbox.rendering.PageDrawer.showFontGlyph(PageDrawer.java:314)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showGlyph(PDFStreamEngine.java:731)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showText(PDFStreamEngine.java:690)
	at org.apache.pdfbox.rendering.PageDrawer.showText(PageDrawer.java:296)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.showTextStrings(PDFStreamEngine.java:600)
	at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.ShowTextAdjusted.process(ShowTextAdjusted.java:38)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:802)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:464)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:438)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:149)
	at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:179)
	at org.apache.pdfbox.rendering.PDFRenderer.renderPage(PDFRenderer.java:205)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:136)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImageWithDPI(PDFRenderer.java:95)
	at org.ilsos.cm.export.client.workers.Pdf2SinglePageTiff.processResult(Pdf2SinglePageTiff.java:139)
	at org.ilsos.cm.export.client.ExportWorker.run(ExportWorker.java:69)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:784)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14581290" author="jahewson" created="Thu, 11 Jun 2015 00:42:54 +0000"  >&lt;p&gt;I can see what the problem is there. In TTFGlyph2D.getPathForGID, we see the line:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;GlyphData glyph = ttf.getGlyph().getGlyph(gid);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, ttf.getGlyph() is synchronized and the getGlyph(gid) method of GlyphTable is too, however GlyphTable #getGlyph(gid) is synchronized on the GlyphTable instance, while TrueTypeFont#getGlyph() is synchronized on the TrueTypeFont instance. Both share the same TTFDataStream, so we&apos;re failing to synchronize on the resource which is actually being shared and the result is simultaneous reads.&lt;/p&gt;

&lt;p&gt;P.S. You can include quoted code in &lt;a href=&quot;https://issues.apache.org/jira/secure/WikiRendererHelpAction.jspa?section=advanced&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;JIRA markup&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14582012" author="kenneyil" created="Thu, 11 Jun 2015 14:50:21 +0000"  >&lt;p&gt;Thanks Guys.  I added a synchronization block to TrueTypeFont.java #readTable method to synchronize on the data stream and changed the synchronization of GlyphTable getGlyph from the GlyphTable instance to data stream and the Exception has abated.&lt;/p&gt;</comment>
                            <comment id="14582130" author="tilman" created="Thu, 11 Jun 2015 15:49:13 +0000"  >&lt;p&gt;It didn&apos;t work for me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14582183" author="kenneyil" created="Thu, 11 Jun 2015 16:24:42 +0000"  >&lt;p&gt;That&apos;s odd.  I would get the exception every time I use more the one thread to consume documents and now it&apos;s running with no exceptions after I made the changes I mentioned.  I definitely think John was on the right track but where it need to be implemented is still yet to be determined. &lt;/p&gt;</comment>
                            <comment id="14582321" author="jahewson" created="Thu, 11 Jun 2015 18:17:31 +0000"  >&lt;p&gt;I&apos;ve attached a patch which adds the TrueTypeFont as a constructor parameter to TTFTable, so that TTFTable instances can synchronize on it, and made GlyphTable#getGlyph() do that. I&apos;ve also made the mutable setters of TTFTable package-private, as they are used for parsing only.&lt;/p&gt;</comment>
                            <comment id="14582412" author="tilman" created="Thu, 11 Jun 2015 19:31:58 +0000"  >&lt;p&gt;It works, I did at least successful 10 tests with the 8x rendering of the annots.pdf file.&lt;/p&gt;</comment>
                            <comment id="14583868" author="jira-bot" created="Fri, 12 Jun 2015 18:39:22 +0000"  >&lt;p&gt;Commit 1685144 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1685144&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1685144&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2824&quot; title=&quot;ArrayIndexOutOfBoundsException in GlyfSimpleDescript.readFlags() when multithreading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2824&quot;&gt;&lt;del&gt;PDFBOX-2824&lt;/del&gt;&lt;/a&gt;: Fix multithreading issues in GlyphTable&lt;/p&gt;</comment>
                            <comment id="14583896" author="tilman" created="Fri, 12 Jun 2015 18:57:58 +0000"  >&lt;p&gt;Thanks... what about that GlyphTable.cache that is never populated? I&apos;m not even sure the cache is needed, because caching is also done at another place.&lt;/p&gt;</comment>
                            <comment id="14584205" author="jahewson" created="Fri, 12 Jun 2015 22:40:47 +0000"  >&lt;p&gt;It&apos;s probably not worth bothering with, as you say we have caches elsewhere.&lt;/p&gt;</comment>
                            <comment id="14584212" author="jira-bot" created="Fri, 12 Jun 2015 22:46:49 +0000"  >&lt;p&gt;Commit 1685184 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1685184&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1685184&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2824&quot; title=&quot;ArrayIndexOutOfBoundsException in GlyfSimpleDescript.readFlags() when multithreading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2824&quot;&gt;&lt;del&gt;PDFBOX-2824&lt;/del&gt;&lt;/a&gt;: remove unused cache&lt;/p&gt;</comment>
                            <comment id="14584214" author="jira-bot" created="Fri, 12 Jun 2015 22:47:26 +0000"  >&lt;p&gt;Commit 1685185 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1685185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1685185&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2824&quot; title=&quot;ArrayIndexOutOfBoundsException in GlyfSimpleDescript.readFlags() when multithreading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2824&quot;&gt;&lt;del&gt;PDFBOX-2824&lt;/del&gt;&lt;/a&gt;: remove unused imports&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12749279">PDFBOX-2439</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12888802">TIKA-1737</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12739096" name="PDFBOX-2824.patch" size="20672" author="jahewson" created="Thu, 11 Jun 2015 18:16:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fnen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>