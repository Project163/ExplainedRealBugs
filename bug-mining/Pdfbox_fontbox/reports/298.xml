<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:50:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4828] Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4828</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13002582/13002582_ARIALUNI.TTF&quot; title=&quot;ARIALUNI.TTF attached to PDFBOX-4828&quot;&gt;ARIALUNI.TTF&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13002583/13002583_Test1.java&quot; title=&quot;Test1.java attached to PDFBOX-4828&quot;&gt;Test1.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;ARIALUNI.TTF^&lt;img src=&quot;https://issues.apache.org/jira/images/icons/attach/noimage.png&quot; imagetext=&quot;/jira/images/icons/link_attachment_7.gif|width=7,height=7,align=absmiddle&quot; align=&quot;absmiddle&quot; border=&quot;0&quot; height=&quot;7&quot; width=&quot;7&quot; /&gt;^&lt;/p&gt;

&lt;p&gt;Run the follows code use 2.0.12, the text can be successfully encoded. Run this code use 2.0.19, the text can&apos;t be encoded.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException { &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException { &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;sun.java2d.cmm&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sun.java2d.cmm.kcms.KcmsServiceProvider&quot;&lt;/span&gt;);  PDDocument doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument(); &#160; &#160; PDPage page = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage(PDRectangle.A4); &#160; &#160; doc.addPage(page);
 &#160; &#160; File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;ARIALUNI.TTF&quot;&lt;/span&gt;); &#160; &#160; PDType0Font ttFont = PDType0Font.loadVertical(doc, file); &#160; &#160;&#160; &#160; &#160; PDPageContentStream contentStream1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPageContentStream(doc, page); &#160; &#160;&#160; &#160; &#160; contentStream1.beginText(); &#160; &#160; contentStream1.newLineAtOffset(100, 100);
 &#160; &#160; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text = &lt;span class=&quot;code-quote&quot;&gt;&quot;&#30005;&#20449;&quot;&lt;/span&gt;; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(isCharacterEncodeable(text, ttFont)) &#160; &#160; { &#160; &#160; &#160; &#160; contentStream1.setFont(ttFont, 12); &#160; &#160; &#160; &#160; contentStream1.showText(text); &#160; &#160; } &#160; &#160; contentStream1.endText(); &#160; &#160; contentStream1.close(); &#160; &#160;&#160; &#160; &#160; doc.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;export.pdf&quot;&lt;/span&gt;);
 &#160; &#160; doc.close();  &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;aaaaa&quot;&lt;/span&gt;); }  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isCharacterEncodeable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text, PDFont font){ &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; { font.encode(text); &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; } }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13304003">PDFBOX-4828</key>
            <summary>Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="berylbai">bai yuan</reporter>
                        <labels>
                            <label>regression</label>
                    </labels>
                <created>Mon, 11 May 2020 04:25:00 +0000</created>
                <updated>Mon, 15 Jun 2020 04:54:19 +0000</updated>
                            <resolved>Wed, 13 May 2020 17:43:04 +0000</resolved>
                                    <version>2.0.19</version>
                                    <fixVersion>2.0.20</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>FontBox</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17104085" author="tilman" created="Mon, 11 May 2020 05:32:18 +0000"  >&lt;p&gt;Thank you... 2.0.17 is the first version that fails&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.lang.ArrayIndexOutOfBoundsException: 60
	at org.apache.fontbox.ttf.GlyphSubstitutionTable.getFeatureRecords(GlyphSubstitutionTable.java:418)
	at org.apache.fontbox.ttf.GlyphSubstitutionTable.getSubstitution(GlyphSubstitutionTable.java:532)
	at org.apache.fontbox.ttf.SubstitutingCmapLookup.getGlyphId(SubstitutingCmapLookup.java:45)
	at org.apache.pdfbox.pdmodel.font.PDCIDFontType2.encode(PDCIDFontType2.java:337)
	at org.apache.pdfbox.pdmodel.font.PDType0Font.encode(PDType0Font.java:415)
	at org.apache.pdfbox.pdmodel.font.PDFont.encode(PDFont.java:342)
	at org.apache.pdfbox.pdmodel.PDPageContentStream.showTextInternal(PDPageContentStream.java:514)
	at org.apache.pdfbox.pdmodel.PDPageContentStream.showText(PDPageContentStream.java:476)
	at com.mycompany.mavenpdfboxtest.PDFBOX4828.main(PDFBOX4828.java:44) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17104096" author="tilman" created="Mon, 11 May 2020 05:53:27 +0000"  >&lt;p&gt;It happened in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4580&quot; title=&quot;PDFTextStripper::getText() lead to OutOfMemoryError: Java heap space&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4580&quot;&gt;&lt;del&gt;PDFBOX-4580&lt;/del&gt;&lt;/a&gt;. The warning &quot;FeatureRecord array not alphabetically sorted by FeatureTag: init &amp;lt; isol&quot; is related to the problem. Removing the &quot;return&quot; in the code makes it work again. The change is there to detect corrupt fonts. ArialUni.ttf is obviously not a corrupt font but it does not follow the specification.&lt;/p&gt;

&lt;p&gt;So there are two things to do:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;make the check more relaxed so that only non alphanum names are checked&lt;/li&gt;
	&lt;li&gt;find out why the ArrayIndexOutOfBoundsException. My guess is that we skip one table but not another table that references it.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17104113" author="jira-bot" created="Mon, 11 May 2020 06:16:55 +0000"  >&lt;p&gt;Commit 1877561 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877561&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4828&quot; title=&quot;Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4828&quot;&gt;&lt;del&gt;PDFBOX-4828&lt;/del&gt;&lt;/a&gt;: avoid ArrayIndexOutOfBoundsException&lt;/p&gt;</comment>
                            <comment id="17104117" author="jira-bot" created="Mon, 11 May 2020 06:27:00 +0000"  >&lt;p&gt;Commit 1877562 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877562&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877562&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4828&quot; title=&quot;Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4828&quot;&gt;&lt;del&gt;PDFBOX-4828&lt;/del&gt;&lt;/a&gt;: avoid ArrayIndexOutOfBoundsException&lt;/p&gt;</comment>
                            <comment id="17104119" author="jira-bot" created="Mon, 11 May 2020 06:28:19 +0000"  >&lt;p&gt;Commit 1877563 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877563&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877563&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4828&quot; title=&quot;Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4828&quot;&gt;&lt;del&gt;PDFBOX-4828&lt;/del&gt;&lt;/a&gt;: avoid ArrayIndexOutOfBoundsException&lt;/p&gt;</comment>
                            <comment id="17104121" author="jira-bot" created="Mon, 11 May 2020 06:30:04 +0000"  >&lt;p&gt;Commit 1877564 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877564&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877564&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4828&quot; title=&quot;Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4828&quot;&gt;&lt;del&gt;PDFBOX-4828&lt;/del&gt;&lt;/a&gt;: avoid ArrayIndexOutOfBoundsException&lt;/p&gt;</comment>
                            <comment id="17104133" author="tilman" created="Mon, 11 May 2020 06:58:50 +0000"  >&lt;p&gt;Surprisingly, avoiding the AIOOB also solves your problem (edit: this is because you were catching all exceptions, and not just the exception mentioned in the javadoc). Snapshot available here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.20-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.20-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll do the other change later.&lt;/p&gt;</comment>
                            <comment id="17106512" author="jira-bot" created="Wed, 13 May 2020 17:37:53 +0000"  >&lt;p&gt;Commit 1877704 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877704&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877704&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4828&quot; title=&quot;Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4828&quot;&gt;&lt;del&gt;PDFBOX-4828&lt;/del&gt;&lt;/a&gt;: don&apos;t bother with improperly sorted tables as long as the contents aren&apos;t trash&lt;/p&gt;</comment>
                            <comment id="17106513" author="jira-bot" created="Wed, 13 May 2020 17:37:58 +0000"  >&lt;p&gt;Commit 1877705 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877705&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4828&quot; title=&quot;Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4828&quot;&gt;&lt;del&gt;PDFBOX-4828&lt;/del&gt;&lt;/a&gt;: don&apos;t bother with improperly sorted tables as long as the contents aren&apos;t trash&lt;/p&gt;</comment>
                            <comment id="17106514" author="jira-bot" created="Wed, 13 May 2020 17:38:01 +0000"  >&lt;p&gt;Commit 1877706 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1877706&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1877706&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4828&quot; title=&quot;Encode a text using the vertical type of the font in the attachment, which succeeded in version 2.0.12 but failed in version 2.0.19&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4828&quot;&gt;&lt;del&gt;PDFBOX-4828&lt;/del&gt;&lt;/a&gt;: don&apos;t bother with improperly sorted tables as long as the contents aren&apos;t trash&lt;/p&gt;</comment>
                            <comment id="17106517" author="tilman" created="Wed, 13 May 2020 17:43:04 +0000"  >&lt;p&gt;That&apos;s it, thanks for your report. The new snapshot should be available at the mentioned link soon.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13002582" name="ARIALUNI.TTF" size="23275812" author="berylbai" created="Mon, 11 May 2020 04:19:23 +0000"/>
                            <attachment id="13002583" name="Test1.java" size="2756" author="berylbai" created="Mon, 11 May 2020 04:31:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0eku0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>