<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:49:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3319] Chinese character overlap other chinese character</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3319</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;i&apos;m using SimHei.ttf copy from my windows fonts folder.&lt;br/&gt;
i found when i use my font to show Chinese.character will overlap other chinese. just for Chinese character, english is ok. &lt;br/&gt;
it looks the second character start from the a half width first character?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12959537">PDFBOX-3319</key>
            <summary>Chinese character overlap other chinese character</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="huazhong">huazhong</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Apr 2016 05:40:35 +0000</created>
                <updated>Sat, 25 Mar 2017 18:13:37 +0000</updated>
                            <resolved>Tue, 19 Apr 2016 16:27:10 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.1</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Writing</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15245199" author="tilman" created="Mon, 18 Apr 2016 06:28:34 +0000"  >&lt;p&gt;The /W array looks suspicious. There are many individual 500 values in the &quot;bad&quot; file, and in the good file that I just created from word, these are 1000 or default 1000.&lt;/p&gt;</comment>
                            <comment id="15245944" author="tilman" created="Mon, 18 Apr 2016 16:25:37 +0000"  >&lt;p&gt;When removing the &quot;!&quot; the widths are OK. There is a problem with fonts that have some identical hmetrics, i.e. where the last advanceWidth value applies to all subsequent glyphs. (I&apos;d call this a &quot;partial monotype font&quot;) I&apos;m wondering whether in TTFSubsetter.buildHmtxTable the &quot;catchall&quot; entry (&quot;The last entry applies to all subsequent glyphs&quot;) is copied.&lt;/p&gt;

&lt;p&gt;In the font numHMetrics is 855. Some debug output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Subsetter.add unicode 20320, gid 1430
Subsetter.add unicode 33, gid 4
Subsetter.add unicode 20013, gid 1123
Subsetter.add unicode 22269, gid 3379
Subsetter.add unicode 22909, gid 4019
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &quot;!&quot; (gid 4) is the only gid smaller than 855 so it will get its specific width. All the other ones have an identical width, the one from the last hmtx entry.&lt;/p&gt;

&lt;p&gt;numHMetrics for the subset is written in buildHheaTable:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;writeUint16(out, glyphIds.subSet(0, h.getNumberOfHMetrics()).size());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it just counts the used gids that are in (0...854). If any gid is &amp;gt;= than 855 then it should put one extra entry in the subset for all, i.e. the one from 854. Currently the one from gid 4 would be the last one, and the &quot;!&quot; width is smaller than the chinese glyphs.&lt;/p&gt;

&lt;p&gt;One quick solution would be to add in the 2nd TTFSubsetter constructor this line at the end:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;glyphIds.add(ttf.getHorizontalHeader().getNumberOfHMetrics()-1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However this would also mean that the subsetted font gets too big (for this example, the size difference in the final file is 263 bytes) because we don&apos;t check whether it is needed, and we would also write the path of that glyph instead of just writing one single hmtx entry (4 bytes).&lt;/p&gt;

&lt;p&gt;I&apos;ll come up with a better solution tomorrow.&lt;/p&gt;</comment>
                            <comment id="15247479" author="huazhong" created="Tue, 19 Apr 2016 10:09:33 +0000"  >&lt;p&gt;hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; &lt;br/&gt;
Thanks your answer.&lt;br/&gt;
i try to change embedSubset to  false, it works well in my windows 7 with adobe pdf reader.but can&apos;t display Chinese character in centos 7(use wrong font,this font cannot support Chinese), see&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12799476/12799476_testChinese_embedSubset_false.pdf&quot; title=&quot;testChinese_embedSubset_false.pdf attached to PDFBOX-3319&quot;&gt;testChinese_embedSubset_false.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;PDType0Font.load(document, TestPDF.class.getResourceAsStream(&quot;/fonts/SimHei.ttf&quot;),&lt;b&gt;false&lt;/b&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="15247618" author="tilman" created="Tue, 19 Apr 2016 11:58:39 +0000"  >&lt;p&gt;yes that is why you should always embed. I&apos;ll make an improved change soon.&lt;/p&gt;</comment>
                            <comment id="15248039" author="jira-bot" created="Tue, 19 Apr 2016 16:02:03 +0000"  >&lt;p&gt;Commit 1739952 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1739952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1739952&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3319&quot; title=&quot;Chinese character overlap other chinese character&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3319&quot;&gt;&lt;del&gt;PDFBOX-3319&lt;/del&gt;&lt;/a&gt;: correct handling of partially monospaced fonts&lt;/p&gt;</comment>
                            <comment id="15248051" author="tilman" created="Tue, 19 Apr 2016 16:06:31 +0000"  >&lt;p&gt;Commit 1739950 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1739950&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1739950&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3319&quot; title=&quot;Chinese character overlap other chinese character&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3319&quot;&gt;&lt;del&gt;PDFBOX-3319&lt;/del&gt;&lt;/a&gt;: correct handling of partially monospaced fonts&lt;/p&gt;</comment>
                            <comment id="15248059" author="tilman" created="Tue, 19 Apr 2016 16:09:34 +0000"  >&lt;p&gt;The committed change increases only the hmtx table if needed. The font file is 4 bytes larger. The final file is 8 bytes larger because the widths table is larger, i.e. &quot;1000&quot; instead of &quot;500&quot;. The 1000 isn&apos;t needed because that is the default width, I&apos;ll optimize that.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wolfgang.glas%40ev-i.at&quot; class=&quot;user-hover&quot; rel=&quot;wolfgang.glas@ev-i.at&quot;&gt;wolfgang.glas@ev-i.at&lt;/a&gt; maybe the change is also relevant to your project.&lt;/p&gt;</comment>
                            <comment id="15248069" author="jira-bot" created="Tue, 19 Apr 2016 16:15:47 +0000"  >&lt;p&gt;Commit 1739957 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1739957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1739957&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3319&quot; title=&quot;Chinese character overlap other chinese character&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3319&quot;&gt;&lt;del&gt;PDFBOX-3319&lt;/del&gt;&lt;/a&gt;: skip default width 1000&lt;/p&gt;</comment>
                            <comment id="15248073" author="jira-bot" created="Tue, 19 Apr 2016 16:16:25 +0000"  >&lt;p&gt;Commit 1739958 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1739958&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1739958&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3319&quot; title=&quot;Chinese character overlap other chinese character&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3319&quot;&gt;&lt;del&gt;PDFBOX-3319&lt;/del&gt;&lt;/a&gt;: skip default width 1000&lt;/p&gt;</comment>
                            <comment id="15248101" author="tilman" created="Tue, 19 Apr 2016 16:27:10 +0000"  >&lt;p&gt;Setting to resolved. A snapshot version should be available within a few hours. A new release is planned to come out next week. Thanks for the report!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12977532">PDFBOX-3379</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12799203" name="SimHei.ttf" size="9751960" author="huazhong" created="Mon, 18 Apr 2016 05:46:04 +0000"/>
                            <attachment id="12799201" name="TestPDF.java" size="2015" author="huazhong" created="Mon, 18 Apr 2016 05:41:15 +0000"/>
                            <attachment id="12799204" name="china-word.pdf" size="124954" author="tilman" created="Mon, 18 Apr 2016 06:28:34 +0000"/>
                            <attachment id="12799202" name="testChinese.pdf" size="3961" author="huazhong" created="Mon, 18 Apr 2016 05:41:15 +0000"/>
                            <attachment id="12799476" name="testChinese_embedSubset_false.pdf" size="145699" author="huazhong" created="Tue, 19 Apr 2016 10:10:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2w8pz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>