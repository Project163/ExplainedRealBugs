<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:50:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3757] TTFSubsetter scrambles PostScript names and unicode codepoints when subset contains diaeresis</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3757</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I tried to build a standalone FontSubsetter with the great fontbox tools. It works so far for OpenType/TrueType fonts, but when the glyph subset contains characters with diaeresis (like german umlauts &#228;&#246;&#252;), the TTFSubsetter class scrambles PostScript names and unicode codepoints.&lt;/p&gt;

&lt;p&gt;When creating a subset from DejaVuSans.ttf for example, with only those two characters &quot;&#214;&#8202;&quot; (O umlaut and a hair space \u200A), the resulting font subset is recognized as a valid font, but the unicode codepoint 200A in the resulting font file has the postscript name &quot;Dieresis&quot; and the single dieresis are named &quot;uni200A&quot;. See screenshot &quot;fontbox-2.0.5-ttfsubsetter_dieresis-scrambled-names.png&quot; and the subsetted Font &quot;Subset-DejaVuSans__dieresis-scrambled-names.ttf&quot;.&lt;/p&gt;

&lt;p&gt;When there are more glyphs in the subset, more whitespace, special chars and umlauts, the scrambling goes even further and also scrambles unicode codepoints and not only postscript names:&lt;/p&gt;

&lt;p&gt;glyphs in subset: &quot;Rabenk&#246;igKrmloEyGfthsTjHdAu cvF&#252;D.&#8198;w,&#228;Up:IzWVZSN-&#223;LC&#8197;PB5M&#171;&#187;O2013Q&#169;/;x978-()64XJ&apos;!&#196;?&#8249;&#8250;&#160;...&#220;qY&#8202;&amp;amp;&#214;&#233;|_&#8226;{}[]&amp;gt;#*$^&lt;br class=&quot;atl-forced-newline&quot; /&gt;+&quot;&lt;/p&gt;

&lt;p&gt;Resulting font: &quot;Subset-DejaVuSans__scrambled-codepoints.ttf&quot;&lt;br/&gt;
Screenshot: &quot;fontbox-2.0.5-ttfsubsetter_scrambled-codepoints.png&quot;&lt;/p&gt;

&lt;p&gt;I considder this a bug, as it does not appear when there are no umlauts or diaeresis in the subset.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13064664">PDFBOX-3757</key>
            <summary>TTFSubsetter scrambles PostScript names and unicode codepoints when subset contains diaeresis</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tofi86">Tobias Fischer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Apr 2017 10:33:44 +0000</created>
                <updated>Mon, 15 May 2017 20:28:12 +0000</updated>
                            <resolved>Wed, 19 Apr 2017 11:41:58 +0000</resolved>
                                    <version>2.0.5</version>
                                    <fixVersion>2.0.6</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>FontBox</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15973003" author="tilman" created="Tue, 18 Apr 2017 16:26:06 +0000"  >&lt;p&gt;Tthe subsetter creates a bad &quot;post&quot; table. This doesn&apos;t occur in production because PDFBox doesn&apos;t use the &quot;post&quot; table, see TTFSubsetterTest.java and TrueTypeEmbedder.java.&lt;/p&gt;

&lt;p&gt;This code reproduces your problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;DejaVuSans.ttf&quot;&lt;/span&gt;);
TrueTypeFont ttf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TTFParser().parse(file);
TTFSubsetter ttfSubsetter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TTFSubsetter(ttf);
ttfSubsetter.add(&lt;span class=&quot;code-quote&quot;&gt;&apos;&#214;&apos;&lt;/span&gt;);
ttfSubsetter.add(&lt;span class=&quot;code-quote&quot;&gt;&apos;\u200A&apos;&lt;/span&gt;);
ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
ttfSubsetter.writeToStream(baos);
ttfSubsetter.writeToStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;subset.ttf&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;// look at it with DTL OTMaster Light 3.7
&lt;/span&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (TrueTypeFont subset = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TTFParser(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).parse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(baos.toByteArray())))
{
    PostScriptTable pst = subset.getPostScript();
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(Arrays.toString(pst.getGlyphNames()));
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; pst.getGlyphNames().length; ++i)
    {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(i + &lt;span class=&quot;code-quote&quot;&gt;&quot;: &quot;&lt;/span&gt; + pst.getName(i) + &lt;span class=&quot;code-quote&quot;&gt;&quot;, gid: &quot;&lt;/span&gt; + subset.nameToGID(pst.getName(i)));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;  &quot;&lt;/span&gt; + subset.getPath(pst.getName(i)).getBounds2D());
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (subset.getGlyph().getGlyph(i) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;  none&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
        {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;  &quot;&lt;/span&gt; + subset.getGlyph().getGlyph(i).getPath().getBounds2D());
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The output is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[.notdef, O, Odieresis, Dieresis, uni200A]
0: .notdef, gid: 0
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=102.0,y=-362.0,w=1024.0,h=1806.0]
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=102.0,y=-362.0,w=1024.0,h=1806.0]
1: O, gid: 1
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=115.0,y=-29.0,w=1382.0,h=1549.0]
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=115.0,y=-29.0,w=1382.0,h=1549.0]
2: Odieresis, gid: 2
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=115.0,y=-29.0,w=1382.0,h=1899.0]
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=115.0,y=-29.0,w=1382.0,h=1899.0]
3: Dieresis, gid: 3
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=0.0,y=0.0,w=0.0,h=0.0]
  none
4: uni200A, gid: 4
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=-809.0,y=1294.0,w=594.0,h=203.0]
  java.awt.geom.Rectangle2D$&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;[x=-809.0,y=1294.0,w=594.0,h=203.0] 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So Dieresis has no glyph &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;My theory is that the bug is in buildPostTable(), because the rest (glyf, cmap) is correct. I tried generating PDFs and there are no problems.&lt;/p&gt;

&lt;p&gt;The buildPostTable() method works with the GIDs (only those where the names are not part of WGL4Names) in GID order. Here uni200A comes first, and then Dieresis. But when writing the names, it uses the name order and now Dieresis comes first and then uni200A.&lt;/p&gt;

&lt;p&gt;I suspect this was introduced in rev 1645796 in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2565&quot; title=&quot;Subset embedded TTF fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2565&quot;&gt;&lt;del&gt;PDFBOX-2565&lt;/del&gt;&lt;/a&gt; as a refactoring within a bigger commit, to simplify the code. The old code used a list for the names and a map for the gids, the new code used only a name set ordered by names.&lt;/p&gt;

&lt;p&gt;So I&apos;m using a LinkedHashMap, where the iteration order is the insertion order.&lt;/p&gt;</comment>
                            <comment id="15973012" author="jira-bot" created="Tue, 18 Apr 2017 16:30:55 +0000"  >&lt;p&gt;Commit 1791809 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1791809&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1791809&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3757&quot; title=&quot;TTFSubsetter scrambles PostScript names and unicode codepoints when subset contains diaeresis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3757&quot;&gt;&lt;del&gt;PDFBOX-3757&lt;/del&gt;&lt;/a&gt;: use LinkedHashMap instead of TreeMap to iterate in insertion order&lt;/p&gt;</comment>
                            <comment id="15973014" author="jira-bot" created="Tue, 18 Apr 2017 16:31:01 +0000"  >&lt;p&gt;Commit 1791810 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1791810&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1791810&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3757&quot; title=&quot;TTFSubsetter scrambles PostScript names and unicode codepoints when subset contains diaeresis&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3757&quot;&gt;&lt;del&gt;PDFBOX-3757&lt;/del&gt;&lt;/a&gt;: use LinkedHashMap instead of TreeMap to iterate in insertion order&lt;/p&gt;</comment>
                            <comment id="15973062" author="tilman" created="Tue, 18 Apr 2017 16:56:19 +0000"  >&lt;p&gt;There&apos;s a snapshot here:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.6-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.6-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please test your application and give feedback.&lt;/p&gt;</comment>
                            <comment id="15974267" author="tofi86" created="Wed, 19 Apr 2017 07:57:04 +0000"  >&lt;p&gt;Indeed, the Snapshots fixes the problem. Thanks for the quick fix, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt;! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12863793" name="Subset-DejaVuSans__dieresis-scrambled-names.ttf" size="68620" author="tofi86" created="Tue, 18 Apr 2017 10:33:44 +0000"/>
                            <attachment id="12863794" name="Subset-DejaVuSans__scrambled-codepoints.ttf" size="88264" author="tofi86" created="Tue, 18 Apr 2017 10:33:44 +0000"/>
                            <attachment id="12863792" name="fontbox-2.0.5-ttfsubsetter_dieresis-scrambled-names.png" size="18074" author="tofi86" created="Tue, 18 Apr 2017 10:33:44 +0000"/>
                            <attachment id="12863795" name="fontbox-2.0.5-ttfsubsetter_scrambled-codepoints.png" size="55377" author="tofi86" created="Tue, 18 Apr 2017 10:33:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dql3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>