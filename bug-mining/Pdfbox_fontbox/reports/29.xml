<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:48:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1473] Incorrect handling of OpenType fonts</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1473</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;There is embedded font in this PDF which pdfbox/fontbox does not handle properly.&lt;br/&gt;
This OpenType font contains CFF data.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12624591">PDFBOX-1473</key>
            <summary>Incorrect handling of OpenType fonts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="chupacabras">Juraj Lonc</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Dec 2012 08:06:59 +0000</created>
                <updated>Thu, 2 May 2013 02:29:59 +0000</updated>
                            <resolved>Sat, 2 Mar 2013 11:39:36 +0000</resolved>
                                    <version>1.7.1</version>
                                    <fixVersion>1.8.0</fixVersion>
                                    <component>FontBox</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13535769" author="chupacabras" created="Wed, 19 Dec 2012 08:13:25 +0000"  >&lt;p&gt;I made fix in CFFParser so it can properly read CFF data from OpenType font.&lt;/p&gt;</comment>
                            <comment id="13535771" author="chupacabras" created="Wed, 19 Dec 2012 08:15:34 +0000"  >&lt;p&gt;I made enhancement to PDType1CFont so the proper font is selected. OpenType font could contain multiple fonts.&lt;/p&gt;</comment>
                            <comment id="13535777" author="chupacabras" created="Wed, 19 Dec 2012 08:21:41 +0000"  >&lt;p&gt;After applying these patches the font is being loaded and CFF data processed but there is another problem.&lt;/p&gt;

&lt;p&gt;CharStream contains command 27 (hhcurveto) and it seems it has 6 numeric operands. This leads to exception because CharStringConverter.drawCurve() expects 4 or 5 (+n*4) operands.&lt;/p&gt;</comment>
                            <comment id="13535848" author="lehmi" created="Wed, 19 Dec 2012 10:19:19 +0000"  >&lt;p&gt;There are some known issues concerning the CFF parser. Probably yours is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-969&quot; title=&quot;IndexOutOfBound whle creating a Type1C font&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-969&quot;&gt;&lt;del&gt;PDFBOX-969&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13535850" author="chupacabras" created="Wed, 19 Dec 2012 10:28:17 +0000"  >&lt;p&gt;Partly yes.&lt;/p&gt;

&lt;p&gt;I detected 3 problems. I provided patch files for 2 of them.&lt;br/&gt;
The last one equals to mentioned &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-969&quot; title=&quot;IndexOutOfBound whle creating a Type1C font&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-969&quot;&gt;&lt;del&gt;PDFBOX-969&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13535855" author="chupacabras" created="Wed, 19 Dec 2012 10:35:51 +0000"  >&lt;p&gt;I was very brief, my bad.&lt;br/&gt;
Patches I provided solve problem with loading of OpenType font.&lt;br/&gt;
You are expecting that CFF has to be directly there. Which is not true. PDF I atatched has such font. It is necessary to detect OpenType format (OTTO header tag) and then fint CFF tag and use its content.&lt;/p&gt;</comment>
                            <comment id="13535872" author="lehmi" created="Wed, 19 Dec 2012 11:12:33 +0000"  >&lt;p&gt;I got your point right from the start. My guess adresses your remaining issue. So it was my bad to be inaccurately. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll check your patches later when I&apos;m back home.&lt;/p&gt;</comment>
                            <comment id="13535928" author="chupacabras" created="Wed, 19 Dec 2012 13:07:13 +0000"  >&lt;p&gt;I think I found where is the problem.&lt;/p&gt;

&lt;p&gt;It seems that command &quot;hintmask&quot; is incorrectly parsed. It results to incorrect count of hints and that causes that incorrect number of following bytes is read (as part of hintmask operator). And this naturally leads to incorrect parsing of data following the &quot;hintmask&quot;.&lt;/p&gt;

&lt;p&gt;Commands should be parsed in &quot;inline&quot; way, so &quot;callsubr&quot; and &quot;callgsubr&quot; should be &quot;expanded&quot; to the stack before the following data is parsed.&lt;br/&gt;
I am not sure if I explained it understoodable &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13536902" author="chupacabras" created="Thu, 20 Dec 2012 09:52:38 +0000"  >&lt;p&gt;I made fix in parser.&lt;br/&gt;
&quot;callsubr&quot; and &quot;callgsubr&quot; commands are processed directly in parser so parser works with correct count of stems.&lt;/p&gt;

&lt;p&gt;Parser works OK with this modification and CharString is being decoded correctly.&lt;/p&gt;

&lt;p&gt;But I found another bug. OpenType fonts may have CMAP definition (like the one in attached PDF). And this CMAP is not handled/processed. You are expecting that Type1 font cannot have CMAP. This causes that no character is printed/drawed despite font is parsed correctly (now).&lt;/p&gt;</comment>
                            <comment id="13538837" author="lehmi" created="Sat, 22 Dec 2012 15:53:27 +0000"  >&lt;p&gt;I added the PDType1CFont patch in revision 1425301&lt;/p&gt;</comment>
                            <comment id="13538844" author="lehmi" created="Sat, 22 Dec 2012 16:11:50 +0000"  >&lt;p&gt;I added the open type font support in revision 1425304&lt;/p&gt;</comment>
                            <comment id="13538865" author="lehmi" created="Sat, 22 Dec 2012 17:41:07 +0000"  >&lt;p&gt;Can we remove the handling of the &quot;callsubr&quot; and &quot;callgsubr&quot; commands from the CharStringParser (handleTyp1Command() and handleType2Command()) if those are handled inline?&lt;/p&gt;</comment>
                            <comment id="13538870" author="chupacabras" created="Sat, 22 Dec 2012 18:08:27 +0000"  >&lt;p&gt;Yes. But you have to remember that any sequence of operators and operands which comes to CharStringConverter must be already &quot;inflated&quot; (subrs replaced). If there is any subr command in that sequence then exception should be thrown.&lt;br/&gt;
You are right, handling of subr commands in CharStringConverter is obsolete and not necessary.&lt;/p&gt;

&lt;p&gt;If you remove handling of subr commands than CharStringConverter does not need fontGlobalSubrIndex/fontLocalSubrIndex.&lt;/p&gt;

&lt;p&gt;Type1CharStringParser should be fixed the same way.&lt;/p&gt;</comment>
                            <comment id="13539563" author="lehmi" created="Wed, 26 Dec 2012 15:41:17 +0000"  >&lt;p&gt;I added the improved handling of &quot;callsubr&quot; and &quot;callgsubr&quot; commands in revision 1425954 based on Jurajs proposal.&lt;/p&gt;

&lt;p&gt;@Eric and @Guillaume&lt;br/&gt;
I had to adjust the preflight Type1Parser. Please check if everything still works as expected.&lt;/p&gt;</comment>
                            <comment id="13591392" author="lehmi" created="Sat, 2 Mar 2013 11:39:36 +0000"  >&lt;p&gt;It seems that the preflight sutff still works. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Set to resolved.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12500416">PDFBOX-969</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12502692">PDFBOX-992</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12553113">PDFBOX-1298</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12561662" name="CFFParser.patch" size="1918" author="chupacabras" created="Wed, 19 Dec 2012 08:13:25 +0000"/>
                            <attachment id="12561663" name="PDType1CFont.patch" size="820" author="chupacabras" created="Wed, 19 Dec 2012 08:15:34 +0000"/>
                            <attachment id="12561866" name="parsingfix_CFFFont.patch" size="865" author="chupacabras" created="Thu, 20 Dec 2012 09:52:38 +0000"/>
                            <attachment id="12561867" name="parsingfix_Type2CharStringParser.patch" size="5123" author="chupacabras" created="Thu, 20 Dec 2012 09:52:38 +0000"/>
                            <attachment id="12561661" name="redig_test_textAdded.pdf" size="334490" author="chupacabras" created="Wed, 19 Dec 2012 08:08:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>300414</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i16847:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>244447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>