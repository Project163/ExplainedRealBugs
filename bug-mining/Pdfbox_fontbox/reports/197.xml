<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:50:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3267] Using threads results in different images</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3267</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;If i dont use threads images are the same&lt;/p&gt;

&lt;p&gt;java -cp pdf-box-svn/app/target/pdfbox-app-2.0.0-SNAPSHOT.jar:. ComparePDF&lt;br/&gt;
Exception in thread &quot;main&quot; java.io.IOException: Not equals&lt;br/&gt;
	at ComparePDF.main(ComparePDF.java:21)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12949068">PDFBOX-3267</key>
            <summary>Using threads results in different images</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="ssteiner">Simon Steiner</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Mar 2016 12:14:54 +0000</created>
                <updated>Tue, 16 Apr 2019 17:12:35 +0000</updated>
                            <resolved>Mon, 6 Jun 2016 16:39:18 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.2</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15191114" author="tilman" created="Fri, 11 Mar 2016 16:27:14 +0000"  >&lt;p&gt;It worked fine for me a few times. Then I got a concurrent something exception in &lt;tt&gt;ICC_Profile.getInstance&lt;/tt&gt; in PDICCBase.java. As a quick solution, I enclosed this in &lt;tt&gt;synchronized(LOG)&lt;/tt&gt; and it stopped. But I never got a &quot;Not equals&quot;.&lt;/p&gt;

&lt;p&gt;It would be interesting if you&apos;d save the different images and post them here.&lt;/p&gt;

&lt;p&gt;Your polling condition should have an &quot;or&quot; instead of an &quot;and&quot; IMHO. (I got an NPE once)&lt;/p&gt;
</comment>
                            <comment id="15191194" author="ssteiner1" created="Fri, 11 Mar 2016 16:48:26 +0000"  >&lt;p&gt;I also get ICC_Profile.getInstance issues but if i patch that i get not equals exception, im on linux&lt;/p&gt;</comment>
                            <comment id="15192183" author="tilman" created="Sun, 13 Mar 2016 07:43:27 +0000"  >&lt;p&gt;Can you test with a different JVM?&lt;/p&gt;</comment>
                            <comment id="15192924" author="ssteiner1" created="Mon, 14 Mar 2016 08:46:20 +0000"  >&lt;p&gt;I get it on Java 6,7,8&lt;/p&gt;</comment>
                            <comment id="15198498" author="jahewson" created="Thu, 17 Mar 2016 00:48:23 +0000"  >&lt;p&gt;Looking at the different images you posted, my first suspect would be glyph caching inside TTF fonts, because the fonts are shared between threads and it looks like the glyphs are mixed up.&lt;/p&gt;</comment>
                            <comment id="15201772" author="tilman" created="Fri, 18 Mar 2016 16:47:39 +0000"  >&lt;p&gt;Can you try with some older 2.0 builds (e.g. RC1 and earlier), does the effect also happen? I can&apos;t help you myself, because I can&apos;t reproduce it.&lt;/p&gt;</comment>
                            <comment id="15203963" author="ssteiner1" created="Mon, 21 Mar 2016 09:58:33 +0000"  >&lt;p&gt;The problem is introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2262&quot; title=&quot;Remove usage of AWT fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2262&quot;&gt;&lt;del&gt;PDFBOX-2262&lt;/del&gt;&lt;/a&gt;: Improved font fallback for Linux&lt;/p&gt;

&lt;p&gt;git-svn-id: &lt;a href=&quot;https://svn.apache.org/repos/asf/pdfbox/trunk@1621548&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/pdfbox/trunk@1621548&lt;/a&gt; 13f79535-47bb-0310-9956-ffa450edef68&lt;/p&gt;</comment>
                            <comment id="15203992" author="ssteiner1" created="Mon, 21 Mar 2016 10:23:24 +0000"  >&lt;p&gt;If i comment out &quot;charStringCache.put(name, type1);&quot; in Type1Font it works ok&lt;/p&gt;</comment>
                            <comment id="15301966" author="lehmi" created="Thu, 26 May 2016 11:47:39 +0000"  >&lt;p&gt;charStringCache is a ConcurrentHashMap which eliminates some of the possible issues when using more than one thread. But all members of the map have to be implemented thread safe as well and Type1CharString isn&apos;t thread safe. I&apos;ve synchronized the render part in getBounds, getWidth and getPath and everything works as expected, see attached patch.&lt;/p&gt;</comment>
                            <comment id="15301968" author="lehmi" created="Thu, 26 May 2016 11:49:48 +0000"  >&lt;p&gt;On linux there isn&apos;t any TTF font involved but a type1 font. Anyway, your conclusion is true for type1 fonst as well, see my other comment&lt;/p&gt;</comment>
                            <comment id="15302737" author="tilman" created="Thu, 26 May 2016 19:20:45 +0000"  >&lt;p&gt;No problems for me. (But I never had the problem anyway, so you&apos;ll have to wait for Simon)&lt;/p&gt;</comment>
                            <comment id="15303760" author="ssteiner1" created="Fri, 27 May 2016 08:44:30 +0000"  >&lt;p&gt;Seems to work better but ICC_Profile.getInstance sometimes fails&lt;/p&gt;</comment>
                            <comment id="15304331" author="jira-bot" created="Fri, 27 May 2016 16:54:03 +0000"  >&lt;p&gt;Commit 1745774 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1745774&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1745774&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3267&quot; title=&quot;Using threads results in different images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3267&quot;&gt;&lt;del&gt;PDFBOX-3267&lt;/del&gt;&lt;/a&gt;: synchronize render operation for thread safety&lt;/p&gt;</comment>
                            <comment id="15304358" author="jira-bot" created="Fri, 27 May 2016 17:11:17 +0000"  >&lt;p&gt;Commit 1745776 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1745776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1745776&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3267&quot; title=&quot;Using threads results in different images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3267&quot;&gt;&lt;del&gt;PDFBOX-3267&lt;/del&gt;&lt;/a&gt;: use a final mutex&lt;/p&gt;</comment>
                            <comment id="15304359" author="tilman" created="Fri, 27 May 2016 17:11:43 +0000"  >&lt;p&gt;That is a different problem. The workaround is to make such a call in a non parallel way before your real application begins working.&lt;/p&gt;</comment>
                            <comment id="15304373" author="jira-bot" created="Fri, 27 May 2016 17:18:34 +0000"  >&lt;p&gt;Commit 1745779 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1745779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1745779&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3267&quot; title=&quot;Using threads results in different images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3267&quot;&gt;&lt;del&gt;PDFBOX-3267&lt;/del&gt;&lt;/a&gt;: synchronize parts of loadICCProfile as proposed by Tilman Hausherr&lt;/p&gt;</comment>
                            <comment id="15304391" author="jira-bot" created="Fri, 27 May 2016 17:21:06 +0000"  >&lt;p&gt;Commit 1745783 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1745783&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1745783&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3267&quot; title=&quot;Using threads results in different images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3267&quot;&gt;&lt;del&gt;PDFBOX-3267&lt;/del&gt;&lt;/a&gt;: synchronize render operation for thread safety&lt;/p&gt;</comment>
                            <comment id="15304392" author="jira-bot" created="Fri, 27 May 2016 17:21:56 +0000"  >&lt;p&gt;Commit 1745784 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1745784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1745784&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3267&quot; title=&quot;Using threads results in different images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3267&quot;&gt;&lt;del&gt;PDFBOX-3267&lt;/del&gt;&lt;/a&gt;: synchronize parts of loadICCProfile as proposed by Tilman Hausherr&lt;/p&gt;</comment>
                            <comment id="15316731" author="lehmi" created="Mon, 6 Jun 2016 16:39:19 +0000"  >&lt;p&gt;Set to resolved&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12903841">PDFBOX-3015</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12977237">PDFBOX-3374</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13228260">PDFBOX-4514</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12792790" name="ComparePDF.java" size="2146" author="ssteiner" created="Fri, 11 Mar 2016 12:18:15 +0000"/>
                            <attachment id="12806348" name="Type1CharString_sync_patch.txt" size="1217" author="lehmi" created="Thu, 26 May 2016 11:52:31 +0000"/>
                            <attachment id="12792788" name="bmpwithdpi.pdf" size="33870" author="ssteiner" created="Fri, 11 Mar 2016 12:18:15 +0000"/>
                            <attachment id="12792789" name="bmpwithdpi2.pdf" size="33870" author="ssteiner" created="Fri, 11 Mar 2016 12:18:15 +0000"/>
                            <attachment id="12794487" name="syncicc.patch" size="998" author="ssteiner" created="Mon, 21 Mar 2016 09:03:17 +0000"/>
                            <attachment id="12792861" name="t1.png" size="41922" author="ssteiner" created="Fri, 11 Mar 2016 16:44:37 +0000"/>
                            <attachment id="12792862" name="t2.png" size="41871" author="ssteiner" created="Fri, 11 Mar 2016 16:44:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uijz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>