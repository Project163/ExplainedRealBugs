<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:51:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5724] CharStringCommand.equals() does not conform to the contract of Object.equals</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5724</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The equals() method in CharStringCommand breaks the contract of Object.equals(). From the Object.equals() Javadoc:&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The &lt;tt&gt;equals&lt;/tt&gt; method implements an equivalence relation on non-null object references:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;It is &lt;em&gt;reflexive&lt;/em&gt;: for any non-null reference value &lt;tt&gt;x&lt;/tt&gt;, &lt;tt&gt;x.equals&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/tt&gt;&#160;should return &lt;tt&gt;true&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;It is &lt;em&gt;symmetric&lt;/em&gt;: for any non-null reference values &lt;tt&gt;x&lt;/tt&gt; and &lt;tt&gt;y&lt;/tt&gt;, &lt;tt&gt;x.equals&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/tt&gt;&#160;should return &lt;tt&gt;true&lt;/tt&gt; if and only if &lt;tt&gt;y.equals&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/tt&gt;&#160;returns &lt;tt&gt;true&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;It is &lt;em&gt;transitive&lt;/em&gt;: for any non-null reference values &lt;tt&gt;x&lt;/tt&gt;, &lt;tt&gt;y&lt;/tt&gt;, and &lt;tt&gt;z&lt;/tt&gt;, if &lt;tt&gt;x.equals&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/tt&gt;&#160;returns &lt;tt&gt;true&lt;/tt&gt; and &lt;tt&gt;y.equals(z)&lt;/tt&gt; returns &lt;tt&gt;true&lt;/tt&gt;, then &lt;tt&gt;x.equals(z)&lt;/tt&gt; should return &lt;tt&gt;true&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;It is &lt;em&gt;consistent&lt;/em&gt;: for any non-null reference values &lt;tt&gt;x&lt;/tt&gt; and &lt;tt&gt;y&lt;/tt&gt;, multiple invocations of &lt;tt&gt;x.equals&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/tt&gt;&#160;consistently return &lt;tt&gt;true&lt;/tt&gt; or consistently return &lt;tt&gt;false&lt;/tt&gt;, provided no information used in &lt;tt&gt;equals&lt;/tt&gt; comparisons on the objects is modified.&lt;/li&gt;
	&lt;li&gt;For any non-null reference value &lt;tt&gt;x&lt;/tt&gt;, &lt;tt&gt;x.equals(null)&lt;/tt&gt; should return &lt;tt&gt;false&lt;/tt&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;This is the current implementation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; object)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (object &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; CharStringCommand)
        {
            CharStringCommand that = (CharStringCommand) object;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type1KeyWord != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; type1KeyWord == that.getType1KeyWord())
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type2KeyWord != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; type2KeyWord == that.getType2KeyWord())
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type1KeyWord == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; type2KeyWord == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If type1Keyword==null and type2Keyword!=null, true is returned without checking the values of that.getType1Keyword() and that.getType2Keyword().&lt;/p&gt;

&lt;p&gt;Now imagine a has both fields set to null and b has not. Then a.equals(b)==true and b.equals(a)!=true.&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13560337">PDFBOX-5724</key>
            <summary>CharStringCommand.equals() does not conform to the contract of Object.equals</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="axh">Axel Howind</reporter>
                        <labels>
                    </labels>
                <created>Sun, 3 Dec 2023 05:04:04 +0000</created>
                <updated>Thu, 14 Mar 2024 20:57:39 +0000</updated>
                            <resolved>Mon, 4 Dec 2023 07:23:41 +0000</resolved>
                                    <version>3.0.1 PDFBox</version>
                    <version>4.0.0</version>
                                    <fixVersion>3.0.2 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>FontBox</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17792512" author="tilman" created="Sun, 3 Dec 2023 11:16:51 +0000"  >&lt;p&gt;Here&apos;s what netbeans suggests:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; equals(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; == obj)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obj == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getClass() != obj.getClass())
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CharStringCommand other = (CharStringCommand) obj;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.type1KeyWord != other.type1KeyWord)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.type2KeyWord == other.type2KeyWord;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17792626" author="axh" created="Mon, 4 Dec 2023 04:22:47 +0000"  >&lt;p&gt;Yes, since both keywords are enums, the if-block can be simplified to&lt;/p&gt;

&lt;p&gt;&#160; &#160; return that.type1Keyword == type1Keyword &amp;amp;&amp;amp; that.type2Keyword == type2Keyword;&lt;/p&gt;

&lt;p&gt;That would be a correct implementation according to Java contentions. I am just reluctant because whoever wrote the code seemed to have something else on his mind and I don&#8217;t know if there&#8217;s any reason &#160;buried in the pdf spec to consider two instances equal maybe if one only has one of the keywords set. Anyway once equals() is changed, we need to look at hashCode() too.&lt;/p&gt;</comment>
                            <comment id="17792644" author="tilman" created="Mon, 4 Dec 2023 05:56:04 +0000"  >&lt;p&gt;Thanks; here&apos;s what Netbeans suggests for hash:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hashCode()
    {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hash = 7;
        hash = 89 * hash + Objects.hashCode(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.type1KeyWord);
        hash = 89 * hash + Objects.hashCode(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.type2KeyWord);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; hash;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I suspect that both aren&apos;t used at all. I just ran a build with trace on equals() and nothing was shown.&lt;/p&gt;</comment>
                            <comment id="17792658" author="axh" created="Mon, 4 Dec 2023 06:46:59 +0000"  >&lt;p&gt;OK, I&apos;ll try and run some tests and if nothing breaks, create a patch.&lt;/p&gt;</comment>
                            <comment id="17792661" author="axh" created="Mon, 4 Dec 2023 06:59:24 +0000"  >&lt;p&gt;Added patch &quot;fix_CharStringCommand_equals()_and_hashCode().patch&quot;.&lt;/p&gt;

&lt;p&gt;The CharStringCommand class also looks a bit complex if I see how it is used in code. I will have a look, but that would be another ticket.&lt;/p&gt;</comment>
                            <comment id="17792669" author="jira-bot" created="Mon, 4 Dec 2023 07:21:30 +0000"  >&lt;p&gt;Commit 1914311 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1914311&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1914311&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5724&quot; title=&quot;CharStringCommand.equals() does not conform to the contract of Object.equals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5724&quot;&gt;&lt;del&gt;PDFBOX-5724&lt;/del&gt;&lt;/a&gt;: fix equals() and hashCode(), by Axel Howind&lt;/p&gt;</comment>
                            <comment id="17792671" author="jira-bot" created="Mon, 4 Dec 2023 07:21:48 +0000"  >&lt;p&gt;Commit 1914312 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1914312&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1914312&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5724&quot; title=&quot;CharStringCommand.equals() does not conform to the contract of Object.equals&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5724&quot;&gt;&lt;del&gt;PDFBOX-5724&lt;/del&gt;&lt;/a&gt;: fix equals() and hashCode(), by Axel Howind&lt;/p&gt;</comment>
                            <comment id="17792674" author="tilman" created="Mon, 4 Dec 2023 07:23:41 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13064935" name="fix_CharStringCommand_equals()_and_hashCode().patch" size="2137" author="axh" created="Mon, 4 Dec 2023 06:57:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1m060:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>