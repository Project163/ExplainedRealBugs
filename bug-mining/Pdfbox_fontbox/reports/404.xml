<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:51:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5721] The embedded font DroidSansFallbackFull reports an error when parsing, and finally uses lastResortFont, resulting in garbled fonts.</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5721</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;demo&#65306;&lt;/p&gt;

&lt;p&gt;public static void main(String[] args) throws IOException, InterruptedException {&lt;br/&gt;
		File file = new File(&quot;C:\\Users\\LYCIT\\Downloads&lt;br class=&quot;atl-forced-newline&quot; /&gt;CMISG Mutual NDA_Enepath_09Nov23_signed6.pdf&quot;);&lt;br/&gt;
		final PDDocument load = PDDocument.load(file, MemoryUsageSetting.setupTempFileOnly()&lt;br/&gt;
				.setTempDir(new File(&quot;D:\\fcs&lt;br class=&quot;atl-forced-newline&quot; /&gt;test&quot;)));&lt;/p&gt;

&lt;p&gt;		PDFRenderer renderer = new PDFRenderer(load);&lt;br/&gt;
		renderer.setSubsamplingAllowed(true);&lt;br/&gt;
		int pageIndex = 0;&lt;br/&gt;
		float scale = 2f;&lt;br/&gt;
		BufferedImage bufferedImage = renderer.renderImage(pageIndex, scale, ImageType.RGB);&lt;br/&gt;
		FileOutputStream fos = null;&lt;br/&gt;
		try &lt;/p&gt;
{
			fos = new FileOutputStream(new File(&quot;D:\\fcs\\test/test6/image&quot; + pageIndex + &quot;.jpg&quot;));
			ImageIO.write(bufferedImage, &quot;jpg&quot;, fos);
		}
&lt;p&gt; finally {&lt;br/&gt;
			if (fos != null) &lt;/p&gt;
{
				fos.close();
			}
&lt;p&gt;		}&lt;br/&gt;
		Thread.sleep(6000000);&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;pdf&#65306;CMISG Mutual NDA_Enepath_09Nov23_signed6.pdf&lt;/p&gt;

&lt;p&gt;garbled fonts&#65306;image0.jpg&lt;/p&gt;
</description>
                <environment></environment>
        <key id="13559646">PDFBOX-5721</key>
            <summary>The embedded font DroidSansFallbackFull reports an error when parsing, and finally uses lastResortFont, resulting in garbled fonts.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="lycheng">liu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Nov 2023 06:03:50 +0000</created>
                <updated>Thu, 14 Mar 2024 20:57:40 +0000</updated>
                            <resolved>Sun, 7 Jan 2024 13:06:52 +0000</resolved>
                                    <version>2.0.30</version>
                                    <fixVersion>2.0.31</fixVersion>
                    <fixVersion>3.0.2 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>FontBox</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17803937" author="lehmi" created="Sun, 7 Jan 2024 12:06:48 +0000"  >&lt;p&gt;There are two exceptions while opening the mentioned pdf using PDFDebugger &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 Error  [PDFont] Could not read ToUnicode CMap in font DroidSansFallbackFull
    java.io.IOException: java.lang.IllegalArgumentException: The start and the end values must not have different lengths.
	at org.apache.fontbox.cmap.CMapParser.parseBegincodespacerange(CMapParser.java:268)
	at org.apache.fontbox.cmap.CMapParser.parse(CMapParser.java:110)
	at org.apache.pdfbox.pdmodel.font.CMapManager.parseCMap(CMapManager.java:72)
	at org.apache.pdfbox.pdmodel.font.PDFont.readCMap(PDFont.java:220)
	at org.apache.pdfbox.pdmodel.font.PDFont.loadUnicodeCmap(PDFont.java:144)
	at org.apache.pdfbox.pdmodel.font.PDFont.&amp;lt;init&amp;gt;(PDFont.java:113)
	at org.apache.pdfbox.pdmodel.font.PDType0Font.&amp;lt;init&amp;gt;(PDType0Font.java:73)
	at org.apache.pdfbox.pdmodel.font.PDFontFactory.createFont(PDFontFactory.java:96)
	at org.apache.pdfbox.pdmodel.PDResources.getFont(PDResources.java:170)
	at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.SetFontAndSize.process(SetFontAndSize.java:72)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:892)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:530)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:505)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:152)
	at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:285)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:330)
	at org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.doInBackground(PagePane.java:532)
	at org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.doInBackground(PagePane.java:1)
	at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at javax.swing.SwingWorker.run(SwingWorker.java:334)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:750)
Caused by: java.lang.IllegalArgumentException: The start and the end values must not have different lengths.
	at org.apache.fontbox.cmap.CodespaceRange.&amp;lt;init&amp;gt;(CodespaceRange.java:50)
	at org.apache.fontbox.cmap.CMapParser.parseBegincodespacerange(CMapParser.java:264)
	... 23 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Warning  [PDCIDFontType2] Could not read embedded OTF &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; font DroidSansFallbackFull
    java.io.EOFException
	at org.apache.fontbox.ttf.TTFDataStream.readUnsignedShort(TTFDataStream.java:154)
	at org.apache.fontbox.ttf.PostScriptTable.read(PostScriptTable.java:79)
	at org.apache.fontbox.ttf.TrueTypeFont.readTable(TrueTypeFont.java:365)
	at org.apache.fontbox.ttf.TTFParser.parseTables(TTFParser.java:165)
	at org.apache.fontbox.ttf.TTFParser.parse(TTFParser.java:144)
	at org.apache.fontbox.ttf.TTFParser.parse(TTFParser.java:66)
	at org.apache.pdfbox.pdmodel.font.PDCIDFontType2.&amp;lt;init&amp;gt;(PDCIDFontType2.java:123)
	at org.apache.pdfbox.pdmodel.font.PDCIDFontType2.&amp;lt;init&amp;gt;(PDCIDFontType2.java:72)
	at org.apache.pdfbox.pdmodel.font.PDFontFactory.createDescendantFont(PDFontFactory.java:138)
	at org.apache.pdfbox.pdmodel.font.PDType0Font.&amp;lt;init&amp;gt;(PDType0Font.java:97)
	at org.apache.pdfbox.pdmodel.font.PDFontFactory.createFont(PDFontFactory.java:96)
	at org.apache.pdfbox.pdmodel.PDResources.getFont(PDResources.java:170)
	at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.SetFontAndSize.process(SetFontAndSize.java:72)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:892)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:530)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:505)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:152)
	at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:285)
	at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:330)
	at org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.doInBackground(PagePane.java:532)
	at org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.doInBackground(PagePane.java:1)
	at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at javax.swing.SwingWorker.run(SwingWorker.java:334)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:750)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17803945" author="lehmi" created="Sun, 7 Jan 2024 12:28:15 +0000"  >&lt;p&gt;The first exception occurs due to a malformed codespacerange within the font &quot;DroidSansFallbackFull&quot; using the name &quot;KSPF1&quot;. The end value of the codespace range consist of 5 bytes which is wrong&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1 begincodespacerange
&amp;lt;0000&amp;gt; &amp;lt;FFFFF&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17803946" author="tilman" created="Sun, 7 Jan 2024 12:31:35 +0000"  >&lt;p&gt;The font is broken, here&apos;s the left pane of DTL OTMaster, the hmtx and post tables exist but have no content. The right pane exists but it seems to be a subset, but isn&apos;t named like a subset.&lt;/p&gt;

&lt;p&gt;Surprisingly, the rendering problem vanishes if I catch the EOF in the post table. (the EOF is at the beginning, so I&apos;d say it&apos;s graceful)&lt;/p&gt;

&lt;p&gt;I can&apos;t remember why I didn&apos;t write anything when this issue was created; this time I looked at the second exception because in the last few weeks several EOF bugs turned out to be programming errors.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13065778/13065778_image-2024-01-07-13-19-32-380.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17803947" author="jira-bot" created="Sun, 7 Jan 2024 12:36:33 +0000"  >&lt;p&gt;Commit 1915112 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1915112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1915112&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5721&quot; title=&quot;The embedded font DroidSansFallbackFull reports an error when parsing, and finally uses lastResortFont, resulting in garbled fonts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5721&quot;&gt;&lt;del&gt;PDFBOX-5721&lt;/del&gt;&lt;/a&gt;: ignore EOF if it is before just data&lt;/p&gt;</comment>
                            <comment id="17803948" author="jira-bot" created="Sun, 7 Jan 2024 12:36:37 +0000"  >&lt;p&gt;Commit 1915113 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1915113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1915113&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5721&quot; title=&quot;The embedded font DroidSansFallbackFull reports an error when parsing, and finally uses lastResortFont, resulting in garbled fonts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5721&quot;&gt;&lt;del&gt;PDFBOX-5721&lt;/del&gt;&lt;/a&gt;: ignore EOF if it is before just data&lt;/p&gt;</comment>
                            <comment id="17803949" author="jira-bot" created="Sun, 7 Jan 2024 12:36:41 +0000"  >&lt;p&gt;Commit 1915114 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1915114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1915114&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5721&quot; title=&quot;The embedded font DroidSansFallbackFull reports an error when parsing, and finally uses lastResortFont, resulting in garbled fonts.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5721&quot;&gt;&lt;del&gt;PDFBOX-5721&lt;/del&gt;&lt;/a&gt;: ignore EOF if it is before just data&lt;/p&gt;</comment>
                            <comment id="17803955" author="lehmi" created="Sun, 7 Jan 2024 13:05:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; thanks for the fix, looks good to me. I don&apos;t see any fix for the other issue but fortunately it isn&apos;t related to the described rendering issue, so that I&apos;d set this to resolved.&lt;/p&gt;</comment>
                            <comment id="17803956" author="tilman" created="Sun, 7 Jan 2024 13:06:52 +0000"  >&lt;p&gt;Surprisingly, even text extraction works properly, despite the bad syntax.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt;&#160; thanks for the ping and the feedback.&lt;/p&gt;</comment>
                            <comment id="17803962" author="lehmi" created="Sun, 7 Jan 2024 13:37:04 +0000"  >&lt;p&gt;w.r.t. to text extraction the internal cmap mapping from the font is used due to the &quot;missing&quot; toUnicode mapping&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13064732" name="CMISG Mutual NDA_Enepath_09Nov23_signed6.pdf" size="644601" author="lycheng" created="Tue, 28 Nov 2023 06:02:28 +0000"/>
                            <attachment id="13065777" name="droid-bad.ttf" size="4687" author="tilman" created="Sun, 7 Jan 2024 12:17:06 +0000"/>
                            <attachment id="13065778" name="image-2024-01-07-13-19-32-380.png" size="43585" author="tilman" created="Sun, 7 Jan 2024 12:19:32 +0000"/>
                            <attachment id="13064731" name="image0.jpg" size="41952" author="lycheng" created="Tue, 28 Nov 2023 06:03:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1lvwg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>