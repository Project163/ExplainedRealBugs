<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:52:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DELTASPIKE-519] ClassLoader leak in ClassDeactivationUtils</title>
                <link>https://issues.apache.org/jira/browse/DELTASPIKE-519</link>
                <project id="12312820" key="DELTASPIKE">DeltaSpike</project>
                    <description>&lt;p&gt;ClassDeactivationUtils statically holds two maps (classDeactivatorMap, activationStatusCache) one having a classloader as key and the other a class. These entries are never removed resulting in leaks of the TCCL or the classloaders of Deactivatable classes if they do not equal the classloader loading deltaspike.&lt;/p&gt;

&lt;p&gt;Suggested fix:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/**
     * This Map holds the &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; as first level to make it possible to have different configurations per 
     * WebApplication in an EAR or other Multi-&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; scenario.
     * 
     * The Map then contains a List of {@link ClassDeactivator}s in order of their configured ordinal.
     */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;, List&amp;lt;ClassDeactivator&amp;gt;&amp;gt; classDeactivatorMap
        = Collections.synchronizedMap(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WeakHashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;, List&amp;lt;ClassDeactivator&amp;gt;&amp;gt;());

    /**
     * Cache &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the result. It won&apos;t contain many classes but it might be accessed frequently.
     * Valid entries are only &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; or &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;. If an entry isn&apos;t available or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, it gets calculated.
     */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Deactivatable&amp;gt;, &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;&amp;gt; activationStatusCache
        = Collections.synchronizedMap(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WeakHashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Deactivatable&amp;gt;, &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;&amp;gt;());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12693878">DELTASPIKE-519</key>
            <summary>ClassLoader leak in ClassDeactivationUtils</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="mbechler">Moritz Bechler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Feb 2014 12:52:22 +0000</created>
                <updated>Mon, 18 May 2020 14:35:06 +0000</updated>
                            <resolved>Mon, 18 May 2020 14:35:06 +0000</resolved>
                                    <version>0.5</version>
                                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13894475" author="romain.manni-bucau" created="Fri, 7 Feb 2014 12:55:10 +0000"  >&lt;p&gt;I think we have it for BeanManagerProvider too. We spoke about having a map store in the classloader (using Unsafe), it could do the trick and would avoid the need to track classloaders&lt;/p&gt;</comment>
                            <comment id="13894507" author="mbechler" created="Fri, 7 Feb 2014 13:34:17 +0000"  >&lt;p&gt;Did not see this one during memory debugging and it seems that BeanManagerProvider is cleaning the map at&lt;br/&gt;
BeanManagerProvider.cleanupStoredBeanManagerOnShutdown(@Observes BeforeShutdown beforeShutdown)&lt;br/&gt;
which looks fine as long as the CDI context lifecycle is shorter or equal to the TCCLs (I don&apos;t think there can be a practical setup where this is not the case) and the event is guaranteed to be properly delivered (I don&apos;t know about that). Patching the instances into the classloader sounds a bit harsh to me and might cause other troubles. Afaik, using a WeakHashMap should be just fine.&lt;/p&gt;</comment>
                            <comment id="13894508" author="romain.manni-bucau" created="Fri, 7 Feb 2014 13:36:36 +0000"  >&lt;p&gt;excepted startup loader and runtime/shutdown loader can be different&lt;/p&gt;</comment>
                            <comment id="17110347" author="jira-bot" created="Mon, 18 May 2020 14:35:02 +0000"  >&lt;p&gt;Commit d826c9686ca85a79b4e8f52beda4ab78b38bb680 in deltaspike&apos;s branch refs/heads/master from Mark Struberg&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=deltaspike.git;h=d826c96&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=deltaspike.git;h=d826c96&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/DELTASPIKE-519&quot; title=&quot;ClassLoader leak in ClassDeactivationUtils&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DELTASPIKE-519&quot;&gt;&lt;del&gt;DELTASPIKE-519&lt;/del&gt;&lt;/a&gt; fix potential ClassLoader leak&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372387</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s6cv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>