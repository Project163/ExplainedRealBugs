<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:52:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DELTASPIKE-648] @ConfigProperty in Wildfly 8.1 not working correctly</title>
                <link>https://issues.apache.org/jira/browse/DELTASPIKE-648</link>
                <project id="12312820" key="DELTASPIKE">DeltaSpike</project>
                    <description>&lt;p&gt;I am not quite sure if my problem is related to the (already closed) &lt;a href=&quot;https://issues.apache.org/jira/browse/DELTASPIKE-451&quot; title=&quot; Using @ConfigProperty in an EAR File on JBoss 7 fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DELTASPIKE-451&quot;&gt;&lt;del&gt;DELTASPIKE-451&lt;/del&gt;&lt;/a&gt;, but it is quite similar in behavior:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I have an EAR file that packages a few EJB jars (these are NOT contained in the lib directory of the EAR)&lt;/li&gt;
	&lt;li&gt;the application.xml uses the default isolation mechanism, which means that all libs in /lib have access to all classes (although I don&apos;t think this is relevant in my case since my EJB jars are not located in /lib)&lt;/li&gt;
	&lt;li&gt;inside one of the EJB jars I put a property file that should be used ONLY by beans inside this jar file&lt;/li&gt;
	&lt;li&gt;I created an implementation of PropertyFileConfig and provided the path to this property file&lt;/li&gt;
	&lt;li&gt;during startup I can see that the property file is correctly detected and stored in the hashmap using the EAR classloader&lt;/li&gt;
	&lt;li&gt;I have a bean (@Singleton, @Startup) inside the aforementioned EJB jar that expects a property to be injected via @Inject @ConfigProperty - which does not work&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I debugged the startup process and detected that the property injection into the bean fails because the lookup into the hashmap will not be done with the EAR classloader, but with the jar&apos;s classloader, which is totally understandable. What I do not understand, however, is, why the resolution process which kicks in afterwards does no longer find my PropertyFileConfig implementation, which worked in the EAR classloader case.&lt;/p&gt;

&lt;p&gt;My temporary solution now is to put a META-INF/services/org.apache.deltaspike.core.spi.config.ConfigSourceProvider file into the EJB jar and reference a custom ConfigSourceProvider. This file is always picked up correctly (interestingly in both cases, the EAR classloader and the jar classloader).&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t the ConfigResolver pick up my PropertyFileConfig implementation in both cases as well?&lt;/p&gt;</description>
                <environment>Mac OS X 10.9, Java 1.7.45, Wildfly 8.1</environment>
        <key id="12723572">DELTASPIKE-648</key>
            <summary>@ConfigProperty in Wildfly 8.1 not working correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="spanko">Sven Panko</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jun 2014 06:53:46 +0000</created>
                <updated>Sun, 8 Mar 2015 19:56:56 +0000</updated>
                            <resolved>Mon, 2 Mar 2015 12:25:47 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                                    <component>Configuration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14043230" author="gpetracek" created="Wed, 25 Jun 2014 09:12:10 +0000"  >&lt;p&gt;changed to minor, because there is a workaround&lt;/p&gt;</comment>
                            <comment id="14054363" author="rafabene" created="Tue, 8 Jul 2014 01:07:14 +0000"  >&lt;p&gt;The Attached file replaces &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; currentClassLoader = ClassUtils.getClassLoader(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;by&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt; currentClassLoader = ConfigResolver.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getClassLoader();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is due because ClassUtils#getClassLoader returns the ContextClassLoader of the current Thread first. ConfigResolver should always get the same ClassLoader when inside the same EAR&lt;/p&gt;
</comment>
                            <comment id="14055327" author="rafabene" created="Tue, 8 Jul 2014 19:05:49 +0000"  >&lt;p&gt;Tests added to check WAR and EAR utilisation... &lt;/p&gt;</comment>
                            <comment id="14057965" author="rafabene" created="Thu, 10 Jul 2014 21:12:07 +0000"  >&lt;p&gt;Fixed: &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=deltaspike.git;a=commit;h=750d11e163398066dc9f99ce43f486fe71dd5398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=deltaspike.git;a=commit;h=750d11e163398066dc9f99ce43f486fe71dd5398&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14301195" author="struberg" created="Mon, 2 Feb 2015 12:13:40 +0000"  >&lt;p&gt;The problem is that this change trashed every other application server.&lt;/p&gt;

&lt;p&gt;ConfigResolver is now broken on WAS, TomEE, Glassfish,  etc&lt;/p&gt;

&lt;p&gt;The reason for taking the current TCCL is that this is the BeanManager which is used to start the config. using the ConfigResolver.class.ClassLoader breaks every application which uses different config per webapp. It also breaks addConfigResolvers as they leak over into other webapps.&lt;/p&gt;

&lt;p&gt;I will revert this change.&lt;/p&gt;</comment>
                            <comment id="14301209" author="struberg" created="Mon, 2 Feb 2015 12:30:38 +0000"  >&lt;p&gt;Raphael, I like to understand what the real issues have been. With using ConfigResolver.class.getClassLoader() we basically ditch the whole Map&amp;lt;ClassLoader,..&amp;gt; Thus you end up having exactly one config per server. Which is a bit narrow &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14302571" author="rafabene" created="Tue, 3 Feb 2015 00:41:06 +0000"  >&lt;p&gt;I tried the revert and obviously it broke the WildFly implementation. I&apos;m not sure how we should deal with it or just leave it (as it only happens for EARs and they aren&apos;t fully supported anyway). &lt;/p&gt;</comment>
                            <comment id="14302960" author="gpetracek" created="Tue, 3 Feb 2015 08:43:26 +0000"  >&lt;p&gt;@mark:&lt;br/&gt;
i don&apos;t doubt what you wrote, however, we need a test for it.&lt;br/&gt;
after your revert ConfigPropertyEARTest#testInjectConfig is failing with as7/wf8.&lt;br/&gt;
-&amp;gt; please create a test-ear with 2 web-apps which use different configs otherwise we depend on manual tests for it.&lt;/p&gt;

&lt;p&gt;in general:&lt;br/&gt;
since classloading can be changed in some ee-servers, we will never get an approach which works in any case (without optional config).&lt;br/&gt;
-&amp;gt; we have to think about a ClassLoaderStrategy used e.g. by ClassUtils.&lt;/p&gt;</comment>
                            <comment id="14329112" author="majson" created="Fri, 20 Feb 2015 16:17:08 +0000"  >&lt;p&gt;Hi guys, this bug hurts us a lot at the moment. With latest build from develop it&apos;s obviously gone. Is there a plan for a 1.2.2 release anytime soon?&lt;/p&gt;</comment>
                            <comment id="14329146" author="johndament" created="Fri, 20 Feb 2015 16:44:20 +0000"  >&lt;p&gt;do you think we really need to support wildfly 8.0 at this point? what about AS7, or it&apos;ll be an issue w/ the EAP builds?&lt;/p&gt;</comment>
                            <comment id="14329165" author="majson" created="Fri, 20 Feb 2015 17:03:15 +0000"  >&lt;p&gt;It&apos;s not about the &quot;fix&quot; nor support of WF 8.1, &quot;actual fix&quot; introduced the regression which Mark reverted and it is already pushed to master branch.&lt;/p&gt;</comment>
                            <comment id="14329167" author="struberg" created="Fri, 20 Feb 2015 17:03:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=johndament&quot; class=&quot;user-hover&quot; rel=&quot;johndament&quot;&gt;johndament&lt;/a&gt;]&lt;br/&gt;
I fear all JBoss containers are broken with EARs. This problem is actually not a fault of DeltaSpike to be honest. But I think we still need to support it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=majson&quot; class=&quot;user-hover&quot; rel=&quot;majson&quot;&gt;majson&lt;/a&gt; &lt;br/&gt;
I was working like mad on this for the last week or so. You might probably already have read the blog I wrote about the various containers and how they work&lt;br/&gt;
&lt;a href=&quot;https://struberg.wordpress.com/2015/02/18/cdi-in-ears/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://struberg.wordpress.com/2015/02/18/cdi-in-ears/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also wrote a smallish EAR which just logs out a bit of information about ClassLoaders, TCCL, scanned beans, etc&lt;br/&gt;
&lt;a href=&quot;https://github.com/struberg/cdi-ear-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/struberg/cdi-ear-test&lt;/a&gt;&lt;br/&gt;
If you let this run on WildFly or JBossAS then you will quickly see the issue. The Extension from WAR1 will also get fed with the classes from WAR2 and the other way around. If you have an Extension only in the EAR-lib it will automatically pick up the classes from ALL WARs as well. Thus our Set&amp;lt;Class&amp;lt;? extends ConfigSourceProvider&amp;gt;&amp;gt; might contain classes which you actually MUST NOT SEE. &lt;/p&gt;

&lt;p&gt;I&apos;m still trying to get my head around it and I have the gut feeling that I might have found a pretty generic solution for this issue. But I still need to test this out on various servers.&lt;/p&gt;</comment>
                            <comment id="14329189" author="struberg" created="Fri, 20 Feb 2015 17:14:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=majson&quot; class=&quot;user-hover&quot; rel=&quot;majson&quot;&gt;majson&lt;/a&gt; The problem is that the original &apos;fix&apos; reduced DeltaSpike to run exactly with the very same single Configuration for the WHOLE SERVER. Of course this fixed the sample and probably your project (if you just use DS config in one app and no modules) but it broken tons of other projects/applications.&lt;/p&gt;</comment>
                            <comment id="14329202" author="majson" created="Fri, 20 Feb 2015 17:20:00 +0000"  >&lt;p&gt;That&apos;s exactly the problem we are facing now with single config for all the apps. If we run using 1.2.2-SNAPSHOT everything works fine for us. We have couple of applications packaged in EARs on JBoss EAP 6.&lt;/p&gt;</comment>
                            <comment id="14329232" author="struberg" created="Fri, 20 Feb 2015 17:37:58 +0000"  >&lt;p&gt;Can you do me a favor and run the cdi-ear-test sample on JBossEAP6 and copy to result to pastie or gist? That would help us to get more info about Extensions are handled in EARs in this container - txs!&lt;/p&gt;</comment>
                            <comment id="14329423" author="majson" created="Fri, 20 Feb 2015 19:38:11 +0000"  >&lt;p&gt;There you go &lt;a href=&quot;https://gist.github.com/bartoszmajsak/fe173fc2e3a652e6bd1d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/bartoszmajsak/fe173fc2e3a652e6bd1d&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you need other versions of EAP I can also provide you logs from these environments.&lt;/p&gt;

&lt;p&gt;And now to the original question &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; When do you plan to release 1.2.2? &lt;/p&gt;</comment>
                            <comment id="14343114" author="struberg" created="Mon, 2 Mar 2015 12:25:47 +0000"  >&lt;p&gt;finally fixed. You need to configure the PropertyFileConfig via java.util.ServiceLoader for EARs on some containers.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/DELTASPIKE-837&quot; title=&quot;PropertyFileConfig pickup via java.util.ServiceLoader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DELTASPIKE-837&quot;&gt;&lt;del&gt;DELTASPIKE-837&lt;/del&gt;&lt;/a&gt; for more info.&lt;/p&gt;</comment>
                            <comment id="14350265" author="johndament" created="Fri, 6 Mar 2015 12:04:04 +0000"  >&lt;p&gt;Any idea why this is fix for 1.3.1 instead of 1.3.0? Looks like its in the 1.3.0 code base.&lt;/p&gt;</comment>
                            <comment id="14350276" author="struberg" created="Fri, 6 Mar 2015 12:25:40 +0000"  >&lt;p&gt;weird, checking the history gerhard clearly did set the fixed version to 1.3.0 4 days ago. Changed it back to 1.3.0 now - txs!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12776798">DELTASPIKE-837</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12654652" name="DELTASPIKE-648.patch" size="13012" author="rafabene" created="Tue, 8 Jul 2014 19:16:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401757</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x5i7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>