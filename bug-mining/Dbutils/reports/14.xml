<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:49:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DBUTILS-77] &quot;drop view&quot; does not work from QueryRunner.update with SQLServer JDBC drivers.  Same SQL works with a PreparedStatement just fine.</title>
                <link>https://issues.apache.org/jira/browse/DBUTILS-77</link>
                <project id="12310470" key="DBUTILS">Commons DbUtils</project>
                    <description></description>
                <environment>&lt;p&gt;Java environment: Java 6 on Redhat Linux&lt;br/&gt;
Database enviroment: SQLServer 2008&lt;/p&gt;</environment>
        <key id="12514121">DBUTILS-77</key>
            <summary>&quot;drop view&quot; does not work from QueryRunner.update with SQLServer JDBC drivers.  Same SQL works with a PreparedStatement just fine.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="eakerma">Michael Akerman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jul 2011 20:18:39 +0000</created>
                <updated>Mon, 21 Nov 2011 16:02:20 +0000</updated>
                            <resolved>Mon, 21 Nov 2011 16:02:20 +0000</resolved>
                                    <version>1.3</version>
                                    <fixVersion>1.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13072629" author="wspeirs" created="Fri, 29 Jul 2011 00:46:27 +0000"  >&lt;p&gt;Are you seeing any exceptions?&lt;/p&gt;</comment>
                            <comment id="13147953" author="bayard" created="Thu, 10 Nov 2011 19:35:21 +0000"  >&lt;p&gt;Seems like a great one to get released in the next one. Michael - are you still around and able to provide any more info?&lt;/p&gt;</comment>
                            <comment id="13149673" author="eakerma" created="Mon, 14 Nov 2011 15:15:50 +0000"  >&lt;p&gt;Yes, I&apos;ll recreate it and see what I can report.  I don&apos;t recall exceptions, I think it was an error code.&lt;/p&gt;</comment>
                            <comment id="13149690" author="eakerma" created="Mon, 14 Nov 2011 15:36:51 +0000"  >&lt;p&gt;Yes, sorry there was an exception:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.sql.SQLException: com.microsoft.sqlserver.jdbc.SQLServerException: Unable to identify the table drop view sqlapps.rso_current_person for the metadata. Query: drop view sqlapps.rso_current_person Parameters: []&lt;br/&gt;
        at org.apache.commons.dbutils.QueryRunner.rethrow(QueryRunner.java:540)&lt;br/&gt;
        at org.apache.commons.dbutils.QueryRunner.update(QueryRunner.java:597)&lt;/p&gt;</comment>
                            <comment id="13149692" author="eakerma" created="Mon, 14 Nov 2011 15:38:19 +0000"  >&lt;p&gt;Here&apos;s the code that fails to run the SQL for me:&lt;/p&gt;

&lt;p&gt;			final QueryRunner qr = new QueryRunner();&lt;br/&gt;
			final int rows = qr.update( con, sql, args );&lt;br/&gt;
			return rows;&lt;/p&gt;

&lt;p&gt;Here&apos;s code that works:&lt;br/&gt;
			final PreparedStatement psm = con.prepareStatement( sql );&lt;br/&gt;
			for ( int i=1; i &amp;lt;= args.length; i++ )&lt;/p&gt;
			{
				psm.setString( i, args[i].toString() );
			}
&lt;p&gt;			int rows = psm.executeUpdate();&lt;br/&gt;
			psm.close();&lt;br/&gt;
			return rows;&lt;/p&gt;</comment>
                            <comment id="13149698" author="eakerma" created="Mon, 14 Nov 2011 15:48:15 +0000"  >&lt;p&gt;The first stack trace was from the 1.2 version.  Here&apos;s the stack trace from 1.4.&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.sql.SQLException: com.microsoft.sqlserver.jdbc.SQLServerException: Unable to identify the table drop view sqlapps.rso_current_person for the metadata. Query: drop view sqlapps.rso_current_person Parameters: []&lt;br/&gt;
        at org.apache.commons.dbutils.AbstractQueryRunner.rethrow(AbstractQueryRunner.java:320)&lt;br/&gt;
        at org.apache.commons.dbutils.QueryRunner.update(QueryRunner.java:489)&lt;br/&gt;
        at org.apache.commons.dbutils.QueryRunner.update(QueryRunner.java:402)&lt;br/&gt;
        at edu.uark.util.ConnectionUtils.execute(ConnectionUtils.java:64)&lt;br/&gt;
        at edu.uark.util.queryrunner.Main.main(Main.java:64)&lt;/p&gt;</comment>
                            <comment id="13149705" author="eakerma" created="Mon, 14 Nov 2011 15:56:58 +0000"  >&lt;p&gt;Here is the inner SQLException:&lt;br/&gt;
com.microsoft.sqlserver.jdbc.SQLServerException: com.microsoft.sqlserver.jdbc.SQLServerException: Unable to identify the table drop view sqlapps.rso_current_person for the metadata.&lt;br/&gt;
	at com.microsoft.sqlserver.jdbc.SQLServerException.makeFromDriverError(SQLServerException.java:171)&lt;br/&gt;
	at com.microsoft.sqlserver.jdbc.SQLServerParameterMetaData.(SQLServerParameterMetaData.java:426)&lt;br/&gt;
	at com.microsoft.sqlserver.jdbc.SQLServerPreparedStatement.getParameterMetaData(SQLServerPreparedStatement.java:1510)&lt;br/&gt;
	at org.apache.commons.dbutils.AbstractQueryRunner.fillStatement(AbstractQueryRunner.java:172)&lt;br/&gt;
	at org.apache.commons.dbutils.QueryRunner.update(QueryRunner.java:485)&lt;br/&gt;
	at org.apache.commons.dbutils.QueryRunner.update(QueryRunner.java:402)&lt;br/&gt;
	at edu.uark.util.ConnectionUtils.execute(ConnectionUtils.java:66)&lt;br/&gt;
	at edu.uark.util.queryrunner.Main.main(Main.java:64)&lt;/p&gt;</comment>
                            <comment id="13149718" author="wspeirs" created="Mon, 14 Nov 2011 16:19:11 +0000"  >&lt;p&gt;Michael, can you try it again but construct QueryRunner as follows: QueryRunner(true);&lt;/p&gt;

&lt;p&gt;The line which is causing the exception is an attempt to get meta data: stmt.getParameterMetaData(); using the QueryRunner(true) constructor will prevent this code from being run. Thanks...&lt;/p&gt;</comment>
                            <comment id="13149726" author="eakerma" created="Mon, 14 Nov 2011 16:33:51 +0000"  >&lt;p&gt;			final QueryRunner qr = new QueryRunner(true);&lt;/p&gt;

&lt;p&gt;Solves the problem.  However this doesn&apos;t match the documentation of what that feature is meant for.&lt;/p&gt;

&lt;p&gt;Also, I think we might need:&lt;br/&gt;
catch (SQLException e) &lt;/p&gt;
{
                            pmdKnownBroken = true;
                       }

&lt;p&gt;In AbstractQueryRunner.java somewhere around line 172.&lt;/p&gt;</comment>
                            <comment id="13149730" author="wspeirs" created="Mon, 14 Nov 2011 16:41:29 +0000"  >&lt;p&gt;Agreed, the documentation should be updated to better explain what the &quot;workaround&quot; is actually doing, and that other JDBC Drivers might want to use it as well.&lt;/p&gt;

&lt;p&gt;I wouldn&apos;t rush to add that line to AbstractQueryRunner however. If you have a bad SQL statement, you&apos;ll be turning off the use of getParameterMetaData() when it might actually be useful with later requests.&lt;/p&gt;

&lt;p&gt;I&apos;d propose only an update to documentation for this one...&lt;/p&gt;</comment>
                            <comment id="13150525" author="wspeirs" created="Tue, 15 Nov 2011 14:39:06 +0000"  >&lt;p&gt;Updated documentation to better explain what the pmdKnownBroken parameter does&lt;/p&gt;</comment>
                            <comment id="13154266" author="wspeirs" created="Mon, 21 Nov 2011 16:02:20 +0000"  >&lt;p&gt;Documentation change submitted in r1204562.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12503744" name="DBUTILS-77v1.diff" size="7293" author="wspeirs" created="Tue, 15 Nov 2011 14:39:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uwuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178464</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>