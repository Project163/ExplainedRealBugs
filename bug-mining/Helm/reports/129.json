{"url":"https://api.github.com/repos/helm/helm/issues/30622","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/30622/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/30622/comments","events_url":"https://api.github.com/repos/helm/helm/issues/30622/events","html_url":"https://github.com/helm/helm/issues/30622","id":2897791677,"node_id":"I_kwDOApspmc6suMq9","number":30622,"title":"--take-ownership does not adopt custom resources","user":{"login":"p-se","id":9606095,"node_id":"MDQ6VXNlcjk2MDYwOTU=","avatar_url":"https://avatars.githubusercontent.com/u/9606095?v=4","gravatar_id":"","url":"https://api.github.com/users/p-se","html_url":"https://github.com/p-se","followers_url":"https://api.github.com/users/p-se/followers","following_url":"https://api.github.com/users/p-se/following{/other_user}","gists_url":"https://api.github.com/users/p-se/gists{/gist_id}","starred_url":"https://api.github.com/users/p-se/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/p-se/subscriptions","organizations_url":"https://api.github.com/users/p-se/orgs","repos_url":"https://api.github.com/users/p-se/repos","events_url":"https://api.github.com/users/p-se/events{/privacy}","received_events_url":"https://api.github.com/users/p-se/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":778135666,"node_id":"MDU6TGFiZWw3NzgxMzU2NjY=","url":"https://api.github.com/repos/helm/helm/labels/bug","name":"bug","color":"e11d21","default":true,"description":"Categorizes issue or PR as related to a bug."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2025-03-05T16:21:20Z","updated_at":"2025-04-17T15:54:12Z","closed_at":"2025-04-17T15:54:12Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"If a resource exists in the cluster and is to be adopted by `helm install --take-ownership`, it is left unchanged while helm reports the installation to have succeeded.\n\n# Reproduce\n\n0. Helm version v3.17.1+g980d8ac\n\n1. Install any CRD\n\n```yaml\napiVersion: apiextensions.k8s.io/v1\nkind: CustomResourceDefinition\nmetadata:\n  name: datas.crd.com\nspec:\n  group: crd.com\n  scope: Namespaced\n  names:\n    plural: datas\n    singular: data\n    kind: Data\n  versions:\n  - name: v1\n    served: true\n    storage: true\n    schema:\n      openAPIV3Schema:\n        type: object\n        x-kubernetes-preserve-unknown-fields: true\n```\n\n2. Apply a custom resource onto the cluster.\n\n```yaml\nkind: Data\napiVersion: crd.com/v1\nmetadata:\n  name: crd-test\n  namespace: kube-system\n  labels:\n    test: adopt\nspec:\n  color: blue\n  size: large\n```\n\n3. `helm install --take-ownership` a chart that contains a different version of the custom resource.\n\n```yaml\nkind: Data\napiVersion: crd.com/v1\nmetadata:\n  name: crd-test\n  namespace: kube-system\n  labels:\n    test: adopt\nspec:\n  weight: heavy\n```\n\n4. Notice that the custom resource has not changed at all (still at initial state) but helm reported the operation to have succeeded, including the creation of a helm release.\n\n```\nhelm install foo ./foo --take-ownership \nNAME: foo\nLAST DEPLOYED: Wed Mar  5 17:10:16 2025\nNAMESPACE: default\nSTATUS: deployed\nREVISION: 1\nTEST SUITE: None\n```\n\n# Suggested Solution\n\nTransparently use three-way merge for `--take-ownership`.","closed_by":{"login":"scottrigby","id":407675,"node_id":"MDQ6VXNlcjQwNzY3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/407675?v=4","gravatar_id":"","url":"https://api.github.com/users/scottrigby","html_url":"https://github.com/scottrigby","followers_url":"https://api.github.com/users/scottrigby/followers","following_url":"https://api.github.com/users/scottrigby/following{/other_user}","gists_url":"https://api.github.com/users/scottrigby/gists{/gist_id}","starred_url":"https://api.github.com/users/scottrigby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottrigby/subscriptions","organizations_url":"https://api.github.com/users/scottrigby/orgs","repos_url":"https://api.github.com/users/scottrigby/repos","events_url":"https://api.github.com/users/scottrigby/events{/privacy}","received_events_url":"https://api.github.com/users/scottrigby/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helm/helm/issues/30622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/30622/timeline","performed_via_github_app":null,"state_reason":"completed"}