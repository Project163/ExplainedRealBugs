{"url":"https://api.github.com/repos/helm/helm/issues/9145","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/9145/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/9145/comments","events_url":"https://api.github.com/repos/helm/helm/issues/9145/events","html_url":"https://github.com/helm/helm/issues/9145","id":770350838,"node_id":"MDU6SXNzdWU3NzAzNTA4Mzg=","number":9145,"title":"action.Upgrade and action.Rollback create a new release, even if cleanup of least-recent release versions fails","user":{"login":"dlipovetsky","id":3445370,"node_id":"MDQ6VXNlcjM0NDUzNzA=","avatar_url":"https://avatars.githubusercontent.com/u/3445370?v=4","gravatar_id":"","url":"https://api.github.com/users/dlipovetsky","html_url":"https://github.com/dlipovetsky","followers_url":"https://api.github.com/users/dlipovetsky/followers","following_url":"https://api.github.com/users/dlipovetsky/following{/other_user}","gists_url":"https://api.github.com/users/dlipovetsky/gists{/gist_id}","starred_url":"https://api.github.com/users/dlipovetsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlipovetsky/subscriptions","organizations_url":"https://api.github.com/users/dlipovetsky/orgs","repos_url":"https://api.github.com/users/dlipovetsky/repos","events_url":"https://api.github.com/users/dlipovetsky/events{/privacy}","received_events_url":"https://api.github.com/users/dlipovetsky/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":778135666,"node_id":"MDU6TGFiZWw3NzgxMzU2NjY=","url":"https://api.github.com/repos/helm/helm/labels/bug","name":"bug","color":"e11d21","default":true,"description":"Categorizes issue or PR as related to a bug."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-12-17T20:37:27Z","updated_at":"2021-02-19T16:54:29Z","closed_at":"2021-02-19T16:54:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"`action.Upgrade` and `action.Rollback` allow the caller to define a maximum number of releases versions to keep, and attempt to cleanup the least-recent release versions, so that only the maximum number remain.\r\n\r\nThe cleanup can fail, e.g., because the helm client is unable to delete a ConfigMap or Secret for some release version. In that case, an error is returned:\r\nhttps://github.com/helm/helm/blob/c6a00e63ef638c14be5560534c339484e35eb7ba/pkg%2Fstorage%2Fstorage.go#L161\r\n\r\nHowever, the error is _ignored_:\r\nhttps://github.com/helm/helm/blob/c6a00e63ef638c14be5560534c339484e35eb7ba/pkg%2Fstorage%2Fstorage.go#L62-L65\r\n\r\nThe `action.Upgrade` or `action.Rollback` caller has no way of knowing (short of parsing the log to which the helm SDK writes) that an error occurred. If the upgrade or rollback fails, and the caller retries, a new release version will be created, and releases versions will grow without bound.","closed_by":{"login":"mattfarina","id":62991,"node_id":"MDQ6VXNlcjYyOTkx","avatar_url":"https://avatars.githubusercontent.com/u/62991?v=4","gravatar_id":"","url":"https://api.github.com/users/mattfarina","html_url":"https://github.com/mattfarina","followers_url":"https://api.github.com/users/mattfarina/followers","following_url":"https://api.github.com/users/mattfarina/following{/other_user}","gists_url":"https://api.github.com/users/mattfarina/gists{/gist_id}","starred_url":"https://api.github.com/users/mattfarina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattfarina/subscriptions","organizations_url":"https://api.github.com/users/mattfarina/orgs","repos_url":"https://api.github.com/users/mattfarina/repos","events_url":"https://api.github.com/users/mattfarina/events{/privacy}","received_events_url":"https://api.github.com/users/mattfarina/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helm/helm/issues/9145/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/9145/timeline","performed_via_github_app":null,"state_reason":"completed"}