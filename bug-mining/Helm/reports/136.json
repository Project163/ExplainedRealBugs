{"url":"https://api.github.com/repos/helm/helm/issues/7891","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/7891/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/7891/comments","events_url":"https://api.github.com/repos/helm/helm/issues/7891/events","html_url":"https://github.com/helm/helm/issues/7891","id":596627114,"node_id":"MDU6SXNzdWU1OTY2MjcxMTQ=","number":7891,"title":"Post-renderer not receiving chart hook manifests?","user":{"login":"robg","id":89702,"node_id":"MDQ6VXNlcjg5NzAy","avatar_url":"https://avatars.githubusercontent.com/u/89702?v=4","gravatar_id":"","url":"https://api.github.com/users/robg","html_url":"https://github.com/robg","followers_url":"https://api.github.com/users/robg/followers","following_url":"https://api.github.com/users/robg/following{/other_user}","gists_url":"https://api.github.com/users/robg/gists{/gist_id}","starred_url":"https://api.github.com/users/robg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robg/subscriptions","organizations_url":"https://api.github.com/users/robg/orgs","repos_url":"https://api.github.com/users/robg/repos","events_url":"https://api.github.com/users/robg/events{/privacy}","received_events_url":"https://api.github.com/users/robg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":562687520,"node_id":"MDU6TGFiZWw1NjI2ODc1MjA=","url":"https://api.github.com/repos/helm/helm/labels/feature","name":"feature","color":"0052cc","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":54,"created_at":"2020-04-08T14:34:16Z","updated_at":"2025-11-05T22:07:32Z","closed_at":"2025-07-10T16:31:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Output of `helm version`: \r\n\r\n```\r\nversion.BuildInfo{Version:\"v3.1.2\", GitCommit:\"d878d4d45863e42fd5cff6743294a11d28a9abce\", GitTreeState:\"clean\", GoVersion:\"go1.13.8\"}\r\n```\r\n\r\nOutput of `kubectl version`:\r\n\r\n```\r\nClient Version: version.Info{Major:\"1\", Minor:\"17\", GitVersion:\"v1.17.4+k3s1\", GitCommit:\"3eee8ac3a1cf0a216c8a660571329d4bda3bdf77\", GitTreeState:\"clean\", BuildDate:\"2020-03-25T16:13:25Z\", GoVersion:\"go1.13.8\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"17\", GitVersion:\"v1.17.4+k3s1\", GitCommit:\"3eee8ac3a1cf0a216c8a660571329d4bda3bdf77\", GitTreeState:\"clean\", BuildDate:\"2020-03-25T16:13:25Z\", GoVersion:\"go1.13.8\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n```\r\n\r\nI was experimenting with the `--post-renderer` option and a simple chart that includes one pod:\r\n\r\n```\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: post-render-test\r\n  labels:\r\n    # The \"app.kubernetes.io/managed-by\" label is used to track which tool\r\n    # deployed a given chart. It is useful for admins who want to see what\r\n    # releases a particular tool is responsible for.\r\n    app.kubernetes.io/managed-by: {{.Release.Service | quote }}\r\n    # The \"app.kubernetes.io/instance\" convention makes it easy to tie a release\r\n    # to all of the Kubernetes resources that were created as part of that\r\n    # release.\r\n    app.kubernetes.io/instance: {{.Release.Name | quote }}\r\n    app.kubernetes.io/version: {{ .Chart.AppVersion | quote }}\r\n    # This makes it easy to audit chart usage.\r\n    helm.sh/chart: \"{{.Chart.Name}}-{{.Chart.Version}}\"\r\n    values: {{.Values.Name}}\r\nspec:\r\n  # This shows how to use a simple value. This will look for a passed-in value\r\n  # called restartPolicy. If it is not found, it will use the default value.\r\n  # {{default \"Never\" .restartPolicy}} is a slightly optimized version of the\r\n  # more conventional syntax: {{.restartPolicy | default \"Never\"}}\r\n  restartPolicy: {{default \"Never\" .Values.restartPolicy}}\r\n  containers:\r\n  - name: waiter\r\n    image: \"alpine:3.4\"\r\n    command: [\"/bin/sleep\",\"9000\"]\r\n```\r\n\r\nand one pre-install hook:\r\n\r\n```\r\napiVersion: batch/v1\r\nkind: Job\r\nmetadata:\r\n  name: \"{{ .Release.Name }}\"\r\n  labels:\r\n    app.kubernetes.io/managed-by: {{ .Release.Service | quote }}\r\n    app.kubernetes.io/instance: {{ .Release.Name | quote }}\r\n    app.kubernetes.io/version: {{ .Chart.AppVersion | quote }}\r\n    helm.sh/chart: \"{{ .Chart.Name }}-{{ .Chart.Version }}\"\r\n  annotations:\r\n    # This is what defines this resource as a hook. Without this line, the\r\n    # job is considered part of the release.\r\n    \"helm.sh/hook\": pre-install,pre-upgrade\r\n    \"helm.sh/hook-weight\": \"-5\"\r\n    \"helm.sh/hook-delete-policy\": before-hook-creation\r\nspec:\r\n  backoffLimit: 3 # retry this task 3 times\r\n  template:\r\n    metadata:\r\n      name: \"{{ .Release.Name }}\"\r\n      labels:\r\n        app.kubernetes.io/managed-by: {{ .Release.Service | quote }}\r\n        app.kubernetes.io/instance: {{ .Release.Name | quote }}\r\n        helm.sh/chart: \"{{ .Chart.Name }}-{{ .Chart.Version }}\"\r\n    spec:\r\n      restartPolicy: Never\r\n      containers:\r\n      - name: pre-deploy-job\r\n        image: \"alpine:3.4\"\r\n{{- if .Values.predeploy_task.fail }}\r\n        command: [\"/bin/false\"]\r\n{{- else }}\r\n        command: [\"/bin/sleep\",\"{{ default \"10\" .Values.sleepyTime }}\"]\r\n{{- end }}\r\n```\r\n\r\nFor the test, I was using a no-op post-renderer:\r\n\r\n```\r\n#!/bin/bash\r\n\r\ntee --append  <&0 all.yaml\r\n```\r\n\r\nWhen I execute `helm install post-render-test ../chart --post-renderer ./post-renderer --debug --dry-run` I see both the chart hook and the pod manifest in the output, however my post-renderer only captures the pod manifest.\r\n\r\nI've tried this as well with `helm template` with the same results.\r\n\r\nIs this the intended behavior?  I couldn't find anything in the documentation to suggest that hooks would not be included when invoking the post-renderer. ","closed_by":{"login":"scottrigby","id":407675,"node_id":"MDQ6VXNlcjQwNzY3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/407675?v=4","gravatar_id":"","url":"https://api.github.com/users/scottrigby","html_url":"https://github.com/scottrigby","followers_url":"https://api.github.com/users/scottrigby/followers","following_url":"https://api.github.com/users/scottrigby/following{/other_user}","gists_url":"https://api.github.com/users/scottrigby/gists{/gist_id}","starred_url":"https://api.github.com/users/scottrigby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottrigby/subscriptions","organizations_url":"https://api.github.com/users/scottrigby/orgs","repos_url":"https://api.github.com/users/scottrigby/repos","events_url":"https://api.github.com/users/scottrigby/events{/privacy}","received_events_url":"https://api.github.com/users/scottrigby/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helm/helm/issues/7891/reactions","total_count":70,"+1":68,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":2,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/7891/timeline","performed_via_github_app":null,"state_reason":"completed"}