[{"url":"https://api.github.com/repos/helm/helm/issues/comments/568019521","html_url":"https://github.com/helm/helm/issues/7279#issuecomment-568019521","issue_url":"https://api.github.com/repos/helm/helm/issues/7279","id":568019521,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODAxOTUyMQ==","user":{"login":"bacongobbler","id":1360539,"node_id":"MDQ6VXNlcjEzNjA1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1360539?v=4","gravatar_id":"","url":"https://api.github.com/users/bacongobbler","html_url":"https://github.com/bacongobbler","followers_url":"https://api.github.com/users/bacongobbler/followers","following_url":"https://api.github.com/users/bacongobbler/following{/other_user}","gists_url":"https://api.github.com/users/bacongobbler/gists{/gist_id}","starred_url":"https://api.github.com/users/bacongobbler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bacongobbler/subscriptions","organizations_url":"https://api.github.com/users/bacongobbler/orgs","repos_url":"https://api.github.com/users/bacongobbler/repos","events_url":"https://api.github.com/users/bacongobbler/events{/privacy}","received_events_url":"https://api.github.com/users/bacongobbler/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-12-20T17:53:36Z","updated_at":"2019-12-20T17:53:57Z","body":"The docs may be a little misleading here. If the CRD was installed as part of the `crds` directory, then the CRD will not be removed on `helm uninstall`. However, if it was installed as part of the `templates` directory, it is treated as any other resource, and therefore it will be deleted upon removal from the chart. In other words, this is intentional behaviour.\r\n\r\nIf you try installing a chart with the CRD in the `crds` directory first, then try removing it before upgrading, do you see the same behaviour?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/helm/helm/issues/comments/568019521/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bacongobbler","id":1360539,"node_id":"MDQ6VXNlcjEzNjA1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1360539?v=4","gravatar_id":"","url":"https://api.github.com/users/bacongobbler","html_url":"https://github.com/bacongobbler","followers_url":"https://api.github.com/users/bacongobbler/followers","following_url":"https://api.github.com/users/bacongobbler/following{/other_user}","gists_url":"https://api.github.com/users/bacongobbler/gists{/gist_id}","starred_url":"https://api.github.com/users/bacongobbler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bacongobbler/subscriptions","organizations_url":"https://api.github.com/users/bacongobbler/orgs","repos_url":"https://api.github.com/users/bacongobbler/repos","events_url":"https://api.github.com/users/bacongobbler/events{/privacy}","received_events_url":"https://api.github.com/users/bacongobbler/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":2901582517,"node_id":"MDEyOkxhYmVsZWRFdmVudDI5MDE1ODI1MTc=","url":"https://api.github.com/repos/helm/helm/issues/events/2901582517","actor":{"login":"bacongobbler","id":1360539,"node_id":"MDQ6VXNlcjEzNjA1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1360539?v=4","gravatar_id":"","url":"https://api.github.com/users/bacongobbler","html_url":"https://github.com/bacongobbler","followers_url":"https://api.github.com/users/bacongobbler/followers","following_url":"https://api.github.com/users/bacongobbler/following{/other_user}","gists_url":"https://api.github.com/users/bacongobbler/gists{/gist_id}","starred_url":"https://api.github.com/users/bacongobbler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bacongobbler/subscriptions","organizations_url":"https://api.github.com/users/bacongobbler/orgs","repos_url":"https://api.github.com/users/bacongobbler/repos","events_url":"https://api.github.com/users/bacongobbler/events{/privacy}","received_events_url":"https://api.github.com/users/bacongobbler/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2019-12-20T18:17:05Z","label":{"name":"question/support","color":"cc317c"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/helm/helm/issues/comments/568118962","html_url":"https://github.com/helm/helm/issues/7279#issuecomment-568118962","issue_url":"https://api.github.com/repos/helm/helm/issues/7279","id":568118962,"node_id":"MDEyOklzc3VlQ29tbWVudDU2ODExODk2Mg==","user":{"login":"PhilGrayson","id":143456,"node_id":"MDQ6VXNlcjE0MzQ1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/143456?v=4","gravatar_id":"","url":"https://api.github.com/users/PhilGrayson","html_url":"https://github.com/PhilGrayson","followers_url":"https://api.github.com/users/PhilGrayson/followers","following_url":"https://api.github.com/users/PhilGrayson/following{/other_user}","gists_url":"https://api.github.com/users/PhilGrayson/gists{/gist_id}","starred_url":"https://api.github.com/users/PhilGrayson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PhilGrayson/subscriptions","organizations_url":"https://api.github.com/users/PhilGrayson/orgs","repos_url":"https://api.github.com/users/PhilGrayson/repos","events_url":"https://api.github.com/users/PhilGrayson/events{/privacy}","received_events_url":"https://api.github.com/users/PhilGrayson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-12-20T23:02:25Z","updated_at":"2019-12-20T23:02:25Z","body":">If you try installing a chart with the CRD in the crds directory first, then try removing it before upgrading, do you see the same behaviour?\r\n\r\nI do not see the same behaviour. If the chart started with a CRD in the `crds/` directory, Helm does not delete the CRD if the `crds` directory is removed and the release upgrade. Nor does Helm delete the CRD if the release is deleted. This is consistent with the documentation.\r\n\r\nHowever, for charts with CRDs in the `templates/` directory (ie charts prior to Helm 3, or if the chart author did not read the documentation fully and didn't use the `crds/` directory), I can't find a migration path to safety where Helm doesn't delete the CRD.\r\n\r\n> this is intentional behaviour\r\n\r\nThe reasoning for the behaviour makes sense. I do wonder if helm could better handle this case though. For example, the linter rejecting CRDs in `template/` (in the same way resources with `helm.sh/hook: crd-hook` is rejected). If the other idea of skipping Deletes for CRDs is not desired, a note about this case in the documentation would be good. \r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/helm/helm/issues/comments/568118962/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"PhilGrayson","id":143456,"node_id":"MDQ6VXNlcjE0MzQ1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/143456?v=4","gravatar_id":"","url":"https://api.github.com/users/PhilGrayson","html_url":"https://github.com/PhilGrayson","followers_url":"https://api.github.com/users/PhilGrayson/followers","following_url":"https://api.github.com/users/PhilGrayson/following{/other_user}","gists_url":"https://api.github.com/users/PhilGrayson/gists{/gist_id}","starred_url":"https://api.github.com/users/PhilGrayson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PhilGrayson/subscriptions","organizations_url":"https://api.github.com/users/PhilGrayson/orgs","repos_url":"https://api.github.com/users/PhilGrayson/repos","events_url":"https://api.github.com/users/PhilGrayson/events{/privacy}","received_events_url":"https://api.github.com/users/PhilGrayson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"PhilGrayson","id":143456,"node_id":"MDQ6VXNlcjE0MzQ1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/143456?v=4","gravatar_id":"","url":"https://api.github.com/users/PhilGrayson","html_url":"https://github.com/PhilGrayson","followers_url":"https://api.github.com/users/PhilGrayson/followers","following_url":"https://api.github.com/users/PhilGrayson/following{/other_user}","gists_url":"https://api.github.com/users/PhilGrayson/gists{/gist_id}","starred_url":"https://api.github.com/users/PhilGrayson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PhilGrayson/subscriptions","organizations_url":"https://api.github.com/users/PhilGrayson/orgs","repos_url":"https://api.github.com/users/PhilGrayson/repos","events_url":"https://api.github.com/users/PhilGrayson/events{/privacy}","received_events_url":"https://api.github.com/users/PhilGrayson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-01-01T22:02:57Z","updated_at":"2020-01-01T22:02:57Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/helm/helm/issues/7320","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/7320/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/7320/comments","events_url":"https://api.github.com/repos/helm/helm/issues/7320/events","html_url":"https://github.com/helm/helm/pull/7320","id":544403483,"node_id":"MDExOlB1bGxSZXF1ZXN0MzU4NTIxMDgz","number":7320,"title":"Do not delete templated CRDs","user":{"login":"PhilGrayson","id":143456,"node_id":"MDQ6VXNlcjE0MzQ1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/143456?v=4","gravatar_id":"","url":"https://api.github.com/users/PhilGrayson","html_url":"https://github.com/PhilGrayson","followers_url":"https://api.github.com/users/PhilGrayson/followers","following_url":"https://api.github.com/users/PhilGrayson/following{/other_user}","gists_url":"https://api.github.com/users/PhilGrayson/gists{/gist_id}","starred_url":"https://api.github.com/users/PhilGrayson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PhilGrayson/subscriptions","organizations_url":"https://api.github.com/users/PhilGrayson/orgs","repos_url":"https://api.github.com/users/PhilGrayson/repos","events_url":"https://api.github.com/users/PhilGrayson/events{/privacy}","received_events_url":"https://api.github.com/users/PhilGrayson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":676174034,"node_id":"MDU6TGFiZWw2NzYxNzQwMzQ=","url":"https://api.github.com/repos/helm/helm/labels/size/S","name":"size/S","color":"77bb00","default":false,"description":"Denotes a PR that changes 10-29 lines, ignoring generated files."},{"id":778135666,"node_id":"MDU6TGFiZWw3NzgxMzU2NjY=","url":"https://api.github.com/repos/helm/helm/labels/bug","name":"bug","color":"e11d21","default":true,"description":"Categorizes issue or PR as related to a bug."},{"id":817666493,"node_id":"MDU6TGFiZWw4MTc2NjY0OTM=","url":"https://api.github.com/repos/helm/helm/labels/needs-pick","name":"needs-pick","color":"FF7F50","default":false,"description":"Indicates that a PR needs to be cherry-picked into the next release candidate."},{"id":817666543,"node_id":"MDU6TGFiZWw4MTc2NjY1NDM=","url":"https://api.github.com/repos/helm/helm/labels/picked","name":"picked","color":"0e8a16","default":false,"description":"Indicates that a PR has been cherry-picked into the next release candidate."},{"id":926755770,"node_id":"MDU6TGFiZWw5MjY3NTU3NzA=","url":"https://api.github.com/repos/helm/helm/labels/v3.x","name":"v3.x","color":"e82969","default":false,"description":"Issues and Pull Requests related to the major version v3"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/helm/helm/milestones/82","html_url":"https://github.com/helm/helm/milestone/82","labels_url":"https://api.github.com/repos/helm/helm/milestones/82/labels","id":4940239,"node_id":"MDk6TWlsZXN0b25lNDk0MDIzOQ==","number":82,"title":"3.0.3","description":"","creator":{"login":"mattfarina","id":62991,"node_id":"MDQ6VXNlcjYyOTkx","avatar_url":"https://avatars.githubusercontent.com/u/62991?v=4","gravatar_id":"","url":"https://api.github.com/users/mattfarina","html_url":"https://github.com/mattfarina","followers_url":"https://api.github.com/users/mattfarina/followers","following_url":"https://api.github.com/users/mattfarina/following{/other_user}","gists_url":"https://api.github.com/users/mattfarina/gists{/gist_id}","starred_url":"https://api.github.com/users/mattfarina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattfarina/subscriptions","organizations_url":"https://api.github.com/users/mattfarina/orgs","repos_url":"https://api.github.com/users/mattfarina/repos","events_url":"https://api.github.com/users/mattfarina/events{/privacy}","received_events_url":"https://api.github.com/users/mattfarina/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":20,"state":"closed","created_at":"2019-12-17T18:54:33Z","updated_at":"2020-01-29T15:33:20Z","due_on":null,"closed_at":"2020-01-29T15:33:20Z"},"comments":4,"created_at":"2020-01-01T22:02:57Z","updated_at":"2020-01-28T16:41:13Z","closed_at":"2020-01-09T18:03:56Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":43723161,"node_id":"MDEwOlJlcG9zaXRvcnk0MzcyMzE2MQ==","name":"helm","full_name":"helm/helm","private":false,"owner":{"login":"helm","id":15859888,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1ODU5ODg4","avatar_url":"https://avatars.githubusercontent.com/u/15859888?v=4","gravatar_id":"","url":"https://api.github.com/users/helm","html_url":"https://github.com/helm","followers_url":"https://api.github.com/users/helm/followers","following_url":"https://api.github.com/users/helm/following{/other_user}","gists_url":"https://api.github.com/users/helm/gists{/gist_id}","starred_url":"https://api.github.com/users/helm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helm/subscriptions","organizations_url":"https://api.github.com/users/helm/orgs","repos_url":"https://api.github.com/users/helm/repos","events_url":"https://api.github.com/users/helm/events{/privacy}","received_events_url":"https://api.github.com/users/helm/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/helm/helm","description":"The Kubernetes Package Manager","fork":false,"url":"https://api.github.com/repos/helm/helm","forks_url":"https://api.github.com/repos/helm/helm/forks","keys_url":"https://api.github.com/repos/helm/helm/keys{/key_id}","collaborators_url":"https://api.github.com/repos/helm/helm/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/helm/helm/teams","hooks_url":"https://api.github.com/repos/helm/helm/hooks","issue_events_url":"https://api.github.com/repos/helm/helm/issues/events{/number}","events_url":"https://api.github.com/repos/helm/helm/events","assignees_url":"https://api.github.com/repos/helm/helm/assignees{/user}","branches_url":"https://api.github.com/repos/helm/helm/branches{/branch}","tags_url":"https://api.github.com/repos/helm/helm/tags","blobs_url":"https://api.github.com/repos/helm/helm/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/helm/helm/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/helm/helm/git/refs{/sha}","trees_url":"https://api.github.com/repos/helm/helm/git/trees{/sha}","statuses_url":"https://api.github.com/repos/helm/helm/statuses/{sha}","languages_url":"https://api.github.com/repos/helm/helm/languages","stargazers_url":"https://api.github.com/repos/helm/helm/stargazers","contributors_url":"https://api.github.com/repos/helm/helm/contributors","subscribers_url":"https://api.github.com/repos/helm/helm/subscribers","subscription_url":"https://api.github.com/repos/helm/helm/subscription","commits_url":"https://api.github.com/repos/helm/helm/commits{/sha}","git_commits_url":"https://api.github.com/repos/helm/helm/git/commits{/sha}","comments_url":"https://api.github.com/repos/helm/helm/comments{/number}","issue_comment_url":"https://api.github.com/repos/helm/helm/issues/comments{/number}","contents_url":"https://api.github.com/repos/helm/helm/contents/{+path}","compare_url":"https://api.github.com/repos/helm/helm/compare/{base}...{head}","merges_url":"https://api.github.com/repos/helm/helm/merges","archive_url":"https://api.github.com/repos/helm/helm/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/helm/helm/downloads","issues_url":"https://api.github.com/repos/helm/helm/issues{/number}","pulls_url":"https://api.github.com/repos/helm/helm/pulls{/number}","milestones_url":"https://api.github.com/repos/helm/helm/milestones{/number}","notifications_url":"https://api.github.com/repos/helm/helm/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/helm/helm/labels{/name}","releases_url":"https://api.github.com/repos/helm/helm/releases{/id}","deployments_url":"https://api.github.com/repos/helm/helm/deployments","created_at":"2015-10-06T01:07:32Z","updated_at":"2025-11-09T19:00:10Z","pushed_at":"2025-11-09T12:57:10Z","git_url":"git://github.com/helm/helm.git","ssh_url":"git@github.com:helm/helm.git","clone_url":"https://github.com/helm/helm.git","svn_url":"https://github.com/helm/helm","homepage":"https://helm.sh","size":25851,"stargazers_count":28930,"watchers_count":28930,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":7393,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":448,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":true,"topics":["chart","charts","cncf","helm","kubernetes"],"visibility":"public","forks":7393,"open_issues":448,"watchers":28930,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/helm/helm/pulls/7320","html_url":"https://github.com/helm/helm/pull/7320","diff_url":"https://github.com/helm/helm/pull/7320.diff","patch_url":"https://github.com/helm/helm/pull/7320.patch","merged_at":"2020-01-09T18:03:56Z"},"body":"Fixes issue #7279.\r\n\r\nPrevent the deletion of CRDs that were defined in the `templates/`\r\ndirectory. This makes CRD deletion behaviour consistent with Helm\r\ndocumentation:\r\n\r\n > CRDs are never deleted. Deleting a CRD automatically deletes all of the\r\n > CRDâ€™s contents across all namespaces in the cluster. Consequently, Helm\r\n > will not delete CRDs.\r\n\r\nPrevious the documentation only applied to CRDs that were defined in the\r\n`crds/` directory. It did not consider that Charts could have CRDs in the\r\n`templates/` directory (for example charts that were written before the\r\n`crds/` directory feature or if the Chart author needed templated CRDs).\r\n\r\nSigned-off-by: Phil Grayson <phil@philgrayson.com>","reactions":{"url":"https://api.github.com/repos/helm/helm/issues/7320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/7320/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":2936418739,"node_id":"MDExOkNsb3NlZEV2ZW50MjkzNjQxODczOQ==","url":"https://api.github.com/repos/helm/helm/issues/events/2936418739","actor":{"login":"PhilGrayson","id":143456,"node_id":"MDQ6VXNlcjE0MzQ1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/143456?v=4","gravatar_id":"","url":"https://api.github.com/users/PhilGrayson","html_url":"https://github.com/PhilGrayson","followers_url":"https://api.github.com/users/PhilGrayson/followers","following_url":"https://api.github.com/users/PhilGrayson/following{/other_user}","gists_url":"https://api.github.com/users/PhilGrayson/gists{/gist_id}","starred_url":"https://api.github.com/users/PhilGrayson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PhilGrayson/subscriptions","organizations_url":"https://api.github.com/users/PhilGrayson/orgs","repos_url":"https://api.github.com/users/PhilGrayson/repos","events_url":"https://api.github.com/users/PhilGrayson/events{/privacy}","received_events_url":"https://api.github.com/users/PhilGrayson/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-01-09T20:53:10Z","state_reason":null,"performed_via_github_app":null},{"id":2986469228,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDI5ODY0NjkyMjg=","url":"https://api.github.com/repos/helm/helm/issues/events/2986469228","actor":{"login":"mattfarina","id":62991,"node_id":"MDQ6VXNlcjYyOTkx","avatar_url":"https://avatars.githubusercontent.com/u/62991?v=4","gravatar_id":"","url":"https://api.github.com/users/mattfarina","html_url":"https://github.com/mattfarina","followers_url":"https://api.github.com/users/mattfarina/followers","following_url":"https://api.github.com/users/mattfarina/following{/other_user}","gists_url":"https://api.github.com/users/mattfarina/gists{/gist_id}","starred_url":"https://api.github.com/users/mattfarina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattfarina/subscriptions","organizations_url":"https://api.github.com/users/mattfarina/orgs","repos_url":"https://api.github.com/users/mattfarina/repos","events_url":"https://api.github.com/users/mattfarina/events{/privacy}","received_events_url":"https://api.github.com/users/mattfarina/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9711d1c6bfd9cd0cebe47b069a18cfc83ac3bfee","commit_url":"https://api.github.com/repos/helm/helm/commits/9711d1c6bfd9cd0cebe47b069a18cfc83ac3bfee","created_at":"2020-01-28T17:03:59Z","performed_via_github_app":null},{"id":3081104941,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMwODExMDQ5NDE=","url":"https://api.github.com/repos/helm/helm/issues/events/3081104941","actor":{"login":"bamachrn","id":8213617,"node_id":"MDQ6VXNlcjgyMTM2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/8213617?v=4","gravatar_id":"","url":"https://api.github.com/users/bamachrn","html_url":"https://github.com/bamachrn","followers_url":"https://api.github.com/users/bamachrn/followers","following_url":"https://api.github.com/users/bamachrn/following{/other_user}","gists_url":"https://api.github.com/users/bamachrn/gists{/gist_id}","starred_url":"https://api.github.com/users/bamachrn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bamachrn/subscriptions","organizations_url":"https://api.github.com/users/bamachrn/orgs","repos_url":"https://api.github.com/users/bamachrn/repos","events_url":"https://api.github.com/users/bamachrn/events{/privacy}","received_events_url":"https://api.github.com/users/bamachrn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"66397e8a9bf7b3857a1f818b39afc9c60f9988a7","commit_url":"https://api.github.com/repos/bamachrn/helm/commits/66397e8a9bf7b3857a1f818b39afc9c60f9988a7","created_at":"2020-02-28T08:58:37Z","performed_via_github_app":null},{"id":3082303365,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMwODIzMDMzNjU=","url":"https://api.github.com/repos/helm/helm/issues/events/3082303365","actor":{"login":"bamachrn","id":8213617,"node_id":"MDQ6VXNlcjgyMTM2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/8213617?v=4","gravatar_id":"","url":"https://api.github.com/users/bamachrn","html_url":"https://github.com/bamachrn","followers_url":"https://api.github.com/users/bamachrn/followers","following_url":"https://api.github.com/users/bamachrn/following{/other_user}","gists_url":"https://api.github.com/users/bamachrn/gists{/gist_id}","starred_url":"https://api.github.com/users/bamachrn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bamachrn/subscriptions","organizations_url":"https://api.github.com/users/bamachrn/orgs","repos_url":"https://api.github.com/users/bamachrn/repos","events_url":"https://api.github.com/users/bamachrn/events{/privacy}","received_events_url":"https://api.github.com/users/bamachrn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"8d0d4f4ba1ce969470c9d439d9b1492a6e02814e","commit_url":"https://api.github.com/repos/bamachrn/helm/commits/8d0d4f4ba1ce969470c9d439d9b1492a6e02814e","created_at":"2020-02-28T15:09:18Z","performed_via_github_app":null},{"id":3082420824,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDMwODI0MjA4MjQ=","url":"https://api.github.com/repos/helm/helm/issues/events/3082420824","actor":{"login":"bamachrn","id":8213617,"node_id":"MDQ6VXNlcjgyMTM2MTc=","avatar_url":"https://avatars.githubusercontent.com/u/8213617?v=4","gravatar_id":"","url":"https://api.github.com/users/bamachrn","html_url":"https://github.com/bamachrn","followers_url":"https://api.github.com/users/bamachrn/followers","following_url":"https://api.github.com/users/bamachrn/following{/other_user}","gists_url":"https://api.github.com/users/bamachrn/gists{/gist_id}","starred_url":"https://api.github.com/users/bamachrn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bamachrn/subscriptions","organizations_url":"https://api.github.com/users/bamachrn/orgs","repos_url":"https://api.github.com/users/bamachrn/repos","events_url":"https://api.github.com/users/bamachrn/events{/privacy}","received_events_url":"https://api.github.com/users/bamachrn/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"57190cf99947b288c567ef50ca9e9781498b5871","commit_url":"https://api.github.com/repos/bamachrn/helm/commits/57190cf99947b288c567ef50ca9e9781498b5871","created_at":"2020-02-28T15:40:10Z","performed_via_github_app":null},{"actor":{"login":"bacongobbler","id":1360539,"node_id":"MDQ6VXNlcjEzNjA1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1360539?v=4","gravatar_id":"","url":"https://api.github.com/users/bacongobbler","html_url":"https://github.com/bacongobbler","followers_url":"https://api.github.com/users/bacongobbler/followers","following_url":"https://api.github.com/users/bacongobbler/following{/other_user}","gists_url":"https://api.github.com/users/bacongobbler/gists{/gist_id}","starred_url":"https://api.github.com/users/bacongobbler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bacongobbler/subscriptions","organizations_url":"https://api.github.com/users/bacongobbler/orgs","repos_url":"https://api.github.com/users/bacongobbler/repos","events_url":"https://api.github.com/users/bacongobbler/events{/privacy}","received_events_url":"https://api.github.com/users/bacongobbler/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-05-19T15:26:05Z","updated_at":"2020-05-19T15:26:05Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/helm/helm/issues/8163","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/8163/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/8163/comments","events_url":"https://api.github.com/repos/helm/helm/issues/8163/events","html_url":"https://github.com/helm/helm/issues/8163","id":621005659,"node_id":"MDU6SXNzdWU2MjEwMDU2NTk=","number":8163,"title":"CRDs get deleted when moving them from templates/ to crds/","user":{"login":"jonathan-kaleve","id":19330942,"node_id":"MDQ6VXNlcjE5MzMwOTQy","avatar_url":"https://avatars.githubusercontent.com/u/19330942?v=4","gravatar_id":"","url":"https://api.github.com/users/jonathan-kaleve","html_url":"https://github.com/jonathan-kaleve","followers_url":"https://api.github.com/users/jonathan-kaleve/followers","following_url":"https://api.github.com/users/jonathan-kaleve/following{/other_user}","gists_url":"https://api.github.com/users/jonathan-kaleve/gists{/gist_id}","starred_url":"https://api.github.com/users/jonathan-kaleve/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jonathan-kaleve/subscriptions","organizations_url":"https://api.github.com/users/jonathan-kaleve/orgs","repos_url":"https://api.github.com/users/jonathan-kaleve/repos","events_url":"https://api.github.com/users/jonathan-kaleve/events{/privacy}","received_events_url":"https://api.github.com/users/jonathan-kaleve/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-05-19T14:06:46Z","updated_at":"2020-05-19T15:26:06Z","closed_at":"2020-05-19T15:26:05Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":43723161,"node_id":"MDEwOlJlcG9zaXRvcnk0MzcyMzE2MQ==","name":"helm","full_name":"helm/helm","private":false,"owner":{"login":"helm","id":15859888,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1ODU5ODg4","avatar_url":"https://avatars.githubusercontent.com/u/15859888?v=4","gravatar_id":"","url":"https://api.github.com/users/helm","html_url":"https://github.com/helm","followers_url":"https://api.github.com/users/helm/followers","following_url":"https://api.github.com/users/helm/following{/other_user}","gists_url":"https://api.github.com/users/helm/gists{/gist_id}","starred_url":"https://api.github.com/users/helm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helm/subscriptions","organizations_url":"https://api.github.com/users/helm/orgs","repos_url":"https://api.github.com/users/helm/repos","events_url":"https://api.github.com/users/helm/events{/privacy}","received_events_url":"https://api.github.com/users/helm/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/helm/helm","description":"The Kubernetes Package Manager","fork":false,"url":"https://api.github.com/repos/helm/helm","forks_url":"https://api.github.com/repos/helm/helm/forks","keys_url":"https://api.github.com/repos/helm/helm/keys{/key_id}","collaborators_url":"https://api.github.com/repos/helm/helm/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/helm/helm/teams","hooks_url":"https://api.github.com/repos/helm/helm/hooks","issue_events_url":"https://api.github.com/repos/helm/helm/issues/events{/number}","events_url":"https://api.github.com/repos/helm/helm/events","assignees_url":"https://api.github.com/repos/helm/helm/assignees{/user}","branches_url":"https://api.github.com/repos/helm/helm/branches{/branch}","tags_url":"https://api.github.com/repos/helm/helm/tags","blobs_url":"https://api.github.com/repos/helm/helm/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/helm/helm/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/helm/helm/git/refs{/sha}","trees_url":"https://api.github.com/repos/helm/helm/git/trees{/sha}","statuses_url":"https://api.github.com/repos/helm/helm/statuses/{sha}","languages_url":"https://api.github.com/repos/helm/helm/languages","stargazers_url":"https://api.github.com/repos/helm/helm/stargazers","contributors_url":"https://api.github.com/repos/helm/helm/contributors","subscribers_url":"https://api.github.com/repos/helm/helm/subscribers","subscription_url":"https://api.github.com/repos/helm/helm/subscription","commits_url":"https://api.github.com/repos/helm/helm/commits{/sha}","git_commits_url":"https://api.github.com/repos/helm/helm/git/commits{/sha}","comments_url":"https://api.github.com/repos/helm/helm/comments{/number}","issue_comment_url":"https://api.github.com/repos/helm/helm/issues/comments{/number}","contents_url":"https://api.github.com/repos/helm/helm/contents/{+path}","compare_url":"https://api.github.com/repos/helm/helm/compare/{base}...{head}","merges_url":"https://api.github.com/repos/helm/helm/merges","archive_url":"https://api.github.com/repos/helm/helm/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/helm/helm/downloads","issues_url":"https://api.github.com/repos/helm/helm/issues{/number}","pulls_url":"https://api.github.com/repos/helm/helm/pulls{/number}","milestones_url":"https://api.github.com/repos/helm/helm/milestones{/number}","notifications_url":"https://api.github.com/repos/helm/helm/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/helm/helm/labels{/name}","releases_url":"https://api.github.com/repos/helm/helm/releases{/id}","deployments_url":"https://api.github.com/repos/helm/helm/deployments","created_at":"2015-10-06T01:07:32Z","updated_at":"2025-11-09T19:00:10Z","pushed_at":"2025-11-09T12:57:10Z","git_url":"git://github.com/helm/helm.git","ssh_url":"git@github.com:helm/helm.git","clone_url":"https://github.com/helm/helm.git","svn_url":"https://github.com/helm/helm","homepage":"https://helm.sh","size":25851,"stargazers_count":28930,"watchers_count":28930,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":7393,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":448,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":true,"topics":["chart","charts","cncf","helm","kubernetes"],"visibility":"public","forks":7393,"open_issues":448,"watchers":28930,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"## Description\r\nAssume a CRD that is first declared as a template. This CRD then gets moved to the crds directory (with all templating removed). Now, when doing a Helm upgrade, all CRDs will get removed. If many custom resources are connected to this CRD, the upgrade will basically shut most of the cluster down. Is this intentional? Is there a way to work around this?\r\n\r\n## Steps to reproduce\r\n1. Install a chart that declares CRDs using templating, for example [Strimzi Kafka Operator](https://github.com/strimzi/strimzi-kafka-operator/tree/master/helm-charts)\r\n2. Move the CRDs to the crds/ folder\r\n3. Do a helm upgrade\r\n\r\n## Versions\r\nOutput of `helm version`:\r\nversion.BuildInfo{Version:\"v3.2.1\", GitCommit:\"fe51cd1e31e6a202cba7dead9552a6d418ded79a\", GitTreeState:\"clean\", GoVersion:\"go1.13.10\"}\r\n\r\nOutput of `kubectl version`:\r\nClient Version: version.Info{Major:\"1\", Minor:\"18\", GitVersion:\"v1.18.2\", GitCommit:\"52c56ce7a8272c798dbc29846288d7cd9fbae032\", GitTreeState:\"clean\", BuildDate:\"2020-04-21T01:25:41Z\", GoVersion:\"go1.13.10\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"18\", GitVersion:\"v1.18.2\", GitCommit:\"52c56ce7a8272c798dbc29846288d7cd9fbae032\", GitTreeState:\"clean\", BuildDate:\"2020-04-16T11:48:36Z\", GoVersion:\"go1.13.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\nCloud Provider/Platform (AKS, GKE, Minikube etc.): \r\nMinikube\r\n\r\n","reactions":{"url":"https://api.github.com/repos/helm/helm/issues/8163/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/8163/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"bacongobbler","id":1360539,"node_id":"MDQ6VXNlcjEzNjA1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1360539?v=4","gravatar_id":"","url":"https://api.github.com/users/bacongobbler","html_url":"https://github.com/bacongobbler","followers_url":"https://api.github.com/users/bacongobbler/followers","following_url":"https://api.github.com/users/bacongobbler/following{/other_user}","gists_url":"https://api.github.com/users/bacongobbler/gists{/gist_id}","starred_url":"https://api.github.com/users/bacongobbler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bacongobbler/subscriptions","organizations_url":"https://api.github.com/users/bacongobbler/orgs","repos_url":"https://api.github.com/users/bacongobbler/repos","events_url":"https://api.github.com/users/bacongobbler/events{/privacy}","received_events_url":"https://api.github.com/users/bacongobbler/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-05-19T15:26:44Z","updated_at":"2020-05-19T15:26:44Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/helm/helm/issues/8161","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/8161/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/8161/comments","events_url":"https://api.github.com/repos/helm/helm/issues/8161/events","html_url":"https://github.com/helm/helm/issues/8161","id":620726718,"node_id":"MDU6SXNzdWU2MjA3MjY3MTg=","number":8161,"title":"[Question/Support] Migrating from chart apiVersion v1 to v2","user":{"login":"vivekzhere","id":1204217,"node_id":"MDQ6VXNlcjEyMDQyMTc=","avatar_url":"https://avatars.githubusercontent.com/u/1204217?v=4","gravatar_id":"","url":"https://api.github.com/users/vivekzhere","html_url":"https://github.com/vivekzhere","followers_url":"https://api.github.com/users/vivekzhere/followers","following_url":"https://api.github.com/users/vivekzhere/following{/other_user}","gists_url":"https://api.github.com/users/vivekzhere/gists{/gist_id}","starred_url":"https://api.github.com/users/vivekzhere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vivekzhere/subscriptions","organizations_url":"https://api.github.com/users/vivekzhere/orgs","repos_url":"https://api.github.com/users/vivekzhere/repos","events_url":"https://api.github.com/users/vivekzhere/events{/privacy}","received_events_url":"https://api.github.com/users/vivekzhere/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":269212356,"node_id":"MDU6TGFiZWwyNjkyMTIzNTY=","url":"https://api.github.com/repos/helm/helm/labels/question/support","name":"question/support","color":"cc317c","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-05-19T06:54:51Z","updated_at":"2020-05-19T15:26:54Z","closed_at":"2020-05-19T14:25:18Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":43723161,"node_id":"MDEwOlJlcG9zaXRvcnk0MzcyMzE2MQ==","name":"helm","full_name":"helm/helm","private":false,"owner":{"login":"helm","id":15859888,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1ODU5ODg4","avatar_url":"https://avatars.githubusercontent.com/u/15859888?v=4","gravatar_id":"","url":"https://api.github.com/users/helm","html_url":"https://github.com/helm","followers_url":"https://api.github.com/users/helm/followers","following_url":"https://api.github.com/users/helm/following{/other_user}","gists_url":"https://api.github.com/users/helm/gists{/gist_id}","starred_url":"https://api.github.com/users/helm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helm/subscriptions","organizations_url":"https://api.github.com/users/helm/orgs","repos_url":"https://api.github.com/users/helm/repos","events_url":"https://api.github.com/users/helm/events{/privacy}","received_events_url":"https://api.github.com/users/helm/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/helm/helm","description":"The Kubernetes Package Manager","fork":false,"url":"https://api.github.com/repos/helm/helm","forks_url":"https://api.github.com/repos/helm/helm/forks","keys_url":"https://api.github.com/repos/helm/helm/keys{/key_id}","collaborators_url":"https://api.github.com/repos/helm/helm/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/helm/helm/teams","hooks_url":"https://api.github.com/repos/helm/helm/hooks","issue_events_url":"https://api.github.com/repos/helm/helm/issues/events{/number}","events_url":"https://api.github.com/repos/helm/helm/events","assignees_url":"https://api.github.com/repos/helm/helm/assignees{/user}","branches_url":"https://api.github.com/repos/helm/helm/branches{/branch}","tags_url":"https://api.github.com/repos/helm/helm/tags","blobs_url":"https://api.github.com/repos/helm/helm/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/helm/helm/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/helm/helm/git/refs{/sha}","trees_url":"https://api.github.com/repos/helm/helm/git/trees{/sha}","statuses_url":"https://api.github.com/repos/helm/helm/statuses/{sha}","languages_url":"https://api.github.com/repos/helm/helm/languages","stargazers_url":"https://api.github.com/repos/helm/helm/stargazers","contributors_url":"https://api.github.com/repos/helm/helm/contributors","subscribers_url":"https://api.github.com/repos/helm/helm/subscribers","subscription_url":"https://api.github.com/repos/helm/helm/subscription","commits_url":"https://api.github.com/repos/helm/helm/commits{/sha}","git_commits_url":"https://api.github.com/repos/helm/helm/git/commits{/sha}","comments_url":"https://api.github.com/repos/helm/helm/comments{/number}","issue_comment_url":"https://api.github.com/repos/helm/helm/issues/comments{/number}","contents_url":"https://api.github.com/repos/helm/helm/contents/{+path}","compare_url":"https://api.github.com/repos/helm/helm/compare/{base}...{head}","merges_url":"https://api.github.com/repos/helm/helm/merges","archive_url":"https://api.github.com/repos/helm/helm/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/helm/helm/downloads","issues_url":"https://api.github.com/repos/helm/helm/issues{/number}","pulls_url":"https://api.github.com/repos/helm/helm/pulls{/number}","milestones_url":"https://api.github.com/repos/helm/helm/milestones{/number}","notifications_url":"https://api.github.com/repos/helm/helm/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/helm/helm/labels{/name}","releases_url":"https://api.github.com/repos/helm/helm/releases{/id}","deployments_url":"https://api.github.com/repos/helm/helm/deployments","created_at":"2015-10-06T01:07:32Z","updated_at":"2025-11-09T19:00:10Z","pushed_at":"2025-11-09T12:57:10Z","git_url":"git://github.com/helm/helm.git","ssh_url":"git@github.com:helm/helm.git","clone_url":"https://github.com/helm/helm.git","svn_url":"https://github.com/helm/helm","homepage":"https://helm.sh","size":25851,"stargazers_count":28930,"watchers_count":28930,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":7393,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":448,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":true,"topics":["chart","charts","cncf","helm","kubernetes"],"visibility":"public","forks":7393,"open_issues":448,"watchers":28930,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I have a [helm chart](https://github.com/cloudfoundry-incubator/service-fabrik-broker/tree/master/helm-charts/interoperator) which uses chart apiVersion `v1`.  The chart installs some CRDs. When I created the chart, the CRDs were directly added as templates. I did not use the [helm2 best practices](https://v2.helm.sh/docs/chart_best_practices/#custom-resource-definitions) of using `crd-install` hook. \r\n\r\nNow I want to migrate to chart  apiVersion  `v2` and use the the `crds` directory according to the [helm3 best practices](https://helm.sh/docs/chart_best_practices/custom_resource_definitions). But I have existing `releases` running which has many instances of the custom resource already created. So when I try to move the crds to the `crds` folder, the upgrade of the existing release causes problems. The upgrade first tries to delete the crds and then creates them again.\r\n\r\nIs there some way I can do the migration so that existing releases can be upgraded?\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/helm/helm/issues/8161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/8161/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"SapientGuardian","id":14796343,"node_id":"MDQ6VXNlcjE0Nzk2MzQz","avatar_url":"https://avatars.githubusercontent.com/u/14796343?v=4","gravatar_id":"","url":"https://api.github.com/users/SapientGuardian","html_url":"https://github.com/SapientGuardian","followers_url":"https://api.github.com/users/SapientGuardian/followers","following_url":"https://api.github.com/users/SapientGuardian/following{/other_user}","gists_url":"https://api.github.com/users/SapientGuardian/gists{/gist_id}","starred_url":"https://api.github.com/users/SapientGuardian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SapientGuardian/subscriptions","organizations_url":"https://api.github.com/users/SapientGuardian/orgs","repos_url":"https://api.github.com/users/SapientGuardian/repos","events_url":"https://api.github.com/users/SapientGuardian/events{/privacy}","received_events_url":"https://api.github.com/users/SapientGuardian/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-04T14:59:44Z","updated_at":"2020-09-04T14:59:44Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/banzaicloud/koperator/issues/444","repository_url":"https://api.github.com/repos/banzaicloud/koperator","labels_url":"https://api.github.com/repos/banzaicloud/koperator/issues/444/labels{/name}","comments_url":"https://api.github.com/repos/banzaicloud/koperator/issues/444/comments","events_url":"https://api.github.com/repos/banzaicloud/koperator/issues/444/events","html_url":"https://github.com/banzaicloud/koperator/issues/444","id":692114447,"node_id":"MDU6SXNzdWU2OTIxMTQ0NDc=","number":444,"title":"Upgrading operator deleted cluster","user":{"login":"SapientGuardian","id":14796343,"node_id":"MDQ6VXNlcjE0Nzk2MzQz","avatar_url":"https://avatars.githubusercontent.com/u/14796343?v=4","gravatar_id":"","url":"https://api.github.com/users/SapientGuardian","html_url":"https://github.com/SapientGuardian","followers_url":"https://api.github.com/users/SapientGuardian/followers","following_url":"https://api.github.com/users/SapientGuardian/following{/other_user}","gists_url":"https://api.github.com/users/SapientGuardian/gists{/gist_id}","starred_url":"https://api.github.com/users/SapientGuardian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SapientGuardian/subscriptions","organizations_url":"https://api.github.com/users/SapientGuardian/orgs","repos_url":"https://api.github.com/users/SapientGuardian/repos","events_url":"https://api.github.com/users/SapientGuardian/events{/privacy}","received_events_url":"https://api.github.com/users/SapientGuardian/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2020-09-03T16:29:27Z","updated_at":"2020-09-07T14:51:29Z","closed_at":"2020-09-07T14:29:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":135042369,"node_id":"MDEwOlJlcG9zaXRvcnkxMzUwNDIzNjk=","name":"koperator","full_name":"banzaicloud/koperator","private":false,"owner":{"login":"banzaicloud","id":32848483,"node_id":"MDEyOk9yZ2FuaXphdGlvbjMyODQ4NDgz","avatar_url":"https://avatars.githubusercontent.com/u/32848483?v=4","gravatar_id":"","url":"https://api.github.com/users/banzaicloud","html_url":"https://github.com/banzaicloud","followers_url":"https://api.github.com/users/banzaicloud/followers","following_url":"https://api.github.com/users/banzaicloud/following{/other_user}","gists_url":"https://api.github.com/users/banzaicloud/gists{/gist_id}","starred_url":"https://api.github.com/users/banzaicloud/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/banzaicloud/subscriptions","organizations_url":"https://api.github.com/users/banzaicloud/orgs","repos_url":"https://api.github.com/users/banzaicloud/repos","events_url":"https://api.github.com/users/banzaicloud/events{/privacy}","received_events_url":"https://api.github.com/users/banzaicloud/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/banzaicloud/koperator","description":"Oh no! Yet another Apache Kafka operator for Kubernetes","fork":false,"url":"https://api.github.com/repos/banzaicloud/koperator","forks_url":"https://api.github.com/repos/banzaicloud/koperator/forks","keys_url":"https://api.github.com/repos/banzaicloud/koperator/keys{/key_id}","collaborators_url":"https://api.github.com/repos/banzaicloud/koperator/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/banzaicloud/koperator/teams","hooks_url":"https://api.github.com/repos/banzaicloud/koperator/hooks","issue_events_url":"https://api.github.com/repos/banzaicloud/koperator/issues/events{/number}","events_url":"https://api.github.com/repos/banzaicloud/koperator/events","assignees_url":"https://api.github.com/repos/banzaicloud/koperator/assignees{/user}","branches_url":"https://api.github.com/repos/banzaicloud/koperator/branches{/branch}","tags_url":"https://api.github.com/repos/banzaicloud/koperator/tags","blobs_url":"https://api.github.com/repos/banzaicloud/koperator/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/banzaicloud/koperator/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/banzaicloud/koperator/git/refs{/sha}","trees_url":"https://api.github.com/repos/banzaicloud/koperator/git/trees{/sha}","statuses_url":"https://api.github.com/repos/banzaicloud/koperator/statuses/{sha}","languages_url":"https://api.github.com/repos/banzaicloud/koperator/languages","stargazers_url":"https://api.github.com/repos/banzaicloud/koperator/stargazers","contributors_url":"https://api.github.com/repos/banzaicloud/koperator/contributors","subscribers_url":"https://api.github.com/repos/banzaicloud/koperator/subscribers","subscription_url":"https://api.github.com/repos/banzaicloud/koperator/subscription","commits_url":"https://api.github.com/repos/banzaicloud/koperator/commits{/sha}","git_commits_url":"https://api.github.com/repos/banzaicloud/koperator/git/commits{/sha}","comments_url":"https://api.github.com/repos/banzaicloud/koperator/comments{/number}","issue_comment_url":"https://api.github.com/repos/banzaicloud/koperator/issues/comments{/number}","contents_url":"https://api.github.com/repos/banzaicloud/koperator/contents/{+path}","compare_url":"https://api.github.com/repos/banzaicloud/koperator/compare/{base}...{head}","merges_url":"https://api.github.com/repos/banzaicloud/koperator/merges","archive_url":"https://api.github.com/repos/banzaicloud/koperator/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/banzaicloud/koperator/downloads","issues_url":"https://api.github.com/repos/banzaicloud/koperator/issues{/number}","pulls_url":"https://api.github.com/repos/banzaicloud/koperator/pulls{/number}","milestones_url":"https://api.github.com/repos/banzaicloud/koperator/milestones{/number}","notifications_url":"https://api.github.com/repos/banzaicloud/koperator/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/banzaicloud/koperator/labels{/name}","releases_url":"https://api.github.com/repos/banzaicloud/koperator/releases{/id}","deployments_url":"https://api.github.com/repos/banzaicloud/koperator/deployments","created_at":"2018-05-27T12:02:35Z","updated_at":"2025-10-24T10:23:52Z","pushed_at":"2025-03-11T08:20:50Z","git_url":"git://github.com/banzaicloud/koperator.git","ssh_url":"git@github.com:banzaicloud/koperator.git","clone_url":"https://github.com/banzaicloud/koperator.git","svn_url":"https://github.com/banzaicloud/koperator","homepage":"","size":38398,"stargazers_count":790,"watchers_count":790,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":196,"mirror_url":null,"archived":true,"disabled":false,"open_issues_count":66,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cruisecontrol","kafka","kafka-operator","kubernetes"],"visibility":"public","forks":196,"open_issues":66,"watchers":790,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Upgrading the kafka-operator helm chart caused my cluster to get deleted!\r\n\r\nI was running version 0.12.2 of the operator, installed by helm chart. I ran `helm upgrade --install kafka-operator banzaicloud-stable/kafka-operator --set certManager.enabled=true --namespace kafka-operator`, which gave the following output:\r\n```\r\nmanifest_sorter.go:192: info: skipping unknown hook: \"crd-install\"\r\n manifest_sorter.go:192: info: skipping unknown hook: \"crd-install\"\r\n manifest_sorter.go:192: info: skipping unknown hook: \"crd-install\"\r\n Release \"kafka-operator\" has been upgraded. Happy Helming!\r\n NAME: kafka-operator\r\n LAST DEPLOYED: Thu Sep  3 16:02:06 2020\r\n NAMESPACE: kafka-operator\r\n STATUS: deployed\r\n REVISION: 8\r\n TEST SUITE: None\r\n```\r\n```\r\nhelm ls -n kafka-operator\r\nNAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART        APP VERSION\r\nkafka-operator  kafka-operator  8               2020-09-03 16:02:06.494435966 +0000 UTC deployed        kafka-operator-0.2.22   v0.12.3\r\n```\r\n\r\nAfter which I found my cluster had completely disappeared! No kafka pods, and even the kafkacluster CRD was gone:\r\n```\r\nkubectl get kafkacluster -n pushdelivery-stage\r\nerror: the server doesn't have a resource type \"kafkacluster\"\r\n```\r\n\r\n\r\nHere are the latest logs from the operator before the upgrade (nothing particularly interesting here):\r\n\r\n```\r\n{\"level\":\"info\",\"ts\":1599148172.6998022,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Reconciling KafkaTopic\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-results\",\"Request.Name\":\"push-delivery-results\"}\r\n{\"level\":\"info\",\"ts\":1599148172.6999924,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Retrieving Kafka client for pushdelivery-stage/kafka-pushdelivery-stage\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-results\",\"Request.Name\":\"push-delivery-results\"}\r\n{\"level\":\"info\",\"ts\":1599148172.8118215,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Topic already exists, verifying configuration\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-results\",\"Request.Name\":\"push-delivery-results\"}\r\n{\"level\":\"info\",\"ts\":1599148172.8408773,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Verified partitions and configuration for topic\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-results\",\"Request.Name\":\"push-delivery-results\"}\r\n{\"level\":\"info\",\"ts\":1599148172.84725,\"logger\":\"webhooks\",\"msg\":\"AdmissionReview for Kind=kafka.banzaicloud.io/v1alpha1, Kind=KafkaTopic, Namespace=pushdelivery-stage Name=push-delivery-results UID=0e04ed5d-d03f-4a19-9669-630f1bcf6d5e patchOperation=UPDATE UserInfo={system:serviceaccount:kafka-operator:kafka-operator-operator 2b69accc-63be-11ea-a6fa-06bc8cfa3fa2 [system:serviceaccounts system:serviceaccounts:kafka-operator system:authenticated] map[]}\"}\r\n{\"level\":\"info\",\"ts\":1599148172.8473399,\"logger\":\"webhooks\",\"msg\":\"Doing pre-admission validation of kafka topic push-delivery-results\"}\r\n{\"level\":\"info\",\"ts\":1599148172.9368777,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Ensured topic\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-results\",\"Request.Name\":\"push-delivery-results\"}\r\n{\"level\":\"info\",\"ts\":1599148172.936941,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Kafka client closed cleanly\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-results\",\"Request.Name\":\"push-delivery-results\"}\r\n{\"level\":\"info\",\"ts\":1599148172.9369812,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Reconciling KafkaTopic\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148172.93705,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Retrieving Kafka client for pushdelivery-stage/kafka-pushdelivery-stage\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148173.0359287,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Topic already exists, verifying configuration\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148173.0537887,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Verified partitions and configuration for topic\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148173.05574,\"logger\":\"webhooks\",\"msg\":\"AdmissionReview for Kind=kafka.banzaicloud.io/v1alpha1, Kind=KafkaTopic, Namespace=pushdelivery-stage Name=kafka-pushdelivery-stage-cruise-control-topic UID=98c1fead-c7c9-4422-86f2-e3b24aac16ea patchOperation=UPDATE UserInfo={system:serviceaccount:kafka-operator:kafka-operator-operator 2b69accc-63be-11ea-a6fa-06bc8cfa3fa2 [system:serviceaccounts system:serviceaccounts:kafka-operator system:authenticated] map[]}\"}\r\n{\"level\":\"info\",\"ts\":1599148173.0558407,\"logger\":\"webhooks\",\"msg\":\"Doing pre-admission validation of kafka topic __CruiseControlMetrics\"}\r\n{\"level\":\"info\",\"ts\":1599148173.1402967,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Ensured topic\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148173.140351,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Kafka client closed cleanly\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148173.1403859,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Reconciling KafkaTopic\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-failures\",\"Request.Name\":\"push-delivery-failures\"}\r\n{\"level\":\"info\",\"ts\":1599148173.1404526,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Retrieving Kafka client for pushdelivery-stage/kafka-pushdelivery-stage\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-failures\",\"Request.Name\":\"push-delivery-failures\"}\r\n{\"level\":\"info\",\"ts\":1599148173.2386732,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Topic already exists, verifying configuration\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-failures\",\"Request.Name\":\"push-delivery-failures\"}\r\n{\"level\":\"info\",\"ts\":1599148173.2584016,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Verified partitions and configuration for topic\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-failures\",\"Request.Name\":\"push-delivery-failures\"}\r\n{\"level\":\"info\",\"ts\":1599148173.260417,\"logger\":\"webhooks\",\"msg\":\"AdmissionReview for Kind=kafka.banzaicloud.io/v1alpha1, Kind=KafkaTopic, Namespace=pushdelivery-stage Name=push-delivery-failures UID=861d8f7a-e735-4b1b-81cc-a0fefe4401b2 patchOperation=UPDATE UserInfo={system:serviceaccount:kafka-operator:kafka-operator-operator 2b69accc-63be-11ea-a6fa-06bc8cfa3fa2 [system:serviceaccounts system:serviceaccounts:kafka-operator system:authenticated] map[]}\"}\r\n{\"level\":\"info\",\"ts\":1599148173.2605708,\"logger\":\"webhooks\",\"msg\":\"Doing pre-admission validation of kafka topic push-delivery-failures\"}\r\n{\"level\":\"info\",\"ts\":1599148173.3355663,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Ensured topic\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-failures\",\"Request.Name\":\"push-delivery-failures\"}\r\n{\"level\":\"info\",\"ts\":1599148173.3356223,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Kafka client closed cleanly\",\"kafkatopic\":\"pushdelivery-stage/push-delivery-failures\",\"Request.Name\":\"push-delivery-failures\"}\r\n```\r\n\r\nAnd here are the logs immediately following the upgrade:\r\n\r\n```\r\n{\"level\":\"info\",\"ts\":1599148927.4185057,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Reconciling KafkaTopic\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148927.4186797,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Retrieving Kafka client for pushdelivery-stage/kafka-pushdelivery-stage\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148927.420733,\"logger\":\"controllers.KafkaCluster\",\"msg\":\"Reconciling KafkaCluster\",\"Request.Namespace\":\"pushdelivery-stage/kafka-pushdelivery-stage\",\"Request.Name\":\"kafka-pushdelivery-stage\"}\r\n{\"level\":\"info\",\"ts\":1599148927.4207926,\"logger\":\"controllers.KafkaCluster\",\"msg\":\"KafkaCluster is marked for deletion, checking for children\",\"Request.Namespace\":\"pushdelivery-stage/kafka-pushdelivery-stage\",\"Request.Name\":\"kafka-pushdelivery-stage\"}\r\nE0903 16:02:07.423850       1 reflector.go:178] pkg/mod/k8s.io/client-go@v0.18.2/tools/cache/reflector.go:125: Failed to list *v1.Namespace: namespaces is forbidden: User \"system:serviceaccount:kafka-operator:kafka-operator-operator\" cannot list resource \"namespaces\" in API group \"\" at the cluster scope\r\nE0903 16:02:07.424939       1 reflector.go:178] pkg/mod/k8s.io/client-go@v0.18.2/tools/cache/reflector.go:125: Failed to list *v1.Namespace: namespaces is forbidden: User \"system:serviceaccount:kafka-operator:kafka-operator-operator\" cannot list resource \"namespaces\" in API group \"\" at the cluster scope\r\n{\"level\":\"info\",\"ts\":1599148927.426373,\"logger\":\"controllers.KafkaUser\",\"msg\":\"Reconciling KafkaUser\",\"kafkauser\":\"pushdelivery-stage/kafka-admin\",\"Request.Name\":\"kafka-admin\"}\r\n{\"level\":\"info\",\"ts\":1599148927.4276004,\"logger\":\"controllers.KafkaUser\",\"msg\":\"failed to reconcile user secret\",\"kafkauser\":\"pushdelivery-stage/kafka-admin\",\"Request.Name\":\"kafka-admin\"}\r\n{\"level\":\"error\",\"ts\":1599148927.4276366,\"logger\":\"controller-runtime.controller\",\"msg\":\"Reconciler error\",\"controller\":\"kafkauser\",\"request\":\"pushdelivery-stage/kafka-admin\",\"error\":\"could not update secret with jks: secrets \\\"kafka-admin\\\" is forbidden: User \\\"system:serviceaccount:kafka-operator:kafka-operator-operator\\\" cannot update resource \\\"secrets\\\" in API group \\\"\\\" in the namespace \\\"pushdelivery-stage\\\"\",\"stacktrace\":\"github.com/go-logr/zapr.(*zapLogger).Error\\n\\t/go/pkg/mod/github.com/go-logr/zapr@v0.1.1/zapr.go:128\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).reconcileHandler\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:258\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).processNextWorkItem\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:232\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).worker\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:211\\nk8s.io/apimachinery/pkg/util/wait.BackoffUntil.func1\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:155\\nk8s.io/apimachinery/pkg/util/wait.BackoffUntil\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:156\\nk8s.io/apimachinery/pkg/util/wait.JitterUntil\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:133\\nk8s.io/apimachinery/pkg/util/wait.Until\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:90\"}\r\n{\"level\":\"info\",\"ts\":1599148927.4311106,\"logger\":\"controllers.KafkaUser\",\"msg\":\"Reconciling KafkaUser\",\"kafkauser\":\"pushdelivery-stage/kafka-exporter\",\"Request.Name\":\"kafka-exporter\"}\r\n{\"level\":\"info\",\"ts\":1599148927.43218,\"logger\":\"controllers.KafkaUser\",\"msg\":\"failed to reconcile user secret\",\"kafkauser\":\"pushdelivery-stage/kafka-exporter\",\"Request.Name\":\"kafka-exporter\"}\r\n{\"level\":\"error\",\"ts\":1599148927.4322095,\"logger\":\"controller-runtime.controller\",\"msg\":\"Reconciler error\",\"controller\":\"kafkauser\",\"request\":\"pushdelivery-stage/kafka-exporter\",\"error\":\"could not update secret with jks: secrets \\\"kafka-exporter\\\" is forbidden: User \\\"system:serviceaccount:kafka-operator:kafka-operator-operator\\\" cannot update resource \\\"secrets\\\" in API group \\\"\\\" in the namespace \\\"pushdelivery-stage\\\"\",\"stacktrace\":\"github.com/go-logr/zapr.(*zapLogger).Error\\n\\t/go/pkg/mod/github.com/go-logr/zapr@v0.1.1/zapr.go:128\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).reconcileHandler\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:258\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).processNextWorkItem\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:232\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).worker\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:211\\nk8s.io/apimachinery/pkg/util/wait.BackoffUntil.func1\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:155\\nk8s.io/apimachinery/pkg/util/wait.BackoffUntil\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:156\\nk8s.io/apimachinery/pkg/util/wait.JitterUntil\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:133\\nk8s.io/apimachinery/pkg/util/wait.Until\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:90\"}\r\n{\"level\":\"info\",\"ts\":1599148927.5110118,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Kafka topic is marked for deletion\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\nE0903 16:02:08.383143       1 leaderelection.go:320] error retrieving resource lock kafka-operator/controller-leader-election-helper: configmaps \"controller-leader-election-helper\" is forbidden: User \"system:serviceaccount:kafka-operator:kafka-operator-operator\" cannot get resource \"configmaps\" in API group \"\" in the namespace \"kafka-operator\"\r\n{\"level\":\"info\",\"ts\":1599148928.4324532,\"logger\":\"controllers.KafkaUser\",\"msg\":\"Reconciling KafkaUser\",\"kafkauser\":\"pushdelivery-stage/kafka-admin\",\"Request.Name\":\"kafka-admin\"}\r\n{\"level\":\"info\",\"ts\":1599148928.4338923,\"logger\":\"controllers.KafkaUser\",\"msg\":\"failed to reconcile user secret\",\"kafkauser\":\"pushdelivery-stage/kafka-admin\",\"Request.Name\":\"kafka-admin\"}\r\n{\"level\":\"error\",\"ts\":1599148928.4339426,\"logger\":\"controller-runtime.controller\",\"msg\":\"Reconciler error\",\"controller\":\"kafkauser\",\"request\":\"pushdelivery-stage/kafka-admin\",\"error\":\"could not update secret with jks: secrets \\\"kafka-admin\\\" is forbidden: User \\\"system:serviceaccount:kafka-operator:kafka-operator-operator\\\" cannot update resource \\\"secrets\\\" in API group \\\"\\\" in the namespace \\\"pushdelivery-stage\\\"\",\"stacktrace\":\"github.com/go-logr/zapr.(*zapLogger).Error\\n\\t/go/pkg/mod/github.com/go-logr/zapr@v0.1.1/zapr.go:128\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).reconcileHandler\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:258\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).processNextWorkItem\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:232\\nsigs.k8s.io/controller-runtime/pkg/internal/controller.(*Controller).worker\\n\\t/go/pkg/mod/sigs.k8s.io/controller-runtime@v0.6.0/pkg/internal/controller/controller.go:211\\nk8s.io/apimachinery/pkg/util/wait.BackoffUntil.func1\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:155\\nk8s.io/apimachinery/pkg/util/wait.BackoffUntil\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:156\\nk8s.io/apimachinery/pkg/util/wait.JitterUntil\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:133\\nk8s.io/apimachinery/pkg/util/wait.Until\\n\\t/go/pkg/mod/k8s.io/apimachinery@v0.18.2/pkg/util/wait/wait.go:90\"}\r\n{\"level\":\"info\",\"ts\":1599148928.7050483,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Deleted topic\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148928.706356,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"failed to remove finalizer from kafkatopic\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n{\"level\":\"info\",\"ts\":1599148928.7064152,\"logger\":\"controllers.KafkaTopic\",\"msg\":\"Kafka client closed cleanly\",\"kafkatopic\":\"pushdelivery-stage/kafka-pushdelivery-stage-cruise-control-topic\",\"Request.Name\":\"kafka-pushdelivery-stage-cruise-control-topic\"}\r\n\r\n```\r\n\r\nThey go on for some time, alternating between \"forbidden\" errors and deleting my resources.\r\n\r\nI then performed a rollback of the helm chart:\r\n`helm rollback kafka-operator -n kafka-operator`\r\n\r\nwhich at least got the CRDs restored:\r\n```\r\n kubectl get kafkacluster -n pushdelivery-stage\r\nNo resources found in pushdelivery-stage namespace.\r\n```\r\nBut of course my cluster and all of my data was totally gone.\r\n\r\nThankfully I performed the upgrade in a non-production environment, otherwise this would have been truly disastrous!\r\n\r\nWhat went so wrong here?","reactions":{"url":"https://api.github.com/repos/banzaicloud/koperator/issues/444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/banzaicloud/koperator/issues/444/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"bonifaido","id":23779,"node_id":"MDQ6VXNlcjIzNzc5","avatar_url":"https://avatars.githubusercontent.com/u/23779?v=4","gravatar_id":"","url":"https://api.github.com/users/bonifaido","html_url":"https://github.com/bonifaido","followers_url":"https://api.github.com/users/bonifaido/followers","following_url":"https://api.github.com/users/bonifaido/following{/other_user}","gists_url":"https://api.github.com/users/bonifaido/gists{/gist_id}","starred_url":"https://api.github.com/users/bonifaido/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bonifaido/subscriptions","organizations_url":"https://api.github.com/users/bonifaido/orgs","repos_url":"https://api.github.com/users/bonifaido/repos","events_url":"https://api.github.com/users/bonifaido/events{/privacy}","received_events_url":"https://api.github.com/users/bonifaido/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-08T07:51:36Z","updated_at":"2020-10-08T07:51:36Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues/1139","repository_url":"https://api.github.com/repos/bank-vaults/bank-vaults","labels_url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues/1139/labels{/name}","comments_url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues/1139/comments","events_url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues/1139/events","html_url":"https://github.com/bank-vaults/bank-vaults/pull/1139","id":716459856,"node_id":"MDExOlB1bGxSZXF1ZXN0NDk5MTkyNTQ3","number":1139,"title":"operator: drop helm2 support in the chart","user":{"login":"bonifaido","id":23779,"node_id":"MDQ6VXNlcjIzNzc5","avatar_url":"https://avatars.githubusercontent.com/u/23779?v=4","gravatar_id":"","url":"https://api.github.com/users/bonifaido","html_url":"https://github.com/bonifaido","followers_url":"https://api.github.com/users/bonifaido/followers","following_url":"https://api.github.com/users/bonifaido/following{/other_user}","gists_url":"https://api.github.com/users/bonifaido/gists{/gist_id}","starred_url":"https://api.github.com/users/bonifaido/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bonifaido/subscriptions","organizations_url":"https://api.github.com/users/bonifaido/orgs","repos_url":"https://api.github.com/users/bonifaido/repos","events_url":"https://api.github.com/users/bonifaido/events{/privacy}","received_events_url":"https://api.github.com/users/bonifaido/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"bonifaido","id":23779,"node_id":"MDQ6VXNlcjIzNzc5","avatar_url":"https://avatars.githubusercontent.com/u/23779?v=4","gravatar_id":"","url":"https://api.github.com/users/bonifaido","html_url":"https://github.com/bonifaido","followers_url":"https://api.github.com/users/bonifaido/followers","following_url":"https://api.github.com/users/bonifaido/following{/other_user}","gists_url":"https://api.github.com/users/bonifaido/gists{/gist_id}","starred_url":"https://api.github.com/users/bonifaido/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bonifaido/subscriptions","organizations_url":"https://api.github.com/users/bonifaido/orgs","repos_url":"https://api.github.com/users/bonifaido/repos","events_url":"https://api.github.com/users/bonifaido/events{/privacy}","received_events_url":"https://api.github.com/users/bonifaido/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bonifaido","id":23779,"node_id":"MDQ6VXNlcjIzNzc5","avatar_url":"https://avatars.githubusercontent.com/u/23779?v=4","gravatar_id":"","url":"https://api.github.com/users/bonifaido","html_url":"https://github.com/bonifaido","followers_url":"https://api.github.com/users/bonifaido/followers","following_url":"https://api.github.com/users/bonifaido/following{/other_user}","gists_url":"https://api.github.com/users/bonifaido/gists{/gist_id}","starred_url":"https://api.github.com/users/bonifaido/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bonifaido/subscriptions","organizations_url":"https://api.github.com/users/bonifaido/orgs","repos_url":"https://api.github.com/users/bonifaido/repos","events_url":"https://api.github.com/users/bonifaido/events{/privacy}","received_events_url":"https://api.github.com/users/bonifaido/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2020-10-07T11:52:23Z","updated_at":"2020-10-08T11:07:37Z","closed_at":"2020-10-08T11:07:35Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":124260244,"node_id":"MDEwOlJlcG9zaXRvcnkxMjQyNjAyNDQ=","name":"bank-vaults","full_name":"bank-vaults/bank-vaults","private":false,"owner":{"login":"bank-vaults","id":129937617,"node_id":"O_kgDOB76w0Q","avatar_url":"https://avatars.githubusercontent.com/u/129937617?v=4","gravatar_id":"","url":"https://api.github.com/users/bank-vaults","html_url":"https://github.com/bank-vaults","followers_url":"https://api.github.com/users/bank-vaults/followers","following_url":"https://api.github.com/users/bank-vaults/following{/other_user}","gists_url":"https://api.github.com/users/bank-vaults/gists{/gist_id}","starred_url":"https://api.github.com/users/bank-vaults/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bank-vaults/subscriptions","organizations_url":"https://api.github.com/users/bank-vaults/orgs","repos_url":"https://api.github.com/users/bank-vaults/repos","events_url":"https://api.github.com/users/bank-vaults/events{/privacy}","received_events_url":"https://api.github.com/users/bank-vaults/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bank-vaults/bank-vaults","description":"A Vault swiss-army knife: A CLI tool to init, unseal and configure Vault (auth methods, secret engines).","fork":false,"url":"https://api.github.com/repos/bank-vaults/bank-vaults","forks_url":"https://api.github.com/repos/bank-vaults/bank-vaults/forks","keys_url":"https://api.github.com/repos/bank-vaults/bank-vaults/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bank-vaults/bank-vaults/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bank-vaults/bank-vaults/teams","hooks_url":"https://api.github.com/repos/bank-vaults/bank-vaults/hooks","issue_events_url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues/events{/number}","events_url":"https://api.github.com/repos/bank-vaults/bank-vaults/events","assignees_url":"https://api.github.com/repos/bank-vaults/bank-vaults/assignees{/user}","branches_url":"https://api.github.com/repos/bank-vaults/bank-vaults/branches{/branch}","tags_url":"https://api.github.com/repos/bank-vaults/bank-vaults/tags","blobs_url":"https://api.github.com/repos/bank-vaults/bank-vaults/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bank-vaults/bank-vaults/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bank-vaults/bank-vaults/git/refs{/sha}","trees_url":"https://api.github.com/repos/bank-vaults/bank-vaults/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bank-vaults/bank-vaults/statuses/{sha}","languages_url":"https://api.github.com/repos/bank-vaults/bank-vaults/languages","stargazers_url":"https://api.github.com/repos/bank-vaults/bank-vaults/stargazers","contributors_url":"https://api.github.com/repos/bank-vaults/bank-vaults/contributors","subscribers_url":"https://api.github.com/repos/bank-vaults/bank-vaults/subscribers","subscription_url":"https://api.github.com/repos/bank-vaults/bank-vaults/subscription","commits_url":"https://api.github.com/repos/bank-vaults/bank-vaults/commits{/sha}","git_commits_url":"https://api.github.com/repos/bank-vaults/bank-vaults/git/commits{/sha}","comments_url":"https://api.github.com/repos/bank-vaults/bank-vaults/comments{/number}","issue_comment_url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues/comments{/number}","contents_url":"https://api.github.com/repos/bank-vaults/bank-vaults/contents/{+path}","compare_url":"https://api.github.com/repos/bank-vaults/bank-vaults/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bank-vaults/bank-vaults/merges","archive_url":"https://api.github.com/repos/bank-vaults/bank-vaults/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bank-vaults/bank-vaults/downloads","issues_url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues{/number}","pulls_url":"https://api.github.com/repos/bank-vaults/bank-vaults/pulls{/number}","milestones_url":"https://api.github.com/repos/bank-vaults/bank-vaults/milestones{/number}","notifications_url":"https://api.github.com/repos/bank-vaults/bank-vaults/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bank-vaults/bank-vaults/labels{/name}","releases_url":"https://api.github.com/repos/bank-vaults/bank-vaults/releases{/id}","deployments_url":"https://api.github.com/repos/bank-vaults/bank-vaults/deployments","created_at":"2018-03-07T16:02:20Z","updated_at":"2025-11-08T09:03:11Z","pushed_at":"2025-11-08T09:03:09Z","git_url":"git://github.com/bank-vaults/bank-vaults.git","ssh_url":"git@github.com:bank-vaults/bank-vaults.git","clone_url":"https://github.com/bank-vaults/bank-vaults.git","svn_url":"https://github.com/bank-vaults/bank-vaults","homepage":"https://bank-vaults.dev","size":25895,"stargazers_count":2195,"watchers_count":2195,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":473,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":20,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["alibaba-cloud","amazon","azure","golang","google-cloud","helm-chart","hsm","istio","kubernetes","kubernetes-secrets","mutating-webhook","operator","secret","security","unseal","vault","vault-client","vault-operator","vault-unsealing"],"visibility":"public","forks":473,"open_issues":20,"watchers":2195,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/bank-vaults/bank-vaults/pulls/1139","html_url":"https://github.com/bank-vaults/bank-vaults/pull/1139","diff_url":"https://github.com/bank-vaults/bank-vaults/pull/1139.diff","patch_url":"https://github.com/bank-vaults/bank-vaults/pull/1139.patch","merged_at":"2020-10-08T11:07:35Z"},"body":"Signed-off-by: Nandor Kracser <bonifaido@gmail.com>\r\n\r\n| Q               | A\r\n| --------------- | ---\r\n| Bug fix?        | yes\r\n| New feature?    | no\r\n| API breaks?     | no\r\n| Deprecations?   | yes\r\n| Related tickets | fixes #1059, fixes #1097 \r\n| License         | Apache 2.0\r\n\r\n\r\n### What's in this PR?\r\n<!-- Explain the contents of the PR. Give an overview about the implementation, which decisions were made and why. -->\r\nDropping Helm 2 support in the operator chart. We keep the compatibility in the other charts for a while, but officially we are not supporting Helm 2 from now on.\r\n\r\n### Why?\r\n<!-- Which problem does the PR fix? (Please remove this section if you linked an issue above) -->\r\nHelm 2 is reaching the end of life this month, and we had a hacky helper template which caused some issues in Helm linters.\r\n\r\n### Additional context\r\n<!-- Additional information we should know about (eg. edge cases, steps you followed to test the implementation) (Please remove this section if you don't need it) -->\r\n### Helm2 -> Helm3 migration\r\n\r\nIf you have installed the chart with Helm 2 and now you are trying to upgrade it with Helm3 you have to be careful because Helm 3 will delete the Vault CRD from your cluster during the upgrade from Helm 2 (see https://github.com/helm/helm/issues/7279). To avoid that follow these steps:\r\n\r\n```bash\r\n# Make sure you are using Helm 3\r\nhelm version\r\n\r\n# version.BuildInfo{Version:\"v3.3.4\", GitCommit:\"a61ce5633af99708171414353ed49547cf05013d\", GitTreeState:\"clean\", GoVersion:\"go1.14.9\"}\r\n\r\n# Get the latest vault-operator chart\r\nhelm repo add banzaicloud-stable https://kubernetes-charts.banzaicloud.com\r\nhelm repo update\r\n\r\n# Delete all Helm2 releases of the vault-operator manually wit kubectl to keep the resources in the cluster\r\nkubectl delete configmaps -n kube-system vault-operator.v1\r\n# Delete all resources except the Vault CRD\r\nhelm template vault-operator banzaicloud-stable/vault-operator | kubectl delete -f -\r\n# Install the new Helm3 version of the chart\r\nhelm upgrade --install vault-operator banzaicloud-stable/charts/vault-operator\r\n```\r\n\r\n\r\n### Checklist\r\n<!-- Place an '[x]' (no spaces) in all applicable fields. Please remove unrelated fields. -->\r\n\r\n- [x] Code meets the [Developer Guide](https://github.com/banzaicloud/developer-guide)\r\n- [x] User guide and development docs updated (if needed)\r\n- [x] Related Helm chart(s) updated (if needed)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues/1139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bank-vaults/bank-vaults/issues/1139/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"actor":{"login":"brokenjacobs","id":3159463,"node_id":"MDQ6VXNlcjMxNTk0NjM=","avatar_url":"https://avatars.githubusercontent.com/u/3159463?v=4","gravatar_id":"","url":"https://api.github.com/users/brokenjacobs","html_url":"https://github.com/brokenjacobs","followers_url":"https://api.github.com/users/brokenjacobs/followers","following_url":"https://api.github.com/users/brokenjacobs/following{/other_user}","gists_url":"https://api.github.com/users/brokenjacobs/gists{/gist_id}","starred_url":"https://api.github.com/users/brokenjacobs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brokenjacobs/subscriptions","organizations_url":"https://api.github.com/users/brokenjacobs/orgs","repos_url":"https://api.github.com/users/brokenjacobs/repos","events_url":"https://api.github.com/users/brokenjacobs/events{/privacy}","received_events_url":"https://api.github.com/users/brokenjacobs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-26T18:56:57Z","updated_at":"2020-10-26T18:56:57Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues/3877","repository_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator","labels_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues/3877/labels{/name}","comments_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues/3877/comments","events_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues/3877/events","html_url":"https://github.com/strimzi/strimzi-kafka-operator/issues/3877","id":729619862,"node_id":"MDU6SXNzdWU3Mjk2MTk4NjI=","number":3877,"title":"[Bug] unexpected removing all kafka resources when upgrade using helm3","user":{"login":"gricuk","id":9693387,"node_id":"MDQ6VXNlcjk2OTMzODc=","avatar_url":"https://avatars.githubusercontent.com/u/9693387?v=4","gravatar_id":"","url":"https://api.github.com/users/gricuk","html_url":"https://github.com/gricuk","followers_url":"https://api.github.com/users/gricuk/followers","following_url":"https://api.github.com/users/gricuk/following{/other_user}","gists_url":"https://api.github.com/users/gricuk/gists{/gist_id}","starred_url":"https://api.github.com/users/gricuk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gricuk/subscriptions","organizations_url":"https://api.github.com/users/gricuk/orgs","repos_url":"https://api.github.com/users/gricuk/repos","events_url":"https://api.github.com/users/gricuk/events{/privacy}","received_events_url":"https://api.github.com/users/gricuk/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":371937798,"node_id":"MDU6TGFiZWwzNzE5Mzc3OTg=","url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":33,"created_at":"2020-10-26T14:36:22Z","updated_at":"2021-05-11T00:05:51Z","closed_at":"2021-05-11T00:05:51Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":58194180,"node_id":"MDEwOlJlcG9zaXRvcnk1ODE5NDE4MA==","name":"strimzi-kafka-operator","full_name":"strimzi/strimzi-kafka-operator","private":false,"owner":{"login":"strimzi","id":34767428,"node_id":"MDEyOk9yZ2FuaXphdGlvbjM0NzY3NDI4","avatar_url":"https://avatars.githubusercontent.com/u/34767428?v=4","gravatar_id":"","url":"https://api.github.com/users/strimzi","html_url":"https://github.com/strimzi","followers_url":"https://api.github.com/users/strimzi/followers","following_url":"https://api.github.com/users/strimzi/following{/other_user}","gists_url":"https://api.github.com/users/strimzi/gists{/gist_id}","starred_url":"https://api.github.com/users/strimzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strimzi/subscriptions","organizations_url":"https://api.github.com/users/strimzi/orgs","repos_url":"https://api.github.com/users/strimzi/repos","events_url":"https://api.github.com/users/strimzi/events{/privacy}","received_events_url":"https://api.github.com/users/strimzi/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/strimzi/strimzi-kafka-operator","description":"Apache KafkaÂ® running on Kubernetes","fork":false,"url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator","forks_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/forks","keys_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/keys{/key_id}","collaborators_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/teams","hooks_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/hooks","issue_events_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues/events{/number}","events_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/events","assignees_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/assignees{/user}","branches_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/branches{/branch}","tags_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/tags","blobs_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/git/refs{/sha}","trees_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/git/trees{/sha}","statuses_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/statuses/{sha}","languages_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/languages","stargazers_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/stargazers","contributors_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/contributors","subscribers_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/subscribers","subscription_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/subscription","commits_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/commits{/sha}","git_commits_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/git/commits{/sha}","comments_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/comments{/number}","issue_comment_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues/comments{/number}","contents_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/contents/{+path}","compare_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/compare/{base}...{head}","merges_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/merges","archive_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/downloads","issues_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues{/number}","pulls_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/pulls{/number}","milestones_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/milestones{/number}","notifications_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/labels{/name}","releases_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/releases{/id}","deployments_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/deployments","created_at":"2016-05-06T08:52:33Z","updated_at":"2025-11-09T15:31:30Z","pushed_at":"2025-11-09T15:31:24Z","git_url":"git://github.com/strimzi/strimzi-kafka-operator.git","ssh_url":"git@github.com:strimzi/strimzi-kafka-operator.git","clone_url":"https://github.com/strimzi/strimzi-kafka-operator.git","svn_url":"https://github.com/strimzi/strimzi-kafka-operator","homepage":"https://strimzi.io/","size":86174,"stargazers_count":5532,"watchers_count":5532,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":1420,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":126,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":true,"topics":["data-stream","data-streaming","data-streams","hacktoberfest","kafka","kafka-connect","kafka-streams","kubernetes","kubernetes-controller","kubernetes-operator","messaging","openshift"],"visibility":"public","forks":1420,"open_issues":126,"watchers":5532,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"**Describe the bug**\r\nI'm using strimzi operator v0.19.0 and tried upgrade to 0.20.0. When I've ran helm upgrade procedure all my resources (users, topics, clusters) was removed.\r\nI try to reproduce problem with fresh installed cluster and situation was reproduced again.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n```\r\n1. helm install strimzi-kafka strimzi/strimzi-kafka-operator --namespace kafka --set watchNamespaces=\"{kafka,test-kafka}\" --version=0.19.0\r\n2. create cluster, users and topics from manifests (apiVersion: v1beta1)\r\n3. helm upgrade strimzi-kafka strimzi/strimzi-kafka-operator --namespace kafka --set watchNamespaces=\"{kafka,test-kafka}\"\r\nkubectl get crd| grep kafka| wc -l\r\n       0\r\n```\r\nAfter the steps above my cluster and users/topics was removed. The operator pod try to start and crashed with the following error:\r\n```\r\n2020-10-26 14:35:47 WARN  WatchConnectionManager:198 - Exec Failure: HTTP 404, Status: 404 - 404 page not found\r\n\r\njava.net.ProtocolException: Expected HTTP 101 response but was '404 Not Found'\r\n\tat okhttp3.internal.ws.RealWebSocket.checkResponse(RealWebSocket.java:229) [com.squareup.okhttp3.okhttp-3.12.6.jar:?]\r\n\tat okhttp3.internal.ws.RealWebSocket$2.onResponse(RealWebSocket.java:196) [com.squareup.okhttp3.okhttp-3.12.6.jar:?]\r\n\tat okhttp3.RealCall$AsyncCall.execute(RealCall.java:203) [com.squareup.okhttp3.okhttp-3.12.6.jar:?]\r\n\tat okhttp3.internal.NamedRunnable.run(NamedRunnable.java:32) [com.squareup.okhttp3.okhttp-3.12.6.jar:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n2020-10-26 14:35:47 WARN  WatchConnectionManager:198 - Exec Failure: HTTP 404, Status: 404 - 404 page not found\r\n\r\njava.net.ProtocolException: Expected HTTP 101 response but was '404 Not Found'\r\n\tat okhttp3.internal.ws.RealWebSocket.checkResponse(RealWebSocket.java:229) [com.squareup.okhttp3.okhttp-3.12.6.jar:?]\r\n\tat okhttp3.internal.ws.RealWebSocket$2.onResponse(RealWebSocket.java:196) [com.squareup.okhttp3.okhttp-3.12.6.jar:?]\r\n\tat okhttp3.RealCall$AsyncCall.execute(RealCall.java:203) [com.squareup.okhttp3.okhttp-3.12.6.jar:?]\r\n\tat okhttp3.internal.NamedRunnable.run(NamedRunnable.java:32) [com.squareup.okhttp3.okhttp-3.12.6.jar:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\n```\r\n\r\n**Expected behavior**\r\nThe operator should be updated without removing resources.\r\n\r\n**Environment (please complete the following information):**\r\n - Strimzi version: 0.19.0\r\n - Installation method: Helm chart\r\n - Kubernetes cluster: v.1.18.8\r\n - Infrastructure: Rancher2 on Amazon EC2 instances\r\n\r\n","reactions":{"url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues/3877/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/strimzi/strimzi-kafka-operator/issues/3877/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"TessaIO","id":161601825,"node_id":"U_kgDOCaHZIQ","avatar_url":"https://avatars.githubusercontent.com/u/161601825?v=4","gravatar_id":"","url":"https://api.github.com/users/TessaIO","html_url":"https://github.com/TessaIO","followers_url":"https://api.github.com/users/TessaIO/followers","following_url":"https://api.github.com/users/TessaIO/following{/other_user}","gists_url":"https://api.github.com/users/TessaIO/gists{/gist_id}","starred_url":"https://api.github.com/users/TessaIO/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TessaIO/subscriptions","organizations_url":"https://api.github.com/users/TessaIO/orgs","repos_url":"https://api.github.com/users/TessaIO/repos","events_url":"https://api.github.com/users/TessaIO/events{/privacy}","received_events_url":"https://api.github.com/users/TessaIO/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-24T14:15:42Z","updated_at":"2024-06-24T14:15:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/datainfrahq/druid-operator/issues/170","repository_url":"https://api.github.com/repos/datainfrahq/druid-operator","labels_url":"https://api.github.com/repos/datainfrahq/druid-operator/issues/170/labels{/name}","comments_url":"https://api.github.com/repos/datainfrahq/druid-operator/issues/170/comments","events_url":"https://api.github.com/repos/datainfrahq/druid-operator/issues/170/events","html_url":"https://github.com/datainfrahq/druid-operator/issues/170","id":2352746816,"node_id":"I_kwDOJAblsM6MPBFA","number":170,"title":"Operator takes down druid cluster upon re-creation","user":{"login":"mariuskimmina","id":38843153,"node_id":"MDQ6VXNlcjM4ODQzMTUz","avatar_url":"https://avatars.githubusercontent.com/u/38843153?v=4","gravatar_id":"","url":"https://api.github.com/users/mariuskimmina","html_url":"https://github.com/mariuskimmina","followers_url":"https://api.github.com/users/mariuskimmina/followers","following_url":"https://api.github.com/users/mariuskimmina/following{/other_user}","gists_url":"https://api.github.com/users/mariuskimmina/gists{/gist_id}","starred_url":"https://api.github.com/users/mariuskimmina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mariuskimmina/subscriptions","organizations_url":"https://api.github.com/users/mariuskimmina/orgs","repos_url":"https://api.github.com/users/mariuskimmina/repos","events_url":"https://api.github.com/users/mariuskimmina/events{/privacy}","received_events_url":"https://api.github.com/users/mariuskimmina/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2024-06-14T07:41:55Z","updated_at":"2024-06-24T14:18:10Z","closed_at":"2024-06-24T14:18:10Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":604431792,"node_id":"R_kgDOJAblsA","name":"druid-operator","full_name":"datainfrahq/druid-operator","private":false,"owner":{"login":"datainfrahq","id":125942261,"node_id":"O_kgDOB4G59Q","avatar_url":"https://avatars.githubusercontent.com/u/125942261?v=4","gravatar_id":"","url":"https://api.github.com/users/datainfrahq","html_url":"https://github.com/datainfrahq","followers_url":"https://api.github.com/users/datainfrahq/followers","following_url":"https://api.github.com/users/datainfrahq/following{/other_user}","gists_url":"https://api.github.com/users/datainfrahq/gists{/gist_id}","starred_url":"https://api.github.com/users/datainfrahq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/datainfrahq/subscriptions","organizations_url":"https://api.github.com/users/datainfrahq/orgs","repos_url":"https://api.github.com/users/datainfrahq/repos","events_url":"https://api.github.com/users/datainfrahq/events{/privacy}","received_events_url":"https://api.github.com/users/datainfrahq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/datainfrahq/druid-operator","description":"Apache Druid On Kubernetes","fork":false,"url":"https://api.github.com/repos/datainfrahq/druid-operator","forks_url":"https://api.github.com/repos/datainfrahq/druid-operator/forks","keys_url":"https://api.github.com/repos/datainfrahq/druid-operator/keys{/key_id}","collaborators_url":"https://api.github.com/repos/datainfrahq/druid-operator/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/datainfrahq/druid-operator/teams","hooks_url":"https://api.github.com/repos/datainfrahq/druid-operator/hooks","issue_events_url":"https://api.github.com/repos/datainfrahq/druid-operator/issues/events{/number}","events_url":"https://api.github.com/repos/datainfrahq/druid-operator/events","assignees_url":"https://api.github.com/repos/datainfrahq/druid-operator/assignees{/user}","branches_url":"https://api.github.com/repos/datainfrahq/druid-operator/branches{/branch}","tags_url":"https://api.github.com/repos/datainfrahq/druid-operator/tags","blobs_url":"https://api.github.com/repos/datainfrahq/druid-operator/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/datainfrahq/druid-operator/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/datainfrahq/druid-operator/git/refs{/sha}","trees_url":"https://api.github.com/repos/datainfrahq/druid-operator/git/trees{/sha}","statuses_url":"https://api.github.com/repos/datainfrahq/druid-operator/statuses/{sha}","languages_url":"https://api.github.com/repos/datainfrahq/druid-operator/languages","stargazers_url":"https://api.github.com/repos/datainfrahq/druid-operator/stargazers","contributors_url":"https://api.github.com/repos/datainfrahq/druid-operator/contributors","subscribers_url":"https://api.github.com/repos/datainfrahq/druid-operator/subscribers","subscription_url":"https://api.github.com/repos/datainfrahq/druid-operator/subscription","commits_url":"https://api.github.com/repos/datainfrahq/druid-operator/commits{/sha}","git_commits_url":"https://api.github.com/repos/datainfrahq/druid-operator/git/commits{/sha}","comments_url":"https://api.github.com/repos/datainfrahq/druid-operator/comments{/number}","issue_comment_url":"https://api.github.com/repos/datainfrahq/druid-operator/issues/comments{/number}","contents_url":"https://api.github.com/repos/datainfrahq/druid-operator/contents/{+path}","compare_url":"https://api.github.com/repos/datainfrahq/druid-operator/compare/{base}...{head}","merges_url":"https://api.github.com/repos/datainfrahq/druid-operator/merges","archive_url":"https://api.github.com/repos/datainfrahq/druid-operator/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/datainfrahq/druid-operator/downloads","issues_url":"https://api.github.com/repos/datainfrahq/druid-operator/issues{/number}","pulls_url":"https://api.github.com/repos/datainfrahq/druid-operator/pulls{/number}","milestones_url":"https://api.github.com/repos/datainfrahq/druid-operator/milestones{/number}","notifications_url":"https://api.github.com/repos/datainfrahq/druid-operator/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/datainfrahq/druid-operator/labels{/name}","releases_url":"https://api.github.com/repos/datainfrahq/druid-operator/releases{/id}","deployments_url":"https://api.github.com/repos/datainfrahq/druid-operator/deployments","created_at":"2023-02-21T03:27:56Z","updated_at":"2025-10-28T08:42:44Z","pushed_at":"2025-10-08T14:39:28Z","git_url":"git://github.com/datainfrahq/druid-operator.git","ssh_url":"git@github.com:datainfrahq/druid-operator.git","clone_url":"https://github.com/datainfrahq/druid-operator.git","svn_url":"https://github.com/datainfrahq/druid-operator","homepage":"","size":66816,"stargazers_count":122,"watchers_count":122,"language":"Go","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":53,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":50,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["druid","golang","kubernetes","kubernetes-operator"],"visibility":"public","forks":53,"open_issues":50,"watchers":122,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"We currently have the druid-operator and the druid cluster in the same namespace. \r\nWe'll soon add a second druid cluster and to keep things cleaner we would like to move the operator to it's own namespace but while we were testing this we ran into a couple of issues.\r\n\r\nFirst, here is how we imaged this should work:\r\n\r\n1. Take down the current operator\r\n2. All CRDs remain and the druid cluster stays alive\r\n3. Bring up the operator again in the new namespace\r\n4. The operator picks up the existing CRDs and ClusterRoles and things keep working\r\n5. No clusters get destroyed\r\n\r\nStep 1 and 2 worked as expected, we could bring down the operator without affecting our existing druid cluster.\r\nOn step 3 we faced a couple of issues, first the operator did not support helms `--skip-crd` flag which prevented the new operator from coming up while the CRD already existed, a fix for this already got merged [here](https://github.com/datainfrahq/druid-operator/pull/162)\r\n\r\nA similar issue then occurs for clusterRoles, we fixed this in our local chart by adding an option to skip the clusterRoles as well and of course we can also open a PR for this.\r\n\r\nNow, with both of the above in place we were able to bring up the druid operator in it's own namespace but once the operator was up it somehow removed the existing CRD and because of the owner dependence the whole druid cluster was gone with it.\r\nWe are yet to figure out why exactly the CRD got removed. It also did not create a new one, we were left  with a running operator but no druid cluster.\r\n\r\nWe saw the following events in our kubernetes cluster which seem to be related\r\n\r\n```\r\ndruid             11m         Normal    DruidOperatorUpdateSuccess        druid/sb2                                                                        Updated [sb2:*v1alpha1.Druid].\r\n```\r\n\r\n```\r\ndruid             11m         Normal    DruidOperatorDeleteSuccess        druid/sb2                                                                        Successfully deleted object [data-volume-druid-sb2-middlemanagers-2:*v1.PersistentVolumeClaim] in namespace [druid]\r\n```\r\n\r\nThat said, we haven't yet found the root cause of the operator removing the CRD \r\n\r\n","reactions":{"url":"https://api.github.com/repos/datainfrahq/druid-operator/issues/170/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/datainfrahq/druid-operator/issues/170/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]