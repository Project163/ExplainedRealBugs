{"url":"https://api.github.com/repos/helm/helm/issues/6361","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/6361/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/6361/comments","events_url":"https://api.github.com/repos/helm/helm/issues/6361/events","html_url":"https://github.com/helm/helm/issues/6361","id":489873920,"node_id":"MDU6SXNzdWU0ODk4NzM5MjA=","number":6361,"title":"unable to retrieve the complete list of server APIs","user":{"login":"planetf1","id":7292002,"node_id":"MDQ6VXNlcjcyOTIwMDI=","avatar_url":"https://avatars.githubusercontent.com/u/7292002?v=4","gravatar_id":"","url":"https://api.github.com/users/planetf1","html_url":"https://github.com/planetf1","followers_url":"https://api.github.com/users/planetf1/followers","following_url":"https://api.github.com/users/planetf1/following{/other_user}","gists_url":"https://api.github.com/users/planetf1/gists{/gist_id}","starred_url":"https://api.github.com/users/planetf1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/planetf1/subscriptions","organizations_url":"https://api.github.com/users/planetf1/orgs","repos_url":"https://api.github.com/users/planetf1/repos","events_url":"https://api.github.com/users/planetf1/events{/privacy}","received_events_url":"https://api.github.com/users/planetf1/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":778135666,"node_id":"MDU6TGFiZWw3NzgxMzU2NjY=","url":"https://api.github.com/repos/helm/helm/labels/bug","name":"bug","color":"e11d21","default":true,"description":"Categorizes issue or PR as related to a bug."},{"id":926755770,"node_id":"MDU6TGFiZWw5MjY3NTU3NzA=","url":"https://api.github.com/repos/helm/helm/labels/v3.x","name":"v3.x","color":"e82969","default":false,"description":"Issues and Pull Requests related to the major version v3"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/helm/helm/milestones/81","html_url":"https://github.com/helm/helm/milestone/81","labels_url":"https://api.github.com/repos/helm/helm/milestones/81/labels","id":4911686,"node_id":"MDk6TWlsZXN0b25lNDkxMTY4Ng==","number":81,"title":"3.0.2","description":"","creator":{"login":"mattfarina","id":62991,"node_id":"MDQ6VXNlcjYyOTkx","avatar_url":"https://avatars.githubusercontent.com/u/62991?v=4","gravatar_id":"","url":"https://api.github.com/users/mattfarina","html_url":"https://github.com/mattfarina","followers_url":"https://api.github.com/users/mattfarina/followers","following_url":"https://api.github.com/users/mattfarina/following{/other_user}","gists_url":"https://api.github.com/users/mattfarina/gists{/gist_id}","starred_url":"https://api.github.com/users/mattfarina/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattfarina/subscriptions","organizations_url":"https://api.github.com/users/mattfarina/orgs","repos_url":"https://api.github.com/users/mattfarina/repos","events_url":"https://api.github.com/users/mattfarina/events{/privacy}","received_events_url":"https://api.github.com/users/mattfarina/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":8,"state":"closed","created_at":"2019-12-07T19:07:46Z","updated_at":"2019-12-17T18:55:03Z","due_on":null,"closed_at":"2019-12-17T18:55:03Z"},"comments":64,"created_at":"2019-09-05T16:34:11Z","updated_at":"2024-12-12T17:56:33Z","closed_at":"2019-12-17T17:31:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- If you need help or think you have found a bug, please help us with your issue by entering the following information (otherwise you can delete this text): -->\r\n\r\nOutput of `helm version`:\r\nversion.BuildInfo{Version:\"v3.0+unreleased\", GitCommit:\"180db556aaf45f34516f8ddb9ddac28d71736a3e\", GitTreeState:\"clean\", GoVersion:\"go1.13\"}\r\n\r\nOutput of `kubectl version`:\r\nlient Version: version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.3\", GitCommit:\"2d3c76f9091b6bec110a5e63777c332469e0cba2\", GitTreeState:\"clean\", BuildDate:\"2019-08-19T12:36:28Z\", GoVersion:\"go1.12.9\", Compiler:\"gc\", Platform:\"darwin/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"15\", GitVersion:\"v1.15.3+IKS\", GitCommit:\"66a72e7aa8fd2dbf64af493f50f943d7f7067916\", GitTreeState:\"clean\", BuildDate:\"2019-08-23T08:07:38Z\", GoVersion:\"go1.12.9\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\nCloud Provider/Platform (AKS, GKE, Minikube etc.): \r\nIBM Cloud \r\n\r\nHelm chart deployment fails with:\r\n```\r\n➜  charts git:(h2update2) helm install vdc -f ~/etc/cloud-noes.yaml vdc                                                                                                                                <<<\r\ncoalesce.go:155: warning: skipped value for image: Not a table.\r\nError: could not get apiVersions from Kubernetes: unable to retrieve the complete list of server APIs: custom.metrics.k8s.io/v1beta1: the server is currently unable to handle the request\r\n```\r\n(The first error is in a confluent chart... here I discuss the second issue)\r\n\r\nLooking at the error I see a similar problem with\r\n```\r\n➜  charts git:(h2update2) kubectl api-resources\r\nNAME                              SHORTNAMES      APIGROUP                           NAMESPACED   KIND\r\nbindings                                                                             true         Binding\r\ncomponentstatuses                 cs                                                 false        ComponentStatus\r\nconfigmaps                        cm                                                 true         ConfigMap\r\nendpoints                         ep                                                 true         Endpoints\r\nevents                            ev                                                 true         Event\r\nlimitranges                       limits                                             true         LimitRange\r\nnamespaces                        ns                                                 false        Namespace\r\nnodes                             no                                                 false        Node\r\npersistentvolumeclaims            pvc                                                true         PersistentVolumeClaim\r\npersistentvolumes                 pv                                                 false        PersistentVolume\r\npods                              po                                                 true         Pod\r\npodtemplates                                                                         true         PodTemplate\r\nreplicationcontrollers            rc                                                 true         ReplicationController\r\nresourcequotas                    quota                                              true         ResourceQuota\r\nsecrets                                                                              true         Secret\r\nserviceaccounts                   sa                                                 true         ServiceAccount\r\nservices                          svc                                                true         Service\r\nmutatingwebhookconfigurations                     admissionregistration.k8s.io       false        MutatingWebhookConfiguration\r\nvalidatingwebhookconfigurations                   admissionregistration.k8s.io       false        ValidatingWebhookConfiguration\r\ncustomresourcedefinitions         crd,crds        apiextensions.k8s.io               false        CustomResourceDefinition\r\napiservices                                       apiregistration.k8s.io             false        APIService\r\ncontrollerrevisions                               apps                               true         ControllerRevision\r\ndaemonsets                        ds              apps                               true         DaemonSet\r\ndeployments                       deploy          apps                               true         Deployment\r\nreplicasets                       rs              apps                               true         ReplicaSet\r\nstatefulsets                      sts             apps                               true         StatefulSet\r\nmeshpolicies                                      authentication.istio.io            false        MeshPolicy\r\npolicies                                          authentication.istio.io            true         Policy\r\ntokenreviews                                      authentication.k8s.io              false        TokenReview\r\nlocalsubjectaccessreviews                         authorization.k8s.io               true         LocalSubjectAccessReview\r\nselfsubjectaccessreviews                          authorization.k8s.io               false        SelfSubjectAccessReview\r\nselfsubjectrulesreviews                           authorization.k8s.io               false        SelfSubjectRulesReview\r\nsubjectaccessreviews                              authorization.k8s.io               false        SubjectAccessReview\r\nhorizontalpodautoscalers          hpa             autoscaling                        true         HorizontalPodAutoscaler\r\nmetrics                                           autoscaling.internal.knative.dev   true         Metric\r\npodautoscalers                    kpa,pa          autoscaling.internal.knative.dev   true         PodAutoscaler\r\ncronjobs                          cj              batch                              true         CronJob\r\njobs                                              batch                              true         Job\r\nimages                            img             caching.internal.knative.dev       true         Image\r\ncertificatesigningrequests        csr             certificates.k8s.io                false        CertificateSigningRequest\r\ncertificates                      cert,certs      certmanager.k8s.io                 true         Certificate\r\nchallenges                                        certmanager.k8s.io                 true         Challenge\r\nclusterissuers                                    certmanager.k8s.io                 false        ClusterIssuer\r\nissuers                                           certmanager.k8s.io                 true         Issuer\r\norders                                            certmanager.k8s.io                 true         Order\r\nadapters                                          config.istio.io                    true         adapter\r\nattributemanifests                                config.istio.io                    true         attributemanifest\r\nhandlers                                          config.istio.io                    true         handler\r\nhttpapispecbindings                               config.istio.io                    true         HTTPAPISpecBinding\r\nhttpapispecs                                      config.istio.io                    true         HTTPAPISpec\r\ninstances                                         config.istio.io                    true         instance\r\nquotaspecbindings                                 config.istio.io                    true         QuotaSpecBinding\r\nquotaspecs                                        config.istio.io                    true         QuotaSpec\r\nrules                                             config.istio.io                    true         rule\r\ntemplates                                         config.istio.io                    true         template\r\nleases                                            coordination.k8s.io                true         Lease\r\nbrokers                                           eventing.knative.dev               true         Broker\r\nchannels                          chan            eventing.knative.dev               true         Channel\r\nclusterchannelprovisioners        ccp             eventing.knative.dev               false        ClusterChannelProvisioner\r\neventtypes                                        eventing.knative.dev               true         EventType\r\nsubscriptions                     sub             eventing.knative.dev               true         Subscription\r\ntriggers                                          eventing.knative.dev               true         Trigger\r\nevents                            ev              events.k8s.io                      true         Event\r\ndaemonsets                        ds              extensions                         true         DaemonSet\r\ndeployments                       deploy          extensions                         true         Deployment\r\ningresses                         ing             extensions                         true         Ingress\r\nnetworkpolicies                   netpol          extensions                         true         NetworkPolicy\r\npodsecuritypolicies               psp             extensions                         false        PodSecurityPolicy\r\nreplicasets                       rs              extensions                         true         ReplicaSet\r\nchannels                          ch              messaging.knative.dev              true         Channel\r\nchoices                                           messaging.knative.dev              true         Choice\r\ninmemorychannels                  imc             messaging.knative.dev              true         InMemoryChannel\r\nsequences                                         messaging.knative.dev              true         Sequence\r\nnodes                                             metrics.k8s.io                     false        NodeMetrics\r\npods                                              metrics.k8s.io                     true         PodMetrics\r\ncertificates                      kcert           networking.internal.knative.dev    true         Certificate\r\nclusteringresses                                  networking.internal.knative.dev    false        ClusterIngress\r\ningresses                         ing             networking.internal.knative.dev    true         Ingress\r\nserverlessservices                sks             networking.internal.knative.dev    true         ServerlessService\r\ndestinationrules                  dr              networking.istio.io                true         DestinationRule\r\nenvoyfilters                                      networking.istio.io                true         EnvoyFilter\r\ngateways                          gw              networking.istio.io                true         Gateway\r\nserviceentries                    se              networking.istio.io                true         ServiceEntry\r\nsidecars                                          networking.istio.io                true         Sidecar\r\nvirtualservices                   vs              networking.istio.io                true         VirtualService\r\ningresses                         ing             networking.k8s.io                  true         Ingress\r\nnetworkpolicies                   netpol          networking.k8s.io                  true         NetworkPolicy\r\npoddisruptionbudgets              pdb             policy                             true         PodDisruptionBudget\r\npodsecuritypolicies               psp             policy                             false        PodSecurityPolicy\r\nclusterrolebindings                               rbac.authorization.k8s.io          false        ClusterRoleBinding\r\nclusterroles                                      rbac.authorization.k8s.io          false        ClusterRole\r\nrolebindings                                      rbac.authorization.k8s.io          true         RoleBinding\r\nroles                                             rbac.authorization.k8s.io          true         Role\r\nauthorizationpolicies                             rbac.istio.io                      true         AuthorizationPolicy\r\nclusterrbacconfigs                                rbac.istio.io                      false        ClusterRbacConfig\r\nrbacconfigs                                       rbac.istio.io                      true         RbacConfig\r\nservicerolebindings                               rbac.istio.io                      true         ServiceRoleBinding\r\nserviceroles                                      rbac.istio.io                      true         ServiceRole\r\npriorityclasses                   pc              scheduling.k8s.io                  false        PriorityClass\r\nconfigurations                    config,cfg      serving.knative.dev                true         Configuration\r\nrevisions                         rev             serving.knative.dev                true         Revision\r\nroutes                            rt              serving.knative.dev                true         Route\r\nservices                          kservice,ksvc   serving.knative.dev                true         Service\r\napiserversources                                  sources.eventing.knative.dev       true         ApiServerSource\r\nawssqssources                                     sources.eventing.knative.dev       true         AwsSqsSource\r\ncontainersources                                  sources.eventing.knative.dev       true         ContainerSource\r\ncronjobsources                                    sources.eventing.knative.dev       true         CronJobSource\r\ngithubsources                                     sources.eventing.knative.dev       true         GitHubSource\r\nkafkasources                                      sources.eventing.knative.dev       true         KafkaSource\r\ncsidrivers                                        storage.k8s.io                     false        CSIDriver\r\ncsinodes                                          storage.k8s.io                     false        CSINode\r\nstorageclasses                    sc              storage.k8s.io                     false        StorageClass\r\nvolumeattachments                                 storage.k8s.io                     false        VolumeAttachment\r\nclustertasks                                      tekton.dev                         false        ClusterTask\r\npipelineresources                                 tekton.dev                         true         PipelineResource\r\npipelineruns                      pr,prs          tekton.dev                         true         PipelineRun\r\npipelines                                         tekton.dev                         true         Pipeline\r\ntaskruns                          tr,trs          tekton.dev                         true         TaskRun\r\ntasks                                             tekton.dev                         true         Task\r\nerror: unable to retrieve the complete list of server APIs: custom.metrics.k8s.io/v1beta1: the server is currently unable to handle the request\r\n➜  charts git:(h2update2)\r\n```\r\n\r\nThen looking at 'action.go' in the source I can see that if this api call fails, we exit getCapabilities(). I understand why ... but is this failure too 'hard' - in the case above the error was a minor service?\r\n\r\nThis seems to have come up recently due to some changes on the k8s service with metrics. \r\nI will persue that seperately... but was after thoughts on how helm handles this situation\r\nAlso a heads up helm3 *may* be broken on IKS - but I'm not knowledgeable enough to dig much further?","closed_by":{"login":"technosophos","id":89193,"node_id":"MDQ6VXNlcjg5MTkz","avatar_url":"https://avatars.githubusercontent.com/u/89193?v=4","gravatar_id":"","url":"https://api.github.com/users/technosophos","html_url":"https://github.com/technosophos","followers_url":"https://api.github.com/users/technosophos/followers","following_url":"https://api.github.com/users/technosophos/following{/other_user}","gists_url":"https://api.github.com/users/technosophos/gists{/gist_id}","starred_url":"https://api.github.com/users/technosophos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/technosophos/subscriptions","organizations_url":"https://api.github.com/users/technosophos/orgs","repos_url":"https://api.github.com/users/technosophos/repos","events_url":"https://api.github.com/users/technosophos/events{/privacy}","received_events_url":"https://api.github.com/users/technosophos/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helm/helm/issues/6361/reactions","total_count":24,"+1":24,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/6361/timeline","performed_via_github_app":null,"state_reason":"completed"}