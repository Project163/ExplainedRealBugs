{"url":"https://api.github.com/repos/helm/helm/issues/9285","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/9285/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/9285/comments","events_url":"https://api.github.com/repos/helm/helm/issues/9285/events","html_url":"https://github.com/helm/helm/issues/9285","id":794857587,"node_id":"MDU6SXNzdWU3OTQ4NTc1ODc=","number":9285,"title":"--wait-for-jobs does not fails if job failed","user":{"login":"antonio-antuan","id":6426720,"node_id":"MDQ6VXNlcjY0MjY3MjA=","avatar_url":"https://avatars.githubusercontent.com/u/6426720?v=4","gravatar_id":"","url":"https://api.github.com/users/antonio-antuan","html_url":"https://github.com/antonio-antuan","followers_url":"https://api.github.com/users/antonio-antuan/followers","following_url":"https://api.github.com/users/antonio-antuan/following{/other_user}","gists_url":"https://api.github.com/users/antonio-antuan/gists{/gist_id}","starred_url":"https://api.github.com/users/antonio-antuan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antonio-antuan/subscriptions","organizations_url":"https://api.github.com/users/antonio-antuan/orgs","repos_url":"https://api.github.com/users/antonio-antuan/repos","events_url":"https://api.github.com/users/antonio-antuan/events{/privacy}","received_events_url":"https://api.github.com/users/antonio-antuan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":562687520,"node_id":"MDU6TGFiZWw1NjI2ODc1MjA=","url":"https://api.github.com/repos/helm/helm/labels/feature","name":"feature","color":"0052cc","default":false,"description":null},{"id":562687714,"node_id":"MDU6TGFiZWw1NjI2ODc3MTQ=","url":"https://api.github.com/repos/helm/helm/labels/keep%20open","name":"keep open","color":"fbca04","default":false,"description":null},{"id":562692416,"node_id":"MDU6TGFiZWw1NjI2OTI0MTY=","url":"https://api.github.com/repos/helm/helm/labels/in%20progress","name":"in progress","color":"11DD11","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":18,"created_at":"2021-01-27T07:44:03Z","updated_at":"2023-07-13T15:22:00Z","closed_at":"2023-07-13T15:22:00Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- If you need help or think you have found a bug, please help us with your issue by entering the following information (otherwise you can delete this text): -->\r\n\r\nOutput of `helm version`: \r\nversion.BuildInfo{Version:\"v3.5.0\", GitCommit:\"32c22239423b3b4ba6706d450bd044baffdcf9e6\", GitTreeState:\"clean\", GoVersion:\"go1.15.6\"}\r\n\r\n\r\nOutput of `kubectl version`:\r\nClient Version: version.Info{Major:\"1\", Minor:\"19\", GitVersion:\"v1.19.4\", GitCommit:\"d360454c9bcd1634cf4cc52d1867af5491dc9c5f\", GitTreeState:\"archive\", BuildDate:\"2020-11-25T13:19:56Z\", GoVersion:\"go1.15.5\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\nServer Version: version.Info{Major:\"1\", Minor:\"18\", GitVersion:\"v1.18.8\", GitCommit:\"9f2892aab98fe339f3bd70e3c470144299398ace\", GitTreeState:\"clean\", BuildDate:\"2020-08-13T16:04:18Z\", GoVersion:\"go1.13.15\", Compiler:\"gc\", Platform:\"linux/amd64\"}\r\n\r\nCloud Provider/Platform (AKS, GKE, Minikube etc.): \r\n\r\n\r\n\r\nI have this template:\r\n\r\n```\r\napiVersion: batch/v1\r\nkind: Job\r\nmetadata:\r\n  name: backend-tests-job\r\n  labels:\r\n    app-name: tests\r\n    app-service: backend-tests\r\nspec:\r\n  backoffLimit: 0\r\n  template:\r\n    metadata:\r\n      name: backend-tests\r\n    spec:\r\n      restartPolicy: Never\r\n      imagePullSecrets:\r\n        - name: {{ .Values.imagePullSecrets }}\r\n\r\n      containers:\r\n      - name: tests\r\n        image: {{.Values.image.repository}}/{{ .Values.appName }}:{{ .Values.appVersion }}\r\n        imagePullPolicy: Always\r\n        command: [\"/usr/bin/make\"]\r\n        args: [\"test\", \"PYTEST_ARGS=${ARGS}\", \"VERSION=${VERSION}\"]\r\n        env:\r\n          - name: ARGS\r\n            value: {{ .Values.pytestArgs | quote }}\r\n          - name: GG_VERSION\r\n            value: {{ .Values.version | quote }}\r\n        resources:\r\n            {{- toYaml .Values.resources | nindent 12 }}\r\n\r\n```\r\n\r\nI installs it with this command:\r\n`helm install CHART --wait-for-jobs --wait --timeout 10m`\r\n\r\nSometimes job failed (because of tests, yeap :) ), does not restart (because of backoffLimit: 0) and then helm just... waits. \r\nI think that helm should not wait if job failed without any other restarts","closed_by":{"login":"joejulian","id":952828,"node_id":"MDQ6VXNlcjk1MjgyOA==","avatar_url":"https://avatars.githubusercontent.com/u/952828?v=4","gravatar_id":"","url":"https://api.github.com/users/joejulian","html_url":"https://github.com/joejulian","followers_url":"https://api.github.com/users/joejulian/followers","following_url":"https://api.github.com/users/joejulian/following{/other_user}","gists_url":"https://api.github.com/users/joejulian/gists{/gist_id}","starred_url":"https://api.github.com/users/joejulian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joejulian/subscriptions","organizations_url":"https://api.github.com/users/joejulian/orgs","repos_url":"https://api.github.com/users/joejulian/repos","events_url":"https://api.github.com/users/joejulian/events{/privacy}","received_events_url":"https://api.github.com/users/joejulian/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helm/helm/issues/9285/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/9285/timeline","performed_via_github_app":null,"state_reason":"completed"}