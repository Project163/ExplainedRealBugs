{"url":"https://api.github.com/repos/helm/helm/issues/30880","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/30880/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/30880/comments","events_url":"https://api.github.com/repos/helm/helm/issues/30880/events","html_url":"https://github.com/helm/helm/issues/30880","id":3076582467,"node_id":"I_kwDOApspmc63YOxD","number":30880,"title":"typeIs/typeOf behavior has changed since helm 3.18.0","user":{"login":"marcmillien","id":2512238,"node_id":"MDQ6VXNlcjI1MTIyMzg=","avatar_url":"https://avatars.githubusercontent.com/u/2512238?v=4","gravatar_id":"","url":"https://api.github.com/users/marcmillien","html_url":"https://github.com/marcmillien","followers_url":"https://api.github.com/users/marcmillien/followers","following_url":"https://api.github.com/users/marcmillien/following{/other_user}","gists_url":"https://api.github.com/users/marcmillien/gists{/gist_id}","starred_url":"https://api.github.com/users/marcmillien/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcmillien/subscriptions","organizations_url":"https://api.github.com/users/marcmillien/orgs","repos_url":"https://api.github.com/users/marcmillien/repos","events_url":"https://api.github.com/users/marcmillien/events{/privacy}","received_events_url":"https://api.github.com/users/marcmillien/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":778135666,"node_id":"MDU6TGFiZWw3NzgxMzU2NjY=","url":"https://api.github.com/repos/helm/helm/labels/bug","name":"bug","color":"e11d21","default":true,"description":"Categorizes issue or PR as related to a bug."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2025-05-20T10:53:09Z","updated_at":"2025-06-24T11:02:42Z","closed_at":"2025-05-21T19:18:12Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"With helm 3.18.0, there is a change in `typeIs`/`typeOf` gotemplate behavior.\n\nFor example in:\nhttps://github.com/oauth2-proxy/manifests/blob/4001c2385dc72990add71437b02e18d7ec7f8ffd/helm/oauth2-proxy/templates/_ingress.tpl#L40-L44\n\nWhile debugging, we saw that `typeOf .servicePort` has changed from `float64` to `json.Number`.\n\nThis could be a bad practice from the chart (that should probably use `KindIs`), but this is widely used and could break many charts.\n\nStep to reproduce:\n\nHelm 3.17.3:\n```sh\n$ helm repo add oauth2-proxy https://oauth2-proxy.github.io/manifests\n\"oauth2-proxy\" has been added to your repositories\n\n$ helm version\nversion.BuildInfo{Version:\"v3.17.3\", GitCommit:\"e4da49785aa6e6ee2b86efd5dd9e43400318262b\", GitTreeState:\"clean\", GoVersion:\"go1.23.7\"}\n\n$ cat <<EOF | helm template demo oauth2-proxy/oauth2-proxy -f -\n{\n  \"ingress\": {\n    \"enabled\": true,\n    \"hosts\": [\"demo.fr\"]\n  }\n}\nEOF\n[...]\n# Source: oauth2-proxy/templates/ingress.yaml\n[...]\nspec:\n  rules:\n    - host: \"demo.fr\"\n      http:\n        paths:\n          - path: /\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: demo-oauth2-proxy\n                port:\n                  number: 80                                         <==== OK\n```\n\nHelm 3.18.0:\n```sh\n$ helm version\nversion.BuildInfo{Version:\"v3.18.0\", GitCommit:\"cc58e3f5a3aa615c6a86275e6f4444b5fdd3cc4e\", GitTreeState:\"clean\", GoVersion:\"go1.24.3\"}\n\n$ cat <<EOF | helm template demo oauth2-proxy/oauth2-proxy -f -\n{\n  \"ingress\": {\n    \"enabled\": true,\n    \"hosts\": [\"demo.fr\"]\n  }\n}\nEOF\n[...]\n# Source: oauth2-proxy/templates/ingress.yaml\n[...]\nspec:\n  rules:\n    - host: \"demo.fr\"\n      http:\n        paths:\n          - path: /\n            pathType: ImplementationSpecific\n            backend:\n              service:\n                name: demo-oauth2-proxy\n                port:                                            <======= missing\n```","closed_by":{"login":"robertsirc","id":13884882,"node_id":"MDQ6VXNlcjEzODg0ODgy","avatar_url":"https://avatars.githubusercontent.com/u/13884882?v=4","gravatar_id":"","url":"https://api.github.com/users/robertsirc","html_url":"https://github.com/robertsirc","followers_url":"https://api.github.com/users/robertsirc/followers","following_url":"https://api.github.com/users/robertsirc/following{/other_user}","gists_url":"https://api.github.com/users/robertsirc/gists{/gist_id}","starred_url":"https://api.github.com/users/robertsirc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robertsirc/subscriptions","organizations_url":"https://api.github.com/users/robertsirc/orgs","repos_url":"https://api.github.com/users/robertsirc/repos","events_url":"https://api.github.com/users/robertsirc/events{/privacy}","received_events_url":"https://api.github.com/users/robertsirc/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helm/helm/issues/30880/reactions","total_count":11,"+1":11,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/30880/timeline","performed_via_github_app":null,"state_reason":"completed"}