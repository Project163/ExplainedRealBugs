{"url":"https://api.github.com/repos/helm/helm/issues/7416","repository_url":"https://api.github.com/repos/helm/helm","labels_url":"https://api.github.com/repos/helm/helm/issues/7416/labels{/name}","comments_url":"https://api.github.com/repos/helm/helm/issues/7416/comments","events_url":"https://api.github.com/repos/helm/helm/issues/7416/events","html_url":"https://github.com/helm/helm/issues/7416","id":551038060,"node_id":"MDU6SXNzdWU1NTEwMzgwNjA=","number":7416,"title":"respect sort order for equal weight hooks","user":{"login":"dastrobu","id":1847260,"node_id":"MDQ6VXNlcjE4NDcyNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1847260?v=4","gravatar_id":"","url":"https://api.github.com/users/dastrobu","html_url":"https://github.com/dastrobu","followers_url":"https://api.github.com/users/dastrobu/followers","following_url":"https://api.github.com/users/dastrobu/following{/other_user}","gists_url":"https://api.github.com/users/dastrobu/gists{/gist_id}","starred_url":"https://api.github.com/users/dastrobu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dastrobu/subscriptions","organizations_url":"https://api.github.com/users/dastrobu/orgs","repos_url":"https://api.github.com/users/dastrobu/repos","events_url":"https://api.github.com/users/dastrobu/events{/privacy}","received_events_url":"https://api.github.com/users/dastrobu/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":562687520,"node_id":"MDU6TGFiZWw1NjI2ODc1MjA=","url":"https://api.github.com/repos/helm/helm/labels/feature","name":"feature","color":"0052cc","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2020-01-16T20:31:37Z","updated_at":"2020-03-24T15:38:45Z","closed_at":"2020-03-24T15:38:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Helm is currently sorting hooks by weight and then by name. This is nice, however, for hooks with equal weight I would expect that the same sorting by kind is done before executing the hooks with equal weight. \r\nConsider e.g. the following example. A hook should run a job, but the job requires a certain service account to do that. So create a template with the service account and the jobs annotated as helm hook with some weight. Then it would make sense to sort the hooks by kind, like done for normal resources, to make sure that the service account is created before the job. \r\nI think this would resource handling make more consistent, if it is done the same way for hooks and non-hooks.\r\n\r\nTo workaround this, one can manage the order by carefully choosing weights. For the example above that would mean that the service account must get a smaller weight than the job.\r\n\r\nI am not sure if it is considered a feature or a bug, but I can provide a pull request to fix this, if the proposed solution is accepted.\r\n\r\n\r\nOutput of `helm version`:\r\n`version.BuildInfo{Version:\"v3.0.2\", GitCommit:\"19e47ee3283ae98139d98460de796c1be1e3975f\", GitTreeState:\"clean\", GoVersion:\"go1.13.5\"}`\r\n\r\n\r\n","closed_by":{"login":"bacongobbler","id":1360539,"node_id":"MDQ6VXNlcjEzNjA1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1360539?v=4","gravatar_id":"","url":"https://api.github.com/users/bacongobbler","html_url":"https://github.com/bacongobbler","followers_url":"https://api.github.com/users/bacongobbler/followers","following_url":"https://api.github.com/users/bacongobbler/following{/other_user}","gists_url":"https://api.github.com/users/bacongobbler/gists{/gist_id}","starred_url":"https://api.github.com/users/bacongobbler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bacongobbler/subscriptions","organizations_url":"https://api.github.com/users/bacongobbler/orgs","repos_url":"https://api.github.com/users/bacongobbler/repos","events_url":"https://api.github.com/users/bacongobbler/events{/privacy}","received_events_url":"https://api.github.com/users/bacongobbler/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/helm/helm/issues/7416/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/helm/helm/issues/7416/timeline","performed_via_github_app":null,"state_reason":"completed"}