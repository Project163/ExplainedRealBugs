{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1249","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1249/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1249/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1249/events","html_url":"https://github.com/launchbadge/sqlx/issues/1249","id":901298362,"node_id":"MDU6SXNzdWU5MDEyOTgzNjI=","number":1249,"title":"Left joins in SQLite can break the query macros","user":{"login":"ProjectMoon","id":183856,"node_id":"MDQ6VXNlcjE4Mzg1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/183856?v=4","gravatar_id":"","url":"https://api.github.com/users/ProjectMoon","html_url":"https://github.com/ProjectMoon","followers_url":"https://api.github.com/users/ProjectMoon/followers","following_url":"https://api.github.com/users/ProjectMoon/following{/other_user}","gists_url":"https://api.github.com/users/ProjectMoon/gists{/gist_id}","starred_url":"https://api.github.com/users/ProjectMoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ProjectMoon/subscriptions","organizations_url":"https://api.github.com/users/ProjectMoon/orgs","repos_url":"https://api.github.com/users/ProjectMoon/repos","events_url":"https://api.github.com/users/ProjectMoon/events{/privacy}","received_events_url":"https://api.github.com/users/ProjectMoon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2021-05-25T19:59:58Z","updated_at":"2022-04-07T20:18:39Z","closed_at":"2022-04-07T20:18:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"After some debugging by myself and some people in the #rust:mozilla.org Matrix room, we've come to the conclusion that I've found a bug in SQLx.\r\n\r\nIf I have two tables like this:\r\n```sql\r\nCREATE TABLE IF NOT EXISTS \"accounts\" (\r\n    \"user_id\" TEXT PRIMARY KEY NOT NULL UNIQUE,\r\n    \"password\" TEXT NULL\r\n);\r\n\r\nCREATE TABLE IF NOT EXISTS \"user_state\" (\r\n    \"user_id\" TEXT PRIMARY KEY NOT NULL UNIQUE, \r\n    \"active_room\" TEXT, \r\n    \"account_status\" CHECK(account_status IN ('not_registered', 'registered', 'awaiting_activation')) NOT NULL\r\n);\r\n```\r\n\r\nThis query will break the `query` and `query_as!` macros:\r\n\r\n```sql\r\nSELECT\r\n    a.user_id as \"username\",\r\n    a.password,\r\n    s.active_room,\r\n    s.account_status\r\n    FROM accounts a\r\n    LEFT JOIN user_state s on a.user_id = s.user_id\r\n    WHERE a.user_id = 'usernamehere';\r\n```\r\n\r\nThe error message returned during compilation is `proc macro panicked` and `help: message: no entry found for key`. The code is located at `src/sqlite/connection/explain.rs:149:32`. This occurs on sqlx 0.5.x, including 0.5.5.\r\n\r\nIt seems specifically related to the `LEFT JOIN`. A regular `JOIN` will compile just fine.","closed_by":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1249/reactions","total_count":6,"+1":6,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1249/timeline","performed_via_github_app":null,"state_reason":"completed"}