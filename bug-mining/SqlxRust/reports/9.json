{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/120","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/120/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/120/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/120/events","html_url":"https://github.com/launchbadge/sqlx/issues/120","id":574330933,"node_id":"MDU6SXNzdWU1NzQzMzA5MzM=","number":120,"title":"Error inside postgres plpgsql stored procedure yields Error::Protocol(\"received unknown field in Response: 87\") ","user":{"login":"stadust","id":43299462,"node_id":"MDQ6VXNlcjQzMjk5NDYy","avatar_url":"https://avatars.githubusercontent.com/u/43299462?v=4","gravatar_id":"","url":"https://api.github.com/users/stadust","html_url":"https://github.com/stadust","followers_url":"https://api.github.com/users/stadust/followers","following_url":"https://api.github.com/users/stadust/following{/other_user}","gists_url":"https://api.github.com/users/stadust/gists{/gist_id}","starred_url":"https://api.github.com/users/stadust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stadust/subscriptions","organizations_url":"https://api.github.com/users/stadust/orgs","repos_url":"https://api.github.com/users/stadust/repos","events_url":"https://api.github.com/users/stadust/events{/privacy}","received_events_url":"https://api.github.com/users/stadust/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-03-03T00:05:46Z","updated_at":"2020-03-27T23:53:52Z","closed_at":"2020-03-27T23:43:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"A came across this because a trigger function in my database errored out and I got the error from the title.\r\n\r\nIf a normal SQL function is used instead of a stored procedure, the error message returned by `sqlx` is correct.\r\n\r\nFor example, this can be triggered as follows:\r\n\r\n```rs\r\nuse sqlx::Connect;\r\n\r\n#[tokio::main]\r\nasync fn main() {\r\n    let mut connection = sqlx::PgConnection::connect(\"<some database>\")\r\n        .await\r\n        .unwrap();\r\n\r\n    sqlx::query!(\"BEGIN TRANSACTION\").execute(&mut connection).await.unwrap();\r\n\r\n    // Create erroring function\r\n    sqlx::query!(\"CREATE FUNCTION this_will_error() RETURNS INTEGER AS $$ BEGIN RETURN 'a'::integer; END; $$ LANGUAGE plpgsql\")\r\n        .execute(&mut connection)\r\n        .await\r\n        .unwrap();\r\n\r\n    // Call the function, causing an error\r\n    sqlx::query(\"SELECT this_will_error()\")\r\n        .execute(&mut connection)\r\n        .await\r\n        .unwrap();\r\n}\r\n```\r\n\r\nThe exact error message is \r\n\r\n```\r\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Protocol(\"received unknown field in Response: 87\")', src/libcore/result.rs:1188:5\r\n```\r\n\r\nIf I run this piece of SQL inside psql, I get the error message\r\n\r\n```\r\nERROR:  invalid input syntax for type integer: \"a\"\r\nLINE 1: SELECT 'a'::integer\r\n               ^\r\nQUERY:  SELECT 'a'::integer\r\nCONTEXT:  PL/pgSQL function this_will_error() line 1 at RETURN\r\n```\r\nwhich directly tells me what's wrong. It'd be nice if `sqlx` could somehow include this in its message or at least point me towards the stored procedure.\r\n\r\n+ `sqlx` version: 0.2.5\r\n+ `postgres` version: 12.2","closed_by":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/120/timeline","performed_via_github_app":null,"state_reason":"completed"}