[{"id":5236149312,"node_id":"LE_lADODb6dM846re63zwAAAAE4GUxA","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5236149312","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-09-01T01:39:52Z","label":{"name":"db:sqlite","color":"a1cc4d"},"performed_via_github_app":null},{"id":5236149571,"node_id":"LE_lADODb6dM846re63zwAAAAE4GU1D","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5236149571","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2021-09-01T01:39:56Z","label":{"name":"bug","color":"e11d21"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/909808426","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-909808426","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":909808426,"node_id":"IC_kwDODb6dM842OpMq","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-01T02:10:36Z","updated_at":"2021-09-01T02:10:36Z","body":"I actually have no idea what's causing this. Obviously it's a `ConnectionHandle` getting dropped while some `StatementHandle` still exists, but I have no idea how.\r\n\r\nFor one, we make sure to clear all the virtual statements in `SqliteConnection::drop()`: https://github.com/launchbadge/sqlx/blob/master/sqlx-core/src/sqlite/connection/mod.rs#L105\r\n\r\nThe comment reminded me that drop order is not defined, _but_ either way it shouldn't be an issue:\r\n\r\nIf `handle: ConnectionHandle` is dropped first, that should be fine, as that uses an `Arc` and sends a strong reference to the statement worker thread to make sure it's dropped last: https://github.com/launchbadge/sqlx/blob/master/sqlx-core/src/sqlite/statement/worker.rs#L79\r\n\r\nThe `crossbeam-channel` docs specify that even if all the senders have gone away (so the `Sender` in the `StatementWorker` struct getting dropped), the receiver should still be able to empty the channel of messages and thus work through all the remaining `StatementHandle`s that might be queued.\r\n\r\nI could see this panic happening if for some reason the thread we spawn in `StatementWorker::new()` dies prematurely, as that would leave `StatementHandle`s in the channel, and then `ConnectionHandle` getting dropped before `StatementWorker` will trigger the panic.\r\n\r\nHowever, the only way the statement worker thread would die first without consuming all the messages in the channel (barring a bug in `crossbeam-channel`) is by _itself_ panicking; can you look back through your logs to find a panic with a different message?\r\n\r\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/909808426/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/910360941","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-910360941","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":910360941,"node_id":"IC_kwDODb6dM842QwFt","user":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-01T14:50:20Z","updated_at":"2021-09-01T14:50:20Z","body":"I checked again to be sure and this is the only error I see at all unfortunately. I am going to try to recreate this in a stripped down project to make troubleshooting easier. I will update if I find anything out from that. ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/910360941/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/910708069","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-910708069","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":910708069,"node_id":"IC_kwDODb6dM842SE1l","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-01T20:24:34Z","updated_at":"2021-09-01T20:24:34Z","body":"@06chaynes the full panic backtrace may also help. It couldn't hurt, at least.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/910708069/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5242239237,"node_id":"MEE_lADODb6dM846re63zwAAAAE4djkF","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5242239237","actor":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-09-01T20:24:34Z","performed_via_github_app":null},{"id":5242239250,"node_id":"SE_lADODb6dM846re63zwAAAAE4djkS","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5242239250","actor":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-09-01T20:24:35Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/910746668","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-910746668","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":910746668,"node_id":"IC_kwDODb6dM842SOQs","user":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-01T20:59:53Z","updated_at":"2021-09-01T20:59:53Z","body":"```\r\nthread '<unnamed>' panicked at 'unable to close due to unfinalized statements or unfinished backups', /home/user/.cargo/registry/src/github.com-1ecc6299db9ec823/sqlx-core-0.5.7/src/sqlite/connection/handle.rs:68:17\r\nstack backtrace:\r\n   0:     0x558300684bfa - std::backtrace_rs::backtrace::libunwind::trace::h34055254b57d8e79\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/../../backtrace/src/backtrace/libunwind.rs:90:5\r\n   1:     0x558300684bfa - std::backtrace_rs::backtrace::trace_unsynchronized::h8f1e3fbd9afff6ec\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/../../backtrace/src/backtrace/mod.rs:66:5\r\n   2:     0x558300684bfa - std::sys_common::backtrace::_print_fmt::h3a99a796b770c360\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:67:5\r\n   3:     0x558300684bfa - <std::sys_common::backtrace::_print::DisplayBacktrace as core::fmt::Display>::fmt::h32d1f94a80615d18\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:46:22\r\n   4:     0x5583004f8ecc - core::fmt::write::h306731c068f7162c\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/fmt/mod.rs:1110:17\r\n   5:     0x558300683644 - std::io::Write::write_fmt::hd2fa90334eee2a21\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/io/mod.rs:1588:15\r\n   6:     0x558300683f25 - std::sys_common::backtrace::_print::h5abaa2601a852287\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:49:5\r\n   7:     0x558300683f25 - std::sys_common::backtrace::print::h8d81445442bb638f\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:36:9\r\n   8:     0x558300683f25 - std::panicking::default_hook::{{closure}}::hcfe804496a9fa747\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:208:50\r\n   9:     0x558300683436 - std::panicking::default_hook::hbea8e3ccf2ba8901\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:225:9\r\n  10:     0x558300683436 - std::panicking::rust_panic_with_hook::h7ee9e1a2d0f8975a\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:622:17\r\n  11:     0x55830069c0cd - std::panicking::begin_panic_handler::{{closure}}::h8ab3b4491718b2c7\r\n  12:     0x55830069c03c - std::sys_common::backtrace::__rust_end_short_backtrace::hd489062ffa586a9f\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys_common/backtrace.rs:141:18\r\n  13:     0x55830069bfed - rust_begin_unwind\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:515:5\r\n  14:     0x55830042bca0 - std::panicking::begin_panic_fmt::h5479575e112541f8\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:457:5\r\n  15:     0x558300672a04 - alloc::sync::Arc<T>::drop_slow::h5e9b78887050d417\r\n  16:     0x55830067a4b9 - std::sys_common::backtrace::__rust_begin_short_backtrace::h5e11ff00e096ce1d\r\n  17:     0x558300678691 - core::ops::function::FnOnce::call_once{{vtable.shim}}::hafdf47ca0c764638\r\n  18:     0x5583006ad6d5 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::h7ece6cfefaff1005\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/alloc/src/boxed.rs:1575:9\r\n  19:     0x5583006ad6d5 - <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once::hb8b48e55c21f193e\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/alloc/src/boxed.rs:1575:9\r\n  20:     0x5583006ad6d5 - std::sys::unix::thread::Thread::new::thread_start::h8c7c4450dba62914\r\n                               at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/sys/unix/thread.rs:71:17\r\n  21:     0x7f04d3330609 - start_thread\r\n  22:     0x7f04d3102293 - clone\r\n  23:                0x0 - <unknown>\r\nAborted (core dumped)\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/910746668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/910822122","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-910822122","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":910822122,"node_id":"IC_kwDODb6dM842Sgrq","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-01T22:08:50Z","updated_at":"2021-09-01T22:10:37Z","body":"Frustratingly, that doesn't actually show where in non-stdlib code that the panic occurred. It looks like a bunch of inlining has happened here. Considering how shallow the stack is, though, I'm guessing that that _is_ the worker thread panicking when it drops the `ConnectionHandleRef`: https://github.com/launchbadge/sqlx/blob/master/sqlx-core/src/sqlite/statement/worker.rs#L79\r\n\r\nI'm still at a loss as to how this is happening, though. Any progress on that minimal reproduction? It would help to see how you're actually using SQLx.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/910822122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/911675341","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-911675341","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":911675341,"node_id":"IC_kwDODb6dM842Vw_N","user":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-02T13:20:14Z","updated_at":"2021-09-02T13:20:14Z","body":"Before I share this really strange looking example think I should share a bit of what led up to this. I started out with a sqlite pool limited to 1 connection but was running into issues, specifically I was seeing connection timeouts. This had me kind of stumped because it seemed no matter what I tried it would run into this connection error a crazy number of times. \r\n\r\nSo I modified things a bit more and ended up wrapping a SqliteConnection in a mutex and that in an arc, then would clone and wait for an owned lock, do the query, then drop that clone after it finished. This ended up working, though I did notice that after weeks of continuous operation I would see the connection timeout error a few times on some days. This program cycles every 30 seconds, so having an error that rarely isn't an issue for what we are doing. \r\n\r\nAfter moving past v0.5.5 though I started getting the new error. This example can recreate the error at least, [https://github.com/06chaynes/sqlxerr](https://github.com/06chaynes/sqlxerr), not quite what I'm doing but apparently close enough!  ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/911675341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/912026217","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-912026217","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":912026217,"node_id":"IC_kwDODb6dM842XGpp","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-02T20:21:14Z","updated_at":"2021-09-02T20:24:51Z","body":"With your example, I figured it out!\r\n\r\nThe issue is the `books: Vec<SqliteRow>`, as `SqliteRow` retains a strong reference to the `StatementHandle` which finalizes the inner `sqlite3_stmt` on-drop. \r\n\r\nSince you're prematurely dropping the `SqliteConnection` with `drop(conn)`, it's trying to finalize the `sqlite3` instance before it finalizes the `Vec<SqliteRow>` and thus the `sqlite3_stmt`s contained therin (as the normal drop order in a function is LIFO).\r\n\r\nAs a temporary fix on your end, make sure to drop `books` before `conn`. With that change, the panic no longer happens in your example.\r\n\r\nThe permanent fix here on our end is probably to retain a `ConnectionHandleRef` in the `SqliteRow` struct so the connection cannot be finalized prematurely, or even just in `StatementHandle` itself, maybe.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/912026217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/912032960","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-912032960","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":912032960,"node_id":"IC_kwDODb6dM842XITA","user":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-02T20:30:53Z","updated_at":"2021-09-02T20:30:53Z","body":"Ah! I didn't consider that at all, thank you. I'll make those changes as soon as possible and test again.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/912032960/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5346379934,"node_id":"REFE_lADODb6dM846re63zwAAAAE-q0ie","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5346379934","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5d25f4342b972f7e7c45707356329f5f80a8c0de","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/5d25f4342b972f7e7c45707356329f5f80a8c0de","created_at":"2021-09-22T22:49:21Z","performed_via_github_app":null},{"id":5346379937,"node_id":"REFE_lADODb6dM846re63zwAAAAE-q0ih","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5346379937","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"0e482baba9187f08f9c0d1dc4dcf1c3a00eb8f2c","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/0e482baba9187f08f9c0d1dc4dcf1c3a00eb8f2c","created_at":"2021-09-22T22:49:21Z","performed_via_github_app":null},{"id":5346434799,"node_id":"REFE_lADODb6dM846re63zwAAAAE-rB7v","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5346434799","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"ba3994e53007a0839be4ed612f0359488a92bb01","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/ba3994e53007a0839be4ed612f0359488a92bb01","created_at":"2021-09-22T23:07:32Z","performed_via_github_app":null},{"id":5346434804,"node_id":"REFE_lADODb6dM846re63zwAAAAE-rB70","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5346434804","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"d804eb53db8aab9c73c2138ad50bbe358cef09e9","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/d804eb53db8aab9c73c2138ad50bbe358cef09e9","created_at":"2021-09-22T23:07:32Z","performed_via_github_app":null},{"id":5346467551,"node_id":"REFE_lADODb6dM846re63zwAAAAE-rJ7f","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5346467551","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"7ff66209d9c2075d1f6273487fa199d70b36c9cb","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/7ff66209d9c2075d1f6273487fa199d70b36c9cb","created_at":"2021-09-22T23:18:02Z","performed_via_github_app":null},{"id":5346467555,"node_id":"REFE_lADODb6dM846re63zwAAAAE-rJ7j","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5346467555","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"f1d26107deec11b41767bfe228d690072aa2b331","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/f1d26107deec11b41767bfe228d690072aa2b331","created_at":"2021-09-22T23:18:02Z","performed_via_github_app":null},{"actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-22T23:18:53Z","updated_at":"2021-09-22T23:18:53Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1450","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1450/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1450/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1450/events","html_url":"https://github.com/launchbadge/sqlx/pull/1450","id":1004856003,"node_id":"PR_kwDODb6dM84sKbnh","number":1450,"title":"Fix a panic in the worker thread when dropping the connection while `SqliteRow`s still exist","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-09-22T23:18:53Z","updated_at":"2021-09-23T12:02:46Z","closed_at":"2021-09-22T23:55:22Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":230595891,"node_id":"MDEwOlJlcG9zaXRvcnkyMzA1OTU4OTE=","name":"sqlx","full_name":"launchbadge/sqlx","private":false,"owner":{"login":"launchbadge","id":10077001,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwMDc3MDAx","avatar_url":"https://avatars.githubusercontent.com/u/10077001?v=4","gravatar_id":"","url":"https://api.github.com/users/launchbadge","html_url":"https://github.com/launchbadge","followers_url":"https://api.github.com/users/launchbadge/followers","following_url":"https://api.github.com/users/launchbadge/following{/other_user}","gists_url":"https://api.github.com/users/launchbadge/gists{/gist_id}","starred_url":"https://api.github.com/users/launchbadge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/launchbadge/subscriptions","organizations_url":"https://api.github.com/users/launchbadge/orgs","repos_url":"https://api.github.com/users/launchbadge/repos","events_url":"https://api.github.com/users/launchbadge/events{/privacy}","received_events_url":"https://api.github.com/users/launchbadge/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/launchbadge/sqlx","description":"ðŸ§° The Rust SQL Toolkit. An async, pure Rust SQL crate featuring compile-time checked queries without a DSL. Supports PostgreSQL, MySQL, and SQLite.","fork":false,"url":"https://api.github.com/repos/launchbadge/sqlx","forks_url":"https://api.github.com/repos/launchbadge/sqlx/forks","keys_url":"https://api.github.com/repos/launchbadge/sqlx/keys{/key_id}","collaborators_url":"https://api.github.com/repos/launchbadge/sqlx/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/launchbadge/sqlx/teams","hooks_url":"https://api.github.com/repos/launchbadge/sqlx/hooks","issue_events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/events{/number}","events_url":"https://api.github.com/repos/launchbadge/sqlx/events","assignees_url":"https://api.github.com/repos/launchbadge/sqlx/assignees{/user}","branches_url":"https://api.github.com/repos/launchbadge/sqlx/branches{/branch}","tags_url":"https://api.github.com/repos/launchbadge/sqlx/tags","blobs_url":"https://api.github.com/repos/launchbadge/sqlx/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/launchbadge/sqlx/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/launchbadge/sqlx/git/refs{/sha}","trees_url":"https://api.github.com/repos/launchbadge/sqlx/git/trees{/sha}","statuses_url":"https://api.github.com/repos/launchbadge/sqlx/statuses/{sha}","languages_url":"https://api.github.com/repos/launchbadge/sqlx/languages","stargazers_url":"https://api.github.com/repos/launchbadge/sqlx/stargazers","contributors_url":"https://api.github.com/repos/launchbadge/sqlx/contributors","subscribers_url":"https://api.github.com/repos/launchbadge/sqlx/subscribers","subscription_url":"https://api.github.com/repos/launchbadge/sqlx/subscription","commits_url":"https://api.github.com/repos/launchbadge/sqlx/commits{/sha}","git_commits_url":"https://api.github.com/repos/launchbadge/sqlx/git/commits{/sha}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/comments{/number}","issue_comment_url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments{/number}","contents_url":"https://api.github.com/repos/launchbadge/sqlx/contents/{+path}","compare_url":"https://api.github.com/repos/launchbadge/sqlx/compare/{base}...{head}","merges_url":"https://api.github.com/repos/launchbadge/sqlx/merges","archive_url":"https://api.github.com/repos/launchbadge/sqlx/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/launchbadge/sqlx/downloads","issues_url":"https://api.github.com/repos/launchbadge/sqlx/issues{/number}","pulls_url":"https://api.github.com/repos/launchbadge/sqlx/pulls{/number}","milestones_url":"https://api.github.com/repos/launchbadge/sqlx/milestones{/number}","notifications_url":"https://api.github.com/repos/launchbadge/sqlx/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/launchbadge/sqlx/labels{/name}","releases_url":"https://api.github.com/repos/launchbadge/sqlx/releases{/id}","deployments_url":"https://api.github.com/repos/launchbadge/sqlx/deployments","created_at":"2019-12-28T10:40:57Z","updated_at":"2025-11-10T07:15:41Z","pushed_at":"2025-10-29T18:37:49Z","git_url":"git://github.com/launchbadge/sqlx.git","ssh_url":"git@github.com:launchbadge/sqlx.git","clone_url":"https://github.com/launchbadge/sqlx.git","svn_url":"https://github.com/launchbadge/sqlx","homepage":"","size":9641,"stargazers_count":15938,"watchers_count":15938,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1502,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":701,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","await","mariadb","mysql","postgres","postgresql","rust","sql","sqlite"],"visibility":"public","forks":1502,"open_issues":701,"watchers":15938,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/launchbadge/sqlx/pulls/1450","html_url":"https://github.com/launchbadge/sqlx/pull/1450","diff_url":"https://github.com/launchbadge/sqlx/pull/1450.diff","patch_url":"https://github.com/launchbadge/sqlx/pull/1450.patch","merged_at":"2021-09-22T23:55:22Z"},"body":"Was able to cut the example given in #1419 down to a nice minimal repro.\r\n\r\nCloses #1419","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1450/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":5346566536,"node_id":"CE_lADODb6dM846re63zwAAAAE-riGI","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5346566536","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-09-22T23:55:22Z","state_reason":null,"performed_via_github_app":null},{"id":5346566598,"node_id":"REFE_lADODb6dM846re63zwAAAAE-riHG","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5346566598","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"8b30f3059b6b7027c50af804d711e88706670acd","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/8b30f3059b6b7027c50af804d711e88706670acd","created_at":"2021-09-22T23:55:23Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/953261154","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-953261154","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":953261154,"node_id":"IC_kwDODb6dM8440Zxi","user":{"login":"definitelycarter","id":6287039,"node_id":"MDQ6VXNlcjYyODcwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/6287039?v=4","gravatar_id":"","url":"https://api.github.com/users/definitelycarter","html_url":"https://github.com/definitelycarter","followers_url":"https://api.github.com/users/definitelycarter/followers","following_url":"https://api.github.com/users/definitelycarter/following{/other_user}","gists_url":"https://api.github.com/users/definitelycarter/gists{/gist_id}","starred_url":"https://api.github.com/users/definitelycarter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/definitelycarter/subscriptions","organizations_url":"https://api.github.com/users/definitelycarter/orgs","repos_url":"https://api.github.com/users/definitelycarter/repos","events_url":"https://api.github.com/users/definitelycarter/events{/privacy}","received_events_url":"https://api.github.com/users/definitelycarter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-27T19:55:31Z","updated_at":"2021-10-27T19:55:31Z","body":"I hit this error on version 0.5.9.\r\n\r\n`thread '<unnamed>' panicked at 'unable to close due to unfinalized statements or unfinished backups', /usr/local/cargo/registry/src/github.com-1ecc6299db9ec823/sqlx-core-0.5.9/src/sqlite/connection/handle.rs:69:17`\r\n\r\n<img width=\"777\" alt=\"image\" src=\"https://user-images.githubusercontent.com/6287039/139137403-10b7939a-4ca5-4e8f-bc35-dc6d3cbc121f.png\">\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/953261154/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"definitelycarter","id":6287039,"node_id":"MDQ6VXNlcjYyODcwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/6287039?v=4","gravatar_id":"","url":"https://api.github.com/users/definitelycarter","html_url":"https://github.com/definitelycarter","followers_url":"https://api.github.com/users/definitelycarter/followers","following_url":"https://api.github.com/users/definitelycarter/following{/other_user}","gists_url":"https://api.github.com/users/definitelycarter/gists{/gist_id}","starred_url":"https://api.github.com/users/definitelycarter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/definitelycarter/subscriptions","organizations_url":"https://api.github.com/users/definitelycarter/orgs","repos_url":"https://api.github.com/users/definitelycarter/repos","events_url":"https://api.github.com/users/definitelycarter/events{/privacy}","received_events_url":"https://api.github.com/users/definitelycarter/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/954911113","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-954911113","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":954911113,"node_id":"IC_kwDODb6dM8446smJ","user":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-29T17:17:05Z","updated_at":"2021-10-29T17:17:05Z","body":"@definitelycarter do you have a code snippet that could reproduce the issue by chance? ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/954911113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5541889671,"node_id":"MEE_lADODb6dM846re63zwAAAAFKUoaH","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5541889671","actor":{"login":"definitelycarter","id":6287039,"node_id":"MDQ6VXNlcjYyODcwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/6287039?v=4","gravatar_id":"","url":"https://api.github.com/users/definitelycarter","html_url":"https://github.com/definitelycarter","followers_url":"https://api.github.com/users/definitelycarter/followers","following_url":"https://api.github.com/users/definitelycarter/following{/other_user}","gists_url":"https://api.github.com/users/definitelycarter/gists{/gist_id}","starred_url":"https://api.github.com/users/definitelycarter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/definitelycarter/subscriptions","organizations_url":"https://api.github.com/users/definitelycarter/orgs","repos_url":"https://api.github.com/users/definitelycarter/repos","events_url":"https://api.github.com/users/definitelycarter/events{/privacy}","received_events_url":"https://api.github.com/users/definitelycarter/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-10-29T17:17:05Z","performed_via_github_app":null},{"id":5541889676,"node_id":"SE_lADODb6dM846re63zwAAAAFKUoaM","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5541889676","actor":{"login":"definitelycarter","id":6287039,"node_id":"MDQ6VXNlcjYyODcwMzk=","avatar_url":"https://avatars.githubusercontent.com/u/6287039?v=4","gravatar_id":"","url":"https://api.github.com/users/definitelycarter","html_url":"https://github.com/definitelycarter","followers_url":"https://api.github.com/users/definitelycarter/followers","following_url":"https://api.github.com/users/definitelycarter/following{/other_user}","gists_url":"https://api.github.com/users/definitelycarter/gists{/gist_id}","starred_url":"https://api.github.com/users/definitelycarter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/definitelycarter/subscriptions","organizations_url":"https://api.github.com/users/definitelycarter/orgs","repos_url":"https://api.github.com/users/definitelycarter/repos","events_url":"https://api.github.com/users/definitelycarter/events{/privacy}","received_events_url":"https://api.github.com/users/definitelycarter/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-10-29T17:17:05Z","performed_via_github_app":null},{"id":5647417031,"node_id":"REFE_lADODb6dM846re63zwAAAAFQnL7H","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5647417031","actor":{"login":"placrosse","id":974306,"node_id":"MDQ6VXNlcjk3NDMwNg==","avatar_url":"https://avatars.githubusercontent.com/u/974306?v=4","gravatar_id":"","url":"https://api.github.com/users/placrosse","html_url":"https://github.com/placrosse","followers_url":"https://api.github.com/users/placrosse/followers","following_url":"https://api.github.com/users/placrosse/following{/other_user}","gists_url":"https://api.github.com/users/placrosse/gists{/gist_id}","starred_url":"https://api.github.com/users/placrosse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/placrosse/subscriptions","organizations_url":"https://api.github.com/users/placrosse/orgs","repos_url":"https://api.github.com/users/placrosse/repos","events_url":"https://api.github.com/users/placrosse/events{/privacy}","received_events_url":"https://api.github.com/users/placrosse/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"6cdb35d950517078969ac0d06b7e3a6e8a7f775c","commit_url":"https://api.github.com/repos/JetASAP/sqlx/commits/6cdb35d950517078969ac0d06b7e3a6e8a7f775c","created_at":"2021-11-19T19:49:24Z","performed_via_github_app":null},{"id":5649296401,"node_id":"REFE_lADODb6dM846re63zwAAAAFQuWwR","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5649296401","actor":{"login":"placrosse","id":974306,"node_id":"MDQ6VXNlcjk3NDMwNg==","avatar_url":"https://avatars.githubusercontent.com/u/974306?v=4","gravatar_id":"","url":"https://api.github.com/users/placrosse","html_url":"https://github.com/placrosse","followers_url":"https://api.github.com/users/placrosse/followers","following_url":"https://api.github.com/users/placrosse/following{/other_user}","gists_url":"https://api.github.com/users/placrosse/gists{/gist_id}","starred_url":"https://api.github.com/users/placrosse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/placrosse/subscriptions","organizations_url":"https://api.github.com/users/placrosse/orgs","repos_url":"https://api.github.com/users/placrosse/repos","events_url":"https://api.github.com/users/placrosse/events{/privacy}","received_events_url":"https://api.github.com/users/placrosse/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b5a95c4ec0638231009eb438b2823afa0d20dd10","commit_url":"https://api.github.com/repos/JetASAP/sqlx/commits/b5a95c4ec0638231009eb438b2823afa0d20dd10","created_at":"2021-11-20T20:19:53Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/977058551","html_url":"https://github.com/launchbadge/sqlx/issues/1419#issuecomment-977058551","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1419","id":977058551,"node_id":"IC_kwDODb6dM846PLr3","user":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-23T19:27:12Z","updated_at":"2021-11-23T19:29:17Z","body":"@abonander looks like I am still encountering this error after all. After your comment I had made some changes so I was surprised to see the error pop up again in the logs.\r\n\r\nQuick question on the matter, would `active_recs` in this example also retain a strong reference to the `StatementHandle` as you mentioned before?\r\n\r\n```rust\r\nlet mut conn = db_conn.clone().lock_owned().await;\r\nlet active_recs = sqlx::query_as::<_, WatchModel>(&q)\r\n     .fetch_all(&mut *conn)\r\n     .await?;\r\ndrop(conn);\r\n```\r\n\r\n`WatchModel` here is a struct that derives `FromRow`","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/977058551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"06chaynes","id":612378,"node_id":"MDQ6VXNlcjYxMjM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/612378?v=4","gravatar_id":"","url":"https://api.github.com/users/06chaynes","html_url":"https://github.com/06chaynes","followers_url":"https://api.github.com/users/06chaynes/followers","following_url":"https://api.github.com/users/06chaynes/following{/other_user}","gists_url":"https://api.github.com/users/06chaynes/gists{/gist_id}","starred_url":"https://api.github.com/users/06chaynes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/06chaynes/subscriptions","organizations_url":"https://api.github.com/users/06chaynes/orgs","repos_url":"https://api.github.com/users/06chaynes/repos","events_url":"https://api.github.com/users/06chaynes/events{/privacy}","received_events_url":"https://api.github.com/users/06chaynes/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5662521719,"node_id":"MEE_lADODb6dM846re63zwAAAAFRgzl3","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5662521719","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-11-23T19:27:13Z","performed_via_github_app":null},{"id":5662521723,"node_id":"SE_lADODb6dM846re63zwAAAAFRgzl7","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5662521723","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-11-23T19:27:13Z","performed_via_github_app":null}]