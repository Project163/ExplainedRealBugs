{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/870","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/870/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/870/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/870/events","html_url":"https://github.com/launchbadge/sqlx/issues/870","id":755752148,"node_id":"MDU6SXNzdWU3NTU3NTIxNDg=","number":870,"title":"[cli] new feature: 'migrate info': warn about changed-after-installed migrations","user":{"login":"salewski","id":997214,"node_id":"MDQ6VXNlcjk5NzIxNA==","avatar_url":"https://avatars.githubusercontent.com/u/997214?v=4","gravatar_id":"","url":"https://api.github.com/users/salewski","html_url":"https://github.com/salewski","followers_url":"https://api.github.com/users/salewski/followers","following_url":"https://api.github.com/users/salewski/following{/other_user}","gists_url":"https://api.github.com/users/salewski/gists{/gist_id}","starred_url":"https://api.github.com/users/salewski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/salewski/subscriptions","organizations_url":"https://api.github.com/users/salewski/orgs","repos_url":"https://api.github.com/users/salewski/repos","events_url":"https://api.github.com/users/salewski/events{/privacy}","received_events_url":"https://api.github.com/users/salewski/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1757378996,"node_id":"MDU6TGFiZWwxNzU3Mzc4OTk2","url":"https://api.github.com/repos/launchbadge/sqlx/labels/enhancement","name":"enhancement","color":"a2eeef","default":true,"description":"New feature or request"},{"id":1944326125,"node_id":"MDU6TGFiZWwxOTQ0MzI2MTI1","url":"https://api.github.com/repos/launchbadge/sqlx/labels/E-easy","name":"E-easy","color":"d8c0f9","default":false,"description":""},{"id":2099607607,"node_id":"MDU6TGFiZWwyMDk5NjA3NjA3","url":"https://api.github.com/repos/launchbadge/sqlx/labels/cli","name":"cli","color":"71e20d","default":false,"description":"Concerns `sqlx-cli`"},{"id":2457398477,"node_id":"MDU6TGFiZWwyNDU3Mzk4NDc3","url":"https://api.github.com/repos/launchbadge/sqlx/labels/migrations","name":"migrations","color":"f9d0c4","default":false,"description":"Proposals or bugs involving migrations"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2020-12-03T02:07:28Z","updated_at":"2022-08-14T14:47:04Z","closed_at":"2022-02-16T04:11:06Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"```console\r\n    $ sqlx --version\r\n    sqlx-cli 0.2.0\r\n\r\n    $ git rev-parse --short=12 HEAD\r\n    7f1bff406d94\r\n```\r\n----\r\nRelated to:\r\n   * issue #358 (introduced checksum column)\r\n\r\nRelated tangentially to:\r\n   * issue #357 (`--dry-run` support  for `sqlx migrate run`)\r\n----\r\n\r\nIt would be useful to have `sqlx migrate info` warn the user about migrations whose file checksum no longer matches the value recorded in the db, similar to how `sqlx database setup` does.\r\n\r\nFor example, if I:\r\n\r\n   1. `sqlx database setup`\r\n   2. change the migration file\r\n   3. `sqlx database setup`\r\n\r\nUpon the second setup invocation an error is emitted:\r\n```console\r\n    error: migration 20201202222356 was previously applied but has been modified\r\n```\r\n\r\nThat's quite nice.\r\n\r\nFrom the perspective of treating the `sqlx migrate info` command as the thing to use to answer the question, *\"Where does the database stand with respect to the available migrations?\"*, it would be nice if it were able to provide similar information. Currently it shows that the migration was successfully installed at some point in the past, but does not give any indication that the migration script has been modified:\r\n\r\n```console\r\n    $ sqlx migrate info\r\n    20201202222356/installed name-of-migration\r\n```\r\n","closed_by":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/870/timeline","performed_via_github_app":null,"state_reason":"completed"}