[{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/938571429","html_url":"https://github.com/launchbadge/sqlx/issues/1477#issuecomment-938571429","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1477","id":938571429,"node_id":"IC_kwDODb6dM8438Xal","user":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-08T11:36:30Z","updated_at":"2021-10-08T11:36:30Z","body":"I managed to reproduce the issue in the test suite. I am still working on the fix.\r\n\r\n<details>\r\n\r\n```rs\r\n#[sqlx_macros::test]\r\nasync fn it_supports_composite_types_in_arrays() -> anyhow::Result<()> {\r\n    // Only supported in Postgres 11+\r\n    let mut conn = new::<Postgres>().await?;\r\n    if matches!(conn.server_version_num(), Some(version) if version < 110000) {\r\n        return Ok(());\r\n    }\r\n\r\n    conn.execute(\r\n        r#\"\r\nDROP TABLE IF EXISTS pets;\r\nDROP DOMAIN IF EXISTS pet_name_and_race_array;\r\nDROP TYPE IF EXISTS PET_NAME_AND_RACE;\r\n\r\nCREATE TYPE PET_NAME_AND_RACE AS (\r\n  name TEXT,\r\n  race TEXT\r\n);\r\nCREATE DOMAIN pet_name_and_race_array AS PET_NAME_AND_RACE[];\r\nCREATE TABLE pets (\r\n  owner TEXT NOT NULL,\r\n  name TEXT NOT NULL,\r\n  race TEXT NOT NULL,\r\n  PRIMARY KEY (owner, name)\r\n);\r\nINSERT INTO pets(owner, name, race)\r\nVALUES\r\n  ('Alice', 'Foo', 'cat');\r\nINSERT INTO pets(owner, name, race)\r\nVALUES\r\n  ('Alice', 'Bar', 'dog');\r\n    \"#,\r\n    )\r\n        .await?;\r\n\r\n    #[derive(Clone, Debug, PartialEq, Eq, PartialOrd, Ord, Hash)]\r\n    struct PetNameAndRace {\r\n        name: String,\r\n        race: String,\r\n    }\r\n\r\n    impl sqlx::Type<Postgres> for PetNameAndRace {\r\n        fn type_info() -> sqlx::postgres::PgTypeInfo {\r\n            sqlx::postgres::PgTypeInfo::with_name(\"pet_name_and_race\")\r\n        }\r\n    }\r\n\r\n    impl<'r> sqlx::Decode<'r, Postgres> for PetNameAndRace {\r\n        fn decode(\r\n            value: sqlx::postgres::PgValueRef<'r>,\r\n        ) -> Result<Self, Box<dyn std::error::Error + 'static + Send + Sync>> {\r\n            let mut decoder = sqlx::postgres::types::PgRecordDecoder::new(value)?;\r\n            let name = decoder.try_decode::<String>()?;\r\n            let race = decoder.try_decode::<String>()?;\r\n            Ok(Self {name, race})\r\n        }\r\n    }\r\n\r\n    #[derive(Clone, Debug, PartialEq, Eq, PartialOrd, Ord, Hash)]\r\n    struct PetNameAndRaceArray(Vec<PetNameAndRace>);\r\n\r\n    impl sqlx::Type<Postgres> for PetNameAndRaceArray {\r\n        fn type_info() -> sqlx::postgres::PgTypeInfo {\r\n            // Array type name is the name of the element type prefixed with `_`\r\n            sqlx::postgres::PgTypeInfo::with_name(\"_pet_name_and_race\")\r\n        }\r\n    }\r\n\r\n    impl<'r> sqlx::Decode<'r, Postgres> for PetNameAndRaceArray {\r\n        fn decode(\r\n            value: sqlx::postgres::PgValueRef<'r>,\r\n        ) -> Result<Self, Box<dyn std::error::Error + 'static + Send + Sync>> {\r\n            Ok(Self(Vec::<PetNameAndRace>::decode(value)?))\r\n        }\r\n    }\r\n\r\n\r\n    let mut conn = new::<Postgres>().await?;\r\n\r\n    let row = sqlx::query(\"select owner, array_agg(row(name, race)::pet_name_and_race) as pets from pets group by owner\")\r\n        .fetch_one(&mut conn)\r\n        .await?;\r\n\r\n    let pets: PetNameAndRaceArray = row.get(\"pets\");\r\n\r\n    assert_eq!(pets.0.len(), 2);\r\n    Ok(())\r\n}\r\n```\r\n\r\n</details>","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/938571429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5437134433,"node_id":"REFE_lADODb6dM848zitEzwAAAAFEFBZh","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5437134433","actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"327af64f847c6cf626c9c0788d394bda820d2870","commit_url":"https://api.github.com/repos/demurgos/sqlx/commits/327af64f847c6cf626c9c0788d394bda820d2870","created_at":"2021-10-08T22:44:25Z","performed_via_github_app":null},{"actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-08T22:44:58Z","updated_at":"2021-10-08T22:44:58Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1483","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1483/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1483/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1483/events","html_url":"https://github.com/launchbadge/sqlx/pull/1483","id":1021518391,"node_id":"PR_kwDODb6dM84s9vXL","number":1483,"title":"Fix support for Postgres array of custom types","user":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-10-08T22:44:58Z","updated_at":"2021-12-30T16:11:30Z","closed_at":"2021-12-29T21:05:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":230595891,"node_id":"MDEwOlJlcG9zaXRvcnkyMzA1OTU4OTE=","name":"sqlx","full_name":"launchbadge/sqlx","private":false,"owner":{"login":"launchbadge","id":10077001,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwMDc3MDAx","avatar_url":"https://avatars.githubusercontent.com/u/10077001?v=4","gravatar_id":"","url":"https://api.github.com/users/launchbadge","html_url":"https://github.com/launchbadge","followers_url":"https://api.github.com/users/launchbadge/followers","following_url":"https://api.github.com/users/launchbadge/following{/other_user}","gists_url":"https://api.github.com/users/launchbadge/gists{/gist_id}","starred_url":"https://api.github.com/users/launchbadge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/launchbadge/subscriptions","organizations_url":"https://api.github.com/users/launchbadge/orgs","repos_url":"https://api.github.com/users/launchbadge/repos","events_url":"https://api.github.com/users/launchbadge/events{/privacy}","received_events_url":"https://api.github.com/users/launchbadge/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/launchbadge/sqlx","description":"ðŸ§° The Rust SQL Toolkit. An async, pure Rust SQL crate featuring compile-time checked queries without a DSL. Supports PostgreSQL, MySQL, and SQLite.","fork":false,"url":"https://api.github.com/repos/launchbadge/sqlx","forks_url":"https://api.github.com/repos/launchbadge/sqlx/forks","keys_url":"https://api.github.com/repos/launchbadge/sqlx/keys{/key_id}","collaborators_url":"https://api.github.com/repos/launchbadge/sqlx/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/launchbadge/sqlx/teams","hooks_url":"https://api.github.com/repos/launchbadge/sqlx/hooks","issue_events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/events{/number}","events_url":"https://api.github.com/repos/launchbadge/sqlx/events","assignees_url":"https://api.github.com/repos/launchbadge/sqlx/assignees{/user}","branches_url":"https://api.github.com/repos/launchbadge/sqlx/branches{/branch}","tags_url":"https://api.github.com/repos/launchbadge/sqlx/tags","blobs_url":"https://api.github.com/repos/launchbadge/sqlx/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/launchbadge/sqlx/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/launchbadge/sqlx/git/refs{/sha}","trees_url":"https://api.github.com/repos/launchbadge/sqlx/git/trees{/sha}","statuses_url":"https://api.github.com/repos/launchbadge/sqlx/statuses/{sha}","languages_url":"https://api.github.com/repos/launchbadge/sqlx/languages","stargazers_url":"https://api.github.com/repos/launchbadge/sqlx/stargazers","contributors_url":"https://api.github.com/repos/launchbadge/sqlx/contributors","subscribers_url":"https://api.github.com/repos/launchbadge/sqlx/subscribers","subscription_url":"https://api.github.com/repos/launchbadge/sqlx/subscription","commits_url":"https://api.github.com/repos/launchbadge/sqlx/commits{/sha}","git_commits_url":"https://api.github.com/repos/launchbadge/sqlx/git/commits{/sha}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/comments{/number}","issue_comment_url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments{/number}","contents_url":"https://api.github.com/repos/launchbadge/sqlx/contents/{+path}","compare_url":"https://api.github.com/repos/launchbadge/sqlx/compare/{base}...{head}","merges_url":"https://api.github.com/repos/launchbadge/sqlx/merges","archive_url":"https://api.github.com/repos/launchbadge/sqlx/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/launchbadge/sqlx/downloads","issues_url":"https://api.github.com/repos/launchbadge/sqlx/issues{/number}","pulls_url":"https://api.github.com/repos/launchbadge/sqlx/pulls{/number}","milestones_url":"https://api.github.com/repos/launchbadge/sqlx/milestones{/number}","notifications_url":"https://api.github.com/repos/launchbadge/sqlx/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/launchbadge/sqlx/labels{/name}","releases_url":"https://api.github.com/repos/launchbadge/sqlx/releases{/id}","deployments_url":"https://api.github.com/repos/launchbadge/sqlx/deployments","created_at":"2019-12-28T10:40:57Z","updated_at":"2025-11-10T07:15:41Z","pushed_at":"2025-10-29T18:37:49Z","git_url":"git://github.com/launchbadge/sqlx.git","ssh_url":"git@github.com:launchbadge/sqlx.git","clone_url":"https://github.com/launchbadge/sqlx.git","svn_url":"https://github.com/launchbadge/sqlx","homepage":"","size":9641,"stargazers_count":15938,"watchers_count":15938,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1502,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":701,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","await","mariadb","mysql","postgres","postgresql","rust","sql","sqlite"],"visibility":"public","forks":1502,"open_issues":701,"watchers":15938,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/launchbadge/sqlx/pulls/1483","html_url":"https://github.com/launchbadge/sqlx/pull/1483","diff_url":"https://github.com/launchbadge/sqlx/pull/1483.diff","patch_url":"https://github.com/launchbadge/sqlx/pull/1483.patch","merged_at":"2021-12-29T21:05:15Z"},"body":"This commit fixes the array decoder to support custom types. The core of the issue was that the array decoder did not use the type info retrieved from the database. It means that it only supported native types.\r\n\r\nThis commit fixes the issue by using the element type info fetched from the database. A new internal helper method is added to the `PgType` struct: it returns the type info for the inner array element, if available.\r\n\r\nCloses #1477","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1483/reactions","total_count":6,"+1":6,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1483/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/939153888","html_url":"https://github.com/launchbadge/sqlx/issues/1477#issuecomment-939153888","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1477","id":939153888,"node_id":"IC_kwDODb6dM843-lng","user":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-08T22:46:03Z","updated_at":"2021-10-08T22:46:19Z","body":"I sent a PR ( #1483 ) to fix the issue. The root cause was that the array decoder ignored the type info fetched from the DB, preventing it from supporting custom types.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/939153888/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5437849777,"node_id":"REFE_lADODb6dM848zitEzwAAAAFEHwCx","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5437849777","actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"ddd2b5675d131f25ae3312bca269736ad5082437","commit_url":"https://api.github.com/repos/demurgos/sqlx/commits/ddd2b5675d131f25ae3312bca269736ad5082437","created_at":"2021-10-09T08:37:31Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/968079057","html_url":"https://github.com/launchbadge/sqlx/issues/1477#issuecomment-968079057","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1477","id":968079057,"node_id":"IC_kwDODb6dM845s7bR","user":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-13T14:42:15Z","updated_at":"2021-11-13T14:42:15Z","body":"@jplatte @abonander \r\nI just noticed that besides the PR I send ( #1483 ) there is already is a similar PR: https://github.com/launchbadge/sqlx/pull/1385\r\n\r\nCould you comment on any of those PRs? This issue currently forces me to use my temporary fork of the lib, and I would much rather prefer to use the official version.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/968079057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5613210103,"node_id":"MEE_lADODb6dM848zitEzwAAAAFOksn3","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5613210103","actor":{"login":"jplatte","id":951129,"node_id":"MDQ6VXNlcjk1MTEyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/951129?v=4","gravatar_id":"","url":"https://api.github.com/users/jplatte","html_url":"https://github.com/jplatte","followers_url":"https://api.github.com/users/jplatte/followers","following_url":"https://api.github.com/users/jplatte/following{/other_user}","gists_url":"https://api.github.com/users/jplatte/gists{/gist_id}","starred_url":"https://api.github.com/users/jplatte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jplatte/subscriptions","organizations_url":"https://api.github.com/users/jplatte/orgs","repos_url":"https://api.github.com/users/jplatte/repos","events_url":"https://api.github.com/users/jplatte/events{/privacy}","received_events_url":"https://api.github.com/users/jplatte/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-11-13T14:42:15Z","performed_via_github_app":null},{"id":5613210105,"node_id":"SE_lADODb6dM848zitEzwAAAAFOksn5","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5613210105","actor":{"login":"jplatte","id":951129,"node_id":"MDQ6VXNlcjk1MTEyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/951129?v=4","gravatar_id":"","url":"https://api.github.com/users/jplatte","html_url":"https://github.com/jplatte","followers_url":"https://api.github.com/users/jplatte/followers","following_url":"https://api.github.com/users/jplatte/following{/other_user}","gists_url":"https://api.github.com/users/jplatte/gists{/gist_id}","starred_url":"https://api.github.com/users/jplatte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jplatte/subscriptions","organizations_url":"https://api.github.com/users/jplatte/orgs","repos_url":"https://api.github.com/users/jplatte/repos","events_url":"https://api.github.com/users/jplatte/events{/privacy}","received_events_url":"https://api.github.com/users/jplatte/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-11-13T14:42:15Z","performed_via_github_app":null},{"id":5613210107,"node_id":"MEE_lADODb6dM848zitEzwAAAAFOksn7","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5613210107","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-11-13T14:42:15Z","performed_via_github_app":null},{"id":5613210112,"node_id":"SE_lADODb6dM848zitEzwAAAAFOksoA","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5613210112","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-11-13T14:42:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/968082141","html_url":"https://github.com/launchbadge/sqlx/issues/1477#issuecomment-968082141","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1477","id":968082141,"node_id":"IC_kwDODb6dM845s8Ld","user":{"login":"jplatte","id":951129,"node_id":"MDQ6VXNlcjk1MTEyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/951129?v=4","gravatar_id":"","url":"https://api.github.com/users/jplatte","html_url":"https://github.com/jplatte","followers_url":"https://api.github.com/users/jplatte/followers","following_url":"https://api.github.com/users/jplatte/following{/other_user}","gists_url":"https://api.github.com/users/jplatte/gists{/gist_id}","starred_url":"https://api.github.com/users/jplatte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jplatte/subscriptions","organizations_url":"https://api.github.com/users/jplatte/orgs","repos_url":"https://api.github.com/users/jplatte/repos","events_url":"https://api.github.com/users/jplatte/events{/privacy}","received_events_url":"https://api.github.com/users/jplatte/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-13T15:02:27Z","updated_at":"2021-11-13T15:03:27Z","body":"Actually, #1385 and #1483 are entirely orthogonal: My PR doesn't touch the encode / decode logic at all, it only affects the `sqlx::Type` trait.\r\n\r\nI am not at all familiar with the postgres protocol and the Encode / Decode stuff, so can't comment on your PR.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/968082141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jplatte","id":951129,"node_id":"MDQ6VXNlcjk1MTEyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/951129?v=4","gravatar_id":"","url":"https://api.github.com/users/jplatte","html_url":"https://github.com/jplatte","followers_url":"https://api.github.com/users/jplatte/followers","following_url":"https://api.github.com/users/jplatte/following{/other_user}","gists_url":"https://api.github.com/users/jplatte/gists{/gist_id}","starred_url":"https://api.github.com/users/jplatte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jplatte/subscriptions","organizations_url":"https://api.github.com/users/jplatte/orgs","repos_url":"https://api.github.com/users/jplatte/repos","events_url":"https://api.github.com/users/jplatte/events{/privacy}","received_events_url":"https://api.github.com/users/jplatte/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/968104167","html_url":"https://github.com/launchbadge/sqlx/issues/1477#issuecomment-968104167","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1477","id":968104167,"node_id":"IC_kwDODb6dM845tBjn","user":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-13T17:25:57Z","updated_at":"2021-11-13T17:25:57Z","body":"I am not sure I understand your reply: both PRs are about improving support for arrays of custom types, and they don't touch the Postgres protocol.\r\n\r\nThe only change my PR does is that it reuses the type info already fetched from the DB to read arrays (so it is not restricted to built-in types).","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/968104167/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/968107772","html_url":"https://github.com/launchbadge/sqlx/issues/1477#issuecomment-968107772","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1477","id":968107772,"node_id":"IC_kwDODb6dM845tCb8","user":{"login":"jplatte","id":951129,"node_id":"MDQ6VXNlcjk1MTEyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/951129?v=4","gravatar_id":"","url":"https://api.github.com/users/jplatte","html_url":"https://github.com/jplatte","followers_url":"https://api.github.com/users/jplatte/followers","following_url":"https://api.github.com/users/jplatte/following{/other_user}","gists_url":"https://api.github.com/users/jplatte/gists{/gist_id}","starred_url":"https://api.github.com/users/jplatte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jplatte/subscriptions","organizations_url":"https://api.github.com/users/jplatte/orgs","repos_url":"https://api.github.com/users/jplatte/repos","events_url":"https://api.github.com/users/jplatte/events{/privacy}","received_events_url":"https://api.github.com/users/jplatte/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-13T17:50:10Z","updated_at":"2021-11-13T17:50:31Z","body":"> The only change my PR does is that it reuses the type info already fetched from the DB *to read arrays*\r\n\r\nMy PR doesn't change the behavior of how things are read / written. It is simply an addition that allows users to declare (through the new `PgHasArrayType` trait) the type name of the corresponding array type for a given Rust type such that `Vec<CustomType>` implements `sqlx::Type`, the same way implementing the `Type` trait allows declaring the corresponding regular DB type.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/968107772/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jplatte","id":951129,"node_id":"MDQ6VXNlcjk1MTEyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/951129?v=4","gravatar_id":"","url":"https://api.github.com/users/jplatte","html_url":"https://github.com/jplatte","followers_url":"https://api.github.com/users/jplatte/followers","following_url":"https://api.github.com/users/jplatte/following{/other_user}","gists_url":"https://api.github.com/users/jplatte/gists{/gist_id}","starred_url":"https://api.github.com/users/jplatte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jplatte/subscriptions","organizations_url":"https://api.github.com/users/jplatte/orgs","repos_url":"https://api.github.com/users/jplatte/repos","events_url":"https://api.github.com/users/jplatte/events{/privacy}","received_events_url":"https://api.github.com/users/jplatte/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-17T21:28:42Z","updated_at":"2021-11-17T21:28:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1547","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1547/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1547/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1547/events","html_url":"https://github.com/launchbadge/sqlx/issues/1547","id":1056509826,"node_id":"I_kwDODb6dM84--Q-C","number":1547,"title":"sqlx doesn't handle array_agg and composite type correctly","user":{"login":"winston0410","id":59228178,"node_id":"MDQ6VXNlcjU5MjI4MTc4","avatar_url":"https://avatars.githubusercontent.com/u/59228178?v=4","gravatar_id":"","url":"https://api.github.com/users/winston0410","html_url":"https://github.com/winston0410","followers_url":"https://api.github.com/users/winston0410/followers","following_url":"https://api.github.com/users/winston0410/following{/other_user}","gists_url":"https://api.github.com/users/winston0410/gists{/gist_id}","starred_url":"https://api.github.com/users/winston0410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/winston0410/subscriptions","organizations_url":"https://api.github.com/users/winston0410/orgs","repos_url":"https://api.github.com/users/winston0410/repos","events_url":"https://api.github.com/users/winston0410/events{/privacy}","received_events_url":"https://api.github.com/users/winston0410/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-11-17T19:07:55Z","updated_at":"2023-11-04T00:21:47Z","closed_at":"2023-11-04T00:21:47Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":230595891,"node_id":"MDEwOlJlcG9zaXRvcnkyMzA1OTU4OTE=","name":"sqlx","full_name":"launchbadge/sqlx","private":false,"owner":{"login":"launchbadge","id":10077001,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwMDc3MDAx","avatar_url":"https://avatars.githubusercontent.com/u/10077001?v=4","gravatar_id":"","url":"https://api.github.com/users/launchbadge","html_url":"https://github.com/launchbadge","followers_url":"https://api.github.com/users/launchbadge/followers","following_url":"https://api.github.com/users/launchbadge/following{/other_user}","gists_url":"https://api.github.com/users/launchbadge/gists{/gist_id}","starred_url":"https://api.github.com/users/launchbadge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/launchbadge/subscriptions","organizations_url":"https://api.github.com/users/launchbadge/orgs","repos_url":"https://api.github.com/users/launchbadge/repos","events_url":"https://api.github.com/users/launchbadge/events{/privacy}","received_events_url":"https://api.github.com/users/launchbadge/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/launchbadge/sqlx","description":"ðŸ§° The Rust SQL Toolkit. An async, pure Rust SQL crate featuring compile-time checked queries without a DSL. Supports PostgreSQL, MySQL, and SQLite.","fork":false,"url":"https://api.github.com/repos/launchbadge/sqlx","forks_url":"https://api.github.com/repos/launchbadge/sqlx/forks","keys_url":"https://api.github.com/repos/launchbadge/sqlx/keys{/key_id}","collaborators_url":"https://api.github.com/repos/launchbadge/sqlx/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/launchbadge/sqlx/teams","hooks_url":"https://api.github.com/repos/launchbadge/sqlx/hooks","issue_events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/events{/number}","events_url":"https://api.github.com/repos/launchbadge/sqlx/events","assignees_url":"https://api.github.com/repos/launchbadge/sqlx/assignees{/user}","branches_url":"https://api.github.com/repos/launchbadge/sqlx/branches{/branch}","tags_url":"https://api.github.com/repos/launchbadge/sqlx/tags","blobs_url":"https://api.github.com/repos/launchbadge/sqlx/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/launchbadge/sqlx/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/launchbadge/sqlx/git/refs{/sha}","trees_url":"https://api.github.com/repos/launchbadge/sqlx/git/trees{/sha}","statuses_url":"https://api.github.com/repos/launchbadge/sqlx/statuses/{sha}","languages_url":"https://api.github.com/repos/launchbadge/sqlx/languages","stargazers_url":"https://api.github.com/repos/launchbadge/sqlx/stargazers","contributors_url":"https://api.github.com/repos/launchbadge/sqlx/contributors","subscribers_url":"https://api.github.com/repos/launchbadge/sqlx/subscribers","subscription_url":"https://api.github.com/repos/launchbadge/sqlx/subscription","commits_url":"https://api.github.com/repos/launchbadge/sqlx/commits{/sha}","git_commits_url":"https://api.github.com/repos/launchbadge/sqlx/git/commits{/sha}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/comments{/number}","issue_comment_url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments{/number}","contents_url":"https://api.github.com/repos/launchbadge/sqlx/contents/{+path}","compare_url":"https://api.github.com/repos/launchbadge/sqlx/compare/{base}...{head}","merges_url":"https://api.github.com/repos/launchbadge/sqlx/merges","archive_url":"https://api.github.com/repos/launchbadge/sqlx/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/launchbadge/sqlx/downloads","issues_url":"https://api.github.com/repos/launchbadge/sqlx/issues{/number}","pulls_url":"https://api.github.com/repos/launchbadge/sqlx/pulls{/number}","milestones_url":"https://api.github.com/repos/launchbadge/sqlx/milestones{/number}","notifications_url":"https://api.github.com/repos/launchbadge/sqlx/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/launchbadge/sqlx/labels{/name}","releases_url":"https://api.github.com/repos/launchbadge/sqlx/releases{/id}","deployments_url":"https://api.github.com/repos/launchbadge/sqlx/deployments","created_at":"2019-12-28T10:40:57Z","updated_at":"2025-11-10T07:15:41Z","pushed_at":"2025-10-29T18:37:49Z","git_url":"git://github.com/launchbadge/sqlx.git","ssh_url":"git@github.com:launchbadge/sqlx.git","clone_url":"https://github.com/launchbadge/sqlx.git","svn_url":"https://github.com/launchbadge/sqlx","homepage":"","size":9641,"stargazers_count":15938,"watchers_count":15938,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1502,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":701,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","await","mariadb","mysql","postgres","postgresql","rust","sql","sqlite"],"visibility":"public","forks":1502,"open_issues":701,"watchers":15938,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I am using postgres, and I am making a query like this:\r\n\r\n```rust\r\nuse chrono::{DateTime, Utc};\r\nuse ormx::{Patch, Table};\r\nuse serde::{Deserialize, Serialize};\r\nuse sqlx::{FromRow, Type};\r\n\r\n#[derive(Debug, Table, Clone, Serialize, Type, FromRow)]\r\n#[ormx(table = \"tags\", id = id, insertable, deletable)]\r\npub struct Tag {\r\n    #[ormx(default)]\r\n    pub id: i32,\r\n    pub name: String,\r\n    pub updated_at: DateTime<Utc>,\r\n}\r\n\r\n#[derive(Debug, Clone, Serialize, FromRow)]\r\npub struct TaskEntity {\r\n    pub tags: Option<Vec<Tag>>,\r\n}\r\n\r\nimpl TaskEntity {\r\n    pub async fn all_by_gid(pool: &Pool<Postgres>, gid: u32) -> Result<Vec<TaskEntity>, Error> {\r\n        sqlx::query_as!(TaskEntity, r#\"\r\n        select array_agg(tags.*) as \"tags: Vec<Tag>\" \r\n        from tasks_tags\r\n        join tags on tasks_tags.tag_id = tags.id\r\n        \"#).fetch_all(pool).await\r\n    }\r\n}\r\n\r\n```\r\n\r\nAnd then I got an error like this:\r\n\r\n```\r\nthread 'actix-rt|system:0|arbiter:0' panicked at 'internal error: entered unreachable code: (bug) use of unresolved type declaration [oid=22100]', /home/hugosum/.cache/cargo/registry/src/github.com-1ecc6299db9ec823/sqlx-core-0.5.9/src/postgres/type_info.rs:746:17\r\n```\r\n\r\nI have then tried to change the type to `String` like this:\r\n\r\n```rust\r\n#[derive(Debug, Clone, Serialize, FromRow)]\r\npub struct TaskEntity {\r\n    pub tags: Option<Vec<String>>,\r\n}\r\n\r\nimpl TaskEntity {\r\n    pub async fn all_by_gid(pool: &Pool<Postgres>, gid: u32) -> Result<Vec<TaskEntity>, Error> {\r\n        sqlx::query_as!(TaskEntity, r#\"\r\n        select array_agg(tags.*) as \"tags: Vec<String>\" \r\n        from tasks_tags\r\n        join tags on tasks_tags.tag_id = tags.id\r\n        \"#).fetch_all(pool).await\r\n    }\r\n}\r\n\r\n```\r\n\r\nAnd got this error this time:\r\n\r\n```\r\nColumnDecode { index: \"0\", source: Utf8Error { valid_up_to: 33, error_len: Some(1) } }\r\n```\r\n\r\nAnd it would work if I just get a single field with `String`:\r\n\r\n```rust\r\n#[derive(Debug, Clone, Serialize, FromRow)]\r\npub struct TaskEntity {\r\n    pub tags: Option<Vec<String>>,\r\n}\r\n\r\nimpl TaskEntity {\r\n    pub async fn all_by_gid(pool: &Pool<Postgres>, gid: u32) -> Result<Vec<TaskEntity>, Error> {\r\n        sqlx::query_as!(TaskEntity, r#\"\r\n        select array_agg(tags.name) as \"tags: Vec<String>\" \r\n        from tasks_tags\r\n        join tags on tasks_tags.tag_id = tags.id\r\n        \"#).fetch_all(pool).await\r\n    }\r\n}\r\n```\r\n\r\nSo I suspect the issue is with the composite type created by `array_agg`. Is there any workaround right now?\r\n\r\ndatabase schema as a reference:\r\n\r\n```sql\r\nCREATE TYPE status AS ENUM ('completed', 'incomplete');\r\n\r\ndrop table if exists tasks;\r\ncreate table if not exists tasks(\r\n    id int GENERATED ALWAYS AS IDENTITY,\r\n    name varchar(256) not null,\r\n    -- created_at timestamptz not null,\r\n    updated_at timestamptz not null,\r\n    status status not null,\r\n    primary key(id)\r\n);\r\n\r\ndrop table if exists tags;\r\ncreate table if not exists tags(\r\n    id int GENERATED ALWAYS AS IDENTITY,\r\n    name varchar(256) not null,\r\n    updated_at timestamptz not null,\r\n    primary key(id)\r\n);\r\n\r\ndrop table if exists tasks_tags;\r\ncreate table if not exists tasks_tags(\r\n    id int GENERATED ALWAYS AS IDENTITY,\r\n    task_id int not null,\r\n    tag_id int not null,\r\n    primary key(id),\r\n    foreign key(task_id) references tasks ON DELETE CASCADE,\r\n    foreign key(tag_id) references tags ON DELETE CASCADE\r\n);\r\n```","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1547/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1547/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/972668099","html_url":"https://github.com/launchbadge/sqlx/issues/1477#issuecomment-972668099","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1477","id":972668099,"node_id":"IC_kwDODb6dM845-bzD","user":{"login":"winston0410","id":59228178,"node_id":"MDQ6VXNlcjU5MjI4MTc4","avatar_url":"https://avatars.githubusercontent.com/u/59228178?v=4","gravatar_id":"","url":"https://api.github.com/users/winston0410","html_url":"https://github.com/winston0410","followers_url":"https://api.github.com/users/winston0410/followers","following_url":"https://api.github.com/users/winston0410/following{/other_user}","gists_url":"https://api.github.com/users/winston0410/gists{/gist_id}","starred_url":"https://api.github.com/users/winston0410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/winston0410/subscriptions","organizations_url":"https://api.github.com/users/winston0410/orgs","repos_url":"https://api.github.com/users/winston0410/repos","events_url":"https://api.github.com/users/winston0410/events{/privacy}","received_events_url":"https://api.github.com/users/winston0410/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-18T09:06:03Z","updated_at":"2021-11-18T09:06:03Z","body":"The PR of @demurgos has solved the issue perfectly! Can it be merged anytime soon?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/972668099/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"winston0410","id":59228178,"node_id":"MDQ6VXNlcjU5MjI4MTc4","avatar_url":"https://avatars.githubusercontent.com/u/59228178?v=4","gravatar_id":"","url":"https://api.github.com/users/winston0410","html_url":"https://github.com/winston0410","followers_url":"https://api.github.com/users/winston0410/followers","following_url":"https://api.github.com/users/winston0410/following{/other_user}","gists_url":"https://api.github.com/users/winston0410/gists{/gist_id}","starred_url":"https://api.github.com/users/winston0410/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/winston0410/subscriptions","organizations_url":"https://api.github.com/users/winston0410/orgs","repos_url":"https://api.github.com/users/winston0410/repos","events_url":"https://api.github.com/users/winston0410/events{/privacy}","received_events_url":"https://api.github.com/users/winston0410/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5637265457,"node_id":"MEE_lADODb6dM848zitEzwAAAAFQAdgx","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5637265457","actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-11-18T09:06:03Z","performed_via_github_app":null},{"id":5637265468,"node_id":"SE_lADODb6dM848zitEzwAAAAFQAdg8","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5637265468","actor":{"login":"demurgos","id":2262218,"node_id":"MDQ6VXNlcjIyNjIyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2262218?v=4","gravatar_id":"","url":"https://api.github.com/users/demurgos","html_url":"https://github.com/demurgos","followers_url":"https://api.github.com/users/demurgos/followers","following_url":"https://api.github.com/users/demurgos/following{/other_user}","gists_url":"https://api.github.com/users/demurgos/gists{/gist_id}","starred_url":"https://api.github.com/users/demurgos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/demurgos/subscriptions","organizations_url":"https://api.github.com/users/demurgos/orgs","repos_url":"https://api.github.com/users/demurgos/repos","events_url":"https://api.github.com/users/demurgos/events{/privacy}","received_events_url":"https://api.github.com/users/demurgos/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-11-18T09:06:03Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/986996865","html_url":"https://github.com/launchbadge/sqlx/issues/1477#issuecomment-986996865","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1477","id":986996865,"node_id":"IC_kwDODb6dM8461GCB","user":{"login":"iupii","id":45940305,"node_id":"MDQ6VXNlcjQ1OTQwMzA1","avatar_url":"https://avatars.githubusercontent.com/u/45940305?v=4","gravatar_id":"","url":"https://api.github.com/users/iupii","html_url":"https://github.com/iupii","followers_url":"https://api.github.com/users/iupii/followers","following_url":"https://api.github.com/users/iupii/following{/other_user}","gists_url":"https://api.github.com/users/iupii/gists{/gist_id}","starred_url":"https://api.github.com/users/iupii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iupii/subscriptions","organizations_url":"https://api.github.com/users/iupii/orgs","repos_url":"https://api.github.com/users/iupii/repos","events_url":"https://api.github.com/users/iupii/events{/privacy}","received_events_url":"https://api.github.com/users/iupii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-06T17:33:03Z","updated_at":"2021-12-06T17:33:03Z","body":"I have the same issue.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/986996865/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"iupii","id":45940305,"node_id":"MDQ6VXNlcjQ1OTQwMzA1","avatar_url":"https://avatars.githubusercontent.com/u/45940305?v=4","gravatar_id":"","url":"https://api.github.com/users/iupii","html_url":"https://github.com/iupii","followers_url":"https://api.github.com/users/iupii/followers","following_url":"https://api.github.com/users/iupii/following{/other_user}","gists_url":"https://api.github.com/users/iupii/gists{/gist_id}","starred_url":"https://api.github.com/users/iupii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iupii/subscriptions","organizations_url":"https://api.github.com/users/iupii/orgs","repos_url":"https://api.github.com/users/iupii/repos","events_url":"https://api.github.com/users/iupii/events{/privacy}","received_events_url":"https://api.github.com/users/iupii/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5826069695,"node_id":"CE_lADODb6dM848zitEzwAAAAFbQsS_","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5826069695","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-12-29T21:05:15Z","state_reason":null,"performed_via_github_app":null},{"id":5826069747,"node_id":"REFE_lADODb6dM848zitEzwAAAAFbQsTz","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/5826069747","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"32f1273565e1cd676e0514655fe8aec67b59b634","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/32f1273565e1cd676e0514655fe8aec67b59b634","created_at":"2021-12-29T21:05:16Z","performed_via_github_app":null}]