[{"id":6322205405,"node_id":"LE_lADODb6dM85Gk0_hzwAAAAF41TLd","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6322205405","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-03-28T22:48:38Z","label":{"name":"db:postgres","color":"336791"},"performed_via_github_app":null},{"id":6322205406,"node_id":"LE_lADODb6dM85Gk0_hzwAAAAF41TLe","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6322205406","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-03-28T22:48:38Z","label":{"name":"pool","color":"7680ed"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1081251370","html_url":"https://github.com/launchbadge/sqlx/issues/1764#issuecomment-1081251370","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1764","id":1081251370,"node_id":"IC_kwDODb6dM85AcpYq","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-28T23:32:13Z","updated_at":"2022-03-28T23:32:13Z","body":"To be fair, there's nothing in the documentation that suggests that this is how it'll work. If there's an error on the connection, `try_recv()` will try to acquire another from the pool at which point it would return `PoolClosed`, but not before.\r\n\r\nFrom the pool's perspective, `PgListener` isn't anything special. The task using it is just like any other that's sitting on an acquired connection or waiting on an in-flight query. Calling `close()` doesn't cancel in-flight queries (which requires a separate connection with superuser privileges to do so in Postgres anyway), nor does it have any way in general to notify tasks that are currently holding a connection that the pool is closed. \r\n\r\nSimilarly, if you `.leak()` a `PoolConnection` it'll simply prevent the pool from ever closing, which I honestly didn't realize until just now makes that method particularly hazardous. `Pool` should probably maintain an internal count of leaked connections so it doesn't wait forever for them to never be returned, but that's an orthogonal issue.\r\n\r\nThat kind of stuff is too tied into application-level semantics to be handled automatically, although I appreciate that it would be annoying to retrofit your own \"application is shutting down, please stop listening\" notification.\r\n\r\nGiven that `try_recv()` would eventually return `PoolClosed` _anyway_, I don't see a huge issue with changing it to be returned eagerly when the pool is closed. \r\n\r\nHowever, I think it could be really useful to make it possible to listen for the closed notification on `Pool` directly so other application code that acquires and holds a connection for long durations can implement the same behavior. It could be something as simple as:\r\n\r\n```rust\r\nimpl<T> Pool<T> {\r\n    /// Resolves when `.close()` is called.\r\n\r\n    /// Can be used with something like `select!()` to cancel tasks that acquire and hold onto connections for a long time,\r\n    /// which would otherwise prevent the pool from closing.\r\n    pub async fn closed(&self) {\r\n\r\n    }\r\n}\r\n```","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1081251370/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1081257469","html_url":"https://github.com/launchbadge/sqlx/issues/1764#issuecomment-1081257469","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1764","id":1081257469,"node_id":"IC_kwDODb6dM85Acq39","user":{"login":"dbeckwith","id":1279939,"node_id":"MDQ6VXNlcjEyNzk5Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1279939?v=4","gravatar_id":"","url":"https://api.github.com/users/dbeckwith","html_url":"https://github.com/dbeckwith","followers_url":"https://api.github.com/users/dbeckwith/followers","following_url":"https://api.github.com/users/dbeckwith/following{/other_user}","gists_url":"https://api.github.com/users/dbeckwith/gists{/gist_id}","starred_url":"https://api.github.com/users/dbeckwith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbeckwith/subscriptions","organizations_url":"https://api.github.com/users/dbeckwith/orgs","repos_url":"https://api.github.com/users/dbeckwith/repos","events_url":"https://api.github.com/users/dbeckwith/events{/privacy}","received_events_url":"https://api.github.com/users/dbeckwith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-28T23:44:09Z","updated_at":"2022-03-28T23:44:09Z","body":"> To be fair, there's nothing in the documentation that suggests that this is how it'll work. If there's an error on the connection, `try_recv()` will try to acquire another from the pool at which point it would return `PoolClosed`, but not before.\r\n\r\nSo just to make sure I understand, you're saying that in my situation, I would eventually get a `PoolClosed` from `try_recv()`, but only after something else causes an error? I think it would be much more useful if that happened immediately.\r\n\r\nI suppose I could always try to interrupt the `try_recv()` if my own quit signal gets notified, but according to [this comment](https://github.com/launchbadge/sqlx/issues/643#issuecomment-675728317) I think that might run into other issues? If not, your `Pool::closed` suggestion sounds great.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1081257469/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dbeckwith","id":1279939,"node_id":"MDQ6VXNlcjEyNzk5Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1279939?v=4","gravatar_id":"","url":"https://api.github.com/users/dbeckwith","html_url":"https://github.com/dbeckwith","followers_url":"https://api.github.com/users/dbeckwith/followers","following_url":"https://api.github.com/users/dbeckwith/following{/other_user}","gists_url":"https://api.github.com/users/dbeckwith/gists{/gist_id}","starred_url":"https://api.github.com/users/dbeckwith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbeckwith/subscriptions","organizations_url":"https://api.github.com/users/dbeckwith/orgs","repos_url":"https://api.github.com/users/dbeckwith/repos","events_url":"https://api.github.com/users/dbeckwith/events{/privacy}","received_events_url":"https://api.github.com/users/dbeckwith/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1081276920","html_url":"https://github.com/launchbadge/sqlx/issues/1764#issuecomment-1081276920","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1764","id":1081276920,"node_id":"IC_kwDODb6dM85Acvn4","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-29T00:23:22Z","updated_at":"2022-03-29T00:23:22Z","body":"> I suppose I could always try to interrupt the try_recv() if my own quit signal gets notified, but according to https://github.com/launchbadge/sqlx/issues/643#issuecomment-675728317 I think that might run into other issues?\r\n\r\nTheoretically yeah, but if your application is immediately quitting anyway, it doesn't really matter.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1081276920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1081347515","html_url":"https://github.com/launchbadge/sqlx/issues/1764#issuecomment-1081347515","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1764","id":1081347515,"node_id":"IC_kwDODb6dM85AdA27","user":{"login":"dbeckwith","id":1279939,"node_id":"MDQ6VXNlcjEyNzk5Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1279939?v=4","gravatar_id":"","url":"https://api.github.com/users/dbeckwith","html_url":"https://github.com/dbeckwith","followers_url":"https://api.github.com/users/dbeckwith/followers","following_url":"https://api.github.com/users/dbeckwith/following{/other_user}","gists_url":"https://api.github.com/users/dbeckwith/gists{/gist_id}","starred_url":"https://api.github.com/users/dbeckwith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbeckwith/subscriptions","organizations_url":"https://api.github.com/users/dbeckwith/orgs","repos_url":"https://api.github.com/users/dbeckwith/repos","events_url":"https://api.github.com/users/dbeckwith/events{/privacy}","received_events_url":"https://api.github.com/users/dbeckwith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-29T02:56:24Z","updated_at":"2022-03-29T02:56:24Z","body":"Well that's the thing, I'm trying not to immediately quit, I wanted the shutdown to be as \"nice\" as possible and let everything close that needs to. I'll try cancelling `try_recv()` and see if that works.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1081347515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dbeckwith","id":1279939,"node_id":"MDQ6VXNlcjEyNzk5Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1279939?v=4","gravatar_id":"","url":"https://api.github.com/users/dbeckwith","html_url":"https://github.com/dbeckwith","followers_url":"https://api.github.com/users/dbeckwith/followers","following_url":"https://api.github.com/users/dbeckwith/following{/other_user}","gists_url":"https://api.github.com/users/dbeckwith/gists{/gist_id}","starred_url":"https://api.github.com/users/dbeckwith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbeckwith/subscriptions","organizations_url":"https://api.github.com/users/dbeckwith/orgs","repos_url":"https://api.github.com/users/dbeckwith/repos","events_url":"https://api.github.com/users/dbeckwith/events{/privacy}","received_events_url":"https://api.github.com/users/dbeckwith/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1082239167","html_url":"https://github.com/launchbadge/sqlx/issues/1764#issuecomment-1082239167","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1764","id":1082239167,"node_id":"IC_kwDODb6dM85Agai_","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-29T18:34:52Z","updated_at":"2022-03-29T18:34:52Z","body":"I mean if you're not going to use the connection again, which you won't be as the connection will be closed as soon as you return it to the pool.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1082239167/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1082398958","html_url":"https://github.com/launchbadge/sqlx/issues/1764#issuecomment-1082398958","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1764","id":1082398958,"node_id":"IC_kwDODb6dM85AhBju","user":{"login":"dbeckwith","id":1279939,"node_id":"MDQ6VXNlcjEyNzk5Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1279939?v=4","gravatar_id":"","url":"https://api.github.com/users/dbeckwith","html_url":"https://github.com/dbeckwith","followers_url":"https://api.github.com/users/dbeckwith/followers","following_url":"https://api.github.com/users/dbeckwith/following{/other_user}","gists_url":"https://api.github.com/users/dbeckwith/gists{/gist_id}","starred_url":"https://api.github.com/users/dbeckwith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbeckwith/subscriptions","organizations_url":"https://api.github.com/users/dbeckwith/orgs","repos_url":"https://api.github.com/users/dbeckwith/repos","events_url":"https://api.github.com/users/dbeckwith/events{/privacy}","received_events_url":"https://api.github.com/users/dbeckwith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-29T21:40:01Z","updated_at":"2022-03-29T21:40:01Z","body":"Ah okay I see what you mean, that makes sense.\r\n\r\nI was able to get a working solution by using `select` on the `try_recv()` call to interrupt it when my application is exiting. This works fine for me, but I can definitely see the general use in the `Pool::closed` future you suggested so you don't need to use an external quit notification and can just tell if you're exiting from the pool itself.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1082398958/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"dbeckwith","id":1279939,"node_id":"MDQ6VXNlcjEyNzk5Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1279939?v=4","gravatar_id":"","url":"https://api.github.com/users/dbeckwith","html_url":"https://github.com/dbeckwith","followers_url":"https://api.github.com/users/dbeckwith/followers","following_url":"https://api.github.com/users/dbeckwith/following{/other_user}","gists_url":"https://api.github.com/users/dbeckwith/gists{/gist_id}","starred_url":"https://api.github.com/users/dbeckwith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbeckwith/subscriptions","organizations_url":"https://api.github.com/users/dbeckwith/orgs","repos_url":"https://api.github.com/users/dbeckwith/repos","events_url":"https://api.github.com/users/dbeckwith/events{/privacy}","received_events_url":"https://api.github.com/users/dbeckwith/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6330050566,"node_id":"CE_lADODb6dM85Gk0_hzwAAAAF5TOgG","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6330050566","actor":{"login":"dbeckwith","id":1279939,"node_id":"MDQ6VXNlcjEyNzk5Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1279939?v=4","gravatar_id":"","url":"https://api.github.com/users/dbeckwith","html_url":"https://github.com/dbeckwith","followers_url":"https://api.github.com/users/dbeckwith/followers","following_url":"https://api.github.com/users/dbeckwith/following{/other_user}","gists_url":"https://api.github.com/users/dbeckwith/gists{/gist_id}","starred_url":"https://api.github.com/users/dbeckwith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dbeckwith/subscriptions","organizations_url":"https://api.github.com/users/dbeckwith/orgs","repos_url":"https://api.github.com/users/dbeckwith/repos","events_url":"https://api.github.com/users/dbeckwith/events{/privacy}","received_events_url":"https://api.github.com/users/dbeckwith/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-03-29T21:40:01Z","state_reason":null,"performed_via_github_app":null},{"id":6337330282,"node_id":"REE_lADODb6dM85Gk0_hzwAAAAF5u_xq","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6337330282","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2022-03-30T18:18:31Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1083464134","html_url":"https://github.com/launchbadge/sqlx/issues/1764#issuecomment-1083464134","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1764","id":1083464134,"node_id":"IC_kwDODb6dM85AlFnG","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-30T18:18:52Z","updated_at":"2022-03-30T18:18:52Z","body":"Leaving this open as a note to implement that close notification and integrate it into `PgListener`.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/1083464134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-02T00:00:41Z","updated_at":"2022-04-02T00:00:41Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/smol-rs/async-lock/issues/22","repository_url":"https://api.github.com/repos/smol-rs/async-lock","labels_url":"https://api.github.com/repos/smol-rs/async-lock/issues/22/labels{/name}","comments_url":"https://api.github.com/repos/smol-rs/async-lock/issues/22/comments","events_url":"https://api.github.com/repos/smol-rs/async-lock/issues/22/events","html_url":"https://github.com/smol-rs/async-lock/issues/22","id":1190402428,"node_id":"I_kwDOD8cEas5G9Bl8","number":22,"title":"Feature request: manually release semaphore permits","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-04-02T00:00:41Z","updated_at":"2023-05-27T04:44:03Z","closed_at":"2023-05-27T04:44:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":264701034,"node_id":"MDEwOlJlcG9zaXRvcnkyNjQ3MDEwMzQ=","name":"async-lock","full_name":"smol-rs/async-lock","private":false,"owner":{"login":"smol-rs","id":73748432,"node_id":"MDEyOk9yZ2FuaXphdGlvbjczNzQ4NDMy","avatar_url":"https://avatars.githubusercontent.com/u/73748432?v=4","gravatar_id":"","url":"https://api.github.com/users/smol-rs","html_url":"https://github.com/smol-rs","followers_url":"https://api.github.com/users/smol-rs/followers","following_url":"https://api.github.com/users/smol-rs/following{/other_user}","gists_url":"https://api.github.com/users/smol-rs/gists{/gist_id}","starred_url":"https://api.github.com/users/smol-rs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smol-rs/subscriptions","organizations_url":"https://api.github.com/users/smol-rs/orgs","repos_url":"https://api.github.com/users/smol-rs/repos","events_url":"https://api.github.com/users/smol-rs/events{/privacy}","received_events_url":"https://api.github.com/users/smol-rs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/smol-rs/async-lock","description":"Async synchronization primitives","fork":false,"url":"https://api.github.com/repos/smol-rs/async-lock","forks_url":"https://api.github.com/repos/smol-rs/async-lock/forks","keys_url":"https://api.github.com/repos/smol-rs/async-lock/keys{/key_id}","collaborators_url":"https://api.github.com/repos/smol-rs/async-lock/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/smol-rs/async-lock/teams","hooks_url":"https://api.github.com/repos/smol-rs/async-lock/hooks","issue_events_url":"https://api.github.com/repos/smol-rs/async-lock/issues/events{/number}","events_url":"https://api.github.com/repos/smol-rs/async-lock/events","assignees_url":"https://api.github.com/repos/smol-rs/async-lock/assignees{/user}","branches_url":"https://api.github.com/repos/smol-rs/async-lock/branches{/branch}","tags_url":"https://api.github.com/repos/smol-rs/async-lock/tags","blobs_url":"https://api.github.com/repos/smol-rs/async-lock/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/smol-rs/async-lock/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/smol-rs/async-lock/git/refs{/sha}","trees_url":"https://api.github.com/repos/smol-rs/async-lock/git/trees{/sha}","statuses_url":"https://api.github.com/repos/smol-rs/async-lock/statuses/{sha}","languages_url":"https://api.github.com/repos/smol-rs/async-lock/languages","stargazers_url":"https://api.github.com/repos/smol-rs/async-lock/stargazers","contributors_url":"https://api.github.com/repos/smol-rs/async-lock/contributors","subscribers_url":"https://api.github.com/repos/smol-rs/async-lock/subscribers","subscription_url":"https://api.github.com/repos/smol-rs/async-lock/subscription","commits_url":"https://api.github.com/repos/smol-rs/async-lock/commits{/sha}","git_commits_url":"https://api.github.com/repos/smol-rs/async-lock/git/commits{/sha}","comments_url":"https://api.github.com/repos/smol-rs/async-lock/comments{/number}","issue_comment_url":"https://api.github.com/repos/smol-rs/async-lock/issues/comments{/number}","contents_url":"https://api.github.com/repos/smol-rs/async-lock/contents/{+path}","compare_url":"https://api.github.com/repos/smol-rs/async-lock/compare/{base}...{head}","merges_url":"https://api.github.com/repos/smol-rs/async-lock/merges","archive_url":"https://api.github.com/repos/smol-rs/async-lock/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/smol-rs/async-lock/downloads","issues_url":"https://api.github.com/repos/smol-rs/async-lock/issues{/number}","pulls_url":"https://api.github.com/repos/smol-rs/async-lock/pulls{/number}","milestones_url":"https://api.github.com/repos/smol-rs/async-lock/milestones{/number}","notifications_url":"https://api.github.com/repos/smol-rs/async-lock/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/smol-rs/async-lock/labels{/name}","releases_url":"https://api.github.com/repos/smol-rs/async-lock/releases{/id}","deployments_url":"https://api.github.com/repos/smol-rs/async-lock/deployments","created_at":"2020-05-17T15:42:15Z","updated_at":"2025-10-27T20:43:38Z","pushed_at":"2025-08-25T00:22:29Z","git_url":"git://github.com/smol-rs/async-lock.git","ssh_url":"git@github.com:smol-rs/async-lock.git","clone_url":"https://github.com/smol-rs/async-lock.git","svn_url":"https://github.com/smol-rs/async-lock","homepage":"","size":208,"stargazers_count":275,"watchers_count":275,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":35,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":8,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","rust"],"visibility":"public","forks":35,"open_issues":8,"watchers":275,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I'm evaluating this crate as a replacement for `futures-intrusive` in SQLx for our connection pool implementation as the maintenance status of the former is currently unknown: https://github.com/launchbadge/sqlx/issues/1668#issuecomment-1032026830\r\n\r\nThe pool internally uses a semaphore where each permit represents the privilege for a task to acquire a connection; once it acquires a permit, it first checks the idle queue to see if an idle connection is available, or if the idle queue is empty then it may open a new connection. The pool starts with a set maximum number of permits, and permits are released when a connection is returned to the idle queue or is closed for whatever reason.\r\n\r\nThe function of the pool currently requires having the ability to release permits manually to the semaphore, for two main reasons:\r\n\r\n* to sidestep ownership issues with `SemaphoreGuard` as neither borrowing the semaphore nor keeping it by itself in an `Arc` is an optimal solution;\r\n    * `PoolConnection` doesn't want to contain a `SemaphoreGuard` that borrows into the pool shared state as that's a less ergonomic and flexible API than `PoolConnection` being `'static`.\r\n    * keeping the semaphore in an `Arc` by itself to satisfy the `SemaphoreGuardArc` API is annoyingly redundant as the pool already keeps its shared state in an `Arc`.\r\n    * currently, when a `SemaphoreGuard` is acquired it's `mem::forget()`'d to \"leak\" the permit, then a separate RAII guard that holds an `Arc` to the pool's shared state calls the method to release the permit on-drop. \r\n* to signal all tasks waiting to acquire a connection that the pool is closed, `usize::MAX / 2` permits are released (the pool maintains the invariant that its capacity plus this value must not overflow, to avoid potential issues there).\r\n\r\nI'm also working on a separate close-notification feature for https://github.com/launchbadge/sqlx/issues/1764 but I think that should be a separate waitlist as that's likely to consist of long-lived tasks expecting to wait from spawn until the pool is closed (usually the full lifetime of the process), and I don't want those clogging up the normal waitlist. If it was possible to make them always wait at the back of the list, that would save some work, but I don't think that's important.\r\n\r\nAs for bikeshedding, `futures_intrusive::sync::GenericSemaphore` simply calls the function `release()` whereas `tokio::sync::Semaphore` calls it `add_permits()`:\r\n\r\n* https://docs.rs/futures-intrusive/latest/futures_intrusive/sync/struct.GenericSemaphore.html#method.release\r\n* https://docs.rs/tokio/latest/tokio/sync/struct.Semaphore.html#method.add_permits\r\n\r\nAnecdotally, I think `release` is better as that's what comes to mind with this operation. I overlooked `add_permits` in the Tokio API initially because I was looking for the keyword \"release\" when scanning the functions.\r\n\r\nMaybe `manual_release()` to differentiate it from the \"automatic release\" function of `SemaphoreGuard`?","reactions":{"url":"https://api.github.com/repos/smol-rs/async-lock/issues/22/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/smol-rs/async-lock/issues/22/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":6356155200,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF62ztA","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6356155200","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"424691a081e1da7d54a3b5b9a91de6a4750c4ec0","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/424691a081e1da7d54a3b5b9a91de6a4750c4ec0","created_at":"2022-04-02T01:17:43Z","performed_via_github_app":null},{"actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-02T01:19:26Z","updated_at":"2022-04-02T01:19:26Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1776","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1776/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1776/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1776/events","html_url":"https://github.com/launchbadge/sqlx/pull/1776","id":1190451842,"node_id":"PR_kwDODb6dM841hRrd","number":1776,"title":"feat(pool): implement close-event notification","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-04-02T01:19:26Z","updated_at":"2022-04-05T23:17:37Z","closed_at":"2022-04-05T23:17:36Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":230595891,"node_id":"MDEwOlJlcG9zaXRvcnkyMzA1OTU4OTE=","name":"sqlx","full_name":"launchbadge/sqlx","private":false,"owner":{"login":"launchbadge","id":10077001,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwMDc3MDAx","avatar_url":"https://avatars.githubusercontent.com/u/10077001?v=4","gravatar_id":"","url":"https://api.github.com/users/launchbadge","html_url":"https://github.com/launchbadge","followers_url":"https://api.github.com/users/launchbadge/followers","following_url":"https://api.github.com/users/launchbadge/following{/other_user}","gists_url":"https://api.github.com/users/launchbadge/gists{/gist_id}","starred_url":"https://api.github.com/users/launchbadge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/launchbadge/subscriptions","organizations_url":"https://api.github.com/users/launchbadge/orgs","repos_url":"https://api.github.com/users/launchbadge/repos","events_url":"https://api.github.com/users/launchbadge/events{/privacy}","received_events_url":"https://api.github.com/users/launchbadge/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/launchbadge/sqlx","description":"ðŸ§° The Rust SQL Toolkit. An async, pure Rust SQL crate featuring compile-time checked queries without a DSL. Supports PostgreSQL, MySQL, and SQLite.","fork":false,"url":"https://api.github.com/repos/launchbadge/sqlx","forks_url":"https://api.github.com/repos/launchbadge/sqlx/forks","keys_url":"https://api.github.com/repos/launchbadge/sqlx/keys{/key_id}","collaborators_url":"https://api.github.com/repos/launchbadge/sqlx/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/launchbadge/sqlx/teams","hooks_url":"https://api.github.com/repos/launchbadge/sqlx/hooks","issue_events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/events{/number}","events_url":"https://api.github.com/repos/launchbadge/sqlx/events","assignees_url":"https://api.github.com/repos/launchbadge/sqlx/assignees{/user}","branches_url":"https://api.github.com/repos/launchbadge/sqlx/branches{/branch}","tags_url":"https://api.github.com/repos/launchbadge/sqlx/tags","blobs_url":"https://api.github.com/repos/launchbadge/sqlx/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/launchbadge/sqlx/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/launchbadge/sqlx/git/refs{/sha}","trees_url":"https://api.github.com/repos/launchbadge/sqlx/git/trees{/sha}","statuses_url":"https://api.github.com/repos/launchbadge/sqlx/statuses/{sha}","languages_url":"https://api.github.com/repos/launchbadge/sqlx/languages","stargazers_url":"https://api.github.com/repos/launchbadge/sqlx/stargazers","contributors_url":"https://api.github.com/repos/launchbadge/sqlx/contributors","subscribers_url":"https://api.github.com/repos/launchbadge/sqlx/subscribers","subscription_url":"https://api.github.com/repos/launchbadge/sqlx/subscription","commits_url":"https://api.github.com/repos/launchbadge/sqlx/commits{/sha}","git_commits_url":"https://api.github.com/repos/launchbadge/sqlx/git/commits{/sha}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/comments{/number}","issue_comment_url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments{/number}","contents_url":"https://api.github.com/repos/launchbadge/sqlx/contents/{+path}","compare_url":"https://api.github.com/repos/launchbadge/sqlx/compare/{base}...{head}","merges_url":"https://api.github.com/repos/launchbadge/sqlx/merges","archive_url":"https://api.github.com/repos/launchbadge/sqlx/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/launchbadge/sqlx/downloads","issues_url":"https://api.github.com/repos/launchbadge/sqlx/issues{/number}","pulls_url":"https://api.github.com/repos/launchbadge/sqlx/pulls{/number}","milestones_url":"https://api.github.com/repos/launchbadge/sqlx/milestones{/number}","notifications_url":"https://api.github.com/repos/launchbadge/sqlx/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/launchbadge/sqlx/labels{/name}","releases_url":"https://api.github.com/repos/launchbadge/sqlx/releases{/id}","deployments_url":"https://api.github.com/repos/launchbadge/sqlx/deployments","created_at":"2019-12-28T10:40:57Z","updated_at":"2025-11-10T07:15:41Z","pushed_at":"2025-10-29T18:37:49Z","git_url":"git://github.com/launchbadge/sqlx.git","ssh_url":"git@github.com:launchbadge/sqlx.git","clone_url":"https://github.com/launchbadge/sqlx.git","svn_url":"https://github.com/launchbadge/sqlx","homepage":"","size":9641,"stargazers_count":15938,"watchers_count":15938,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1502,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":701,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","await","mariadb","mysql","postgres","postgresql","rust","sql","sqlite"],"visibility":"public","forks":1502,"open_issues":701,"watchers":15938,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/launchbadge/sqlx/pulls/1776","html_url":"https://github.com/launchbadge/sqlx/pull/1776","diff_url":"https://github.com/launchbadge/sqlx/pull/1776.diff","patch_url":"https://github.com/launchbadge/sqlx/pull/1776.patch","merged_at":"2022-04-05T23:17:36Z"},"body":"fix(postgres): integrate pool close-event into `PgListener`\r\n\r\ncloses #1764\r\n\r\ncc @dbeckwith ","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1776/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1776/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":6374368818,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF78SYy","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6374368818","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"88c25cf0674463e5bef6d730d2d696c0aa16c0eb","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/88c25cf0674463e5bef6d730d2d696c0aa16c0eb","created_at":"2022-04-05T20:26:02Z","performed_via_github_app":null},{"id":6374371241,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF78S-p","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6374371241","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"bab0e0c19fc3aab6259646fe7b04ed4f090a2faf","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/bab0e0c19fc3aab6259646fe7b04ed4f090a2faf","created_at":"2022-04-05T20:26:28Z","performed_via_github_app":null},{"id":6374908125,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF7-WDd","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6374908125","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"7382e9c0ad7f9f2fcddfb2002beb4766989a45d6","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/7382e9c0ad7f9f2fcddfb2002beb4766989a45d6","created_at":"2022-04-05T22:01:17Z","performed_via_github_app":null},{"id":6375054575,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF7-5zv","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6375054575","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"6094e10b3ba3aad260701b51d87a95cfe2246803","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/6094e10b3ba3aad260701b51d87a95cfe2246803","created_at":"2022-04-05T22:34:55Z","performed_via_github_app":null},{"id":6375068512,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF7-9Ng","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6375068512","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"910b1ae9f885e1129991c3107a3013c8bd431b21","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/910b1ae9f885e1129991c3107a3013c8bd431b21","created_at":"2022-04-05T22:39:19Z","performed_via_github_app":null},{"id":6375090627,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF7_CnD","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6375090627","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"be68f86c06ebb0c325cffc1e1f2052acbaf55ef2","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/be68f86c06ebb0c325cffc1e1f2052acbaf55ef2","created_at":"2022-04-05T22:46:12Z","performed_via_github_app":null},{"id":6375267524,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF7_tzE","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6375267524","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5b5f6b7c8031934dea7251d9029754b8f302759a","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/5b5f6b7c8031934dea7251d9029754b8f302759a","created_at":"2022-04-05T23:08:11Z","performed_via_github_app":null},{"id":6375297148,"node_id":"CE_lADODb6dM85Gk0_hzwAAAAF7_1B8","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6375297148","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-04-05T23:17:36Z","state_reason":null,"performed_via_github_app":null},{"id":6375297249,"node_id":"REFE_lADODb6dM85Gk0_hzwAAAAF7_1Dh","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/6375297249","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"f1c635d739f2229359b689a1675e842f437eddd3","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/f1c635d739f2229359b689a1675e842f437eddd3","created_at":"2022-04-05T23:17:38Z","performed_via_github_app":null},{"actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T20:18:37Z","updated_at":"2022-04-26T20:18:37Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1833","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1833/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1833/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1833/events","html_url":"https://github.com/launchbadge/sqlx/pull/1833","id":1215702934,"node_id":"PR_kwDODb6dM842ydeD","number":1833,"title":"Remove futures-intrusive when using tokio","user":{"login":"paolobarbolini","id":6215781,"node_id":"MDQ6VXNlcjYyMTU3ODE=","avatar_url":"https://avatars.githubusercontent.com/u/6215781?v=4","gravatar_id":"","url":"https://api.github.com/users/paolobarbolini","html_url":"https://github.com/paolobarbolini","followers_url":"https://api.github.com/users/paolobarbolini/followers","following_url":"https://api.github.com/users/paolobarbolini/following{/other_user}","gists_url":"https://api.github.com/users/paolobarbolini/gists{/gist_id}","starred_url":"https://api.github.com/users/paolobarbolini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paolobarbolini/subscriptions","organizations_url":"https://api.github.com/users/paolobarbolini/orgs","repos_url":"https://api.github.com/users/paolobarbolini/repos","events_url":"https://api.github.com/users/paolobarbolini/events{/privacy}","received_events_url":"https://api.github.com/users/paolobarbolini/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2022-04-26T09:55:10Z","updated_at":"2022-08-09T00:49:45Z","closed_at":"2022-08-09T00:49:44Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":230595891,"node_id":"MDEwOlJlcG9zaXRvcnkyMzA1OTU4OTE=","name":"sqlx","full_name":"launchbadge/sqlx","private":false,"owner":{"login":"launchbadge","id":10077001,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwMDc3MDAx","avatar_url":"https://avatars.githubusercontent.com/u/10077001?v=4","gravatar_id":"","url":"https://api.github.com/users/launchbadge","html_url":"https://github.com/launchbadge","followers_url":"https://api.github.com/users/launchbadge/followers","following_url":"https://api.github.com/users/launchbadge/following{/other_user}","gists_url":"https://api.github.com/users/launchbadge/gists{/gist_id}","starred_url":"https://api.github.com/users/launchbadge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/launchbadge/subscriptions","organizations_url":"https://api.github.com/users/launchbadge/orgs","repos_url":"https://api.github.com/users/launchbadge/repos","events_url":"https://api.github.com/users/launchbadge/events{/privacy}","received_events_url":"https://api.github.com/users/launchbadge/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/launchbadge/sqlx","description":"ðŸ§° The Rust SQL Toolkit. An async, pure Rust SQL crate featuring compile-time checked queries without a DSL. Supports PostgreSQL, MySQL, and SQLite.","fork":false,"url":"https://api.github.com/repos/launchbadge/sqlx","forks_url":"https://api.github.com/repos/launchbadge/sqlx/forks","keys_url":"https://api.github.com/repos/launchbadge/sqlx/keys{/key_id}","collaborators_url":"https://api.github.com/repos/launchbadge/sqlx/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/launchbadge/sqlx/teams","hooks_url":"https://api.github.com/repos/launchbadge/sqlx/hooks","issue_events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/events{/number}","events_url":"https://api.github.com/repos/launchbadge/sqlx/events","assignees_url":"https://api.github.com/repos/launchbadge/sqlx/assignees{/user}","branches_url":"https://api.github.com/repos/launchbadge/sqlx/branches{/branch}","tags_url":"https://api.github.com/repos/launchbadge/sqlx/tags","blobs_url":"https://api.github.com/repos/launchbadge/sqlx/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/launchbadge/sqlx/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/launchbadge/sqlx/git/refs{/sha}","trees_url":"https://api.github.com/repos/launchbadge/sqlx/git/trees{/sha}","statuses_url":"https://api.github.com/repos/launchbadge/sqlx/statuses/{sha}","languages_url":"https://api.github.com/repos/launchbadge/sqlx/languages","stargazers_url":"https://api.github.com/repos/launchbadge/sqlx/stargazers","contributors_url":"https://api.github.com/repos/launchbadge/sqlx/contributors","subscribers_url":"https://api.github.com/repos/launchbadge/sqlx/subscribers","subscription_url":"https://api.github.com/repos/launchbadge/sqlx/subscription","commits_url":"https://api.github.com/repos/launchbadge/sqlx/commits{/sha}","git_commits_url":"https://api.github.com/repos/launchbadge/sqlx/git/commits{/sha}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/comments{/number}","issue_comment_url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments{/number}","contents_url":"https://api.github.com/repos/launchbadge/sqlx/contents/{+path}","compare_url":"https://api.github.com/repos/launchbadge/sqlx/compare/{base}...{head}","merges_url":"https://api.github.com/repos/launchbadge/sqlx/merges","archive_url":"https://api.github.com/repos/launchbadge/sqlx/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/launchbadge/sqlx/downloads","issues_url":"https://api.github.com/repos/launchbadge/sqlx/issues{/number}","pulls_url":"https://api.github.com/repos/launchbadge/sqlx/pulls{/number}","milestones_url":"https://api.github.com/repos/launchbadge/sqlx/milestones{/number}","notifications_url":"https://api.github.com/repos/launchbadge/sqlx/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/launchbadge/sqlx/labels{/name}","releases_url":"https://api.github.com/repos/launchbadge/sqlx/releases{/id}","deployments_url":"https://api.github.com/repos/launchbadge/sqlx/deployments","created_at":"2019-12-28T10:40:57Z","updated_at":"2025-11-10T07:15:41Z","pushed_at":"2025-10-29T18:37:49Z","git_url":"git://github.com/launchbadge/sqlx.git","ssh_url":"git@github.com:launchbadge/sqlx.git","clone_url":"https://github.com/launchbadge/sqlx.git","svn_url":"https://github.com/launchbadge/sqlx","homepage":"","size":9641,"stargazers_count":15938,"watchers_count":15938,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1502,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":701,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","await","mariadb","mysql","postgres","postgresql","rust","sql","sqlite"],"visibility":"public","forks":1502,"open_issues":701,"watchers":15938,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/launchbadge/sqlx/pulls/1833","html_url":"https://github.com/launchbadge/sqlx/pull/1833","diff_url":"https://github.com/launchbadge/sqlx/pull/1833.diff","patch_url":"https://github.com/launchbadge/sqlx/pull/1833.patch","merged_at":null},"body":"Currently implemented just for tokio and without waiting for all permits to be released on `close`","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1833/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1833/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]