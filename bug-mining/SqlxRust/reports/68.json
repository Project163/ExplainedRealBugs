{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/2034","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/2034/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/2034/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/2034/events","html_url":"https://github.com/launchbadge/sqlx/issues/2034","id":1334038715,"node_id":"I_kwDODb6dM85Pg9C7","number":2034,"title":"Getting `setting the PIPES_AS_CONCAT sql_mode is unsupported` ","user":{"login":"marcustut","id":59773847,"node_id":"MDQ6VXNlcjU5NzczODQ3","avatar_url":"https://avatars.githubusercontent.com/u/59773847?v=4","gravatar_id":"","url":"https://api.github.com/users/marcustut","html_url":"https://github.com/marcustut","followers_url":"https://api.github.com/users/marcustut/followers","following_url":"https://api.github.com/users/marcustut/following{/other_user}","gists_url":"https://api.github.com/users/marcustut/gists{/gist_id}","starred_url":"https://api.github.com/users/marcustut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcustut/subscriptions","organizations_url":"https://api.github.com/users/marcustut/orgs","repos_url":"https://api.github.com/users/marcustut/repos","events_url":"https://api.github.com/users/marcustut/events{/privacy}","received_events_url":"https://api.github.com/users/marcustut/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-08-10T04:07:23Z","updated_at":"2022-08-11T21:24:35Z","closed_at":"2022-08-11T21:24:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm using a planetscale database, which uses vitess under the hood. it was working fine for a past few days, but when I try to build my code today this error occured:\r\n\r\n`setting the PIPES_AS_CONCAT sql_mode is unsupported`\r\n\r\n```rs\r\n    sqlx::query_as!(\r\n        ExpenseQueryResponse,\r\n        r#\"\r\nselect\r\n    e. `id`,\r\n    e. `name`,\r\n    e. `amount`,\r\n    e. `date`,\r\n    ec. `name` as `category`,\r\n    e. `comment`,\r\n    group_concat(t. `name` separator ', ') as `tags`\r\nfrom\r\n    `expenses` e\r\n    inner join `expenses_categories` ec on e. `expenses_categories_id` = ec. `id`\r\n    left join `tags_expenses` te on e. `id` = te. `expenses_id`\r\n    left join `tags` t on t. `id` = te. `tags_id`\r\ngroup by\r\n    e. `id`,\r\n    e. `name`,\r\n    e. `amount`,\r\n    e. `date`,\r\n    ec. `name`,\r\n    e. `comment`\r\norder by\r\n    e. `date` desc,\r\n    e. `id` desc;\r\n        \"#,\r\n    )\r\n    .fetch_all(db)\r\n    .await\r\n```\r\n\r\nI searched the code and I found that when sqlx connect to the db, it tries to set certain sql_mode on the connection. It can be found in [sqlx-core/src/mysql/options/connect.rs](https://github.com/launchbadge/sqlx/blob/061fdcabd72896d9bc3abb4ea4af6712a04bc0a8/sqlx-core/src/mysql/options/connect.rs#L45)\r\n\r\nI queried for the current `sql_mode` set on the db, this is the result:\r\n```sh\r\nmarcustut/|⚠ main ⚠|> show variables like '%sql_mode%';\r\n+---------------+-----------------------------------------------------------------------------------------------------------------------+\r\n| Variable_name | Value                                                                                                                 |\r\n+---------------+-----------------------------------------------------------------------------------------------------------------------+\r\n| sql_mode      | ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION |\r\n+---------------+-----------------------------------------------------------------------------------------------------------------------+\r\n```\r\n\r\nIt can be clearly see that `PIPES_AS_CONCAT` is not set. So I suspect that planetscale doesn't allow setting `sql_mode` but sqlx is trying to set the variable. Is there a way to override this behavior?","closed_by":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/2034/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/2034/timeline","performed_via_github_app":null,"state_reason":"completed"}