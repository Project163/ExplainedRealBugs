[{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641870653","html_url":"https://github.com/launchbadge/sqlx/issues/379#issuecomment-641870653","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/379","id":641870653,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTg3MDY1Mw==","user":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-10T09:20:09Z","updated_at":"2020-06-10T09:20:09Z","body":"We had this before where you were allowed to implement `Type` and return `PgTypeInfo::with_oid(3220)` . It's still there just `pub(crate)` as we did add support for `PgTypeInfo::with_name(\"pg_lsn\")` (as long as the type category is known). \r\n\r\nWhat you describe sounds like a reasonable use case to re-expose `with_oid`.\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641870653/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641885684","html_url":"https://github.com/launchbadge/sqlx/issues/379#issuecomment-641885684","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/379","id":641885684,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTg4NTY4NA==","user":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-10T09:42:46Z","updated_at":"2020-06-10T09:51:01Z","body":"Some types have unknown category, like `pg_lsn`. So maybe add it into built-in types (just like other libs do), or provides explicit methods for registering new oid into built-in types. Otherwise, the error would happen before decoding, check `handle_row_description()` for prepared statements.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641885684/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641890719","html_url":"https://github.com/launchbadge/sqlx/issues/379#issuecomment-641890719","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/379","id":641890719,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTg5MDcxOQ==","user":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-10T09:51:19Z","updated_at":"2020-06-10T09:51:19Z","body":">  For example, I could create a struct type struct LSN(i64), impl Decode for it, and register oid 3220 for it.\r\n\r\n```\r\nimpl Type<Postgres> for LSN {\r\n  fn type_info() -> PgTypeInfo { PgTypeInfo::with_oid(3220) }\r\n}\r\n```\r\n\r\nThat would work if `with_oid` was public. Should be a simple tweak. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641890719/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3428834591,"node_id":"MDEyOkxhYmVsZWRFdmVudDM0Mjg4MzQ1OTE=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3428834591","actor":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-06-10T09:51:31Z","label":{"name":"E-easy","color":"d8c0f9"},"performed_via_github_app":null},{"id":3428834593,"node_id":"MDEyOkxhYmVsZWRFdmVudDM0Mjg4MzQ1OTM=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3428834593","actor":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2020-06-10T09:51:31Z","label":{"name":"enhancement","color":"a2eeef"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641899529","html_url":"https://github.com/launchbadge/sqlx/issues/379#issuecomment-641899529","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/379","id":641899529,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTg5OTUyOQ==","user":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-10T10:06:44Z","updated_at":"2020-06-10T10:06:44Z","body":"Let me clarify more.\r\n\r\nYes, I know `PgTypeInfo::with_oid` could be used to implement new types. But it doesn't help here, because the key is to register new types so that query would not fail at early stage.\r\n\r\nCheck https://github.com/launchbadge/sqlx/blob/master/sqlx-core/src/postgres/connection/describe.rs#L97, in prepare callflow, it would try to get oid of the type, either from constant built-in types (`PgTypeInfo::try_from_oid`), or get it from table `pg_catalog.pg_type` (`fetch_type_by_oid`). `pg_lsn` does not exist in built-in types of sqlx, and has unknown category in pg. So sqlx would fail it.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641899529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3429171339,"node_id":"MDExOkNsb3NlZEV2ZW50MzQyOTE3MTMzOQ==","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3429171339","actor":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"1dac0b5c291c9a9fa97a28fa0c6f5bb01aa21650","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/1dac0b5c291c9a9fa97a28fa0c6f5bb01aa21650","created_at":"2020-06-10T11:24:43Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641939623","html_url":"https://github.com/launchbadge/sqlx/issues/379#issuecomment-641939623","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/379","id":641939623,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MTkzOTYyMw==","user":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-10T11:26:54Z","updated_at":"2020-06-10T11:26:54Z","body":"@kingluo ðŸ™‡ I'm sorry for being dense. I understand now.  Still an easy fix. I went ahead and took care of it. The logic was backwards in that function you linked.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/641939623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3429178852,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzQyOTE3ODg1Mg==","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3429178852","actor":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-06-10T11:26:54Z","performed_via_github_app":null},{"id":3429178857,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM0MjkxNzg4NTc=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3429178857","actor":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-06-10T11:26:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/642032212","html_url":"https://github.com/launchbadge/sqlx/issues/379#issuecomment-642032212","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/379","id":642032212,"node_id":"MDEyOklzc3VlQ29tbWVudDY0MjAzMjIxMg==","user":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-10T14:03:47Z","updated_at":"2020-06-10T14:06:19Z","body":"I found another related issue.\r\n\r\nThe `handle_row_description()` is ok, but because it would do another query for unknown built-in oid, it would use current unamed portal, so back to the main query, it would fail at the pg side due to the previous unamed portal is destroyed. Check https://github.com/launchbadge/sqlx/blob/master/sqlx-core/src/postgres/connection/executor.rs#L137.\r\n\r\nAccording to the pg doc:\r\n\r\n> An unnamed portal is destroyed at the end of the transaction, or as soon as the next Bind statement specifying the unnamed portal as destination is issued.\r\n\r\nAnd sqlx does not report such error (At higher API, it just reports `RowNotFound`, in fact it is not). I just found it via tcpdump:\r\n`Message: portal \"\" does not exist`","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/642032212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-13T09:09:00Z","updated_at":"2020-06-13T09:09:00Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/406","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/406/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/406/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/406/events","html_url":"https://github.com/launchbadge/sqlx/issues/406","id":638127324,"node_id":"MDU6SXNzdWU2MzgxMjczMjQ=","number":406,"title":"portal \"\" does not exist","user":{"login":"kingluo","id":4401042,"node_id":"MDQ6VXNlcjQ0MDEwNDI=","avatar_url":"https://avatars.githubusercontent.com/u/4401042?v=4","gravatar_id":"","url":"https://api.github.com/users/kingluo","html_url":"https://github.com/kingluo","followers_url":"https://api.github.com/users/kingluo/followers","following_url":"https://api.github.com/users/kingluo/following{/other_user}","gists_url":"https://api.github.com/users/kingluo/gists{/gist_id}","starred_url":"https://api.github.com/users/kingluo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingluo/subscriptions","organizations_url":"https://api.github.com/users/kingluo/orgs","repos_url":"https://api.github.com/users/kingluo/repos","events_url":"https://api.github.com/users/kingluo/events{/privacy}","received_events_url":"https://api.github.com/users/kingluo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2020-06-13T09:09:00Z","updated_at":"2020-06-13T17:22:20Z","closed_at":"2020-06-13T17:22:19Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":230595891,"node_id":"MDEwOlJlcG9zaXRvcnkyMzA1OTU4OTE=","name":"sqlx","full_name":"launchbadge/sqlx","private":false,"owner":{"login":"launchbadge","id":10077001,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwMDc3MDAx","avatar_url":"https://avatars.githubusercontent.com/u/10077001?v=4","gravatar_id":"","url":"https://api.github.com/users/launchbadge","html_url":"https://github.com/launchbadge","followers_url":"https://api.github.com/users/launchbadge/followers","following_url":"https://api.github.com/users/launchbadge/following{/other_user}","gists_url":"https://api.github.com/users/launchbadge/gists{/gist_id}","starred_url":"https://api.github.com/users/launchbadge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/launchbadge/subscriptions","organizations_url":"https://api.github.com/users/launchbadge/orgs","repos_url":"https://api.github.com/users/launchbadge/repos","events_url":"https://api.github.com/users/launchbadge/events{/privacy}","received_events_url":"https://api.github.com/users/launchbadge/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/launchbadge/sqlx","description":"ðŸ§° The Rust SQL Toolkit. An async, pure Rust SQL crate featuring compile-time checked queries without a DSL. Supports PostgreSQL, MySQL, and SQLite.","fork":false,"url":"https://api.github.com/repos/launchbadge/sqlx","forks_url":"https://api.github.com/repos/launchbadge/sqlx/forks","keys_url":"https://api.github.com/repos/launchbadge/sqlx/keys{/key_id}","collaborators_url":"https://api.github.com/repos/launchbadge/sqlx/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/launchbadge/sqlx/teams","hooks_url":"https://api.github.com/repos/launchbadge/sqlx/hooks","issue_events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/events{/number}","events_url":"https://api.github.com/repos/launchbadge/sqlx/events","assignees_url":"https://api.github.com/repos/launchbadge/sqlx/assignees{/user}","branches_url":"https://api.github.com/repos/launchbadge/sqlx/branches{/branch}","tags_url":"https://api.github.com/repos/launchbadge/sqlx/tags","blobs_url":"https://api.github.com/repos/launchbadge/sqlx/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/launchbadge/sqlx/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/launchbadge/sqlx/git/refs{/sha}","trees_url":"https://api.github.com/repos/launchbadge/sqlx/git/trees{/sha}","statuses_url":"https://api.github.com/repos/launchbadge/sqlx/statuses/{sha}","languages_url":"https://api.github.com/repos/launchbadge/sqlx/languages","stargazers_url":"https://api.github.com/repos/launchbadge/sqlx/stargazers","contributors_url":"https://api.github.com/repos/launchbadge/sqlx/contributors","subscribers_url":"https://api.github.com/repos/launchbadge/sqlx/subscribers","subscription_url":"https://api.github.com/repos/launchbadge/sqlx/subscription","commits_url":"https://api.github.com/repos/launchbadge/sqlx/commits{/sha}","git_commits_url":"https://api.github.com/repos/launchbadge/sqlx/git/commits{/sha}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/comments{/number}","issue_comment_url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments{/number}","contents_url":"https://api.github.com/repos/launchbadge/sqlx/contents/{+path}","compare_url":"https://api.github.com/repos/launchbadge/sqlx/compare/{base}...{head}","merges_url":"https://api.github.com/repos/launchbadge/sqlx/merges","archive_url":"https://api.github.com/repos/launchbadge/sqlx/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/launchbadge/sqlx/downloads","issues_url":"https://api.github.com/repos/launchbadge/sqlx/issues{/number}","pulls_url":"https://api.github.com/repos/launchbadge/sqlx/pulls{/number}","milestones_url":"https://api.github.com/repos/launchbadge/sqlx/milestones{/number}","notifications_url":"https://api.github.com/repos/launchbadge/sqlx/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/launchbadge/sqlx/labels{/name}","releases_url":"https://api.github.com/repos/launchbadge/sqlx/releases{/id}","deployments_url":"https://api.github.com/repos/launchbadge/sqlx/deployments","created_at":"2019-12-28T10:40:57Z","updated_at":"2025-11-10T07:15:41Z","pushed_at":"2025-10-29T18:37:49Z","git_url":"git://github.com/launchbadge/sqlx.git","ssh_url":"git@github.com:launchbadge/sqlx.git","clone_url":"https://github.com/launchbadge/sqlx.git","svn_url":"https://github.com/launchbadge/sqlx","homepage":"","size":9641,"stargazers_count":15938,"watchers_count":15938,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1502,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":701,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","await","mariadb","mysql","postgres","postgresql","rust","sql","sqlite"],"visibility":"public","forks":1502,"open_issues":701,"watchers":15938,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"For the issue https://github.com/launchbadge/sqlx/issues/379, I found another related issue.\r\n\r\nThe `handle_row_description()` would do another query for unknown built-in oid, it would use current unamed portal, so back to the main query, it would fail at the pg side due to the previous unamed portal is destroyed. Check https://github.com/launchbadge/sqlx/blob/master/sqlx-core/src/postgres/connection/executor.rs#L137.\r\n\r\nAccording to the pg doc:\r\n\r\n> An unnamed portal is destroyed at the end of the transaction, or as soon as the next Bind statement specifying the unnamed portal as destination is issued.\r\n\r\nAnd sqlx does not report such error (At higher API, it just reports `RowNotFound`, in fact it is not). I just found it via tcpdump:\r\n`Message: portal \"\" does not exist`","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/406/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":13478501811,"node_id":"REFE_lADODb6dM84lsxCyzwAAAAMjYZ2z","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/13478501811","actor":{"login":"audunhalland","id":5767935,"node_id":"MDQ6VXNlcjU3Njc5MzU=","avatar_url":"https://avatars.githubusercontent.com/u/5767935?v=4","gravatar_id":"","url":"https://api.github.com/users/audunhalland","html_url":"https://github.com/audunhalland","followers_url":"https://api.github.com/users/audunhalland/followers","following_url":"https://api.github.com/users/audunhalland/following{/other_user}","gists_url":"https://api.github.com/users/audunhalland/gists{/gist_id}","starred_url":"https://api.github.com/users/audunhalland/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/audunhalland/subscriptions","organizations_url":"https://api.github.com/users/audunhalland/orgs","repos_url":"https://api.github.com/users/audunhalland/repos","events_url":"https://api.github.com/users/audunhalland/events{/privacy}","received_events_url":"https://api.github.com/users/audunhalland/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1dac0b5c291c9a9fa97a28fa0c6f5bb01aa21650","commit_url":"https://api.github.com/repos/audunhalland/sqlx/commits/1dac0b5c291c9a9fa97a28fa0c6f5bb01aa21650","created_at":"2024-07-11T21:53:15Z","performed_via_github_app":null}]