[{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/672683872","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-672683872","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":672683872,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MjY4Mzg3Mg==","user":{"login":"cetra3","id":6415435,"node_id":"MDQ6VXNlcjY0MTU0MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6415435?v=4","gravatar_id":"","url":"https://api.github.com/users/cetra3","html_url":"https://github.com/cetra3","followers_url":"https://api.github.com/users/cetra3/followers","following_url":"https://api.github.com/users/cetra3/following{/other_user}","gists_url":"https://api.github.com/users/cetra3/gists{/gist_id}","starred_url":"https://api.github.com/users/cetra3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cetra3/subscriptions","organizations_url":"https://api.github.com/users/cetra3/orgs","repos_url":"https://api.github.com/users/cetra3/repos","events_url":"https://api.github.com/users/cetra3/events{/privacy}","received_events_url":"https://api.github.com/users/cetra3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-12T07:20:57Z","updated_at":"2020-08-12T07:20:57Z","body":"I've ran into the same issue. I am not seeing connections recycled when they are dropped, which is causing issues when multiple queries happen on one web request/future.\r\n\r\nI have worked around it by using [`deadpool`](https://github.com/bikeshedder/deadpool) for connection pooling, which appears to be more reliable in my limited tests.\r\n\r\nHere's my (very simple) implementation. *(also note: I needed to use `DerefMut` to coax the compiler, as I am not sure what combination of `*` and `&` is needed here.)*\r\n\r\n```rust\r\nuse std::ops::DerefMut;\r\nuse sqlx::{Connect, Connection, Error as SqlxError, Executor, PgConnection};\r\n\r\nuse async_trait::async_trait;\r\nuse deadpool::managed::{Manager, RecycleResult};\r\nuse log::*;\r\ntype Pool = deadpool::managed::Pool<PgConnection, SqlxError>;\r\n\r\nstruct DbPool {\r\n    url: String,\r\n}\r\n\r\nimpl DbPool {\r\n    fn new(url: String, size: usize) -> Pool {\r\n        Pool::new(DbPool { url }, size)\r\n    }\r\n}\r\n\r\n#[async_trait]\r\nimpl Manager<PgConnection, SqlxError> for DbPool {\r\n    async fn create(&self) -> Result<PgConnection, SqlxError> {\r\n        PgConnection::connect(&self.url).await\r\n    }\r\n    async fn recycle(&self, obj: &mut PgConnection) -> RecycleResult<SqlxError> {\r\n        Ok(obj.ping().await?)\r\n    }\r\n}\r\n\r\n\r\n\r\nasync fn main() {\r\n    ...\r\n    let pool = DbPool::new(url, 16);\r\n    ...\r\n    sqlx::query_as(\"select * from users where email = $1\")\r\n      .bind(&email)\r\n      .fetch_one(pool.get().await?.deref_mut())\r\n      .await?;\r\n     ... \r\n}\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/672683872/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cetra3","id":6415435,"node_id":"MDQ6VXNlcjY0MTU0MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6415435?v=4","gravatar_id":"","url":"https://api.github.com/users/cetra3","html_url":"https://github.com/cetra3","followers_url":"https://api.github.com/users/cetra3/followers","following_url":"https://api.github.com/users/cetra3/following{/other_user}","gists_url":"https://api.github.com/users/cetra3/gists{/gist_id}","starred_url":"https://api.github.com/users/cetra3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cetra3/subscriptions","organizations_url":"https://api.github.com/users/cetra3/orgs","repos_url":"https://api.github.com/users/cetra3/repos","events_url":"https://api.github.com/users/cetra3/events{/privacy}","received_events_url":"https://api.github.com/users/cetra3/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673026687","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-673026687","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":673026687,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzAyNjY4Nw==","user":{"login":"skuzins","id":20017950,"node_id":"MDQ6VXNlcjIwMDE3OTUw","avatar_url":"https://avatars.githubusercontent.com/u/20017950?v=4","gravatar_id":"","url":"https://api.github.com/users/skuzins","html_url":"https://github.com/skuzins","followers_url":"https://api.github.com/users/skuzins/followers","following_url":"https://api.github.com/users/skuzins/following{/other_user}","gists_url":"https://api.github.com/users/skuzins/gists{/gist_id}","starred_url":"https://api.github.com/users/skuzins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skuzins/subscriptions","organizations_url":"https://api.github.com/users/skuzins/orgs","repos_url":"https://api.github.com/users/skuzins/repos","events_url":"https://api.github.com/users/skuzins/events{/privacy}","received_events_url":"https://api.github.com/users/skuzins/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-12T18:03:55Z","updated_at":"2020-08-12T18:03:55Z","body":"Thanks for sharing your workaround! deadpool looks great.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673026687/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"skuzins","id":20017950,"node_id":"MDQ6VXNlcjIwMDE3OTUw","avatar_url":"https://avatars.githubusercontent.com/u/20017950?v=4","gravatar_id":"","url":"https://api.github.com/users/skuzins","html_url":"https://github.com/skuzins","followers_url":"https://api.github.com/users/skuzins/followers","following_url":"https://api.github.com/users/skuzins/following{/other_user}","gists_url":"https://api.github.com/users/skuzins/gists{/gist_id}","starred_url":"https://api.github.com/users/skuzins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skuzins/subscriptions","organizations_url":"https://api.github.com/users/skuzins/orgs","repos_url":"https://api.github.com/users/skuzins/repos","events_url":"https://api.github.com/users/skuzins/events{/privacy}","received_events_url":"https://api.github.com/users/skuzins/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673131742","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-673131742","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":673131742,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzEzMTc0Mg==","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-12T22:00:05Z","updated_at":"2020-08-12T22:00:52Z","body":"Currently the pool doesn't behave well if the `acquire()` future is cancelled; it fails to remove the waiter from the list, which holds up the queue. This could have a knock-on effect with other `acquire()` calls timing out due to the same problem. Each time a connection is returned to the pool it only attempts to wake the task at the head of the queue. If there's more dead tasks than connections in the queue then the pool will stall.\r\n\r\n@skuzins in your example, could you please try debug-printing the pool after the second `.acquire()` call times out, instead of panicking:\r\n\r\n```rust\r\nif let Err(e) = pool.acquire().await {\r\n    println!(\"acquire error: {}, pool state: {:?}\", e, pool);\r\n}\r\n```","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673131742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3649606274,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzY0OTYwNjI3NA==","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3649606274","actor":{"login":"skuzins","id":20017950,"node_id":"MDQ6VXNlcjIwMDE3OTUw","avatar_url":"https://avatars.githubusercontent.com/u/20017950?v=4","gravatar_id":"","url":"https://api.github.com/users/skuzins","html_url":"https://github.com/skuzins","followers_url":"https://api.github.com/users/skuzins/followers","following_url":"https://api.github.com/users/skuzins/following{/other_user}","gists_url":"https://api.github.com/users/skuzins/gists{/gist_id}","starred_url":"https://api.github.com/users/skuzins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skuzins/subscriptions","organizations_url":"https://api.github.com/users/skuzins/orgs","repos_url":"https://api.github.com/users/skuzins/repos","events_url":"https://api.github.com/users/skuzins/events{/privacy}","received_events_url":"https://api.github.com/users/skuzins/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-08-12T22:00:05Z","performed_via_github_app":null},{"id":3649606276,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM2NDk2MDYyNzY=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3649606276","actor":{"login":"skuzins","id":20017950,"node_id":"MDQ6VXNlcjIwMDE3OTUw","avatar_url":"https://avatars.githubusercontent.com/u/20017950?v=4","gravatar_id":"","url":"https://api.github.com/users/skuzins","html_url":"https://github.com/skuzins","followers_url":"https://api.github.com/users/skuzins/followers","following_url":"https://api.github.com/users/skuzins/following{/other_user}","gists_url":"https://api.github.com/users/skuzins/gists{/gist_id}","starred_url":"https://api.github.com/users/skuzins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skuzins/subscriptions","organizations_url":"https://api.github.com/users/skuzins/orgs","repos_url":"https://api.github.com/users/skuzins/repos","events_url":"https://api.github.com/users/skuzins/events{/privacy}","received_events_url":"https://api.github.com/users/skuzins/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-08-12T22:00:05Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673198240","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-673198240","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":673198240,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzE5ODI0MA==","user":{"login":"skuzins","id":20017950,"node_id":"MDQ6VXNlcjIwMDE3OTUw","avatar_url":"https://avatars.githubusercontent.com/u/20017950?v=4","gravatar_id":"","url":"https://api.github.com/users/skuzins","html_url":"https://github.com/skuzins","followers_url":"https://api.github.com/users/skuzins/followers","following_url":"https://api.github.com/users/skuzins/following{/other_user}","gists_url":"https://api.github.com/users/skuzins/gists{/gist_id}","starred_url":"https://api.github.com/users/skuzins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skuzins/subscriptions","organizations_url":"https://api.github.com/users/skuzins/orgs","repos_url":"https://api.github.com/users/skuzins/repos","events_url":"https://api.github.com/users/skuzins/events{/privacy}","received_events_url":"https://api.github.com/users/skuzins/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-13T01:37:14Z","updated_at":"2020-08-13T01:37:14Z","body":"I'm not sure any future would/should normally be cancelled in this example - I believe they should all just run to completion.\r\n\r\nHere's the debug message, please let me know if you need more information.\r\n\r\n```\r\nacquire error: pool timed out while waiting for an open connection, pool state: \r\nPool { size: 1, num_idle: 0, is_closed: false, options: PoolOptions { \r\nmax_connections: 1, min_connections: 0, connect_timeout: 30s, \r\nmax_lifetime: Some(1800s), idle_timeout: Some(600s), test_before_acquire: true } }\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673198240/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"skuzins","id":20017950,"node_id":"MDQ6VXNlcjIwMDE3OTUw","avatar_url":"https://avatars.githubusercontent.com/u/20017950?v=4","gravatar_id":"","url":"https://api.github.com/users/skuzins","html_url":"https://github.com/skuzins","followers_url":"https://api.github.com/users/skuzins/followers","following_url":"https://api.github.com/users/skuzins/following{/other_user}","gists_url":"https://api.github.com/users/skuzins/gists{/gist_id}","starred_url":"https://api.github.com/users/skuzins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skuzins/subscriptions","organizations_url":"https://api.github.com/users/skuzins/orgs","repos_url":"https://api.github.com/users/skuzins/repos","events_url":"https://api.github.com/users/skuzins/events{/privacy}","received_events_url":"https://api.github.com/users/skuzins/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673200874","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-673200874","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":673200874,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzIwMDg3NA==","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-13T01:47:32Z","updated_at":"2020-08-13T01:47:32Z","body":"The timeout itself cancels the internal future that's actually waiting in the queue.\r\n\r\nHowever, I'd expect to see `num_idle: 1` if that was the case. How about with `.max_connections(5)`?","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673200874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673201833","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-673201833","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":673201833,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzIwMTgzMw==","user":{"login":"cetra3","id":6415435,"node_id":"MDQ6VXNlcjY0MTU0MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6415435?v=4","gravatar_id":"","url":"https://api.github.com/users/cetra3","html_url":"https://github.com/cetra3","followers_url":"https://api.github.com/users/cetra3/followers","following_url":"https://api.github.com/users/cetra3/following{/other_user}","gists_url":"https://api.github.com/users/cetra3/gists{/gist_id}","starred_url":"https://api.github.com/users/cetra3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cetra3/subscriptions","organizations_url":"https://api.github.com/users/cetra3/orgs","repos_url":"https://api.github.com/users/cetra3/repos","events_url":"https://api.github.com/users/cetra3/events{/privacy}","received_events_url":"https://api.github.com/users/cetra3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-13T01:51:16Z","updated_at":"2020-08-13T01:51:16Z","body":"I am not seeing cancellations in my code and the example posted doesn't have them either.   It feels more like an issue with waking up after the pool has stopped using a connection.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673201833/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cetra3","id":6415435,"node_id":"MDQ6VXNlcjY0MTU0MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6415435?v=4","gravatar_id":"","url":"https://api.github.com/users/cetra3","html_url":"https://github.com/cetra3","followers_url":"https://api.github.com/users/cetra3/followers","following_url":"https://api.github.com/users/cetra3/following{/other_user}","gists_url":"https://api.github.com/users/cetra3/gists{/gist_id}","starred_url":"https://api.github.com/users/cetra3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cetra3/subscriptions","organizations_url":"https://api.github.com/users/cetra3/orgs","repos_url":"https://api.github.com/users/cetra3/repos","events_url":"https://api.github.com/users/cetra3/events{/privacy}","received_events_url":"https://api.github.com/users/cetra3/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673204728","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-673204728","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":673204728,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzIwNDcyOA==","user":{"login":"skuzins","id":20017950,"node_id":"MDQ6VXNlcjIwMDE3OTUw","avatar_url":"https://avatars.githubusercontent.com/u/20017950?v=4","gravatar_id":"","url":"https://api.github.com/users/skuzins","html_url":"https://github.com/skuzins","followers_url":"https://api.github.com/users/skuzins/followers","following_url":"https://api.github.com/users/skuzins/following{/other_user}","gists_url":"https://api.github.com/users/skuzins/gists{/gist_id}","starred_url":"https://api.github.com/users/skuzins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skuzins/subscriptions","organizations_url":"https://api.github.com/users/skuzins/orgs","repos_url":"https://api.github.com/users/skuzins/repos","events_url":"https://api.github.com/users/skuzins/events{/privacy}","received_events_url":"https://api.github.com/users/skuzins/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-13T02:02:08Z","updated_at":"2020-08-13T02:02:08Z","body":"@abonander The thing is, there shouldn't be any timeouts. The task acquires the connection, performs a short query, drops the connection and does the same thing once more. The whole program should finish within milliseconds without any timeouts. \r\n\r\nHere's the output with `.max_connections(5)`:\r\n\r\n```\r\nacquire error: pool timed out while waiting for an open connection, pool state: Pool \r\n{ size: 5, num_idle: 0, is_closed: false, options: PoolOptions { \r\nmax_connections: 5, min_connections: 0, connect_timeout: 30s, \r\nmax_lifetime: Some(1800s), idle_timeout: Some(600s), test_before_acquire: true } }\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/673204728/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"skuzins","id":20017950,"node_id":"MDQ6VXNlcjIwMDE3OTUw","avatar_url":"https://avatars.githubusercontent.com/u/20017950?v=4","gravatar_id":"","url":"https://api.github.com/users/skuzins","html_url":"https://github.com/skuzins","followers_url":"https://api.github.com/users/skuzins/followers","following_url":"https://api.github.com/users/skuzins/following{/other_user}","gists_url":"https://api.github.com/users/skuzins/gists{/gist_id}","starred_url":"https://api.github.com/users/skuzins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skuzins/subscriptions","organizations_url":"https://api.github.com/users/skuzins/orgs","repos_url":"https://api.github.com/users/skuzins/repos","events_url":"https://api.github.com/users/skuzins/events{/privacy}","received_events_url":"https://api.github.com/users/skuzins/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3650089301,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzY1MDA4OTMwMQ==","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3650089301","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-08-13T02:02:08Z","performed_via_github_app":null},{"id":3650089302,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM2NTAwODkzMDI=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3650089302","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-08-13T02:02:08Z","performed_via_github_app":null},{"id":3650674490,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2NTA2NzQ0OTA=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3650674490","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"fdfafa8b18d5217f15ceb3ee05f331b07f499c85","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/fdfafa8b18d5217f15ceb3ee05f331b07f499c85","created_at":"2020-08-13T06:55:39Z","performed_via_github_app":null},{"actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-13T06:56:32Z","updated_at":"2020-08-13T06:56:32Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/629","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/629/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/629/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/629/events","html_url":"https://github.com/launchbadge/sqlx/pull/629","id":678201294,"node_id":"MDExOlB1bGxSZXF1ZXN0NDY3MTg4NzQ2","number":629,"title":"fix(pool): ignore spurious wakeups when waiting for a connection","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-08-13T06:56:32Z","updated_at":"2020-10-13T17:37:12Z","closed_at":"2020-10-13T17:37:11Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":230595891,"node_id":"MDEwOlJlcG9zaXRvcnkyMzA1OTU4OTE=","name":"sqlx","full_name":"launchbadge/sqlx","private":false,"owner":{"login":"launchbadge","id":10077001,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwMDc3MDAx","avatar_url":"https://avatars.githubusercontent.com/u/10077001?v=4","gravatar_id":"","url":"https://api.github.com/users/launchbadge","html_url":"https://github.com/launchbadge","followers_url":"https://api.github.com/users/launchbadge/followers","following_url":"https://api.github.com/users/launchbadge/following{/other_user}","gists_url":"https://api.github.com/users/launchbadge/gists{/gist_id}","starred_url":"https://api.github.com/users/launchbadge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/launchbadge/subscriptions","organizations_url":"https://api.github.com/users/launchbadge/orgs","repos_url":"https://api.github.com/users/launchbadge/repos","events_url":"https://api.github.com/users/launchbadge/events{/privacy}","received_events_url":"https://api.github.com/users/launchbadge/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/launchbadge/sqlx","description":"ðŸ§° The Rust SQL Toolkit. An async, pure Rust SQL crate featuring compile-time checked queries without a DSL. Supports PostgreSQL, MySQL, and SQLite.","fork":false,"url":"https://api.github.com/repos/launchbadge/sqlx","forks_url":"https://api.github.com/repos/launchbadge/sqlx/forks","keys_url":"https://api.github.com/repos/launchbadge/sqlx/keys{/key_id}","collaborators_url":"https://api.github.com/repos/launchbadge/sqlx/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/launchbadge/sqlx/teams","hooks_url":"https://api.github.com/repos/launchbadge/sqlx/hooks","issue_events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/events{/number}","events_url":"https://api.github.com/repos/launchbadge/sqlx/events","assignees_url":"https://api.github.com/repos/launchbadge/sqlx/assignees{/user}","branches_url":"https://api.github.com/repos/launchbadge/sqlx/branches{/branch}","tags_url":"https://api.github.com/repos/launchbadge/sqlx/tags","blobs_url":"https://api.github.com/repos/launchbadge/sqlx/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/launchbadge/sqlx/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/launchbadge/sqlx/git/refs{/sha}","trees_url":"https://api.github.com/repos/launchbadge/sqlx/git/trees{/sha}","statuses_url":"https://api.github.com/repos/launchbadge/sqlx/statuses/{sha}","languages_url":"https://api.github.com/repos/launchbadge/sqlx/languages","stargazers_url":"https://api.github.com/repos/launchbadge/sqlx/stargazers","contributors_url":"https://api.github.com/repos/launchbadge/sqlx/contributors","subscribers_url":"https://api.github.com/repos/launchbadge/sqlx/subscribers","subscription_url":"https://api.github.com/repos/launchbadge/sqlx/subscription","commits_url":"https://api.github.com/repos/launchbadge/sqlx/commits{/sha}","git_commits_url":"https://api.github.com/repos/launchbadge/sqlx/git/commits{/sha}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/comments{/number}","issue_comment_url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments{/number}","contents_url":"https://api.github.com/repos/launchbadge/sqlx/contents/{+path}","compare_url":"https://api.github.com/repos/launchbadge/sqlx/compare/{base}...{head}","merges_url":"https://api.github.com/repos/launchbadge/sqlx/merges","archive_url":"https://api.github.com/repos/launchbadge/sqlx/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/launchbadge/sqlx/downloads","issues_url":"https://api.github.com/repos/launchbadge/sqlx/issues{/number}","pulls_url":"https://api.github.com/repos/launchbadge/sqlx/pulls{/number}","milestones_url":"https://api.github.com/repos/launchbadge/sqlx/milestones{/number}","notifications_url":"https://api.github.com/repos/launchbadge/sqlx/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/launchbadge/sqlx/labels{/name}","releases_url":"https://api.github.com/repos/launchbadge/sqlx/releases{/id}","deployments_url":"https://api.github.com/repos/launchbadge/sqlx/deployments","created_at":"2019-12-28T10:40:57Z","updated_at":"2025-11-10T07:15:41Z","pushed_at":"2025-10-29T18:37:49Z","git_url":"git://github.com/launchbadge/sqlx.git","ssh_url":"git@github.com:launchbadge/sqlx.git","clone_url":"https://github.com/launchbadge/sqlx.git","svn_url":"https://github.com/launchbadge/sqlx","homepage":"","size":9641,"stargazers_count":15938,"watchers_count":15938,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1502,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":701,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","await","mariadb","mysql","postgres","postgresql","rust","sql","sqlite"],"visibility":"public","forks":1502,"open_issues":701,"watchers":15938,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/launchbadge/sqlx/pulls/629","html_url":"https://github.com/launchbadge/sqlx/pull/629","diff_url":"https://github.com/launchbadge/sqlx/pull/629.diff","patch_url":"https://github.com/launchbadge/sqlx/pull/629.patch","merged_at":"2020-10-13T17:37:11Z"},"body":"fixes #622\r\n\r\ncc @skuzins @cetra3 would two mind trying this branch to see if it still has the problem?","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/629/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":3653867202,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2NTM4NjcyMDI=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3653867202","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"770ff81a735c21cda46d0aa9172868309970544c","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/770ff81a735c21cda46d0aa9172868309970544c","created_at":"2020-08-13T21:09:09Z","performed_via_github_app":null},{"id":3653960341,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2NTM5NjAzNDE=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3653960341","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"72d630c7be5d11485b0289bd54b5b029f8081300","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/72d630c7be5d11485b0289bd54b5b029f8081300","created_at":"2020-08-13T21:42:14Z","performed_via_github_app":null},{"id":3658961780,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2NTg5NjE3ODA=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3658961780","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"8caac32916ea5228bb4a3a56fcd158fde655ef94","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/8caac32916ea5228bb4a3a56fcd158fde655ef94","created_at":"2020-08-16T02:06:15Z","performed_via_github_app":null},{"id":3658961903,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2NTg5NjE5MDM=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3658961903","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"60fababbd733738bc9778d49c709b7026c9b5b83","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/60fababbd733738bc9778d49c709b7026c9b5b83","created_at":"2020-08-16T02:06:36Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/675645942","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-675645942","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":675645942,"node_id":"MDEyOklzc3VlQ29tbWVudDY3NTY0NTk0Mg==","user":{"login":"jgrund","id":458717,"node_id":"MDQ6VXNlcjQ1ODcxNw==","avatar_url":"https://avatars.githubusercontent.com/u/458717?v=4","gravatar_id":"","url":"https://api.github.com/users/jgrund","html_url":"https://github.com/jgrund","followers_url":"https://api.github.com/users/jgrund/followers","following_url":"https://api.github.com/users/jgrund/following{/other_user}","gists_url":"https://api.github.com/users/jgrund/gists{/gist_id}","starred_url":"https://api.github.com/users/jgrund/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgrund/subscriptions","organizations_url":"https://api.github.com/users/jgrund/orgs","repos_url":"https://api.github.com/users/jgrund/repos","events_url":"https://api.github.com/users/jgrund/events{/privacy}","received_events_url":"https://api.github.com/users/jgrund/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-18T18:36:45Z","updated_at":"2020-08-18T18:36:45Z","body":"FWIW, I think I'm hitting this (or something like it) when using `try_acquire` with Postgres.\r\n\r\nI have a loop which waits 5 seconds and calls `try_acquire` to see if any connections are available. The loop also does some work with the pool in a spawned task.\r\n\r\nOnce the 5 seconds elapse the pool shows all connections idle, but `try_acquire` returns `None`.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/675645942/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jgrund","id":458717,"node_id":"MDQ6VXNlcjQ1ODcxNw==","avatar_url":"https://avatars.githubusercontent.com/u/458717?v=4","gravatar_id":"","url":"https://api.github.com/users/jgrund","html_url":"https://github.com/jgrund","followers_url":"https://api.github.com/users/jgrund/followers","following_url":"https://api.github.com/users/jgrund/following{/other_user}","gists_url":"https://api.github.com/users/jgrund/gists{/gist_id}","starred_url":"https://api.github.com/users/jgrund/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgrund/subscriptions","organizations_url":"https://api.github.com/users/jgrund/orgs","repos_url":"https://api.github.com/users/jgrund/repos","events_url":"https://api.github.com/users/jgrund/events{/privacy}","received_events_url":"https://api.github.com/users/jgrund/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3667654153,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2Njc2NTQxNTM=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3667654153","actor":{"login":"jgrund","id":458717,"node_id":"MDQ6VXNlcjQ1ODcxNw==","avatar_url":"https://avatars.githubusercontent.com/u/458717?v=4","gravatar_id":"","url":"https://api.github.com/users/jgrund","html_url":"https://github.com/jgrund","followers_url":"https://api.github.com/users/jgrund/followers","following_url":"https://api.github.com/users/jgrund/following{/other_user}","gists_url":"https://api.github.com/users/jgrund/gists{/gist_id}","starred_url":"https://api.github.com/users/jgrund/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgrund/subscriptions","organizations_url":"https://api.github.com/users/jgrund/orgs","repos_url":"https://api.github.com/users/jgrund/repos","events_url":"https://api.github.com/users/jgrund/events{/privacy}","received_events_url":"https://api.github.com/users/jgrund/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"642eaa370a56f4d21a99f90810f6454ab4371019","commit_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/commits/642eaa370a56f4d21a99f90810f6454ab4371019","created_at":"2020-08-18T18:43:13Z","performed_via_github_app":null},{"actor":{"login":"jgrund","id":458717,"node_id":"MDQ6VXNlcjQ1ODcxNw==","avatar_url":"https://avatars.githubusercontent.com/u/458717?v=4","gravatar_id":"","url":"https://api.github.com/users/jgrund","html_url":"https://github.com/jgrund","followers_url":"https://api.github.com/users/jgrund/followers","following_url":"https://api.github.com/users/jgrund/following{/other_user}","gists_url":"https://api.github.com/users/jgrund/gists{/gist_id}","starred_url":"https://api.github.com/users/jgrund/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgrund/subscriptions","organizations_url":"https://api.github.com/users/jgrund/orgs","repos_url":"https://api.github.com/users/jgrund/repos","events_url":"https://api.github.com/users/jgrund/events{/privacy}","received_events_url":"https://api.github.com/users/jgrund/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-18T18:43:43Z","updated_at":"2020-08-18T18:43:43Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues/2165","repository_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre","labels_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues/2165/labels{/name}","comments_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues/2165/comments","events_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues/2165/events","html_url":"https://github.com/whamcloud/integrated-manager-for-lustre/pull/2165","id":681254151,"node_id":"MDExOlB1bGxSZXF1ZXN0NDY5NjcyNjAw","number":2165,"title":"Don't use try_acquire alongside spawned task","user":{"login":"jgrund","id":458717,"node_id":"MDQ6VXNlcjQ1ODcxNw==","avatar_url":"https://avatars.githubusercontent.com/u/458717?v=4","gravatar_id":"","url":"https://api.github.com/users/jgrund","html_url":"https://github.com/jgrund","followers_url":"https://api.github.com/users/jgrund/followers","following_url":"https://api.github.com/users/jgrund/following{/other_user}","gists_url":"https://api.github.com/users/jgrund/gists{/gist_id}","starred_url":"https://api.github.com/users/jgrund/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgrund/subscriptions","organizations_url":"https://api.github.com/users/jgrund/orgs","repos_url":"https://api.github.com/users/jgrund/repos","events_url":"https://api.github.com/users/jgrund/events{/privacy}","received_events_url":"https://api.github.com/users/jgrund/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":590805730,"node_id":"MDU6TGFiZWw1OTA4MDU3MzA=","url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":true,"assignee":{"login":"jgrund","id":458717,"node_id":"MDQ6VXNlcjQ1ODcxNw==","avatar_url":"https://avatars.githubusercontent.com/u/458717?v=4","gravatar_id":"","url":"https://api.github.com/users/jgrund","html_url":"https://github.com/jgrund","followers_url":"https://api.github.com/users/jgrund/followers","following_url":"https://api.github.com/users/jgrund/following{/other_user}","gists_url":"https://api.github.com/users/jgrund/gists{/gist_id}","starred_url":"https://api.github.com/users/jgrund/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgrund/subscriptions","organizations_url":"https://api.github.com/users/jgrund/orgs","repos_url":"https://api.github.com/users/jgrund/repos","events_url":"https://api.github.com/users/jgrund/events{/privacy}","received_events_url":"https://api.github.com/users/jgrund/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"jgrund","id":458717,"node_id":"MDQ6VXNlcjQ1ODcxNw==","avatar_url":"https://avatars.githubusercontent.com/u/458717?v=4","gravatar_id":"","url":"https://api.github.com/users/jgrund","html_url":"https://github.com/jgrund","followers_url":"https://api.github.com/users/jgrund/followers","following_url":"https://api.github.com/users/jgrund/following{/other_user}","gists_url":"https://api.github.com/users/jgrund/gists{/gist_id}","starred_url":"https://api.github.com/users/jgrund/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgrund/subscriptions","organizations_url":"https://api.github.com/users/jgrund/orgs","repos_url":"https://api.github.com/users/jgrund/repos","events_url":"https://api.github.com/users/jgrund/events{/privacy}","received_events_url":"https://api.github.com/users/jgrund/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2020-08-18T18:43:43Z","updated_at":"2020-08-19T02:22:40Z","closed_at":"2020-08-19T02:22:39Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":89255289,"node_id":"MDEwOlJlcG9zaXRvcnk4OTI1NTI4OQ==","name":"integrated-manager-for-lustre","full_name":"whamcloud/integrated-manager-for-lustre","private":false,"owner":{"login":"whamcloud","id":20727479,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIwNzI3NDc5","avatar_url":"https://avatars.githubusercontent.com/u/20727479?v=4","gravatar_id":"","url":"https://api.github.com/users/whamcloud","html_url":"https://github.com/whamcloud","followers_url":"https://api.github.com/users/whamcloud/followers","following_url":"https://api.github.com/users/whamcloud/following{/other_user}","gists_url":"https://api.github.com/users/whamcloud/gists{/gist_id}","starred_url":"https://api.github.com/users/whamcloud/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/whamcloud/subscriptions","organizations_url":"https://api.github.com/users/whamcloud/orgs","repos_url":"https://api.github.com/users/whamcloud/repos","events_url":"https://api.github.com/users/whamcloud/events{/privacy}","received_events_url":"https://api.github.com/users/whamcloud/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/whamcloud/integrated-manager-for-lustre","description":"Integrated Manager for Lustre","fork":false,"url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre","forks_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/forks","keys_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/keys{/key_id}","collaborators_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/teams","hooks_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/hooks","issue_events_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues/events{/number}","events_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/events","assignees_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/assignees{/user}","branches_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/branches{/branch}","tags_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/tags","blobs_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/git/refs{/sha}","trees_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/git/trees{/sha}","statuses_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/statuses/{sha}","languages_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/languages","stargazers_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/stargazers","contributors_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/contributors","subscribers_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/subscribers","subscription_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/subscription","commits_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/commits{/sha}","git_commits_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/git/commits{/sha}","comments_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/comments{/number}","issue_comment_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues/comments{/number}","contents_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/contents/{+path}","compare_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/compare/{base}...{head}","merges_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/merges","archive_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/downloads","issues_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues{/number}","pulls_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/pulls{/number}","milestones_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/milestones{/number}","notifications_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/labels{/name}","releases_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/releases{/id}","deployments_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/deployments","created_at":"2017-04-24T15:12:54Z","updated_at":"2025-05-05T13:19:37Z","pushed_at":"2021-04-05T14:35:27Z","git_url":"git://github.com/whamcloud/integrated-manager-for-lustre.git","ssh_url":"git@github.com:whamcloud/integrated-manager-for-lustre.git","clone_url":"https://github.com/whamcloud/integrated-manager-for-lustre.git","svn_url":"https://github.com/whamcloud/integrated-manager-for-lustre","homepage":"https://whamcloud.github.io/Online-Help/","size":92253,"stargazers_count":75,"watchers_count":75,"language":"Rust","has_issues":false,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":37,"mirror_url":null,"archived":true,"disabled":false,"open_issues_count":120,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["high-performance","hpc","lustre","management","monitoring","zfs"],"visibility":"public","forks":37,"open_issues":120,"watchers":75,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/pulls/2165","html_url":"https://github.com/whamcloud/integrated-manager-for-lustre/pull/2165","diff_url":"https://github.com/whamcloud/integrated-manager-for-lustre/pull/2165.diff","patch_url":"https://github.com/whamcloud/integrated-manager-for-lustre/pull/2165.patch","merged_at":"2020-08-19T02:22:39Z"},"body":"We're hitting an issue that looks similar to\r\nhttps://github.com/launchbadge/sqlx/issues/622\r\n\r\nI was able to work around it by disabling fairness, but we can just\r\navoid the lookup entirely if active workers is >= the pool size.\r\n\r\nSigned-off-by: Joe Grund <jgrund@whamcloud.io>\n\n<!-- Reviewable:start -->\n---\nThis change isâ€‚[<img src=\"https://reviewable.io/review_button.svg\" height=\"34\" align=\"absmiddle\" alt=\"Reviewable\"/>](https://reviewable.io/reviews/whamcloud/integrated-manager-for-lustre/2165)\n<!-- Reviewable:end -->\n","reactions":{"url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues/2165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/issues/2165/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":3668785841,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2Njg3ODU4NDE=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3668785841","actor":{"login":"jgrund","id":458717,"node_id":"MDQ6VXNlcjQ1ODcxNw==","avatar_url":"https://avatars.githubusercontent.com/u/458717?v=4","gravatar_id":"","url":"https://api.github.com/users/jgrund","html_url":"https://github.com/jgrund","followers_url":"https://api.github.com/users/jgrund/followers","following_url":"https://api.github.com/users/jgrund/following{/other_user}","gists_url":"https://api.github.com/users/jgrund/gists{/gist_id}","starred_url":"https://api.github.com/users/jgrund/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgrund/subscriptions","organizations_url":"https://api.github.com/users/jgrund/orgs","repos_url":"https://api.github.com/users/jgrund/repos","events_url":"https://api.github.com/users/jgrund/events{/privacy}","received_events_url":"https://api.github.com/users/jgrund/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"156972abbbf1db95d784dc0f25de8170e92d2e85","commit_url":"https://api.github.com/repos/whamcloud/integrated-manager-for-lustre/commits/156972abbbf1db95d784dc0f25de8170e92d2e85","created_at":"2020-08-19T02:22:40Z","performed_via_github_app":null},{"id":3872677203,"node_id":"MDExOkNsb3NlZEV2ZW50Mzg3MjY3NzIwMw==","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3872677203","actor":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-10-13T17:37:11Z","state_reason":null,"performed_via_github_app":null},{"id":3872677274,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM4NzI2NzcyNzQ=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/3872677274","actor":{"login":"mehcode","id":753919,"node_id":"MDQ6VXNlcjc1MzkxOQ==","avatar_url":"https://avatars.githubusercontent.com/u/753919?v=4","gravatar_id":"","url":"https://api.github.com/users/mehcode","html_url":"https://github.com/mehcode","followers_url":"https://api.github.com/users/mehcode/followers","following_url":"https://api.github.com/users/mehcode/following{/other_user}","gists_url":"https://api.github.com/users/mehcode/gists{/gist_id}","starred_url":"https://api.github.com/users/mehcode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mehcode/subscriptions","organizations_url":"https://api.github.com/users/mehcode/orgs","repos_url":"https://api.github.com/users/mehcode/repos","events_url":"https://api.github.com/users/mehcode/events{/privacy}","received_events_url":"https://api.github.com/users/mehcode/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"fa7981f68a95d4cddbb07843af62b41c730ee0a3","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/fa7981f68a95d4cddbb07843af62b41c730ee0a3","created_at":"2020-10-13T17:37:12Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/833015622","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-833015622","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":833015622,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzAxNTYyMg==","user":{"login":"bbqsrc","id":279099,"node_id":"MDQ6VXNlcjI3OTA5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/279099?v=4","gravatar_id":"","url":"https://api.github.com/users/bbqsrc","html_url":"https://github.com/bbqsrc","followers_url":"https://api.github.com/users/bbqsrc/followers","following_url":"https://api.github.com/users/bbqsrc/following{/other_user}","gists_url":"https://api.github.com/users/bbqsrc/gists{/gist_id}","starred_url":"https://api.github.com/users/bbqsrc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbqsrc/subscriptions","organizations_url":"https://api.github.com/users/bbqsrc/orgs","repos_url":"https://api.github.com/users/bbqsrc/repos","events_url":"https://api.github.com/users/bbqsrc/events{/privacy}","received_events_url":"https://api.github.com/users/bbqsrc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T21:21:16Z","updated_at":"2021-05-05T21:21:16Z","body":"I'm not certain this bug has been fixed, as I've been required to use the `deadpool` workaround, which has entirely solved the problems we've been having. `PgPool` seems to, in seemingly simple cases, break even under a very basic load.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/833015622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bbqsrc","id":279099,"node_id":"MDQ6VXNlcjI3OTA5OQ==","avatar_url":"https://avatars.githubusercontent.com/u/279099?v=4","gravatar_id":"","url":"https://api.github.com/users/bbqsrc","html_url":"https://github.com/bbqsrc","followers_url":"https://api.github.com/users/bbqsrc/followers","following_url":"https://api.github.com/users/bbqsrc/following{/other_user}","gists_url":"https://api.github.com/users/bbqsrc/gists{/gist_id}","starred_url":"https://api.github.com/users/bbqsrc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbqsrc/subscriptions","organizations_url":"https://api.github.com/users/bbqsrc/orgs","repos_url":"https://api.github.com/users/bbqsrc/repos","events_url":"https://api.github.com/users/bbqsrc/events{/privacy}","received_events_url":"https://api.github.com/users/bbqsrc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/833062161","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-833062161","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":833062161,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzA2MjE2MQ==","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T21:58:25Z","updated_at":"2021-05-05T21:58:25Z","body":"Yeah I think adding this periodic wake was a mistake: https://github.com/launchbadge/sqlx/blob/master/sqlx-core/src/pool/inner.rs#L180\r\n\r\nAfter a single wait period it effectively makes the pool unfair again as it becomes dependent on the timing of when tasks wake and poll the future.\r\n\r\nSomething I realized in 0.6 that I want to backport is that if a task is \"woken\" (as in its `woken` flag is set) but it doesn't try to acquire, on drop of the `Waiter` it needs to wake the next task in the list so that it can attempt to acquire. I think without that it leads to a knock-on effect where there's a connection in the idle queue and tasks waiting but none are getting woken because the first task was woken but didn't poll (either because it timed out or was cancelled).\r\n\r\nThe idle reaper might also be unintentionally preempting waiting tasks, I need to look into that.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/833062161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T22:19:34Z","updated_at":"2021-05-05T22:19:34Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1210","repository_url":"https://api.github.com/repos/launchbadge/sqlx","labels_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1210/labels{/name}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1210/comments","events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1210/events","html_url":"https://github.com/launchbadge/sqlx/issues/1210","id":874072610,"node_id":"MDU6SXNzdWU4NzQwNzI2MTA=","number":1210,"title":"sqlx 0.5.2 with a pool size of 1 fails to respond to simultaneous queries","user":{"login":"D1plo1d","id":145184,"node_id":"MDQ6VXNlcjE0NTE4NA==","avatar_url":"https://avatars.githubusercontent.com/u/145184?v=4","gravatar_id":"","url":"https://api.github.com/users/D1plo1d","html_url":"https://github.com/D1plo1d","followers_url":"https://api.github.com/users/D1plo1d/followers","following_url":"https://api.github.com/users/D1plo1d/following{/other_user}","gists_url":"https://api.github.com/users/D1plo1d/gists{/gist_id}","starred_url":"https://api.github.com/users/D1plo1d/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/D1plo1d/subscriptions","organizations_url":"https://api.github.com/users/D1plo1d/orgs","repos_url":"https://api.github.com/users/D1plo1d/repos","events_url":"https://api.github.com/users/D1plo1d/events{/privacy}","received_events_url":"https://api.github.com/users/D1plo1d/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-05-02T21:46:45Z","updated_at":"2021-05-20T23:41:25Z","closed_at":"2021-05-20T23:41:25Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":230595891,"node_id":"MDEwOlJlcG9zaXRvcnkyMzA1OTU4OTE=","name":"sqlx","full_name":"launchbadge/sqlx","private":false,"owner":{"login":"launchbadge","id":10077001,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEwMDc3MDAx","avatar_url":"https://avatars.githubusercontent.com/u/10077001?v=4","gravatar_id":"","url":"https://api.github.com/users/launchbadge","html_url":"https://github.com/launchbadge","followers_url":"https://api.github.com/users/launchbadge/followers","following_url":"https://api.github.com/users/launchbadge/following{/other_user}","gists_url":"https://api.github.com/users/launchbadge/gists{/gist_id}","starred_url":"https://api.github.com/users/launchbadge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/launchbadge/subscriptions","organizations_url":"https://api.github.com/users/launchbadge/orgs","repos_url":"https://api.github.com/users/launchbadge/repos","events_url":"https://api.github.com/users/launchbadge/events{/privacy}","received_events_url":"https://api.github.com/users/launchbadge/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/launchbadge/sqlx","description":"ðŸ§° The Rust SQL Toolkit. An async, pure Rust SQL crate featuring compile-time checked queries without a DSL. Supports PostgreSQL, MySQL, and SQLite.","fork":false,"url":"https://api.github.com/repos/launchbadge/sqlx","forks_url":"https://api.github.com/repos/launchbadge/sqlx/forks","keys_url":"https://api.github.com/repos/launchbadge/sqlx/keys{/key_id}","collaborators_url":"https://api.github.com/repos/launchbadge/sqlx/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/launchbadge/sqlx/teams","hooks_url":"https://api.github.com/repos/launchbadge/sqlx/hooks","issue_events_url":"https://api.github.com/repos/launchbadge/sqlx/issues/events{/number}","events_url":"https://api.github.com/repos/launchbadge/sqlx/events","assignees_url":"https://api.github.com/repos/launchbadge/sqlx/assignees{/user}","branches_url":"https://api.github.com/repos/launchbadge/sqlx/branches{/branch}","tags_url":"https://api.github.com/repos/launchbadge/sqlx/tags","blobs_url":"https://api.github.com/repos/launchbadge/sqlx/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/launchbadge/sqlx/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/launchbadge/sqlx/git/refs{/sha}","trees_url":"https://api.github.com/repos/launchbadge/sqlx/git/trees{/sha}","statuses_url":"https://api.github.com/repos/launchbadge/sqlx/statuses/{sha}","languages_url":"https://api.github.com/repos/launchbadge/sqlx/languages","stargazers_url":"https://api.github.com/repos/launchbadge/sqlx/stargazers","contributors_url":"https://api.github.com/repos/launchbadge/sqlx/contributors","subscribers_url":"https://api.github.com/repos/launchbadge/sqlx/subscribers","subscription_url":"https://api.github.com/repos/launchbadge/sqlx/subscription","commits_url":"https://api.github.com/repos/launchbadge/sqlx/commits{/sha}","git_commits_url":"https://api.github.com/repos/launchbadge/sqlx/git/commits{/sha}","comments_url":"https://api.github.com/repos/launchbadge/sqlx/comments{/number}","issue_comment_url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments{/number}","contents_url":"https://api.github.com/repos/launchbadge/sqlx/contents/{+path}","compare_url":"https://api.github.com/repos/launchbadge/sqlx/compare/{base}...{head}","merges_url":"https://api.github.com/repos/launchbadge/sqlx/merges","archive_url":"https://api.github.com/repos/launchbadge/sqlx/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/launchbadge/sqlx/downloads","issues_url":"https://api.github.com/repos/launchbadge/sqlx/issues{/number}","pulls_url":"https://api.github.com/repos/launchbadge/sqlx/pulls{/number}","milestones_url":"https://api.github.com/repos/launchbadge/sqlx/milestones{/number}","notifications_url":"https://api.github.com/repos/launchbadge/sqlx/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/launchbadge/sqlx/labels{/name}","releases_url":"https://api.github.com/repos/launchbadge/sqlx/releases{/id}","deployments_url":"https://api.github.com/repos/launchbadge/sqlx/deployments","created_at":"2019-12-28T10:40:57Z","updated_at":"2025-11-10T07:15:41Z","pushed_at":"2025-10-29T18:37:49Z","git_url":"git://github.com/launchbadge/sqlx.git","ssh_url":"git@github.com:launchbadge/sqlx.git","clone_url":"https://github.com/launchbadge/sqlx.git","svn_url":"https://github.com/launchbadge/sqlx","homepage":"","size":9641,"stargazers_count":15938,"watchers_count":15938,"language":"Rust","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1502,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":701,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["async","await","mariadb","mysql","postgres","postgresql","rust","sql","sqlite"],"visibility":"public","forks":1502,"open_issues":701,"watchers":15938,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"After upgrading to sqlx 0.5.2 whenever I run more then one SQL query in parallel one (or possibly more) of the queries will time out after 30 seconds with:\r\n\r\n```\r\npool timed out while waiting for an open connection\r\n```\r\n\r\nDowngrading to sqlx 0.5.1 resolves the issue and these same queries complete within an imperceptible amount of time.\r\n\r\nI'm using Sqlite with the following configuration:\r\n```rust\r\n    // Connect to the database\r\n    let db_options = db_url.parse::<SqliteConnectOptions>()?\r\n        .synchronous(sqlx::sqlite::SqliteSynchronous::Normal);\r\n\r\n    let db = SqlitePoolOptions::new()\r\n        .max_connections(1)\r\n        .connect_with(db_options)\r\n        .await?;\r\n```\r\n\r\nCould this be related to the pool changes in #1149 ?\r\n\r\nAlso downgrading to 0.5.1 was made slightly more difficult because `sqlx-core` and `sqlx-macros` were not locked to the same patch release as `sqlx`. If it would be possible to lock those to the same releass as sqlx, eg. \"=0.5.1\" that might be handy in debugging future patch release regressions.","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/1210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/launchbadge/sqlx/issues/1210/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/833124871","html_url":"https://github.com/launchbadge/sqlx/issues/622#issuecomment-833124871","issue_url":"https://api.github.com/repos/launchbadge/sqlx/issues/622","id":833124871,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzEyNDg3MQ==","user":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T00:02:15Z","updated_at":"2021-05-06T00:02:15Z","body":"Just spotted another bug, too; since waking a waiting task involves popping it from the `SegQueue`, if the task wakes and doesn't get a connection, it'll just... go back to sleep without putting itself back in the queue.\r\n\r\nUsing `SegQueue` was probably a bad idea anyway since waiting tasks can't retain their spot in line and have to get returned to the back of the queue. In 0.6 we're switching to an intrusive linked list where waiting tasks aren't removed until `acquire()` completes or is cancelled, so that should avoid this issue.\r\n\r\nThe idle reaper is also definitely preempting some waiting tasks since it directly pops connections from the idle queue without checking if any tasks are waiting.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/launchbadge/sqlx/issues/comments/833124871/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null,"event":"commented","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4692094470,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQ0NjkyMDk0NDcw","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/4692094470","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2021-05-06T00:02:15Z","state_reason":null,"performed_via_github_app":null},{"id":4692136764,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ2OTIxMzY3NjQ=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/4692136764","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"96b5564e1877f94752cb8544a348487098b26644","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/96b5564e1877f94752cb8544a348487098b26644","created_at":"2021-05-06T00:15:54Z","performed_via_github_app":null},{"id":4692140344,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ2OTIxNDAzNDQ=","url":"https://api.github.com/repos/launchbadge/sqlx/issues/events/4692140344","actor":{"login":"abonander","id":3198595,"node_id":"MDQ6VXNlcjMxOTg1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/3198595?v=4","gravatar_id":"","url":"https://api.github.com/users/abonander","html_url":"https://github.com/abonander","followers_url":"https://api.github.com/users/abonander/followers","following_url":"https://api.github.com/users/abonander/following{/other_user}","gists_url":"https://api.github.com/users/abonander/gists{/gist_id}","starred_url":"https://api.github.com/users/abonander/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abonander/subscriptions","organizations_url":"https://api.github.com/users/abonander/orgs","repos_url":"https://api.github.com/users/abonander/repos","events_url":"https://api.github.com/users/abonander/events{/privacy}","received_events_url":"https://api.github.com/users/abonander/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"0847a04b7afabc47b9a8b40aa0365cd275e24dd9","commit_url":"https://api.github.com/repos/launchbadge/sqlx/commits/0847a04b7afabc47b9a8b40aa0365cd275e24dd9","created_at":"2021-05-06T00:17:02Z","performed_via_github_app":null}]