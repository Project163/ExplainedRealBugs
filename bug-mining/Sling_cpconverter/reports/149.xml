<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:37:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SLING-11240] Content packages with invalid Long properties cause index definition extraction to fail</title>
                <link>https://issues.apache.org/jira/browse/SLING-11240</link>
                <project id="12310710" key="SLING">Sling</project>
                    <description>&lt;p&gt;Certain content packages contain invalid attribute definitions, such as&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;...
  &amp;lt;jcrTitle jcr:primaryType=&quot;nt:unstructured&quot; name=&quot;jcr:content/jcr:title&quot; boost=&quot;{Long}2.0&quot; /&amp;gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Although the intention is clear - a boot value of 2 - parsing fails&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.NumberFormatException: For input string: &quot;2.0&quot;
	at java.base/java.lang.NumberFormatException.forInputString(NumberFormatException.java:65)
	at java.base/java.lang.Long.parseLong(Long.java:692)
	at java.base/java.lang.Long.parseLong(Long.java:817)
	at org.apache.sling.feature.cpconverter.index.IndexDefinitionsJsonWriter.lambda$write$2(IndexDefinitionsJsonWriter.java:94)
	at org.apache.sling.feature.cpconverter.index.IndexDefinitionsJsonWriter.write(IndexDefinitionsJsonWriter.java:143)
	at org.apache.sling.feature.cpconverter.index.IndexDefinitionsJsonWriter.write(IndexDefinitionsJsonWriter.java:94)
	at org.apache.sling.feature.cpconverter.index.IndexDefinitionsJsonWriter.write(IndexDefinitionsJsonWriter.java:134)
	at org.apache.sling.feature.cpconverter.index.IndexDefinitionsJsonWriter.write(IndexDefinitionsJsonWriter.java:134)
	at org.apache.sling.feature.cpconverter.index.IndexDefinitionsJsonWriter.write(IndexDefinitionsJsonWriter.java:134)
	at org.apache.sling.feature.cpconverter.index.IndexDefinitionsJsonWriter.write(IndexDefinitionsJsonWriter.java:134)
	at org.apache.sling.feature.cpconverter.index.IndexDefinitionsJsonWriter.writeAsJson(IndexDefinitionsJsonWriter.java:69)
	at org.apache.sling.feature.cpconverter.index.DefaultIndexManager.addRepoinitExtension(DefaultIndexManager.java:38)
	at org.apache.sling.feature.cpconverter.ContentPackage2FeatureModelConverter.secondPass(ContentPackage2FeatureModelConverter.java:331)
	at org.apache.sling.feature.cpconverter.ContentPackage2FeatureModelConverter.convert(ContentPackage2FeatureModelConverter.java:266)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13437217">SLING-11240</key>
            <summary>Content packages with invalid Long properties cause index definition extraction to fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rombert">Robert Munteanu</assignee>
                                    <reporter username="rombert">Robert Munteanu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Apr 2022 10:29:07 +0000</created>
                <updated>Fri, 20 May 2022 05:00:12 +0000</updated>
                            <resolved>Fri, 1 Apr 2022 11:01:51 +0000</resolved>
                                    <version>Content-Package to Feature Model Converter 1.1.14</version>
                                    <fixVersion>Content-Package to Feature Model Converter 1.1.16</fixVersion>
                                    <component>Content-Package to Feature Model Converter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17515867" author="rombert" created="Fri, 1 Apr 2022 11:01:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; - I am getting the data from the filevault &lt;tt&gt;DocViewParser&lt;/tt&gt;, who is apparently happy to send over a property value of &quot;2.0&quot; and type &lt;tt&gt;Long&lt;/tt&gt;. I assume that the parsing/conversion is something that happens in Vault further down the line. Is this something that can be moved over to the parsers to simplify consumption of should I handle it in the cp converter?&lt;/p&gt;</comment>
                            <comment id="17515875" author="kwin" created="Fri, 1 Apr 2022 11:30:18 +0000"  >&lt;p&gt;The DocViewProperty2 does not perform type coercion. When applying to a Node it relies on &lt;a href=&quot;https://developer.adobe.com/experience-manager/reference-materials/spec/jsr170/javadocs/jcr-2.0/javax/jcr/Node.html#setProperty(java.lang.String,%20java.lang.String,%20int&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://developer.adobe.com/experience-manager/reference-materials/spec/jsr170/javadocs/jcr-2.0/javax/jcr/Node.html#setProperty(java.lang.String,%20java.lang.String,%20int&lt;/a&gt;) for doing the conversion. As this is implementation specific, there is nothing which can be done here by FileVault just with JCR API IMO. Feel free to raise an issue in FileVault with a PR if you disagree. Actually I am pretty sure that Long an &#8222;2.0&#8220; is accepted by Apache Oak (compare with &lt;a href=&quot;https://developer.adobe.com/experience-manager/reference-materials/spec/jcr/2.0/3_Repository_Model.html#3.6.4%20Property%20Type%20Conversion&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://developer.adobe.com/experience-manager/reference-materials/spec/jcr/2.0/3_Repository_Model.html#3.6.4%20Property%20Type%20Conversion&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="17515893" author="rombert" created="Fri, 1 Apr 2022 12:17:44 +0000"  >&lt;p&gt;Ack , thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; . We&apos;ll keep the parsing logic in Sling. FWIW, I think Oak does more of the conversation than what the spec says. We have&lt;br/&gt;
&lt;blockquote&gt;&lt;p&gt;From STRING To&lt;br/&gt;
(...)&lt;br/&gt;
LONG: The string is converted using java.lang.Long.valueOf(String).&lt;/p&gt;&lt;/blockquote&gt;.&lt;/p&gt;

&lt;p&gt;but &lt;tt&gt;Long.valueOf(&quot;2.0&quot;)&lt;/tt&gt; fails with a NumberFormatException.&lt;/p&gt;</comment>
                            <comment id="17515940" author="kwin" created="Fri, 1 Apr 2022 14:09:15 +0000"  >&lt;p&gt;I created &lt;a href=&quot;https://issues.apache.org/jira/browse/JCRVLT-623&quot; title=&quot;Validate that DocView values for a specific type are correct serializations (i.e. are a string which can be converted back to the given type)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JCRVLT-623&quot;&gt;&lt;del&gt;JCRVLT-623&lt;/del&gt;&lt;/a&gt; to improve validation for that case. I don&apos;t know yet, whether that will lead to an exception being thrown by DocViewProperty2.parse() or just an additional check in the validator only.&lt;/p&gt;</comment>
                            <comment id="17515947" author="kwin" created="Fri, 1 Apr 2022 14:24:40 +0000"  >&lt;p&gt;IMHO failure is expected and the only reasonable thing to do here. When you try to import such package with FileVault it will fail as well (in strict mode) and in no case it tries to convert the value but in the lenient case just skips the property. Establishing a different/more lenient behaviour in cp2fm doesn&apos;t feel right to me. Any particular reason why you think you need to accept such invalid DocView XML files?&lt;/p&gt;</comment>
                            <comment id="17520612" author="rombert" created="Mon, 11 Apr 2022 14:30:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; - I have lost track of what happens with this kind of input in the processing pipeline I&apos;m using at the moment &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I fully agree that we should prevent invalid content packages from advancing, and earlier is better.&lt;/p&gt;

&lt;p&gt;At the same time, I did not see any problems with this package, except for the changes I introduced. So I&apos;d be hesistant to add more validation, or at least if FileVault becomes more strict I&apos;d be very careful about integrating it since it has the potential to introduce regressions.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13437262">JCRVLT-623</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 30 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1121c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>