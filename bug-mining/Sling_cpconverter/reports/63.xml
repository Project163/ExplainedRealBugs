<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:36:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SLING-9970] SystemUser.getPath doesn&apos;t reflect the repository path</title>
                <link>https://issues.apache.org/jira/browse/SLING-9970</link>
                <project id="12310710" key="SLING">Sling</project>
                    <description>&lt;p&gt;I tried to find out why &lt;tt&gt;AccessControlEntry&lt;/tt&gt; is constructed with 2 different &lt;tt&gt;RepoPath}}s one reflecting the path as obtained from the parser and one containing the path converted to &apos;repository path&apos; using {{PlatformNameFormat.getRepositoryPath(resourcePath)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;from what i see the &apos;repository&apos; path contained in the entry is later used to create the hierarchy down to access controlled nodes that hold the resource-based access control policy with the entries.&lt;/p&gt;

&lt;p&gt;but looking at the usages of the &apos;path&apos; field i found that it is only used in &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/blob/master/src/main/java/org/apache/sling/feature/cpconverter/accesscontrol/DefaultAclManager.java#L152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/blob/master/src/main/java/org/apache/sling/feature/cpconverter/accesscontrol/DefaultAclManager.java#L152&lt;/a&gt; (see also &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-9953&quot; title=&quot;ACEs on/below user nodes are ignored upon conversion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-9953&quot;&gt;&lt;del&gt;SLING-9953&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-comment&quot;&gt;// clean the unneeded ACLs, see SLING-8561
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (authorizations != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            Iterator&amp;lt;AccessControlEntry&amp;gt; authorizationsIterator = authorizations.iterator();
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (authorizationsIterator.hasNext()) {
                AccessControlEntry acl = authorizationsIterator.next();

                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (acl.getPath().startsWith(systemUser.getPath())) {
                    authorizationsIterator.remove();
                }
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;this finding lead me to the conclusion that the &lt;tt&gt;SystemUser&lt;/tt&gt; object is in fact created with a path that doesn&apos;t actually represent the JCR path as found in the repository.&lt;/p&gt;

&lt;p&gt;so, all usages of &lt;tt&gt;SystemUser.getPath&lt;/tt&gt; used to create the system user will potentially use the &apos;wrong&apos; path. for example:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/blob/master/src/main/java/org/apache/sling/feature/cpconverter/accesscontrol/DefaultAclManager.java#L105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/blob/master/src/main/java/org/apache/sling/feature/cpconverter/accesscontrol/DefaultAclManager.java#L105&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-comment&quot;&gt;// TODO does it harm?!?
&lt;/span&gt;     addSystemUserPath(formatter, systemUser.getPath());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which the issues the following repo-init statement&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
formatter.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;create path (rep:AuthorizableFolder) %s%n&quot;&lt;/span&gt;, path);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/blob/master/src/main/java/org/apache/sling/feature/cpconverter/accesscontrol/DefaultAclManager.java#L109&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/blob/master/src/main/java/org/apache/sling/feature/cpconverter/accesscontrol/DefaultAclManager.java#L109&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
formatter.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;create service user %s with path %s%n&quot;&lt;/span&gt;, systemUser.getId(), systemUser.getPath());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;upon a quick (but maybe incomplete) search I didn&apos;t find any usage of &lt;tt&gt;SystemUser.getPath()&lt;/tt&gt; that would require it to reflect the path as extracted from the content package.... if that was true, the method should be renamed to &apos;getRepositoryPath&apos; and should return the converted  path (see above).&lt;/p&gt;

&lt;p&gt;Having this addressed would IMO subsequently allow to drop the duplicated path argument from the &lt;tt&gt;AccessControlEntry&lt;/tt&gt; and drop the &lt;tt&gt;getPath&lt;/tt&gt; method altogether. which anyway seems a bit confusing to have. let me know if i should create a separate issue for this follow up clean up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13343936">SLING-9970</key>
            <summary>SystemUser.getPath doesn&apos;t reflect the repository path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karlpauls">Karl Pauls</assignee>
                                    <reporter username="angela">Angela Schreiber</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Dec 2020 08:07:34 +0000</created>
                <updated>Mon, 17 May 2021 11:38:36 +0000</updated>
                            <resolved>Wed, 9 Dec 2020 14:51:53 +0000</resolved>
                                                    <fixVersion>Content-Package to Feature Model Converter 1.1.0</fixVersion>
                                    <component>Content-Package to Feature Model Converter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="17243079" author="anchela" created="Thu, 3 Dec 2020 10:26:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cziegeler&quot; class=&quot;user-hover&quot; rel=&quot;cziegeler&quot;&gt;cziegeler&lt;/a&gt;, patch at &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/tree/SLING-9970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/tree/SLING-9970&lt;/a&gt;. I decided not to change the name of &lt;tt&gt;SystemUser.getPath()&lt;/tt&gt; in order to keep the number of modifications as limited as possible.&lt;/p&gt;

&lt;p&gt;hope it helps. but please be aware that i have very limited insight into the usage and the intentions of the converter tool... so careful review is needed from someone in the sling team that is familiar and in charge of this code.&lt;/p&gt;</comment>
                            <comment id="17246582" author="karlpauls" created="Wed, 9 Dec 2020 14:51:53 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Angela&quot; class=&quot;user-hover&quot; rel=&quot;angela&quot;&gt;Angela&lt;/a&gt; - I merged your patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0l5ns:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>