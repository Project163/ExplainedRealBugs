<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:36:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SLING-10157] Converter fails with duplicate configuration PIDs</title>
                <link>https://issues.apache.org/jira/browse/SLING-10157</link>
                <project id="12310710" key="SLING">Sling</project>
                    <description>&lt;p&gt;If there is a configuration for the same PID multiple times, either in the same or different content packages, the converter fails with an error.&lt;br/&gt;
We should handle this similar to how the OSGi installer does it, and pick the right configuration based on the repository path.&lt;br/&gt;
A warning should be logged for these cases as well.&lt;/p&gt;

&lt;p&gt;We could add a strict option, throwing an exception in this case like today&lt;/p&gt;</description>
                <environment></environment>
        <key id="13360383">SLING-10157</key>
            <summary>Converter fails with duplicate configuration PIDs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="cziegeler">Carsten Ziegeler</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Feb 2021 17:04:35 +0000</created>
                <updated>Mon, 17 May 2021 11:38:42 +0000</updated>
                            <resolved>Fri, 26 Feb 2021 14:07:22 +0000</resolved>
                                    <version>Content-Package to Feature Model Converter 1.0.24</version>
                                    <fixVersion>Content-Package to Feature Model Converter 1.1.0</fixVersion>
                                    <component>Content-Package to Feature Model Converter</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17289419" author="schaefa" created="Tue, 23 Feb 2021 23:02:08 +0000"  >&lt;p&gt;The CP Converter has a mergeConfiguration flag that enables to deal with multiple configurations. That said I takes the configuration is order it finds it in the ZIP file and that is, I assume, alphabetically ordered.&lt;br/&gt;
I would prefer to have a way of setting a precedence based on the content-package but as far as I can tell this is not available to the&#160;FeaturesManager so I guess we should have something along the lines of the Sling Feature Model Plugin (USE_FIRST / USE_LATEST).&lt;/p&gt;</comment>
                            <comment id="17289682" author="cziegeler" created="Wed, 24 Feb 2021 06:31:15 +0000"  >&lt;p&gt;The order of paths in a zip file is not reliable, it depends on the tool creating the zip file and the order the tool creates the entries. So this is not a stable order.&lt;br/&gt;
I think the first step is to implement this like the OSGi installer does, and that is based on the path order - that should be the default.&lt;br/&gt;
I&apos;m not sure if anyone is using the mergeConfiguration flag - at least the way it is implemented today, it does not have a stable order either.&lt;br/&gt;
I&apos;m open to implement other strategies, but I think thats an extension to the current mechanism.&lt;br/&gt;
Or in other words, lets&lt;br/&gt;
1. fix the broken implementation (this issue)&lt;br/&gt;
2. think about extensions (another issue)&lt;/p&gt;</comment>
                            <comment id="17290504" author="schaefa" created="Wed, 24 Feb 2021 22:30:39 +0000"  >&lt;p&gt;The issue I encounter is a little bit more delicate as it is forced by the way Feature Models are handled.&lt;/p&gt;

&lt;p&gt;Traditionally I would install (external) package into Sling that may contain OSGi configurations (assume here it does).&lt;br/&gt;
Then I would install the client&apos;s custom project package which its custom configuration which in turn overrides the default configuration of the external package.&lt;/p&gt;

&lt;p&gt;Because this happens at different times (two separate installation tasks) the order is defined by that.&lt;/p&gt;

&lt;p&gt;In the Feature Model world the customer might combine both packages into one package (required by Skyline) together with the configurations and here we need to provide a strategy to resolve it.&lt;/p&gt;

&lt;p&gt;For now we can rely on an alphabetical order meaning that the overriding configuration but that might getting ugly when the configuration is in the /libs folder.&lt;/p&gt;</comment>
                            <comment id="17290699" author="cziegeler" created="Thu, 25 Feb 2021 06:02:10 +0000"  >&lt;p&gt;We need to have a consistent, repeatable solution - in the old world with the OSGi installer, the way it works is:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if all configurations are known, alphabetical ordering of the id is used, the first being used (so /apps before /libs)&lt;/li&gt;
	&lt;li&gt;if a configuration is already installed and a new one with the PID at a different location arrives, the new one is not considered regardless of the path&lt;br/&gt;
So that already is inconsistent and depends on installation order; which is a bad idea - we must not make the same mistake here again.&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="17291667" author="cziegeler" created="Fri, 26 Feb 2021 14:07:22 +0000"  >&lt;p&gt;Implemented in &lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/commit/23731f426bb9ec00313f11ae81cdcbb72110c0f7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/commit/23731f426bb9ec00313f11ae81cdcbb72110c0f7&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17293125" author="schaefa" created="Mon, 1 Mar 2021 19:30:59 +0000"  >&lt;p&gt;It works but I ran into a few issues:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in AbstractJcrNodeParser&#160;this line failed:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;this.primaryTypes = ImmutableSet.of(primaryTypes);&lt;/p&gt;

&lt;p&gt;and I had to replace it with:&lt;br/&gt;
 this.primaryTypes = new HashSet&amp;lt;String&amp;gt;(java.util.Arrays.asList(primaryTypes));&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In&#160;DefaultFeaturesManager when I only have two configurations it did not work well because the first configuration is not added to the map. So I had to add this line (233):&lt;/p&gt;

&lt;p&gt;if (configuration == null) {&lt;br/&gt;
 configuration = new Configuration(pid);&lt;br/&gt;
 feature.getConfigurations().add(configuration);&lt;/p&gt;

&lt;p&gt;// Add this so that the first configuration is considered in an Ordered configuration&lt;br/&gt;
 this.pidToPathMapping.put(pid, path);&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17293376" author="cziegeler" created="Tue, 2 Mar 2021 05:56:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andysch&quot; class=&quot;user-hover&quot; rel=&quot;andysch&quot;&gt;andysch&lt;/a&gt; Good catch with the missing line for the configuration handling. I added it (together with a test):&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/commit/28a78d2a8f2cee923402cf1be39be9cac62baa6c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/commit/28a78d2a8f2cee923402cf1be39be9cac62baa6c&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For the other error, that seems to be unrelated to configurations, please open a separate ticket. Thanks&lt;/p&gt;</comment>
                            <comment id="17293628" author="cziegeler" created="Tue, 2 Mar 2021 11:20:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andysch&quot; class=&quot;user-hover&quot; rel=&quot;andysch&quot;&gt;andysch&lt;/a&gt; I created &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-10180&quot; title=&quot;Remove dependency to google commons&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-10180&quot;&gt;&lt;del&gt;SLING-10180&lt;/del&gt;&lt;/a&gt; - let me know if that fixes the other problem&lt;/p&gt;</comment>
                            <comment id="17293813" author="schaefa" created="Tue, 2 Mar 2021 16:19:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cziegeler&quot; class=&quot;user-hover&quot; rel=&quot;cziegeler&quot;&gt;cziegeler&lt;/a&gt;&#160;Yes, that fixed my problems.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nz9c:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>