<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:36:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SLING-8800] A change in a Content Package will not be reflected in a Converted CP on a rebuild</title>
                <link>https://issues.apache.org/jira/browse/SLING-8800</link>
                <project id="12310710" key="SLING">Sling</project>
                    <description>&lt;p&gt;After a successful content package conversion any change in a content package will not be reflected in a converted content package.&lt;/p&gt;

&lt;p&gt;The reason is that the temporary generated file inside a temporary folder created in the&#160;VaultPackageAssembler is not deleted.&lt;/p&gt;

&lt;p&gt;The CP Converter should at least provide a flag to force the deletion but maybe it is best to use a hash to see if the content has changed and if should delete the temporary folder.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13264306">SLING-8800</key>
            <summary>A change in a Content Package will not be reflected in a Converted CP on a rebuild</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="andysch">Andreas Schaefer</assignee>
                                    <reporter username="andysch">Andreas Schaefer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Oct 2019 18:08:02 +0000</created>
                <updated>Thu, 13 Feb 2020 08:46:05 +0000</updated>
                            <resolved>Wed, 27 Nov 2019 01:48:44 +0000</resolved>
                                                    <fixVersion>Content-Package to Feature Model Converter 1.0.2</fixVersion>
                                    <component>Feature Model</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16959853" author="schaefa" created="Fri, 25 Oct 2019 15:25:43 +0000"  >&lt;p&gt;This is an issue with the&#160;VaultPackageAssembler class as it only adds and changes files but does not remove files in the ZIP deflated folder and so removed files are staying in the package forever.&lt;/p&gt;

&lt;p&gt;I am looking into a solution where an existing deflated folder is deleted when the&#160;VaultPackageAssembler is created to make sure we do not carry around old baggage.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16959917" author="schaefa" created="Fri, 25 Oct 2019 16:45:57 +0000"  >&lt;p&gt;The attached ZIP file contains a test project (generated with the Sling Project Archetype).&lt;br/&gt;
To see the issue to the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Go to folder ui.apps/src/main/content/jcr_root/apps/test2/page&lt;/li&gt;
	&lt;li&gt;Create a file test.html and add some content&lt;/li&gt;
	&lt;li&gt;Build it (mvn clean install)&lt;/li&gt;
	&lt;li&gt;Look into the the temporary folder (search the logs for &apos;Building zip:&apos; which should point out the folder)&lt;/li&gt;
	&lt;li&gt;List the deflated folder: &apos;ls -lta ui.apps-1.0.0-SNAPSHOT.zip-deflated/jcr_root/apps/test2/page`&lt;/li&gt;
	&lt;li&gt;The &apos;test.html&apos; file should be there next to page.html etc&lt;/li&gt;
	&lt;li&gt;Now delete this file in your source folder&lt;/li&gt;
	&lt;li&gt;Rebuild with (mvn clean install)&lt;/li&gt;
	&lt;li&gt;List the deflated folder once more and the file is still there&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is how I fixed it in my project inside the VaulPackageAssembler:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; VaultPackageAssembler create(VaultPackage vaultPackage, WorkspaceFilter filter) {
    File storingDirectory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(TMP_DIR, vaultPackage.getFile().getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;-deflated&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(storingDirectory.exists()) {
        File backup = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(storingDirectory.getPath() + &lt;span class=&quot;code-quote&quot;&gt;&quot;.backup&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(backup.exists()) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                FileUtils.deleteDirectory(backup);
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(IOException e) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to delete backup folder: &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + backup + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&quot;&lt;/span&gt;, e);
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!storingDirectory.renameTo(backup)) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to rename folder: &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + storingDirectory + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt; to folder: &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + backup + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&quot;&lt;/span&gt;);
        }
    }
    &lt;span class=&quot;code-comment&quot;&gt;// avoid any possible Stream is not a content &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;. Missing &lt;span class=&quot;code-quote&quot;&gt;&apos;jcr_root&apos;&lt;/span&gt; error
&lt;/span&gt;    File jcrRootDirectory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(storingDirectory, ROOT_DIR);
...&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I just kept the old folder there for comparison purposes.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16959920" author="schaefa" created="Fri, 25 Oct 2019 16:53:01 +0000"  >&lt;p&gt;Just on a side note the name for the temporary folder is misspelled: &apos;syntethic-content-packages&apos;&lt;/p&gt;

&lt;p&gt;It should be &apos;synthetic-content-packages&apos; if I am not mistaken.&lt;/p&gt;</comment>
                            <comment id="16959928" author="schaefa" created="Fri, 25 Oct 2019 17:09:08 +0000"  >&lt;p&gt;Updated the attachments as the original one contained the patched CP Converter in the local repo.&lt;/p&gt;</comment>
                            <comment id="16960187" author="schaefa" created="Fri, 25 Oct 2019 22:30:25 +0000"  >&lt;p&gt;Created a PR with a fix for this:&#160;&lt;a href=&quot;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/pull/20&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/sling-org-apache-sling-feature-cpconverter/pull/20&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16983077" author="schaefa" created="Wed, 27 Nov 2019 01:48:26 +0000"  >&lt;p&gt;I merged my PR as this was pending after a month and I discovered another issue where when two modules in a project have the same artifact id like ui.apps (but different group ids) then the deflated folder would contain both code as the folders are not deleted.&lt;br/&gt;
I fixed that by adding the package id as a prefix to the file name - hopefully this makes the folder unique. Anyhow the deletion of the folder would prevent the code duplication.&lt;/p&gt;</comment>
                            <comment id="16983078" author="schaefa" created="Wed, 27 Nov 2019 01:48:44 +0000"  >&lt;p&gt;Merged&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12984038" name="secondary-test.zip" size="13235035" author="andysch" created="Fri, 25 Oct 2019 17:06:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07xbk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>