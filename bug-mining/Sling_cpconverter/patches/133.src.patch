diff --git a/pom.xml b/pom.xml
index 47401b3..ba5cfeb 100644
--- a/pom.xml
+++ b/pom.xml
@@ -244,6 +244,18 @@
       <version>${mockito-core.version}</version>
       <scope>test</scope>
     </dependency>
+    <dependency>
+      <groupId>org.apache.jackrabbit</groupId>
+      <artifactId>jackrabbit-jcr2spi</artifactId>
+      <version>2.21.3</version>
+      <scope>compile</scope>
+    </dependency>
+    <dependency>
+      <groupId>org.apache.jackrabbit.vault</groupId>
+      <artifactId>vault-validation</artifactId>
+      <version>3.4.6</version>
+      <scope>compile</scope>
+    </dependency>
   </dependencies>
 
   <build>
diff --git a/src/main/java/org/apache/sling/feature/cpconverter/vltpkg/JcrNamespaceRegistry.java b/src/main/java/org/apache/sling/feature/cpconverter/vltpkg/JcrNamespaceRegistry.java
index 51263f7..3f84c07 100644
--- a/src/main/java/org/apache/sling/feature/cpconverter/vltpkg/JcrNamespaceRegistry.java
+++ b/src/main/java/org/apache/sling/feature/cpconverter/vltpkg/JcrNamespaceRegistry.java
@@ -16,89 +16,92 @@
  */
 package org.apache.sling.feature.cpconverter.vltpkg;
 
-import java.io.IOException;
-import java.io.Reader;
-import java.util.ArrayList;
-import java.util.Collection;
-import java.util.HashMap;
-import java.util.Map;
+import org.apache.jackrabbit.commons.SimpleValueFactory;
+import org.apache.jackrabbit.commons.cnd.CndImporter;
+import org.apache.jackrabbit.commons.cnd.ParseException;
+import org.apache.jackrabbit.spi.commons.namespace.NamespaceResolver;
+import org.apache.jackrabbit.vault.validation.spi.impl.nodetype.NodeTypeManagerProvider;
+import org.jetbrains.annotations.NotNull;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 import javax.jcr.NamespaceException;
 import javax.jcr.NamespaceRegistry;
 import javax.jcr.RepositoryException;
-
-import org.apache.jackrabbit.commons.cnd.ParseException;
-import org.apache.jackrabbit.spi.commons.namespace.NamespaceResolver;
-import org.jetbrains.annotations.NotNull;
+import javax.jcr.ValueFactory;
+import javax.jcr.nodetype.NodeTypeManager;
+import java.io.IOException;
+import java.io.Reader;
+import java.util.ArrayList;
+import java.util.Collection;
 
 /** Simple namespace registry backed by a map */
 public class JcrNamespaceRegistry implements NamespaceRegistry, NamespaceResolver {
 
-    private final Map<String, String> prefixUriMapping;
-    private final Collection<String> registeredCndSystemIds;
-    
-    public JcrNamespaceRegistry() {
-        prefixUriMapping = new HashMap<>();
-        prefixUriMapping.put(PREFIX_JCR, NAMESPACE_JCR);
-        prefixUriMapping.put(PREFIX_MIX, NAMESPACE_MIX);
-        prefixUriMapping.put(PREFIX_NT, NAMESPACE_NT);
-        prefixUriMapping.put(PREFIX_XML, NAMESPACE_XML);
-        // referencing from org.apache.sling.jcr.resource.api.JcrResourceConstants.SLING_NAMESPACE_URI would require an additional dependency
-        prefixUriMapping.put("sling", "http://sling.apache.org/jcr/sling/1.0");
-        registeredCndSystemIds = new ArrayList<>();
+    protected final Logger logger = LoggerFactory.getLogger(getClass());
+    private final Collection<String> registeredCndSystemIds = new ArrayList<>();
+    private final NodeTypeManagerProvider ntManagerProvider = new NodeTypeManagerProvider();
+    private final NodeTypeManager ntManager;
+
+    public JcrNamespaceRegistry() throws RepositoryException, ParseException, IOException {
+        ntManager = ntManagerProvider.getNodeTypeManager();
+        ntManagerProvider.registerNamespace(PREFIX_XML, NAMESPACE_XML);
     }
 
     public void registerCnd(Reader reader, String systemId) throws ParseException, RepositoryException, IOException {
-        throw new IllegalStateException("Not implemented");
-        /*
-        TODO: SLING-10770, implement CND support
-            NodeTypeManager ntManager = null;
-            ValueFactory valueFactory = null;
-            CndImporter.registerNodeTypes(reader, systemId, ntManager, this, valueFactory, false);
-            registeredCndSystemIds.add(systemId);
-         */
+        ValueFactory valueFactory = new SimpleValueFactory();
+        CndImporter.registerNodeTypes(reader, systemId, ntManager, this, valueFactory, false);
+        registeredCndSystemIds.add(systemId);
     }
 
     @Override
     public void registerNamespace(String prefix, String uri)
             throws RepositoryException {
-        String oldUri = prefixUriMapping.putIfAbsent(prefix, uri);
-        if (oldUri != null && !oldUri.equals(uri)) {
-            throw new RepositoryException("Prefix " + prefix + " already used for another uri!");
-        }
+        ntManagerProvider.registerNamespace(prefix, uri);
     }
 
     @Override
     public void unregisterNamespace(String prefix)
             throws RepositoryException {
-        throw new UnsupportedOperationException("Unregistering namespaces is unsupported");
+        ntManagerProvider.unregisterNamespace(prefix);
     }
 
     @Override
     public String[] getPrefixes() throws RepositoryException {
-        return prefixUriMapping.keySet().toArray(new String[0]);
+        String[] stringArray = getPrefixStringArray();
+        return ntManagerProvider.getRegisteredNamespaces().keySet().toArray(stringArray);
     }
 
     @Override
     public String[] getURIs() throws RepositoryException {
-        return prefixUriMapping.values().toArray(new String[0]);
+        String[] stringArray = getPrefixStringArray();
+        return ntManagerProvider.getRegisteredNamespaces().values().toArray(stringArray);
     }
 
     @Override
     public String getURI(String prefix) throws NamespaceException {
-        String uri = prefixUriMapping.get(prefix);
-        if (uri == null) {
-            throw new NamespaceException("No registered URI found for prefix " + prefix);
+        try {
+            return ntManagerProvider.getURI(prefix);
+        } catch (RepositoryException e) {
+            throw new NamespaceException(e);
         }
-        return uri;
     }
 
     @Override
     public String getPrefix(String uri) throws NamespaceException {
-        throw new UnsupportedOperationException("This lookup direction is unsupported");
+        try {
+            return ntManagerProvider.getPrefix(uri);
+        } catch (RepositoryException e) {
+            throw new NamespaceException(e);
+        }
     }
 
     public @NotNull Collection<String> getRegisteredCndSystemIds() {
         return registeredCndSystemIds;
     }
+
+    @NotNull
+    private String[] getPrefixStringArray() throws RepositoryException {
+        return new String[ntManagerProvider.getRegisteredNamespaces().size()];
+    }
 }
diff --git a/src/test/java/org/apache/sling/feature/cpconverter/ContentPackage2FeatureModelConverterTest.java b/src/test/java/org/apache/sling/feature/cpconverter/ContentPackage2FeatureModelConverterTest.java
index b573b07..a16c332 100644
--- a/src/test/java/org/apache/sling/feature/cpconverter/ContentPackage2FeatureModelConverterTest.java
+++ b/src/test/java/org/apache/sling/feature/cpconverter/ContentPackage2FeatureModelConverterTest.java
@@ -146,7 +146,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         try {
 
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .convert(packageFile);
@@ -226,7 +226,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         try {
 
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .setContentTypePackagePolicy(PackagePolicy.DROP)
@@ -296,7 +296,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         try {
 
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .setContentTypePackagePolicy(PackagePolicy.PUT_IN_DEDICATED_FOLDER)
@@ -377,7 +377,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
 
         try {
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .setRemoveInstallHooks(true)
@@ -405,7 +405,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
 
         try {
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .convert(packageFile);
@@ -432,7 +432,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
         File outDir = Files.createTempDirectory(getClass().getSimpleName()).toFile();
 
         try {
-            DefaultFeaturesManager fm = new DefaultFeaturesManager(true, 5, outDir, null, null, null, new DefaultAclManager());
+            DefaultFeaturesManager fm = new DefaultFeaturesManager(true, 5, outDir, null, null, new HashMap<>(), new DefaultAclManager());
             fm.setAPIRegions(Arrays.asList("global", "foo.bar"));
             converter.setFeaturesManager(fm)
                      .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outDir))
@@ -479,7 +479,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
                     .setEntryHandlersManager(handlersManager)
                     .setAclManager(aclManager);
 
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, aclManager))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), aclManager))
                     .setBundlesDeployer(new SimpleFolderArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .convert(packageFile);
@@ -502,7 +502,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         try {
 
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .convert(packageFile);
@@ -524,7 +524,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         try {
 
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .convert(packageFile);
@@ -557,7 +557,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
             File packageFile = FileUtils.toFile(packageUrl);
     
             converter.setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
-                     .setFeaturesManager(new DefaultFeaturesManager(DefaultFeaturesManager.ConfigurationHandling.STRICT, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+                     .setFeaturesManager(new DefaultFeaturesManager(DefaultFeaturesManager.ConfigurationHandling.STRICT, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                      .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                      .convert(packageFile);
     
@@ -578,7 +578,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
             File packageFile = FileUtils.toFile(packageUrl);
     
             converter.setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
-                     .setFeaturesManager(new DefaultFeaturesManager(false, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+                     .setFeaturesManager(new DefaultFeaturesManager(false, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                      .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                      .convert(packageFile);
     
@@ -602,7 +602,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
             File packageFile = FileUtils.toFile(packageUrl);
     
             converter.setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
-                     .setFeaturesManager(new DefaultFeaturesManager(false, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+                     .setFeaturesManager(new DefaultFeaturesManager(false, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                      .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                      .convert(packageFile);
     
@@ -627,7 +627,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         try {
             converter.setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outDir))
-            .setFeaturesManager(new DefaultFeaturesManager(false, 5, outDir, null, null, null, new DefaultAclManager())
+            .setFeaturesManager(new DefaultFeaturesManager(false, 5, outDir, null, null, new HashMap<>(), new DefaultAclManager())
                     .setAPIRegions(Collections.singletonList("a.b.c")))
             .setEmitter(DefaultPackagesEventsEmitter.open(outDir))
             .convert(cpFile);
@@ -668,7 +668,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
         try {
 
             String overrideId = "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0:${project.version}";
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, overrideId, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, overrideId, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .convert(packageFile);
@@ -741,7 +741,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         try {
 
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .convert(contentPackages[0]);
@@ -786,7 +786,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
         try {
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setContentTypePackagePolicy(PackagePolicy.DROP)
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
@@ -821,7 +821,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
         try {
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setContentTypePackagePolicy(PackagePolicy.DROP)
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
@@ -858,7 +858,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
 
         File unrefOutputDir = new File(outputDirectory, "unref");
 
-        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                 .setUnreferencedArtifactsDeployer(new LocalMavenRepositoryArtifactsDeployer(unrefOutputDir))
                 .setContentTypePackagePolicy(PackagePolicy.PUT_IN_DEDICATED_FOLDER)
                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
@@ -878,7 +878,7 @@ public class ContentPackage2FeatureModelConverterTest extends AbstractConverterT
         File[] contentPackages = load("test_generated_package.zip");
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
         try {
-            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null, new DefaultAclManager()))
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, new HashMap<>(), new DefaultAclManager()))
                     .setBundlesDeployer(new LocalMavenRepositoryArtifactsDeployer(outputDirectory))
                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
                     .convert(contentPackages);
diff --git a/src/test/java/org/apache/sling/feature/cpconverter/handlers/BundleEntryHandleSlingInitialContentTest.java b/src/test/java/org/apache/sling/feature/cpconverter/handlers/BundleEntryHandleSlingInitialContentTest.java
index ae0068e..0a124be 100644
--- a/src/test/java/org/apache/sling/feature/cpconverter/handlers/BundleEntryHandleSlingInitialContentTest.java
+++ b/src/test/java/org/apache/sling/feature/cpconverter/handlers/BundleEntryHandleSlingInitialContentTest.java
@@ -107,6 +107,55 @@ public class BundleEntryHandleSlingInitialContentTest extends AbstractBundleEntr
         Mockito.verify(featuresManager).addArtifact(null, ArtifactId.fromMvnId("io.wcm:io.wcm.handler.media:1.11.6-cp2fm-converted"), null);
     }
 
+
+    @Test
+    public void testSlingInitialContentWithNodeType() throws Exception {
+        setUpArchive("/jcr_root/apps/mysite/install/mysite-slinginitialcontent-nodetype-def.jar", "mysite-slinginitialcontent-nodetype-def.jar");
+        DefaultEntryHandlersManager handlersManager = new DefaultEntryHandlersManager();
+        converter.setEntryHandlersManager(handlersManager);
+        Map<String, String> namespaceRegistry = Collections.singletonMap("granite", "http://www.adobe.com/jcr/granite/1.0");
+        when(featuresManager.getNamespaceUriByPrefix()).thenReturn(namespaceRegistry);
+
+        File targetFolder = tmpFolder.newFolder();
+        when(converter.getArtifactsDeployer()).thenReturn(new SimpleFolderArtifactsDeployer(targetFolder));
+        when(converter.isSubContentPackageIncluded("/jcr_root/apps/mysite/install/mysite-slinginitialcontent-nodetype-def.jar-APPLICATION")).thenReturn(true);
+
+        VaultPackageAssembler assembler = Mockito.mock(VaultPackageAssembler.class);
+        Properties props = new Properties();
+        props.setProperty(PackageProperties.NAME_GROUP, "com.mysite");
+        props.setProperty(PackageProperties.NAME_NAME, "mysite.core");
+        props.setProperty(PackageProperties.NAME_VERSION, "1.0.0-SNAPSHOT");
+        when(assembler.getPackageProperties()).thenReturn(props);
+        converter.setMainPackageAssembler(assembler);
+
+        handler.setSlingInitialContentPolicy(SlingInitialContentPolicy.EXTRACT_AND_REMOVE);
+        handler.handle("/jcr_root/apps/mysite/install/mysite-slinginitialcontent-nodetype-def.jar", archive, entry, converter);
+
+        converter.deployPackages();
+        // verify generated bundle
+        try (JarFile jarFile = new JarFile(new File(targetFolder, "mysite.core-1.0.0-SNAPSHOT-cp2fm-converted.jar"))) {
+            String bundleVersion = jarFile.getManifest().getMainAttributes().getValue(Constants.BUNDLE_VERSION);
+            assertNotNull(bundleVersion);
+            assertNull(jarFile.getManifest().getMainAttributes().getValue("Sling-Initial-Content"));
+            assertEquals("SNAPSHOT_cp2fm-converted", Version.parseVersion(bundleVersion).getQualifier());
+            // make sure the initial content is no longer contained
+            assertNull(jarFile.getEntry("SLING-INF/app-root/"));
+        }
+        // verify generated package
+        try (VaultPackage vaultPackage = new PackageManagerImpl().open(new File(targetFolder, "mysite.core-apps-1.0.0-SNAPSHOT-cp2fm-converted.zip")); 
+            Archive archive = vaultPackage.getArchive()) {
+            archive.open(true);
+            PackageId targetId = PackageId.fromString("com.mysite:mysite.core-apps:1.0.0-SNAPSHOT-cp2fm-converted");
+            assertEquals(targetId, vaultPackage.getId());
+            Entry entry = archive.getEntry("jcr_root/apps/myinitialcontentest/my-first-node.xml");
+            assertNotNull("Archive does not contain expected item", entry);
+        }
+        // verify nothing else has been deployed
+        assertEquals(2, targetFolder.list().length);
+        // verify changed id
+        Mockito.verify(featuresManager).addArtifact(null, ArtifactId.fromMvnId("com.mysite:mysite.core:1.0.0-SNAPSHOT-cp2fm-converted"), null);
+    }
+
     @Test
     public void testSlingInitialContentContainingConfigurationExtractAndRemove() throws Exception {
         setUpArchive("/jcr_root/apps/gav/install/composum-nodes-config-2.5.3.jar", "composum-nodes-config-2.5.3.jar");
diff --git a/src/test/resources/org/apache/sling/feature/cpconverter/handlers/mysite-slinginitialcontent-nodetype-def.jar b/src/test/resources/org/apache/sling/feature/cpconverter/handlers/mysite-slinginitialcontent-nodetype-def.jar
new file mode 100644
index 0000000..346f26f
Binary files /dev/null and b/src/test/resources/org/apache/sling/feature/cpconverter/handlers/mysite-slinginitialcontent-nodetype-def.jar differ
