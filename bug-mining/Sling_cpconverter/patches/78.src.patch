diff --git a/src/main/java/org/apache/sling/feature/cpconverter/features/DefaultFeaturesManager.java b/src/main/java/org/apache/sling/feature/cpconverter/features/DefaultFeaturesManager.java
index ab4ea25..4d6f4f2 100644
--- a/src/main/java/org/apache/sling/feature/cpconverter/features/DefaultFeaturesManager.java
+++ b/src/main/java/org/apache/sling/feature/cpconverter/features/DefaultFeaturesManager.java
@@ -55,6 +55,12 @@ import org.slf4j.LoggerFactory;
 
 public class DefaultFeaturesManager implements FeaturesManager {
 
+    public enum ConfigurationHandling {
+        ORDERED,
+        MERGE,
+        STRICT
+    };
+
     private static final String CONTENT_PACKAGES = "content-packages";
 
     private static final String SLING_OSGI_FEATURE_TILE_TYPE = "slingosgifeature";
@@ -67,7 +73,7 @@ public class DefaultFeaturesManager implements FeaturesManager {
 
     private final VariablesInterpolator interpolator = new SimpleVariablesInterpolator();
 
-    private final boolean mergeConfigurations;
+    private final ConfigurationHandling configurationHandling;
 
     private final int bundlesStartOrder;
 
@@ -83,9 +89,11 @@ public class DefaultFeaturesManager implements FeaturesManager {
 
     private final List<String> targetAPIRegions = new ArrayList<>();
 
-    private String exportsToAPIRegion = null;
+    private String exportsToAPIRegion;
+
+    private Feature targetFeature;
 
-    private Feature targetFeature = null;
+    private final Map<String, String> pidToPathMapping = new HashMap<>();
 
     DefaultFeaturesManager() {
         this(new File(""));
@@ -101,7 +109,17 @@ public class DefaultFeaturesManager implements FeaturesManager {
                                   @Nullable String artifactIdOverride,
                                   @Nullable String prefix,
                                   @NotNull Map<String, String> properties) {
-        this.mergeConfigurations = mergeConfigurations;
+        this(mergeConfigurations ? ConfigurationHandling.MERGE : ConfigurationHandling.ORDERED, bundlesStartOrder, featureModelsOutputDirectory,
+                artifactIdOverride, prefix, properties);
+    }
+
+    public DefaultFeaturesManager(@NotNull ConfigurationHandling configurationHandling,
+                                    int bundlesStartOrder,
+                                    @NotNull File featureModelsOutputDirectory,
+                                    @Nullable String artifactIdOverride,
+                                    @Nullable String prefix,
+                                    @NotNull Map<String, String> properties) {
+        this.configurationHandling = configurationHandling;
         this.bundlesStartOrder = bundlesStartOrder;
         this.featureModelsOutputDirectory = featureModelsOutputDirectory;
         this.artifactIdOverride = artifactIdOverride;
@@ -202,19 +220,34 @@ public class DefaultFeaturesManager implements FeaturesManager {
     }
 
     @Override
-    public void addConfiguration(@Nullable String runMode, @NotNull String pid, @Nullable Dictionary<String, Object> configurationProperties) {
+    public void addConfiguration(@Nullable String runMode, 
+        @NotNull String pid, 
+        @NotNull String path,
+        @Nullable Dictionary<String, Object> configurationProperties) {
         Feature feature = getRunMode(runMode);
         Configuration configuration = feature.getConfigurations().getConfiguration(pid);
 
         if (configuration == null) {
             configuration = new Configuration(pid);
             feature.getConfigurations().add(configuration);
-        } else if (!mergeConfigurations) {
-            throw new IllegalStateException("Configuration '"
-                                            + pid
-                                            + "' already defined in Feature Model '"
-                                            + feature.getId().toMvnId()
-                                            + "', set the 'mergeConfigurations' flag to 'true' if you want to merge multiple configurations with same PID");
+        } else {
+            switch ( this.configurationHandling ) {
+                case STRICT : throw new IllegalStateException("Configuration '"
+                               + pid
+                               + "' already defined in Feature Model '"
+                               + feature.getId().toMvnId()
+                               + "', set the 'mergeConfigurations' flag to 'true' if you want to merge multiple configurations with same PID");
+                case ORDERED : final String oldPath = this.pidToPathMapping.get(pid);
+                               if ( oldPath == null || oldPath.compareTo(path) > 0 ) {
+                                   this.pidToPathMapping.put(pid, path);
+                                   feature.getConfigurations().remove(configuration);
+                                   configuration = new Configuration(pid);
+                                   feature.getConfigurations().add(configuration);                       
+                               } else {
+                                   return;
+                               }
+                case MERGE : // nothing to do
+            }
         }
 
         Enumeration<String> keys = configurationProperties.keys();
diff --git a/src/main/java/org/apache/sling/feature/cpconverter/features/FeaturesManager.java b/src/main/java/org/apache/sling/feature/cpconverter/features/FeaturesManager.java
index c771cdb..8392599 100644
--- a/src/main/java/org/apache/sling/feature/cpconverter/features/FeaturesManager.java
+++ b/src/main/java/org/apache/sling/feature/cpconverter/features/FeaturesManager.java
@@ -37,7 +37,10 @@ public interface FeaturesManager {
 
     void addAPIRegionExport(@Nullable String runMode, @NotNull String exportedPackage);
 
-    void addConfiguration(@Nullable String runMode, @NotNull String pid, @Nullable Dictionary<String, Object> configurationProperties);
+    void addConfiguration(@Nullable String runMode, 
+        @NotNull String pid,
+        @NotNull String path,
+        @Nullable Dictionary<String, Object> configurationProperties);
 
     void serialize() throws Exception;
 
diff --git a/src/main/java/org/apache/sling/feature/cpconverter/handlers/AbstractConfigurationEntryHandler.java b/src/main/java/org/apache/sling/feature/cpconverter/handlers/AbstractConfigurationEntryHandler.java
index 4ade6d8..29f7eaf 100644
--- a/src/main/java/org/apache/sling/feature/cpconverter/handlers/AbstractConfigurationEntryHandler.java
+++ b/src/main/java/org/apache/sling/feature/cpconverter/handlers/AbstractConfigurationEntryHandler.java
@@ -107,9 +107,9 @@ abstract class AbstractConfigurationEntryHandler extends AbstractRegexEntryHandl
                         aclManager.addMapping(new Mapping(usermapping));
                     }
                 }
-                featuresManager.addConfiguration(runMode, id, configurationProperties);
+                featuresManager.addConfiguration(runMode, id, path, configurationProperties);
             } else {
-                featuresManager.addConfiguration(runMode, id, configurationProperties);
+                featuresManager.addConfiguration(runMode, id, path, configurationProperties);
             }
         } else {
             throw new IllegalStateException("Something went terribly wrong: pattern '"
diff --git a/src/main/java/org/apache/sling/feature/cpconverter/vltpkg/VaultPackageAssembler.java b/src/main/java/org/apache/sling/feature/cpconverter/vltpkg/VaultPackageAssembler.java
index 6c0c22b..90d6457 100644
--- a/src/main/java/org/apache/sling/feature/cpconverter/vltpkg/VaultPackageAssembler.java
+++ b/src/main/java/org/apache/sling/feature/cpconverter/vltpkg/VaultPackageAssembler.java
@@ -72,7 +72,7 @@ public class VaultPackageAssembler implements EntryHandler, FileFilter {
     public static @NotNull VaultPackageAssembler create(@NotNull VaultPackage vaultPackage) {
         return create(vaultPackage, Objects.requireNonNull(vaultPackage.getMetaInf().getFilter()));
     }
-
+/*
     public static @NotNull File createSynthetic(@NotNull VaultPackage vaultPackage) throws Exception {
         DefaultWorkspaceFilter filter = new DefaultWorkspaceFilter();
         PathFilterSet filterSet = new PathFilterSet();
@@ -82,7 +82,7 @@ public class VaultPackageAssembler implements EntryHandler, FileFilter {
         filter.add(filterSet);
         return create(vaultPackage, filter).createPackage();
     }
-
+*/
     private static @NotNull VaultPackageAssembler create(@NotNull VaultPackage vaultPackage, @NotNull WorkspaceFilter filter) {
         PackageId packageId = vaultPackage.getId();
         String fileName = packageId.toString().replaceAll("/", "-").replaceAll(":", "-") + "-" + vaultPackage.getFile().getName();
diff --git a/src/test/java/org/apache/sling/feature/cpconverter/ContentPackage2FeatureModelConverterTest.java b/src/test/java/org/apache/sling/feature/cpconverter/ContentPackage2FeatureModelConverterTest.java
index e3e3d45..1cfa29d 100644
--- a/src/test/java/org/apache/sling/feature/cpconverter/ContentPackage2FeatureModelConverterTest.java
+++ b/src/test/java/org/apache/sling/feature/cpconverter/ContentPackage2FeatureModelConverterTest.java
@@ -55,6 +55,7 @@ import org.apache.jackrabbit.vault.packaging.VaultPackage;
 import org.apache.jackrabbit.vault.packaging.impl.PackageManagerImpl;
 import org.apache.sling.feature.ArtifactId;
 import org.apache.sling.feature.Artifacts;
+import org.apache.sling.feature.Configuration;
 import org.apache.sling.feature.Extension;
 import org.apache.sling.feature.ExtensionType;
 import org.apache.sling.feature.Feature;
@@ -141,84 +142,89 @@ public class ContentPackage2FeatureModelConverterTest {
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
 
-        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
-                 .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
-                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
-                 .convert(packageFile);
-
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all.json",
-                          "asd.sample:asd.retail.all:slingosgifeature:0.0.1",
-                          Arrays.asList("org.apache.felix:org.apache.felix.framework:6.0.1"),
-                          Arrays.asList("org.apache.sling.commons.log.LogManager.factory.config~asd-retail"),
-                          Arrays.asList("asd.sample:asd.retail.apps:zip:cp2fm-converted:0.0.1",
-                                        "asd.sample:Asd.Retail.ui.content:zip:cp2fm-converted:0.0.1",
-                                        "asd:Asd.Retail.config:zip:cp2fm-converted:0.0.1",
-                                        "asd.sample:asd.retail.all:zip:cp2fm-converted:0.0.1"));
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all-author.json",
-                          "asd.sample:asd.retail.all:slingosgifeature:author:0.0.1",
-                          Arrays.asList("org.apache.sling:org.apache.sling.api:2.20.0"),
-                          Collections.emptyList(),
-                          Collections.emptyList());
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all-publish.json",
-                          "asd.sample:asd.retail.all:slingosgifeature:publish:0.0.1",
-                          Arrays.asList("org.apache.sling:org.apache.sling.models.api:1.3.8"),
-                          Arrays.asList("org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended~asd-retail"),
-                          Collections.emptyList());
-
-        // verify the runmode.mapper integrity
-        File runmodeMapperFile = new File(outputDirectory, "runmode.mapping");
-        assertTrue(runmodeMapperFile.exists());
-        assertTrue(runmodeMapperFile.isFile());
-        Properties runModes = new Properties();
-        try (FileInputStream input = new FileInputStream(runmodeMapperFile)) {
-            runModes.load(input);
+        try {
+
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
+                    .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                    .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                    .convert(packageFile);
+
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all.json",
+                            "asd.sample:asd.retail.all:slingosgifeature:0.0.1",
+                            Arrays.asList("org.apache.felix:org.apache.felix.framework:6.0.1"),
+                            Arrays.asList("org.apache.sling.commons.log.LogManager.factory.config~asd-retail"),
+                            Arrays.asList("asd.sample:asd.retail.apps:zip:cp2fm-converted:0.0.1",
+                                            "asd.sample:Asd.Retail.ui.content:zip:cp2fm-converted:0.0.1",
+                                            "asd:Asd.Retail.config:zip:cp2fm-converted:0.0.1",
+                                            "asd.sample:asd.retail.all:zip:cp2fm-converted:0.0.1"));
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all-author.json",
+                            "asd.sample:asd.retail.all:slingosgifeature:author:0.0.1",
+                            Arrays.asList("org.apache.sling:org.apache.sling.api:2.20.0"),
+                            Collections.emptyList(),
+                            Collections.emptyList());
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all-publish.json",
+                            "asd.sample:asd.retail.all:slingosgifeature:publish:0.0.1",
+                            Arrays.asList("org.apache.sling:org.apache.sling.models.api:1.3.8"),
+                            Arrays.asList("org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended~asd-retail"),
+                            Collections.emptyList());
+
+            // verify the runmode.mapper integrity
+            File runmodeMapperFile = new File(outputDirectory, "runmode.mapping");
+            assertTrue(runmodeMapperFile.exists());
+            assertTrue(runmodeMapperFile.isFile());
+            Properties runModes = new Properties();
+            try (FileInputStream input = new FileInputStream(runmodeMapperFile)) {
+                runModes.load(input);
+            }
+            assertFalse(runModes.isEmpty());
+            assertTrue(runModes.containsKey("(default)"));
+            assertEquals("asd.retail.all.json", runModes.getProperty("(default)"));
+            assertEquals("asd.retail.all-author.json", runModes.getProperty("author"));
+            assertEquals("asd.retail.all-publish.json", runModes.getProperty("publish"));
+
+            verifyContentPackage(new File(outputDirectory, "asd/Asd.Retail.config/0.0.1/Asd.Retail.config-0.0.1-cp2fm-converted.zip"),
+                                "META-INF/vault/settings.xml",
+                                "META-INF/vault/properties.xml",
+                                "META-INF/vault/config.xml",
+                                "META-INF/vault/filter.xml",
+                                "jcr_root/settings.xml",
+                                "jcr_root/config.xml",
+                                "jcr_root/definition/.content.xml",
+                                "jcr_root/apps/.content.xml");
+            verifyContentPackage(new File(outputDirectory, "asd/sample/Asd.Retail.ui.content/0.0.1/Asd.Retail.ui.content-0.0.1-cp2fm-converted.zip"),
+                                "META-INF/vault/settings.xml",
+                                "META-INF/vault/properties.xml",
+                                "META-INF/vault/config.xml",
+                                "META-INF/vault/filter.xml",
+                                "META-INF/vault/filter-plugin-generated.xml",
+                                "jcr_root/settings.xml",
+                                "jcr_root/content/asd/.content.xml",
+                                "jcr_root/content/asd/resources.xml",
+                                "jcr_root/config.xml",
+                                "jcr_root/definition/.content.xml");
+            verifyContentPackage(new File(outputDirectory, "asd/sample/asd.retail.apps/0.0.1/asd.retail.apps-0.0.1-cp2fm-converted.zip"),
+                                "META-INF/vault/settings.xml",
+                                "META-INF/vault/properties.xml",
+                                "META-INF/vault/config.xml",
+                                "META-INF/vault/filter.xml",
+                                "META-INF/vault/filter-plugin-generated.xml",
+                                "jcr_root/settings.xml",
+                                "jcr_root/config.xml",
+                                "jcr_root/definition/.content.xml");
+            verifyContentPackage(new File(outputDirectory, "asd/sample/asd.retail.all/0.0.1/asd.retail.all-0.0.1-cp2fm-converted.zip"),
+                                "META-INF/vault/settings.xml",
+                                "META-INF/vault/properties.xml",
+                                "META-INF/vault/config.xml",
+                                "META-INF/vault/filter.xml",
+                                "jcr_root/settings.xml",
+                                "jcr_root/config.xml",
+                                "jcr_root/definition/.content.xml");
+        } finally {
+            deleteDirTree(outputDirectory);
         }
-        assertFalse(runModes.isEmpty());
-        assertTrue(runModes.containsKey("(default)"));
-        assertEquals("asd.retail.all.json", runModes.getProperty("(default)"));
-        assertEquals("asd.retail.all-author.json", runModes.getProperty("author"));
-        assertEquals("asd.retail.all-publish.json", runModes.getProperty("publish"));
-
-        verifyContentPackage(new File(outputDirectory, "asd/Asd.Retail.config/0.0.1/Asd.Retail.config-0.0.1-cp2fm-converted.zip"),
-                             "META-INF/vault/settings.xml",
-                             "META-INF/vault/properties.xml",
-                             "META-INF/vault/config.xml",
-                             "META-INF/vault/filter.xml",
-                             "jcr_root/settings.xml",
-                             "jcr_root/config.xml",
-                             "jcr_root/definition/.content.xml",
-                             "jcr_root/apps/.content.xml");
-        verifyContentPackage(new File(outputDirectory, "asd/sample/Asd.Retail.ui.content/0.0.1/Asd.Retail.ui.content-0.0.1-cp2fm-converted.zip"),
-                             "META-INF/vault/settings.xml",
-                             "META-INF/vault/properties.xml",
-                             "META-INF/vault/config.xml",
-                             "META-INF/vault/filter.xml",
-                             "META-INF/vault/filter-plugin-generated.xml",
-                             "jcr_root/settings.xml",
-                             "jcr_root/content/asd/.content.xml",
-                             "jcr_root/content/asd/resources.xml",
-                             "jcr_root/config.xml",
-                             "jcr_root/definition/.content.xml");
-        verifyContentPackage(new File(outputDirectory, "asd/sample/asd.retail.apps/0.0.1/asd.retail.apps-0.0.1-cp2fm-converted.zip"),
-                             "META-INF/vault/settings.xml",
-                             "META-INF/vault/properties.xml",
-                             "META-INF/vault/config.xml",
-                             "META-INF/vault/filter.xml",
-                             "META-INF/vault/filter-plugin-generated.xml",
-                             "jcr_root/settings.xml",
-                             "jcr_root/config.xml",
-                             "jcr_root/definition/.content.xml");
-        verifyContentPackage(new File(outputDirectory, "asd/sample/asd.retail.all/0.0.1/asd.retail.all-0.0.1-cp2fm-converted.zip"),
-                             "META-INF/vault/settings.xml",
-                             "META-INF/vault/properties.xml",
-                             "META-INF/vault/config.xml",
-                             "META-INF/vault/filter.xml",
-                             "jcr_root/settings.xml",
-                             "jcr_root/config.xml",
-                             "jcr_root/definition/.content.xml");
     }
 
     @Test
@@ -228,67 +234,73 @@ public class ContentPackage2FeatureModelConverterTest {
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
 
-        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
-                 .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
-                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
-                 .setDropContent(true)
-                 .convert(packageFile);
-
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all.json",
-                          "asd.sample:asd.retail.all:slingosgifeature:0.0.1",
-                          Arrays.asList("org.apache.felix:org.apache.felix.framework:6.0.1"),
-                          Arrays.asList("org.apache.sling.commons.log.LogManager.factory.config~asd-retail"),
-                          Arrays.asList("asd.sample:asd.retail.apps:zip:cp2fm-converted:0.0.1",
-                                        "asd:Asd.Retail.config:zip:cp2fm-converted:0.0.1"));
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all-author.json",
-                          "asd.sample:asd.retail.all:slingosgifeature:author:0.0.1",
-                          Arrays.asList("org.apache.sling:org.apache.sling.api:2.20.0"),
-                          Collections.emptyList(),
-                          Collections.emptyList());
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all-publish.json",
-                          "asd.sample:asd.retail.all:slingosgifeature:publish:0.0.1",
-                          Arrays.asList("org.apache.sling:org.apache.sling.models.api:1.3.8"),
-                          Arrays.asList("org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended~asd-retail"),
-                          Collections.emptyList());
-
-        // verify the runmode.mapper integrity
-        File runmodeMapperFile = new File(outputDirectory, "runmode.mapping");
-        assertTrue(runmodeMapperFile.exists());
-        assertTrue(runmodeMapperFile.isFile());
-        Properties runModes = new Properties();
-        try (FileInputStream input = new FileInputStream(runmodeMapperFile)) {
-            runModes.load(input);
+        try {
+
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
+                    .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                    .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                    .setDropContent(true)
+                    .convert(packageFile);
+
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all.json",
+                            "asd.sample:asd.retail.all:slingosgifeature:0.0.1",
+                            Arrays.asList("org.apache.felix:org.apache.felix.framework:6.0.1"),
+                            Arrays.asList("org.apache.sling.commons.log.LogManager.factory.config~asd-retail"),
+                            Arrays.asList("asd.sample:asd.retail.apps:zip:cp2fm-converted:0.0.1",
+                                            "asd:Asd.Retail.config:zip:cp2fm-converted:0.0.1"));
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all-author.json",
+                            "asd.sample:asd.retail.all:slingosgifeature:author:0.0.1",
+                            Arrays.asList("org.apache.sling:org.apache.sling.api:2.20.0"),
+                            Collections.emptyList(),
+                            Collections.emptyList());
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all-publish.json",
+                            "asd.sample:asd.retail.all:slingosgifeature:publish:0.0.1",
+                            Arrays.asList("org.apache.sling:org.apache.sling.models.api:1.3.8"),
+                            Arrays.asList("org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended~asd-retail"),
+                            Collections.emptyList());
+
+            // verify the runmode.mapper integrity
+            File runmodeMapperFile = new File(outputDirectory, "runmode.mapping");
+            assertTrue(runmodeMapperFile.exists());
+            assertTrue(runmodeMapperFile.isFile());
+            Properties runModes = new Properties();
+            try (FileInputStream input = new FileInputStream(runmodeMapperFile)) {
+                runModes.load(input);
+            }
+            assertFalse(runModes.isEmpty());
+            assertTrue(runModes.containsKey("(default)"));
+            assertEquals("asd.retail.all.json", runModes.getProperty("(default)"));
+            assertEquals("asd.retail.all-author.json", runModes.getProperty("author"));
+            assertEquals("asd.retail.all-publish.json", runModes.getProperty("publish"));
+
+            verifyContentPackage(new File(outputDirectory, "asd/Asd.Retail.config/0.0.1/Asd.Retail.config-0.0.1-cp2fm-converted.zip"),
+                                "META-INF/vault/settings.xml",
+                                "META-INF/vault/properties.xml",
+                                "META-INF/vault/config.xml",
+                                "META-INF/vault/filter.xml",
+                                "jcr_root/settings.xml",
+                                "jcr_root/config.xml",
+                                "jcr_root/definition/.content.xml",
+                                "jcr_root/apps/.content.xml");
+            verifyContentPackage(new File(outputDirectory, "asd/sample/asd.retail.apps/0.0.1/asd.retail.apps-0.0.1-cp2fm-converted.zip"),
+                                "META-INF/vault/settings.xml",
+                                "META-INF/vault/properties.xml",
+                                "META-INF/vault/config.xml",
+                                "META-INF/vault/filter.xml",
+                                "META-INF/vault/filter-plugin-generated.xml",
+                                "jcr_root/settings.xml",
+                                "jcr_root/config.xml",
+                                "jcr_root/definition/.content.xml");
+            // in contrast to previous test when dropping content packages the cases below would be filtered out and files wouldn'T be in cache
+            assertFalse(new File(outputDirectory, "asd/sample/Asd.Retail.ui.content/0.0.1/Asd.Retail.ui.content-0.0.1-cp2fm-converted.zip").exists());
+            assertFalse(new File(outputDirectory, "asd/sample/asd.retail.all/0.0.1/asd.retail.all-0.0.1-cp2fm-converted.zip").exists());
+
+        } finally {
+            deleteDirTree(outputDirectory);
         }
-        assertFalse(runModes.isEmpty());
-        assertTrue(runModes.containsKey("(default)"));
-        assertEquals("asd.retail.all.json", runModes.getProperty("(default)"));
-        assertEquals("asd.retail.all-author.json", runModes.getProperty("author"));
-        assertEquals("asd.retail.all-publish.json", runModes.getProperty("publish"));
-
-        verifyContentPackage(new File(outputDirectory, "asd/Asd.Retail.config/0.0.1/Asd.Retail.config-0.0.1-cp2fm-converted.zip"),
-                             "META-INF/vault/settings.xml",
-                             "META-INF/vault/properties.xml",
-                             "META-INF/vault/config.xml",
-                             "META-INF/vault/filter.xml",
-                             "jcr_root/settings.xml",
-                             "jcr_root/config.xml",
-                             "jcr_root/definition/.content.xml",
-                             "jcr_root/apps/.content.xml");
-        verifyContentPackage(new File(outputDirectory, "asd/sample/asd.retail.apps/0.0.1/asd.retail.apps-0.0.1-cp2fm-converted.zip"),
-                             "META-INF/vault/settings.xml",
-                             "META-INF/vault/properties.xml",
-                             "META-INF/vault/config.xml",
-                             "META-INF/vault/filter.xml",
-                             "META-INF/vault/filter-plugin-generated.xml",
-                             "jcr_root/settings.xml",
-                             "jcr_root/config.xml",
-                             "jcr_root/definition/.content.xml");
-        // in contrast to previous test when dropping content packages the cases below would be filtered out and files wouldn'T be in cache
-        assertFalse(new File(outputDirectory, "asd/sample/Asd.Retail.ui.content/0.0.1/Asd.Retail.ui.content-0.0.1-cp2fm-converted.zip").exists());
-        assertFalse(new File(outputDirectory, "asd/sample/asd.retail.all/0.0.1/asd.retail.all-0.0.1-cp2fm-converted.zip").exists());
     }
 
     @Test
@@ -427,10 +439,15 @@ public class ContentPackage2FeatureModelConverterTest {
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
 
-        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
-                 .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
-                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
-                 .convert(packageFile);
+        try {
+
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
+                    .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                    .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                    .convert(packageFile);
+        } finally {
+            deleteDirTree(outputDirectory);
+        }
     }
     
     /** app package containing another app package must lead to an explicit dependency from  
@@ -444,17 +461,22 @@ public class ContentPackage2FeatureModelConverterTest {
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
 
-        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
-                 .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
-                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
-                 .convert(packageFile);
-        
-        File contentPackage = new File(outputDirectory, "asd/sample/embedded.test.app/0.0.0/embedded.test.app-0.0.0-cp2fm-converted.zip");
-        VaultPackage vaultPackage = new PackageManagerImpl().open(contentPackage);
-        String dependencies = vaultPackage.getProperties().getProperty(PackageProperties.NAME_DEPENDENCIES);
-        org.apache.jackrabbit.vault.packaging.Dependency dep = org.apache.jackrabbit.vault.packaging.Dependency.fromString(dependencies);
-        PackageId targetId = PackageId.fromString("asd/sample:embedded.package.test:0.0.1-cp2fm-converted");
-        assertTrue(dep.matches(targetId));
+        try {
+
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
+                    .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                    .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                    .convert(packageFile);
+            
+            File contentPackage = new File(outputDirectory, "asd/sample/embedded.test.app/0.0.0/embedded.test.app-0.0.0-cp2fm-converted.zip");
+            VaultPackage vaultPackage = new PackageManagerImpl().open(contentPackage);
+            String dependencies = vaultPackage.getProperties().getProperty(PackageProperties.NAME_DEPENDENCIES);
+            org.apache.jackrabbit.vault.packaging.Dependency dep = org.apache.jackrabbit.vault.packaging.Dependency.fromString(dependencies);
+            PackageId targetId = PackageId.fromString("asd/sample:embedded.package.test:0.0.1-cp2fm-converted");
+            assertTrue(dep.matches(targetId));
+        } finally {
+            deleteDirTree(outputDirectory);
+        }
     }
 
     @Test(expected = IllegalStateException.class)
@@ -469,17 +491,47 @@ public class ContentPackage2FeatureModelConverterTest {
 
     private void addSamePidConfiguration(String runmodeA, String runmodeB) throws Exception {
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
-        URL packageUrl = getClass().getResource("test-content-package.zip");
-        File packageFile = FileUtils.toFile(packageUrl);
-
-        converter.setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
-                 .setFeaturesManager(new DefaultFeaturesManager(false, 5, outputDirectory, null, null, null))
-                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
-                 .convert(packageFile);
+        try {
+            URL packageUrl = getClass().getResource("test-content-package.zip");
+            File packageFile = FileUtils.toFile(packageUrl);
+    
+            converter.setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                     .setFeaturesManager(new DefaultFeaturesManager(DefaultFeaturesManager.ConfigurationHandling.STRICT, 5, outputDirectory, null, null, null))
+                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                     .convert(packageFile);
+    
+            String pid = "this.is.just.a.pid";
+            converter.getFeaturesManager().addConfiguration(runmodeA, pid, "/a", new Hashtable<String, Object>());
+            converter.getFeaturesManager().addConfiguration(runmodeB, pid, "/b", new Hashtable<String, Object>());
+    
+        } finally {
+            deleteDirTree(outputDirectory);
+        }
+    }
 
-        String pid = "this.is.just.a.pid";
-        converter.getFeaturesManager().addConfiguration(runmodeA, pid, new Hashtable<String, Object>());
-        converter.getFeaturesManager().addConfiguration(runmodeB, pid, new Hashtable<String, Object>());
+    @Test
+    public void testSameConfigurationPidDifferentPaths() throws Exception {
+        File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
+        try {
+            URL packageUrl = getClass().getResource("test-content-package.zip");
+            File packageFile = FileUtils.toFile(packageUrl);
+    
+            converter.setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                     .setFeaturesManager(new DefaultFeaturesManager(false, 5, outputDirectory, null, null, null))
+                     .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                     .convert(packageFile);
+    
+            String pid = "this.is.just.a.pid";
+            converter.getFeaturesManager().addConfiguration(null, pid, "/apps/b/config/pid.json", new Hashtable<String, Object>(){{put("foo", "b");}});
+            converter.getFeaturesManager().addConfiguration(null, pid, "/apps/a/config/pid.json", new Hashtable<String, Object>(){{put("foo", "a");}});
+            converter.getFeaturesManager().addConfiguration(null, pid, "/apps/c/config/pid.json", new Hashtable<String, Object>(){{put("foo", "c");}});
+    
+            Configuration c = converter.getFeaturesManager().getTargetFeature().getConfigurations().getConfiguration(pid);
+            assertNotNull(c);
+            assertEquals("a", c.getConfigurationProperties().get("foo"));
+        } finally {
+            deleteDirTree(outputDirectory);
+        }
     }
 
     @Test
@@ -528,39 +580,44 @@ public class ContentPackage2FeatureModelConverterTest {
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
 
-        String overrideId = "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0:${project.version}";
-        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, overrideId, null, null))
-                 .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
-                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
-                 .convert(packageFile);
-
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all.json",
-                          "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0:${project.version}",
-                          Arrays.asList("org.apache.felix:org.apache.felix.framework:6.0.1"),
-                          Arrays.asList("org.apache.sling.commons.log.LogManager.factory.config~asd-retail"),
-                          Arrays.asList("asd.sample:asd.retail.apps:zip:cp2fm-converted:0.0.1",
-                                        "asd.sample:Asd.Retail.ui.content:zip:cp2fm-converted:0.0.1",
-                                        "asd:Asd.Retail.config:zip:cp2fm-converted:0.0.1",
-                                        "asd.sample:asd.retail.all:zip:cp2fm-converted:0.0.1"));
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all-author.json",
-                          "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0-author:${project.version}",
-                          Arrays.asList("org.apache.sling:org.apache.sling.api:2.20.0"),
-                          Collections.emptyList(),
-                          Collections.emptyList());
-        verifyFeatureFile(outputDirectory,
-                          "asd.retail.all-publish.json",
-                          "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0-publish:${project.version}",
-                          Arrays.asList("org.apache.sling:org.apache.sling.models.api:1.3.8"),
-                          Arrays.asList("org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended~asd-retail"),
-                          Collections.emptyList());
-
-        verifyContentPackage(new File(outputDirectory, "asd/sample/asd.retail.all/0.0.1/asd.retail.all-0.0.1-cp2fm-converted.zip"),
-                             "META-INF/vault/properties.xml",
-                             "META-INF/vault/config.xml",
-                             "META-INF/vault/settings.xml",
-                             "META-INF/vault/filter.xml");
+        try {
+
+            String overrideId = "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0:${project.version}";
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, overrideId, null, null))
+                    .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                    .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                    .convert(packageFile);
+
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all.json",
+                            "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0:${project.version}",
+                            Arrays.asList("org.apache.felix:org.apache.felix.framework:6.0.1"),
+                            Arrays.asList("org.apache.sling.commons.log.LogManager.factory.config~asd-retail"),
+                            Arrays.asList("asd.sample:asd.retail.apps:zip:cp2fm-converted:0.0.1",
+                                            "asd.sample:Asd.Retail.ui.content:zip:cp2fm-converted:0.0.1",
+                                            "asd:Asd.Retail.config:zip:cp2fm-converted:0.0.1",
+                                            "asd.sample:asd.retail.all:zip:cp2fm-converted:0.0.1"));
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all-author.json",
+                            "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0-author:${project.version}",
+                            Arrays.asList("org.apache.sling:org.apache.sling.api:2.20.0"),
+                            Collections.emptyList(),
+                            Collections.emptyList());
+            verifyFeatureFile(outputDirectory,
+                            "asd.retail.all-publish.json",
+                            "${project.groupId}:${project.artifactId}:slingosgifeature:asd.test.all-1.0.0-publish:${project.version}",
+                            Arrays.asList("org.apache.sling:org.apache.sling.models.api:1.3.8"),
+                            Arrays.asList("org.apache.sling.serviceusermapping.impl.ServiceUserMapperImpl.amended~asd-retail"),
+                            Collections.emptyList());
+
+            verifyContentPackage(new File(outputDirectory, "asd/sample/asd.retail.all/0.0.1/asd.retail.all-0.0.1-cp2fm-converted.zip"),
+                                "META-INF/vault/properties.xml",
+                                "META-INF/vault/config.xml",
+                                "META-INF/vault/settings.xml",
+                                "META-INF/vault/filter.xml");
+        } finally {
+            deleteDirTree(outputDirectory);
+        }
     }
 
     @Test
@@ -597,36 +654,41 @@ public class ContentPackage2FeatureModelConverterTest {
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
 
-        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
-                 .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
-                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
-                 .convert(contentPackages[0]);
+        try {
 
-        File featureFile = new File(outputDirectory, "test_a.json");
-        try (Reader reader = new FileReader(featureFile)) {
-            Feature feature = FeatureJSONReader.read(reader, featureFile.getAbsolutePath());
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
+                    .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                    .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                    .convert(contentPackages[0]);
+
+            File featureFile = new File(outputDirectory, "test_a.json");
+            try (Reader reader = new FileReader(featureFile)) {
+                Feature feature = FeatureJSONReader.read(reader, featureFile.getAbsolutePath());
 
-            Extension repoinitExtension = feature.getExtensions().getByName("repoinit");
-            assertNotNull(repoinitExtension);
-
-            String expected = "register nodetypes" + System.lineSeparator() +
-                    "<<===" + System.lineSeparator() +
-                    "<< <'sling'='http://sling.apache.org/jcr/sling/1.0'>" + System.lineSeparator() +
-                    "<< <'nt'='http://www.jcp.org/jcr/nt/1.0'>" + System.lineSeparator() +
-                    "<< <'rep'='internal'>" + System.lineSeparator() +
-                    "" + System.lineSeparator() +
-                    "<< [sling:Folder] > nt:folder" + System.lineSeparator() +
-                    "<<   - * (undefined) multiple" + System.lineSeparator() +
-                    "<<   - * (undefined)" + System.lineSeparator() +
-                    "<<   + * (nt:base) = sling:Folder version" + System.lineSeparator() +
-                    System.lineSeparator() +
-                    "<< [rep:RepoAccessControllable]" + System.lineSeparator() +
-                    "<<   mixin" + System.lineSeparator() +
-                    "<<   + rep:repoPolicy (rep:Policy) protected ignore" + System.lineSeparator() +
-                    System.lineSeparator() +
-                    "===>>" + System.lineSeparator();
-            String actual = repoinitExtension.getText();
-            assertEquals(expected, actual);
+                Extension repoinitExtension = feature.getExtensions().getByName("repoinit");
+                assertNotNull(repoinitExtension);
+
+                String expected = "register nodetypes" + System.lineSeparator() +
+                        "<<===" + System.lineSeparator() +
+                        "<< <'sling'='http://sling.apache.org/jcr/sling/1.0'>" + System.lineSeparator() +
+                        "<< <'nt'='http://www.jcp.org/jcr/nt/1.0'>" + System.lineSeparator() +
+                        "<< <'rep'='internal'>" + System.lineSeparator() +
+                        "" + System.lineSeparator() +
+                        "<< [sling:Folder] > nt:folder" + System.lineSeparator() +
+                        "<<   - * (undefined) multiple" + System.lineSeparator() +
+                        "<<   - * (undefined)" + System.lineSeparator() +
+                        "<<   + * (nt:base) = sling:Folder version" + System.lineSeparator() +
+                        System.lineSeparator() +
+                        "<< [rep:RepoAccessControllable]" + System.lineSeparator() +
+                        "<<   mixin" + System.lineSeparator() +
+                        "<<   + rep:repoPolicy (rep:Policy) protected ignore" + System.lineSeparator() +
+                        System.lineSeparator() +
+                        "===>>" + System.lineSeparator();
+                String actual = repoinitExtension.getText();
+                assertEquals(expected, actual);
+            }
+        } finally {
+            deleteDirTree(outputDirectory);
         }
     }
 
@@ -639,25 +701,29 @@ public class ContentPackage2FeatureModelConverterTest {
         // expected output: c <- a
 
         File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
+        try {
 
-        converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
-                 .setDropContent(true)
-                 .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
-                 .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
-                 .convert(contentPackages);
+            converter.setFeaturesManager(new DefaultFeaturesManager(true, 5, outputDirectory, null, null, null))
+                    .setDropContent(true)
+                    .setBundlesDeployer(new DefaultArtifactsDeployer(outputDirectory))
+                    .setEmitter(DefaultPackagesEventsEmitter.open(outputDirectory))
+                    .convert(contentPackages);
 
-        Feature a = getFeature(outputDirectory, "test_a.json");
-        assertNull(a.getExtensions().getByName("content-packages"));
+            Feature a = getFeature(outputDirectory, "test_a.json");
+            assertNull(a.getExtensions().getByName("content-packages"));
 
-        Feature b = getFeature(outputDirectory, "test_b.json");
-        Artifacts artifacts = b.getExtensions().getByName("content-packages").getArtifacts();
-        assertFalse(artifacts.isEmpty());
-        assertEquals("my_packages:test_b:zip:cp2fm-converted:1.0", artifacts.iterator().next().getId().toString());
+            Feature b = getFeature(outputDirectory, "test_b.json");
+            Artifacts artifacts = b.getExtensions().getByName("content-packages").getArtifacts();
+            assertFalse(artifacts.isEmpty());
+            assertEquals("my_packages:test_b:zip:cp2fm-converted:1.0", artifacts.iterator().next().getId().toString());
 
-        File contentPackage = new File(outputDirectory, "my_packages/test_b/1.0/test_b-1.0-cp2fm-converted.zip");
-        VaultPackage vaultPackage = new PackageManagerImpl().open(contentPackage);
-        String dependencies = vaultPackage.getProperties().getProperty(PackageProperties.NAME_DEPENDENCIES);
-        assertEquals("my_packages:test_c", dependencies);
+            File contentPackage = new File(outputDirectory, "my_packages/test_b/1.0/test_b-1.0-cp2fm-converted.zip");
+            VaultPackage vaultPackage = new PackageManagerImpl().open(contentPackage);
+            String dependencies = vaultPackage.getProperties().getProperty(PackageProperties.NAME_DEPENDENCIES);
+            assertEquals("my_packages:test_c", dependencies);
+        } finally {
+            deleteDirTree(outputDirectory);
+        }
     }
 
     private File[] load(String...resources) {
diff --git a/src/test/java/org/apache/sling/feature/cpconverter/artifacts/DefaultBundlesDeployerTest.java b/src/test/java/org/apache/sling/feature/cpconverter/artifacts/DefaultBundlesDeployerTest.java
index 0b9b914..a7505be 100644
--- a/src/test/java/org/apache/sling/feature/cpconverter/artifacts/DefaultBundlesDeployerTest.java
+++ b/src/test/java/org/apache/sling/feature/cpconverter/artifacts/DefaultBundlesDeployerTest.java
@@ -21,10 +21,11 @@ import static org.junit.Assert.*;
 import static org.mockito.Mockito.mock;
 
 import java.io.File;
+import java.io.IOException;
+import java.nio.file.Files;
+import java.nio.file.Path;
+import java.util.Comparator;
 
-import org.apache.sling.feature.cpconverter.artifacts.ArtifactWriter;
-import org.apache.sling.feature.cpconverter.artifacts.ArtifactsDeployer;
-import org.apache.sling.feature.cpconverter.artifacts.DefaultArtifactsDeployer;
 import org.junit.After;
 import org.junit.Before;
 import org.junit.Test;
@@ -33,15 +34,25 @@ public class DefaultBundlesDeployerTest {
 
     private ArtifactsDeployer artifactDeployer;
 
+    private File outputDirectory;
+
     @Before
     public void setUp() {
-        File outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
+        outputDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
         artifactDeployer = new DefaultArtifactsDeployer(outputDirectory);
     }
 
     @After
-    public void tearDown() {
+    public void tearDown() throws IOException {
         artifactDeployer = null;
+        Path tempDir = outputDirectory.toPath();
+    
+        Files.walk(tempDir)
+            .sorted(Comparator.reverseOrder())
+            .map(Path::toFile)
+            .forEach(File::delete);
+
+        outputDirectory = null;
     }
 
     @Test
diff --git a/src/test/java/org/apache/sling/feature/cpconverter/handlers/BundleEntryHandlerTest.java b/src/test/java/org/apache/sling/feature/cpconverter/handlers/BundleEntryHandlerTest.java
index ae2031d..6889155 100644
--- a/src/test/java/org/apache/sling/feature/cpconverter/handlers/BundleEntryHandlerTest.java
+++ b/src/test/java/org/apache/sling/feature/cpconverter/handlers/BundleEntryHandlerTest.java
@@ -27,9 +27,13 @@ import static org.mockito.Mockito.spy;
 import static org.mockito.Mockito.when;
 
 import java.io.File;
+import java.io.IOException;
 import java.io.InputStream;
+import java.nio.file.Files;
+import java.nio.file.Path;
 import java.util.Arrays;
 import java.util.Collection;
+import java.util.Comparator;
 
 import org.apache.jackrabbit.vault.fs.io.Archive;
 import org.apache.jackrabbit.vault.fs.io.Archive.Entry;
@@ -76,6 +80,15 @@ public final class BundleEntryHandlerTest {
         assertTrue(bundleEntryHandler.matches(bundleLocation.replace("/apps/", "/libs/")));
     }
 
+    private void deleteDirTree(File dir) throws IOException {
+        Path tempDir = dir.toPath();
+
+        Files.walk(tempDir)
+            .sorted(Comparator.reverseOrder())
+            .map(Path::toFile)
+            .forEach(File::delete);
+    }
+
     @Test
     public void deployBundle() throws Exception {
         Archive archive = mock(Archive.class);
@@ -100,18 +113,23 @@ public final class BundleEntryHandlerTest {
         ContentPackage2FeatureModelConverter converter = spy(ContentPackage2FeatureModelConverter.class);
 
         File testDirectory = new File(System.getProperty("java.io.tmpdir"), getClass().getName() + '_' + System.currentTimeMillis());
-        when(converter.getArtifactsDeployer()).thenReturn(new DefaultArtifactsDeployer(testDirectory));
-        when(converter.getFeaturesManager()).thenReturn(featuresManager);
+        try {
+
+            when(converter.getArtifactsDeployer()).thenReturn(new DefaultArtifactsDeployer(testDirectory));
+            when(converter.getFeaturesManager()).thenReturn(featuresManager);
 
-        bundleEntryHandler.handle(bundleLocation, archive, entry, converter);
+            bundleEntryHandler.handle(bundleLocation, archive, entry, converter);
 
-        assertTrue(new File(testDirectory, "org/apache/felix/org.apache.felix.framework/6.0.1/org.apache.felix.framework-6.0.1.pom").exists());
-        assertTrue(new File(testDirectory, "org/apache/felix/org.apache.felix.framework/6.0.1/org.apache.felix.framework-6.0.1.jar").exists());
+            assertTrue(new File(testDirectory, "org/apache/felix/org.apache.felix.framework/6.0.1/org.apache.felix.framework-6.0.1.pom").exists());
+            assertTrue(new File(testDirectory, "org/apache/felix/org.apache.felix.framework/6.0.1/org.apache.felix.framework-6.0.1.jar").exists());
 
-        assertFalse(featuresManager.getTargetFeature().getBundles().isEmpty());
-        assertEquals(1, feature.getBundles().size());
-        assertEquals("org.apache.felix:org.apache.felix.framework:6.0.1", feature.getBundles().get(0).getId().toMvnId());
-        assertEquals(startOrder, feature.getBundles().get(0).getStartOrder());
+            assertFalse(featuresManager.getTargetFeature().getBundles().isEmpty());
+            assertEquals(1, feature.getBundles().size());
+            assertEquals("org.apache.felix:org.apache.felix.framework:6.0.1", feature.getBundles().get(0).getId().toMvnId());
+            assertEquals(startOrder, feature.getBundles().get(0).getStartOrder());
+        } finally {
+            deleteDirTree(testDirectory);
+        }
     }
 
     @Parameters
diff --git a/src/test/java/org/apache/sling/feature/cpconverter/handlers/ConfigEntryHandlerTest.java b/src/test/java/org/apache/sling/feature/cpconverter/handlers/ConfigEntryHandlerTest.java
index 9fcacd4..ad14e50 100644
--- a/src/test/java/org/apache/sling/feature/cpconverter/handlers/ConfigEntryHandlerTest.java
+++ b/src/test/java/org/apache/sling/feature/cpconverter/handlers/ConfigEntryHandlerTest.java
@@ -64,7 +64,7 @@ public class ConfigEntryHandlerTest {
         Feature expected = new Feature(new ArtifactId("org.apache.sling", "org.apache.sling.cp2fm", "0.0.1", null, null));
         FeaturesManager featuresManager = spy(DefaultFeaturesManager.class);
         when(featuresManager.getTargetFeature()).thenReturn(expected);
-        doCallRealMethod().when(featuresManager).addConfiguration(anyString(), anyString(), any());
+        doCallRealMethod().when(featuresManager).addConfiguration(anyString(), anyString(), anyString(), any());
 
         ContentPackage2FeatureModelConverter converter = mock(ContentPackage2FeatureModelConverter.class);
         when(converter.getFeaturesManager()).thenReturn(featuresManager);
@@ -116,8 +116,8 @@ public class ConfigEntryHandlerTest {
         };
         handler.handle("/jcr_root/apps/foo/bar/config/baz/blub.cfg", archive, entry, converter);
 
-        Mockito.verify(manager).addConfiguration(null, "blub", new Hashtable(){{put("foo","bar");}});
-        Mockito.verify(manager).addConfiguration(Mockito.any(), Mockito.anyString(), Mockito.any());
+        Mockito.verify(manager).addConfiguration(null, "blub", "/jcr_root/apps/foo/bar/config/baz/blub.cfg", new Hashtable(){{put("foo","bar");}});
+        Mockito.verify(manager).addConfiguration(Mockito.any(), Mockito.anyString(), Mockito.anyString(), Mockito.any());
     }
 
 }
diff --git a/src/test/java/org/apache/sling/feature/cpconverter/handlers/ConfigurationEntryHandlerTest.java b/src/test/java/org/apache/sling/feature/cpconverter/handlers/ConfigurationEntryHandlerTest.java
index 1af5e4f..8158976 100644
--- a/src/test/java/org/apache/sling/feature/cpconverter/handlers/ConfigurationEntryHandlerTest.java
+++ b/src/test/java/org/apache/sling/feature/cpconverter/handlers/ConfigurationEntryHandlerTest.java
@@ -132,7 +132,7 @@ public class ConfigurationEntryHandlerTest {
         Feature feature = new Feature(new ArtifactId("org.apache.sling", "org.apache.sling.cp2fm", "0.0.1", null, null));
         FeaturesManager featuresManager = spy(DefaultFeaturesManager.class);
         when(featuresManager.getTargetFeature()).thenReturn(feature);
-        doCallRealMethod().when(featuresManager).addConfiguration(anyString(), anyString(), any());
+        doCallRealMethod().when(featuresManager).addConfiguration(anyString(), anyString(), anyString(), any());
         when(featuresManager.getRunMode(anyString())).thenReturn(feature);
         ContentPackage2FeatureModelConverter converter = mock(ContentPackage2FeatureModelConverter.class);
         when(converter.getFeaturesManager()).thenReturn(featuresManager);
