diff --git a/shell/src/main/java/org/apache/felix/shell/impl/Activator.java b/shell/src/main/java/org/apache/felix/shell/impl/Activator.java
index aae9b354be..056bcf7b44 100644
--- a/shell/src/main/java/org/apache/felix/shell/impl/Activator.java
+++ b/shell/src/main/java/org/apache/felix/shell/impl/Activator.java
@@ -225,7 +225,18 @@ public class Activator implements BundleActivator
 
         public synchronized ServiceReference getCommandReference(String name)
         {
-            return (ServiceReference) m_commandNameMap.get(name);
+            ServiceReference ref = null;
+            Iterator itr = m_commandRefMap.entrySet().iterator();
+            while (itr.hasNext())
+            {
+                Map.Entry entry = (Map.Entry) itr.next();
+                if (((Command) entry.getValue()).getName().equals(name))
+                {
+                    ref = (ServiceReference) entry.getKey();
+                    break;
+                }
+            }
+            return ref;
         }
 
         public synchronized void removeCommand(ServiceReference ref)
