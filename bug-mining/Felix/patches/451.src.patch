diff --git a/framework/src/main/java/org/apache/felix/framework/FilterImpl.java b/framework/src/main/java/org/apache/felix/framework/FilterImpl.java
index 4b7abfbc1a..840901f251 100644
--- a/framework/src/main/java/org/apache/felix/framework/FilterImpl.java
+++ b/framework/src/main/java/org/apache/felix/framework/FilterImpl.java
@@ -306,11 +306,11 @@ public class FilterImpl implements Filter
 
         public Object lookup(String name)
         {
-            if (m_map == null)
+            if (m_ref != null)
             {
                 return m_ref.getProperty(name);
             }
-            return m_map.get(name);
+            return (m_map != null) ? m_map.get(name) : null;
         }
     }
 }
\ No newline at end of file
