diff --git a/jaas/src/main/java/org/apache/felix/jaas/internal/ConfigSpiOsgi.java b/jaas/src/main/java/org/apache/felix/jaas/internal/ConfigSpiOsgi.java
index beebd8a6aa..c20d2411a9 100644
--- a/jaas/src/main/java/org/apache/felix/jaas/internal/ConfigSpiOsgi.java
+++ b/jaas/src/main/java/org/apache/felix/jaas/internal/ConfigSpiOsgi.java
@@ -63,12 +63,12 @@ public class ConfigSpiOsgi extends ConfigurationSpi implements ManagedService,
 
     public static final String SERVICE_PID = "org.apache.felix.jaas.ConfigurationSpi";
 
-    private static enum GlobalConfigurationPolicy
+    private enum GlobalConfigurationPolicy
     {
         DEFAULT, REPLACE, PROXY
     }
 
-    private Map<String, Realm> configs = Collections.emptyMap();
+    private volatile Map<String, Realm> configs = Collections.emptyMap();
 
     private final Logger log;
 
@@ -206,24 +206,21 @@ public class ConfigSpiOsgi extends ConfigurationSpi implements ManagedService,
             realm.afterPropertiesSet();
         }
 
+        this.configs = Collections.unmodifiableMap(realmToConfigMap);
+    }
+
+    private void registerSpiWithOSGi()
+    {
         //We also register the Spi with OSGI SR if any configuration is available
         //This would allow any client component to determine when it should start
         //and use the config
-        if (!realmToConfigMap.isEmpty() && spiReg == null)
+        if (spiReg == null && configs != null && !configs.isEmpty())
         {
             Properties props = new Properties();
             props.setProperty("providerName", "felix");
 
-            synchronized (lock)
-            {
-                spiReg = context.registerService(ConfigurationSpi.class.getName(), this,
+            spiReg = context.registerService(ConfigurationSpi.class.getName(), this,
                     props);
-            }
-        }
-
-        synchronized (lock)
-        {
-            this.configs = Collections.unmodifiableMap(realmToConfigMap);
         }
     }
 
@@ -237,6 +234,12 @@ public class ConfigSpiOsgi extends ConfigurationSpi implements ManagedService,
 
     void close()
     {
+
+        if (spiReg != null)
+        {
+            spiReg.unregister();
+        }
+
         this.tracker.close();
         deregisterProvider(jaasConfigProviderName);
 
@@ -367,8 +370,24 @@ public class ConfigSpiOsgi extends ConfigurationSpi implements ManagedService,
     public Object addingService(ServiceReference reference)
     {
         LoginModuleFactory lmf = (LoginModuleFactory) context.getService(reference);
-        registerFactory(reference, lmf);
-        recreateConfigs();
+        boolean registerSpi = false;
+        synchronized (lock)
+        {
+            boolean noConfigAtStart = configs.isEmpty();
+            registerFactory(reference, lmf);
+            recreateConfigs();
+            if (spiReg == null && noConfigAtStart && !configs.isEmpty())
+            {
+                registerSpi = true;
+            }
+        }
+
+        //Register SPI outside of this lock
+        if (registerSpi)
+        {
+            registerSpiWithOSGi();
+        }
+
         return lmf;
     }
 
@@ -380,14 +399,20 @@ public class ConfigSpiOsgi extends ConfigurationSpi implements ManagedService,
             // refresh to update configs
             ((OsgiLoginModuleProvider) lmf).configure();
         }
-        recreateConfigs();
+        synchronized (lock)
+        {
+            recreateConfigs();
+        }
     }
 
     @Override
     public void removedService(ServiceReference reference, Object service)
     {
-        deregisterFactory(reference);
-        recreateConfigs();
+        synchronized (lock)
+        {
+            deregisterFactory(reference);
+            recreateConfigs();
+        }
         context.ungetService(reference);
     }
 
diff --git a/jaas/src/test/java/org/apache/felix/jaas/internal/ITConcurrentLoginModuleFactoryTest.java b/jaas/src/test/java/org/apache/felix/jaas/internal/ITConcurrentLoginModuleFactoryTest.java
index b2002e7986..67b20e7e58 100644
--- a/jaas/src/test/java/org/apache/felix/jaas/internal/ITConcurrentLoginModuleFactoryTest.java
+++ b/jaas/src/test/java/org/apache/felix/jaas/internal/ITConcurrentLoginModuleFactoryTest.java
@@ -35,9 +35,10 @@ import java.util.Queue;
 import java.util.concurrent.ArrayBlockingQueue;
 import java.util.concurrent.CountDownLatch;
 
+import javax.security.auth.login.ConfigurationSpi;
+
 import org.apache.felix.jaas.LoginModuleFactory;
 import org.apache.sling.testing.mock.osgi.junit.OsgiContext;
-import org.junit.Ignore;
 import org.junit.Rule;
 import org.junit.Test;
 import org.junit.runner.RunWith;
@@ -47,7 +48,6 @@ import org.mockito.stubbing.Answer;
 import org.osgi.framework.BundleContext;
 import org.osgi.framework.ServiceReference;
 
-@Ignore("FELIX-5502")
 @RunWith(Parameterized.class)
 public class ITConcurrentLoginModuleFactoryTest
 {
@@ -55,6 +55,7 @@ public class ITConcurrentLoginModuleFactoryTest
     @Rule
     public OsgiContext context = new OsgiContext();
 
+    //Run the test multiple times
     @Parameterized.Parameters
     public static List<Object[]> data()
     {
@@ -97,6 +98,7 @@ public class ITConcurrentLoginModuleFactoryTest
 
         assertEquals(numOfServices,
             spi.engineGetAppConfigurationEntry(TEST_REALM_NAME).length);
+        assertEquals(1, context.getServices(ConfigurationSpi.class, null).length);
     }
 
     private static class ServiceAdder implements Runnable
