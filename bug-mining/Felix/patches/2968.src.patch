diff --git a/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/HttpServiceController.java b/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/HttpServiceController.java
index 6c4350a6cb..ad1d4f9fb5 100644
--- a/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/HttpServiceController.java
+++ b/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/HttpServiceController.java
@@ -101,7 +101,7 @@ public final class HttpServiceController
         return new HttpSessionIdListener() {
 
             @Override
-            public void sessionIdChanged(final HttpSessionEvent event, String oldSessionId) {
+            public void sessionIdChanged(final HttpSessionEvent event, final String oldSessionId) {
                 whiteboardManager.sessionIdChanged(event, oldSessionId, HttpSessionWrapper.getSessionContextIds(event.getSession()));
             }
         };
diff --git a/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapper.java b/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapper.java
index 5bded699e7..3dff4712a8 100644
--- a/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapper.java
+++ b/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapper.java
@@ -273,7 +273,7 @@ public class HttpSessionWrapper implements HttpSession
     public String getId()
     {
         this.checkInvalid();
-        return this.delegate.getId() + "-" + this.sessionId;
+        return this.delegate.getId();
     }
 
     @Override
@@ -471,7 +471,7 @@ public class HttpSessionWrapper implements HttpSession
     @Override
     public int hashCode()
     {
-        return this.getId().hashCode();
+        return this.getId().concat(this.sessionId).hashCode();
     }
 
     @Override
@@ -486,6 +486,6 @@ public class HttpSessionWrapper implements HttpSession
             return false;
         }
         final HttpSessionWrapper other = (HttpSessionWrapper) obj;
-        return other.getId().equals(this.getId());
+        return other.getId().concat(other.sessionId).equals(this.getId().concat(this.sessionId));
     }
 }
diff --git a/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/WhiteboardManager.java b/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/WhiteboardManager.java
index 175dd56aed..11aed53630 100644
--- a/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/WhiteboardManager.java
+++ b/osgi-r7/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/WhiteboardManager.java
@@ -109,15 +109,15 @@ public final class WhiteboardManager
 
     private final HttpServiceRuntimeImpl serviceRuntime;
 
-    private final List<ServiceTracker<?, ?>> trackers = new ArrayList<ServiceTracker<?, ?>>();
+    private final List<ServiceTracker<?, ?>> trackers = new ArrayList<>();
 
     private final HttpServicePlugin plugin;
 
     /** A map containing all servlet context registrations. Mapped by context name */
-    private final Map<String, List<WhiteboardContextHandler>> contextMap = new HashMap<String, List<WhiteboardContextHandler>>();
+    private final Map<String, List<WhiteboardContextHandler>> contextMap = new HashMap<>();
 
     /** A map with all servlet/filter registrations, mapped by abstract info. */
-    private final Map<WhiteboardServiceInfo<?>, List<WhiteboardContextHandler>> servicesMap = new HashMap<WhiteboardServiceInfo<?>, List<WhiteboardContextHandler>>();
+    private final Map<WhiteboardServiceInfo<?>, List<WhiteboardContextHandler>> servicesMap = new HashMap<>();
 
     private volatile List<PreprocessorHandler> preprocessorHandlers = Collections.emptyList();
 
@@ -169,7 +169,7 @@ public final class WhiteboardManager
 
 
         // add context for http service
-        final List<WhiteboardContextHandler> list = new ArrayList<WhiteboardContextHandler>();
+        final List<WhiteboardContextHandler> list = new ArrayList<>();
         final ServletContextHelperInfo info = new ServletContextHelperInfo(Integer.MAX_VALUE,
                 HttpServiceFactory.HTTP_SERVICE_CONTEXT_SERVICE_ID,
                 HttpServiceFactory.HTTP_SERVICE_CONTEXT_NAME, "/", null);
@@ -178,7 +178,7 @@ public final class WhiteboardManager
         this.contextMap.put(HttpServiceFactory.HTTP_SERVICE_CONTEXT_NAME, list);
 
         // add default context
-        final Dictionary<String, Object> props = new Hashtable<String, Object>();
+        final Dictionary<String, Object> props = new Hashtable<>();
         props.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_NAME, HttpWhiteboardConstants.HTTP_WHITEBOARD_DEFAULT_CONTEXT_NAME);
         props.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_PATH, "/");
         props.put(Constants.SERVICE_RANKING, Integer.MIN_VALUE);
@@ -281,7 +281,7 @@ public final class WhiteboardManager
      * @param oldSessionId The old session id
      * @param contextIds The context ids using that session
      */
-    public void sessionIdChanged(@Nonnull final HttpSessionEvent event, String oldSessionId, final Set<Long> contextIds)
+    public void sessionIdChanged(@Nonnull final HttpSessionEvent event, @Nonnull final String oldSessionId, @Nonnull final Set<Long> contextIds)
     {
         for(final Long contextId : contextIds)
         {
@@ -306,7 +306,7 @@ public final class WhiteboardManager
             return false;
         }
 
-        final List<WhiteboardServiceInfo<?>> services = new ArrayList<WhiteboardServiceInfo<?>>();
+        final List<WhiteboardServiceInfo<?>> services = new ArrayList<>();
         for(final Map.Entry<WhiteboardServiceInfo<?>, List<WhiteboardContextHandler>> entry : this.servicesMap.entrySet())
         {
             final WhiteboardServiceInfo<?> info = entry.getKey();
@@ -354,7 +354,7 @@ public final class WhiteboardManager
     private void deactivate(final WhiteboardContextHandler handler)
     {
         // services except context listeners first
-        final List<WhiteboardServiceInfo<?>> listeners = new ArrayList<WhiteboardServiceInfo<?>>();
+        final List<WhiteboardServiceInfo<?>> listeners = new ArrayList<>();
         final Iterator<Map.Entry<WhiteboardServiceInfo<?>, List<WhiteboardContextHandler>>> i = this.servicesMap.entrySet().iterator();
         while ( i.hasNext() )
         {
@@ -411,7 +411,7 @@ public final class WhiteboardManager
                     List<WhiteboardContextHandler> handlerList = this.contextMap.get(info.getName());
                     if ( handlerList == null )
                     {
-                        handlerList = new ArrayList<WhiteboardContextHandler>();
+                        handlerList = new ArrayList<>();
                     }
                     final boolean activate = handlerList.isEmpty() || handlerList.get(0).compareTo(handler) > 0;
                     if ( activate )
@@ -527,7 +527,7 @@ public final class WhiteboardManager
      */
     private List<WhiteboardContextHandler> getMatchingContexts(final WhiteboardServiceInfo<?> info)
     {
-        final List<WhiteboardContextHandler> result = new ArrayList<WhiteboardContextHandler>();
+        final List<WhiteboardContextHandler> result = new ArrayList<>();
         for(final List<WhiteboardContextHandler> handlerList : this.contextMap.values())
         {
             final WhiteboardContextHandler h = handlerList.get(0);
@@ -561,7 +561,7 @@ public final class WhiteboardManager
                 }
                 else
                 {
-                    final Map<String, String> props = new HashMap<String, String>();
+                    final Map<String, String> props = new HashMap<>();
                     props.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_NAME, h.getContextInfo().getName());
                     props.put(HttpWhiteboardConstants.HTTP_WHITEBOARD_CONTEXT_PATH, h.getContextInfo().getPath());
                     props.put(HttpWhiteboardConstants.HTTP_SERVICE_CONTEXT_PROPERTY, h.getContextInfo().getName());
@@ -598,7 +598,7 @@ public final class WhiteboardManager
                     {
                         synchronized ( this.preprocessorHandlers )
                         {
-                            final List<PreprocessorHandler> newList = new ArrayList<PreprocessorHandler>(this.preprocessorHandlers);
+                            final List<PreprocessorHandler> newList = new ArrayList<>(this.preprocessorHandlers);
                             newList.add(handler);
                             Collections.sort(newList);
                             this.preprocessorHandlers = newList;
@@ -716,7 +716,7 @@ public final class WhiteboardManager
                 {
                     synchronized ( this.preprocessorHandlers )
                     {
-                        final List<PreprocessorHandler> newList = new ArrayList<PreprocessorHandler>(this.preprocessorHandlers);
+                        final List<PreprocessorHandler> newList = new ArrayList<>(this.preprocessorHandlers);
                         final Iterator<PreprocessorHandler> iter = newList.iterator();
                         while ( iter.hasNext() )
                         {
@@ -942,10 +942,10 @@ public final class WhiteboardManager
     {
         final FailedDTOHolder failedDTOHolder = new FailedDTOHolder();
 
-        final Collection<ServletContextDTO> contextDTOs = new ArrayList<ServletContextDTO>();
+        final Collection<ServletContextDTO> contextDTOs = new ArrayList<>();
 
         // get sort list of context handlers
-        final List<WhiteboardContextHandler> contextHandlerList = new ArrayList<WhiteboardContextHandler>();
+        final List<WhiteboardContextHandler> contextHandlerList = new ArrayList<>();
         synchronized ( this.contextMap )
         {
             for (final List<WhiteboardContextHandler> list : this.contextMap.values())
@@ -969,7 +969,7 @@ public final class WhiteboardManager
             }
         }
 
-        final List<PreprocessorDTO> preprocessorDTOs = new ArrayList<PreprocessorDTO>();
+        final List<PreprocessorDTO> preprocessorDTOs = new ArrayList<>();
         final List<PreprocessorHandler> localHandlers = this.preprocessorHandlers;
         for(final PreprocessorHandler handler : localHandlers)
         {
diff --git a/osgi-r7/http/itest/src/test/java/org/apache/felix/http/itest/SessionHandlingTest.java b/osgi-r7/http/itest/src/test/java/org/apache/felix/http/itest/SessionHandlingTest.java
index 407ad3123d..02854e94de 100644
--- a/osgi-r7/http/itest/src/test/java/org/apache/felix/http/itest/SessionHandlingTest.java
+++ b/osgi-r7/http/itest/src/test/java/org/apache/felix/http/itest/SessionHandlingTest.java
@@ -69,7 +69,7 @@ import org.osgi.service.http.context.ServletContextHelper;
 @ExamReactorStrategy(PerMethod.class)
 public class SessionHandlingTest extends BaseIntegrationTest
 {
-    private List<ServiceRegistration<?>> registrations = new ArrayList<ServiceRegistration<?>>();
+    private List<ServiceRegistration<?>> registrations = new ArrayList<>();
 
     private CountDownLatch initLatch;
     private CountDownLatch destroyLatch;
@@ -82,7 +82,7 @@ public class SessionHandlingTest extends BaseIntegrationTest
 
     private void setupServlet(final String name, String[] path, int rank, final String context) throws Exception
     {
-        Dictionary<String, Object> servletProps = new Hashtable<String, Object>();
+        Dictionary<String, Object> servletProps = new Hashtable<>();
         servletProps.put(HTTP_WHITEBOARD_SERVLET_NAME, name);
         servletProps.put(HTTP_WHITEBOARD_SERVLET_PATTERN, path);
         servletProps.put(SERVICE_RANKING, rank);
@@ -125,7 +125,8 @@ public class SessionHandlingTest extends BaseIntegrationTest
                 {
                     pw.println(" \"session\" : true,");
                     pw.println(" \"sessionId\" : \"" + s.getId() + "\",");
-                    pw.println(" \"value\" : \"" + s.getAttribute("value") + "\"");
+                    pw.println(" \"value\" : \"" + s.getAttribute("value") + "\",");
+                    pw.println(" \"hashCode\" : \"" + s.hashCode() + "\"");
                 }
                 pw.println("}");
             }
@@ -214,6 +215,8 @@ public class SessionHandlingTest extends BaseIntegrationTest
         assertEquals("test1", json.getString("value"));
         final String sessionId1 = json.getString("sessionId");
         assertNotNull(sessionId1);
+        final String hashCode1 = json.getString("hashCode");
+        assertNotNull(hashCode1);
 
         // check session for servlet bar (= no session)
         json = getJSONResponse(httpclient, "/bar");
@@ -230,7 +233,9 @@ public class SessionHandlingTest extends BaseIntegrationTest
         assertEquals("test2", json.getString("value"));
         final String sessionId2 = json.getString("sessionId");
         assertNotNull(sessionId2);
-        assertFalse(sessionId1.equals(sessionId2));
+        final String hashCode2 = json.getString("hashCode");
+        assertNotNull(hashCode2);
+        assertFalse(hashCode2.equals(hashCode1));
 
         // and context foo is untouched
         json = getJSONResponse(httpclient, "/foo");
