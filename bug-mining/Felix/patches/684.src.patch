diff --git a/framework/src/main/java/org/apache/felix/framework/URLHandlersBundleURLConnection.java b/framework/src/main/java/org/apache/felix/framework/URLHandlersBundleURLConnection.java
index d6fa8172e9..3947785e0e 100644
--- a/framework/src/main/java/org/apache/felix/framework/URLHandlersBundleURLConnection.java
+++ b/framework/src/main/java/org/apache/felix/framework/URLHandlersBundleURLConnection.java
@@ -55,7 +55,7 @@ class URLHandlersBundleURLConnection extends URLConnection
             Object tmp = URLHandlers.getFrameworkFromContext();
             if (tmp instanceof Felix)
             {
-                m_framework = (Felix) framework;
+                m_framework = (Felix) tmp;
             }
         }
 
diff --git a/framework/src/main/java/org/apache/felix/framework/util/manifestparser/R4LibraryClause.java b/framework/src/main/java/org/apache/felix/framework/util/manifestparser/R4LibraryClause.java
index cbd7d73acb..1457979899 100644
--- a/framework/src/main/java/org/apache/felix/framework/util/manifestparser/R4LibraryClause.java
+++ b/framework/src/main/java/org/apache/felix/framework/util/manifestparser/R4LibraryClause.java
@@ -449,7 +449,8 @@ public class R4LibraryClause
     {
         value = value.toLowerCase();
 
-        if (value.startsWith("x86-64") || value.startsWith("amd64"))
+        if (value.startsWith("x86-64") || value.startsWith("amd64") || 
+            value.startsWith("em64") || value.startsWith("x86_64"))
         {
             return "x86-64";
         }
