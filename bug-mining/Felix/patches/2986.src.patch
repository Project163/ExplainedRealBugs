diff --git a/tools/maven-bundle-plugin/src/main/java/org/apache/felix/bundleplugin/JpaPlugin.java b/tools/maven-bundle-plugin/src/main/java/org/apache/felix/bundleplugin/JpaPlugin.java
index 931e4985bc..d2f4428eef 100644
--- a/tools/maven-bundle-plugin/src/main/java/org/apache/felix/bundleplugin/JpaPlugin.java
+++ b/tools/maven-bundle-plugin/src/main/java/org/apache/felix/bundleplugin/JpaPlugin.java
@@ -27,6 +27,7 @@ import java.io.InputStream;
 import java.io.InputStreamReader;
 import java.net.URL;
 import java.util.HashSet;
+import java.util.LinkedHashSet;
 import java.util.Map;
 import java.util.Set;
 
@@ -134,7 +135,7 @@ System.err.println("Output: " + set.toString());
 
     public Set<String> analyze( InputStream in ) throws Exception
     {
-        Set<String> refers = new HashSet<String>();
+        Set<String> refers = new LinkedHashSet<String>();
         ByteArrayOutputStream bout = new ByteArrayOutputStream();
         javax.xml.transform.Result r = new StreamResult( bout );
         javax.xml.transform.Source s = new StreamSource( in );
diff --git a/tools/maven-bundle-plugin/src/main/resources/org/apache/felix/bundleplugin/jpa.xsl b/tools/maven-bundle-plugin/src/main/resources/org/apache/felix/bundleplugin/jpa.xsl
index bff2348414..4b2ebb6252 100644
--- a/tools/maven-bundle-plugin/src/main/resources/org/apache/felix/bundleplugin/jpa.xsl
+++ b/tools/maven-bundle-plugin/src/main/resources/org/apache/felix/bundleplugin/jpa.xsl
@@ -136,19 +136,31 @@
     <xsl:template name="service-capability">
         <xsl:param name="interface"/>
         <xsl:param name="attributes" select="''"/>
-        <xsl:value-of select="concat('Provide-Capability: osgi.service;effective:=active;',
-                                         'objectClass=', $interface, ';',
-                                         $attributes,
-                                         $nl)"/>
+        <xsl:choose>
+            <xsl:when test="string-length($attributes)>0">
+                <xsl:value-of select="concat('Provide-Capability: osgi.service;effective:=active;',
+                                         'objectClass=', $interface, ';', $attributes, $nl)"/>
+            </xsl:when>
+            <xsl:otherwise>
+                <xsl:value-of select="concat('Provide-Capability: osgi.service;effective:=active;',
+                                         'objectClass=', $interface, $nl)"/>
+            </xsl:otherwise>
+        </xsl:choose>
     </xsl:template>
 
     <xsl:template name="service-requirement">
         <xsl:param name="interface"/>
         <xsl:param name="attributes" select="''"/>
-        <xsl:value-of select="concat('Require-Capability: osgi.service;effective:=active;',
-                                         'objectClass=', $interface, ';',
-                                         $attributes,
-                                         $nl)"/>
+        <xsl:choose>
+            <xsl:when test="string-length($attributes)>0">
+                <xsl:value-of select="concat('Require-Capability: osgi.service;effective:=active;',
+                                         'objectClass=', $interface, ';', $attributes, $nl)"/>
+            </xsl:when>
+            <xsl:otherwise>
+                <xsl:value-of select="concat('Require-Capability: osgi.service;effective:=active;',
+                                         'objectClass=', $interface, $nl)"/>
+            </xsl:otherwise>
+        </xsl:choose>
     </xsl:template>
 
 </xsl:stylesheet>
diff --git a/tools/maven-bundle-plugin/src/test/java/org/apache/felix/bundleplugin/JpaPluginTest.java b/tools/maven-bundle-plugin/src/test/java/org/apache/felix/bundleplugin/JpaPluginTest.java
index 0850541b9c..706cdf9ce6 100644
--- a/tools/maven-bundle-plugin/src/test/java/org/apache/felix/bundleplugin/JpaPluginTest.java
+++ b/tools/maven-bundle-plugin/src/test/java/org/apache/felix/bundleplugin/JpaPluginTest.java
@@ -35,7 +35,7 @@ public class JpaPluginTest {
                         "        <jta-data-source>osgi:service/jdbc/h2DS</jta-data-source>\n" +
                         "    </persistence-unit>\n" +
                         "</persistence>";
-        String expectedReqs = "osgi.extender;osgi.extender=aries.jpa,osgi.service;effective:=active;objectClass=javax.transaction.TransactionManager;";
+        String expectedReqs = "osgi.extender;osgi.extender=aries.jpa,osgi.service;effective:=active;objectClass=javax.transaction.TransactionManager";
         assertTransformation(xmlStr, expectedReqs);
     }
 
@@ -46,7 +46,7 @@ public class JpaPluginTest {
                         "        <jta-data-source>osgi:service/javax.sql.DataSource/(&amp;(db=mydb)(version=3.1))</jta-data-source>\n" +
                         "    </persistence-unit>\n" +
                         "</persistence>";
-        String expectedReqs = "osgi.extender;osgi.extender=aries.jpa,osgi.service;effective:=active;objectClass=javax.sql.DataSource;filter:=\"(&(db=mydb)(version=3.1))\",osgi.service;effective:=active;objectClass=javax.transaction.TransactionManager;";
+        String expectedReqs = "osgi.extender;osgi.extender=aries.jpa,osgi.service;effective:=active;objectClass=javax.transaction.TransactionManager,osgi.service;effective:=active;objectClass=javax.sql.DataSource;filter:=\"(&(db=mydb)(version=3.1))\"";
         assertTransformation(xmlStr, expectedReqs);
     }
 
@@ -68,5 +68,6 @@ public class JpaPluginTest {
         plugin.analyzeJar(analyzer);
 
         assertEquals(expectedReqs, analyzer.getProperty("Require-Capability"));
+
     }
 }
