diff --git a/gogo/runtime/src/main/java/org/apache/felix/gogo/runtime/Parser.java b/gogo/runtime/src/main/java/org/apache/felix/gogo/runtime/Parser.java
index bf28234755..e0f9bc59ff 100644
--- a/gogo/runtime/src/main/java/org/apache/felix/gogo/runtime/Parser.java
+++ b/gogo/runtime/src/main/java/org/apache/felix/gogo/runtime/Parser.java
@@ -211,12 +211,16 @@ public class Parser
                     return new Program(whole(tokens, start), tokens);
                 }
             }
-            if (Token.eq("}", t) || Token.eq(")", t))
+            if (Token.eq("}", t) || Token.eq(")", t) || Token.eq("]", t))
             {
                 if (pipes != null)
                 {
                     throw new EOFError(t.line, t.column, "unexpected token '" + t + "' while looking for a statement after |", getMissing("pipe"), "0");
                 }
+                else if (stack.isEmpty())
+                {
+                    throw new SyntaxError(t.line, t.column, "unexpected token '" + t + "'");
+                }
                 else
                 {
                     push(t);
diff --git a/gogo/runtime/src/test/java/org/apache/felix/gogo/runtime/TestParser.java b/gogo/runtime/src/test/java/org/apache/felix/gogo/runtime/TestParser.java
index 8d87fb77e5..a5f698ae4d 100644
--- a/gogo/runtime/src/test/java/org/apache/felix/gogo/runtime/TestParser.java
+++ b/gogo/runtime/src/test/java/org/apache/felix/gogo/runtime/TestParser.java
@@ -455,6 +455,26 @@ public class TestParser extends AbstractParserTest
         assertEquals("bar", s0.redirections().get(1).toString());
     }
 
+    @Test
+    public void testClosingSquareBracket()
+    {
+        expectSyntaxError("{ a } }");
+        expectSyntaxError("a }");
+        expectSyntaxError("}");
+        expectSyntaxError("{ a } ]");
+        expectSyntaxError("a ]");
+        expectSyntaxError("]");
+    }
+
+    private void expectSyntaxError(String txt) {
+        try {
+            new Parser(txt).program();
+            fail("Expected a SyntaxError to be thrown");
+        } catch (SyntaxError e) {
+            // ok
+        }
+    }
+
     @Test
     public void testSimpleValue()
     {
