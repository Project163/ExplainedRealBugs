diff --git a/framework/src/main/java/org/apache/felix/framework/ServiceRegistry.java b/framework/src/main/java/org/apache/felix/framework/ServiceRegistry.java
index 22552e87df..dac1dc236c 100644
--- a/framework/src/main/java/org/apache/felix/framework/ServiceRegistry.java
+++ b/framework/src/main/java/org/apache/felix/framework/ServiceRegistry.java
@@ -181,6 +181,12 @@ public class ServiceRegistry
         // Bundles are allowed to get a reference while unregistering
         // get fresh set of bundles (should be empty, but this is a sanity check)
         ungetServices(ref);
+
+        // Now flush all usage counts as the registration is invalid
+        for (Bundle usingBundle : m_inUseMap.keySet())
+        {
+            flushUsageCount(usingBundle, ref, null);
+        }
     }
 
     private void ungetServices(final ServiceReference<?> ref)
@@ -543,7 +549,7 @@ public class ServiceRegistry
             UsageCount[] usages = entry.getValue();
             for (int useIdx = 0; useIdx < usages.length; useIdx++)
             {
-                if (usages[useIdx].m_ref.equals(ref))
+                if (usages[useIdx].m_ref.equals(ref) && usages[useIdx].m_count.get() > 0)
                 {
                     // Add the bundle to the array to be returned.
                     if (bundles == null)
diff --git a/framework/src/test/java/org/apache/felix/framework/ServiceRegistryTest.java b/framework/src/test/java/org/apache/felix/framework/ServiceRegistryTest.java
index ccc84fb722..b83eef4f64 100644
--- a/framework/src/test/java/org/apache/felix/framework/ServiceRegistryTest.java
+++ b/framework/src/test/java/org/apache/felix/framework/ServiceRegistryTest.java
@@ -54,6 +54,10 @@ import org.osgi.framework.hooks.service.EventHook;
 import org.osgi.framework.hooks.service.FindHook;
 import org.osgi.framework.hooks.service.ListenerHook;
 
+import static org.hamcrest.CoreMatchers.is;
+import static org.hamcrest.CoreMatchers.nullValue;
+import static org.hamcrest.MatcherAssert.assertThat;
+
 public class ServiceRegistryTest extends TestCase
 {
     public void testRegisterEventHookService()
@@ -1228,6 +1232,29 @@ public class ServiceRegistryTest extends TestCase
         sb.append("Obtained service");
     }
 
+    public void testUsingBundlesWithoutZeroCounts() throws Exception
+    {
+        ServiceRegistry sr = new ServiceRegistry(null, null);
+        Bundle regBundle = Mockito.mock(Bundle.class);
+
+        ServiceRegistration reg = sr.registerService(
+                regBundle, new String [] {String.class.getName()}, "hi", null);
+        @SuppressWarnings("unchecked")
+        ServiceReference<String> ref = reg.getReference();
+
+        final Bundle clientBundle = Mockito.mock(Bundle.class);
+        Mockito.when(clientBundle.getBundleId()).thenReturn(42L);
+        assertThat(sr.getService(clientBundle, ref, false), is("hi"));
+
+        final Bundle clientBundle2 = Mockito.mock(Bundle.class);
+        Mockito.when(clientBundle.getBundleId()).thenReturn(327L);
+        assertThat(sr.getService(clientBundle2, ref, false), is("hi"));
+
+        assertThat(sr.ungetService(clientBundle, reg.getReference(), null), is(true));
+
+        assertThat(sr.getUsingBundles(reg.getReference()), is(new Bundle[]{clientBundle2}));
+    }
+
     private Object getPrivateField(Object obj, String fieldName) throws NoSuchFieldException,
             IllegalAccessException
     {
