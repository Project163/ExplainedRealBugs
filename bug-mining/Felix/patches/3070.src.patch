diff --git a/scr/src/main/java/org/apache/felix/scr/impl/helper/ComponentServiceObjectsHelper.java b/scr/src/main/java/org/apache/felix/scr/impl/helper/ComponentServiceObjectsHelper.java
index 6d1418bff7..5f11b9286c 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/helper/ComponentServiceObjectsHelper.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/helper/ComponentServiceObjectsHelper.java
@@ -41,6 +41,8 @@ public class ComponentServiceObjectsHelper
 
     private final List<ComponentServiceObjectsImpl> closedServices = new ArrayList<ComponentServiceObjectsImpl>();
 
+    private final ConcurrentMap<ServiceReference<?>, Object> prototypeInstances = new ConcurrentHashMap<ServiceReference<?>, Object>();
+
     public ComponentServiceObjectsHelper(final BundleContext bundleContext)
     {
         this.bundleContext = bundleContext;
@@ -63,6 +65,7 @@ public class ComponentServiceObjectsHelper
         {
         	cso.deactivate();
         }
+        prototypeInstances.clear();
     }
 
     public ComponentServiceObjects getServiceObjects(final ServiceReference<?> ref)
@@ -98,7 +101,19 @@ public class ComponentServiceObjectsHelper
 
     public <T> T getPrototypeRefInstance(final ServiceReference<T> ref)
     {
-    	return (T) getServiceObjects(ref).getService();
+    	T service = (T) prototypeInstances.get(ref);
+    	if ( service == null )
+    	{
+    		service = (T) getServiceObjects(ref).getService();
+    		T oldService = (T)prototypeInstances.putIfAbsent(ref, service);
+    		if ( oldService != null )
+    		{
+    			// another thread created the instance already
+    			getServiceObjects(ref).ungetService(service);
+    			service = oldService;
+    		}
+    	}
+    	return service;
     }
 
     private static final class ComponentServiceObjectsImpl implements ComponentServiceObjects
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/DependencyManager.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/DependencyManager.java
index e177f4c54a..55d005fa9b 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/DependencyManager.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/DependencyManager.java
@@ -223,15 +223,7 @@ public class DependencyManager<S, T> implements ReferenceManager<S, T>
 
         protected void ungetService(RefPair<S, T> ref)
         {
-            Object service = ref.unsetServiceObject(null);
-            if (service != null)
-            {
-                BundleContext bundleContext = m_componentManager.getBundleContext();
-                if (bundleContext != null)
-                {
-                    bundleContext.ungetService(ref.getRef());
-                }
-            }
+            ref.ungetServiceObjects(m_componentManager.getBundleContext());
         }
 
         protected void tracked(int trackingCount)
@@ -1690,7 +1682,7 @@ public class DependencyManager<S, T> implements ReferenceManager<S, T>
                 invokeUnbindMethod(componentContext, boundRef, trackingCount.get(), edgeInfo);
             }
             
-            boundRef.unsetServiceObject(componentContext);
+            boundRef.ungetServiceObject(componentContext);
             
         }
         latch.countDown();
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/MultiplePrototypeRefPair.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/MultiplePrototypeRefPair.java
index 4681de7b53..8e827381ed 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/MultiplePrototypeRefPair.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/MultiplePrototypeRefPair.java
@@ -54,7 +54,7 @@ public class MultiplePrototypeRefPair<S, T> extends RefPair<S, T>
     }
 
     @Override
-    public T unsetServiceObject(ComponentContextImpl<S> key)
+    public T ungetServiceObject(ComponentContextImpl<S> key)
     {
     	if ( key == null )
     	{
@@ -74,6 +74,11 @@ public class MultiplePrototypeRefPair<S, T> extends RefPair<S, T>
 		return service;
     }
 
+    @Override
+    public void ungetServiceObjects(BundleContext bundleContext) {
+        ungetServiceObject(null);
+    }
+
     @Override
     public String toString()
     {
@@ -83,7 +88,7 @@ public class MultiplePrototypeRefPair<S, T> extends RefPair<S, T>
     @Override
     public boolean getServiceObject(ComponentContextImpl<S> key, BundleContext context)
     {
-    	final T service = key.getComponentServiceObjectsHelper().getPrototypeRefInstance(this.getRef());
+        final T service = key.getComponentServiceObjectsHelper().getPrototypeRefInstance(this.getRef());
         if ( service == null )
         {
             setFailed();
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/RefPair.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/RefPair.java
index 97c180c4d9..1566a6dd49 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/RefPair.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/RefPair.java
@@ -50,7 +50,8 @@ public abstract class RefPair<S, T>
 
     public abstract boolean setServiceObject( ComponentContextImpl<S> key, T serviceObject );
 
-    public abstract T unsetServiceObject(ComponentContextImpl<S> key);
+    public abstract void ungetServiceObjects(BundleContext context);
+    public abstract T ungetServiceObject(ComponentContextImpl<S> key);
 
     public void setFailed( )
     {
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/SingleComponentManager.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/SingleComponentManager.java
index 79ef32871d..3b9f4a7bc6 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/SingleComponentManager.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/SingleComponentManager.java
@@ -161,7 +161,6 @@ public class SingleComponentManager<S> extends AbstractComponentManager<S> imple
         {
             m_useCount.set( 0 );
             disposeImplementationObject( m_componentContext, reason );
-            m_componentContext.cleanup();
             m_componentContext = null;
             getLogger().log( LogService.LOG_DEBUG, "Unset and deconfigured implementation object for component in deleteComponent for reason {0}", null, REASONS[ reason ] );
             clearServiceProperties();
@@ -417,7 +416,7 @@ public class SingleComponentManager<S> extends AbstractComponentManager<S> imple
                 md.close( componentContext, componentContext.getEdgeInfo( md ) );
             }
         }
-
+        componentContext.cleanup();
     }
 
     @Override
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/SinglePrototypeRefPair.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/SinglePrototypeRefPair.java
index 0e9754c897..76f552058c 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/SinglePrototypeRefPair.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/SinglePrototypeRefPair.java
@@ -20,6 +20,8 @@
 
 package org.apache.felix.scr.impl.manager;
 
+import java.util.concurrent.atomic.AtomicReference;
+
 import org.osgi.framework.BundleContext;
 import org.osgi.framework.ServiceReference;
 import org.osgi.service.log.LogService;
@@ -27,13 +29,55 @@ import org.osgi.service.log.LogService;
 /**
  * @version $Rev$ $Date$
  */
-public class SinglePrototypeRefPair<S, T> extends SingleRefPair<S, T>
+public class SinglePrototypeRefPair<S, T> extends RefPair<S, T>
 {
+    class SingleKeyService {
+        final ComponentContextImpl<S> key;
+        final T serviceObject;
+        SingleKeyService(ComponentContextImpl<S> key, T serviceObject) {
+            this.key = key;
+            this.serviceObject = serviceObject;
+        }
+    }
+    protected AtomicReference<SingleKeyService> serviceObjectRef = new AtomicReference<>();
+
     public SinglePrototypeRefPair( ServiceReference<T> ref )
     {
         super(ref);
     }
 
+    @Override
+    public T getServiceObject(ComponentContextImpl<S> key)
+    {
+        SingleKeyService service = serviceObjectRef.get();
+        return service == null ? null : service.serviceObject;
+    }
+
+    @Override
+    public boolean setServiceObject(ComponentContextImpl<S> key, T serviceObject)
+    {
+        return serviceObjectRef.compareAndSet(null, new SingleKeyService(key, serviceObject ));
+    }
+
+    @Override
+    public T ungetServiceObject(ComponentContextImpl<S> key)
+    {
+        SingleKeyService service = serviceObjectRef.getAndSet(null);
+        if (service != null) {
+            if (key == null) {
+                key = service.key;
+            }
+            doUngetService(key, service.serviceObject);
+            return service.serviceObject;
+        }
+		return null;
+    }
+
+    @Override
+    public void ungetServiceObjects(BundleContext bundleContext) {
+        ungetServiceObject(null);
+    }
+
     @Override
     public String toString()
     {
@@ -49,37 +93,25 @@ public class SinglePrototypeRefPair<S, T> extends SingleRefPair<S, T>
             setFailed();
             key.getLogger().log(
                  LogService.LOG_WARNING,
-                 "Could not get service from serviceobjects for ref {0}",null, getRef() );
+                 "Could not get service from serviceobjects for ref {0}", null, getRef() );
             return false;
         }
         if (!setServiceObject(key, service))
         {
             // Another thread got the service before, so unget our
-        	doUngetService(key, service);
+        	doUngetService( key, service );
         }
         return true;
     }
 
-    @Override
-    public T unsetServiceObject(ComponentContextImpl<S> key)
-    {
-    	final T service = super.unsetServiceObject(key);
-    	if ( service != null )
-    	{
-			doUngetService(key, service);
-    	}
-    	return null ;
-    }
-
 	private void doUngetService(ComponentContextImpl<S> key, final T service) {
 		try 
 		{
-			key.getComponentServiceObjectsHelper().getServiceObjects(getRef()).ungetService(service);
+			key.getComponentServiceObjectsHelper().getServiceObjects(getRef()).ungetService( service );
 		}
-		catch (final IllegalStateException ise)
+		catch ( final IllegalStateException ise )
 		{
 			// ignore
 		}
 	}
-    
 }
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/SingleRefPair.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/SingleRefPair.java
index 7c1ded7711..f9b8df5528 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/SingleRefPair.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/SingleRefPair.java
@@ -31,7 +31,7 @@ import org.osgi.service.log.LogService;
  */
 public class SingleRefPair<S, T> extends RefPair<S, T>
 {
-    private AtomicReference<T> serviceObjectRef = new AtomicReference<>();
+    protected AtomicReference<T> serviceObjectRef = new AtomicReference<>();
 
     public SingleRefPair( ServiceReference<T> ref )
     {
@@ -56,9 +56,22 @@ public class SingleRefPair<S, T> extends RefPair<S, T>
     }
 
     @Override
-    public T unsetServiceObject(ComponentContextImpl<S> key)
+    public T ungetServiceObject(ComponentContextImpl<S> key) {
+        // null operation for singleRefPair
+        return null;
+    }
+
+    @Override
+    public void ungetServiceObjects(BundleContext bundleContext)
     {
-        return serviceObjectRef.getAndSet( null );
+        T service = serviceObjectRef.getAndSet( null );
+        if (service != null)
+        {
+            if (bundleContext != null)
+            {
+                bundleContext.ungetService(getRef());
+            }
+        }
     }
 
     @Override
