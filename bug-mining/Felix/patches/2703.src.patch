diff --git a/tools/org.apache.felix.scr.generator/src/main/java/org/apache/felix/scrplugin/xml/ComponentDescriptorIO.java b/tools/org.apache.felix.scr.generator/src/main/java/org/apache/felix/scrplugin/xml/ComponentDescriptorIO.java
index 6c55e1c4c6..b749cc7f3f 100644
--- a/tools/org.apache.felix.scr.generator/src/main/java/org/apache/felix/scrplugin/xml/ComponentDescriptorIO.java
+++ b/tools/org.apache.felix.scr.generator/src/main/java/org/apache/felix/scrplugin/xml/ComponentDescriptorIO.java
@@ -32,6 +32,7 @@ import org.apache.felix.scrplugin.Options;
 import org.apache.felix.scrplugin.SCRDescriptorException;
 import org.apache.felix.scrplugin.SCRDescriptorFailureException;
 import org.apache.felix.scrplugin.SpecVersion;
+import org.apache.felix.scrplugin.description.AbstractDescription;
 import org.apache.felix.scrplugin.description.ClassDescription;
 import org.apache.felix.scrplugin.description.ComponentConfigurationPolicy;
 import org.apache.felix.scrplugin.description.ComponentDescription;
@@ -253,17 +254,16 @@ public class ComponentDescriptorIO {
         IOUtils.indent(contentHandler, indent);
         contentHandler.startElement(namespace, ComponentDescriptorIO.COMPONENT, ComponentDescriptorIO.COMPONENT_QNAME, ai);
         IOUtils.newline(contentHandler);
-        generateImplementationXML(container, contentHandler, indent+1);
-        if (container.getServiceDescription() != null) {
-            generateServiceXML(container.getServiceDescription(), contentHandler, indent+1);
-        }
         for (final PropertyDescription property : container.getProperties().values()) {
             generatePropertyXML(property, contentHandler, indent+1);
         }
-
+        if (container.getServiceDescription() != null) {
+            generateServiceXML(container.getServiceDescription(), contentHandler, indent+1);
+        }
         for (final ReferenceDescription reference : container.getReferences().values()) {
             generateReferenceXML(component, module, reference, contentHandler, indent+1);
         }
+        generateImplementationXML(container, contentHandler, indent+1);
 
         IOUtils.indent(contentHandler, indent);
         contentHandler.endElement(namespace, ComponentDescriptorIO.COMPONENT, ComponentDescriptorIO.COMPONENT_QNAME);
@@ -462,6 +462,9 @@ public class ComponentDescriptorIO {
         /** XML file location. */
         private final String location;
 
+        /** Properties. */
+        private final List<AbstractDescription> propsAndRefs = new ArrayList<AbstractDescription>();
+
         /** Classloader. */
         private final ClassLoader classLoader;
 
@@ -587,7 +590,7 @@ public class ComponentDescriptorIO {
                             } else {
                                 prop.setValue(attributes.getValue(PROPERTY_ATTR_VALUE));
                             }
-                            this.currentClass.add(prop);
+                            propsAndRefs.add(prop);
                         } else {
                             // hold the property pending as we have a multi value
                             this.pendingProperty = prop;
@@ -620,7 +623,6 @@ public class ComponentDescriptorIO {
                 } else if (localName.equals(SERVICE)) {
 
                     this.currentService = new ServiceDescription(null);
-                    this.currentClass.add(this.currentService);
 
                     if (attributes.getValue(SERVICE_ATTR_FACTORY) != null) {
                         this.currentService.setServiceFactory(Boolean.valueOf(attributes.getValue(SERVICE_ATTR_FACTORY)));
@@ -679,7 +681,7 @@ public class ComponentDescriptorIO {
                         }
                     }
 
-                    this.currentClass.add(ref);
+                    propsAndRefs.add(ref);
                 }
             }
         }
@@ -699,8 +701,18 @@ public class ComponentDescriptorIO {
 
             if (SpecVersion.fromNamespaceUrl(uri) != null) {
                 if (localName.equals(COMPONENT)) {
+                    if ( this.currentClass != null && this.currentService != null ) {
+                        this.currentClass.add(currentService);
+                    }
+                    if ( this.currentClass != null ) {
+                        for(final AbstractDescription d : propsAndRefs) {
+                            this.currentClass.add(d);
+                        }
+                    }
+                    this.propsAndRefs.clear();
                     this.currentClass = null;
                     this.currentComponent = null;
+                    this.currentService = null;
                     this.isComponent = false;
                 } else if (localName.equals(PROPERTY) && this.pendingProperty != null) {
                     // now split the value
@@ -720,7 +732,7 @@ public class ComponentDescriptorIO {
                         }
                         this.pendingProperty.setMultiValue(values);
                     }
-                    this.currentClass.add(this.pendingProperty);
+                    propsAndRefs.add(this.pendingProperty);
                     this.pendingProperty = null;
                 }
             }
