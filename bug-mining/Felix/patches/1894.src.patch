diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/AbstractComponentManager.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/AbstractComponentManager.java
index 2a1fbd046a..e214400d72 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/AbstractComponentManager.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/AbstractComponentManager.java
@@ -851,6 +851,8 @@ public abstract class AbstractComponentManager<S> implements Component, SimpleLo
         m_dependenciesCollected = false;
     }
 
+    abstract EdgeInfo getEdgeInfo( S implObject, DependencyManager<S, ?> dependencyManager);
+    
     abstract <T> void invokeUpdatedMethod( DependencyManager<S, T> dependencyManager, RefPair<T> refPair, int trackingCount );
 
     abstract <T> void invokeBindMethod( DependencyManager<S, T> dependencyManager, RefPair<T> refPair, int trackingCount );
@@ -966,9 +968,10 @@ public abstract class AbstractComponentManager<S> implements Component, SimpleLo
         // If this component has got dependencies, create dependency managers for each one of them.
         if ( metadata.getDependencies().size() != 0 )
         {
+            int index = 0;
             for ( ReferenceMetadata currentdependency: metadata.getDependencies() )
             {
-                DependencyManager depmanager = new DependencyManager( this, currentdependency );
+                DependencyManager depmanager = new DependencyManager( this, currentdependency, index++ );
 
                 depMgrList.add( depmanager );
             }
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/ComponentContextImpl.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/ComponentContextImpl.java
index 9df5fb3a95..70a67ef706 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/ComponentContextImpl.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/ComponentContextImpl.java
@@ -19,6 +19,7 @@
 package org.apache.felix.scr.impl.manager;
 
 
+import java.util.Arrays;
 import java.util.Dictionary;
 
 import org.apache.felix.scr.component.ExtComponentContext;
@@ -35,14 +36,31 @@ import org.osgi.service.component.ComponentInstance;
  */
 public class ComponentContextImpl implements ExtComponentContext, ComponentInstance {
 
-    private AbstractComponentManager m_componentManager;
+    private final AbstractComponentManager m_componentManager;
+    
+    private final EdgeInfo[] edgeInfos;
 
 
     ComponentContextImpl( AbstractComponentManager componentManager )
     {
         m_componentManager = componentManager;
+        edgeInfos = new EdgeInfo[componentManager.getComponentMetadata().getDependencies().size()];
+    }
+    
+    EdgeInfo getEdgeInfo(DependencyManager dm)
+    {
+        int index = dm.getIndex();
+        if (edgeInfos[index] == null)
+        {
+            edgeInfos[index] = new EdgeInfo();
+        }
+        return edgeInfos[index];
     }
 
+    void clearEdgeInfos()
+    {
+        Arrays.fill( edgeInfos, null );
+    }
 
     protected AbstractComponentManager getComponentManager()
     {
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/ComponentFactoryImpl.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/ComponentFactoryImpl.java
index 56fae25bed..8ff8956053 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/ComponentFactoryImpl.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/ComponentFactoryImpl.java
@@ -123,7 +123,7 @@ public class ComponentFactoryImpl<S> extends AbstractComponentManager<S> impleme
         cm.activateInternal( getTrackingCount().get() );
 
         instance = cm.getComponentInstance();
-        if ( instance == null )
+        if ( instance == null || instance.getInstance() == null )
         {
             // activation failed, clean up component manager
             cm.disposeInternal( ComponentConstants.DEACTIVATION_REASON_DISPOSED );
@@ -278,6 +278,11 @@ public class ComponentFactoryImpl<S> extends AbstractComponentManager<S> impleme
         return true;
     }
 
+    EdgeInfo getEdgeInfo( S implObject, DependencyManager<S, ?> dependencyManager) 
+    {
+        return null;
+    }
+
     <T> void invokeUpdatedMethod( DependencyManager<S, T> dependencyManager, RefPair<T> ref, int trackingCount )
     {
     }
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/DependencyManager.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/DependencyManager.java
index a0dd549c6c..e41c26ad20 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/DependencyManager.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/DependencyManager.java
@@ -67,6 +67,8 @@ public class DependencyManager<S, T> implements Reference
 
     // Reference to the metadata
     private final ReferenceMetadata m_dependencyMetadata;
+    
+    private final int m_index;
 
     private final AtomicReference<ServiceTracker<T, RefPair<T>>> trackerRef = new AtomicReference<ServiceTracker<T, RefPair<T>>>();
 
@@ -82,50 +84,16 @@ public class DependencyManager<S, T> implements Reference
 
     private boolean registered;
 
-    private final Map<S, EdgeInfo> edgeInfoMap = new IdentityHashMap<S, EdgeInfo>(  );
-
-    private static class EdgeInfo
-    {
-        private int open = -1;
-        private int close = -1;
-        private CountDownLatch latch;
-
-        public void setClose( int close )
-        {
-            this.close = close;
-        }
-
-        public CountDownLatch getLatch()
-        {
-            return latch;
-        }
-
-        public void setLatch( CountDownLatch latch )
-        {
-            this.latch = latch;
-        }
-
-        public void setOpen( int open )
-        {
-            this.open = open;
-        }
-
-        public boolean outOfRange( int trackingCount )
-        {
-            return (open != -1 && trackingCount < open)
-                || (close != -1 && trackingCount > close);
-        }
-    }
-
     /**
      * Constructor that receives several parameters.
-     *
      * @param dependency An object that contains data about the dependency
+     * @param index TODO
      */
-    DependencyManager( AbstractComponentManager<S> componentManager, ReferenceMetadata dependency )
+    DependencyManager( AbstractComponentManager<S> componentManager, ReferenceMetadata dependency, int index )
     {
         m_componentManager = componentManager;
         m_dependencyMetadata = dependency;
+        m_index = index;
         customizer = newCustomizer();
 
         // dump the reference information if DEBUG is enabled
@@ -140,6 +108,11 @@ public class DependencyManager<S, T> implements Reference
                             dependency.getCardinality(), dependency.getBind(), dependency.getUnbind() }, null );
         }
     }
+    
+    int getIndex() 
+    {
+        return m_index;
+    }   
 
     /**
      * Initialize binding methods.
@@ -1383,14 +1356,9 @@ public class DependencyManager<S, T> implements Reference
 
     private EdgeInfo getEdgeInfo( S componentInstance )
     {
-        EdgeInfo info = edgeInfoMap.get( componentInstance );
-        if ( info == null )
-        {
-            info = new EdgeInfo();
-            edgeInfoMap.put( componentInstance, info );
-        }
-        return info;
+        return m_componentManager.getEdgeInfo( componentInstance, this );
     }
+    
     /**
      * Revoke the given bindings. This method cannot throw an exception since
      * it must try to complete all that it can
@@ -1427,11 +1395,6 @@ public class DependencyManager<S, T> implements Reference
         latch.countDown();
     }
 
-    void cleanup( S componentInstance)
-    {
-        edgeInfoMap.remove( componentInstance );
-    }
-
     public void invokeBindMethodLate( final ServiceReference<T> ref, int trackingCount )
     {
         if ( !isSatisfied() )
@@ -1497,8 +1460,8 @@ public class DependencyManager<S, T> implements Reference
         {
             synchronized ( trackerRef.get().tracked() )
             {
-                EdgeInfo info = edgeInfoMap.get( componentInstance );
-                if (info != null && info.outOfRange( trackingCount ) )
+                EdgeInfo info = getEdgeInfo( componentInstance );
+                if (info.outOfRange( trackingCount ) )
                 {
                     //ignore events before open started or we will have duplicate binds.
                     return true;
@@ -1556,8 +1519,8 @@ public class DependencyManager<S, T> implements Reference
             }
             synchronized ( trackerRef.get().tracked() )
             {
-                EdgeInfo info = edgeInfoMap.get( componentInstance );
-                if (info != null && info.outOfRange( trackingCount ) )
+                EdgeInfo info = getEdgeInfo( componentInstance );
+                if (info.outOfRange( trackingCount ) )
                 {
                     //ignore events after close started or we will have duplicate unbinds.
                     return;
@@ -1608,9 +1571,9 @@ public class DependencyManager<S, T> implements Reference
             EdgeInfo info;
             synchronized ( trackerRef.get().tracked() )
             {
-                info = edgeInfoMap.get( componentInstance );
+                info = getEdgeInfo( componentInstance );
             }
-            if (info != null && info.outOfRange( trackingCount ) )
+            if (info.outOfRange( trackingCount ) )
             {
                 //wait for unbinds to complete
                 if (info.getLatch() != null)
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/EdgeInfo.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/EdgeInfo.java
new file mode 100644
index 0000000000..eae4d9a43b
--- /dev/null
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/EdgeInfo.java
@@ -0,0 +1,54 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one
+ * or more contributor license agreements.  See the NOTICE file
+ * distributed with this work for additional information
+ * regarding copyright ownership.  The ASF licenses this file
+ * to you under the Apache License, Version 2.0 (the
+ * "License"); you may not use this file except in compliance
+ * with the License.  You may obtain a copy of the License at
+ *
+ *   http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing,
+ * software distributed under the License is distributed on an
+ * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
+ * KIND, either express or implied.  See the License for the
+ * specific language governing permissions and limitations
+ * under the License.
+ */
+package org.apache.felix.scr.impl.manager;
+
+import java.util.concurrent.CountDownLatch;
+
+class EdgeInfo
+{
+    private int open = -1;
+    private int close = -1;
+    private CountDownLatch latch;
+
+    public void setClose( int close )
+    {
+        this.close = close;
+    }
+
+    public CountDownLatch getLatch()
+    {
+        return latch;
+    }
+
+    public void setLatch( CountDownLatch latch )
+    {
+        this.latch = latch;
+    }
+
+    public void setOpen( int open )
+    {
+        this.open = open;
+    }
+
+    public boolean outOfRange( int trackingCount )
+    {
+        return (open != -1 && trackingCount < open)
+            || (close != -1 && trackingCount > close);
+    }
+}
\ No newline at end of file
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/ImmediateComponentManager.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/ImmediateComponentManager.java
index a943602855..33af8c3ad8 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/ImmediateComponentManager.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/ImmediateComponentManager.java
@@ -121,11 +121,11 @@ public class ImmediateComponentManager<S> extends AbstractComponentManager<S> im
         if ( m_implementationObject == null )
         {
             final ComponentContextImpl tmpContext = new ComponentContextImpl( this );
+            m_componentContext = tmpContext;
             S tmpComponent = createImplementationObject( tmpContext, new SetImplementationObject<S>()
             {
                 public void setImplementationObject( S implementationObject )
                 {
-                    m_componentContext = tmpContext;
                     m_implementationObject = implementationObject;
                     m_tmpImplementationObject = null;
                 }
@@ -172,7 +172,7 @@ public class ImmediateComponentManager<S> extends AbstractComponentManager<S> im
             m_tmpImplementationObject = implementationObject;
             m_implementationObject = null;
             disposeImplementationObject( implementationObject, m_componentContext, reason );
-            m_implementationObject = null;
+            m_tmpImplementationObject = null;
             cleanupImplementationObject( implementationObject );
             log( LogService.LOG_DEBUG, "Unset and deconfigured implementation object for component {0} in deleteComponent for reason {1}", new Object[] { getName(), REASONS[ reason ] },  null );
             m_componentContext = null;
@@ -342,12 +342,7 @@ public class ImmediateComponentManager<S> extends AbstractComponentManager<S> im
 
     protected void cleanupImplementationObject( Object implementationObject )
     {
-
-        for ( DependencyManager md: getReversedDependencyManagers() )
-        {
-            md.cleanup( implementationObject );
-        }
-
+        m_componentContext.clearEdgeInfos();
     }
 
     State getSatisfiedState()
@@ -359,11 +354,10 @@ public class ImmediateComponentManager<S> extends AbstractComponentManager<S> im
     {
         return Active.getInstance();
     }
-
-    <T> void invokeUpdatedMethod( DependencyManager<S, T> dependencyManager, RefPair<T> refPair, int trackingCount )
+    
+    EdgeInfo getEdgeInfo( S implObject, DependencyManager<S, ?> dependencyManager) 
     {
-        final S impl = ( m_tmpImplementationObject != null ) ? m_tmpImplementationObject : m_implementationObject;
-        dependencyManager.invokeUpdatedMethod( impl, refPair, trackingCount );
+        return m_componentContext.getEdgeInfo( dependencyManager );
     }
 
     <T> void invokeBindMethod( DependencyManager<S, T> dependencyManager, RefPair<T> refPair, int trackingCount )
@@ -372,6 +366,12 @@ public class ImmediateComponentManager<S> extends AbstractComponentManager<S> im
         dependencyManager.invokeBindMethod( impl, refPair, trackingCount );
     }
 
+    <T> void invokeUpdatedMethod( DependencyManager<S, T> dependencyManager, RefPair<T> refPair, int trackingCount )
+    {
+        final S impl = ( m_tmpImplementationObject != null ) ? m_tmpImplementationObject : m_implementationObject;
+        dependencyManager.invokeUpdatedMethod( impl, refPair, trackingCount );
+    }
+
     <T> void invokeUnbindMethod( DependencyManager<S, T> dependencyManager, RefPair<T> oldRefPair, int trackingCount )
     {
         final S impl = ( m_tmpImplementationObject != null ) ? m_tmpImplementationObject : m_implementationObject;
diff --git a/scr/src/main/java/org/apache/felix/scr/impl/manager/ServiceFactoryComponentManager.java b/scr/src/main/java/org/apache/felix/scr/impl/manager/ServiceFactoryComponentManager.java
index 749b7c1564..92f5823fa0 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/manager/ServiceFactoryComponentManager.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/manager/ServiceFactoryComponentManager.java
@@ -143,7 +143,6 @@ public class ServiceFactoryComponentManager<S> extends ImmediateComponentManager
             {
                 serviceContext.setImplementationObject( implementationObject );
                 serviceContexts.put( implementationObject, serviceContext );
-
             }
 
 
@@ -201,6 +200,16 @@ public class ServiceFactoryComponentManager<S> extends ImmediateComponentManager
         }
     }
 
+    EdgeInfo getEdgeInfo( S implObject, DependencyManager<S, ?> dependencyManager) 
+    {
+        return serviceContexts.get( implObject ).getEdgeInfo( dependencyManager );
+    }
+
+    protected void cleanupImplementationObject( Object implementationObject )
+    {
+        serviceContexts.get( implementationObject ).clearEdgeInfos();
+    }
+
     <T> void invokeBindMethod( DependencyManager<S, T> dependencyManager, RefPair<T> refPair, int trackingCount )
     {
         for ( S implementationObject : serviceContexts.keySet() )
diff --git a/scr/src/test/java/org/apache/felix/scr/integration/ComponentTestBase.java b/scr/src/test/java/org/apache/felix/scr/integration/ComponentTestBase.java
index b88ec11e4f..df5e10de65 100644
--- a/scr/src/test/java/org/apache/felix/scr/integration/ComponentTestBase.java
+++ b/scr/src/test/java/org/apache/felix/scr/integration/ComponentTestBase.java
@@ -114,7 +114,7 @@ public abstract class ComponentTestBase
 
     protected static boolean NONSTANDARD_COMPONENT_FACTORY_BEHAVIOR = false;
     protected volatile Log log;
-
+    
     //set to true to only get last 1000 lines of log.
     protected static boolean restrictedLogging;
     
@@ -677,6 +677,8 @@ public abstract class ComponentTestBase
         private volatile PrintStream m_realOut;
         private volatile PrintStream m_realErr;
 
+        protected Throwable firstFrameworkThrowable;
+
         private final boolean restrictedLogging;
         private final String[] log = new String[1000];
         private int i = 0;
@@ -732,6 +734,12 @@ public abstract class ComponentTestBase
         {
             return m_warnings;
         }
+        
+        Throwable getFirstFrameworkThrowable()
+        {
+            return firstFrameworkThrowable;
+        }
+
 
 
         public void run()
@@ -767,6 +775,7 @@ public abstract class ComponentTestBase
                         sw.append( System.getProperty( "line.separator" ) );
                         PrintWriter pw = new PrintWriter( sw );
                         entry.getError().printStackTrace( pw );
+                        pw.flush();
                     }
                     if ( restrictedLogging )
                     {
@@ -795,6 +804,10 @@ public abstract class ComponentTestBase
             String msg = getFrameworkEventMessage( eventType );
             int level = ( eventType == FrameworkEvent.ERROR ) ? LogService.LOG_ERROR : LogService.LOG_WARNING;
             log( level, msg, event.getThrowable() );
+            if (event.getThrowable() != null && firstFrameworkThrowable == null)
+            {
+                firstFrameworkThrowable = event.getThrowable();
+            }
         }
 
 
diff --git a/scr/src/test/java/org/apache/felix/scr/integration/Felix3680_2Test.java b/scr/src/test/java/org/apache/felix/scr/integration/Felix3680_2Test.java
index 701508ed9b..c232ca6da8 100644
--- a/scr/src/test/java/org/apache/felix/scr/integration/Felix3680_2Test.java
+++ b/scr/src/test/java/org/apache/felix/scr/integration/Felix3680_2Test.java
@@ -63,19 +63,25 @@ public class Felix3680_2Test extends ComponentTestBase
 
 
     @Test
-    public void test_concurrent_injection_with_bundleContext()
+    public void test_concurrent_injection_with_bundleContext() throws Throwable
     {
-        final Component main = findComponentByName( "org.apache.felix.scr.integration.components.felix3680_2.Main" );
-        TestCase.assertNotNull( main );
-        main.enable();
-
-        delay( 30 );
-        main.disable();
-        delay(); //async deactivate
-        for ( Iterator it = log.foundWarnings().iterator(); it.hasNext(); )
+        for ( int i = 0; i < 6; i++ )
         {
-            String message = ( String ) it.next();
-            TestCase.fail( "unexpected warning or error logged: " + message );
+            final Component main = findComponentByName( "org.apache.felix.scr.integration.components.felix3680_2.Main" );
+            TestCase.assertNotNull( main );
+            main.enable();
+            delay( 5 ); //run test for 30 seconds
+            main.disable();
+            delay(); //async deactivate
+            if ( log.getFirstFrameworkThrowable() != null )
+            {
+                throw log.getFirstFrameworkThrowable();
+            }
+            for ( Iterator it = log.foundWarnings().iterator(); it.hasNext(); )
+            {
+                String message = ( String ) it.next();
+                TestCase.fail( "unexpected warning or error logged: " + message );
+            }
         }
     }
 }
diff --git a/scr/src/test/java/org/apache/felix/scr/integration/components/felix3680_2/Main.java b/scr/src/test/java/org/apache/felix/scr/integration/components/felix3680_2/Main.java
index ecb6cb2ddf..91539ac031 100644
--- a/scr/src/test/java/org/apache/felix/scr/integration/components/felix3680_2/Main.java
+++ b/scr/src/test/java/org/apache/felix/scr/integration/components/felix3680_2/Main.java
@@ -202,19 +202,29 @@ public class Main implements Runnable
         new Thread( this ).start();
     }
 
-    void stop()
+    void stop() throws InterruptedException
     {
-        running = false;
+        synchronized ( this )
+        {
+            running = false;
+        }
+        if (m_enabledLatch != null) 
+        {
+            m_enabledLatch.await( 1, TimeUnit.MILLISECONDS );
+        }
+        if (m_disabledLatch != null) 
+        {
+            m_disabledLatch.await( 1, TimeUnit.MILLISECONDS );
+        }
     }
 
 
     public void run()
     {
         int loop = 0;
-        while ( running )
+        while ( iterate() )
         {
-            m_enabledLatch = new CountDownLatch( 11 ); // 10 for registrations of B,C,D,E,F,G,H,I,J,K + 1 for Main.bindA
-            m_disabledLatch = new CountDownLatch( 11 ); // 10 for unregistrations of B,C,D,E,F,G,H,I,J,K + 1 for Main.unbindA
+            
 
             RegistrationHelper registry = new RegistrationHelper();
             registry.registerBCDEFGHIJK( m_exec );
@@ -258,6 +268,17 @@ public class Main implements Runnable
         }
     }
 
+
+    private synchronized boolean iterate()
+    {
+        if ( running )
+        {
+            m_enabledLatch = new CountDownLatch( 11 ); // 10 for registrations of B,C,D,E,F,G,H,I,J,K + 1 for Main.bindA
+            m_disabledLatch = new CountDownLatch( 11 ); // 10 for unregistrations of B,C,D,E,F,G,H,I,J,K + 1 for Main.unbindA
+        }
+        return running;
+    }
+
     private String dumpThreads()
     {
         ThreadMXBean threadMXBean = ManagementFactory.getThreadMXBean();
