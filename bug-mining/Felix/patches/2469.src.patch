diff --git a/framework/src/main/java/org/apache/felix/framework/ServiceRegistry.java b/framework/src/main/java/org/apache/felix/framework/ServiceRegistry.java
index 46334cef76..be78da4830 100644
--- a/framework/src/main/java/org/apache/felix/framework/ServiceRegistry.java
+++ b/framework/src/main/java/org/apache/felix/framework/ServiceRegistry.java
@@ -452,12 +452,17 @@ public class ServiceRegistry
 
                     if (svc != null)
                     {
-                        if (usage.m_svcHolderRef.compareAndSet(holder, null))
+                        // Check the count again to ensure that nobody else has just
+                        // obtained the service again
+                        if (usage.m_count.get() <= 0)
                         {
-                            // Remove reference from usages array.
-                            ((ServiceRegistrationImpl.ServiceReferenceImpl) ref)
-                                .getRegistration().ungetService(bundle, svc);
+                            if (usage.m_svcHolderRef.compareAndSet(holder, null))
+                            {
+                                // Remove reference from usages array.
+                                ((ServiceRegistrationImpl.ServiceReferenceImpl) ref)
+                                    .getRegistration().ungetService(bundle, svc);
 
+                            }
                         }
                     }
                 }
diff --git a/framework/src/test/java/org/apache/felix/framework/ServiceRegistryTest.java b/framework/src/test/java/org/apache/felix/framework/ServiceRegistryTest.java
index 440617d158..ecb7e2e9a9 100644
--- a/framework/src/test/java/org/apache/felix/framework/ServiceRegistryTest.java
+++ b/framework/src/test/java/org/apache/felix/framework/ServiceRegistryTest.java
@@ -1053,14 +1053,12 @@ public class ServiceRegistryTest extends TestCase
 
                     final class ObserverImpl implements Observer
                     {
-//                        private volatile int counter = 0;
                         private final AtomicInteger counter = new AtomicInteger();
                         public volatile boolean active = true;
 
                         @Override
                         public void update(Observable o, Object arg)
                         {
-//                            counter++; // Not completely atomic, but that doesn't matter here.
                             counter.incrementAndGet();
                             if ( !active )
                             {
