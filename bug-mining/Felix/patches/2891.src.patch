diff --git a/utils/src/main/java/org/apache/felix/utils/properties/Properties.java b/utils/src/main/java/org/apache/felix/utils/properties/Properties.java
index bb327271ac..808b0e0a12 100644
--- a/utils/src/main/java/org/apache/felix/utils/properties/Properties.java
+++ b/utils/src/main/java/org/apache/felix/utils/properties/Properties.java
@@ -281,6 +281,10 @@ public class Properties extends AbstractMap<String, String> {
         return old;
     }
 
+    void putAllSubstituted(Map<? extends String, ? extends String> m) {
+        storage.putAll(m);
+    }
+
     public String put(String key, List<String> commentLines, List<String> valueLines) {
         commentLines = new ArrayList<String>(commentLines);
         valueLines = new ArrayList<String>(valueLines);
diff --git a/utils/src/main/java/org/apache/felix/utils/properties/TypedProperties.java b/utils/src/main/java/org/apache/felix/utils/properties/TypedProperties.java
index 8ff0a7f0c4..c69fc41189 100644
--- a/utils/src/main/java/org/apache/felix/utils/properties/TypedProperties.java
+++ b/utils/src/main/java/org/apache/felix/utils/properties/TypedProperties.java
@@ -336,7 +336,7 @@ public class TypedProperties extends AbstractMap<String, Object> {
             ((DynamicMap) map).init(callback, finalSubstitution);
         }
         for (Map.Entry<String, TypedProperties> entry : properties.entrySet()) {
-            entry.getValue().storage.putAll(dynamic.get(entry.getKey()));
+            entry.getValue().storage.putAllSubstituted(dynamic.get(entry.getKey()));
         }
     }
 
diff --git a/utils/src/test/java/org/apache/felix/utils/properties/PropertiesTest.java b/utils/src/test/java/org/apache/felix/utils/properties/PropertiesTest.java
index 9cb5f89860..b3be38c266 100644
--- a/utils/src/test/java/org/apache/felix/utils/properties/PropertiesTest.java
+++ b/utils/src/test/java/org/apache/felix/utils/properties/PropertiesTest.java
@@ -340,4 +340,17 @@ public class PropertiesTest extends TestCase {
         assertEquals(Arrays.asList("#", "# List of good fruits", "#"), p1.getComments("fruits"));
         assertEquals("apple, banana, pear", p1.getProperty("fruits"));
     }
+
+    public void testSubstitution() throws IOException
+    {
+        String str = "port = 4141\n" +
+                "host = localhost\n" +
+                "url = https://${host}:${port}/service\n";
+        Properties properties = new Properties();
+        properties.load(new StringReader(str));
+        properties.put("url", "https://localhost:4141/service");
+        StringWriter sw = new StringWriter();
+        properties.save(sw);
+        assertEquals(str, sw.toString());
+    }
 }
diff --git a/utils/src/test/java/org/apache/felix/utils/properties/TypedPropertiesTest.java b/utils/src/test/java/org/apache/felix/utils/properties/TypedPropertiesTest.java
index 994ebe7cec..d0b84995b4 100644
--- a/utils/src/test/java/org/apache/felix/utils/properties/TypedPropertiesTest.java
+++ b/utils/src/test/java/org/apache/felix/utils/properties/TypedPropertiesTest.java
@@ -99,4 +99,16 @@ public class TypedPropertiesTest extends TestCase {
         assertEquals("key = F\"1137191584\"\n", sw.toString());
     }
 
+    public void testSubstitution() throws IOException
+    {
+        String str = "port = 4141\n" +
+                     "host = localhost\n" +
+                     "url = https://${host}:${port}/service\n";
+        TypedProperties properties = new TypedProperties();
+        properties.load(new StringReader(str));
+        properties.put("url", "https://localhost:4141/service");
+        StringWriter sw = new StringWriter();
+        properties.save(sw);
+        assertEquals(str, sw.toString());
+    }
 }
