diff --git a/http/base/src/main/java/org/apache/felix/http/base/internal/HttpServiceController.java b/http/base/src/main/java/org/apache/felix/http/base/internal/HttpServiceController.java
index ad1d4f9fb5..7f737ba939 100644
--- a/http/base/src/main/java/org/apache/felix/http/base/internal/HttpServiceController.java
+++ b/http/base/src/main/java/org/apache/felix/http/base/internal/HttpServiceController.java
@@ -84,7 +84,7 @@ public final class HttpServiceController
                 @Override
                 public void sessionDestroyed(final HttpSessionEvent se) {
                     registry.getRegistry(HttpServiceFactory.HTTP_SERVICE_CONTEXT_SERVICE_ID).getEventListenerRegistry().sessionDestroyed(se);
-                    whiteboardManager.sessionDestroyed(se.getSession(), HttpSessionWrapper.getSessionContextIds(se.getSession()));
+                    whiteboardManager.sessionDestroyed(se.getSession(), HttpSessionWrapper.getSessionContextNames(se.getSession()));
                 }
 
                 @Override
@@ -102,7 +102,7 @@ public final class HttpServiceController
 
             @Override
             public void sessionIdChanged(final HttpSessionEvent event, final String oldSessionId) {
-                whiteboardManager.sessionIdChanged(event, oldSessionId, HttpSessionWrapper.getSessionContextIds(event.getSession()));
+                whiteboardManager.sessionIdChanged(event, oldSessionId, HttpSessionWrapper.getSessionContextNames(event.getSession()));
             }
         };
     }
diff --git a/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/Dispatcher.java b/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/Dispatcher.java
index d40fce37b7..4a9cf6410e 100644
--- a/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/Dispatcher.java
+++ b/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/Dispatcher.java
@@ -81,8 +81,8 @@ public final class Dispatcher
         final HttpSession session = req.getSession(false);
         if ( session != null )
         {
-            final Set<Long> ids = HttpSessionWrapper.getExpiredSessionContextIds(session);
-            mgr.sessionDestroyed(session, ids);
+            final Set<String> names = HttpSessionWrapper.getExpiredSessionContextNames(session);
+            mgr.sessionDestroyed(session, names);
         }
 
         {
@@ -115,7 +115,6 @@ public final class Dispatcher
 		        final RequestInfo requestInfo = new RequestInfo(pr.servletPath, pr.pathInfo, null, req.getRequestURI());
 
 		        final HttpServletRequest wrappedRequest = new ServletRequestWrapper(req, servletContext, requestInfo, null,
-		                pr.handler.getContextServiceId(),
 		                pr.handler.getServletInfo().isAsyncSupported(),
 		                pr.handler.getMultipartConfig());
 		        final FilterHandler[] filterHandlers = handlerRegistry.getFilters(pr, req.getDispatcherType(), pr.requestURI);
diff --git a/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/RequestDispatcherImpl.java b/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/RequestDispatcherImpl.java
index a22bafd0f9..406f62cebf 100644
--- a/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/RequestDispatcherImpl.java
+++ b/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/RequestDispatcherImpl.java
@@ -64,7 +64,6 @@ public final class RequestDispatcherImpl implements RequestDispatcher
                     this.resolution.handler.getContext(),
                     this.requestInfo,
                     DispatcherType.FORWARD,
-                    this.resolution.handler.getContextServiceId(),
                     this.resolution.handler.getServletInfo().isAsyncSupported(),
                     this.resolution.handler.getMultipartConfig());
             final String requestURI = UriUtils.concat(this.requestInfo.servletPath, this.requestInfo.pathInfo);
@@ -101,7 +100,6 @@ public final class RequestDispatcherImpl implements RequestDispatcher
                 this.resolution.handler.getContext(),
                 this.requestInfo,
                 DispatcherType.INCLUDE,
-                this.resolution.handler.getContextServiceId(),
                 this.resolution.handler.getServletInfo().isAsyncSupported(),
                 this.resolution.handler.getMultipartConfig());
         final String requestURI = UriUtils.concat(this.requestInfo.servletPath, this.requestInfo.pathInfo);
diff --git a/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/ServletRequestWrapper.java b/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/ServletRequestWrapper.java
index c3fb45c2a3..518a3f7bbd 100644
--- a/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/ServletRequestWrapper.java
+++ b/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/ServletRequestWrapper.java
@@ -64,7 +64,6 @@ final class ServletRequestWrapper extends HttpServletRequestWrapper
     private final DispatcherType type;
     private final RequestInfo requestInfo;
     private final ExtServletContext servletContext;
-    private final long contextId;
     private final boolean asyncSupported;
     private final MultipartConfig multipartConfig;
     private Collection<Part> parts;
@@ -73,7 +72,6 @@ final class ServletRequestWrapper extends HttpServletRequestWrapper
             ExtServletContext servletContext,
             RequestInfo requestInfo,
             DispatcherType type,
-            final Long contextId,
             final boolean asyncSupported,
             final MultipartConfig multipartConfig)
     {
@@ -84,7 +82,6 @@ final class ServletRequestWrapper extends HttpServletRequestWrapper
         this.servletContext = servletContext;
         this.requestInfo = requestInfo;
         this.type = type;
-        this.contextId = contextId;
     }
 
     @Override
@@ -255,11 +252,11 @@ final class ServletRequestWrapper extends HttpServletRequestWrapper
             return null;
         }
         // check if internal session is available
-        if ( !create && !HttpSessionWrapper.hasSession(this.contextId, session) )
+        if ( !create && !HttpSessionWrapper.hasSession(this.servletContext.getServletContextName(), session) )
         {
             return null;
         }
-        return new HttpSessionWrapper(this.contextId, session, this.servletContext, false);
+        return new HttpSessionWrapper(session, this.servletContext, false);
     }
 
     @Override
diff --git a/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/ServletResponseWrapper.java b/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/ServletResponseWrapper.java
index 9ee0ad093c..cc6c9dd646 100644
--- a/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/ServletResponseWrapper.java
+++ b/http/base/src/main/java/org/apache/felix/http/base/internal/dispatch/ServletResponseWrapper.java
@@ -107,7 +107,7 @@ final class ServletResponseWrapper extends HttpServletResponseWrapper
 
                         final ServletRequestWrapper reqWrapper = new ServletRequestWrapper(request,
                                 errorResolution.getContext(),
-                                requestInfo, null, errorResolution.getContextServiceId(), false, null);
+                                requestInfo, null, false, null);
                         final FilterChain filterChain = new InvocationChain(errorResolution, filterHandlers);
                         filterChain.doFilter(reqWrapper, this);
 
diff --git a/http/base/src/main/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapper.java b/http/base/src/main/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapper.java
index 3dff4712a8..a6e00d43c7 100644
--- a/http/base/src/main/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapper.java
+++ b/http/base/src/main/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapper.java
@@ -87,21 +87,20 @@ public class HttpSessionWrapper implements HttpSession
      */
     private final boolean isNew;
 
-    public static boolean hasSession(final long contextId, final HttpSession session)
+    public static boolean hasSession(final String contextName, final HttpSession session)
     {
-        final String sessionId = String.valueOf(contextId);
-        return session.getAttribute(ATTR_CREATED + sessionId) != null;
+        return session.getAttribute(ATTR_CREATED.concat(contextName)) != null;
     }
 
-    public static Set<Long> getExpiredSessionContextIds(final HttpSession session)
+    public static Set<String> getExpiredSessionContextNames(final HttpSession session)
     {
         final long now = System.currentTimeMillis();
 
-        final Set<Long> ids = new HashSet<Long>();
-        final Enumeration<String> names = session.getAttributeNames();
-        while (names.hasMoreElements())
+        final Set<String> names = new HashSet<String>();
+        final Enumeration<String> attrNames = session.getAttributeNames();
+        while (attrNames.hasMoreElements())
         {
-            final String name = names.nextElement();
+            final String name = attrNames.nextElement();
             if (name.startsWith(ATTR_LAST_ACCESSED))
             {
                 final String id = name.substring(ATTR_LAST_ACCESSED.length());
@@ -111,77 +110,72 @@ public class HttpSessionWrapper implements HttpSession
 
                 if ((maxTimeout > 0) && (lastAccess + maxTimeout) < now)
                 {
-                    ids.add(Long.valueOf(id));
+                    names.add(id);
                 }
             }
         }
-        return ids;
+        return names;
     }
 
-    public static Set<Long> getSessionContextIds(final HttpSession session)
+    /**
+     * Get the names of all contexts using a session.
+     * @param session The underlying session
+     * @return The set of names
+     */
+    public static Set<String> getSessionContextNames(final HttpSession session)
     {
-        final Set<Long> ids = new HashSet<Long>();
-        final Enumeration<String> names = session.getAttributeNames();
-        while (names.hasMoreElements())
+        final Set<String> names = new HashSet<String>();
+        final Enumeration<String> attrNames = session.getAttributeNames();
+        while (attrNames.hasMoreElements())
         {
-            final String name = names.nextElement();
+            final String name = attrNames.nextElement();
             if (name.startsWith(ATTR_LAST_ACCESSED))
             {
                 final String id = name.substring(ATTR_LAST_ACCESSED.length());
-                ids.add(Long.valueOf(id));
+                names.add(id);
             }
         }
-        return ids;
+        return names;
     }
 
     /**
      * Creates a new {@link HttpSessionWrapper} instance.
      */
-    public HttpSessionWrapper(final long contextId,
-            final HttpSession session,
+    public HttpSessionWrapper(final HttpSession session,
             final ExtServletContext context,
             final boolean terminate)
     {
         this.delegate = session;
         this.context = context;
-        this.sessionId = String.valueOf(contextId);
+        this.sessionId = context.getServletContextName();
         this.keyPrefix = ATTR_PREFIX + this.sessionId + ".";
 
-        if ( this.keyPrefix != null )
+        final long now = System.currentTimeMillis();
+        if ( session.getAttribute(ATTR_CREATED + this.sessionId) == null )
         {
-            final long now = System.currentTimeMillis();
-            if ( session.getAttribute(ATTR_CREATED + this.sessionId) == null )
-            {
-                this.created = now;
-                this.maxTimeout = session.getMaxInactiveInterval();
-                this.isNew = true;
-
-                session.setAttribute(ATTR_CREATED + this.sessionId, this.created);
-                session.setAttribute(ATTR_MAX_INACTIVE + this.sessionId, this.maxTimeout);
+            this.created = now;
+            this.maxTimeout = session.getMaxInactiveInterval();
+            this.isNew = true;
 
-                if ( context.getHttpSessionListener() != null )
-                {
-                    context.getHttpSessionListener().sessionCreated(new HttpSessionEvent(this));
-                }
-            }
-            else
-            {
-                this.created = (Long)session.getAttribute(ATTR_CREATED + this.sessionId);
-                this.maxTimeout = (Integer)session.getAttribute(ATTR_MAX_INACTIVE + this.sessionId);
-                this.isNew = false;
-            }
+            session.setAttribute(ATTR_CREATED + this.sessionId, this.created);
+            session.setAttribute(ATTR_MAX_INACTIVE + this.sessionId, this.maxTimeout);
 
-            this.lastAccessed = now;
-            if ( !terminate )
+            if ( context.getHttpSessionListener() != null )
             {
-                session.setAttribute(ATTR_LAST_ACCESSED + this.sessionId, this.lastAccessed);
+                context.getHttpSessionListener().sessionCreated(new HttpSessionEvent(this));
             }
         }
         else
         {
-            this.isNew = session.isNew();
-            this.lastAccessed = session.getLastAccessedTime();
-            this.created = session.getCreationTime();
+            this.created = (Long)session.getAttribute(ATTR_CREATED + this.sessionId);
+            this.maxTimeout = (Integer)session.getAttribute(ATTR_MAX_INACTIVE + this.sessionId);
+            this.isNew = false;
+        }
+
+        this.lastAccessed = now;
+        if ( !terminate )
+        {
+            session.setAttribute(ATTR_LAST_ACCESSED + this.sessionId, this.lastAccessed);
         }
     }
 
@@ -190,7 +184,7 @@ public class HttpSessionWrapper implements HttpSession
      */
     private String getKey(final String name)
     {
-        return this.keyPrefix == null ? name : this.keyPrefix.concat(name);
+        return this.keyPrefix.concat(name);
     }
 
     /**
@@ -231,10 +225,6 @@ public class HttpSessionWrapper implements HttpSession
                 while ( e.hasMoreElements() )
                 {
                     final String name = e.nextElement();
-                    if ( keyPrefix == null && !name.startsWith(PREFIX) )
-                    {
-                        return name;
-                    }
                     if ( name.startsWith(keyPrefix))
                     {
                         return name.substring(keyPrefix.length());
@@ -325,26 +315,22 @@ public class HttpSessionWrapper implements HttpSession
             context.getHttpSessionListener().sessionDestroyed(new HttpSessionEvent(this));
         }
 
-        if ( this.keyPrefix != null )
-        {
-            this.delegate.removeAttribute(ATTR_CREATED + this.sessionId);
-            this.delegate.removeAttribute(ATTR_LAST_ACCESSED + this.sessionId);
-            this.delegate.removeAttribute(ATTR_MAX_INACTIVE + this.sessionId);
+        this.delegate.removeAttribute(ATTR_CREATED + this.sessionId);
+        this.delegate.removeAttribute(ATTR_LAST_ACCESSED + this.sessionId);
+        this.delegate.removeAttribute(ATTR_MAX_INACTIVE + this.sessionId);
 
-            final Enumeration<String> names = this.delegate.getAttributeNames();
-            while ( names.hasMoreElements() )
-            {
-                final String name = names.nextElement();
+        final Enumeration<String> names = this.delegate.getAttributeNames();
+        while ( names.hasMoreElements() )
+        {
+            final String name = names.nextElement();
 
-                if ( name.startsWith(this.keyPrefix) ) {
-                    this.removeAttribute(name.substring(this.keyPrefix.length()));
-                }
+            if ( name.startsWith(this.keyPrefix) ) {
+                this.removeAttribute(name.substring(this.keyPrefix.length()));
             }
         }
 
         // if the session is empty we can invalidate
-        final Enumeration<String> names = this.delegate.getAttributeNames();
-        if ( !names.hasMoreElements() )
+        if ( !this.delegate.getAttributeNames().hasMoreElements() )
         {
             this.delegate.invalidate();
         }
@@ -373,7 +359,7 @@ public class HttpSessionWrapper implements HttpSession
         if ( oldValue != null )
         {
             this.delegate.removeAttribute(this.getKey(name));
-            if ( this.keyPrefix != null && oldValue instanceof HttpSessionBindingListener )
+            if ( oldValue instanceof HttpSessionBindingListener )
             {
                 ((HttpSessionBindingListener)oldValue).valueUnbound(new HttpSessionBindingEvent(this, name));
             }
@@ -402,7 +388,7 @@ public class HttpSessionWrapper implements HttpSession
 
         final Object oldValue = this.getAttribute(name);
         // wrap http session binding listener to avoid container calling it!
-        if ( this.keyPrefix != null && value instanceof HttpSessionBindingListener )
+        if ( value instanceof HttpSessionBindingListener )
         {
             this.delegate.setAttribute(this.getKey(name),
                     new SessionBindingValueListenerWrapper((HttpSessionBindingListener)value));
@@ -411,7 +397,7 @@ public class HttpSessionWrapper implements HttpSession
         {
             this.delegate.setAttribute(this.getKey(name), value);
         }
-        if ( this.keyPrefix != null && value instanceof HttpSessionBindingListener )
+        if ( value instanceof HttpSessionBindingListener )
         {
             ((HttpSessionBindingListener)value).valueBound(new HttpSessionBindingEvent(this, name));
         }
@@ -436,11 +422,8 @@ public class HttpSessionWrapper implements HttpSession
         {
             this.delegate.setMaxInactiveInterval(interval);
         }
-        if ( this.keyPrefix != null )
-        {
-            this.maxTimeout = interval;
-            this.delegate.setAttribute(ATTR_MAX_INACTIVE + this.sessionId, interval);
-        }
+        this.maxTimeout = interval;
+        this.delegate.setAttribute(ATTR_MAX_INACTIVE + this.sessionId, interval);
     }
 
     @Override
diff --git a/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/SharedServletContextImpl.java b/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/SharedServletContextImpl.java
index e497573d27..f858bdf033 100644
--- a/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/SharedServletContextImpl.java
+++ b/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/SharedServletContextImpl.java
@@ -425,7 +425,6 @@ public class SharedServletContextImpl implements ServletContext
         return this.context.getSessionCookieConfig();
     }
 
-    @SuppressWarnings("deprecation")
     @Override
     public void log(final Exception cause, final String message)
     {
diff --git a/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/WhiteboardManager.java b/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/WhiteboardManager.java
index 980612ebb7..1fe7e5687a 100644
--- a/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/WhiteboardManager.java
+++ b/http/base/src/main/java/org/apache/felix/http/base/internal/whiteboard/WhiteboardManager.java
@@ -244,15 +244,15 @@ public final class WhiteboardManager
         this.webContext = null;
     }
 
-    public void sessionDestroyed(@Nonnull final HttpSession session, final Set<Long> contextIds)
+    public void sessionDestroyed(@Nonnull final HttpSession session, final Set<String> contextNames)
     {
-        for(final Long contextId : contextIds)
+        for(final String contextName : contextNames)
         {
-            final WhiteboardContextHandler handler = this.getContextHandler(contextId);
+            final WhiteboardContextHandler handler = this.getContextHandler(contextName);
             if ( handler != null )
             {
                 final ExtServletContext context = handler.getServletContext(this.httpBundleContext.getBundle());
-                new HttpSessionWrapper(contextId, session, context, true).invalidate();
+                new HttpSessionWrapper(session, context, true).invalidate();
                 handler.ungetServletContext(this.httpBundleContext.getBundle());
             }
         }
@@ -264,11 +264,11 @@ public final class WhiteboardManager
      * @param oldSessionId The old session id
      * @param contextIds The context ids using that session
      */
-    public void sessionIdChanged(@Nonnull final HttpSessionEvent event, final String oldSessionId, final Set<Long> contextIds)
+    public void sessionIdChanged(@Nonnull final HttpSessionEvent event, final String oldSessionId, final Set<String> contextNames)
     {
-        for(final Long contextId : contextIds)
+        for(final String contextName : contextNames)
         {
-            final WhiteboardContextHandler handler = this.getContextHandler(contextId);
+            final WhiteboardContextHandler handler = this.getContextHandler(contextName);
             if ( handler != null )
             {
                 handler.getRegistry().getEventListenerRegistry().sessionIdChanged(event, oldSessionId);
@@ -856,14 +856,14 @@ public final class WhiteboardManager
         return true;
     }
 
-    private WhiteboardContextHandler getContextHandler(final Long contextId)
+    private WhiteboardContextHandler getContextHandler(final String name)
     {
         synchronized ( this.contextMap )
         {
             for(final List<WhiteboardContextHandler> handlerList : this.contextMap.values())
             {
                 final WhiteboardContextHandler h = handlerList.get(0);
-                if ( h.getContextInfo().getServiceId() == contextId )
+                if ( h.getContextInfo().getName().equals(name) )
                 {
                     return h;
                 }
diff --git a/http/base/src/test/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapperTest.java b/http/base/src/test/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapperTest.java
index 3904d942fb..71857a328a 100644
--- a/http/base/src/test/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapperTest.java
+++ b/http/base/src/test/java/org/apache/felix/http/base/internal/handler/HttpSessionWrapperTest.java
@@ -19,14 +19,16 @@
 
 package org.apache.felix.http.base.internal.handler;
 
-import static org.mockito.Mockito.*;
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertTrue;
+import static org.mockito.Matchers.eq;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.when;
 
 import java.util.Arrays;
 import java.util.Collections;
 import java.util.Set;
 
-import static org.junit.Assert.*;
-
 import javax.servlet.http.HttpSession;
 
 import org.junit.Test;
@@ -38,33 +40,33 @@ public class HttpSessionWrapperTest
 {
 
     /**
-     * FELIX-5175 - sessions are incorrectly destroyed / destroyed too soon. 
+     * FELIX-5175 - sessions are incorrectly destroyed / destroyed too soon.
      */
     @Test
     public void testSessionTimeout() throws Exception
     {
-        Set<Long> ids;
+        Set<String> names;
 
-        long sessionID = 123;
+        String contextName = "default";
         long now = System.currentTimeMillis();
 
-        HttpSession session = createMockSession(sessionID, now, 1);
+        HttpSession session = createMockSession(contextName, now, 1);
 
-        ids = HttpSessionWrapper.getExpiredSessionContextIds(session);
-        assertTrue("Session should NOT be destroyed!", ids.isEmpty());
+        names = HttpSessionWrapper.getExpiredSessionContextNames(session);
+        assertTrue("Session should NOT be destroyed!", names.isEmpty());
 
         // Pretend we've accessed this session two seconds ago, which should imply it is timed out...
-        session = createMockSession(sessionID, now - 2000L, 1);
+        session = createMockSession(contextName, now - 2000L, 1);
 
-        ids = HttpSessionWrapper.getExpiredSessionContextIds(session);
-        assertFalse("Session should be destroyed!", ids.isEmpty());
-        assertTrue(ids.contains(sessionID));
+        names = HttpSessionWrapper.getExpiredSessionContextNames(session);
+        assertFalse("Session should be destroyed!", names.isEmpty());
+        assertTrue(names.contains(contextName));
     }
 
-    private HttpSession createMockSession(long sessionId, long lastAccessed, int maxInactive)
+    private HttpSession createMockSession(String sessionName, long lastAccessed, int maxInactive)
     {
-        String attrLastAccessed = String.format("org.apache.felix.http.session.context.lastaccessed.%d", sessionId);
-        String attrMaxInactive = String.format("org.apache.felix.http.session.context.maxinactive.%d", sessionId);
+        String attrLastAccessed = String.format("org.apache.felix.http.session.context.lastaccessed.%s", sessionName);
+        String attrMaxInactive = String.format("org.apache.felix.http.session.context.maxinactive.%s", sessionName);
 
         HttpSession session = mock(HttpSession.class);
         when(session.getAttributeNames()).thenReturn(Collections.enumeration(Arrays.asList(attrLastAccessed)));
