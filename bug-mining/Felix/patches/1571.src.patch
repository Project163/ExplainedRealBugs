diff --git a/ipojo/manipulator/manipulator/src/main/java/org/apache/felix/ipojo/manipulation/ClassChecker.java b/ipojo/manipulator/manipulator/src/main/java/org/apache/felix/ipojo/manipulation/ClassChecker.java
index 8e23bf1afc..2072c23bd1 100644
--- a/ipojo/manipulator/manipulator/src/main/java/org/apache/felix/ipojo/manipulation/ClassChecker.java
+++ b/ipojo/manipulator/manipulator/src/main/java/org/apache/felix/ipojo/manipulation/ClassChecker.java
@@ -79,6 +79,12 @@ public class ClassChecker extends EmptyVisitor implements ClassVisitor, Opcodes
      */
     private boolean m_supportAnnotation = false;
 
+    /**
+     * Class Version.
+     * Used to determine the frame format.
+     */
+    private int m_classVersion;
+
     /**
      * Check if the _cm field already exists.
      * Update the field list.
@@ -154,6 +160,14 @@ public class ClassChecker extends EmptyVisitor implements ClassVisitor, Opcodes
         return m_isAlreadyManipulated;
     }
 
+    /**
+     * Gets the extracted class version
+     * @return the class version.
+     */
+    public int getClassVersion() {
+        return m_classVersion;
+    }
+
     /**
      * Visit the class.
      * Update the implemented interface list.
@@ -168,6 +182,7 @@ public class ClassChecker extends EmptyVisitor implements ClassVisitor, Opcodes
     public void visit(int version, int access, String name, String signature,
             String superName, String[] interfaces) {
 
+        m_classVersion = version;
         m_supportAnnotation = version > V1_4 && version < V1_1;
 
         if (! superName.equals("java/lang/Object")) {
diff --git a/ipojo/manipulator/manipulator/src/main/java/org/apache/felix/ipojo/manipulation/Manipulator.java b/ipojo/manipulator/manipulator/src/main/java/org/apache/felix/ipojo/manipulation/Manipulator.java
index 3739b6a763..e10fa47be0 100644
--- a/ipojo/manipulator/manipulator/src/main/java/org/apache/felix/ipojo/manipulation/Manipulator.java
+++ b/ipojo/manipulator/manipulator/src/main/java/org/apache/felix/ipojo/manipulation/Manipulator.java
@@ -29,6 +29,7 @@ import org.apache.felix.ipojo.metadata.Attribute;
 import org.apache.felix.ipojo.metadata.Element;
 import org.objectweb.asm.ClassReader;
 import org.objectweb.asm.ClassWriter;
+import org.objectweb.asm.Opcodes;
 
 /**
  * iPOJO Byte code Manipulator.
@@ -97,7 +98,11 @@ public class Manipulator {
             ClassWriter cw0 = new ClassWriter(ClassWriter.COMPUTE_MAXS);
             //CheckClassAdapter ch = new CheckClassAdapter(cw0);
             MethodCreator preprocess = new MethodCreator(cw0, m_fields, m_methods);
-            cr0.accept(preprocess, 0);
+            if (ck.getClassVersion() >= Opcodes.V1_6) {
+                cr0.accept(preprocess, ClassReader.EXPAND_FRAMES);
+            } else {
+                cr0.accept(preprocess, 0);
+            }
             is2.close();
             finalWriter = cw0;
         }
