diff --git a/framework/src/main/java/org/apache/felix/framework/BundleImpl.java b/framework/src/main/java/org/apache/felix/framework/BundleImpl.java
index 20bda9b429..b3e7cff551 100644
--- a/framework/src/main/java/org/apache/felix/framework/BundleImpl.java
+++ b/framework/src/main/java/org/apache/felix/framework/BundleImpl.java
@@ -971,13 +971,16 @@ class BundleImpl implements Bundle
             // TODO: Security
             // sp.checkBundle(this);
         }
-        module.setSecurityContext(new BundleProtectionDomain(getFramework(), this));
 
         IModule[] dest = new IModule[m_modules.length + 1];
         System.arraycopy(m_modules, 0, dest, 0, m_modules.length);
         dest[m_modules.length] = module;
         m_modules = dest;
 
+        // Set protection domain after adding the module to the bundle,
+        // since this requires that the bundle has a module.
+        module.setSecurityContext(new BundleProtectionDomain(getFramework(), this));
+
         // TODO: REFACTOR - consider moving ModuleImpl into the framework package
         // so we can null module capabilities for extension bundles so we don't
         // need this check anymore.
