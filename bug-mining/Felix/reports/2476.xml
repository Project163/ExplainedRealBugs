<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:58:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4999] maven-scr-plugin messes project resources when outputDirectory configuration present on windows</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4999</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;As I look at the following code, I easily can conclude problems on Windows.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;org.apache.felix.scrplugin.mojo.SCRDescriptorMojo#updateProjectResources()&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; updateProjectResources() {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; classesDir = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.project.getBuild().getOutputDirectory().replace(File.separatorChar, &lt;span class=&quot;code-quote&quot;&gt;&apos;/&apos;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; ourRsrcPath = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outputDirectory.getAbsolutePath().replace(File.separatorChar, &lt;span class=&quot;code-quote&quot;&gt;&apos;/&apos;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( !classesDir.equals(ourRsrcPath) ) {
            &lt;span class=&quot;code-comment&quot;&gt;// now add the descriptor directory to the maven resources
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; found = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
            @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Iterator&amp;lt;Resource&amp;gt; rsrcIterator = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.project.getResources().iterator();
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!found &amp;amp;&amp;amp; rsrcIterator.hasNext()) {
                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Resource rsrc = rsrcIterator.next();
                found = rsrc.getDirectory().equals(ourRsrcPath);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!found) {
                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Resource resource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Resource();
                resource.setDirectory(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.outputDirectory.getAbsolutePath());
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.project.addResource(resource);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problematic snippet is &lt;b&gt;&lt;tt&gt;.replace(File.separatorChar, &apos;/&apos;)&lt;/tt&gt;&lt;/b&gt;. On any other environment that Windows this might work but it does not work with backslash file separators.&lt;br/&gt;
At first &lt;b&gt;&lt;tt&gt;classesDir&lt;/tt&gt;&lt;/b&gt; is compared to &lt;b&gt;&lt;tt&gt;ourRsrcPath&lt;/tt&gt;&lt;/b&gt; which is correct as both values have their slashes replaced. The second comparison on line &lt;a href=&quot;http://svn.apache.org/viewvc/felix/trunk/scrplugin/maven-scr-plugin/src/main/java/org/apache/felix/scrplugin/mojo/SCRDescriptorMojo.java?view=markup&amp;amp;revision=1616419&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;545&lt;/a&gt;, however, is invalid because &lt;b&gt;&lt;tt&gt;rsrc.getDirectory()&lt;/tt&gt;&lt;/b&gt; contains native file separators when compared to &lt;b&gt;&lt;tt&gt;ourRsrcPath&lt;/tt&gt;&lt;/b&gt; with replaced file separators.&lt;/p&gt;

&lt;p&gt;As a consequence, the outputDirecory becomes (is added as a) maven project resource and everything inside it if previously existing is copied into the target directory. In my case I specified the project root directory as outputDirectory so that Eclipse PDE finds the OSGI-INF folder in the place expected and added the root folder with an inclusion pattern of OSGI-INF/** to the project resources. The issue caused the whole project to get copied into the target/classes folder resulting in something like target/classes/target/classes, which maven-bundle-plugin is then complaining with an error because:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[ERROR] ... : Classes found in the wrong directory: {target/classes/target/clases/...=...}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Windows</environment>
        <key id="12853687">FELIX-4999</key>
            <summary>maven-scr-plugin messes project resources when outputDirectory configuration present on windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="philipp.kunz">Philipp Kunz</reporter>
                        <labels>
                            <label>easyfix</label>
                            <label>patch-available</label>
                    </labels>
                <created>Sun, 9 Aug 2015 12:32:42 +0000</created>
                <updated>Wed, 18 May 2016 05:43:39 +0000</updated>
                            <resolved>Thu, 13 Aug 2015 05:23:00 +0000</resolved>
                                    <version>maven-scr-plugin 1.21.0</version>
                                    <fixVersion>maven-scr-plugin 1.22.0</fixVersion>
                                    <component>SCR Tooling</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14679147" author="philipp.kunz" created="Sun, 9 Aug 2015 13:38:33 +0000"  >&lt;p&gt;as a workaround it migth be possible to specify no outputDirectory and the copy the generated output to whereever desired&lt;/p&gt;</comment>
                            <comment id="14679198" author="philipp.kunz" created="Sun, 9 Aug 2015 16:23:02 +0000"  >&lt;p&gt;The attached patch should solve the problem but I was not able to verify it. Until no tests cover the improvement it&apos;s more like a suggestion. Also with the slash replacement I was not 100% sure why it was there in the first place.&lt;/p&gt;</comment>
                            <comment id="14679735" author="cziegeler" created="Mon, 10 Aug 2015 07:51:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=philipp.kunz&quot; class=&quot;user-hover&quot; rel=&quot;philipp.kunz&quot;&gt;philipp.kunz&lt;/a&gt; Thanks for reporting, I&apos;Ve committed in rev 1694981 a slightly different fix. The idea of replacing the file separator char with &quot;/&quot; is basically to work with resource definitions that use any path character, e.g. there might be a resource definition for dir foo/bar in the pom, but the project is built on windows. I think I fixed all the places where this should matter with the patch. Could you please try this out?&lt;/p&gt;</comment>
                            <comment id="14680682" author="philipp.kunz" created="Mon, 10 Aug 2015 20:09:52 +0000"  >&lt;p&gt;The file separators are now compared correctly. However, I find one of my resources directory (&lt;b&gt;&lt;tt&gt;rsrc.getDirectory()&lt;/tt&gt;&lt;/b&gt; on line 546 now in SCRDescriptorMojo) ending up with a trailing &lt;b&gt;&lt;tt&gt;\.&lt;/tt&gt;&lt;/b&gt; which is not suitable for comparison. Eventually I figured I have added it myself.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;resources&amp;gt;&amp;lt;resource&amp;gt;&amp;lt;directory&amp;gt;.&amp;lt;/directory&amp;gt;...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nevertheless, &lt;b&gt;&lt;tt&gt;ourRsrcPath&lt;/tt&gt;&lt;/b&gt; is absolute due to &lt;b&gt;&lt;tt&gt;getAbsolutePath()&lt;/tt&gt;&lt;/b&gt; and &lt;b&gt;&lt;tt&gt;rsrc.getDirectory()&lt;/tt&gt;&lt;/b&gt; is not or not always.&lt;/p&gt;</comment>
                            <comment id="14680709" author="philipp.kunz" created="Mon, 10 Aug 2015 20:26:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cziegeler&quot; class=&quot;user-hover&quot; rel=&quot;cziegeler&quot;&gt;cziegeler&lt;/a&gt;, have you ever thought about the case the outputDirectory of the maven-scr-plugin an existing directory which is not empty and at the same time not defined as a maven resource directory when scr is executed such as basedir in my case? Might happen rarely but would then be even more confusing. I have encountered a somewhat similar case with the complete project directory tree ending up copied into target/classes resulting in a build failure. I think I was lucky having got this problem reported by the bundle plugin but it has still wasted considerable amount of time to find out where the confusion originated from. With some inclusion pattern to cover exactly the generated files this case might have worked well. On the other hand I&apos;m still not conviced of the added value of such behaviour as it would be quite easier to manually add a maven resource to the configuration when finding the generated stuff not ending up in the final artifact. For better understanding the purpose of &lt;tt&gt;&amp;lt;outputDirectory&amp;gt;${project.basedir}&amp;lt;/outputDirectory&amp;gt;&lt;/tt&gt; my intention in the first place was to get it known to Eclipse PDE so that I can launch my app from within the workspace. There might be more promising options, feel free to give me a hint. In case this might have become a little bit off-topic, I apologize in advance.&lt;/p&gt;</comment>
                            <comment id="14680750" author="philipp.kunz" created="Mon, 10 Aug 2015 20:55:41 +0000"  >&lt;p&gt;There are by the way quite a few occurrences of &lt;b&gt;&lt;tt&gt;&amp;lt;directory&amp;gt;.&amp;lt;/directory&amp;gt;&lt;/tt&gt;&lt;/b&gt; inside Felix itself. Whether considered recommended or bad it should not necessarily break the build.&lt;/p&gt;</comment>
                            <comment id="14681284" author="cziegeler" created="Tue, 11 Aug 2015 05:54:28 +0000"  >&lt;p&gt;I&apos;ve committed a patch which should fix the &quot;.&quot; problem. Could you please give this a try?&lt;/p&gt;

&lt;p&gt;In fact, the scr plugin should work with an output directory which is not configured in the resources. However, having additional content in that output directory not generated by the plugin, seems uncommon. The plugin tries to be smart, but I guess there will always be a case where it fails. In general, especially when working with Eclipse, the best solution we&apos;re using is to let the scr plugin generate it&apos;s stuff into target/classes. This basically makes target/classes an expanded version of the resulting bundle jar which allows for easy bundle updates into your container (without building the jar) etc.&lt;br/&gt;
But I think for this issue we should focus on getting the dir path handling right&lt;/p&gt;</comment>
                            <comment id="14694708" author="cziegeler" created="Thu, 13 Aug 2015 05:23:00 +0000"  >&lt;p&gt;Assuming this is resolved&lt;/p&gt;</comment>
                            <comment id="14698184" author="philipp.kunz" created="Sat, 15 Aug 2015 08:42:55 +0000"  >&lt;p&gt;It is. Thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12749473" name="FELIX-4999.patch" size="2086" author="philipp.kunz" created="Sun, 9 Aug 2015 16:23:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ii9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>