<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:31:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-2492] scr plugin: using src annotations causes NoClassDefFoundError and other errors</title>
                <link>https://issues.apache.org/jira/browse/FELIX-2492</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Using comment tags and having a dependency on slf4j-api causes the scr plugin to throw a NoClassDefFoundError:&lt;/p&gt;

&lt;p&gt;java.lang.NoClassDefFoundError: org/slf4j/impl/StaticLoggerBinder&lt;br/&gt;
	at org.slf4j.LoggerFactory.&amp;lt;clinit&amp;gt;(LoggerFactory.java:60)&lt;br/&gt;
	at com.day.crx.spi.sharepoint.resource.SharepointResourceProvider.&amp;lt;clinit&amp;gt;(SharepointResourceProvider.java:60)&lt;br/&gt;
	at sun.misc.Unsafe.ensureClassInitialized(Native Method)&lt;br/&gt;
	at sun.reflect.UnsafeFieldAccessorFactory.newFieldAccessor(UnsafeFieldAccessorFactory.java:25)&lt;br/&gt;
	at sun.reflect.ReflectionFactory.newFieldAccessor(ReflectionFactory.java:122)&lt;br/&gt;
	at java.lang.reflect.Field.acquireFieldAccessor(Field.java:918)&lt;br/&gt;
	at java.lang.reflect.Field.getFieldAccessor(Field.java:899)&lt;br/&gt;
	at java.lang.reflect.Field.get(Field.java:358)&lt;br/&gt;
	at org.apache.felix.scrplugin.tags.ClassUtil.getInitializationExpression(ClassUtil.java:41)&lt;br/&gt;
	at org.apache.felix.scrplugin.tags.qdox.QDoxJavaField.getInitializationExpression(QDoxJavaField.java:44)&lt;br/&gt;
	at org.apache.felix.scrplugin.helper.PropertyHandler.getPropertyName(PropertyHandler.java:239)&lt;/p&gt;

&lt;p&gt;A workaround is to add a &apos;dummy&apos; dependency to i.e. slf4j-simple. But then&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;WARNING&amp;#93;&lt;/span&gt; Unused declared dependencies found:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;WARNING&amp;#93;&lt;/span&gt;    org.slf4j:slf4j-simple:jar:1.5.0:provided&lt;/p&gt;

&lt;p&gt;Furthermore when the &apos;dummy&apos; dependency has the wrong version, the scr plugin might throw other errors:&lt;/p&gt;

&lt;p&gt;java.lang.NoSuchFieldError: name&lt;br/&gt;
	at org.slf4j.impl.Log4jLoggerAdapter.&amp;lt;init&amp;gt;(Log4jLoggerAdapter.java:75)&lt;br/&gt;
	at org.slf4j.impl.Log4jLoggerFactory.getLogger(Log4jLoggerFactory.java:75)&lt;br/&gt;
	at org.slf4j.LoggerFactory.getLogger(LoggerFactory.java:103)&lt;br/&gt;
	at com.day.crx.spi.sharepoint.resource.SharepointResourceProvider.&amp;lt;clinit&amp;gt;(SharepointResourceProvider.java:60)&lt;br/&gt;
	at sun.misc.Unsafe.ensureClassInitialized(Native Method)&lt;br/&gt;
	at sun.reflect.UnsafeFieldAccessorFactory.newFieldAccessor(UnsafeFieldAccessorFactory.java:25)&lt;br/&gt;
	at sun.reflect.ReflectionFactory.newFieldAccessor(ReflectionFactory.java:122)&lt;br/&gt;
	at java.lang.reflect.Field.acquireFieldAccessor(Field.java:918)&lt;br/&gt;
	at java.lang.reflect.Field.getFieldAccessor(Field.java:899)&lt;br/&gt;
	at java.lang.reflect.Field.get(Field.java:358)&lt;br/&gt;
	at org.apache.felix.scrplugin.tags.ClassUtil.getInitializationExpression(ClassUtil.java:41)&lt;br/&gt;
	at org.apache.felix.scrplugin.tags.qdox.QDoxJavaField.getInitializationExpression(QDoxJavaField.java:44)&lt;br/&gt;
	at org.apache.felix.scrplugin.helper.PropertyHandler.getPropertyName(PropertyHandler.java:238)&lt;/p&gt;

&lt;p&gt;I think such errors should be handled more gracefully indicating the source of the problem. Also it should not be necessary to have a &apos;dummy&apos; dependencies. This was not the case up to version 1.4.1. &lt;br/&gt;
If it is absolutely necessary to include such dummy dependencies, the plugin should state so in its error message. Also the slf4j case is so common that it might be worth to considering a specific solution/workaround for this in the plugin. This is still much better than forcing all clients to analyze the problem from the stacktrace and then implement workarounds.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12470427">FELIX-2492</key>
            <summary>scr plugin: using src annotations causes NoClassDefFoundError and other errors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="mduerig">Michael D&#252;rig</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Jul 2010 09:18:11 +0000</created>
                <updated>Tue, 5 May 2020 08:15:15 +0000</updated>
                            <resolved>Tue, 7 Jun 2011 10:03:55 +0000</resolved>
                                    <version> maven-scr-plugin-1.4.4</version>
                                    <fixVersion>maven-scr-plugin-1.7.2</fixVersion>
                    <fixVersion>scr ant task 1.1.2</fixVersion>
                    <fixVersion>scr generator 1.1.2</fixVersion>
                                    <component>SCR Tooling</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12893577" author="sseifert@pro-vision.de" created="Thu, 29 Jul 2010 10:30:13 +0000"  >&lt;p&gt;we&apos;ve already discusses this some time ago in &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1726&quot; title=&quot;SCR Annotations - Enhance error messages in case of missing project dependencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1726&quot;&gt;&lt;del&gt;FELIX-1726&lt;/del&gt;&lt;/a&gt; - at this time it was decided that this has to be solved with project-specific dependencies.&lt;/p&gt;</comment>
                            <comment id="12894005" author="mduerig" created="Fri, 30 Jul 2010 11:07:49 +0000"  >&lt;p&gt;That&apos;s one part of the issue. But I think the scr plugin should say so. That is the plugin should at least print a message like &quot;unresolved dependency.... See &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-2492&quot; title=&quot;scr plugin: using src annotations causes NoClassDefFoundError and other errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-2492&quot;&gt;&lt;del&gt;FELIX-2492&lt;/del&gt;&lt;/a&gt;&quot;. In the case of slf4j which seems very common to me the plugin could even suggest to add a dependency to slf4j-simple. &lt;/p&gt;

&lt;p&gt;Simply failing with a stack trace and relying on the each and every user digging into the problem seems not right to me. &lt;/p&gt;
</comment>
                            <comment id="12894009" author="fmeschbe" created="Fri, 30 Jul 2010 11:32:20 +0000"  >&lt;p&gt;&amp;gt; Simply failing with a stack trace and relying on the each and every user digging into the problem seems not right to me.&lt;/p&gt;

&lt;p&gt;YMMV certainly here, particularly as we are talking of &quot;developers&quot; not mere users in the sense of &quot;my mother&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;But yes, the message could be nicer indicating similarly to &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1726&quot; title=&quot;SCR Annotations - Enhance error messages in case of missing project dependencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1726&quot;&gt;&lt;del&gt;FELIX-1726&lt;/del&gt;&lt;/a&gt;, that a project dependency is missing.&lt;/p&gt;

&lt;p&gt;Whether we should specially highlight SLF4J or not: I certainly don&apos;t think so. It may be your case, that SLF4J is a primary candidate. Other users have other candidates. So we may probably not generalize, event though SLF4J is certainly one of the few libraries having such an issue.&lt;/p&gt;</comment>
                            <comment id="12894023" author="mduerig" created="Fri, 30 Jul 2010 11:42:46 +0000"  >&lt;p&gt;&amp;gt; as we are talking of &quot;developers&quot; &lt;/p&gt;

&lt;p&gt;That&apos;s the users I had in mind. It still takes them time to analyze the issue and research a workaround. Particularly since the issue is counter intuitive: the dependency plugin will report your dependencies as fine but the src plugin will fail because of a missing dependency which the dependency plugin would report as unreferenced. &lt;/p&gt;

&lt;p&gt;I still think printing an explanatory message pointing to this bug would cut the time used to analyze the problem and come up with a workaround. &lt;/p&gt;</comment>
                            <comment id="12894353" author="fmeschbe" created="Sun, 1 Aug 2010 09:08:31 +0000"  >&lt;p&gt;Comes to mind: Another, even better option than adding a compile-scope dependency on slf4j-simple is to not use constant fields referring to SLF4J loggers. There are at least two good reasons for this:&lt;/p&gt;

&lt;p&gt;  (1) Having a complie-scope dependency on slf4-simple is bad, because the goal of slf4j is to properly separate the compile time issues (cared for by the developer) from the run-time issues (cared for by the deployer and/or system administrator). So, at least, you should mark your slf4j-simple compile time dependency as optional so as to not transitively forward this dependency.&lt;/p&gt;

&lt;p&gt;  (2) Having constant references to complex objects makes the work of the garbage collector unnecessarily hard: The referred-to object can only be collected once the class containing the static final reference is collected ....&lt;/p&gt;

&lt;p&gt;So, your best fix would probably be to change your &quot;static final&quot; reference to just a &quot;final&quot; reference. And everything would be fine.&lt;/p&gt;</comment>
                            <comment id="12894359" author="cziegeler" created="Sun, 1 Aug 2010 09:15:51 +0000"  >&lt;p&gt;I would suggest people to use the real annotations instead of the javadoc tags anyway &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I haven&apos;t encounted such problems with annotations yet and I would like to get more feedback about the annotations anyway.&lt;br/&gt;
So I tend to agree with Felix to &quot;just&quot; have a nicer error message&lt;/p&gt;</comment>
                            <comment id="12894496" author="mduerig" created="Mon, 2 Aug 2010 08:48:08 +0000"  >&lt;p&gt;I agree on everything here: should use annotations instead of comment tags, should use final instead of final static, should mark slf4j-simple as optional and so on. The best way to advertise all this is to put this info onto the Wiki page of the scr plugin improve the error reporting of the plugin in the case of the missing dependency directing the user to the relevant information (i.e. Wiki, this bug).&lt;/p&gt;
</comment>
                            <comment id="13045344" author="cziegeler" created="Tue, 7 Jun 2011 09:55:28 +0000"  >&lt;p&gt;You mean something like this?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://felix.apache.org/site/apache-felix-scr-plugin-faq.html#ApacheFelixSCRPluginFAQ-NoClassDefFoundErrorduringbuild&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://felix.apache.org/site/apache-felix-scr-plugin-faq.html#ApacheFelixSCRPluginFAQ-NoClassDefFoundErrorduringbuild&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13045347" author="mduerig" created="Tue, 7 Jun 2011 09:59:53 +0000"  >&lt;p&gt;Yes.&lt;/p&gt;</comment>
                            <comment id="13045348" author="cziegeler" created="Tue, 7 Jun 2011 10:03:55 +0000"  >&lt;p&gt;Changed the exception message in revision 1132934&lt;/p&gt;

&lt;p&gt;Setting this to fixed now as we have docs and a better error msgs&lt;/p&gt;</comment>
                            <comment id="13651042" author="alexander.klimetschek" created="Tue, 7 May 2013 16:51:22 +0000"  >&lt;p&gt;Got the same issue. Please note that I am using Java annotations. I could only fix it with the workaround mentioned above, adding &quot;slf4j-simple&quot; with scope=provided, which is not needed. scope=test did not work.&lt;/p&gt;

&lt;p&gt;AFAICS, the problem is the nasty slf4j binding trick that in org.slf4j.LoggerFactory the import of &quot;org.slf4j.impl.StaticLoggerBinder&quot; is unresolved in the api jar itself.&lt;/p&gt;

&lt;p&gt;Some possible solutions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the scr plugin could just output a warning here in case this is a 3rd party jar (and not local source code)&lt;/li&gt;
	&lt;li&gt;that might break the desired validation of export/import/private package declarations or generation; so maybe one can configure classes to ignore in the pom (in this case &quot;org.slf4j.LoggerFactory&quot;)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13651082" author="cziegeler" created="Tue, 7 May 2013 17:20:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexander.klimetschek&quot; class=&quot;user-hover&quot; rel=&quot;alexander.klimetschek&quot;&gt;alexander.klimetschek&lt;/a&gt; Please note that this issue is closed; if you still have a problem with the latest released plugin (1.12.0), please open a new issue. Thanks&lt;/p&gt;</comment>
                            <comment id="13651219" author="alexander.klimetschek" created="Tue, 7 May 2013 19:41:32 +0000"  >&lt;p&gt;Oh, sorry, missed that completely!&lt;/p&gt;

&lt;p&gt;BTW, I found it is only fixed starting with maven-scr-plugin 1.7.4, not 1.7.2 as mentioned in the fix version.&lt;/p&gt;</comment>
                            <comment id="13651233" author="alexander.klimetschek" created="Tue, 7 May 2013 19:52:40 +0000"  >&lt;p&gt;Scratch that - it was ONLY fixed with 1.7.4, starting from 1.8.0 until now (1.12.0), the issue happens again. Created &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4056&quot; title=&quot;scr plugin: a required class was missing for org.slf4j.impl.StaticLoggerBinder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-4056&quot;&gt;&lt;del&gt;FELIX-4056&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12437663">FELIX-1726</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13302817">JCR-4562</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56290</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1at7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>271197</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>