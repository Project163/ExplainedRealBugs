<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:19:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-2479] Required bundles not correctly re-exporting their substitutable exports</title>
                <link>https://issues.apache.org/jira/browse/FELIX-2479</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;This is sort of a complicated scenario, but I&apos;ve been able to create a relatively simple test to recreate this.  See the attachment for the project.  Note that to get this to run using the 3.0.1 Felix framework version, I needed to create a private build of the pax exam trunk with a dependency change to also pick up the latest pax runner snapshot version.  &lt;/p&gt;

&lt;p&gt;This problem showed up for us with the 3.0.1 release, but also appears to be in the 3.1.0-SNAPSHOT release.  The 2.0.5 release does not have the problem and equinox also appears to be handling this correctly.  In this scenario, we have a bundle with two embedded jar files that also has a Dynamic-Import: * header and a Require-Bundle header for another bundle.  One of the embedded jars uses the same package name as packages defined in the bundle referenced by the Require-Bundle, creating a split package situation.  The test is fairly simple, consisting of just a couple of lines: &lt;/p&gt;

&lt;p&gt;        // if this line is commented out, then the second loadClass() call will succeed.  If &lt;br/&gt;
        // this load occurs first, then a NoClassDefFound error results on the load for TestClass. &lt;br/&gt;
        Class cls1 = bundle1.loadClass(&quot;org.apache.geronimo.harness.EETestDummy&quot;);&lt;/p&gt;

&lt;p&gt;        Class cls = bundle1.loadClass(&quot;org.apache.geronimo.embedded.TestClass&quot;);&lt;br/&gt;
        // this will force the fields classes to be resolved. &lt;br/&gt;
        cls.getDeclaredFields(); &lt;/p&gt;

&lt;p&gt;When this is run, the cls.getDeclaredFields() call will get a NoClassDefFound exception for the class Lorg/apache/geronimo/harness/EETest&lt;/p&gt;

&lt;p&gt;That class is defined in one of the embedded jars.  If the load of the EETestDummy class is commented out, then the getDeclaredFields() call does not throw the exception.  The resolution of the internal EETest class appears to depend on whether the imported package gets resolved first.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12469738">FELIX-2479</key>
            <summary>Required bundles not correctly re-exporting their substitutable exports</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="rickmcguire">Richard McGuire</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Jul 2010 17:42:02 +0000</created>
                <updated>Wed, 18 Aug 2010 20:02:14 +0000</updated>
                            <resolved>Thu, 22 Jul 2010 14:11:25 +0000</resolved>
                                    <version>framework-3.0.1</version>
                                    <fixVersion>framework-3.0.2</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12890346" author="rickmcguire" created="Tue, 20 Jul 2010 17:44:18 +0000"  >&lt;p&gt;If you have a version of PAX exam setup that can handle the 3.0.1 framework, then you should be able to run this by just doing an &quot;mvn install&quot; from the test subproject after unzipping.  &lt;/p&gt;</comment>
                            <comment id="12890445" author="rickhall" created="Tue, 20 Jul 2010 21:06:14 +0000"  >&lt;p&gt;I see what is going on. The bundle being required imports its own packages and there is a bug when calculating the available packages from a required bundle which is essentially ignoring the packages that are also imported, but they should be part of the export signature of the required bundle. This omission causes the second bundle to actually get dynamically wired to the first bundle on the first class load above, which then subsequently short circuits the class loading from that point forward. I think this should be a straightforward fix. I will work on a patch tomorrow.&lt;/p&gt;</comment>
                            <comment id="12890738" author="rickhall" created="Wed, 21 Jul 2010 14:31:19 +0000"  >&lt;p&gt;I committed a fix for this to trunk. It worked in my local test case, but I didn&apos;t test it on the original test case given my limited understanding of Pax Exam. Please close if satisfied.&lt;/p&gt;</comment>
                            <comment id="12890860" author="rickmcguire" created="Wed, 21 Jul 2010 19:54:51 +0000"  >&lt;p&gt;I wasn&apos;t able to get the pax runner framework to execute using a fresh build of the framework trunk, but when I retested this in the original failing environment, this same problem still occurs. &lt;/p&gt;

&lt;p&gt;I rebuilt the current Felix trunk, which builds a 3.1.0-SNAPSHOT version.  I&apos;m a little confused by the fact this Jira is marked as fixed in 3.2.0.  Am I picking up the correct build for testing?&lt;/p&gt;

&lt;p&gt;I&apos;m not really able to provide you with a copy of the bundles that are causing the problem because these materials are covered by an NDA.  I&apos;m willing to do whatever is necessary though to gather information that can help you debug the problem. &lt;/p&gt;</comment>
                            <comment id="12890872" author="rickhall" created="Wed, 21 Jul 2010 20:12:35 +0000"  >&lt;p&gt;For the framework, we work on odd/even minor numbers for development/release builds. So the 3.1.0-SNAPSHOT release will become 3.2.0 when released (or possibly a 3.0.x release if we do a quick bug fix release, since we don&apos;t do branches).&lt;/p&gt;

&lt;p&gt;I forgot that I got your attached example working directly in Gogo without the need for Pax Exam, so this is what I see when I run it with trunk:&lt;/p&gt;

&lt;p&gt;g! lb&lt;br/&gt;
START LEVEL 1&lt;br/&gt;
   ID|State      |Level|Name&lt;br/&gt;
    0|Active     |    0|System Bundle (3.1.0.SNAPSHOT)&lt;br/&gt;
    1|Active     |    1|Apache Felix Bundle Repository (1.6.2)&lt;br/&gt;
    2|Active     |    1|Apache Felix Gogo Command (0.6.0)&lt;br/&gt;
    3|Active     |    1|Apache Felix Gogo Runtime (0.6.0)&lt;br/&gt;
    4|Active     |    1|Apache Felix Gogo Shell (0.6.0)&lt;br/&gt;
    5|Installed  |    1|Required test harness bundle (1.0.0.SNAPSHOT)&lt;br/&gt;
    6|Installed  |    1|Bundle used to load failing class (1.0.0.SNAPSHOT)&lt;br/&gt;
g! (bundle 6) loadclass org.apache.geronimo.harness.EETestDummy&lt;br/&gt;
DEBUG: WIRE: &lt;span class=&quot;error&quot;&gt;&amp;#91;6.0&amp;#93;&lt;/span&gt; module; (bundle-symbolic-name=org.apache.geronimo.harness) -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;5.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
[ ...big string dump of the loaded class deleted... ]&lt;/p&gt;

&lt;p&gt;g! (bundle 6) loadclass org.apache.geronimo.embedded.TestClass&lt;br/&gt;
[ ...big string dump of the loaded class deleted... ]&lt;/p&gt;

&lt;p&gt;So you can see that I load the first class, which causes the bundles to get resolved, then I load the second class. So the attached test case appears to work correctly. You can make sure you see the same thing locally by following the same steps. If you see something different, then you don&apos;t have the right build.&lt;/p&gt;

&lt;p&gt;If you see the same thing, but your real scenario still doesn&apos;t work, then it must not be the same issue as the attached test case. I guess that means you&apos;ll need another go at creating an example scenario to demonstrate the issue. Thanks.&lt;/p&gt;</comment>
                            <comment id="12890906" author="rickhall" created="Wed, 21 Jul 2010 21:23:43 +0000"  >&lt;p&gt;Actually, I think I might know what is going on...I&apos;ll investigate more tomorrow and let you know.&lt;/p&gt;</comment>
                            <comment id="12891078" author="rickmcguire" created="Thu, 22 Jul 2010 09:42:55 +0000"  >&lt;p&gt;I&apos;d also like to note that your test in gogo is missing the critical final step.  The NoClassDefFound error does not occur until the getDeclaredMethods() call is made on TestClass.  That&apos;s what forces the load of the EETest class that causes the error.  &lt;/p&gt;</comment>
                            <comment id="12891139" author="rickhall" created="Thu, 22 Jul 2010 12:49:56 +0000"  >&lt;p&gt;True, I missed that, but:&lt;/p&gt;

&lt;p&gt;g! c = (bundle 6) loadclass org.apache.geronimo.embedded.TestClass&lt;br/&gt;
[ ...big string dump of the loaded class deleted... ] &lt;/p&gt;

&lt;p&gt;g! $c getDeclaredMethods&lt;/p&gt;

&lt;p&gt;g! $c getName&lt;br/&gt;
org.apache.geronimo.embedded.TestClass&lt;br/&gt;
g! $c getMethods&lt;br/&gt;
public final void java.lang.Object.wait() throws java.lang.InterruptedException&lt;br/&gt;
public final native void java.lang.Object.wait(long) throws java.lang.InterruptedException&lt;br/&gt;
public final void java.lang.Object.wait(long,int) throws java.lang.InterruptedException&lt;br/&gt;
public boolean java.lang.Object.equals(java.lang.Object)&lt;br/&gt;
public java.lang.String java.lang.Object.toString()&lt;br/&gt;
public native int java.lang.Object.hashCode()&lt;br/&gt;
public final native java.lang.Class java.lang.Object.getClass()&lt;br/&gt;
public final native void java.lang.Object.notify()&lt;br/&gt;
public final native void java.lang.Object.notifyAll()&lt;/p&gt;

&lt;p&gt;g! &lt;/p&gt;

&lt;p&gt;It still doesn&apos;t seem to cause an issue for me with the current test. Regardless, I&apos;ll investigate more.&lt;/p&gt;</comment>
                            <comment id="12891178" author="rickhall" created="Thu, 22 Jul 2010 14:11:25 +0000"  >&lt;p&gt;Ok, I&apos;ve committed another potential fix that works for me in the supplied test case and in an additional test case I created where the previous patch failed. There was a bug in calculating which packages were exposed from a required bundle when that bundle imports packages it exports. Even if the bundle ends up wiring to a different provider, it must still expose the packages it was exporting (i.e., it implicitly reexports its substituted exports).&lt;/p&gt;

&lt;p&gt;Please close this bug if satisfied. Thanks!&lt;/p&gt;</comment>
                            <comment id="12891232" author="rickmcguire" created="Thu, 22 Jul 2010 16:35:13 +0000"  >&lt;p&gt;There is joy in Mudville!  The second attempt fixed the original, more complicated problem too.  Thank you for the quick turnaround on this!&lt;/p&gt;</comment>
                            <comment id="12891234" author="rickhall" created="Thu, 22 Jul 2010 16:40:12 +0000"  >&lt;p&gt;Change the summary to match the real issue.&lt;/p&gt;</comment>
                            <comment id="12891237" author="rickhall" created="Thu, 22 Jul 2010 16:40:52 +0000"  >&lt;p&gt;Great news. I think we&apos;ll try to do another micro release before too long, since we have a good collection of minor bugs already fixed.&lt;/p&gt;</comment>
                            <comment id="12891239" author="rickhall" created="Thu, 22 Jul 2010 16:48:01 +0000"  >&lt;p&gt;Even better summary. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12449949" name="splitpackage.zip" size="231114" author="rickmcguire" created="Tue, 20 Jul 2010 17:44:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vxif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184402</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>