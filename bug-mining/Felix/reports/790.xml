<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:14:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1101] framework.security can&apos;t be built or run against Felix 1.6</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1101</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;The org.apache.felix.framework.SecurityActivator and org.apache.felix.framework.SecurityProviderImpl classes have a dependency on the org.apache.felix.framework.FelixBundle class, which seems to have been removed since Felix 1.4 (which, BTW, works fine with the PermissionAdmin service).&lt;/p&gt;

&lt;p&gt;Most &lt;del&gt;but not all&lt;/del&gt; of the required methods seem to be available in org.apache.felix.framework.BundleImpl now. Further changes involve using IModule instead of IContentLoader.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12424163">FELIX-1101</key>
            <summary>framework.security can&apos;t be built or run against Felix 1.6</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karlpauls">Karl Pauls</assignee>
                                    <reporter username="udittmer">Ulf Dittmer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Apr 2009 13:41:34 +0000</created>
                <updated>Thu, 26 Nov 2009 20:24:22 +0000</updated>
                            <resolved>Tue, 24 Nov 2009 23:24:05 +0000</resolved>
                                    <version>framework-1.6.0</version>
                                                    <component>Conditional Permission Admin</component>
                    <component>Permission Admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12704940" author="udittmer" created="Fri, 1 May 2009 10:07:19 +0000"  >&lt;p&gt;The attached source files can be compiled and run with the current Felix trunk. I verified that they work just like the existing sources work with Felix 1.4, both for PermissionAdmin and ConditionalPermissionAdmin (with a BundleLocationCondition). The fix for issue Felix-1103 is also included.&lt;/p&gt;</comment>
                            <comment id="12705027" author="karlpauls" created="Fri, 1 May 2009 15:45:32 +0000"  >&lt;p&gt;Great. Thanks. I will look at it soon. Could you attach a diff as well? Otherwise I will diff it myself. Thanks again and I come back to this soon.&lt;/p&gt;</comment>
                            <comment id="12705439" author="udittmer" created="Sun, 3 May 2009 19:40:55 +0000"  >&lt;p&gt;There&apos;s still an issue that I think isn&apos;t correct (and it was like that before - it&apos;s not something that got introduced now):&lt;/p&gt;

&lt;p&gt;If a bundle is installed at the same location under which another bundle was installed and uninstalled before, then the CPA is no longer consulted if the bundle also had PA permissions. That can lead to the new bundle not being installed if it depends on permissions granted by the CPA.&lt;/p&gt;

&lt;p&gt;This is caused by the m_store Map in the PermissionAdminImpl still having permission information for that location; see the use of the boolean &quot;file&quot; in the hasPermission method. If it gets set to true due to permissions of the old (now uninstalled) bundle being cached, then the method returns false and the CPA is not consulted.&lt;/p&gt;

&lt;p&gt;While it&apos;s not hard for the host application to set null permissions for any bundle that gets uninstalled (thus removing the cache entry), I think the PA should do that automatically. Maybe a BundleListener could remove the cache entry when a bundle gets uninstalled?&lt;/p&gt;

&lt;p&gt;(PS: Since I&apos;d have to do the diff of 7 files manually, I want to wait until I hear about this, so I only have to do it once...)&lt;/p&gt;</comment>
                            <comment id="12705442" author="karlpauls" created="Sun, 3 May 2009 20:06:17 +0000"  >&lt;p&gt;Why can&apos;t you just do a:&lt;/p&gt;

&lt;p&gt;&amp;gt; svn diff framework.security&lt;/p&gt;

&lt;p&gt;That will diff all files in one go ...&lt;/p&gt;</comment>
                            <comment id="12705495" author="udittmer" created="Mon, 4 May 2009 06:03:55 +0000"  >&lt;p&gt;... because I was unaware that svn can do that recursively for a directory &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;m using an SVN GUI client that supports diff for single files only.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached the diff for the whole &quot;framework.security&quot; directory.&lt;/p&gt;</comment>
                            <comment id="12707657" author="udittmer" created="Sat, 9 May 2009 12:23:20 +0000"  >&lt;p&gt;There&apos;s another issue that prevents some bundles (like org.apache.felix.scr-1.0.8.jar) to be started if the PA/CPA bundle is active. Trying to start it results in the exception quoted below. The missing method is part of BundleImpl, not Felix. Maybe the getDeclaredMethod call should be done repeatedly with the respective superclass if it fails?&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; java.lang.NoSuchMethodException: org.apache.felix.framework.Felix.getSignerMatcher()&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.lang.Class.getDeclaredMethod(Class.java:1909)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.osgi.framework.AdminPermission.createSigner(AdminPermission.java:245)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.osgi.framework.AdminPermission.access$200(AdminPermission.java:43)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.osgi.framework.AdminPermission$1.run(AdminPermission.java:227)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.osgi.framework.AdminPermission.getBundleDictionary(AdminPermission.java:221)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.osgi.framework.AdminPermission.implies(AdminPermission.java:197)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.osgi.framework.AdminPermissionCollection.implies(AdminPermission.java:442)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.security.util.Permissions.implies(Permissions.java:393)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.security.permissionadmin.PermissionAdminImpl.check(PermissionAdminImpl.java:175)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.security.permissionadmin.PermissionAdminImpl.hasPermission(PermissionAdminImpl.java:157)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.SecurityProviderImpl.hasBundlePermission(SecurityProviderImpl.java:109)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.Felix.impliesBundlePermission(Felix.java:3312)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleProtectionDomain.implies(BundleProtectionDomain.java:46)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.security.AccessControlContext.checkPermission(AccessControlContext.java:249)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.security.AccessController.checkPermission(AccessController.java:427)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleImpl.getHeaders(BundleImpl.java:239)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleImpl.getHeaders(BundleImpl.java:230)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.scr.impl.Activator.loadComponents(Activator.java:210)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.scr.impl.Activator.loadAllComponents(Activator.java:193)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.scr.impl.Activator.start(Activator.java:102)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.util.SecureAction$Actions.run(SecureAction.java:1114)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.util.SecureAction.startActivator(SecureAction.java:580)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.Felix.startBundle(Felix.java:1458)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:774)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:755) &lt;/p&gt;</comment>
                            <comment id="12782233" author="karlpauls" created="Tue, 24 Nov 2009 23:24:05 +0000"  >&lt;p&gt;I did migrate the security provider to felix 2.0.2 as of revision 883923.&lt;/p&gt;</comment>
                            <comment id="12782541" author="udittmer" created="Wed, 25 Nov 2009 18:20:39 +0000"  >&lt;p&gt;A quick test indicates that it works as advertised. One change I observe from previous versions is that bundles loaded while PA/CPA is active now require a java.lang.RuntimePermission for &quot;getClassLoader&quot; - that wasn&apos;t the case before. It&apos;s possible that that&apos;s OK as per the spec, but it seemed like an odd &lt;del&gt;and rather dangerous&lt;/del&gt; permission to have to grant to random bundles, and since it was&apos;t needed before I thought I&apos;d mention it. I&apos;m attaching the stack trace I get if the permission is not granted; &quot;plugin1.PlusOne&quot; is the bundle class implementing BundleActivator, and &quot;host.Main&quot; is the application class that tries to load the bundle.&lt;/p&gt;

&lt;p&gt;     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt; java.security.AccessControlException: access denied (java.lang.RuntimePermission getClassLoader)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.security.AccessControlContext.checkPermission(AccessControlContext.java:264)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.security.AccessController.checkPermission(AccessController.java:427)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.lang.Class.getClassLoader(Class.java:588)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.util.Util.loadClassUsingClass(Util.java:168)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.Felix.registerService(Felix.java:2696)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleContextImpl.registerService(BundleContextImpl.java:252)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleContextImpl.registerService(BundleContextImpl.java:230)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at plugin1.PlusOne.start(PlusOne.java:24)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.util.SecureAction$Actions.run(SecureAction.java:1262)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.util.SecureAction.startActivator(SecureAction.java:631)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.Felix.activateBundle(Felix.java:1700)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.Felix.startBundle(Felix.java:1622)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:915)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:902)&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;java&amp;#93;&lt;/span&gt;     at host.Main.fileNew(Main.java:98)&lt;/p&gt;</comment>
                            <comment id="12782589" author="karlpauls" created="Wed, 25 Nov 2009 20:01:42 +0000"  >&lt;p&gt;Well, I just did update the security provider and got it back to work with felix 2.0.2. I didn&apos;t yet get back to work on the security inside the framework. This is just one of several place I will have to look into to a) make sure we do the required checks and b) as in this case, make sure we do have the right doPriv blocks in place. I will hopefully be able to find the time soon.&lt;/p&gt;</comment>
                            <comment id="12782621" author="karlpauls" created="Wed, 25 Nov 2009 21:06:02 +0000"  >&lt;p&gt;Ok, I just did a quick fix to the framework which should fix the issue you did see. Please close this issue if it works for you. I will create new issues for all the other outstanding security related work. Thanks again!&lt;/p&gt;</comment>
                            <comment id="12782854" author="udittmer" created="Thu, 26 Nov 2009 11:49:38 +0000"  >&lt;p&gt;If by &quot;the issue you did see&quot; you mean the &quot;RuntimePermission for getClassLoader&quot;, then that&apos;s still happening. What&apos;s no longer happening is the &quot;getSignerMatcher&quot; issue I mentioned above. I&apos;ll create a new issue about the install/uninstall/reinstall behavior I mentioned in my second post.&lt;/p&gt;</comment>
                            <comment id="12782970" author="karlpauls" created="Thu, 26 Nov 2009 19:57:11 +0000"  >&lt;p&gt;Um, are you sure you tested it with the latest &lt;em&gt;framework&lt;/em&gt; trunk? The fix for your second issue has been for framework &lt;em&gt;not&lt;/em&gt; the framework.security...&lt;/p&gt;</comment>
                            <comment id="12782973" author="udittmer" created="Thu, 26 Nov 2009 20:24:22 +0000"  >&lt;p&gt;Ah, sorry, I misunderstood. Running it with the latest framework sources indeed no longer shows the problem. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12406999" name="framework-security.zip" size="123059" author="udittmer" created="Fri, 1 May 2009 10:07:19 +0000"/>
                            <attachment id="12407132" name="security.diff" size="13610" author="udittmer" created="Mon, 4 May 2009 06:03:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57912</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vusf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183961</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>