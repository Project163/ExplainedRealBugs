<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:15:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1792] Felix OBR seems to just randomly choose one of the satisifed bundles if more than one bundle meets the requirement</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1792</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I have one bundle bundle1, which imports a package called com.obr.bundle&lt;/p&gt;

&lt;p&gt;Bundle1&apos;s manifest:&lt;/p&gt;

&lt;p&gt;Manifest-Version: 1.0&lt;br/&gt;
Ant-Version: Apache Ant 1.7.0&lt;br/&gt;
Bundle-ManifestVersion: 2&lt;br/&gt;
Bundle-Name: Bundle Plug-in&lt;br/&gt;
Bundle-SymbolicName: com.obr.bundle1&lt;br/&gt;
Bundle-Version: 1.0.0&lt;br/&gt;
Export-Package: com.obr.bundle1&lt;br/&gt;
Import-Package: com.obr.bundle;version=&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;1.2.0.999,3.2.2.bz&amp;#93;&lt;/span&gt;&quot;&lt;/p&gt;


&lt;p&gt;There are two bundles in my repositories, bundler2 and bundle 3. Both of them export package com.obr.bundle. Below are their manifest files.&lt;br/&gt;
Bundle2&lt;/p&gt;

&lt;p&gt;Manifest-Version: 1.0&lt;br/&gt;
Ant-Version: Apache Ant 1.7.0&lt;br/&gt;
Bundle-ManifestVersion: 2&lt;br/&gt;
Bundle-Name: Bundle Plug-in&lt;br/&gt;
Bundle-SymbolicName: com.obr.bundle2&lt;br/&gt;
Bundle-Version: 1.0.0&lt;br/&gt;
Bundle-Vendor: xxx&lt;br/&gt;
Import-Package: a.b.c&lt;br/&gt;
Export-Package: com.obr.bundle;version=3.2.2.blah&lt;/p&gt;


&lt;p&gt;Bundle3:&lt;br/&gt;
Manifest-Version: 1.0&lt;br/&gt;
Ant-Version: Apache Ant 1.7.0&lt;br/&gt;
Bundle-ManifestVersion: 2&lt;br/&gt;
Bundle-Name: Bundle Plug-in&lt;br/&gt;
Bundle-SymbolicName: com.obr.bundle3&lt;br/&gt;
Bundle-Version: 1.0.0&lt;br/&gt;
Import-Package: a.b.c&lt;br/&gt;
Export-Package: com.obr.bundle;version=3.1&lt;/p&gt;

&lt;p&gt;As you can see, both bundle2 and bundle3 meet the requirements of bundle1. I hope the highest package version, which is bundle2, is chosen by felix obr. However, sometimes bundle 3 was chosen instead of bundle2. The behaviour is random.&lt;/p&gt;

&lt;p&gt;Am I right to say that the Felix obr runtime just picks the first bundle that meets the requirements and then stop searching for any more eligible bundles?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</description>
                <environment>n/a</environment>
        <key id="12438746">FELIX-1792</key>
            <summary>Felix OBR seems to just randomly choose one of the satisifed bundles if more than one bundle meets the requirement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="davidsmall99">david small99</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Oct 2009 21:05:03 +0000</created>
                <updated>Mon, 15 Mar 2010 23:09:16 +0000</updated>
                            <resolved>Mon, 25 Jan 2010 15:09:07 +0000</resolved>
                                    <version>bundlerepository-1.4.2</version>
                                    <fixVersion>bundlerepository-1.4.3</fixVersion>
                                    <component>Bundle Repository (OBR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12768469" author="rickhall" created="Wed, 21 Oct 2009 21:28:09 +0000"  >&lt;p&gt;OBR tries to select the highest version among matching candidates, however there are cases where this might not be the case. For example, if you explicitly added the lower version resource to the set of resources to be resolved, then OBR would prefer the added resource over including another resource exporting a higher version of the package. Another example is if a lower version of the resource was already selected to resolve a different dependency of another resource being resolved, in that case OBR would favor the already selected resource rather than adding another resource exporting the same package again.&lt;/p&gt;

&lt;p&gt;OBR tries to limit the number of bundles it is going to download. It is not random, although it may not be completely obvious.&lt;/p&gt;</comment>
                            <comment id="12768484" author="davemssavage" created="Wed, 21 Oct 2009 21:57:14 +0000"  >&lt;p&gt;Hmmm one possible source of entropy could be the use of HashSets in the ResolverImpl? I recently had make a similar fix to the sigil resolver, to use LinkedLists vs HashSets. A cursory look at the code suggests the ResolverImpl performs the resolution by iterating over a number of different HashSets which are inherently unordered...so could lead to different graph traversals depending on the already selected resources? I would need to do further analysis to see if this is actually the case though...but thought it might be of use...&lt;/p&gt;</comment>
                            <comment id="12768684" author="davidsmall99" created="Thu, 22 Oct 2009 13:42:55 +0000"  >&lt;p&gt;Thanks Richard and David,&lt;/p&gt;

&lt;p&gt;The above test scenario returns different bundles when I run the test in the exact same environment. The majority of time returns the highest version, which is bundle2. This behavior does not fit in the cases Richard mentioned. It suggests there might be a bug somewhere, as hinted by David.&lt;/p&gt;

&lt;p&gt;Thanks again.&lt;/p&gt;</comment>
                            <comment id="12769129" author="davemssavage" created="Fri, 23 Oct 2009 08:15:57 +0000"  >&lt;p&gt;Hi David,&lt;/p&gt;

&lt;p&gt;Would it be possible to submit a small unit test that demonstrates this problem - then we can take a look at it in more depth?&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Dave&lt;/p&gt;</comment>
                            <comment id="12785055" author="hehe" created="Wed, 2 Dec 2009 23:23:47 +0000"  >&lt;p&gt;Further to Dave&apos;s comment, will the repository.xml help in diagnosing the problem? Not too sure what kind of unit tests required for this kind of information?&lt;br/&gt;
Thanks&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                            <comment id="12788087" author="hehe" created="Wed, 9 Dec 2009 13:41:50 +0000"  >&lt;p&gt;Hi, &lt;br/&gt;
Can anyone look at the issue again? This defect blocks me. I am happy to supply any more information if needed.&lt;br/&gt;
Thanks&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                            <comment id="12788162" author="rickhall" created="Wed, 9 Dec 2009 17:04:25 +0000"  >&lt;p&gt;It is really difficult for me to say if the above scenario description is correct or not, since I am not able to reproduce by creating bundles for the above three manifests.&lt;/p&gt;

&lt;p&gt;I mentioned two situations above where it might choose a lower version instead of a higher version; however, I do see a potential issue when selecting the &quot;best candidate&quot;. In that case, we are selecting based on the highest version of the candidate, not the highest version of the capability. Thus, if bundle2 is version 1.0.0 and bundle3 is version 2.0.0, then we will select bundle3.&lt;/p&gt;

&lt;p&gt;I don&apos;t recall if this was the original intent of selecting the best candidate, but my intuition tells me this is a logical error. It makes more sense to find the matching capability from each resource, then select the capability with the highest version. I will try to create a patch for this, but it is not clear to me if this will address your scenario or not.&lt;/p&gt;</comment>
                            <comment id="12788321" author="rickhall" created="Wed, 9 Dec 2009 21:26:19 +0000"  >&lt;p&gt;Ok, I committed a patch to address the issue I saw above and deployed a snapshot release. Please let me know if this makes any difference in the various use cases. Thanks.&lt;/p&gt;</comment>
                            <comment id="12789037" author="hehe" created="Fri, 11 Dec 2009 00:00:40 +0000"  >&lt;p&gt;Richard,&lt;br/&gt;
Thanks for looking into this. I am looking forward to trying the fix. Where can I access the snapshot release?&lt;br/&gt;
Thanks&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                            <comment id="12789331" author="rickhall" created="Fri, 11 Dec 2009 14:50:49 +0000"  >&lt;p&gt;Here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots-group/org/apache/felix/org.apache.felix.bundlerepository/1.5.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots-group/org/apache/felix/org.apache.felix.bundlerepository/1.5.0-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12793645" author="hehe" created="Tue, 22 Dec 2009 15:50:13 +0000"  >&lt;p&gt;Hi Richard,&lt;/p&gt;

&lt;p&gt;Thanks for the patch. I tried it but I got deadlock problem for the following situation:&lt;/p&gt;

&lt;p&gt;Bundle71 (in repo) : Depends on Bundle72&lt;br/&gt;
Bundle72 v1 (in repo) : depends on bundle73&lt;br/&gt;
Bundle72_2 v2 (in eba)  : Depends on Bundle.invalid // This should not be picked up&lt;br/&gt;
Bundle73 (in eba) : No Dependencies&lt;/p&gt;

&lt;p&gt;I expect bundle71, bundle71 v1 and bundle73 are installed in framework.&lt;/p&gt;



&lt;p&gt;3XMTHREADINFO      &quot;Thread-129&quot; TID:0x000000000238A400, j9thread_t:0x000004000ABA1920, state:CW, prio=5&lt;br/&gt;
3XMTHREADINFO1            (native thread ID:0x6BF9, native priority:0x5, native policy:UNKNOWN)&lt;br/&gt;
3XMTHREADINFO2            (native stack address range from:0x000004000B580000, to:0x000004000B540000, size:0x40000)&lt;br/&gt;
4XESTACKTRACE          at java/lang/Character.toLowerCase(Character.java:4187(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at java/lang/String.compareValue(String.java:450(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at java/lang/String.compareToIgnoreCase(String.java:466(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at org/apache/felix/bundlerepository/ResourceImpl$1.compare(ResourceImpl.java:55(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at java/util/TreeMap.cmp(TreeMap.java:4472(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at java/util/TreeMap.get(TreeMap.java:4344(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at org/apache/felix/bundlerepository/ResourceImpl.getSymbolicName(ResourceImpl.java:107(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at org/apache/felix/bundlerepository/ResourceImpl.hashCode(ResourceImpl.java:84(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at java/util/HashMap.getEntry(HashMap.java:506(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at java/util/HashMap.containsKey(HashMap.java:432(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at java/util/HashSet.contains(HashSet.java:138(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at org/apache/felix/bundlerepository/ResolverImpl.resolve(ResolverImpl.java:158(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at org/apache/felix/bundlerepository/ResolverImpl.resolve(ResolverImpl.java:199(Compiled Code))&lt;br/&gt;
4XESTACKTRACE          at org/apache/felix/bundlerepository/ResolverImpl.resolve(ResolverImpl.java:199)&lt;br/&gt;
4XESTACKTRACE          at org/apache/felix/bundlerepository/ResolverImpl.resolve(ResolverImpl.java:133)&lt;/p&gt;

&lt;p&gt;Please let me know if you need more information.&lt;br/&gt;
Thanks&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                            <comment id="12793654" author="rickhall" created="Tue, 22 Dec 2009 16:07:25 +0000"  >&lt;p&gt;What does &quot;in eba&quot; mean?&lt;/p&gt;

&lt;p&gt;Could you give me a simplified example of the bundle manifests and a description of the steps needed to reproduce the issue? If so, I will look into it.&lt;/p&gt;</comment>
                            <comment id="12794014" author="hehe" created="Wed, 23 Dec 2009 11:10:50 +0000"  >&lt;p&gt;Hi Richard,&lt;/p&gt;

&lt;p&gt;What I mean about &quot;in eba&quot; is that I put the bundles in my local repository. Sorry about the confusion. You can put the bundles in any repositories, which should not make any difference.&lt;/p&gt;

&lt;p&gt;Below are the manifests for the bundles I mentioned in my previous email. &lt;/p&gt;

&lt;p&gt;bundle71.jar&lt;/p&gt;

&lt;p&gt;Manifest-Version: 1.0&lt;br/&gt;
Bundle-ManifestVersion: 2&lt;br/&gt;
Bundle-Name: Bundle Plug-in&lt;br/&gt;
Bundle-SymbolicName: a.b.c.bundle71&lt;br/&gt;
Bundle-Version: 1.0.0&lt;br/&gt;
Bundle-Vendor: ABC&lt;br/&gt;
Import-Package: a.b.c.bundle72;version=3.0&lt;br/&gt;
Export-Package: a.b.c.bundle71&lt;/p&gt;

&lt;p&gt;bundle72.jar&lt;br/&gt;
Manifest-Version: 1.0&lt;br/&gt;
Bundle-ManifestVersion: 2&lt;br/&gt;
Bundle-Name: Bundle Plug-in&lt;br/&gt;
Bundle-SymbolicName: a.b.c.bundle72&lt;br/&gt;
Bundle-Version: 1.0.0&lt;br/&gt;
Bundle-Vendor: ABC&lt;br/&gt;
Import-Package: a.b.c.bundle73&lt;br/&gt;
Export-Package: a.b.c.bundle72;version=3.2.4.1ded6&lt;/p&gt;

&lt;p&gt;bundle72_2.jar&lt;br/&gt;
Manifest-Version: 1.0&lt;br/&gt;
Bundle-ManifestVersion: 2&lt;br/&gt;
Bundle-Name: Bundle Plug-in&lt;br/&gt;
Bundle-SymbolicName: a.b.c.bundle72&lt;br/&gt;
Bundle-Version: 2.0.0&lt;br/&gt;
Bundle-Vendor: ABC&lt;br/&gt;
Import-Package: a.b.c.bundle.invalid&lt;br/&gt;
Export-Package: a.b.c.bundle72;version=9&lt;/p&gt;

&lt;p&gt;bundle73&lt;br/&gt;
Manifest-Version: 1.0&lt;br/&gt;
Bundle-ManifestVersion: 2&lt;br/&gt;
Bundle-Name: Bundle Plug-in&lt;br/&gt;
Bundle-SymbolicName: a.b.c.bundle73&lt;br/&gt;
Bundle-Version: 1.0.0&lt;br/&gt;
Bundle-Vendor: ABC&lt;br/&gt;
Export-Package: a.b.c.bundle73&lt;br/&gt;
Import-Package: org.osgi.framework&lt;/p&gt;

&lt;p&gt;Feel free to let me know if you need more explanation.&lt;br/&gt;
Thanks&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                            <comment id="12799655" author="hehe" created="Wed, 13 Jan 2010 08:32:54 +0000"  >&lt;p&gt;Hi Richard,&lt;/p&gt;

&lt;p&gt;Can you please investigate the hanging?&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                            <comment id="12799746" author="rickhall" created="Wed, 13 Jan 2010 13:59:31 +0000"  >&lt;p&gt;I will try to look into it...got caught up in some higher priority issues...&lt;/p&gt;</comment>
                            <comment id="12799915" author="rickhall" created="Wed, 13 Jan 2010 20:36:40 +0000"  >&lt;p&gt;It was not a deadlock, but an infinite loop. In my last patch, I was attempting to remove a Resource from the list of candidates when it failed to resolve, but I should have been removing a Capability. As a result, the list never got smaller, which led to an infinite loop. I fixed it and your example now works for me. I deployed a new snapshot, let me know if you run into any other issues. Thanks.&lt;/p&gt;</comment>
                            <comment id="12804312" author="hehe" created="Sun, 24 Jan 2010 22:18:53 +0000"  >&lt;p&gt;Hi Richard,&lt;br/&gt;
Sorry for the delay. I was away last week. The patch worked. Thanks for your help. Which release will contain this fix?&lt;/p&gt;

&lt;p&gt;Thanks again.&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                            <comment id="12804562" author="rickhall" created="Mon, 25 Jan 2010 15:09:07 +0000"  >&lt;p&gt;The fix will be in the next release of the OBR bundle, which will hopefully be soon.&lt;/p&gt;</comment>
                            <comment id="12804792" author="hehe" created="Mon, 25 Jan 2010 23:44:52 +0000"  >&lt;p&gt;Thanks Richard,&lt;/p&gt;

&lt;p&gt;Can you please notify me by adding a quite comment when it is available, if possible? It will be great if it is available in the next couple of weeks:o.&lt;/p&gt;

&lt;p&gt;Thanks again&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                            <comment id="12830166" author="rickhall" created="Fri, 5 Feb 2010 17:05:34 +0000"  >&lt;p&gt;This should be released next week with Framework 2.0.3.&lt;/p&gt;</comment>
                            <comment id="12845587" author="hehe" created="Mon, 15 Mar 2010 23:09:16 +0000"  >&lt;p&gt;Hi Richard,&lt;/p&gt;

&lt;p&gt;I moved up to the latest release and found a bug, which might be related to the fix for this defect. I raised a separate bug, which is &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-2205&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FELIX-2205&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Emily&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57245</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vton:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183782</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>