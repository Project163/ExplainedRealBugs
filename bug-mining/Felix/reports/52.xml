<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:04:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-314] EventDispatcher class not reusable in same class loader for multiple Felix instances</title>
                <link>https://issues.apache.org/jira/browse/FELIX-314</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Consider this use case:&lt;/p&gt;

&lt;p&gt;   Felix felix = new Felix();&lt;br/&gt;
   felix.start(props, null);&lt;br/&gt;
   felix.shutdown();&lt;/p&gt;

&lt;p&gt;   felix = new Felix();&lt;br/&gt;
   felix.start(props, null);&lt;br/&gt;
   felix.shutdown();&lt;/p&gt;

&lt;p&gt;The first Felix instance will stop the EventDispatcher by calling the static EventDispatcher.shutdown() method thus stopping the event dispatcher thread and setting the static variables stopping and stopped to true. The reference to the event dispatcher thread in the static variable m_thread is not cleared on shutdown.&lt;/p&gt;

&lt;p&gt;The second Felix instance will create an EventDispatcher instance but the static fields are not reset. That is the event dispatcher is assumed to be stopped and the event dispatcher thread will not be newly created and started.&lt;/p&gt;

&lt;p&gt;I will suggest a patch for this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12372577">FELIX-314</key>
            <summary>EventDispatcher class not reusable in same class loader for multiple Felix instances</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Jun 2007 09:54:31 +0000</created>
                <updated>Fri, 29 Jun 2007 15:21:30 +0000</updated>
                            <resolved>Fri, 29 Jun 2007 14:53:45 +0000</resolved>
                                    <version>framework-0.8.0</version>
                                    <fixVersion>framework-1.0.0</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12508779" author="fmeschbe" created="Thu, 28 Jun 2007 09:59:38 +0000"  >&lt;p&gt;Patch trying to fix the EventDispatcher issue.&lt;/p&gt;

&lt;p&gt;This patch turns all static fields and methods into instance fields and methods. As a consequence the EventDispatcher constructor will start a thread on each call, while the EventDispatcher.shutdown method will stop the thread and remove the local reference to it.&lt;/p&gt;

&lt;p&gt;Incidentally, only two locations inside the Framework project are touched by this change: The Felix.shutdownInternalStart and Felix.start methods have to use the m_dispatcher field instead of calling the static method.&lt;/p&gt;

&lt;p&gt;I do not know of any other users of the EventDispatcher class, but I assume, there aren&apos;t any outside the Framework.&lt;/p&gt;

&lt;p&gt;If nobody opposes, I will apply this patch.&lt;/p&gt;</comment>
                            <comment id="12508831" author="rickhall" created="Thu, 28 Jun 2007 13:57:22 +0000"  >&lt;p&gt;I introduced that bug by apparently not thinking enough about what I was trying to do.&lt;/p&gt;

&lt;p&gt;The reason for all of the statics was not accidental, the goal was to essentially require only one EventDispatcher (and thus one dispatcher thread) for all Felix instances inside of a given JVM (loaded by a specific class loader). The goal here was to reduce overhead.&lt;/p&gt;

&lt;p&gt;I guess the debate here is whether or not it is worth it, but I would prefer such attempts to minimize thread usage. In truth, we probably should look at other places where threads are created to see if similar thread sharing can be achieved.&lt;/p&gt;</comment>
                            <comment id="12508935" author="karlpauls" created="Thu, 28 Jun 2007 21:21:00 +0000"  >&lt;p&gt;I&apos;d like to stress how important it is to keep the number of framework created threads to a minimum. I have use cases where I need lots of frameworks and operating systems have thread limits which are often hard to change. Additionally, threads are cumbersome in resource restricted environments (and I&apos;m using Felix there too). &lt;/p&gt;

&lt;p&gt;Furthermore, it looks to me like it should be enough to keep some kind of reference count of active frameworks in the EventDispatcher to make it work with a single thread, no?&lt;/p&gt;</comment>
                            <comment id="12509019" author="fmeschbe" created="Fri, 29 Jun 2007 06:28:42 +0000"  >&lt;p&gt;Sounds reasonable. So I suggest the following solution: We make the constructor private and provide a static factory method to acquire an EventDispatcher instance. This factory method would care to have the thread running and the flags cleared as well as having the use counter managed. The shutdown method in turn is &quot;fixed&quot; to obey the reference counter and to drop the thread reference after stopping it.&lt;/p&gt;

&lt;p&gt;I think it is more symetric to the static shutdown method if we have a static &quot;startup&quot; method instead of a constructor to acquire the EventDispatcher and setup the statics and a static shutdown to &quot;disable&quot; the dispatcher.&lt;/p&gt;</comment>
                            <comment id="12509030" author="rickhall" created="Fri, 29 Jun 2007 06:58:30 +0000"  >&lt;p&gt;I am okay with those changes...if you format the code to look like the existing code&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, then I think it looks good to commit. What do you think, Karl?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://cwiki.apache.org/FELIX/codingstandards.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cwiki.apache.org/FELIX/codingstandards.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12509034" author="fmeschbe" created="Fri, 29 Jun 2007 07:09:20 +0000"  >&lt;p&gt;&amp;gt; if you format the code to look like the existing code&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Hmm, looks like the blanks are not there (anymore ?) in parentheses of arguments, right ? But of course, will do that alignment. No problem &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12509040" author="karlpauls" created="Fri, 29 Jun 2007 07:37:23 +0000"  >&lt;p&gt;Looks good to me.&lt;/p&gt;</comment>
                            <comment id="12509121" author="fmeschbe" created="Fri, 29 Jun 2007 14:53:45 +0000"  >&lt;p&gt;Applied the patch with one slight modification apart from reformating: I named the reference counter to m_references because m_users does not really sound good as a reference counter.&lt;/p&gt;

&lt;p&gt;Fixed at Revision 551911.&lt;/p&gt;

&lt;p&gt;Deployed a new snapshot to the Apache Snapshot Repository.&lt;/p&gt;</comment>
                            <comment id="12509128" author="fmeschbe" created="Fri, 29 Jun 2007 15:21:30 +0000"  >&lt;p&gt;Fix confirmed by user. Hence closing this issue now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12360718" name="FELIX-314.diff" size="4171" author="fmeschbe" created="Thu, 28 Jun 2007 09:59:38 +0000"/>
                            <attachment id="12360780" name="FELIX-314_2.diff" size="3147" author="fmeschbe" created="Fri, 29 Jun 2007 06:28:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58670</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 22 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vzv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184783</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>