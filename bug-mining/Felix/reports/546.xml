<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:11:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1464] issue when using a negation in ldap service dependency filter</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1464</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I found an issue when using a negation in the service dependency ldap filter (or more generally when the filter alone is not sufficient to narrow the search down to the required service).&lt;/p&gt;

&lt;p&gt;Let&apos;s consider the following bundle activator:&lt;/p&gt;

&lt;p&gt;public class Activator extends DependencyActivatorBase {&lt;/p&gt;

&lt;p&gt;  interface Toto { }&lt;/p&gt;

&lt;p&gt;  private Toto _toto; //injected&lt;/p&gt;

&lt;p&gt;  public void init(BundleContext ctx, DependencyManager mgr) throws Exception {&lt;br/&gt;
    mgr.add(createService()&lt;br/&gt;
        .setInterface(Toto.class.getName(), new Hashtable() {{&lt;br/&gt;
          put(&quot;key&quot;, &quot;toto&quot;);&lt;br/&gt;
        }})&lt;br/&gt;
        .setImplementation(new Toto() {&lt;br/&gt;
          public String toString() &lt;/p&gt;
{ return &quot;toto&quot;; }
&lt;p&gt;        }));&lt;br/&gt;
    mgr.add(createService()&lt;br/&gt;
        .setImplementation(this)&lt;br/&gt;
        .add(createServiceDependency()&lt;br/&gt;
          .setService(Toto.class, &quot;(!(key=tutu))&quot;)&lt;br/&gt;
          .setAutoConfig(&quot;_toto&quot;).setRequired(true)));&lt;br/&gt;
  }&lt;br/&gt;
  public void start() &lt;/p&gt;
{
    System.out.println(&quot;got _toto=&quot;+_toto);
  }
&lt;p&gt;  public void destroy(BundleContext ctx, DependencyManager mgr) throws Exception {&lt;br/&gt;
  }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;When deployed in a framework with a WebConsole, we can see under the &quot;Configuration Status&quot; tab that ALL the services in the registry (like all the org.apache.felix.shell.Command for instance) are shown as being used by our test bundle (list of &quot;Using bundles&quot;).&lt;br/&gt;
From our test bundle point of view, only the correct service is bound because DM&apos;s ServiceTrackerCustomizer will filter out all services whose name don&apos;t match the expected one.&lt;br/&gt;
But from the service registry point of view it looks quite messy.&lt;/p&gt;

&lt;p&gt;Besides being very confusing on the WebConsole page, it becomes a real problem when, for example, lazy activated services managed by DeclarativeService are activated when they should not.&lt;/p&gt;


&lt;p&gt;Merely as a suggestion, I found the following patch which corrects the issue:&lt;/p&gt;

&lt;p&gt;Index: src/main/java/org/apache/felix/dependencymanager/ServiceDependency.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/main/java/org/apache/felix/dependencymanager/ServiceDependency.java    (revision 802768)&lt;br/&gt;
+++ src/main/java/org/apache/felix/dependencymanager/ServiceDependency.java    (working copy)&lt;br/&gt;
@@ -530,7 +530,9 @@&lt;br/&gt;
             throw new IllegalArgumentException(&quot;Service name cannot be null.&quot;);&lt;br/&gt;
         }&lt;br/&gt;
         m_trackedServiceName = serviceName;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;m_trackedServiceFilter = serviceFilter;&lt;br/&gt;
+    if(m_trackedServiceName != null &amp;amp;&amp;amp; serviceFilter != null &amp;amp;&amp;amp; serviceFilter.indexOf(&quot;objectClass&quot;) &amp;lt; 0) 
{
+      m_trackedServiceFilter = &quot;(&amp;amp;(objectClass=&quot;+m_trackedServiceName.getName()+&quot;)&quot;+serviceFilter+&quot;)&quot;;
+        }
&lt;p&gt; else m_trackedServiceFilter = serviceFilter;&lt;br/&gt;
         m_trackedServiceReference = null;&lt;br/&gt;
         return this;&lt;br/&gt;
     }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Best regards,&lt;br/&gt;
Arjun&lt;/p&gt;</description>
                <environment></environment>
        <key id="12432693">FELIX-1464</key>
            <summary>issue when using a negation in ldap service dependency filter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marrs">Marcel Offermans</assignee>
                                    <reporter username="apanday">Arjun Panday</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Aug 2009 15:22:14 +0000</created>
                <updated>Tue, 10 May 2011 08:35:28 +0000</updated>
                            <resolved>Tue, 11 Aug 2009 09:58:10 +0000</resolved>
                                    <version>dependencymanager-2.0.1</version>
                                                    <component>Dependency Manager</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12741755" author="marrs" created="Tue, 11 Aug 2009 08:28:09 +0000"  >&lt;p&gt;You are right that even though the filter used in the underlying ServiceTracker does not filter on the name of the service, the addingService() method does. Therefore it makes sense to include the service name in the filter condition. I do find the serviceFilter.indexOf(&quot;objectClass&quot;) a bit too tricky to commit. I understand what you&apos;re trying to achieve, but I don&apos;t think this is the right way to do it. In fact, I believe we should not add that condition at all. Three scenarios here:&lt;br/&gt;
1) The user did not manually add an objectClass condition to the filter. This will work, we just add our condition.&lt;br/&gt;
2) The user already added an objectClass condition to the filter, on the same class we&apos;re about to add. This will work, but the condition is part of the expression twice. One could argue that the filter expression parser could optimize that away if it&apos;s smart.&lt;br/&gt;
3) The user already added an objectClass condition for a &lt;b&gt;different&lt;/b&gt; class. This will not work, with our without the check you added, since in the end, the filter condition will conflict with the filtering done in addingService() so you won&apos;t ever find a match.&lt;/p&gt;

&lt;p&gt;Therefore I propose to include the patch without this extra check.&lt;/p&gt;</comment>
                            <comment id="12741756" author="marrs" created="Tue, 11 Aug 2009 08:31:19 +0000"  >&lt;p&gt;Please review the applied patch and comment and re-open if this is not satisfactory.&lt;/p&gt;</comment>
                            <comment id="12741770" author="apanday" created="Tue, 11 Aug 2009 09:02:10 +0000"  >&lt;p&gt;I agree, the extra check is not very useful (not to mention my silly double check on serviceName!)&lt;br/&gt;
I tried your fix and it seems fine. Thanks.&lt;/p&gt;</comment>
                            <comment id="12741777" author="marrs" created="Tue, 11 Aug 2009 09:53:30 +0000"  >&lt;p&gt;Made a mistake in the implementation. Forgot to invoke getName() on the class before using it in a String.&lt;/p&gt;</comment>
                            <comment id="12741778" author="marrs" created="Tue, 11 Aug 2009 09:58:10 +0000"  >&lt;p&gt;Committed the fix.&lt;/p&gt;</comment>
                            <comment id="13031090" author="marrs" created="Tue, 10 May 2011 08:35:28 +0000"  >&lt;p&gt;Part of the 3.0.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ar1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>270847</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>