<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:52:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4386] Deadlock while creating composite instances programatically</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4386</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;DEADLOCK DETECTED:&lt;br/&gt;
==================&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;deadlocked thread&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;iPOJO&amp;#93;&lt;/span&gt; pool-1-thread-1:&lt;br/&gt;
-------------------------------------------&lt;br/&gt;
Thread &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;iPOJO&amp;#93;&lt;/span&gt; pool-1-thread-1&apos; is waiting to acquire lock &apos;org.apache.felix.ipojo.composite.CompositeFactory@4b61f9d9&apos; that is held by thread &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;ACTIVE&amp;#93;&lt;/span&gt; ExecuteThread: &apos;2&apos;&lt;/p&gt;

&lt;p&gt;Stack trace:&lt;br/&gt;
------------&lt;br/&gt;
	org.apache.felix.ipojo.IPojoFactory.getComponentDescription(IPojoFactory.java:371)&lt;br/&gt;
	org.apache.felix.ipojo.composite.instance.InstanceHandler.__M_bindFactory(InstanceHandler.java:179)&lt;br/&gt;
	org.apache.felix.ipojo.composite.instance.InstanceHandler.bindFactory(InstanceHandler.java)&lt;br/&gt;
	sun.reflect.GeneratedMethodAccessor149.invoke(Unknown Source)&lt;br/&gt;
	sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	org.apache.felix.ipojo.util.Callback.call(Callback.java:260)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.DependencyCallback.callOnInstance(DependencyCallback.java:303)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.Dependency.invokeCallback(Dependency.java:340)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.Dependency.onObjectCreation(Dependency.java:290)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.DependencyHandler.__M_onCreation(DependencyHandler.java:524)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.DependencyHandler.onCreation(DependencyHandler.java)&lt;br/&gt;
	org.apache.felix.ipojo.HandlerManager.start(HandlerManager.java:132)&lt;br/&gt;
	org.apache.felix.ipojo.composite.CompositeManager.start(CompositeManager.java:355)&lt;br/&gt;
	org.apache.felix.ipojo.composite.CompositeFactory.createInstance(CompositeFactory.java:146)&lt;br/&gt;
	org.apache.felix.ipojo.IPojoFactory.createComponentInstance(IPojoFactory.java:319)&lt;br/&gt;
	org.apache.felix.ipojo.IPojoFactory.createComponentInstance(IPojoFactory.java:240)&lt;br/&gt;
	foo.activator.DeployInstanceActivator$1.addingService(DeployInstanceActivator.java:43)&lt;br/&gt;
	org.osgi.util.tracker.ServiceTracker$Tracked.customizerAdding(ServiceTracker.java:932)&lt;br/&gt;
	org.osgi.util.tracker.ServiceTracker$Tracked.customizerAdding(ServiceTracker.java:864)&lt;br/&gt;
	org.osgi.util.tracker.AbstractTracked.trackAdding(AbstractTracked.java:256)&lt;br/&gt;
	org.osgi.util.tracker.AbstractTracked.track(AbstractTracked.java:229)&lt;br/&gt;
	org.osgi.util.tracker.ServiceTracker$Tracked.serviceChanged(ServiceTracker.java:894)&lt;br/&gt;
	org.apache.felix.framework.util.EventDispatcher.invokeServiceListenerCallback(EventDispatcher.java:932)&lt;br/&gt;
	org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:793)&lt;br/&gt;
	org.apache.felix.framework.util.EventDispatcher.fireServiceEvent(EventDispatcher.java:543)&lt;br/&gt;
	org.apache.felix.framework.Felix.fireServiceEvent(Felix.java:4419)&lt;br/&gt;
	org.apache.felix.framework.Felix.registerService(Felix.java:3423)&lt;br/&gt;
	org.apache.felix.framework.BundleContextImpl.registerService(BundleContextImpl.java:346)&lt;br/&gt;
	org.apache.felix.ipojo.IPojoFactory.start(IPojoFactory.java:686)&lt;br/&gt;
	org.apache.felix.ipojo.extender.internal.linker.ManagedType$ExtensionSupport$1.call(ManagedType.java:229)&lt;br/&gt;
	org.apache.felix.ipojo.extender.internal.linker.ManagedType$ExtensionSupport$1.call(ManagedType.java:216)&lt;br/&gt;
	org.apache.felix.ipojo.extender.internal.queue.JobInfoCallable.call(JobInfoCallable.java:114)&lt;br/&gt;
	java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)&lt;br/&gt;
	java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)&lt;br/&gt;
	java.lang.Thread.run(Thread.java:662)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;deadlocked thread&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;ACTIVE&amp;#93;&lt;/span&gt; ExecuteThread: &apos;2&apos;&lt;br/&gt;
--------------------------------------------------------------------------------------------------&lt;br/&gt;
Thread &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;ACTIVE&amp;#93;&lt;/span&gt; ExecuteThread: &apos;2&apos; waiting to acquire lock &apos;org.apache.felix.ipojo.composite.CompositeFactory@d5a3c39&apos; that is held by thread &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;iPOJO&amp;#93;&lt;/span&gt; pool-1-thread-1&apos;&lt;/p&gt;

&lt;p&gt;Stack trace:&lt;br/&gt;
------------&lt;br/&gt;
	org.apache.felix.ipojo.IPojoFactory.getComponentDescription(IPojoFactory.java:371)&lt;br/&gt;
	org.apache.felix.ipojo.composite.instance.InstanceHandler.__M_bindFactory(InstanceHandler.java:179)&lt;br/&gt;
	org.apache.felix.ipojo.composite.instance.InstanceHandler.bindFactory(InstanceHandler.java)&lt;br/&gt;
	sun.reflect.GeneratedMethodAccessor149.invoke(Unknown Source)&lt;br/&gt;
	sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	org.apache.felix.ipojo.util.Callback.call(Callback.java:260)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.DependencyCallback.callOnInstance(DependencyCallback.java:303)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.Dependency.invokeCallback(Dependency.java:340)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.Dependency.onObjectCreation(Dependency.java:290)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.DependencyHandler.__M_onCreation(DependencyHandler.java:524)&lt;br/&gt;
	org.apache.felix.ipojo.handlers.dependency.DependencyHandler.onCreation(DependencyHandler.java)&lt;br/&gt;
	org.apache.felix.ipojo.HandlerManager.start(HandlerManager.java:132)&lt;br/&gt;
	org.apache.felix.ipojo.composite.CompositeManager.start(CompositeManager.java:355)&lt;br/&gt;
	org.apache.felix.ipojo.composite.CompositeFactory.createInstance(CompositeFactory.java:146)&lt;br/&gt;
	org.apache.felix.ipojo.IPojoFactory.createComponentInstance(IPojoFactory.java:319)&lt;br/&gt;
	org.apache.felix.ipojo.IPojoFactory.createComponentInstance(IPojoFactory.java:240)&lt;br/&gt;
	foo.activator.DeployInstanceActivator$1.addingService(DeployInstanceActivator.java:43)&lt;br/&gt;
	org.osgi.util.tracker.ServiceTracker$Tracked.customizerAdding(ServiceTracker.java:932)&lt;br/&gt;
	org.osgi.util.tracker.ServiceTracker$Tracked.customizerAdding(ServiceTracker.java:864)&lt;br/&gt;
	org.osgi.util.tracker.AbstractTracked.trackAdding(AbstractTracked.java:256)&lt;br/&gt;
	org.osgi.util.tracker.AbstractTracked.trackInitial(AbstractTracked.java:183)&lt;br/&gt;
	org.osgi.util.tracker.ServiceTracker.open(ServiceTracker.java:317)&lt;br/&gt;
	org.osgi.util.tracker.ServiceTracker.open(ServiceTracker.java:261)&lt;br/&gt;
	foo.activator.DeployInstanceActivator.start(DeployInstanceActivator.java:74)&lt;br/&gt;
	org.apache.felix.framework.util.SecureAction.startActivator(SecureAction.java:645)&lt;br/&gt;
	org.apache.felix.framework.Felix.activateBundle(Felix.java:2146)&lt;br/&gt;
	org.apache.felix.framework.Felix.startBundle(Felix.java:2064)&lt;br/&gt;
	org.apache.felix.framework.Felix.updateBundle(Felix.java:2404)&lt;br/&gt;
	org.apache.felix.framework.BundleImpl.update(BundleImpl.java:973)&lt;br/&gt;
	...&lt;/p&gt;

&lt;p&gt;&amp;gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="12689053">FELIX-4386</key>
            <summary>Deadlock while creating composite instances programatically</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clement.escoffier">Clement Escoffier</assignee>
                                    <reporter username="patricio78">Patricio Barletta</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jan 2014 18:17:09 +0000</created>
                <updated>Fri, 7 Mar 2014 08:27:15 +0000</updated>
                            <resolved>Sat, 18 Jan 2014 08:46:55 +0000</resolved>
                                    <version>ipojo-composite-1.8.4</version>
                                    <fixVersion>ipojo-runtime-1.11.1</fixVersion>
                                    <component>iPOJO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13872370" author="patricio78" created="Wed, 15 Jan 2014 18:23:36 +0000"  >&lt;p&gt;The problem seems to be in org.apache.felix.ipojo.composite.instance.InstanceHandler. The handler is tracking all iPOJO Factories by the bind method bindFactory.&lt;br/&gt;
Inside the bindFactory there is a call to factory.getComponentDescription(), which is synchronized. That other factory lock is held by another thread creating a composite instance. Both threads hold a lock on their respective factories, and both receive a bindFactory call with the other&apos;s thread Factory.&lt;br/&gt;
I&apos;m running in a system with hundred of bundles, each containing a composite metadata.xml. Another set of bundles take care of creating/disposing composite instances programatically, by tracking on their respective composite factory bundle.&lt;br/&gt;
I also see a performance and memory footprint degradation as the InstanceHandler is actually tracking all Factories in the system, without any filtering.&lt;/p&gt;</comment>
                            <comment id="13875594" author="clement.escoffier" created="Sat, 18 Jan 2014 08:46:55 +0000"  >&lt;p&gt;I&apos;ve fixed it in the trunk.&lt;/p&gt;

&lt;p&gt;The description field does not need to have synchronized accesses.&lt;/p&gt;

&lt;p&gt;Could you check ?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368020</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rfmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368327</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>