<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:10:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5649] Refreshing a fragment causes the framework to be restarted</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5649</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;This is caused because the fragment has 2 wires: one to its host and another one to the system bundle for an osgi.ee requirement.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13077675">FELIX-5649</key>
            <summary>Refreshing a fragment causes the framework to be restarted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="gnodet">Guillaume Nodet</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Jun 2017 13:44:58 +0000</created>
                <updated>Fri, 6 Oct 2017 21:37:13 +0000</updated>
                            <resolved>Wed, 7 Jun 2017 08:06:06 +0000</resolved>
                                    <version>framework-5.0.0</version>
                                    <fixVersion>framework-5.6.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16039010" author="gnt" created="Tue, 6 Jun 2017 14:49:58 +0000"  >&lt;p&gt;From the specs (section 3.15.1, &lt;a href=&quot;https://github.com/apache/felix/blob/trunk/resolver/src/main/java/org/apache/felix/resolver/ResolverImpl.java#L2027-L2028&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/blob/trunk/resolver/src/main/java/org/apache/felix/resolver/ResolverImpl.java#L2027-L2028&lt;/a&gt;), it seems that the fact that there are 2 wires on the fragment is expected.&lt;br/&gt;
However, such a wire should definitely not cause a refresh of the framework if a fragment is refreshed.&lt;br/&gt;
So I&apos;m planning to add an additional test around the following line:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/felix/blob/trunk/framework/src/main/java/org/apache/felix/framework/BundleRevisionDependencies.java#L173&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/blob/trunk/framework/src/main/java/org/apache/felix/framework/BundleRevisionDependencies.java#L173&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (HostNamespace.HOST_NAMESPACE.equals(bw.getCapability().getNamespace()))
                        {
                            result.add(bw.getProvider().getBundle());
                        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16039031" author="rickhall" created="Tue, 6 Jun 2017 14:58:18 +0000"  >&lt;p&gt;Fragments can have multiple wires, but they should only be wires to hosts, they shouldn&apos;t have any other type of wire, IIRC.&lt;/p&gt;

&lt;p&gt;I could be wrong, but I thought a fragment attached to the system bundle does cause a framework refresh, though.&lt;/p&gt;</comment>
                            <comment id="16039064" author="karlpauls" created="Tue, 6 Jun 2017 15:16:53 +0000"  >&lt;p&gt;Yeah, I&apos;m a bit confused as well. As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;gnodet&lt;/a&gt; references 3.15.1 it almost sounds like we are talking about an extension bundle - in which case, it would be correct that the framework gets refreshed (from the spec 3.15): &lt;/p&gt;

&lt;p&gt;&quot;If a RESOLVED extension bundle is refreshed then the Framework must shutdown; the host VM must terminate and framework must be re-launched.&quot;&lt;/p&gt;

&lt;p&gt;Obviously, if we are talking about a &quot;normal&quot; fragment, it shouldn&apos;t.&lt;/p&gt;</comment>
                            <comment id="16039347" author="gnt" created="Tue, 6 Jun 2017 17:56:55 +0000"  >&lt;p&gt;In my case, the fragment is not an extension.  But reading the spec and the resolver impl lead me to think that osgi.ee requirements are not hosted, i.e. they are wired from the fragment itself and not its host.&lt;br/&gt;
That has been the case at least from framework 5.0.0 release.&lt;br/&gt;
If that&apos;s correct, then we simply need to only take into account host wires when calculating dependencies as suggested by my patch above.&lt;/p&gt;</comment>
                            <comment id="16039362" author="gnt" created="Tue, 6 Jun 2017 18:02:31 +0000"  >&lt;p&gt;See the section 7.4:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A fragment bundle will show all its declared capabilities and requirements on its Bundle Revision but during resolving the resolver only considers the osgi.wiring.host and osgi.ee requirements and the osgi.identity capability and requirements.
The osgi.wiring.host requirement represents the Fragment-Host header. A fragment can be attached to different hosts and each attachment creates a wire from the fragment&lt;span class=&quot;code-quote&quot;&gt;&apos;s Bundle Wiring to the host&apos;&lt;/span&gt;s Bundle Wiring. The osgi.ee requirement is also never hosted.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16039481" author="rickhall" created="Tue, 6 Jun 2017 19:12:46 +0000"  >&lt;p&gt;Ok, I see what you are saying. The reasoning behind not letting the ee requirement be hosted is not clear to me, although I understand there is no need to resolve the ee requirement more than once for hosting, it does no harm to do it more than once and doesn&apos;t create a special case. But if that is the case, then yes it does seem like refreshing should only consider host requirements when refreshing fragment dependencies.&lt;/p&gt;</comment>
                            <comment id="16040459" author="gnt" created="Wed, 7 Jun 2017 08:06:06 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Committing to https:&lt;span class=&quot;code-comment&quot;&gt;//svn.apache.org/repos/asf/felix/trunk ...
&lt;/span&gt;	M	framework/src/main/java/org/apache/felix/framework/BundleRevisionDependencies.java
Committed r1797882
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="13077697">KARAF-5180</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13107629">FELIX-5709</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13091172">KARAF-5278</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fxfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>