<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:57:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4851] ConfigAdmin only forwards ConfigurationEvents to ConfigurationListeners which are provided by bundles that are in state ACTIVE</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4851</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I am facing a serious problem with the Felix ConfigAdmin in combination with Felix SCR. Let us assume that the SCR bundle becomes activated at last and activates a component that creates a configuration which itself is a precondition for the instantiation of another component (ConfigurationPolicy#REQUIRE). In this case the Felix ConfigAdmin does not deliver the configuration update event to SCR, although SCR has registered a ConfigurationListener in the OSGi Service Registry.&lt;br/&gt;
The problem is caused by line 2029 of the class ConfigurationManager (Version: 1.8.3-SNAPSHOT):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( listenerProvider[serviceIndex].getState() == Bundle.ACTIVE &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.listeners[serviceIndex] != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; )
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this scenario, the SCR bundle is in state STARTING and reaches the ACTIVE state directly after all available components have been activated. Because of missing Configuration Events caused by the Felix ConfigAdmin, SCR is not able to activate all those components whose preconditions are actually fulfilled. The problem does not occur in combination with the Equinox ConfigAdmin, which does not make the problematic bundle state check.&lt;br/&gt;
I highly recommend removing the bundle state check and change line 2029 into:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.listeners[serviceIndex] != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ).
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is up to the developer to decide, in which bundle state configuration events are considered to be important or not. In the SCR scenario, the developers rely on the fact that configuration events are delivered independently of their bundle state.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12820309">FELIX-4851</key>
            <summary>ConfigAdmin only forwards ConfigurationEvents to ConfigurationListeners which are provided by bundles that are in state ACTIVE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bosschaert">David Bosschaert</assignee>
                                    <reporter username="herr-herner">Jens Offenbach</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Apr 2015 12:49:34 +0000</created>
                <updated>Thu, 19 Dec 2019 17:37:20 +0000</updated>
                            <resolved>Fri, 17 Apr 2015 11:59:50 +0000</resolved>
                                    <version>configadmin-1.8.2</version>
                                    <fixVersion>configadmin-1.8.4</fixVersion>
                                    <component>Configuration Admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14491019" author="magnet" created="Sat, 11 Apr 2015 13:12:28 +0000"  >&lt;p&gt;Oh thanks a lot. We&apos;re facing the same problem that has been plaguing us for some time, and I was thinking to try to find exactly what&apos;s happening this afternoon, but you just made that useless &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;My workaround so far has been to call configAdmin.getConfiguration(configPid, null).update(properties); after all bundles are in the ACTIVE state, which is very ugly. &lt;/p&gt;

&lt;p&gt;I believe this fix alone, if it&apos;s approved, warrants a new release!&lt;/p&gt;

&lt;p&gt;I might as well report that Felix SCR&apos;s &quot;scr:info&quot; Gogo command is outputing wrong info when the problem happens; it seems it has no way to tell a component is unsatisfied because the required configuration was not provided, an instead the first required service reference is stated as unsatisfied, even though the service is indeed provided and used elsewhere in the same bundle.&lt;/p&gt;</comment>
                            <comment id="14491038" author="herr-herner" created="Sat, 11 Apr 2015 13:43:05 +0000"  >&lt;p&gt;I am facing the problem for a long time, but I was never able to find the issue. My workaround so far was to resort to the Equinox CM, but now we must run in Apache Karaf where the Felix ConfigAdmin is set. The activation problem becomes now a hard blocker for me. In the last time, I have tried to get rid of all direct OSGi dependencies (.e.g. BundleActivator), relying solely on SCR and the problem has been multiplied.&lt;/p&gt;

&lt;p&gt;Thanks for the info regarding SCR&apos;s &quot;scr:info&quot;. Hopefully, the problem can be fixed soon.&lt;/p&gt;</comment>
                            <comment id="14499696" author="gnt" created="Fri, 17 Apr 2015 11:44:24 +0000"  >&lt;p&gt;Committing to &lt;a href=&quot;https://svn.apache.org/repos/asf/felix/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/felix/trunk&lt;/a&gt; ...&lt;br/&gt;
	M	configadmin/src/main/java/org/apache/felix/cm/impl/ConfigurationManager.java&lt;br/&gt;
Committed r1674281&lt;/p&gt;</comment>
                            <comment id="14499706" author="bosschaert" created="Fri, 17 Apr 2015 11:54:51 +0000"  >&lt;p&gt;I had actually worked on a slightly different fix. After discussing with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;gnodet&lt;/a&gt; we decided to use my approach which allows events to be sent to bundles in STARTING and ACTIVE states, but not in all other states. For example it is not desirable to have events sent to bundles in the STOPPING state. &lt;/p&gt;</comment>
                            <comment id="14499708" author="bosschaert" created="Fri, 17 Apr 2015 11:59:50 +0000"  >&lt;p&gt;Applied my fix in &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1674284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1674284&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also added a unit test for this and ran it through the OSGi ConfigAdmin CT.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=herr-herner&quot; class=&quot;user-hover&quot; rel=&quot;herr-herner&quot;&gt;herr-herner&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=magnet&quot; class=&quot;user-hover&quot; rel=&quot;magnet&quot;&gt;magnet&lt;/a&gt; could you please check that this resolves the issue for you?&lt;/p&gt;</comment>
                            <comment id="14499714" author="cziegeler" created="Fri, 17 Apr 2015 12:05:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=magnet&quot; class=&quot;user-hover&quot; rel=&quot;magnet&quot;&gt;magnet&lt;/a&gt; Could you please open a separate issue for the SCR gogo command problem?&lt;/p&gt;</comment>
                            <comment id="14499717" author="magnet" created="Fri, 17 Apr 2015 12:08:00 +0000"  >&lt;p&gt;~davidb: Thanks. I&apos;ll try it right now but that will take some time, I know one of our integration servers used to always fail (on my dev machine, it rarely happened)&lt;br/&gt;
~cziegeler: Sure thing.&lt;/p&gt;</comment>
                            <comment id="14499763" author="magnet" created="Fri, 17 Apr 2015 12:49:06 +0000"  >&lt;p&gt;The fix seems to work for me. I have a test environment where the current release of ConfigAdmin consistently fails at updating my DS components and  switching  the configadmin impl with the current snapshot fixes the problem. Tried a few times back and forth and it seems OK. Thanks a lot!&lt;/p&gt;

&lt;p&gt;On a related note, the pax-exam integration tests on ConfigAdmin are failing with deployment errors using mvn clean install. I had to skipTests to build the snapshot. I know that&apos;s another issue, but for the record I have fixed it a few weeks ago when I was having a look at the current issue and pushed it here &lt;a href=&quot;https://github.com/livingobjects/felix-configadmin&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/livingobjects/felix-configadmin&lt;/a&gt;. Please tell me if the build is broken for you as well so that I can open another issue and extract a patch.&lt;/p&gt;

&lt;p&gt;~cziegeler: I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4857&quot; title=&quot;SCR Gogo commands outputs wrong infos when a component is unsatisfied because of missing configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-4857&quot;&gt;&lt;del&gt;FELIX-4857&lt;/del&gt;&lt;/a&gt; for the scr command issue.&lt;/p&gt;</comment>
                            <comment id="14499777" author="bosschaert" created="Fri, 17 Apr 2015 13:01:50 +0000"  >&lt;p&gt;&amp;gt; On a related note, the pax-exam integration tests on ConfigAdmin are failing with deployment errors using mvn clean install.&lt;/p&gt;

&lt;p&gt;I&apos;m not seeing this issue. For me &apos;mvn clean install&apos; in the configadmin directory completes successfully. (With Maven 3.0.5 and Java 1.7 on OSX)&lt;/p&gt;</comment>
                            <comment id="14499784" author="magnet" created="Fri, 17 Apr 2015 13:08:06 +0000"  >&lt;p&gt;I&apos;m on Linux with Apache Maven 3.3.1, a clean local repository and Maven central.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java version &quot;1.8.0_40&quot;
Java(TM) SE Runtime Environment (build 1.8.0_40-b25)
Java HotSpot(TM) 64-Bit Server VM (build 25.40-b25, mixed mode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have tens of errors like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR: Bundle org.ops4j.pax.tinybundles [15] Error starting mvn:org.ops4j.pax.tinybundles/tinybundles/1.0.0 (org.osgi.framework.BundleException: Unresolved constraint in bundle org.ops4j.pax.tinybun
dles [15]: Unable to resolve 15.0: missing requirement [15.0] osgi.wiring.package; (&amp;amp;(osgi.wiring.package=org.slf4j)(version&amp;gt;=1.6.0)(!(version&amp;gt;=2.0.0))) [caused by: Unable to resolve 6.0: missing re
quirement [6.0] osgi.wiring.package; (osgi.wiring.package=javax.xml.parsers)])
org.osgi.framework.BundleException: Unresolved constraint in bundle org.ops4j.pax.tinybundles [15]: Unable to resolve 15.0: missing requirement [15.0] osgi.wiring.package; (&amp;amp;(osgi.wiring.package=org
.slf4j)(version&amp;gt;=1.6.0)(!(version&amp;gt;=2.0.0))) [caused by: Unable to resolve 6.0: missing requirement [6.0] osgi.wiring.package; (osgi.wiring.package=javax.xml.parsers)]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Most errors are related to javax packages not being defined in systemPackages() in pax exam.&lt;/p&gt;

&lt;p&gt;PS: Sorry for the message flood, the JIRA instance is severely lagging.&lt;/p&gt;</comment>
                            <comment id="14499811" author="cziegeler" created="Fri, 17 Apr 2015 13:24:05 +0000"  >&lt;p&gt;That&apos;s a problem of 1.8 and PAX I think, updating the pax version does the trick (at least that solved it for me in a different project9&lt;/p&gt;</comment>
                            <comment id="14500343" author="herr-herner" created="Fri, 17 Apr 2015 18:13:21 +0000"  >&lt;p&gt;Thanks a lot. I have built the ConfigAdmin fresh from the Felix repository and everythings works nice with 1.8.3-SNAPSHOT. Switching back to 1.8.2 and the issue occurs immediately. I get under Windows 7 and Java 8 the same error stated above during test execution. I switched to Java 7, but Pax reports two test failures:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Failed tests:
testCMUpdateStress:org.apache.felix.cm.integration.ConfigurationAdminUpdateStressTest.testCMUpdateStress:NativeContainer:org.apache.felix.framework.FrameworkFactory@714fef9f(org.apache.felix.cm.integration.ConfigurationAdminUpdateStressTest): Test did not completed timely
test_ConcurrentManagedServicesWithConcurrentConfigurations:org.apache.felix.cm.integration.FELIX4385_StressTest.test_ConcurrentManagedServicesWithConcurrentConfigurations:NativeContainer:org.apache.felix.framework.FrameworkFactory@67adc23a(org.apache.felix.cm.integration.FELIX4385_StressTest): Test failed: Detected errors logged during concurrent test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Harald from Pax Exam prepares a new release that will be fully compatbile with both OSGi R6 frameworks. Have a look here: &lt;a href=&quot;https://ops4j1.jira.com/browse/PAXEXAM-701&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://ops4j1.jira.com/browse/PAXEXAM-701&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d54f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>