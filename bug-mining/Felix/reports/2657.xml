<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:03:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4840] Asynchronous IO fails in webconsole plugin</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4840</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;&lt;b&gt;Issue&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;The following function call always returns with true:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ServletRequest.isAsyncSupported()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, async calls fail even if the webconsole plugin tries to provide some resource (with some special extension on the end of the URI).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Reason&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In the end of the &lt;em&gt;OSGiManager.service(ServletRequest, ServletResponse)&lt;/em&gt; function, there is the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// ensure response has been sent back and response is committed
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// (we are authorative &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; our URL space and no other servlet should interfere)
&lt;/span&gt;        res.flushBuffer();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Due to the reason that &lt;em&gt;flushBuffer()&lt;/em&gt; function is called, any asynchronous handling will fail with an exception.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Proposed solution&lt;/b&gt;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In case the webconsole plugin is rendered (the path ends with / or .html), the &lt;em&gt;request.isAsyncSupported()&lt;/em&gt; method call should return false&lt;/li&gt;
	&lt;li&gt;In case a custom resource is provided by the webconsole plugin (any extension but html on the end of the path) the &lt;em&gt;flushBuffer()&lt;/em&gt; method should not be called&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;At least the second part of the fix should be implemented as if a plugin wants to provide bigger files (like a dump), async support can be useful. Also, by the time more and more libraries will support asynchronous IO to provide resources and if a webconsole plugin uses such library, it will fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12787394">FELIX-4840</key>
            <summary>Asynchronous IO fails in webconsole plugin</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="balazs.zsoldos">Balazs Zsoldos</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Apr 2015 16:32:28 +0000</created>
                <updated>Fri, 13 Jan 2017 20:45:42 +0000</updated>
                            <resolved>Mon, 13 Jun 2016 12:18:55 +0000</resolved>
                                    <version>webconsole-4.2.8</version>
                                    <fixVersion>webconsole-4.2.18</fixVersion>
                                    <component>Web Console</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14392201" author="cziegeler" created="Thu, 2 Apr 2015 06:01:25 +0000"  >&lt;p&gt;isAsyncSupported returning true is not a problem/bug of the web console; this is more a problem of the http service implementation. I assume you&apos;re using an implementing embedding Jetty (like the Apache Felix one). Jetty always returns true. We are currently working on an update of the Felix implementation handling this correctly and ignoring the value from Jetty.&lt;br/&gt;
I agree that if your web console plugin wants to use async support, we maybe should change the webconsole implementation as well&lt;/p&gt;</comment>
                            <comment id="14392473" author="balazs.zsoldos" created="Thu, 2 Apr 2015 09:51:26 +0000"  >&lt;p&gt;I am not sure HTTPService implementation should be changed at all. It is up to the servlet if async is supported or not. In case of WebConsole, there are two different situations:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;A full page is rendered&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;In this case async is not supported. I do not think async is an issue as plugins would not want to (and cannot) render their fragments asynchronously.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The request is simply dispatched to the plugin&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;This happens if the end of the uri neither ends with extension nor the extension is &lt;em&gt;.html&lt;/em&gt;. When such a request comes, Webconsole should not call any function on the response By calling &lt;em&gt;flushBuffer()&lt;/em&gt;, webconsole horns in on the lifecycle of the response although it should not.&lt;/p&gt;</comment>
                            <comment id="14392503" author="balazs.zsoldos" created="Thu, 2 Apr 2015 10:21:59 +0000"  >&lt;p&gt;Btw.: I made a workaround in my plugin that I wrap the request in the plugin with HttpServletRequestWrapper and override the function of isAsyncSupported() in case of non-full page requests.&lt;/p&gt;</comment>
                            <comment id="15327246" author="cziegeler" created="Mon, 13 Jun 2016 12:18:55 +0000"  >&lt;p&gt;I&apos;ve removed the flushBuffer call - not sure why it was there in the first place&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27nin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>