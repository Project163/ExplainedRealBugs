<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:54:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4534] Bundles containing native code fails to start on Windows 7</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4534</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Windows 7 system is not properly recognized which makes bundles containing native code fail to start.&lt;/p&gt;

&lt;p&gt;The OS name is retrieved using Java system property in org.apache.felix.Felix class, line 4481. OS name is then &quot;Windows 7&quot;, with a space.&lt;/p&gt;

&lt;p&gt;It is then normalized using method org.apache.felix.framework.util.manifestparser.R4LibraryClause.normalizeOSName() and stored in the configMap. OS name becomes &quot;windows7&quot; without the space.&lt;/p&gt;

&lt;p&gt;When starting the bundle, method org.apache.felix.framework.util.manifestparser.R4LibraryClause.match() is called, retrieves the already normalized OS name (&quot;windows7&quot;) in the configMap and normalizes it again.&lt;/p&gt;

&lt;p&gt;This second normalisation fails as &quot;windows7&quot; without the space is not recognized by method org.apache.felix.framework.util.manifestparser.R4LibraryClause.normalizeOSName().&lt;/p&gt;

&lt;p&gt;In particular, the condition in the if statement line 392 is false when the OS name is &quot;windows7&quot;:&lt;br/&gt;
if ((value.indexOf(&quot; 7&quot;) &amp;gt;= 0) || value.equals(&quot;win7&quot;))&lt;/p&gt;

&lt;p&gt;Possible solutions are:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;prevent the OS name to be normalized twice (by checking if it is already normal)&lt;/li&gt;
	&lt;li&gt;improve the normalisation to deal with &quot;windows7&quot; OS name (by replacing the if statement with if ((value.indexOf(&quot;7&quot;) &amp;gt;= 0)) &amp;lt;- no space)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>Windows 7</environment>
        <key id="12721107">FELIX-4534</key>
            <summary>Bundles containing native code fails to start on Windows 7</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bosschaert">David Bosschaert</assignee>
                                    <reporter username="bthiebault">Beno&#238;t Thi&#233;bault</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jun 2014 13:33:27 +0000</created>
                <updated>Tue, 11 Nov 2014 09:19:00 +0000</updated>
                            <resolved>Mon, 16 Jun 2014 07:25:13 +0000</resolved>
                                    <version>framework-4.2.0</version>
                    <version>framework-4.2.1</version>
                    <version>framework-4.4.0</version>
                                    <fixVersion>framework-4.4.1</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14030748" author="bosschaert" created="Fri, 13 Jun 2014 15:32:48 +0000"  >&lt;p&gt;I&apos;m having a look to provide a fix for this...&lt;/p&gt;</comment>
                            <comment id="14030754" author="rickhall" created="Fri, 13 Jun 2014 15:37:57 +0000"  >&lt;p&gt;Ok, I think the best approach is to simply not re-normalize already normal names. Thanks!&lt;/p&gt;</comment>
                            <comment id="14030770" author="bosschaert" created="Fri, 13 Jun 2014 15:49:20 +0000"  >&lt;p&gt;Is there a simple way to figure out that a string has already been normalized though?&lt;/p&gt;

&lt;p&gt;The one thing that I notice is is that for these Windows values the return value doesn&apos;t pass its own test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((value.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&quot; 7&quot;&lt;/span&gt;) &amp;gt;= 0) || value.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;win7&quot;&lt;/span&gt;))
  {
    os = &lt;span class=&quot;code-quote&quot;&gt;&quot;windows7&quot;&lt;/span&gt;;
  }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14030782" author="bosschaert" created="Fri, 13 Jun 2014 16:02:49 +0000"  >&lt;p&gt;I guess the easiest way to fix this would be to make that condition pass its own test (like the other tests in this place), e.g. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((value.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&quot; 7&quot;&lt;/span&gt;) &amp;gt;= 0) || value.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;win7&quot;&lt;/span&gt;) || value.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;windows7&quot;&lt;/span&gt;))
  {
    os = &lt;span class=&quot;code-quote&quot;&gt;&quot;windows7&quot;&lt;/span&gt;;
  }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But that doesn&apos;t change the amount of times that the normalization is executed...&lt;/p&gt;</comment>
                            <comment id="14030783" author="bthiebault" created="Fri, 13 Jun 2014 16:03:02 +0000"  >&lt;p&gt;Exactly, it&apos;s because the Windows 7 normalised name does not pass the normalisation test that the problem appears.&lt;/p&gt;

&lt;p&gt;To know if a name is already normalised, you could store the normalised names somewhere. There is another bug report from Richard that suggest storing OS names in a properties file.&lt;/p&gt;</comment>
                            <comment id="14031014" author="rickhall" created="Fri, 13 Jun 2014 19:05:25 +0000"  >&lt;p&gt;Yes, David, I think that would be the easiest too.&lt;/p&gt;</comment>
                            <comment id="14031109" author="bosschaert" created="Fri, 13 Jun 2014 20:26:38 +0000"  >&lt;p&gt;I wrote an implementation in &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1602511&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1602511&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I basically didn&apos;t go for the easiest way I described above, but use a map of all the normalized names instead so that already normalized osnames won&apos;t be normalized again. This should be a little faster at runtime and this should also be really easy to change to having these names stored in a properties file, in a later commit.&lt;/p&gt;

&lt;p&gt;Beno&#238;t, would you have time to see whether this fixes the issue for you?&lt;br/&gt;
Richard, are you happy with the approach I took? &lt;br/&gt;
If not I&apos;m happy to change things...&lt;/p&gt;</comment>
                            <comment id="14031485" author="bthiebault" created="Sat, 14 Jun 2014 06:19:10 +0000"  >&lt;p&gt;Yes, it fixes the issue for me.&lt;/p&gt;

&lt;p&gt;Maybe it is a good occasion to coordinate with &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3883&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FELIX-3883&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks both for your help anyway &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14032183" author="bosschaert" created="Mon, 16 Jun 2014 07:25:13 +0000"  >&lt;p&gt;Thanks for confirming, Beno&#238;t.&lt;/p&gt;</comment>
                            <comment id="14032548" author="rickhall" created="Mon, 16 Jun 2014 15:25:21 +0000"  >&lt;p&gt;Looks good, David. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12754415">FELIX-4690</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399304</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wqo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399414</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>