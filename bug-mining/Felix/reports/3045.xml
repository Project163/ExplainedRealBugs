<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:13:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5950] NPE in  MultiplePrototypeRefPair.unsetServiceObject</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5950</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I use Felix with the eclipse runtime (Photon 0918), and I get a NPE when running my application.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Actually in the code of&#160;&lt;/p&gt;

&lt;p&gt;MultiplePrototypeRefPair.unsetServiceObject we have : &#160;instances.get(key).&#160;&lt;/p&gt;

&lt;p&gt;If we search for the callers, the DependencyManager class call It like this :&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&#160; &#160; &#160; protected void ungetService(RefPair&amp;lt;S, T&amp;gt; ref)&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; {&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; &#160; &#160; Object service = ref.unsetServiceObject(&lt;b&gt;null&lt;/b&gt;);&lt;/p&gt;

&lt;p&gt;&#160; &#160; &#160; &#160; &#160; &#160; if (service != null)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Unfortunately, the instances map is a ConcurentHashMap which can not deal with null keys (it calls key.hashcode at the beginning), and this call will always raise an exception...&#160;&lt;/p&gt;

&lt;p&gt;Don&apos;t know what is the Felix version involved, but the bundle I use in my launch configuration is &#160;(org.apache.felix.scr 2.0.14.v20180117)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>Mac OS X 10.14</environment>
        <key id="13189376">FELIX-5950</key>
            <summary>NPE in  MultiplePrototypeRefPair.unsetServiceObject</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="olivierprouvost">Olivier Prouvost</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Oct 2018 09:10:05 +0000</created>
                <updated>Tue, 13 Nov 2018 11:04:04 +0000</updated>
                            <resolved>Thu, 18 Oct 2018 05:29:28 +0000</resolved>
                                                    <fixVersion>scr-2.1.14</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16637977" author="pderop" created="Thu, 4 Oct 2018 09:25:22 +0000"  >&lt;p&gt;Hello Olivier,&#160;&lt;/p&gt;

&lt;p&gt;I was preparing a new DM release, but I will look into your issue before releasing ; I will get back to you soon; thanks.&lt;/p&gt;</comment>
                            <comment id="16637979" author="pderop" created="Thu, 4 Oct 2018 09:29:23 +0000"  >&lt;p&gt;just to clarify, are you using Apache Felix Dependency Manager, or Apache Felix SCR ?&lt;/p&gt;

&lt;p&gt;(in your message, you said you were using&#160;org.apache.felix.scr 2.0.14.v20180117 ?)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16637982" author="olivierprouvost" created="Thu, 4 Oct 2018 09:32:29 +0000"  >&lt;p&gt;I don&apos;t know if ti is Felix Dependency Manager ... Actually I use Apache Felix SCR plugin in my Eclipse Launch configuration. I saw in the class that was coming from Felix Dependency manager...&#160;&lt;/p&gt;

&lt;p&gt;I will join the trace&lt;/p&gt;</comment>
                            <comment id="16637985" author="olivierprouvost" created="Thu, 4 Oct 2018 09:33:13 +0000"  >&lt;p&gt;!MESSAGE FrameworkEvent ERROR&lt;/p&gt;

&lt;p&gt;!STACK 0&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;java.lang.NullPointerException&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at java.util.concurrent.ConcurrentHashMap.get(Unknown Source)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.MultiplePrototypeRefPair.unsetServiceObject(&lt;ins&gt;MultiplePrototypeRefPair.java:67&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.DependencyManager$AbstractCustomizer.ungetService(&lt;ins&gt;DependencyManager.java:222&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.DependencyManager$MultipleDynamicCustomizer.removedService(&lt;ins&gt;DependencyManager.java:392&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.DependencyManager$MultipleDynamicCustomizer.removedService(&lt;ins&gt;DependencyManager.java:291&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.ServiceTracker$Tracked.customizerRemoved(&lt;ins&gt;ServiceTracker.java:1242&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.ServiceTracker$Tracked.customizerRemoved(&lt;ins&gt;ServiceTracker.java:1137&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.ServiceTracker$AbstractTracked.untrack(&lt;ins&gt;ServiceTracker.java:997&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.ServiceTracker$Tracked.serviceChanged(&lt;ins&gt;ServiceTracker.java:1176&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.BundleComponentActivator$ListenerInfo.serviceChanged(&lt;ins&gt;BundleComponentActivator.java:127&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.serviceregistry.FilteredServiceListener.serviceChanged(&lt;ins&gt;FilteredServiceListener.java:109&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.framework.BundleContextImpl.dispatchEvent(&lt;ins&gt;BundleContextImpl.java:920&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(&lt;ins&gt;EventManager.java:230&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(&lt;ins&gt;ListenerQueue.java:148&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.publishServiceEventPrivileged(&lt;ins&gt;ServiceRegistry.java:862&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.serviceregistry.ServiceRegistry.publishServiceEvent(&lt;ins&gt;ServiceRegistry.java:801&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.serviceregistry.ServiceRegistrationImpl.unregister(&lt;ins&gt;ServiceRegistrationImpl.java:222&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.AbstractComponentManager$3.unregister(&lt;ins&gt;AbstractComponentManager.java:925&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.AbstractComponentManager$3.unregister(&lt;ins&gt;AbstractComponentManager.java:890&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.RegistrationManager.changeRegistration(&lt;ins&gt;RegistrationManager.java:139&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.AbstractComponentManager.unregisterService(&lt;ins&gt;AbstractComponentManager.java:967&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.AbstractComponentManager.doDeactivate(&lt;ins&gt;AbstractComponentManager.java:822&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.AbstractComponentManager.deactivateInternal(&lt;ins&gt;AbstractComponentManager.java:804&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.AbstractComponentManager.dispose(&lt;ins&gt;AbstractComponentManager.java:580&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.manager.ConfigurableComponentHolder.disposeComponents(&lt;ins&gt;ConfigurableComponentHolder.java:706&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.BundleComponentActivator.dispose(&lt;ins&gt;BundleComponentActivator.java:523&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.Activator.disposeComponents(&lt;ins&gt;Activator.java:436&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.Activator.access$300(&lt;ins&gt;Activator.java:52&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.Activator$ScrExtension.destroy(&lt;ins&gt;Activator.java:290&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.AbstractExtender$1.run(&lt;ins&gt;AbstractExtender.java:216&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at java.util.concurrent.FutureTask.run(Unknown Source)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.AbstractExtender.destroyExtension(&lt;ins&gt;AbstractExtender.java:238&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.apache.felix.scr.impl.AbstractExtender.bundleChanged(&lt;ins&gt;AbstractExtender.java:132&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.framework.BundleContextImpl.dispatchEvent(&lt;ins&gt;BundleContextImpl.java:908&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.framework.eventmgr.EventManager.dispatchEvent(&lt;ins&gt;EventManager.java:230&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.framework.eventmgr.ListenerQueue.dispatchEventSynchronous(&lt;ins&gt;ListenerQueue.java:148&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEventPrivileged(&lt;ins&gt;EquinoxEventPublisher.java:230&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEvent(&lt;ins&gt;EquinoxEventPublisher.java:137&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.framework.EquinoxEventPublisher.publishBundleEvent(&lt;ins&gt;EquinoxEventPublisher.java:129&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.framework.EquinoxContainerAdaptor.publishModuleEvent(&lt;ins&gt;EquinoxContainerAdaptor.java:191&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.Module.publishEvent(&lt;ins&gt;Module.java:476&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.Module.doStop(&lt;ins&gt;Module.java:634&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.Module.stop(&lt;ins&gt;Module.java:498&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.ModuleContainer$ContainerStartLevel.decStartLevel(&lt;ins&gt;ModuleContainer.java:1723&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.ModuleContainer$ContainerStartLevel.doContainerStartLevel(&lt;ins&gt;ModuleContainer.java:1642&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.SystemModule.stopWorker(&lt;ins&gt;SystemModule.java:270&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.framework.EquinoxBundle$SystemBundle$EquinoxSystemModule.stopWorker(&lt;ins&gt;EquinoxBundle.java:192&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.Module.doStop(&lt;ins&gt;Module.java:636&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.Module.stop(&lt;ins&gt;Module.java:498&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.container.SystemModule.stop(&lt;ins&gt;SystemModule.java:202&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at org.eclipse.osgi.internal.framework.EquinoxBundle$SystemBundle$EquinoxSystemModule$1.run(&lt;ins&gt;EquinoxBundle.java:210&lt;/ins&gt;)&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160; at java.lang.Thread.run(Unknown Source)&lt;/p&gt;</comment>
                            <comment id="16637988" author="pderop" created="Thu, 4 Oct 2018 09:38:22 +0000"  >&lt;p&gt;It comes from SCR (check the package name):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
at org.apache.felix.scr.impl.manager.MultiplePrototypeRefPair.unsetServiceObject(MultiplePrototypeRefPair.java:67)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;please change the Components field of the Jira issue to &quot;Declarative Services (SCR)&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;thank you.&lt;/p&gt;</comment>
                            <comment id="16650368" author="cziegeler" created="Mon, 15 Oct 2018 15:35:50 +0000"  >&lt;p&gt;As a quick fix we could check for the argument being null and clear all instances.&lt;br/&gt;
I&apos;m not 100% sure whether this is the correct fix though, it depends on which bundle is stopped - the one with the referenced service or the one referencing the service&lt;/p&gt;</comment>
                            <comment id="16650477" author="cziegeler" created="Mon, 15 Oct 2018 16:55:32 +0000"  >&lt;p&gt;Committed the above mentioned check in rev 1843926&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ytlr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>