<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:53:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4182] Issues with package space consistency check</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4182</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;There are two issues here.  I could separate this into two reports but I need them both fixed at the same time and will be providing a patch shortly that addresses both of the following issues:&lt;/p&gt;

&lt;p&gt;1) ResolverImpl.resolve(ResolveContext) fails hard if a consistent class space cannot be found for all optional resources being resolved.  It would be nice of the resolve process could eliminate some optional resources that are the &apos;roots&apos; that caused the inconsistent class space and try again.&lt;/p&gt;

&lt;p&gt;2) There is a case where a false positive inconsistency is reported for require-bundle and split packages.  Here is the scenario&lt;/p&gt;

&lt;p&gt;Bundle uses.a&lt;br/&gt;
Export-Package: &lt;br/&gt;
 uses1; uses:=&quot;uses2&quot;; A=&quot;split&quot;; mandatory:=&quot;A&quot;,&lt;br/&gt;
 uses2; A=&quot;split&quot;; mandatory:=&quot;A&quot;&lt;/p&gt;

&lt;p&gt;Bundle uses.b&lt;br/&gt;
Export-Package: &lt;br/&gt;
 uses1; uses:=&quot;uses2&quot;; B=&quot;split&quot;; mandatory:=&quot;B&quot;,&lt;br/&gt;
 uses2; B=&quot;split&quot;; mandatory:=&quot;B&quot;&lt;/p&gt;

&lt;p&gt;Bundle uses.d&lt;br/&gt;
Require-Bundle: uses.a, uses.b&lt;/p&gt;

&lt;p&gt;In this scenario, if an attempt is made to resolve uses.d then checkDynamicPackageSpaceConsistency method will detect that uses2 is inconsistent for resource uses.d because it gets it from two different sources uses.a and uses.b.  You get something like the following error message:&lt;/p&gt;

&lt;p&gt;Uses constraint violation. Unable to resolve resource uses.d &lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.identity; osgi.identity=&amp;quot;uses.d&amp;quot;; type=&amp;quot;osgi.bundle&amp;quot;; version:Version=&amp;quot;1.0.0&amp;quot;&amp;#93;&lt;/span&gt; because it is exposed to package &apos;uses2&apos; from resources uses.a &lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.identity; osgi.identity=&amp;quot;uses.a&amp;quot;; type=&amp;quot;osgi.bundle&amp;quot;; version:Version=&amp;quot;1.0.0&amp;quot;&amp;#93;&lt;/span&gt; and uses.b &lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.identity; osgi.identity=&amp;quot;uses.b&amp;quot;; type=&amp;quot;osgi.bundle&amp;quot;; version:Version=&amp;quot;1.0.0&amp;quot;&amp;#93;&lt;/span&gt; via two dependency chains.&lt;/p&gt;

&lt;p&gt;Chain 1:&lt;br/&gt;
  uses.d &lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.identity; osgi.identity=&amp;quot;uses.d&amp;quot;; type=&amp;quot;osgi.bundle&amp;quot;; version:Version=&amp;quot;1.0.0&amp;quot;&amp;#93;&lt;/span&gt;&lt;br/&gt;
    require: (osgi.wiring.bundle=uses.a)&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;    provide: osgi.wiring.bundle: uses.a&lt;br/&gt;
  uses.a &lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.identity; osgi.identity=&amp;quot;uses.a&amp;quot;; type=&amp;quot;osgi.bundle&amp;quot;; version:Version=&amp;quot;1.0.0&amp;quot;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Chain 2:&lt;br/&gt;
  uses.d &lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.identity; osgi.identity=&amp;quot;uses.d&amp;quot;; type=&amp;quot;osgi.bundle&amp;quot;; version:Version=&amp;quot;1.0.0&amp;quot;&amp;#93;&lt;/span&gt;&lt;br/&gt;
    require: (osgi.wiring.bundle=uses.b)&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;

&lt;p&gt;    provide: osgi.wiring.bundle: uses.b&lt;br/&gt;
  uses.b &lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.identity; osgi.identity=&amp;quot;uses.b&amp;quot;; type=&amp;quot;osgi.bundle&amp;quot;; version:Version=&amp;quot;1.0.0&amp;quot;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The issue is in the check for isCompatible.  This method attempts to address split packages, but only for the provider of the split package, it does not aggregate the split sources for clients using require-bundle to gather all the sources of the split package.&lt;/p&gt;</description>
                <environment>All</environment>
        <key id="12659599">FELIX-4182</key>
            <summary>Issues with package space consistency check</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tjwatson">Tom Watson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Jul 2013 15:36:02 +0000</created>
                <updated>Thu, 24 Apr 2014 14:15:41 +0000</updated>
                            <resolved>Thu, 24 Apr 2014 14:06:21 +0000</resolved>
                                    <version>resolver-1.0.0</version>
                                    <fixVersion>resolver-1.2.0</fixVersion>
                                    <component>Resolver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13718631" author="tjwatson" created="Wed, 24 Jul 2013 17:52:41 +0000"  >&lt;p&gt;Possible fix.&lt;/p&gt;

&lt;p&gt;Fix for retry with less optional resources:&lt;/p&gt;

&lt;p&gt;Methods changed:&lt;/p&gt;

&lt;p&gt;ResolverImpl.resolve(ResolveContext)&lt;/p&gt;

&lt;p&gt;When rethrow!=null there was some code to try and look at the requirements from the rethrow and see if any of them came from optional resources and if so to remove them.  This has issues because in most cases the ResolutionException is not getting populated with the requirements (another bug I thing).  But this also has certain issues because the rethrow only holds the very last instance of rethrow for the last permutation checked.  That may not really be the resource you want to throw out.&lt;/p&gt;

&lt;p&gt;This patch takes different approach by recording each &apos;root&apos; resource that results in an inconsistent class space exception for a given solution.  As each solution is checked it is determined if the solution results in less root resources causing inconsistencies (faultyResources).  At the end if no consistent solution is found then we throw out all optional resources that are contained in the faultyResources with the assumption that the faultyResources is the smallest collection possible and that removing them as root resources will result in a possible solution for the remaining optional and mandatory resources.  It is still possible that the resources removed could get pulled back in for the next attempt, but then we will not be able to remove them again and it should cause the resolve loop to end.&lt;/p&gt;

&lt;p&gt;-----------------------------------------&lt;br/&gt;
Fix for split package class space consistency check:&lt;/p&gt;

&lt;p&gt;Methods changed:&lt;/p&gt;

&lt;p&gt;ResolverImpl.getPackageSourcesInternal)&lt;br/&gt;
With split packages it is possible to get duplicate sources added to the list.  This change just checks for duplicates to avoid that&lt;/p&gt;

&lt;p&gt;ResolverImpl.isCompatible&lt;br/&gt;
Changed it to take a List&amp;lt;Blame&amp;gt; for the currentBlames since multiple bundle-requirements may lead to multiple blames for the same package name (multiple sources)&lt;/p&gt;

&lt;p&gt;If there are multiple then package sources for each &apos;root&apos; source is gathered for a complete list of sources for the package.  This is important for cases where a bundle requires one or more bundles that provide the same package so that we can get a proper list of package sources from the perspective of the requiring bundle.&lt;/p&gt;

&lt;p&gt;ResolverImpl.checkDynamicPackageSpaceConsistency&lt;/p&gt;

&lt;p&gt;The changes are around the calls to isCompatible.  Instead of looping over each requirement Blame (from either a single Import-Package or a list of Require-Bundle) the patch now considers the List&amp;lt;Blame&amp;gt; as one when calling isCompatible with the usedBlame&lt;/p&gt;

&lt;p&gt;If the List&amp;lt;Blame&amp;gt; turns out to cause a consistency issue then the code iterates over each req from the List&amp;lt;Blame&amp;gt; and sees if it can permutate it (not 100% sure if this is the right approach).  Before would only permutate the first req that caused the issue, but now that we consider them all as contributing to the issue I decided to attempt to permutate all of them.&lt;/p&gt;</comment>
                            <comment id="13718635" author="tjwatson" created="Wed, 24 Jul 2013 17:54:58 +0000"  >&lt;p&gt;To cross reference, this bug caused me issues in Eclipse bug &lt;a href=&quot;https://bugs.eclipse.org/bugs/show_bug.cgi?id=413537&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.eclipse.org/bugs/show_bug.cgi?id=413537&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13979754" author="rickhall" created="Thu, 24 Apr 2014 14:06:21 +0000"  >&lt;p&gt;Applied supplied patch to align with work done by Tom Watson at Equinox: &lt;a href=&quot;http://git.eclipse.org/c/equinox/rt.equinox.framework.git/commit/?id=a7bb93e965ee40f221a1eaeb77a94aba955820e8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git.eclipse.org/c/equinox/rt.equinox.framework.git/commit/?id=a7bb93e965ee40f221a1eaeb77a94aba955820e8&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please close if satisfied, thanks.&lt;/p&gt;</comment>
                            <comment id="13979767" author="tjwatson" created="Thu, 24 Apr 2014 14:15:41 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12593986" name="org.apache.felix.resolver.patch" size="17324" author="tjwatson" created="Wed, 24 Jul 2013 17:52:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339792</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mltr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340111</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>