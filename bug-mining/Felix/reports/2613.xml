<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:00:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5205] Webconsole and text console throw IllegalStateException</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5205</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Recently I&apos;ve upgraded my application from using Karaf 3.x to Karaf 4.x. The application works fine, but sometimes (I can&apos;t reproduce consistenly but it happens regularly) the &apos;Components&apos; tab of the webconsole throws an IllegalStateException:&lt;/p&gt;

&lt;p&gt;Problem accessing /system/console/components. Reason:&lt;/p&gt;

&lt;p&gt;    Server Error&lt;br/&gt;
Caused by:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: Invalid BundleContext.&lt;br/&gt;
	at org.apache.felix.framework.BundleContextImpl.checkValidity(BundleContextImpl.java:511)&lt;br/&gt;
	at org.apache.felix.framework.BundleContextImpl.getBundle(BundleContextImpl.java:114)&lt;br/&gt;
	at org.apache.felix.scr.impl.runtime.ServiceComponentRuntimeImpl.bundleToDTO(ServiceComponentRuntimeImpl.java:345)&lt;br/&gt;
	at org.apache.felix.scr.impl.runtime.ServiceComponentRuntimeImpl.holderToDescription(ServiceComponentRuntimeImpl.java:241)&lt;br/&gt;
	at org.apache.felix.scr.impl.runtime.ServiceComponentRuntimeImpl.getComponentDescriptionDTOs(ServiceComponentRuntimeImpl.java:79)&lt;br/&gt;
	at org.apache.felix.webconsole.plugins.ds.internal.WebConsolePlugin$RequestInfo.&amp;lt;init&amp;gt;(WebConsolePlugin.java:615)&lt;br/&gt;
	at org.apache.felix.webconsole.plugins.ds.internal.WebConsolePlugin.doGet(WebConsolePlugin.java:177)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:687)&lt;br/&gt;
	at javax.servlet.http.HttpServlet.service(HttpServlet.java:790)&lt;br/&gt;
	at org.apache.felix.webconsole.internal.servlet.OsgiManager.service(OsgiManager.java:567)&lt;br/&gt;
	at org.apache.felix.webconsole.internal.servlet.KarafOsgiManager.doService(KarafOsgiManager.java:78)&lt;br/&gt;
	at org.apache.felix.webconsole.internal.servlet.KarafOsgiManager$1.run(KarafOsgiManager.java:58)&lt;br/&gt;
	at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
	at org.apache.karaf.util.jaas.JaasHelper.doAs(JaasHelper.java:103)&lt;br/&gt;
	at org.apache.felix.webconsole.internal.servlet.KarafOsgiManager.service(KarafOsgiManager.java:56)&lt;br/&gt;
	at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:812)&lt;br/&gt;
	at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:587)&lt;br/&gt;
....&lt;/p&gt;

&lt;p&gt;If I do a &apos;scr:list&apos; in the Gogo shell, I get a similar error:&lt;/p&gt;

&lt;p&gt;2016-03-02 14:48:25,065 | ERROR | nsole user karaf | ShellUtil                        | 58 - org.apache.karaf.shell.core - 4.0.4 | Exception caught while executing command&lt;br/&gt;
java.lang.IllegalStateException: Invalid BundleContext.&lt;br/&gt;
	at org.apache.felix.framework.BundleContextImpl.checkValidity(BundleContextImpl.java:511)&lt;br/&gt;
	at org.apache.felix.framework.BundleContextImpl.getBundle(BundleContextImpl.java:114)&lt;br/&gt;
	at org.apache.felix.scr.impl.runtime.ServiceComponentRuntimeImpl.bundleToDTO(ServiceComponentRuntimeImpl.java:345)&lt;br/&gt;
	at org.apache.felix.scr.impl.runtime.ServiceComponentRuntimeImpl.holderToDescription(ServiceComponentRuntimeImpl.java:241)&lt;br/&gt;
	at org.apache.felix.scr.impl.runtime.ServiceComponentRuntimeImpl.getComponentDescriptionDTOs(ServiceComponentRuntimeImpl.java:79)&lt;br/&gt;
	at org.apache.felix.scr.impl.ScrCommand.list(ScrCommand.java:248)&lt;br/&gt;
	at org.apache.felix.scr.impl.ScrGogoCommand.list(ScrGogoCommand.java:64)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.8.0_66-internal&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.8.0_66-internal&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.8.0_66-internal&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:497)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.8.0_66-internal&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.gogo.runtime.Reflective.invoke(Reflective.java:137)&lt;span class=&quot;error&quot;&gt;&amp;#91;58:org.apache.karaf.shell.core:4.0.4&amp;#93;&lt;/span&gt;&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;That it happens both in Gogo and Webconsole makes me think the problem is in SCR. Any ideas?&lt;/p&gt;</description>
                <environment>Mac OSX 10.11.2 Java 1.8.0_66</environment>
        <key id="12946164">FELIX-5205</key>
            <summary>Webconsole and text console throw IllegalStateException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="djencks">David Jencks</assignee>
                                    <reporter username="flyaruu">Frank Lyaruu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Mar 2016 14:49:44 +0000</created>
                <updated>Thu, 16 Mar 2017 20:29:55 +0000</updated>
                            <resolved>Thu, 16 Mar 2017 20:29:55 +0000</resolved>
                                    <version>scr-2.0.2</version>
                                                    <component>Declarative Services (SCR)</component>
                    <component>Gogo Shell</component>
                    <component>Web Console</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15175736" author="flyaruu" created="Wed, 2 Mar 2016 14:56:03 +0000"  >&lt;p&gt;If this happens, it keeps happening until I restart the app. After that, about 50 % chance it will happen again.&lt;/p&gt;

&lt;p&gt;It is a rather large application (300+ bundles) that works fine under Karaf 3 (SCR 1.8.x). While I can&apos;t rule out that there is something wrong with a service component declaration somewhere, I&apos;d expect scr:list / webconsole to be a bit more defensive and not completely break down, or at least log something.&lt;/p&gt;</comment>
                            <comment id="15176008" author="djencks" created="Wed, 2 Mar 2016 17:14:42 +0000"  >&lt;p&gt;There&apos;s an obvious immediate fix but the fact that this keeps happening rather than being transient suggests that when a bundle stops we aren&apos;t cleaning up properly.  Thanks for the report.  &lt;/p&gt;</comment>
                            <comment id="15188865" author="djencks" created="Thu, 10 Mar 2016 07:49:25 +0000"  >&lt;p&gt;Immediate fix in r1734367.  I haven&apos;t yet looked for an underlying cleanup problem.&lt;/p&gt;</comment>
                            <comment id="15362158" author="cziegeler" created="Tue, 5 Jul 2016 07:45:10 +0000"  >&lt;p&gt;This sounds somehow similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5284&quot; title=&quot;java.lang.IllegalStateException: Invalid BundleContext after uninstall of a bundle within DS component&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5284&quot;&gt;&lt;del&gt;FELIX-5284&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12982599">FELIX-5284</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2u173:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>