<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:04:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5389] NullPointerException in Candidates#prepare() method</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5389</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Project where the errors appear: &lt;a href=&quot;https://github.com/mrulli/com.flairbit.eclipsecon.onesix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mrulli/com.flairbit.eclipsecon.onesix&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;During the resolution of my bundles I get the following stacktrace (to trigger the resolution, just do &lt;tt&gt;mvn install&lt;/tt&gt; from the &lt;tt&gt;example.cassandra.itest.bndrun&lt;/tt&gt; folder in the project above):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[ERROR] Failed to execute goal biz.aQute.bnd:bnd-export-maven-plugin:3.4.0-SNAPSHOT:export (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) on project example.cassandra.bndrun: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;: MojoExecutionException: NullPointerException -&amp;gt; [Help 1]
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal biz.aQute.bnd:bnd-export-maven-plugin:3.4.0-SNAPSHOT:export (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) on project example.cassandra.bndrun: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:216)
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153)
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145)
 at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:116)
 at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:80)
 at org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build(SingleThreadedBuilder.java:51)
 at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:120)
 at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:347)
 at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:154)
 at org.apache.maven.cli.MavenCli.execute(MavenCli.java:582)
 at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:214)
 at org.apache.maven.cli.MavenCli.main(MavenCli.java:158)
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 at java.lang.reflect.Method.invoke(Method.java:498)
 at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:289)
 at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:229)
 at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:415)
 at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:356)
Caused by: org.apache.maven.plugin.MojoExecutionException
 at aQute.bnd.maven.export.plugin.ExportMojo.execute(ExportMojo.java:52)
 at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:132)
 at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:208)
 ... 19 more
Caused by: java.lang.NullPointerException
 at org.apache.felix.resolver.Candidates.prepare(Candidates.java:946)
 at org.apache.felix.resolver.ResolverImpl.getInitialCandidates(ResolverImpl.java:502)
 at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:387)
 at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:375)
 at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:329)
 at biz.aQute.resolve.BndResolver.resolve(BndResolver.java:29)
 at biz.aQute.resolve.ResolveProcess.resolveRequired(ResolveProcess.java:75)
 at biz.aQute.resolve.ProjectResolver.resolve(ProjectResolver.java:109)
 at biz.aQute.resolve.ProjectResolver.getRunBundles(ProjectResolver.java:126)
 at aQute.bnd.maven.export.plugin.ExportMojo.resolve(ExportMojo.java:86)
 at aQute.bnd.maven.export.plugin.ExportMojo.export(ExportMojo.java:70)
 at aQute.bnd.maven.export.plugin.ExportMojo.execute(ExportMojo.java:49)
 ... 21 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tried to investigate a little bit this and I found that the NPE is generated in the &lt;tt&gt;prepare()&lt;/tt&gt; method - &lt;tt&gt;org.apache.felix.resolver.Candidates&lt;/tt&gt; class, within the following snippet:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;m_candidateMap.put(r, cands.copy());
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Capability cand : cands.getRemainingCandidates())
{
    Set&amp;lt;Requirement&amp;gt; dependents = m_dependentMap.get(cand);
    dependents.remove(origReq);
    dependents.add(r);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;org.apache.felix.resolver.Candidates.m_dependentMap.get&lt;/tt&gt; is invoked with key&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    WrappedCapability: &lt;span class=&quot;code-quote&quot;&gt;&apos;[slf4j.api version=1.6.1] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; org.slf4j.impl&apos;&lt;/span&gt; 
        m_cap: Provide[osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;]{version=1.6.1, osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j.impl}{}
        m_host: slf4j.api version=1.6.1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and this nullifies &lt;tt&gt;dependents&lt;/tt&gt; var. The only WrappedCapabilities within the m_dependentMap key set are the followings:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; [slf4j.api version=1.7.7] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j)(version&amp;gt;=1.6.1))
 [slf4j.api version=1.7.5] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j.spi)(version&amp;gt;=1.6.1))
 [slf4j.api version=1.7.5] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.apache.log4j))
 [slf4j.api version=1.6.1] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j.impl)(version&amp;gt;=1.6.0))
 [slf4j.api version=1.7.5] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j.helpers)(version&amp;gt;=1.6.1))
 [slf4j.api version=1.7.7] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.apache.log4j))
 [slf4j.api version=1.7.7] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j.helpers)(version&amp;gt;=1.6.1))
 [slf4j.api version=1.7.5] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j.impl)(version&amp;gt;=1.6.0))
 [slf4j.api version=1.7.7] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j.spi)(version&amp;gt;=1.6.1))
 [slf4j.api version=1.7.7] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j.impl)(version&amp;gt;=1.6.0))
 [slf4j.api version=1.7.5] osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;; (&amp;amp;(osgi.wiring.&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt;=org.slf4j)(version&amp;gt;=1.6.1))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and none of them match the specified key above, at least as long as the WrappedCapability equals method is concerned.&lt;br/&gt;
In my opinion a meaningful error should be thrown by the resolver instead of throwing NullPointerException. Or maybe it is just enough to skip actions on dependents in case null value is returned?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13015552">FELIX-5389</key>
            <summary>NullPointerException in Candidates#prepare() method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tjwatson">Tom Watson</assignee>
                                    <reporter username="matteor">matteo rulli</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Oct 2016 19:44:41 +0000</created>
                <updated>Thu, 3 Nov 2016 10:37:55 +0000</updated>
                            <resolved>Wed, 2 Nov 2016 19:41:12 +0000</resolved>
                                    <version>resolver-1.10.0</version>
                                    <fixVersion>resolver-1.10.1</fixVersion>
                                    <component>Resolver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15609682" author="tjwatson" created="Wed, 26 Oct 2016 21:09:39 +0000"  >&lt;p&gt;I get this error running mvn install from the example.cassandra.itest.bndrun folder:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failed to execute goal biz.aQute.bnd:bnd-export-maven-plugin:3.4.0-SNAPSHOT:export (default) on project example.cassandra.bndrun: Parent not foundcom.flairbit.eclipsecon.onesix:example.cassandra.parent:pom:1.0.0 -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt;&lt;br/&gt;
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal biz.aQute.bnd:bnd-export-maven-plugin:3.4.0-SNAPSHOT:export (default) on project example.cassandra.bndrun: Parent not foundcom.flairbit.eclipsecon.onesix:example.cassandra.parent:pom:1.0.0&lt;/p&gt;

&lt;p&gt;I did run mvn install from the root of the repo and it seemed to build example.cassandra.parent fine:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Reactor Summary:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; example.cassandra.parent ........................... SUCCESS [  0.664 s]&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; com.flairbit.example.cassandra.api ................. SUCCESS [ 16.953 s]&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; com.flairbit.example.cassandra.impl ................ SUCCESS [ 17.562 s]&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; com.flairbit.example.cassandra.cmd ................. SUCCESS [  0.242 s]&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; com.flairbit.example.cassandra.itest ............... SUCCESS [  0.366 s]&lt;/p&gt;
</comment>
                            <comment id="15609722" author="matteor" created="Wed, 26 Oct 2016 21:24:19 +0000"  >&lt;p&gt;Yes sorry for that, one commit was missing: you can now pull again from git and run mvn install from the top level directory. &lt;br/&gt;
Anyway, the error does not occur systematically: for me it happens one in two/three times.&lt;/p&gt;</comment>
                            <comment id="15611064" author="rotty3000" created="Thu, 27 Oct 2016 07:45:20 +0000"  >&lt;p&gt;BTW, this feels very much like the same NPE I&apos;ve noted here: &lt;a href=&quot;https://github.com/bndtools/bnd/issues/1697&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bndtools/bnd/issues/1697&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15615495" author="tjwatson" created="Fri, 28 Oct 2016 13:58:25 +0000"  >&lt;p&gt;It appears this is using the latest felix resolver code now.  I got a different flavor of the NPE just now.  Only recording it here to keep a record.  I also got the same NPE initially reported in a separate run.  Not sure what the cause is yet but I suspect improper wrapping for fragments ...&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.felix.resolver.util.CandidateSelector.&amp;lt;init&amp;gt;(CandidateSelector.java:39)&lt;br/&gt;
        at org.apache.felix.resolver.util.ShadowList.&amp;lt;init&amp;gt;(ShadowList.java:38)&lt;br/&gt;
        at org.apache.felix.resolver.util.ShadowList.createShadowList(ShadowList.java:31)&lt;br/&gt;
        at org.apache.felix.resolver.Candidates.prepare(Candidates.java:903)&lt;br/&gt;
        at org.apache.felix.resolver.ResolverImpl.getInitialCandidates(ResolverImpl.java:502)&lt;br/&gt;
        at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:387)&lt;br/&gt;
        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:375)&lt;br/&gt;
        at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:329)&lt;br/&gt;
        at biz.aQute.resolve.BndResolver.resolve(BndResolver.java:29)&lt;br/&gt;
        at biz.aQute.resolve.ResolveProcess.resolveRequired(ResolveProcess.java:75)&lt;br/&gt;
        at biz.aQute.resolve.ProjectResolver.resolve(ProjectResolver.java:109)&lt;br/&gt;
        at biz.aQute.resolve.ProjectResolver.getRunBundles(ProjectResolver.java:126)&lt;br/&gt;
        at aQute.bnd.maven.testing.plugin.TestingMojo.resolve(TestingMojo.java:135)&lt;br/&gt;
        at aQute.bnd.maven.testing.plugin.TestingMojo.testing(TestingMojo.java:91)&lt;br/&gt;
        at aQute.bnd.maven.testing.plugin.TestingMojo.execute(TestingMojo.java:66)&lt;br/&gt;
        ... 22 more&lt;/p&gt;</comment>
                            <comment id="15616585" author="tjwatson" created="Fri, 28 Oct 2016 21:07:17 +0000"  >&lt;p&gt;I have not been able to spend the necessary time to get to the bottom of this one yet.  But I find something strange with aQute.bnd.osgi.resource.ResourceImpl when it represents a fragment.  I see this list of capabilities for slf4j.log4j12 fragment:&lt;/p&gt;

&lt;p&gt;[&lt;br/&gt;
 Provide&lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.identity&amp;#93;&lt;/span&gt;&lt;/p&gt;
{description=The slf4j log4j-12 binding, osgi.identity=slf4j.log4j12, type=osgi.fragment, version=1.6.1}
&lt;p&gt;{},  &lt;br/&gt;
 Provide&lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.wiring.bundle&amp;#93;&lt;/span&gt;&lt;/p&gt;
{bundle-version=1.6.1, osgi.wiring.bundle=slf4j.log4j12}
&lt;p&gt;{},&lt;br/&gt;
 Provide&lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.wiring.package&amp;#93;&lt;/span&gt;&lt;/p&gt;
{version=1.6.1, osgi.wiring.package=org.slf4j.impl}
&lt;p&gt;{},&lt;br/&gt;
 Provide&lt;span class=&quot;error&quot;&gt;&amp;#91;osgi.content&amp;#93;&lt;/span&gt;&lt;/p&gt;
{size=9753, url=file:/C:/Users/IBM_ADMIN/.m2/repository/org/slf4j/slf4j-log4j12/1.6.1/slf4j-log4j12-1.6.1.jar, mime=vnd.osgi.bundle, osgi.content=CBAE818E0D2E020F0C850C4B9C7C169B1ED99311DA23E9A3EFE66CE60E8795BA}
&lt;p&gt;{},&lt;br/&gt;
 Provide&lt;span class=&quot;error&quot;&gt;&amp;#91;bnd.info&amp;#93;&lt;/span&gt;&lt;/p&gt;
{name=org.slf4j:slf4j-log4j12:1.6.1, from=org.slf4j:slf4j-log4j12:1.6.1}
&lt;p&gt;{}&lt;br/&gt;
]&lt;/p&gt;

&lt;p&gt;it is claiming it provides a osgi.wiring.bundle which is invalid for fragments.&lt;/p&gt;</comment>
                            <comment id="15623217" author="rotty3000" created="Mon, 31 Oct 2016 20:10:25 +0000"  >&lt;p&gt;With &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjwatson&quot; class=&quot;user-hover&quot; rel=&quot;tjwatson&quot;&gt;tjwatson&lt;/a&gt;&apos;s comment I believe I was able to track down the issue to the ResourceBuilder in bnd which was erroneously adding osgi.wiring.bundle capabilities into the index for fragments.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://github.com/bndtools/bnd/pull/1759&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bndtools/bnd/pull/1759&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15623901" author="tjwatson" created="Tue, 1 Nov 2016 00:29:59 +0000"  >&lt;p&gt;I have found an issue with fragment that have multiple hosts.  I think the issue only manifests when there are three or more hosts and there is a cycle between the host and fragment.  I have not found a solution yet.  The problem appears to be related to the shared candidate list held by each hosted fragment.   Manipulation of the candidate list is effecting multiple CandidateSelectors when it should not.  This causes an inconsistency that leads to various NPEs or other runtime errors.  I don&apos;t think the extra host capability on the fragment is causing the problem. &lt;/p&gt;</comment>
                            <comment id="15625824" author="tjwatson" created="Tue, 1 Nov 2016 16:08:06 +0000"  >&lt;p&gt;I have found an issue with fragments and have a fix and test in &lt;a href=&quot;https://github.com/tjwatson/felix/tree/FELIX-5389&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tjwatson/felix/tree/FELIX-5389&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The error I see is an out of bounds exception when calling ShadowList.replace method and not the NPEs reported here.  That makes me worry that this is not the same issue.  I&apos;m currently trying to figure out how to test the bnd maven plugin with my patched resolver.&lt;/p&gt;</comment>
                            <comment id="15626415" author="rotty3000" created="Tue, 1 Nov 2016 19:23:51 +0000"  >&lt;p&gt;for posterity, I also now see a different error after using the latest snapshot of bndlib:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Using the supplied repository&lt;/b&gt; my process was to first publish the bnd libraries to the .m2 repo (using the normal bnd build process) and then force the maven build of this repo to &lt;tt&gt;--offline&lt;/tt&gt; so that it doesn&apos;t download other artifacts from the remote repositories.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[ERROR] Failed to execute goal biz.aQute.bnd:bnd-testing-maven-plugin:3.4.0-SNAPSHOT:testing (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) on project example.cassandra.itest.bndrun: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;: MojoExecutionException: NullPointerException -&amp;gt; [Help 1]
org.apache.maven.lifecycle.LifecycleExecutionException: Failed to execute goal biz.aQute.bnd:bnd-testing-maven-plugin:3.4.0-SNAPSHOT:testing (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) on project example.cassandra.itest.bndrun: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:212)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:153)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:145)
	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:116)
	at org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:80)
	at org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build(SingleThreadedBuilder.java:51)
	at org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:128)
	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:307)
	at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:193)
	at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:106)
	at org.apache.maven.cli.MavenCli.execute(MavenCli.java:863)
	at org.apache.maven.cli.MavenCli.doMain(MavenCli.java:288)
	at org.apache.maven.cli.MavenCli.main(MavenCli.java:199)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:289)
	at org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:229)
	at org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:415)
	at org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:356)
Caused by: org.apache.maven.plugin.MojoExecutionException
	at aQute.bnd.maven.testing.plugin.TestingMojo.execute(TestingMojo.java:77)
	at org.apache.maven.plugin.DefaultBuildPluginManager.executeMojo(DefaultBuildPluginManager.java:134)
	at org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:207)
	... 20 more
Caused by: java.lang.NullPointerException
	at org.apache.felix.resolver.util.CandidateSelector.&amp;lt;init&amp;gt;(CandidateSelector.java:39)
	at org.apache.felix.resolver.util.ShadowList.&amp;lt;init&amp;gt;(ShadowList.java:38)
	at org.apache.felix.resolver.util.ShadowList.createShadowList(ShadowList.java:31)
	at org.apache.felix.resolver.Candidates.prepare(Candidates.java:903)
	at org.apache.felix.resolver.ResolverImpl.getInitialCandidates(ResolverImpl.java:502)
	at org.apache.felix.resolver.ResolverImpl.doResolve(ResolverImpl.java:387)
	at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:375)
	at org.apache.felix.resolver.ResolverImpl.resolve(ResolverImpl.java:329)
	at biz.aQute.resolve.BndResolver.resolve(BndResolver.java:29)
	at biz.aQute.resolve.ResolveProcess.resolveRequired(ResolveProcess.java:75)
	at biz.aQute.resolve.ProjectResolver.resolve(ProjectResolver.java:109)
	at biz.aQute.resolve.ProjectResolver.getRunBundles(ProjectResolver.java:126)
	at aQute.bnd.maven.testing.plugin.TestingMojo.resolve(TestingMojo.java:135)
	at aQute.bnd.maven.testing.plugin.TestingMojo.testing(TestingMojo.java:97)
	at aQute.bnd.maven.testing.plugin.TestingMojo.execute(TestingMojo.java:71)
	... 22 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15629180" author="rotty3000" created="Wed, 2 Nov 2016 14:46:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matteor&quot; class=&quot;user-hover&quot; rel=&quot;matteor&quot;&gt;matteor&lt;/a&gt; while there&apos;s likely a bug in the resolver related to this issue, I wanted to alert you to the fact that &lt;del&gt;regardless of this fact what you have is a collection of runrequires which will need two different versions of slf4j.&lt;/del&gt; you can get things working by using the following:&lt;/p&gt;

&lt;p&gt;Make the following changes to your &lt;tt&gt;example.cassandra.itest.bndrun/itest.bndrun&lt;/tt&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;     slf4j.api; version=&lt;span class=&quot;code-quote&quot;&gt;&apos;[1.7.7,1.7.8)&apos;&lt;/span&gt;,\
     slf4j.log4j12; version=&lt;span class=&quot;code-quote&quot;&gt;&apos;[1.6.1,1.6.2)&apos;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;AND disable resolution in the pom file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;resolve&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/resolve&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This gets the tests to run, but they fail for other reasons. However all bundles resolve.&lt;/p&gt;</comment>
                            <comment id="15630209" author="tjwatson" created="Wed, 2 Nov 2016 19:40:21 +0000"  >&lt;p&gt;I have found another issue which is causing the two NPEs reported here:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.felix.resolver.util.CandidateSelector.&amp;lt;init&amp;gt;(CandidateSelector.java:39)&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
        at org.apache.felix.resolver.Candidates.prepare(Candidates.java:946)&lt;/p&gt;

&lt;p&gt;Both these errors are occurring because the capability, requirement, resource equals methods are NOT symmetrical (a.equals(b) == b.equals(a)) when dealing with WrappedResource, WrappedCapability and WrappedRequirement.  This causes major issues for our implementations of Map and Set in the resolver.&lt;/p&gt;

&lt;p&gt;For framework implementations that use the resolver this is not an issue because their implementations of capability, requirement, and resource effectively use identity equality (default Object.equals() behavior).  This is because even when the same bundle is installed multiple times in the framework we must treat the two copies of the bundle Resource as unique.&lt;/p&gt;

&lt;p&gt;BND does not use identity equality for its capability, requirement, resource implementations.  Instead it tries to do equality check on the attributes/directives of the requirement or capability and then does an equality check on the resource.  It does an equality check on the resource by checking the osgi.content capability of the resource.  With this bit of implementation knowledge of BND I decided to work around this by augmenting the osgi.content capability when it is wrapped such that its &apos;url&apos; key is different.  This causes bnd to do the &apos;right thing&apos; WRT to symmetric equality with the resolver&apos;s wrapped objects.&lt;/p&gt;

&lt;p&gt;I released this fix along with the other issues I found with out of bounds errors.&lt;/p&gt;</comment>
                            <comment id="15630211" author="tjwatson" created="Wed, 2 Nov 2016 19:41:12 +0000"  >&lt;p&gt;Resolving as fixed.  Please close if satisfied with the fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35fxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>