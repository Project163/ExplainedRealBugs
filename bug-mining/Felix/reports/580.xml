<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:12:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1488] Configuration binding is broken</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1488</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Configuration can be statically or dynamically bound:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;A configuration is statically bound by explicitly calling the Configuration.setBundleLocation method or&lt;br/&gt;
    by creating the configuration object with a non-null bundle location. Static binding must be persisted and&lt;br/&gt;
    is only reset by explicitly calling the setBundleLocation with a null argument.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;A configuration may dynamically bound if the configuration has been created with a null bundle location and&lt;br/&gt;
    the setBundleLocation has not been called (or called with a null argument). If such an unbound configuration&lt;br/&gt;
    is provided to a ManagedService&lt;span class=&quot;error&quot;&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt; it is dynamically bound to the service&apos;s bundle. Such bundle&lt;br/&gt;
    binding is not persisted.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The reason why dynamic binding need not be persisted is actually an implementation detail because we keep used configurations in an internal cache. Entries in the cache are only removed if the configuration is deleted or if the configuration admin service is stopped. In the first case, bundle binding is lost anyway. In the second case dynamic bundle bindings will be recreated on configuration admin service restart when the configurations are supplied to ManagedService&lt;span class=&quot;error&quot;&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt; services again.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12433188">FELIX-1488</key>
            <summary>Configuration binding is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Sun, 16 Aug 2009 17:07:28 +0000</created>
                <updated>Tue, 4 Jun 2024 20:41:14 +0000</updated>
                            <resolved>Thu, 20 Aug 2009 10:26:24 +0000</resolved>
                                    <version>configadmin-1.0.10</version>
                                    <fixVersion>configadmin-1.2.0</fixVersion>
                                    <component>Configuration Admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12743869" author="fmeschbe" created="Sun, 16 Aug 2009 18:30:42 +0000"  >&lt;p&gt;Changing this issue to reflect the currently broken configuration binding support: All bindings are persisted and thus static. This makes handling of bundle uninstallations while the Configuration Admin service is not running more complicated (see &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1484&quot; title=&quot;Dynamically bound configuration must be reset to null after target bundle is uninstalled.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1484&quot;&gt;&lt;del&gt;FELIX-1484&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;This updated bug description will overcome this issue.&lt;/p&gt;</comment>
                            <comment id="12743872" author="fmeschbe" created="Sun, 16 Aug 2009 18:40:20 +0000"  >&lt;p&gt;Applied a fix in Rev. 804740:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;configuration (and factory) binding is only persisted if statically bound&lt;/li&gt;
	&lt;li&gt;bundle uninstallation only considers dynamic binding, which is in the cache only (this makes this update easier)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12743876" author="fmeschbe" created="Sun, 16 Aug 2009 18:52:34 +0000"  >&lt;p&gt;Added test in Rev. 804744&lt;/p&gt;</comment>
                            <comment id="12743990" author="fmeschbe" created="Mon, 17 Aug 2009 07:56:22 +0000"  >&lt;p&gt;There is use case not convered by just transiently keeping the dynamic bindings:&lt;/p&gt;

&lt;p&gt;  1. create configuration pid1&lt;br/&gt;
  2. start bundle b1 with managed service pid1&lt;/p&gt;

&lt;p&gt;  ==&amp;gt; configuration is provided to managed service and bound to b1&lt;/p&gt;

&lt;p&gt;  3. stop bundle b1&lt;/p&gt;

&lt;p&gt;  ==&amp;gt; configuration is still bound to b1&lt;/p&gt;

&lt;p&gt;  4. restart configuration admin service&lt;/p&gt;

&lt;p&gt;  ==&amp;gt; configuration must still be bound to b1&lt;/p&gt;

&lt;p&gt;Hence the dynamic bindings must also be persisted to survice configuration admin restarts. To facilitate the management of the dynamic bindings we do not store them inside the configuration objects but separately. This allows for simpler cleanup on configuration admin restart (i.e. not requiring to load and verify all configurations).&lt;/p&gt;

&lt;p&gt;Implemented storage of dynamic bindings (outside of the actual configuration) along with unit and integration tests in Rev. 804891&lt;/p&gt;</comment>
                            <comment id="12744012" author="fmeschbe" created="Mon, 17 Aug 2009 10:03:19 +0000"  >&lt;p&gt;Revisions 804915 and 804916 fix an issue with incorrectly setting the staticallyBound flag: If the bundle location is statically set to null, the flag must be set to false, such that dynamic binding may occurr later when assigning the configuration to a ManagedService.&lt;/p&gt;

&lt;p&gt;The test case is test_create_with_location_unbind_before_service_supply:&lt;/p&gt;

&lt;p&gt;         1. create Configuration with pid and non-null location.&lt;br/&gt;
         2. update the configuration with non-null props.&lt;br/&gt;
         3. set location of the configuration to null.&lt;br/&gt;
         4. bundleA registers a ManagedService service with the pid.&lt;/p&gt;</comment>
                            <comment id="12744907" author="fmeschbe" created="Wed, 19 Aug 2009 05:59:53 +0000"  >&lt;p&gt;We have  another failure with configuration binding:&lt;/p&gt;

&lt;p&gt;   1. create configuration pid with non-null location&lt;br/&gt;
   2. register ManagedService with pid from the bundle with said location&lt;br/&gt;
   3. Call Configuration.setBundleLocation(null) on the configuration&lt;br/&gt;
   ==&amp;gt; configuration must still be dynamically bound to location&lt;/p&gt;

&lt;p&gt;The current implementation (before Rev. 805667)  didn&apos;t handle this use case correctly and did not leave the dynamic binding of the configuration thus completely unbinding the configuration.&lt;/p&gt;

&lt;p&gt;In Rev. 805667 I have applied a refactoring for this use case: bindings are now kept in two fields, one for dynamic binding and one for static binding. If the dynamic binding field is set, it takes precedence. If the dynamic field is set it is equal to the static binding field value unless the static binding field is null.&lt;/p&gt;

&lt;p&gt;In Rev. 805668 the ConfigurationManager class has been adapted to the new binding field management API.&lt;/p&gt;

&lt;p&gt;Testcases for this have already been commited with Rev. 805666.&lt;/p&gt;</comment>
                            <comment id="12744909" author="fmeschbe" created="Wed, 19 Aug 2009 06:06:13 +0000"  >&lt;p&gt;One further case remains to be discussed and implemented:&lt;/p&gt;

&lt;p&gt;   1. create config with pid and locationA&lt;br/&gt;
   2. update config with properties&lt;br/&gt;
   3. register ManagedService ms1 with pid from said locationA&lt;br/&gt;
   ==&amp;gt; configuration supplied to the service ms1&lt;br/&gt;
   4. register ManagedService ms2 with pid from locationB&lt;br/&gt;
   ==&amp;gt; configuration not supplied to service ms2&lt;br/&gt;
   4. Call Configuration.setBundleLocation( &quot;locationB&quot; )&lt;/p&gt;

&lt;p&gt;A slight variation of this use case exhibits the same problem:&lt;/p&gt;

&lt;p&gt;   1. create config with pid with null location&lt;br/&gt;
   2. update config with properties&lt;br/&gt;
   3. register ManagedService ms1 with pid from locationA&lt;br/&gt;
   ==&amp;gt; configuration supplied to the service ms1&lt;br/&gt;
   ==&amp;gt; configuration is dynamically bound to locationA&lt;br/&gt;
   4. register ManagedService ms2 with pid from locationB&lt;br/&gt;
   ==&amp;gt; configuration not supplied to service ms2&lt;br/&gt;
   5. Call Configuration.setBundleLocation( &quot;locationB&quot; )&lt;/p&gt;


&lt;p&gt;It is unclear from the spec, what should happen after setting the new (static) bundle location. Ikuo Yamasaki proposes two options:&lt;/p&gt;

&lt;p&gt;   Option A: nothing happens&lt;br/&gt;
   Option B: configuration is removed from ms1 and supplied to ms2&lt;/p&gt;

&lt;p&gt;Option A is currently implemented (as of Rev. 805668), while I agree with Ikuo that Option B probably makes more sense.&lt;/p&gt;

&lt;p&gt;I start implementing Option B.&lt;/p&gt;</comment>
                            <comment id="12744966" author="fmeschbe" created="Wed, 19 Aug 2009 09:40:37 +0000"  >&lt;p&gt;Implemented Option B of the last use case along with test cases in Rev. 805716.&lt;/p&gt;

&lt;p&gt;(this can easily be removed again, should it be decided that Option B is not correct)&lt;/p&gt;</comment>
                            <comment id="12745034" author="fmeschbe" created="Wed, 19 Aug 2009 12:39:08 +0000"  >&lt;p&gt;In Rev. 805776 added support for another use case related to the above replacement:&lt;/p&gt;

&lt;p&gt;  1. Create configuration pid1 with null location and set properties&lt;br/&gt;
  2. Install bundle locationA with ManagedServiceA pid1&lt;br/&gt;
  3. Install bundle locationB with ManagedServiceB pid1&lt;br/&gt;
  4. Uninstall bundle locationA&lt;br/&gt;
  ==&amp;gt; configuration to be assigned to locationB/pid1 service&lt;/p&gt;

&lt;p&gt;Also includes integration tests and fixes of existing test cases which do not expect this functionality yet&lt;/p&gt;</comment>
                            <comment id="12745345" author="fmeschbe" created="Thu, 20 Aug 2009 08:14:14 +0000"  >&lt;p&gt;In Rev. 806074/806078 (integration tests) and 806075 (implementation) I disabled the automatic reassignment of configurations if the static bundle location is set to a different location.&lt;/p&gt;

&lt;p&gt;For the integration tests, the code is guarded by a switch to change either one or the other expected behaviour of reassignment.&lt;/p&gt;

&lt;p&gt;For the implementation the main reassignment code has just been commented out.&lt;/p&gt;

&lt;p&gt;In Rev. 806083 I added the removal of dynamic bundle location binding if the static locaiton is set to a location different than the current dynamic binding.&lt;/p&gt;</comment>
                            <comment id="12745378" author="fmeschbe" created="Thu, 20 Aug 2009 10:26:24 +0000"  >&lt;p&gt;After much back and forth, it looks like we now reached kind of a consensus (for the short-term) with respect to configuration binding:&lt;/p&gt;

&lt;p&gt;Calling Configuration.setBundleLocation() does not cause any bound configuration to be unbound. Neither are configurations newly bound due to this.&lt;/p&gt;

&lt;p&gt;On the other hand further configuration updates will be sent out according to the bundle location set. Any dynamic configuration binding prevalent to calling setBundleLocation() is dropped (unless of course the dynamic binding is the same as the new static binding).&lt;/p&gt;

&lt;p&gt;So, it is confimed the current trunk state implements this as agreed upon and I close this issue.&lt;/p&gt;</comment>
                            <comment id="12747292" author="fmeschbe" created="Tue, 25 Aug 2009 08:09:16 +0000"  >&lt;p&gt;Close all issues now this version has been released&lt;/p&gt;</comment>
                            <comment id="16093675" author="githubbot" created="Wed, 19 Jul 2017 19:45:44 +0000"  >&lt;p&gt;GitHub user drewbrokke opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/113&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fixes regression caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1488&quot; title=&quot;Configuration binding is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1488&quot;&gt;&lt;del&gt;FELIX-1488&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    If one of the three calls inside of the `delete()` method throws an exception, the `isDeleted` field remains true, which causes some unexpected `IllegalStateException`s. &lt;/p&gt;

&lt;p&gt;    Before the field was introduced, whenever the `isDeleted()` method was called it would invoke `getPersistenceManager()`, which would then use the local persistence manager to actually check to see if the configuration had been removed from the persistence.&lt;/p&gt;

&lt;p&gt;    Now the boolean field is being set before any persistence calls actually happen, which is a problem if any of the calls throw.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/drewbrokke/felix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/drewbrokke/felix&lt;/a&gt; patch-1&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/113.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/113.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #113&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 25260a6b84438722de67b688b1af8713dcabe13a&lt;br/&gt;
Author: Drew Brokke &amp;lt;drew.brokke@liferay.com&amp;gt;&lt;br/&gt;
Date:   2017-07-19T19:38:27Z&lt;/p&gt;

&lt;p&gt;    Fixes regression caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1488&quot; title=&quot;Configuration binding is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1488&quot;&gt;&lt;del&gt;FELIX-1488&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    If one of the three calls inside of the `delete()` method throws an exception, the `isDeleted` field remains true, which causes some unexpected `IllegalStateException`s. &lt;/p&gt;

&lt;p&gt;    Before the field was introduced, whenever the `isDeleted()` method was called it would invoke `getPersistenceManager()`, which would then use the local persistence manager to actually check to see if the configuration had been removed from the persistence.&lt;/p&gt;

&lt;p&gt;    Now the boolean field is being set before any persistence calls actually happen, which is a problem if any of the calls throw.&lt;/p&gt;

&lt;hr /&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12433067">FELIX-1484</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57536</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vywf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184627</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>