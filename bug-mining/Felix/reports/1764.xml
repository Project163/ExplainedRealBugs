<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:46:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3789] Deadlock due to synchronization on INSTANCE_NAME</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3789</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;iPojo sometimes locks up during component instanciation in our application.&lt;br/&gt;
After analysis, the lockup occurs since the fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3548&quot; title=&quot;Concurrent access during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3548&quot;&gt;&lt;del&gt;FELIX-3548&lt;/del&gt;&lt;/a&gt; was applied.&lt;/p&gt;

&lt;p&gt;The problem is that createComponentInstance in the class IPojoFactory is pseudo-recursive (through a call to getHandler), that is it can call recursively itself on a different factory instance.&lt;br/&gt;
Since createComponentInstance synchronizes itself on the factory first (local lock) and on INSTANCE_NAME second (global lock), sometimes it will try to call createComponentInstance on a different factory while holding the global lock and while another threads holds that factory&apos;s local lock and is trying to acquire the global lock (I hope what I wrote makes sense).&lt;/p&gt;

&lt;p&gt;Stack trace of the problem :&lt;br/&gt;
Daemon Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1&amp;#93;&lt;/span&gt; (Suspended)&lt;br/&gt;
 	owns: ComponentFactory  (id=5717)&lt;br/&gt;
 	owns: ArrayList&amp;lt;E&amp;gt;  (id=5708)	&amp;lt;==============&lt;br/&gt;
 	owns: HandlerManagerFactory  (id=5718)&lt;br/&gt;
 	waiting for: HandlerManagerFactory  (id=5709)	&amp;lt;==============&lt;br/&gt;
 	HandlerManagerFactory(IPojoFactory).createComponentInstance(Dictionary,&lt;br/&gt;
 ServiceContext) line: 258&lt;br/&gt;
 	ComponentFactory(IPojoFactory).getHandler(IPojoFactory$RequiredHandler,&lt;br/&gt;
 ServiceContext) line: 830&lt;br/&gt;
 	ComponentFactory(IPojoFactory).createComponentInstance(Dictionary,&lt;br/&gt;
 ServiceContext) line: 306&lt;br/&gt;
 	ComponentFactory(IPojoFactory).createComponentInstance(Dictionary)&lt;br/&gt;
 line: 239&lt;br/&gt;
 	InstanceCreator$ManagedInstance.create(IPojoFactory) line: 343&lt;br/&gt;
 	InstanceCreator.onValidation(IPojoFactory) line: 202&lt;br/&gt;
 	InstanceCreator.stateChanged(Factory, int) line: 243&lt;br/&gt;
 	ComponentFactory(IPojoFactory).computeFactoryState() line: 766&lt;br/&gt;
 	ComponentFactory.addedService(ServiceReference) line: 414&lt;br/&gt;
 	Tracker$Tracked.trackAdding(ServiceReference) line: 725&lt;br/&gt;
 	Tracker$Tracked.track(ServiceReference) line: 686&lt;br/&gt;
 	Tracker$Tracked.serviceChanged(ServiceEvent) line: 642&lt;br/&gt;
 	FilteredServiceListener.serviceChanged(ServiceEvent) line: 107&lt;br/&gt;
 	BundleContextImpl.dispatchEvent(Object, Object, int, Object) line: 861&lt;br/&gt;
 	EventManager.dispatchEvent(Set, EventDispatcher, int, Object) line: &lt;br/&gt;
 230&lt;br/&gt;
 	ListenerQueue.dispatchEventSynchronous(int, Object) line: 148&lt;br/&gt;
 	ServiceRegistry.publishServiceEventPrivileged(ServiceEvent) line: 819&lt;br/&gt;
 	ServiceRegistry.publishServiceEvent(ServiceEvent) line: 771&lt;br/&gt;
 	ServiceRegistrationImpl.register(Dictionary) line: 130&lt;br/&gt;
 	ServiceRegistry.registerService(BundleContextImpl, String[], Object,&lt;br/&gt;
 Dictionary) line: 214&lt;br/&gt;
 	BundleContextImpl.registerService(String[], Object, Dictionary) line: &lt;br/&gt;
 433&lt;br/&gt;
 	HandlerManagerFactory(IPojoFactory).start() line: 613&lt;br/&gt;
 	Extender.createAbstractFactory(Bundle, Element) line: 520&lt;br/&gt;
 	Extender.parse(Bundle, String) line: 301&lt;br/&gt;
 	Extender.startManagementFor(Bundle) line: 237&lt;br/&gt;
 	Extender.access$600(Extender, Bundle) line: 52&lt;br/&gt;
 	Extender$CreatorThread.run() line: 769&lt;br/&gt;
 	Thread.run() line: 662&lt;/p&gt;


&lt;p&gt; Daemon Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-7&amp;#93;&lt;/span&gt; (Suspended)&lt;br/&gt;
 	owns: HandlerManagerFactory  (id=5709)		&amp;lt;==============&lt;br/&gt;
 	owns: ComponentFactory  (id=5710)&lt;br/&gt;
 	owns: Tracker  (id=5711)&lt;br/&gt;
 	owns: Dependency[]  (id=5712)&lt;br/&gt;
 	waiting for: ArrayList&amp;lt;E&amp;gt;  (id=5708)		&amp;lt;==============&lt;br/&gt;
 	HandlerManagerFactory(IPojoFactory).createComponentInstance(Dictionary,&lt;br/&gt;
 ServiceContext) line: 283&lt;br/&gt;
 	ComponentFactory(IPojoFactory).getHandler(IPojoFactory$RequiredHandler,&lt;br/&gt;
 ServiceContext) line: 830&lt;br/&gt;
 	ComponentFactory(IPojoFactory).computeDescription() line: 721&lt;br/&gt;
 	ComponentFactory(IPojoFactory).computeFactoryState() line: 757&lt;br/&gt;
 	ComponentFactory.addedService(ServiceReference) line: 414&lt;br/&gt;
 	Tracker$Tracked.trackAdding(ServiceReference) line: 725&lt;br/&gt;
 	Tracker$Tracked.trackInitialServices() line: 610&lt;br/&gt;
 	Tracker.open() line: 210&lt;br/&gt;
 	ComponentFactory.starting() line: 262&lt;br/&gt;
 	ComponentFactory(IPojoFactory).start() line: 605&lt;br/&gt;
 	PrimitiveComponentType.createFactory() line: 441&lt;br/&gt;
 	PrimitiveComponentType.initializeFactory() line: 198&lt;br/&gt;
 	PrimitiveComponentType.getFactory() line: 171&lt;br/&gt;
 	PrimitiveComponentType(ComponentType).ensureFactory() line: 185&lt;br/&gt;
 	PrimitiveComponentType(ComponentType).ensureAndGetFactory() line: 177&lt;br/&gt;
 	PrimitiveComponentType(ComponentType).createInstance() line: 79&lt;br/&gt;
 	COI_Starter.__M_coiBuildler(COI_ConfigLoader) line: 176&lt;br/&gt;
 	COI_Starter.coiBuildler(COI_ConfigLoader) line: not available&lt;br/&gt;
 	COI_Starter.__M_startOSGI() line: 97&lt;br/&gt;
 	COI_Starter.startOSGI() line: not available&lt;br/&gt;
 	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not  available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;&lt;br/&gt;
 	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39&lt;br/&gt;
 	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25&lt;br/&gt;
 	Method.invoke(Object, Object...) line: 597&lt;br/&gt;
 	Callback.call(Object[]) line: 233&lt;br/&gt;
 	Callback.call() line: 193&lt;br/&gt;
 	LifecycleCallback.call() line: 86&lt;br/&gt;
 	LifecycleCallbackHandler.__M_stateChanged(int) line: 162&lt;br/&gt;
 	LifecycleCallbackHandler.stateChanged(int) line: not available&lt;br/&gt;
 	InstanceManager.setState(int) line: 535&lt;br/&gt;
 	InstanceManager.stateChanged(ComponentInstance, int) line: 1401&lt;br/&gt;
 	HandlerManager(InstanceManager).setState(int) line: 560&lt;br/&gt;
 	HandlerManager.stateChanged(ComponentInstance, int) line: 239&lt;br/&gt;
 	DependencyHandler(Handler).setValidity(boolean) line: 174&lt;br/&gt;
 	DependencyHandler.__M_checkContext() line: 186&lt;br/&gt;
 	DependencyHandler.checkContext() line: not available&lt;br/&gt;
 	DependencyHandler.__M_validate(DependencyModel) line: 149&lt;br/&gt;
 	DependencyHandler.validate(DependencyModel) line: not available&lt;br/&gt;
 	Dependency(DependencyModel).validate() line: 642&lt;br/&gt;
 	Dependency(DependencyModel).computeDependencyState() line: 310&lt;br/&gt;
 	Dependency(DependencyModel).manageArrival(ServiceReference) line: 399&lt;br/&gt;
 	Dependency(DependencyModel).addedService(ServiceReference) line: 335&lt;br/&gt;
 	Tracker$Tracked.trackAdding(ServiceReference) line: 725&lt;br/&gt;
 	Tracker$Tracked.track(ServiceReference) line: 686&lt;br/&gt;
 	Tracker$Tracked.serviceChanged(ServiceEvent) line: 647&lt;br/&gt;
 	FilteredServiceListener.serviceChanged(ServiceEvent) line: 107&lt;br/&gt;
 	BundleContextImpl.dispatchEvent(Object, Object, int, Object) line: 861&lt;br/&gt;
 	EventManager.dispatchEvent(Set, EventDispatcher, int, Object) line: &lt;br/&gt;
 230&lt;br/&gt;
 	ListenerQueue.dispatchEventSynchronous(int, Object) line: 148&lt;br/&gt;
 	ServiceRegistry.publishServiceEventPrivileged(ServiceEvent) line: 819&lt;br/&gt;
 	ServiceRegistry.publishServiceEvent(ServiceEvent) line: 771&lt;br/&gt;
 	ServiceRegistrationImpl.register(Dictionary) line: 130&lt;br/&gt;
 	ServiceRegistry.registerService(BundleContextImpl, String[], Object,&lt;br/&gt;
 Dictionary) line: 214&lt;br/&gt;
 	BundleContextImpl.registerService(String[], Object, Dictionary) line: &lt;br/&gt;
 433&lt;br/&gt;
 	BundleContextImpl.registerService(String, Object, Dictionary) line: &lt;br/&gt;
 451&lt;br/&gt;
 	IPojoContext.registerService(String, Object, Dictionary) line: 404&lt;br/&gt;
 	StartupSequencerImpl$SequenceThread.launchStartupPhase(StartupPhase)&lt;br/&gt;
 line: 309&lt;br/&gt;
 	StartupSequencerImpl$SequenceThread.runStartup() line: 389&lt;br/&gt;
 	StartupSequencerImpl$SequenceThread.run() line: 262&lt;/p&gt;</description>
                <environment></environment>
        <key id="12618020">FELIX-3789</key>
            <summary>Deadlock due to synchronization on INSTANCE_NAME</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clement.escoffier">Clement Escoffier</assignee>
                                    <reporter username="seb64">Sebastien GRIMARD</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Nov 2012 17:35:00 +0000</created>
                <updated>Mon, 4 Feb 2013 12:34:32 +0000</updated>
                            <resolved>Tue, 18 Dec 2012 08:49:17 +0000</resolved>
                                    <version>ipojo-core-1.8.4</version>
                                    <fixVersion>ipojo-runtime-1.8.6</fixVersion>
                                    <component>iPOJO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13506406" author="sauthieg" created="Thu, 29 Nov 2012 11:17:45 +0000"  >&lt;p&gt;As far as I understand the issue, there is 1 thread creating a component instance (from the iPOJO extender), it takes a lock when creating a handler instance.&lt;br/&gt;
And there is another Thread (is StartupSequencer a class of yours ?) that register a service that ends up starting a component instance that in turn creates and start a new PrimitiveComponentType that also wants to create a Handler instance (from the same handler type). Here is the dead lock.&lt;/p&gt;

&lt;p&gt;As a workaround, is it possible to move the PrimitiveComponentType startup outside of the @Validate method?&lt;br/&gt;
If possible, does this solve the issue?&lt;/p&gt;
</comment>
                            <comment id="13506480" author="seb64" created="Thu, 29 Nov 2012 14:01:26 +0000"  >&lt;p&gt;StartupSequencerImpl is one of my classes.&lt;/p&gt;

&lt;p&gt;I tried to run the PrimitiveComponentType startup from another thread and it did not solve the problem. The same deadlock still occasionally happens.&lt;/p&gt;

&lt;p&gt;New stack trace:&lt;/p&gt;

&lt;p&gt;Daemon Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-9&amp;#93;&lt;/span&gt; (Suspended)	&lt;br/&gt;
	owns: ComponentFactory  (id=59)	&lt;br/&gt;
	owns: ArrayList&amp;lt;E&amp;gt;  (id=60)	&lt;br/&gt;
	waiting for: HandlerManagerFactory  (id=58)	&lt;br/&gt;
	HandlerManagerFactory(IPojoFactory).createComponentInstance(Dictionary, ServiceContext) line: 258	&lt;br/&gt;
	ComponentFactory(IPojoFactory).getHandler(IPojoFactory$RequiredHandler, ServiceContext) line: 830	&lt;br/&gt;
	ComponentFactory(IPojoFactory).createComponentInstance(Dictionary, ServiceContext) line: 306	&lt;br/&gt;
	ComponentFactory(IPojoFactory).createComponentInstance(Dictionary) line: 239	&lt;br/&gt;
	PrimitiveComponentType(ComponentType).createInstance() line: 79	&lt;br/&gt;
	COI_Starter$1.run() line: 191	&lt;/p&gt;


&lt;p&gt;Daemon Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-1&amp;#93;&lt;/span&gt; (Suspended)	&lt;br/&gt;
	owns: HandlerManagerFactory  (id=58)	&lt;br/&gt;
	owns: ComponentFactory  (id=61)	&lt;br/&gt;
	owns: HandlerManagerFactory  (id=62)	&lt;br/&gt;
	waiting for: ArrayList&amp;lt;E&amp;gt;  (id=60)	&lt;br/&gt;
	HandlerManagerFactory(IPojoFactory).createComponentInstance(Dictionary, ServiceContext) line: 283	&lt;br/&gt;
	ComponentFactory(IPojoFactory).getHandler(IPojoFactory$RequiredHandler, ServiceContext) line: 830	&lt;br/&gt;
	ComponentFactory(IPojoFactory).computeDescription() line: 721	&lt;br/&gt;
	ComponentFactory(IPojoFactory).computeFactoryState() line: 757	&lt;br/&gt;
	ComponentFactory.addedService(ServiceReference) line: 414	&lt;br/&gt;
	Tracker$Tracked.trackAdding(ServiceReference) line: 725	&lt;br/&gt;
	Tracker$Tracked.track(ServiceReference) line: 686	&lt;br/&gt;
	Tracker$Tracked.serviceChanged(ServiceEvent) line: 642	&lt;br/&gt;
	FilteredServiceListener.serviceChanged(ServiceEvent) line: 107	&lt;br/&gt;
	BundleContextImpl.dispatchEvent(Object, Object, int, Object) line: 861	&lt;br/&gt;
	EventManager.dispatchEvent(Set, EventDispatcher, int, Object) line: 230	&lt;br/&gt;
	ListenerQueue.dispatchEventSynchronous(int, Object) line: 148	&lt;br/&gt;
	ServiceRegistry.publishServiceEventPrivileged(ServiceEvent) line: 819	&lt;br/&gt;
	ServiceRegistry.publishServiceEvent(ServiceEvent) line: 771	&lt;br/&gt;
	ServiceRegistrationImpl.register(Dictionary) line: 130	&lt;br/&gt;
	ServiceRegistry.registerService(BundleContextImpl, String[], Object, Dictionary) line: 214	&lt;br/&gt;
	BundleContextImpl.registerService(String[], Object, Dictionary) line: 433	&lt;br/&gt;
	HandlerManagerFactory(IPojoFactory).start() line: 613	&lt;br/&gt;
	Extender.createAbstractFactory(Bundle, Element) line: 520	&lt;br/&gt;
	Extender.parse(Bundle, String) line: 301	&lt;br/&gt;
	Extender.startManagementFor(Bundle) line: 237	&lt;br/&gt;
	Extender.access$600(Extender, Bundle) line: 52	&lt;br/&gt;
	Extender$CreatorThread.run() line: 769	&lt;br/&gt;
	Thread.run() line: 662	&lt;/p&gt;</comment>
                            <comment id="13534761" author="clement.escoffier" created="Tue, 18 Dec 2012 08:49:17 +0000"  >&lt;p&gt;Guillaume Sauthier proposed a patch changing how we compute the instance name. This should fixed the deadlock. &lt;/p&gt;

&lt;p&gt;However, we now must ensure that factory names are unique. As factory names are used as service pid (of the Factory service), they should have already been unique but it was not enforced. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>292622</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s9qv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163055</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>