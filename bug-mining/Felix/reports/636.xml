<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:12:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1565] Deadlock UrlHandlers</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1565</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I&apos;m getting a deadlock quite frequently in the URLHandlers class during our unit tests:&lt;/p&gt;

&lt;p&gt;build	07-Sep-2009 23:13:49	Java stack information for the threads listed above:&lt;br/&gt;
build	07-Sep-2009 23:13:49	===================================================&lt;br/&gt;
build	07-Sep-2009 23:13:49	&quot;FelixShutdown&quot;:&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.URLHandlers.unregisterFrameworkListsForContextSearch(URLHandlers.java:265)&lt;br/&gt;
build	07-Sep-2009 23:13:49		- waiting to lock &amp;lt;0xb41335e0&amp;gt; (a java.util.HashMap)&lt;br/&gt;
build	07-Sep-2009 23:13:49		- locked &amp;lt;0xb00fd0e8&amp;gt; (a java.lang.Class for java.net.URL)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.util.SecureAction.invoke(SecureAction.java:763)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.URLHandlers.unregisterFrameworkInstance(URLHandlers.java:533)&lt;br/&gt;
build	07-Sep-2009 23:13:49		- locked &amp;lt;0xb4133590&amp;gt; (a java.util.ArrayList)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.URLHandlersActivator.stop(URLHandlersActivator.java:63)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.util.SecureAction.stopActivator(SecureAction.java:611)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.Felix$SystemBundleActivator.run(Felix.java:4041)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
build	07-Sep-2009 23:13:49	&quot;main&quot;:&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.URLHandlers.getFrameworkFromContext(URLHandlers.java:571)&lt;br/&gt;
build	07-Sep-2009 23:13:49		- waiting to lock &amp;lt;0xb4133590&amp;gt; (a java.util.ArrayList)&lt;br/&gt;
build	07-Sep-2009 23:13:49		- locked &amp;lt;0xb41335e0&amp;gt; (a java.util.HashMap)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.URLHandlersStreamHandlerProxy.getStreamHandlerService(URLHandlersStreamHandlerProxy.java:465)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at org.apache.felix.framework.URLHandlersStreamHandlerProxy.hashCode(URLHandlersStreamHandlerProxy.java:225)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at java.net.URL.hashCode(URL.java:857)&lt;br/&gt;
build	07-Sep-2009 23:13:49		- locked &amp;lt;0xefb8c0a8&amp;gt; (a java.net.URL)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at java.util.HashMap.get(HashMap.java:300)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.net.www.protocol.jar.JarFileFactory.getCachedJarFile(JarFileFactory.java:90)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.java:50)&lt;br/&gt;
build	07-Sep-2009 23:13:49		- locked &amp;lt;0xb40027d8&amp;gt; (a sun.net.www.protocol.jar.JarFileFactory)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.java:104)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.net.www.protocol.jar.JarURLConnection.getInputStream(JarURLConnection.java:132)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at java.net.URL.openStream(URL.java:1009)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at aQute.lib.osgi.Analyzer.getBndManifest(Analyzer.java:591)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at aQute.lib.osgi.Analyzer.getVersion(Analyzer.java:554)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at aQute.lib.osgi.Analyzer.calcManifest(Analyzer.java:303)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at com.atlassian.plugin.osgi.container.felix.ExportsBuilder.determineExports(ExportsBuilder.java:84)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at com.atlassian.plugin.osgi.container.felix.TestExportsBuilder.testDetermineExportsIncludeServiceInterfaces(TestExportsBuilder.java:68)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
build	07-Sep-2009 23:13:49		at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;/p&gt;</description>
                <environment>java version &amp;quot;1.6.0_14&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_14-b08)&lt;br/&gt;
Java HotSpot(TM) Server VM (build 14.0-b16, mixed mode)&lt;br/&gt;
&lt;br/&gt;
Linux</environment>
        <key id="12435058">FELIX-1565</key>
            <summary>Deadlock UrlHandlers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karlpauls">Karl Pauls</assignee>
                                    <reporter username="mrdon">Donald J. Brown</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Sep 2009 04:18:07 +0000</created>
                <updated>Mon, 14 Sep 2009 06:29:37 +0000</updated>
                            <resolved>Wed, 9 Sep 2009 12:17:09 +0000</resolved>
                                    <version>framework-1.8.1</version>
                    <version>framework-2.0.0</version>
                                    <fixVersion>framework-2.0.1</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12752353" author="mrdon" created="Tue, 8 Sep 2009 05:56:22 +0000"  >&lt;p&gt;Looks like this is still an issue with trunk.  The simple fix is the change this:&lt;/p&gt;

&lt;p&gt;         // This is a hack. The idea is to return the only registered framework&lt;br/&gt;
        synchronized (m_classloaderToFrameworkLists)&lt;br/&gt;
        {&lt;br/&gt;
            if (m_classloaderToFrameworkLists.isEmpty())&lt;br/&gt;
            {&lt;br/&gt;
                synchronized (m_frameworks)&lt;br/&gt;
                {&lt;br/&gt;
                    if ((m_counter == 1) &amp;amp;&amp;amp; (m_frameworks.size() == 1))&lt;/p&gt;
                    {
                        return m_frameworks.get(0);
                    }&lt;br/&gt;
                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;br/&gt;
&lt;br/&gt;
to be this:&lt;br/&gt;
&lt;br/&gt;
         // This is a hack. The idea is to return the only registered framework&lt;br/&gt;
        synchronized (m_frameworks) &lt;br/&gt;
            synchronized (m_classloaderToFrameworkLists)&lt;br/&gt;
            {&lt;br/&gt;
                if (m_classloaderToFrameworkLists.isEmpty())&lt;br/&gt;
                {&lt;br/&gt;
                    if ((m_counter == 1) &amp;amp;&amp;amp; (m_frameworks.size() == 1))&lt;br/&gt;
                    {                        return m_frameworks.get(0);                    }
&lt;p&gt;                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;But that may or may not be a good idea, as I don&apos;t fully understand the context.&lt;/p&gt;</comment>
                            <comment id="12752717" author="karlpauls" created="Tue, 8 Sep 2009 20:21:43 +0000"  >&lt;p&gt;Yes, there is a possibility for deadlock if a Url is created/used while the framework is shutdown. While your simple fix would solve that it introduces another possibility for a different deadlock. &lt;/p&gt;

&lt;p&gt;However, I can see a fix for this - I will test it tomorrow and come back to this issue asap.&lt;/p&gt;</comment>
                            <comment id="12752719" author="karlpauls" created="Tue, 8 Sep 2009 20:23:55 +0000"  >&lt;p&gt;I can confirm that this affects 2.0.0 as well. Fix needs to go into the next release then.&lt;/p&gt;</comment>
                            <comment id="12753055" author="karlpauls" created="Wed, 9 Sep 2009 12:17:09 +0000"  >&lt;p&gt;I just commited a fix for this. Please retest and see whether it fixes the issue for you. Thanks for reporting.&lt;/p&gt;</comment>
                            <comment id="12754842" author="mrdon" created="Mon, 14 Sep 2009 06:29:37 +0000"  >&lt;p&gt;I reverted my fix and applied this one.  All builds green.  Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57462</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vt0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183673</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>