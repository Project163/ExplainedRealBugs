<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:00:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5153] DM4 calls stop before ungetService() on ServiceFactory components</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5153</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When you remove a ServiceFactory component DM4 will call the stop method before the the framework has called ungetService() for all service instances. &lt;/p&gt;

&lt;p&gt;This seems to be a regression from DM3 and breaks any implementation that relies on previous behavior for cleanup.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12924874">FELIX-5153</key>
            <summary>DM4 calls stop before ungetService() on ServiceFactory components</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pderop">Pierre De Rop</assignee>
                                    <reporter username="bramk">Bram de Kruijff</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Dec 2015 12:34:13 +0000</created>
                <updated>Sun, 6 Mar 2016 19:06:35 +0000</updated>
                            <resolved>Sun, 3 Jan 2016 23:42:49 +0000</resolved>
                                                    <fixVersion>org.apache.felix.dependencymanager-r8</fixVersion>
                                    <component>Dependency Manager</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15074995" author="bramk" created="Wed, 30 Dec 2015 12:35:30 +0000"  >&lt;p&gt;Here is a small project that reproduces the problem: &lt;a href=&quot;https://github.com/bramk/dmtest&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bramk/dmtest&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15075003" author="pderop" created="Wed, 30 Dec 2015 12:42:53 +0000"  >&lt;p&gt;ok, I will look into this asap.&lt;/p&gt;</comment>
                            <comment id="15075033" author="pderop" created="Wed, 30 Dec 2015 13:40:53 +0000"  >&lt;p&gt;I reproduced. (Thanks a lot for the nice bndtools sample project !)&lt;/p&gt;

&lt;p&gt;I think all comes from the ComponentImpl.unregisterService() method (DM4), which currently does this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void unregisterService() {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (m_serviceName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; m_registration != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (m_bundle != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; m_bundle.getState() == Bundle.ACTIVE) {
                    m_registration.unregister();
                }
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IllegalStateException e) { &lt;span class=&quot;code-comment&quot;&gt;/* Should we really log &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; ? */&lt;/span&gt;}
            autoConfigureImplementation(ServiceRegistration.class, NULL_REGISTRATION);
            m_registration = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;you see the &quot;if (m_bundle != null &amp;amp;&amp;amp; m_bundle.getState() == Bundle.ACTIVE) {&quot; &lt;br/&gt;
-&amp;gt; this is the root cause.&lt;/p&gt;

&lt;p&gt;I will work on the fix tonight.&lt;/p&gt;

&lt;p&gt;can you please tell me if you need a quick release ?&lt;/p&gt;
</comment>
                            <comment id="15075045" author="bramk" created="Wed, 30 Dec 2015 13:57:25 +0000"  >&lt;p&gt;Awesome! Thanks for a quick triage &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Please do not spend new years eve on this! No need for super quick release from my end. We can stick with DM3 for a few more weeks.&lt;/p&gt;</comment>
                            <comment id="15075064" author="pderop" created="Wed, 30 Dec 2015 14:25:57 +0000"  >&lt;p&gt;Ok &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I plan to release the DM-R7 in the second week of 2016, so the fix will be included it it.&lt;br/&gt;
(notice that R7 will be built with java8,  because it will include a new dependencymanager-lambda library (see &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4689&quot; title=&quot;Create a more fluent syntax for the dependency manager builder&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-4689&quot;&gt;&lt;del&gt;FELIX-4689&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I hope it won&apos;t be an issue if R7 is not compatible anymore with java7 ?&lt;br/&gt;
(I think you are all using java8 at Amdatu ? if not let me know).&lt;/p&gt;

&lt;p&gt;thanks Bram.&lt;/p&gt;</comment>
                            <comment id="15075078" author="bramk" created="Wed, 30 Dec 2015 14:51:03 +0000"  >&lt;p&gt;Java 8 is fine &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="15075853" author="pderop" created="Thu, 31 Dec 2015 09:10:42 +0000"  >&lt;p&gt;It is fixed in the trunk (in rv 1722430.)&lt;br/&gt;
I will add a test case (based on your scenario) a bit later and will release around 10th January.&lt;/p&gt;</comment>
                            <comment id="15076017" author="bramk" created="Thu, 31 Dec 2015 15:32:48 +0000"  >&lt;p&gt;Works! &lt;/p&gt;

&lt;p&gt;The update did uncover a nasty race condition in my code... seems the timing it a bit different to DM3 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15080580" author="pderop" created="Sun, 3 Jan 2016 23:41:59 +0000"  >&lt;p&gt;Just committed a testcase in revision 1722772.&lt;br/&gt;
(src/org/apache/felix/dm/itest/api/FELIX5153_StopBeforeUngetServiceTest.java)&lt;/p&gt;</comment>
                            <comment id="15171581" author="pderop" created="Mon, 29 Feb 2016 08:34:23 +0000"  >&lt;p&gt;Hello Bram, &lt;/p&gt;

&lt;p&gt;Just to tell that the vote for the R7 has started (slightly behind schedule, sorry about that).&lt;br/&gt;
This release includes the fix for your issue.&lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qelr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>