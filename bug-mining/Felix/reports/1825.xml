<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:47:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3766] Slightly invalid logic for pre-checking dynamic imports which cause the framework the grab the lock with no real need</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3766</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Proposed patch&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/framework/src/main/java/org/apache/felix/framework/StatefulResolver.java b/framework/src/main/java/org/apache/felix/framework/StatefulResolver.java
index cc9a387..7255649 100644
--- a/framework/src/main/java/org/apache/felix/framework/StatefulResolver.java
+++ b/framework/src/main/java/org/apache/felix/framework/StatefulResolver.java
@@ -39,6 +39,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.framework.resolver.ResolverWire;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.framework.util.ShrinkableCollection;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.framework.util.Util;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.framework.util.manifestparser.R4Library;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.framework.wiring.BundleCapabilityImpl;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.framework.wiring.BundleRequirementImpl;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.framework.wiring.BundleWireImpl;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.Bundle;
@@ -755,6 +756,44 @@ &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;StatefulResolver
             attrs);
         List&amp;lt;BundleCapability&amp;gt; candidates = findProviders(req, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
 
+        &lt;span class=&quot;code-comment&quot;&gt;// Try to find a dynamic requirement that matches the capabilities.
&lt;/span&gt;+        BundleRequirementImpl dynReq = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; dynIdx = 0;
+             (candidates.size() &amp;gt; 0) &amp;amp;&amp;amp; (dynReq == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; (dynIdx &amp;lt; dynamics.size());
+             dynIdx++)
+        {
+            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Iterator&amp;lt;BundleCapability&amp;gt; itCand = candidates.iterator();
+                 (dynReq == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; itCand.hasNext(); )
+            {
+                BundleCapability cap = itCand.next();
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (CapabilitySet.matches(
+                        (BundleCapabilityImpl) cap,
+                        ((BundleRequirementImpl) dynamics.get(dynIdx)).getFilter()))
+                {
+                    dynReq = (BundleRequirementImpl) dynamics.get(dynIdx);
+                }
+            }
+        }
+
+        &lt;span class=&quot;code-comment&quot;&gt;// If we found a matching dynamic requirement, then filter out
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// any candidates that &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not match it.
&lt;/span&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dynReq != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
+        {
+            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Iterator&amp;lt;BundleCapability&amp;gt; itCand = candidates.iterator();
+                 itCand.hasNext(); )
+            {
+                BundleCapability cap = itCand.next();
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!CapabilitySet.matches(cap, dynReq.getFilter()))
+                {
+                    itCand.remove();
+                }
+            }
+        }
+        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
+        {
+            candidates.clear();
+        }
+
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !candidates.isEmpty();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12616670">FELIX-3766</key>
            <summary>Slightly invalid logic for pre-checking dynamic imports which cause the framework the grab the lock with no real need</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="gnodet">Guillaume Nodet</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Nov 2012 00:41:00 +0000</created>
                <updated>Tue, 5 Feb 2013 18:12:45 +0000</updated>
                            <resolved>Tue, 5 Feb 2013 18:12:45 +0000</resolved>
                                    <version>framework-4.0.2</version>
                                    <fixVersion>framework-4.2.0</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13507086" author="rickhall" created="Fri, 30 Nov 2012 04:29:59 +0000"  >&lt;p&gt;I think there was a reason that was omitted from ResolveImpl.getDynamicImportCandidates(), but off the top of my head I cannot think of why. Also, I notice that this isn&apos;t technically 100% correct since you can have multiple dynamic requirements that match a given package, thus we may pick the wrong one to filter. We should probably make dynReq a list of potentially matching dynamic requirements and then filter candidates that don&apos;t match any of them.&lt;/p&gt;</comment>
                            <comment id="13571529" author="rickhall" created="Tue, 5 Feb 2013 18:12:45 +0000"  >&lt;p&gt;Since I couldn&apos;t think of any reasons why not, I went ahead and basically applied the supplied patch. This pre-check is still just an approximation, since it doesn&apos;t take into account resolver hooks, but it should make it more accurate. Please close if satisfied, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>258526</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ktxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>119667</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>