<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:49:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4069] [DS] ConcurrentModificationException in ServiceFactoryComponentManager</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4069</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;During startup of our application that is heavily dependant on DS and felix we occasionally see the following error:&lt;/p&gt;

&lt;p&gt;ERROR: Bundle DwsCoreImpl.DwsCoreLogProviderImpl &lt;span class=&quot;error&quot;&gt;&amp;#91;37&amp;#93;&lt;/span&gt; EventDispatcher: Error during dispatch. (java.util.ConcurrentModificationException)&lt;br/&gt;
java.util.ConcurrentModificationException&lt;br/&gt;
        at java.util.IdentityHashMap$IdentityHashMapIterator.nextIndex(IdentityHashMap.java:732)&lt;br/&gt;
        at java.util.IdentityHashMap$KeyIterator.next(IdentityHashMap.java:822)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.ServiceFactoryComponentManager.invokeBindMethod(ServiceFactoryComponentManager.java:204)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.DependencyManager.serviceAdded(DependencyManager.java:402)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.DependencyManager.serviceChanged(DependencyManager.java:159)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.invokeServiceListenerCallback(EventDispatcher.java:932)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:793)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireServiceEvent(EventDispatcher.java:543)&lt;br/&gt;
        at org.apache.felix.framework.Felix.fireServiceEvent(Felix.java:4419)&lt;br/&gt;
        at org.apache.felix.framework.Felix.registerService(Felix.java:3423)&lt;br/&gt;
        at org.apache.felix.framework.BundleContextImpl.registerService(BundleContextImpl.java:346)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.registerService(AbstractComponentManager.java:660)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.registerService(AbstractComponentManager.java:644)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.registerComponentService(AbstractComponentManager.java:688)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager$Unsatisfied.activate(AbstractComponentManager.java:1481)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.activateInternal(AbstractComponentManager.java:550)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.enable(AbstractComponentManager.java:261)&lt;br/&gt;
        at org.apache.felix.scr.impl.config.ImmediateComponentHolder.enableComponents(ImmediateComponentHolder.java:328)&lt;br/&gt;
        at org.apache.felix.scr.impl.BundleComponentActivator.initialize(BundleComponentActivator.java:158)&lt;br/&gt;
        at org.apache.felix.scr.impl.BundleComponentActivator.&amp;lt;init&amp;gt;(BundleComponentActivator.java:113)&lt;br/&gt;
        at org.apache.felix.scr.impl.Activator.loadComponents(Activator.java:261)&lt;br/&gt;
        at org.apache.felix.scr.impl.Activator.bundleChanged(Activator.java:179)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.invokeBundleListenerCallback(EventDispatcher.java:868)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:789)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireBundleEvent(EventDispatcher.java:514)&lt;br/&gt;
        at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4403)&lt;br/&gt;
        at org.apache.felix.framework.Felix.startBundle(Felix.java:2092)&lt;br/&gt;
        at org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1291)&lt;br/&gt;
        at org.apache.felix.framework.FrameworkStartLevelImpl.run(FrameworkStartLevelImpl.java:304)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
FrameworkEvent ERROR&lt;br/&gt;
java.util.ConcurrentModificationException&lt;br/&gt;
        at java.util.IdentityHashMap$IdentityHashMapIterator.nextIndex(IdentityHashMap.java:732)&lt;br/&gt;
        at java.util.IdentityHashMap$KeyIterator.next(IdentityHashMap.java:822)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.ServiceFactoryComponentManager.invokeBindMethod(ServiceFactoryComponentManager.java:204)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.DependencyManager.serviceAdded(DependencyManager.java:402)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.DependencyManager.serviceChanged(DependencyManager.java:159)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.invokeServiceListenerCallback(EventDispatcher.java:932)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:793)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireServiceEvent(EventDispatcher.java:543)&lt;br/&gt;
        at org.apache.felix.framework.Felix.fireServiceEvent(Felix.java:4419)&lt;br/&gt;
        at org.apache.felix.framework.Felix.registerService(Felix.java:3423)&lt;br/&gt;
        at org.apache.felix.framework.BundleContextImpl.registerService(BundleContextImpl.java:346)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.registerService(AbstractComponentManager.java:660)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.registerService(AbstractComponentManager.java:644)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.registerComponentService(AbstractComponentManager.java:688)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager$Unsatisfied.activate(AbstractComponentManager.java:1481)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.activateInternal(AbstractComponentManager.java:550)&lt;br/&gt;
        at org.apache.felix.scr.impl.manager.AbstractComponentManager.enable(AbstractComponentManager.java:261)&lt;br/&gt;
        at org.apache.felix.scr.impl.config.ImmediateComponentHolder.enableComponents(ImmediateComponentHolder.java:328)&lt;br/&gt;
        at org.apache.felix.scr.impl.BundleComponentActivator.initialize(BundleComponentActivator.java:158)&lt;br/&gt;
        at org.apache.felix.scr.impl.BundleComponentActivator.&amp;lt;init&amp;gt;(BundleComponentActivator.java:113)&lt;br/&gt;
        at org.apache.felix.scr.impl.Activator.loadComponents(Activator.java:261)&lt;br/&gt;
        at org.apache.felix.scr.impl.Activator.bundleChanged(Activator.java:179)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.invokeBundleListenerCallback(EventDispatcher.java:868)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:789)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireBundleEvent(EventDispatcher.java:514)&lt;br/&gt;
        at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4403)&lt;br/&gt;
        at org.apache.felix.framework.Felix.startBundle(Felix.java:2092)&lt;br/&gt;
        at org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1291)&lt;br/&gt;
        at org.apache.felix.framework.FrameworkStartLevelImpl.run(FrameworkStartLevelImpl.java:304)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:722)&lt;/p&gt;


&lt;p&gt;Looking at the ServiceFactoryComponentManager we see there is no protection around the iteration over components which makes it no surprise that the code is not thread safe and is suffering from concurrent modification. Although most of our system seems to be working this exception at startup is cause for wider concern on how thread safe the code is and if later on when we have even more services we will start seeing bigger issues that mean ditching scr and using some other solution.&lt;/p&gt;</description>
                <environment>Windows 7</environment>
        <key id="12648244">FELIX-4069</key>
            <summary>[DS] ConcurrentModificationException in ServiceFactoryComponentManager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djencks">David Jencks</assignee>
                                    <reporter username="ajpurkiss">Adam Purkiss</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 May 2013 20:15:03 +0000</created>
                <updated>Tue, 15 Oct 2013 23:39:26 +0000</updated>
                            <resolved>Sun, 19 May 2013 01:59:57 +0000</resolved>
                                    <version>scr-1.6.2</version>
                                    <fixVersion>scr-1.8.0</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13661459" author="djencks" created="Sun, 19 May 2013 01:59:57 +0000"  >&lt;p&gt;This should be fixed in rev 1484207.  Please try it out and let us know.&lt;/p&gt;

&lt;p&gt;We don&apos;t have any tests for the ServiceFactory functionality &amp;#8211; I haven&apos;t figured out a good way to create enough bundles to test it &amp;#8211; so any feedback you can give would be really useful.&lt;/p&gt;</comment>
                            <comment id="13663288" author="ajpurkiss" created="Tue, 21 May 2013 19:27:56 +0000"  >&lt;p&gt;The error does not seem to occur and things seem ok at the moment although we will continue testing with this, I have not looked at the full change list from 1.6.2 to this so I am assuming all should be good else where. Is there a eta on when this might make it to an official update? On a side not I had to skip the unit tests on my dev box when doing the build as I got a build failure during the tests . I have not looked into the test failure to see what is going on but for your information my dev box was saying:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.scr.integration.components.concurrency.C&amp;#93;&lt;/span&gt; (exit)&lt;br/&gt;
log level: 4 D=13:20:10,796 T=Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-4,5,main&amp;#93;&lt;/span&gt;: [org.apache.felix.scr.int&lt;br/&gt;
egration.components.concurrency.C(21310)] Unset and deconfigured implementation&lt;br/&gt;
object for component org.apache.felix.scr.integration.components.concurrency.C i&lt;br/&gt;
n deleteComponent for reason Component disabled&lt;br/&gt;
log level: 4 D=13:20:10,796 T=Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-4,5,main&amp;#93;&lt;/span&gt;: [org.apache.felix.scr.int&lt;br/&gt;
egration.components.concurrency.C(21310)] Deactivating dependency managers&lt;br/&gt;
log level: 4 D=13:20:10,796 T=Thread&lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-4,5,main&amp;#93;&lt;/span&gt;: [org.apache.felix.scr.int&lt;br/&gt;
egration.components.concurrency.C(21310)] Disabling dependency managers&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests run: 17, Failures: 0, Errors: 0, Skipped: 0&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; BUILD FAILURE&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 8:16.128s&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: Tue May 21 13:27:10 EDT 2013&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 12M/247M&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failed to execute goal org.apache.maven.plugins:maven-failsafe-plugin:2.&lt;br/&gt;
12:integration-test (default) on project org.apache.felix.scr: Execution default&lt;br/&gt;
 of goal org.apache.maven.plugins:maven-failsafe-plugin:2.12:integration-test fa&lt;br/&gt;
iled: The forked VM terminated without saying properly goodbye. VM crash or Syst&lt;br/&gt;
em.exit called ? -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; To see the full stack trace of the errors, re-run Maven with the -e swit&lt;br/&gt;
ch.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Re-run Maven using the -X switch to enable full debug logging.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; For more information about the errors and possible solutions, please rea&lt;br/&gt;
d the following articles:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://cwiki.apache.org/confluence/display/MAVEN/PluginExecutio&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cwiki.apache.org/confluence/display/MAVEN/PluginExecutio&lt;/a&gt;&lt;br/&gt;
nException&lt;/p&gt;</comment>
                            <comment id="13665439" author="ajpurkiss" created="Thu, 23 May 2013 18:12:15 +0000"  >&lt;p&gt;build failure was tracked down to not providing maven with enough memory&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328600</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kp1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>328944</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>