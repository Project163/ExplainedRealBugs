<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:17:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1753] The start level should check that the bundle still exists before starting it to avoid an ugly exception</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1753</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;ERROR: Error locking &lt;a href=&quot;file:/Users/gnodet/work/felix/git/karaf/assembly/target/apache-felix-karaf-1.1.0-SNAPSHOT/deploy/test.xml&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/Users/gnodet/work/felix/git/karaf/assembly/target/apache-felix-karaf-1.1.0-SNAPSHOT/deploy/test.xml&lt;/a&gt; (java.lang.IllegalStateException: Bundle in unexpected state.)&lt;br/&gt;
java.lang.IllegalStateException: Bundle in unexpected state.&lt;br/&gt;
	at org.apache.felix.framework.Felix.acquireBundleLock(Felix.java:4513)&lt;br/&gt;
	at org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1048)&lt;br/&gt;
	at org.apache.felix.framework.StartLevelImpl.run(StartLevelImpl.java:264)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:613)&lt;/p&gt;


&lt;p&gt;This is the exception I have when i start felix after having removed a bundle managed by fileinstall while felix was stopped.&lt;br/&gt;
I think it should be easy enough to add a check to avoid this exception.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12438004">FELIX-1753</key>
            <summary>The start level should check that the bundle still exists before starting it to avoid an ugly exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="gnodet">Guillaume Nodet</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Oct 2009 19:44:22 +0000</created>
                <updated>Thu, 1 Apr 2010 13:00:53 +0000</updated>
                            <resolved>Thu, 25 Mar 2010 06:02:20 +0000</resolved>
                                    <version>framework-2.0.0</version>
                                    <fixVersion>framework-2.0.5</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12765235" author="rickhall" created="Tue, 13 Oct 2009 21:15:47 +0000"  >&lt;p&gt;Well, we could change the log ERROR to a WARNING, but the whole point is we let start level change process be a little loose so we don&apos;t run into any deadlocks. So, we just get all bundles at the beginning while holding the lock and then cycle through them all starting/stopping as appropriate without the lock.&lt;/p&gt;</comment>
                            <comment id="12765274" author="gnt" created="Tue, 13 Oct 2009 22:07:54 +0000"  >&lt;p&gt;I certainly did not imply to add more locking.&lt;/p&gt;

&lt;p&gt;But if you have lots of bundles to start at a given level, during the time you start the first bundles, you may have other bundles being uninstalled.  I just think we should not print anything if one bundle has been uninstalled between the time the bundle list has been computed and the time we try to actually start the bundle.&lt;/p&gt;

&lt;p&gt;What about adding the following just before trying to acquire the lock in the setActiveStartLevel method:&lt;/p&gt;

&lt;p&gt;if (impl.getState() == Bundle.UNINSTALLED)&lt;br/&gt;
{&lt;br/&gt;
   continue;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;I don&apos;t think we should print / log an error, as this is imho a valid, yet rare, use case.&lt;/p&gt;</comment>
                            <comment id="12765278" author="rickhall" created="Tue, 13 Oct 2009 22:18:59 +0000"  >&lt;p&gt;I am not against that, but, to be clear, that doesn&apos;t eliminate the possibility, it just shortens the window in which it can happen.&lt;/p&gt;

&lt;p&gt;We could also log just the message and not the exception, since that is more of an implementation detail anyway.&lt;/p&gt;</comment>
                            <comment id="12765283" author="gnt" created="Tue, 13 Oct 2009 22:28:34 +0000"  >&lt;p&gt;Maybe a better fix would be to modify the code to the following:&lt;/p&gt;

&lt;p&gt;                // Lock the current bundle.&lt;br/&gt;
                try&lt;/p&gt;
                {
                    acquireBundleLock(impl,
                        Bundle.INSTALLED | Bundle.RESOLVED | Bundle.ACTIVE
                        | Bundle.STARTING | Bundle.STOPPING);
                }
&lt;p&gt;                catch (IllegalStateException ex)&lt;br/&gt;
                {&lt;br/&gt;
                    if (impl.getState() != Bundle.UNINSTALLED)&lt;/p&gt;
                    {
                        fireFrameworkEvent(FrameworkEvent.ERROR, impl, ex);
                        m_logger.log(
                            Logger.LOG_ERROR,
                            &quot;Error locking &quot; + impl._getLocation(), ex);
                    }
&lt;p&gt;                    continue;&lt;br/&gt;
                }&lt;/p&gt;
</comment>
                            <comment id="12849594" author="rickhall" created="Thu, 25 Mar 2010 06:02:20 +0000"  >&lt;p&gt;I committed your last suggest patch, please close if satisfied. Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12455882">FELIX-2064</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57278</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vs1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183516</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>