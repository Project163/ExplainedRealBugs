<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:52:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3712] FileInstall throws Interrupted exception when refreshed</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3712</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;FileInstall will throw exception when refreshing. It is possible there are easier ways to reproduce this but here is one way:&lt;/p&gt;

&lt;p&gt;1) Uninstall gogo command (if available) from the osgi container.&lt;br/&gt;
2) Install fileinstall&lt;br/&gt;
3) Put gogo command in the directory watched by fileinstall&lt;/p&gt;

&lt;p&gt;Result: Fileinstall throws&lt;/p&gt;

&lt;p&gt;In main loop, we have serious trouble: java.lang.RuntimeException: java.lang.InterruptedException&lt;br/&gt;
java.lang.RuntimeException: java.lang.InterruptedException&lt;br/&gt;
        at org.apache.felix.fileinstall.internal.FileInstall.refresh(FileInstall.java:332)&lt;br/&gt;
        at org.apache.felix.fileinstall.internal.DirectoryWatcher.refresh(DirectoryWatcher.java:677)&lt;br/&gt;
        at org.apache.felix.fileinstall.internal.DirectoryWatcher.process(DirectoryWatcher.java:494)&lt;br/&gt;
        at org.apache.felix.fileinstall.internal.DirectoryWatcher.run(DirectoryWatcher.java:291)&lt;br/&gt;
Caused by: java.lang.InterruptedException&lt;br/&gt;
        at java.lang.Object.wait(Native Method)&lt;br/&gt;
        at org.apache.felix.fileinstall.internal.FileInstall.refresh(FileInstall.java:330)&lt;br/&gt;
        ... 3 more&lt;/p&gt;

&lt;p&gt;Possible reason: Due to &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3414&quot; title=&quot;BundleException: Unable to acquire global lock for resolve&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3414&quot;&gt;&lt;del&gt;FELIX-3414&lt;/del&gt;&lt;/a&gt;, the refresh() method in DirectoryWatcher was changed from calling&lt;br/&gt;
packageAdmin#refreshPackages() directly, to using the FileInstall#refresh()&lt;br/&gt;
helper method. The later wraps interrupted excpetions in a runtime exception which is never caught in the directory watcher&apos;s main loop. Thus, the directory watcher will re-throw the exception, which it previously did not (since the interrupted excpetion would get caught).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12612015">FELIX-3712</key>
            <summary>FileInstall throws Interrupted exception when refreshed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="pererik">Per-Erik Svensson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Oct 2012 11:22:59 +0000</created>
                <updated>Fri, 12 Jun 2015 19:29:00 +0000</updated>
                            <resolved>Fri, 6 Dec 2013 09:49:15 +0000</resolved>
                                    <version>fileinstall-3.2.4</version>
                    <version>fileinstall-3.2.6</version>
                                    <fixVersion>fileinstall-3.2.8</fixVersion>
                                    <component>File Install</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13503565" author="rotty3000" created="Sun, 25 Nov 2012 22:39:52 +0000"  >&lt;p&gt;I get the same error when using fileinstall 3.2.6 on Equinox during startup.&lt;/p&gt;

&lt;p&gt;In main loop, we have serious trouble&lt;br/&gt;
java.lang.RuntimeException: java.lang.InterruptedException&lt;br/&gt;
	at org.apache.felix.fileinstall.internal.FileInstall.refresh(FileInstall.java:332)&lt;br/&gt;
	at org.apache.felix.fileinstall.internal.DirectoryWatcher.refresh(DirectoryWatcher.java:680)&lt;br/&gt;
	at org.apache.felix.fileinstall.internal.DirectoryWatcher.process(DirectoryWatcher.java:496)&lt;br/&gt;
	at org.apache.felix.fileinstall.internal.DirectoryWatcher.run(DirectoryWatcher.java:291)&lt;br/&gt;
Caused by: java.lang.InterruptedException&lt;br/&gt;
	at java.lang.Object.wait(Native Method)&lt;br/&gt;
	at org.apache.felix.fileinstall.internal.FileInstall.refresh(FileInstall.java:330)&lt;br/&gt;
	... 3 more&lt;/p&gt;</comment>
                            <comment id="13776675" author="tjwatson" created="Tue, 24 Sep 2013 19:50:59 +0000"  >&lt;p&gt;This issue happens when file install decides to: &lt;/p&gt;

&lt;p&gt;1) refresh itself or &lt;br/&gt;
2) refreshes a bundle which file install is wired to&lt;/p&gt;

&lt;p&gt;When this happens file install will be stopped while one of its directory watcher threads is waiting for a refresh package operation to complete.  Stopping file install will cause it to attempt to interrupt the directory watcher threads.  This causes the runtime exception to be thrown from FileInstall#refreshPackages like the reporter of this issue indicates.&lt;/p&gt;

&lt;p&gt;In my environment this ultimately makes the current operation to fail, it will not proceed to start the bundles that just got installed.  When file install is restarted it does not appear to reprocess the bundles from the directory, I assume because it persisted some timestamp information on the first attempt (which failed with a runtime exception) so the bundles are not started on file install restart.  So something is off with the file install restarting logic when a stop was done while waiting for a refresh operation to complete.&lt;/p&gt;

&lt;p&gt;This overall issue is happening if gogo command bundle is installed with file install because gogo command exports the log service package and file install optionally imports the log service package.  File install determines that a new provider of some optional import of the package is now available and decides it should refresh the file install bundle to allow it to get wired to the newly installed log service packages.&lt;/p&gt;

&lt;p&gt;This logic seems flawed.  In my case file install was already optionally wired to another provider of the log service package but file install detected that it was an optional import and a new provider just got installed so it must need refreshed.  I don&apos;t think it is a good idea to refresh a bundle just because another provider showed up for some optional requirement that is already wired to a perfectly good provider.&lt;/p&gt;</comment>
                            <comment id="13841135" author="gnt" created="Fri, 6 Dec 2013 09:46:42 +0000"  >&lt;p&gt;I&apos;ve made sure the InterruptedException is caught correctly.&lt;/p&gt;

&lt;p&gt;Committing to &lt;a href=&quot;https://svn.apache.org/repos/asf/felix/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/felix/trunk&lt;/a&gt; ...&lt;br/&gt;
	M	fileinstall/src/main/java/org/apache/felix/fileinstall/internal/DirectoryWatcher.java&lt;br/&gt;
	M	fileinstall/src/main/java/org/apache/felix/fileinstall/internal/FileInstall.java&lt;br/&gt;
Committed r1548470&lt;/p&gt;

&lt;p&gt;The logic can be changed to avoid refreshing bundles that are already wired, but this would require &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3543&quot; title=&quot;Upgrade to the new osgi wiring api&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3543&quot;&gt;&lt;del&gt;FELIX-3543&lt;/del&gt;&lt;/a&gt;, so I&apos;ll defer it until we do a minor/major release.&lt;/p&gt;</comment>
                            <comment id="13841138" author="gnt" created="Fri, 6 Dec 2013 09:52:15 +0000"  >&lt;p&gt;Raised &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4346&quot; title=&quot;Consider improving the logic to only refresh bundles for optional imports that are not satisfied yet&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-4346&quot;&gt;&lt;del&gt;FELIX-4346&lt;/del&gt;&lt;/a&gt; for improving the logic, though I&apos;m not even convinced yet it&apos;s a good idea.&lt;/p&gt;</comment>
                            <comment id="14583940" author="rotty3000" created="Fri, 12 Jun 2015 19:29:00 +0000"  >&lt;p&gt;FYI, this issue can be avoided in Equinox by setting the felix property:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;felix.fileinstall.optionalImportRefreshScope=managed&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;where &quot;fileinstall&quot; is not itself being managed (i.e. is not within one of the fileinstall scanned directories). Basically this tells fileinstall to ignore all bundles that are not under it&apos;s management.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12683086">FELIX-4346</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12680890">FELIX-4328</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248960</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a2qv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56718</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>