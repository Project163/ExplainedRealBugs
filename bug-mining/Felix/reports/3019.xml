<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:12:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5910] Set correct AccessControlContext when receiving configuration events</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5910</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;ConfigAdmin requests a restricted set of permissions by means of a permissions.perm file, which must not restrict the permissions of other bundles to which it sends events. There is in fact a mechanism in place to prevent this, using the protection domain of the bundle, in the class ManagedServiceTracker (resolving the related issue &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4362&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FELIX-4362&lt;/a&gt;). However, the UpdateThread class does not use this mechanism; instead it explicitly&#160;sets an AccessControlContext&#160;based on its own protection domain, hence enforcing its own restricted set of permissions to the event listeners. Below are two examples of the resulting&#160;AccessControlExceptions I get... there is just one additional bundle in the stack trace, felix-scr, which has all permissions and can be ignored from the permissions point of view.&#160;&lt;br/&gt;
By the way, removing the permissions.perm file from ConfigAdmin resolves the problem,&#160;confirming&#160;that the bug is&#160;indeed in ConfigAdmin.&#160;&lt;/p&gt;

&lt;p&gt;rg.slf4j.osgi-over-slf4j&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.configadmin.1.9.4&amp;#93;&lt;/span&gt; : [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.osgi.service.cm.ConfigurationAdmin&amp;#93;&lt;/span&gt;]Unexpected problem delivering configuration event to &lt;span class=&quot;error&quot;&gt;&amp;#91;org.osgi.service.cm.ConfigurationListener, id=18, bundle=24/mvn:org.apache.felix/org.apache.felix.configadmin/1.9.4&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.security.AccessControlException: access denied (&quot;java.lang.RuntimePermission&quot; &quot;getClassLoader&quot;)&lt;br/&gt;
 at java.base/java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)&lt;br/&gt;
 at java.base/java.security.AccessController.checkPermission(AccessController.java:895)&lt;br/&gt;
 at java.base/java.lang.SecurityManager.checkPermission(SecurityManager.java:335)&lt;br/&gt;
 at java.base/java.lang.ClassLoader.checkClassLoaderPermission(ClassLoader.java:2042)&lt;br/&gt;
 at java.base/java.lang.Class.getClassLoader(Class.java:807)&lt;br/&gt;
 at org.apache.felix.scr.impl.inject.methods.BaseMethod.findMethod(BaseMethod.java:158)&lt;br/&gt;
 at org.apache.felix.scr.impl.inject.methods.BaseMethod.access$400(BaseMethod.java:41)&lt;br/&gt;
 at org.apache.felix.scr.impl.inject.methods.BaseMethod$NotResolved.resolve(BaseMethod.java:602)&lt;br/&gt;
 at org.apache.felix.scr.impl.inject.methods.BaseMethod$NotResolved.methodExists(BaseMethod.java:626)&lt;br/&gt;
 at org.apache.felix.scr.impl.inject.methods.BaseMethod.methodExists(BaseMethod.java:528)&lt;br/&gt;
 at org.apache.felix.scr.impl.inject.methods.ActivateMethod.invoke(ActivateMethod.java:315)&lt;br/&gt;
 at org.apache.felix.scr.impl.inject.methods.ActivateMethod.invoke(ActivateMethod.java:307)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.SingleComponentManager.invokeModifiedMethod(SingleComponentManager.java:810)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.SingleComponentManager.modify(SingleComponentManager.java:765)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.SingleComponentManager.reconfigure(SingleComponentManager.java:683)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.SingleComponentManager.reconfigure(SingleComponentManager.java:647)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.ConfigurableComponentHolder.configurationUpdated(ConfigurableComponentHolder.java:435)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.RegionConfigurationSupport.configurationEvent(RegionConfigurationSupport.java:288)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.RegionConfigurationSupport$1.configurationEvent(RegionConfigurationSupport.java:91)&lt;br/&gt;
 at org.apache.felix.cm.impl.ConfigurationManager$FireConfigurationEvent.sendEvent(ConfigurationManager.java:1667)&lt;br/&gt;
 at org.apache.felix.cm.impl.ConfigurationManager$FireConfigurationEvent.run(ConfigurationManager.java:1635)&lt;br/&gt;
 at org.apache.felix.cm.impl.UpdateThread$1.run(UpdateThread.java:126)&lt;br/&gt;
 at org.apache.felix.cm.impl.UpdateThread$1.run(UpdateThread.java:123)&lt;br/&gt;
 at java.base/java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
 at org.apache.felix.cm.impl.UpdateThread.run0(UpdateThread.java:122)&lt;br/&gt;
 at org.apache.felix.cm.impl.UpdateThread.run(UpdateThread.java:105)&lt;br/&gt;
 at java.base/java.lang.Thread.run(Thread.java:844)&lt;/p&gt;

&lt;p&gt;org.slf4j.osgi-over-slf4j&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.configadmin.1.9.4&amp;#93;&lt;/span&gt; : [&lt;span class=&quot;error&quot;&gt;&amp;#91;org.osgi.service.cm.ConfigurationAdmin&amp;#93;&lt;/span&gt;]Unexpected problem delivering configuration event to &lt;span class=&quot;error&quot;&gt;&amp;#91;org.osgi.service.cm.ConfigurationListener, id=18, bundle=24/mvn:org.apache.felix/org.apache.felix.configadmin/1.9.4&amp;#93;&lt;/span&gt;&lt;br/&gt;
java.security.AccessControlException: access denied (&quot;org.osgi.framework.ServicePermission&quot; &quot;java.lang.Runnable&quot; &quot;register&quot;)&lt;br/&gt;
 at java.base/java.security.AccessControlContext.checkPermission(AccessControlContext.java:472)&lt;br/&gt;
 at java.base/java.security.AccessController.checkPermission(AccessController.java:895)&lt;br/&gt;
 at java.base/java.lang.SecurityManager.checkPermission(SecurityManager.java:335)&lt;br/&gt;
 at org.apache.felix.framework.BundleContextImpl.registerService(BundleContextImpl.java:322)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.AbstractComponentManager$3.register(AbstractComponentManager.java:891)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.AbstractComponentManager$3.register(AbstractComponentManager.java:877)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.RegistrationManager.changeRegistration(RegistrationManager.java:128)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.AbstractComponentManager.registerService(AbstractComponentManager.java:944)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.AbstractComponentManager.activateInternal(AbstractComponentManager.java:727)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.AbstractComponentManager.enableInternal(AbstractComponentManager.java:661)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.AbstractComponentManager.enable(AbstractComponentManager.java:427)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.ConfigurableComponentHolder.configurationUpdated(ConfigurableComponentHolder.java:440)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.RegionConfigurationSupport.configurationEvent(RegionConfigurationSupport.java:288)&lt;br/&gt;
 at org.apache.felix.scr.impl.manager.RegionConfigurationSupport$1.configurationEvent(RegionConfigurationSupport.java:91)&lt;br/&gt;
 at org.apache.felix.cm.impl.ConfigurationManager$FireConfigurationEvent.sendEvent(ConfigurationManager.java:1667)&lt;br/&gt;
 at org.apache.felix.cm.impl.ConfigurationManager$FireConfigurationEvent.run(ConfigurationManager.java:1635)&lt;br/&gt;
 at org.apache.felix.cm.impl.UpdateThread$1.run(UpdateThread.java:126)&lt;br/&gt;
 at org.apache.felix.cm.impl.UpdateThread$1.run(UpdateThread.java:123)&lt;br/&gt;
 at java.base/java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
 at org.apache.felix.cm.impl.UpdateThread.run0(UpdateThread.java:122)&lt;br/&gt;
 at org.apache.felix.cm.impl.UpdateThread.run(UpdateThread.java:105)&lt;br/&gt;
 at java.base/java.lang.Thread.run(Thread.java:844)&lt;/p&gt;</description>
                <environment>- Felix fwk 6.0.0 &lt;br/&gt;
- Felix security 2.6.0&lt;br/&gt;
- Felix config admin 1.9.4 and 1.9.5-SNAPSHOT</environment>
        <key id="13180105">FELIX-5910</key>
            <summary>Set correct AccessControlContext when receiving configuration events</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="cnoelle">Christoph N&#246;lle</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Aug 2018 00:51:32 +0000</created>
                <updated>Sun, 23 Sep 2018 07:09:27 +0000</updated>
                            <resolved>Sun, 16 Sep 2018 20:12:20 +0000</resolved>
                                    <version>scr-2.1.6</version>
                                    <fixVersion>scr-2.1.8</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16611880" author="cziegeler" created="Wed, 12 Sep 2018 10:15:31 +0000"  >&lt;p&gt;Thanks for reporting &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnoelle&quot; class=&quot;user-hover&quot; rel=&quot;cnoelle&quot;&gt;cnoelle&lt;/a&gt;. I&apos;ve committed a potential fix in rev 1840649. Please give it a test&lt;/p&gt;</comment>
                            <comment id="16612043" author="cnoelle" created="Wed, 12 Sep 2018 12:19:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cziegeler&quot; class=&quot;user-hover&quot; rel=&quot;cziegeler&quot;&gt;cziegeler&lt;/a&gt;, I think you forgot to include the&#160;fix in the commit. No changes in UpdateThread so far, the bug is still present.&lt;/p&gt;</comment>
                            <comment id="16612099" author="cziegeler" created="Wed, 12 Sep 2018 12:59:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnoelle&quot; class=&quot;user-hover&quot; rel=&quot;cnoelle&quot;&gt;cnoelle&lt;/a&gt; The change is in FireConfigurationEvent&lt;/p&gt;</comment>
                            <comment id="16612114" author="cziegeler" created="Wed, 12 Sep 2018 13:09:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnoelle&quot; class=&quot;user-hover&quot; rel=&quot;cnoelle&quot;&gt;cnoelle&lt;/a&gt; Is there an easy way to reproduce the issue?&lt;/p&gt;</comment>
                            <comment id="16612155" author="cnoelle" created="Wed, 12 Sep 2018 13:51:57 +0000"  >&lt;p&gt;Ok, sorry. In any case, the issue is still there. I tracked it down a little further: there are these two arrays in the&#160;&#160;FireConfigurationEvent class,&#160;&lt;/p&gt;

&lt;p&gt;private final ConfigurationListener[] listeners;&lt;/p&gt;

&lt;p&gt;private final Bundle[] listenerProvider;&lt;/p&gt;

&lt;p&gt;In my case there is an entry of type&#160;org.apache.felix.scr.impl.manager.RegionConfigurationSupport$1 in the listeners array, with the configadmin bundle in the listenersProvider array at the corresponding position. Hence the scr-callback is executed with permissions of the configadmin bundle.&#160;The reason is that scr uses the CA bundle context to register a service, see the #start-method in &lt;a href=&quot;https://github.com/apache/felix/blob/trunk/scr/src/main/java/org/apache/felix/scr/impl/manager/RegionConfigurationSupport.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/blob/trunk/scr/src/main/java/org/apache/felix/scr/impl/manager/RegionConfigurationSupport.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So maybe it&apos;s rather an scr issue now.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16612199" author="cziegeler" created="Wed, 12 Sep 2018 14:17:17 +0000"  >&lt;p&gt;Thanks, yes this looks like a SCR bug, it has to register the listener using the config admin bundle and therefore the listener is executed in the wrong bundle context&lt;/p&gt;</comment>
                            <comment id="16612312" author="cnoelle" created="Wed, 12 Sep 2018 15:17:48 +0000"  >&lt;p&gt;By the way, to reproduce the issue:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;create/use a ds-component which expects a component property type (@interface) in the activate method&lt;/li&gt;
	&lt;li&gt;start with security enabled&lt;/li&gt;
	&lt;li&gt;create a configuration with location &quot;?&quot; for the component (I did this by means of the configurator; when running with security you need to use a snapshot version and remove the permissions.perm file, due to some other bugs; but it shouldn&apos;t matter how the configuration is created)&lt;/li&gt;
	&lt;li&gt;change the configuration at runtime&#160;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16612491" author="timothyjward" created="Wed, 12 Sep 2018 17:21:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Thanks, yes this looks like a SCR bug&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I agree with this. SCR should definitely be removing itself from the stack by setting the relevant access control context before calling any lifecycle methods on the component. Otherwise SCR requires AllPermission (which is probably what it has if nobody has created a proper permissions file for it) which is a bad thing.&lt;/p&gt;</comment>
                            <comment id="16612533" author="cnoelle" created="Wed, 12 Sep 2018 17:59:26 +0000"  >&lt;p&gt;In general you are right, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=timothyjward&quot; class=&quot;user-hover&quot; rel=&quot;timothyjward&quot;&gt;timothyjward&lt;/a&gt;. Note however that here the issue is not&#160;that SCR is on the call stack where it shouldn&apos;t, but rather that ConfigAdmin is (although the root cause for this is in SCR).&lt;/p&gt;</comment>
                            <comment id="16614112" author="cziegeler" created="Thu, 13 Sep 2018 22:02:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cnoelle&quot; class=&quot;user-hover&quot; rel=&quot;cnoelle&quot;&gt;cnoelle&lt;/a&gt; I&apos;ve committed a potential fix to SCR in rev 1840868. It would be great if you could give this a try. Thanks!&lt;/p&gt;</comment>
                            <comment id="16616880" author="cnoelle" created="Sun, 16 Sep 2018 20:08:54 +0000"  >&lt;p&gt;Looks good to me, thanks a lot &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cziegeler&quot; class=&quot;user-hover&quot; rel=&quot;cziegeler&quot;&gt;cziegeler&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3x8t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>