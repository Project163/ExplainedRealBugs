<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:07:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-661] maven bundle plugin does not close the accessed fie /jar streams</title>
                <link>https://issues.apache.org/jira/browse/FELIX-661</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Maven bundle plugin is doing the following.&lt;/p&gt;

&lt;p&gt;i)  When someone (from a pom.xml)  uses this plug-in, to bundlize their project jars,  this plugin  first opens  a jar file for reading. And then later after in some other method call, it opens the SAME file for writing.  Basically it dynamically changes the content of the jar for reading and writing.  &lt;/p&gt;

&lt;p&gt;ii)  This plugin forgets to call the close() method on the file / zip/jar/ resource of  jdk and aQute packages.&lt;/p&gt;

&lt;p&gt;How to fix:&lt;/p&gt;

&lt;p&gt;i)  Please call close() at places wherever your are trying to read and write ZipFile  JarFile or aQute&apos;s  Analyzer , ZipResource , Jar class files from &lt;br/&gt;
                  biz/aQute/bndlib/0.0.255/.. /OSGI-OPT/src/aQute/lib/osgi&lt;br/&gt;
    And also at &lt;/p&gt;

&lt;p&gt;                 org/apache/maven/shared/maven-osgi/0.2.0/tt/org/apache/maven/shared/osgi/DefaultMaven2OsgiConverter.java&lt;/p&gt;

&lt;p&gt;ii) At    org/apache/felix/bundleplugin/BundlePlugin.java&lt;/p&gt;

&lt;p&gt;         where  where &quot;classpath&quot; variable is actually an Array of Jar files that need to closed upon task is done.&lt;br/&gt;
        Note that  the Jar here is from aQute and it has got resource map. So each Jar object might have recursive resources. So, please walk through the map &lt;br/&gt;
       and close each resource if it is  FileResource/ JarResource / ZipResource.&lt;/p&gt;


&lt;p&gt;iii)   At    org/apache/felix/bundleplugin/BundlePlugin.java&lt;br/&gt;
       I also suspect the place in the same BundlePlugin.java,  where we  call unpackBundle(...) and call  ManifestPlugin.writeManifest(... , ..)&lt;br/&gt;
       Please make sure the streams are closed.&lt;/p&gt;

&lt;p&gt;&amp;#8211; A generic message.&lt;br/&gt;
We need this very urgently.  We appreciate your timely action.  Any comments, questions please send it to me directly.&lt;br/&gt;
I can work with you to provide the fix and verify the fix.&lt;/p&gt;

&lt;p&gt;Many thanks in advance.&lt;/p&gt;

&lt;p&gt;Harsha&lt;/p&gt;</description>
                <environment>maven 2&lt;br/&gt;
jdk 5 or 6 &lt;br/&gt;
any OS where JDK is supported</environment>
        <key id="12401739">FELIX-661</key>
            <summary>maven bundle plugin does not close the accessed fie /jar streams</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mcculls">Stuart McCulloch</assignee>
                                    <reporter username="hg2008">Harsha Godugu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Aug 2008 22:57:36 +0000</created>
                <updated>Wed, 27 Aug 2008 10:50:16 +0000</updated>
                            <resolved>Wed, 6 Aug 2008 17:55:42 +0000</resolved>
                                    <version>maven-bundle-plugin-1.4.2</version>
                                    <fixVersion>maven-bundle-plugin-1.4.3</fixVersion>
                                    <component>Maven Bundle Plugin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12620081" author="hg2008" created="Tue, 5 Aug 2008 23:03:28 +0000"  >&lt;p&gt;Please take a look at the following bug for more information:&lt;br/&gt;
&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6713913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6713913&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12620127" author="mcculls" created="Wed, 6 Aug 2008 03:57:11 +0000"  >&lt;p&gt;This issue relates mostly to code in Bnd, so setting fix target to 1.4.3 where we plan to upgrade Bnd.&lt;/p&gt;</comment>
                            <comment id="12620128" author="mcculls" created="Wed, 6 Aug 2008 04:06:17 +0000"  >&lt;p&gt;A couple of questions:&lt;/p&gt;

&lt;p&gt;  1)  is there a publicly available testcase I can use to recreate this problem?  (I&apos;ve never seen it before on any Windows/Mac/Linux build)&lt;/p&gt;

&lt;p&gt;  2)  you set the affected version to 1.4.2 (which isn&apos;t released yet)  -  does the same problem occur with 1.4.1 and 1.4.0?&lt;/p&gt;

&lt;p&gt;thanks in advance - please note that I will be away for the next few weeks until 24th August.&lt;/p&gt;</comment>
                            <comment id="12620131" author="mcculls" created="Wed, 6 Aug 2008 04:26:19 +0000"  >&lt;p&gt;&amp;gt; Maven bundle plugin is doing the following.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; i) When someone (from a pom.xml) uses this plug-in, to bundlize their project jars, this plugin first opens a jar file for reading. And then later after in some other method call, it opens the SAME file for writing. Basically it dynamically changes the content of the jar for reading and writing.&lt;/p&gt;

&lt;p&gt;Could you be a bit clearer about which jarfile is being read and written - Bnd actually does most of the building of the bundle in memory, and only writes this out to &quot;target/classes&quot; when that particular build is complete. This file is then installed to the local repository, and subsequent builds in the Maven reactor will either use the file from the local repository, or the one in &quot;target/classes&quot; which is at that point no longer being written.&lt;/p&gt;

&lt;p&gt;There is some potential for confusion, because the Bnd Jar class can actually work off a jarfile, a directory, or its own internal storage (memory) - so not all the places you mention technically need to be closed, because for some of them there is no underlying jarfile to close. However, it is definitely good practice to be consistent and call close in all places where we&apos;re done with that Bnd Jar object &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; ii) This plugin forgets to call the close() method on the file / zip/jar/ resource of jdk and aQute packages.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; How to fix:&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; i) Please call close() at places wherever your are trying to read and write ZipFile JarFile or aQute&apos;s Analyzer , ZipResource , Jar class files from&lt;br/&gt;
&amp;gt;                   biz/aQute/bndlib/0.0.255/.. /OSGI-OPT/src/aQute/lib/osgi&lt;/p&gt;

&lt;p&gt;could you work with Peter Kriens (&lt;a href=&quot;http://aqute.biz/Code/Bnd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://aqute.biz/Code/Bnd&lt;/a&gt;) to get the appropriate fixes into Bnd?  then we can pick up the new Bnd library in the next release.&lt;/p&gt;

&lt;p&gt;&amp;gt;     And also at&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt;                  org/apache/maven/shared/maven-osgi/0.2.0/tt/org/apache/maven/shared/osgi/DefaultMaven2OsgiConverter.java&lt;/p&gt;

&lt;p&gt;this will need to be handled by the Maven team - contact Carlos Sanchez (carlos@apache.org) or raise an issue at &lt;a href=&quot;http://jira.codehaus.org/browse/MSHARED&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/MSHARED&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; ii) At org/apache/felix/bundleplugin/BundlePlugin.java&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt;          where where &quot;classpath&quot; variable is actually an Array of Jar files that need to closed upon task is done.&lt;br/&gt;
&amp;gt;         Note that the Jar here is from aQute and it has got resource map. So each Jar object might have recursive resources. So, please walk through the map&lt;br/&gt;
&amp;gt;        and close each resource if it is FileResource/ JarResource / ZipResource.&lt;/p&gt;

&lt;p&gt;well we can definitely loop through the array and call close on the jars, but will need to rely on Bnd to close the internal resource map.&lt;/p&gt;

&lt;p&gt;&amp;gt; iii) At org/apache/felix/bundleplugin/BundlePlugin.java&lt;br/&gt;
&amp;gt;        I also suspect the place in the same BundlePlugin.java, where we call unpackBundle(...) and call ManifestPlugin.writeManifest(... , ..)&lt;br/&gt;
&amp;gt;        Please make sure the streams are closed.&lt;/p&gt;

&lt;p&gt;unpackBundle uses the Maven archiver component, which does close the stream - similarly writeManifest closes its stream with a finally block.&lt;/p&gt;

&lt;p&gt;&amp;gt; &amp;#8211; A generic message.&lt;br/&gt;
&amp;gt; We need this very urgently. We appreciate your timely action. Any comments, questions please send it to me directly.&lt;br/&gt;
&amp;gt; I can work with you to provide the fix and verify the fix.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Many thanks in advance.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Harsha&lt;/p&gt;</comment>
                            <comment id="12620145" author="sahoo" created="Wed, 6 Aug 2008 06:06:43 +0000"  >&lt;p&gt;To reproduce, follow the instructions below:&lt;br/&gt;
svn co &lt;a href=&quot;https://svn.dev.java.net/svn/glassfish-svn/trunk/v3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.dev.java.net/svn/glassfish-svn/trunk/v3&lt;/a&gt;&lt;br/&gt;
mvn clean install -f v3/pom.xml&lt;/p&gt;

&lt;p&gt;Run the above mvn command in a loop, you shall eventually hit the issue.&lt;/p&gt;</comment>
                            <comment id="12620185" author="mcculls" created="Wed, 6 Aug 2008 09:27:54 +0000"  >&lt;p&gt;Ok, here&apos;s my proposed plan:&lt;/p&gt;

&lt;p&gt;1.4.2 has already been cut and the release vote is in progress, so because this issue existed in earlier releases I don&apos;t see any reason to abort this release (because that wouldn&apos;t save any time in fixing this problem) - so I&apos;ll release 1.4.2 once the vote ends.&lt;/p&gt;

&lt;p&gt;In the meantime I&apos;m running the failing build on various machines (although I have yet to recreate the failure) - once I receive the patches I will review them and make the necessary commits to the bundleplugin. The other components, such as Bnd, can be temporarily patched by adding the patched source directly to the bundleplugin build - this will be removed when we update Bnd.&lt;/p&gt;

&lt;p&gt;The patched bundleplugin will become 1.4.3, and the next stable release with the new version of Bnd will become 1.6.0 - this is because the Bnd tool now requires Java5 which is a potentially big change, so we should reflect that in the bundleplugin version.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="12620262" author="mcculls" created="Wed, 6 Aug 2008 14:18:22 +0000"  >&lt;p&gt;Although I haven&apos;t been able to reproduce the build failure, I have been running some diagnostics and believe that most of the problems are due to omissions in the bundleplugin code - the Bnd library will close all the classpath zipfiles if we call the close method on the builder/analyzer instance.&lt;/p&gt;

&lt;p&gt;I have some initial patches, which I&apos;m currently testing to check that all opened zipfiles are eventually closed - hopefully this will resolve the issue.&lt;/p&gt;</comment>
                            <comment id="12620303" author="mcculls" created="Wed, 6 Aug 2008 16:20:34 +0000"  >&lt;p&gt;I&apos;ve committed an initial round of patches - mostly to the bundleplugin, plus one minor Bnd patch - that should fix the problem in the GlassFish build.&lt;/p&gt;</comment>
                            <comment id="12620321" author="mcculls" created="Wed, 6 Aug 2008 17:05:11 +0000"  >&lt;p&gt;I&apos;ve opened &lt;a href=&quot;http://jira.codehaus.org/browse/MSHARED-53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/MSHARED-53&lt;/a&gt; for the JarFile leak in the Maven shared component.&lt;/p&gt;</comment>
                            <comment id="12620351" author="mcculls" created="Wed, 6 Aug 2008 17:55:42 +0000"  >&lt;p&gt;OK, I think I&apos;ve nailed down all the missing close statements - when I run an instrumented plugin against the GlassFish build I now see that every ZipFile and JarFile opened, is also closed.&lt;/p&gt;

&lt;p&gt;Could you try the 1.4.3-SNAPSHOT that I&apos;ve just deployed and see if it fixes the problem on your build machines (I&apos;ve still been unable to recreate the original failure on my local machines)&lt;/p&gt;

&lt;p&gt;   &lt;a href=&quot;http://people.apache.org/repo/m2-snapshot-repository/org/apache/felix/maven-bundle-plugin/1.4.3-SNAPSHOT/maven-bundle-plugin-1.4.3-20080806.174605-1.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/repo/m2-snapshot-repository/org/apache/felix/maven-bundle-plugin/1.4.3-SNAPSHOT/maven-bundle-plugin-1.4.3-20080806.174605-1.jar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;please let me know asap if this snapshot works without error across your build machines, so I can start the release process.&lt;/p&gt;</comment>
                            <comment id="12620355" author="hg2008" created="Wed, 6 Aug 2008 18:03:35 +0000"  >&lt;p&gt;Hi Stuart,&lt;/p&gt;

&lt;p&gt;Thanks a lot for the quick response. I&apos;m in Pacific time zone.  I&apos;m going through your comments and other emails. I will download the latest bundle plugin and try to test this bug.&lt;/p&gt;

&lt;p&gt;More later. Stay tuned.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Harsha&lt;/p&gt;</comment>
                            <comment id="12620357" author="mcculls" created="Wed, 6 Aug 2008 18:10:33 +0000"  >&lt;p&gt;No problem, it&apos;s 2am over here so I&apos;m off to bed for a few hours sleep - let me know how the testing goes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12620451" author="hg2008" created="Wed, 6 Aug 2008 22:18:59 +0000"  >&lt;p&gt;Hi Stuart,&lt;/p&gt;

&lt;p&gt;First, many many thanks for providing the 1.4.3-xx maven-bundle-plugin snapshot.&lt;/p&gt;

&lt;p&gt;I&apos;ve locally used your jar in a local build system. Mostly it was like an off line build to just use the supplied jar here.&lt;br/&gt;
Good news is that, the bug is gone.&lt;br/&gt;
(One question: . Was there a debug line or version verification string in this jar to check during runtime?)&lt;/p&gt;

&lt;p&gt;Please wait for some more time. We are planning to use the provided jar here in our build system where we hit the bug very badly.&lt;br/&gt;
We just changed our parent pom to use your plug-in from :&lt;br/&gt;
   &lt;a href=&quot;http://people.apache.org/repo/m2-snapshot-repository&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/repo/m2-snapshot-repository&lt;/a&gt;&lt;br/&gt;
This will be online build.&lt;/p&gt;

&lt;p&gt;This is just an update. I will provide more to confirm if the fix is working. Thanks!&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Harsha&lt;/p&gt;</comment>
                            <comment id="12620488" author="mcculls" created="Thu, 7 Aug 2008 00:41:13 +0000"  >&lt;p&gt;Hi Harsha, excellent news - btw, although there isn&apos;t an explicit version string in the normal snapshot plugin output, you can use the -X Maven option to enable debug trace. The plugin version should appear in the trace output (you&apos;ll need to pipe this to a file because it will produce a lot of output). HTH&lt;/p&gt;</comment>
                            <comment id="12620494" author="hg2008" created="Thu, 7 Aug 2008 01:52:01 +0000"  >&lt;p&gt;Hi Stuart,  We need another 8-10Hrs (max) to test the jar.  The bits are now injected into the system.  Thanks!!&lt;br/&gt;
-Harsha&lt;/p&gt;</comment>
                            <comment id="12620677" author="hg2008" created="Thu, 7 Aug 2008 17:10:56 +0000"  >&lt;p&gt;Hi Stuart, &lt;/p&gt;

&lt;p&gt;I confirm that the fix works great.  &lt;/p&gt;

&lt;p&gt;Thank a lot for your very swift response and action on this issue.&lt;/p&gt;

&lt;p&gt;Please add this fix your next (1.4.3?) release.   &lt;br/&gt;
Currently, we are using :     &lt;br/&gt;
                            &lt;a href=&quot;http://people.apache.org/repo/m2-snapshot-repository/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/repo/m2-snapshot-repository/&lt;/a&gt; &lt;br/&gt;
org/apache/felix/maven-bundle-plugin/ &lt;br/&gt;
1.4.3-SNAPSHOT/maven-bundle-plugin-1.4.3-20080806.174605-1.jar&lt;/p&gt;

&lt;p&gt;Would you be able to keep it intact at that location. (until 1.4.3 ) is out.&lt;/p&gt;

&lt;p&gt;It also seems like we need to follow up with BND too.  I will check with them.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Harsha&lt;br/&gt;
GlassFish v3 team&lt;/p&gt;</comment>
                            <comment id="12620683" author="mcculls" created="Thu, 7 Aug 2008 17:20:53 +0000"  >&lt;p&gt;Cool - yes, this fix will be in the 1.4.3 release (I will cut this release very soon and begin the release vote)&lt;br/&gt;
Also, the plugin snapshot will stay intact at that location - we typically don&apos;t overwrite or delete snapshots.&lt;/p&gt;</comment>
                            <comment id="12626066" author="mcculls" created="Wed, 27 Aug 2008 10:50:16 +0000"  >&lt;p&gt;Fixed in latest release of the maven-bundle-plugin (1.4.3)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58328</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vwb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184207</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>