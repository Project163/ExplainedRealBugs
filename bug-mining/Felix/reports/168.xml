<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:06:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-536] Threadlocks on ContentClassLoader by FelixDispatchQueue and FelixStartLevel threads when using log bundles</title>
                <link>https://issues.apache.org/jira/browse/FELIX-536</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Sometimes Felix gets stuck at startup with a threadlock when using a log bundle,  including the Felix provided log bundle.&lt;/p&gt;

&lt;p&gt;jdb reveals the following information:&lt;/p&gt;

&lt;p&gt;FelixDispatchQueue&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; threadlocks 0x3c1&lt;br/&gt;
Monitor information for thread FelixDispatchQueue:&lt;br/&gt;
  Owned monitor: instance of org.apache.felix.framework.searchpolicy.ContentClassLoader(id=970)&lt;br/&gt;
   Waiting for monitor: instance of org.apache.felix.moduleloader.ModuleFactoryImpl(id=971)&lt;/p&gt;

&lt;p&gt;FelixDispatchQueue&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; threadlocks 0x3c0&lt;br/&gt;
Monitor information for thread FelixStartLevel:&lt;br/&gt;
  Owned monitor: instance of org.apache.felix.moduleloader.ModuleFactoryImpl(id=971)&lt;br/&gt;
   Waiting for monitor: instance of org.apache.felix.framework.searchpolicy.ContentClassLoader(id=970)&lt;/p&gt;

&lt;p&gt;FelixStartLevel&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; where&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; sun.misc.Unsafe.defineClass (native method)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; sun.reflect.ClassDefiner.defineClass (ClassDefiner.java:45)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; sun.reflect.MethodAccessorGenerator$1.run (MethodAccessorGenerator.java:381)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; java.security.AccessController.doPrivileged (native method)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; sun.reflect.MethodAccessorGenerator.generate (MethodAccessorGenerator.java:377)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt; sun.reflect.MethodAccessorGenerator.generateMethod (MethodAccessorGenerator.java:59)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;7&amp;#93;&lt;/span&gt; sun.reflect.NativeMethodAccessorImpl.invoke (NativeMethodAccessorImpl.java:28)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;8&amp;#93;&lt;/span&gt; sun.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;9&amp;#93;&lt;/span&gt; java.lang.reflect.Method.invoke (Method.java:585)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;10&amp;#93;&lt;/span&gt; org.apache.felix.framework.Logger._logReflectively (Logger.java:163)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;11&amp;#93;&lt;/span&gt; org.apache.felix.framework.Logger._log (Logger.java:143)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;12&amp;#93;&lt;/span&gt; org.apache.felix.framework.Logger.log (Logger.java:81)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;13&amp;#93;&lt;/span&gt; org.apache.felix.framework.searchpolicy.R4SearchPolicyCore.createWires (R4SearchPolicyCore.java:2,154)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;14&amp;#93;&lt;/span&gt; org.apache.felix.framework.searchpolicy.R4SearchPolicyCore.resolve (R4SearchPolicyCore.java:1,034)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;15&amp;#93;&lt;/span&gt; org.apache.felix.framework.Felix._resolveBundle (Felix.java:1,693)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;16&amp;#93;&lt;/span&gt; org.apache.felix.framework.Felix._startBundle (Felix.java:1,566)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;17&amp;#93;&lt;/span&gt; org.apache.felix.framework.Felix.startBundle (Felix.java:1,519)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;18&amp;#93;&lt;/span&gt; org.apache.felix.framework.Felix.setFrameworkStartLevel (Felix.java:1,104)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;19&amp;#93;&lt;/span&gt; org.apache.felix.framework.StartLevelImpl.run (StartLevelImpl.java:258)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;20&amp;#93;&lt;/span&gt; java.lang.Thread.run (Thread.java:613)&lt;/p&gt;


&lt;p&gt;FelixDispatchQueue&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; where&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; org.apache.felix.framework.searchpolicy.R4SearchPolicyCore.resolve (R4SearchPolicyCore.java:989)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; org.apache.felix.framework.searchpolicy.R4SearchPolicyCore.findClassOrResource (R4SearchPolicyCore.java:374)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; org.apache.felix.framework.searchpolicy.R4SearchPolicyCore.findClass (R4SearchPolicyCore.java:186)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; org.apache.felix.framework.searchpolicy.R4SearchPolicy.findClass (R4SearchPolicy.java:45)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; org.apache.felix.framework.searchpolicy.ContentClassLoader.loadClass (ContentClassLoader.java:109)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt; java.lang.ClassLoader.loadClass (ClassLoader.java:251)&lt;br/&gt;
  &lt;span class=&quot;error&quot;&gt;&amp;#91;7&amp;#93;&lt;/span&gt; java.lang.ClassLoader.loadClassInternal (ClassLoader.java:374)&lt;/p&gt;

&lt;p&gt;I have been reading &lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/dev@felix.apache.org/msg03142.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/dev@felix.apache.org/msg03142.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But I think that it does not really provide a &quot;solution&quot; to this problem and that this is an issue in the framework implementation. I don&apos;t think that the specification of the LogService implies that it cannot be configurable or loading any classes.....&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Dieter&lt;/p&gt;


</description>
                <environment>1.6.0_03-b05;Sun Microsystems Inc.;mixed mode, sharing;Linux;32 bit JVM&lt;br/&gt;
and&lt;br/&gt;
1.5.0_13-119;Apple Inc.;mixed mode, sharing;Mac OS X;32 bit JVM&lt;br/&gt;
</environment>
        <key id="12393839">FELIX-536</key>
            <summary>Threadlocks on ContentClassLoader by FelixDispatchQueue and FelixStartLevel threads when using log bundles</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karlpauls">Karl Pauls</assignee>
                                    <reporter username="wimpi">Dieter Wimberger</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Apr 2008 18:33:12 +0000</created>
                <updated>Mon, 14 Apr 2008 06:12:13 +0000</updated>
                            <resolved>Sun, 13 Apr 2008 21:25:44 +0000</resolved>
                                    <version>framework-1.0.3</version>
                                    <fixVersion>framework-1.0.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12588411" author="karlpauls" created="Sun, 13 Apr 2008 18:51:14 +0000"  >&lt;p&gt;Well, for now the workaround is to set the following in conf/config.properties:&lt;/p&gt;

&lt;p&gt;felix.log.level=3&lt;/p&gt;</comment>
                            <comment id="12588436" author="karlpauls" created="Sun, 13 Apr 2008 21:25:44 +0000"  >&lt;p&gt;The issue is that we log messages while holding framework internal locks &amp;#8211; hence, when a log service calls back into the framework (e.g., by loading a class) we might deadlock. This is one instance of this problem. &lt;/p&gt;

&lt;p&gt;I disabled logging to internal log services - we can reintroduce this feature at a later time but - for now it is clear that people keep running into this issue and all we are trying is to be nice. &lt;/p&gt;

&lt;p&gt;Please close this issue if the current trunk works for you.&lt;/p&gt;</comment>
                            <comment id="12588463" author="wimpi" created="Mon, 14 Apr 2008 01:28:29 +0000"  >&lt;p&gt;Karl:&lt;/p&gt;

&lt;p&gt;I actually reported this problem, because I was trying to understand the wiring process, with the help of the log messages that are turned off with the workaround and now disabled in the trunk.&lt;/p&gt;

&lt;p&gt;In particular, what would you suggest to use for debugging to figure out why bundles with a Manifest Header that includes an ExecutionEnvironment specification&lt;br/&gt;
(i.e. Bundle-RequiredExecutionEnvironment=J2SE-1.5) needs to explicitly import certain packages like for example:&lt;br/&gt;
javax.xml.parsers&lt;br/&gt;
org.xml.sax.helpers&lt;/p&gt;

&lt;p&gt;If not imported explicitly, ClassNotFoundExceptions are thrown.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Dieter&lt;/p&gt;</comment>
                            <comment id="12588477" author="mcculls" created="Mon, 14 Apr 2008 04:10:50 +0000"  >&lt;p&gt;From what I understand, setting Bundle-RequiredExecutionEnvironment (section 3.3 of the spec) is just a way to declare your bundle needs a subset of those Execution Environments to function - so if a framework doesn&apos;t support them then you get a BundleException when you try to install / update.&lt;/p&gt;

&lt;p&gt;It does not mean you can avoid having to import any non-java.* packages that you use. Packages like javax.xml.parsers and org.xml.sax.helpers would still need to be explicitly imported, unless you set the &quot;org.osgi.framework.bootdelegation&quot; property to delegate their lookup to the boot classloader - although by using bootdelegation you are limiting your ability to replace the JDK implementations or have different versions loaded simultaneously.&lt;/p&gt;</comment>
                            <comment id="12588486" author="wimpi" created="Mon, 14 Apr 2008 05:47:08 +0000"  >&lt;p&gt;Stuart:&lt;/p&gt;

&lt;p&gt;I guess I have to agree, but I think it&apos;s a bit counter-intuitive.&lt;/p&gt;

&lt;p&gt;The question that remains open is, whether there is a way to debug classloading and wiring if these debugs are simply turned off.&lt;/p&gt;

&lt;p&gt;Maybe there should be a way to log these without depending on the presence of an special (because it will need to avoid the deadlocks) LogService (which is part of the compendium, not the core specs).&lt;/p&gt;

&lt;p&gt;But then, that may be a new feature request, so I better close this issue.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Dieter&lt;/p&gt;
</comment>
                            <comment id="12588487" author="karlpauls" created="Mon, 14 Apr 2008 06:12:12 +0000"  >&lt;p&gt;You can still receive wiring debug messages. They are send to System.out if the debug level is 4. Furthermore, Felix accepts a Logger in it&apos;s constructor which it will log to in case stdout is not an option.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 33 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vwdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184218</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>