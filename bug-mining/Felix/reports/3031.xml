<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:12:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5942] Felix Framework freezes when resolving classes in parallel with Java 10</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5942</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Hello.&lt;/p&gt;

&lt;p&gt;When resolving a class in parallel in Java 10, you end up with a freeze.&lt;/p&gt;

&lt;p&gt;You end up with threads beeing blocked&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Thread-99&quot; #121 prio=5 os_prio=0 tid=0x000001bdaf679000 nid=0x69d4 in Object.wait()  [0x000000296d0fe000]
   java.lang.Thread.State: BLOCKED (on object monitor)
	at java.lang.Object.wait(java.base@10.0.2/Native Method)
	- waiting on &amp;lt;0x00000006c931dd20&amp;gt; (a [Ljava.lang.Object;)
	at java.lang.Object.wait(java.base@10.0.2/Object.java:328)
	at org.apache.felix.framework.Felix.acquireGlobalLock(Felix.java:4301)
	- waiting to re-lock in wait() &amp;lt;0x00000006c931dd20&amp;gt; (a [Ljava.lang.Object;)
	at org.apache.felix.framework.StatefulResolver.resolve(StatefulResolver.java:413)
	at org.apache.felix.framework.Felix.resolveBundleRevision(Felix.java:3318)
	at org.apache.felix.framework.Felix.loadBundleClass(Felix.java:1618)
	at org.apache.felix.framework.BundleImpl.loadClass(BundleImpl.java:978)
	at org.apache.felix.framework.ConcurrentClassLoaderTest$1.run(ConcurrentClassLoaderTest.java:69)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You&apos;ll find attached a test reproducing the issue :&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12941048/12941048_ConcurrentClassLoaderTest.java&quot; title=&quot;ConcurrentClassLoaderTest.java attached to FELIX-5942&quot;&gt;ConcurrentClassLoaderTest.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Here&apos;s what you need to freeze felix :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Lots of threads trying to acquire the global lock
	&lt;ul&gt;
		&lt;li&gt;here we&apos;re resolving a class from a bundle with dynamic import packages&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;An Oracle&#160;JDK 10 or OpenJDK 11
	&lt;ul&gt;
		&lt;li&gt;it&apos;s working fine with Oracle JDK 8&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Replacing the &lt;tt&gt;m_bundleLock&lt;/tt&gt; by a fair&#160;&lt;tt&gt;ReentrantLock&lt;/tt&gt; with a &lt;tt&gt;Condition&lt;/tt&gt; makes it work with 10 parallel threads but still fails with 100 threads.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13187038">FELIX-5942</key>
            <summary>Felix Framework freezes when resolving classes in parallel with Java 10</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karlpauls">Karl Pauls</assignee>
                                    <reporter username="antoine.dessaigne">Antoine DESSAIGNE</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Sep 2018 13:39:05 +0000</created>
                <updated>Thu, 31 Jan 2019 13:08:52 +0000</updated>
                            <resolved>Mon, 24 Sep 2018 18:38:16 +0000</resolved>
                                    <version>framework-6.0.1</version>
                                    <fixVersion>framework-6.0.2</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16625843" author="karlpauls" created="Mon, 24 Sep 2018 13:47:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=antoine.dessaigne&quot; class=&quot;user-hover&quot; rel=&quot;antoine.dessaigne&quot;&gt;antoine.dessaigne&lt;/a&gt;, can you clarify what this part means:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;An Oracle Java 10
	&lt;ul&gt;
		&lt;li&gt;with an OpenJDK 11 it&apos;s not working&lt;/li&gt;
		&lt;li&gt;with an Oracle Java 8 it&apos;s working&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;what is working on what version and is not working on which version?&lt;/p&gt;</comment>
                            <comment id="16625846" author="antoine.dessaigne" created="Mon, 24 Sep 2018 13:49:32 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karlpauls&quot; class=&quot;user-hover&quot; rel=&quot;karlpauls&quot;&gt;karlpauls&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Sure &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;with Oracle JDK 10 : freeze&lt;/li&gt;
	&lt;li&gt;with OpenJDK 11 (last early access) : freeze&lt;/li&gt;
	&lt;li&gt;with Oracle JDK 8&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16625982" author="githubbot" created="Mon, 24 Sep 2018 15:26:25 +0000"  >&lt;p&gt;GitHub user adessaigne opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/156&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5942&quot; title=&quot;Felix Framework freezes when resolving classes in parallel with Java 10&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5942&quot;&gt;&lt;del&gt;FELIX-5942&lt;/del&gt;&lt;/a&gt; - Replace wait/notify by lock/conditions in Felix to avoid freeze&lt;/p&gt;

&lt;p&gt;    Fix proposal for &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5942&quot; title=&quot;Felix Framework freezes when resolving classes in parallel with Java 10&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5942&quot;&gt;&lt;del&gt;FELIX-5942&lt;/del&gt;&lt;/a&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5942&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FELIX-5942&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;    Instead of a single `Object` with calls to `wait` and `notifyAll` we&apos;re using a `Lock` with 2 `Condition` objects :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;one when the waiting conditions on global lock acquisition have changed&lt;/li&gt;
	&lt;li&gt;one when the waiting conditions on bundle lock acquisition have changed&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/adessaigne/felix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/adessaigne/felix&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5942&quot; title=&quot;Felix Framework freezes when resolving classes in parallel with Java 10&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5942&quot;&gt;&lt;del&gt;FELIX-5942&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/156.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/156.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #156&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit d906ec37291bbc7d9fd4bd3211aaae0b4f9eac00&lt;br/&gt;
Author: Antoine DESSAIGNE &amp;lt;antoine.dessaigne@...&amp;gt;&lt;br/&gt;
Date:   2018-09-24T15:22:12Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5942&quot; title=&quot;Felix Framework freezes when resolving classes in parallel with Java 10&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5942&quot;&gt;&lt;del&gt;FELIX-5942&lt;/del&gt;&lt;/a&gt; - Replace wait/notify by lock/conditions in Felix to avoid freeze&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16625984" author="antoine.dessaigne" created="Mon, 24 Sep 2018 15:27:10 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karlpauls&quot; class=&quot;user-hover&quot; rel=&quot;karlpauls&quot;&gt;karlpauls&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I&apos;ve just opened the&#160;&lt;a href=&quot;https://github.com/apache/felix/pull/156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pull request #156&lt;/a&gt; with a fix proposal&lt;/p&gt;</comment>
                            <comment id="16626230" author="githubbot" created="Mon, 24 Sep 2018 18:36:41 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/156&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16626247" author="karlpauls" created="Mon, 24 Sep 2018 18:38:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=antoine.dessaigne&quot; class=&quot;user-hover&quot; rel=&quot;antoine.dessaigne&quot;&gt;antoine.dessaigne&lt;/a&gt;, it looks like newer jdk versions have a changed behaviour when it comes to fairness and synchronized. Good catch - I applied a modified version of your patch that uses only one condition but sets the the lock to be fair. It seems to work with your test. &lt;/p&gt;

&lt;p&gt;Feel free to reopen this issue if it doesn&apos;t work for you. Many thanks for reporting and providing the patch!&lt;/p&gt;</comment>
                            <comment id="16627032" author="antoine.dessaigne" created="Tue, 25 Sep 2018 09:03:46 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karlpauls&quot; class=&quot;user-hover&quot; rel=&quot;karlpauls&quot;&gt;karlpauls&lt;/a&gt;,&lt;br/&gt;
Thanks for integrating it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Do you know when the release is planned ? As JDK11 will replace JDK10 in few hours &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Thanks again.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12941048" name="ConcurrentClassLoaderTest.java" size="5592" author="antoine.dessaigne" created="Mon, 24 Sep 2018 13:47:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yf8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>