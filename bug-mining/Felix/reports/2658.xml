<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:03:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5248] SCR does not reactivate a failed component after a configuration update</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5248</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;A configurable SCR component may fail to activate by throwing an exception if the factory configuration contains bad values. If the factory configuration for that component is then updated SCR should attempt to recreate and activate the component. Instead the component sits in the &quot;satisfied&quot; state forever, and updates to the factory configuration are ignored.&lt;/p&gt;

&lt;p&gt;This makes it impossible to &quot;fix&quot; a mistaken configuration without deleting and recreating it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12964704">FELIX-5248</key>
            <summary>SCR does not reactivate a failed component after a configuration update</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djencks">David Jencks</assignee>
                                    <reporter username="timothyjward">Timothy James Ward</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 May 2016 16:22:37 +0000</created>
                <updated>Thu, 16 Mar 2017 20:06:35 +0000</updated>
                            <resolved>Thu, 16 Mar 2017 20:06:35 +0000</resolved>
                                    <version>scr-2.0.4</version>
                                    <fixVersion>scr-2.0.6</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15269101" author="djencks" created="Tue, 3 May 2016 17:06:43 +0000"  >&lt;p&gt;Can you provide more information about the scenario you are talking about?  If not a test case, at least some indication of how many components, any references, and the immediate setting.  Also more information about the sequence of events you&apos;d like to have happen.&lt;/p&gt;

&lt;p&gt;For instance, providing the factory configuration to a component that provides a service is going to register the service.  If the component isn&apos;t immediate, then we&apos;ll try to create the service when someone asks for it.  If the configuration changes, someone has to ask for it again in order for it to get created.  If you are using the lookup strategy or the event strategy with ServiceReference, you can try again whenever you want.&lt;/p&gt;</comment>
                            <comment id="15269493" author="timothyjward" created="Tue, 3 May 2016 20:12:35 +0000"  >&lt;p&gt;Hi David,&lt;/p&gt;

&lt;p&gt;The component is immediate and has a configuration policy of required. It has one static reference to a service which is satisfied, an activate method which takes a bundle context, a type safe configuration object, and a map of the raw configuration. It also has a deactivate method which takes no arguments.&lt;/p&gt;

&lt;p&gt;The failure flow is as follows:&lt;/p&gt;

&lt;p&gt;1. The component&apos;s bundle is started and the referenced service is available. The configuration requirement correctly prevents activation of any component instances.&lt;br/&gt;
2. A factory configuration is created for the correct factory pid with some config properties. Occasionally one of the config properties is malformed, which the component instance detects, throwing an exception from the activate method. This correctly prevents that component instance from starting when the config is bad.&lt;br/&gt;
3. The factory configuration is then updated by the user to correct the malformed config property. At this point I do not get the behaviour I expect. I expect a component instance to be activated with the updated configuration. Instead the component sits there, ignoring the configuration update.&lt;/p&gt;

&lt;p&gt;If at this point I disable and enable the component then everything works fine, but I don&apos;t want to do that as it will disable all of the other instances created by other factory configurations. It also works if I delete the old config and create a new config, but I don&apos;t want to do that either because it&apos;s an extra set of steps for the user.&lt;/p&gt;

&lt;p&gt;I don&apos;t think that what I&apos;m asking for is illogical, although I can&apos;t find a line in the specification which says that it must work. &lt;/p&gt;

&lt;p&gt;I hope this helps. I&apos;ve tried looking through the felix SCR unit tests, but at the moment I&apos;m not entirely sure how I would write a failing test for this behaviour.&lt;/p&gt;

&lt;p&gt;Tim&lt;/p&gt;</comment>
                            <comment id="15269562" author="djencks" created="Tue, 3 May 2016 20:54:48 +0000"  >&lt;p&gt;I think this can be fixed.  I suggest we get Guillaume&apos;s refactoring in first.  A test would be an integration test, which is currently mixed into the same test folder as unit tests but run separately.  It should be fairly straightforward to write a component that throws an exception in activate depending on a config property, and to change the config back and forth a few times to see what happens.&lt;/p&gt;

&lt;p&gt;It&apos;s less clear to me how to deal with the situation where other components have a reference to the service with the intermittent problem.  Maybe we could track &quot;failed lookup&quot; links and clear them on any other service change (certainly unregistration).&lt;/p&gt;</comment>
                            <comment id="15327785" author="djencks" created="Mon, 13 Jun 2016 17:21:53 +0000"  >&lt;p&gt;I added a test that while simpler than your situation I thought would include the important parts, and currently it appears to pass.  Could you see if your original case now works properly as well, and if not see if you can figure out what is missing in my test?&lt;/p&gt;</comment>
                            <comment id="15928771" author="cziegeler" created="Thu, 16 Mar 2017 20:06:35 +0000"  >&lt;p&gt;As there has been no response for quiet some while and as David&apos;s test passes, I consider this now as fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2x407:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>