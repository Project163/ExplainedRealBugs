<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:14:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1201] Issue with DM and CM</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1201</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I am using DM for configuring my POJOs from Configuration Admin Service.&lt;br/&gt;
This issue is actually about a bug, but also ask for a change request:.&lt;/p&gt;

&lt;p&gt;1/ first, I think there are two bugs in ConfigurationDependency.java:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When the configuration is not currently available from CM, POJOs are invoked in their &quot;updated&quot; method with a null Dictionary&lt;/li&gt;
	&lt;li&gt;Morover, DM requires POJO to implement the ManagedService interface, while in the online doc, it is stated that POJOs just have&lt;br/&gt;
  to provide an &quot;updated(Dictionary)&quot; method signature.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Concerning the null dictionary passed to my updated method: for example:&lt;/p&gt;

&lt;p&gt;dm.add(createService()&lt;br/&gt;
           .setImplementation(new Log4jConfigurator(property))&lt;br/&gt;
           .add(createConfigurationDependency()&lt;br/&gt;
                .setPid(&quot;log4j&quot;)));&lt;/p&gt;

&lt;p&gt;-&amp;gt; My Pojo &quot;Log4jConfigurator&quot; is invoked in its &quot;updated&quot; method with a null Dictionary if the configuration is not yet available from CM.&lt;br/&gt;
I have attached to this issue a proposed patch (in ConfigurationDependency.java).&lt;br/&gt;
I just check if CM provides a null Dictionary and I just don&apos;t activate the dependencies ...&lt;/p&gt;


&lt;p&gt;2/ Now, there is something I would like you to add concerning configuration callbacks (I also have implemeted it in the proposed patch):&lt;br/&gt;
Indeed, by default, DM assumes that the pojo implements the org.osgi.service.cm.ManagedService interface.&lt;br/&gt;
But the point is: I need my POJOs to be reused outside OSGi; and I don&apos;t want to introduce a dependency over the OSGi CM managed service interface.&lt;br/&gt;
Moreover, I need to get injected with several PIDS.&lt;/p&gt;

&lt;p&gt;That&apos;s why I would like to be able to invoke a method &quot;setCallback&quot; in the ConfigurationDependency class (like in ServiceDependency.java).&lt;br/&gt;
This callback would match a method which takes as parameter a Dictionary.&lt;br/&gt;
So, adding such setCallback method would also let me listen to more than one PID like this:&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;    dm.add(createService()&lt;br/&gt;
           .setImplementation(new Log4jConfigurator(property))&lt;br/&gt;
           .add(createConfigurationDependency()&lt;br/&gt;
                .setPid(&quot;log4j&quot;)&lt;br/&gt;
                .setCallback(&quot;updateLog4jConfig&quot;))&lt;br/&gt;
           .add(createConfigurationDependency()&lt;br/&gt;
                .setPid(&quot;system&quot;)&lt;br/&gt;
                .setCallback(&quot;updateSystemConfig&quot;)));&lt;/p&gt;

&lt;p&gt;The patch attached to this issue sounds like to work fine.&lt;/p&gt;

&lt;p&gt;Marcel, WDYT ? &lt;br/&gt;
Could you please commit this patch (and then make a new release of DM) ?&lt;/p&gt;

&lt;p&gt;Thanks a lot for your help;&lt;br/&gt;
/pierre&lt;/p&gt;</description>
                <environment>linux FC10, jdk 1.5, 1.6</environment>
        <key id="12427274">FELIX-1201</key>
            <summary>Issue with DM and CM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marrs">Marcel Offermans</assignee>
                                    <reporter username="pderop">Pierre De Rop</reporter>
                        <labels>
                    </labels>
                <created>Sat, 6 Jun 2009 08:52:05 +0000</created>
                <updated>Tue, 10 May 2011 08:31:35 +0000</updated>
                            <resolved>Mon, 16 Nov 2009 07:42:46 +0000</resolved>
                                    <version>dependencymanager-2.0.1</version>
                                                    <component>Dependency Manager</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12716852" author="pderop" created="Sat, 6 Jun 2009 08:54:37 +0000"  >&lt;p&gt;attached the proposed patch.&lt;/p&gt;</comment>
                            <comment id="12735248" author="marrs" created="Sat, 25 Jul 2009 08:37:02 +0000"  >&lt;p&gt;Regarding invoking the updated() method with a null argument, I agree, that is a bug, it should not activate the dependencies. It&apos;s safe to assume that if someone requires a configuration, the configuration actually needs to contain at least something.&lt;/p&gt;

&lt;p&gt;I have some doubts about the second part. I like the fact that you don&apos;t need to implement ManagedService anymore (even though you can argue about that being an &quot;OSGi dependency&quot;, you could view that as just an interface to deal with configurability of a POJO, but I see your point)&lt;/p&gt;

&lt;p&gt;Getting injected with multiple configurations in OSGi is no real issue, all configurations can go to the same updated() method because each configuration will contain a service.pid which allows you to recognize which configuration it actually is. However, I can see the value of having the option to redirect those to different methods.&lt;/p&gt;

&lt;p&gt;What I don&apos;t like is the way the updated() signature is changed. Currently it throws ConfigurationException which allows you to explicitly tell the system what property you don&apos;t like and why. In the proposed patch, that exception gets lost. I would at least want to change that in such a way that these exceptions do not get lost, and I think that is possible. The &quot;general&quot; signature could become &quot;updated(Dictionary props) throws Exception&quot; since the JavaDocs of the spec actually state that any exception other than ConfigurationException should be caught and logged by ConfigurationAdmin anyway (we might have to check if implementations actually do this, but other than that we&apos;re fine).&lt;/p&gt;

&lt;p&gt;So, with a few changes, I think I can apply the patch. WDYT? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12744764" author="pderop" created="Tue, 18 Aug 2009 22:45:53 +0000"  >&lt;p&gt;You are definitely right: -&amp;gt; my patch introduced a bug regarding the ConfigurationException.&lt;br/&gt;
I have attached to this issue a second patch which takes into acount your remark.&lt;br/&gt;
The patch does the following:&lt;/p&gt;

&lt;p&gt;1) if the callback method throws a org.osgi.service.cm.ConfigurationException -&amp;gt; then this exception is just re-thrown. This use case applies when the Pojo implements directly the&lt;br/&gt;
OSGi ManagedService interface.&lt;/p&gt;

&lt;p&gt;2) if the callback method throws any other exception (java.lang.Exception, or whatever RuntimeException, like IllegalArgumentException) -&amp;gt; then it is simply wrapped as a ConfigurationException.&lt;/p&gt;

&lt;p&gt;Hope that all is Ok for you.&lt;/p&gt;


</comment>
                            <comment id="12744766" author="pderop" created="Tue, 18 Aug 2009 22:47:53 +0000"  >&lt;p&gt;added the second patch ...&lt;/p&gt;</comment>
                            <comment id="12763188" author="marrs" created="Wed, 7 Oct 2009 18:48:12 +0000"  >&lt;p&gt;Applied the patch.&lt;/p&gt;</comment>
                            <comment id="12777966" author="pderop" created="Sat, 14 Nov 2009 16:54:07 +0000"  >&lt;p&gt;Issue re-opened.&lt;/p&gt;

&lt;p&gt;Indeed, in the previous patch, I forgot to remove the java language access check, before invoking the callback.&lt;br/&gt;
in the attached patch, I just call &quot;setAccessible(true)&quot; on the callback method, just before invoking it.&lt;/p&gt;</comment>
                            <comment id="12777967" author="pderop" created="Sat, 14 Nov 2009 16:55:59 +0000"  >&lt;p&gt;see patch in ConfigurationDependency-3.java&lt;/p&gt;</comment>
                            <comment id="12778239" author="marrs" created="Mon, 16 Nov 2009 07:42:46 +0000"  >&lt;p&gt;Applied the setAccessible(true) patch.&lt;/p&gt;</comment>
                            <comment id="13031082" author="marrs" created="Tue, 10 May 2011 08:31:35 +0000"  >&lt;p&gt;Part of the 3.0.0 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12416929" name="ConfigurationDependency-2.java" size="7855" author="pderop" created="Tue, 18 Aug 2009 22:47:52 +0000"/>
                            <attachment id="12424966" name="ConfigurationDependency-3.java" size="7706" author="pderop" created="Sat, 14 Nov 2009 16:55:59 +0000"/>
                            <attachment id="12410057" name="ConfigurationDependency.java" size="7042" author="pderop" created="Sat, 6 Jun 2009 08:54:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57817</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1arrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>270964</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>