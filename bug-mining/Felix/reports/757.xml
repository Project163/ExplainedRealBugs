<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:14:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1642] osgi:shutdown just hang when use karaf-client.jar</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1642</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I tried with karaf/demos/web example, all is fine, I can use java -jar lib/karaf-client.jar to connect the karaf instance deployed in servlet container,&lt;br/&gt;
osgi:list return is ok,&lt;br/&gt;
but when I try to use osgi:shutdown to quit the client, the console just hang&lt;/p&gt;</description>
                <environment></environment>
        <key id="12436569">FELIX-1642</key>
            <summary>osgi:shutdown just hang when use karaf-client.jar</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="ffang">Freeman Yue Fang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Sep 2009 08:56:35 +0000</created>
                <updated>Thu, 2 May 2013 02:29:25 +0000</updated>
                            <resolved>Fri, 30 Oct 2009 11:39:56 +0000</resolved>
                                                    <fixVersion>karaf-1.2.0</fixVersion>
                                    <component>Karaf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12759443" author="gnt" created="Fri, 25 Sep 2009 09:00:55 +0000"  >&lt;p&gt;Can you please attach thread dumps ?&lt;br/&gt;
Also, if it&apos;s easy to reproduce, try with equinox and see if it&apos;s better.  That could point to a problem in felix framework.&lt;/p&gt;</comment>
                            <comment id="12759454" author="ffang" created="Fri, 25 Sep 2009 09:17:28 +0000"  >&lt;p&gt;Hi Guillaume,&lt;/p&gt;

&lt;p&gt;Thanks for the response, as the console hang, both ctrl + \  and kill -3 pid can&apos;t get the thread dump.&lt;br/&gt;
And might be a stupid question, how to replace my framework with equinox? &lt;/p&gt;

&lt;p&gt;Freeman &lt;/p&gt;</comment>
                            <comment id="12759459" author="ffang" created="Fri, 25 Sep 2009 09:30:48 +0000"  >&lt;p&gt;Hi Guillaume,&lt;/p&gt;

&lt;p&gt;I just test it with equinox as you suggested, it&apos;s same behavior.&lt;br/&gt;
Btw, the hang is easily to reproduce, I can see this problem each time.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Freeman&lt;/p&gt;</comment>
                            <comment id="12759482" author="eglynn" created="Fri, 25 Sep 2009 10:32:33 +0000"  >&lt;p&gt;Could the client &quot;hang&quot; occur because the shutdown command is actually interpreted as &quot;shutdown the remote karaf instance&quot; as opposed to &quot;shutdown the local client&quot;?&lt;/p&gt;

&lt;p&gt;That&apos;s what I&apos;m seeing when I use a karaf-client to interact with a remote karaf instance started standalone, or launched from MOP (though not running in a servlet container as per your use-case).&lt;/p&gt;</comment>
                            <comment id="12759491" author="eglynn" created="Fri, 25 Sep 2009 11:16:36 +0000"  >&lt;p&gt;Here&apos;s a thread dump from a client after running shutdown:&lt;/p&gt;

&lt;p&gt;karaf@root&amp;gt; shutdown&lt;br/&gt;
karaf@root&amp;gt; 2009-09-25 12:12:27&lt;br/&gt;
Full thread dump Java HotSpot(TM) Server VM (14.2-b01 mixed mode):&lt;/p&gt;

&lt;p&gt;&quot;ClientInputStreamPump&quot; daemon prio=10 tid=0x8fffa800 nid=0x84a runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x8f5fe000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
	at java.io.FileInputStream.readBytes(Native Method)&lt;br/&gt;
	at java.io.FileInputStream.read(FileInputStream.java:199)&lt;br/&gt;
	at org.apache.sshd.client.channel.ChannelSession.pumpInputStream(ChannelSession.java:78)&lt;br/&gt;
	at org.apache.sshd.client.channel.ChannelSession$1.run(ChannelSession.java:50)&lt;/p&gt;

&lt;p&gt;&quot;pool-1-thread-1&quot; prio=10 tid=0x091b0800 nid=0x83f waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x8fcad000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: TIMED_WAITING (parking)&lt;br/&gt;
	at sun.misc.Unsafe.park(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;parking to wait for  &amp;lt;0xb1084c68&amp;gt; (a java.util.concurrent.SynchronousQueue$TransferStack)&lt;br/&gt;
	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)&lt;br/&gt;
	at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:424)&lt;br/&gt;
	at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:323)&lt;br/&gt;
	at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:874)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:945)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;pool-2-thread-1&quot; prio=10 tid=0x8ff1f400 nid=0x83d waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x8fcfe000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: TIMED_WAITING (parking)&lt;br/&gt;
	at sun.misc.Unsafe.park(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;parking to wait for  &amp;lt;0xb10f3890&amp;gt; (a java.util.concurrent.SynchronousQueue$TransferStack)&lt;br/&gt;
	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:198)&lt;br/&gt;
	at java.util.concurrent.SynchronousQueue$TransferStack.awaitFulfill(SynchronousQueue.java:424)&lt;br/&gt;
	at java.util.concurrent.SynchronousQueue$TransferStack.transfer(SynchronousQueue.java:323)&lt;br/&gt;
	at java.util.concurrent.SynchronousQueue.poll(SynchronousQueue.java:874)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:945)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;Low Memory Detector&quot; daemon prio=10 tid=0x08c2d800 nid=0x834 runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;/p&gt;

&lt;p&gt;&quot;CompilerThread1&quot; daemon prio=10 tid=0x08c2b800 nid=0x833 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;/p&gt;

&lt;p&gt;&quot;CompilerThread0&quot; daemon prio=10 tid=0x08c28c00 nid=0x832 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;/p&gt;

&lt;p&gt;&quot;Signal Dispatcher&quot; daemon prio=10 tid=0x08c27400 nid=0x831 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;/p&gt;

&lt;p&gt;&quot;Finalizer&quot; daemon prio=10 tid=0x08c16c00 nid=0x830 in Object.wait() &lt;span class=&quot;error&quot;&gt;&amp;#91;0x90332000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: WAITING (on object monitor)&lt;br/&gt;
	at java.lang.Object.wait(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &amp;lt;0xb16c29c8&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)&lt;br/&gt;
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:118)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0xb16c29c8&amp;gt; (a java.lang.ref.ReferenceQueue$Lock)&lt;br/&gt;
	at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:134)&lt;br/&gt;
	at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:159)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;Reference Handler&quot; daemon prio=10 tid=0x08c12000 nid=0x82f in Object.wait() &lt;span class=&quot;error&quot;&gt;&amp;#91;0x90383000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: WAITING (on object monitor)&lt;br/&gt;
	at java.lang.Object.wait(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &amp;lt;0xb16c29e8&amp;gt; (a java.lang.ref.Reference$Lock)&lt;br/&gt;
	at java.lang.Object.wait(Object.java:485)&lt;br/&gt;
	at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:116)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0xb16c29e8&amp;gt; (a java.lang.ref.Reference$Lock)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;main&quot; prio=10 tid=0x08b6f000 nid=0x829 in Object.wait() &lt;span class=&quot;error&quot;&gt;&amp;#91;0xb739d000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: WAITING (on object monitor)&lt;br/&gt;
	at java.lang.Object.wait(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &amp;lt;0xb12f34b0&amp;gt; (a java.lang.Object)&lt;br/&gt;
	at java.lang.Object.wait(Object.java:485)&lt;br/&gt;
	at org.apache.sshd.client.channel.AbstractClientChannel.waitFor(AbstractClientChannel.java:155)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0xb12f34b0&amp;gt; (a java.lang.Object)&lt;br/&gt;
	at org.apache.felix.karaf.client.Main.main(Main.java:92)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;VM Thread&quot; prio=10 tid=0x08c0e000 nid=0x82e runnable &lt;/p&gt;

&lt;p&gt;&quot;GC task thread#0 (ParallelGC)&quot; prio=10 tid=0x08b75800 nid=0x82a runnable &lt;/p&gt;

&lt;p&gt;&quot;GC task thread#1 (ParallelGC)&quot; prio=10 tid=0x08b77000 nid=0x82b runnable &lt;/p&gt;

&lt;p&gt;&quot;GC task thread#2 (ParallelGC)&quot; prio=10 tid=0x08b78800 nid=0x82c runnable &lt;/p&gt;

&lt;p&gt;&quot;GC task thread#3 (ParallelGC)&quot; prio=10 tid=0x08b79c00 nid=0x82d runnable &lt;/p&gt;

&lt;p&gt;&quot;VM Periodic Task Thread&quot; prio=10 tid=0x08c2f400 nid=0x835 waiting on condition &lt;/p&gt;

&lt;p&gt;JNI global references: 680&lt;/p&gt;

&lt;p&gt;Heap&lt;br/&gt;
 PSYoungGen      total 12800K, used 12228K [0xb09f0000, 0xb16f0000, 0xb41f0000)&lt;br/&gt;
  eden space 12288K, 95% used [0xb09f0000,0xb1561b60,0xb15f0000)&lt;br/&gt;
  from space 512K, 99% used [0xb1670000,0xb16ef800,0xb16f0000)&lt;br/&gt;
  to   space 512K, 0% used [0xb15f0000,0xb15f0000,0xb1670000)&lt;br/&gt;
 PSOldGen        total 28672K, used 108K [0x949f0000, 0x965f0000, 0xb09f0000)&lt;br/&gt;
  object space 28672K, 0% used [0x949f0000,0x94a0b000,0x965f0000)&lt;br/&gt;
 PSPermGen       total 16384K, used 5235K [0x909f0000, 0x919f0000, 0x949f0000)&lt;br/&gt;
  object space 16384K, 31% used [0x909f0000,0x90f0ce40,0x919f0000)&lt;/p&gt;</comment>
                            <comment id="12759505" author="gnt" created="Fri, 25 Sep 2009 12:14:37 +0000"  >&lt;p&gt;Shutdown will actually asks the server to shutdown the osgi framework.&lt;br/&gt;
That should also cause the client to be terminated because of the loss of connection with the ssh server somehow.&lt;br/&gt;
This thread dump is ok, as the main class is simply waiting for the client to terminate, which should happen automatically.&lt;br/&gt;
I think the prolem might be on the server side rather than the client.&lt;/p&gt;</comment>
                            <comment id="12770924" author="gnt" created="Wed, 28 Oct 2009 13:21:26 +0000"  >&lt;p&gt;The sshd issues fixes the problem, so we need to upgrade when it&apos;s released.&lt;/p&gt;</comment>
                            <comment id="12771921" author="gnt" created="Fri, 30 Oct 2009 11:39:56 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=831271&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=831271&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1642&quot; title=&quot;osgi:shutdown just hang when use karaf-client.jar&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1642&quot;&gt;&lt;del&gt;FELIX-1642&lt;/del&gt;&lt;/a&gt;: osgi:shutdown just hang when using karaf-client.jar&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
   felix/trunk/karaf/pom.xml&lt;br/&gt;
   felix/trunk/karaf/shell/ssh/src/main/java/org/apache/felix/karaf/shell/ssh/SshTerminal.java&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12436598">SSHD-43</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57386</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vr13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183352</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>