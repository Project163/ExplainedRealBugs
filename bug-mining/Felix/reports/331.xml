<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:08:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-934] Bootdelegation bug</title>
                <link>https://issues.apache.org/jira/browse/FELIX-934</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Bootdelegation does not work as supposed in 1.4.1&lt;br/&gt;
Let&apos;s say I provide the following parameter at startup org.osgi.framework.bootdelegation=org.acme.foo.bar.*&lt;/p&gt;

&lt;p&gt;Then the class org.acme.foo.bar.ClassA should be loaded by the boot classloader meanwhile org.acme.foo.ClassB should not, however currently both classes will be loaded by the boot classloader.&lt;/p&gt;

&lt;p&gt;This is due to a bug in R4SearchPolicyCore with checking if the bootdelegation should be applied for a given package:&lt;br/&gt;
if ((m_bootPkgWildcards&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;amp;&amp;amp;&lt;br/&gt;
                    (pkgName.startsWith(m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;) ||&lt;br/&gt;
                    m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.regionMatches(0, pkgName, 0, pkgName.length())))&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; (!m_bootPkgWildcards&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;amp;&amp;amp; m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.equals(pkgName)))&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;That is  m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.regionMatches(0, pkgName, 0, pkgName.length()) will pass for org.acme.foo if the bootdelegation is set for org.acme.foo.bar.* - but it should not!&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Robert&lt;/p&gt;</description>
                <environment>All</environment>
        <key id="12414566">FELIX-934</key>
            <summary>Bootdelegation bug</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="koszegir">Robert Koszegi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Feb 2009 13:23:46 +0000</created>
                <updated>Sat, 14 Feb 2009 11:44:12 +0000</updated>
                            <resolved>Fri, 13 Feb 2009 19:54:32 +0000</resolved>
                                    <version>framework-1.4.1</version>
                                    <fixVersion>framework-1.6.0</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12672649" author="rickhall" created="Wed, 11 Feb 2009 15:06:35 +0000"  >&lt;p&gt;Yes, you are correct. The condition should have been:&lt;/p&gt;

&lt;p&gt;    if ((m_bootPkgWildcards&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;amp;&amp;amp;&lt;br/&gt;
        (pkgName.startsWith(m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;) ||&lt;br/&gt;
        pkgName.regionMatches(0, m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, 0, m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.length() - 1)))&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; (!m_bootPkgWildcards&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;amp;&amp;amp; m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.equals(pkgName)))&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;This correctly checks for subpackages with &quot;startsWith()&quot; or an exact match of a wildcarded package with &quot;regionMatches()&quot;.&lt;/p&gt;

&lt;p&gt;Please close this bug if you are satisfied and thanks for reporting it!&lt;/p&gt;</comment>
                            <comment id="12673245" author="koszegir" created="Fri, 13 Feb 2009 13:09:31 +0000"  >&lt;p&gt;I tested the solution on 1.4.1 and it is not a 100% fix. &lt;/p&gt;

&lt;p&gt;The condition pkgName.regionMatches(0, m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, 0, m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.length() - 1))) will pass for any javax.pakagename because java. is always in the bootdelegation array - the result is that all javax packages will be bootdelegated, but they should not. &lt;/p&gt;

&lt;p&gt;The correct condition in my opinion is:&lt;br/&gt;
pkgName.regionMatches(0, m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, 0, m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.length())))  &lt;/p&gt;

&lt;p&gt;The -1 in the length calculation excluded the trailing period allowing unwanted matches.&lt;/p&gt;

&lt;p&gt;This is true for explicitly defined bootdelegations as well : if com.foo.* is bootdelegated then com.foobar will be as well.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Robert&lt;/p&gt;</comment>
                            <comment id="12673270" author="rickhall" created="Fri, 13 Feb 2009 15:26:16 +0000"  >&lt;p&gt;You are right, my fix is not complete, but your suggestion is also not correct. See? It isn&apos;t so easy. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Your fix will not match package &quot;foo&quot; against &quot;foo.*&quot;, since it will compare &quot;foo&quot; to &quot;foo.&quot;, which is the case my original patch is trying to get. The mistake I made, is that we only want to do the regionMatches() if the package names are the same length, otherwise we get the bug you discovered (i.e., my original fix matches &quot;foo&quot; with &quot;foo.&quot;, but also &quot;foop&quot; with &quot;foo.&quot;).&lt;/p&gt;

&lt;p&gt;So, the actual fix should be:&lt;/p&gt;

&lt;p&gt;                if ((m_bootPkgWildcards&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;amp;&amp;amp;&lt;br/&gt;
                    (pkgName.startsWith(m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;) ||&lt;br/&gt;
                    ((pkgName.length() == m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.length() - 1) &amp;amp;&amp;amp;&lt;br/&gt;
                        pkgName.regionMatches(0, m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, 0, m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.length() - 1))))&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; (!m_bootPkgWildcards&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; &amp;amp;&amp;amp; m_bootPkgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.equals(pkgName)))&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;You can see here that we only do the regionMatches() if the two package names are the same length (ignoring the dot). Whew!&lt;/p&gt;

&lt;p&gt;Thanks for double checking this...feel free to triple check! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12673365" author="rickhall" created="Fri, 13 Feb 2009 19:54:32 +0000"  >&lt;p&gt;Forgot to resolve. Robert, please close if satisfied.&lt;/p&gt;</comment>
                            <comment id="12673503" author="koszegir" created="Sat, 14 Feb 2009 11:44:12 +0000"  >&lt;p&gt;I had a feeling it is not so simple as I thought &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I am happy with the solution. Issue is closed.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Robert&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58056</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1414v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231646</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>