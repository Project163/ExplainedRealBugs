<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:11:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1479] Security errors accessing configurations in the file system</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1479</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When the FilePersistenceManager is trying to access the configuration files it currently does this in the security context of the calling bundle. If the calling bundle does not have file access permissions, this access fails (unexpectedly).&lt;/p&gt;

&lt;p&gt;The fix is to ensure running in doPrivileged using the configuration admin bundle&apos;s security context to access the files.&lt;/p&gt;

&lt;p&gt;More informations from the original reporter:&lt;/p&gt;


&lt;p&gt;There seems no test of that SecurityException is thrown because&lt;br/&gt;
a configuring bundle CB does not have appropriate Permission to call&lt;br/&gt;
ConfigurationAdmin#getConfiguration(pid,location).&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;In testGetConfigurationWithLocation(), CB can get a Configuration&lt;/li&gt;
	&lt;li&gt;objects because it has AllPermission.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;As far as I see, felix cm impl has a bug if the Java Runtime supports&lt;br/&gt;
security. In my test, the following Exception is thrown. (&lt;/p&gt;

&lt;p&gt;Currently, the CB fails to get a Configuration. The reason is CB has no&lt;br/&gt;
permission to access a file FilePersistenceManager handles.&lt;br/&gt;
&quot;doPriviledge&quot; in seems required to avoid it.&lt;/p&gt;


&lt;hr /&gt;
&lt;p&gt;locations&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;=C:\ws\OSGiSVN\cnf\repo\osgi.cmpn\osgi.cmpn-4.2.1.jar&lt;br/&gt;
                (java.security.AllPermission)&lt;br/&gt;
locations&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;=targetB1.jar&lt;br/&gt;
                (java.security.AllPermission)&lt;br/&gt;
locations&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;=C:\ws\OSGiSVN\licensed\repo\org.apache.felix.configadmin\org.apache.felix.configadmin-1.0.10.jar&lt;br/&gt;
                (java.security.AllPermission)&lt;br/&gt;
locations&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt;=C:\ws\OSGiSVN\org.osgi.test.cases.cm.ext\generated\org.osgi.test.cases.cm.ext.jar&lt;br/&gt;
                (java.security.AllPermission)&lt;br/&gt;
locations&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt;=setAllPermission.jar&lt;br/&gt;
                (java.security.AllPermission)&lt;br/&gt;
locations&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt;=configuringB1.jar&lt;br/&gt;
                (org.osgi.framework.PackagePermission &quot;org.osgi.service.cm&quot; &quot;IMPORT&quot;)&lt;br/&gt;
                (org.osgi.framework.ServicePermission &quot;org.osgi.service.cm.ConfigurationAdmin&quot; &quot;GET&quot;)&lt;br/&gt;
                (org.osgi.framework.PackagePermission &quot;org.osgi.test.cases.cm.ext.util&quot; &quot;IMPORT&quot;)&lt;br/&gt;
                (org.osgi.framework.ServicePermission &quot;org.osgi.test.cases.cm.ext.util.ResultKeeper&quot; &quot;REGISTER&quot;)&lt;br/&gt;
                (org.osgi.framework.PackagePermission &quot;org.osgi.framework&quot; &quot;IMPORT&quot;)&lt;br/&gt;
                (org.osgi.service.cm.ConfigurationPermission &quot;*&quot; &quot;CONFIGURE&quot;)&lt;br/&gt;
locations&lt;span class=&quot;error&quot;&gt;&amp;#91;6&amp;#93;&lt;/span&gt;=System Bundle&lt;br/&gt;
                (java.security.AllPermission)&lt;br/&gt;
default permission=&lt;br/&gt;
                (java.util.PropertyPermission &quot;java.home&quot; &quot;read&quot;)&lt;/p&gt;

&lt;p&gt;org.osgi.framework.BundleException: Exception in org.osgi.test.cases.cm.ext.configuringB1.ConfiguringActivator.start() of bundle org.osgi.test.cases.cm.ext.configuringB1.&lt;br/&gt;
                at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:805)&lt;br/&gt;
                at org.eclipse.osgi.framework.internal.core.BundleContextImpl.start(BundleContextImpl.java:754)&lt;br/&gt;
                at org.eclipse.osgi.framework.internal.core.BundleHost.startWorker(BundleHost.java:352)&lt;br/&gt;
                at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:280)&lt;br/&gt;
                at org.eclipse.osgi.framework.internal.core.AbstractBundle.start(AbstractBundle.java:272)&lt;br/&gt;
                at org.osgi.test.cases.cm.ext.tbc.CmExtTestControl.startBundleAndCheckSecurityException(CmExtTestControl.java:2120)&lt;br/&gt;
                at org.osgi.test.cases.cm.ext.tbc.CmExtTestControl.testGetConfigurationWithLocation1_1_1(CmExtTestControl.java:227)&lt;br/&gt;
                at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
                at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
                at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
                at java.lang.reflect.Method.invoke(Method.java:324)&lt;br/&gt;
                at junit.framework.TestCase.runTest(TestCase.java:164)&lt;br/&gt;
                at junit.framework.TestCase.runBare(TestCase.java:130)&lt;br/&gt;
                at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
                at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
                at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
                at junit.framework.TestCase.run(TestCase.java:120)&lt;br/&gt;
                at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
                at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
                at junit.framework.TestSuite.runTest(TestSuite.java:230)&lt;br/&gt;
                at junit.framework.TestSuite.run(TestSuite.java:225)&lt;br/&gt;
                at aQute.junit.runtime.Target.doTesting(Target.java:158)&lt;br/&gt;
                at aQute.junit.runtime.Target.run(Target.java:42)&lt;br/&gt;
                at aQute.junit.runtime.Target.main(Target.java:33)&lt;br/&gt;
Caused by: java.security.AccessControlException: access denied&lt;br/&gt;
(java.io.FilePermission C:\ws\OSGiSVN\org.osgi.test.cases.cm.ext\generat&lt;br/&gt;
ed\fwtmp\org.eclipse.osgi\bundles\1\data\config\cm\ext\pid1.config read)&lt;br/&gt;
                at java.security.AccessControlContext.checkPermission(AccessControlContext.java:269)&lt;br/&gt;
                at org.eclipse.osgi.internal.permadmin.EquinoxSecurityManager.internalCheckPermission(EquinoxSecurityManager.java:117)&lt;br/&gt;
                at org.eclipse.osgi.internal.permadmin.EquinoxSecurityManager$CheckPermissionAction.run(EquinoxSecurityManager.java:60)&lt;br/&gt;
                at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
                at org.eclipse.osgi.internal.permadmin.EquinoxSecurityManager.checkPermission(EquinoxSecurityManager.java:88)&lt;br/&gt;
                at org.eclipse.osgi.internal.permadmin.EquinoxSecurityManager.checkPermission(EquinoxSecurityManager.java:187)&lt;br/&gt;
                at java.lang.SecurityManager.checkRead(SecurityManager.java:863)&lt;br/&gt;
                at java.io.File.isFile(File.java:723)&lt;br/&gt;
                at org.apache.felix.cm.file.FilePersistenceManager.exists(FilePersistenceManager.java:388)&lt;br/&gt;
                at org.apache.felix.cm.impl.ConfigurationManager.getExistingConfiguration(ConfigurationManager.java:375)&lt;br/&gt;
                at org.apache.felix.cm.impl.ConfigurationManager.getConfiguration(ConfigurationManager.java:391)&lt;br/&gt;
                at org.apache.felix.cm.impl.ConfigurationAdminImpl.getConfiguration(ConfigurationAdminImpl.java:116)&lt;br/&gt;
                at org.osgi.test.cases.cm.ext.configuringB1.ConfiguringActivator.start(ConfiguringActivator.java:25)&lt;br/&gt;
                at org.eclipse.osgi.framework.internal.core.BundleContextImpl$1.run(BundleContextImpl.java:782)&lt;br/&gt;
                at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
                at org.eclipse.osgi.framework.internal.core.BundleContextImpl.startActivator(BundleContextImpl.java:773)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12432905">FELIX-1479</key>
            <summary>Security errors accessing configurations in the file system</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Aug 2009 18:30:27 +0000</created>
                <updated>Tue, 25 Aug 2009 08:09:16 +0000</updated>
                            <resolved>Mon, 17 Aug 2009 10:16:12 +0000</resolved>
                                    <version>configadmin-1.0.10</version>
                                    <fixVersion>configadmin-1.2.0</fixVersion>
                                    <component>Configuration Admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12743480" author="fmeschbe" created="Fri, 14 Aug 2009 22:50:32 +0000"  >&lt;p&gt;Committed a modified FilePersistenceManager, which checks for the system SecurityManager and if set uses an AccessControlContext setup at construction time to run operations as privileged actions in Rev. 804404.&lt;/p&gt;

&lt;p&gt;Sending a SNAPSHOT containing these changes to the reporter for cross-checking.&lt;/p&gt;

&lt;p&gt;(BTW: The FailureActivator class committed with this revision does not belong in the SVN yet and is removed)&lt;/p&gt;</comment>
                            <comment id="12744016" author="fmeschbe" created="Mon, 17 Aug 2009 10:16:12 +0000"  >&lt;p&gt;The original reporter has confirmed the fix to be working correctly.&lt;/p&gt;

&lt;p&gt;Therefore resolving this issue fixed.&lt;/p&gt;</comment>
                            <comment id="12747290" author="fmeschbe" created="Tue, 25 Aug 2009 08:09:16 +0000"  >&lt;p&gt;Close all issues now this version has been released&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57545</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vz5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184670</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>