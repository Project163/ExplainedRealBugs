<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:55:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4728] InstanceManager concurrency issue</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4728</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;We observed a race condition in InstanceManager.onEntry. This is caused by improperly synchronized access on a HashMap. Unlike reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3500&quot; title=&quot;InstanceManager concurrency issue: &amp;quot;A methodID cannot be associated with a method from the POJO class&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3500&quot;&gt;&lt;del&gt;FELIX-3500&lt;/del&gt;&lt;/a&gt;, we did not get an exception, but high cpu usage due to the data race. See the relevant thread stacks in the comments.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12761093">FELIX-4728</key>
            <summary>InstanceManager concurrency issue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clement.escoffier">Clement Escoffier</assignee>
                                    <reporter username="n.beekman">Niels Beekman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Dec 2014 15:56:08 +0000</created>
                <updated>Wed, 24 Dec 2014 16:24:00 +0000</updated>
                            <resolved>Mon, 15 Dec 2014 15:59:00 +0000</resolved>
                                    <version>ipojo-runtime-1.11.2</version>
                                    <fixVersion>ipojo-runtime-1.12.1</fixVersion>
                                    <component>iPOJO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14242724" author="n.beekman" created="Thu, 11 Dec 2014 15:57:16 +0000"  >&lt;p&gt;Relevant portions of the thread stacks:&lt;/p&gt;

&lt;p&gt;Thread 98: (state = IN_JAVA)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;java.util.HashMap.getEntry(java.lang.Object) @bci=81, line=465 (Compiled frame; information may be imprecise)&lt;/li&gt;
	&lt;li&gt;java.util.HashMap.containsKey(java.lang.Object) @bci=2, line=449 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.getMethodById(java.lang.String) @bci=19, line=1310 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.onEntry(java.lang.Object, java.lang.String, java.lang.Object[]) @bci=28, line=1238 (Compiled frame)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thread 62: (state = IN_JAVA)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;java.util.HashMap.getEntry(java.lang.Object) @bci=81, line=465 (Compiled frame; information may be imprecise)&lt;/li&gt;
	&lt;li&gt;java.util.HashMap.get(java.lang.Object) @bci=11, line=417 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.getMethodById(java.lang.String) @bci=5, line=1309 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.onEntry(java.lang.Object, java.lang.String, java.lang.Object[]) @bci=28, line=1238 (Compiled frame)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thread 58: (state = IN_JAVA)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;java.util.HashMap.getEntry(java.lang.Object) @bci=81, line=465 (Compiled frame; information may be imprecise)&lt;/li&gt;
	&lt;li&gt;java.util.HashMap.containsKey(java.lang.Object) @bci=2, line=449 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.getMethodById(java.lang.String) @bci=19, line=1310 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.onEntry(java.lang.Object, java.lang.String, java.lang.Object[]) @bci=28, line=1238 (Compiled frame)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thread 53: (state = IN_JAVA)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;java.util.HashMap.getEntry(java.lang.Object) @bci=81, line=465 (Compiled frame; information may be imprecise)&lt;/li&gt;
	&lt;li&gt;java.util.HashMap.containsKey(java.lang.Object) @bci=2, line=449 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.getMethodById(java.lang.String) @bci=19, line=1310 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.onEntry(java.lang.Object, java.lang.String, java.lang.Object[]) @bci=28, line=1238 (Compiled frame)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thread 44: (state = IN_JAVA)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;java.util.HashMap.getEntry(java.lang.Object) @bci=81, line=465 (Compiled frame; information may be imprecise)&lt;/li&gt;
	&lt;li&gt;java.util.HashMap.get(java.lang.Object) @bci=11, line=417 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.getMethodById(java.lang.String) @bci=5, line=1309 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.onEntry(java.lang.Object, java.lang.String, java.lang.Object[]) @bci=28, line=1238 (Compiled frame)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thread 40: (state = IN_JAVA)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;java.util.HashMap.getEntry(java.lang.Object) @bci=81, line=465 (Compiled frame; information may be imprecise)&lt;/li&gt;
	&lt;li&gt;java.util.HashMap.containsKey(java.lang.Object) @bci=2, line=449 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.getMethodById(java.lang.String) @bci=19, line=1310 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.onEntry(java.lang.Object, java.lang.String, java.lang.Object[]) @bci=28, line=1238 (Compiled frame)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thread 39: (state = IN_JAVA)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;java.util.HashMap.getEntry(java.lang.Object) @bci=81, line=465 (Compiled frame; information may be imprecise)&lt;/li&gt;
	&lt;li&gt;java.util.HashMap.containsKey(java.lang.Object) @bci=2, line=449 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.getMethodById(java.lang.String) @bci=19, line=1310 (Compiled frame)&lt;/li&gt;
	&lt;li&gt;org.apache.felix.ipojo.InstanceManager.onEntry(java.lang.Object, java.lang.String, java.lang.Object[]) @bci=28, line=1238 (Compiled frame)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14243815" author="clement.escoffier" created="Fri, 12 Dec 2014 07:23:35 +0000"  >&lt;p&gt;Do you have a way to reproduce it ?&lt;/p&gt;</comment>
                            <comment id="14243903" author="n.beekman" created="Fri, 12 Dec 2014 09:22:15 +0000"  >&lt;p&gt;No, unfortunately. We encountered this issue only once after months in production.&lt;br/&gt;
However, if you have tests for the InstanceManager, you should be able to just let a number of threads access onEntry concurrently to reproduce.&lt;br/&gt;
A simple fix would be to use &quot;private Map m_methods = Collections.synchronizedMap(new HashMap());&quot; or use ConcurrentHashMap if possible, or synchronize getMethodById entirely.&lt;/p&gt;

&lt;p&gt;For a detailed explanation of this race condition, see &lt;a href=&quot;http://mailinator.blogspot.nl/2009/06/beautiful-race-condition.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://mailinator.blogspot.nl/2009/06/beautiful-race-condition.html&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14246774" author="clement.escoffier" created="Mon, 15 Dec 2014 15:59:00 +0000"  >&lt;p&gt;Fixed in trunk.&lt;/p&gt;</comment>
                            <comment id="14253195" author="n.beekman" created="Fri, 19 Dec 2014 09:57:17 +0000"  >&lt;p&gt;Thanks for the quick fix. Has a release date for 1.12.1 been set yet?&lt;/p&gt;

&lt;p&gt;I think much of the InstanceManager code would benefit a lot from using modern synchronization classes such as ConcurrentMap rather than a crude Collections.synchronizedMap(). I don&apos;t know much about iPOJO internals, but this code path seems to be occurring for each and every dependency access. Is there a limitation on JVM version that prevents iPOJO from being able to use these?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12554139">FELIX-3500</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 48 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23bmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>