<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:09:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-619] Shell.TUI causes &quot;new java.io.ServerSocket()&quot; to hang</title>
                <link>https://issues.apache.org/jira/browse/FELIX-619</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;To save me from typing it in again, here&apos;s the dev mailing list excerpt:&lt;br/&gt;
-------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;br/&gt;
I uncovered an issue in which the Shell.TUI will cause &quot;new java.io.ServerSocket()&quot; to hang;&lt;/p&gt;

&lt;p&gt;Through process of elimination / gutting, pretty much to the point of a small bundle with an activate() method (I&apos;m using SCR) and a &quot;new ServerSocket(1234, 1)&quot;, with a couple log events pre and post, I determined that the construction of the ServerSocket will not return (nor timeout, IIRC), if the Shell.TUI bundle is started first;&lt;/p&gt;

&lt;p&gt;In other forms of the telnet shell, which do not use SCR/DeclarativeServices, I remember I had to put install and start those bundles prior to the Shell.TUI... However, because I changed the ordering a la SCR (my bundle is installed and started, but SCR does not start my &quot;service&quot; and activation thereof until my dependencies are satisfied, in this case to shell service and log service), my bundle activation falls behind the shell.TUI activation...&lt;/p&gt;

&lt;p&gt;So, the Shell.TUI must be causing some sort of conflict with ServerSocket ... I did not dig deeper than that... Not sure if someone would ask me to file a bug or not... I&apos;m just putting this out there... maybe others have come across this, but I don&apos;t know...&lt;/p&gt;

&lt;p&gt;I solved my immediate problem by simple removing Shell.TUI from the auto.start list;&lt;br/&gt;
------------------------------------------------------------------------------------------------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;autotart:&lt;br/&gt;
felix.auto.start.1= \&lt;br/&gt;
 &lt;a href=&quot;file:bundle/org.craig.shell.play01.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/org.craig.shell.play01.jar&lt;/a&gt; \&lt;br/&gt;
 &lt;a href=&quot;file:bundle/org.osgi.compendium-1.0.1.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/org.osgi.compendium-1.0.1.jar&lt;/a&gt; \&lt;br/&gt;
 &lt;a href=&quot;file:bundle/org.apache.felix.shell-1.0.1.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/org.apache.felix.shell-1.0.1.jar&lt;/a&gt; \&lt;br/&gt;
&lt;a href=&quot;file:bundle/org.apache.felix.shell.tui-1.0.1.ja&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/org.apache.felix.shell.tui-1.0.1.ja&lt;/a&gt;&lt;br/&gt;
 &lt;a href=&quot;file:bundle/org.apache.felix.configadmin-1.0.1.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/org.apache.felix.configadmin-1.0.1.jar&lt;/a&gt; \&lt;br/&gt;
 &lt;a href=&quot;file:bundle/org.apache.felix.bundlerepository-1.0.3.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/org.apache.felix.bundlerepository-1.0.3.jar&lt;/a&gt; \&lt;br/&gt;
 &lt;a href=&quot;file:bundle/org.apache.felix.scr-1.0.0.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/org.apache.felix.scr-1.0.0.jar&lt;/a&gt; \&lt;br/&gt;
 &lt;a href=&quot;file:bundle/pax-logging-api-1.0.0.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/pax-logging-api-1.0.0.jar&lt;/a&gt; \&lt;br/&gt;
 &lt;a href=&quot;file:bundle/pax-logging-service-1.0.0.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/pax-logging-service-1.0.0.jar&lt;/a&gt; \&lt;br/&gt;
 &lt;a href=&quot;file:bundle/pax-confman-propsloader-0.2.1.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundle/pax-confman-propsloader-0.2.1.jar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Play01.java:&lt;br/&gt;
package org.craig.shell;&lt;/p&gt;

&lt;p&gt;import org.osgi.service.component.ComponentContext;&lt;br/&gt;
import org.osgi.service.log.LogService;&lt;br/&gt;
import org.apache.felix.shell.ShellService;&lt;br/&gt;
import java.io.*;&lt;/p&gt;

&lt;p&gt;public class Play01&lt;br/&gt;
{&lt;br/&gt;
   protected ShellService shell = null;&lt;br/&gt;
   protected LogService log = null;&lt;/p&gt;

&lt;p&gt;   protected void activate(ComponentContext context) throws Exception&lt;/p&gt;
   {
      ServerSocket myListener = new ServerSocket(1234, 1); // Note from Craig - this will hang if TUI is started (presumably first)
   }

&lt;p&gt;   protected void deactivate(ComponentContext context) throws Exception&lt;br/&gt;
   {&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;   protected void setLog(LogService log)&lt;/p&gt;
   {
      this.log = log;
   }

&lt;p&gt;   protected void unsetLog(LogService log)&lt;/p&gt;
   {
      this.log = null;
   }

&lt;p&gt;   protected void setShell(ShellService shell)&lt;/p&gt;
   {
      this.shell = shell;
   }

&lt;p&gt;   protected void unsetShell(ShellService shell)&lt;/p&gt;
   {
      this.shell = null;
   }

&lt;p&gt;This is the dot.bnd file, which uses the BND tool (as an ANT task), and creates the manifest and OSGI-INF metadata thereof:&lt;/p&gt;

&lt;p&gt;Bundle-SymbolicName: org.craig.shell.play01&lt;br/&gt;
Bundle-Name: org.craig.shell.play01 - shell play01&lt;br/&gt;
Bundle-Description: shell play01&lt;br/&gt;
Bundle-Version: 1.0.0&lt;br/&gt;
Export-Package: org.craig.shell&lt;br/&gt;
Import-Package: org.osgi.framework,org.osgi.service.component,org.apache.felix.shell,org.osgi.service.log&lt;br/&gt;
Service-Component=org.craig.shell.Play01; \&lt;br/&gt;
   log=org.osgi.service.log.LogService; \&lt;br/&gt;
   shell=org.apache.felix.shell.ShellService;&lt;/p&gt;</description>
                <environment>Windows; Best to run in a sandbox, fork java if necessary (for full effect)... By sandbox, I mean a directory structure / project area that&amp;#39;s sterile, shall we say</environment>
        <key id="12399450">FELIX-619</key>
            <summary>Shell.TUI causes &quot;new java.io.ServerSocket()&quot; to hang</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="lcphillips">Craig Phillips</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Jul 2008 13:59:09 +0000</created>
                <updated>Mon, 12 Apr 2010 14:48:15 +0000</updated>
                            <resolved>Sun, 6 Sep 2009 19:11:11 +0000</resolved>
                                    <version>framework-1.0.4</version>
                                    <fixVersion>shell.tui-1.4.0</fixVersion>
                                    <component>Shell TUI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12620855" author="fmeschbe" created="Fri, 8 Aug 2008 06:35:31 +0000"  >&lt;p&gt;This is interesting.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Have you tried this with the latest release of the felix scr bundle ?&lt;/li&gt;
	&lt;li&gt;This only happens on the first startup ?&lt;/li&gt;
	&lt;li&gt;Or does it happen on each startup ?&lt;/li&gt;
	&lt;li&gt;Does it also happen if you install the bundles &quot;manually&quot;, e.g. through the shell ?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12709917" author="rickhall" created="Fri, 15 May 2009 17:33:13 +0000"  >&lt;p&gt;This is related to a JDK bug:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4809647&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4809647&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12710382" author="rickhall" created="Mon, 18 May 2009 15:27:41 +0000"  >&lt;p&gt;Committed a patch to try to work around this issue. Basically, we try to determine if there are bytes available before reading from stdin. The current approach might not eliminate the issue completely, since it uses readLine() if there is any input available at all. It might still be possible for the deadlock situation to occur if there isn&apos;t a complete line to read. It might be better to implement or our own readLine() that uses available() to only read the available number of bytes until it gets a line feed. However, this is just a hunch.&lt;/p&gt;

&lt;p&gt;I have deployed a snapshot.&lt;/p&gt;</comment>
                            <comment id="12711189" author="pforhan" created="Wed, 20 May 2009 15:36:24 +0000"  >&lt;p&gt;While the fix works when running under Eclipse (another way to make things seem to hang), my text does not get echoed to the console window when running this from the command line. &lt;/p&gt;</comment>
                            <comment id="12711196" author="rickhall" created="Wed, 20 May 2009 15:49:26 +0000"  >&lt;p&gt;Thanks for the feedback. Now I remember something about this from the last time we tried to find a fix for this issue. We will look into it.&lt;/p&gt;</comment>
                            <comment id="12711201" author="pforhan" created="Wed, 20 May 2009 15:59:34 +0000"  >&lt;p&gt;I need to amend this a bit... for a simple 10-bundle set-up, I see the problem.  For a more complex application (nearly 100 bundles) I do not see the issue.&lt;/p&gt;</comment>
                            <comment id="12711210" author="rickhall" created="Wed, 20 May 2009 16:27:29 +0000"  >&lt;p&gt;I talked to Tom Watson about how they solved this issue in Equinox and apparently there isn&apos;t a solution. They simply made this a configuration property. By default, they do not use the &quot;available()&quot; workaround, but when run within Eclipse they do. So, unless we can find another solution, I think we will have to follow a similar route and make this a configuration property for Shell TUI.&lt;/p&gt;</comment>
                            <comment id="12751948" author="rickhall" created="Sun, 6 Sep 2009 19:11:11 +0000"  >&lt;p&gt;I added a configuration property to enable the workaround: shell.tui.checkinput&lt;/p&gt;

&lt;p&gt;It is false by default. This probably won&apos;t solve all of our issues, but it is something. We can always re-address this issue if necessary in a future release.&lt;/p&gt;</comment>
                            <comment id="12855992" author="rickhall" created="Mon, 12 Apr 2010 14:48:15 +0000"  >&lt;p&gt;For future reference, this is related to this JRE bug:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4809647&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4809647&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The related Equinox bug is:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://bugs.eclipse.org/bugs/show_bug.cgi?id=40066&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.eclipse.org/bugs/show_bug.cgi?id=40066&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58369</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 33 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vvpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184110</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>