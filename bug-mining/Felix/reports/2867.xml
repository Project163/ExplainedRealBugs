<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:10:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5652] Felix Framework hangs on shutdown</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5652</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When shutting down the Felix Framework the process hangs for about 1 minute or so.&lt;/p&gt;

&lt;p&gt;When running with the debugger, NetBeans shows 8 FelixResolver threads still running (my machine has 8 cores, the number might be related).&lt;/p&gt;

&lt;p&gt;The issue did not occur with v4.6.0&lt;/p&gt;</description>
                <environment></environment>
        <key id="13081552">FELIX-5652</key>
            <summary>Felix Framework hangs on shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karlpauls">Karl Pauls</assignee>
                                    <reporter username="puce">Florian Brunner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Jun 2017 20:44:30 +0000</created>
                <updated>Thu, 29 Jun 2017 19:00:26 +0000</updated>
                            <resolved>Fri, 23 Jun 2017 13:57:58 +0000</resolved>
                                    <version>framework-5.6.2</version>
                    <version>framework-5.6.4</version>
                                    <fixVersion>framework-5.6.6</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16058215" author="puce" created="Wed, 21 Jun 2017 20:57:29 +0000"  >&lt;p&gt;2 &quot;empty&quot; Drombler FX applications.&lt;/p&gt;

&lt;p&gt;v5.6.2 uses org.apache.felix.framework-5.6.2.jar showing the issue&lt;/p&gt;

&lt;p&gt;v4.6.0 uses org.apache.felix.framework-4.6.0.jar, which doesn&apos;t suffer from this issue.&lt;/p&gt;

&lt;p&gt;run with: java -jar bin/my-application.jar&lt;/p&gt;

&lt;p&gt;The application just shows a progress indicator as the applications are &quot;empty&quot; (no OSGi bundles in the &quot;bundle&quot; directory).&lt;/p&gt;

&lt;p&gt;You can see the issue on the console when closing the JavaFX window.&lt;/p&gt;

&lt;p&gt;Tested with: java v1.8.0_131&lt;/p&gt;</comment>
                            <comment id="16058216" author="puce" created="Wed, 21 Jun 2017 20:59:45 +0000"  >&lt;p&gt;You can find the source code, which stops the framework here: &lt;a href=&quot;https://github.com/Drombler/drombler-acp/blob/develop/drombler-acp-startup-main/src/main/java/org/drombler/acp/startup/main/impl/osgi/OSGiStarter.java#L99&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Drombler/drombler-acp/blob/develop/drombler-acp-startup-main/src/main/java/org/drombler/acp/startup/main/impl/osgi/OSGiStarter.java#L99&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16058220" author="puce" created="Wed, 21 Jun 2017 21:01:03 +0000"  >&lt;p&gt;This issue affects the following Drombler FX issue: &lt;a href=&quot;https://github.com/Drombler/drombler-fx/issues/185&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/Drombler/drombler-fx/issues/185&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16058240" author="puce" created="Wed, 21 Jun 2017 21:09:48 +0000"  >&lt;p&gt;framework-5.6.4 suffers from this issue as well&lt;/p&gt;</comment>
                            <comment id="16058263" author="karlpauls" created="Wed, 21 Jun 2017 21:17:12 +0000"  >&lt;p&gt;Yeah, I guess the problem is that you start the framework with a none daemon thread. That makes the threads in the resolver threadpool be none daemons and hence, keep the jvm running until they timeout. I guess we should actually make sure we closed the resolver threadpool when we are stopped. &lt;/p&gt;</comment>
                            <comment id="16060935" author="karlpauls" created="Fri, 23 Jun 2017 13:57:58 +0000"  >&lt;p&gt;I made it so that the resolver threads are daemons now which should solve your problem. I commited this in r1799675. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=puce&quot; class=&quot;user-hover&quot; rel=&quot;puce&quot;&gt;puce&lt;/a&gt;, can you please verify that the current trunk works as expected for you and close this issue if it does (otherwise please reopen).&lt;/p&gt;</comment>
                            <comment id="16067217" author="puce" created="Wed, 28 Jun 2017 21:03:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karlpauls&quot; class=&quot;user-hover&quot; rel=&quot;karlpauls&quot;&gt;karlpauls&lt;/a&gt; : Thanks a lot!&lt;/p&gt;

&lt;p&gt;The Apache Felix build failed however with:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Failed to execute goal on project org.apache.felix.converter: Could not resolve dependencies for project org.apache.felix:org.apache.felix.converter:jar:0.1.0-SNAPSHOT: Could not find artifact org.osgi:org.osgi.util.converter:jar:1.0.0-SNAPSHOT in nexus &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is there an additional Maven Repo I need to configure in Nexus?&lt;/p&gt;

&lt;p&gt;Or can I get the latest build from a Maven Repo?&lt;/p&gt;</comment>
                            <comment id="16067301" author="karlpauls" created="Wed, 28 Jun 2017 21:50:28 +0000"  >&lt;p&gt;I don&apos;t think so, what are you trying to build? &lt;/p&gt;

&lt;p&gt;However, I just pushed a SNAPSHOT - hence, just use 5.7.0-SNAPSHOT and you should get the latest version (with the fix).&lt;/p&gt;</comment>
                            <comment id="16068762" author="puce" created="Thu, 29 Jun 2017 18:34:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karlpauls&quot; class=&quot;user-hover&quot; rel=&quot;karlpauls&quot;&gt;karlpauls&lt;/a&gt;: I tried to to build &lt;a href=&quot;https://github.com/apache/felix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix&lt;/a&gt; (root: mvn clean install)&lt;/p&gt;

&lt;p&gt;In the Apache Snapshot Repo I found now a recent binary version: &lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/felix/org.apache.felix.framework/5.7.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/felix/org.apache.felix.framework/5.7.0-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The fix seems to have solved the issue. Thanks!&lt;/p&gt;

&lt;p&gt;From an API point of view you still might want to consider to also stop all threads when calling Framework.waitForStop(0)&lt;/p&gt;

&lt;p&gt;From the Javadoc:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Wait until this Framework has completely stopped. &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16068791" author="puce" created="Thu, 29 Jun 2017 19:00:26 +0000"  >&lt;p&gt;Calling &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;           Framework.start();
           Framework.waitForStop(0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;on a daemon thread, however, doesn&apos;t solve the issue (without your fix).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12873942" name="felix-5652-v4.6.0.zip" size="577911" author="puce" created="Wed, 21 Jun 2017 20:51:33 +0000"/>
                            <attachment id="12873941" name="felix-5652-v5.6.2.zip" size="675488" author="puce" created="Wed, 21 Jun 2017 20:51:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3gkgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>