<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:09:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1162] Component.getReferences returns null if a component that has references is not enabled.</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1162</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;The implementation of method &lt;font color=&quot;blue&quot;&gt;org.apache.felix.scr.Component.getReferences&lt;/font&gt; in class &lt;font color=&quot;blue&quot;&gt;org.apache.felix.scr.impl.AbstractComponentManager&lt;/font&gt; doesn&apos;t use &lt;font color=&quot;red&quot;&gt;m_componentMetadata&lt;/font&gt; but &lt;font color=&quot;red&quot;&gt;m_dependencyManagers&lt;/font&gt; to return the service references of a component, which causes a calling of &lt;font color=&quot;blue&quot;&gt;getReferences&lt;/font&gt; to return null before &quot;enable component&quot; is scheduled.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12425644">FELIX-1162</key>
            <summary>Component.getReferences returns null if a component that has references is not enabled.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="agemocui">Agemo Cui</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 May 2009 03:28:29 +0000</created>
                <updated>Fri, 31 Jul 2009 15:07:38 +0000</updated>
                            <resolved>Mon, 25 May 2009 21:07:36 +0000</resolved>
                                    <version>scr-1.0.8</version>
                                    <fixVersion>scr-1.2.0</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12710073" author="fmeschbe" created="Sat, 16 May 2009 05:32:42 +0000"  >&lt;p&gt;I agree that for management for components this is unsatisfactory. So the attached patch creates the dependency manager list upfront and only enables them in the enableInternal() method.&lt;/p&gt;

&lt;p&gt;Also I encapsulated all dependency manager operations (load, enable, verify, dispose) into separate methods.&lt;/p&gt;

&lt;p&gt;WDYT ?&lt;/p&gt;</comment>
                            <comment id="12712711" author="fmeschbe" created="Mon, 25 May 2009 12:39:25 +0000"  >&lt;p&gt;Applied the patch in Rev. 778407. Please close this issue if it satisfies your needs. Thanks.&lt;/p&gt;</comment>
                            <comment id="12712726" author="fmeschbe" created="Mon, 25 May 2009 14:09:50 +0000"  >&lt;p&gt;This patch is not correct, since it does not correctly handle reference counting.&lt;/p&gt;

&lt;p&gt;When a bundle is activated all its component are created (along with the DependencyManagers). This sets all reference counters of the DependencyManagers (the m_size field) to the number of already registered services matching the reference. For references to services in the same bundle, this number is always zero.&lt;/p&gt;

&lt;p&gt;After setting up the component they are scheduled for enablement. Thus all components are asynchronously enabled.&lt;/p&gt;

&lt;p&gt;Now it may (and will) happen that services may be registered matching references of DependencyManagers without the respective reference counter being incremented because the DependencyManager is not yet enabled and thus not listening for service events.&lt;/p&gt;

&lt;p&gt;When the component in question is then enabled, the DependencyManager still has the m_size field set to zero, where actually it should be 1 (or more). Consequently the reference may not be assumed satisified and hence the component may fail to activate.&lt;/p&gt;

&lt;p&gt;The probable fix is to setup the initial value of the m_size not in the DependencyManager constructor but in the enable() method along with the service listener registration.&lt;/p&gt;</comment>
                            <comment id="12712796" author="fmeschbe" created="Mon, 25 May 2009 21:07:36 +0000"  >&lt;p&gt;Moved the calculation of the initial value for the m_size field to the enable method in Rev. 778505&lt;/p&gt;

&lt;p&gt;This should do it now.&lt;/p&gt;

&lt;p&gt;So you may close it now, if it works for you. Thanks.&lt;/p&gt;</comment>
                            <comment id="12712800" author="fmeschbe" created="Mon, 25 May 2009 21:27:07 +0000"  >&lt;p&gt;Deployed SNAPSHOT version 1.0.9-20090525.212438-1 containing this fix.&lt;/p&gt;</comment>
                            <comment id="12713647" author="agemocui" created="Wed, 27 May 2009 17:16:58 +0000"  >&lt;p&gt;It works perfect. Thanks.&lt;/p&gt;</comment>
                            <comment id="12737564" author="fmeschbe" created="Fri, 31 Jul 2009 15:07:38 +0000"  >&lt;p&gt;Retargeting fixes for SCR 1.2.0 release. There will be no 1.0.10 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12408308" name="FELIX-1162.patch" size="8677" author="fmeschbe" created="Sat, 16 May 2009 05:32:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57856</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1aruf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>270977</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>