<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:06:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-609] PreferencesService might return invalid Preferences object for a user</title>
                <link>https://issues.apache.org/jira/browse/FELIX-609</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When a Preferences object has been obtained for a given user, it can be removed using removeNode(). A following call to getUserPreferences(...) will then return the old, now invalid, Preferences object, leading to an IllegalStateException when trying to add new data to the node. From this moment on, it is not possible to obtain a valid Preferences object for this user.&lt;/p&gt;

&lt;p&gt;The spec does not provide a definite answer about this case; 106.4 comes closest with &quot;getUserPreferences(String) - Return a Preferences object associated with the user name that is given as argument. If the user does not exist, a new root is created atomically.&quot; Intuitively, one might expect that removeNode() restores the PreferencesService to the same state it was before getUserPreferences(...) was called.&lt;/p&gt;

&lt;p&gt;The invalid Preferences object is caused by caching behavior in PreferencesServicesImpl&apos;s getUserPreferences(...), which checks whether a user&apos;s root node has already been created; if so, it will be returned, if not, it will be created. &lt;/p&gt;

&lt;p&gt;91        PreferencesImpl result = (PreferencesImpl) this.trees.get(name);&lt;br/&gt;
92        // if the tree does not exist yet, create it&lt;br/&gt;
93        if (result == null) &lt;/p&gt;
{
94            result = new PreferencesImpl(new PreferencesDescription(this.bundleId, name), this.storeManager);
95            this.trees.put(name, result);
96        }

&lt;p&gt;The most plausible solution is to add an extra clause to the if-statement on line 93, stating something like &lt;br/&gt;
93        if (result == null || !result.isValid()) {&lt;br/&gt;
provided that isValid() will then return the valid field of PreferencesImpl.&lt;/p&gt;

&lt;p&gt;An alternative would be to detect the removal of a node which does not have a parent (is a root node), and then remove it from the PreferencesServiceImpl&apos;s trees; this is not that complicated, but requires some extra code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12398362">FELIX-609</key>
            <summary>PreferencesService might return invalid Preferences object for a user</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marrs">Marcel Offermans</assignee>
                                    <reporter username="angelovds">Angelo van der Sijpt</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Jun 2008 19:19:10 +0000</created>
                <updated>Mon, 22 Jun 2009 15:40:37 +0000</updated>
                            <resolved>Mon, 23 Jun 2008 19:52:17 +0000</resolved>
                                    <version>prefs-1.0.2</version>
                                    <fixVersion>prefs-1.0.4</fixVersion>
                                    <component>Preferences Service</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12605574" author="angelovds" created="Tue, 17 Jun 2008 12:43:31 +0000"  >&lt;p&gt;Typo.&lt;/p&gt;</comment>
                            <comment id="12607362" author="marrs" created="Mon, 23 Jun 2008 19:52:17 +0000"  >&lt;p&gt;Someone please confirm the fix has the desired effect.&lt;/p&gt;</comment>
                            <comment id="12669904" author="angelovds" created="Tue, 3 Feb 2009 09:29:06 +0000"  >&lt;p&gt;It has been a while, but yes, the trunk behavior is now OK.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58379</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 43 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0w0rz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184931</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>