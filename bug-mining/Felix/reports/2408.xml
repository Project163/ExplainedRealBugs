<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:57:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4869] Callbacks not invoked for dependencies that are added after the component is initialized</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4869</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When adding a ServiceDependency after the component is initialized the dependency manager doesn&apos;t invoke callbacks for services already registered before the dependency was added.&lt;/p&gt;

&lt;p&gt;I&apos;m using the 4.0.1 version of the dependency manager.&lt;/p&gt;

&lt;p&gt;I&apos;ve created a small example to demonstrate the issue. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;TestComponent.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestComponent {
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;volatile&lt;/span&gt; DependencyManager dm; 
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;volatile&lt;/span&gt; Component c; 
  
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void addDependency(){
    c.add(dm.createServiceDependency().setService(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.class).setCallbacks(&lt;span class=&quot;code-quote&quot;&gt;&quot;add&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;remove&quot;&lt;/span&gt;));
  }
  
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void add(ServiceReference&amp;lt;?&amp;gt; ref) {
   &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;added &quot;&lt;/span&gt; + ref)
  }
  
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void remove(ServiceReference&amp;lt;?&amp;gt; ref) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;removed &quot;&lt;/span&gt; + ref)
  }
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the dependency is added &lt;b&gt;after&lt;/b&gt; the services are registered the add callback is never invoked. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Activator.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(BundleContext ctx, DependencyManager dm) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
	TestComponent testComponent = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestComponent();
	dm.add(createComponent().setImplementation(testComponent));
 
	ctx.registerService(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
	ctx.registerService(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);

	testComponent.addDependency();  
}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the dependency is added &lt;b&gt;before&lt;/b&gt; the services are registered the add callback are invoked. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Activator.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void init(BundleContext ctx, DependencyManager dm) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
	TestComponent testComponent = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestComponent();
	dm.add(createComponent().setImplementation(testComponent));
		
	testComponent.addDependency();  
 
	ctx.registerService(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
	ctx.registerService(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.class, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
}
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve noticed something similar when adding multiple service dependencies in the init method. When adding the dependencies in one call to Component#add(Dependency...) everything seems to work as expected but when calling the add method one component at a time callbacks not invoked for the second service dependency. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12825438">FELIX-4869</key>
            <summary>Callbacks not invoked for dependencies that are added after the component is initialized</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pderop">Pierre De Rop</assignee>
                                    <reporter username="brampouwelse">Bram Pouwelse</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Apr 2015 06:52:26 +0000</created>
                <updated>Tue, 26 May 2015 21:54:39 +0000</updated>
                            <resolved>Tue, 28 Apr 2015 23:06:39 +0000</resolved>
                                    <version>org.apache.felix.dependencymanager-r2</version>
                                    <fixVersion>org.apache.felix.dependencymanager-r3</fixVersion>
                                    <component>Dependency Manager</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14516617" author="pderop" created="Tue, 28 Apr 2015 08:03:06 +0000"  >&lt;p&gt;Hello Bram,&lt;/p&gt;

&lt;p&gt;Thanks for reporting, I will try to reproduce this issue with a DM testcase and will let you know asap (today if possible).&lt;br/&gt;
Did you check if you have some exceptions in the OSG log service when you are facing the issue ?&lt;/p&gt;


&lt;p&gt;Regarding your last comment, yes, iif you add multiple dependencies from the init() method, then you have to do it atomically and pass all dependencies in one shot using the varargs options. Please see the documentation on the Component.add(Dependency ... dependencies) in &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://felix.apache.org/apidocs/dependencymanager/4.0.0/org/apache/felix/dm/Component.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://felix.apache.org/apidocs/dependencymanager/4.0.0/org/apache/felix/dm/Component.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14516709" author="pderop" created="Tue, 28 Apr 2015 09:20:15 +0000"  >&lt;p&gt;I reproduced the problem, and will provide a patch today.&lt;/p&gt;</comment>
                            <comment id="14516712" author="pderop" created="Tue, 28 Apr 2015 09:27:10 +0000"  >&lt;p&gt;Added test case in org.apache.felix.dependencymanager.itest/src/org/apache/felix/dm/itest/api/FELIX4869_CallbackNotCalled.java&lt;/p&gt;</comment>
                            <comment id="14516749" author="brampouwelse" created="Tue, 28 Apr 2015 09:54:34 +0000"  >&lt;p&gt;Hello Pierre, &lt;/p&gt;

&lt;p&gt;Thanks for the quick reply, I did check the log service for errors but nothing (at least not with the log level error ) &lt;/p&gt;</comment>
                            <comment id="14516755" author="pderop" created="Tue, 28 Apr 2015 10:05:20 +0000"  >&lt;p&gt;ok Bram.&lt;/p&gt;

&lt;p&gt;From my side, I identified the bug (argh .. really sorry for that).&lt;br/&gt;
I will make a patch today.&lt;/p&gt;

&lt;p&gt;Just curious: if I commit a patch today, then do you need a release quickly or can you live with the trunk ?&lt;br/&gt;
(we could make a release soon, next week for example).&lt;/p&gt;

&lt;p&gt;let me know&lt;/p&gt;



</comment>
                            <comment id="14516761" author="brampouwelse" created="Tue, 28 Apr 2015 10:15:07 +0000"  >&lt;p&gt;Good to hear you&apos;ve found the issue, and even better that you&apos;ll have a patch today &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;Are there snapshots available that I can use so I can give it a try? a release next week is ok for me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  &lt;/p&gt;</comment>
                            <comment id="14516970" author="pderop" created="Tue, 28 Apr 2015 12:46:11 +0000"  >&lt;p&gt;I think I fixed it (it&apos;s committed in the trunk).&lt;/p&gt;

&lt;p&gt;Unfortunately, I&apos;m not sure I can easily push snapshots to maven because the release process of DM is now based on bndtools and I did not have time to add support for maven.&lt;/p&gt;

&lt;p&gt;Can you please build the trunk using gradle and confirm that the issue is fixed ? To build with gradle:&lt;/p&gt;

&lt;p&gt;cd /tmp&lt;br/&gt;
svn checkout &lt;a href=&quot;https://svn.apache.org/repos/asf/felix/trunk/dependencymanager&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/felix/trunk/dependencymanager&lt;/a&gt;&lt;br/&gt;
cd dependencymanager&lt;br/&gt;
gradlew org.apache.felix.dependencymanager:jar&lt;/p&gt;

&lt;p&gt;The generated jar is stored in org.apache.felix.dependencymanager/generated/org.apache.felix.dependencymanager.jar&lt;/p&gt;

&lt;p&gt;thank you !&lt;/p&gt;
</comment>
                            <comment id="14517544" author="brampouwelse" created="Tue, 28 Apr 2015 18:04:00 +0000"  >&lt;p&gt;Just tested the version from trunk and I can confirm that your fix works.&lt;/p&gt;

&lt;p&gt;Thanks again for the quick response and fix!&lt;/p&gt;</comment>
                            <comment id="14518324" author="pderop" created="Tue, 28 Apr 2015 23:06:39 +0000"  >&lt;p&gt;great ! Thanks Bram.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dzuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>