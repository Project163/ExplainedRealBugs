<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:32:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3178] NPE in ResolverImpl</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3178</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Bundle Resolution fails with NPE in both, Felix 4.0.0 and 4.0.1&lt;/p&gt;

&lt;p&gt;ERROR: Bundle com.springsource.com.sun.tools.xjc &lt;span class=&quot;error&quot;&gt;&amp;#91;119&amp;#93;&lt;/span&gt; Error starting &lt;a href=&quot;file:bundles/com.springsource.com.sun.tools.xjc.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:bundles/com.springsource.com.sun.tools.xjc.jar&lt;/a&gt; (java.lang.NullPointerException)&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.felix.framework.resolver.ResolverImpl.mergeUses(ResolverImpl.java:856)&lt;br/&gt;
        at org.apache.felix.framework.resolver.ResolverImpl.calculatePackageSpaces(ResolverImpl.java:659)&lt;br/&gt;
        at org.apache.felix.framework.resolver.ResolverImpl.calculatePackageSpaces(ResolverImpl.java:609)&lt;br/&gt;
        at org.apache.felix.framework.resolver.ResolverImpl.resolve(ResolverImpl.java:181)&lt;br/&gt;
        at org.apache.felix.framework.StatefulResolver.resolve(StatefulResolver.java:168)&lt;br/&gt;
        at org.apache.felix.framework.Felix.resolveBundleRevision(Felix.java:3811)&lt;br/&gt;
        at org.apache.felix.framework.Felix.startBundle(Felix.java:1868)&lt;br/&gt;
        at org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1191)&lt;br/&gt;
        at org.apache.felix.framework.FrameworkStartLevelImpl.run(FrameworkStartLevelImpl.java:295)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;</description>
                <environment>Also reproduced on 4.0.1</environment>
        <key id="12528253">FELIX-3178</key>
            <summary>NPE in ResolverImpl</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="aschloss">Andreas Schlosser</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Oct 2011 10:38:50 +0000</created>
                <updated>Mon, 21 Nov 2011 09:12:48 +0000</updated>
                            <resolved>Fri, 18 Nov 2011 22:09:01 +0000</resolved>
                                    <version>framework-4.0.0</version>
                                    <fixVersion>framework-4.0.2</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13132583" author="aschloss" created="Fri, 21 Oct 2011 10:39:55 +0000"  >&lt;p&gt;This is the bundle&apos;s manifest&lt;/p&gt;</comment>
                            <comment id="13133058" author="rickhall" created="Fri, 21 Oct 2011 21:01:11 +0000"  >&lt;p&gt;Having the manifest alone isn&apos;t sufficient, since the error occurs after it has calculated its dependencies. I tried to recreate the error from a set of bundles from the SpringSource bundle repository, but for me it ended up resolving correctly.&lt;/p&gt;

&lt;p&gt;Perhaps you could zip up and attach to this issue the set of bundles you use to see the error, then I can investigate it. Thanks.&lt;/p&gt;</comment>
                            <comment id="13133913" author="aschloss" created="Mon, 24 Oct 2011 09:07:33 +0000"  >&lt;p&gt;I did also include the start up profile that we use. Since I did remove all the Spring libraries as well as our own bundles, this container doesn&apos;t do much, but the error happens anyway. Thanks&lt;/p&gt;</comment>
                            <comment id="13134131" author="rickhall" created="Mon, 24 Oct 2011 15:13:14 +0000"  >&lt;p&gt;Do I just &apos;cat&apos; these three files together (e.g., cat npe.z01 npe.z02 npe.zip &amp;gt; full.zip) or what?&lt;/p&gt;</comment>
                            <comment id="13134161" author="aschloss" created="Mon, 24 Oct 2011 15:44:47 +0000"  >&lt;p&gt;Sorry about that, please reassemble the zip using &quot;zip &lt;del&gt;s&lt;/del&gt; npe -O full&quot;&lt;/p&gt;</comment>
                            <comment id="13134235" author="rickhall" created="Mon, 24 Oct 2011 16:55:50 +0000"  >&lt;p&gt;Ok, I see what is going on. Previously, the framework treated caps/reqs from attached fragments as if they came from the host, but the R4.3 API treats attached caps/reqs as coming from the fragment making the host/fragment tuple explicit. Internally, the resolver deals with this by wrapping any attached caps/reqs to make it look like they come from the host hiding the host/fragment tuple.&lt;/p&gt;

&lt;p&gt;Unfortunately, when calculating package sources during a resolve in getPackageSourceInternal() the wrapper is lost, which ultimately causes the NPE since the resolve subsequently tries to wire to a fragment capability directly, but cannot find its package space because it doesn&apos;t exist since it should be using the host&apos;s package space instead.&lt;/p&gt;

&lt;p&gt;I&apos;ll need to think about the proper way to resolve this issue, but given this knowledge I should be able to create a simple test case to recreate it, so I&apos;ll attempt to do that first.&lt;/p&gt;</comment>
                            <comment id="13140336" author="rickhall" created="Mon, 31 Oct 2011 17:21:15 +0000"  >&lt;p&gt;Just a status update, I&apos;ve created a test case to reproduce the bug in a much simpler scenario. Now I just have to figure out the best way to resolve it. Once i get something committed, I&apos;ll start to think about a 4.0.2 framework release.&lt;/p&gt;</comment>
                            <comment id="13140516" author="aschloss" created="Mon, 31 Oct 2011 20:12:07 +0000"  >&lt;p&gt;Thanks for taking this on; a 4.0.2 release would be greatly appreciated&lt;/p&gt;</comment>
                            <comment id="13146113" author="rickhall" created="Tue, 8 Nov 2011 07:22:38 +0000"  >&lt;p&gt;I&apos;ve committed a patch for this and deployed snapshots. Please let me know if it is working for you, thanks.&lt;/p&gt;

&lt;p&gt;I&apos;m not completely happy with the patch, so I may make improvements if I can think of any.&lt;/p&gt;</comment>
                            <comment id="13148220" author="adreghiciu" created="Fri, 11 Nov 2011 02:31:41 +0000"  >&lt;p&gt;I&apos;ve run into same problem and I can confirm that 4.1.0-SNAPSHOT is working fine&lt;/p&gt;</comment>
                            <comment id="13148237" author="rickhall" created="Fri, 11 Nov 2011 03:06:07 +0000"  >&lt;p&gt;Great. We&apos;ll start a 4.0.2 release pretty soon.&lt;/p&gt;</comment>
                            <comment id="13148333" author="rickhall" created="Fri, 11 Nov 2011 07:54:35 +0000"  >&lt;p&gt;Resolving as fixed, please close if satisfied. Thanks.&lt;/p&gt;</comment>
                            <comment id="13148336" author="aschloss" created="Fri, 11 Nov 2011 08:07:33 +0000"  >&lt;p&gt;I updated from felix-3.0.9 to 4.1.0-20111108.085917-4 and now I&apos;m getting a different one:&lt;br/&gt;
ERROR: Bundle org.apache.servicemix.specs.jaxp-api-1.4 &lt;span class=&quot;error&quot;&gt;&amp;#91;177&amp;#93;&lt;/span&gt; EventDispatcher: Error during dispatch. (java.lang.NullPointerException)&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.felix.framework.resolver.ResolverImpl.resolve(ResolverImpl.java:177)&lt;br/&gt;
        at org.apache.felix.framework.StatefulResolver.resolve(StatefulResolver.java:168)&lt;br/&gt;
        at org.apache.felix.framework.Felix.resolveBundles(Felix.java:3783)&lt;br/&gt;
        at org.apache.felix.framework.Felix.findBundleEntries(Felix.java:1622)&lt;br/&gt;
        at org.apache.felix.framework.BundleImpl.findEntries(BundleImpl.java:303)&lt;br/&gt;
        at org.apache.servicemix.specs.locator.Activator.register(Activator.java:97)&lt;br/&gt;
        at org.apache.servicemix.specs.locator.Activator.bundleChanged(Activator.java:88)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.invokeBundleListenerCallback(EventDispatcher.java:868)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:789)&lt;br/&gt;
        at org.apache.felix.framework.util.EventDispatcher.fireBundleEvent(EventDispatcher.java:514)&lt;br/&gt;
        at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4244)&lt;br/&gt;
        at org.apache.felix.framework.StatefulResolver.fireResolvedEvents(StatefulResolver.java:783)&lt;br/&gt;
        at org.apache.felix.framework.StatefulResolver.resolve(StatefulResolver.java:203)&lt;br/&gt;
        at org.apache.felix.framework.Felix.resolveBundleRevision(Felix.java:3819)&lt;br/&gt;
        at org.apache.felix.framework.Felix.startBundle(Felix.java:1868)&lt;br/&gt;
        at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:944)&lt;br/&gt;
        at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:931)&lt;/p&gt;</comment>
                            <comment id="13148376" author="rickhall" created="Fri, 11 Nov 2011 09:26:23 +0000"  >&lt;p&gt;Is this something I can easily recreate with the attached zip again or do I need something else?&lt;/p&gt;</comment>
                            <comment id="13148419" author="aschloss" created="Fri, 11 Nov 2011 11:00:51 +0000"  >&lt;p&gt;Sorry about that, should&apos;ve checked first. Seems to be due to another constellation that I did not have in the previous shrink-down. I did attach a new bundle collection that reproduces the problem.&lt;/p&gt;

&lt;p&gt;Again, use &quot;zip &lt;del&gt;s&lt;/del&gt; npe2 -O full&quot; to recombine the archive&lt;/p&gt;</comment>
                            <comment id="13153169" author="rickhall" created="Fri, 18 Nov 2011 22:08:27 +0000"  >&lt;p&gt;Ok, I&apos;ve gotten to the bottom of this second issue. It is actually completely unrelated to the first issue, so technically we could open another bug on it, but it&apos;s probably not necessary.&lt;/p&gt;

&lt;p&gt;This second issue has existed for a while, I believe. Essentially, candidates for bundle revisions are populated in a recursive fashion. The approach must allow for cycles and does this by essentially picking up where it left off on a given revision when it tries to populate a revision that it is already populating.&lt;/p&gt;

&lt;p&gt;With this approach, it is possible that a given revision can fail at a deeper level in the recursion stack than where it started. However, there were certain scenarios where this would go unnoticed at the higher level because resolve failures do not necessarily get thrown to the top immediately.&lt;/p&gt;

&lt;p&gt;To remedy this, after returning from a deeper recursion level, the algorithm must double check to make sure that the revision it is resolving didn&apos;t already fail in a deeper level.&lt;/p&gt;</comment>
                            <comment id="13153170" author="rickhall" created="Fri, 18 Nov 2011 22:09:01 +0000"  >&lt;p&gt;I&apos;ve committed a patch and the supplied scenario now works for me. Please close if you are satisfied. Thanks.&lt;/p&gt;</comment>
                            <comment id="13154083" author="aschloss" created="Mon, 21 Nov 2011 09:12:48 +0000"  >&lt;p&gt;Works for me as well. Thanks for the help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12500169" name="MANIFEST.MF" size="26087" author="aschloss" created="Fri, 21 Oct 2011 10:39:55 +0000"/>
                            <attachment id="12500413" name="npe.z01" size="10485760" author="aschloss" created="Mon, 24 Oct 2011 09:07:33 +0000"/>
                            <attachment id="12500414" name="npe.z02" size="10485760" author="aschloss" created="Mon, 24 Oct 2011 09:07:33 +0000"/>
                            <attachment id="12500415" name="npe.zip" size="10336939" author="aschloss" created="Mon, 24 Oct 2011 09:07:33 +0000"/>
                            <attachment id="12503360" name="npe2.z01" size="10485760" author="aschloss" created="Fri, 11 Nov 2011 11:00:50 +0000"/>
                            <attachment id="12503361" name="npe2.z02" size="10485760" author="aschloss" created="Fri, 11 Nov 2011 11:00:50 +0000"/>
                            <attachment id="12503362" name="npe2.z03" size="10485760" author="aschloss" created="Fri, 11 Nov 2011 11:00:50 +0000"/>
                            <attachment id="12503363" name="npe2.z04" size="10485760" author="aschloss" created="Fri, 11 Nov 2011 11:00:50 +0000"/>
                            <attachment id="12503364" name="npe2.zip" size="161360" author="aschloss" created="Fri, 11 Nov 2011 11:00:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97607</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 1 week, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vwe7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>