<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:05:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5446] Http Service ignores Whiteboard Servlet API Listeners</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5446</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Situation:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;A ServletRequestListener registered with the Http Whiteboard Service (standard OSGi Http Whiteboard) with property &lt;tt&gt;osgi.http.whiteboard.listener==true&lt;/tt&gt;.&lt;/li&gt;
	&lt;li&gt;A Servlet registered with the traditional OSGi HttpService&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Problem: The ServletRequestListener is not called for requests for requests to said servlet.&lt;/p&gt;

&lt;p&gt;Investigation: It looks like the ServletRequestListenerManager used to handle ServletRequestListener services for traditionally registered Servlets explicitly ignores listeners registered with the &lt;tt&gt;osgi.http.whiteboard.listener&lt;/tt&gt; property set. See this code in &lt;a href=&quot;https://github.com/apache/felix/blob/trunk/http/base/src/main/java/org/apache/felix/http/base/internal/service/listener/ServletRequestListenerManager.java#L45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ServletRequestListenerManager&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For one thing, the listener should at best ignore services registered with the property set to true. If the property is set to anything else, it will explicitly be ignored by the OSGi Whiteboard Http Service and thus should probably be accepted by the legacy Felix Http Service implementation.&lt;/p&gt;

&lt;p&gt;On the other hand: Why ignore at all ? Originally the legacy Felix Http Service accepted all Servlet API listeners regardless of such property set. So if there is a listener used and the Jetty bundle is updated and the service updated to make sure it is called for new OSGi Whiteboard services it will not be called any more for the legacy registered services&lt;/p&gt;

&lt;p&gt;I think the legacy Felix Http Service should just accept all listeners like it always did.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13027411">FELIX-5446</key>
            <summary>Http Service ignores Whiteboard Servlet API Listeners</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Dec 2016 09:54:46 +0000</created>
                <updated>Fri, 6 Jan 2017 12:01:05 +0000</updated>
                            <resolved>Wed, 21 Dec 2016 10:56:01 +0000</resolved>
                                    <version>http.base-3.0.16</version>
                    <version>http.jetty-3.4.0</version>
                    <version>http.bridge-3.0.16</version>
                                    <fixVersion>http.base-3.0.18</fixVersion>
                    <fixVersion>http.jetty-3.4.2</fixVersion>
                    <fixVersion>http.bridge-3.0.18</fixVersion>
                                    <component>HTTP Service</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15741687" author="fmeschbe" created="Mon, 12 Dec 2016 11:37:13 +0000"  >&lt;p&gt;I have looked again, and it looks like the Http Service Web Console plugin indeed &lt;b&gt;lists&lt;/b&gt; the listener for the servlet context &quot;&apos;org.osgi.service.http&quot; where the HttpService registered services are listed. But the listener is not called.&lt;/p&gt;</comment>
                            <comment id="15741762" author="cziegeler" created="Mon, 12 Dec 2016 12:19:40 +0000"  >&lt;p&gt;The web console uses the DTOs.&lt;/p&gt;

&lt;p&gt;There are two context implementations, one for the context of the http service and the other one for the whiteboard contexts. I assume that the context implementation for the http service is not considering the listeners registered through the official whiteboard but just calling the listeners registered through the old felix whiteboard.&lt;br/&gt;
I think the problematic part is the ServletContextManager class which is not considering listeners from the official whiteboard&lt;/p&gt;</comment>
                            <comment id="15748400" author="cziegeler" created="Wed, 14 Dec 2016 14:04:20 +0000"  >&lt;p&gt;As a first step, I added a test case in rev 1774247, the test is partially disabled for now&lt;/p&gt;</comment>
                            <comment id="15766748" author="cziegeler" created="Wed, 21 Dec 2016 10:55:39 +0000"  >&lt;p&gt;Fixed the implementation in rev 1775388&lt;br/&gt;
With this change I could remove a lot of duplicate code that was used to handle the listeners registered through the proprietary Felix whiteboard. Now the same code as for the http whiteboard is used, making everything easier.&lt;br/&gt;
Updated tests to verify the behaviour&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13026689">SLING-6378</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 48 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i37h3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>