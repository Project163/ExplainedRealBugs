<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:11:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5739] Strange behaviour with Lazy-ActivationPolicy and autostart</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5739</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Iam using felix.scr with Equinox (e4 application)&lt;/p&gt;

&lt;p&gt;Scenario:&lt;br/&gt;
Bundle A has Bundle-ActivationPolicy: lazy&lt;br/&gt;
Bundle A has startLevel=4&lt;br/&gt;
Bundle A provides Service S1 via ComponentDefinition&lt;br/&gt;
Bundle B listens for REGISTER-Event of S1 and retrieves it via BundleContext.getService(serviceEvent.getServiceReference())&lt;/p&gt;

&lt;p&gt;When Bundle A has autostart = false everything behaves as expected:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Equinox-ModuleContainer increases actual level to 4&lt;/li&gt;
	&lt;li&gt;Equinox-ModuleContainer starts lazyOnly-Bundles with StartLevel 4&lt;/li&gt;
	&lt;li&gt;Bundle A BundleState changes to STARTING&lt;/li&gt;
	&lt;li&gt;felix.scr reacts to BundleEvent for STARTING of Bundle A, and parses the ComponentDefinitions&lt;/li&gt;
	&lt;li&gt;felix.scr registers a ServiceFactory for S1&lt;/li&gt;
	&lt;li&gt;Bundle B reacts to ServiceEvent for REGISTER of S1 and calls BundleContext.getService(serviceEvent.getServiceReference())&lt;/li&gt;
	&lt;li&gt;The ServiceFactory for S1 loads Class of S1&lt;/li&gt;
	&lt;li&gt;The responsible Equinox-BundleClassLoader starts Bundle A&lt;/li&gt;
	&lt;li&gt;Activator#start of Bundle A is called&lt;/li&gt;
	&lt;li&gt;Instance of S1 is created&lt;/li&gt;
	&lt;li&gt;S1.activate() is called&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;When Bundle A has autostart = true something (in my opinion) weird happens:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Equinox-ModuleContainer increases actual level to 4&lt;/li&gt;
	&lt;li&gt;Equinox-ModuleContainer starts lazyOnly-Bundles with StartLevel 4&lt;/li&gt;
	&lt;li&gt;Bundle A BundleState changes to STARTING&lt;/li&gt;
	&lt;li&gt;felix.scr reacts to BundleEvent for STARTING of Bundle A, and parses the ComponentDefinitions&lt;/li&gt;
	&lt;li&gt;felix.scr registers a ServiceFactory for S1&lt;/li&gt;
	&lt;li&gt;Bundle B reacts to ServiceEvent for REGISTER of S1 and calls BundleContext.getService(serviceEvent.getServiceReference())&lt;/li&gt;
	&lt;li&gt;The ServiceFactory for S1 loads Class of S1&lt;/li&gt;
	&lt;li&gt;The responsible Equinox-BundleClassLoader &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; DOESNT start Bundle A&lt;/li&gt;
	&lt;li&gt;Instance of S1 is created&lt;/li&gt;
	&lt;li&gt;S1.activate() is called&lt;/li&gt;
	&lt;li&gt;Equinox-ModuleContainer starts autostartedOnly-Bundles with StartLevel 4 (module#start returns fast for Modules that are not autostarted)&lt;/li&gt;
	&lt;li&gt;Activator#start of Bundle A is called&lt;/li&gt;
	&lt;li&gt;Bundle A BundleState changes to ACTIVE&lt;br/&gt;
In this case we have a Lazy-BundleA and its services #activate-Method is called before its Activator#start... should this even be possible?&lt;br/&gt;
I&apos;m not sure why one would even use LazyActivationPolicy in combination with autostart but I&apos;m pretty sure it didnt behave this way before we updated to eclipse-oxygen and felix.scr&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>felix.scr 2.0.10&lt;br/&gt;
eclipse 4.7.0&lt;br/&gt;
equinox&lt;br/&gt;
windows</environment>
        <key id="13115562">FELIX-5739</key>
            <summary>Strange behaviour with Lazy-ActivationPolicy and autostart</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="mherchet">Marko Herchet</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Nov 2017 08:35:38 +0000</created>
                <updated>Mon, 8 Jan 2018 14:47:38 +0000</updated>
                            <resolved>Mon, 8 Jan 2018 14:47:32 +0000</resolved>
                                    <version>scr-2.0.10</version>
                                    <fixVersion>scr-2.0.14</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16235691" author="mherchet" created="Thu, 2 Nov 2017 13:06:57 +0000"  >&lt;p&gt;I have to add that the &quot;right&quot; behaviour with autostart=false scenario doesnt seem to be reliable:&lt;br/&gt;
When I start it from the Eclipse-Workspace with a launch-config it may work 10 times... then I change the launch-config a bit to try some things, revert the launch-config back to the original state and it doesnt work anymore (behaves like the autostart=true scenario). When I change some things in the launch-config again, start and end the application, change the launch-config back to its original state and start it again it may work again.&lt;/p&gt;

&lt;p&gt;Looks like it depends on some kind of order in the launch-config or something like that... &lt;/p&gt;</comment>
                            <comment id="16244224" author="tjwatson" created="Wed, 8 Nov 2017 16:06:55 +0000"  >&lt;p&gt;If there is an ordering issue in the case where the activation policy is actually configured to be used then it seems like that would be an Equinox issue.  I suggest you open a bug with Equinox if that is the case.  But for your consistently failing case, it sounds like the bundle is not be marked to use the activation policy at all.  The Felix DS method:&lt;/p&gt;

&lt;p&gt;org.apache.felix.scr.impl.ComponentRegistry.isBundleActive(Bundle)&lt;/p&gt;

&lt;p&gt;This method should check org.osgi.framework.startlevel.BundleStartLevel.isActivationPolicyUsed() before returning true in the STARTING case.  If the activation policy is not set to be used then even though the bundle says its activation policy is &apos;lazy&apos; the framework will behave as though the bundle does not and it will treat it as an eagerly activated bundle.  In this case it will not activate it automatically on first class load.&lt;/p&gt;</comment>
                            <comment id="16245326" author="cziegeler" created="Thu, 9 Nov 2017 07:49:04 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tjwatson&quot; class=&quot;user-hover&quot; rel=&quot;tjwatson&quot;&gt;tjwatson&lt;/a&gt;. Minor correction &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ComponentRegistry.isBundleActive(Bundle) is only used by the ScrInfo command, the problematic code is in the AbstractExtender from the felix.utils bundle. It&apos;s suffering from the same problem though&lt;/p&gt;</comment>
                            <comment id="16245468" author="cziegeler" created="Thu, 9 Nov 2017 10:22:02 +0000"  >&lt;p&gt;I&apos;ve added the additional check in rev 1814713 (and rev 1814712 for the R7 branch).&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mherchet&quot; class=&quot;user-hover&quot; rel=&quot;mherchet&quot;&gt;mherchet&lt;/a&gt; Could you maybe give this version a try and report back?&lt;/p&gt;</comment>
                            <comment id="16245477" author="mherchet" created="Thu, 9 Nov 2017 10:30:43 +0000"  >&lt;p&gt;Will have the chance to work on the related project next week and give some feedback asap.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mauv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>