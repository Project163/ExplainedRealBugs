<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:55:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4566] Consistency in PersistenceManager and Cache is not guaranteed</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4566</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Currently the store method in the CachingPersistenceManagerProxy performs an update on the PersistenceManager and then also updates the Cache.&lt;/p&gt;

&lt;p&gt;Since we are updating 2 resources, without any form of synchronisation its possible that the resources are out of sync.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;p&gt;Two threads A and B call configuration.update() on the same pid. The first threads calls store(), the PersistenceManager gets updated and then the second thread kicks in updates both PersistenceManager and the cache and finally the first thread updates the cache. &lt;/p&gt;
</description>
                <environment></environment>
        <key id="12728182">FELIX-4566</key>
            <summary>Consistency in PersistenceManager and Cache is not guaranteed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="iocanel">Ioannis Canellos</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jul 2014 10:24:41 +0000</created>
                <updated>Wed, 15 Apr 2015 15:12:38 +0000</updated>
                            <resolved>Fri, 5 Sep 2014 11:29:55 +0000</resolved>
                                    <version>configadmin-1.8.2</version>
                                    <fixVersion>configadmin-1.8.2</fixVersion>
                                    <component>Configuration Admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14066375" author="iocanel" created="Fri, 18 Jul 2014 14:05:13 +0000"  >&lt;p&gt;I am attaching a patch which uses read/write lock to ensure that updates on cache and persistence manager are synchronized.&lt;/p&gt;

&lt;p&gt;It also removes the check and act for populating the initial cache values and moves that part in the constructor. &lt;/p&gt;</comment>
                            <comment id="14066380" author="iocanel" created="Fri, 18 Jul 2014 14:11:28 +0000"  >&lt;p&gt;Improvement: Removal of the lock when the pid gets removed.&lt;/p&gt;</comment>
                            <comment id="14076789" author="gnt" created="Mon, 28 Jul 2014 20:34:24 +0000"  >&lt;p&gt;I think the patch is not sufficient.&lt;br/&gt;
We should provide some kind of synchronization for concurrent access to the cache and the getDictionaries() method returns an enumeration directly on the Hashtable which is not guarded.&lt;br/&gt;
I&apos;m also not sure if eagerly loading the entries is a good idea, as it would result in an exception thrown from a totally different place and i&apos;m not sure it&apos;s really supported.&lt;br/&gt;
I wonder if it would be easier to sync on a single global lock...&lt;br/&gt;
Thoughts ?&lt;/p&gt;</comment>
                            <comment id="14118056" author="iocanel" created="Tue, 2 Sep 2014 09:24:06 +0000"  >&lt;p&gt;Even though getDictionaries() doesn&apos;t affect the consistency between cache/file persistance it should still be guarded so that it always returns the &quot;snapshot&quot; of the cache. &lt;/p&gt;

&lt;p&gt;Regarding, the eager loading I am not sure. Personally, I think that since the service is backed by files its better to have an error during initialisation than later in the processes. For what it worths, I switched to eager loading so that I can be able to use a lock per pid. But since the getDictionaries() will require a global lock, then yes most probably will can switch back to lazy loading too.&lt;/p&gt;</comment>
                            <comment id="14122821" author="gnt" created="Fri, 5 Sep 2014 11:29:55 +0000"  >&lt;p&gt;Committing to &lt;a href=&quot;https://svn.apache.org/repos/asf/felix/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/felix/trunk&lt;/a&gt; ...&lt;br/&gt;
	M	configadmin/src/main/java/org/apache/felix/cm/impl/CachingPersistenceManagerProxy.java&lt;br/&gt;
Committed r1622684&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12739135">KARAF-3204</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12821094">KARAF-3668</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12656514" name="FELIX-4566-2.patch" size="5794" author="iocanel" created="Fri, 18 Jul 2014 14:11:28 +0000"/>
                            <attachment id="12656512" name="FELIX-4566.patch" size="5813" author="iocanel" created="Fri, 18 Jul 2014 14:05:13 +0000"/>
                            <attachment id="12666768" name="FELIX-45661-global-lock.patch" size="5535" author="iocanel" created="Fri, 5 Sep 2014 09:43:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xwzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>406308</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>