<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:51:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4309] SCR leaves some components in DISABLED state</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4309</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When running some load testing (involving refresh and restarts) on bundles, I end up with the following exceptions:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2013-11-08 13:20:00,234 | ERROR | xFrameworkWiring | fabric-core                      | ?                                   ? | 61 - org.fusesource.fabric.fabric-core - 7.3.0.redhat-SNAPSHOT | [org.fusesource.fabric.portservice.zookeeper] Cannot register Component
java.lang.IllegalStateException: Invalid BundleContext.
	at org.apache.felix.framework.BundleContextImpl.checkValidity(BundleContextImpl.java:514)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.BundleContextImpl.getBundle(BundleContextImpl.java:112)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.scr.impl.ComponentRegistry.checkComponentName(ComponentRegistry.java:357)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.scr.impl.BundleComponentActivator.loadDescriptor(BundleComponentActivator.java:253)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.scr.impl.BundleComponentActivator.initialize(BundleComponentActivator.java:153)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.scr.impl.BundleComponentActivator.&amp;lt;init&amp;gt;(BundleComponentActivator.java:115)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.scr.impl.Activator.loadComponents(Activator.java:235)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.scr.impl.Activator.access$000(Activator.java:44)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.scr.impl.Activator$1.start(Activator.java:169)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.utils.extender.AbstractExtender.createExtension(AbstractExtender.java:256)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.utils.extender.AbstractExtender.modifiedBundle(AbstractExtender.java:229)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.osgi.util.tracker.BundleTracker$Tracked.customizerModified(BundleTracker.java:479)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.osgi.util.tracker.BundleTracker$Tracked.customizerModified(BundleTracker.java:414)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.osgi.util.tracker.AbstractTracked.track(AbstractTracked.java:232)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.osgi.util.tracker.BundleTracker$Tracked.bundleChanged(BundleTracker.java:443)[74:org.apache.felix.scr:1.8.0.redhat-610147]
	at org.apache.felix.framework.util.EventDispatcher.invokeBundleListenerCallback(EventDispatcher.java:870)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:791)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.util.EventDispatcher.fireBundleEvent(EventDispatcher.java:515)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:4580)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.Felix$4.run(Felix.java:2115)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.Felix.runInContext(Felix.java:2139)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.Felix.startBundle(Felix.java:2113)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.Felix$RefreshHelper.restart(Felix.java:5099)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.Felix.refreshPackages(Felix.java:4303)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at org.apache.felix.framework.FrameworkWiringImpl.run(FrameworkWiringImpl.java:178)[org.apache.felix.framework-4.0.3.redhat-610147.jar:]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)[:1.7.0_12-ea]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The end result is that I end up with lots of components in DISABLED state while the bundles are fully started&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FuseFabric:karaf@root&amp;gt; scr:list
   ID   State             Component Name
[-1  ] [DISABLED        ] org.fusesource.fabric.placholder.resolver.port
[-1  ] [DISABLED        ] org.fusesource.fabric.profile.urlhandler
[-1  ] [DISABLED        ] org.fusesource.fabric.container.registration.karaf
[-1  ] [DISABLED        ] org.fusesource.fabric.placholder.resolver.versionprop
[-1  ] [DISABLED        ] org.fusesource.fabric.placholder.resolver.crypt
[-1  ] [DISABLED        ] org.fusesource.fabric.portservice.zookeeper
[-1  ] [DISABLED        ] org.fusesource.fabric.placholder.resolver.zookeeper
[-1  ] [DISABLED        ] org.fusesource.fabric.placholder.resolver.env
[-1  ] [DISABLED        ] org.fusesource.fabric.placholder.resolver.profileprop
[-1  ] [DISABLED        ] org.fusesource.fabric.mbeanserver.listener
[-1  ] [DISABLED        ] org.fusesource.fabric.service
[46  ] [UNSATISFIED     ] org.fusesource.fabric.configadmin.bridge
[93  ] [UNSATISFIED     ] org.fusesource.fabric.api.jmx.ClusterBootstrapManager
[94  ] [UNSATISFIED     ] org.fusesource.fabric.api.jmx.ClusterServiceManager
[95  ] [UNSATISFIED     ] org.fusesource.fabric.api.jmx.MQManager
[96  ] [UNSATISFIED     ] org.fusesource.fabric.zookeeper.config.builder
[97  ] [REGISTERED      ] org.fusesource.fabric.lock.service
[98  ] [UNSATISFIED     ] org.fusesource.fabric.zookeeper.cluster.bootstrap
[99  ] [UNSATISFIED     ] org.fusesource.fabric.zookeeper.cluster.service
[100 ] [REGISTERED      ] org.fusesource.fabric.placholder.resolver.checksum
[101 ] [UNSATISFIED     ] org.fusesource.fabric.container.provider.child
[102 ] [UNSATISFIED     ] org.fusesource.fabric.placholder.resolver.container
[103 ] [ACTIVE          ] org.fusesource.datastore.manager
[164 ] [UNSATISFIED     ] org.fusesource.fabric.features
[202 ] [ACTIVE          ] org.fusesource.fabric.extender.listener.blueprint
[203 ] [ACTIVE          ] org.fusesource.fabric.extender.listener.spring
[205 ] [ACTIVE          ] org.fusesource.fabric.jaas
[206 ] [REGISTERED      ] org.fusesource.fabric.jaas.zookeeper.backingengine
[207 ] [UNSATISFIED     ] org.fusesource.fabric.web
[208 ] [ACTIVE          ] org.fusesource.fabric.zookeeper.acl
[209 ] [ACTIVE          ] org.fusesource.fabric.zookeeper
[210 ] [ACTIVE          ] org.fusesource.fabric.zookeeper.urlhandler
[216 ] [ACTIVE          ] org.fusesource.fabric.maven
[217 ] [UNSATISFIED     ] org.fusesource.fabric.git.hawtio
[218 ] [UNSATISFIED     ] org.fusesource.fabric.datastore
[219 ] [ACTIVE          ] org.fusesource.fabric.git.service
[220 ] [UNSATISFIED     ] org.fusesource.fabric.git.master.listener
[221 ] [UNSATISFIED     ] org.fusesource.fabric.git.server
FuseFabric:karaf@root&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12678228">FELIX-4309</key>
            <summary>SCR leaves some components in DISABLED state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="gnodet">Guillaume Nodet</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Nov 2013 13:48:34 +0000</created>
                <updated>Wed, 6 Aug 2014 02:21:51 +0000</updated>
                            <resolved>Wed, 20 Nov 2013 09:44:03 +0000</resolved>
                                    <version>scr-1.8.0</version>
                                    <fixVersion>scr-1.8.2</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13817618" author="djencks" created="Fri, 8 Nov 2013 19:43:48 +0000"  >&lt;p&gt;Can you comment on how many threads are involved?  Offhand it looks to me as if a new version of a bundle is started before the old one is stopped.  If this is all in one thread then obviously I need to look harder.&lt;/p&gt;</comment>
                            <comment id="13819966" author="gnt" created="Tue, 12 Nov 2013 09:51:17 +0000"  >&lt;p&gt;We have definitely a few threads involved in the process &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I&apos;m actually running a load test on bundles start / stop / refresh / update.&lt;br/&gt;
The framework itself does not allow concurrent access on a bundle (at least if the bundle and extenders do act synchronously).&lt;br/&gt;
Given SCR extends the felix AbstractExtender, it will synchronize correctly as much as possible, but there are always cases where the bundle can be stopped while the extender is processing the bundle.  The abstract extender correctly handles that (i.e. it will wait for the processing to finish, then destroy the extension), but it seems something is missing anyway.&lt;/p&gt;

&lt;p&gt;After looking a bit more at the code, the problem may just come from the fact that the extension start / stop methods are not synchronized.  I think extending the SimpleExtension from felix utils would help in fixing this issue.&lt;br/&gt;
I can actually try and see if it helps.&lt;/p&gt;</comment>
                            <comment id="13819970" author="gnt" created="Tue, 12 Nov 2013 09:54:35 +0000"  >&lt;p&gt;Testing the following patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/scr/src/main/java/org/apache/felix/scr/impl/Activator.java b/scr/src/main/java/org/apache/felix/scr/impl/Activator.java
index 24fdf65..552aa3e 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/Activator.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/Activator.java
@@ -28,6 +28,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.scr.impl.config.ScrConfiguration;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.scr.impl.metadata.ComponentMetadata;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.utils.extender.AbstractExtender;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.utils.extender.Extension;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.utils.extender.SimpleExtension;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.Bundle;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.BundleContext;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.Constants;
@@ -162,14 +163,14 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Activator &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractExtender
     @Override
     &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Extension doCreateExtension(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Bundle bundle) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
     {
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Extension()
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleExtension(bundle)
         {
-            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void start() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
+            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void doStart() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
             {
                 loadComponents( bundle );
             }
 
-            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void destroy() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
+            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void doDestroy() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
             {
                 disposeComponents( bundle );
             }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13819976" author="gnt" created="Tue, 12 Nov 2013 10:05:40 +0000"  >&lt;p&gt;It seems to help a bit, as I now end up in a slightly better state:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[93  ] [UNSATISFIED     ] org.fusesource.fabric.features
[96  ] [UNSATISFIED     ] org.fusesource.fabric.configadmin.bridge
[179 ] [UNSATISFIED     ] org.fusesource.fabric.web.api
[180 ] [UNSATISFIED     ] org.fusesource.fabric.web
[181 ] [ACTIVE          ] org.fusesource.fabric.zookeeper.acl
[182 ] [ACTIVE          ] org.fusesource.fabric.zookeeper
[183 ] [ACTIVE          ] org.fusesource.fabric.zookeeper.urlhandler
[185 ] [ACTIVE          ] org.fusesource.fabric.extender.listener.blueprint
[186 ] [ACTIVE          ] org.fusesource.fabric.extender.listener.spring
[187 ] [ACTIVE          ] org.fusesource.fabric.jaas
[188 ] [REGISTERED      ] org.fusesource.fabric.jaas.zookeeper.backingengine
[209 ] [UNSATISFIED     ] org.fusesource.fabric.api.jmx.ClusterBootstrapManager
[210 ] [UNSATISFIED     ] org.fusesource.fabric.api.jmx.ClusterServiceManager
[211 ] [UNSATISFIED     ] org.fusesource.fabric.api.jmx.MQManager
[212 ] [REGISTERED      ] org.fusesource.fabric.lock.service
[213 ] [UNSATISFIED     ] org.fusesource.fabric.zookeeper.cluster.service
[214 ] [REGISTERED      ] org.fusesource.fabric.placholder.resolver.checksum
[215 ] [UNSATISFIED     ] org.fusesource.fabric.container.provider.child
[216 ] [UNSATISFIED     ] org.fusesource.fabric.placholder.resolver.container
[217 ] [REGISTERED      ] org.fusesource.fabric.placholder.resolver.crypt
[218 ] [REGISTERED      ] org.fusesource.fabric.placholder.resolver.env
[219 ] [UNSATISFIED     ] org.fusesource.fabric.mbeanserver.listener
[220 ] [UNSATISFIED     ] org.fusesource.fabric.service
[221 ] [UNSATISFIED     ] org.fusesource.fabric.container.registration.karaf
[222 ] [UNSATISFIED     ] org.fusesource.fabric.placholder.resolver.port
[223 ] [UNSATISFIED     ] org.fusesource.fabric.placholder.resolver.profileprop
[224 ] [UNSATISFIED     ] org.fusesource.fabric.profile.urlhandler
[225 ] [UNSATISFIED     ] org.fusesource.fabric.placholder.resolver.versionprop
[226 ] [REGISTERED      ] org.fusesource.fabric.placholder.resolver.zookeeper
[227 ] [REGISTERED      ] org.fusesource.fabric.portservice.zookeeper
[228 ] [UNSATISFIED     ] org.fusesource.fabric.git.server
[229 ] [UNSATISFIED     ] org.fusesource.fabric.git.hawtio
[230 ] [UNSATISFIED     ] org.fusesource.fabric.datastore
[231 ] [ACTIVE          ] org.fusesource.fabric.git.service
[232 ] [UNSATISFIED     ] org.fusesource.fabric.git.master.listener
[234 ] [ACTIVE          ] org.fusesource.fabric.maven
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which may be correct in my use case (where I have blueprint bundles in a failed state which may cause the unsatisfied scr components).&lt;/p&gt;</comment>
                            <comment id="13820220" author="gnt" created="Tue, 12 Nov 2013 16:16:50 +0000"  >&lt;p&gt;I&apos;m not sure I like the above patch, even though it seems to work, for the reason that it&apos;s a bad idea to hold java locks while executing code that calls the OSGi API.  In this case, activating components calls uncontrolled code, so it should be avoided.&lt;br/&gt;
I&apos;ll work on a less simple patch that will avoid holding a lock, but the stop() method will have to synchronize on something anyway to at least wait for the start() to finish.&lt;/p&gt;</comment>
                            <comment id="13820271" author="gnt" created="Tue, 12 Nov 2013 17:27:04 +0000"  >&lt;p&gt;I have the following patch which looks good to me:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/scr/src/main/java/org/apache/felix/scr/impl/Activator.java b/scr/src/main/java/org/apache/felix/scr/impl/Activator.java
index 24fdf65..5a01b9a 100644
--- a/scr/src/main/java/org/apache/felix/scr/impl/Activator.java
+++ b/scr/src/main/java/org/apache/felix/scr/impl/Activator.java
@@ -23,11 +23,13 @@ &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.PrintStream;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.text.MessageFormat;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.HashMap;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Map;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.FutureTask;
 
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.scr.impl.config.ScrConfiguration;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.scr.impl.metadata.ComponentMetadata;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.utils.extender.AbstractExtender;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.utils.extender.Extension;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.felix.utils.extender.SimpleExtension;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.Bundle;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.BundleContext;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.Constants;
@@ -162,18 +164,31 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Activator &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractExtender
     @Override
     &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Extension doCreateExtension(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Bundle bundle) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
     {
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Extension()
-        {
-            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void start() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
-            {
-                loadComponents( bundle );
-            }
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScrExtension(bundle);
+    }
 
-            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void destroy() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception
-            {
-                disposeComponents( bundle );
-            }
-        };
+    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ScrExtension &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Extension {
+
+        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Bundle bundle;
+        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FutureTask&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt; startFuture;
+
+        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ScrExtension(Bundle bundle) {
+            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.bundle = bundle;
+            startFuture = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FutureTask&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;() {
+                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
+                    loadComponents( ScrExtension.&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.bundle );
+                }
+            }, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
+        }
+
+        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void start() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
+            startFuture.run();
+        }
+
+        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void destroy() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
+            startFuture.get();
+            disposeComponents( bundle );
+        }
     }
 
     /**
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13820284" author="djencks" created="Tue, 12 Nov 2013 17:51:10 +0000"  >&lt;p&gt;In terms of blocking, how does this differ from synchronizing on start and destroy?&lt;/p&gt;

&lt;p&gt;Would it be worth considering waiting on a latch with a timeout?  &lt;/p&gt;
</comment>
                            <comment id="13821037" author="gnt" created="Wed, 13 Nov 2013 07:47:14 +0000"  >&lt;p&gt;Yes, I agree it doesn&apos;t change much.  I&apos;ve rewritten the patch with a latch and timeout instead as suggested, which enables the wait to timeout at least.&lt;br/&gt;
The main reason for avoiding a real lock is that I&apos;m investigating a small change in felix to detect OSGI Api calls while holding java locks, and I&apos;d like to avoid having scr reporting issues on that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Committing to &lt;a href=&quot;https://svn.apache.org/repos/asf/felix/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/felix/trunk&lt;/a&gt; ...&lt;br/&gt;
	M	scr/src/main/java/org/apache/felix/scr/impl/Activator.java&lt;br/&gt;
Committed r1541409&lt;/p&gt;</comment>
                            <comment id="13821046" author="djencks" created="Wed, 13 Nov 2013 07:58:12 +0000"  >&lt;p&gt;I like this better.  All the other timeouts are configured, what would you think of making this one configured too, perhaps 10 or12 times m_configuration.lockTimeout()? (default is 5000 milliseconds)&lt;/p&gt;</comment>
                            <comment id="13825210" author="gnt" created="Mon, 18 Nov 2013 09:16:12 +0000"  >&lt;p&gt;Reopened to make the timeout configurable somehow&lt;/p&gt;</comment>
                            <comment id="13827486" author="gnt" created="Wed, 20 Nov 2013 09:44:03 +0000"  >&lt;p&gt;Committing to &lt;a href=&quot;https://svn.apache.org/repos/asf/felix/trunk&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/felix/trunk&lt;/a&gt; ...&lt;br/&gt;
	M	scr/src/main/java/org/apache/felix/scr/impl/Activator.java&lt;br/&gt;
	M	scr/src/main/java/org/apache/felix/scr/impl/config/ScrConfiguration.java&lt;br/&gt;
Committed r1543739&lt;/p&gt;</comment>
                            <comment id="14087146" author="djencks" created="Wed, 6 Aug 2014 02:21:51 +0000"  >&lt;p&gt;closing remaining 1.8.2 resolved issues&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357603</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pnb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357893</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>