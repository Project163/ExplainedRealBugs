<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:57:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4907] ConfigurationDependency calls updated(null) when component is stopped.</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4907</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When a component has a Configuration Dependency, the updated callback is invoked with a null Dictionary when the omponent is stopped.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12832884">FELIX-4907</key>
            <summary>ConfigurationDependency calls updated(null) when component is stopped.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pderop">Pierre De Rop</assignee>
                                    <reporter username="pderop">Pierre De Rop</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 May 2015 22:26:00 +0000</created>
                <updated>Tue, 9 Jun 2015 21:39:46 +0000</updated>
                            <resolved>Thu, 4 Jun 2015 21:08:47 +0000</resolved>
                                    <version>org.apache.felix.dependencymanager-r3</version>
                                    <fixVersion>  org.apache.felix.dependencymanager-r5</fixVersion>
                                    <component>Dependency Manager</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14560036" author="pderop" created="Tue, 26 May 2015 22:51:45 +0000"  >&lt;p&gt;Added testFELIX4907() method in ConfigurationDependencyTest.java, which is reproducing this issue.&lt;/p&gt;</comment>
                            <comment id="14564333" author="pderop" created="Fri, 29 May 2015 07:22:42 +0000"  >&lt;p&gt;I did more checks and compared the old bahavior that was used by DM3 when a configuration is lost:&lt;/p&gt;

&lt;p&gt;in DM3, when a component defines a ConfigurationDependency:&lt;/p&gt;

&lt;p&gt;1) when the configuration is lost; component.updated(null) is called, and then the component.stop() is called (the component is stopped).&lt;br/&gt;
2) when the component is removed (with &quot;dm.remove(c)&quot;), the component.stop() is just called, and component.updated(null) is not called.&lt;/p&gt;

&lt;p&gt;but in DM4:&lt;/p&gt;

&lt;p&gt;1) when the configuration is lost, component.stop() is first called, then component.updated(null) is called.&lt;/p&gt;

&lt;p&gt;2) when the component is removed (with &quot;dm.remove(c)&quot;), the component.stop() is first called, then component.updated(null) is called.&lt;/p&gt;

&lt;p&gt;So, in DM4, we should following the same behavior as in DM3: when the component is stopped, we should not call updated(null).&lt;/p&gt;

&lt;p&gt;Now, I&apos;m hesitant about the following other issues:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;when the configuration is lost, should we really invoke updated(null) ? After all, the component will be called in its component.stop() callback, so do we really need to invoke updated(null) ? Thanks for confirming ?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When the configuration is lost (deleted), in DM3 we called component.updated(null) in the current ConfigurationAdmin thread, then we called component.stop(). But in DM4, we first stop the component (we call component.stop(); possibly in another thread than the ConfigurationAdmin thread), and then we call component.updated(null).&lt;br/&gt;
So, should we reverse the order, like in DM3: first invoke component.updated(null), then invoke component.stop() ?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14567214" author="marrs" created="Mon, 1 Jun 2015 12:05:40 +0000"  >&lt;p&gt;I think the DM3 behaviour makes sense. It only invokes updated(null) if the configuration is indeed deleted, and that leaves the component the opportunity to react on that (if it wants to do something). Only after that the component is then stopped.&lt;/p&gt;</comment>
                            <comment id="14567245" author="chris@die-schneider.net" created="Mon, 1 Jun 2015 12:29:41 +0000"  >&lt;p&gt;I think this behaviour is good as it allows the updated method to clean up.&lt;/p&gt;

&lt;p&gt;For example I use the same behaviour outside DM in plain OSGi with config admin. I create a class when config is available and destroy it when the config is null.&lt;br/&gt;
So if updated is called with null when then bundle is stopped this allows to clean up without adding some special callback when the bundle stops. It is simply the same behaviour as if the user deletes the config. So +1 for keeping this functionality. On the other hand it of course makes sense to have a test that checks for it and kind of documents the behaviour.&lt;/p&gt;</comment>
                            <comment id="14573583" author="pderop" created="Thu, 4 Jun 2015 21:08:47 +0000"  >&lt;p&gt;Thanks, I have committed the patches, and updated the ConfigurationDependencyTest.java integration test.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f887:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>