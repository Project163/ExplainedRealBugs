<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:03:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5309] SslFilter: sendRedirect does not support deliberate protocol changes on the current host</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5309</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Consider the case where application A and B are running under the same domain example.com. A is served by an Apache Felix (below &lt;a href=&quot;https://example.com/A&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://example.com/A&lt;/a&gt;) and only supports HTTPS (being terminated e.g. by a LoadBalancer in front). B is served by some other application server (below &lt;a href=&quot;https://example.com/B&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://example.com/B&lt;/a&gt;) and only supports HTTP.&lt;/p&gt;

&lt;p&gt;Now I create a link from A towards B with &lt;tt&gt;HttpServletResponse.sendRedirect(&quot;http://example.com/B/somepath&quot;)&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This URL is automatically converted by the SslFilter to &lt;tt&gt;&lt;a href=&quot;https://example.com/B/somepath&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://example.com/B/somepath&lt;/a&gt;&lt;/tt&gt; which is clearly not intended.&lt;/p&gt;

&lt;p&gt;I think the sendRedirect(...) implementation of the SSLFilter from &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4420&quot; title=&quot;[HTTP SSLFilter] Implement sendRedirect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-4420&quot;&gt;&lt;del&gt;FELIX-4420&lt;/del&gt;&lt;/a&gt; is way too aggressive, because it will also rewrite absolute URIs already containing a scheme.&lt;br/&gt;
Actually absolute URIs should never been rewritten by that filter, only relative ones (starting with a &quot;/&quot;).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12991093">FELIX-5309</key>
            <summary>SslFilter: sendRedirect does not support deliberate protocol changes on the current host</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="kwin">Konrad Windszus</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jul 2016 12:09:43 +0000</created>
                <updated>Mon, 29 Aug 2016 11:13:02 +0000</updated>
                            <resolved>Wed, 24 Aug 2016 07:27:59 +0000</resolved>
                                    <version>http.sslfilter-1.0.6</version>
                                    <fixVersion>http.sslfilter-1.2.0</fixVersion>
                                    <component>HTTP Service</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15385798" author="kwin" created="Wed, 20 Jul 2016 12:50:54 +0000"  >&lt;p&gt;There is currently an explicit test for the change of absolute URIs containing a different scheme (&lt;a href=&quot;https://github.com/apache/felix/blob/d48ced9595f0ac7cd9dd3864743598b832313d37/http/sslfilter/src/test/java/org/apache/felix/http/sslfilter/internal/SslFilterJettyTest.java#L102&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/blob/d48ced9595f0ac7cd9dd3864743598b832313d37/http/sslfilter/src/test/java/org/apache/felix/http/sslfilter/internal/SslFilterJettyTest.java#L102&lt;/a&gt;). This test wrongly assumes that the current domain is being served exclusively by Apache Felix (or at least only by backends supporting HTTPS).&lt;/p&gt;</comment>
                            <comment id="15385808" author="kwin" created="Wed, 20 Jul 2016 12:59:53 +0000"  >&lt;p&gt;Since the same logic for rewriting is being used for &lt;tt&gt;sendRedirect(&amp;lt;some uri&amp;gt;)&lt;/tt&gt; and &lt;tt&gt;setHeader(&quot;Location&quot;, &amp;lt;some uri&amp;gt;)&lt;/tt&gt; it is not easy to come up with a fix, which does not break intended rewriting. &lt;/p&gt;

&lt;p&gt;What again is the reason that &lt;tt&gt;setHeader(...)&lt;/tt&gt; is overwritten as well? Even for Jetty it should work with &lt;tt&gt;sendRedirect(...)&lt;/tt&gt; being overwritten only because that one will call the Jetty implementation of sendRedirect(...) already with the correct value (i.e. rewritten URI).&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cziegeler&quot; class=&quot;user-hover&quot; rel=&quot;cziegeler&quot;&gt;cziegeler&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jajans&quot; class=&quot;user-hover&quot; rel=&quot;jajans&quot;&gt;jajans&lt;/a&gt; WDYT?&lt;/p&gt;</comment>
                            <comment id="15430666" author="cziegeler" created="Mon, 22 Aug 2016 12:34:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-4420&quot; title=&quot;[HTTP SSLFilter] Implement sendRedirect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-4420&quot;&gt;&lt;del&gt;FELIX-4420&lt;/del&gt;&lt;/a&gt; originally was implemented by overwriting setHeader, it seems that has changed to overwrite both setHeader and sendRedirect.&lt;br/&gt;
I think it still makes sense to overwrite both and apply the same logic. If setHeader is called with a relative path, its better to make it absolute using the correct protocol.&lt;/p&gt;

&lt;p&gt;Now I agree that if sendRedirect or setHeader is called with an absolute path, no rewriting should happen. I don&apos;t know why the rewriting is done nevertheless. I assume, it&apos;s because of the initial version relying on sendRedirect calling setHeader&lt;/p&gt;</comment>
                            <comment id="15432165" author="cziegeler" created="Tue, 23 Aug 2016 05:22:32 +0000"  >&lt;p&gt;Attaching a potential fix which does not rewrite absolute urls, adjusted test cases and added some more test cases for relative paths&lt;/p&gt;</comment>
                            <comment id="15432167" author="cziegeler" created="Tue, 23 Aug 2016 05:23:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; I&apos;ve attached a potential fix, wdyt? As this is a change in behaviour I think we should make it configurable, just to be safe that if we break applications there is an easy way out.&lt;/p&gt;</comment>
                            <comment id="15432304" author="kwin" created="Tue, 23 Aug 2016 07:34:26 +0000"  >&lt;p&gt;The patch looks good to me. Maybe we should extend the javadoc of &lt;tt&gt;sendRedirect&lt;/tt&gt; and &lt;tt&gt;setHeader&lt;/tt&gt; as well telling under which circumstances somethings gets rewritten (although probably not too many people will look at the javadoc of the response being set by the filter). I agree that introducing a property to configure the behavior of absolute URLs is probably the safest way. What do you think about a label like &quot;Don&apos;t rewrite absolute redirect URLs&quot; with a value of &lt;tt&gt;false&lt;/tt&gt; as the default?&lt;/p&gt;</comment>
                            <comment id="15433084" author="cziegeler" created="Tue, 23 Aug 2016 15:54:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kwin&quot; class=&quot;user-hover&quot; rel=&quot;kwin&quot;&gt;kwin&lt;/a&gt; Thanks for the feedback, yes, that sounds good to me. I&apos;ll update the patch accordingly&lt;/p&gt;</comment>
                            <comment id="15433441" author="cziegeler" created="Tue, 23 Aug 2016 19:29:47 +0000"  >&lt;p&gt;In rev 1757420 I committed a version with a configuration property which is set to false (no rewriting of absolute urls) by default&lt;br/&gt;
I&apos;ve increased the test coverage to test both cases (setting the flag to true and false)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12693529">FELIX-4420</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12824990" name="patch.txt" size="13787" author="cziegeler" created="Tue, 23 Aug 2016 05:22:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 13 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3198v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>