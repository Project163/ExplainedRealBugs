<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:55:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4686] If component is declared with 1.3 NS and ds.factory.enabled = true, validation error occors</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4686</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;For example the following component xml leads to a validation error:&lt;/p&gt;

&lt;p&gt;&quot;Configuration of component factory instances through config admin factory pids supported only through the 1.2 namespace&quot;&lt;/p&gt;

&lt;p&gt;&amp;lt;components xmlns:scr=&quot;http://www.osgi.org/xmlns/scr/v1.3.0&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;scr:component name=&quot;org.apache.sling.sample.slingshot.impl.SetupService&quot; activate=&quot;activate&quot; deactivate=&quot;deactivate&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;implementation class=&quot;org.apache.sling.sample.slingshot.impl.SetupService&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;service.vendor&quot; value=&quot;The Apache Software Foundation&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;service.pid&quot; value=&quot;org.apache.sling.sample.slingshot.impl.SetupService&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/scr:component&amp;gt;&lt;br/&gt;
&amp;lt;/components&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12753907">FELIX-4686</key>
            <summary>If component is declared with 1.3 NS and ds.factory.enabled = true, validation error occors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="cziegeler">Carsten Ziegeler</reporter>
                        <labels>
                    </labels>
                <created>Sat, 8 Nov 2014 11:25:51 +0000</created>
                <updated>Tue, 11 Aug 2015 05:09:33 +0000</updated>
                            <resolved>Wed, 12 Nov 2014 01:37:04 +0000</resolved>
                                                    <fixVersion>scr-2.0.0</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14207348" author="cziegeler" created="Tue, 11 Nov 2014 23:41:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djencks&quot; class=&quot;user-hover&quot; rel=&quot;djencks&quot;&gt;djencks&lt;/a&gt; What do you think about this patch , which disables the non standard factory stuff if namespace 1.3+ is used:&lt;/p&gt;

&lt;p&gt;Index: src/main/java/org/apache/felix/scr/impl/metadata/XmlHandler.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/main/java/org/apache/felix/scr/impl/metadata/XmlHandler.java	(revision 1637751)&lt;br/&gt;
+++ src/main/java/org/apache/felix/scr/impl/metadata/XmlHandler.java	(working copy)&lt;br/&gt;
@@ -280,7 +280,14 @@&lt;br/&gt;
                     m_currentComponent.setConfigurableServiceProperties(&quot;true&quot;.equals(attributes.getAttribute(NAMESPACE_URI_1_0_FELIX_EXTENSIONS, CONFIGURABLE_SERVICE_PROPERTIES)));&lt;br/&gt;
                     m_currentComponent.setPersistentFactoryComponent(&quot;true&quot;.equals(attributes.getAttribute(NAMESPACE_URI_1_0_FELIX_EXTENSIONS, PERSISTENT_FACTORY_COMPONENT)));&lt;br/&gt;
                     m_currentComponent.setDeleteCallsModify(&quot;true&quot;.equals(attributes.getAttribute(NAMESPACE_URI_1_0_FELIX_EXTENSIONS, DELETE_CALLS_MODIFY)));&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;m_currentComponent.setObsoleteFactoryComponentFactory(m_globalObsoleteFactoryComponentFactory ||  &quot;true&quot;.equals(attributes.getAttribute(NAMESPACE_URI_1_0_FELIX_EXTENSIONS, OBSOLETE_FACTORY_COMPONENT_FACTORY)));&lt;br/&gt;
+                    if ( namespaceCode.isDS13() )&lt;br/&gt;
+                    
{
+                           m_currentComponent.setObsoleteFactoryComponentFactory(false);
+                    }
&lt;p&gt;+                    else&lt;br/&gt;
+                    &lt;/p&gt;
{
+                        m_currentComponent.setObsoleteFactoryComponentFactory(m_globalObsoleteFactoryComponentFactory ||  &quot;true&quot;.equals(attributes.getAttribute(NAMESPACE_URI_1_0_FELIX_EXTENSIONS, OBSOLETE_FACTORY_COMPONENT_FACTORY)));
+                    }
&lt;p&gt;                     m_currentComponent.setConfigureWithInterfaces(&quot;true&quot;.equals(attributes.getAttribute(NAMESPACE_URI_1_0_FELIX_EXTENSIONS, CONFIGURE_WITH_INTERFACES)));&lt;br/&gt;
                     m_currentComponent.setDelayedKeepInstances(m_globalDelayedKeepInstances || &quot;true&quot;.equals(attributes.getAttribute(NAMESPACE_URI_1_0_FELIX_EXTENSIONS, DELAYED_KEEP_INSTANCES)));&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="14207372" author="djencks" created="Tue, 11 Nov 2014 23:57:31 +0000"  >&lt;p&gt;IIUC your example only fails if your felix configuration includes the global ds.factory.enabled = true flag, which IMO we should do our utmost to discourage, since there is now a felix-namespace attribute you can use per-component.&lt;/p&gt;

&lt;p&gt;I don&apos;t like this suggestion.  You only get a 1.3 namespace from annotations if you use a new 1.3 feature or explicitly set it.  In this case it should be an error to try to use the obsolete component factory stuff, it should not be silently ignored.  If you have a bundle where you want to update the namespace to 1.3 but are not willing to fix the code to use factory configurations properly, you can go to the trouble of adding the felix-namespace attribute to all these badly written components.  There&apos;s no reason to make preserving these obsolete implementations easy with up-to-date namespaces, we should encourage people to update them, and to not use the obsolete global flag.&lt;/p&gt;</comment>
                            <comment id="14207386" author="cziegeler" created="Wed, 12 Nov 2014 00:11:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djencks&quot; class=&quot;user-hover&quot; rel=&quot;djencks&quot;&gt;djencks&lt;/a&gt; But my component is neither a factory nor is it really trying to use the feature enabled with ds.factory.enabled = true (it&apos;s right that this flag is enabled to be able to deal with old components). So I can&apos;t disable the flag - so if we don&apos;t fix this, I can never use 1.3 features, which I believe is not what we want.&lt;br/&gt;
Another option would be to remove the support of ds.factory.enable completely&lt;/p&gt;</comment>
                            <comment id="14207396" author="djencks" created="Wed, 12 Nov 2014 00:24:58 +0000"  >&lt;p&gt;If we completely removed ds.factory.enable support, your old components wouldn&apos;t work even if you didn&apos;t use any 1.3 features&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  I&apos;m OK with that, but I don&apos;t think you are &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
The current situation is that if you want to use 1.3 features and obsolete components, you have to change the component descriptor for the obsolete components to mark them obsolete by adding the felix-namespace attribute.  Even if you don&apos;t own the source code for these, you can repackage the compiled component and change the component xml descriptor.&lt;/p&gt;</comment>
                            <comment id="14207410" author="cziegeler" created="Wed, 12 Nov 2014 00:34:51 +0000"  >&lt;p&gt;I still think this is a little bit strange as we put a pun on components using new stuff.&lt;br/&gt;
So, as we have the felix-namespace, we &lt;b&gt;could&lt;/b&gt; remove the ds.factory.enabled flag - now, my problem is actually not that we have old components, but we have running installations where the flag is set and as soon as I update the DS implementation I can&apos;t use 1.3 stuff unless I remove the ds.factory.enabled property - which in my case is not that easy&lt;/p&gt;</comment>
                            <comment id="14207456" author="cziegeler" created="Wed, 12 Nov 2014 01:02:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djencks&quot; class=&quot;user-hover&quot; rel=&quot;djencks&quot;&gt;djencks&lt;/a&gt; Rethinking the whole story, for compatibility sake we should leave the switch (ds.factory.enabled) in.&lt;br/&gt;
So basically what you&apos;re saying is to always switch of ds.factory.enabled and change the old components that use that. However, you don&apos;t know which component is actually using this, right? If you have hundreds of bundles, you would need to rewrap all those bundles. (Or maybe I&apos;m missing something).&lt;br/&gt;
Where on the other hand, we could simply say, if you&apos;re using the 1.3 NS, the ds.factory.enabled flag has no influence on your component anymore - which my patch does. And this simply ensures, old bundles work as is, new bundles work as expected as well.&lt;/p&gt;</comment>
                            <comment id="14207471" author="djencks" created="Wed, 12 Nov 2014 01:11:15 +0000"  >&lt;p&gt;I&apos;m having trouble reading your patch in my web browser, so it might possibly already do what I&apos;m going to propose:&lt;/p&gt;

&lt;p&gt;&amp;#8211; for pre-1.3 components, either the global flag or the attribute will turn on the obsolete behavior&lt;/p&gt;

&lt;p&gt;&amp;#8211; for 1.3 components, the global flag has no effect&lt;/p&gt;

&lt;p&gt;&amp;#8211; for 1.3 components, using the attribute fails verification.&lt;/p&gt;

&lt;p&gt;We could remove the attribute, but I think it might be useful for someone interested in gradually removing/rewriting obsolete components.  If you feel strongly about this and want to remove the attribute, I won&apos;t object.&lt;/p&gt;</comment>
                            <comment id="14207480" author="cziegeler" created="Wed, 12 Nov 2014 01:23:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=djencks&quot; class=&quot;user-hover&quot; rel=&quot;djencks&quot;&gt;djencks&lt;/a&gt; My patch does point 1 and 2, but actually not 3 yet. I&apos;ll implement that one in addition, then. And I don&apos;t think we need to remove the attribute. Thanks!&lt;/p&gt;</comment>
                            <comment id="14207501" author="cziegeler" created="Wed, 12 Nov 2014 01:37:04 +0000"  >&lt;p&gt;Fixed as outlined above&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2254f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>