<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:14:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1812] deadlock on System.exit()</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1812</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;A deadlock occurs if System.exit() is called during startup of the Apache Framework.&lt;/p&gt;

&lt;p&gt;additional information:&lt;/p&gt;

&lt;p&gt;We call System.exit() during the BundleActivator.start(BundleContext) method. &lt;/p&gt;

&lt;p&gt;I will include a stacktrace and an example felix framework for reproduction.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12439143">FELIX-1812</key>
            <summary>deadlock on System.exit()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="karlpauls">Karl Pauls</assignee>
                                    <reporter username="dennisg">Dennis Geurts</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Oct 2009 08:32:08 +0000</created>
                <updated>Fri, 24 Feb 2017 12:41:54 +0000</updated>
                            <resolved>Fri, 24 Feb 2017 12:41:54 +0000</resolved>
                                    <version>framework-2.0.1</version>
                                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12770423" author="dennisg" created="Tue, 27 Oct 2009 08:36:38 +0000"  >&lt;p&gt;Please find a configured felix framework for reproduction. It should be possible to untar it, enter the expanded directory, then run using &apos;java -jar bin/felix.jar&apos;&lt;/p&gt;

&lt;p&gt;trace.log contains the stacktrace.&lt;br/&gt;
Activator.java is the source file, included in the net.luminis.launchtest bundle&lt;/p&gt;</comment>
                            <comment id="12770675" author="karlpauls" created="Tue, 27 Oct 2009 22:17:24 +0000"  >&lt;p&gt;Looking at the stacktrace it looks to me like you are calling System.exit() inside the Activator.start() method of one of your bundles. This is just nothing you should ever do but if so, then you basically have two options to make this work without the deadlock. &lt;/p&gt;

&lt;p&gt;1) You can disable the shutdown hook we have in our launcher by using -Dfelix.shutdown.hook=false&lt;/p&gt;

&lt;p&gt;2) Do the call to System.exit() asynchronously i.e., fork another thread inside your activator to do the deed.&lt;/p&gt;

&lt;p&gt;I will close this issue as invalid for now. Please reopen in case you disagree&lt;/p&gt;</comment>
                            <comment id="12770818" author="dennisg" created="Wed, 28 Oct 2009 07:47:56 +0000"  >&lt;p&gt;I&apos;m reopening this is issue because I think one should be able to call System.exit / SystemBundle.stop anytime.&lt;/p&gt;

&lt;p&gt;Furthermore: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;As mentioned in a previous comment by karlp: &quot;this is something one should never do&quot;: I wonder why, I haven&apos;t&lt;br/&gt;
  found any clue in the spec that validates this remark. This btw also immediately disqualifies calling System.exit in the constructor of a service,&lt;br/&gt;
  if you are using the dependency manager, the init, start, stop, destroy callbacks. If you use a ServiceTracker, his callbacks are also &lt;br/&gt;
  &quot;out of bounds&quot;. It becomes less and less clear to me where one will be able to call System.exit such that it &lt;em&gt;immediately&lt;/em&gt; stops the java process&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If I replace the System.exit call with the more osgi-friendly call: SystemBundle.stop() the same deadlock occurs.&lt;br/&gt;
  the spec is more clear about this: It poses no restrictions as to where one is &apos;allowed&apos; to call this method. Also the spec&lt;br/&gt;
  says the following: &lt;br/&gt;
     1. The system bundle enters the STOPPING state.&lt;br/&gt;
     (great, I like that!)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     2. All ACTIVE bundles are stopped as described in the Bundle.stop method, except that their persistently recorded state indicates that they must be restarted &lt;br/&gt;
     when the Framework is next started...&lt;br/&gt;
     (this is exactly the behavior I want: all bundles that have been started up to that moment must stop, and bundle that haven&apos;t been started yet do not get started)&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Doing this asynchronously does not prevent other bundles from being started. This is something I definitely do not want.&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12770845" author="karlpauls" created="Wed, 28 Oct 2009 09:22:33 +0000"  >&lt;p&gt;If you want calls to System.exit from a bundleactivator.start to work then you will have to disable the shutdown hook if you are using our launcher. This has nothing to do with the framework but with the shutdownhook in the launcher and that can be disabled. &lt;/p&gt;

&lt;p&gt;If you are seeing a deadlock in a call to systembundle.stop then this is an issue but it is not related to the shutdown hook and the system.exit. Please create a new issue and attach a stacktrace on that one where it shows that systembundle.stop does deadlock when called during startup from a bundleactivator.start and I will look into it. It can not be the same stacktrace as with the system.exit (as that is not being called anymore right &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="12771954" author="karlpauls" created="Fri, 30 Oct 2009 14:28:50 +0000"  >&lt;p&gt;Reopen this issue as closer investigation releated to &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1816&quot; title=&quot;deadlock on SystemBundle.stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1816&quot;&gt;&lt;del&gt;FELIX-1816&lt;/del&gt;&lt;/a&gt; indicates a different result. &lt;/p&gt;</comment>
                            <comment id="12771960" author="karlpauls" created="Fri, 30 Oct 2009 14:42:18 +0000"  >&lt;p&gt;As a side effect, &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1816&quot; title=&quot;deadlock on SystemBundle.stop()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1816&quot;&gt;&lt;del&gt;FELIX-1816&lt;/del&gt;&lt;/a&gt; makes it possible again to call System.exit inside an activator.start method while the framework is still in the STARTING state. However, the framework will not be shutdown when the jvm exits.&lt;/p&gt;

&lt;p&gt;Please close this issue if the current trunk works for you.&lt;/p&gt;</comment>
                            <comment id="12772055" author="dennisg" created="Fri, 30 Oct 2009 19:34:01 +0000"  >&lt;p&gt;Excellent, this is what I want. &lt;/p&gt;

&lt;p&gt;As a sidenote:&lt;/p&gt;

&lt;p&gt;Calling System.exit() during activation of a bundle is not something we do regularly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. In this specific case, the bundle calling&lt;br/&gt;
System.exit() is part of a more elaborate licensing scheme. If we detect a situation where no valid license can be obtained, we really&lt;br/&gt;
&lt;em&gt;do&lt;/em&gt; want to (be able to) exit the java process immediately. It is therefore sub-optimal to say the least to delay the exit until after the complete framework&lt;br/&gt;
has come up, or to delegate this to another thread (for obvious reasons).&lt;/p&gt;

&lt;p&gt;Great that this functionality has become been made  available!&lt;/p&gt;</comment>
                            <comment id="12772339" author="karlpauls" created="Sun, 1 Nov 2009 16:40:01 +0000"  >&lt;p&gt;I re-open this issue as I really don&apos;t like the solution (and it makes various other cases fail). I will have to get back to this and fix it correctly by introducing timeouts or something. The result for this case would be the same I imagine but for now i will rollback.&lt;/p&gt;</comment>
                            <comment id="14200089" author="cziegeler" created="Thu, 6 Nov 2014 11:24:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=karlpauls&quot; class=&quot;user-hover&quot; rel=&quot;karlpauls&quot;&gt;karlpauls&lt;/a&gt; This is a pretty old issue, is it still current?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12423298" name="Activator.java" size="534" author="dennisg" created="Tue, 27 Oct 2009 08:36:38 +0000"/>
                            <attachment id="12423296" name="felix-framework-2.0.1.tar.gz" size="425885" author="dennisg" created="Tue, 27 Oct 2009 08:36:38 +0000"/>
                            <attachment id="12423297" name="trace.log" size="7308" author="dennisg" created="Tue, 27 Oct 2009 08:36:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1arwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>270987</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>