<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:09:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-962] Erroneous class loading delegation to the application launcher classloader in some cases</title>
                <link>https://issues.apache.org/jira/browse/FELIX-962</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Here is an example stack trace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ProcessStoreImpl-1@50 daemon, priority=5, in group &lt;span class=&quot;code-quote&quot;&gt;&apos;main&apos;&lt;/span&gt;, status: &lt;span class=&quot;code-quote&quot;&gt;&apos;RUNNING&apos;&lt;/span&gt;
	  at org.apache.felix.framework.searchpolicy.ModuleImpl.searchDynamicImports(ModuleImpl.java:1,215)
	  at org.apache.felix.framework.searchpolicy.ModuleImpl.findClassOrResourceByDelegation(ModuleImpl.java:558)
	  at org.apache.felix.framework.searchpolicy.ModuleImpl.access$100(ModuleImpl.java:59)
	  at org.apache.felix.framework.searchpolicy.ModuleImpl$ModuleClassLoader.loadClass(ModuleImpl.java:1,382)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:251)
	  at org.apache.felix.framework.searchpolicy.ModuleImpl.getClassByDelegation(ModuleImpl.java:428)
	  at org.apache.felix.framework.Felix.loadBundleClass(Felix.java:1,341)
	  at org.apache.felix.framework.BundleImpl.loadClass(BundleImpl.java:737)
	  at org.springframework.osgi.util.BundleDelegatingClassLoader.findClass(BundleDelegatingClassLoader.java:99)
	  at org.springframework.osgi.util.BundleDelegatingClassLoader.loadClass(BundleDelegatingClassLoader.java:156)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:251)
	  at org.apache.xbean.classloader.MultiParentClassLoader.loadClass(MultiParentClassLoader.java:184)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:251)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClassInternal(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:374)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.defineClass1(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:-1)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.defineClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:675)
	  at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:124)
	  at java.net.URLClassLoader.defineClass(URLClassLoader.java:260)
	  at java.net.URLClassLoader.access$100(URLClassLoader.java:56)
	  at java.net.URLClassLoader$1.run(URLClassLoader.java:195)
	  at java.security.AccessController.doPrivileged(AccessController.java:-1)
	  at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
	  at org.apache.xbean.classloader.MultiParentClassLoader.loadClass(MultiParentClassLoader.java:200)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:251)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClassInternal(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:374)
	  at org.apache.openjpa.util.ProxyMaps.afterEntrySet(ProxyMaps.java:74)
	  at org.apache.openjpa.util.java$util$HashMap$proxy.entrySet(Unknown Source:-1)
	  at org.apache.openjpa.util.ProxyMaps.values(ProxyMaps.java:65)
	  at org.apache.openjpa.util.java$util$HashMap$proxy.values(Unknown Source:-1)
	  at org.apache.openjpa.kernel.SingleFieldManager.delete(SingleFieldManager.java:335)
	  at org.apache.openjpa.kernel.SingleFieldManager.delete(SingleFieldManager.java:283)
	  at org.apache.openjpa.kernel.StateManagerImpl.cascadeDelete(StateManagerImpl.java:2,861)
	  at org.apache.openjpa.kernel.BrokerImpl.delete(BrokerImpl.java:2,566)
	  at org.apache.openjpa.kernel.SingleFieldManager.delete(SingleFieldManager.java:387)
	  at org.apache.openjpa.kernel.SingleFieldManager.delete(SingleFieldManager.java:372)
	  at org.apache.openjpa.kernel.SingleFieldManager.delete(SingleFieldManager.java:329)
	  at org.apache.openjpa.kernel.SingleFieldManager.delete(SingleFieldManager.java:283)
	  at org.apache.openjpa.kernel.StateManagerImpl.cascadeDelete(StateManagerImpl.java:2,861)
	  at org.apache.openjpa.kernel.BrokerImpl.delete(BrokerImpl.java:2,566)
	  at org.apache.openjpa.kernel.BrokerImpl.delete(BrokerImpl.java:2,531)
	  at org.apache.openjpa.kernel.DelegatingBroker.delete(DelegatingBroker.java:1,046)
	  at org.apache.openjpa.persistence.EntityManagerImpl.remove(EntityManagerImpl.java:659)
	  at org.apache.ode.store.jpa.JpaObj.delete(JpaObj.java:34)
	  at org.apache.ode.store.jpa.DeploymentUnitDaoImpl.delete(DeploymentUnitDaoImpl.java:114)
	  at org.apache.ode.store.ProcessStoreImpl$3.call(ProcessStoreImpl.java:303)
	  at org.apache.ode.store.ProcessStoreImpl$3.call(ProcessStoreImpl.java:300)
	  at org.apache.ode.store.ProcessStoreImpl$Callable.call(ProcessStoreImpl.java:701)
	  at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:269)
	  at java.util.concurrent.FutureTask.run(FutureTask.java:123)
	  at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)
	  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)
	  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:613)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The interesting bit is the following exerpt:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	  at java.net.URLClassLoader$1.run(URLClassLoader.java:195)
	  at java.security.AccessController.doPrivileged(AccessController.java:-1)
	  at java.net.URLClassLoader.findClass(URLClassLoader.java:188)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The current code in ModuleImpl#searchDynamicImports() does not really handle this case.  The reason is that the &lt;tt&gt;java.net.URLClassLoader$1&lt;/tt&gt; class is an anonymous PrivilegedExceptionAction.&lt;br/&gt;
The result is that the loop is aborted too soon and the launcher classloader is used to delegate the call.   In my application, it leads to all kinds of LinkageError being thrown.&lt;/p&gt;

&lt;p&gt;Note that this problem mostly happen on macs, which has a weird thing in the classloader, trying to handle some org.apache.crimson / org.apache.xalan / org.apache.xml / org.apache.xpath in some weird way.&lt;br/&gt;
Anyway, I have a patch to support this anonymous classes I will attach now.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12415644">FELIX-962</key>
            <summary>Erroneous class loading delegation to the application launcher classloader in some cases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="gnodet">Guillaume Nodet</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Feb 2009 08:32:39 +0000</created>
                <updated>Thu, 12 Mar 2009 20:08:48 +0000</updated>
                            <resolved>Thu, 12 Mar 2009 19:52:17 +0000</resolved>
                                                    <fixVersion>framework-1.6.0</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12676920" author="mcculls" created="Thu, 26 Feb 2009 08:51:03 +0000"  >&lt;p&gt;isn&apos;t getEnclosingClass a Java 5 method?&lt;/p&gt;</comment>
                            <comment id="12676921" author="mcculls" created="Thu, 26 Feb 2009 08:52:48 +0000"  >&lt;p&gt;Perhaps getDeclaringClass would be better - could you see if that also fixes the problem?&lt;/p&gt;</comment>
                            <comment id="12676926" author="mcculls" created="Thu, 26 Feb 2009 08:58:20 +0000"  >&lt;p&gt;dang, anonymous inner classes aren&apos;t defined to be part of the class where they appear (as they aren&apos;t really &quot;declared&quot; with a name)&lt;/p&gt;

&lt;p&gt;so, what to do... use reflection to see if getEnclosingClass is available, or use some other technique to get the enclosing class (ie. chop off the $ part) ?&lt;/p&gt;</comment>
                            <comment id="12676955" author="gnt" created="Thu, 26 Feb 2009 10:35:03 +0000"  >&lt;p&gt;Argh, I had not paid attention to that.&lt;br/&gt;
I suppose using reflection will not fix the problem on Java 4, so maybe removing the $ part could work.&lt;br/&gt;
Let me try that.&lt;/p&gt;</comment>
                            <comment id="12676957" author="gnt" created="Thu, 26 Feb 2009 10:56:25 +0000"  >&lt;p&gt;This other patch seems to work too and avoids the Java 5 call.&lt;/p&gt;</comment>
                            <comment id="12677417" author="gnt" created="Fri, 27 Feb 2009 16:59:12 +0000"  >&lt;p&gt;Are you guys happy with this patch or should I try something else ?&lt;/p&gt;</comment>
                            <comment id="12677418" author="rickhall" created="Fri, 27 Feb 2009 17:02:30 +0000"  >&lt;p&gt;I have been stuck working on a different issue, so I haven&apos;t really looked at it. It is probably ok, we just need some time to review and apply it.&lt;/p&gt;</comment>
                            <comment id="12678326" author="rickhall" created="Tue, 3 Mar 2009 14:31:23 +0000"  >&lt;p&gt;Guillaume, could you try my patch against trunk and see if it resolves your issue. It is basically just your patch moved into the existing &apos;if&apos; statement. If it works, then I will apply it. Thanks.&lt;/p&gt;</comment>
                            <comment id="12678707" author="gnt" created="Wed, 4 Mar 2009 11:46:13 +0000"  >&lt;p&gt;RIchard, the problem with your patch is that an NPE can be thrown because classes&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.getClassLoader() can be null if the class has been loaded from the system class loader.&lt;/p&gt;


&lt;p&gt;After modifying the test to guard against this NPE, I&apos;ve hit another one which was caused by the loadClass() returning null as a result of ModuleImpl#getClassByDelegation() returning null.&lt;br/&gt;
After removing this NPE,&lt;/p&gt;


&lt;p&gt;Caused by: java.lang.StackOverflowError&lt;br/&gt;
at sun.security.provider.PolicyFile.implies(PolicyFile.java:1170)&lt;br/&gt;
at java.security.ProtectionDomain.implies(ProtectionDomain.java:195)&lt;br/&gt;
at java.security.AccessControlContext.checkPermission(AccessControlContext.java:249)&lt;br/&gt;
at java.security.AccessController.checkPermission(AccessController.java:427)&lt;br/&gt;
at java.lang.SecurityManager.checkPermission(SecurityManager.java:532)&lt;br/&gt;
at org.apache.felix.framework.BundleImpl.loadClass(BundleImpl.java:728)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.findClass(BundleDelegatingClassLoader.java:99)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.loadClass(BundleDelegatingClassLoader.java:156)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.xbean.classloader.MultiParentClassLoader.loadClass(MultiParentClassLoader.java:184)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.searchDynamicImports(ModuleImpl.java:1218)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.findClassOrResourceByDelegation(ModuleImpl.java:558)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.access$100(ModuleImpl.java:59)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl$ModuleClassLoader.loadClass(ModuleImpl.java:1377)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.getClassByDelegation(ModuleImpl.java:428)&lt;br/&gt;
at org.apache.felix.framework.Felix.loadBundleClass(Felix.java:1343)&lt;br/&gt;
at org.apache.felix.framework.BundleImpl.loadClass(BundleImpl.java:737)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.findClass(BundleDelegatingClassLoader.java:99)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.loadClass(BundleDelegatingClassLoader.java:156)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.xbean.classloader.MultiParentClassLoader.loadClass(MultiParentClassLoader.java:184)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.searchDynamicImports(ModuleImpl.java:1218)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.findClassOrResourceByDelegation(ModuleImpl.java:558)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.access$100(ModuleImpl.java:59)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl$ModuleClassLoader.loadClass(ModuleImpl.java:1377)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.loadClass(BundleDelegatingClassLoader.java:160)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.xbean.classloader.MultiParentClassLoader.loadClass(MultiParentClassLoader.java:184)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.searchDynamicImports(ModuleImpl.java:1218)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.findClassOrResourceByDelegation(ModuleImpl.java:558)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.access$100(ModuleImpl.java:59)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl$ModuleClassLoader.loadClass(ModuleImpl.java:1377)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.loadClass(BundleDelegatingClassLoader.java:160)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.xbean.classloader.MultiParentClassLoader.loadClass(MultiParentClassLoader.java:184)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.searchDynamicImports(ModuleImpl.java:1218)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.findClassOrResourceByDelegation(ModuleImpl.java:558)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.access$100(ModuleImpl.java:59)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl$ModuleClassLoader.loadClass(ModuleImpl.java:1377)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.loadClass(BundleDelegatingClassLoader.java:160)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.xbean.classloader.MultiParentClassLoader.loadClass(MultiParentClassLoader.java:184)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.searchDynamicImports(ModuleImpl.java:1218)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.findClassOrResourceByDelegation(ModuleImpl.java:558)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl.access$100(ModuleImpl.java:59)&lt;br/&gt;
at org.apache.felix.framework.searchpolicy.ModuleImpl$ModuleClassLoader.loadClass(ModuleImpl.java:1377)&lt;br/&gt;
at java.lang.ClassLoader.loadClass(ClassLoader.java:251)&lt;br/&gt;
at org.springframework.osgi.util.BundleDelegatingClassLoader.loadClass(BundleDelegatingClassLoader.java:160)&lt;/p&gt;

&lt;p&gt;I&apos;m investigating a bit more&lt;/p&gt;</comment>
                            <comment id="12678708" author="gnt" created="Wed, 4 Mar 2009 11:48:49 +0000"  >&lt;p&gt;Richard, attached is a modified version of your patch which guards against NullPointerExceptions and avoid a stack overflow by moving the cycling check in findClassOrResourceByDelegation.&lt;br/&gt;
This patch seems to work great for me.&lt;/p&gt;</comment>
                            <comment id="12678717" author="gnt" created="Wed, 4 Mar 2009 12:43:35 +0000"  >&lt;p&gt;This patch should be slightly faster and avoids multiple calls to loadClass / lastIndexOf.&lt;br/&gt;
Also a bit easier to read imho.&lt;/p&gt;</comment>
                            <comment id="12678754" author="rickhall" created="Wed, 4 Mar 2009 15:09:13 +0000"  >&lt;p&gt;Excellent patches, Guillaume. I have uploaded a slightly refactored version of your patch. I don&apos;t think I changed any of the substance, but could you please check it again to verify it is ok. Thanks.&lt;/p&gt;</comment>
                            <comment id="12678774" author="gnt" created="Wed, 4 Mar 2009 16:32:22 +0000"  >&lt;p&gt;Weird, with your patch, I end up with the following exception:&lt;br/&gt;
   java.lang.LinkageError: duplicate class definition: org/apache/openjpa/kernel/jpql/JPQLExpressionBuilder&lt;br/&gt;
I&apos;ll try to investigate...&lt;/p&gt;</comment>
                            <comment id="12678777" author="rickhall" created="Wed, 4 Mar 2009 16:37:49 +0000"  >&lt;p&gt;Odd, considering I really didn&apos;t try to change it.&lt;/p&gt;

&lt;p&gt;That error typically occurs because the call to defineClass() is not properly guarded with synchronization when it checks to verify whether the class was already loaded or not before defining the class.&lt;/p&gt;

&lt;p&gt;Felix actually checks twice if a class is loaded already, once at the beginning and then once again before defining the class.&lt;/p&gt;</comment>
                            <comment id="12678782" author="rickhall" created="Wed, 4 Mar 2009 16:44:45 +0000"  >&lt;p&gt;It is because it no longer returns null in the case of a detected cycle?&lt;/p&gt;

&lt;p&gt;In findClassOrResourceByDelegation(), add:&lt;/p&gt;

&lt;p&gt;    else&lt;/p&gt;
    {
        return null;
    }

&lt;p&gt;To the &quot;if (requestSet.add(name))&quot; statement and see if that makes a difference, since that is the only content change I really made. This will have it return null in the case of a detected cycle, but throw an exception in all other cases.&lt;/p&gt;

&lt;p&gt;If this makes a difference, then we will have to think about it to make sure it is correct.&lt;/p&gt;</comment>
                            <comment id="12678785" author="gnt" created="Wed, 4 Mar 2009 16:53:27 +0000"  >&lt;p&gt;Yes, i&apos;ve spotted the problem.  It comes from the fact that if the class / resource to be searched is already in the cycleCheck set, the method should return null and not throw an exception.&lt;/p&gt;

&lt;p&gt;The attached patched is a modified version of yours which fix the problem.&lt;/p&gt;</comment>
                            <comment id="12678791" author="rickhall" created="Wed, 4 Mar 2009 17:04:55 +0000"  >&lt;p&gt;Not to completely beat this dead horse, but I uploaded hopefully the final version of the patch. My original intent with my last patch was to eliminate some of the internal return statements in the method to make it a little clearer what the return result was by having most returns at the end of the method. So, this last patch just attempts to implement that again. Please let me know if it works, so we can put this to bed. Thanks for your assistance.&lt;/p&gt;</comment>
                            <comment id="12678798" author="gnt" created="Wed, 4 Mar 2009 17:22:26 +0000"  >&lt;p&gt;This one works for me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12678814" author="rickhall" created="Wed, 4 Mar 2009 17:57:49 +0000"  >&lt;p&gt;Excellent. I just committed the patch, please close if you are satisfied.&lt;/p&gt;</comment>
                            <comment id="12678826" author="gnt" created="Wed, 4 Mar 2009 18:31:23 +0000"  >&lt;p&gt;Thanks !&lt;/p&gt;</comment>
                            <comment id="12681102" author="gnt" created="Wed, 11 Mar 2009 23:55:07 +0000"  >&lt;p&gt;I have found a small problem with the current code. I will attach a patch&lt;/p&gt;</comment>
                            <comment id="12681103" author="gnt" created="Wed, 11 Mar 2009 23:57:37 +0000"  >&lt;p&gt;The attached patch fixes two problems:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the first one which happen when the class is loaded from the boot classloader (in which case, we now use the system classloader to load the enclosing class)&lt;/li&gt;
	&lt;li&gt;the second one which is the fact that all kind of linkage errors can happen when loading the class and this would really disturb the classloader correct behavior&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12681334" author="rickhall" created="Thu, 12 Mar 2009 14:34:38 +0000"  >&lt;p&gt;Make me wonder if we are doing the right thing here, because you are correct, it is not a good idea to try to do a class load in the middle of doing a class load.&lt;/p&gt;</comment>
                            <comment id="12681395" author="rickhall" created="Thu, 12 Mar 2009 17:02:31 +0000"  >&lt;p&gt;Guillaume, in an effort to lessen the possibility of receiving class loading errors, I modified the patch to use getEnclosingClass() if it is available and to use the manual approach if it is not. What do you think? Please test to see if this resolves the situation for you. Thanks.&lt;/p&gt;</comment>
                            <comment id="12681449" author="gnt" created="Thu, 12 Mar 2009 19:00:46 +0000"  >&lt;p&gt;Your patch does not work because it calls &lt;br/&gt;
   clazz.getMethod(&quot;getEnclosingClass&quot;)&lt;br/&gt;
instead of&lt;br/&gt;
   Class.class.getMethod(&quot;getEnclosingClass&quot;)&lt;/p&gt;

&lt;p&gt;The attached patch fix this issue and works great for me.&lt;br/&gt;
I&apos;ve also slightly modified the patch to cache the method.&lt;/p&gt;</comment>
                            <comment id="12681462" author="rickhall" created="Thu, 12 Mar 2009 19:52:16 +0000"  >&lt;p&gt;Ok, I applied the patch. I made your cache variables volatile so we don&apos;t have to synchronize access to them for different threads. Please close this issue (again) if you are satisfied. Thanks.&lt;/p&gt;</comment>
                            <comment id="12681467" author="gnt" created="Thu, 12 Mar 2009 20:08:48 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12401018" name="FELIX-962-bis.patch" size="1331" author="gnodet" created="Thu, 26 Feb 2009 10:55:59 +0000"/>
                            <attachment id="12402081" name="FELIX-962-newerer.patch" size="3763" author="gnodet" created="Thu, 12 Mar 2009 19:00:46 +0000"/>
                            <attachment id="12401404" name="FELIX-962-quarter.patch" size="7190" author="gnodet" created="Wed, 4 Mar 2009 12:43:35 +0000"/>
                            <attachment id="12401415" name="FELIX-962-quinquies.patch" size="14195" author="rickhall" created="Wed, 4 Mar 2009 15:08:18 +0000"/>
                            <attachment id="12401315" name="FELIX-962-richard.txt" size="3442" author="rickhall" created="Tue, 3 Mar 2009 14:29:49 +0000"/>
                            <attachment id="12401422" name="FELIX-962-septies.patch" size="14462" author="rickhall" created="Wed, 4 Mar 2009 17:02:24 +0000"/>
                            <attachment id="12401421" name="FELIX-962-sexies.patch" size="14900" author="gnodet" created="Wed, 4 Mar 2009 16:53:27 +0000"/>
                            <attachment id="12401403" name="FELIX-962-ter.patch" size="6396" author="gnodet" created="Wed, 4 Mar 2009 11:48:49 +0000"/>
                            <attachment id="12401990" name="FELIX-962.new.patch" size="1607" author="gnodet" created="Wed, 11 Mar 2009 23:57:36 +0000"/>
                            <attachment id="12402059" name="FELIX-962.newer.patch" size="3486" author="rickhall" created="Thu, 12 Mar 2009 17:03:23 +0000"/>
                            <attachment id="12401002" name="FELIX-962.patch" size="1133" author="gnodet" created="Thu, 26 Feb 2009 08:33:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58028</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 37 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vwfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184227</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>