<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:52:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-2774] HTTP Servlet RequestDispatcher &apos;forward&apos; has invalid request pathInfo</title>
                <link>https://issues.apache.org/jira/browse/FELIX-2774</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I&apos;m trying to have one servlet forward to another servlet.  However, the forwarding doesn&apos;t seem to work.&lt;/p&gt;

&lt;p&gt;I&apos;ve set up the proxy servlet in my web.xml as follows (and this is the only servlet...no filters defined)&lt;/p&gt;

&lt;p&gt;    &amp;lt;servlet&amp;gt;&lt;br/&gt;
        &amp;lt;servlet-name&amp;gt;osgi-servlet-bridge&amp;lt;/servlet-name&amp;gt;&lt;br/&gt;
        &amp;lt;servlet-class&amp;gt;org.apache.felix.http.proxy.ProxyServlet&amp;lt;/servlet-class&amp;gt;&lt;br/&gt;
        &amp;lt;load-on-startup&amp;gt;1&amp;lt;/load-on-startup&amp;gt;&lt;br/&gt;
    &amp;lt;/servlet&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;servlet-mapping&amp;gt;&lt;br/&gt;
        &amp;lt;servlet-name&amp;gt;osgi-servlet-bridge&amp;lt;/servlet-name&amp;gt;&lt;br/&gt;
        &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;&lt;br/&gt;
    &amp;lt;/servlet-mapping&amp;gt;&lt;/p&gt;


&lt;p&gt;I then have two bundles, each registers a servlet under a different path (e.g. bundle A registers under alias &apos;/a&apos; and bundle B registers under alias &apos;/b&apos;) using the whiteboard pattern.  The implementation of servlet A ends up doing this:&lt;/p&gt;

&lt;p&gt;RequestDispatcher rd = request.getRequestDispatcher(&quot;/b/some/path&quot;);&lt;br/&gt;
rd.forward(request, response);&lt;/p&gt;

&lt;p&gt;This finds the ServletHandler for servlet B just fine, but gets hung up in the &apos;handle&apos; method. I think this is due to the implementation of the internal RequestWrapper class in the ServletPipeline class.  This implementation overrides the getRequestURI method with the passed in value.  However, ServletHandler.handle passed the result of HttpServletRequest.getPathInfo() to the &apos;matches&apos; method as a final check to make sure that the servlet should be invoked.  Since the RequestWrapper class does not override getPathInfo, it returns the value from the original request....which is &apos;/a&apos; in my example.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12495299">FELIX-2774</key>
            <summary>HTTP Servlet RequestDispatcher &apos;forward&apos; has invalid request pathInfo</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dhay">David Hay</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Jan 2011 21:11:44 +0000</created>
                <updated>Fri, 13 Jun 2014 09:27:16 +0000</updated>
                            <resolved>Wed, 12 Feb 2014 08:28:41 +0000</resolved>
                                    <version>http-2.0.4</version>
                                                    <component>HTTP Service</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12980548" author="fmeschbe" created="Wed, 12 Jan 2011 04:27:17 +0000"  >&lt;p&gt;Actually, neither forward nor include are really properly implemented in that both do not set the required request attributes.&lt;/p&gt;

&lt;p&gt;In addition the forward method to overwrite the getRequestURI method with the forward target looks wrong to me, too, because these methods should always return the same value. It is the request attributes baring the new path strings.&lt;/p&gt;

&lt;p&gt;In addtion on forward or include the HttpContext.handleSecurity method is probably not to be called any more ...&lt;/p&gt;</comment>
                            <comment id="12980556" author="fmeschbe" created="Wed, 12 Jan 2011 04:45:45 +0000"  >&lt;p&gt;Simple patch against the HTTP Base module:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Removes the Request Wrapper overwriting getRequestURI method from the game&lt;/li&gt;
	&lt;li&gt;Adds a ServletHandler.handleInclude method which calls the Servlet&apos;s service method&lt;br/&gt;
      without the ServletHandlerRequestWrapper (on the grounds that the path related getter&lt;br/&gt;
      methods must return the same values)&lt;/li&gt;
	&lt;li&gt;Adds a resetBuffer() call to the forward method&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;What&apos;s still missing is the management of the request attributes mandated by the Servlet API specification&lt;/p&gt;

&lt;p&gt;Shall we go this route ? Any takers to hack on the request attribute provisioning ?&lt;/p&gt;</comment>
                            <comment id="12985613" author="fmeschbe" created="Mon, 24 Jan 2011 10:46:32 +0000"  >&lt;p&gt;Attaching correct patch this time&lt;/p&gt;</comment>
                            <comment id="13898917" author="jajans" created="Wed, 12 Feb 2014 08:28:41 +0000"  >&lt;p&gt;Stumbled on this while doing some tests with the new Servlet 3.0 API provided by the Jetty 8 upgrade.&lt;/p&gt;

&lt;p&gt;Implemented support for proper forward and include requests in Servlets, including some itests to verify this behaviour. Have to take a look at how this works using Filters.&lt;/p&gt;

&lt;p&gt;See rev #1567561.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12538301">FELIX-3304</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12697842">FELIX-4440</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12469139" name="FELIX-2774-simple.patch" size="2915" author="fmeschbe" created="Mon, 24 Jan 2011 10:46:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56153</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1atqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>271283</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>