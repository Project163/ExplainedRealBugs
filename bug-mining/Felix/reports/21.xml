<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:04:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-169] Shutdown of Felix through Felix.shutdown() does not call custom activator stop methods</title>
                <link>https://issues.apache.org/jira/browse/FELIX-169</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When starting Felix through Felix.start() a list of BundleActivator objects may be handed in. Additionally, the SystemBundle adds some more BundleActivators (e.g. the URLHandlersActivator. When stopping Felix through the SystemBundle.stop() method, a separate thread is started, which calls the Felix.shutdown() method, which ultimately calls back into the SystemBundle.stop() method, which now - amongst other things - calls the BundleActivator.stop() method of the additional BundleActivators.&lt;/p&gt;

&lt;p&gt;If shutting Felix down through Felix.shutdown() directly, a separate thread is not started, and hence the BundleActivator.stop() methods are not called.&lt;/p&gt;

&lt;p&gt;I assume, the test for the m_shutdownThread field in the SystemBundle.stop method is superfluous as this field is only set then Felix is stopped through the system bundle.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12354581">FELIX-169</key>
            <summary>Shutdown of Felix through Felix.shutdown() does not call custom activator stop methods</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Nov 2006 14:58:53 +0000</created>
                <updated>Tue, 7 Nov 2006 07:56:38 +0000</updated>
                            <resolved>Tue, 7 Nov 2006 07:51:47 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12446880" author="fmeschbe" created="Fri, 3 Nov 2006 09:26:54 +0000"  >&lt;p&gt;Attached is a patch, which also should fix a symetry issue: If the framework is shut down through the Framework.shutdown() method by the application, the SystemBundle.stop method does not start a separate thread, which at the end terminates the VM if not embedded.&lt;/p&gt;

&lt;p&gt;The patch creates a new Felix.shutdownInternal() method, which is called by the SystemBundle.stop() method. The Felix.shutdown() method just calls the getBundle(0).stop() method, which then takes care to start the separate thread, call the Felix.shutdownInternal() method and finally terminating the VM if not embedded.&lt;/p&gt;

&lt;p&gt;There is one catch, though: This patch causes the framework to shutdown asynchronously also for Felix.shutdown(). This may be desired in terms of symetry - however I stop the framework, it always does it the same way - or it may not besired, as Felix.shutdown() should possibly be a synchronous operation.&lt;/p&gt;

&lt;p&gt;In the latter case, the Felix.shutdown() method should probably be extended to Thread.join() the shutdown thread.&lt;/p&gt;

&lt;p&gt;What do you think ? If so, I could provide a patch for this, too.&lt;/p&gt;</comment>
                            <comment id="12446958" author="rickhall" created="Fri, 3 Nov 2006 13:48:51 +0000"  >&lt;p&gt;I think you would want Felix.shutdown() to be synchronous.&lt;/p&gt;</comment>
                            <comment id="12447036" author="fmeschbe" created="Fri, 3 Nov 2006 18:25:45 +0000"  >&lt;p&gt;Allright, I will modify the patch to make Felix.shutdown() synchronous.&lt;/p&gt;</comment>
                            <comment id="12447381" author="fmeschbe" created="Mon, 6 Nov 2006 07:06:06 +0000"  >&lt;p&gt;Proposed patch with following additions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Felix.shutdown() method split into public Felix.shutdown() (checks status, calls Felix.shutdownInternal(), exits VM if not embedded) and private Felix.shutdownInternal() doing the rest of the work of the former Felix.shutdown() method.&lt;/li&gt;
	&lt;li&gt;SystemBundle.stop() method split into SystemBundle.stop() (just calls Felix.shutdown() in a separate thread if the framework is running) and SystemBundle.shutdown() (actually stops the SystemBundle)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The reasoning for these new methods is as follows:&lt;br/&gt;
   (1) Felix.shutdown() and SystemBundle.stop() should behave the same for a running framework: The framework should be shut down - albeit Felix.shutdown() works synchronously and SystemBundle.stop() must work asynchronously (according to the spec).&lt;br/&gt;
   (2) Calling Felix.shutdown() or SystemBundle.stop() (e.g. through context.getBundle(0).stop()) while the framework is shutting down should have no effect.&lt;br/&gt;
   (3) After taking the startlevel to zero, the SystemBundle must be regularly stopped, which primarily means stopping any BundleActivators started.&lt;/p&gt;

&lt;p&gt;With the former combined SystemBundle.stop() method, issue (2) could not be solved, as either the BundleActivators were never stopped (as no shutdown thread was started) or calling SystemBundle.stop() while the framework was being stopped would result in the BundleActivators being stopped to early.&lt;/p&gt;

&lt;p&gt;I split the Felix.shutdown() method just for source code complexity reasons: The framework shutdown should complete - with or without exception - and the the VM should be stopped no matter what if the framework is not embedded. Therefore, shutdown processing should be encapsulated by a try-catch statement.&lt;/p&gt;</comment>
                            <comment id="12447703" author="rickhall" created="Tue, 7 Nov 2006 07:51:47 +0000"  >&lt;p&gt;I have applied this patch.&lt;/p&gt;</comment>
                            <comment id="12447704" author="fmeschbe" created="Tue, 7 Nov 2006 07:56:38 +0000"  >&lt;p&gt;Thanks alot. Closing this issue then.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12344271" name="FELIX-169.diff" size="2404" author="fmeschbe" created="Fri, 3 Nov 2006 09:26:54 +0000"/>
                            <attachment id="12344377" name="FELIX-169_2.diff" size="6832" author="fmeschbe" created="Mon, 6 Nov 2006 07:06:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58814</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vxpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184436</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>