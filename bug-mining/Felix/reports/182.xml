<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:06:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-490] Deadlocks may be caused by Declarative Services</title>
                <link>https://issues.apache.org/jira/browse/FELIX-490</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;The Declarative Services implementation has an AbstractComponentManager class which implementa the lifecycles of components in methods like enable, activate, deactivate, disable and dispose. All methods come in two flavors an (private) internal on which is synchronized and executes the action and a public unsynchronized one calling the internal one on a separate thread.&lt;/p&gt;

&lt;p&gt;All internal methods are generally called only from the separate thread so are guaranteed to run sequentially on after the other due to the queing in the thread. One exception is the deactivate method which is always called directly and not in the separate thread. So a component may be deactivated while it is actually being activated. This is why the internal methods are synchronized - to delay a deactivation in case an activation already active.&lt;/p&gt;

&lt;p&gt;The problem is, that activate calls in to the framework to get at services or to register services. At the same time the deactivate method may be called from within the framework for example because a required or static dependency has been unregistered. This may now create a deadlock between the activate method trying to register a service and the service unregistration trying to call the deactivate method.&lt;/p&gt;

&lt;p&gt;The fix is to look at a more finegrained synchronization mechanism in the AbstractComponentManager.&lt;/p&gt;

&lt;p&gt;Similar behaviour is reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-489&quot; title=&quot;Intermittent deadlock while using declarative services in Tuscany   &quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-489&quot;&gt;&lt;del&gt;FELIX-489&lt;/del&gt;&lt;/a&gt;, which is currently analysed looking from the framework to the outside.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12388647">FELIX-490</key>
            <summary>Deadlocks may be caused by Declarative Services</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Feb 2008 10:07:27 +0000</created>
                <updated>Tue, 3 Jun 2008 10:26:12 +0000</updated>
                            <resolved>Tue, 3 Jun 2008 10:26:12 +0000</resolved>
                                    <version>framework-1.0.0</version>
                                    <fixVersion>scr-1.0.2</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12568854" author="fmeschbe" created="Thu, 14 Feb 2008 10:08:05 +0000"  >&lt;p&gt;Link to related issue&lt;/p&gt;</comment>
                            <comment id="12568855" author="fmeschbe" created="Thu, 14 Feb 2008 10:10:09 +0000"  >&lt;p&gt;Thread dump showing this deadlock. This dump has been attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/SLING-245&quot; title=&quot;After reinstalling sling core, server shutdown hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SLING-245&quot;&gt;&lt;del&gt;SLING-245&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12601885" author="fmeschbe" created="Tue, 3 Jun 2008 10:26:12 +0000"  >&lt;p&gt;In Rev. 662733 of the AbstractCompeontManager class I modified the deactivate() method to call the deactivateInternal immediately unless the component is currently being activated. In this case deactivation is scheduled for asynchronous execution and a info (Rev. 662734, was WARN initially) is printed.&lt;/p&gt;

&lt;p&gt;This should solve this deadlock, as the deactivateInternal method is only called from the separate thread and thus needs not waiting on the activateInternal method to finish, which in turn might be wait for the service registration event call causing the deactivation to terminate.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                            <outwardlinks description="is a clone of">
                                        <issuelink>
            <issuekey id="12388429">SLING-245</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12388521">FELIX-489</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12375569" name="threaddump.txt" size="24910" author="fmeschbe" created="Thu, 14 Feb 2008 10:10:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58497</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i140z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231620</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>