<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:13:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-6056] SCR exports promises</title>
                <link>https://issues.apache.org/jira/browse/FELIX-6056</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Apache Felix SCR exports promises 1.0 as a convenience.&#160;However, since this package contains the implementation it is a &lt;ins&gt;provider&lt;/ins&gt;. Originally, the import was correct for a provider, [1,1.1). however,&#160;last July it was increased to [1,2). This&#160;therefore against the semantic versioning specification that prescribes a minor import range when providing the implementation of an API.&lt;/p&gt;

&lt;p&gt;Exporting an package like Promises is not a good idea anyway. It is only a convenience, promises have nothing to do with SCR in itself and that will always back fire in the end. Even exporting it correctly causes unnecessary version constraints since the order of resolving cannot be controlled. So if you have Promises 1.1 it depends on the order of resolving if SCR uses 1.0 or 1.1 and it creates nasty class spaces.&lt;/p&gt;

&lt;p&gt;It is inconvenient to make SCR depend on Promises. Personally I would not have used promises or would have included the package privately. (No API of SCR depends on Promises) Since SCR is such a crucial base component I strongly&#160;recommend to not export it from SCR.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13215244">FELIX-6056</key>
            <summary>SCR exports promises</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tjwatson">Tom Watson</assignee>
                                    <reporter username="pkriens">Peter Kriens</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Feb 2019 13:13:55 +0000</created>
                <updated>Fri, 1 Mar 2019 14:26:41 +0000</updated>
                            <resolved>Fri, 15 Feb 2019 20:28:32 +0000</resolved>
                                                    <fixVersion>scr-2.1.16</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16766024" author="tjwatson" created="Tue, 12 Feb 2019 13:34:17 +0000"  >&lt;p&gt;Also see &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-6043&quot; title=&quot;ClassNotFoundException org.osgi.util.function.Function&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-6043&quot;&gt;&lt;del&gt;FELIX-6043&lt;/del&gt;&lt;/a&gt;.  I&apos;m perfectly fine having promises be imported.  But I will point out that SCR API DOES use promises with the following return types from:&lt;/p&gt;

&lt;p&gt;org.osgi.service.component.runtime.ServiceComponentRuntime.enableComponent(ComponentDescriptionDTO)&lt;br/&gt;
org.osgi.service.component.runtime.ServiceComponentRuntime.disableComponent(ComponentDescriptionDTO)&lt;/p&gt;

&lt;p&gt;And promises uses function.  Current versions of SCR release say they export function but they don&apos;t actually have any of the content from function.&lt;/p&gt;</comment>
                            <comment id="16766042" author="pkriens" created="Tue, 12 Feb 2019 13:55:24 +0000"  >&lt;p&gt;Yes, the API dependency is unfortunate since very few bundles use this class (let alone these rarely used methods). it is one of the few places where an OSGi spec references another spec than the framework. We always tried to keep these separate, which is imho good design. Not sure what happened here. The cost of not letting these functions use Promises would have been negligent.&lt;/p&gt;

&lt;p&gt;The reason they export functions as well is I assume that Promises needs requires them. Another good reason not to export a package that is not yours.&lt;/p&gt;</comment>
                            <comment id="16766579" author="tjwatson" created="Tue, 12 Feb 2019 23:34:54 +0000"  >&lt;p&gt;OK, I think we should change to not export promises or function (only import them).&lt;/p&gt;</comment>
                            <comment id="16766917" author="pkriens" created="Wed, 13 Feb 2019 08:19:43 +0000"  >&lt;p&gt;Come on Tom! That was way too easy, this way you spoil all the fun! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks a lot, any idea of a time frame?&lt;/p&gt;</comment>
                            <comment id="16767055" author="cziegeler" created="Wed, 13 Feb 2019 11:07:52 +0000"  >&lt;p&gt;I&apos;m not sure what exactly we&apos;re trying to fix here. So far you need a single bundle for SCR. By not including promise/functions you out of a sudden need three bundles.&lt;br/&gt;
I understand the theoretical discussions about this, but in practice both bundles are released once every couple of years - next release will be with R8 I guess. &lt;br/&gt;
So why can&apos;t we just inlcude the latest version, properly export/import it and are done with it for the next N years?&lt;/p&gt;</comment>
                            <comment id="16767071" author="pkriens" created="Wed, 13 Feb 2019 11:31:08 +0000"  >&lt;p&gt;By wrapping it in a single bundle you force others to follow &lt;font color=&quot;#333333&quot;&gt;your&lt;/font&gt;&#160;Promises&apos; &lt;font color=&quot;#FF0000&quot;&gt;implementation&lt;/font&gt; and that version is not always compatible. in a runtime (The version we currently use for R7 is R6 promises.) Since SCR is such a fundamental bundle it should not force such constraints on other people&apos;s runtime.&lt;/p&gt;

&lt;p&gt;Notice that this is mostly caused because it includes API &lt;font color=&quot;#FF0000&quot;&gt;and&lt;/font&gt; an implementation. An API only would still be not cohesive but would work ok. Since others do this as well, there is no backward compatibility on the API possible. You therefore must import it [1,1.1) This constrained will then likely cause multiple class spaces in more complex runtimes and that is almost always havoc. That is why importing [1,2) for a provided package is basically throwing a big wrench in the semantic versioning.&lt;/p&gt;

&lt;p&gt;Exporting a package that is not part of your primary responsibility is fundamentally wrong in component based design. Yes, I&#160;feel we&#160;messed up on the SCR Runtime API to force Promises in the ScrComponentRuntime methods and it is inconvenient to require 3 instead of 1 bundle but the cause is the bad API design that references another spec, this causes an &lt;em&gt;external&lt;/em&gt; reference. Solving this problem by exporting those references is a hack and will cause problems.&lt;/p&gt;

&lt;p&gt;At my customers I see the problems always around the bundles that start doing these hacks, never around simple clean honest manifests that refer to what they should refer to. Apache Felix has always been extremely good in this respect so I was quite surprised when I learned about this.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16767079" author="cziegeler" created="Wed, 13 Feb 2019 11:45:29 +0000"  >&lt;p&gt;Yes, I agree that we shouldn&apos;t have used Promises in the SCR Runtime API and its also a problem that promises has both API and impl in the same package.&lt;br/&gt;
I think we&apos;ve updated to R7 promises now.&lt;br/&gt;
I&apos;m still not 100% convinced about this, but in the end it&apos;s not important enough to spend too much time on it. It seems the current situation is causing problems, so let&apos;s change it and see what happens&lt;/p&gt;</comment>
                            <comment id="16767147" author="pkriens" created="Wed, 13 Feb 2019 12:48:07 +0000"  >&lt;p&gt;Since when are you guys so easy to convince? You spoil all the fun!&#160; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;BTW, I drove by Bielefeld last week and it was much nicer than I thought! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thx&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16767193" author="cziegeler" created="Wed, 13 Feb 2019 13:26:17 +0000"  >&lt;p&gt;That&apos;s impossible &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; it doesn&apos;t exist...&lt;/p&gt;</comment>
                            <comment id="16767250" author="tjwatson" created="Wed, 13 Feb 2019 14:28:40 +0000"  >&lt;p&gt;It wasn&apos;t hard to convince me because I didn&apos;t like these exports of util packages to begin with.  I just wasn&apos;t as motivated as you to change the current situation &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve been fixing a few other bugs in SCR so we can do our upgrade to SCR R7 for open liberty.  I&apos;m still working through the testing of that before I want to consider a release of felix, but I think this issue should be fixed for the next SCR release.&lt;/p&gt;</comment>
                            <comment id="16767265" author="tjwatson" created="Wed, 13 Feb 2019 14:42:00 +0000"  >&lt;p&gt;I have a PR at: &lt;a href=&quot;https://github.com/apache/felix/pull/183&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/183&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Not sure why the magic linking in jira isn&apos;t happening for it.  I&apos;ve reverted the dependencies back to 1.0 versions of promises and function because the implementation of SCR doesn&apos;t need the latest.  I&apos;ve removed the exports and the explicit imports so that BND will calculate the imports and range.  This results in only promises getting imported at range [1.0,2.0) which I think is good.&lt;/p&gt;

&lt;p&gt;I had to update the integration test to configure pax to install the promises and function bundles.  I will merge to trunk if I don&apos;t hear any objections today (we can always revert if needed).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 40 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0wc0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>