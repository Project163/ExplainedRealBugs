<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:05:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-381] Started bundles may change state to RESOLVED</title>
                <link>https://issues.apache.org/jira/browse/FELIX-381</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;In certain situations a bundle, which has already been started gets its state changed back to RESOLVED.&lt;/p&gt;

&lt;p&gt;Consider the following situation: A thread T1 is starting a Bundle A while another thread T2 is starting a Bundle B depending on Bundle A. T2 resolves Bundle B and as T1 has not done it yet assumes to have to resolve Bundle A. Before T2 can resolve Bundle A, T1 resolves Bundle A itself and actually starts Bundle A at the end setting the state to ACTIVE. Then T2 finishes resolving and calls the ResolveListener to inform that Bundle A has been resolved, which causes the state of Bundle A to be set to RESOLVED.&lt;/p&gt;

&lt;p&gt;The consequence is that Bundle A has been started  - BundleActivator called, STARTED event fired - and then its state is just set to RESOLVED and a RESOLVED event is fired. This is incorrect as (1) Bundle A has already started and before entering the RESOLVED state (again) it would have to be stopped and (2) getting A back into resolved state would cause STOPPING and STOPPED events to be fired and not a RESOLVED event.&lt;/p&gt;

&lt;p&gt;The fix would probably be to ignore the moduleResolved event for bundles, which are not in the INSTALLED state.&lt;/p&gt;

&lt;p&gt;Testing this issue is difficult as it heavily depends on timing and environmental issues, yet we have a setup, which produces the situation relatively often times.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12379170">FELIX-381</key>
            <summary>Started bundles may change state to RESOLVED</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Sep 2007 07:15:49 +0000</created>
                <updated>Mon, 1 Oct 2007 07:23:24 +0000</updated>
                            <resolved>Sun, 30 Sep 2007 16:55:25 +0000</resolved>
                                    <version>framework-1.0.0</version>
                                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12530646" author="fmeschbe" created="Thu, 27 Sep 2007 07:17:13 +0000"  >&lt;p&gt;Addition to moduleResolved method in the Felix class to ignore the event if the owning bundle is not in the INSTALLED state.&lt;/p&gt;</comment>
                            <comment id="12530726" author="rickhall" created="Thu, 27 Sep 2007 13:53:57 +0000"  >&lt;p&gt;I think this should probably be investigated further. If both are actually firing the RESOLVED event, then it seems that the wiring is happening twice for Bundle A and that is incorrect. I will try to investigate it this weekend.&lt;/p&gt;</comment>
                            <comment id="12530737" author="karlpauls" created="Thu, 27 Sep 2007 14:18:31 +0000"  >&lt;p&gt;As far as I can see that might be true. There is a race condition between checking whether a module is already resolved and actually getting the lock to resolve it &amp;#8211; hence, there should be the possibility to resolve it twice. It might be enough to move the isResolved check inside the synchronized block. &lt;/p&gt;</comment>
                            <comment id="12531351" author="rickhall" created="Sun, 30 Sep 2007 16:55:25 +0000"  >&lt;p&gt;I have just committed a fix for this, which basically implemented Karl&apos;s suggestion of moving the isResolved() check inside the synchronized block. I also tried to simplify the locking protocol by removing the locks on &quot;this&quot; from the isResolved/setResolved methods, making them private, and adding a note that they should only be called when holding a lock on m_factory.&lt;/p&gt;

&lt;p&gt;I also added a warning if you see a resolved event for a bundle that is not in the INSTALLED state so that we can more easily see when this occurs in the future.&lt;/p&gt;

&lt;p&gt;Felix, do your best to see if this patch resolves the issue. If so, please close it.&lt;/p&gt;</comment>
                            <comment id="12531426" author="fmeschbe" created="Mon, 1 Oct 2007 07:23:24 +0000"  >&lt;p&gt;Thanks for fixing. This seems to do the trick.&lt;/p&gt;

&lt;p&gt;Thanks for fixing. Hence, this can be closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12366643" name="FELIX-381.patch" size="954" author="fmeschbe" created="Thu, 27 Sep 2007 07:17:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58604</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vxtb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>