<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:46:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3715] ResolverImpl is not thread safe</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3715</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;The org.apache.felix.resolver.ResolverImpl class has many member fields which keep state for a single resolve operation.  But the resolve methods may be called by multiple threads which means different resolve operations could try to use the same internal state objects leading to very unpredictable behavior.&lt;/p&gt;

&lt;p&gt;Here is a list of the current member fields that hold state:&lt;/p&gt;

&lt;p&gt;m_usesPermutations&lt;br/&gt;
m_importPermutations&lt;br/&gt;
m_packageSourcesCache&lt;/p&gt;

&lt;p&gt;I think we should introduce contextual class that can be used to store these state objects as well as the ResolveContext used for a particular resolve operation.  This contextual object (I suggest calling it something like ResolveOperation) would be passed around instead of the ResolveContext.&lt;/p&gt;

&lt;p&gt;I think this approach is necessary instead of using thread local variables.  The reason is that a call back to a ResolveContext could initiate another resolve() operation using an unrelated (or sandbox) environment from the current resolve operation.  Using thread locals would not help in cases where nested resolve() operations happen.&lt;/p&gt;</description>
                <environment>All</environment>
        <key id="12612247">FELIX-3715</key>
            <summary>ResolverImpl is not thread safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="tjwatson">Tom Watson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Oct 2012 15:54:27 +0000</created>
                <updated>Thu, 13 Dec 2012 18:43:44 +0000</updated>
                            <resolved>Tue, 11 Dec 2012 21:21:47 +0000</resolved>
                                                                    <component>Resolver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13478052" author="rickhall" created="Wed, 17 Oct 2012 17:19:41 +0000"  >&lt;p&gt;Sounds good.&lt;/p&gt;

&lt;p&gt;How about ResolveSession?&lt;/p&gt;</comment>
                            <comment id="13478315" author="tjwatson" created="Wed, 17 Oct 2012 20:00:44 +0000"  >&lt;p&gt;Sure, ResolveSession is fine with me.  I can work on a patch for this after a fix for issue 3716 has been released (I am close to having something to review for that bug).&lt;/p&gt;</comment>
                            <comment id="13526527" author="tjwatson" created="Fri, 7 Dec 2012 16:45:29 +0000"  >&lt;p&gt;Here is a possible fix.  I added a ResolveSession class to ResolverImpl to hold all the state holding objects.  In most cases I pass a ResolveSession around instead of a ResolveContext now.  This makes the patch look rather large, but it is because all the lines of code which accessed state holding member variables now has to access the ResolveSession.&lt;/p&gt;

&lt;p&gt;I added a couple of TODOs about clearing out the state in finally blocks and about checking for multiple cardinality candidates for dynamic resolution.  I think both are needed but wanted to call out to the code where I made functional changes for the reviewer of the patch.&lt;/p&gt;</comment>
                            <comment id="13529346" author="rickhall" created="Tue, 11 Dec 2012 21:21:47 +0000"  >&lt;p&gt;I&apos;ve applied the patch and deployed a snapshot. Please close this issue if you are satisfied. Thanks.&lt;/p&gt;</comment>
                            <comment id="13531002" author="benoitf" created="Thu, 13 Dec 2012 13:21:32 +0000"  >&lt;p&gt;In my tests this commit fixed the problem of Thread safe&lt;/p&gt;</comment>
                            <comment id="13531315" author="tjwatson" created="Thu, 13 Dec 2012 18:43:44 +0000"  >&lt;p&gt;Thanks for releasing the fix.  Closing the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12559894" name="org.apache.felix.resolver.patch" size="28925" author="tjwatson" created="Fri, 7 Dec 2012 16:45:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a6w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57390</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>