<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:04:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-149] Bug in Bundle.getEntry</title>
                <link>https://issues.apache.org/jira/browse/FELIX-149</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I think I found a bug in the implementation of URL Bundle.getEntry(String name); &lt;br/&gt;
It raises a ClassCastException when called on the system bundle since its content loader &lt;br/&gt;
is not a ContentLoaderImpl but actually a SystemBundleContentLoader. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;class BundleImpl         &lt;br/&gt;
    public URL getEntry(String name) &lt;br/&gt;
    { &lt;br/&gt;
        Object sm = System.getSecurityManager(); &lt;/p&gt;

&lt;p&gt;        if (sm != null) &lt;br/&gt;
        { &lt;br/&gt;
            try &lt;/p&gt;
            { 
                ((SecurityManager) sm).checkPermission(new AdminPermission(this, 
                    AdminPermission.RESOURCE)); 
            } 
&lt;p&gt;            catch (Exception e) &lt;/p&gt;
            { 
                return null; // No permission 
            } 
&lt;p&gt;        } &lt;/p&gt;

&lt;p&gt;        return m_felix.getBundleEntry(this, name); &lt;br/&gt;
    } &lt;/p&gt;

&lt;p&gt;class Felix &lt;br/&gt;
    /** &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Implementation for Bundle.getEntry().&lt;br/&gt;
    **/ &lt;br/&gt;
    protected URL getBundleEntry(BundleImpl bundle, String name) &lt;br/&gt;
    { &lt;br/&gt;
        if (bundle.getInfo().getState() == Bundle.UNINSTALLED) 
        { 
            throw new IllegalStateException(&quot;The bundle is uninstalled.&quot;); 
        } &lt;br/&gt;
==&amp;gt;&amp;gt;        return ((ContentLoaderImpl) bundle.getInfo().getCurrentModule() &lt;br/&gt;
            .getContentLoader()).getResourceFromContent(name); &lt;br/&gt;
    } &lt;br/&gt;
&lt;br/&gt;
Here is a patch for this problem. &lt;br/&gt;
It is basically moving the getResourceFromContent from ContentLoaderImpl to Felix, &lt;br/&gt;
which required to modify the FindEntriesEnumeration slightly. &lt;br/&gt;
&lt;br/&gt;
Index: org/apache/felix/framework/searchpolicy/ContentLoaderImpl.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; org/apache/felix/framework/searchpolicy/ContentLoaderImpl.java	(revision 440763)&lt;br/&gt;
+++ org/apache/felix/framework/searchpolicy/ContentLoaderImpl.java	(working copy)&lt;br/&gt;
@@ -174,39 +174,6 @@&lt;br/&gt;
         return v.elements();&lt;br/&gt;
     }&lt;br/&gt;
 &lt;br/&gt;
-    // TODO: API: Investigate making this an API call.&lt;br/&gt;
-    public URL getResourceFromContent(String name)&lt;br/&gt;
-    {&lt;br/&gt;
-        URL url = null;&lt;br/&gt;
-&lt;br/&gt;
-        // Check for the special case of &quot;/&quot;, which represents&lt;br/&gt;
-        // the root of the bundle according to the spec.&lt;br/&gt;
-        if (name.equals(&quot;/&quot;))&lt;br/&gt;
-        {
-            url = getURLPolicy().createURL(&quot;0/&quot;);
-        }&lt;br/&gt;
-&lt;br/&gt;
-        if (url == null)&lt;br/&gt;
-        {&lt;br/&gt;
-            // Remove leading slash, if present.&lt;br/&gt;
-            if (name.startsWith(&quot;/&quot;))&lt;br/&gt;
-            {
-                name = name.substring(1);
-            }&lt;br/&gt;
-&lt;br/&gt;
-            // Check the module content.&lt;br/&gt;
-            if (getContent().hasEntry(name))&lt;br/&gt;
-            {
-                // Module content URLs start with 0, whereas module
-                // class path URLs start with the index into the class
-                // path + 1.
-                url = getURLPolicy().createURL(&quot;0/&quot; + name);
-            }&lt;br/&gt;
-        }&lt;br/&gt;
-&lt;br/&gt;
-        return url;&lt;br/&gt;
-    }&lt;br/&gt;
-&lt;br/&gt;
     public boolean hasInputStream(String urlPath)&lt;br/&gt;
     {&lt;br/&gt;
         if (urlPath.startsWith(&quot;/&quot;))&lt;br/&gt;
Index: org/apache/felix/framework/Felix.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; org/apache/felix/framework/Felix.java	(revision 440763)&lt;br/&gt;
+++ org/apache/felix/framework/Felix.java	(working copy)&lt;br/&gt;
@@ -1001,10 +1001,47 @@&lt;br/&gt;
         {             throw new IllegalStateException(&quot;The bundle is uninstalled.&quot;);         }&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return ((ContentLoaderImpl) bundle.getInfo().getCurrentModule()&lt;/li&gt;
	&lt;li&gt;.getContentLoader()).getResourceFromContent(name);&lt;br/&gt;
+        IContentLoader loader;&lt;br/&gt;
+        loader = bundle.getInfo().getCurrentModule().getContentLoader();&lt;br/&gt;
+        return getResourceFromContent(loader,name);&lt;br/&gt;
+        //return ((ContentLoaderImpl) bundle.getInfo().getCurrentModule()&lt;br/&gt;
+        //    .getContentLoader()).getResourceFromContent(name);&lt;br/&gt;
     }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+    // TODO: API: Investigate making this an API call.&lt;br/&gt;
+    private URL getResourceFromContent(IContentLoader loader, String name)&lt;br/&gt;
+    {&lt;br/&gt;
+        URL url = null;&lt;br/&gt;
+&lt;br/&gt;
+        // Check for the special case of &quot;/&quot;, which represents&lt;br/&gt;
+        // the root of the bundle according to the spec.&lt;br/&gt;
+        if (name.equals(&quot;/&quot;))&lt;br/&gt;
+        &lt;/p&gt;
{
+            url = loader.getURLPolicy().createURL(&quot;0/&quot;);
+        }
&lt;p&gt;+&lt;br/&gt;
+        if (url == null)&lt;br/&gt;
+        {&lt;br/&gt;
+            // Remove leading slash, if present.&lt;br/&gt;
+            if (name.startsWith(&quot;/&quot;))&lt;br/&gt;
+            &lt;/p&gt;
{
+                name = name.substring(1);
+            }
&lt;p&gt;+&lt;br/&gt;
+            // Check the module content.&lt;br/&gt;
+            IContent content = loader.getContent();&lt;br/&gt;
+            if (content!=null &amp;amp;&amp;amp; content.hasEntry(name))&lt;br/&gt;
+            &lt;/p&gt;
{
+                // Module content URLs start with 0, whereas module
+                // class path URLs start with the index into the class
+                // path + 1.
+                url = loader.getURLPolicy().createURL(&quot;0/&quot; + name);
+            }
&lt;p&gt;+        }&lt;br/&gt;
+&lt;br/&gt;
+        return url;&lt;br/&gt;
+    }&lt;br/&gt;
+&lt;br/&gt;
     /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Implementation for Bundle.getEntryPaths().&lt;br/&gt;
     **/&lt;br/&gt;
@@ -1034,8 +1071,8 @@&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         // Get the entry enumeration from the module content and&lt;br/&gt;
         // create a wrapper enumeration to filter it.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Enumeration enumeration =&lt;/li&gt;
	&lt;li&gt;new FindEntriesEnumeration(bundle, path, filePattern, recurse);&lt;br/&gt;
+        Enumeration enumeration = &lt;br/&gt;
+            new FindEntriesEnumeration(this,bundle, path, filePattern, recurse);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         // Return the enumeration if it has elements.&lt;br/&gt;
         return (!enumeration.hasMoreElements()) ? null : enumeration;&lt;br/&gt;
Index: org/apache/felix/framework/FindEntriesEnumeration.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; org/apache/felix/framework/FindEntriesEnumeration.java	(revision 440763)&lt;br/&gt;
+++ org/apache/felix/framework/FindEntriesEnumeration.java	(working copy)&lt;br/&gt;
@@ -22,6 +22,7 @@&lt;/p&gt;

&lt;p&gt; class FindEntriesEnumeration implements Enumeration&lt;br/&gt;
 {&lt;br/&gt;
+	private Felix m_felix;&lt;br/&gt;
     private BundleImpl m_bundle = null;&lt;br/&gt;
     private Enumeration m_enumeration = null;&lt;br/&gt;
     private String m_path = null;&lt;br/&gt;
@@ -29,9 +30,10 @@&lt;br/&gt;
     private boolean m_recurse = false;&lt;br/&gt;
     private Object m_next = null;&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public FindEntriesEnumeration(&lt;br/&gt;
+    public FindEntriesEnumeration(Felix felix,&lt;br/&gt;
         BundleImpl bundle, String path, String filePattern, boolean recurse)
     {
+    	m_felix = felix;
         m_bundle = bundle;
         m_path = path;
         m_enumeration = m_bundle.getInfo().getCurrentModule()
@@ -49,7 +51,7 @@
             m_path = m_path.substring(1);
         }
&lt;p&gt;         // Add a &apos;/&apos; to the end if not present.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;if ((m_path.length() &amp;gt; 0) &amp;amp;&amp;amp; (m_path.charAt(path.length() - 1) != &apos;/&apos;))&lt;br/&gt;
+        if ((m_path.length() &amp;gt; 0) &amp;amp;&amp;amp; (m_path.charAt(m_path.length() - 1) != &apos;/&apos;))
         {
             m_path = m_path + &quot;/&quot;;
         }
&lt;p&gt;@@ -116,10 +118,12 @@&lt;br/&gt;
                     // See if the file pattern matches the last element of the path.&lt;br/&gt;
                     if (checkSubstring(m_filePattern, lastElement))&lt;/p&gt;
                     {
+                    	return m_felix.getBundleEntry(m_bundle,entryName);
+                    	
                         // Convert entry name into an entry URL.
-                        return ((ContentLoaderImpl) m_bundle.getInfo()
-                            .getCurrentModule().getContentLoader())
-                                .getResourceFromContent(entryName);
+                        //return ((ContentLoaderImpl) m_bundle.getInfo()
+                        //    .getCurrentModule().getContentLoader())
+                        //        .getResourceFromContent(entryName);
                     }
&lt;p&gt;                 }&lt;br/&gt;
             }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12350263">FELIX-149</key>
            <summary>Bug in Bundle.getEntry</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="ogruber">Olivier Gruber</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Sep 2006 16:52:15 +0000</created>
                <updated>Thu, 28 Sep 2006 06:26:49 +0000</updated>
                            <resolved>Mon, 25 Sep 2006 18:29:25 +0000</resolved>
                                                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12437632" author="rickhall" created="Mon, 25 Sep 2006 18:29:25 +0000"  >&lt;p&gt;I did not apply the patch as is, since I think it complicates the situation by spreading the resource URL handling out a little bit too much. Instead, what I did was add a getResourceFromContent() method to IContentLoader as a way to get resource URLs from a module&apos;s raw content. This is something that I had contemplated doing anyway as was noted in the comments. This probably still requires some thought on how to best handle resource URLs, but it should work for now.&lt;/p&gt;

&lt;p&gt;Olivier, please review and test these changes to make sure they solve the issue you were having.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58834</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ao7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>270388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>