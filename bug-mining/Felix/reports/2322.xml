<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:55:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4716] Bundle org.apache.felix.ipojo physically contains OSGi API classes</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4716</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;The &lt;em&gt;org.apache.felix.ipojo&lt;/em&gt; bundle imports, exports and physically contains interface-classes of packages &lt;em&gt;org.osgi.services.cm&lt;/em&gt; and &lt;em&gt;org.osgi.services.log&lt;/em&gt;, both with version 1.3.&lt;/p&gt;

&lt;p&gt;I&apos;m running ipojo in karaf 3.0.2. There, these osgi-packages also exists, just in another version.&lt;/p&gt;

&lt;p&gt;Sometimes it happens that a bundle of mine, which has a package-dependency on &lt;em&gt;org.osgi.services.cm&lt;/em&gt; is bound to the ipojo-version instead of the one of felix/karaf. Now, the bundle is resolved, but the service dependency on the ConfigurationAdmin can never be resolved, because the implementation is incompatible to the imported interface.&lt;/p&gt;

&lt;p&gt;I can fix that, if I play around with the bundle start levels.&lt;/p&gt;

&lt;p&gt;Anyway, I think it&apos;s a bug in iPOJO, because it should not inline any OSGi API packages.&lt;/p&gt;</description>
                <environment>ubuntu 14, karaf</environment>
        <key id="12758920">FELIX-4716</key>
            <summary>Bundle org.apache.felix.ipojo physically contains OSGi API classes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clement.escoffier">Clement Escoffier</assignee>
                                    <reporter username="palador">Karl Leopold</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Dec 2014 15:31:48 +0000</created>
                <updated>Wed, 24 Dec 2014 16:23:58 +0000</updated>
                            <resolved>Wed, 10 Dec 2014 07:45:40 +0000</resolved>
                                    <version>ipojo-runtime-1.12.0</version>
                                    <fixVersion>ipojo-runtime-1.12.1</fixVersion>
                                    <component>iPOJO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14231646" author="clement.escoffier" created="Tue, 2 Dec 2014 15:38:50 +0000"  >&lt;p&gt;iPOJO embeds theses classes to be standalone. We should update the embedded version to avoid the issue (and to always use the latest API).&lt;/p&gt;</comment>
                            <comment id="14231678" author="palador" created="Tue, 2 Dec 2014 16:01:44 +0000"  >&lt;p&gt;Oh no, please don&apos;t do that...&lt;/p&gt;

&lt;p&gt;Now, I can work around this issue by tuning start-levels, so that they&apos;re started the newer config-admin API is running. Since it is newer, it is preferred over the API exported by iPOJO. If both bundles export org.osgi.services.* with the same version, I have to look for another hack to get my stuff running correctly.&lt;/p&gt;

&lt;p&gt;And I still think, that it&apos;s not a good idea to inline AND export these packages. If iPOJO has a dependency on the OSGi-compendium, then it should be. And having the OSGi-compendium API in an OSGi container is not that uncommon &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; .&lt;/p&gt;

&lt;p&gt;What about making the dependency on org.osgi.services.* optional? Then, I&apos;ll have a lot of trouble at runtime with checking whether it&apos;s there or not, but in the end it should be possible.&lt;/p&gt;</comment>
                            <comment id="14232726" author="clement.escoffier" created="Wed, 3 Dec 2014 07:49:16 +0000"  >&lt;p&gt;Oh I see.&lt;/p&gt;

&lt;p&gt;So, first making these packages optional is not really satisfying, for two reasons:&lt;/p&gt;

&lt;p&gt;1. Providers (bundle exporting these packages) may come and go, and the optional resolution does not support such dynamism&lt;br/&gt;
2. The impact of not having these packages is quite huge. I agree that an initial detection would be enough, but if I want to be more dynamic, that&apos;s not that simple&lt;/p&gt;

&lt;p&gt;One possibility would be to package a &lt;em&gt;bare&lt;/em&gt; version of iPOJO core. This version would not contain &lt;em&gt;org.osgi.services.*&lt;/em&gt; packages (just import them). &lt;/p&gt;

&lt;p&gt;WDYT ?&lt;/p&gt;</comment>
                            <comment id="14232867" author="chris@die-schneider.net" created="Wed, 3 Dec 2014 10:49:29 +0000"  >&lt;p&gt;Embedding packages from the OSGi compendium or enterprise APIs is quite common practice. If importers of the packages specify correct import ranges this normally should not pose a problem.&lt;/p&gt;</comment>
                            <comment id="14232885" author="palador" created="Wed, 3 Dec 2014 11:11:05 +0000"  >&lt;p&gt;You&apos;re right, that&apos;s the best solution since it avoids a rotten compromise between being able to run standalone and having a potentially unnecessary package-dependencies on OSGi-services.&lt;/p&gt;

&lt;p&gt;BTW. I&apos;m still a bit confused if the approach with inlining api classes works. Imagine:&lt;/p&gt;

&lt;p&gt;Bundle 1: exports and contains org.osgi.service.cm;version=&quot;1.3&quot;  and requires service org.osgi.service.cm.ConfigurationAdmin &lt;br/&gt;
Bundle 2: exports and contains org.osgi.service.cm;version=&quot;1.5&quot;&lt;/p&gt;

&lt;p&gt;Bundle 3: imports org.osgi.service.cm;version=&quot;[1.0,2)&quot; and registers ConfigAdminImpl (which implements org.osgi.service.cm.ConfigurationAdmin)&lt;br/&gt;
Bundle 4: imports org.osgi.service.cm;version=&quot;[1.0,2)&quot; and want to use org.osgi.service.cm.ConfigurationAdmin &lt;/p&gt;

&lt;p&gt;Now, when everything is started, Bundle 3 and 4 would be wired to either Bundle 1 or 2. If they are started in the given order, Bundle 2 would be preferred, cause of the higher package-version. Now, bundle 4 can take the service, because it&apos;s using the same API-package.&lt;br/&gt;
But how can bundle 1 use the service? It&apos;s service API interface class is not an instance of the one provided by Bundle 3, since both API-classes come from different bundles and are defined by different class-loaders.&lt;/p&gt;

&lt;p&gt;The question is, I believe that there doesn&apos;t exist any ConfigAdmin service or whatever for the iPOJO bundle. There is one, but it is incompatible because it doesn&apos;t implement the API provided by iPOJO but the newer provided by the latest config-admin-api bundle...&lt;/p&gt;</comment>
                            <comment id="14233008" author="chris@die-schneider.net" created="Wed, 3 Dec 2014 14:01:37 +0000"  >&lt;p&gt;Like you explained your example would not work. The problem is that some of the Import ranges are wrong.&lt;/p&gt;

&lt;p&gt;Every bundle that exports an OSGi API and also uses it should also import it. So bundle 1 is wrong as it only exports the API. It also should import it with a range of [1,2)&lt;/p&gt;

&lt;p&gt;The idea behind this is that if everyone imports the OSGI API then the OSGi framework will only select one bundle to export the API and all use the same classloader for that package&lt;/p&gt;</comment>
                            <comment id="14233028" author="palador" created="Wed, 3 Dec 2014 14:25:17 +0000"  >&lt;p&gt;Thank you, I got it. Also, that&apos;s why I can &quot;fix&quot; my problem with fine-tuning the bundle startlevels: If the iPOJO bundle is started after the bundle exporting a newer version of &lt;em&gt;org.osgi.....&lt;/em&gt;, It&apos;ll use this package instead of its own one.&lt;/p&gt;</comment>
                            <comment id="14240774" author="clement.escoffier" created="Wed, 10 Dec 2014 07:45:40 +0000"  >&lt;p&gt;Fixed in trunk by creating a &apos;bare&apos; bundle that does not include the classes from the compendium.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22ywf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>