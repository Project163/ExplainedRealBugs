<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:13:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5974] Prototype scope references are not released on deactivation</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5974</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Having read the stack overflow question on &lt;a href=&quot;https://stackoverflow.com/questions/52839641/osgi-ds-prototype-reference-not-released&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Stack Overflow&lt;/a&gt;&#160;I was pretty certain that the user must be doing something wrong, but in fact it seems as though SCR does a bad job of releasing Prototype scoped references when a component is disposed.&lt;/p&gt;

&lt;p&gt;I looked into the code, and it seems that there are a lot of conflicting locations where prototype scope services are obtained and released. I propose tidying this up so that the ComponentServiceObjects is &lt;b&gt;always&lt;/b&gt; used internally regardless of whether it is injected or not. This encapsulates all the access in a single location so it is less likely that the objects will leak.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13194397">FELIX-5974</key>
            <summary>Prototype scope references are not released on deactivation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="timothyjward">Timothy James Ward</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Oct 2018 12:18:44 +0000</created>
                <updated>Fri, 1 Feb 2019 17:23:45 +0000</updated>
                            <resolved>Sat, 3 Nov 2018 13:46:01 +0000</resolved>
                                    <version>scr-2.1.12</version>
                                    <fixVersion>scr-2.1.14</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16665103" author="githubbot" created="Fri, 26 Oct 2018 12:21:05 +0000"  >&lt;p&gt;GitHub user timothyjward opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/159&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Provide a refactoring to simplify prototype reference access&lt;/p&gt;

&lt;p&gt;    This should also Fix &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5974&quot; title=&quot;Prototype scope references are not released on deactivation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5974&quot;&gt;&lt;del&gt;FELIX-5974&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Tim Ward &amp;lt;timothyjward@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/timothyjward/felix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/timothyjward/felix&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5974&quot; title=&quot;Prototype scope references are not released on deactivation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5974&quot;&gt;&lt;del&gt;FELIX-5974&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/159.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/159.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #159&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1a0973e08353bb0c4e959fb2a01b861c9cfcc39b&lt;br/&gt;
Author: Tim Ward &amp;lt;timothyjward@...&amp;gt;&lt;br/&gt;
Date:   2018-10-26T12:20:11Z&lt;/p&gt;

&lt;p&gt;    Provide a refactoring to simplify prototype reference access&lt;/p&gt;

&lt;p&gt;    This should also Fix &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5974&quot; title=&quot;Prototype scope references are not released on deactivation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5974&quot;&gt;&lt;del&gt;FELIX-5974&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Signed-off-by: Tim Ward &amp;lt;timothyjward@apache.org&amp;gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16667905" author="danielreuther" created="Mon, 29 Oct 2018 23:54:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=timothyjward&quot; class=&quot;user-hover&quot; rel=&quot;timothyjward&quot;&gt;timothyjward&lt;/a&gt;, thanks again for working on this! I did some tests with your changes and all prototype-scoped services seem to get deactivated properly now (which wasn&apos;t the case before). However, it looks like the instances themselves still can&apos;t get garbage collected.&lt;/p&gt;

&lt;p&gt;There&apos;s a chance my test is flawed but after calling ungetService for a component with a prototype reference, I still see MultiplePrototypeRefPair holding on to prototype and ComponentContextImpl instances.&lt;/p&gt;</comment>
                            <comment id="16669018" author="timothyjward" created="Tue, 30 Oct 2018 16:41:45 +0000"  >&lt;p&gt;I&apos;ve updated the PR - hopefully this will now release the objects from the&#160;MultiplePrototypeRefPair as well as releasing the service instance.&lt;/p&gt;</comment>
                            <comment id="16670431" author="danielreuther" created="Wed, 31 Oct 2018 17:36:51 +0000"  >&lt;p&gt;Thanks, Tim. This works fine for me&#8212;prototype instances seem to get collected properly now. This is also true for the Vaadin scenario mentioned in the Stackoverflow thread.&lt;/p&gt;</comment>
                            <comment id="16674052" author="cziegeler" created="Sat, 3 Nov 2018 13:46:01 +0000"  >&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=timothyjward&quot; class=&quot;user-hover&quot; rel=&quot;timothyjward&quot;&gt;timothyjward&lt;/a&gt;, i&apos;ve applied it in rev 1845660.&lt;/p&gt;</comment>
                            <comment id="16758512" author="tjwatson" created="Fri, 1 Feb 2019 17:23:45 +0000"  >&lt;p&gt;Notice that this fix has caused a regression with &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-6044&quot; title=&quot;Component deactivation does not cause reference services to be ungotten&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-6044&quot;&gt;&lt;del&gt;FELIX-6044&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zoen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>