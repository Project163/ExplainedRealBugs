<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:42:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3568] java.lang.VerifyError from bundles compiled with maven-scr-plugin  (java 7)</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3568</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;A bundle compiled by javac 1.7.0, using maven-scr-plugin 1.7.4, seems to raise a VerifyError when SCR attempts to reflect out the generated constructors.&lt;/p&gt;

&lt;p&gt;java.lang.VerifyError: Expecting a stackmap frame at branch target 13 in method com.intergral.storm.pqs.internal.PersistentQueueComponent.unbindBus(Lorg/osgi/service/event/EventAdmin;)V at offset 5&lt;br/&gt;
	at java.lang.Class.getDeclaredConstructors0(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_04&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Class.privateGetDeclaredConstructors(Class.java:2404)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_04&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Class.getConstructor0(Class.java:2714)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_04&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Class.newInstance0(Class.java:343)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_04&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Class.newInstance(Class.java:325)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_04&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.manager.ImmediateComponentManager.createImplementationObject(ImmediateComponentManager.java:183)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.manager.ImmediateComponentManager.createComponent(ImmediateComponentManager.java:118)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.manager.AbstractComponentManager$Unsatisfied.activate(AbstractComponentManager.java:997)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.manager.AbstractComponentManager.activateInternal(AbstractComponentManager.java:333)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.manager.AbstractComponentManager.enable(AbstractComponentManager.java:157)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.config.ConfiguredComponentHolder.enableComponents(ConfiguredComponentHolder.java:256)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.BundleComponentActivator.loadDescriptor(BundleComponentActivator.java:253)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.BundleComponentActivator.initialize(BundleComponentActivator.java:147)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.BundleComponentActivator.&amp;lt;init&amp;gt;(BundleComponentActivator.java:111)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.Activator.loadComponents(Activator.java:285)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.scr.impl.Activator.bundleChanged(Activator.java:203)&lt;span class=&quot;error&quot;&gt;&amp;#91;55:org.apache.felix.scr:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.framework.util.EventDispatcher.invokeBundleListenerCallback(EventDispatcher.java:807)&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.framework-3.0.9.jar:&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:729)&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.framework-3.0.9.jar:&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.framework.util.EventDispatcher.fireBundleEvent(EventDispatcher.java:610)&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.framework-3.0.9.jar:&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.framework.Felix.fireBundleEvent(Felix.java:3761)&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.framework-3.0.9.jar:&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.framework.Felix.startBundle(Felix.java:1787)&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.framework-3.0.9.jar:&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1163)&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.framework-3.0.9.jar:&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.framework.StartLevelImpl.run(StartLevelImpl.java:264)&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.felix.framework-3.0.9.jar:&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_04&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;Workaround: applying the XX:-UseSplitVerifier option to the VM seems to stop this occurring.&lt;/p&gt;</description>
                <environment>maven-scr-plugin 1.7.4&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_04-b21) (oracle/mac os)&lt;br/&gt;
org.apache.felix.scr-1.6.0.jar&lt;br/&gt;
Apache Karaf (2.2.7)&lt;br/&gt;
&lt;br/&gt;
</environment>
        <key id="12595437">FELIX-3568</key>
            <summary>java.lang.VerifyError from bundles compiled with maven-scr-plugin  (java 7)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="jhawksley">John Hawksley</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Jun 2012 14:47:15 +0000</created>
                <updated>Wed, 12 Mar 2014 08:55:26 +0000</updated>
                            <resolved>Fri, 30 Nov 2012 10:36:41 +0000</resolved>
                                    <version>maven-scr-plugin-1.7.4</version>
                                    <fixVersion>maven-scr-plugin-1.9.0</fixVersion>
                    <fixVersion>scr ant task 1.3.0</fixVersion>
                    <fixVersion>scr generator 1.3.0</fixVersion>
                                    <component>SCR Tooling</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13398471" author="jhawksley" created="Thu, 21 Jun 2012 15:00:17 +0000"  >&lt;p&gt;Another workaround seems to be coding up the bind and unbind methods manually, and specifying them in the @Reference annotation.  If this is done, the split verifier workaround is not required.&lt;/p&gt;</comment>
                            <comment id="13399088" author="djencks" created="Fri, 22 Jun 2012 03:11:37 +0000"  >&lt;p&gt;Just so I&apos;m sure I understand, the problem occurs with bind/unbind methods generated by the maven-scr-plugin but not with methods you write in java yourself?  So the problem is with the generated bytecode?&lt;/p&gt;</comment>
                            <comment id="13399174" author="jhawksley" created="Fri, 22 Jun 2012 07:06:22 +0000"  >&lt;p&gt;David, exactly right.  When I write the bind/unbind, without the workaround, everything&apos;s fine.  When I let maven-scr-plugin add the bytecode, the problem occurs.&lt;/p&gt;</comment>
                            <comment id="13400450" author="lucdew" created="Mon, 25 Jun 2012 13:07:09 +0000"  >&lt;p&gt;Hi, it is really quite a blocker for Java7 adoption for us.&lt;br/&gt;
Using the XX:-UseSplitVerifier JVM option fixes the issue but we have to set it for Maven surefire plugin (so that Junit test pass) and in the startup parameters of our OSGi based servers.&lt;br/&gt;
Also since the UseSplitVerifier use a fallback mechanism testing first with the Java7 verifier and rolling back to Java6 verifier, it has an impact on class loading time.&lt;/p&gt;</comment>
                            <comment id="13400455" author="jhawksley" created="Mon, 25 Jun 2012 13:12:40 +0000"  >&lt;p&gt;Linked &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3145&quot; title=&quot;VerifyError on Java 7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3145&quot;&gt;&lt;del&gt;FELIX-3145&lt;/del&gt;&lt;/a&gt; which seems to be the same issue in iPOJO.&lt;/p&gt;</comment>
                            <comment id="13403062" author="cziegeler" created="Thu, 28 Jun 2012 12:45:41 +0000"  >&lt;p&gt;It seems we have to update ASM to 3.3.1 and set some flags for the class writer: java.lang.VerifyError from bundles compiled with maven-scr-plugin (java 7)&lt;/p&gt;</comment>
                            <comment id="13406302" author="cziegeler" created="Wed, 4 Jul 2012 06:36:09 +0000"  >&lt;p&gt;Simply adding those flags and using a newer ASM version creates problems as this results in errors when the class is used (at least with Java 6). As the fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3145&quot; title=&quot;VerifyError on Java 7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3145&quot;&gt;&lt;del&gt;FELIX-3145&lt;/del&gt;&lt;/a&gt; as been reverted as well, we need to find something different&lt;/p&gt;</comment>
                            <comment id="13406362" author="jhawksley" created="Wed, 4 Jul 2012 08:34:41 +0000"  >&lt;p&gt;Ah that&apos;s frustrating &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  I would say that naturally having one-build-to-rule-them-all is the optimal solution, but as a fallback position, could you read the compile target out of the Maven pom, and generate the &quot;correct&quot; bytecode based on that?  I&apos;m not familiar with Maven internals, so I don&apos;t know if that&apos;s possible. &lt;/p&gt;</comment>
                            <comment id="13406400" author="cziegeler" created="Wed, 4 Jul 2012 09:45:09 +0000"  >&lt;p&gt;No, that&apos;s not possible &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Maybe we could detect that by looking at a compiled class file?&lt;br/&gt;
Could you try the latest version of the scr plugin from svn trunk and change line 68 in the ClassModifier class (scr generator module) to&lt;br/&gt;
final ClassWriter writer = new ClassWriter(ClassWriter.COMPUTE_MAXS  | ClassWriter.COMPUTE_FRAMES) {&lt;/p&gt;

&lt;p&gt;and see if that fixes your problem with java 7 ?&lt;/p&gt;

&lt;p&gt;I&apos;ll try this with Java 6 and report the error I get, maybe someone has an idea then what we need to change to get a single version for all java versions&lt;/p&gt;</comment>
                            <comment id="13406418" author="jhawksley" created="Wed, 4 Jul 2012 10:14:46 +0000"  >&lt;p&gt;Works with your change, Carsten - thanks for that! Hopefully someone can find a method that works for all versions... fingers crossed.&lt;/p&gt;</comment>
                            <comment id="13406921" author="cziegeler" created="Thu, 5 Jul 2012 09:03:52 +0000"  >&lt;p&gt;Thanks John.&lt;/p&gt;

&lt;p&gt;I&apos;ve updated trunk to use the latest asm (4.0) which is the first version supporting java 7 - although it results in the same problem.&lt;br/&gt;
I get this exception:&lt;br/&gt;
Caused by: java.lang.RuntimeException: JSR/RET are not supported with computeFrames option&lt;br/&gt;
	at org.objectweb.asm.Frame.a(Unknown Source)&lt;br/&gt;
	at org.objectweb.asm.MethodWriter.visitJumpInsn(Unknown Source)&lt;br/&gt;
	at org.objectweb.asm.tree.JumpInsnNode.accept(Unknown Source)&lt;br/&gt;
	at org.objectweb.asm.tree.InsnList.accept(Unknown Source)&lt;br/&gt;
	at org.objectweb.asm.tree.MethodNode.accept(Unknown Source)&lt;br/&gt;
	at org.objectweb.asm.tree.MethodNode.accept(Unknown Source)&lt;br/&gt;
	at org.objectweb.asm.tree.ClassNode.accept(Unknown Source)&lt;br/&gt;
	at org.apache.felix.scrplugin.helper.ClassModifier.addMethods(ClassModifier.java:94)&lt;/p&gt;

&lt;p&gt;Maybe someone has an idea how to change the bytecode generation?&lt;/p&gt;</comment>
                            <comment id="13434886" author="cziegeler" created="Wed, 15 Aug 2012 08:54:00 +0000"  >&lt;p&gt;Moving to next version as we don&apos;t know a good solution yet.&lt;/p&gt;</comment>
                            <comment id="13434907" author="cziegeler" created="Wed, 15 Aug 2012 09:40:23 +0000"  >&lt;p&gt;It seems that JSRInlineAdapter should help in this situation, not sure how to use that one....&lt;/p&gt;</comment>
                            <comment id="13507254" author="cziegeler" created="Fri, 30 Nov 2012 10:36:41 +0000"  >&lt;p&gt;I&apos;ve now fixed this by looking at the version of the class file:&lt;br/&gt;
if it&apos;s java7 or above use ClassWriter.COMPUTE_MAXS  | ClassWriter.COMPUTE_FRAMES&lt;br/&gt;
otherwise 0 is used.&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12525635">FELIX-3145</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>246071</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i07h5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41547</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>