<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:47:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3840] problem with URLHandlers when running 2 frameworks in one jvm in separate class loaders</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3840</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;This bug happens with 4.0.2 and 4.1.0-SNAPSHOT framework versions.&lt;br/&gt;
Run embedded felix with tomcat as describe in &lt;a href=&quot;http://felix.apache.org/site/apache-felix-framework-launching-and-embedding.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://felix.apache.org/site/apache-felix-framework-launching-and-embedding.html&lt;/a&gt; and as shown in &lt;a href=&quot;http://heapdump.wordpress.com/2010/03/25/osgi-enabled-war/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://heapdump.wordpress.com/2010/03/25/osgi-enabled-war/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;One war activate Felix and works great. Adding another war gives the below error :&lt;br/&gt;
&quot;Unable to update the bundle. (java.net.MalformedURLException: Unknown protocol: obr&quot;&lt;/p&gt;

&lt;p&gt;After debugging I saw the problem is generally in the URLHandlers classes implementation.&lt;br/&gt;
In URLHandlersStreamHandlerProxy class the getStreamHandlerService function does not return the correct value. The below code fails since framework is from current webapp class loader and Felix is from first webapp class loader&lt;br/&gt;
if (framework instanceof Felix)&lt;br/&gt;
{&lt;br/&gt;
	service = ((Felix) framework).getStreamHandlerService(m_protocol);&lt;br/&gt;
}&lt;br/&gt;
so we try to execute the below code and fail with method not recognize error&lt;br/&gt;
service = m_action.invoke(&lt;br/&gt;
m_action.getMethod(framework.getClass(), &quot;getStreamHandlerService&quot;, STRING_TYPES), &lt;br/&gt;
framework, new Object[]&lt;/p&gt;
{m_protocol}
&lt;p&gt;);&lt;/p&gt;

&lt;p&gt;After I set getStreamHandlerService function to public in Felix class it works.&lt;/p&gt;

&lt;p&gt;Then in URLHandlersStreamHandlerProxy  class the below function fails (for the setURL method) since m_service is null&lt;/p&gt;

&lt;p&gt;public Object invoke(Object obj, Method method, Object[] params)&lt;br/&gt;
	throws Throwable&lt;br/&gt;
{&lt;br/&gt;
	try&lt;br/&gt;
	{&lt;br/&gt;
		Class[] types = method.getParameterTypes();&lt;br/&gt;
		if (&quot;parseURL&quot;.equals(method.getName()))&lt;br/&gt;
		{&lt;br/&gt;
			types&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = m_service.getClass().getClassLoader().loadClass(&lt;br/&gt;
				URLStreamHandlerSetter.class.getName());&lt;br/&gt;
			params&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; = Proxy.newProxyInstance(&lt;br/&gt;
				m_service.getClass().getClassLoader(), new Class[]&lt;/p&gt;
{types[0]}
&lt;p&gt;, &lt;br/&gt;
				(URLHandlersStreamHandlerProxy) params&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;);&lt;br/&gt;
		}&lt;br/&gt;
		return m_action.invokeDirect(m_action.getMethod(m_service.getClass(), &lt;br/&gt;
			method.getName(), types), m_service, params);&lt;br/&gt;
	} &lt;br/&gt;
	catch (Exception ex)&lt;/p&gt;
	{
		throw ex;
	}
&lt;p&gt;}&lt;/p&gt;</description>
                <environment>windows 7 64bit</environment>
        <key id="12626520">FELIX-3840</key>
            <summary>problem with URLHandlers when running 2 frameworks in one jvm in separate class loaders</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karlpauls">Karl Pauls</assignee>
                                    <reporter username="itay.hindy">itay hindy</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jan 2013 09:23:55 +0000</created>
                <updated>Fri, 1 Feb 2013 21:17:21 +0000</updated>
                            <resolved>Fri, 1 Feb 2013 21:17:21 +0000</resolved>
                                    <version>framework-4.0.2</version>
                    <version>framework-4.0.3</version>
                                    <fixVersion>framework-4.2.0</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13546788" author="karlpauls" created="Tue, 8 Jan 2013 11:10:46 +0000"  >&lt;p&gt;1. we need to set the class accessible - its form a different classloader so we don&apos;t have visibility. &lt;br/&gt;
2. I need to investigate why m_service is null - it shouldn&apos;t be.&lt;/p&gt;

&lt;p&gt;I&apos;ll try to get to it asap.&lt;/p&gt;</comment>
                            <comment id="13569092" author="karlpauls" created="Fri, 1 Feb 2013 21:17:21 +0000"  >&lt;p&gt;As I said, the problem was that we didn&apos;t use the getDeclaredMethod. That was a problem since the classes are loaded by different classloaders. Now, we get the service even so the methods are not public.&lt;/p&gt;

&lt;p&gt;Furthermore, there was a bug in the proxy (the nullpointer you did see). I fixed this as well. Please close this issue if it works for you (or reopen if not).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303126</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17853:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>