<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:11:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5683] getServiceProperties returns null instead of empty dictionary</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5683</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;There are two issues:&lt;/p&gt;

&lt;p&gt;1)&lt;/p&gt;

&lt;p&gt;In the felix users mailing list (see &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;), Bram reported the following:&lt;/p&gt;

&lt;p&gt;when you set a component service properties like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Component component = 
m_dependencyManager.createComponent().setInterface(ApplicationService.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName(),&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties());
component.getServiceProperties().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then you get a NPE because the component.getServiceProperties() method returns null instead of the empty dictionary that has been set in the setInterfaceMethod.&lt;/p&gt;

&lt;p&gt;This is a regression made in r9 release, in the &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5522&quot; title=&quot;Refactor aspect service implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5522&quot;&gt;&lt;del&gt;FELIX-5522&lt;/del&gt;&lt;/a&gt; where a refactoring was done regarding aspect service properties.&lt;/p&gt;

&lt;p&gt;A fix can be made in order to behave like before (that is : avoid the NPE). &lt;/p&gt;

&lt;p&gt;2)&lt;/p&gt;

&lt;p&gt;Bram, I may be wrong but I think that one new issue is that the dictionary returned by the getServiceProperties() method was so far (since the initial version of felix dm 2.0.1) a copy of the service properties dictionary maintained in the ComponentImpl, so if you would like to do set service properties like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Component component = m_dependencyManager.createComponent().setInterface(ApplicationService.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName(),&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Properties());
component.getServiceProperties().put(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;);
m_dependencyManager.add(component);  &lt;span class=&quot;code-comment&quot;&gt;// won&apos;t add &lt;span class=&quot;code-quote&quot;&gt;&quot;a=b&quot;&lt;/span&gt; properties&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;then the &quot;a&quot; property will be set in the copy of the internal dictionary returned by the getServiceProperties() method, and the &quot;a=b&quot; service properties won&apos;t be set when the component is added in the m_dependencyManager.&lt;/p&gt;

&lt;p&gt;So, if what I&apos;m saying is correct and if you would like to see this new behavior implemented, please open a new jira issue and I will manage to implement it; thanks&lt;/p&gt;

&lt;p&gt;PS: I&apos;m now fixing the 1) regression, in order to avoid the NPE.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://www.mail-archive.com/users%40felix.apache.org/msg17939.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/users%40felix.apache.org/msg17939.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13097498">FELIX-5683</key>
            <summary>getServiceProperties returns null instead of empty dictionary</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pderop">Pierre De Rop</assignee>
                                    <reporter username="pderop">Pierre De Rop</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Aug 2017 05:41:24 +0000</created>
                <updated>Mon, 22 Oct 2018 09:01:15 +0000</updated>
                            <resolved>Wed, 26 Sep 2018 16:53:37 +0000</resolved>
                                    <version>org.apache.felix.dependencymanager-r9</version>
                                    <fixVersion>org.apache.felix.dependencymanager-r13</fixVersion>
                                    <component>Dependency Manager</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16141235" author="pderop" created="Fri, 25 Aug 2017 05:51:42 +0000"  >&lt;p&gt;Committed a patch in revision 1806124 which resolves the 1) issue (avoid the NPE) and added the corresponding test:&lt;/p&gt;

&lt;p&gt;org.apache.felix.dependencymanager.itest/src/org/apache/felix/dm/itest/api/FELIX5683_GetServicePropertiesReturnsNullTest.java&lt;/p&gt;
</comment>
                            <comment id="16141301" author="brampouwelse" created="Fri, 25 Aug 2017 07:02:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pderop&quot; class=&quot;user-hover&quot; rel=&quot;pderop&quot;&gt;pderop&lt;/a&gt;  Thanks for the quick response! &lt;/p&gt;

&lt;p&gt;I&apos;ll try to do a test with the trunk version later today. &lt;/p&gt;

&lt;p&gt;&amp;gt; Bram, I may be wrong but I think that one new issue is that the dictionary returned by the getServiceProperties() method was so far (since the initial version of felix dm 2.0.1) a copy of the service properties dictionary maintained in the ComponentImpl, so if you would like to do set service properties like this:&lt;/p&gt;

&lt;p&gt;I&apos;m not sure that&apos;s a real issue I am aware that, furthermore I think that changing this behavior would be another breaking change. &lt;/p&gt;</comment>
                            <comment id="16141315" author="jajans" created="Fri, 25 Aug 2017 07:27:27 +0000"  >&lt;blockquote&gt;
&lt;p&gt;&amp;gt; Bram, I may be wrong but I think that one new issue is that the dictionary returned by the getServiceProperties() method was so far (since the initial version of felix dm 2.0.1) a copy of the service properties dictionary maintained in the ComponentImpl, so if you would like to do set service properties like this:&lt;/p&gt;

&lt;p&gt;I&apos;m not sure that&apos;s a real issue I am aware that, furthermore I think that changing this behavior would be another breaking change.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I tend to agree with Bram here, I think it would cause more trouble than it is worth: with the current (DM 2.0.1) behaviour, you can create &quot;atomic&quot; updates to the service properties by retrieving them, modifying them and updating them in a single call. With the proposed change it would allow the service properties to reflect &quot;partial&quot; changes while we&apos;re updating them.&lt;/p&gt;</comment>
                            <comment id="16141337" author="brampouwelse" created="Fri, 25 Aug 2017 07:50:10 +0000"  >&lt;p&gt;There is however another change that I think would be nice.. I thinkit would be easier for consumers if the getServiceProperties method never returns null (so even if the component was initialized without service properties just return a new dictionary). &lt;/p&gt;</comment>
                            <comment id="16141345" author="mariang" created="Fri, 25 Aug 2017 08:02:10 +0000"  >&lt;p&gt;The javadoc on &lt;tt&gt;Component.getServiceProperties()&lt;/tt&gt; should be updated to reflect the new API logic.&lt;br/&gt;
+1 to always return an empty dictionary and never null.&lt;/p&gt;</comment>
                            <comment id="16141593" author="pderop" created="Fri, 25 Aug 2017 13:16:16 +0000"  >&lt;p&gt;ok; &lt;/p&gt;

&lt;p&gt;and Jan Willem, what is your opinion ?&lt;/p&gt;

&lt;p&gt;thanks.&lt;/p&gt;</comment>
                            <comment id="16141610" author="jajans" created="Fri, 25 Aug 2017 13:27:00 +0000"  >&lt;p&gt;As Marian and Bram suggested, I would also opt for always returning a &lt;tt&gt;Dictionary&lt;/tt&gt; instance that is either empty if no service properties were defined for the service, or a &lt;b&gt;copy&lt;/b&gt; of Dictionary with the existing service properties. It would make the usage pattern very clear regardless whether there were service properties defined on the original service.&lt;/p&gt;</comment>
                            <comment id="16208256" author="pderop" created="Tue, 17 Oct 2017 20:15:34 +0000"  >&lt;p&gt;I finally did a fix to now never return null from the getServicesProperties() method.&lt;br/&gt;
I&apos;m sorry for the delay.&lt;br/&gt;
please close this if you are ok.&lt;/p&gt;

&lt;p&gt;thank you.&lt;/p&gt;</comment>
                            <comment id="16629117" author="pderop" created="Wed, 26 Sep 2018 16:53:37 +0000"  >&lt;p&gt;committed in revision 1842034.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3j9sf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>