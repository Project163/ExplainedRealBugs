<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:10:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1203] NPE in fileinstall if a watched bundle is uninstalled by some other means</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1203</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;test1.jar is part of watched dir /tmp/autodeploy-bundles/. I accidentally uninstalled test1.jar bundle using the Shell command. Next time, when I actually removed the file from the directory, fileinstall failed with the following NPE:&lt;/p&gt;

&lt;p&gt;Jun 7, 2009 11:23:52 PM  &lt;br/&gt;
INFO: Failed to uninstall bundle: /tmp/autodeploy-bundles/test1.jar: java.lang.NullPointerException&lt;br/&gt;
Jun 7, 2009 11:23:52 PM  &lt;br/&gt;
INFO: java.lang.NullPointerException&lt;br/&gt;
Jun 7, 2009 11:23:52 PM  &lt;br/&gt;
INFO:   at org.apache.felix.fileinstall.DirectoryWatcher.uninstall(DirectoryWatcher.java:717)&lt;br/&gt;
Jun 7, 2009 11:23:52 PM  &lt;br/&gt;
INFO:   at org.apache.felix.fileinstall.DirectoryWatcher.uninstall(DirectoryWatcher.java:611)&lt;br/&gt;
Jun 7, 2009 11:23:52 PM  &lt;br/&gt;
INFO:   at org.apache.felix.fileinstall.DirectoryWatcher.doInstalled(DirectoryWatcher.java:350)&lt;br/&gt;
Jun 7, 2009 11:23:52 PM  &lt;br/&gt;
INFO:   at org.apache.felix.fileinstall.DirectoryWatcher.run(DirectoryWatcher.java:122)&lt;/p&gt;

&lt;p&gt;I think it is OK to get the NPE, as user is expected to uninstall the bundle by removing the file unlike what I did in this case. But I am not sure. So, I am filing this bug to share my experience. The fix is pretty simple; we need to log the fact that the bundle has been uninstalled by some other means and add a null check in the code. &lt;/p&gt;</description>
                <environment>generic</environment>
        <key id="12427302">FELIX-1203</key>
            <summary>NPE in fileinstall if a watched bundle is uninstalled by some other means</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="sahoo">Sanjeeb Kumar Sahoo</reporter>
                        <labels>
                    </labels>
                <created>Sun, 7 Jun 2009 17:59:50 +0000</created>
                <updated>Fri, 12 Jun 2009 15:51:35 +0000</updated>
                            <resolved>Fri, 12 Jun 2009 15:28:13 +0000</resolved>
                                    <version> fileinstall-1.0.0</version>
                                    <fixVersion>fileinstall-1.2.0</fixVersion>
                                    <component>File Install</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12718402" author="fdiotalevi" created="Thu, 11 Jun 2009 11:00:16 +0000"  >&lt;p&gt;Generally speaking, weird things happen when you try  provision your container with FileInstall and another provisioning system.&lt;/p&gt;

&lt;p&gt;Anyway I agree we should at least avoid the NPE and give a more expressive error message.&lt;/p&gt;

&lt;p&gt;While looking into the code I realized that there&apos;s a very similar error case when you:&lt;br/&gt;
1) add a bundle.jar in the /load folder (watched by fileinstall)&lt;br/&gt;
2) uninstall bundle.jar via console&lt;br/&gt;
3) update the bundle.jar file  in the /load folder (just:&amp;gt; touch bundle.jar f.i.)&lt;br/&gt;
Similarly to the error case reported, you have &lt;br/&gt;
Failed to update bundle /opt/myprojects/felix-1.8.0/load/sample.bundle-1.1.0-SNAPSHOT.jar: java.lang.NullPointerException&lt;/p&gt;

&lt;p&gt;I&apos;ll submit a patch to avoid the NPE and give a more meaningful error message in both cases&lt;/p&gt;</comment>
                            <comment id="12718421" author="fdiotalevi" created="Thu, 11 Jun 2009 12:14:06 +0000"  >&lt;p&gt;The patch displays more meaningful logs instead of the NPE.&lt;/p&gt;

&lt;p&gt;A question remains open though: consider the case&lt;br/&gt;
1) add a bundle.jar in the /load folder (watched by fileinstall) &lt;br/&gt;
2) uninstall bundle.jar via console &lt;br/&gt;
3) update the bundle.jar file in the /load folder (just:&amp;gt; touch bundle.jar f.i.) &lt;/p&gt;

&lt;p&gt;with the current behavior, fileinstall will try to update the bundle on every iteration, every time displaying the message &quot;Cannot update bundle....&quot;&lt;br/&gt;
Is it an acceptable solution?&lt;/p&gt;

&lt;p&gt;Some options:&lt;br/&gt;
a) leave it as it is. Using fileinstall and another provisioning system is a problem anyway, so it&apos;s better to highlight this problem in the logs&lt;/p&gt;

&lt;p&gt;b) remove bundle.jar from currentManagedBundles. In this case, fileinstall won&apos;t try to update it later, BUT it will install it in the next iteration since it will find the file in the /load folder&lt;/p&gt;

&lt;p&gt;c) remove  bundle.jar from currentManagedBundles AND delete the file from /load (or instruct fileinstall to ignore it).&lt;/p&gt;

&lt;p&gt;IMHO, a) it&apos;s the better solution, since b) and c) can really confuse the user. Wdyt?&lt;/p&gt;</comment>
                            <comment id="12718445" author="sahoo" created="Thu, 11 Jun 2009 13:02:31 +0000"  >&lt;p&gt;I vote for option #a.&lt;/p&gt;

&lt;p&gt;The patch looks fine to me. Thanks.&lt;/p&gt;</comment>
                            <comment id="12718876" author="rickhall" created="Fri, 12 Jun 2009 15:28:13 +0000"  >&lt;p&gt;I have applied this patch. Please close if satisfied. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12410387" name="FELIX-1203.txt" size="1416" author="fdiotalevi" created="Thu, 11 Jun 2009 12:14:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57815</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0w0m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184905</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>