<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:02:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5213] ComponentContext.getServiceReference returns null though service registered</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5213</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;In a component that provides a service and is not immediate, the service is registered before activation. Therefore the service reference of the registered service should be available to the component, from ComponentContext.getServiceReference(), during activation. However the following code sample throws NPE:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.Constants;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.framework.ServiceReference;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.service.component.ComponentContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.service.component.annotations.Activate;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.osgi.service.component.annotations.Component;

@Component(service = &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.class, property = &lt;span class=&quot;code-quote&quot;&gt;&quot;name=scrbug&quot;&lt;/span&gt;)
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Example {
	@Activate
	void activate(ComponentContext context) {
		ServiceReference&amp;lt;?&amp;gt; reference = context.getServiceReference();
		&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;My service ID is %d%n&quot;&lt;/span&gt;, reference.getProperty(Constants.SERVICE_ID));
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that the service certainly exists, because I have injected it into a second component, in order to force activation of the above.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12949051">FELIX-5213</key>
            <summary>ComponentContext.getServiceReference returns null though service registered</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="njbartlett">Neil Bartlett</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Mar 2016 10:32:48 +0000</created>
                <updated>Fri, 8 Jul 2016 08:05:12 +0000</updated>
                            <resolved>Thu, 31 Mar 2016 00:21:29 +0000</resolved>
                                    <version>scr-2.0.2</version>
                                    <fixVersion>scr-2.0.4</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15210281" author="djencks" created="Thu, 24 Mar 2016 14:12:03 +0000"  >&lt;p&gt;Well, the service certainly &lt;em&gt;doesn&apos;t&lt;/em&gt; exist yet, since the activate method has not yet completed so it certainly hasn&apos;t been exposed to anything.&lt;/p&gt;

&lt;p&gt;I don&apos;t see how to fix this.  We get the ServiceReference to return from the ServiceRegistration, however in your scenario the consuming component is obtaining the service from the service reference before the registerService call has returned the ServiceRegistration.  Is there another way to reliably find the ServiceReference for a particular service?&lt;/p&gt;</comment>
                            <comment id="15210567" author="njbartlett" created="Thu, 24 Mar 2016 17:07:52 +0000"  >&lt;p&gt;There are two cases. If the component publishes its service before any consumer tries to fetch it, then we should get the ServiceRegistration during activate. This does seem to work correctly.&lt;/p&gt;

&lt;p&gt;On the other hand if somebody was already listening for the service when we registered and they call getService synchronously from the serviceChanged event, then SCR doesn&apos;t yet have either the ServiceRegistration OR the ServiceReference because OSGi hasn&apos;t returned from registerService yet. So SCR cannot possibly see the ServiceRegistration yet.&lt;/p&gt;

&lt;p&gt;So it&apos;s not a Felix/SCR bug, but certainly a gotcha in the spec.&lt;/p&gt;</comment>
                            <comment id="15218480" author="njbartlett" created="Wed, 30 Mar 2016 18:07:38 +0000"  >&lt;p&gt;Reopening on the advice on BJ, who makes the following comment:&lt;/p&gt;

&lt;p&gt;&quot;The component activate method is being activated because someone wants the service object. Since the ServiceRegistration is passed to the ServiceFactory.getService method, SCR can certainly provide the ServiceReference in the call to context.getServiceReference in the activate method.&quot;&lt;/p&gt;</comment>
                            <comment id="15218508" author="bjhargrave" created="Wed, 30 Mar 2016 18:20:01 +0000"  >&lt;p&gt;See section 5.2.4 &#8220;Early Need for ServiceRegistration Object&#8221; in the Core spec which provides advice for exactly this corner case.&lt;/p&gt;</comment>
                            <comment id="15219111" author="djencks" created="Thu, 31 Mar 2016 00:21:29 +0000"  >&lt;p&gt;Fixed in r1737170&lt;/p&gt;</comment>
                            <comment id="15227672" author="djencks" created="Wed, 6 Apr 2016 04:01:14 +0000"  >&lt;p&gt;Additional fix in r1737908 after Pierre de Rop noticed a FrameworkEvent logged in a test where service properties were being changed after service deregistration.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 33 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uig7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>