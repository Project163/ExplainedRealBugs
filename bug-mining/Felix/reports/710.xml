<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:13:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1666] Missing support for DS 1.1 specified lazy activation behavior</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1666</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;While attempting to move code from the Equinox implementation of DS to the Felix implementation, I discovered that the Felix SCR does not seem to support processing and activation of component configurations that are declared in bundles awaiting lazy activation.  The DS 1.1 specification, section 112.8.2 indicates that bundles awaiting lazy activation are to be processed when the SCR starts (and, presumedly by extension, as bundles bundles are starting/started).&lt;/p&gt;

&lt;p&gt;It appears that Felix has implemented most of the DS 1.1 support already so it appears this is an oversight.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12436951">FELIX-1666</key>
            <summary>Missing support for DS 1.1 specified lazy activation behavior</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="sykesm">Matthew Sykes</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Sep 2009 20:34:46 +0000</created>
                <updated>Tue, 8 Dec 2009 15:49:27 +0000</updated>
                            <resolved>Wed, 14 Oct 2009 06:11:41 +0000</resolved>
                                    <version>scr-1.0.8</version>
                                    <fixVersion>scr-1.2.0</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12762135" author="fmeschbe" created="Mon, 5 Oct 2009 10:09:07 +0000"  >&lt;p&gt;Indeed.&lt;/p&gt;

&lt;p&gt;Thanks for reporting.&lt;/p&gt;</comment>
                            <comment id="12764433" author="fmeschbe" created="Sun, 11 Oct 2009 08:36:10 +0000"  >&lt;p&gt;In Rev. 824038 add support for lazy bundle activation policy.&lt;/p&gt;

&lt;p&gt;Also refactored the map of bundles with components: This used to be indexed by the bundle symbolic name, but this is wrong since&lt;br/&gt;
it is perfectly ok for two or more bundles in the framework to have the same symbolic name. Now the bundle ID is used, which is guaranteed to be unique per bundle.&lt;/p&gt;

&lt;p&gt;Can you please verify this works correctly in your environment ? Thanks.&lt;/p&gt;</comment>
                            <comment id="12765090" author="sykesm" created="Tue, 13 Oct 2009 14:30:33 +0000"  >&lt;p&gt;I&apos;ve pulled in the SCR from the trunk and tried it out.  It looks like the component descriptors are being processed but things still aren&apos;t behaving as expected as the component services aren&apos;t being registered as the references are resolved.  This may be related to the lazy state but I expect it&apos;s something more fundamental.&lt;/p&gt;

&lt;p&gt;I&apos;ll dig in and either comment here or open another bug.&lt;/p&gt;

&lt;p&gt;Thanks for the quick turnaround on the patch.&lt;/p&gt;</comment>
                            <comment id="12765102" author="sykesm" created="Tue, 13 Oct 2009 14:58:31 +0000"  >&lt;p&gt;I dug in a little bit more.  I have a delayed component defined in a bundle with a lazy activation policy that provides a service.  The component has no references so its configuration is satisfied at the time the bundle is started.  The service for the delayed component is never registered causing dependent components to remain unsatisfied.&lt;/p&gt;

&lt;p&gt;This problem appears to be coming from the ComponentActivatorTask as the following warning issued via the log service:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;21&amp;#93;&lt;/span&gt; Cannot run task &apos;Enable Component: com.foo.bar.ServiceComponent (20)&apos;: Declaring bundle is not active null&lt;/p&gt;

&lt;p&gt;Enabled, satisfied components should have their provided services registered as a ServiceFactory when the bundle is in the LAZY_ACTIVATION state.  When the services are resolved, the deferred component should then be activated.&lt;/p&gt;

&lt;p&gt;Thanks again.&lt;/p&gt;</comment>
                            <comment id="12765110" author="sykesm" created="Tue, 13 Oct 2009 15:14:08 +0000"  >&lt;p&gt;Simple patch that honors Bundle.STARTING as an appropriate state for activation.&lt;/p&gt;</comment>
                            <comment id="12765115" author="fmeschbe" created="Tue, 13 Oct 2009 15:19:11 +0000"  >&lt;p&gt;Thanks for digging in and providing the patch. I try to apply it tonight.&lt;/p&gt;

&lt;p&gt;&amp;gt; Enabled, satisfied components should have their provided services registered as a ServiceFactory&lt;/p&gt;

&lt;p&gt;Are you sure ? I think the components providing a service should only be registered as ServiceFactory iff they are defined as delayed or as service factories in the descriptor. Service components declared as &quot;immediate=true&quot; should IMHO registered as plain services and thus should cause the bundle to be really started.&lt;/p&gt;

&lt;p&gt;WDYT ?&lt;/p&gt;</comment>
                            <comment id="12765121" author="sykesm" created="Tue, 13 Oct 2009 15:46:18 +0000"  >&lt;p&gt;I&apos;m sorry.  The ServiceFactory comment was intended to be scoped to delayed components.  I absolutely agree that there&apos;s no reason why an immediate component needs another layer of indirection.&lt;/p&gt;</comment>
                            <comment id="12765190" author="fmeschbe" created="Tue, 13 Oct 2009 19:00:41 +0000"  >&lt;p&gt;Found another place where the correct state has not been checked: In the case of starting SCR after other bundles, components of lazily started bundles are not loaded.&lt;/p&gt;

&lt;p&gt;Fixed both situations using a new helper method, which should these two situations in Rev. 824884&lt;/p&gt;

&lt;p&gt;May I ask you to check again ? Thanks.&lt;/p&gt;</comment>
                            <comment id="12765272" author="sykesm" created="Tue, 13 Oct 2009 22:01:54 +0000"  >&lt;p&gt;I did a quick sniff test by mucking around with start levels.  If I start the SCR after the other bundles are in lazy state, things seem to work.  Unfortunately I&apos;m not in a position to do a lot more than that.&lt;/p&gt;

&lt;p&gt;Thanks again for the quick turnaround.&lt;/p&gt;</comment>
                            <comment id="12765420" author="fmeschbe" created="Wed, 14 Oct 2009 06:11:41 +0000"  >&lt;p&gt;I slinghtly modified the active check to verify the lazy activation policy header is set for STARTING bundles in Rev. 825016.&lt;/p&gt;

&lt;p&gt;From your comments, I assume this works, so I resolve the issue. Thanks.&lt;/p&gt;</comment>
                            <comment id="12787537" author="fmeschbe" created="Tue, 8 Dec 2009 15:49:27 +0000"  >&lt;p&gt;SCR 1.2.0 has been released. Close all issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12421992" name="lazy-bundle-state.diff" size="993" author="sykesm" created="Tue, 13 Oct 2009 15:14:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vz33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184657</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>