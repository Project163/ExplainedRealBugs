<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:12:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5902] java.lang.IllegalArgumentException: Bundle org.apache.felix.scr is not resolved with R7 LogService</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5902</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I have updated to SCR 2.1.2 with Felix LogService 1.2.0 and getting&#160;&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException: Bundle org.apache.felix.scr &lt;span class=&quot;error&quot;&gt;&amp;#91;81&amp;#93;&lt;/span&gt; is not resolved.&lt;/p&gt;

&lt;p&gt;IMHO, this happens due to the&#160;&lt;b&gt;org.apache.felix.log.LogServiceImpl&lt;/b&gt;#getLogger(Bundle bundle, String name, Class&amp;lt;L&amp;gt; loggerType) checking if the calling Bundle is in&#160;&lt;b&gt;active&lt;/b&gt; or &lt;b&gt;resolved&lt;/b&gt;&#160;state. &#160;** &#160;Since the SCR bundle is in &lt;b&gt;starting&lt;/b&gt; state which throws the above mentioned&#160;exception.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here is the stack trace.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException: Bundle org.apache.felix.scr [81] is not resolved.
at org.apache.felix.log.LogServiceImpl.getLogService(LogServiceImpl.java:153)
at org.apache.felix.log.LogServiceImpl.getLogger(LogServiceImpl.java:146)
at org.apache.felix.scr.impl.logger.R7LogServiceLogger.&amp;lt;init&amp;gt;(R7LogServiceLogger.java:35)
at org.apache.felix.scr.impl.logger.LogServiceSupport.getLogger(LogServiceSupport.java:69)
at org.apache.felix.scr.impl.logger.LogServiceEnabledLogger.getLogger(LogServiceEnabledLogger.java:106)
at org.apache.felix.scr.impl.logger.AbstractLogger.isLogEnabled(AbstractLogger.java:71)
at org.apache.felix.scr.impl.logger.AbstractLogger.log(AbstractLogger.java:110)
at org.apache.felix.scr.impl.Activator.restart(Activator.java:143)
at org.apache.felix.scr.impl.config.ScrConfigurationImpl.configure(ScrConfigurationImpl.java:213)
at org.apache.felix.scr.impl.config.ScrConfigurationImpl.start(ScrConfigurationImpl.java:118)
at org.apache.felix.scr.impl.Activator.start(Activator.java:100)
at org.apache.felix.framework.util.SecureAction.startActivator(SecureAction.java:697)
at org.apache.felix.framework.Felix.activateBundle(Felix.java:2398)
at org.apache.felix.framework.Felix.startBundle(Felix.java:2304)
at org.apache.felix.framework.Felix.setActiveStartLevel(Felix.java:1535)
at org.apache.felix.framework.FrameworkStartLevelImpl.run(FrameworkStartLevelImpl.java:308)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Please look into this as I am blocked due to this.&lt;/p&gt;</description>
                <environment>MacOS 10.14, JDK 8, bnd-maven-plugin 4.0.0</environment>
        <key id="13177571">FELIX-5902</key>
            <summary>java.lang.IllegalArgumentException: Bundle org.apache.felix.scr is not resolved with R7 LogService</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="rakeshk15">Rakesh Kumar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Aug 2018 01:51:01 +0000</created>
                <updated>Mon, 20 Aug 2018 07:19:21 +0000</updated>
                            <resolved>Thu, 9 Aug 2018 09:50:13 +0000</resolved>
                                    <version>scr-2.1.2</version>
                                    <fixVersion>scr-2.1.6</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16572573" author="rakeshk15" created="Wed, 8 Aug 2018 02:14:19 +0000"  >&lt;p&gt;SCR 2.1.0 works with Felix Log Service 1.2.0 though.&lt;/p&gt;

&lt;p&gt;Only change I could see now is w.r.t finding out whether runtime is &lt;b&gt;r7Enabled&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;SCR 2.1.0 Code&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.r7Enabled = &lt;span class=&quot;code-quote&quot;&gt;&quot;org.osgi.service.log.LoggerFactory&quot;&lt;/span&gt;.equals(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.logService.getClass().getSuperclass().getName());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The getSuperClass always returns &lt;b&gt;java.lang.Object&lt;/b&gt; which can never be equals to&#160;&lt;b&gt;org.osgi.service.log.LoggerFactory&lt;/b&gt;&#160;and resulted in using&#160;&lt;b&gt;R6LogServiceLogger&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;SCR 2.1.2 Code,&lt;/b&gt; the code is corrected though&#160;and&#160;&lt;b&gt;R7LogServiceLogger&lt;/b&gt; is invoked which results in the&#160;&lt;b&gt;java.lang.IllegalArgumentException&lt;/b&gt;**&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; checkForLoggerFactory(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; clazz)
{
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ( clazz != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; )
    {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt;[] is = clazz.getInterfaces();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; c : is)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( &lt;span class=&quot;code-quote&quot;&gt;&quot;org.osgi.service.log.LoggerFactory&quot;&lt;/span&gt;.equals(c.getName()) )
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( checkForLoggerFactory(c) )
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
        }
        clazz = clazz.getSuperclass();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16573205" author="rakeshk15" created="Wed, 8 Aug 2018 13:05:47 +0000"  >&lt;p&gt;this happens intermittently, specifically when the Log Service bundle is&#160;activated before the SCR bundle.&lt;/p&gt;

&lt;p&gt;Please see the&#160;SCRandLogServiceBundleIds screenshot attached.&lt;/p&gt;</comment>
                            <comment id="16574390" author="cziegeler" created="Thu, 9 Aug 2018 07:23:10 +0000"  >&lt;p&gt;I think this need to be fixed in the Log Service. Logging should work for a starting bundle, otherwise you have no change to log in the BundleActivator#start method&lt;br/&gt;
For this particular error, this could be avoided in LogServiceImpl with checking that the bundle parameter in getLogger is the same as m_bundle - which should be the case, but that would just be a workaround. The real fix, as mentioned above is to allow logging for starting and probably stopping bundles. I understand that getBundleContext does not work in these states but such a bundle could get the LogService in that state&lt;/p&gt;</comment>
                            <comment id="16574423" author="cziegeler" created="Thu, 9 Aug 2018 07:44:19 +0000"  >&lt;p&gt;Actually my above comment is missing the fact, that the getLogger(Bundle, String, Class) method is used which explicitly states that the bundle needs to be resolved in the specification. It&apos;s possible to log in an bundle activator but not by using this method (which makes sense).&lt;br/&gt;
So SCR should not use this method to get the logger for itself as it already has the LogService/LoggerFactory from the service registry. For the logger instance SCR gets on behalf of extended bundles, the bundles are in the resolved/active state, so that&apos;s fine to use the bundle as a first argument&lt;br/&gt;
Or in other words, we need to fix this in SCR&lt;/p&gt;</comment>
                            <comment id="16574441" author="cziegeler" created="Thu, 9 Aug 2018 07:57:21 +0000"  >&lt;p&gt;Thanks for reporting this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshk15&quot; class=&quot;user-hover&quot; rel=&quot;rakeshk15&quot;&gt;rakeshk15&lt;/a&gt;&lt;br/&gt;
I&apos;ve committed a fix in rev 1837694 to SCR. Could you please try latest SCR from trunk?&lt;/p&gt;</comment>
                            <comment id="16574514" author="rakeshk15" created="Thu, 9 Aug 2018 09:01:46 +0000"  >&lt;p&gt;Thanks for the prompt fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cziegeler&quot; class=&quot;user-hover&quot; rel=&quot;cziegeler&quot;&gt;cziegeler&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I just built/deployed the 2.1.3-SNAPSHOT and it worked perfectly.&lt;/p&gt;</comment>
                            <comment id="16574586" author="cziegeler" created="Thu, 9 Aug 2018 09:50:13 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rakeshk15&quot; class=&quot;user-hover&quot; rel=&quot;rakeshk15&quot;&gt;rakeshk15&lt;/a&gt; for verifying&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12934811" name="SCRandLogServiceBundleIds.png" size="240124" author="rakeshk15" created="Wed, 8 Aug 2018 13:07:21 +0000"/>
                            <attachment id="12934744" name="Screenshot 2018-08-08 at 7.16.38 AM.png" size="58458" author="rakeshk15" created="Wed, 8 Aug 2018 01:47:33 +0000"/>
                            <attachment id="12934743" name="Screenshot 2018-08-08 at 7.17.09 AM.png" size="113463" author="rakeshk15" created="Wed, 8 Aug 2018 01:47:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3wt7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>