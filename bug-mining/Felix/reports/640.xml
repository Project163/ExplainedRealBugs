<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:12:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1580] Regression with native library handling</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1580</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>
&lt;p&gt;I tried to update to felix-2.0.0 but my bundles with native code would not install anymore, even though they work fine under felix-1.8.1 and equinox. The following error showed up for no good reason:&lt;/p&gt;

&lt;p&gt;org.osgi.framework.BundleException: Activator start error in bundle org.example.pkg &lt;span class=&quot;error&quot;&gt;&amp;#91;23&amp;#93;&lt;/span&gt;.&lt;br/&gt;
        at org.apache.felix.framework.Felix.activateBundle(Felix.java:1750)&lt;br/&gt;
        at org.apache.felix.framework.Felix.startBundle(Felix.java:1621)&lt;br/&gt;
        at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:890)&lt;br/&gt;
        at org.apache.felix.shell.impl.StartCommandImpl.execute(StartCommandImpl.java:114)&lt;br/&gt;
        at org.apache.felix.shell.impl.Activator$ShellServiceImpl.executeCommand(Activator.java:281)&lt;br/&gt;
        at org.apache.felix.shell.tui.Activator$ShellTuiRunnable.run(Activator.java:184)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: java.lang.ArrayIndexOutOfBoundsException: 0&lt;br/&gt;
        at org.apache.felix.framework.util.manifestparser.R4Library.match(R4Library.java:113)&lt;br/&gt;
        at org.apache.felix.framework.ModuleImpl$ModuleClassLoader.findLibrary(ModuleImpl.java:1929)&lt;br/&gt;
        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:1680)&lt;br/&gt;
        at java.lang.Runtime.loadLibrary0(Runtime.java:823)&lt;br/&gt;
        at java.lang.System.loadLibrary(System.java:1028)&lt;br/&gt;
        at org.example.pkg.internal.ExampleActivator.start(ExampleActivator.java:12)&lt;br/&gt;
        at org.apache.felix.framework.util.SecureAction.startActivator(SecureAction.java:667)&lt;br/&gt;
        at org.apache.felix.framework.Felix.activateBundle(Felix.java:1699)&lt;br/&gt;
        ... 6 more&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException: 0&lt;/p&gt;

&lt;p&gt;Through trial-and-error I have found the rather confusing conditions under which this error shows up:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;a library is not found in the bundle (code passes a nonexisting name to System.loadLibrary())&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;multiple libraries are &lt;em&gt;correctly&lt;/em&gt; specified in the Bundle-NativeCode header!&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There might be other confusing combinations. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I traced this back to the changes to R4Library in r790963 (Add support for configurable native library extensions. (&lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1298&quot; title=&quot;Implement support for new org.osgi.framework.library.extensions configuration property&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1298&quot;&gt;&lt;del&gt;FELIX-1298&lt;/del&gt;&lt;/a&gt;)) where the match() method was modified. It seems that the &quot;exts&quot; array is empty and therefore leads to the AIOOB later.&lt;/p&gt;</description>
                <environment>generic, JDK6, tested on Windows &amp;amp; Linux</environment>
        <key id="12435419">FELIX-1580</key>
            <summary>Regression with native library handling</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="h2o">Holger Hoffst&#228;tte</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Sep 2009 12:04:28 +0000</created>
                <updated>Fri, 11 Sep 2009 15:04:58 +0000</updated>
                            <resolved>Fri, 11 Sep 2009 14:31:30 +0000</resolved>
                                    <version>framework-2.0.0</version>
                                    <fixVersion>framework-2.0.1</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12754104" author="h2o" created="Fri, 11 Sep 2009 12:10:50 +0000"  >&lt;p&gt;I can provide a stripped-down example to demonstrate these behaviours, however it requires Windows (for the two required dlls). Let me know if this would be helpful for verifying the bug and I&apos;ll attach it.&lt;/p&gt;</comment>
                            <comment id="12754126" author="rickhall" created="Fri, 11 Sep 2009 13:40:11 +0000"  >&lt;p&gt;Definitely, an example would be good.&lt;/p&gt;

&lt;p&gt;I am sure it is something stupid on our part...we will get it fixed.&lt;/p&gt;</comment>
                            <comment id="12754134" author="rickhall" created="Fri, 11 Sep 2009 13:57:16 +0000"  >&lt;p&gt;I believe I see the issue. If I create a fix, can you build framework from the trunk to test it or would you rather have me email you a snapshot? If the latter, then contact me via email.&lt;/p&gt;</comment>
                            <comment id="12754142" author="h2o" created="Fri, 11 Sep 2009 14:12:59 +0000"  >&lt;p&gt;This is the simple bundle project to reproduce, including the two dlls to run (apr and pcre renamed so that they do not clash with stuff on PATH)&lt;/p&gt;

&lt;p&gt;The activator simply load one library and should work fine in its current form. To cause an error, either:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;simply add the second library (mypcre.dll) to the osgi.bnd instructions&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;change the activator to load &quot;foo&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Both should cause the AIOOB to occur on bundle start.&lt;/p&gt;
</comment>
                            <comment id="12754144" author="h2o" created="Fri, 11 Sep 2009 14:13:48 +0000"  >&lt;p&gt;I have trunk checked out and am familiar with maven &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12754151" author="rickhall" created="Fri, 11 Sep 2009 14:31:30 +0000"  >&lt;p&gt;Ok, I committed a fix to framework. We were not correctly checking if additional native library extensions were specified, now we do. Build framework, then main and test this resulting felix.jar file. If it works, please close this issue. If not, please reopen it and I will take another look. Thanks.&lt;/p&gt;</comment>
                            <comment id="12754159" author="h2o" created="Fri, 11 Sep 2009 14:46:54 +0000"  >&lt;p&gt;Tested successfully with both the clean-room example and my original project (with multiple libraries) on Windows as well as Linux. Thanks!&lt;/p&gt;</comment>
                            <comment id="12754165" author="rickhall" created="Fri, 11 Sep 2009 15:04:58 +0000"  >&lt;p&gt;Great. This fix will go out in the next maintenance release. Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12419304" name="org.example.pkg.zip" size="137740" author="h2o" created="Fri, 11 Sep 2009 14:12:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57447</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vwef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184222</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>