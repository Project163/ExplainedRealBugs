<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:47:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3618] [Framework] Should not allow bundles to use generic cap/req headers for osgi.wiring.* namespaces</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3618</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I think I found a bug while I playing with 4.3&apos;s Bundle Capabilities.&lt;/p&gt;

&lt;p&gt;I tried to convert a simple Export-Package to Provide-Capability.&lt;/p&gt;

&lt;p&gt;Core specification 5.0, &#167;3.3.3 defines the grammar for Provide-Compatibility headers:Provide-Capability ::= capability ( &apos;,&apos; capability )*&lt;br/&gt;
capability ::= name-space &lt;br/&gt;
( &#8217;;&#8217; directive | typed-attr )*&lt;br/&gt;
name-space ::= symbolic-name&lt;br/&gt;
typed-attr ::= extended ( &#8217;:&#8217; type ) &#8217;=&#8217; argument&lt;br/&gt;
type ::= scalar | list&lt;br/&gt;
scalar ::= &#8217;String&#8217; | &#8217;Version&#8217; | &#8217;Long&#8217; &lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;   &#8217;Double&#8217; &lt;br/&gt;
list ::= &#8217;List&amp;lt;&#8217; scalar &#8217;&amp;gt;&#8217;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;



&lt;p&gt;With my interpretation of the spec:&lt;/p&gt;

&lt;p&gt;Export-Package: com.test.api; version=&quot;1.0.0&quot;&lt;/p&gt;

&lt;p&gt;becomes:&lt;/p&gt;

&lt;p&gt;Provide-Capability: osgi.wiring.package; osgi.wiring.package=com.test.api; version:Version=1.0.0&lt;/p&gt;

&lt;p&gt;where osgi.wiring.package is both the namespace and the attribute name for the package name. Please note that the namespace is mandatory.&lt;/p&gt;

&lt;p&gt;This is consistent with the Require-Capability statement:&lt;br/&gt;
osgi.wiring.package; (&amp;amp;(osgi.wiring.package=com.test.api)(version&amp;gt;=1.0.0)(!(version&amp;gt;=2.0.0))) resolved by:&lt;br/&gt;
   osgi.wiring.package; com.test.api 1.0.0 from com.test.api &lt;span class=&quot;error&quot;&gt;&amp;#91;41&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;If I use this header and install my bundle, using Felix 4.0.3 I get:&lt;/p&gt;

&lt;p&gt;g! inspect c * 41&lt;br/&gt;
com.test.api &lt;span class=&quot;error&quot;&gt;&amp;#91;41&amp;#93;&lt;/span&gt; provides:&lt;br/&gt;
-------------------------------&lt;br/&gt;
osgi.wiring.bundle; com.test.api 1.0.0 &lt;span class=&quot;error&quot;&gt;&amp;#91;UNUSED&amp;#93;&lt;/span&gt;&lt;br/&gt;
osgi.wiring.host; com.test.api 1.0.0 &lt;span class=&quot;error&quot;&gt;&amp;#91;UNUSED&amp;#93;&lt;/span&gt;&lt;br/&gt;
osgi.wiring.package; com.test.api 1.0.0 required by:&lt;br/&gt;
   com.test.consumer &lt;span class=&quot;error&quot;&gt;&amp;#91;36&amp;#93;&lt;/span&gt;&lt;br/&gt;
osgi.wiring.package; com.test.api 1.0.0 &lt;span class=&quot;error&quot;&gt;&amp;#91;UNUSED&amp;#93;&lt;/span&gt;&lt;br/&gt;
g! &lt;/p&gt;

&lt;p&gt;Note that the same package is advised as exported &lt;b&gt;twice&lt;/b&gt; by the bundle with only the first one wired.&lt;/p&gt;


&lt;p&gt;Now, if I use Export-Package, it is exported just once as expected,&lt;br/&gt;
The only way with Provide-Capability to get it exported just once is to omit the namespace, as in:&lt;/p&gt;

&lt;p&gt;Provide-Capability: osgi.wiring.package=com.test.api; version:Version=1.0.0&lt;/p&gt;

&lt;p&gt;However, this is not compliant with the spec, since the namespace is mandatory.&lt;/p&gt;

&lt;p&gt;Finally, a last test where the namespace osgi.wiring.package has no attributes or directives fail with a NullPointerException, it should probably be handled gracefully. &lt;br/&gt;
Provide-Capability: osgi.wiring.package&lt;/p&gt;

&lt;p&gt;Stacktrace:&lt;br/&gt;
g! start 62&lt;br/&gt;
ERROR: Unable to resolve 62.0 (java.lang.NullPointerException)&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.felix.framework.BundleWiringImpl.&amp;lt;init&amp;gt;(BundleWiringImpl.java:270)&lt;br/&gt;
	at org.apache.felix.framework.StatefulResolver.markResolvedRevisions(StatefulResolver.java:650)&lt;br/&gt;
	at org.apache.felix.framework.StatefulResolver.resolve(StatefulResolver.java:189)&lt;br/&gt;
	at org.apache.felix.framework.Felix.resolveBundleRevision(Felix.java:3819)&lt;br/&gt;
	at org.apache.felix.framework.Felix.startBundle(Felix.java:1868)&lt;br/&gt;
	at org.apache.felix.framework.BundleImpl.start(BundleImpl.java:944)&lt;br/&gt;
	at org.apache.felix.gogo.command.Basic.start(Basic.java:729)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12600655">FELIX-3618</key>
            <summary>[Framework] Should not allow bundles to use generic cap/req headers for osgi.wiring.* namespaces</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="magnet">Simon Chemouil</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Jul 2012 13:09:34 +0000</created>
                <updated>Wed, 6 Feb 2013 13:19:36 +0000</updated>
                            <resolved>Thu, 31 Jan 2013 21:40:51 +0000</resolved>
                                    <version>framework-4.0.3</version>
                                    <fixVersion>framework-4.2.0</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13424858" author="rickhall" created="Mon, 30 Jul 2012 13:41:32 +0000"  >&lt;p&gt;Actually, the real bug here is that the framework shouldn&apos;t allow you to specify any osgi.wiring.* namespace in the generic cap/req model in the bundle manifest, since the spec doesn&apos;t allow that.&lt;/p&gt;

&lt;p&gt;We need to put a check that will either ignore such cases or throw an installation exception...I&apos;ll have to check which is the correct response. Thanks.&lt;/p&gt;</comment>
                            <comment id="13568138" author="rickhall" created="Thu, 31 Jan 2013 21:40:51 +0000"  >&lt;p&gt;Applied a patch to fail installation of any bundles using the osgi.wiring namespace in their generic capabilities and/or requirements. Please close if you are satisfied, thanks.&lt;/p&gt;</comment>
                            <comment id="13572397" author="magnet" created="Wed, 6 Feb 2013 13:19:36 +0000"  >&lt;p&gt;Fixed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>307361</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1avsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>271618</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>