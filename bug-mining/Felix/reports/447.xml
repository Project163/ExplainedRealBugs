<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:10:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1192] KARAF: Locking error in DefaultJDBCLock, also contains an eventual OutOfMemory error on locked processes.</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1192</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;If you configure servicemix to use the DefaultJDBCLock like so:&lt;/p&gt;


&lt;p&gt;karaf.lock=true&lt;br/&gt;
karaf.lock.class=org.apache.felix.karaf.main.DefaultJDBCLock&lt;br/&gt;
karaf.lock.level=50&lt;br/&gt;
karaf.lock.delay=1000&lt;br/&gt;
karaf.lock.jdbc.url=jdbc:mysql://localhost:3306/somedatabase&lt;br/&gt;
karaf.lock.jdbc.driver=org.apache.derby.jdbc.ClientDriver&lt;br/&gt;
karaf.lock.jdbc.user=root&lt;br/&gt;
karaf.lock.jdbc.password=&lt;br/&gt;
karaf.lock.jdbc.table=KARAF_LOCK&lt;br/&gt;
karaf.lock.jdbc.clustername=mycluster&lt;br/&gt;
karaf.lock.jdbc.timeout=30&lt;/p&gt;


&lt;p&gt;and simply run it you&apos;ll get an OutOfMemory error printed to the console within an hour or so. It appears that the offending code is here:&lt;/p&gt;


&lt;p&gt;/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;isAlive - test if lock still exists.&lt;br/&gt;
     */&lt;br/&gt;
    public boolean isAlive() throws Exception 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {        if (lockConnection == null) { return false; }        PreparedStatement statement = null;        try {
            lockConnection.setAutoCommit(false);
            statements.init(lockConnection);
            String sql = statements.testLockTableStatus();
            statement = lockConnection.prepareStatement(sql);
            statement.execute();
        } catch (Exception ex) {
            return false;
        }         return true;    }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;the try/catch statement needs a finally to ensure the PreparedStatement is cleaned up:&lt;/p&gt;


&lt;p&gt;} finally {&lt;br/&gt;
            if (statement != null) {&lt;br/&gt;
                try &lt;/p&gt;
{
                    statement.close();
                }
&lt;p&gt; catch (SQLException e) &lt;/p&gt;
{
                         //log failure here...
                }
&lt;p&gt;            }&lt;br/&gt;
        }&lt;/p&gt;


&lt;p&gt;We should also put some unit testing in place for this class and ensure that it doesn&apos;t leak any other resources, JDBC or otherwise as this class is used to set up master/slave HA which is an important use case to support.&lt;/p&gt;

&lt;p&gt;Also of note is that the container level locking mechanism seems to not be honored by slave processes. In the Main#lock method if the lock is enabled we should only start up to the configured lock level, otherwise start Karaf up to the default lock level.&lt;/p&gt;</description>
                <environment>All</environment>
        <key id="12426833">FELIX-1192</key>
            <summary>KARAF: Locking error in DefaultJDBCLock, also contains an eventual OutOfMemory error on locked processes.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ccustine">Chris Custine</assignee>
                                    <reporter username="jgoodyear">Jamie Mark Goodyear</reporter>
                        <labels>
                    </labels>
                <created>Mon, 1 Jun 2009 16:49:34 +0000</created>
                <updated>Thu, 18 Jun 2009 00:32:18 +0000</updated>
                            <resolved>Thu, 18 Jun 2009 00:32:17 +0000</resolved>
                                    <version>karaf-1.0.0</version>
                                    <fixVersion>karaf-1.0.0</fixVersion>
                                    <component>Karaf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12715149" author="jgoodyear" created="Mon, 1 Jun 2009 16:54:15 +0000"  >&lt;p&gt;File: felix1192.patch&lt;/p&gt;

&lt;p&gt;Contains modifications to:&lt;/p&gt;

&lt;p&gt;assembly/pom.xml&lt;br/&gt;
main/src/main/java/org/apache/felix/karaf/main/DefaultJDBCLock.java&lt;br/&gt;
main/src/main/java/org/apache/felix/karaf/main/Main.java&lt;br/&gt;
main/src/main/java/org/apache/felix/karaf/main/Statements.java, and&lt;br/&gt;
main/pom.xml&lt;/p&gt;

&lt;p&gt;Please note that this patch incorporates modifications from &lt;a href=&quot;https://issues.apache.org/jira/browse/KARAF-23&quot; title=&quot;Enhance features maven plugin to support deployment / undeployment of features, html generation and create a few archetypes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;KARAF-23&quot;&gt;FELIX-1080&lt;/a&gt; for improved logging support.&lt;/p&gt;

</comment>
                            <comment id="12721007" author="ccustine" created="Thu, 18 Jun 2009 00:32:18 +0000"  >&lt;p&gt;Patch applied, with thanks to Jamie Goodyear.  I made a few small adjustments to the patch and removed the logging calls related to &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1180&quot; title=&quot;Improve Karaf DefaultJDBCLock to use proper logging mechanism instead of System err prints.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1180&quot;&gt;&lt;del&gt;FELIX-1180&lt;/del&gt;&lt;/a&gt; because we going to revisit that issue at a later date.  Some calls were removed and some were converted to System.err.println, etc.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12409570" name="felix1192.patch" size="12522" author="jgoodyear" created="Mon, 1 Jun 2009 16:54:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vt3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183688</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>