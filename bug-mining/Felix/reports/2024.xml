<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:50:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4246] SCR and Metatype descriptor files get deleted on subsequent (incremental) eclipse build</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4246</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;There&apos;s a regression bug introduced in maven-scr-plugin 1.14.0 which &lt;b&gt;worked fine in 1.13.0&lt;/b&gt;. Consider the following scenario:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;a project is setup in eclipse/m2eclipse using the maven-scr-plugin 1.14.0 and contains java classes annotated with @Service and/or @Components&lt;/li&gt;
	&lt;li&gt;the project is cleaned (&apos;clean project&apos;) and built (&apos;build project&apos;)&lt;br/&gt;
 -&amp;gt; the descriptor .xml files are created as expected&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;when the project is built again (incrementally, eg manually triggering another &apos;build project&apos;), the descriptor .xml files are deleted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Some debugging narrows the problem down to the MavenProjectScanner.getSourcesForScanKind, where the buildContext.newScanner is invoked. The scanner returned there is of type EclipseBuildContext (set by m2eclipse) when doing a build right after a clean - and in this case the scanner finds java files, sets those via project.setSources and MetaTypeIO.generateDescriptors correctly generates the descriptors.&lt;/p&gt;

&lt;p&gt;In the incremental(-eclipse)-build case though, the buildContext.newScanner returns an EclipseIncrementalBuildContext - which results in an empty set of sources being passed to project.setScanner, hence later down the call-stack MetaTypeIO.generateDescriptors gets an empty list of components, thus &lt;b&gt;thinks it&apos;s a good idea to go through the metatype directory and delete &apos;obsolete&apos; metatype files&lt;/b&gt; - when in fact they are not quite obsolete..&lt;/p&gt;

&lt;p&gt;Maybe it would be better to hook into the &apos;clean&apos; method for deleting/cleaning up?&lt;/p&gt;</description>
                <environment>Eclipse, m2eclipse</environment>
        <key id="12670897">FELIX-4246</key>
            <summary>SCR and Metatype descriptor files get deleted on subsequent (incremental) eclipse build</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="stefanegli">Stefan Egli</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Sep 2013 09:59:42 +0000</created>
                <updated>Fri, 4 Oct 2013 14:10:32 +0000</updated>
                            <resolved>Fri, 27 Sep 2013 11:48:55 +0000</resolved>
                                    <version>maven-scr-plugin 1.14.0</version>
                                    <fixVersion>maven-scr-plugin 1.15.0</fixVersion>
                    <fixVersion>scr generator 1.8.2</fixVersion>
                                    <component>SCR Tooling</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13779822" author="cziegeler" created="Fri, 27 Sep 2013 11:01:17 +0000"  >&lt;p&gt;Thanks for reporting. I see two solutions, the simplest would be to check the type of the build context, if it&apos;s incremental don&apos;t delete things.&lt;br/&gt;
Is there some better way to find out whether a java file has been deleted?&lt;/p&gt;</comment>
                            <comment id="13779844" author="cziegeler" created="Fri, 27 Sep 2013 11:42:47 +0000"  >&lt;p&gt;Both descriptor files are affected - the plugin deletes all of them if there is no source. This looks like a wrong behaviour in the case of an incremental build.&lt;br/&gt;
As a first fix, I&apos;Ve added an incremental flag to the options which is set by the maven plugin and in that case no descriptor files are removed.&lt;br/&gt;
In the ant case everything is removed (like before) - and a mvn clean should remove the whole target directory. So this should work&lt;/p&gt;</comment>
                            <comment id="13779849" author="egli" created="Fri, 27 Sep 2013 11:51:05 +0000"  >&lt;p&gt;FYI: Tested and verified, the files dont get deleted anymore with the latest fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350726</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oh0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351017</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>