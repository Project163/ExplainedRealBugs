<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:14:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-6103] ConfigInstaller, when using NotCachablePersistenceManager, can restore cached stale properties</title>
                <link>https://issues.apache.org/jira/browse/FELIX-6103</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When using a NotCachablePersistenceManager the following steps occur when changing .config file values:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;ConfigInstaller.setConfig gets called.&lt;/li&gt;
	&lt;li&gt;Configuration gets retrieved from ConfigInstaller.getConfiguration method&lt;/li&gt;
	&lt;li&gt;getConfigurationAdmin().listConfigurations(filter) returns a new configuration each time because NotCacheablePersitenceManger is used.&lt;/li&gt;
	&lt;li&gt;Changes are performed in the new Configuration.&lt;/li&gt;
	&lt;li&gt;ConfigInstaller.doConfigurationEvent gets called back and retrieves configuration from configurationAdmin.&lt;/li&gt;
	&lt;li&gt;ConfigurationAdmin.getConfiguration retrieves cached value (hasn&apos;t been updated in step 4 because a new differente configuration was returned)&lt;/li&gt;
	&lt;li&gt;config file gets updated with cached values&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13228377">FELIX-6103</key>
            <summary>ConfigInstaller, when using NotCachablePersistenceManager, can restore cached stale properties</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbonofre">Jean-Baptiste Onofr&#233;</assignee>
                                    <reporter username="mariano.alvaro">Mariano Alvaro</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Apr 2019 16:09:47 +0000</created>
                <updated>Sat, 18 Jul 2020 06:10:11 +0000</updated>
                            <resolved>Sat, 18 Jul 2020 06:10:11 +0000</resolved>
                                                    <fixVersion>fileinstall-3.6.8</fixVersion>
                                    <component>File Install</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16819199" author="mariano.alvaro" created="Tue, 16 Apr 2019 16:12:31 +0000"  >&lt;p&gt;Possible solution attached:&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12966109/12966109_diffs.txt&quot; title=&quot;diffs.txt attached to FELIX-6103&quot;&gt;diffs.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="16854734" author="rotty3000" created="Mon, 3 Jun 2019 15:43:38 +0000"  >&lt;p&gt;Merged solution donated by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mariano.alvaro&quot; class=&quot;user-hover&quot; rel=&quot;mariano.alvaro&quot;&gt;mariano.alvaro&lt;/a&gt; at git-svn-id: &lt;a href=&quot;https://svn.apache.org/repos/asf/felix/trunk@1860567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/felix/trunk@1860567&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17158146" author="gzres" created="Wed, 15 Jul 2020 13:15:14 +0000"  >&lt;p&gt;I wanted to run pax-web 7.3.8-SNAPSHOT tests with Karaf 4.2.9 which uses felix.fileinstall 3.6.6 and the tests failed. I checked that the problem is &lt;a href=&quot;https://github.com/apache/felix-dev/commit/e4131ea442a711d5996ae514dcdbfb6a6ccd0486&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this commit&lt;/a&gt; and in particular, this fragment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        Configuration cachedConfiguration = oldConfiguration != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ?
                getConfigurationAdmin().getConfiguration(oldConfiguration.getPid()) : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;tt&gt;configAdmin.getConfiguration(pid)&lt;/tt&gt; - the 1-arg version of &lt;tt&gt;getConfiguration()&lt;/tt&gt; always calls &lt;tt&gt;org.apache.felix.cm.impl.ConfigurationImpl#setDynamicBundleLocation()&lt;/tt&gt; when location is not set and in my particular test the PIDs created by Karaf features installed during pax-exam tests have location set to URI of felix.fileinstall bundle (instead of &lt;tt&gt;&quot;?&quot;&lt;/tt&gt;) - such configuration can&apos;t be passed to pax-web-runtime bundle which sets up ManagedService for &lt;tt&gt;org.ops4j.pax.web&lt;/tt&gt; PID...&lt;/p&gt;

&lt;p&gt;IMO, &lt;tt&gt;getConfiguration(pid, &quot;?&quot;)&lt;/tt&gt; should be called in the above fragment instead.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;gnodet&lt;/a&gt; what do you think?&lt;/p&gt;</comment>
                            <comment id="17158159" author="gzres" created="Wed, 15 Jul 2020 13:29:11 +0000"  >&lt;p&gt;Yes, with fileinstall 3.6.4 and Karaf 4.2.8, pax-web karaf itests work fine.&lt;/p&gt;</comment>
                            <comment id="17158567" author="gnt" created="Wed, 15 Jul 2020 17:33:46 +0000"  >&lt;p&gt;Yes, the 1-arg &lt;tt&gt;getConfiguration(pid)&lt;/tt&gt; method call should only be used from the bundle which is using the configuration directly.  Any other usage, such as the one here, should use either &lt;tt&gt;getConfiguration(pid, &quot;?&quot;)&lt;/tt&gt; or &lt;tt&gt;getConfiguration(pid, null)&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="17158883" author="jbonofre" created="Thu, 16 Jul 2020 04:52:22 +0000"  >&lt;p&gt;Agree, the &quot;fix&quot; is wrong IMHO. We should use &lt;tt&gt;getConfiguration(pid, null)&lt;/tt&gt;. I&apos;m reopening the Jira and do the fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12966109" name="diffs.txt" size="5390" author="mariano.alvaro" created="Tue, 16 Apr 2019 16:12:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 17 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01ucw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>