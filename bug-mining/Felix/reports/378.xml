<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:09:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1044] DependencyManager may miss service registrations</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1044</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Instances of the DependencyManager class are used to track component references and to call the bind/unbind methods as appropriate.&lt;/p&gt;

&lt;p&gt;There are timing issues, which may cause instances of this class to miss services.&lt;/p&gt;

&lt;p&gt;The serviceAdded method checks whether the component is active before handling a service registration. Generally this works because the activation of the component will call the bind() method for all dependency managers. The problem arises if the service is registered &lt;em&gt;after&lt;/em&gt; the DependencyManager has bound registered services but before the component is fully active (e.g. while the activate() method is still running): In this case the service is received but not bound because the component is activating and because the dependency manager has already been called to bind to registered services, the registering service is lost.&lt;/p&gt;

&lt;p&gt;An approach to explore is to ignore the component state when deciding on whether to handle the event or not but to add a flag: The flag indicates whether the DependencyManager.bind method has already been called and hence future events should be handled. When the DependencyManager.unbind method is called, the flag should be cleare to prevent event handling. In other words:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Add boolean flag &quot;open&quot;&lt;/li&gt;
	&lt;li&gt;Add open(Object) method to be called during activation. This binds existing services and sets the &quot;open&quot; flag&lt;/li&gt;
	&lt;li&gt;Rename undinb(Object) called during deactivation to close(Object) . This unbinds all bound services and clears the &quot;open&quot; flag&lt;/li&gt;
	&lt;li&gt;Add a check for the &quot;open&quot; flag to the serviceChanged method&lt;/li&gt;
	&lt;li&gt;Remove the &quot;handleEvent&quot; method, whose functionality is replaced by the &quot;open&quot; flag&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12423259">FELIX-1044</key>
            <summary>DependencyManager may miss service registrations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Apr 2009 09:06:44 +0000</created>
                <updated>Wed, 22 Apr 2009 11:04:01 +0000</updated>
                            <resolved>Mon, 20 Apr 2009 11:14:05 +0000</resolved>
                                    <version>scr-1.0.6</version>
                                    <fixVersion>scr-1.0.8</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12700761" author="fmeschbe" created="Mon, 20 Apr 2009 11:03:47 +0000"  >&lt;p&gt;Closer inspection showed, that the component state handling is quite correct. The problem is, that the serviceAdded method must provide the invokeBindMethod with the component instance to call the method on, which may be null.&lt;/p&gt;

&lt;p&gt;The reason for this is the following process setting up an immediate component:&lt;/p&gt;

&lt;p&gt;  1 set state to ACTIVATING&lt;br/&gt;
  2 create instance&lt;br/&gt;
  3 call bind methods  (currently calling DependencyManager.bind( Object ))&lt;br/&gt;
  4 call the activate method&lt;br/&gt;
  5 set the implementation instance field&lt;br/&gt;
  6 etc.&lt;/p&gt;

&lt;p&gt;What happens is, that the interesting service is being registered &lt;em&gt;after&lt;/em&gt; the component has become ACTIVATING (step 1) but &lt;em&gt;before&lt;/em&gt; the implementation instance field is set (step 5). This causes the registation to fail and the service to be missed.&lt;/p&gt;

&lt;p&gt;The solution is for the bind(Object) method to keep the implementation instance in an internal field, which may subsequently be used by service registration event handling. This will cause all service registration between setting the component to ACTIVATING (step 1) and calling the bind(Object) method (step 3) to not be handled. But since the bind(Object) method calls for all services registered before this time, the service will be correctly picked up.&lt;/p&gt;

&lt;p&gt;It turns out, that storing the component instance in a field of the DependencyManager instance can also be used as the &quot;open&quot; flag described in the initial report.&lt;/p&gt;</comment>
                            <comment id="12700762" author="fmeschbe" created="Mon, 20 Apr 2009 11:13:43 +0000"  >&lt;p&gt;Applied the following fix in Rev. 766652&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;Rename DependencyManager.close() method to DependencyManager.dispose()&lt;br/&gt;
      this is the opposite method to the constructor and dispose marks this relation better than close&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Rename DependencyManager.bind(Object) to open(Object)&lt;br/&gt;
      indicates that the DependencyManager is now bound to the component instance and should handle (bind) references&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Rename DependencyManager.unbind(Object) method to close()&lt;br/&gt;
       this is the counterpart to the new open(Object) method and renaming is logical. In addition the instance parameter&lt;br/&gt;
       is not needed anymore because it is kept in a file of the DependencyManager instance&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Changed invokeBindMethod and invokeUnbindMethod signatures to not take an object parameter anymore since&lt;br/&gt;
       these methods can rely on the field referring to the component instance&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;invokeUnbindMethod does not return a value anymore because this return value is not used anyway&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Added lots of logging (mostly DEBUG) to the DependencyManager class&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12700763" author="fmeschbe" created="Mon, 20 Apr 2009 11:14:05 +0000"  >&lt;p&gt;Considering this issue fixed. Will keep it open for some time to gain more confidence.&lt;/p&gt;</comment>
                            <comment id="12701487" author="fmeschbe" created="Wed, 22 Apr 2009 11:04:01 +0000"  >&lt;p&gt;Internal testing shows that the issue is actually fixed. Therefore closing this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vz0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184646</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>