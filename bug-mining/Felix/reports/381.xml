<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:09:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1045] Felix 1.6.0 fails with ClassCircularityError</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1045</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;In Glassfish v3, JRuby runtime classes are loaded by a URLClassLoader form inside an OSGi bundle. This all worked fine till upgrade to Felix 1.6.0. With felix 1.6.0 it fails with ClassCircularityError. See &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; below. This issue seems to be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-962&quot; title=&quot;Erroneous class loading delegation to the application launcher classloader in some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-962&quot;&gt;&lt;del&gt;FELIX-962&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;This is &lt;br/&gt;
discussed on dev@glassfish at &lt;a href=&quot;http://www.nabble.com/Re:-ClassCircularityError-reported-with-the-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/Re:-ClassCircularityError-reported-with-the-&lt;/a&gt;&lt;br/&gt;
latest-v3-trunk-td23118716.html. &lt;/p&gt;

&lt;p&gt;Here is the evaluation of this issue by Richard Hall, a patched version of felix.jar is tested and it works &lt;br/&gt;
fine. &lt;/p&gt;

&lt;p&gt;----------&lt;br/&gt;
This code in Felix should only ever be executed when there is a CNFE that is going to be thrown. Do &lt;br/&gt;
you know if you should correctly be getting a CNFE?&lt;/p&gt;

&lt;p&gt;To be clear, the explicit issue we are talking about is this change in Felix:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;http://issues.apache.org/jira/browse/FELIX-962&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/FELIX-962&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We actually try to determine if a class is an inner class of a class loader when we are trying to guess &lt;br/&gt;
whether or not we should delegate to the parent class loader. This is part of a hack which is a last ditch &lt;br/&gt;
effort to avoid CNFE for bad JRE code that assumes it should be able to see everything on the class path &lt;br/&gt;
from any class loader.&lt;/p&gt;

&lt;p&gt;The change from &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-962&quot; title=&quot;Erroneous class loading delegation to the application launcher classloader in some cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-962&quot;&gt;&lt;del&gt;FELIX-962&lt;/del&gt;&lt;/a&gt; is actually implemented in two different ways, one for JDK &amp;lt; 1.5 and one &lt;br/&gt;
for JDK &amp;gt;= 1.5. In the &amp;gt;= 1.5 version we use the method Class.getEnclosingClass(), which seems to &lt;br/&gt;
cause the error for perhaps the reasons in the JDK bug you referenced. We implemented the two &lt;br/&gt;
different approaches since we assumed performance would be better by just using getEnclosingClass() &lt;br/&gt;
than trying to figure it out the enclosing class manually, which involves doing a class load.&lt;/p&gt;

&lt;p&gt;We could potentially try always using the &amp;lt; 1.5 approach, which does not use that method. If I created &lt;br/&gt;
a felix.jar that did that, could you test it to see if it resolved the issue? &lt;br/&gt;
----------&lt;/p&gt;</description>
                <environment></environment>
        <key id="12423296">FELIX-1045</key>
            <summary>Felix 1.6.0 fails with ClassCircularityError</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="vivek.pandey@sun.com">Vivek Pandey</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Apr 2009 19:01:39 +0000</created>
                <updated>Thu, 23 Apr 2009 08:50:52 +0000</updated>
                            <resolved>Wed, 22 Apr 2009 21:38:13 +0000</resolved>
                                    <version>framework-1.6.0</version>
                                    <fixVersion>framework-1.6.1</fixVersion>
                                    <component>Framework</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12701081" author="rickhall" created="Tue, 21 Apr 2009 07:25:40 +0000"  >&lt;p&gt;It appears as if Felix is running into the following JDK bug:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6508296&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6508296&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The JVM thinks there is a circularity error when there is not. The workaround for us seems to be avoid using Class.getEnclosingClass(). The only potential downside is the possible performance impact and/or accuracy of manually trying to determine the enclosing class, which may or may not be an issue.&lt;/p&gt;</comment>
                            <comment id="12701691" author="rickhall" created="Wed, 22 Apr 2009 21:38:13 +0000"  >&lt;p&gt;I have committed a patch for this issue. Please close if you are satisfied. Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57945</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 31 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vt4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183692</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>