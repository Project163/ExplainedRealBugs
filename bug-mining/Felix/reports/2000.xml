<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:50:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4165] FilePersistenceManager fails to rename configuration file</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4165</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Quite frequently a file move fails. The symptom is:&lt;/p&gt;

&lt;p&gt;java.io.IOException: Failed to rename configuration file from &apos;C:\Users\mli\nuc\env\master\karaf\karaf\karaf-deploy-std\target\karaf\data\cache\bundle5\data\config\org_apache_felix_cm_impl_DynamicBindings.config2019338524809240991.tmp&apos; to &apos;C:\Users\mli\nuc\env\master\karaf\karaf\karaf-deploy-std\target\karaf\data\cache\bundle5\data\config\org_apache_felix_cm_impl_DynamicBindings.config&lt;br/&gt;
	at org.apache.felix.cm.file.FilePersistenceManager._store(FilePersistenceManager.java:640)&lt;span class=&quot;error&quot;&gt;&amp;#91;5:org.apache.felix.configadmin:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.cm.file.FilePersistenceManager.store(FilePersistenceManager.java:582)&lt;span class=&quot;error&quot;&gt;&amp;#91;5:org.apache.felix.configadmin:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.cm.impl.DynamicBindings.putLocation(DynamicBindings.java:116)&lt;span class=&quot;error&quot;&gt;&amp;#91;5:org.apache.felix.configadmin:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.cm.impl.ConfigurationManager.setDynamicBundleLocation(ConfigurationManager.java:461)&lt;span class=&quot;error&quot;&gt;&amp;#91;5:org.apache.felix.configadmin:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.cm.impl.ConfigurationImpl.setDynamicBundleLocation(ConfigurationImpl.java:281)&lt;span class=&quot;error&quot;&gt;&amp;#91;5:org.apache.felix.configadmin:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.cm.impl.ConfigurationImpl.tryBindLocation(ConfigurationImpl.java:304)&lt;span class=&quot;error&quot;&gt;&amp;#91;5:org.apache.felix.configadmin:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.cm.impl.ConfigurationManager$UpdateConfiguration.run(ConfigurationManager.java:1705)&lt;span class=&quot;error&quot;&gt;&amp;#91;5:org.apache.felix.configadmin:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.felix.cm.impl.UpdateThread.run(UpdateThread.java:103)&lt;span class=&quot;error&quot;&gt;&amp;#91;5:org.apache.felix.configadmin:1.6.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:724)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_25&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Perhaps the file exists and cannot be deleted (could report return value of the delete() on line 634).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12656623">FELIX-4165</key>
            <summary>FilePersistenceManager fails to rename configuration file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="lichtin">Martin Lichtin</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Jul 2013 15:36:50 +0000</created>
                <updated>Sat, 28 Sep 2013 15:27:00 +0000</updated>
                            <resolved>Wed, 14 Aug 2013 08:14:34 +0000</resolved>
                                    <version>configadmin-1.6.0</version>
                                    <fixVersion>configadmin-1.8.0</fixVersion>
                                    <component>Configuration Admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13706903" author="lichtin" created="Fri, 12 Jul 2013 12:47:08 +0000"  >&lt;p&gt;I wanted to work around the issue, but unfortunately the exception is swallowed in ConfigurationImpl.java:&lt;/p&gt;

&lt;p&gt;    private void updateFactory() throws IOException {&lt;br/&gt;
        String factoryPid = getFactoryPidString();&lt;br/&gt;
        if ( factoryPid != null )&lt;br/&gt;
        {&lt;br/&gt;
            Factory factory = getConfigurationManager().getOrCreateFactory( factoryPid );&lt;br/&gt;
            if ( factory.addPID( getPidString() ) )&lt;br/&gt;
            {&lt;br/&gt;
                // only write back if the pid was not already registered&lt;br/&gt;
                // with the factory&lt;br/&gt;
                try&lt;/p&gt;
                {
                    factory.store();
                }
&lt;p&gt;                catch ( IOException ioe )&lt;br/&gt;
                {&lt;br/&gt;
                    getConfigurationManager().log( LogService.LOG_ERROR,&lt;br/&gt;
                        &quot;Failure storing factory &lt;/p&gt;
{0}
&lt;p&gt; with new configuration &lt;/p&gt;
{1}
&lt;p&gt;&quot;, new Object[]&lt;br/&gt;
                            &lt;/p&gt;
{ factoryPid, getPidString(), ioe }
&lt;p&gt; );&lt;br/&gt;
                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;Could you either re-throw or perhaps not catch the exception at all if you don&apos;t know how to handle it?&lt;/p&gt;</comment>
                            <comment id="13739373" author="fmeschbe" created="Wed, 14 Aug 2013 07:56:44 +0000"  >&lt;p&gt;Thanks for reporting the issue.&lt;/p&gt;

&lt;p&gt;I have added a check for the result of the delete operation in Rev. 1513753. Unfortunately Java just reports success or failure. So, the only thing that can be done at that level is to throw an IOException and fail the store operation.&lt;/p&gt;

&lt;p&gt;The reason for failure to delete a file (or rename a file by that matter) on windows is generally related to the file still being open. Both should not be the case to the best of my knowledge here.&lt;/p&gt;

&lt;p&gt;As for your follow-up comment: The code extract is unrelated to the original report. But you mention, that an IOException should be thrown here instead of catching and logging it. I disagree in this context because the factory.store() operation is an internal maintenance task not related to the actual creation of a factory configuration. As such me thinks this exception should not exposed to the consumer because the consumer can do even less. In addition, regardless of the success or failure in this particular situation, the task of the consumer (creating a factory configuration) has been done.&lt;/p&gt;</comment>
                            <comment id="13739384" author="lichtin" created="Wed, 14 Aug 2013 08:07:06 +0000"  >&lt;p&gt;Thanks for having a look and the check.&lt;/p&gt;

&lt;p&gt;As mentioned elsewhere, it is likely related to Windows and a virus scanner (Kaspersky in my case).&lt;br/&gt;
I excluded the Karaf run directories from getting scanned by KAV and don&apos;t see the issue since then (fingers crossed).&lt;/p&gt;</comment>
                            <comment id="13739397" author="fmeschbe" created="Wed, 14 Aug 2013 08:14:34 +0000"  >&lt;p&gt;Thanks to the quick feedback.&lt;/p&gt;

&lt;p&gt;So I resolve this issue for now. You may want to create a new one (relating to this) if the issue occurs again.&lt;/p&gt;</comment>
                            <comment id="13780874" author="fmeschbe" created="Sat, 28 Sep 2013 15:27:00 +0000"  >&lt;p&gt;Close after release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336846</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m3ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337169</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>