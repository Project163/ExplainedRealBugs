<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:03:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4384] Difference between inner class and normal class service</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4384</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Given the following code:&lt;br/&gt;
package org.example;&lt;/p&gt;

&lt;p&gt;import org.apache.felix.dm.DependencyActivatorBase;&lt;br/&gt;
import org.apache.felix.dm.DependencyManager;&lt;br/&gt;
import org.osgi.framework.BundleContext;&lt;/p&gt;

&lt;p&gt;public class Activator extends DependencyActivatorBase {&lt;br/&gt;
    @Override&lt;br/&gt;
    public synchronized void init(BundleContext context, DependencyManager manager) throws Exception &lt;/p&gt;
{
        manager.add(createComponent()
            .setInterface(A.class.getName(), null)
            .setImplementation(A.class)
            .add(createServiceDependency().setService(S.class).setRequired(true)));
        
        manager.add(createComponent()
            .setInterface(S.class.getName(), null)
            .setImplementation(S1.class));
    }

&lt;p&gt;    @Override&lt;br/&gt;
    public synchronized void destroy(BundleContext context, DependencyManager manager) throws Exception {}&lt;/p&gt;

&lt;p&gt;    interface S {}&lt;br/&gt;
    class A {}&lt;br/&gt;
    class S1 implements S {}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;dm will print out:&lt;br/&gt;
g! dm&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;8&amp;#93;&lt;/span&gt; mytest&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; org.example.Activator$A unregistered&lt;br/&gt;
    org.example.Activator$S service required unavailable&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; org.example.Activator$S registered&lt;/p&gt;


&lt;p&gt;But when the class S1 is promoted to a real class, dm will print out:&lt;br/&gt;
g! dm&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;8&amp;#93;&lt;/span&gt; mytest&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; org.example.Activator$A registered&lt;br/&gt;
    org.example.Activator$S service required available&lt;br/&gt;
 &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; org.example.Activator$S registered&lt;/p&gt;

&lt;p&gt;So the service class S1 is not available if its an inner class but is available if its a normal class.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12688943">FELIX-4384</key>
            <summary>Difference between inner class and normal class service</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Japio007">Jago de Vreede</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jan 2014 05:47:47 +0000</created>
                <updated>Wed, 14 Sep 2016 14:25:32 +0000</updated>
                            <resolved>Wed, 14 Sep 2016 14:25:30 +0000</resolved>
                                    <version>dependencymanager-3.1.0</version>
                                                    <component>Dependency Manager</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13871835" author="marrs" created="Wed, 15 Jan 2014 09:14:14 +0000"  >&lt;p&gt;When reproducing the scenario using the code you provided, I immediately get the following error (I cut away most of the stack trace):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR: Could not create service instance of &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;zzz.dm.Activator$S1. (java.lang.NoSuchMethodException: zzz.dm.Activator$S1.&amp;lt;init&amp;gt;())
java.lang.NoSuchMethodException: zzz.dm.Activator$S1.&amp;lt;init&amp;gt;()
ERROR: Could not register service &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; (java.lang.IllegalArgumentException: Service object cannot be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.)
java.lang.IllegalArgumentException: Service object cannot be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So your problem is that DM cannot find a default constructor for S1 (or A for that matter). Without an instance, it cannot register the service. If you change the init method as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        manager.add(createComponent()
            .setInterface(A.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            .setImplementation(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; A())
            .add(createServiceDependency().setService(S.class).setRequired(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)));

        manager.add(createComponent()
            .setInterface(S.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            .setImplementation(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; S1()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It works:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;g! dm 4
[4] zzz.dm
  zzz.dm.Activator$A() registered
    zzz.dm.Activator$S service required available
  zzz.dm.Activator$S() registered
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Another thing about your code. I noticed you &quot;synchronize&quot; the init and destroy methods. Because you invoke DM methods there, you end up invoking code outside your bundle. For example, if you register a service that someone else is depending on, the registration might trigger the invocation of callback methods in someone else&apos;s bundle on that same thread. You cannot hold locks while invoking such methods, because they might end up causing deadlocks (trust me, I&apos;ve seen a few over the years). In this case, I would simply remove the keyword, since there is no reason for it to be there.&lt;/p&gt;

&lt;p&gt;If you agree with my analysis, feel free to close the issue.&lt;/p&gt;</comment>
                            <comment id="13871852" author="japio007" created="Wed, 15 Jan 2014 09:36:58 +0000"  >&lt;p&gt;Indeed dm can&apos;t find the constructor for the inner class. &lt;br/&gt;
createInstance in ComponentImpl could be extended to cope with inner classes. Do you want a patch? or is not worth the effort?&lt;/p&gt;</comment>
                            <comment id="13901448" author="marrs" created="Fri, 14 Feb 2014 13:39:30 +0000"  >&lt;p&gt;A patch for this would be nice as I see no fundamental reason why it would be bad to use an inner class as the implementation for a component.&lt;/p&gt;</comment>
                            <comment id="13903036" author="sandermak" created="Mon, 17 Feb 2014 08:02:55 +0000"  >&lt;p&gt;Indeed, non-static inner-classes have a constructor that takes a reference to the outer class. Therefore the behavior in Jago&apos;s code seems correct and expected to me. Changing the A and S1 class to static inner-classes should solve this, right?&lt;/p&gt;

&lt;p&gt;Special-casing the post-hoc instantiation of non-static inner-classes within DM sounds like a hack to me. Especially since DM already offers component registration based on an instance rather than by reflection like Marcel pointed out.&lt;/p&gt;</comment>
                            <comment id="13903076" author="marrs" created="Mon, 17 Feb 2014 08:55:12 +0000"  >&lt;p&gt;I stand corrected, for some reason I thought we were talking about static inner classes already. I don&apos;t intend to magically patch non-static inner classes. That does not make sense. Thanks Sander!&lt;/p&gt;</comment>
                            <comment id="15490559" author="japio007" created="Wed, 14 Sep 2016 14:25:32 +0000"  >&lt;p&gt;Closing as Won&apos;t Fix As per comment thread, static inner classes work.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367910</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1reyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>