<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:03:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5249] Enabling SSL for org.apache.felix.http fails to properly restart the jetty service</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5249</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When reconfiguring SSL for org.apache.felix.http.jetty (for a running system where jetty only is configured for an HTTP port), below error happens. Afterwards, jetty is not handling one or both ports anymore.&lt;/p&gt;

&lt;p&gt;Restarting the entire server/osgi environment fixes it. It only seems to be a problem the first time or depending on timing. This happens during a somewhat automatic installation procedure on an Apache Sling based server, in which the osgi configuration comes in via the sling jcr installer. If I manually reconfigure org.apache.felix.http.jetty in the felix webconsole and enable/disable SSL, I don&apos;t see the problem.&lt;/p&gt;

&lt;p&gt;This is actually with org.apache.felix.http.jetty 3.1.6.B002, which seems to be a special vendor release.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;05.05.2016 16:12:33.931 *ERROR* [CM Configuration Updater (Update: pid=org.apache.felix.http)] org.apache.felix.configadmin Service [org.apache.felix.cm.ConfigurationAdmin,10, [org.osgi.service.cm.ConfigurationAdmin]] [org.osgi.service.cm.ManagedService, id=57, bundle=36/launchpad:resources/install/5/org.apache.felix.http.jetty-3.1.6-B002.jar]: Unexpected problem updating configuration org.apache.felix.http (java.util.NoSuchElementException)
java.util.NoSuchElementException: null
	at java.util.TreeMap.key(TreeMap.java:1221)
	at java.util.TreeMap.lastKey(TreeMap.java:292)
	at java.util.TreeSet.last(TreeSet.java:401)
	at org.apache.felix.http.jetty.internal.LoadBalancerCustomizerFactoryTracker.removedService(LoadBalancerCustomizerFactoryTracker.java:85)
	at org.apache.felix.http.jetty.internal.LoadBalancerCustomizerFactoryTracker.removedService(LoadBalancerCustomizerFactoryTracker.java:30)
	at org.osgi.util.tracker.ServiceTracker$Tracked.customizerRemoved(ServiceTracker.java:967)
	at org.osgi.util.tracker.ServiceTracker$Tracked.customizerRemoved(ServiceTracker.java:870)
	at org.osgi.util.tracker.AbstractTracked.untrack(AbstractTracked.java:341)
	at org.osgi.util.tracker.ServiceTracker.close(ServiceTracker.java:377)
	at org.apache.felix.http.jetty.internal.JettyService.stopJetty(JettyService.java:225)
	at org.apache.felix.http.jetty.internal.JettyService.updated(JettyService.java:196)
	at org.apache.felix.http.jetty.internal.JettyManagedService$1.updated(JettyManagedService.java:46)
	at org.apache.felix.cm.impl.helper.ManagedServiceTracker.updated(ManagedServiceTracker.java:189)
	at org.apache.felix.cm.impl.helper.ManagedServiceTracker.updateService(ManagedServiceTracker.java:152)
	at org.apache.felix.cm.impl.helper.ManagedServiceTracker.provideConfiguration(ManagedServiceTracker.java:85)
	at org.apache.felix.cm.impl.ConfigurationManager$UpdateConfiguration.run(ConfigurationManager.java:1753)
	at org.apache.felix.cm.impl.UpdateThread.run0(UpdateThread.java:143)
	at org.apache.felix.cm.impl.UpdateThread.run(UpdateThread.java:110)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12965452">FELIX-5249</key>
            <summary>Enabling SSL for org.apache.felix.http fails to properly restart the jetty service</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="alexander.klimetschek">Alexander Klimetschek</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 May 2016 00:14:05 +0000</created>
                <updated>Mon, 25 Jul 2016 06:01:14 +0000</updated>
                            <resolved>Tue, 17 May 2016 12:32:40 +0000</resolved>
                                    <version>http.jetty-3.1.6</version>
                                    <fixVersion>http.jetty-3.2.2</fixVersion>
                                    <component>HTTP Service</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15273384" author="alexander.klimetschek" created="Fri, 6 May 2016 00:27:44 +0000"  >&lt;p&gt;The affected code seems to be introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5207&quot; title=&quot;Flexible Customizer for &amp;quot;Enable Proxy/Load Balancer Connection&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5207&quot;&gt;&lt;del&gt;FELIX-5207&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://github.com/apache/felix/commit/31a9d13be64fbcad14e2606b8d37d080deaccbb7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;31a9d13b&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It looks like the &lt;a href=&quot;https://github.com/apache/felix/blob/trunk/http/jetty/src/main/java/org/apache/felix/http/jetty/internal/LoadBalancerCustomizerFactoryTracker.java#L85&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;TreeSet here is empty&lt;/a&gt;. It should probably check for &lt;tt&gt;set.isEmpty()&lt;/tt&gt; before calling &lt;tt&gt;last()&lt;/tt&gt;, which throws if empty. Another call to &lt;tt&gt;set.last()&lt;/tt&gt; is on line 53, that probably needs the same guarding. Something like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (set.isEmpty()) {
    highestReference = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    highestReference = set.last();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15273560" author="alexander.klimetschek" created="Fri, 6 May 2016 02:55:37 +0000"  >&lt;p&gt;If I provide the SSL-enabling configuration upon startup of the instance, I don&apos;t see the problem. Seems to be only upon configuration changes at runtime.&lt;/p&gt;</comment>
                            <comment id="15286404" author="krystian" created="Tue, 17 May 2016 11:03:32 +0000"  >&lt;p&gt;I can confirm that this issue is happening once every n times in my case (not always, but reoccurring) when changing any Jetty service property (so the issue description might be even reworded to be more generic if such details are needed). As far as I have checked the protection against the exception mentioned proposed by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexander.klimetschek&quot; class=&quot;user-hover&quot; rel=&quot;alexander.klimetschek&quot;&gt;alexander.klimetschek&lt;/a&gt; should be not in line 53 (highestReference retrieval after adding a reference to a set) but in fact in line 85 instead, as the highestReference retrieval is made there after reference removal and thus can be unsuccessful. The patch attached uses &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alexander.klimetschek&quot; class=&quot;user-hover&quot; rel=&quot;alexander.klimetschek&quot;&gt;alexander.klimetschek&lt;/a&gt;&#8217;s idea in that exact place and after applying works in my case at least.&lt;/p&gt;</comment>
                            <comment id="15286509" author="cziegeler" created="Tue, 17 May 2016 12:32:40 +0000"  >&lt;p&gt;Thanks for your patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=krystian&quot; class=&quot;user-hover&quot; rel=&quot;krystian&quot;&gt;krystian&lt;/a&gt;, it&apos;s applied&lt;/p&gt;</comment>
                            <comment id="15391390" author="mlindsey" created="Mon, 25 Jul 2016 06:01:14 +0000"  >&lt;p&gt;For anyone else experiencing this issue, we found that Restarting the entire server/OSGii was ineffective and required manual toggle the setting off &amp;amp; on through OSGi configuration to resolve.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12804387" name="FELIX-5249-patch.txt" size="968" author="krystian" created="Tue, 17 May 2016 11:03:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2x8mf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>