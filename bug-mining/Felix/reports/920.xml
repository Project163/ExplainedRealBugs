<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:16:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1531] Mandatory directive is ignored on the Export-Package when it comes to resolve the bundles</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1531</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When I try to resolve a bundle (bundleFooImport.jar) with the following manifest:&lt;br/&gt;
Import-Package: a.b.c;company=foo&lt;/p&gt;

&lt;p&gt;In the bundle repository, I have a bundle (bundleFoo.jar) with the following manifest:&lt;br/&gt;
Export-Package:a.b.c;version=3;company=foo;security=true;mandatory:=&quot;company,security&quot;&lt;/p&gt;

&lt;p&gt;The repository.xml for the bundleFoo.jar &lt;/p&gt;

&lt;p&gt;&amp;lt;capability name=&apos;package&apos;&amp;gt;&lt;br/&gt;
      &amp;lt;p n=&apos;company&apos; v=&apos;foo&apos;/&amp;gt;&lt;br/&gt;
        &amp;lt;p n=&apos;mandatory:&apos; t=&apos;set&apos; v=&apos;company,security&apos;/&amp;gt;&lt;br/&gt;
      &amp;lt;p n=&apos;package&apos; v=&apos;a.b.c&apos;/&amp;gt;&lt;br/&gt;
      &amp;lt;p n=&apos;security&apos; v=&apos;true&apos;/&amp;gt;&lt;br/&gt;
      &amp;lt;p n=&apos;version&apos; t=&apos;version&apos; v=&apos;3.0.0&apos;/&amp;gt;&lt;br/&gt;
    &amp;lt;/capability&amp;gt;&lt;/p&gt;

&lt;p&gt;For some reason, the felix resolve resolves the bundleFooImport.jar with bundle bundleFoo.jar, which is wrong. According to the osgi specification, bundleFoo.jar bundle insists the bundle imports specifying company and security attributes, which was not the case of bundleFooImport.jar. Clearly, the felix implementation of the mandatory directive is NOT correct.&lt;/p&gt;

&lt;p&gt;Please let me know if you need any more details.&lt;br/&gt;
Thanks&lt;br/&gt;
Hehe&lt;/p&gt;</description>
                <environment>not applicable</environment>
        <key id="12434105">FELIX-1531</key>
            <summary>Mandatory directive is ignored on the Export-Package when it comes to resolve the bundles</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="hehe">He Zhao</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Aug 2009 21:30:15 +0000</created>
                <updated>Thu, 1 Apr 2010 11:48:32 +0000</updated>
                            <resolved>Tue, 2 Mar 2010 15:06:03 +0000</resolved>
                                    <version>bundlerepository-1.4.3</version>
                                    <fixVersion>bundlerepository-1.6.0</fixVersion>
                                    <component>Bundle Repository (OBR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12748230" author="rickhall" created="Thu, 27 Aug 2009 01:51:47 +0000"  >&lt;p&gt;You are talking about resolving with OBR, not Felix, correct? The Felix framework should resolve this correctly, but OBR will not since handling directives is not fully supported.&lt;/p&gt;</comment>
                            <comment id="12840193" author="gnt" created="Tue, 2 Mar 2010 15:06:03 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=918062&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=918062&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Note that the maven bundle plugin currently generates wrong packages capabilities, see &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-2155&quot; title=&quot;The maven bundle plugin generates wrong capabilities for packages with directives&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-2155&quot;&gt;&lt;del&gt;FELIX-2155&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12840232" author="rickhall" created="Tue, 2 Mar 2010 16:51:33 +0000"  >&lt;p&gt;Looking at the patch for this, I was wondering why the following was necessary:&lt;/p&gt;

&lt;p&gt;     public synchronized boolean isSatisfied(Capability capability)&lt;/p&gt;
     {
-        return m_name.equals(capability.getName()) &amp;amp;&amp;amp; m_filter.matchCase(capability.getProperties());
+        return m_name.equals(capability.getName()) &amp;amp;&amp;amp; m_filter.matchCase(capability.getProperties())
+                &amp;amp;&amp;amp; (m_filter.toString().indexOf(&quot;(mandatory:&amp;lt;*&quot;) &amp;gt;= 0 || capability.getProperties().get(&quot;mandatory:&quot;) == null);
     }

&lt;p&gt;I have actually solved this differently in the new resolver, but I was having a debate with Peter Kriens about this and I think this might be related. Could you explain the need for the above (i.e., why was the original code sufficient)? Thanks.&lt;/p&gt;</comment>
                            <comment id="12840239" author="gnt" created="Tue, 2 Mar 2010 17:02:29 +0000"  >&lt;p&gt;Well, just remove that bit of code and run the tests.  They&apos;ll fail.&lt;/p&gt;</comment>
                            <comment id="12840242" author="rickhall" created="Tue, 2 Mar 2010 17:07:22 +0000"  >&lt;p&gt;Well, I assumed that. I just thought you could describe why, since you fixed it, but yeah I can just look into it myself.&lt;/p&gt;</comment>
                            <comment id="12840259" author="rickhall" created="Tue, 2 Mar 2010 18:02:09 +0000"  >&lt;p&gt;Ok, I looked into it and I realize what is going wrong. Peter&apos;s approach to mandatory attributes requires that all filters include a subset check on &quot;mandatory:&quot; otherwise they will falsely match capabilities with mandatory attributes. Since the test repository didn&apos;t include such a check, it was matching when it shouldn&apos;t have been.&lt;/p&gt;

&lt;p&gt;Ultimately, this is why I think Peter&apos;s approach is flawed since we cannot assume people will always obey this rule. In the new framework resolver I avoid this situation by doing the mandatory check in the filter implementation.&lt;/p&gt;</comment>
                            <comment id="12840357" author="gnt" created="Tue, 2 Mar 2010 22:20:53 +0000"  >&lt;p&gt;You&apos;re right.  And sorry about not describing the behavior, I did not meant to be harsh.&lt;/p&gt;

&lt;p&gt;I agree that the current approach is flawed, but I think I also understand why it was taken.  The main reason (I think) is that in the repository xml, we don&apos;t have the full manifest header for the imported packages, we only have a filter.    The meaning of the mandatory directive is to ensure that any attribute marked as mandatory will be requested by the importer.  This implies  that to be able to satisfy the mandatory directive, we&apos;d have to understand what the filter means and how it is composed.&lt;br/&gt;
I think that&apos;s way easier in your case because you don&apos;t have a real filter, you actually build it from the manifest in a way where verifying that the attribute is requested is actually easily doable.&lt;/p&gt;

&lt;p&gt;I originally wanted to modify the filter to add the missing clause, i.e. in case where the mandatory directive isn&apos;t verified, build a new filter like:&lt;br/&gt;
   (&amp;amp;(old-filter)(!(mandatory:=*)))&lt;br/&gt;
but modifying the filter did not really sound a good idea is I did not want to make that visible to the user.&lt;/p&gt;

&lt;p&gt;It may be possible to actually verify if the filter includes tests on the mandatory attributes, but at the end if would still make some assumption about how the filter has been generated.  &lt;/p&gt;

&lt;p&gt;So we have multiple ways to solve the problem imho:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;keep the current hack (i.e. either the filter test the mandatory attribtues or there are no mandatory attributes)&lt;/li&gt;
	&lt;li&gt;modify bindex / maven bundle plugin to add the missing clause for testing there are no mandatory attributes&lt;/li&gt;
	&lt;li&gt;try to verify that the filter includes tests on all mandatory attributes&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I don&apos;t have a strong opinion for any solution.  I just thought the first one would minimize the overhead at runtime.&lt;/p&gt;</comment>
                            <comment id="12840363" author="rickhall" created="Tue, 2 Mar 2010 22:38:01 +0000"  >&lt;p&gt;I understand why Peter chose that approach too, but I just don&apos;t really like it due to these sorts of issues. However, your assumption about the new resolver approach is incorrect. One of the main goals for the new resolver (besides improving performance on some of the &quot;worst case&quot; scenarios) is to adopt the generic capability/requirement model of OBR. So, the new framework resolver relies on filters, not on parsed manifest headers. Where Peter chose to implement new operators in his filter impl, I chose to make my filter impl understand the mandatory directive. That&apos;s the difference.&lt;/p&gt;

&lt;p&gt;For the current situation, I think your hack is the best we can do. In the long term, my goal is to use the new resolver for OBR, which would mean changing the way OBR deals with directives (i.e., they shouldn&apos;t be attributes named with &quot;:&quot; but should be handled separately) and using my filter implementation.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57495</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 39 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vyu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184617</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>