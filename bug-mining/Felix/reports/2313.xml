<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:55:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4455] Missing default constructor creates invalid class instances</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4455</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Consider the following component definition: &lt;/p&gt;

&lt;p&gt;@Component&lt;br/&gt;
@Instantiate&lt;br/&gt;
public class ComponentWithoutDefaultConstructor&lt;br/&gt;
{&lt;br/&gt;
    private Object internal = new Object();&lt;/p&gt;

&lt;p&gt;    @Property&lt;br/&gt;
    private String property;&lt;/p&gt;

&lt;p&gt;    /* Constructor for unit tests */&lt;br/&gt;
    public ComponentWithoutDefaultConstructor(String property)&lt;/p&gt;
    {
        System.out.println(&quot;Non-default constructor call!&quot;);
        this.property = property;
    }

&lt;p&gt;    @Validate&lt;br/&gt;
    public void activate()&lt;/p&gt;
    {
        System.out.println(&quot;ComponentWithoutDefaultConstructor: activating!&quot;);
        System.out.println(this.internal);
    }

&lt;p&gt;}&lt;/p&gt;


&lt;p&gt;As per definition, I would expect every instance of this class to have a non-null member &lt;tt&gt;internal&lt;/tt&gt; at class creation. This is all fine for my unit tests in a non-OSGi environment.&lt;/p&gt;

&lt;p&gt;However, having this processes by iPOJO and putting this in an OSGi container, the component outputs &lt;/p&gt;

&lt;p&gt;ComponentWithoutDefaultConstructor: activating!&lt;br/&gt;
null&lt;/p&gt;

&lt;p&gt;The existing non-default constructor is not called, while it seems that a separate constructor has been created that does non instantiate the member variable.&lt;/p&gt;

&lt;p&gt;If I extend the code by an empty default constructor, that one is called and all works perfectly fine.&lt;/p&gt;

&lt;p&gt;I have no idea how iPOJO creates the object instance anyways, as it should not be possible to create such an invalid object instance. I don&apos;t know much about the reflection APIs or byte code manipulation though.&lt;/p&gt;

&lt;p&gt;I have put a sample maven project on GitHub&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;, which can be built and droppped into a fresh Karaf container + iPOJO, which shows the problem.&lt;/p&gt;

&lt;p&gt;If there is no constructor iPOJO can use, I would expect iPOJO to either A) throw a warning/error (and build or runtime) and fail to instantiate the component or B) synthesize the default constructor properly, including the implicit instantiation of member variables.&lt;/p&gt;

&lt;p&gt;I encountered this problem both with iPOJO 1.10.1 and 1.11.1.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/BenjaminDebeerst/ipojo-component-constructor-sample&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/BenjaminDebeerst/ipojo-component-constructor-sample&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12700660">FELIX-4455</key>
            <summary>Missing default constructor creates invalid class instances</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="benjamindebeerst">Benjamin Debeerst</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Mar 2014 09:00:54 +0000</created>
                <updated>Wed, 10 Dec 2014 07:46:57 +0000</updated>
                            <resolved>Wed, 10 Dec 2014 07:46:57 +0000</resolved>
                                    <version>ipojo-manipulator-1.10.1</version>
                    <version>ipojo-manipulator-1.11.1</version>
                                                    <component>iPOJO</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13930181" author="clement.escoffier" created="Tue, 11 Mar 2014 10:15:02 +0000"  >&lt;p&gt;Could you try with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ComponentWithoutDefaultConstructor(@Property(name=&lt;span class=&quot;code-quote&quot;&gt;&quot;property&quot;&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; property)     { 
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Non-&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; constructor call!&quot;&lt;/span&gt;); 
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.property = property; 
} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13931583" author="benjamindebeerst" created="Wed, 12 Mar 2014 09:42:22 +0000"  >&lt;p&gt;Then I get &lt;tt&gt;createInstance -&amp;gt; Cannot invoke the constructor (method not found)&lt;/tt&gt; and &lt;tt&gt;Cannot create a POJO instance, the POJO constructor cannot be found&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Full stack:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2014-03-12 10:38:51,156 | ERROR |  pool-1-thread-1 | ipojo-constructor                | 91 - com.example.ipojo-constructor - 1.0.0.SNAPSHOT | [ERROR]  : [com.example.ComponentWithoutDefaultConstructor-0] createInstance -&amp;gt; Cannot invoke the constructor (method not found) : com.example.ComponentWithoutDefaultConstructor.&amp;lt;init&amp;gt;(org.apache.felix.ipojo.InstanceManager, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
java.lang.NoSuchMethodException: com.example.ComponentWithoutDefaultConstructor.&amp;lt;init&amp;gt;(org.apache.felix.ipojo.InstanceManager, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2800)[:1.7.0_25]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getDeclaredConstructor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2043)[:1.7.0_25]
        at org.apache.felix.ipojo.InstanceManager.createObject(InstanceManager.java:703)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.InstanceManager.getPojoObject(InstanceManager.java:923)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.handlers.lifecycle.callback.LifecycleCallbackHandler.__M_stateChanged(LifecycleCallbackHandler.java:156)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.handlers.lifecycle.callback.LifecycleCallbackHandler.stateChanged(LifecycleCallbackHandler.java)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.InstanceManager.setState(InstanceManager.java:536)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.InstanceManager.start(InstanceManager.java:418)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.ComponentFactory.createInstance(ComponentFactory.java:179)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.IPojoFactory.createComponentInstance(IPojoFactory.java:319)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.IPojoFactory.createComponentInstance(IPojoFactory.java:240)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.extender.internal.linker.ManagedType$InstanceSupport$1.call(ManagedType.java:312)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.extender.internal.linker.ManagedType$InstanceSupport$1.call(ManagedType.java:306)[84:org.apache.felix.ipojo:1.11.1]
        at org.apache.felix.ipojo.extender.internal.queue.JobInfoCallable.call(JobInfoCallable.java:114 [84:org.apache.felix.ipojo:1.11.1]
        at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)[:1.7.0_25]
        at java.util.concurrent.FutureTask.run(FutureTask.java:166)[:1.7.0_25]
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)[:1.7.0_25]
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)[:1.7.0_25]
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:724)[:1.7.0_25]
2014-03-12 10:38:51,156 | ERROR |  pool-1-thread-1 | ipojo-constructor                | 91 - com.example.ipojo-constructor -1.0.0.SNAPSHOT | [ERROR] com.example.ComponentWithoutDefaultConstructor : Cannot create a POJO instance, the POJO constructor cannot be found
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13932169" author="clement.escoffier" created="Wed, 12 Mar 2014 18:45:57 +0000"  >&lt;p&gt;Did you recompile the bundle in between ? Could you also tell me which version of the manipulator (ant task or maven plugin) are you using ?&lt;/p&gt;</comment>
                            <comment id="13933001" author="benjamindebeerst" created="Thu, 13 Mar 2014 08:36:12 +0000"  >&lt;p&gt;Yes, I recompiled with &lt;tt&gt;mvn clean package&lt;/tt&gt; each time. I used manipulator version 1.11.1 (maven plugin), but the same also happenend for 1.10.1.&lt;/p&gt;

&lt;p&gt;The &lt;a href=&quot;https://github.com/BenjaminDebeerst/ipojo-component-constructor-sample&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;project on GitHub&lt;/a&gt; is a proper maven project, so it should be possible to simply clone, build and run it.&lt;/p&gt;</comment>
                            <comment id="13933018" author="sauthieg" created="Thu, 13 Mar 2014 08:59:51 +0000"  >&lt;p&gt;Hi Benjamin, what do you expect from iPOJO ?&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A clean error message stating that you need a &quot;manageable&quot; (callable from the container) constructor ?&lt;/li&gt;
	&lt;li&gt;iPOJO to work with this constructor scheme ?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;AFAICT, option 2 is not workable (except if you use the {{&lt;/p&gt;
{@Property}
&lt;p&gt;}} on the parameter): any container (not only iPOJO) will have the same issue.&lt;/p&gt;

&lt;p&gt;What you could try is to have a default constructor (no params) that call the parametered constructor.&lt;/p&gt;</comment>
                            <comment id="13933073" author="benjamindebeerst" created="Thu, 13 Mar 2014 10:38:31 +0000"  >&lt;p&gt;I would expected iPOJO to do either of the following:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Raise an error (preferrably at manipulation/compile time), that a required (default) constructor is missing to perform field injection of properties and referenced services&lt;/li&gt;
	&lt;li&gt;Generate the default constructor, but &lt;em&gt;without skipping field instantiation&lt;/em&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The last part is the most important thing. I implemented a component with an internal field, carefully making sure that field can never be null - among others by instantiating at declaration. But then I throw the component into the runtime and at once get unexpected NPEs, because in some unknown way, iPOJO instantiated the class but not it&apos;s fields.&lt;/p&gt;

&lt;p&gt;If I define a class like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Component
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyClass {
   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; internal = &lt;span class=&quot;code-quote&quot;&gt;&quot;Default&quot;&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I expect that any fresh class instance has a non-null &lt;tt&gt;internal&lt;/tt&gt; field - provided the constructor does not overwrite the default value.&lt;/p&gt;
</comment>
                            <comment id="13933101" author="sauthieg" created="Thu, 13 Mar 2014 11:06:02 +0000"  >&lt;p&gt;Ok understood&lt;/p&gt;

&lt;p&gt;From the iPOJO point of view, your component is invalid because it miss a &quot;manageable constructor&quot;. I think that iPOJO should complain with an understandable error message &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m not sure it&apos;s a good practice to generate a default constructor for the user if he (maybe intentionally) omit it. It make things harder to debug because, you&apos;ll assume that what is executed is your code where in fact, iPOJO is doing its own stuff.&lt;/p&gt;

&lt;p&gt;What you see is a side effect of the ipojo manipulation: because it does not stop if no &quot;manageable constructor&quot; is found, it process the class as usual: build a new default constructor from scratch, and doing this, it miss the assignment. This is because, in bytecode, the assignment is done in the constructor, so if you generate one (instead of modifying one that contains the instruction), you won&apos;t have the assignment for free...&lt;/p&gt;</comment>
                            <comment id="13933190" author="benjamindebeerst" created="Thu, 13 Mar 2014 12:49:22 +0000"  >&lt;p&gt;I&apos;m good with both solutions.&lt;/p&gt;

&lt;p&gt;But:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;it processes the class as usual: build a new default constructor from scratch, and doing this, it misses the assignment&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Isn&apos;t this wrong for the &quot;usual&quot; case as well? I think it should definitely consider default assignments of fields whenever constructors are generated.&lt;/p&gt;</comment>
                            <comment id="13933211" author="sauthieg" created="Thu, 13 Mar 2014 13:02:50 +0000"  >&lt;p&gt;As I said, default field assignment is done in the constructor, not outside of it in the bytecode.&lt;br/&gt;
That means that for your component example, the compiled bytecode looks like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Component
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyClass {
   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; internal;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MyClass() {
      internal = &lt;span class=&quot;code-quote&quot;&gt;&quot;Default&quot;&lt;/span&gt;;
   }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, in this case, iPOJO modifies a correct constructor.&lt;/p&gt;

&lt;p&gt;What you miss is that, once you defined your own constructor, there is no more the default one available in the bytecode.&lt;/p&gt;</comment>
                            <comment id="13933359" author="benjamindebeerst" created="Thu, 13 Mar 2014 14:59:34 +0000"  >&lt;p&gt;Okay, I understand.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>379003</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tb0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>379295</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>