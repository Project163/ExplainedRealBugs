<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:15:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1927] NPE in AbstractComponentManager if no services are provided and a SecurityManager is installed</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1927</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Lukas Kolisko reports in response to &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-1827&quot; title=&quot;Check permission before getting or registering services&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-1827&quot;&gt;&lt;del&gt;FELIX-1827&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;If a service component does not provide any service and system security manager is set , then&lt;/p&gt;

&lt;p&gt;AbstractComponentManager.java line 537&lt;br/&gt;
final String[] services = getComponentMetadata().getServiceMetadata().getProvides(); fails with NPE because ServiceMetadata is null.&lt;/p&gt;

&lt;p&gt;Possible patch:&lt;/p&gt;

&lt;p&gt;Index: src/main/java/org/apache/felix/scr/impl/manager/AbstractComponentManager.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/main/java/org/apache/felix/scr/impl/manager/AbstractComponentManager.java (revision 888421)&lt;br/&gt;
+++ src/main/java/org/apache/felix/scr/impl/manager/AbstractComponentManager.java (working copy)&lt;br/&gt;
@@ -33,6 +33,7 @@&lt;br/&gt;
 import org.apache.felix.scr.impl.ComponentActivatorTask;&lt;br/&gt;
 import org.apache.felix.scr.impl.metadata.ComponentMetadata;&lt;br/&gt;
 import org.apache.felix.scr.impl.metadata.ReferenceMetadata;&lt;br/&gt;
+import org.apache.felix.scr.impl.metadata.ServiceMetadata;&lt;br/&gt;
 import org.osgi.framework.Bundle;&lt;br/&gt;
 import org.osgi.framework.InvalidSyntaxException;&lt;br/&gt;
 import org.osgi.framework.ServicePermission;&lt;br/&gt;
@@ -534,18 +535,22 @@&lt;br/&gt;
         boolean allowed = true;&lt;br/&gt;
         if ( System.getSecurityManager() != null )&lt;br/&gt;
         {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;final String[] services = getComponentMetadata().getServiceMetadata().getProvides();&lt;/li&gt;
	&lt;li&gt;if ( services != null &amp;amp;&amp;amp; services.length &amp;gt; 0 )&lt;br/&gt;
+ final ServiceMetadata metadata = getComponentMetadata().getServiceMetadata();&lt;br/&gt;
+ if ( metadata != null )&lt;br/&gt;
             {&lt;/li&gt;
	&lt;li&gt;final Bundle bundle = getBundle();&lt;/li&gt;
	&lt;li&gt;for ( int i = 0; i &amp;lt; services.length; i++ )&lt;br/&gt;
+ final String[] services = metadata.getProvides();&lt;br/&gt;
+ if ( services != null &amp;amp;&amp;amp; services.length &amp;gt; 0 )&lt;br/&gt;
                 {&lt;/li&gt;
	&lt;li&gt;final Permission perm = new ServicePermission( services&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, ServicePermission.REGISTER );&lt;/li&gt;
	&lt;li&gt;if ( !bundle.hasPermission( perm ) )&lt;br/&gt;
+ final Bundle bundle = getBundle();&lt;br/&gt;
+ for ( int i = 0; i &amp;lt; services.length; i++ )&lt;br/&gt;
                     {&lt;/li&gt;
	&lt;li&gt;log( LogService.LOG_INFO, &quot;Permission to register service 
{0} is denied&quot;, new Object[]&lt;br/&gt;
- { services[i] }, null );&lt;br/&gt;
- allowed = false;&lt;br/&gt;
+ final Permission perm = new ServicePermission( services&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;, ServicePermission.REGISTER );&lt;br/&gt;
+ if ( !bundle.hasPermission( perm ) )&lt;br/&gt;
+ {&lt;br/&gt;
+ log( LogService.LOG_INFO, &quot;Permission to register service {0}
&lt;p&gt; is denied&quot;, new Object[]&lt;br/&gt;
+ &lt;/p&gt;
{ services[i] }
&lt;p&gt;, null );&lt;br/&gt;
+ allowed = false;&lt;br/&gt;
+ }&lt;br/&gt;
                     }&lt;br/&gt;
                 }&lt;br/&gt;
             } &lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12442742">FELIX-1927</key>
            <summary>NPE in AbstractComponentManager if no services are provided and a SecurityManager is installed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="lkolisko">Lukas Kolisko</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Dec 2009 15:46:16 +0000</created>
                <updated>Fri, 30 Jul 2010 11:42:08 +0000</updated>
                            <resolved>Tue, 8 Dec 2009 15:54:06 +0000</resolved>
                                    <version>scr-1.2.0</version>
                                    <fixVersion> scr-1.4.0</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12787551" author="fmeschbe" created="Tue, 8 Dec 2009 15:54:06 +0000"  >&lt;p&gt;Thanks again for your patch. I have applied in Rev. 888451.&lt;/p&gt;

&lt;p&gt;Can you please check ? Thanks.&lt;/p&gt;</comment>
                            <comment id="12788017" author="lkolisko" created="Wed, 9 Dec 2009 10:21:29 +0000"  >&lt;p&gt;Rev. 888451 is working fine with my tests. Issue is fixed for me. Thank you very much.&lt;/p&gt;</comment>
                            <comment id="12894018" author="fmeschbe" created="Fri, 30 Jul 2010 11:42:08 +0000"  >&lt;p&gt;Closing since version is released.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57118</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vwlb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184253</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>