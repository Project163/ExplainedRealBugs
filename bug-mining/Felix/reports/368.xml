<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:09:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-977] Bundle resolving runs extreme long</title>
                <link>https://issues.apache.org/jira/browse/FELIX-977</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;I encountered problems while resolving rependencies via the bundle repository.&lt;/p&gt;

&lt;p&gt;Here is the scenario:&lt;br/&gt;
I have a simple obr file with a resource definition which has an unresolved dependency. In this file the resource with the name &quot;org.springframework.core&quot; has a requirement for the &quot;org.apache.commons.logging&quot;.&lt;br/&gt;
When I start felix with the obr repository location poniting to that file and type &apos;obr start com.kkoehler.osgi.repo-test&apos; I&apos;m gettiing the following:&lt;/p&gt;

&lt;p&gt;&amp;#8212; 8&amp;lt; &amp;#8212;&lt;br/&gt;
Unsatisfied requirement(s):&lt;br/&gt;
---------------------------&lt;br/&gt;
   (&amp;amp;(package=org.springframework.context)(version&amp;gt;=2.5.0))&lt;br/&gt;
      Unnamed - com.kkoehler.osgi:repo-test:bundle:1.0-SNAPSHOT&lt;br/&gt;
   (&amp;amp;(package=org.apache.commons.logging)(version&amp;gt;=1.0.4)(!(version&amp;gt;=2.0.0)))&lt;br/&gt;
      Spring Context&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Beans&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
      Spring Core&lt;br/&gt;
&amp;#8212; 8&amp;lt; &amp;#8212;&lt;/p&gt;

&lt;p&gt;I seems to me that felix tries to resolve the bundle &quot;Spring Core&quot; more than once &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The wrong unsatisfied dependency information can easily be fixed when checking for existing information in the current list before added it (org.apache.felix.bundlerepository.ResolverImpl). But I think this is only a workaround for the problem of &apos;double resolving&apos; (I also tried with a larger project and the resolving seems to run &apos;endless&apos;).&lt;/p&gt;

&lt;p&gt;In the ResolverImpl I found a statement which &apos;causes&apos; my problem but there is also a comment for the code.&lt;/p&gt;

&lt;p&gt;&amp;#8212; 8&amp;lt; &amp;#8212;&lt;br/&gt;
        // If the resource did not resolve, then remove it from&lt;br/&gt;
        // the resolve set, since to keep it consistent for iterative&lt;br/&gt;
        // resolving, such as what happens when determining the best&lt;br/&gt;
        // available candidate.&lt;br/&gt;
        if (!result)&lt;/p&gt;
        {
            m_resolveSet.remove(resource);
        }
&lt;p&gt;&amp;#8212; 8&amp;lt; &amp;#8212;&lt;/p&gt;

&lt;p&gt;Removing the line solved my problem but I&apos;m not sure if I&apos;m running in new ones...&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</description>
                <environment></environment>
        <key id="12416307">FELIX-977</key>
            <summary>Bundle resolving runs extreme long</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="kkoehler">Kristian Kohler</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Mar 2009 14:06:29 +0000</created>
                <updated>Mon, 30 Mar 2009 15:19:30 +0000</updated>
                            <resolved>Mon, 30 Mar 2009 15:04:15 +0000</resolved>
                                                    <fixVersion>bundlerepository-1.4.0</fixVersion>
                                    <component>Bundle Repository (OBR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12679601" author="kkoehler" created="Fri, 6 Mar 2009 14:08:26 +0000"  >&lt;p&gt;a repo file to reproduce the &quot;failure&quot;&lt;/p&gt;</comment>
                            <comment id="12689499" author="kkoehler" created="Thu, 26 Mar 2009 14:35:39 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;this patch also includes some optimization within the search for cababilities (should run much faster - in my environement this seems to be factor of 3-4). The current implementation checks the capabilities of a resource more than one time...&lt;/p&gt;


&lt;p&gt;Also added a test case for the resolver.&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12689719" author="rickhall" created="Thu, 26 Mar 2009 22:57:26 +0000"  >&lt;p&gt;Thanks for the patch. I looked it over. Generally speaking, I think your optimizations make sense, but there is one change that introduces a bug.&lt;/p&gt;

&lt;p&gt;When a bundle cannot be resolved, you no longer remove it from m_resolvedSet. This set serves two purposes:&lt;/p&gt;

&lt;p&gt;1. It is used for cycle detection.&lt;br/&gt;
2. It is the set of resolved bundles.&lt;/p&gt;

&lt;p&gt;As you can see, by not removing it, you are saying it is resolved. This is problematic when we searchResolvingResources() since it returns bundles as resolved which were not.&lt;/p&gt;

&lt;p&gt;Perhaps we need to break the set into two, one for cycle detection and one for resolved bundles. I can make this change to your patch next week, but if you want to have a go at it, feel free. Thanks.&lt;/p&gt;</comment>
                            <comment id="12689828" author="kkoehler" created="Fri, 27 Mar 2009 06:40:18 +0000"  >&lt;p&gt;Thanks for your reply. &lt;br/&gt;
As mentioned before I wasn&apos;t sure if this is a good idea to remove the line. That&apos;s why I commented out &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Ok, now I see the problem... Not sure if I find the time today...&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12690136" author="rickhall" created="Fri, 27 Mar 2009 22:32:25 +0000"  >&lt;p&gt;I tried to modify your patch to eliminate the one issue. I created a separate failed set to keep track of bundles that failed to resolve so we don&apos;t try to resolve them again. Let me know if it works for you. Thanks.&lt;/p&gt;</comment>
                            <comment id="12693691" author="kkoehler" created="Mon, 30 Mar 2009 08:03:26 +0000"  >&lt;p&gt;I&apos;m not sure but... where do you add entries to the failed set?&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12693760" author="rickhall" created="Mon, 30 Mar 2009 13:30:38 +0000"  >&lt;p&gt;Yeah, I think my changes are incomplete. I had modified it, but broke things, which eventually led me to revert and start over with a different approach, but apparently I didn&apos;t actually complete it. I will look into it again.&lt;/p&gt;</comment>
                            <comment id="12693769" author="rickhall" created="Mon, 30 Mar 2009 13:49:32 +0000"  >&lt;p&gt;Ok, as far as I can see, I forgot to add the line to add a resource to the failed set when it is removed from the resolve set due to a resolution failure. I have attached a new patch that adds this line and I tested it locally again and it is still correctly resolving dependencies. Let me know if it works for you. Thanks.&lt;/p&gt;</comment>
                            <comment id="12693791" author="kkoehler" created="Mon, 30 Mar 2009 14:41:39 +0000"  >&lt;p&gt;Hi Richard&lt;/p&gt;

&lt;p&gt;yes. works great. &lt;/p&gt;

&lt;p&gt;I modified your patch a bit because within the searchResolvingResources Method there was a array coping which is not neccessary IMO. &lt;/p&gt;

&lt;p&gt;I have also some Unit Tests for the resolver but they depend on the Filter patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-973&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/FELIX-973&lt;/a&gt;&lt;br/&gt;
Do I have a chance to get it in?&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12693794" author="rickhall" created="Mon, 30 Mar 2009 15:04:15 +0000"  >&lt;p&gt;I applied the patch. Thanks for helping with it. Please close if you are satisfied.&lt;/p&gt;

&lt;p&gt;I will try look at the FilterImpl patch next.&lt;/p&gt;</comment>
                            <comment id="12693798" author="kkoehler" created="Mon, 30 Mar 2009 15:19:30 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12404144" name="FELIX-977-2009-03-30.txt" size="7682" author="kkoehler" created="Mon, 30 Mar 2009 14:41:39 +0000"/>
                            <attachment id="12404129" name="FELIX-977-new.txt" size="6724" author="rickhall" created="Mon, 30 Mar 2009 13:46:45 +0000"/>
                            <attachment id="12403850" name="FELIX-977.txt" size="6647" author="rickhall" created="Fri, 27 Mar 2009 22:32:00 +0000"/>
                            <attachment id="12403717" name="bundlerepo-patch-2009_03_26.txt" size="63595" author="kkoehler" created="Thu, 26 Mar 2009 14:35:39 +0000"/>
                            <attachment id="12401628" name="myrepo.xml" size="47326" author="kkoehler" created="Fri, 6 Mar 2009 14:08:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58013</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0w0qf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184924</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>