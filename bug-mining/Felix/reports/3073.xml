<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:13:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-6050] Use abstract class for PrototypeRefPair implementations for Single vs. Multiple case</title>
                <link>https://issues.apache.org/jira/browse/FELIX-6050</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;The SCR implementation has two classes that keep track of prototype references from a service component:&lt;/p&gt;

&lt;p&gt;org.apache.felix.scr.impl.manager.MultiplePrototypeRefPair&lt;br/&gt;
org.apache.felix.scr.impl.manager.SinglePrototypeRefPair&lt;/p&gt;

&lt;p&gt;I&apos;m not entirely sure what motivated the need for Multiple vs. Single here.  The Single one gets used if the service component is a singleton service component.  The Multiple one gets used for service components that are bundle or prototype service components.  The Multiple one will key the instances of the referenced prototype service by the ComponentContextImpl for the requiring service component.  That way if there are multiple instances of the requiring component each instance (and therefore ComponentContextImpl insteance) will get a unique instance of the required prototype service.&lt;/p&gt;

&lt;p&gt;It appears the thought was that some optimizations could have been realized for the Singleton case so it has a specialized class separate from Multiple.  But I think this only makes the code hard to understand and I question that the current state of the code is providing any performance improvement.&lt;/p&gt;

&lt;p&gt;I propose we remove the SinglePrototypeRefPair and rename the MultiplePrototypeRefPair to be simply PrototypeRefPair.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13214253">FELIX-6050</key>
            <summary>Use abstract class for PrototypeRefPair implementations for Single vs. Multiple case</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tjwatson">Tom Watson</assignee>
                                    <reporter username="tjwatson">Tom Watson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Feb 2019 21:08:53 +0000</created>
                <updated>Fri, 1 Mar 2019 14:26:43 +0000</updated>
                            <resolved>Thu, 7 Feb 2019 16:33:57 +0000</resolved>
                                    <version>scr-2.1.14</version>
                                    <fixVersion>scr-2.1.16</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16762189" author="githubbot" created="Wed, 6 Feb 2019 22:18:19 +0000"  >&lt;p&gt;GitHub user tjwatson opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/182&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-6050&quot; title=&quot;Use abstract class for PrototypeRefPair implementations for Single vs. Multiple case&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-6050&quot;&gt;&lt;del&gt;FELIX-6050&lt;/del&gt;&lt;/a&gt; - remove SinglePrototypeRefPair&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/tjwatson/felix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/tjwatson/felix&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-6050&quot; title=&quot;Use abstract class for PrototypeRefPair implementations for Single vs. Multiple case&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-6050&quot;&gt;&lt;del&gt;FELIX-6050&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/182.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/182.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #182&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 1d2a62c36a7bb5ce8cf538447fcbe9d85265c343&lt;br/&gt;
Author: Tom Watson &amp;lt;tjwatson@...&amp;gt;&lt;br/&gt;
Date:   2019-02-06T21:13:33Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-6050&quot; title=&quot;Use abstract class for PrototypeRefPair implementations for Single vs. Multiple case&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-6050&quot;&gt;&lt;del&gt;FELIX-6050&lt;/del&gt;&lt;/a&gt; - remove SinglePrototypeRefPair&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16762212" author="djencks" created="Wed, 6 Feb 2019 22:46:26 +0000"  >&lt;p&gt;The motivation was to provide a simpler quicker code path when there was only the one component with the reference; it leaves out a map and a map lookup. &#160;I still think the two versions make some sense but I&apos;m not going to argue. &#160;It&apos;s not going to make any timing difference unless the component is using the locator strategy repeatedly over and over again; it does make a slight space difference.&lt;/p&gt;</comment>
                            <comment id="16762802" author="tjwatson" created="Thu, 7 Feb 2019 16:02:21 +0000"  >&lt;p&gt;OK, we can keep the two versions, but I am going to refactor the code a bit so the two implementations Single vs. Multiple can share common code for dealing with ServiceObjects.&lt;/p&gt;</comment>
                            <comment id="16762834" author="tjwatson" created="Thu, 7 Feb 2019 16:33:57 +0000"  >&lt;p&gt;Refactored the PrototypeRefPair impls to share code.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0q8o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>