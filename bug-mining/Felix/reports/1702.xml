<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:44:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-3721] Configuration not always provided upon initial service registration</title>
                <link>https://issues.apache.org/jira/browse/FELIX-3721</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;With the changes to implement Targeted PIDs and refactoring of the service trackers for &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3577&quot; title=&quot;Refactor helpers and service trackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3577&quot;&gt;&lt;del&gt;FELIX-3577&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3481&quot; title=&quot;[Config Admin 1.5] Implement support for Targeted PIDs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3481&quot;&gt;&lt;del&gt;FELIX-3481&lt;/del&gt;&lt;/a&gt; a race condition has been introduced which may cause ManagedService and ManagedServiceFactory services to not be called back  on initial registration.&lt;/p&gt;

&lt;p&gt;This has been exhibited by test build of the yet unpublished OSGi CT for Configuration Admin, for example:&lt;br/&gt;
    (1) ManagedService PID 1 registered&lt;br/&gt;
    (2) ManagedService PID 2 registered&lt;br/&gt;
    (3) ManagedService PID 2 called back&lt;/p&gt;

&lt;p&gt;The problem is, that before the call back to ManagedService PID 2, the call back to ManagedService PID 1 is expected.&lt;/p&gt;

&lt;p&gt;Turns out that this race condition takes place, which may primarily be reproduced on Linux platforms, probably due to different threading implementations on the platform:&lt;/p&gt;

&lt;p&gt;   T1: register service&lt;br/&gt;
   T1: call ServiceTracker.addingService&lt;br/&gt;
   T1: schedule service update task&lt;br/&gt;
   T2: run update task&lt;br/&gt;
   T2: terminate update task without calling the service&lt;br/&gt;
   T1: return from ServiceTracker.addingService returning ConfigurationMap&lt;/p&gt;

&lt;p&gt;This is expected since the service update task in T2 expects the ConfigurationMap stored in the ServiceTracker. But this is not the case yet because the ServiceTracker.addingService method has not yet returned it for it to be stored in the ServiceTracker. Therefore T2 is not able to call back the service and thus the update call never takes place.&lt;/p&gt;

&lt;p&gt;The fix is either to delay the task execution in T2 or to prepare the ConfigurationMap in T1 and hand it over to the task to be executed in T2. The first solution is suboptimal because we cannot find a timing value which (a) does not delay too much bug (b) still makes sure the ConfigurationMap will ultimately be available.&lt;/p&gt;</description>
                <environment>Java 6 on Linux platforms</environment>
        <key id="12612373">FELIX-3721</key>
            <summary>Configuration not always provided upon initial service registration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="fmeschbe">Felix Meschberger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Oct 2012 06:35:07 +0000</created>
                <updated>Fri, 23 Nov 2012 15:56:16 +0000</updated>
                            <resolved>Thu, 18 Oct 2012 09:32:57 +0000</resolved>
                                    <version>configadmin-1.6.0</version>
                                    <fixVersion>configadmin-1.6.0</fixVersion>
                                    <component>Configuration Admin</component>
                    <component>Specification compliance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13478737" author="fmeschbe" created="Thu, 18 Oct 2012 06:52:55 +0000"  >&lt;p&gt;Committed a fix in Rev. 1399530: The ManagedService&lt;span class=&quot;error&quot;&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt;Update tasks are now provided with the newly created ConfigurationMap which they hand back to the service tracker to provide the configuration. This accounts for the race situation and allows the asynchronous task to start and complete before the ServiceTracker.addingService method actually ends and allows the ServiceTracker to internally store and provide the ConfigurationMap.&lt;/p&gt;</comment>
                            <comment id="13478872" author="fmeschbe" created="Thu, 18 Oct 2012 09:32:57 +0000"  >&lt;p&gt;Looks like this fix does it.&lt;/p&gt;</comment>
                            <comment id="13480193" author="fmeschbe" created="Fri, 19 Oct 2012 18:05:11 +0000"  >&lt;p&gt;Fixed another timing issue happening in our integration tests in Rev. 1400198:&lt;/p&gt;

&lt;p&gt;When a ManagedService&lt;span class=&quot;error&quot;&gt;&amp;#91;Factory&amp;#93;&lt;/span&gt; updates the service.pid property of its service registration, the new configurations may not properly be recorded for them to be later updated (or removed if deleted). This happened in the test_ManagedService_change_pid and test_ManagedServiceFactory_change_pid tests of the ConfigurationBaseTest class on Linux and Windows platforms.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12617436">FELIX-3781</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12596648">FELIX-3577</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12552298">FELIX-3481</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249484</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aesf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>