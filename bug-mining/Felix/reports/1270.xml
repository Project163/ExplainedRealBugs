<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:22:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-2881] ConcurrentModificationException in HTTP whiteboard bundle</title>
                <link>https://issues.apache.org/jira/browse/FELIX-2881</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;When starting up an OSGi application which uses the HTTP Jetty and whiteboard bundles, I get a concurrent modification exception a lot of the time:&lt;/p&gt;

&lt;p&gt;ERROR: EventDispatcher: Error during dispatch. (java.util.ConcurrentModificationException)&lt;br/&gt;
java.util.ConcurrentModificationException&lt;br/&gt;
	at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)&lt;br/&gt;
	at java.util.HashMap$ValueIterator.next(HashMap.java:822)&lt;br/&gt;
	at org.apache.felix.http.whiteboard.internal.manager.ExtenderManagerImpl.registerAll(ExtenderManagerImpl.java:175)&lt;br/&gt;
	at org.apache.felix.http.whiteboard.internal.manager.ExtenderManagerImpl.setHttpService(ExtenderManagerImpl.java:154)&lt;br/&gt;
	at org.apache.felix.http.whiteboard.internal.tracker.HttpServiceTracker.added(HttpServiceTracker.java:37)&lt;br/&gt;
	at org.apache.felix.http.whiteboard.internal.tracker.HttpServiceTracker.added(HttpServiceTracker.java:24)&lt;br/&gt;
	at org.apache.felix.http.whiteboard.internal.tracker.AbstractTracker.addingService(AbstractTracker.java:36)&lt;br/&gt;
	at org.osgi.util.tracker.ServiceTracker$Tracked.customizerAdding(ServiceTracker.java:896)&lt;br/&gt;
	at org.osgi.util.tracker.AbstractTracked.trackAdding(AbstractTracked.java:261)&lt;br/&gt;
	at org.osgi.util.tracker.AbstractTracked.track(AbstractTracked.java:233)&lt;br/&gt;
	at org.osgi.util.tracker.ServiceTracker$Tracked.serviceChanged(ServiceTracker.java:840)&lt;br/&gt;
	at org.apache.felix.framework.util.EventDispatcher.invokeServiceListenerCallback(EventDispatcher.java:871)&lt;br/&gt;
	at org.apache.felix.framework.util.EventDispatcher.fireEventImmediately(EventDispatcher.java:733)&lt;br/&gt;
	at org.apache.felix.framework.util.EventDispatcher.fireServiceEvent(EventDispatcher.java:662)&lt;br/&gt;
	at org.apache.felix.framework.Felix.fireServiceEvent(Felix.java:3733)&lt;br/&gt;
	at org.apache.felix.framework.Felix.access$000(Felix.java:80)&lt;br/&gt;
	at org.apache.felix.framework.Felix$2.serviceChanged(Felix.java:717)&lt;br/&gt;
	at org.apache.felix.framework.ServiceRegistry.registerService(ServiceRegistry.java:107)&lt;br/&gt;
	at org.apache.felix.framework.Felix.registerService(Felix.java:2854)&lt;br/&gt;
	at org.apache.felix.framework.BundleContextImpl.registerService(BundleContextImpl.java:251)&lt;br/&gt;
	at org.apache.felix.http.base.internal.HttpServiceController.register(HttpServiceController.java:64)&lt;br/&gt;
	at org.apache.felix.http.base.internal.DispatcherServlet.init(DispatcherServlet.java:41)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHolder.initServlet(ServletHolder.java:440)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHolder.doStart(ServletHolder.java:263)&lt;br/&gt;
	at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)&lt;br/&gt;
	at org.mortbay.jetty.servlet.ServletHandler.initialize(ServletHandler.java:685)&lt;br/&gt;
	at org.mortbay.jetty.servlet.Context.startContext(Context.java:140)&lt;br/&gt;
	at org.mortbay.jetty.handler.ContextHandler.doStart(ContextHandler.java:517)&lt;br/&gt;
	at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)&lt;br/&gt;
	at org.mortbay.jetty.handler.HandlerWrapper.doStart(HandlerWrapper.java:130)&lt;br/&gt;
	at org.mortbay.jetty.Server.doStart(Server.java:224)&lt;br/&gt;
	at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)&lt;br/&gt;
	at org.apache.felix.http.jetty.internal.JettyService.initializeJetty(JettyService.java:145)&lt;br/&gt;
	at org.apache.felix.http.jetty.internal.JettyService.startJetty(JettyService.java:112)&lt;br/&gt;
	at org.apache.felix.http.jetty.internal.JettyService.run(JettyService.java:203)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12501631">FELIX-2881</key>
            <summary>ConcurrentModificationException in HTTP whiteboard bundle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="marrs">Marcel Offermans</assignee>
                                    <reporter username="marrs">Marcel Offermans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Mar 2011 23:11:29 +0000</created>
                <updated>Sat, 28 Sep 2013 17:40:01 +0000</updated>
                            <resolved>Mon, 5 Dec 2011 20:35:35 +0000</resolved>
                                    <version>http-2.2.0</version>
                                    <fixVersion>http-2.2.1</fixVersion>
                                    <component>HTTP Service</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13007735" author="marrs" created="Wed, 16 Mar 2011 23:18:33 +0000"  >&lt;p&gt;Upon analysis of this issue, it seems the following scenario unfolds:&lt;/p&gt;

&lt;p&gt;1) The HttpService goes live, as can be seen from the stack trace, and triggers a call to ExtenderManagerImpl.registerAll().&lt;br/&gt;
2) ExtenderManagerImpl.registerAll() loops over its internal collection (which seems well guarded by the synchronized keywords on all methods that manipulate or go over the internal HashMap).&lt;br/&gt;
3) At some point in time, actually before the exception occurs, some servlet is registered with the HttpService that in turn creates a new Servlet that is added to the service registry.&lt;br/&gt;
4) The addition of a new Servlet triggers a call to ExtenderManagerImpl.addMapping() on the same thread, so it already has the lock and modfies the internal collection.&lt;br/&gt;
5) A little while later, the iterator tries to proceed with the next element and fails with the exception printed above.&lt;/p&gt;

&lt;p&gt;The underlying problem is that at point 3) we invoke another service while holding a lock. That is never a good idea. It&apos;s better to, for example, create a copy of the list whilst holding the lock and then iterating over that copy outside of the lock.&lt;/p&gt;</comment>
                            <comment id="13162838" author="fmeschbe" created="Mon, 5 Dec 2011 15:49:45 +0000"  >&lt;p&gt;Taking over to fix along with &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-3226&quot; title=&quot;Whiteboard servlet service registered with default HttpContext if registered before HttpContext service&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-3226&quot;&gt;&lt;del&gt;FELIX-3226&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13163025" author="fmeschbe" created="Mon, 5 Dec 2011 20:35:35 +0000"  >&lt;p&gt;Looks like Marcel already fixed this. Thus resolving.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56098</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vsaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183556</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>