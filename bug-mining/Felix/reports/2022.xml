<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:50:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-4238] Unnecessary re-initialization of PersistenceManagers in configadmin</title>
                <link>https://issues.apache.org/jira/browse/FELIX-4238</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Brief description: If the PersistenceManager is replaced during runtime (e.g. after registering, unregistering and registering again), the ConfigurationManager always re-initializes its list of PersistenceManagers. Thus, no caching is possible and configurations are loaded unnecessarily.&lt;/p&gt;

&lt;p&gt;Details: In the ConfigurationManager line 818 getTrackingCount() on the service tracker for PersistenceManagers is called. If the number returned is different to the number of currently known PersistenceManagers, then the list of PersistenceManagers is re-initialized. This works fine as long as the list of PersistenceManager increases. But if a PersistenceManager is unregistered, getTrackingCount() returns an increased number but the number of known PersistenceManagers is decreased. Thus, the if-condition in line 819 is always true, which causes a re-initialization of the list of known PersistenceManagers.&lt;/p&gt;</description>
                <environment>MacOSX 10.8.5, Java 1.6.0_51, org.eclipse.osgi 3.9.0</environment>
        <key id="12670471">FELIX-4238</key>
            <summary>Unnecessary re-initialization of PersistenceManagers in configadmin</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fmeschbe">Felix Meschberger</assignee>
                                    <reporter username="mroeckl">Matthias</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Wed, 25 Sep 2013 12:06:37 +0000</created>
                <updated>Sat, 28 Sep 2013 15:26:59 +0000</updated>
                            <resolved>Wed, 25 Sep 2013 13:55:54 +0000</resolved>
                                    <version>configadmin-1.6.0</version>
                                    <fixVersion>configadmin-1.8.0</fixVersion>
                                    <component>Configuration Admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1800">0.5h</timeestimate>
                                        <comments>
                            <comment id="13777417" author="fmeschbe" created="Wed, 25 Sep 2013 12:52:27 +0000"  >&lt;p&gt;I am not sure, whether I understand your problem &amp;#8211; or your solution.&lt;/p&gt;

&lt;p&gt;getTrackingCount() is increased whenever something happens to tracked services: a service is added or removed or modified. So this number is ever increasing with service events from tracked service types.&lt;/p&gt;

&lt;p&gt;Consequently whenever a service disappears and re-appears the internal list of persistence managers &amp;#8211; CachingPersistenceManagerProxy[] - is recreated thus flushing all cached data and thus reloading on next access.&lt;/p&gt;

&lt;p&gt;While this accounts for changes to persistence managers, I suspect (and hope) persistence managers will only come and go or change rarely, so the overhead of reading configuration multiple times might be neglectable.&lt;/p&gt;</comment>
                            <comment id="13777448" author="mroeckl" created="Wed, 25 Sep 2013 13:24:53 +0000"  >&lt;p&gt;Thanks, Felix, for the quick reply. You understood my problem correct. The problem is that after a persistence manager changes (come or go) the internal list of persistence managers is recreated always although there was no further change.&lt;/p&gt;

&lt;p&gt;Whenever a persistence manager disappears and re-appears, the if-condition in line 819 is always true and, thus, the internal list of persistence managers is recreated whenever the method getPersistenceManagers() is called. That means each time the getConfiguration() method is called, the internal list of persistence managers is recreated which can be annoying because then the cache of CachingPersistenceManagerProxy has to be re-read. In my case properties are loaded from a remote server which takes some time, which then requires ca. 20 seconds to load 10 configurations.&lt;/p&gt;

&lt;p&gt;To make it clear, let me give you an example:&lt;br/&gt;
(1) First call of getConfiguration(): No custom persistence manager, only default FilePersistenceManager --&amp;gt; currentPmtCount=1, pmtCount=0 --&amp;gt; recreation of internal list of persistence managers&lt;br/&gt;
(2) Every consecutive call of getConfiguration(): currentPmtCount=1, pmtCount=1 --&amp;gt; no recreation of internal list of persistence managers&lt;br/&gt;
(3) Registration of custom persistence manager&lt;br/&gt;
(4) First call of getConfiguration(): currentPmtCount=2, pmtCount=1 --&amp;gt; recreation internal list of persistence managers&lt;br/&gt;
(5) Every consecutive call of getConfiguration() --&amp;gt; currentPmtCount=2, pmtCount=2 --&amp;gt; no recreation of internal list of persistence managers&lt;br/&gt;
(6) Deregistration of custom persistence manager&lt;br/&gt;
(7) Every consecutive call of getConfiguration() --&amp;gt; currentPmtCount=3, pmtCount=1 --&amp;gt; recreation of internal list of persistence managers&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; From now on, every call of getConfiguration() will trigger a recreation of the internal list of persistence managers&lt;/p&gt;</comment>
                            <comment id="13777487" author="fmeschbe" created="Wed, 25 Sep 2013 13:51:57 +0000"  >&lt;p&gt;Woot ! You found a really stupid mistake of comparing apples to oranges. Thank you very much !&lt;/p&gt;

&lt;p&gt;The fix is as simple as:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: ConfigurationManager.java
===================================================================
--- ConfigurationManager.java	(Revision 1524907)
+++ ConfigurationManager.java	(Arbeitskopie)
@@ -848,7 +848,7 @@
                 pm = ( PersistenceManager[] ) pmList.toArray( new PersistenceManager[pmList.size()] );
             }
 
-            pmtCount = pm.length;
+            pmtCount = currentPmtCount;
             persistenceManagers = pm;
         }
 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13777491" author="fmeschbe" created="Wed, 25 Sep 2013 13:55:54 +0000"  >&lt;p&gt;Applied the proposed patch in Rev. 1526179&lt;/p&gt;</comment>
                            <comment id="13780869" author="fmeschbe" created="Sat, 28 Sep 2013 15:26:59 +0000"  >&lt;p&gt;Close after release&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350300</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oeen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>