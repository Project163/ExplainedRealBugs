<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:09:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5613] SCR bundle fails to start without Config Admin</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5613</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;SCR 2.0.8 still imports package &lt;tt&gt;org.osgi.service.cm&lt;/tt&gt; as optional, but it does not start when there is no export of that package available.&lt;/p&gt;

&lt;p&gt;I know that SCR should be able to work without a Config Admin implementation but it clearly does not work at all without an import of the API package, therefore it should not be marked as an optional import.&lt;/p&gt;

&lt;p&gt;Stack trace:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;! Failed to start bundle org.apache.felix.scr-2.0.8, exception activator error org/osgi/service/cm/ConfigurationListener from: java.lang.ClassLoader:defineClass1#-2
org.osgi.framework.BundleException: Activator start error in bundle org.apache.felix.scr [5].
        at org.apache.felix.framework.Felix.activateBundle(Felix.java:2276)
        at org.apache.felix.framework.Felix.startBundle(Felix.java:2144)
        [... snip ...]
Caused by: java.lang.NoClassDefFoundError: org/osgi/service/cm/ConfigurationListener
        at java.lang.ClassLoader.defineClass1(Native Method)
        at java.lang.ClassLoader.defineClass(ClassLoader.java:760)
        at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.defineClass(BundleWiringImpl.java:2370)
        at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.findClass(BundleWiringImpl.java:2154)
        at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1542)
        at org.apache.felix.framework.BundleWiringImpl.access$400(BundleWiringImpl.java:79)
        at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:2018)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        at org.apache.felix.scr.impl.Activator.doStart(Activator.java:157)
        at org.apache.felix.utils.extender.AbstractExtender.start(AbstractExtender.java:114)
        at org.apache.felix.scr.impl.Activator.restart(Activator.java:142)
        at org.apache.felix.scr.impl.config.ScrConfigurationImpl.configure(ScrConfigurationImpl.java:196)
        at org.apache.felix.scr.impl.config.ScrConfigurationImpl.start(ScrConfigurationImpl.java:117)
        at org.apache.felix.scr.impl.Activator.start(Activator.java:110)
        at org.apache.felix.framework.util.SecureAction.startActivator(SecureAction.java:697)
        at org.apache.felix.framework.Felix.activateBundle(Felix.java:2226)
        ... 11 more
Caused by: java.lang.ClassNotFoundException: org.osgi.service.cm.ConfigurationListener not found by org.apache.felix.scr [5]
        at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1574)
        at org.apache.felix.framework.BundleWiringImpl.access$400(BundleWiringImpl.java:79)
        at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.loadClass(BundleWiringImpl.java:2018)
        at java.lang.ClassLoader.loadClass(ClassLoader.java:357)
        ... 27 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13063318">FELIX-5613</key>
            <summary>SCR bundle fails to start without Config Admin</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cziegeler">Carsten Ziegeler</assignee>
                                    <reporter username="nbartlett">Neil Bartlett</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Apr 2017 21:36:04 +0000</created>
                <updated>Mon, 1 May 2017 18:08:14 +0000</updated>
                            <resolved>Sun, 23 Apr 2017 09:57:59 +0000</resolved>
                                                    <fixVersion>scr-2.0.10</fixVersion>
                                    <component>Declarative Services (SCR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15965341" author="djencks" created="Wed, 12 Apr 2017 04:07:39 +0000"  >&lt;p&gt;So here&apos;s the culprit, if my copy of the code is accurate:&lt;/p&gt;

&lt;p&gt;    public RegionConfigurationSupport registerRegionConfigurationSupport(&lt;br/&gt;
            ServiceReference&amp;lt;ConfigurationAdmin&amp;gt; reference) {&lt;/p&gt;

&lt;p&gt;Why doesn&apos;t type erasure eliminate all reference to config admin???&lt;/p&gt;

&lt;p&gt;I imagine we can fix this by using ServiceReference&amp;lt;?&amp;gt; and casting it in the RegionConfigurationSupport constructor, but I&apos;d like to know how my understanding of generics is wrong.&lt;/p&gt;</comment>
                            <comment id="15977877" author="cziegeler" created="Fri, 21 Apr 2017 00:48:20 +0000"  >&lt;p&gt;If you decompile the class file it shows ServiceReference&amp;lt;ConfigurationAdmin&amp;gt;, so it seems its really not erased&lt;br/&gt;
More info at &lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/339699/java-generics-type-erasure-when-and-what-happens&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/339699/java-generics-type-erasure-when-and-what-happens&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15979858" author="nbartlett" created="Sat, 22 Apr 2017 11:16:40 +0000"  >&lt;p&gt;I tried this and it didn&apos;t help.&lt;/p&gt;

&lt;p&gt;Loading class ComponentRegistry triggers loading of RegionConfigurationSupport because it is used as a method parameter and return value in several methods. RegionConfigurationSupport necessarily loads ConfigurationListener because it implements that interface.&lt;/p&gt;

&lt;p&gt;I note that RegionConfigurationSupport registers &lt;b&gt;itself&lt;/b&gt; (i.e. &apos;this&apos;) as a ConfigurationListener in its start method. This is a detail of RegionConfigurationSupport that doesn&apos;t need to be exposed outside the class. It could be refactored to register a private inner class object. I think this would allow the CNFE/NCDFE to be caught and ignored inside the RegionConfigurationSupport#start() method.&lt;/p&gt;</comment>
                            <comment id="15980158" author="githubbot" created="Sat, 22 Apr 2017 22:42:15 +0000"  >&lt;p&gt;GitHub user neilxb opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/105&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5613&quot; title=&quot;SCR bundle fails to start without Config Admin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5613&quot;&gt;&lt;del&gt;FELIX-5613&lt;/del&gt;&lt;/a&gt; - SCR bundle fails to start without Config Admin&lt;/p&gt;

&lt;p&gt;    RegionConfigurationSupport does not need to directly implement ConfigurationListener. By registering an anonymous inner class, the class loading errors are isolated to this class and do not prevent the bundle from starting.&lt;/p&gt;

&lt;p&gt;    *&lt;b&gt;Testing Note&lt;/b&gt;*&lt;/p&gt;

&lt;p&gt;    I tried *&lt;b&gt;very&lt;/b&gt;* hard to write a PAX Exam integration test that would prove SCR works when there is no exporter of `org.osgi.service.cm`, but I believe this is impossible due to a limitation of PAX Exam. The testing framework always contains the OSGi Compendium bundle version 4.2.0 (`org.osgi:org.osgi.compendium:4.2.0`) because it is a dependency of PAX. Compendium exports `org.osgi.service.cm` version 1.3.0. It cannot be removed as far as I can tell.&lt;/p&gt;

&lt;p&gt;    I have verified manually that SCR works in both a framework with Config Admin and a framework without Config Admin. However without an automated test it is always possible somebody will make a change that makes SCR dependent on Config Admin once again. I would suggest migrating to bnd-testing-maven-plugin as this does not pollute the testing framework with dependencies.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/njbartlett/felix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/njbartlett/felix&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5613&quot; title=&quot;SCR bundle fails to start without Config Admin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5613&quot;&gt;&lt;del&gt;FELIX-5613&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/105.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/105.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #105&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2b8dbb83289bf37bb4563b30c05a826fd777ea71&lt;br/&gt;
Author: Neil Bartlett &amp;lt;njbartlett@gmail.com&amp;gt;&lt;br/&gt;
Date:   2017-04-22T18:05:53Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5613&quot; title=&quot;SCR bundle fails to start without Config Admin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5613&quot;&gt;&lt;del&gt;FELIX-5613&lt;/del&gt;&lt;/a&gt; - SCR bundle fails to start without Config Admin&lt;/p&gt;

&lt;p&gt;    RegionConfigurationSupport does not need to directly implement Config-&lt;br/&gt;
    uartionListener. By registering an anonymous inner class, the class&lt;br/&gt;
    loading errors can be isolated to this class rather than bubbling up&lt;br/&gt;
    to the bundle activator.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15980349" author="cziegeler" created="Sun, 23 Apr 2017 09:57:59 +0000"  >&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nbartlett&quot; class=&quot;user-hover&quot; rel=&quot;nbartlett&quot;&gt;nbartlett&lt;/a&gt;. I&apos;ve applied it in rev 1792348&lt;/p&gt;</comment>
                            <comment id="15980350" author="githubbot" created="Sun, 23 Apr 2017 09:59:20 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/105&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15991206" author="tjwatson" created="Mon, 1 May 2017 18:08:14 +0000"  >&lt;p&gt;Note that for the port of this fix to osgi-r7/scr codebase I had to add back the following imports, otherwise scr failed to compile the solution for &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5354&quot; title=&quot;Implement Declarative Service Updates for R7 (RFC 222)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5354&quot;&gt;&lt;del&gt;FELIX-5354&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;import org.osgi.service.cm.ConfigurationException;&lt;br/&gt;
import org.osgi.service.cm.ManagedService;&lt;/p&gt;

&lt;p&gt;I don&apos;t think this issue has been re-introduced in the osgi-r7/scr codebase, but it needs to be verified.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3diaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>