<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 15:09:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-1000] Updating an bundle which was installed via OBR fails</title>
                <link>https://issues.apache.org/jira/browse/FELIX-1000</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;Updating an bundle which was installed via the obr functionality results in an exception (update was triggered via the shell):&lt;/p&gt;

&lt;p&gt;&amp;#8212; 8&amp;lt; &amp;#8212;&lt;br/&gt;
java.net.MalformedURLException: Unknown protocol: obr&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:601)&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:464)&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:413)&lt;br/&gt;
	at org.apache.felix.framework.cache.JarRevision.initialize(JarRevision.java:149)&lt;br/&gt;
	at org.apache.felix.framework.cache.JarRevision.&amp;lt;init&amp;gt;(JarRevision.java:78)&lt;br/&gt;
	at org.apache.felix.framework.cache.JarRevision.&amp;lt;init&amp;gt;(JarRevision.java:56)&lt;br/&gt;
	at org.apache.felix.framework.cache.BundleArchive.createRevisionFromLocation(BundleArchive.java:986)&lt;br/&gt;
	at org.apache.felix.framework.cache.BundleArchive.revise(BundleArchive.java:614)&lt;br/&gt;
	at org.apache.felix.framework.BundleImpl.revise(BundleImpl.java:916)&lt;br/&gt;
	at org.apache.felix.framework.Felix.updateBundle(Felix.java:1592)&lt;br/&gt;
	at org.apache.felix.framework.BundleImpl.update(BundleImpl.java:792)&lt;br/&gt;
	at org.apache.felix.framework.BundleImpl.update(BundleImpl.java:779)&lt;br/&gt;
	at org.apache.felix.shell.impl.UpdateCommandImpl.execute(UpdateCommandImpl.java:96)&lt;br/&gt;
	at org.apache.felix.shell.impl.Activator$ShellServiceImpl.executeCommand(Activator.java:276)&lt;br/&gt;
	at org.apache.felix.shell.tui.Activator$ShellTuiRunnable.run(Activator.java:167)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
&amp;#8212; 8&amp;lt; &amp;#8212;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12419399">FELIX-1000</key>
            <summary>Updating an bundle which was installed via OBR fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rickhall">Richard S. Hall</assignee>
                                    <reporter username="kkoehler">Kristian Kohler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Mar 2009 15:16:25 +0000</created>
                <updated>Mon, 11 May 2009 16:16:11 +0000</updated>
                            <resolved>Tue, 28 Apr 2009 11:16:01 +0000</resolved>
                                    <version>bundlerepository-1.4.0</version>
                                    <fixVersion>bundlerepository-1.4.1</fixVersion>
                                    <component>Bundle Repository (OBR)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12689250" author="rickhall" created="Wed, 25 Mar 2009 21:45:20 +0000"  >&lt;p&gt;This is a known issue. I think there was a JIRA issue on it, but I couldn&apos;t find it quickly.&lt;/p&gt;

&lt;p&gt;At any rate, one idea we had was to have OBR implement a custom URL stream handler to properly handle this situation in some way.&lt;/p&gt;</comment>
                            <comment id="12701127" author="kkoehler" created="Tue, 21 Apr 2009 10:26:22 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;this is a patch for this issue.&lt;/p&gt;

&lt;p&gt;The patch includes a Simple URLStreamHandler which handles obr urls in the follwoing schema:&lt;/p&gt;

&lt;p&gt;obr://&amp;lt;symbolicName&amp;gt;/&amp;lt;timeStamp&amp;gt;/&amp;lt;realUrl&amp;gt;&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;obr://org.apache.felix.javax.servlet/1240305961998/&lt;a href=&quot;http://repo1.maven.org/maven2/org/apache/felix/javax.servlet/1.0.0/javax.servlet-1.0.0.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repo1.maven.org/maven2/org/apache/felix/javax.servlet/1.0.0/javax.servlet-1.0.0.jar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;(The obr url is generated within the ResolverImpl.) &lt;/p&gt;

&lt;p&gt;The StreamHandler parses the url and delegates the actual connection creation to the real url handler.&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12701149" author="rickhall" created="Tue, 21 Apr 2009 13:00:20 +0000"  >&lt;p&gt;I don&apos;t think such an approach makes sense.&lt;/p&gt;

&lt;p&gt;The whole reason why the OBR location string is meaningless is because there cannot be a relationship between what the location is and what is installed there. While perhaps the symbolic name and time stamp portions of the URL make sense in your URL, the &quot;real URL&quot; does not. As soon as you update, then it is no longer the real URL, nor would it be the version specified in the real URL. Remember, the location will never change.&lt;/p&gt;

&lt;p&gt;That is why we ended up with a location that means nothing. Probably a better approach is to have the URL handler use the location to look up the bundle and just query the metadata about the bundle, e.g., its symbolic name and version. Then use this metadata to determine how to update the bundle from OBR.&lt;/p&gt;</comment>
                            <comment id="12701434" author="kkoehler" created="Wed, 22 Apr 2009 08:13:08 +0000"  >&lt;p&gt;Oh ok, the patch doesn&apos;t work if you update a bundle with a new location, but I&apos;m not sure if this works with the current implementation without obr... (just tested to clearify the issue)&lt;/p&gt;

&lt;p&gt;I tested the following without obr:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;install a bundle from location1 -&amp;gt; gets id ID_X&lt;/li&gt;
	&lt;li&gt;move the bundle to location2 in the filesystem&lt;/li&gt;
	&lt;li&gt;update bundle ID_X with location2&lt;/li&gt;
	&lt;li&gt;update bundle ID_X&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-&amp;gt; results in a FileNotFoundException because the bundle is not found at location1. - this should also be location2, or I&apos;m wrong?&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12701946" author="kkoehler" created="Thu, 23 Apr 2009 14:20:24 +0000"  >&lt;p&gt;ok. This is the updated version as discussed this morning. &lt;br/&gt;
Hope you could apply it (it&apos;s out of my local git repo). I could also generate a svn diff if neccessary &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12702859" author="rickhall" created="Sun, 26 Apr 2009 07:54:58 +0000"  >&lt;p&gt;Yes, this patch looks better. However, I do have a question, what semantic are you trying to achieve here? It is purely to eliminate the exception you receive when updating an OBR installed bundle? If so, then I guess the current patch achieves this. I guess I thought you actually wanted OBR to attempt to update the bundle.&lt;/p&gt;

&lt;p&gt;For example, if you update a given OBR-installed bundle, you could actually have OBR check to see if there is a newer version of the bundle in the repo and if so return an input stream to it. If there is no new version, then OBR could just return the same input stream. The current approach always updates to the same version.&lt;/p&gt;

&lt;p&gt;What do you and others think?&lt;/p&gt;</comment>
                            <comment id="12702871" author="kkoehler" created="Sun, 26 Apr 2009 09:21:41 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;two things I&apos;m trying to achive here:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;eliminate the exception&lt;/li&gt;
	&lt;li&gt;update the bundle&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In my first scenario I deployed all my bundles through the OBR. I install them using maven in my local repo and the deploy them to Felix using OBR. Normal versions and SNAPSHOT versions. So an update of the same version means different things &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. SNAPSHOTs are updated, normal versions &quot;stay&quot; the same.&lt;/p&gt;

&lt;p&gt;Updating to a new (bundle) version may also be problematic, i think. Which version should be updated to? The newest or the next available. A customer has the requirement to update to the next available version and not to the newest. For example: currently version 1.1 is installed. Version 1.2, 1.3 and 2.0 are available from OBR. The customer wants to update to 1.2. &lt;/p&gt;

&lt;p&gt;Not sure if the update should try to use a newer version. If I&apos;m right the none OBR stuff also doesn&apos;t try to update to a newer version...&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12702888" author="rickhall" created="Sun, 26 Apr 2009 14:14:35 +0000"  >&lt;p&gt;I think when you want to update a bundle, you would likely want to update to the newest, otherwise you&apos;d likely specify the version you wanted. This is the typical &quot;check for updates&quot; type of scenario where you want to update to the newest.&lt;/p&gt;

&lt;p&gt;Ultimately, I don&apos;t disagree that there are different policies available. I don&apos;t think it is typical people want to upgrade to the next available as opposed to the newest, however, I can imagine some people might. One policy definitely doesn&apos;t fit all. However, either way we are encoding a specific policy. With your policy in place then updating to the newest version becomes a manual process, with my policy updating to the next available becomes a manual process.&lt;/p&gt;

&lt;p&gt;So, the real question is what people think the default policy should be?&lt;/p&gt;

&lt;p&gt;As for OBR not trying to update, that is not really true. When Resolver.deploy() is called, it tries to minimize the number of bundles it installs, so if possible it will update an existing bundle to a newer version.&lt;/p&gt;</comment>
                            <comment id="12703331" author="kkoehler" created="Mon, 27 Apr 2009 20:09:14 +0000"  >&lt;p&gt;I dont&apos;t give up &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Apllied patch includes different strategies for updating bundles. You can configure the strategy to use with the property &quot;obr.update.strategy&quot;. Currently there are two strategies vailable: same and newest. Default is &apos;newest&apos;. &lt;/p&gt;

&lt;p&gt;One point is &quot;open&quot;: I don&apos;t know how to update the version information of the installed bundle. If you &quot;ps&quot; on the console the old version is printed. Is it possible to update this info?&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12703334" author="rickhall" created="Mon, 27 Apr 2009 20:12:26 +0000"  >&lt;p&gt;Sounds odd. The &quot;ps&quot; command just reads the info out of the bundle&apos;s manifest, so if the bundle is updated, it should automatically appear in the listing.&lt;/p&gt;</comment>
                            <comment id="12703502" author="kkoehler" created="Tue, 28 Apr 2009 05:38:07 +0000"  >&lt;p&gt;OK. This is odd because of my test. &lt;br/&gt;
Works if you use different bundles. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; In my testcase I moved the same bundle to different locations and added them to the obr file with different version (not adjusted the files). &lt;br/&gt;
Sorry.&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                            <comment id="12703592" author="rickhall" created="Tue, 28 Apr 2009 11:16:01 +0000"  >&lt;p&gt;Ok, I committed the patch. I think your approach, while valid, was a little over engineered, so I tried to simplify it a little. I also removed the use of statics since it isn&apos;t a good idea to have variables with a different life cycle than the bundle, especially when those variables use the bundle context.&lt;/p&gt;

&lt;p&gt;Please verify that I didn&apos;t break anything. If you are satisfied, then please close this bug. Thanks for the patch and your contributions.&lt;/p&gt;</comment>
                            <comment id="12706130" author="kkoehler" created="Tue, 5 May 2009 18:07:03 +0000"  >&lt;p&gt;works. Thanks&lt;/p&gt;

&lt;p&gt;Kristian&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12406020" name="FELIX-1000-21_04_2009.patch.txt" size="3404" author="kkoehler" created="Tue, 21 Apr 2009 10:26:22 +0000"/>
                            <attachment id="12406236" name="FELIX-1000-23_04_2009.patch.txt" size="5092" author="kkoehler" created="Thu, 23 Apr 2009 14:20:24 +0000"/>
                            <attachment id="12406565" name="FELIX-1000-27_04_2009.patch.txt" size="8107" author="kkoehler" created="Mon, 27 Apr 2009 20:09:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57990</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0vyyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>184637</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>