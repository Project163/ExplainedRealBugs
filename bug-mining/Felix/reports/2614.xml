<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:00:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5217] Fileinstall is handling removal of many files inefficiently</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5217</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;I am currently debugging a performance issue with file install.&lt;/p&gt;

&lt;p&gt;The thread is very hot on:&lt;br/&gt;
java.util.HashMap.hash(java.lang.Object)&lt;br/&gt;
java.util.HashMap.put(java.lang.Object, java.lang.Object)&lt;br/&gt;
java.util.HashSet.add(java.lang.Object)&lt;br/&gt;
java.util.AbstractCollection.addAll(java.util.Collection) (line: 344)&lt;br/&gt;
org.apache.felix.fileinstall.internal.WatcherScanner.scan(boolean) (line: 100)&lt;br/&gt;
org.apache.felix.fileinstall.internal.DirectoryWatcher.run() (line: 302)&lt;/p&gt;

&lt;p&gt;What I see in WatcherScanner, is that it potentially adds the same elements over and over again.&lt;br/&gt;
While I am sure that this is not the root cause, I suggest to change the method to avoid this. (submitting pr in a second)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12950768">FELIX-5217</key>
            <summary>Fileinstall is handling removal of many files inefficiently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="fabianlange">Fabian Lange</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Mar 2016 07:56:09 +0000</created>
                <updated>Wed, 16 Mar 2016 08:53:57 +0000</updated>
                            <resolved>Wed, 16 Mar 2016 08:25:35 +0000</resolved>
                                                    <fixVersion>fileinstall-3.5.4</fixVersion>
                                    <component>File Install</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15196973" author="githubbot" created="Wed, 16 Mar 2016 08:03:06 +0000"  >&lt;p&gt;GitHub user CodingFabian opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/58&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5217&quot; title=&quot;Fileinstall is handling removal of many files inefficiently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5217&quot;&gt;&lt;del&gt;FELIX-5217&lt;/del&gt;&lt;/a&gt; fileinstall: Improve WatcherScanner performance&lt;/p&gt;

&lt;p&gt;    note that the other option is to call addAll before the loop, but because the return value is ignored anyway, it is slightly more efficient to do this in the loop.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/CodingFabian/felix&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/CodingFabian/felix&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5217&quot; title=&quot;Fileinstall is handling removal of many files inefficiently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5217&quot;&gt;&lt;del&gt;FELIX-5217&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/58.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/58.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #58&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f324e9ea13f265d418131cfdce99d8d9315f7991&lt;br/&gt;
Author: Fabian Lange &amp;lt;lange.fabian@gmail.com&amp;gt;&lt;br/&gt;
Date:   2016-03-16T07:59:26Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5217&quot; title=&quot;Fileinstall is handling removal of many files inefficiently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5217&quot;&gt;&lt;del&gt;FELIX-5217&lt;/del&gt;&lt;/a&gt; fileinstall: Improve WatcherScanner performance&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15196976" author="fabianlange" created="Wed, 16 Mar 2016 08:03:43 +0000"  >&lt;p&gt;ok the root cause of the performance problem is that &quot;changed&quot; only grows, never shrinks.&lt;/p&gt;</comment>
                            <comment id="15196989" author="gnt" created="Wed, 16 Mar 2016 08:13:33 +0000"  >&lt;p&gt;Patch applied.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;changed&lt;/tt&gt; set should shrink with line 86:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/felix/blob/trunk/fileinstall/src/main/java/org/apache/felix/fileinstall/internal/WatcherScanner.java#L86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/blob/trunk/fileinstall/src/main/java/org/apache/felix/fileinstall/internal/WatcherScanner.java#L86&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15196994" author="fabianlange" created="Wed, 16 Mar 2016 08:15:39 +0000"  >&lt;p&gt;Yes but it only does that if the file exists. if it doesnt 8because it was removed) then the changed set will not shrink (see &lt;a href=&quot;https://issues.apache.org/jira/browse/FELIX-5218&quot; title=&quot;Fileinstall MemoryLeak / Performance degradation in WatcherScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;FELIX-5218&quot;&gt;&lt;del&gt;FELIX-5218&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="15197047" author="githubbot" created="Wed, 16 Mar 2016 08:53:57 +0000"  >&lt;p&gt;Github user CodingFabian closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/felix/pull/58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/felix/pull/58&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ur3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>