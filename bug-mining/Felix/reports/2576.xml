<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 16:00:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[FELIX-5155] Adapter/Aspect extra service dependencies injected twice if using callback instance</title>
                <link>https://issues.apache.org/jira/browse/FELIX-5155</link>
                <project id="12310100" key="FELIX">Felix</project>
                    <description>&lt;p&gt;In the context of the new DM-lambda library, we found the following issue:&lt;/p&gt;

&lt;p&gt;When an aspect or an adapter is defined on an existing service, and if such aspect (or adapter) declares some extra service dependencies, and if one of these extra dependencies are using an external callback instance (in order to inject the extra dependency into the adapter or aspect instance), then the callback instance is invoked twice:&lt;/p&gt;

&lt;p&gt;The first time, the callback instance is wrongly called by the internal aspect (or adapter) AbstractDecorator component, and the second time it is correctly called in order to inject the dependency into the callback instance.&lt;/p&gt;

&lt;p&gt;I have written a test case which reproduces this issue and will commit it soon.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12926946">FELIX-5155</key>
            <summary>Adapter/Aspect extra service dependencies injected twice if using callback instance</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pderop">Pierre De Rop</assignee>
                                    <reporter username="pderop">Pierre De Rop</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jan 2016 11:08:48 +0000</created>
                <updated>Sun, 6 Mar 2016 19:06:44 +0000</updated>
                            <resolved>Sun, 31 Jan 2016 22:01:00 +0000</resolved>
                                    <version>dependencymanager-3.0.0</version>
                                    <fixVersion>org.apache.felix.dependencymanager-r8</fixVersion>
                                    <component>Dependency Manager</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15081014" author="pderop" created="Mon, 4 Jan 2016 11:11:26 +0000"  >&lt;p&gt;committed a test case for this issue in revision 1722844:&lt;/p&gt;

&lt;p&gt;src/org/apache/felix/dm/itest/api/FELI5155_AdapterCallbackInstanceCalledTwice.java&lt;/p&gt;</comment>
                            <comment id="15081033" author="pderop" created="Mon, 4 Jan 2016 11:27:02 +0000"  >&lt;p&gt;Fix committed in revision 1722848: when an extra dependency is added to an aspect (or adapter), then the service dependency callback instance (if set) is temporarily removed from the dependency, and is cached in a datastructure, allowing to re-add it later, when instantiating concrete aspect/adapter component instances.&lt;/p&gt;

&lt;p&gt;See the following patched methods in the FilterComponent class:&lt;/p&gt;

&lt;p&gt;public Component add(Dependency ... dependencies)&lt;br/&gt;
protected void copyDependencies(List&amp;lt;DependencyContext&amp;gt; dependencies, Component component)&lt;/p&gt;
</comment>
                            <comment id="15125535" author="pderop" created="Sun, 31 Jan 2016 21:59:07 +0000"  >&lt;p&gt;The fix is not satisfying, because it requires a major version bump for the org.apache.felix.dm.context package. Another possible better and simpler fix consists in simply making sure that the ComponentImpl does not invoke callbacks on AbstractDecorator components (excepts for the first internal dependency declared by aspects and adapters).&lt;/p&gt;</comment>
                            <comment id="15125536" author="pderop" created="Sun, 31 Jan 2016 22:01:00 +0000"  >&lt;p&gt;Fixed in 1727864.&lt;/p&gt;</comment>
                            <comment id="15146499" author="pderop" created="Sun, 14 Feb 2016 11:09:33 +0000"  >&lt;p&gt;The previous fix was incomplete.&lt;br/&gt;
Committed in rv 1730313 another fix:  ConfigurationDependencyImpl must not invoke the update callback if the component is an internal adapter object in order to avoid potential double update callback invocation.&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qqzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>