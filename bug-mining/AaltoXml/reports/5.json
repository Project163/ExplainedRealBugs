{"url":"https://api.github.com/repos/FasterXML/aalto-xml/issues/53","repository_url":"https://api.github.com/repos/FasterXML/aalto-xml","labels_url":"https://api.github.com/repos/FasterXML/aalto-xml/issues/53/labels{/name}","comments_url":"https://api.github.com/repos/FasterXML/aalto-xml/issues/53/comments","events_url":"https://api.github.com/repos/FasterXML/aalto-xml/issues/53/events","html_url":"https://github.com/FasterXML/aalto-xml/issues/53","id":283677356,"node_id":"MDU6SXNzdWUyODM2NzczNTY=","number":53,"title":"AsyncByteScanner.validPublicIdChar() incorrectly rejects digits","user":{"login":"dmolesUC","id":10374934,"node_id":"MDQ6VXNlcjEwMzc0OTM0","avatar_url":"https://avatars.githubusercontent.com/u/10374934?v=4","gravatar_id":"","url":"https://api.github.com/users/dmolesUC","html_url":"https://github.com/dmolesUC","followers_url":"https://api.github.com/users/dmolesUC/followers","following_url":"https://api.github.com/users/dmolesUC/following{/other_user}","gists_url":"https://api.github.com/users/dmolesUC/gists{/gist_id}","starred_url":"https://api.github.com/users/dmolesUC/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dmolesUC/subscriptions","organizations_url":"https://api.github.com/users/dmolesUC/orgs","repos_url":"https://api.github.com/users/dmolesUC/repos","events_url":"https://api.github.com/users/dmolesUC/events{/privacy}","received_events_url":"https://api.github.com/users/dmolesUC/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/FasterXML/aalto-xml/milestones/5","html_url":"https://github.com/FasterXML/aalto-xml/milestone/5","labels_url":"https://api.github.com/repos/FasterXML/aalto-xml/milestones/5/labels","id":3224001,"node_id":"MDk6TWlsZXN0b25lMzIyNDAwMQ==","number":5,"title":"1.1.0","description":null,"creator":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":6,"state":"open","created_at":"2018-03-28T03:26:41Z","updated_at":"2018-04-01T23:56:15Z","due_on":null,"closed_at":null},"comments":1,"created_at":"2017-12-20T19:54:14Z","updated_at":"2018-03-28T03:29:52Z","closed_at":"2018-03-28T03:29:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The javadoc for `AsyncByteScanner.validPublicIdChar()` references [PubidLiteral](http://www.w3.org/TR/xml/#NT-PubidLiteral) in the XML 1.0 specification:\r\n\r\n>     PubidLiteral ::= '\"' PubidChar* '\"' | \"'\" (PubidChar - \"'\")* \"'\"\r\n>     PubidChar    ::= #x20 | #xD | #xA | [a-zA-Z0-9] | [-'()+,./:=?;!*#@$_%]\r\n\r\nNote that this includes `[0-9]`. However, the [implementation of the method](https://github.com/FasterXML/aalto-xml/blob/2750fb4be212436ab2cdc5a4d11a0c04baa99451/src/main/java/com/fasterxml/aalto/async/AsyncByteScanner.java#L622-L645) does not:\r\n\r\n```\r\n    protected boolean validPublicIdChar(int c) {\r\n        return\r\n            c == 0xA ||                     //<LF>\r\n            c == 0xD ||                     //<CR>\r\n            c == 0x20 ||                    //<SPACE>\r\n            (c >= '@' && c <= 'Z') ||       //@[A-Z]\r\n            (c >= 'a' && c <= 'z') ||\r\n            c == '!' ||\r\n            (c >= 0x23 && c <= 0x25) ||     //#$%\r\n            (c >= 0x27 && c <= 0x2F) ||     //'()*+,-./\r\n            (c >= ':' && c <= ';') ||\r\n            c == '=' ||\r\n            c == '?' ||\r\n            c == '_';\r\n    }\r\n```\r\n\r\nNote also that [`com.fasterxml.aalto.util.XmlCharTypes.PUBID_CHARS`](https://github.com/FasterXML/aalto-xml/blob/2750fb4be212436ab2cdc5a4d11a0c04baa99451/src/main/java/com/fasterxml/aalto/util/XmlCharTypes.java#L106-L145) correctly includes these digits.\r\n\r\n### Steps to reproduce:\r\n\r\n1. Find or create a document matching the [Encoded Archival Description version 3](https://github.com/saa-ead-roundtable/ead3-toolkit) schema and containing the following `<!DOCTYPE>` declaration (e.g., add it to [this file](https://github.com/saa-ead-roundtable/ead3-toolkit/blob/master/ead3_single_level_minimum.xml)):\r\n\r\n```xml\r\n<!DOCTYPE ead PUBLIC \"+// http://ead3.archivists.org/schema/ //DTD ead3 (Encoded Archival Description (EAD) Version 3)//EN\" \"ead3.dtd\">\r\n```\r\n\r\n2. Attempt to parse it with an `AsyncXMLStreamReader`.\r\n\r\n### Expected:\r\n\r\n- File parses, or at any rate gets past the `<!DOCTYPE>` declaration.\r\n\r\n### Actual:\r\n\r\n- parsing fails with a `WFCException`:\r\n\r\n```java\r\nError parsing XML stream\r\ncom.fasterxml.aalto.WFCException: Unexpected character '3' (code 51) in prolog (not valid in PUBLIC ID)\r\n at [row,col {unknown-source}]: [1,77]\r\n\tat com.fasterxml.aalto.in.XmlScanner.reportInputProblem(XmlScanner.java:1333)\r\n\tat com.fasterxml.aalto.in.XmlScanner.throwUnexpectedChar(XmlScanner.java:1498)\r\n\tat com.fasterxml.aalto.in.XmlScanner.reportPrologUnexpChar(XmlScanner.java:1358)\r\n\tat com.fasterxml.aalto.async.AsyncByteBufferScanner.parseDtdId(AsyncByteBufferScanner.java:1946)\r\n\tat com.fasterxml.aalto.async.AsyncByteBufferScanner.handleDTD(AsyncByteBufferScanner.java:1833)\r\n\tat com.fasterxml.aalto.async.AsyncByteBufferScanner.handlePrologDeclStart(AsyncByteBufferScanner.java:1264)\r\n\tat com.fasterxml.aalto.async.AsyncByteBufferScanner.nextFromProlog(AsyncByteBufferScanner.java:1067)\r\n\tat com.fasterxml.aalto.stax.StreamReaderImpl.next(StreamReaderImpl.java:790)\r\n\tat org.codehaus.stax2.ri.Stax2EventReaderImpl.nextEvent(Stax2EventReaderImpl.java:255)\r\n```\r\n\r\n\r\n","closed_by":{"login":"cowtowncoder","id":55065,"node_id":"MDQ6VXNlcjU1MDY1","avatar_url":"https://avatars.githubusercontent.com/u/55065?v=4","gravatar_id":"","url":"https://api.github.com/users/cowtowncoder","html_url":"https://github.com/cowtowncoder","followers_url":"https://api.github.com/users/cowtowncoder/followers","following_url":"https://api.github.com/users/cowtowncoder/following{/other_user}","gists_url":"https://api.github.com/users/cowtowncoder/gists{/gist_id}","starred_url":"https://api.github.com/users/cowtowncoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cowtowncoder/subscriptions","organizations_url":"https://api.github.com/users/cowtowncoder/orgs","repos_url":"https://api.github.com/users/cowtowncoder/repos","events_url":"https://api.github.com/users/cowtowncoder/events{/privacy}","received_events_url":"https://api.github.com/users/cowtowncoder/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/FasterXML/aalto-xml/issues/53/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/FasterXML/aalto-xml/issues/53/timeline","performed_via_github_app":null,"state_reason":"completed"}