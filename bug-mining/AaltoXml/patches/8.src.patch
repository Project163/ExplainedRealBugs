diff --git a/release-notes/VERSION b/release-notes/VERSION
index d618c1b..75a43be 100644
--- a/release-notes/VERSION
+++ b/release-notes/VERSION
@@ -10,6 +10,8 @@ Project: aalto-xml
  (reported by Mike C)
 #40: Parsing error on hexadecimal character reference in attribute value
  (reported by bfreuden@github)
+#45: Unicode: surrogate pairs encoded invalidly after x number of chars
+ (reported by JervenBolleman@github)
 #53: AsyncByteScanner.validPublicIdChar() incorrectly rejects digits
  (reported by David M)
 - Add "Automatic-Module-Name" for Java 9
diff --git a/src/main/java/com/fasterxml/aalto/out/ByteXmlWriter.java b/src/main/java/com/fasterxml/aalto/out/ByteXmlWriter.java
index 491a3f1..6753862 100644
--- a/src/main/java/com/fasterxml/aalto/out/ByteXmlWriter.java
+++ b/src/main/java/com/fasterxml/aalto/out/ByteXmlWriter.java
@@ -912,15 +912,13 @@ public abstract class ByteXmlWriter
             --len;
         }
 
-        /* Ok, let's offline (what's sure to be) slow case first:
-         * (with multi-byte chars, others may be, too).
-         */
+        // Ok, let's offline (what's sure to be) slow case first:
+        // (with multi-byte chars, others may be, too).
         int ptr = _outputPtr;
         if ((ptr + len) > _outputBufferLen) {
             writeSplitCharacters(cbuf, offset, len);
             return;
         }
-
         len += offset; // now marks the end
 
         main_loop:
@@ -934,11 +932,9 @@ public abstract class ByteXmlWriter
                     break inner_loop;
                 }
                 if (charTypes[ch] != XmlCharTypes.CT_OK) {
-                    /* This may look weird, but profiling showed that
-                     * handling of lfs for indentation has measurable
-                     * effect; plus, that checking it here will not
-                     * slow down inner loop either
-                     */
+                    // This may look weird, but profiling showed that handling of LFs
+                    // for indentation has measurable effect; plus, that checking it
+                    // here will not slow down inner loop either
                     if (ch != '\n') {
                         break inner_loop;
                     }
@@ -1082,9 +1078,9 @@ public abstract class ByteXmlWriter
                 default:
                     break;
                 }
-            } else {
-                writeAsEntity(ch);
-                continue main_loop;
+            } else { // beyond 2-byte encodables; 3-byte, surrogates?
+                offset = outputMultiByteChar(ch, cbuf, offset, len);
+                continue;
             }
 
             if (_outputPtr >= _outputBufferLen) {
@@ -1585,7 +1581,7 @@ public abstract class ByteXmlWriter
     protected final void flushBuffer()
         throws IOException
     {
-        if (_outputPtr > 0 && _out != null) {
+        if ((_outputPtr > 0) && (_out != null)) {
             int ptr = _outputPtr;
             // Need to update location info, to keep it in sync
             _locPastChars += ptr;
diff --git a/src/main/java/com/fasterxml/aalto/out/Utf8XmlWriter.java b/src/main/java/com/fasterxml/aalto/out/Utf8XmlWriter.java
index 4269f5d..d4cbc90 100644
--- a/src/main/java/com/fasterxml/aalto/out/Utf8XmlWriter.java
+++ b/src/main/java/com/fasterxml/aalto/out/Utf8XmlWriter.java
@@ -30,17 +30,17 @@ import com.fasterxml.aalto.util.XmlConsts;
 public final class Utf8XmlWriter
     extends ByteXmlWriter
 {
-    /*
-    ////////////////////////////////////////////////
-    // Life-cycle
-    ////////////////////////////////////////////////
-     */
-
     public Utf8XmlWriter(WriterConfig cfg, OutputStream out)
     {
         super(cfg, out, OutputCharTypes.getUtf8CharTypes());
     }
 
+    /*
+    /**********************************************************************
+    /* Abstract method implementations
+    /**********************************************************************
+     */
+    
     @Override
     public int getHighestEncodable() {
         return XmlConsts.MAX_UNICODE_CHAR;
@@ -120,9 +120,9 @@ public final class Utf8XmlWriter
     }
 
     /*
-    ////////////////////////////////////////////////////
-    // Internal methods, low-level write
-    ////////////////////////////////////////////////////
+    /**********************************************************************
+    /* Internal methods, low-level write
+    /**********************************************************************
      */
 
     @Override
diff --git a/src/test/java/failing/TestUTF8Surrogates.java b/src/test/java/wstream/TestUTF8Surrogates.java
similarity index 84%
rename from src/test/java/failing/TestUTF8Surrogates.java
rename to src/test/java/wstream/TestUTF8Surrogates.java
index f3772d0..9b1332b 100644
--- a/src/test/java/failing/TestUTF8Surrogates.java
+++ b/src/test/java/wstream/TestUTF8Surrogates.java
@@ -1,4 +1,4 @@
-package failing;
+package wstream;
 
 import java.io.ByteArrayOutputStream;
 
@@ -10,6 +10,9 @@ public class TestUTF8Surrogates extends BaseWriterTest
 {
     public void testWithKappas() throws Exception
     {
+        // !!! TODO: mark using Unicode escape, for better source compatibility
+        final String K = new StringBuilder().append("ùúÖ").toString();
+        
         //loop to find exactly at which point entity encoding kicks in.
 //        for (int j = 0; j < 1000; j++)
         final int j = 985;
@@ -19,7 +22,7 @@ public class TestUTF8Surrogates extends BaseWriterTest
             final String namespace = "http://example.org";
             StringBuilder kappas = new StringBuilder();
             for (int i = 0; i < (2000 + j); i++) {
-                kappas.append("ùúÖ");
+                kappas.append(K);
             }
             w.writeStartElement("", "ex", namespace);
             w.writeCharacters(kappas.toString());
@@ -31,7 +34,6 @@ public class TestUTF8Surrogates extends BaseWriterTest
             if (!exp.equals(act)) {
                 fail("Iteration "+j+" failed; exp length "+exp.length()+" vs actual "+act.length());
             }
-            else System.err.println("#"+j+" length: "+exp.length());
         }
     }
 }
