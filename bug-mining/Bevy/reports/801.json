{"url":"https://api.github.com/repos/bevyengine/bevy/issues/18856","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/18856/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/18856/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/18856/events","html_url":"https://github.com/bevyengine/bevy/issues/18856","id":2997860318,"node_id":"I_kwDODf6-U86yr7fe","number":18856,"title":"Mesh picking offset when the camera's viewport physical_position is non-zero","user":{"login":"Henauxg","id":19689618,"node_id":"MDQ6VXNlcjE5Njg5NjE4","avatar_url":"https://avatars.githubusercontent.com/u/19689618?v=4","gravatar_id":"","url":"https://api.github.com/users/Henauxg","html_url":"https://github.com/Henauxg","followers_url":"https://api.github.com/users/Henauxg/followers","following_url":"https://api.github.com/users/Henauxg/following{/other_user}","gists_url":"https://api.github.com/users/Henauxg/gists{/gist_id}","starred_url":"https://api.github.com/users/Henauxg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Henauxg/subscriptions","organizations_url":"https://api.github.com/users/Henauxg/orgs","repos_url":"https://api.github.com/users/Henauxg/repos","events_url":"https://api.github.com/users/Henauxg/events{/privacy}","received_events_url":"https://api.github.com/users/Henauxg/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":7040334053,"node_id":"LA_kwDODf6-U88AAAABo6L45Q","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Picking","name":"A-Picking","color":"c6A751","default":false,"description":"Pointing at and selecting objects of all sorts"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2025-04-15T23:05:53Z","updated_at":"2025-04-27T14:19:35Z","closed_at":"2025-04-27T14:19:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\n\n`0.16` (commit 199c9788c5e8601b6df4b9f517565d1e467348b9)\n\n## What you did\n\nRaised by `Krzysiu` on [Discord](https://discord.com/channels/691052431525675048/1361804711925383359)\n\nModify the `simple_picking` example to add a `Viewport` with an offset:\n- Add the following import `use bevy_render::camera::Viewport;`\n- Add the `window_query: Query<&Window>` parameter to the `setup_scene` system\n- Replace\n```rust\n    commands.spawn((\n        Camera3d::default(),\n        Transform::from_xyz(-2.5, 4.5, 9.0).looking_at(Vec3::ZERO, Vec3::Y),\n    ));\n```\nwith\n```rust\n    let window = window_query.single().unwrap();\n    commands.spawn((\n        Camera {\n            viewport: Some(Viewport {\n                physical_position: UVec2::new(250, 0),\n                physical_size: window.physical_size(),\n                ..default()\n            }),\n            ..default()\n        },\n        Camera3d::default(),\n        Transform::from_xyz(-2.5, 4.5, 9.0).looking_at(Vec3::ZERO, Vec3::Y),\n    ));\n```\n\n## What went wrong\n\n- Picking on the text works as expected to spawn cubes\n- Picking the cubes to rotate them is broken. The user needs to pick 250 px to the right of the cubes.\n\n## Additional information\n\n- Setting the offset value to something greater like 450, causing the displaced picking zone to land outside of the initial window, means that picking won't work at all on the cubes, even if the window is resized horizontally. (Edit: I guess that this is expected and due to the viewport being clamped to the window size. Shouldn't it try to expand to its original `physical_size` though ?)\n- `Krzysiu` created another repro (original discovery) with a setup a bit more involved https://github.com/KrzysztofZywiecki/WFC\n  ```\n  It creates two cameras with different viewports and a rectangle that's visible on both. Left camera picks the square correctly, right one does not, and in the console I'm printing rays dictionary that shows weird ray origin on right camera\n  ```\n- Vaguely related issue, but for sprites: #18005, with an ongoing sprite related fix PR #18069 \n","closed_by":{"login":"mockersf","id":8672791,"node_id":"MDQ6VXNlcjg2NzI3OTE=","avatar_url":"https://avatars.githubusercontent.com/u/8672791?v=4","gravatar_id":"","url":"https://api.github.com/users/mockersf","html_url":"https://github.com/mockersf","followers_url":"https://api.github.com/users/mockersf/followers","following_url":"https://api.github.com/users/mockersf/following{/other_user}","gists_url":"https://api.github.com/users/mockersf/gists{/gist_id}","starred_url":"https://api.github.com/users/mockersf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockersf/subscriptions","organizations_url":"https://api.github.com/users/mockersf/orgs","repos_url":"https://api.github.com/users/mockersf/repos","events_url":"https://api.github.com/users/mockersf/events{/privacy}","received_events_url":"https://api.github.com/users/mockersf/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/18856/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/18856/timeline","performed_via_github_app":null,"state_reason":"completed"}