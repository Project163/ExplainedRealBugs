{"url":"https://api.github.com/repos/bevyengine/bevy/issues/19017","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/19017/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/19017/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/19017/events","html_url":"https://github.com/bevyengine/bevy/issues/19017","id":3034513189,"node_id":"I_kwDODf6-U8603v8l","number":19017,"title":"#[reflect(opaque)] remote type fails to register at runtime, making ReflectSerializer unusable","user":{"login":"chengts95","id":6616679,"node_id":"MDQ6VXNlcjY2MTY2Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/6616679?v=4","gravatar_id":"","url":"https://api.github.com/users/chengts95","html_url":"https://github.com/chengts95","followers_url":"https://api.github.com/users/chengts95/followers","following_url":"https://api.github.com/users/chengts95/following{/other_user}","gists_url":"https://api.github.com/users/chengts95/gists{/gist_id}","starred_url":"https://api.github.com/users/chengts95/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chengts95/subscriptions","organizations_url":"https://api.github.com/users/chengts95/orgs","repos_url":"https://api.github.com/users/chengts95/repos","events_url":"https://api.github.com/users/chengts95/events{/privacy}","received_events_url":"https://api.github.com/users/chengts95/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2914600295,"node_id":"MDU6TGFiZWwyOTE0NjAwMjk1","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Reflection","name":"A-Reflection","color":"c6a751","default":false,"description":"Runtime information about types"},{"id":6899588994,"node_id":"LA_kwDODf6-U88AAAABmz9fgg","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Review","name":"S-Needs-Review","color":"D876E3","default":false,"description":"Needs reviewer attention (from anyone!) to move forward"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bevyengine/bevy/milestones/32","html_url":"https://github.com/bevyengine/bevy/milestone/32","labels_url":"https://api.github.com/repos/bevyengine/bevy/milestones/32/labels","id":12377016,"node_id":"MI_kwDODf6-U84AvNu4","number":32,"title":"0.17","description":"","creator":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":584,"state":"closed","created_at":"2025-02-24T21:56:04Z","updated_at":"2025-09-30T22:33:43Z","due_on":null,"closed_at":"2025-09-30T22:33:43Z"},"comments":2,"created_at":"2025-05-01T19:12:23Z","updated_at":"2025-08-28T23:05:07Z","closed_at":"2025-08-28T23:05:07Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"\n## Bevy 0.16\n\nThe release number or commit hash of the version you're using.\n\nRust 1.86.0 \n\n\n\n\n## What you did\nI simply want to reflect a `Vector2` (since different crates have different `Vector2`) with another type.\nThe code is like the following:\n```rust\nuse std::any::Any;\n\nuse bevy_app::App;\nuse bevy_ecs::prelude::*;\nuse bevy_reflect::{prelude::*, reflect_remote, serde::ReflectSerializer};\n\nuse serde_derive::{Deserialize, Serialize};\n#[derive(Component, Reflect)]\nstruct Port2(#[reflect(remote = Vector2Wrapper)] Vector2<i32>);\n\n#[derive(Clone, Serialize, Deserialize)]\nstruct Vector2<T>([T; 2]);\n\n#[reflect_remote(Vector2<i32>)]\n#[derive(Clone, Serialize, Deserialize)]\n#[reflect(Serialize, Deserialize, opaque)]\nstruct Vector2Wrapper([i32; 2]);\nfn main() {\n    //let p = Port2(vector![1, 2]);\n\n    let p = Port2(Vector2::<i32>([1, 2]));\n    assert_eq!(p.0.0[0], 1);\n    assert_eq!(p.0.0[1], 2);\n    let mut app = App::new();\n\n    let reflect = p.as_partial_reflect();\n    let type_registry = app.world().resource::<AppTypeRegistry>();\n    let binding = type_registry.read();\n    let serializer = ReflectSerializer::new(reflect, &binding);\n    let json = serde_json::to_string(&serializer).unwrap();\n    println!(\"json: {}\", json);\n    println!(\"Hello, world!\");\n}\n\n```\n\n## What went wrong\n\n```\nthread 'main' panicked at src\\main.rs:37:51:\ncalled `Result::unwrap()` on an `Err` value: Error(\"type `bevy_reflect_test::Vector2Wrapper` is not registered in the type registry (stack: `bevy_reflect_test::Port2` -> `bevy_reflect_test::Vector2Wrapper`)\", line: 0, column: 0)\nstack backtrace:\n   0: std::panicking::begin_panic_handler\n             at /rustc/05f9846f893b09a1be1fc8560e33fc3c815cfecb/library\\std\\src\\panicking.rs:695\n   1: core::panicking::panic_fmt\n             at /rustc/05f9846f893b09a1be1fc8560e33fc3c815cfecb/library\\core\\src\\panicking.rs:75\n   2: core::result::unwrap_failed\n             at /rustc/05f9846f893b09a1be1fc8560e33fc3c815cfecb/library\\core\\src\\result.rs:1704\n   3: enum2$<core::result::Result<alloc::string::String,serde_json::error::Error> >::unwrap \n             at C:\\Users\\xxx\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\lib\\rustlib\\src\\rust\\library\\core\\src\\result.rs:1109\n   4: bevy_reflect_test::main\n             at .\\src\\main.rs:37\n   5: core::ops::function::FnOnce::call_once<void (*)(),tuple$<> >\n             at C:\\Users\\xxx\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\lib\\rustlib\\src\\rust\\library\\core\\src\\ops\\function.rs:250\n   6: core::hint::black_box\n             at C:\\Users\\xxx\\.rustup\\toolchains\\stable-x86_64-pc-windows-msvc\\lib\\rustlib\\src\\rust\\library\\core\\src\\hint.rs:477\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.     \nerror: process didn't exit successfully: `target\\debug\\bevy_reflect_test.exe` (exit code: 101)\n\n *  The terminal process \"C:\\Users\\xxx\\.cargo\\bin\\cargo.EXE 'run', '--package', 'bevy_reflect_test', '--bin', 'bevy_reflect_test'\" terminated with exit code: 101. \n```\nThe error is generated at runtime and the compile will not detect the problem.\n\n## Additional information\n\nThis issue only occurs when #[reflect(opaque)] is present. However, removing opaque is not a viable workaround in real scenarios:\n\n- Without opaque, it becomes impossible to reflect over structs with private fields, which is the common case for #[reflect(remote = ...)].\n\n- The current implementation also assumes that the wrapper has exactly the same field names as the original struct, defeating the purpose of creating an abstract or semantically meaningful surrogate. For example: a `Vector2([i32:2])` cannot be  reflected with `Vector2Wrapper{x:i32,y:i32}`. \n- \n\nAs a result, #[reflect(remote)] + #[reflect(opaque)] is not usable for many real-world cases where abstraction, field renaming, or third-party encapsulated types are involved.\n\n\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/19017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/19017/timeline","performed_via_github_app":null,"state_reason":"completed"}