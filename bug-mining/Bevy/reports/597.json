{"url":"https://api.github.com/repos/bevyengine/bevy/issues/16850","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/16850/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/16850/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/16850/events","html_url":"https://github.com/bevyengine/bevy/issues/16850","id":2743524957,"node_id":"I_kwDODf6-U86jht5d","number":16850,"title":"Manually insert `RenderEntity` / reverse extract","user":{"login":"djeedai","id":6532395,"node_id":"MDQ6VXNlcjY1MzIzOTU=","avatar_url":"https://avatars.githubusercontent.com/u/6532395?v=4","gravatar_id":"","url":"https://api.github.com/users/djeedai","html_url":"https://github.com/djeedai","followers_url":"https://api.github.com/users/djeedai/followers","following_url":"https://api.github.com/users/djeedai/following{/other_user}","gists_url":"https://api.github.com/users/djeedai/gists{/gist_id}","starred_url":"https://api.github.com/users/djeedai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/djeedai/subscriptions","organizations_url":"https://api.github.com/users/djeedai/orgs","repos_url":"https://api.github.com/users/djeedai/repos","events_url":"https://api.github.com/users/djeedai/events{/privacy}","received_events_url":"https://api.github.com/users/djeedai/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619326,"node_id":"MDU6TGFiZWwxNzk1NjE5MzI2","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Feature","name":"C-Feature","color":"b8b8b8","default":false,"description":"A new feature, making something new possible"},{"id":2045383863,"node_id":"MDU6TGFiZWwyMDQ1MzgzODYz","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Rendering","name":"A-Rendering","color":"C6A751","default":false,"description":"Drawing game state to the screen"},{"id":2197761682,"node_id":"MDU6TGFiZWwyMTk3NzYxNjgy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-ECS","name":"A-ECS","color":"c6a751","default":false,"description":"Entities, components, systems, and events"},{"id":2747857990,"node_id":"MDU6TGFiZWwyNzQ3ODU3OTkw","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Usability","name":"C-Usability","color":"b8b8b8","default":false,"description":"A targeted quality-of-life change that makes Bevy easier to use"},{"id":3166152189,"node_id":"MDU6TGFiZWwzMTY2MTUyMTg5","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Design","name":"S-Needs-Design","color":"D876E3","default":false,"description":"This issue requires design work to think about how it would best be accomplished"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bevyengine/bevy/milestones/29","html_url":"https://github.com/bevyengine/bevy/milestone/29","labels_url":"https://api.github.com/repos/bevyengine/bevy/milestones/29/labels","id":11971218,"node_id":"MI_kwDODf6-U84AtqqS","number":29,"title":"0.15.1","description":"","creator":{"login":"mockersf","id":8672791,"node_id":"MDQ6VXNlcjg2NzI3OTE=","avatar_url":"https://avatars.githubusercontent.com/u/8672791?v=4","gravatar_id":"","url":"https://api.github.com/users/mockersf","html_url":"https://github.com/mockersf","followers_url":"https://api.github.com/users/mockersf/followers","following_url":"https://api.github.com/users/mockersf/following{/other_user}","gists_url":"https://api.github.com/users/mockersf/gists{/gist_id}","starred_url":"https://api.github.com/users/mockersf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockersf/subscriptions","organizations_url":"https://api.github.com/users/mockersf/orgs","repos_url":"https://api.github.com/users/mockersf/repos","events_url":"https://api.github.com/users/mockersf/events{/privacy}","received_events_url":"https://api.github.com/users/mockersf/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":40,"state":"closed","created_at":"2024-11-29T22:40:35Z","updated_at":"2025-01-03T23:04:13Z","due_on":null,"closed_at":"2025-01-03T23:04:13Z"},"comments":4,"created_at":"2024-12-16T22:29:43Z","updated_at":"2024-12-24T18:43:45Z","closed_at":"2024-12-24T18:43:44Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## What problem does this solve or what need does it fill?\n\nThe new retained render world allows (and, forces) synchonizing entities between both worlds. This can be done via the `entity_sync_system()` with the `SyncToRenderWorld` component, but there's no way to manually insert the `RenderEntity` component on an entity of the `MainWorld`. The reverse is possible; you simply use the extract phase to read the `RenderEntity` from the main world, and write the `MainEntity` in the render world. But since there's no (as I know) \"reverse extract\" where the render world is read-only and the main world can be mutated, it's impossible to manually insert the `RenderEntity` into the main world with custom logic.\n\n## What solution would you like?\n\nOne of:\n- Have a `ReverseExtract` phase at the end of rendering, and helper system param to do render->main sync.\n- Allow the extract phase to mutate the main world (incidentally, this allows stealing resources from main to render without copying them, which can't be done simply if the main world is immutable, and requires workarounds like interior mutability).\n\n## What alternative(s) have you considered?\n\nI'm kind of stuck because I looked at `entity_sync_system()` and it's using a hard-coded hook into the `SubApp`, where it's explicitly called before the `extract(main, render)` call. Since I can neither 1) read the existing `SubApp::extract` function (to be able to call it from a custom one which would replace it); nor 2) add a second custom extract function to the render app, as a consequence I cannot install my own sync system with custom logic because I would overwrite the default Bevy one and break all extract systems.\n\n## Additional context\n\nI'm trying to convert Hanabi to use the retained render world, and need to sync the particle effect on the main world and the cache one on the render world, both pointing to each other. I believe this should greatly simplify/clarify the code, by leveraging ECS to store the data instead of custom containers, and allow more granular and clear systems to operate on partial effect data (as opposed to know, few systems doing many different things on one giant blob of data per effect). However I want to run custom logic when creating the render app entity, because I only want to do so if the main world component passed a few basic validations, to prune potentially invalid effects. I also hate having that `SyncToRenderWorld` marker component which is unrelated to my library, and is redundant with the fact all entities with my particle component should already synchronize by design. Finally, the `SyncWorldPlugin` says the sync is done at the very beginning of the frame, but I want this sync done just before extract, because I don't want to incur a one frame delay on newly spawned effects.\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/16850/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/16850/timeline","performed_via_github_app":null,"state_reason":"completed"}