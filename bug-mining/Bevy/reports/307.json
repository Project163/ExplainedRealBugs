{"url":"https://api.github.com/repos/bevyengine/bevy/issues/14202","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/14202/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/14202/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/14202/events","html_url":"https://github.com/bevyengine/bevy/issues/14202","id":2394015865,"node_id":"I_kwDODf6-U86Osch5","number":14202,"title":"Component Lifecycle Hook for replaced values","user":{"login":"BigWingBeat","id":28542452,"node_id":"MDQ6VXNlcjI4NTQyNDUy","avatar_url":"https://avatars.githubusercontent.com/u/28542452?v=4","gravatar_id":"","url":"https://api.github.com/users/BigWingBeat","html_url":"https://github.com/BigWingBeat","followers_url":"https://api.github.com/users/BigWingBeat/followers","following_url":"https://api.github.com/users/BigWingBeat/following{/other_user}","gists_url":"https://api.github.com/users/BigWingBeat/gists{/gist_id}","starred_url":"https://api.github.com/users/BigWingBeat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BigWingBeat/subscriptions","organizations_url":"https://api.github.com/users/BigWingBeat/orgs","repos_url":"https://api.github.com/users/BigWingBeat/repos","events_url":"https://api.github.com/users/BigWingBeat/events{/privacy}","received_events_url":"https://api.github.com/users/BigWingBeat/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619326,"node_id":"MDU6TGFiZWwxNzk1NjE5MzI2","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Feature","name":"C-Feature","color":"b8b8b8","default":false,"description":"A new feature, making something new possible"},{"id":2197761682,"node_id":"MDU6TGFiZWwyMTk3NzYxNjgy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-ECS","name":"A-ECS","color":"c6a751","default":false,"description":"Entities, components, systems, and events"},{"id":3166151441,"node_id":"MDU6TGFiZWwzMTY2MTUxNDQx","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Ready-For-Implementation","name":"S-Ready-For-Implementation","color":"D876E3","default":false,"description":"This issue is ready for an implementation PR. Go for it!"},{"id":6899549740,"node_id":"LA_kwDODf6-U88AAAABmz7GLA","url":"https://api.github.com/repos/bevyengine/bevy/labels/X-Uncontroversial","name":"X-Uncontroversial","color":"d93f0b","default":false,"description":"This work is generally agreed upon"},{"id":6899571146,"node_id":"LA_kwDODf6-U88AAAABmz8Zyg","url":"https://api.github.com/repos/bevyengine/bevy/labels/D-Straightforward","name":"D-Straightforward","color":"008672","default":false,"description":"Simple bug fixes and API improvements, docs, test and examples"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2024-07-07T11:40:31Z","updated_at":"2024-07-15T15:38:29Z","closed_at":"2024-07-15T15:38:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## What problem does this solve or what need does it fill?\r\n\r\n> [Relevant Discord Discussion](https://discord.com/channels/691052431525675048/742569353878437978/1259223920825995305)\r\n\r\nThere are currently three component lifecycle hooks: `on_add`, `on_insert` and `on_remove`. Of these, only `on_insert` runs when a component is replaced with a new value, e.g. with `EntityCommands::insert()`, and only the new value is accessible to the hook. This means there is no easy way to run cleanup code for the old value in this scenario, as `on_remove` by design is not ran for this operation.\r\n\r\n## What solution would you like?\r\n\r\nI propose a new component lifecycle hook that runs in all cases that `on_remove` runs, as well as the above scenario. It can be thought of as a counterpart to `on_remove` in the same way that `on_insert` is a counterpart to `on_add`, in that they are mostly the same except for also running for replace operations. This new hook would run before the replace actually occurs, allowing it to access and perform cleanup for the old value, which is not possible with `on_insert`. The name can of course be bikeshed, but I think it should be called `on_drop`, as the intention is for it to run in any scenario that would result in the component value being dropped. If there are other ways a component value can be dropped that `on_remove` does not trigger for, this new hook should trigger for all those as well.\r\n\r\n## What alternative(s) have you considered?\r\n\r\nOne workaround that is currently possible is to create a wrapper component type that has hooks to handle adding/replacing/removing the 'actual' component type, but this adds a lot of complexity and requires unavoidably cloning the component value.\r\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/14202/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/14202/timeline","performed_via_github_app":null,"state_reason":"completed"}