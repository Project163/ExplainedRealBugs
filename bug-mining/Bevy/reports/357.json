{"url":"https://api.github.com/repos/bevyengine/bevy/issues/14873","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/14873/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/14873/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/14873/events","html_url":"https://github.com/bevyengine/bevy/issues/14873","id":2480960594,"node_id":"I_kwDODf6-U86T4HRS","number":14873,"title":"Bevy has no clear schedule for updating a camera's `Transform` when using a fixed time step","user":{"login":"janhohenheim","id":9047632,"node_id":"MDQ6VXNlcjkwNDc2MzI=","avatar_url":"https://avatars.githubusercontent.com/u/9047632?v=4","gravatar_id":"","url":"https://api.github.com/users/janhohenheim","html_url":"https://github.com/janhohenheim","followers_url":"https://api.github.com/users/janhohenheim/followers","following_url":"https://api.github.com/users/janhohenheim/following{/other_user}","gists_url":"https://api.github.com/users/janhohenheim/gists{/gist_id}","starred_url":"https://api.github.com/users/janhohenheim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janhohenheim/subscriptions","organizations_url":"https://api.github.com/users/janhohenheim/orgs","repos_url":"https://api.github.com/users/janhohenheim/repos","events_url":"https://api.github.com/users/janhohenheim/events{/privacy}","received_events_url":"https://api.github.com/users/janhohenheim/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619326,"node_id":"MDU6TGFiZWwxNzk1NjE5MzI2","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Feature","name":"C-Feature","color":"b8b8b8","default":false,"description":"A new feature, making something new possible"},{"id":2197761682,"node_id":"MDU6TGFiZWwyMTk3NzYxNjgy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-ECS","name":"A-ECS","color":"c6a751","default":false,"description":"Entities, components, systems, and events"},{"id":3166152189,"node_id":"MDU6TGFiZWwzMTY2MTUyMTg5","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Design","name":"S-Needs-Design","color":"D876E3","default":false,"description":"This issue requires design work to think about how it would best be accomplished"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2024-08-22T14:37:27Z","updated_at":"2024-08-23T16:36:14Z","closed_at":"2024-08-23T16:36:14Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## What problem does this solve or what need does it fill?\r\n\r\nI'm writing primarily first-person 3D games. My physics engine of choice, Avian, has recently switched from their custom fixed update schedule that ran after `Update` to the real Bevy `FixedMain` schedule, which runs *before* `Update`. Running before update makes sense, as you want to set rendering transforms *after* running the physics.\r\n\r\nNow this results in an issue. In first person games, many things are dependent on the current camera rotation. For example, I am currently writing a plugin for picking up props. These want to be as close to the center of the screen as possible while held. This means that I need to update my camera's transform *before* running the physics. So, my order becomes:\r\n\r\n1. Read the player's inputs\r\n2. Rotate the camera\r\n3. Run physics\r\n\r\nLet's think schedules. The physics need to run in fixed update. The camera rotation *could* run there as well, but ideally, if your framerate allows it, a player should be allowed to update their camera more often. So it needs to be in a variable timestep schedule before fixed update. Hmm, the only one available is `PreUpdate`. But that one also populates the resources needed to read inputs. It's also a popular place to run networking. This means we need to be really careful about our system ordering. Meh. Also, its description says the following:\r\n> [PreUpdate](https://docs.rs/bevy/latest/bevy/app/struct.PreUpdate.html) exists to do “engine/plugin preparation work” that ensures the APIs consumed in [Update](https://docs.rs/bevy/latest/bevy/app/struct.Update.html) are “ready”. [PreUpdate](https://docs.rs/bevy/latest/bevy/app/struct.PreUpdate.html) abstracts out “pre work implementation details”.\r\n\r\nThe player's camera being rotated while moving the mouse is definitely more than just \"pre work implemention details\"! In fact, it is part of the core gameplay experience! \r\nThis means that we have no good place to rotate our camera in while following best practices using a very popular camera style.\r\n\r\n-----\r\n\r\nBonus issue: what if our physics need to react to `just_pressed` to e.g. shoot a gun when clicking? The fixed update loop will only sometimes catch these events, as it may happen to run 0 times on the frame when we clicked. This means we need to cache the `just_pressed` event somewhere. In which schedule do we do that? `PreUpdate` is more correct for this, as it is \"pre work implementation details\", but we still need to be careful about ordering.\r\n\r\n## What solution would you like?\r\n\r\nThere are many possibilities. One of them is to add a new schedule between `StateTransition` and `RunFixedMainLoop` called `PreFixedMainLoop` for this use-case.\r\nSee @alice-i-cecile's comment below for other options.\r\n\r\n## What alternative(s) have you considered?\r\n\r\nLeave it as-is and force users to manually add such a schedule.\r\nThis is a bit of an issue for me, as I'm trying to write minimal use-case examples for my libraries. If they happen to be first-person and use physics, I need to somehow deal with the fact that I need systems rotating the camera and reading `just_pressed` events. \r\nI can currently only handle these cleanly by introducing extremely distracting boilerplate to the example or bypassing the issue by letting everything lag one frame behind, which would be teaching the user an antipattern.\r\n\r\n## Additional context\r\n\r\nSee the discussion [started on Discord](https://discord.com/channels/691052431525675048/1124043933886976171/1275886728309375001) and the [continuation](https://discord.com/channels/691052431525675048/749335865876021248/1276190908458598401) for the full context.\r\n\r\nIn particular, here is a side-by-side demonstration of what happens when you ignore all of this nuance and simply update the camera's transform in `Update`, as I think most people's instinct would be. Left is the version updating stuff correctly as described above, right is the one updating the camera in `Update`:\r\n\r\n\r\nhttps://github.com/user-attachments/assets/e569118b-c7fb-4093-b422-e3130b386779\r\n\r\nThe very noticeable jitter is due to the camera being \"one step ahead\" of the physics.\r\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/14873/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/14873/timeline","performed_via_github_app":null,"state_reason":"completed"}