{"url":"https://api.github.com/repos/bevyengine/bevy/issues/18383","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/18383/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/18383/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/18383/events","html_url":"https://github.com/bevyengine/bevy/issues/18383","id":2926867528,"node_id":"I_kwDODf6-U86udHRI","number":18383,"title":"More geometrically-accurate smooth normals.","user":{"login":"Waridley","id":2176843,"node_id":"MDQ6VXNlcjIxNzY4NDM=","avatar_url":"https://avatars.githubusercontent.com/u/2176843?v=4","gravatar_id":"","url":"https://api.github.com/users/Waridley","html_url":"https://github.com/Waridley","followers_url":"https://api.github.com/users/Waridley/followers","following_url":"https://api.github.com/users/Waridley/following{/other_user}","gists_url":"https://api.github.com/users/Waridley/gists{/gist_id}","starred_url":"https://api.github.com/users/Waridley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Waridley/subscriptions","organizations_url":"https://api.github.com/users/Waridley/orgs","repos_url":"https://api.github.com/users/Waridley/repos","events_url":"https://api.github.com/users/Waridley/events{/privacy}","received_events_url":"https://api.github.com/users/Waridley/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619326,"node_id":"MDU6TGFiZWwxNzk1NjE5MzI2","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Feature","name":"C-Feature","color":"b8b8b8","default":false,"description":"A new feature, making something new possible"},{"id":3166152189,"node_id":"MDU6TGFiZWwzMTY2MTUyMTg5","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Design","name":"S-Needs-Design","color":"D876E3","default":false,"description":"This issue requires design work to think about how it would best be accomplished"},{"id":6899576022,"node_id":"LA_kwDODf6-U88AAAABmz8s1g","url":"https://api.github.com/repos/bevyengine/bevy/labels/D-Modest","name":"D-Modest","color":"008672","default":false,"description":"A \"normal\" level of difficulty; suitable for simple features or challenging fixes"},{"id":7520645213,"node_id":"LA_kwDODf6-U88AAAABwEPwXQ","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-glTF","name":"A-glTF","color":"c6A751","default":false,"description":"Related to the glTF 3D scene/model format"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-03-18T02:16:36Z","updated_at":"2025-07-17T19:48:45Z","closed_at":"2025-07-17T19:48:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Problem\n\n#16050 added a much-needed fix to computed smooth normals, where the previous implementation (still in 0.15) resulted in normals weighted by the *count* of triangles in each plane connected to a vertex. The current implementation instead weights them by the *area* of each triangle, which is sometimes entirely desired.\n\nHowever, in a lot of cases, the area of a *triangle* connected to a vertex has nothing to do with the area of the entire *face* on that side, like it would in a full 3D modelling program like Blender. And even if it were the same circumstance as Blender, non-face-weighted normals seems to be the default in most cases anyway. For example, the normal of the maximum corner of a mesh generated from an AABB should always be equal to `Vec3::ONE.normalize()`, no matter the dimensions of the box or the direction the quads are divided into triangles. (In one direction, a face would contribute half of its area, and in the other, it would contribute the full area).\n\n## Solution\n\nIMHO, the normals should by default be weighted by the *angle* of the corner of the triangle at that vertex, as explained in [this StackOverflow answer.](https://stackoverflow.com/a/45496726) I have made a demo comparing the current implementation with one that uses corner angles rather than face area: https://github.com/Waridley/bevy_smooth_normals_comparison?tab=readme-ov-file\n\n## Open questions\n\n### Should it actually be the default?\n\n<img src=\"https://media.githubusercontent.com/media/Waridley/bevy_smooth_normals_comparison/e05575eca9d3b17b2af80e2386fe845c36d735cf/screenshots/front_gizmos.png\"/>\n\n_main branch impl on the left, angle-weighted on the right_\n\nThis view does highlight another potential drawback of this approach: The normal in the concave corner where the gable meets the spire is almost entirely influenced by the spire face and not the ridge of the gable. It's unclear that that is strictly incorrect, but since the far left vertex of the ridge of the gable is pointing significantly more in the upward direction, scaling the mesh along the normals would result in a more tilted ridge. It also results in a more pronounced faux-ambient occlusion effect. I still think the perfectly-vertical spire peak normal is by far the best option, though.\n\n### Naming\n\nIf the angle-weighted method does not become the default, but does get added as another method, that method would need a name. I've been calling them \"geometric\" normals, but I'm not sure how clear that is.\n\nIf the area-weighted version remains an option, is it really clear that only the triangles *connected* to the vertex are incorporated, not the whole plane on that side of the object? Maybe its name could stay but the docs could be updated to clarify that.\n\n## Additional context\n\nI discovered the issue with 0.15's smooth normals when I tried to generate outline meshes and they were very lumpy. It turns out `bevy_mod_outline` also had to deal with that issue and ended up adding [an entire separate mesh attribute](https://docs.rs/bevy_mod_outline/latest/bevy_mod_outline/constant.ATTRIBUTE_OUTLINE_NORMAL.html) for it. They might want to keep it around for other reasons anyway, but it seems to me like generating \"geometric\" smooth normals by default would be less surprising.\n\nI can go ahead and make the PR to update Bevy's implementation, either going with my gut on the unanswered questions and updating later if necessary, or including any feedback provided before I actually make the PR.","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/18383/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/18383/timeline","performed_via_github_app":null,"state_reason":"completed"}