{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12000","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/12000/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/12000/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/12000/events","html_url":"https://github.com/bevyengine/bevy/issues/12000","id":2144488385,"node_id":"I_kwDODf6-U85_0kvB","number":12000,"title":"When VIEWPORT is set to CAMERA and switched to `SizedFullscreen`, PANIC may occur.","user":{"login":"hyoi","id":75478122,"node_id":"MDQ6VXNlcjc1NDc4MTIy","avatar_url":"https://avatars.githubusercontent.com/u/75478122?v=4","gravatar_id":"","url":"https://api.github.com/users/hyoi","html_url":"https://github.com/hyoi","followers_url":"https://api.github.com/users/hyoi/followers","following_url":"https://api.github.com/users/hyoi/following{/other_user}","gists_url":"https://api.github.com/users/hyoi/gists{/gist_id}","starred_url":"https://api.github.com/users/hyoi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hyoi/subscriptions","organizations_url":"https://api.github.com/users/hyoi/orgs","repos_url":"https://api.github.com/users/hyoi/repos","events_url":"https://api.github.com/users/hyoi/events{/privacy}","received_events_url":"https://api.github.com/users/hyoi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2045383863,"node_id":"MDU6TGFiZWwyMDQ1MzgzODYz","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Rendering","name":"A-Rendering","color":"C6A751","default":false,"description":"Drawing game state to the screen"},{"id":2272057257,"node_id":"MDU6TGFiZWwyMjcyMDU3MjU3","url":"https://api.github.com/repos/bevyengine/bevy/labels/P-Crash","name":"P-Crash","color":"FF7b00","default":false,"description":"A sudden unexpected crash"},{"id":3166126807,"node_id":"MDU6TGFiZWwzMTY2MTI2ODA3","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Investigation","name":"S-Needs-Investigation","color":"D876E1","default":false,"description":"This issue requires detective work to figure out what's going wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-02-20T14:18:34Z","updated_at":"2024-04-06T02:37:28Z","closed_at":"2024-04-06T02:37:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\r\n\r\nv0.13.0, 0.13.1\r\n\r\n## Relevant system information\r\n```\r\n2024-02-20T12:45:02.631105Z  INFO bevy_render::renderer: AdapterInfo { name: \"Intel(R) Iris(R) Xe Graphics\", vendor: 32902, device: 18086, device_type: IntegratedGpu, driver: \"Intel Corporation\", driver_info: \"Intel driver\", backend: Vulkan }\r\n2024-02-20T12:45:04.399604Z  INFO bevy_diagnostic::system_information_diagnostics_plugin::internal: SystemInfo { os: \"Windows 11 Home\", kernel: \"22621\", cpu: \"12th Gen Intel(R) Core(TM) i7-1260P\", core_count: \"12\", memory: \"31.7 GiB\" }\r\n2024-02-20T12:45:09.668606Z ERROR log: Handling wgpu errors as fatal by default    \r\nthread '<unnamed>' panicked at C:\\Users\\hyoi\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\wgpu-0.19.1\\src\\backend\\wgpu_core.rs:3009:5:\r\nwgpu error: Validation Error\r\n\r\nCaused by:\r\n    In a RenderPass\r\n      note: encoder = `<CommandBuffer-(0, 181, Vulkan)>`     \r\n    In a set_viewport command\r\n    Viewport has invalid rect Rect { x: 0.0, y: 0.0, w: 1376.0, h: 768.0 }; origin and/or size is less than or equal to 0, and/or is not contained in the render target (1366, 768, 1) \r\n\r\n\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nEncountered a panic in exclusive system `bevy_render::renderer::render_system`!\r\nthread 'Compute Task Pool (1)' panicked at C:\\Users\\hyoi\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_render-0.13.0\\src\\pipelined_rendering.rs:49:67:\r\ncalled `Result::unwrap()` on an `Err` value: RecvError       \r\nerror: process didn't exit successfully: `target\\release\\work.exe` (exit code: 101)\r\n```\r\n\r\n## What you did\r\n\r\nOn my PC, I can reproduce PANIC with the following program.\r\nThis program first displays an empty window, and then the [SPACE] key toggles between `Windowed` and `SizedFullscreen` display.\r\nPANIC occurs when WINDOW_WIDTH is 1376.0, and there is no problem when WINDOW_WIDTH is 1366.0.\r\n```rust\r\nuse bevy::\r\n{   prelude::*,\r\n    render::camera::Viewport,\r\n    window::WindowMode,\r\n};\r\n\r\n// const WINDOW_WIDTH : f32 = 1366.0; //No problem\r\nconst WINDOW_WIDTH : f32 = 1376.0; //Panic: Viewport has invalid rect\r\nconst WINDOW_HEIGHT: f32 = 768.0;\r\n\r\nfn main()\r\n{   //Specify Window Size.\r\n    let window = Window { resolution: ( WINDOW_WIDTH, WINDOW_HEIGHT ).into(), ..default() };\r\n    let primary_window = Some ( window );\r\n\r\n    App::new()\r\n        .add_plugins( DefaultPlugins.set( WindowPlugin { primary_window, ..default() } ) )\r\n        .add_systems( Startup, startup )\r\n        .add_systems( Update, toggle_window_mode )\r\n        .run();\r\n}\r\n\r\nfn startup( mut cmds: Commands )\r\n{   //Match viewport to Window size.\r\n    let physical_position = UVec2::new( 0, 0 );\r\n    let physical_size = Vec2::new( WINDOW_WIDTH, WINDOW_HEIGHT ).as_uvec2();\r\n    let viewport = Some ( Viewport { physical_position, physical_size, ..default() } );\r\n\r\n    cmds.spawn( Camera2dBundle::default() ).insert( Camera { viewport, ..default() } );\r\n}\r\n\r\nfn toggle_window_mode\r\n(   mut qry_window: Query<&mut Window>,\r\n    inkey: Res<ButtonInput<KeyCode>>,\r\n)\r\n{   let Ok( mut window ) = qry_window.get_single_mut() else { return };\r\n\r\n    //Press [SPACE] key to toggle between window and full screen.\r\n    if inkey.just_pressed( KeyCode::Space )\r\n    {   window.mode = match window.mode\r\n        {   WindowMode::Windowed => WindowMode::SizedFullscreen,\r\n            _                    => WindowMode::Windowed,\r\n        };\r\n    }\r\n}\r\n```\r\n\r\n## What went wrong\r\n\r\n- VIEWPORT validation has been added to WGPU V0.18.0. [#4058](https://github.com/gfx-rs/wgpu/pull/4058)\r\n- I thought that if the resolution after `SizedFullscreen` setting is lower than the original window resolution, the VIEWPORT would result in a validation error and PANIC.\r\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12000/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/12000/timeline","performed_via_github_app":null,"state_reason":"completed"}