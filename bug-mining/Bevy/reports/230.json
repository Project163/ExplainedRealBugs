{"url":"https://api.github.com/repos/bevyengine/bevy/issues/13232","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/13232/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/13232/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/13232/events","html_url":"https://github.com/bevyengine/bevy/issues/13232","id":2279021649,"node_id":"I_kwDODf6-U86H1xxR","number":13232,"title":"Bevy can't render default shapes if `bevy_render` has `shader_format_glsl` enabled.","user":{"login":"jimvdl","id":26407533,"node_id":"MDQ6VXNlcjI2NDA3NTMz","avatar_url":"https://avatars.githubusercontent.com/u/26407533?v=4","gravatar_id":"","url":"https://api.github.com/users/jimvdl","html_url":"https://github.com/jimvdl","followers_url":"https://api.github.com/users/jimvdl/followers","following_url":"https://api.github.com/users/jimvdl/following{/other_user}","gists_url":"https://api.github.com/users/jimvdl/gists{/gist_id}","starred_url":"https://api.github.com/users/jimvdl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimvdl/subscriptions","organizations_url":"https://api.github.com/users/jimvdl/orgs","repos_url":"https://api.github.com/users/jimvdl/repos","events_url":"https://api.github.com/users/jimvdl/events{/privacy}","received_events_url":"https://api.github.com/users/jimvdl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2045383863,"node_id":"MDU6TGFiZWwyMDQ1MzgzODYz","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Rendering","name":"A-Rendering","color":"C6A751","default":false,"description":"Drawing game state to the screen"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2024-05-04T14:29:32Z","updated_at":"2024-05-26T14:54:29Z","closed_at":"2024-05-26T14:54:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\r\n\r\n0.13\r\n\r\n## Relevant system information\r\n\r\nOperating system: Windows 10.\r\nRust version: 1.76.0\r\n\r\n```\r\nAdapterInfo { name: \"NVIDIA GeForce RTX 3080\", vendor: 4318, device: 8726, device_type: DiscreteGpu, driver: \"NVIDIA\", driver_info: \"551.52\", backend: Vulkan }\r\n```\r\n\r\n\r\n## What you did\r\nMinimal reproducible example:\r\n`Cargo.toml`\r\n```toml\r\n# package omitted\r\n\r\n[profile.dev]\r\nopt-level = 1\r\n\r\n[profile.dev.package.\"*\"]\r\nopt-level = 3\r\n\r\n[dependencies]\r\nbevy = \"0.13\"\r\nbevy_render = { version = \"0.13\", features = [\"shader_format_glsl\"] }\r\n```\r\n\r\n`main.rs`\r\n```rust\r\nuse bevy::prelude::*;\r\n\r\nfn main() {\r\n    App::new()\r\n        .add_plugins(DefaultPlugins)\r\n        .add_systems(Startup, setup)\r\n        .run();\r\n}\r\n\r\nfn setup(\r\n    mut commands: Commands,\r\n    mut meshes: ResMut<Assets<Mesh>>,\r\n    mut materials: ResMut<Assets<StandardMaterial>>,\r\n) {\r\n    commands.spawn(MaterialMeshBundle {\r\n        mesh: meshes.add(Cuboid::default()),\r\n        transform: Transform::from_xyz(0.0, 0.5, 0.0),\r\n        material: materials.add(Color::rgb(0., 0.5, 0.7)),\r\n        ..default()\r\n    });\r\n\r\n    commands.spawn(Camera3dBundle {\r\n        transform: Transform::from_xyz(-2.0, 2.5, 5.0).looking_at(Vec3::ZERO, Vec3::Y),\r\n        ..default()\r\n    });\r\n}\r\n```\r\n\r\n## What went wrong\r\n\r\nI can render GLTF models fine but once I replace that with a `Cuboid::default` I get the following panic:\r\n```\r\nthread 'Async Compute Task Pool (2)' panicked at C:\\Users\\Jim\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\naga-0.19.2\\src\\back\\glsl\\mod.rs:1183:44:\r\ninternal error: entered unreachable code\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nthread 'Async Compute Task Pool (2)' panicked at C:\\Users\\Jim\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_render-0.13.2\\src\\render_resource\\pipeline_cache.rs:702:60:\r\ncalled `Result::unwrap()` on an `Err` value: PoisonError { .. }\r\nthread 'Async Compute Task Pool (1)' panicked at C:\\Users\\Jim\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_render-0.13.2\\src\\render_resource\\pipeline_cache.rs:801:60:\r\ncalled `Result::unwrap()` on an `Err` value: PoisonError { .. }\r\nEncountered a panic in system `bevy_render::render_resource::pipeline_cache::PipelineCache::process_pipeline_queue_system`!\r\nthread 'Compute Task Pool (3)' panicked at C:\\Users\\Jim\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\bevy_render-0.13.2\\src\\pipelined_rendering.rs:49:67:\r\ncalled `Result::unwrap()` on an `Err` value: RecvError\r\n```\r\n\r\nIn my bigger project I'm using GLSL to shade models that I've imported with GLTF, those work perfectly, the shader works and the models are correctly imported and displayed. The only thing that goes wrong is if you use either `MaterialMeshBundle` or `PbrBundle` with a basic shape mesh, then the above panic occurs.\r\n\r\nI can't use `bevy_render` without `shader_format_glsl` because it's a required feature if you want to shade GLTF meshes with GLSL.\r\n\r\n## Additional information\r\n\r\nI'm very new to all this, I've worked with Bevy before without needing any models or meshes (it was basically only a ECS backend) so it might be that I'm just doing something wrong.\r\n\r\nif you disable the `shader_format_glsl` feature the above example compiles and runs fine.\r\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/13232/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/13232/timeline","performed_via_github_app":null,"state_reason":"completed"}