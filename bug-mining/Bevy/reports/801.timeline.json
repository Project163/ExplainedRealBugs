[{"id":17278183074,"node_id":"LE_lADODf6-U86yr7fezwAAAAQF3Cai","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17278183074","actor":{"login":"Henauxg","id":19689618,"node_id":"MDQ6VXNlcjE5Njg5NjE4","avatar_url":"https://avatars.githubusercontent.com/u/19689618?v=4","gravatar_id":"","url":"https://api.github.com/users/Henauxg","html_url":"https://github.com/Henauxg","followers_url":"https://api.github.com/users/Henauxg/followers","following_url":"https://api.github.com/users/Henauxg/following{/other_user}","gists_url":"https://api.github.com/users/Henauxg/gists{/gist_id}","starred_url":"https://api.github.com/users/Henauxg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Henauxg/subscriptions","organizations_url":"https://api.github.com/users/Henauxg/orgs","repos_url":"https://api.github.com/users/Henauxg/repos","events_url":"https://api.github.com/users/Henauxg/events{/privacy}","received_events_url":"https://api.github.com/users/Henauxg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-04-15T23:05:53Z","label":{"name":"C-Bug","color":"d73a4a"},"performed_via_github_app":null},{"id":17278183078,"node_id":"LE_lADODf6-U86yr7fezwAAAAQF3Cam","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17278183078","actor":{"login":"Henauxg","id":19689618,"node_id":"MDQ6VXNlcjE5Njg5NjE4","avatar_url":"https://avatars.githubusercontent.com/u/19689618?v=4","gravatar_id":"","url":"https://api.github.com/users/Henauxg","html_url":"https://github.com/Henauxg","followers_url":"https://api.github.com/users/Henauxg/followers","following_url":"https://api.github.com/users/Henauxg/following{/other_user}","gists_url":"https://api.github.com/users/Henauxg/gists{/gist_id}","starred_url":"https://api.github.com/users/Henauxg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Henauxg/subscriptions","organizations_url":"https://api.github.com/users/Henauxg/orgs","repos_url":"https://api.github.com/users/Henauxg/repos","events_url":"https://api.github.com/users/Henauxg/events{/privacy}","received_events_url":"https://api.github.com/users/Henauxg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-04-15T23:05:53Z","label":{"name":"S-Needs-Triage","color":"D876e3"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bevyengine/bevy/issues/comments/2810163722","html_url":"https://github.com/bevyengine/bevy/issues/18856#issuecomment-2810163722","issue_url":"https://api.github.com/repos/bevyengine/bevy/issues/18856","id":2810163722,"node_id":"IC_kwDODf6-U86nf7IK","user":{"login":"KrzysztofZywiecki","id":28830803,"node_id":"MDQ6VXNlcjI4ODMwODAz","avatar_url":"https://avatars.githubusercontent.com/u/28830803?v=4","gravatar_id":"","url":"https://api.github.com/users/KrzysztofZywiecki","html_url":"https://github.com/KrzysztofZywiecki","followers_url":"https://api.github.com/users/KrzysztofZywiecki/followers","following_url":"https://api.github.com/users/KrzysztofZywiecki/following{/other_user}","gists_url":"https://api.github.com/users/KrzysztofZywiecki/gists{/gist_id}","starred_url":"https://api.github.com/users/KrzysztofZywiecki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KrzysztofZywiecki/subscriptions","organizations_url":"https://api.github.com/users/KrzysztofZywiecki/orgs","repos_url":"https://api.github.com/users/KrzysztofZywiecki/repos","events_url":"https://api.github.com/users/KrzysztofZywiecki/events{/privacy}","received_events_url":"https://api.github.com/users/KrzysztofZywiecki/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-16T16:51:45Z","updated_at":"2025-04-16T16:55:39Z","body":"I discovered that this bug appears in commit 683b08f associeted with PR https://github.com/bevyengine/bevy/pull/17633 . This issue doesn't happen in b574599 that's right before. The only difference was that I had to add a small margin to viewport's `physical_size`: `physical_size: window.physical_size() - UVec2::new(350, 0)` because the app panicked otherwise.\n\nMy guess is that after this PR, `make_ray` method in bevy_picking/src/backend.rs corrects cursor physical position to logical position twice, once in the function and the second time in `camera.viewport_to_world`. This version of `make_ray` works correctly both with modified example, and my application.\n\n```\n    fn make_ray(\n        primary_window_entity: &Query<Entity, With<PrimaryWindow>>,\n        camera: &Camera,\n        camera_tfm: &GlobalTransform,\n        pointer_loc: &PointerLocation,\n    ) -> Option<Ray3d> {\n        let pointer_loc = pointer_loc.location()?;\n        if !pointer_loc.is_in_viewport(camera, primary_window_entity) {\n            return None;\n        }\n        let mut viewport_pos = pointer_loc.position;\n        // if let Some(viewport) = &camera.viewport {\n        //     let viewport_logical = camera.to_logical(viewport.physical_position)?;\n        //     viewport_pos -= viewport_logical;\n        // }\n        camera.viewport_to_world(camera_tfm, viewport_pos).ok()\n    }","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/comments/2810163722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KrzysztofZywiecki","id":28830803,"node_id":"MDQ6VXNlcjI4ODMwODAz","avatar_url":"https://avatars.githubusercontent.com/u/28830803?v=4","gravatar_id":"","url":"https://api.github.com/users/KrzysztofZywiecki","html_url":"https://github.com/KrzysztofZywiecki","followers_url":"https://api.github.com/users/KrzysztofZywiecki/followers","following_url":"https://api.github.com/users/KrzysztofZywiecki/following{/other_user}","gists_url":"https://api.github.com/users/KrzysztofZywiecki/gists{/gist_id}","starred_url":"https://api.github.com/users/KrzysztofZywiecki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KrzysztofZywiecki/subscriptions","organizations_url":"https://api.github.com/users/KrzysztofZywiecki/orgs","repos_url":"https://api.github.com/users/KrzysztofZywiecki/repos","events_url":"https://api.github.com/users/KrzysztofZywiecki/events{/privacy}","received_events_url":"https://api.github.com/users/KrzysztofZywiecki/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bevyengine/bevy/issues/comments/2810950201","html_url":"https://github.com/bevyengine/bevy/issues/18856#issuecomment-2810950201","issue_url":"https://api.github.com/repos/bevyengine/bevy/issues/18856","id":2810950201,"node_id":"IC_kwDODf6-U86ni7I5","user":{"login":"KrzysztofZywiecki","id":28830803,"node_id":"MDQ6VXNlcjI4ODMwODAz","avatar_url":"https://avatars.githubusercontent.com/u/28830803?v=4","gravatar_id":"","url":"https://api.github.com/users/KrzysztofZywiecki","html_url":"https://github.com/KrzysztofZywiecki","followers_url":"https://api.github.com/users/KrzysztofZywiecki/followers","following_url":"https://api.github.com/users/KrzysztofZywiecki/following{/other_user}","gists_url":"https://api.github.com/users/KrzysztofZywiecki/gists{/gist_id}","starred_url":"https://api.github.com/users/KrzysztofZywiecki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KrzysztofZywiecki/subscriptions","organizations_url":"https://api.github.com/users/KrzysztofZywiecki/orgs","repos_url":"https://api.github.com/users/KrzysztofZywiecki/repos","events_url":"https://api.github.com/users/KrzysztofZywiecki/events{/privacy}","received_events_url":"https://api.github.com/users/KrzysztofZywiecki/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-16T22:24:14Z","updated_at":"2025-04-16T22:24:14Z","body":"I did some more testing. Applying change described above seems to fix picking in examples: simple_picking, mesh_picking, I added a simple observer in split_screen to ground plane and tested individual cameras if they can pick and with this change they can - on master only the top left camera can pick, also UI interferes with picking, however sprite_picking with camera viewport offset stays broken with this change.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/comments/2810950201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KrzysztofZywiecki","id":28830803,"node_id":"MDQ6VXNlcjI4ODMwODAz","avatar_url":"https://avatars.githubusercontent.com/u/28830803?v=4","gravatar_id":"","url":"https://api.github.com/users/KrzysztofZywiecki","html_url":"https://github.com/KrzysztofZywiecki","followers_url":"https://api.github.com/users/KrzysztofZywiecki/followers","following_url":"https://api.github.com/users/KrzysztofZywiecki/following{/other_user}","gists_url":"https://api.github.com/users/KrzysztofZywiecki/gists{/gist_id}","starred_url":"https://api.github.com/users/KrzysztofZywiecki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KrzysztofZywiecki/subscriptions","organizations_url":"https://api.github.com/users/KrzysztofZywiecki/orgs","repos_url":"https://api.github.com/users/KrzysztofZywiecki/repos","events_url":"https://api.github.com/users/KrzysztofZywiecki/events{/privacy}","received_events_url":"https://api.github.com/users/KrzysztofZywiecki/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bevyengine/bevy/issues/comments/2812023893","html_url":"https://github.com/bevyengine/bevy/issues/18856#issuecomment-2812023893","issue_url":"https://api.github.com/repos/bevyengine/bevy/issues/18856","id":2812023893,"node_id":"IC_kwDODf6-U86nnBRV","user":{"login":"Henauxg","id":19689618,"node_id":"MDQ6VXNlcjE5Njg5NjE4","avatar_url":"https://avatars.githubusercontent.com/u/19689618?v=4","gravatar_id":"","url":"https://api.github.com/users/Henauxg","html_url":"https://github.com/Henauxg","followers_url":"https://api.github.com/users/Henauxg/followers","following_url":"https://api.github.com/users/Henauxg/following{/other_user}","gists_url":"https://api.github.com/users/Henauxg/gists{/gist_id}","starred_url":"https://api.github.com/users/Henauxg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Henauxg/subscriptions","organizations_url":"https://api.github.com/users/Henauxg/orgs","repos_url":"https://api.github.com/users/Henauxg/repos","events_url":"https://api.github.com/users/Henauxg/events{/privacy}","received_events_url":"https://api.github.com/users/Henauxg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-17T07:20:03Z","updated_at":"2025-04-17T07:20:03Z","body":"Good find ! Do you want me to whip up a PR for your fix ?\nThe reason sprites don't work yet is probably due to this: #18069 \n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/comments/2812023893/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Henauxg","id":19689618,"node_id":"MDQ6VXNlcjE5Njg5NjE4","avatar_url":"https://avatars.githubusercontent.com/u/19689618?v=4","gravatar_id":"","url":"https://api.github.com/users/Henauxg","html_url":"https://github.com/Henauxg","followers_url":"https://api.github.com/users/Henauxg/followers","following_url":"https://api.github.com/users/Henauxg/following{/other_user}","gists_url":"https://api.github.com/users/Henauxg/gists{/gist_id}","starred_url":"https://api.github.com/users/Henauxg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Henauxg/subscriptions","organizations_url":"https://api.github.com/users/Henauxg/orgs","repos_url":"https://api.github.com/users/Henauxg/repos","events_url":"https://api.github.com/users/Henauxg/events{/privacy}","received_events_url":"https://api.github.com/users/Henauxg/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bevyengine/bevy/issues/comments/2812067176","html_url":"https://github.com/bevyengine/bevy/issues/18856#issuecomment-2812067176","issue_url":"https://api.github.com/repos/bevyengine/bevy/issues/18856","id":2812067176,"node_id":"IC_kwDODf6-U86nnL1o","user":{"login":"KrzysztofZywiecki","id":28830803,"node_id":"MDQ6VXNlcjI4ODMwODAz","avatar_url":"https://avatars.githubusercontent.com/u/28830803?v=4","gravatar_id":"","url":"https://api.github.com/users/KrzysztofZywiecki","html_url":"https://github.com/KrzysztofZywiecki","followers_url":"https://api.github.com/users/KrzysztofZywiecki/followers","following_url":"https://api.github.com/users/KrzysztofZywiecki/following{/other_user}","gists_url":"https://api.github.com/users/KrzysztofZywiecki/gists{/gist_id}","starred_url":"https://api.github.com/users/KrzysztofZywiecki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KrzysztofZywiecki/subscriptions","organizations_url":"https://api.github.com/users/KrzysztofZywiecki/orgs","repos_url":"https://api.github.com/users/KrzysztofZywiecki/repos","events_url":"https://api.github.com/users/KrzysztofZywiecki/events{/privacy}","received_events_url":"https://api.github.com/users/KrzysztofZywiecki/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-17T07:41:01Z","updated_at":"2025-04-17T07:41:01Z","body":"Thanks for clarifying about why sprites don't work. I'll prepare a PR after work to practice doing it, but thank you so much for your initiative ðŸ˜ƒ ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/comments/2812067176/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"KrzysztofZywiecki","id":28830803,"node_id":"MDQ6VXNlcjI4ODMwODAz","avatar_url":"https://avatars.githubusercontent.com/u/28830803?v=4","gravatar_id":"","url":"https://api.github.com/users/KrzysztofZywiecki","html_url":"https://github.com/KrzysztofZywiecki","followers_url":"https://api.github.com/users/KrzysztofZywiecki/followers","following_url":"https://api.github.com/users/KrzysztofZywiecki/following{/other_user}","gists_url":"https://api.github.com/users/KrzysztofZywiecki/gists{/gist_id}","starred_url":"https://api.github.com/users/KrzysztofZywiecki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KrzysztofZywiecki/subscriptions","organizations_url":"https://api.github.com/users/KrzysztofZywiecki/orgs","repos_url":"https://api.github.com/users/KrzysztofZywiecki/repos","events_url":"https://api.github.com/users/KrzysztofZywiecki/events{/privacy}","received_events_url":"https://api.github.com/users/KrzysztofZywiecki/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"KrzysztofZywiecki","id":28830803,"node_id":"MDQ6VXNlcjI4ODMwODAz","avatar_url":"https://avatars.githubusercontent.com/u/28830803?v=4","gravatar_id":"","url":"https://api.github.com/users/KrzysztofZywiecki","html_url":"https://github.com/KrzysztofZywiecki","followers_url":"https://api.github.com/users/KrzysztofZywiecki/followers","following_url":"https://api.github.com/users/KrzysztofZywiecki/following{/other_user}","gists_url":"https://api.github.com/users/KrzysztofZywiecki/gists{/gist_id}","starred_url":"https://api.github.com/users/KrzysztofZywiecki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KrzysztofZywiecki/subscriptions","organizations_url":"https://api.github.com/users/KrzysztofZywiecki/orgs","repos_url":"https://api.github.com/users/KrzysztofZywiecki/repos","events_url":"https://api.github.com/users/KrzysztofZywiecki/events{/privacy}","received_events_url":"https://api.github.com/users/KrzysztofZywiecki/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-04-17T15:38:32Z","updated_at":"2025-04-17T15:38:32Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/18870","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/18870/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/18870/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/18870/events","html_url":"https://github.com/bevyengine/bevy/pull/18870","id":3002852616,"node_id":"PR_kwDODf6-U86TAndO","number":18870,"title":"Removed conversion from pointer physical coordinates to viewport local coordinates in bevy_picking make_ray function","user":{"login":"KrzysztofZywiecki","id":28830803,"node_id":"MDQ6VXNlcjI4ODMwODAz","avatar_url":"https://avatars.githubusercontent.com/u/28830803?v=4","gravatar_id":"","url":"https://api.github.com/users/KrzysztofZywiecki","html_url":"https://github.com/KrzysztofZywiecki","followers_url":"https://api.github.com/users/KrzysztofZywiecki/followers","following_url":"https://api.github.com/users/KrzysztofZywiecki/following{/other_user}","gists_url":"https://api.github.com/users/KrzysztofZywiecki/gists{/gist_id}","starred_url":"https://api.github.com/users/KrzysztofZywiecki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KrzysztofZywiecki/subscriptions","organizations_url":"https://api.github.com/users/KrzysztofZywiecki/orgs","repos_url":"https://api.github.com/users/KrzysztofZywiecki/repos","events_url":"https://api.github.com/users/KrzysztofZywiecki/events{/privacy}","received_events_url":"https://api.github.com/users/KrzysztofZywiecki/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":7040334053,"node_id":"LA_kwDODf6-U88AAAABo6L45Q","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Picking","name":"A-Picking","color":"c6A751","default":false,"description":"Pointing at and selecting objects of all sorts"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bevyengine/bevy/milestones/33","html_url":"https://github.com/bevyengine/bevy/milestone/33","labels_url":"https://api.github.com/repos/bevyengine/bevy/milestones/33/labels","id":12716960,"node_id":"MI_kwDODf6-U84Awgug","number":33,"title":"0.16.1","description":"","creator":{"login":"mockersf","id":8672791,"node_id":"MDQ6VXNlcjg2NzI3OTE=","avatar_url":"https://avatars.githubusercontent.com/u/8672791?v=4","gravatar_id":"","url":"https://api.github.com/users/mockersf","html_url":"https://github.com/mockersf","followers_url":"https://api.github.com/users/mockersf/followers","following_url":"https://api.github.com/users/mockersf/following{/other_user}","gists_url":"https://api.github.com/users/mockersf/gists{/gist_id}","starred_url":"https://api.github.com/users/mockersf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockersf/subscriptions","organizations_url":"https://api.github.com/users/mockersf/orgs","repos_url":"https://api.github.com/users/mockersf/repos","events_url":"https://api.github.com/users/mockersf/events{/privacy}","received_events_url":"https://api.github.com/users/mockersf/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":39,"state":"closed","created_at":"2025-04-11T18:45:29Z","updated_at":"2025-05-30T21:42:40Z","due_on":null,"closed_at":"2025-05-30T21:42:40Z"},"comments":4,"created_at":"2025-04-17T15:38:31Z","updated_at":"2025-04-27T16:03:47Z","closed_at":"2025-04-27T14:19:34Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":234798675,"node_id":"MDEwOlJlcG9zaXRvcnkyMzQ3OTg2NzU=","name":"bevy","full_name":"bevyengine/bevy","private":false,"owner":{"login":"bevyengine","id":60047606,"node_id":"MDEyOk9yZ2FuaXphdGlvbjYwMDQ3NjA2","avatar_url":"https://avatars.githubusercontent.com/u/60047606?v=4","gravatar_id":"","url":"https://api.github.com/users/bevyengine","html_url":"https://github.com/bevyengine","followers_url":"https://api.github.com/users/bevyengine/followers","following_url":"https://api.github.com/users/bevyengine/following{/other_user}","gists_url":"https://api.github.com/users/bevyengine/gists{/gist_id}","starred_url":"https://api.github.com/users/bevyengine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bevyengine/subscriptions","organizations_url":"https://api.github.com/users/bevyengine/orgs","repos_url":"https://api.github.com/users/bevyengine/repos","events_url":"https://api.github.com/users/bevyengine/events{/privacy}","received_events_url":"https://api.github.com/users/bevyengine/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bevyengine/bevy","description":"A refreshingly simple data-driven game engine built in Rust","fork":false,"url":"https://api.github.com/repos/bevyengine/bevy","forks_url":"https://api.github.com/repos/bevyengine/bevy/forks","keys_url":"https://api.github.com/repos/bevyengine/bevy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bevyengine/bevy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bevyengine/bevy/teams","hooks_url":"https://api.github.com/repos/bevyengine/bevy/hooks","issue_events_url":"https://api.github.com/repos/bevyengine/bevy/issues/events{/number}","events_url":"https://api.github.com/repos/bevyengine/bevy/events","assignees_url":"https://api.github.com/repos/bevyengine/bevy/assignees{/user}","branches_url":"https://api.github.com/repos/bevyengine/bevy/branches{/branch}","tags_url":"https://api.github.com/repos/bevyengine/bevy/tags","blobs_url":"https://api.github.com/repos/bevyengine/bevy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bevyengine/bevy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bevyengine/bevy/git/refs{/sha}","trees_url":"https://api.github.com/repos/bevyengine/bevy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bevyengine/bevy/statuses/{sha}","languages_url":"https://api.github.com/repos/bevyengine/bevy/languages","stargazers_url":"https://api.github.com/repos/bevyengine/bevy/stargazers","contributors_url":"https://api.github.com/repos/bevyengine/bevy/contributors","subscribers_url":"https://api.github.com/repos/bevyengine/bevy/subscribers","subscription_url":"https://api.github.com/repos/bevyengine/bevy/subscription","commits_url":"https://api.github.com/repos/bevyengine/bevy/commits{/sha}","git_commits_url":"https://api.github.com/repos/bevyengine/bevy/git/commits{/sha}","comments_url":"https://api.github.com/repos/bevyengine/bevy/comments{/number}","issue_comment_url":"https://api.github.com/repos/bevyengine/bevy/issues/comments{/number}","contents_url":"https://api.github.com/repos/bevyengine/bevy/contents/{+path}","compare_url":"https://api.github.com/repos/bevyengine/bevy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bevyengine/bevy/merges","archive_url":"https://api.github.com/repos/bevyengine/bevy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bevyengine/bevy/downloads","issues_url":"https://api.github.com/repos/bevyengine/bevy/issues{/number}","pulls_url":"https://api.github.com/repos/bevyengine/bevy/pulls{/number}","milestones_url":"https://api.github.com/repos/bevyengine/bevy/milestones{/number}","notifications_url":"https://api.github.com/repos/bevyengine/bevy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bevyengine/bevy/labels{/name}","releases_url":"https://api.github.com/repos/bevyengine/bevy/releases{/id}","deployments_url":"https://api.github.com/repos/bevyengine/bevy/deployments","created_at":"2020-01-18T21:13:55Z","updated_at":"2025-11-10T00:30:24Z","pushed_at":"2025-11-09T20:05:46Z","git_url":"git://github.com/bevyengine/bevy.git","ssh_url":"git@github.com:bevyengine/bevy.git","clone_url":"https://github.com/bevyengine/bevy.git","svn_url":"https://github.com/bevyengine/bevy","homepage":"https://bevy.org","size":152673,"stargazers_count":42996,"watchers_count":42996,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":4220,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":3116,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bevy","game-development","game-engine","gamedev","open-source","rust"],"visibility":"public","forks":4220,"open_issues":3116,"watchers":42996,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/bevyengine/bevy/pulls/18870","html_url":"https://github.com/bevyengine/bevy/pull/18870","diff_url":"https://github.com/bevyengine/bevy/pull/18870.diff","patch_url":"https://github.com/bevyengine/bevy/pull/18870.patch","merged_at":"2025-04-27T14:19:34Z"},"body":"# Objective\r\n\r\n- Fixes #18856.\r\n\r\n## Solution\r\n\r\nAfter PR #17633, `Camera::viewport_to_world` method corrects `viewport_position` passed in that input so that it's offset by camera's viewport. `Camera::viewport_to_world` is used by `make_ray` function which in turn also offsets pointer position by viewport position, which causes picking objects to be shifted by viewport position, and it wasn't removed in the aforementioned PR. This second offsetting in `make_ray` was removed.\r\n\r\n## Testing\r\n\r\n- I tested simple_picking example by applying some horizontal offset to camera's viewport.\r\n- I tested my application that displayed a single rectangle with picking on two cameras arranged in a row. When using local bevy with this fix, both cameras can be used for picking correctly.\r\n- I modified split_screen example: I added observer to ground plane that changes color on hover, and removed UI as it interfered with picking both on master and my branch. On master, only top left camera was triggering the observer, and on my branch all cameras could change plane's color on hover.\r\n- I added viewport offset to mesh_picking, with my changes it works correctly, while on master picking ray is shifted.\r\n- Sprite picking with viewport offset doesn't work both on master and on this branch.\r\n\r\nThese are the only scenarios I tested. I think other picking functions that use this function should be tested but I couldn't track more uses of it.\r\n","reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/18870/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/18870/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":17368103570,"node_id":"UNLE_lADODf6-U86yr7fezwAAAAQLODqS","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17368103570","actor":{"login":"Henauxg","id":19689618,"node_id":"MDQ6VXNlcjE5Njg5NjE4","avatar_url":"https://avatars.githubusercontent.com/u/19689618?v=4","gravatar_id":"","url":"https://api.github.com/users/Henauxg","html_url":"https://github.com/Henauxg","followers_url":"https://api.github.com/users/Henauxg/followers","following_url":"https://api.github.com/users/Henauxg/following{/other_user}","gists_url":"https://api.github.com/users/Henauxg/gists{/gist_id}","starred_url":"https://api.github.com/users/Henauxg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Henauxg/subscriptions","organizations_url":"https://api.github.com/users/Henauxg/orgs","repos_url":"https://api.github.com/users/Henauxg/repos","events_url":"https://api.github.com/users/Henauxg/events{/privacy}","received_events_url":"https://api.github.com/users/Henauxg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2025-04-23T10:15:15Z","label":{"name":"S-Needs-Triage","color":"D876e3"},"performed_via_github_app":null},{"id":17368103581,"node_id":"LE_lADODf6-U86yr7fezwAAAAQLODqd","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17368103581","actor":{"login":"Henauxg","id":19689618,"node_id":"MDQ6VXNlcjE5Njg5NjE4","avatar_url":"https://avatars.githubusercontent.com/u/19689618?v=4","gravatar_id":"","url":"https://api.github.com/users/Henauxg","html_url":"https://github.com/Henauxg","followers_url":"https://api.github.com/users/Henauxg/followers","following_url":"https://api.github.com/users/Henauxg/following{/other_user}","gists_url":"https://api.github.com/users/Henauxg/gists{/gist_id}","starred_url":"https://api.github.com/users/Henauxg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Henauxg/subscriptions","organizations_url":"https://api.github.com/users/Henauxg/orgs","repos_url":"https://api.github.com/users/Henauxg/repos","events_url":"https://api.github.com/users/Henauxg/events{/privacy}","received_events_url":"https://api.github.com/users/Henauxg/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2025-04-23T10:15:15Z","label":{"name":"A-Picking","color":"c6A751"},"performed_via_github_app":null},{"id":17423904624,"node_id":"REFE_lADODf6-U86yr7fezwAAAAQOi69w","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17423904624","actor":{"login":"github-merge-queue[bot]","id":118344674,"node_id":"BOT_kgDOBw3L4g","avatar_url":"https://avatars.githubusercontent.com/u/9919?v=4","gravatar_id":"","url":"https://api.github.com/users/github-merge-queue%5Bbot%5D","html_url":"https://github.com/apps/github-merge-queue","followers_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"7f0490655c3ede945e6babc1f1a1f06b13404aa8","commit_url":"https://api.github.com/repos/bevyengine/bevy/commits/7f0490655c3ede945e6babc1f1a1f06b13404aa8","created_at":"2025-04-27T14:19:35Z","performed_via_github_app":null},{"id":17423904666,"node_id":"CE_lADODf6-U86yr7fezwAAAAQOi6-a","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17423904666","actor":{"login":"mockersf","id":8672791,"node_id":"MDQ6VXNlcjg2NzI3OTE=","avatar_url":"https://avatars.githubusercontent.com/u/8672791?v=4","gravatar_id":"","url":"https://api.github.com/users/mockersf","html_url":"https://github.com/mockersf","followers_url":"https://api.github.com/users/mockersf/followers","following_url":"https://api.github.com/users/mockersf/following{/other_user}","gists_url":"https://api.github.com/users/mockersf/gists{/gist_id}","starred_url":"https://api.github.com/users/mockersf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockersf/subscriptions","organizations_url":"https://api.github.com/users/mockersf/orgs","repos_url":"https://api.github.com/users/mockersf/repos","events_url":"https://api.github.com/users/mockersf/events{/privacy}","received_events_url":"https://api.github.com/users/mockersf/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2025-04-27T14:19:36Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"atlv24","id":11307157,"node_id":"MDQ6VXNlcjExMzA3MTU3","avatar_url":"https://avatars.githubusercontent.com/u/11307157?v=4","gravatar_id":"","url":"https://api.github.com/users/atlv24","html_url":"https://github.com/atlv24","followers_url":"https://api.github.com/users/atlv24/followers","following_url":"https://api.github.com/users/atlv24/following{/other_user}","gists_url":"https://api.github.com/users/atlv24/gists{/gist_id}","starred_url":"https://api.github.com/users/atlv24/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/atlv24/subscriptions","organizations_url":"https://api.github.com/users/atlv24/orgs","repos_url":"https://api.github.com/users/atlv24/repos","events_url":"https://api.github.com/users/atlv24/events{/privacy}","received_events_url":"https://api.github.com/users/atlv24/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-05-11T16:07:52Z","updated_at":"2025-05-11T16:07:52Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/19122","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/19122/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/19122/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/19122/events","html_url":"https://github.com/bevyengine/bevy/issues/19122","id":3047199454,"node_id":"I_kwDODf6-U861oJLe","number":19122,"title":"Bevy picking fails after camera movment. Picking has wrong positions for entities after camera viewport is moved","user":{"login":"aDecoy","id":17123274,"node_id":"MDQ6VXNlcjE3MTIzMjc0","avatar_url":"https://avatars.githubusercontent.com/u/17123274?v=4","gravatar_id":"","url":"https://api.github.com/users/aDecoy","html_url":"https://github.com/aDecoy","followers_url":"https://api.github.com/users/aDecoy/followers","following_url":"https://api.github.com/users/aDecoy/following{/other_user}","gists_url":"https://api.github.com/users/aDecoy/gists{/gist_id}","starred_url":"https://api.github.com/users/aDecoy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aDecoy/subscriptions","organizations_url":"https://api.github.com/users/aDecoy/orgs","repos_url":"https://api.github.com/users/aDecoy/repos","events_url":"https://api.github.com/users/aDecoy/events{/privacy}","received_events_url":"https://api.github.com/users/aDecoy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":7040334053,"node_id":"LA_kwDODf6-U88AAAABo6L45Q","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Picking","name":"A-Picking","color":"c6A751","default":false,"description":"Pointing at and selecting objects of all sorts"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2025-05-07T21:22:05Z","updated_at":"2025-05-11T16:07:53Z","closed_at":"2025-05-11T16:07:51Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":234798675,"node_id":"MDEwOlJlcG9zaXRvcnkyMzQ3OTg2NzU=","name":"bevy","full_name":"bevyengine/bevy","private":false,"owner":{"login":"bevyengine","id":60047606,"node_id":"MDEyOk9yZ2FuaXphdGlvbjYwMDQ3NjA2","avatar_url":"https://avatars.githubusercontent.com/u/60047606?v=4","gravatar_id":"","url":"https://api.github.com/users/bevyengine","html_url":"https://github.com/bevyengine","followers_url":"https://api.github.com/users/bevyengine/followers","following_url":"https://api.github.com/users/bevyengine/following{/other_user}","gists_url":"https://api.github.com/users/bevyengine/gists{/gist_id}","starred_url":"https://api.github.com/users/bevyengine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bevyengine/subscriptions","organizations_url":"https://api.github.com/users/bevyengine/orgs","repos_url":"https://api.github.com/users/bevyengine/repos","events_url":"https://api.github.com/users/bevyengine/events{/privacy}","received_events_url":"https://api.github.com/users/bevyengine/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bevyengine/bevy","description":"A refreshingly simple data-driven game engine built in Rust","fork":false,"url":"https://api.github.com/repos/bevyengine/bevy","forks_url":"https://api.github.com/repos/bevyengine/bevy/forks","keys_url":"https://api.github.com/repos/bevyengine/bevy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bevyengine/bevy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bevyengine/bevy/teams","hooks_url":"https://api.github.com/repos/bevyengine/bevy/hooks","issue_events_url":"https://api.github.com/repos/bevyengine/bevy/issues/events{/number}","events_url":"https://api.github.com/repos/bevyengine/bevy/events","assignees_url":"https://api.github.com/repos/bevyengine/bevy/assignees{/user}","branches_url":"https://api.github.com/repos/bevyengine/bevy/branches{/branch}","tags_url":"https://api.github.com/repos/bevyengine/bevy/tags","blobs_url":"https://api.github.com/repos/bevyengine/bevy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bevyengine/bevy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bevyengine/bevy/git/refs{/sha}","trees_url":"https://api.github.com/repos/bevyengine/bevy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bevyengine/bevy/statuses/{sha}","languages_url":"https://api.github.com/repos/bevyengine/bevy/languages","stargazers_url":"https://api.github.com/repos/bevyengine/bevy/stargazers","contributors_url":"https://api.github.com/repos/bevyengine/bevy/contributors","subscribers_url":"https://api.github.com/repos/bevyengine/bevy/subscribers","subscription_url":"https://api.github.com/repos/bevyengine/bevy/subscription","commits_url":"https://api.github.com/repos/bevyengine/bevy/commits{/sha}","git_commits_url":"https://api.github.com/repos/bevyengine/bevy/git/commits{/sha}","comments_url":"https://api.github.com/repos/bevyengine/bevy/comments{/number}","issue_comment_url":"https://api.github.com/repos/bevyengine/bevy/issues/comments{/number}","contents_url":"https://api.github.com/repos/bevyengine/bevy/contents/{+path}","compare_url":"https://api.github.com/repos/bevyengine/bevy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bevyengine/bevy/merges","archive_url":"https://api.github.com/repos/bevyengine/bevy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bevyengine/bevy/downloads","issues_url":"https://api.github.com/repos/bevyengine/bevy/issues{/number}","pulls_url":"https://api.github.com/repos/bevyengine/bevy/pulls{/number}","milestones_url":"https://api.github.com/repos/bevyengine/bevy/milestones{/number}","notifications_url":"https://api.github.com/repos/bevyengine/bevy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bevyengine/bevy/labels{/name}","releases_url":"https://api.github.com/repos/bevyengine/bevy/releases{/id}","deployments_url":"https://api.github.com/repos/bevyengine/bevy/deployments","created_at":"2020-01-18T21:13:55Z","updated_at":"2025-11-10T00:30:24Z","pushed_at":"2025-11-09T20:05:46Z","git_url":"git://github.com/bevyengine/bevy.git","ssh_url":"git@github.com:bevyengine/bevy.git","clone_url":"https://github.com/bevyengine/bevy.git","svn_url":"https://github.com/bevyengine/bevy","homepage":"https://bevy.org","size":152673,"stargazers_count":42996,"watchers_count":42996,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":4220,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":3116,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bevy","game-development","game-engine","gamedev","open-source","rust"],"visibility":"public","forks":4220,"open_issues":3116,"watchers":42996,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"# Picking has wrong positions for entities after camera viewport is moved\n\n## Bevy version 0.16.0\n\n## Relevant system information\n\n- cargo 1.86.0 (adf9b6ad1 2025-02-28)\n-  Windows 10, \n\n```\n[package]  \nname = \"bevyHelloWorld\"  \nversion = \"0.1.0\"  \nedition = \"2024\"  \n  \n[dependencies]  \n  \nbevy = { version = \"0.16.0\", features = [\"dynamic_linking\", \"wayland\" ,\"bevy_dev_tools\"] }  \n  \n[profile.dev]  \nopt-level =1  \n\n[profile.dev.package.\"*\"]  \nopt-level = 3\n```\n\nIf your bug is rendering-related, copy the adapter info that appears when you run Bevy.\n\n```ignore\nINFO bevy_render::renderer: AdapterInfo { name: \"AMD Radeon RX 6800 XT\", vendor: 4098, device: 29631, device_type: DiscreteGpu, driver: \"AMD proprietary driver\", driver_info: \"24.12.1 (AMD proprietary shader compiler)\", backend: Vulkan }\n```\n\n## What you did\n\nI have a window and a camera with a viewport + a button that allows me to drag the camera around on the window. The dragging is done with bevy picking (`Trigger<Pointer<Drag>>`). I simply move the camera around. And it only works once. Picking fails to find the button where it is rendered if the camera was moved. \n\nCode to replicate this bug is lower down. \n\n\n## What went wrong\n\nThe first time i draged the button, the camera-moving works fine. \n\nIf the camera was moved away from the start position, it fails the second time.\n- But it is possible to click and drag a \"ghost-button\" that is twice the distance away from the start position.  \n\t- It seems like the magic Picking uses to locate entities based on screen position fails after a camera movment.  \n\n## Pictures\n\nThe blue square is the button i am dragging. Note that the debugging find the correct entity in picture 1, but not in picture 2 after the camera has been draged to the right. Picture 3 shows the \"ghost-button\"\n\n![Image](https://github.com/user-attachments/assets/47a25f76-2fa5-4296-8de1-fceb2420bd1b)\n\n![Image](https://github.com/user-attachments/assets/994fe45c-8f4f-4bb7-8bb5-5bd592dc6c87)\n\n![Image](https://github.com/user-attachments/assets/4d91e454-aeb5-426d-940b-f69095db2517)\n\n(i was not able to upload video, so it might be easiest to run the code and see)\n\n## What i suspect is wrong\n\nI think the Picking is using the distance to the window left edge, instead of to the camera left edge. \nEither that or the distance is being added twice. The ghost button always seems to be about twice the distance away. \n\n\n# Code to replicate bug\n\n\nIt is an extention of the https://github.com/bevyengine/bevy/blob/main/examples/picking/debug_picking.rs example, so it provides a lot of debug info. I changed it to 2d to make things a bit easier. \n\n```rust\n//! A simple scene to demonstrate picking events for UI and mesh entities,  \n//! Demonstrates how to change debug settings  \n  \nuse bevy::color::palettes::basic::BLUE;  \nuse bevy::dev_tools::picking_debug::{DebugPickingMode, DebugPickingPlugin};  \nuse bevy::prelude::*;  \nuse bevy::render::camera::Viewport;  \nuse bevy::window::{PrimaryWindow, WindowResized};  \nuse std::cmp::{max, min};  \n  \nfn main() {  \n    App::new()  \n        .add_plugins(DefaultPlugins.set(bevy::log::LogPlugin {  \n            filter: \"bevy_dev_tools=trace\".into(), // Show picking logs trace level and up  \n            ..default()  \n        }))  \n        .add_plugins((MeshPickingPlugin, DebugPickingPlugin))  \n        .add_systems(Startup, setup_scene)  \n        .insert_resource(DebugPickingMode::Normal)  \n        // A system that cycles the debugging state when you press F3:  \n        .add_systems(  \n            PreUpdate,  \n            (|mut mode: ResMut<DebugPickingMode>| {  \n                *mode = match *mode {  \n                    DebugPickingMode::Disabled => DebugPickingMode::Normal,  \n                    DebugPickingMode::Normal => DebugPickingMode::Noisy,  \n                    DebugPickingMode::Noisy => DebugPickingMode::Disabled,  \n                }  \n            })  \n            .distributive_run_if(bevy::input::common_conditions::input_just_pressed(  \n                KeyCode::F3,  \n            )),  \n        )  \n        .add_systems(  \n            Startup,  \n            spawn_button_for_moving_camera_on_screen_inside_window_button.after(setup_scene),  \n        )  \n        .add_systems(  \n            Update,  \n            (  \n                set_camera_viewports,  \n                adjust_button_for_camera_dragging_on_window_resize,  \n            ),  \n        )  \n        .run();  \n}  \n  \nfn setup_scene(  \n    mut commands: Commands,  \n    mut meshes: ResMut<Assets<Mesh>>,  \n    mut materials: ResMut<Assets<ColorMaterial>>,  \n) {  \n    commands.spawn((  \n        Text::new(\"Click Me to get a box\\nDrag cubes to rotate\\nPress F3 to cycle between picking debug levels\"),  \n        Node {  \n            position_type: PositionType::Absolute,  \n            top: Val::Percent(12.0),  \n            left: Val::Percent(12.0),  \n            ..default()  \n        },  \n    )).observe(on_click_spawn_cube).observe(  \n        |out: Trigger<Pointer<Out>>, mut texts: Query<&mut TextColor>| {  \n            let mut text_color = texts.get_mut(out.target()).unwrap();  \n            text_color.0 = Color::WHITE;  \n        },  \n    ).observe(  \n        |over: Trigger<Pointer<Over>>, mut texts: Query<&mut TextColor>| {  \n            let mut color = texts.get_mut(over.target()).unwrap();  \n            color.0 = bevy::color::palettes::tailwind::CYAN_400.into();  \n        },  \n    );  \n  \n    // Base  \n    commands.spawn((  \n        Name::new(\"Base\"),  \n        Mesh3d(meshes.add(Circle::new(20.0))),  \n        MeshMaterial2d(materials.add(Color::WHITE)),  \n        Transform::from_rotation(Quat::from_rotation_x(-std::f32::consts::FRAC_PI_2)),  \n    ));  \n  \n    // Light  \n    commands.spawn((  \n        PointLight {  \n            shadows_enabled: true,  \n            ..default()  \n        },  \n        Transform::from_xyz(4.0, 8.0, 4.0),  \n    ));  \n  \n    // Camera  \n    commands.spawn((  \n        Camera2d::default(),  \n        Camera {  \n            viewport: Some(Viewport::default()),  \n            ..default()  \n        },  \n    ));  \n}  \n  \nfn set_camera_viewports(  \n    primary_window: Query<&Window, With<PrimaryWindow>>,  \n    mut resize_events: EventReader<WindowResized>,  \n    mut kamera_query: Query<(&mut Camera)>,  \n) {  \n    for resize_event in resize_events.read() {  \n        if let Ok(window) = primary_window.get(resize_event.window) {  \n            let window_size = window.physical_size();  \n            let halv_skjerm_stÃ¸rrelse = UVec2::new(window_size.x / 2, window_size.y);  \n  \n            for (mut camera) in &mut kamera_query {  \n                camera.viewport = Some(Viewport {  \n                    physical_position: UVec2::new(0, 0),  \n                    physical_size: halv_skjerm_stÃ¸rrelse,  \n                    ..default()  \n                });  \n            }  \n        }  \n    }  \n}  \n  \nfn on_click_spawn_cube(  \n    _click: Trigger<Pointer<Click>>,  \n    mut commands: Commands,  \n    mut meshes: ResMut<Assets<Mesh>>,  \n    mut materials: ResMut<Assets<ColorMaterial>>,  \n    mut num: Local<usize>,  \n) {  \n    commands  \n        .spawn((  \n            Mesh2d(meshes.add(Rectangle::new(80.0, 80.0))),  \n            MeshMaterial2d(materials.add(Color::srgb_u8(124, 144, 255))),  \n            Transform::from_xyz(0.0, 0.25 + 81.5 * *num as f32, 0.0),  \n        ))  \n        .observe(on_drag_rotate);  \n    *num += 1;  \n}  \n  \nfn on_drag_rotate(drag: Trigger<Pointer<Drag>>, mut transforms: Query<&mut Transform>) {  \n    if let Ok(mut transform) = transforms.get_mut(drag.target()) {  \n        transform.rotate_y(drag.delta.x * 0.02);  \n        transform.rotate_x(drag.delta.y * 0.02);  \n    }  \n}  \n  \n#[derive(Component)]  \nstruct KameraEdgeMoveCameraInTheWindowDragButtonTag;  \n  \npub fn spawn_button_for_moving_camera_on_screen_inside_window_button(  \n    mut commands: Commands,  \n    mut meshes: ResMut<Assets<Mesh>>,  \n    mut materials: ResMut<Assets<ColorMaterial>>,  \n    kamera_query: Query<(Entity, &Camera), With<Camera>>,  \n) {  \n    let material_handle = materials.add(Color::from(BLUE));  \n  \n    for (kamera_entity, camera) in kamera_query.iter() {  \n        let mut parent_kamera = commands.get_entity(kamera_entity);  \n  \n        parent_kamera.unwrap().with_children(|parent_builder| {  \n            parent_builder  \n                .spawn((  \n                    Mesh2d(meshes.add(Rectangle::new(51.5, 51.5))),  \n                    MeshMaterial2d(material_handle.clone().into()),  \n                    Transform::default(), // will be adjusted on window resize events  \n                    KameraEdgeMoveCameraInTheWindowDragButtonTag,  \n                ))  \n                .observe(drag_camera_around_in_the_window);  \n        });  \n    }  \n}  \n  \nfn drag_camera_around_in_the_window(  \n    drag: Trigger<Pointer<Drag>>,  \n    mut kamera_query: Query<(&mut Camera)>,  \n    primary_window: Query<&Window>,  \n) {  \n    if let Ok(mut camera) = kamera_query.single_mut() {  \n        // println!(\"moving camera in window\");  \n        let window_size = primary_window.single().unwrap().physical_size();  \n  \n        // move viewport  \n        if let Some(viewport) = &mut camera.viewport {  \n            let u32_vektor: &mut UVec2 = &mut viewport.physical_position;  \n            drag_u32_vektor_med_potensielt_negative_i32_verdier(drag, u32_vektor);  \n  \n            u32_vektor.x = min(window_size.x - viewport.physical_size.x, u32_vektor.x);  \n            u32_vektor.y = min(window_size.y - viewport.physical_size.y, u32_vektor.y);  \n        }  \n    }  \n}  \n  \nfn drag_u32_vektor_med_potensielt_negative_i32_verdier(  \n    drag: Trigger<Pointer<Drag>>,  \n    u32_vektor: &mut UVec2,  \n) {  \n    let mut new_x_value = u32_vektor.x as i32;  \n    new_x_value += drag.delta.x as i32;  \n    u32_vektor.x = max(0, new_x_value) as u32;  \n  \n    let mut new_y_value = u32_vektor.y as i32;  \n    new_y_value += drag.delta.y as i32;  \n    u32_vektor.y = max(0, new_y_value) as u32;  \n}  \n  \n/// Because the button is \\\"connected\\\" to camera edges, like a HUD element, instead of being connected to the \"render of the world of entities\", we update translation.  \n/// (it gets a bit stretched away from the camera edge when scaling (adjusting window size) for some reason  Â¯\\_(ãƒ„)_/Â¯ , and I feel like this looks better  \n/// Bug still persist without this system   fn adjust_button_for_camera_dragging_on_window_resize(  \n    kamera_query: Query<  \n        (&Camera, &Children),  \n        (  \n            Changed<Camera>,  \n            Without<KameraEdgeMoveCameraInTheWindowDragButtonTag>,  \n        ),  \n    >,  \n    mut button_query: Query<&mut Transform, With<KameraEdgeMoveCameraInTheWindowDragButtonTag>>,  \n    mut resize_events: EventReader<WindowResized>,  \n) {  \n    // moved it double?  \n    if !resize_events.is_empty() {  \n        println!(\"resizing window => moving HUD button since it is \\\"connected\\\" to camera dimensions, instead of being connected to the render of the world of entities \");  \n  \n        for (camera, barn_marginer) in kamera_query.iter() {  \n            println!(\"updating button transform.translation\");  \n            if let Some(viewport) = &camera.viewport {  \n                let view_dimensions = Vec2 {  \n                    x: viewport.physical_size.x as f32,  \n                    y: viewport.physical_size.y as f32,  \n                };  \n  \n                // camera in top_left_corner has physical positon 0.0. Transform 0.0 is drawn at center of camera  \n                let padding = 100.0;  \n                let venstre_side_x = -(view_dimensions.x * 0.5) + padding;  \n                let hÃ¸yre_side_x = (view_dimensions.x * 0.5) - padding;  \n                let bunn_side_y = -(view_dimensions.y * 0.5) + padding;  \n                for barn_margin_ref in barn_marginer {  \n                    // akkurat nÃ¥ sÃ¥ er knappen alltid nede til hÃ¸yre  \n                    if let Ok((mut transform)) = button_query.get_mut(*barn_margin_ref) {  \n                        transform.translation.x = venstre_side_x;  \n                        transform.translation.y = bunn_side_y;  \n                    }  \n                }  \n            };  \n        }  \n    }  \n}\n```","reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/19122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/19122/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":17624327190,"node_id":"REFE_lADODf6-U86yr7fezwAAAAQafeQW","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17624327190","actor":{"login":"jf908","id":2487520,"node_id":"MDQ6VXNlcjI0ODc1MjA=","avatar_url":"https://avatars.githubusercontent.com/u/2487520?v=4","gravatar_id":"","url":"https://api.github.com/users/jf908","html_url":"https://github.com/jf908","followers_url":"https://api.github.com/users/jf908/followers","following_url":"https://api.github.com/users/jf908/following{/other_user}","gists_url":"https://api.github.com/users/jf908/gists{/gist_id}","starred_url":"https://api.github.com/users/jf908/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jf908/subscriptions","organizations_url":"https://api.github.com/users/jf908/orgs","repos_url":"https://api.github.com/users/jf908/repos","events_url":"https://api.github.com/users/jf908/events{/privacy}","received_events_url":"https://api.github.com/users/jf908/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"73508d01a3f8a7e2b9da216f99ff86813cf42c87","commit_url":"https://api.github.com/repos/jf908/bevy/commits/73508d01a3f8a7e2b9da216f99ff86813cf42c87","created_at":"2025-05-12T21:13:57Z","performed_via_github_app":null},{"id":17698863465,"node_id":"REFE_lADODf6-U86yr7fezwAAAAQe7zlp","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17698863465","actor":{"login":"andrewzhurov","id":13056889,"node_id":"MDQ6VXNlcjEzMDU2ODg5","avatar_url":"https://avatars.githubusercontent.com/u/13056889?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewzhurov","html_url":"https://github.com/andrewzhurov","followers_url":"https://api.github.com/users/andrewzhurov/followers","following_url":"https://api.github.com/users/andrewzhurov/following{/other_user}","gists_url":"https://api.github.com/users/andrewzhurov/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewzhurov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewzhurov/subscriptions","organizations_url":"https://api.github.com/users/andrewzhurov/orgs","repos_url":"https://api.github.com/users/andrewzhurov/repos","events_url":"https://api.github.com/users/andrewzhurov/events{/privacy}","received_events_url":"https://api.github.com/users/andrewzhurov/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"f979a5aa2946304942223846cf9b1e647be8b610","commit_url":"https://api.github.com/repos/andrewzhurov/bevy/commits/f979a5aa2946304942223846cf9b1e647be8b610","created_at":"2025-05-17T11:45:22Z","performed_via_github_app":null},{"id":17872757878,"node_id":"REFE_lADODf6-U86yr7fezwAAAAQpTKR2","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17872757878","actor":{"login":"StrikeForceZero","id":983413,"node_id":"MDQ6VXNlcjk4MzQxMw==","avatar_url":"https://avatars.githubusercontent.com/u/983413?v=4","gravatar_id":"","url":"https://api.github.com/users/StrikeForceZero","html_url":"https://github.com/StrikeForceZero","followers_url":"https://api.github.com/users/StrikeForceZero/followers","following_url":"https://api.github.com/users/StrikeForceZero/following{/other_user}","gists_url":"https://api.github.com/users/StrikeForceZero/gists{/gist_id}","starred_url":"https://api.github.com/users/StrikeForceZero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/StrikeForceZero/subscriptions","organizations_url":"https://api.github.com/users/StrikeForceZero/orgs","repos_url":"https://api.github.com/users/StrikeForceZero/repos","events_url":"https://api.github.com/users/StrikeForceZero/events{/privacy}","received_events_url":"https://api.github.com/users/StrikeForceZero/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"bbe0bdfea928d95ee870323dc6b0625b91047a28","commit_url":"https://api.github.com/repos/StrikeForceZero/bevy/commits/bbe0bdfea928d95ee870323dc6b0625b91047a28","created_at":"2025-05-29T17:54:22Z","performed_via_github_app":null},{"id":17891983894,"node_id":"REFE_lADODf6-U86yr7fezwAAAAQqcgIW","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17891983894","actor":{"login":"mockersf","id":8672791,"node_id":"MDQ6VXNlcjg2NzI3OTE=","avatar_url":"https://avatars.githubusercontent.com/u/8672791?v=4","gravatar_id":"","url":"https://api.github.com/users/mockersf","html_url":"https://github.com/mockersf","followers_url":"https://api.github.com/users/mockersf/followers","following_url":"https://api.github.com/users/mockersf/following{/other_user}","gists_url":"https://api.github.com/users/mockersf/gists{/gist_id}","starred_url":"https://api.github.com/users/mockersf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockersf/subscriptions","organizations_url":"https://api.github.com/users/mockersf/orgs","repos_url":"https://api.github.com/users/mockersf/repos","events_url":"https://api.github.com/users/mockersf/events{/privacy}","received_events_url":"https://api.github.com/users/mockersf/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b4ee8981541618597417851108b232ceb4ff8eca","commit_url":"https://api.github.com/repos/bevyengine/bevy/commits/b4ee8981541618597417851108b232ceb4ff8eca","created_at":"2025-05-30T21:29:20Z","performed_via_github_app":null}]