{"url":"https://api.github.com/repos/bevyengine/bevy/issues/16731","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/16731/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/16731/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/16731/events","html_url":"https://github.com/bevyengine/bevy/issues/16731","id":2727694149,"node_id":"I_kwDODf6-U86ilU9F","number":16731,"title":"Bevy UI nodes are always pixel-aligned and there is no way to disable it","user":{"login":"MatrixDev","id":1215187,"node_id":"MDQ6VXNlcjEyMTUxODc=","avatar_url":"https://avatars.githubusercontent.com/u/1215187?v=4","gravatar_id":"","url":"https://api.github.com/users/MatrixDev","html_url":"https://github.com/MatrixDev","followers_url":"https://api.github.com/users/MatrixDev/followers","following_url":"https://api.github.com/users/MatrixDev/following{/other_user}","gists_url":"https://api.github.com/users/MatrixDev/gists{/gist_id}","starred_url":"https://api.github.com/users/MatrixDev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MatrixDev/subscriptions","organizations_url":"https://api.github.com/users/MatrixDev/orgs","repos_url":"https://api.github.com/users/MatrixDev/repos","events_url":"https://api.github.com/users/MatrixDev/events{/privacy}","received_events_url":"https://api.github.com/users/MatrixDev/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2276469463,"node_id":"MDU6TGFiZWwyMjc2NDY5NDYz","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-UI","name":"A-UI","color":"c6a751","default":false,"description":"Graphical user interfaces, styles, layouts, and widgets"},{"id":3166152189,"node_id":"MDU6TGFiZWwzMTY2MTUyMTg5","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Design","name":"S-Needs-Design","color":"D876E3","default":false,"description":"This issue requires design work to think about how it would best be accomplished"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-12-09T16:52:33Z","updated_at":"2024-12-24T02:58:34Z","closed_at":"2024-12-24T02:58:34Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\n\n- 0.15.0\n\n## \\[Optional\\] Relevant system information\n\n```\n- cargo 1.83.0 (5ffbef321 2024-10-29)\n- MacOS Sonoma 14.1.1 (23B81)\n- SystemInfo { os: \"MacOS 14.1.1 \", kernel: \"23.1.0\", cpu: \"Apple M1 Max\", core_count: \"10\", memory: \"64.0 GiB\" }\n- AdapterInfo { name: \"Apple M1 Max\", vendor: 0, device: 0, device_type: IntegratedGpu, driver: \"\", driver_info: \"\", backend: Metal }\n```\n\n## What you did\n\nMade UI follow 3d entity. Bascially I want to make health bar (and some more info) to stick above/belove each unit.\n\n## What went wrong\n\nIt seams that Bevy UI nodes are always aligned to pixels. This is a good thing for static UI to make it sharper but introduces jaggines when UI is smoothly moved. This is especially noticeable when UI is placed near the object.\n\nI think default behaviour is correct but there should be a way to disable it and allow sub-pixel positions/sizes for UI. It probably should be some component added to the root node or a flag in the `TargetCamera`.\n\n## Additional information\n\nHere is example from the game in question:\n![Image](https://github.com/user-attachments/assets/3d80b4d3-eb3d-41fd-81ae-42df816f0c95)\n\nAs you can see model moves smoothly but green borders and red rect (all are nodes within a single root node) are always jumping here and there. If you just look/focus at the model, it becomes much more noticeable.\n\nUI position is calculated by projecting each corner of the hexagon and taking min/max x/y values:\n```rust\nlet corners = Map::get_layout().hex_corners(agent.hex)\n    .map(|e| e.extend(0.0).xzy())\n    .map(|e| camera.world_to_viewport(camera_transform, e))\n    .map(|e| e.unwrap_or(Vec2::INFINITY));\n\nif corners.iter().any(|e| !e.is_finite()) {\n    continue;\n}\nlet Some((min_x, max_x)) = corners.iter().minmax_by_key(|e| e.x).into_option() else {\n    continue;\n};\nlet Some((min_y, max_y)) = corners.iter().minmax_by_key(|e| e.y).into_option() else {\n    continue;\n};\n\nnode.top = Val::Px(min_y.y);\nnode.left = Val::Px(min_x.x);\nnode.width = Val::Px(max_x.x - min_x.x);\nnode.height = Val::Px(max_y.y - min_y.y);\n```\n\nHere is simpler example:\n![Image](https://github.com/user-attachments/assets/6783b587-9f08-438b-889c-661e07e6eabb)\n\nUI scaling in this case is 2, so it takes half of the logical pixel to see UI moving.","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/16731/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/16731/timeline","performed_via_github_app":null,"state_reason":"completed"}