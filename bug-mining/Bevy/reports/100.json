{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12007","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/12007/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/12007/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/12007/events","html_url":"https://github.com/bevyengine/bevy/issues/12007","id":2144935978,"node_id":"I_kwDODf6-U85_2SAq","number":12007,"title":"Interactivity regression in bevy_ui","user":{"login":"eidloi","id":20684057,"node_id":"MDQ6VXNlcjIwNjg0MDU3","avatar_url":"https://avatars.githubusercontent.com/u/20684057?v=4","gravatar_id":"","url":"https://api.github.com/users/eidloi","html_url":"https://github.com/eidloi","followers_url":"https://api.github.com/users/eidloi/followers","following_url":"https://api.github.com/users/eidloi/following{/other_user}","gists_url":"https://api.github.com/users/eidloi/gists{/gist_id}","starred_url":"https://api.github.com/users/eidloi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eidloi/subscriptions","organizations_url":"https://api.github.com/users/eidloi/orgs","repos_url":"https://api.github.com/users/eidloi/repos","events_url":"https://api.github.com/users/eidloi/events{/privacy}","received_events_url":"https://api.github.com/users/eidloi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2272055247,"node_id":"MDU6TGFiZWwyMjcyMDU1MjQ3","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Input","name":"A-Input","color":"C6A751","default":false,"description":"Player input via keyboard, mouse, gamepad, and more"},{"id":2276469463,"node_id":"MDU6TGFiZWwyMjc2NDY5NDYz","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-UI","name":"A-UI","color":"c6a751","default":false,"description":"Graphical user interfaces, styles, layouts, and widgets"},{"id":2860079228,"node_id":"MDU6TGFiZWwyODYwMDc5MjI4","url":"https://api.github.com/repos/bevyengine/bevy/labels/P-Regression","name":"P-Regression","color":"FF7B00","default":false,"description":"Functionality that used to work but no longer does. Add a test for this!"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bevyengine/bevy/milestones/21","html_url":"https://github.com/bevyengine/bevy/milestone/21","labels_url":"https://api.github.com/repos/bevyengine/bevy/milestones/21/labels","id":10570096,"node_id":"MI_kwDODf6-U84AoUlw","number":21,"title":"0.13.1","description":"","creator":{"login":"cart","id":2694663,"node_id":"MDQ6VXNlcjI2OTQ2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/2694663?v=4","gravatar_id":"","url":"https://api.github.com/users/cart","html_url":"https://github.com/cart","followers_url":"https://api.github.com/users/cart/followers","following_url":"https://api.github.com/users/cart/following{/other_user}","gists_url":"https://api.github.com/users/cart/gists{/gist_id}","starred_url":"https://api.github.com/users/cart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cart/subscriptions","organizations_url":"https://api.github.com/users/cart/orgs","repos_url":"https://api.github.com/users/cart/repos","events_url":"https://api.github.com/users/cart/events{/privacy}","received_events_url":"https://api.github.com/users/cart/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":59,"state":"closed","created_at":"2024-02-16T19:38:53Z","updated_at":"2024-03-18T22:44:09Z","due_on":null,"closed_at":"2024-03-18T22:44:09Z"},"comments":3,"created_at":"2024-02-20T17:45:43Z","updated_at":"2024-03-10T02:33:23Z","closed_at":"2024-03-10T02:33:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\r\n\r\n0.13\r\n\r\n## What you did\r\n\r\nUpgraded to bevy 0.13\r\n\r\n## What went wrong\r\n\r\nAbsolutely positioned UI nodes over regular nodes capture interactivity when they are visible but `Display::None` (but `FocusPolicy::Block`). Issue seems to be from the explicit combination of `Display::None`, and `Visibility::Visible` or `Visibility::Inherited`. The `Display::None` element blocks a rectangle from the top left corner of the window to the top left corner of it's parent. The example below draws three boxes, the gray one changes color when hovered, however the top left corner is not interactive when the red box is `Display::None` and `Visiblity::Visible`. Use the `v` key to toggle visibility and the `d` key to toggle the display property.\r\n\r\n## Additional information\r\n\r\n*might* be related to https://github.com/bevyengine/bevy/pull/10454 or an update on taffy.\r\n\r\n## Reproduce with\r\n\r\n``` rust\r\nuse bevy::prelude::*;\r\n\r\nfn main() {\r\n    App::new().add_plugins(ProblemPlugin).run();\r\n}\r\n\r\npub struct ProblemPlugin;\r\n\r\nimpl Plugin for ProblemPlugin {\r\n    fn build(&self, app: &mut App) {\r\n        app.add_plugins(DefaultPlugins.set(WindowPlugin {\r\n            primary_window: Some(Window {\r\n                resolution: (320., 320.).into(),\r\n                ..default()\r\n            }),\r\n            ..default()\r\n        }))\r\n        .add_systems(Startup, setup)\r\n        .add_systems(Update, (update_bg_on_hover, update_foreground_box));\r\n    }\r\n}\r\n\r\n#[derive(Component)]\r\npub struct MainCamera;\r\n\r\n#[derive(Component)]\r\npub struct BackgroundBox;\r\n\r\n#[derive(Component)]\r\npub struct ForegroundBox;\r\n\r\nfn update_bg_on_hover(\r\n    mut q_node: Query<\r\n        (&mut BackgroundColor, &Interaction),\r\n        (Changed<Interaction>, With<BackgroundBox>),\r\n    >,\r\n) {\r\n    for (mut bg, interaction) in &mut q_node {\r\n        match *interaction {\r\n            Interaction::Pressed => bg.0 = Color::rgb(0.7, 0.7, 0.7),\r\n            Interaction::Hovered => bg.0 = Color::rgb(0.5, 0.7, 0.7),\r\n            Interaction::None => bg.0 = Color::GRAY,\r\n        }\r\n    }\r\n}\r\n\r\nfn update_foreground_box(\r\n    mut q_foreground: Query<(&mut Visibility, &mut Style), With<ForegroundBox>>,\r\n    r_input: Res<ButtonInput<KeyCode>>,\r\n) {\r\n    if r_input.just_pressed(KeyCode::KeyV) {\r\n        let (mut visibility, _) = q_foreground.single_mut();\r\n        *visibility = match *visibility {\r\n            Visibility::Inherited => Visibility::Hidden,\r\n            Visibility::Hidden => Visibility::Visible,\r\n            Visibility::Visible => Visibility::Inherited,\r\n        };\r\n        info!(\"Visibility is now: {:?}\", *visibility);\r\n    }\r\n\r\n    if r_input.just_pressed(KeyCode::KeyD) {\r\n        let (_, mut style) = q_foreground.single_mut();\r\n        style.display = match style.display {\r\n            Display::Flex => Display::None,\r\n            Display::Grid => Display::None,\r\n            Display::None => Display::Flex,\r\n        };\r\n        info!(\"Display is now: {:?}\", style.display);\r\n    }\r\n}\r\n\r\nfn setup(mut commands: Commands) {\r\n    let box_size = 2.0;\r\n    let box_thickness = 0.15;\r\n    let box_offset = (box_size + box_thickness) / 2.0;\r\n\r\n    // ambient light\r\n    commands.insert_resource(AmbientLight {\r\n        color: Color::WHITE,\r\n        brightness: 0.02,\r\n    });\r\n\r\n    commands.spawn(DirectionalLightBundle {\r\n        directional_light: DirectionalLight {\r\n            illuminance: 10000.0,\r\n            ..default()\r\n        },\r\n        transform: Transform::from_rotation(Quat::from_rotation_x(-std::f32::consts::PI / 2.0)),\r\n        ..Default::default()\r\n    });\r\n\r\n    // camera\r\n    commands.spawn((\r\n        Camera3dBundle {\r\n            camera: Camera {\r\n                order: 0,\r\n                ..default()\r\n            },\r\n            transform: Transform::from_xyz(0.0, box_offset, 4.0)\r\n                .looking_at(Vec3::new(0.0, box_offset, 0.0), Vec3::Y),\r\n            ..Default::default()\r\n        },\r\n        MainCamera,\r\n    ));\r\n\r\n    commands\r\n        .spawn(NodeBundle::default())\r\n        .with_children(|builder| {\r\n            builder.spawn((\r\n                NodeBundle {\r\n                    style: Style {\r\n                        position_type: PositionType::Absolute,\r\n                        width: Val::Px(200.),\r\n                        height: Val::Px(200.),\r\n                        ..default()\r\n                    },\r\n                    focus_policy: bevy::ui::FocusPolicy::Block,\r\n                    ..default()\r\n                },\r\n                BackgroundBox,\r\n                Interaction::default(),\r\n            ));\r\n            builder\r\n                .spawn((\r\n                    NodeBundle {\r\n                        style: Style {\r\n                            position_type: PositionType::Absolute,\r\n                            left: Val::Px(100.),\r\n                            top: Val::Px(100.),\r\n                            width: Val::Px(200.),\r\n                            height: Val::Px(200.),\r\n                            ..default()\r\n                        },\r\n                        background_color: Color::DARK_GRAY.into(),\r\n                        focus_policy: bevy::ui::FocusPolicy::Block,\r\n                        ..default()\r\n                    },\r\n                    Interaction::default(),\r\n                ))\r\n                .with_children(|builder| {\r\n                    builder.spawn((\r\n                        NodeBundle {\r\n                            style: Style {\r\n                                position_type: PositionType::Absolute,\r\n                                top: Val::Px(20.),\r\n                                left: Val::Px(20.),\r\n                                width: Val::Px(50.),\r\n                                height: Val::Px(50.),\r\n                                display: Display::None,\r\n                                ..default()\r\n                            },\r\n                            background_color: Color::RED.into(),\r\n                            focus_policy: bevy::ui::FocusPolicy::Block,\r\n                            ..default()\r\n                        },\r\n                        ForegroundBox,\r\n                        Interaction::default(),\r\n                    ));\r\n                });\r\n        });\r\n}\r\n```\r\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12007/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/12007/timeline","performed_via_github_app":null,"state_reason":"completed"}