{"url":"https://api.github.com/repos/bevyengine/bevy/issues/13299","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/13299/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/13299/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/13299/events","html_url":"https://github.com/bevyengine/bevy/issues/13299","id":2287706736,"node_id":"I_kwDODf6-U86IW6Jw","number":13299,"title":"Phantom key presses on window focus change (alt+tab, etc)","user":{"login":"hut","id":90548,"node_id":"MDQ6VXNlcjkwNTQ4","avatar_url":"https://avatars.githubusercontent.com/u/90548?v=4","gravatar_id":"","url":"https://api.github.com/users/hut","html_url":"https://github.com/hut","followers_url":"https://api.github.com/users/hut/followers","following_url":"https://api.github.com/users/hut/following{/other_user}","gists_url":"https://api.github.com/users/hut/gists{/gist_id}","starred_url":"https://api.github.com/users/hut/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hut/subscriptions","organizations_url":"https://api.github.com/users/hut/orgs","repos_url":"https://api.github.com/users/hut/repos","events_url":"https://api.github.com/users/hut/events{/privacy}","received_events_url":"https://api.github.com/users/hut/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2272055247,"node_id":"MDU6TGFiZWwyMjcyMDU1MjQ3","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Input","name":"A-Input","color":"C6A751","default":false,"description":"Player input via keyboard, mouse, gamepad, and more"},{"id":2272060273,"node_id":"MDU6TGFiZWwyMjcyMDYwMjcz","url":"https://api.github.com/repos/bevyengine/bevy/labels/O-Linux","name":"O-Linux","color":"2E6991","default":false,"description":"Specific to the Linux desktop operating system"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-05-09T13:31:07Z","updated_at":"2024-06-17T15:04:23Z","closed_at":"2024-06-17T15:04:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\r\n\r\n0.13.2\r\n\r\n## Relevant system information\r\n\r\nArchLinux with i3wm window manager alongside KDE using X11\r\n\r\n## What you did\r\n\r\nI press Alt+Tab to change focus to my bevy application.\r\n\r\n## What went wrong\r\n\r\nI expected this to change focus to my application, and nothing else.\r\n\r\nWhat happend: It caused a key press event of the TAB key and triggered the application action associated with the TAB key.\r\n\r\nThis happens with any key that is used for focus switching. For example, if I use my window manager's \"alt+w\" key binding to switch to the workspace of the game, it registers as a key press of the \"w\" key, which causes my character to unintentionally move forward.\r\n\r\nWorse yet, those keys get stuck in a \"permanently pressed\" state, triggering the actions forever, until I press the respective key once again.\r\n\r\nThis is driving me crazy as I switch focus back/forth between my bevy application a lot.\r\n\r\n## Additional information / Cause\r\n\r\nThis is caused by bevy erroneously interpreting winit's \"synthetic\" key presses as real key presses.\r\n\r\nIf I add a check for [is_synthetic](https://docs.rs/winit/0.30.0/winit/event/enum.WindowEvent.html#variant.KeyboardInput.field.is_synthetic) in [bevy's winit KeyboardInput event handler](https://github.com/bevyengine/bevy/blob/aa80e2d658ed1b84787fd512839a8c84238979ef/crates/bevy_winit/src/lib.rs#L447):\r\n\r\n```rust\r\nWindowEvent::KeyboardInput { ref event, is_synthetic, .. } => {\r\n    if !is_synthetic {\r\n        if event.state.is_pressed() {\r\n            if let Some(char) = &event.text {\r\n                let char = char.clone();\r\n                app.send_event(ReceivedCharacter { window, char });\r\n            }\r\n        }\r\n        app.send_event(converters::convert_keyboard_input(event, window));\r\n    }\r\n}\r\n```\r\n\r\nthen the phantom key press events disappear in my application.\r\n\r\nThis is likely not the full solution though. While the phantom key **press** events are a clear bug, the phantom key **release** events might serve a purpose and possibly should be exposed. See https://github.com/rust-windowing/winit/issues/3543#issuecomment-1973024673\r\n\r\nIf you decide to not filter out synthetic keys, please at least expose the fact that they are synthetic to the user so we can filter them out ourselves. This would be suboptimal solution, but better than nothing.\r\n\r\n- Relevant winit example: [control_flow](https://github.com/rust-windowing/winit/blob/ab33fb8eda45f9a23587465d787a70a309c67ec4/examples/control_flow.rs) (or any other that responds to key presses)\r\n- Relevant bevy example: [keyboard_input_events](https://github.com/bevyengine/bevy/blob/d9d305dab5b3b7a12a634ea7adb5c5a4c6406ec1/examples/input/keyboard_input_events.rs)\r\n- Relevant winit bug report: https://github.com/rust-windowing/winit/issues/3691\r\n- Relevant winit discussion: https://github.com/rust-windowing/winit/issues/3543\r\n\r\nIf I can help in any way with solving this, don't hesitate to ask.\r\n\r\nThank you.\r\n\r\nP.S. here's an analogous fix in another UI framework: https://github.com/lapce/floem/pull/387","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/13299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/13299/timeline","performed_via_github_app":null,"state_reason":"completed"}