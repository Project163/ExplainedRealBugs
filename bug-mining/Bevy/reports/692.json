{"url":"https://api.github.com/repos/bevyengine/bevy/issues/17924","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/17924/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/17924/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/17924/events","html_url":"https://github.com/bevyengine/bevy/issues/17924","id":2859778569,"node_id":"I_kwDODf6-U86qdMIJ","number":17924,"title":"Add explicit type annotations to debug asserts in Bevy ECS","user":{"login":"K0bin","id":1131720,"node_id":"MDQ6VXNlcjExMzE3MjA=","avatar_url":"https://avatars.githubusercontent.com/u/1131720?v=4","gravatar_id":"","url":"https://api.github.com/users/K0bin","html_url":"https://github.com/K0bin","followers_url":"https://api.github.com/users/K0bin/followers","following_url":"https://api.github.com/users/K0bin/following{/other_user}","gists_url":"https://api.github.com/users/K0bin/gists{/gist_id}","starred_url":"https://api.github.com/users/K0bin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/K0bin/subscriptions","organizations_url":"https://api.github.com/users/K0bin/orgs","repos_url":"https://api.github.com/users/K0bin/repos","events_url":"https://api.github.com/users/K0bin/events{/privacy}","received_events_url":"https://api.github.com/users/K0bin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2488007862,"node_id":"MDU6TGFiZWwyNDg4MDA3ODYy","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Triage","name":"S-Needs-Triage","color":"D876e3","default":false,"description":"This issue needs to be labelled"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-02-18T09:06:36Z","updated_at":"2025-02-22T02:14:51Z","closed_at":"2025-02-22T02:14:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\n\n0.15.1 (I've tried 0.15.2, it happens with that version too.)\n\n## \\[Optional\\] Relevant system information\n\ncargo 1.87.0-nightly (ce948f461 2025-02-14)\nrustc 1.87.0-nightly\n\nI also tried:\n\ncargo 1.84.1 (66221abde 2024-11-19)\nrustc 1.84.1 (e71f9a9a9 2025-01-27)\n\n## What you did\n\nI tried building a crate that has both `bevy_ecs` and `serde_json` as a dependency for `wasm32-unknown-unknown`.\n\n## What went wrong\n\nThe Rust compiler seems to get confused by the fact that both `usize` and `serde_json::value::Value` implement `From<usize>`.\nFor some reason I've only experienced that when building for `wasm32-unknown-unknown`. Building for Linux, Windows or Mac OS doesn't seem to run into this. I really don't know why.\n\n```\nerror[E0283]: type annotations needed\n   --> /home/robin/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/bevy_ecs-0.15.2/src/storage/blob_array.rs:251:58\n    |\n251 |         debug_assert_eq!(self.capacity, current_capacity.into());\n    |                                                          ^^^^\n    |\n    = note: cannot satisfy `_: From<NonZero<usize>>`\n    = note: required for `NonZero<usize>` to implement `Into<_>`\nhelp: try using a fully qualified path to specify the expected types\n    |\n251 -         debug_assert_eq!(self.capacity, current_capacity.into());\n251 +         debug_assert_eq!(self.capacity, <NonZero<usize> as Into<T>>::into(current_capacity));\n    |\n\nerror[E0283]: type annotations needed\n   --> /home/robin/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/bevy_ecs-0.15.2/src/storage/blob_array.rs:251:58\n    |\n251 |         debug_assert_eq!(self.capacity, current_capacity.into());\n    |         -------------------------------------------------^^^^--- type must be known at this point\n    |\n    = note: multiple `impl`s satisfying `usize: PartialEq<_>` found in the following crates: `core`, `serde_json`:\n            - impl PartialEq for usize;\n            - impl PartialEq<serde_json::value::Value> for usize;\nhelp: try using a fully qualified path to specify the expected types\n    |\n251 -         debug_assert_eq!(self.capacity, current_capacity.into());\n251 +         debug_assert_eq!(self.capacity, <NonZero<usize> as Into<T>>::into(current_capacity));\n\nerror[E0283]: type annotations needed\n  --> /home/robin/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/bevy_ecs-0.15.2/src/storage/thin_array_ptr.rs:85:52\n   |\n85 |         assert_eq!(self.capacity, current_capacity.into());\n   |                                                    ^^^^\n   |\n   = note: cannot satisfy `_: From<NonZero<usize>>`\n   = note: required for `NonZero<usize>` to implement `Into<_>`\nhelp: try using a fully qualified path to specify the expected types\n   |\n85 -         assert_eq!(self.capacity, current_capacity.into());\n85 +         assert_eq!(self.capacity, <NonZero<usize> as Into<T>>::into(current_capacity));\n   |\n\nerror[E0283]: type annotations needed\n  --> /home/robin/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/bevy_ecs-0.15.2/src/storage/thin_array_ptr.rs:85:52\n   |\n85 |         assert_eq!(self.capacity, current_capacity.into());\n   |         -------------------------------------------^^^^--- type must be known at this point\n   |\n   = note: multiple `impl`s satisfying `usize: PartialEq<_>` found in the following crates: `core`, `serde_json`:\n           - impl PartialEq for usize;\n           - impl PartialEq<serde_json::value::Value> for usize;\nhelp: try using a fully qualified path to specify the expected types\n   |\n85 -         assert_eq!(self.capacity, current_capacity.into());\n85 +         assert_eq!(self.capacity, <NonZero<usize> as Into<T>>::into(current_capacity));\n   |\n```\n","closed_by":{"login":"mockersf","id":8672791,"node_id":"MDQ6VXNlcjg2NzI3OTE=","avatar_url":"https://avatars.githubusercontent.com/u/8672791?v=4","gravatar_id":"","url":"https://api.github.com/users/mockersf","html_url":"https://github.com/mockersf","followers_url":"https://api.github.com/users/mockersf/followers","following_url":"https://api.github.com/users/mockersf/following{/other_user}","gists_url":"https://api.github.com/users/mockersf/gists{/gist_id}","starred_url":"https://api.github.com/users/mockersf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockersf/subscriptions","organizations_url":"https://api.github.com/users/mockersf/orgs","repos_url":"https://api.github.com/users/mockersf/repos","events_url":"https://api.github.com/users/mockersf/events{/privacy}","received_events_url":"https://api.github.com/users/mockersf/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/17924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/17924/timeline","performed_via_github_app":null,"state_reason":"completed"}