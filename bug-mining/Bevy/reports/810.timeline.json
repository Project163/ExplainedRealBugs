[{"id":13522935468,"node_id":"LE_lADODf6-U86Pu2buzwAAAAMmB56s","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/13522935468","actor":{"login":"SkiFire13","id":9020423,"node_id":"MDQ6VXNlcjkwMjA0MjM=","avatar_url":"https://avatars.githubusercontent.com/u/9020423?v=4","gravatar_id":"","url":"https://api.github.com/users/SkiFire13","html_url":"https://github.com/SkiFire13","followers_url":"https://api.github.com/users/SkiFire13/followers","following_url":"https://api.github.com/users/SkiFire13/following{/other_user}","gists_url":"https://api.github.com/users/SkiFire13/gists{/gist_id}","starred_url":"https://api.github.com/users/SkiFire13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SkiFire13/subscriptions","organizations_url":"https://api.github.com/users/SkiFire13/orgs","repos_url":"https://api.github.com/users/SkiFire13/repos","events_url":"https://api.github.com/users/SkiFire13/events{/privacy}","received_events_url":"https://api.github.com/users/SkiFire13/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-07-16T15:12:06Z","label":{"name":"C-Bug","color":"d73a4a"},"performed_via_github_app":null},{"id":13522935488,"node_id":"LE_lADODf6-U86Pu2buzwAAAAMmB57A","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/13522935488","actor":{"login":"SkiFire13","id":9020423,"node_id":"MDQ6VXNlcjkwMjA0MjM=","avatar_url":"https://avatars.githubusercontent.com/u/9020423?v=4","gravatar_id":"","url":"https://api.github.com/users/SkiFire13","html_url":"https://github.com/SkiFire13","followers_url":"https://api.github.com/users/SkiFire13/followers","following_url":"https://api.github.com/users/SkiFire13/following{/other_user}","gists_url":"https://api.github.com/users/SkiFire13/gists{/gist_id}","starred_url":"https://api.github.com/users/SkiFire13/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SkiFire13/subscriptions","organizations_url":"https://api.github.com/users/SkiFire13/orgs","repos_url":"https://api.github.com/users/SkiFire13/repos","events_url":"https://api.github.com/users/SkiFire13/events{/privacy}","received_events_url":"https://api.github.com/users/SkiFire13/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-07-16T15:12:06Z","label":{"name":"S-Needs-Triage","color":"D876e3"},"performed_via_github_app":null},{"id":13523308609,"node_id":"UE_lADODf6-U86Pu2buzwAAAAMmDVBB","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/13523308609","actor":{"login":"Retrodad0001","id":9283221,"node_id":"MDQ6VXNlcjkyODMyMjE=","avatar_url":"https://avatars.githubusercontent.com/u/9283221?v=4","gravatar_id":"","url":"https://api.github.com/users/Retrodad0001","html_url":"https://github.com/Retrodad0001","followers_url":"https://api.github.com/users/Retrodad0001/followers","following_url":"https://api.github.com/users/Retrodad0001/following{/other_user}","gists_url":"https://api.github.com/users/Retrodad0001/gists{/gist_id}","starred_url":"https://api.github.com/users/Retrodad0001/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Retrodad0001/subscriptions","organizations_url":"https://api.github.com/users/Retrodad0001/orgs","repos_url":"https://api.github.com/users/Retrodad0001/repos","events_url":"https://api.github.com/users/Retrodad0001/events{/privacy}","received_events_url":"https://api.github.com/users/Retrodad0001/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unsubscribed","commit_id":null,"commit_url":null,"created_at":"2024-07-16T15:30:30Z","performed_via_github_app":null},{"id":13536541637,"node_id":"UNLE_lADODf6-U86Pu2buzwAAAAMm1zvF","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/13536541637","actor":{"login":"janhohenheim","id":9047632,"node_id":"MDQ6VXNlcjkwNDc2MzI=","avatar_url":"https://avatars.githubusercontent.com/u/9047632?v=4","gravatar_id":"","url":"https://api.github.com/users/janhohenheim","html_url":"https://github.com/janhohenheim","followers_url":"https://api.github.com/users/janhohenheim/followers","following_url":"https://api.github.com/users/janhohenheim/following{/other_user}","gists_url":"https://api.github.com/users/janhohenheim/gists{/gist_id}","starred_url":"https://api.github.com/users/janhohenheim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janhohenheim/subscriptions","organizations_url":"https://api.github.com/users/janhohenheim/orgs","repos_url":"https://api.github.com/users/janhohenheim/repos","events_url":"https://api.github.com/users/janhohenheim/events{/privacy}","received_events_url":"https://api.github.com/users/janhohenheim/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2024-07-17T13:08:56Z","label":{"name":"S-Needs-Triage","color":"D876e3"},"performed_via_github_app":null},{"id":13536541652,"node_id":"LE_lADODf6-U86Pu2buzwAAAAMm1zvU","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/13536541652","actor":{"login":"janhohenheim","id":9047632,"node_id":"MDQ6VXNlcjkwNDc2MzI=","avatar_url":"https://avatars.githubusercontent.com/u/9047632?v=4","gravatar_id":"","url":"https://api.github.com/users/janhohenheim","html_url":"https://github.com/janhohenheim","followers_url":"https://api.github.com/users/janhohenheim/followers","following_url":"https://api.github.com/users/janhohenheim/following{/other_user}","gists_url":"https://api.github.com/users/janhohenheim/gists{/gist_id}","starred_url":"https://api.github.com/users/janhohenheim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janhohenheim/subscriptions","organizations_url":"https://api.github.com/users/janhohenheim/orgs","repos_url":"https://api.github.com/users/janhohenheim/repos","events_url":"https://api.github.com/users/janhohenheim/events{/privacy}","received_events_url":"https://api.github.com/users/janhohenheim/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-07-17T13:08:56Z","label":{"name":"A-ECS","color":"c6a751"},"performed_via_github_app":null},{"id":13536547630,"node_id":"LE_lADODf6-U86Pu2buzwAAAAMm11Mu","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/13536547630","actor":{"login":"janhohenheim","id":9047632,"node_id":"MDQ6VXNlcjkwNDc2MzI=","avatar_url":"https://avatars.githubusercontent.com/u/9047632?v=4","gravatar_id":"","url":"https://api.github.com/users/janhohenheim","html_url":"https://github.com/janhohenheim","followers_url":"https://api.github.com/users/janhohenheim/followers","following_url":"https://api.github.com/users/janhohenheim/following{/other_user}","gists_url":"https://api.github.com/users/janhohenheim/gists{/gist_id}","starred_url":"https://api.github.com/users/janhohenheim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janhohenheim/subscriptions","organizations_url":"https://api.github.com/users/janhohenheim/orgs","repos_url":"https://api.github.com/users/janhohenheim/repos","events_url":"https://api.github.com/users/janhohenheim/events{/privacy}","received_events_url":"https://api.github.com/users/janhohenheim/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-07-17T13:09:21Z","label":{"name":"C-Usability","color":"b8b8b8"},"performed_via_github_app":null},{"actor":{"login":"Victoronz","id":59878206,"node_id":"MDQ6VXNlcjU5ODc4MjA2","avatar_url":"https://avatars.githubusercontent.com/u/59878206?v=4","gravatar_id":"","url":"https://api.github.com/users/Victoronz","html_url":"https://github.com/Victoronz","followers_url":"https://api.github.com/users/Victoronz/followers","following_url":"https://api.github.com/users/Victoronz/following{/other_user}","gists_url":"https://api.github.com/users/Victoronz/gists{/gist_id}","starred_url":"https://api.github.com/users/Victoronz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Victoronz/subscriptions","organizations_url":"https://api.github.com/users/Victoronz/orgs","repos_url":"https://api.github.com/users/Victoronz/repos","events_url":"https://api.github.com/users/Victoronz/events{/privacy}","received_events_url":"https://api.github.com/users/Victoronz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-09-28T20:40:19Z","updated_at":"2024-09-28T20:40:19Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/15396","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/15396/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/15396/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/15396/events","html_url":"https://github.com/bevyengine/bevy/pull/15396","id":2543353306,"node_id":"PR_kwDODf6-U858aIWN","number":15396,"title":"Let query items borrow from query state to avoid needing to clone","user":{"login":"chescock","id":8494645,"node_id":"MDQ6VXNlcjg0OTQ2NDU=","avatar_url":"https://avatars.githubusercontent.com/u/8494645?v=4","gravatar_id":"","url":"https://api.github.com/users/chescock","html_url":"https://github.com/chescock","followers_url":"https://api.github.com/users/chescock/followers","following_url":"https://api.github.com/users/chescock/following{/other_user}","gists_url":"https://api.github.com/users/chescock/gists{/gist_id}","starred_url":"https://api.github.com/users/chescock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chescock/subscriptions","organizations_url":"https://api.github.com/users/chescock/orgs","repos_url":"https://api.github.com/users/chescock/repos","events_url":"https://api.github.com/users/chescock/events{/privacy}","received_events_url":"https://api.github.com/users/chescock/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2197761682,"node_id":"MDU6TGFiZWwyMTk3NzYxNjgy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-ECS","name":"A-ECS","color":"c6a751","default":false,"description":"Entities, components, systems, and events"},{"id":2272098452,"node_id":"MDU6TGFiZWwyMjcyMDk4NDUy","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Performance","name":"C-Performance","color":"B8B8B8","default":false,"description":"A change motivated by improving speed, memory usage or compile times"},{"id":2747865511,"node_id":"MDU6TGFiZWwyNzQ3ODY1NTEx","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Ready-For-Final-Review","name":"S-Ready-For-Final-Review","color":"D876E3","default":false,"description":"This PR has been approved by the community. It's ready for a maintainer to consider merging it"},{"id":3166133948,"node_id":"MDU6TGFiZWwzMTY2MTMzOTQ4","url":"https://api.github.com/repos/bevyengine/bevy/labels/M-Migration-Guide","name":"M-Migration-Guide","color":"006B75","default":false,"description":"A breaking change to Bevy's public API that needs to be noted in a migration guide"},{"id":3166143717,"node_id":"MDU6TGFiZWwzMTY2MTQzNzE3","url":"https://api.github.com/repos/bevyengine/bevy/labels/D-Complex","name":"D-Complex","color":"008672","default":false,"description":"Quite challenging from either a design or technical perspective. Ask for help!"},{"id":6899552399,"node_id":"LA_kwDODf6-U88AAAABmz7Qjw","url":"https://api.github.com/repos/bevyengine/bevy/labels/X-Contentious","name":"X-Contentious","color":"D93F0B","default":false,"description":"There are nontrivial implications that should be thought through"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2024-09-23T18:27:58Z","updated_at":"2025-06-16T21:27:31Z","closed_at":"2025-06-16T21:27:31Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":234798675,"node_id":"MDEwOlJlcG9zaXRvcnkyMzQ3OTg2NzU=","name":"bevy","full_name":"bevyengine/bevy","private":false,"owner":{"login":"bevyengine","id":60047606,"node_id":"MDEyOk9yZ2FuaXphdGlvbjYwMDQ3NjA2","avatar_url":"https://avatars.githubusercontent.com/u/60047606?v=4","gravatar_id":"","url":"https://api.github.com/users/bevyengine","html_url":"https://github.com/bevyengine","followers_url":"https://api.github.com/users/bevyengine/followers","following_url":"https://api.github.com/users/bevyengine/following{/other_user}","gists_url":"https://api.github.com/users/bevyengine/gists{/gist_id}","starred_url":"https://api.github.com/users/bevyengine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bevyengine/subscriptions","organizations_url":"https://api.github.com/users/bevyengine/orgs","repos_url":"https://api.github.com/users/bevyengine/repos","events_url":"https://api.github.com/users/bevyengine/events{/privacy}","received_events_url":"https://api.github.com/users/bevyengine/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bevyengine/bevy","description":"A refreshingly simple data-driven game engine built in Rust","fork":false,"url":"https://api.github.com/repos/bevyengine/bevy","forks_url":"https://api.github.com/repos/bevyengine/bevy/forks","keys_url":"https://api.github.com/repos/bevyengine/bevy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bevyengine/bevy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bevyengine/bevy/teams","hooks_url":"https://api.github.com/repos/bevyengine/bevy/hooks","issue_events_url":"https://api.github.com/repos/bevyengine/bevy/issues/events{/number}","events_url":"https://api.github.com/repos/bevyengine/bevy/events","assignees_url":"https://api.github.com/repos/bevyengine/bevy/assignees{/user}","branches_url":"https://api.github.com/repos/bevyengine/bevy/branches{/branch}","tags_url":"https://api.github.com/repos/bevyengine/bevy/tags","blobs_url":"https://api.github.com/repos/bevyengine/bevy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bevyengine/bevy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bevyengine/bevy/git/refs{/sha}","trees_url":"https://api.github.com/repos/bevyengine/bevy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bevyengine/bevy/statuses/{sha}","languages_url":"https://api.github.com/repos/bevyengine/bevy/languages","stargazers_url":"https://api.github.com/repos/bevyengine/bevy/stargazers","contributors_url":"https://api.github.com/repos/bevyengine/bevy/contributors","subscribers_url":"https://api.github.com/repos/bevyengine/bevy/subscribers","subscription_url":"https://api.github.com/repos/bevyengine/bevy/subscription","commits_url":"https://api.github.com/repos/bevyengine/bevy/commits{/sha}","git_commits_url":"https://api.github.com/repos/bevyengine/bevy/git/commits{/sha}","comments_url":"https://api.github.com/repos/bevyengine/bevy/comments{/number}","issue_comment_url":"https://api.github.com/repos/bevyengine/bevy/issues/comments{/number}","contents_url":"https://api.github.com/repos/bevyengine/bevy/contents/{+path}","compare_url":"https://api.github.com/repos/bevyengine/bevy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bevyengine/bevy/merges","archive_url":"https://api.github.com/repos/bevyengine/bevy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bevyengine/bevy/downloads","issues_url":"https://api.github.com/repos/bevyengine/bevy/issues{/number}","pulls_url":"https://api.github.com/repos/bevyengine/bevy/pulls{/number}","milestones_url":"https://api.github.com/repos/bevyengine/bevy/milestones{/number}","notifications_url":"https://api.github.com/repos/bevyengine/bevy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bevyengine/bevy/labels{/name}","releases_url":"https://api.github.com/repos/bevyengine/bevy/releases{/id}","deployments_url":"https://api.github.com/repos/bevyengine/bevy/deployments","created_at":"2020-01-18T21:13:55Z","updated_at":"2025-11-10T00:30:24Z","pushed_at":"2025-11-09T20:05:46Z","git_url":"git://github.com/bevyengine/bevy.git","ssh_url":"git@github.com:bevyengine/bevy.git","clone_url":"https://github.com/bevyengine/bevy.git","svn_url":"https://github.com/bevyengine/bevy","homepage":"https://bevy.org","size":152673,"stargazers_count":42996,"watchers_count":42996,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":4220,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":3116,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bevy","game-development","game-engine","gamedev","open-source","rust"],"visibility":"public","forks":4220,"open_issues":3116,"watchers":42996,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/bevyengine/bevy/pulls/15396","html_url":"https://github.com/bevyengine/bevy/pull/15396","diff_url":"https://github.com/bevyengine/bevy/pull/15396.diff","patch_url":"https://github.com/bevyengine/bevy/pull/15396.patch","merged_at":"2025-06-16T21:27:30Z"},"body":"# Objective\r\n\r\nImprove the performance of `FilteredEntity(Ref|Mut)` and `Entity(Ref|Mut)Except`.  \r\n\r\n`FilteredEntityRef` needs an `Access<ComponentId>` to determine what components it can access.  There is one stored in the query state, but query items cannot borrow from the state, so it has to `clone()` the access for each row.  Cloning the access involves memory allocations and can be expensive.  \r\n\r\n\r\n## Solution\r\n\r\nLet query items borrow from their query state.  \r\n\r\nAdd an `'s` lifetime to `WorldQuery::Item` and `WorldQuery::Fetch`, similar to the one in `SystemParam`, and provide `&'s Self::State` to the fetch so that it can borrow from the state.  \r\n\r\nUnfortunately, there are a few cases where we currently return query items from temporary query states: the sorted iteration methods create a temporary state to query the sort keys, and the `EntityRef::components<Q>()` methods create a temporary state for their query.  \r\n\r\nTo allow these to continue to work with most `QueryData` implementations, introduce a new subtrait `ReleaseStateQueryData` that converts a `QueryItem<'w, 's>` to `QueryItem<'w, 'static>`, and is implemented for everything except `FilteredEntity(Ref|Mut)` and `Entity(Ref|Mut)Except`.  \r\n\r\n`#[derive(QueryData)]` will generate `ReleaseStateQueryData` implementations that apply when all of the subqueries implement `ReleaseStateQueryData`.\r\n\r\nThis PR does not actually change the implementation of `FilteredEntity(Ref|Mut)` or `Entity(Ref|Mut)Except`!  That will be done as a follow-up PR so that the changes are easier to review.  I have pushed the changes as chescock/bevy#5.\r\n\r\n## Testing\r\n\r\nI ran performance traces of many_foxes, both against main and against chescock/bevy#5, both including #15282.  These changes do appear to make generalized animation a bit faster: \r\n\r\n(Red is main, yellow is chescock/bevy#5)\r\n![image](https://github.com/user-attachments/assets/de900117-0c6a-431d-ab62-c013834f97a9)\r\n\r\n\r\n## Migration Guide\r\n\r\nThe `WorldQuery::Item` and `WorldQuery::Fetch` associated types and the `QueryItem` and `ROQueryItem` type aliases now have an additional lifetime parameter corresponding to the `'s` lifetime in `Query`.  Manual implementations of `WorldQuery` will need to update the method signatures to include the new lifetimes.  Other uses of the types will need to be updated to include a lifetime parameter, although it can usually be passed as `'_`.  In particular, `ROQueryItem` is used when implementing `RenderCommand`.  \r\n\r\nBefore: \r\n\r\n```rust\r\nfn render<'w>(\r\n    item: &P,\r\n    view: ROQueryItem<'w, Self::ViewQuery>,\r\n    entity: Option<ROQueryItem<'w, Self::ItemQuery>>,\r\n    param: SystemParamItem<'w, '_, Self::Param>,\r\n    pass: &mut TrackedRenderPass<'w>,\r\n) -> RenderCommandResult;\r\n```\r\n\r\nAfter: \r\n\r\n```rust\r\nfn render<'w>(\r\n    item: &P,\r\n    view: ROQueryItem<'w, '_, Self::ViewQuery>,\r\n    entity: Option<ROQueryItem<'w, '_, Self::ItemQuery>>,\r\n    param: SystemParamItem<'w, '_, Self::Param>,\r\n    pass: &mut TrackedRenderPass<'w>,\r\n) -> RenderCommandResult;\r\n```\r\n\r\n---\r\n\r\nMethods on `QueryState` that take `&mut self` may now result in conflicting borrows if the query items capture the lifetime of the mutable reference.  This affects `get()`, `iter()`, and others.  To fix the errors, first call `QueryState::update_archetypes()`, and then replace a call `state.foo(world, param)` with `state.query_manual(world).foo_inner(param)`.  Alternately, you may be able to restructure the code to call `state.query(world)` once and then make multiple calls using the `Query`.  \r\n\r\nBefore:\r\n```rust\r\nlet mut state: QueryState<_, _> = ...;\r\nlet d1 = state.get(world, e1);\r\nlet d2 = state.get(world, e2); // Error: cannot borrow `state` as mutable more than once at a time\r\nprintln!(\"{d1:?}\");\r\nprintln!(\"{d2:?}\");\r\n```\r\n\r\nAfter: \r\n```rust\r\nlet mut state: QueryState<_, _> = ...;\r\n\r\nstate.update_archetypes(world);\r\nlet d1 = state.get_manual(world, e1);\r\nlet d2 = state.get_manual(world, e2);\r\n// OR\r\nstate.update_archetypes(world);\r\nlet d1 = state.query(world).get_inner(e1);\r\nlet d2 = state.query(world).get_inner(e2);\r\n// OR\r\nlet query = state.query(world);\r\nlet d1 = query.get_inner(e1);\r\nlet d1 = query.get_inner(e2);\r\n\r\nprintln!(\"{d1:?}\");\r\nprintln!(\"{d2:?}\");\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/15396/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/15396/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":14442170854,"node_id":"LE_lADODf6-U86Pu2buzwAAAANc0gnm","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/14442170854","actor":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-09-28T20:51:15Z","label":{"name":"S-Ready-For-Implementation","color":"D876E3"},"performed_via_github_app":null},{"id":14442170856,"node_id":"LE_lADODf6-U86Pu2buzwAAAANc0gno","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/14442170856","actor":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-09-28T20:51:15Z","label":{"name":"X-Uncontroversial","color":"d93f0b"},"performed_via_github_app":null},{"id":14442170858,"node_id":"LE_lADODf6-U86Pu2buzwAAAANc0gnq","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/14442170858","actor":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2024-09-28T20:51:15Z","label":{"name":"D-Straightforward","color":"008672"},"performed_via_github_app":null},{"actor":{"login":"chescock","id":8494645,"node_id":"MDQ6VXNlcjg0OTQ2NDU=","avatar_url":"https://avatars.githubusercontent.com/u/8494645?v=4","gravatar_id":"","url":"https://api.github.com/users/chescock","html_url":"https://github.com/chescock","followers_url":"https://api.github.com/users/chescock/followers","following_url":"https://api.github.com/users/chescock/following{/other_user}","gists_url":"https://api.github.com/users/chescock/gists{/gist_id}","starred_url":"https://api.github.com/users/chescock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chescock/subscriptions","organizations_url":"https://api.github.com/users/chescock/orgs","repos_url":"https://api.github.com/users/chescock/repos","events_url":"https://api.github.com/users/chescock/events{/privacy}","received_events_url":"https://api.github.com/users/chescock/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2025-03-10T18:16:42Z","updated_at":"2025-03-10T18:16:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/18236","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/18236/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/18236/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/18236/events","html_url":"https://github.com/bevyengine/bevy/pull/18236","id":2908068744,"node_id":"PR_kwDODf6-U86OCWaL","number":18236,"title":"Let `FilteredEntity(Ref|Mut)` receive access when nested.","user":{"login":"chescock","id":8494645,"node_id":"MDQ6VXNlcjg0OTQ2NDU=","avatar_url":"https://avatars.githubusercontent.com/u/8494645?v=4","gravatar_id":"","url":"https://api.github.com/users/chescock","html_url":"https://github.com/chescock","followers_url":"https://api.github.com/users/chescock/followers","following_url":"https://api.github.com/users/chescock/following{/other_user}","gists_url":"https://api.github.com/users/chescock/gists{/gist_id}","starred_url":"https://api.github.com/users/chescock/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chescock/subscriptions","organizations_url":"https://api.github.com/users/chescock/orgs","repos_url":"https://api.github.com/users/chescock/repos","events_url":"https://api.github.com/users/chescock/events{/privacy}","received_events_url":"https://api.github.com/users/chescock/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":1795619326,"node_id":"MDU6TGFiZWwxNzk1NjE5MzI2","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Feature","name":"C-Feature","color":"b8b8b8","default":false,"description":"A new feature, making something new possible"},{"id":2197761682,"node_id":"MDU6TGFiZWwyMTk3NzYxNjgy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-ECS","name":"A-ECS","color":"c6a751","default":false,"description":"Entities, components, systems, and events"},{"id":2747865511,"node_id":"MDU6TGFiZWwyNzQ3ODY1NTEx","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Ready-For-Final-Review","name":"S-Ready-For-Final-Review","color":"D876E3","default":false,"description":"This PR has been approved by the community. It's ready for a maintainer to consider merging it"},{"id":3166143717,"node_id":"MDU6TGFiZWwzMTY2MTQzNzE3","url":"https://api.github.com/repos/bevyengine/bevy/labels/D-Complex","name":"D-Complex","color":"008672","default":false,"description":"Quite challenging from either a design or technical perspective. Ask for help!"},{"id":6899549740,"node_id":"LA_kwDODf6-U88AAAABmz7GLA","url":"https://api.github.com/repos/bevyengine/bevy/labels/X-Uncontroversial","name":"X-Uncontroversial","color":"d93f0b","default":false,"description":"This work is generally agreed upon"},{"id":6899583116,"node_id":"LA_kwDODf6-U88AAAABmz9IjA","url":"https://api.github.com/repos/bevyengine/bevy/labels/D-Unsafe","name":"D-Unsafe","color":"008672","default":false,"description":"Touches with unsafe code in some way"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bevyengine/bevy/milestones/32","html_url":"https://github.com/bevyengine/bevy/milestone/32","labels_url":"https://api.github.com/repos/bevyengine/bevy/milestones/32/labels","id":12377016,"node_id":"MI_kwDODf6-U84AvNu4","number":32,"title":"0.17","description":"","creator":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":584,"state":"closed","created_at":"2025-02-24T21:56:04Z","updated_at":"2025-09-30T22:33:43Z","due_on":null,"closed_at":"2025-09-30T22:33:43Z"},"comments":2,"created_at":"2025-03-10T18:16:41Z","updated_at":"2025-05-05T23:42:37Z","closed_at":"2025-05-05T23:42:37Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":234798675,"node_id":"MDEwOlJlcG9zaXRvcnkyMzQ3OTg2NzU=","name":"bevy","full_name":"bevyengine/bevy","private":false,"owner":{"login":"bevyengine","id":60047606,"node_id":"MDEyOk9yZ2FuaXphdGlvbjYwMDQ3NjA2","avatar_url":"https://avatars.githubusercontent.com/u/60047606?v=4","gravatar_id":"","url":"https://api.github.com/users/bevyengine","html_url":"https://github.com/bevyengine","followers_url":"https://api.github.com/users/bevyengine/followers","following_url":"https://api.github.com/users/bevyengine/following{/other_user}","gists_url":"https://api.github.com/users/bevyengine/gists{/gist_id}","starred_url":"https://api.github.com/users/bevyengine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bevyengine/subscriptions","organizations_url":"https://api.github.com/users/bevyengine/orgs","repos_url":"https://api.github.com/users/bevyengine/repos","events_url":"https://api.github.com/users/bevyengine/events{/privacy}","received_events_url":"https://api.github.com/users/bevyengine/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bevyengine/bevy","description":"A refreshingly simple data-driven game engine built in Rust","fork":false,"url":"https://api.github.com/repos/bevyengine/bevy","forks_url":"https://api.github.com/repos/bevyengine/bevy/forks","keys_url":"https://api.github.com/repos/bevyengine/bevy/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bevyengine/bevy/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bevyengine/bevy/teams","hooks_url":"https://api.github.com/repos/bevyengine/bevy/hooks","issue_events_url":"https://api.github.com/repos/bevyengine/bevy/issues/events{/number}","events_url":"https://api.github.com/repos/bevyengine/bevy/events","assignees_url":"https://api.github.com/repos/bevyengine/bevy/assignees{/user}","branches_url":"https://api.github.com/repos/bevyengine/bevy/branches{/branch}","tags_url":"https://api.github.com/repos/bevyengine/bevy/tags","blobs_url":"https://api.github.com/repos/bevyengine/bevy/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bevyengine/bevy/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bevyengine/bevy/git/refs{/sha}","trees_url":"https://api.github.com/repos/bevyengine/bevy/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bevyengine/bevy/statuses/{sha}","languages_url":"https://api.github.com/repos/bevyengine/bevy/languages","stargazers_url":"https://api.github.com/repos/bevyengine/bevy/stargazers","contributors_url":"https://api.github.com/repos/bevyengine/bevy/contributors","subscribers_url":"https://api.github.com/repos/bevyengine/bevy/subscribers","subscription_url":"https://api.github.com/repos/bevyengine/bevy/subscription","commits_url":"https://api.github.com/repos/bevyengine/bevy/commits{/sha}","git_commits_url":"https://api.github.com/repos/bevyengine/bevy/git/commits{/sha}","comments_url":"https://api.github.com/repos/bevyengine/bevy/comments{/number}","issue_comment_url":"https://api.github.com/repos/bevyengine/bevy/issues/comments{/number}","contents_url":"https://api.github.com/repos/bevyengine/bevy/contents/{+path}","compare_url":"https://api.github.com/repos/bevyengine/bevy/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bevyengine/bevy/merges","archive_url":"https://api.github.com/repos/bevyengine/bevy/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bevyengine/bevy/downloads","issues_url":"https://api.github.com/repos/bevyengine/bevy/issues{/number}","pulls_url":"https://api.github.com/repos/bevyengine/bevy/pulls{/number}","milestones_url":"https://api.github.com/repos/bevyengine/bevy/milestones{/number}","notifications_url":"https://api.github.com/repos/bevyengine/bevy/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bevyengine/bevy/labels{/name}","releases_url":"https://api.github.com/repos/bevyengine/bevy/releases{/id}","deployments_url":"https://api.github.com/repos/bevyengine/bevy/deployments","created_at":"2020-01-18T21:13:55Z","updated_at":"2025-11-10T00:30:24Z","pushed_at":"2025-11-09T20:05:46Z","git_url":"git://github.com/bevyengine/bevy.git","ssh_url":"git@github.com:bevyengine/bevy.git","clone_url":"https://github.com/bevyengine/bevy.git","svn_url":"https://github.com/bevyengine/bevy","homepage":"https://bevy.org","size":152673,"stargazers_count":42996,"watchers_count":42996,"language":"Rust","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":4220,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":3116,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bevy","game-development","game-engine","gamedev","open-source","rust"],"visibility":"public","forks":4220,"open_issues":3116,"watchers":42996,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/bevyengine/bevy/pulls/18236","html_url":"https://github.com/bevyengine/bevy/pull/18236","diff_url":"https://github.com/bevyengine/bevy/pull/18236.diff","patch_url":"https://github.com/bevyengine/bevy/pull/18236.patch","merged_at":"2025-05-05T23:42:36Z"},"body":"# Objective\r\n\r\nLet `FilteredEntityRef` and `FilteredEntityMut` receive access when nested inside tuples or `#[derive(QueryData)]` types.  Make sure to exclude any access that would conflict with other subqueries!  \r\n\r\nFixes #14349\r\n\r\n## Solution\r\n\r\nReplace `WorldQuery::set_access(state, access)` with a new method, `QueryData::provide_extra_access(state, access, available_access)`, that passes both the total available access and the currently used access.  This is called after `WorldQuery::update_component_access()`, so any access used by ordinary subqueries will be known.  `FilteredEntityRef` and `FilteredEntityMut` can use the combination to determine how much access they can safely take, while tuples can safely pass those parameters directly to their subqueries.  \r\n\r\nThis requires a new `Access::remove_conflicting_access()` method that can be used to remove any access that would conflict with existing access.  Implementing this method was easier by first factoring some common set manipulation code out of `Access::extend`.  I can extract that refactoring to a separate PR if desired.  \r\n\r\nHave `FilteredEntity(Ref|Mut)` store `Access` instead of `FilteredAccess` because they do not need to keep track of the filter.  This was necessary in an early draft but no longer is.  I left it in because it's small and I'm touching that code anyway, but I can extract it to a separate PR if desired.  \r\n","reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/18236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/18236/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":17527762898,"node_id":"REFE_lADODf6-U86Pu2buzwAAAAQUvG_S","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17527762898","actor":{"login":"github-merge-queue[bot]","id":118344674,"node_id":"BOT_kgDOBw3L4g","avatar_url":"https://avatars.githubusercontent.com/u/9919?v=4","gravatar_id":"","url":"https://api.github.com/users/github-merge-queue%5Bbot%5D","html_url":"https://github.com/apps/github-merge-queue","followers_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-merge-queue%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"bea0a0a9bc37c66c8495bdee7247fc53dbbf07f1","commit_url":"https://api.github.com/repos/bevyengine/bevy/commits/bea0a0a9bc37c66c8495bdee7247fc53dbbf07f1","created_at":"2025-05-05T23:42:37Z","performed_via_github_app":null},{"id":17527763026,"node_id":"CE_lADODf6-U86Pu2buzwAAAAQUvHBS","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17527763026","actor":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2025-05-05T23:42:38Z","state_reason":null,"performed_via_github_app":null},{"id":17698864297,"node_id":"REFE_lADODf6-U86Pu2buzwAAAAQe7zyp","url":"https://api.github.com/repos/bevyengine/bevy/issues/events/17698864297","actor":{"login":"andrewzhurov","id":13056889,"node_id":"MDQ6VXNlcjEzMDU2ODg5","avatar_url":"https://avatars.githubusercontent.com/u/13056889?v=4","gravatar_id":"","url":"https://api.github.com/users/andrewzhurov","html_url":"https://github.com/andrewzhurov","followers_url":"https://api.github.com/users/andrewzhurov/followers","following_url":"https://api.github.com/users/andrewzhurov/following{/other_user}","gists_url":"https://api.github.com/users/andrewzhurov/gists{/gist_id}","starred_url":"https://api.github.com/users/andrewzhurov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrewzhurov/subscriptions","organizations_url":"https://api.github.com/users/andrewzhurov/orgs","repos_url":"https://api.github.com/users/andrewzhurov/repos","events_url":"https://api.github.com/users/andrewzhurov/events{/privacy}","received_events_url":"https://api.github.com/users/andrewzhurov/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"8ed896ba01f629d17d1e862887aea9f608195ec5","commit_url":"https://api.github.com/repos/andrewzhurov/bevy/commits/8ed896ba01f629d17d1e862887aea9f608195ec5","created_at":"2025-05-17T11:45:27Z","performed_via_github_app":null}]