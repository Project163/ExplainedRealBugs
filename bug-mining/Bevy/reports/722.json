{"url":"https://api.github.com/repos/bevyengine/bevy/issues/15460","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/15460/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/15460/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/15460/events","html_url":"https://github.com/bevyengine/bevy/issues/15460","id":2551692639,"node_id":"I_kwDODf6-U86YF71f","number":15460,"title":"Tracking Issue: MVP `no_std` Bevy","user":{"login":"bushrat011899","id":2217286,"node_id":"MDQ6VXNlcjIyMTcyODY=","avatar_url":"https://avatars.githubusercontent.com/u/2217286?v=4","gravatar_id":"","url":"https://api.github.com/users/bushrat011899","html_url":"https://github.com/bushrat011899","followers_url":"https://api.github.com/users/bushrat011899/followers","following_url":"https://api.github.com/users/bushrat011899/following{/other_user}","gists_url":"https://api.github.com/users/bushrat011899/gists{/gist_id}","starred_url":"https://api.github.com/users/bushrat011899/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bushrat011899/subscriptions","organizations_url":"https://api.github.com/users/bushrat011899/orgs","repos_url":"https://api.github.com/users/bushrat011899/repos","events_url":"https://api.github.com/users/bushrat011899/events{/privacy}","received_events_url":"https://api.github.com/users/bushrat011899/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619326,"node_id":"MDU6TGFiZWwxNzk1NjE5MzI2","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Feature","name":"C-Feature","color":"b8b8b8","default":false,"description":"A new feature, making something new possible"},{"id":2272067174,"node_id":"MDU6TGFiZWwyMjcyMDY3MTc0","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Dependencies","name":"C-Dependencies","color":"b8b8b8","default":false,"description":"A change to the crates that Bevy depends on"},{"id":3166089161,"node_id":"MDU6TGFiZWwzMTY2MDg5MTYx","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Tracking-Issue","name":"C-Tracking-Issue","color":"b8b8b8","default":false,"description":"An issue that collects information about a broad development initiative"},{"id":6732472809,"node_id":"LA_kwDODf6-U88AAAABkUlh6Q","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Cross-Cutting","name":"A-Cross-Cutting","color":"c6A751","default":false,"description":"Impacts the entire engine"},{"id":6899552399,"node_id":"LA_kwDODf6-U88AAAABmz7Qjw","url":"https://api.github.com/repos/bevyengine/bevy/labels/X-Contentious","name":"X-Contentious","color":"D93F0B","default":false,"description":"There are nontrivial implications that should be thought through"},{"id":6899576022,"node_id":"LA_kwDODf6-U88AAAABmz8s1g","url":"https://api.github.com/repos/bevyengine/bevy/labels/D-Modest","name":"D-Modest","color":"008672","default":false,"description":"A \"normal\" level of difficulty; suitable for simple features or challenging fixes"},{"id":7945730867,"node_id":"LA_kwDODf6-U88AAAAB2Zo7Mw","url":"https://api.github.com/repos/bevyengine/bevy/labels/O-Embedded","name":"O-Embedded","color":"2E6991","default":false,"description":"Weird hardware and no_std platforms"}],"state":"closed","locked":false,"assignee":{"login":"bushrat011899","id":2217286,"node_id":"MDQ6VXNlcjIyMTcyODY=","avatar_url":"https://avatars.githubusercontent.com/u/2217286?v=4","gravatar_id":"","url":"https://api.github.com/users/bushrat011899","html_url":"https://github.com/bushrat011899","followers_url":"https://api.github.com/users/bushrat011899/followers","following_url":"https://api.github.com/users/bushrat011899/following{/other_user}","gists_url":"https://api.github.com/users/bushrat011899/gists{/gist_id}","starred_url":"https://api.github.com/users/bushrat011899/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bushrat011899/subscriptions","organizations_url":"https://api.github.com/users/bushrat011899/orgs","repos_url":"https://api.github.com/users/bushrat011899/repos","events_url":"https://api.github.com/users/bushrat011899/events{/privacy}","received_events_url":"https://api.github.com/users/bushrat011899/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bushrat011899","id":2217286,"node_id":"MDQ6VXNlcjIyMTcyODY=","avatar_url":"https://avatars.githubusercontent.com/u/2217286?v=4","gravatar_id":"","url":"https://api.github.com/users/bushrat011899","html_url":"https://github.com/bushrat011899","followers_url":"https://api.github.com/users/bushrat011899/followers","following_url":"https://api.github.com/users/bushrat011899/following{/other_user}","gists_url":"https://api.github.com/users/bushrat011899/gists{/gist_id}","starred_url":"https://api.github.com/users/bushrat011899/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bushrat011899/subscriptions","organizations_url":"https://api.github.com/users/bushrat011899/orgs","repos_url":"https://api.github.com/users/bushrat011899/repos","events_url":"https://api.github.com/users/bushrat011899/events{/privacy}","received_events_url":"https://api.github.com/users/bushrat011899/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":21,"created_at":"2024-09-26T23:32:39Z","updated_at":"2025-03-07T03:56:50Z","closed_at":"2025-03-07T03:56:50Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":4,"completed":2,"percent_completed":50},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"This is a tracking issue for progress on a `no_std` compatible subset of `Bevy`. The tasks are ordered roughly in sequence (`bevy_app` can't be `no_std` until `bevy_ecs` is for example).\n\n# Overview\n\nBelow is a visualisation of the crates planned to be ported to `no_std`. Edges indicate the primary blocker for a crate being ported. The ðŸš§ symbol indicates that this crate is in-progress, while âœ… indicates it is now available in `no_std`.\n\n```mermaid\ngraph TD;\n    bevy_a11y[bevy_a11y âœ…]\n    bevy_app[bevy_app âœ…]\n    bevy_asset\n    bevy_color[bevy_color âœ…]\n    bevy_core[bevy_core* âœ…]\n    bevy_diagnostic[bevy_diagnostic âœ…]\n    bevy_ecs[bevy_ecs âœ…]\n    bevy_hierarchy[bevy_hierarchy* âœ…]\n    bevy_input[bevy_input âœ…]\n    bevy_input_focus[bevy_input_focus âœ…]\n    bevy_math[bevy_math âœ…]\n    bevy_mikktspace[bevy_mikktspace âœ…]\n    bevy_ptr[bevy_ptr âœ…]\n    bevy_reflect[bevy_reflectâœ…]\n    bevy_state[bevy_state âœ…]\n    bevy_tasks[bevy_tasks âœ…]\n    bevy_time[bevy_time âœ…]\n    bevy_transform[bevy_transform âœ…]\n    bevy_utils[bevy_utils âœ…]\n    bevy_window[bevy_window âœ…]\n\n    bevy_ptr-->bevy_ecs;\n\n    bevy_utils-->bevy_ecs;\n\n    bevy_tasks-->bevy_ecs;\n\n    bevy_ecs-->bevy_app;\n\n    bevy_app-->bevy_core;\n    bevy_app-->bevy_a11y;\n    bevy_app-->bevy_asset;\n    bevy_app-->bevy_time;\n    bevy_app-->bevy_log;\n\n    bevy_core-->bevy_input;\n    bevy_core-->bevy_diagnostic;\n    bevy_core-->bevy_hierarchy;\n    \n    bevy_asset-->bevy_image;\n    bevy_asset-->bevy_scene;\n\n    bevy_color-->bevy_image;\n\n    bevy_mikktspace-->bevy_mesh;\n\n    bevy_hierarchy-->bevy_remote;\n    bevy_hierarchy-->bevy_state;\n    bevy_hierarchy-->bevy_transform;\n    bevy_hierarchy-->bevy_input_focus;\n\n    bevy_transform-->bevy_mesh;\n    bevy_transform-->bevy_scene;\n    \n    bevy_math-->bevy_input;\n    bevy_math-->bevy_color;\n\n    bevy_input-->bevy_window;\n\n    bevy_input_focus-->bevy_a11y;\n\n    bevy_window-->bevy_input_focus;\n\n    bevy_reflect-->bevy_ecs;\n\n    bevy_image-->bevy_mesh;\n```\n\n# Core Tasks\n\nThese tasks _must_ be completed for a `no_std` Bevy to become usable at all.\n\n## Prerequisites âœ…\n\n- #15281\n\n## `bevy_ptr` âœ…\n\nDone prior to initiative.\n\n## `bevy_utils` âœ…\n\n- #15463\n\nProvide an appropriate `Instant` type which can be controlled by the user in `no_std` contexts, or avoid its use. Move `web-time` into `wasm32`-only dependencies (doesn't need to exist outside web anyway!). Make `thread_local` optional.\n\nDone!\n\n## `bevy_tasks` âœ…\n \n- #15464\n\nDone!\n\n## `bevy_macro_utils` âœ…\n\n- #15465\n\nUpdate `derive_label` to use `Box` from `alloc` (requires wrapping the quoted `impl` in a `const _: () = { ... }` so that `extern crate alloc` wont conflict with the outer namespace).\n\nDone!\n\n## `bevy_ecs` âœ…\n\n- #15519\n- #15774 \n- #16758\n\nDone!\n\n## `bevy_app` âœ…\n\n- #15779 \n- #16874\n\nMerged!\n\n## `bevy_core`[^1]  âœ…\n\n- #16897\n\nMerged!\n\n[^1]: `bevy_core` has been removed, effectively resolving its `no_std` compatibility.\n\n## `bevy_internal` / `bevy`\n\n- Thread `std` / `alloc` features from sub-crates through to the final `bevy` crate.\n\nBlocked on `bevy_core`.\n\n## CI ðŸš§\n\n- #15843 \n- Once the other core tasks are completed, a `no_std` example should be created and tested in CI as well.\n\n# Bonus Features\n\nThese tasks aren't strictly required, but _should_ be completed to close the gap between `no_std` and `std` Bevy. The more functionality we can provide in `no_std`, the more the community can develop for it.\n\n## `bevy_a11y` âœ…\n\n- #17505\n\nDone!\n\nThis crate ~~is~~ _was_ blocked on [AccessKit's](https://crates.io/crates/accesskit) lack of `no_std` support. @DataTriny pointed out AccessKit 0.17 now supports `no_std`! This should now be quite straightforward to add `no_std` support to once the other internal blockers are resolved (`bevy_app`, etc.)\n\n## `bevy_asset`\n\n- #15778\n\nReliance on filesystem operations will make this interesting, but a lot of the asset functionality exists outside of files and folders (processing, etc.). It's reasonable to consider that a `no_std` platform could have a custom `AssetSource` (and accompanying `AssetReader`/`Writer`/etc.).\n\n## `bevy_color` âœ…\n\n- #16633\n- #15777\n\nDone!\n\n## `bevy_derive`\n\nShould work as-is, but need to test.\n\n## `bevy_diagnostic` âœ…\n\n- #17507\n\nDone!\n\n## `bevy_hierarchy`[^2] âœ…\n\n[^2]: `bevy_hierarchy` has been removed since its port.\n\n- #16998\n\nMerged!\n\n## `bevy_image`\n\n- #15771\n\nBlocked on `bevy_asset`. Would also require some substantial feature-gating to isolate out the `no_std` compatible subset.\n\n## `bevy_input` âœ…\n\n- #15770\n- #16995\n\nAwaiting merge.\n\n## `bevy_input_focus` âœ…\n\n- #17490\n\nDone!\n\n## `bevy_log`\n\nBlocked on `bevy_ecs`.\n\n## `bevy_math` âœ…\n\n- #15810\n- #15769\n\nDone!\n\n## `bevy_mesh`\n\n- #15768\n\nBlocked on `bevy_image`, `bevy_transform`, and [`hexasphere`](https://crates.io/crates/hexasphere). `hexasphere` would need upstream changes, but on a first-glance looks like to _could_ be `no_std`.\n\n## `bevy_mikktspace` âœ…\n\n- #15528\n\nDone!\n\n## `bevy_reflect` âœ…\n\n- #16256\n- #15766\n\nDone!\n\n## `bevy_remote`\n\nBlocked on `bevy_hierarchy` and a design. Currently built around networking, but _could_ support serial commands instead, and would make debugging on embedded _much_ easier too.\n\n## `bevy_scene`\n\n- #15764\n\nBlocked on `bevy_hierarchy` and `bevy_asset`.\n\n## `bevy_state` âœ…\n\n- #17028\n\nDone!\n\n## `bevy_time` âœ…\n\n- #15759\n- #17491\n\nDone!\n\n## `bevy_transform` âœ…\n\n- #15761\n- #17030\n\nMerged!\n\n## `bevy_window` âœ…\n\n- #17031\n\nMerged!\n\n# Not Planned\n\nThese crates _can't_ be ported to `no_std` because they are highly platform specific. If you see something on this list that _could_ be ported, please let me know!\n\n## `bevy_animation` âš \n\nBlocked by `bevy_render`.\n\n- #15780\n- Replace `petgraph` with a `no_std` compatible alternative.\n\nCurrently only using the `DiGraph` type with no edge data and only a single node type `AnimationGraphNode` (and a serializable alternate `SerializedAnimationGraphNode`). \n\n## `bevy_audio` âš \n\nCurrently undergoing a major re-write so this is subject to change. I suspect even with the re-write `no_std` support would be blocked on a fundamental dependency such as `cpal`. Like rendering, audio is very platform dependent so there likely isn't a viable API Bevy could provide that would be simultaneously feature-rich enough for use on common platforms (PC, etc.) while being low-level enough for `no_std` ones too. \n\n## `bevy_core_pipeline` âš \n\n- #15775\n\nBlocked by `bevy_render`. \n\n## `bevy_dev_tools` âš \n\nBlocked by `bevy_render`.\n\n## `bevy_dylib` âš \n\nUnfamiliar with the dynamic linking this crate provides. I don't see any reason why it couldn't be supported in `no_std`, but I would definitely require an SME to assist with getting it working.\n\n## `bevy_encase_derive` âš \n\nExclusively used with [`encase`](https://crates.io/crates/encase), which is a part of the rendering side of Bevy.\n\n## `bevy_gilrs` âš \n\n- #15773\n \nBuilt around [`gilrs`](https://crates.io/crates/gilrs) which does not currently have any `no_std` support. There _might_ be a way to upstream `no_std` support by relying on something like `SDL`, but I'm not familiar enough with the project to make a fair assessment on the viability here. \n \n## `bevy_gizmos` âš \n\nBlocked by `bevy_render`.\n\n## `bevy_gltf` âš \n\n- #15772 \n\nBlocked by `bevy_render`. It _may_ make sense to find a way to break this dependency, since `gLTF` can be used independently of `wgpu` (e.g., with a user-created OpenGL renderer backend), but this would need an SME for sure.\n\n## `bevy_pbr` âš \n\n- #15767\n\nBlocked by `bevy_render` and `wgpu`. Without support for WGSL shaders there's no real point in having this crate supported in `no_std`.\n\n## `bevy_render` âš \n\n- #15765\n\nMassive crate very deeply integrated with `wgpu`, which is not just `std` reliant, but also platform dependent too. I don't think it will ever make sense to have a `no_std` `bevy_render`. _Maybe_ could have value in splitting out some abstractions, but I don't know.\n\n## `bevy_sprite` âš \n\n- #15763\n\nBlocked on `bevy_render`.\n\n## `bevy_text` âš \n\n- #15762\n\nBlocked on `bevy_render`.\n\n## `bevy_ui` âš \n\n- #15760\n\nBlocked on `bevy_render`.\n\n## `bevy_winit` âš \n\nBlocked on [`winit`](https://crates.io/crates/winit). Likely couldn't be made `no_std` upstream either since it's entirely platform dependent.\n\n# General Notes\n\n## `thiserror`\n\n_Note: this is now outdated, as `thiserror` version 2 includes `no_std` support and is now publicly available._\n\n`thiserror` is currently not available in a `no_std` form due to its use of the `::std::error::Error` path for `Error` (which it continues to use for MSRV backwards compatibility). There is a [PR](https://github.com/dtolnay/thiserror/pull/304) to add `no_std` support to `thiserror` which preserves that MSRV requirement, but it's unclear if/when that will be merged and released.\n\nOne alternative is to link against the PR instead of the published version of `thiserror`:\n\n```toml\nthiserror = {\n  git = \"https://github.com/quartiq/thiserror\",\n  rev = \"515bd36da54dbc346250026ddc349c88851e4bb1\",\n  default-features = false,\n}\n```\n\nAnother alternative is to switch to using [`derive_more`](https://crates.io/crates/derive_more/1.0.0). This would require adding explicit calls to `derive(From, Display)` as well, which adds to the noise. Additionally, it isn't already in the dependency tree, so its inclusion may be contentious.\n\nDue to delays in `thiserror`'s `no_std` support, we have decided to use `derive_more`.\n\n## `portable-atomic`\n\nCertain platforms, such as the Raspberry Pi Pico, _could_ run Bevy once `no_std` support is added, but _can't_ due to Bevy's use of certain atomic features. To work around this issue, Bevy should employ [`portable-atomic`](https://crates.io/crates/portable-atomic) and its sibling [`portable-atomic-util`](https://crates.io/crates/portable-atomic-util). These crates provide suitable replacements for the various `AtomicX` types and `Arc`.\n\nThis adds `cfg(...)` burden to the project, but would be limited in scope to `bevy_ecs` and `bevy_tasks` (the largest users of atomic types), at least initially. Additionally, there is issue with coercion since `portable_atomic_util::Arc` is a 3rd party smart-pointer, so you cannot, for example, create an `Arc<dyn T>` directly from an `Arc<impl T>`. There is a [simple workaround](https://github.com/taiki-e/portable-atomic/issues/143#issuecomment-1866488569), but at a small performance cost for unsized types. However, this will be resolved once [#18598](https://github.com/rust-lang/rust/issues/18598) stabilises.\n\n## Platform Support\n\nBeing `no_std` is _necessary_ for certain platforms, but it is not always _sufficient_. Below is a table of platforms that I have tested:\n\n| Name | Target | Builds | Notes |\n| - | - | - | - |\n| UEFI | `x86_64-unknown-uefi` | Runs | Boots on emulated and real hardware, supported by the `uefi` crate. |\n| GameBoy Advance | `thumbv4t-none-eabi` | Partially | The platform does not support all atomic operations (e.g., CAS), which Bevy directly and transiently relies on. Moving from `tracing` to `log`, and using `portable_atomics` is sufficient to make this platform compile. |\n| Nintendo Switch | `aarch64-nintendo-switch-freestanding` | Compiles | I cannot test the binary produced by `cargo nx` on real hardware or an emulator to confirm it actually _works_. |\n| PlayStation One | `mipsel-sony-psx` | Partially | The platform does not support all atomic operations (e.g., CAS), which Bevy directly and transiently relies on. Moving from `tracing` to `log`, and using `portable_atomics` is sufficient to make this platform compile. |\n| MSP430 | `msp430-none-elf` | No | This platform is 16-bit, which breaks too many assumptions made by dependencies like `zerocopy`. |\n| Playdate | `thumbv7em-none-eabihf` | Runs | Runs but requires a patch to `fixedbitset` to disabled SIMD. Could potentially be fixed from within Bevy without the patch though. |\n| Raspberry Pi Pico | `thumbv6m-none-eabi` | Runs | Runs but requires adopting `portable_atomics` within Bevy, since the Pico doesn't support the atomic CAS instructions required. |\n\nI have a prototype of `no_std` compatible Bevy available on [this branch](https://github.com/bushrat011899/bevy/tree/NoSTDBevyECS). It's _not_ being actively maintained, as it is a proof of concept for upstream `no_std` support (use at your own risk, etc.). However, if anyone has a particular platform they'd like to use Bevy on, please feel free to test using this branch and let me know what kind of compatibility you have. In general:\n\n- You _must_ be able to compile a Rust project for this platform. (I hope this goes without saying!)\n- You _must_ have `alloc` and `core` available.\n- Your platform _must_ support Atomic CAS (hoping to relax this in the future!)\n- Only the `bevy_app`, `bevy_ecs`, `bevy_utils`, and `bevy_tasks` are compatible in this branch, and must be imported directly (e.g., you can't `use bevy;`,  instead `use bevy_app;`). Additionally, you must disable default features for `no_std` compatibility.\n- Your platform _must_ be 32-bit or higher due to [safety concerns](https://github.com/bevyengine/bevy/blob/fbb53140e93aafa1c24096309b64bbd9f25145b6/crates/bevy_ecs/src/lib.rs#L13-L14) in `bevy_ecs`. For further information, see #4736.\n\n## Having an `std` Feature\n\nI've posted a more detailed write-up [here](https://www.reddit.com/r/rust/comments/1hs6spy/psa_for_std_feature_in_no_std_libraries/). But as a succinct warning: `no_std` crates should _unconditionally_ be `#[no_std]` to ensure consistent implicit prelude.\n\n```rust\n#![no_std]\n\n#[cfg(feature = \"std\")]\nextern crate std;\n```\n\nThese findings are acted upon in #17086.\n\n## Building for Web using `wasm32v1-none`\n\nAs of Rust 1.84, [`wasm32v1-none`](https://doc.rust-lang.org/nightly/rustc/platform-support/wasm32v1-none.html) has been stabilised as a tier 2 (`no_std`) target. This is notable compared to the existing `wasm32-unknown-unknown` target in that it _doesn't_ enable new proposals as they're stabilised. This massively improves browser compatibility at the expense of some performance and functionality.\n\nAs stated, this new target is strictly `no_std`. This avoids the stubbed-out version of `std` that `wasm32-unknown-unknown` has, which panics when attempting to use unsupported APIs. This has the interesting side-effect of motivating previously disinterested parties into supporting `no_std`. A highly relevant example of this is [`wgpu`](https://github.com/gfx-rs/wgpu/issues/6826). With `wgpu` potentially gaining `no_std` support, the possibility of `bevy_render` and all of its downstream crates becoming `no_std` compatible themselves goes from an outright impossibility to a potentially desirable mainstream feature.","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/15460/reactions","total_count":35,"+1":19,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":8,"rocket":8,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/15460/timeline","performed_via_github_app":null,"state_reason":"completed"}