{"url":"https://api.github.com/repos/bevyengine/bevy/issues/17416","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/17416/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/17416/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/17416/events","html_url":"https://github.com/bevyengine/bevy/issues/17416","id":2795891714,"node_id":"I_kwDODf6-U86mpewC","number":17416,"title":"HashMaps don't include ReflectFromReflect","user":{"login":"anlumo","id":644763,"node_id":"MDQ6VXNlcjY0NDc2Mw==","avatar_url":"https://avatars.githubusercontent.com/u/644763?v=4","gravatar_id":"","url":"https://api.github.com/users/anlumo","html_url":"https://github.com/anlumo","followers_url":"https://api.github.com/users/anlumo/followers","following_url":"https://api.github.com/users/anlumo/following{/other_user}","gists_url":"https://api.github.com/users/anlumo/gists{/gist_id}","starred_url":"https://api.github.com/users/anlumo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anlumo/subscriptions","organizations_url":"https://api.github.com/users/anlumo/orgs","repos_url":"https://api.github.com/users/anlumo/repos","events_url":"https://api.github.com/users/anlumo/events{/privacy}","received_events_url":"https://api.github.com/users/anlumo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2488007862,"node_id":"MDU6TGFiZWwyNDg4MDA3ODYy","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Triage","name":"S-Needs-Triage","color":"D876e3","default":false,"description":"This issue needs to be labelled"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-01-17T16:46:04Z","updated_at":"2025-01-20T22:28:16Z","closed_at":"2025-01-20T22:28:16Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\n\n0.15.1\n\n## What you did\n\nI'm trying to instantiate concrete bevy types using the reflection features.\n\n## What went wrong\n\nThere are some types in the type registry that use hashmaps, for example:\n\n```\nbevy_utils::hashbrown::HashMap<petgraph::graph::NodeIndex, bevy_animation::ActiveAnimation, bevy_utils::hashbrown::hash_map::DefaultHashBuilder>\nbevy_utils::hashbrown::HashMap<bevy_ecs::entity::Entity, alloc::vec::Vec<bevy_pbr::light::Cascade>, bevy_ecs::entity::hash::EntityHash>\nbevy_utils::hashbrown::HashMap<bevy_animation::AnimationEventTarget, alloc::vec::Vec<bevy_animation::TimedAnimationEvent>, bevy_utils::hashbrown::hash_map::DefaultHashBuilder>\nbevy_utils::hashbrown::HashMap<bevy_animation::AnimationTargetId, u64, bevy_utils::hashbrown::hash_map::DefaultHashBuilder>\nbevy_utils::hashbrown::HashMap<bevy_asset::id::AssetId<bevy_animation::graph::AnimationGraph>, bevy_animation::graph::ThreadedAnimationGraph, bevy_utils::hashbrown::hash_map::DefaultHashBuilder>\n```\n\nAll of them do not have the `ReflectFromReflect` type data object attached. This means that I cannot convert from a `DynamicMap` to a concrete reflected instance of that type.\n\n## Additional information\n\nI was able to work around this for a specific type by doing this after the general registrations:\n\n```rust\nlet graphmap = registry\n    .get_mut(std::any::TypeId::of::<\n        bevy::utils::HashMap<petgraph::graph::NodeIndex, bevy::animation::ActiveAnimation>,\n    >())\n    .unwrap();\ngraphmap.insert::<ReflectFromReflect>(bevy::reflect::FromType::<\n    bevy::utils::HashMap<petgraph::graph::NodeIndex, bevy::animation::ActiveAnimation>,\n>::from_type());\n```\n\nUnfortunately, there's no way to loop over these due to the strict types. I think the macro that generates the registration just doesn't handle `ReflectFromReflect` and has to be updated:\n\nhttps://github.com/bevyengine/bevy/blob/b66c3ceb0ee39374ff1759ffb1b5bee2e4b93e99/crates/bevy_reflect/src/impls/std.rs#L808-L812\n\nI think this is true for other macros in that file as well, for example `impl_reflect_for_hashset`.\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/17416/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/17416/timeline","performed_via_github_app":null,"state_reason":"completed"}