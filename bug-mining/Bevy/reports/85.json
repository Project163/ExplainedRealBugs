{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12126","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/12126/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/12126/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/12126/events","html_url":"https://github.com/bevyengine/bevy/issues/12126","id":2154363084,"node_id":"I_kwDODf6-U86AaPjM","number":12126,"title":"Performance Issues in WASM Builds When Refocusing in Firefox","user":{"login":"camblomquist","id":36173306,"node_id":"MDQ6VXNlcjM2MTczMzA2","avatar_url":"https://avatars.githubusercontent.com/u/36173306?v=4","gravatar_id":"","url":"https://api.github.com/users/camblomquist","html_url":"https://github.com/camblomquist","followers_url":"https://api.github.com/users/camblomquist/followers","following_url":"https://api.github.com/users/camblomquist/following{/other_user}","gists_url":"https://api.github.com/users/camblomquist/gists{/gist_id}","starred_url":"https://api.github.com/users/camblomquist/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/camblomquist/subscriptions","organizations_url":"https://api.github.com/users/camblomquist/orgs","repos_url":"https://api.github.com/users/camblomquist/repos","events_url":"https://api.github.com/users/camblomquist/events{/privacy}","received_events_url":"https://api.github.com/users/camblomquist/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2272098452,"node_id":"MDU6TGFiZWwyMjcyMDk4NDUy","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Performance","name":"C-Performance","color":"B8B8B8","default":false,"description":"A change motivated by improving speed, memory usage or compile times"},{"id":2351483673,"node_id":"MDU6TGFiZWwyMzUxNDgzNjcz","url":"https://api.github.com/repos/bevyengine/bevy/labels/O-Web","name":"O-Web","color":"2e6991","default":false,"description":"Specific to web (WASM) builds"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2024-02-26T14:47:25Z","updated_at":"2024-03-21T03:06:01Z","closed_at":"2024-03-21T03:04:47Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Bevy 0.13\r\n\r\nFirefox (version unknown) tested on Windows 10 and MacOS 13\r\n\r\nI had found that frame rate visibly decreases in Firefox, starting at a stable 60fps when first launching and decreasing all the way into the lower teens if the window is put out of focus then back into focus. When the window is put out of focus, the frame rate increases back to nearly reasonable levels. This does not appear to happen in Chrome, only Firefox. Safari has not yet been tested. Seems similar to #7242 but in that case, it was a Chromium browser and there's a lot of conflicting information in there without clear resolution or direction.\r\n\r\nWhen the performance drops, the console repeatedly logs the following error (taken from the breakout example):\r\n```\r\nUncaught Error: closure invoked recursively or after being dropped\r\n    __wbindgen_throw https://bevy-webgl2-examples.pages.dev/Games/breakout/wasm_example.js:2035\r\n    __wbg_adapter_51 https://bevy-webgl2-examples.pages.dev/Games/breakout/wasm_example.js:237\r\n    real https://bevy-webgl2-examples.pages.dev/Games/breakout/wasm_example.js:210\r\n```\r\nI had thought this error popped up during input events but that does not appear to be the case as the error may be logged even without input.\r\n\r\nA profile of the game shows long stretches of \"Jank\" and high levels of GC but other parts of the profile show most of the frame time being JS. I don't really know how to read the profile so I may just be misinterpreting it.\r\n<img width=\"1440\" alt=\"profile\" src=\"https://github.com/bevyengine/bevy/assets/36173306/0a556aaa-347a-49ec-a7d8-a3852247b2bc\">\r\n\r\nSomeone in the Discord recommended changing WinitSetting as a workaround\r\n```rs\r\napp\r\n    .insert_resource(WinitSettings {\r\n        focused_mode: UpdateMode::Continuous,\r\n        unfocused_mode: UpdateMode::Continuous,\r\n    })\r\n```\r\nI haven't had the opportunity to test this yet but if this does work, then it might be an issue with winit. I still felt it was worth documenting here for tracking.","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12126/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/12126/timeline","performed_via_github_app":null,"state_reason":"completed"}