{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12356","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/12356/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/12356/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/12356/events","html_url":"https://github.com/bevyengine/bevy/issues/12356","id":2172733049,"node_id":"I_kwDODf6-U86BgUZ5","number":12356,"title":"`CiTestingConfig` is blocking `bevy_dev_tools` from using `bevy_render`","user":{"login":"pablo-lua","id":126117294,"node_id":"U_kgDOB4Rlrg","avatar_url":"https://avatars.githubusercontent.com/u/126117294?v=4","gravatar_id":"","url":"https://api.github.com/users/pablo-lua","html_url":"https://github.com/pablo-lua","followers_url":"https://api.github.com/users/pablo-lua/followers","following_url":"https://api.github.com/users/pablo-lua/following{/other_user}","gists_url":"https://api.github.com/users/pablo-lua/gists{/gist_id}","starred_url":"https://api.github.com/users/pablo-lua/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pablo-lua/subscriptions","organizations_url":"https://api.github.com/users/pablo-lua/orgs","repos_url":"https://api.github.com/users/pablo-lua/repos","events_url":"https://api.github.com/users/pablo-lua/events{/privacy}","received_events_url":"https://api.github.com/users/pablo-lua/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2045383863,"node_id":"MDU6TGFiZWwyMDQ1MzgzODYz","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Rendering","name":"A-Rendering","color":"C6A751","default":false,"description":"Drawing game state to the screen"},{"id":6657632434,"node_id":"LA_kwDODf6-U88AAAABjNNosg","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Dev-Tools","name":"A-Dev-Tools","color":"c6A751","default":false,"description":"Tools used to debug Bevy applications."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-03-07T01:03:56Z","updated_at":"2024-03-07T22:54:23Z","closed_at":"2024-03-07T22:54:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\r\n\r\nAfter #11341 \r\n\r\n## What you did\r\n\r\nTrying to import bevy_render or some crate that depends on bevy_render, like in #12354 \r\n\r\n## What went wrong\r\n\r\nThis causes circular a dependence, because bevy_render depends internally on bevy_dev_tools\r\n\r\n## Additional information\r\n\r\nPlace where we use bevy_dev_tools in bevy_render\r\n```rust\r\nimpl Plugin for ScreenshotPlugin {\r\n   // . . .\r\n\r\n    fn finish(&self, app: &mut bevy_app::App) {\r\n        if let Ok(render_app) = app.get_sub_app_mut(RenderApp) {\r\n            render_app.init_resource::<SpecializedRenderPipelines<ScreenshotToScreenPipeline>>();\r\n        }\r\n\r\n        #[cfg(feature = \"bevy_ci_testing\")]\r\n        if app\r\n            .world\r\n            .contains_resource::<bevy_dev_tools::ci_testing::CiTestingConfig>()\r\n        {\r\n            app.add_systems(bevy_app::Update, ci_testing_screenshot_at);\r\n        }\r\n    }\r\n}\r\n\r\n#[cfg(feature = \"bevy_ci_testing\")]\r\nfn ci_testing_screenshot_at(\r\n    mut current_frame: Local<u32>,\r\n    ci_testing_config: Res<bevy_dev_tools::ci_testing::CiTestingConfig>,\r\n    mut screenshot_manager: ResMut<ScreenshotManager>,\r\n    main_window: Query<Entity, With<bevy_window::PrimaryWindow>>,\r\n) {\r\n// . . .\r\n}\r\n```\r\n\r\n## Possible solutions\r\n\r\nWe can probably\n\n- Move related ci Test (probably used by screenshot example) into tests and adding this Ci system into there, so we can make sure that screenshots are still working. Then we can remove Ci from bevy_render\r\n- Move Ci back to where it was before, reverting the changes on this field, as we shouldn't really rely internally on nothing from inside bevy_dev_tools\r\n- Address this case in specific: If we are relying on screenshot to add this, maybe we can add the needed system somehow inside `bevy_dev_tools`?\r\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12356/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/12356/timeline","performed_via_github_app":null,"state_reason":"completed"}