{"url":"https://api.github.com/repos/bevyengine/bevy/issues/17287","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/17287/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/17287/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/17287/events","html_url":"https://github.com/bevyengine/bevy/issues/17287","id":2780953552,"node_id":"I_kwDODf6-U86lwfvQ","number":17287,"title":"Unable to compile certain bevy crates directly, unless an executor is defined separately for `bevy_tasks`","user":{"login":"LikeLakers2","id":1008889,"node_id":"MDQ6VXNlcjEwMDg4ODk=","avatar_url":"https://avatars.githubusercontent.com/u/1008889?v=4","gravatar_id":"","url":"https://api.github.com/users/LikeLakers2","html_url":"https://github.com/LikeLakers2","followers_url":"https://api.github.com/users/LikeLakers2/followers","following_url":"https://api.github.com/users/LikeLakers2/following{/other_user}","gists_url":"https://api.github.com/users/LikeLakers2/gists{/gist_id}","starred_url":"https://api.github.com/users/LikeLakers2/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LikeLakers2/subscriptions","organizations_url":"https://api.github.com/users/LikeLakers2/orgs","repos_url":"https://api.github.com/users/LikeLakers2/repos","events_url":"https://api.github.com/users/LikeLakers2/events{/privacy}","received_events_url":"https://api.github.com/users/LikeLakers2/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":3166125248,"node_id":"MDU6TGFiZWwzMTY2MTI1MjQ4","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Tasks","name":"A-Tasks","color":"c6a751","default":false,"description":"Tools for parallel and async work"},{"id":3166126807,"node_id":"MDU6TGFiZWwzMTY2MTI2ODA3","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Investigation","name":"S-Needs-Investigation","color":"D876E1","default":false,"description":"This issue requires detective work to figure out what's going wrong"},{"id":3662879866,"node_id":"LA_kwDODf6-U87aUxx6","url":"https://api.github.com/repos/bevyengine/bevy/labels/P-Compile-Failure","name":"P-Compile-Failure","color":"FF7B00","default":false,"description":"A failure to compile Bevy apps"},{"id":6899571146,"node_id":"LA_kwDODf6-U88AAAABmz8Zyg","url":"https://api.github.com/repos/bevyengine/bevy/labels/D-Straightforward","name":"D-Straightforward","color":"008672","default":false,"description":"Simple bug fixes and API improvements, docs, test and examples"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2025-01-10T19:28:46Z","updated_at":"2025-01-11T02:52:32Z","closed_at":"2025-01-11T02:52:32Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi! While writing some of my linting PRs, I seem to have come across an odd problem with `bevy_tasks`.\n\nSpecifically, it seems that certain crates rely on `bevy_tasks`, but then prevent `bevy_tasks` from having any executor features enabled, causing certain executor types to not be defined.\n\nI was able to observe this while trying to compile the `bevy_state` and `bevy_hierarchy` crates directly (using `--package` to select them specifically), but it's possible there may be other bevy crates that do the same.\n\n<details><summary>Full compilation error log</summary>\n\n```Shell\nerror[E0412]: cannot find type `ExecutorInner` in this scope\n  --> crates\\bevy_tasks\\src\\executor.rs:39:25\n   |\n39 | pub struct Executor<'a>(ExecutorInner<'a>);\n   |                         ^^^^^^^^^^^^^ not found in this scope\n\nerror[E0412]: cannot find type `LocalExecutorInner` in this scope\n  --> crates\\bevy_tasks\\src\\executor.rs:49:30\n   |\n49 | pub struct LocalExecutor<'a>(LocalExecutorInner<'a>);\n   |                              ^^^^^^^^^^^^^^^^^^ not found in this scope\n\nerror[E0599]: the method `get` exists for struct `EagerStorage<LocalExecutor<'static>>`, but its trait bounds were not satisfied\n  --> crates\\bevy_tasks\\src\\single_threaded_task_pool.rs:22:1\n   |\n22 | / thread_local! {\n23 | |     static LOCAL_EXECUTOR: LocalExecutor<'static> = const { LocalExecutor::new() };\n24 | | }\n   | |_^ method cannot be called on `EagerStorage<LocalExecutor<'static>>` due to unsatisfied trait bounds\n   |\n  ::: crates\\bevy_tasks\\src\\executor.rs:49:1\n   |\n49 |   pub struct LocalExecutor<'a>(LocalExecutorInner<'a>);\n   |   ---------------------------- doesn't satisfy `_: Sized`\n   |\n   = note: the following trait bounds were not satisfied:\n           `{type error}: core::marker::Sized`\n           which is required by `executor::LocalExecutor<'static>: core::marker::Sized`\n   = note: this error originates in the macro `$crate::thread::local_impl::thread_local_inner` which comes from the expansion of the macro `thread_local` (in Nightly builds, run with -Z macro-backtrace for mor\nerror[E0433]: failed to resolve: use of undeclared type `ExecutorInner`\n  --> crates\\bevy_tasks\\src\\executor.rs:56:14\n   |\n56 |         Self(ExecutorInner::new())\n   |              ^^^^^^^^^^^^^ use of undeclared type `ExecutorInner`\n\nerror[E0433]: failed to resolve: use of undeclared type `LocalExecutorInner`\n  --> crates\\bevy_tasks\\src\\executor.rs:65:14\n   |\n65 |         Self(LocalExecutorInner::new())\n   |              ^^^^^^^^^^^^^^^^^^\n   |              |\n   |              use of undeclared type `LocalExecutorInner`\n   |              help: a struct with a similar name exists: `LocalExecutor`\n\nerror[E0599]: the method `with` exists for struct `LocalKey<LocalExecutor<'static>>`, but its trait bounds were not satisfied\n   --> crates\\bevy_tasks\\src\\single_threaded_task_pool.rs:208:31\n    |\n208 |         return LOCAL_EXECUTOR.with(|executor| {\n    |                ---------------^^^^ method cannot be called on `LocalKey<LocalExecutor<'static>>` due to unsatisfied trait bounds\n    |\n   ::: crates\\bevy_tasks\\src\\executor.rs:49:1\n    |\n49  | pub struct LocalExecutor<'a>(LocalExecutorInner<'a>);\n    | ---------------------------- doesn't satisfy `_: Sized`\n    |\n    = note: the following trait bounds were not satisfied:\n            `{type error}: core::marker::Sized`\n            which is required by `executor::LocalExecutor<'static>: core::marker::Sized`\n\nerror[E0599]: the method `with` exists for struct `LocalKey<LocalExecutor<'static>>`, but its trait bounds were not satisfied\n   --> crates\\bevy_tasks\\src\\single_threaded_task_pool.rs:253:31\n    |\n253 |         return LOCAL_EXECUTOR.with(f);\n    |                               ^^^^ method cannot be called on `LocalKey<LocalExecutor<'static>>` due to unsatisfied trait bounds\n    |\n   ::: crates\\bevy_tasks\\src\\executor.rs:49:1\n    |\n49  | pub struct LocalExecutor<'a>(LocalExecutorInner<'a>);\n    | ---------------------------- doesn't satisfy `_: Sized`\n    |\n    = note: the following trait bounds were not satisfied:\n            `{type error}: core::marker::Sized`\n            which is required by `executor::LocalExecutor<'static>: core::marker::Sized`\n\nSome errors have detailed explanations: E0412, E0433, E0599.\nFor more information about an error, try `rustc --explain E0412`.\nerror: could not compile `bevy_tasks` (lib) due to 7 previous errors\n```\n</details>\n\nI would make a PR for this, but I'm unsure how to handle it.","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/17287/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/17287/timeline","performed_via_github_app":null,"state_reason":"completed"}