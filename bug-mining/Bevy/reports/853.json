{"url":"https://api.github.com/repos/bevyengine/bevy/issues/19504","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/19504/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/19504/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/19504/events","html_url":"https://github.com/bevyengine/bevy/issues/19504","id":3123062516,"node_id":"I_kwDODf6-U866Jib0","number":19504,"title":"bevy_ecs performance regression in 0.16.0 release (get + insertion)","user":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2197761682,"node_id":"MDU6TGFiZWwyMTk3NzYxNjgy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-ECS","name":"A-ECS","color":"c6a751","default":false,"description":"Entities, components, systems, and events"},{"id":2272098452,"node_id":"MDU6TGFiZWwyMjcyMDk4NDUy","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Performance","name":"C-Performance","color":"B8B8B8","default":false,"description":"A change motivated by improving speed, memory usage or compile times"},{"id":2860079228,"node_id":"MDU6TGFiZWwyODYwMDc5MjI4","url":"https://api.github.com/repos/bevyengine/bevy/labels/P-Regression","name":"P-Regression","color":"FF7B00","default":false,"description":"Functionality that used to work but no longer does. Add a test for this!"},{"id":3166126807,"node_id":"MDU6TGFiZWwzMTY2MTI2ODA3","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Investigation","name":"S-Needs-Investigation","color":"D876E1","default":false,"description":"This issue requires detective work to figure out what's going wrong"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2025-06-05T23:42:16Z","updated_at":"2025-08-17T22:19:49Z","closed_at":null,"author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"# Problem\n\nAs [spotted](https://discord.com/channels/691052431525675048/749335865876021248/1380318173798072371) by @SanderMertens of [flecs](https://github.com/SanderMertens/flecs), Bevy's ECS perf had a serious regression from Bevy 0.15 to Bevy 0.16.\n\nFor many users, this may have been outweighed by the improvements to rendering performance and transform propagation; hence why this is just now being found and reported.\n\n![Image](https://github.com/user-attachments/assets/582d3e7f-e3aa-4127-91d4-b50bfe777c55)\n\nSee [this gist](https://gist.github.com/SanderMertens/b98ea829a1477f9b8620dd5878f707a3) for the exact benches used.\n\n## Path to a solution\n\nWe should focus on the get / get_mut regressions first: those are larger so they'll be easier to spot. We may have multiple independent regressions, particularly since insertion / removal are also affected. The relations regressions are less surprising (we completely changed our strategy there), but should be rechecked once the other regressions are fixed.\n\n1. Bench for Bevy 0.15.\n2. Bench for Bevy 0.16\n3. Bench for Bevy main (we may have somehow fixed this)\n4. Bisect from Bevy 0.15 to Bevy 0.16 by git commits to figure out where this was introduced.\n5. Report back so we can coordinate a fix.\n6. Fix!\n7. Ideally, release a point release removing or at least ameliorating the regression.","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/19504/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/19504/timeline","performed_via_github_app":null,"state_reason":"reopened"}