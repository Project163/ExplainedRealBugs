{"url":"https://api.github.com/repos/bevyengine/bevy/issues/16525","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/16525/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/16525/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/16525/events","html_url":"https://github.com/bevyengine/bevy/issues/16525","id":2696863573,"node_id":"I_kwDODf6-U86gvt9V","number":16525,"title":"webgl2: Mesh without triangles panics","user":{"login":"rparrett","id":200550,"node_id":"MDQ6VXNlcjIwMDU1MA==","avatar_url":"https://avatars.githubusercontent.com/u/200550?v=4","gravatar_id":"","url":"https://api.github.com/users/rparrett","html_url":"https://github.com/rparrett","followers_url":"https://api.github.com/users/rparrett/followers","following_url":"https://api.github.com/users/rparrett/following{/other_user}","gists_url":"https://api.github.com/users/rparrett/gists{/gist_id}","starred_url":"https://api.github.com/users/rparrett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rparrett/subscriptions","organizations_url":"https://api.github.com/users/rparrett/orgs","repos_url":"https://api.github.com/users/rparrett/repos","events_url":"https://api.github.com/users/rparrett/events{/privacy}","received_events_url":"https://api.github.com/users/rparrett/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2045383863,"node_id":"MDU6TGFiZWwyMDQ1MzgzODYz","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Rendering","name":"A-Rendering","color":"C6A751","default":false,"description":"Drawing game state to the screen"},{"id":2272057257,"node_id":"MDU6TGFiZWwyMjcyMDU3MjU3","url":"https://api.github.com/repos/bevyengine/bevy/labels/P-Crash","name":"P-Crash","color":"FF7b00","default":false,"description":"A sudden unexpected crash"},{"id":3166126807,"node_id":"MDU6TGFiZWwzMTY2MTI2ODA3","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Investigation","name":"S-Needs-Investigation","color":"D876E1","default":false,"description":"This issue requires detective work to figure out what's going wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-11-27T03:22:02Z","updated_at":"2025-07-07T02:52:17Z","closed_at":"2025-07-07T02:52:17Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\n\n0.15.0-rc.3\n\n## Relevant system information\n\nAdapterInfo { name: \"ANGLE (Apple, ANGLE Metal Renderer: Apple M1 Max, Unspecified Version)\", vendor: 4203, device: 0, device_type: IntegratedGpu, driver: \"\", driver_info: \"WebGL 2.0 (OpenGL ES 3.0 Chromium)\", backend: Gl }\n\n## What you did\n\nI experienced this panic in the wild while migrating an app that uses a lot of `Mesh2d` by way of `bevy_prototype_lyon`. It seems that the root cause is creating a `Line` with zero length in that plugin.\n\n<details>\n<summary>Minimal repro for Bevy 0.15</summary>\n\n```rust\nuse bevy::{asset::RenderAssetUsages, prelude::*, render::mesh::PrimitiveTopology};\n\nfn main() {\n    App::new()\n        .add_plugins(DefaultPlugins)\n        .add_systems(Startup, setup)\n        .run();\n}\n\nfn setup(\n    mut commands: Commands,\n    mut meshes: ResMut<Assets<Mesh>>,\n    mut materials: ResMut<Assets<ColorMaterial>>,\n) {\n    commands.spawn(Camera2d);\n\n    let mesh = Mesh::new(\n        PrimitiveTopology::TriangleList,\n        RenderAssetUsages::default(),\n    );\n\n    commands.spawn((\n        Mesh2d(meshes.add(mesh)),\n        MeshMaterial2d(materials.add(Color::hsl(180.0, 0.95, 0.7))),\n    ));\n}\n```\n</details>\n\n<details>\n<summary>Bevy 0.14 code tested</summary>\n\n```rust\nuse bevy::{\n    prelude::*,\n    render::{mesh::PrimitiveTopology, render_asset::RenderAssetUsages},\n    sprite::{MaterialMesh2dBundle, Mesh2dHandle},\n};\n\nfn main() {\n    App::new()\n        .add_plugins(DefaultPlugins)\n        .add_systems(Startup, setup)\n        .run();\n}\n\nfn setup(\n    mut commands: Commands,\n    mut meshes: ResMut<Assets<Mesh>>,\n    mut materials: ResMut<Assets<ColorMaterial>>,\n) {\n    commands.spawn(Camera2dBundle::default());\n\n    let mesh = Mesh::new(\n        PrimitiveTopology::TriangleList,\n        RenderAssetUsages::default(),\n    );\n\n    let color = Color::hsl(180., 0.95, 0.7);\n\n    commands.spawn(MaterialMesh2dBundle {\n        mesh: Mesh2dHandle(meshes.add(mesh)),\n        material: materials.add(color),\n        ..default()\n    });\n}\n\n```\n</details>\n\n<details>\n<summary>The exact type of mesh generated by a zero-length line w/ <code>bevy_prototype_lyon</code> (same panic)</summary>\n\n```rust\nlet mesh = Mesh::new(\n    PrimitiveTopology::TriangleList,\n    RenderAssetUsages::default(),\n)\n.with_inserted_attribute(Mesh::ATTRIBUTE_POSITION, Vec::<[f32; 3]>::new())\n.with_inserted_attribute(Mesh::ATTRIBUTE_COLOR, Vec::<[f32; 4]>::new())\n.with_inserted_indices(Indices::U32(vec![]));\n```\n</details>\n\n```\ncargo run -p build-wasm-example -- --api webgl2 empty_mesh\nbasic-http-server examples/wasm/\n```\n\n## What went wrong\n\n```\nwasm_example.js:1951 panicked at /Users/me/.cargo/registry/src/index.crates.io-6f17d22bba15001f/wgpu-23.0.1/src/api/buffer.rs:684:9:\nslice offset 0 is out of range for buffer of size 0\n\nStack:\n\nError\n    at imports.wbg.__wbg_new_abda76e883ba8a5f (http://127.0.0.1:4000/target/wasm_example.js:1935:21)\n    at sprite-e09298d3df91ece6.wasm.__wbg_new_abda76e883ba8a5f externref shim (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[87386]:0x22b19ec)\n    at sprite-e09298d3df91ece6.wasm.console_error_panic_hook::hook::ha8c6c1fd53fdbabe (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[16852]:0x1840f09)\n    at sprite-e09298d3df91ece6.wasm.core::ops::function::Fn::call::h4a1d224ff1d85143 (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[135054]:0x23915f6)\n    at sprite-e09298d3df91ece6.wasm.std::panicking::rust_panic_with_hook::he5c089ac7305193e (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[35603]:0x1ee83b4)\n    at sprite-e09298d3df91ece6.wasm.std::panicking::begin_panic_handler::{{closure}}::h010c94f3a1c5c766 (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[41310]:0x2000557)\n    at sprite-e09298d3df91ece6.wasm.std::sys::backtrace::__rust_end_short_backtrace::hbe714695da4edadc (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[131865]:0x238a269)\n    at sprite-e09298d3df91ece6.wasm.rust_begin_unwind (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[52617]:0x21540ee)\n    at sprite-e09298d3df91ece6.wasm.core::panicking::panic_fmt::hdc8d2d914c0710e4 (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[54160]:0x2173e57)\n    at sprite-e09298d3df91ece6.wasm.wgpu::api::buffer::check_buffer_bounds::h3364e293f2fdb994 (http://127.0.0.1:4000/target/wasm_example_bg.wasm:wasm-function[30214]:0x1d84ec2)\n```\n\n## Additional information\n\nThis is a silly thing to be trying to do, but it did not panic in Bevy 0.14.\n\nPossibly related to https://github.com/gfx-rs/wgpu/issues/3170#issuecomment-2491549161\n\n`webgpu` and native on m1 mac seem to work okay.","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/16525/reactions","total_count":8,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/16525/timeline","performed_via_github_app":null,"state_reason":"completed"}