{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12344","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/12344/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/12344/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/12344/events","html_url":"https://github.com/bevyengine/bevy/issues/12344","id":2172170985,"node_id":"I_kwDODf6-U86BeLLp","number":12344,"title":"Asset will wrongly unload while strong handle is alive under certain circumstances","user":{"login":"Litttlefish","id":38809254,"node_id":"MDQ6VXNlcjM4ODA5MjU0","avatar_url":"https://avatars.githubusercontent.com/u/38809254?v=4","gravatar_id":"","url":"https://api.github.com/users/Litttlefish","html_url":"https://github.com/Litttlefish","followers_url":"https://api.github.com/users/Litttlefish/followers","following_url":"https://api.github.com/users/Litttlefish/following{/other_user}","gists_url":"https://api.github.com/users/Litttlefish/gists{/gist_id}","starred_url":"https://api.github.com/users/Litttlefish/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Litttlefish/subscriptions","organizations_url":"https://api.github.com/users/Litttlefish/orgs","repos_url":"https://api.github.com/users/Litttlefish/repos","events_url":"https://api.github.com/users/Litttlefish/events{/privacy}","received_events_url":"https://api.github.com/users/Litttlefish/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2272055462,"node_id":"MDU6TGFiZWwyMjcyMDU1NDYy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Assets","name":"A-Assets","color":"c6a751","default":false,"description":"Load files from disk to use for things like images, models, and sounds"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/bevyengine/bevy/milestones/21","html_url":"https://github.com/bevyengine/bevy/milestone/21","labels_url":"https://api.github.com/repos/bevyengine/bevy/milestones/21/labels","id":10570096,"node_id":"MI_kwDODf6-U84AoUlw","number":21,"title":"0.13.1","description":"","creator":{"login":"cart","id":2694663,"node_id":"MDQ6VXNlcjI2OTQ2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/2694663?v=4","gravatar_id":"","url":"https://api.github.com/users/cart","html_url":"https://github.com/cart","followers_url":"https://api.github.com/users/cart/followers","following_url":"https://api.github.com/users/cart/following{/other_user}","gists_url":"https://api.github.com/users/cart/gists{/gist_id}","starred_url":"https://api.github.com/users/cart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cart/subscriptions","organizations_url":"https://api.github.com/users/cart/orgs","repos_url":"https://api.github.com/users/cart/repos","events_url":"https://api.github.com/users/cart/events{/privacy}","received_events_url":"https://api.github.com/users/cart/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":59,"state":"closed","created_at":"2024-02-16T19:38:53Z","updated_at":"2024-03-18T22:44:09Z","due_on":null,"closed_at":"2024-03-18T22:44:09Z"},"comments":1,"created_at":"2024-03-06T18:33:35Z","updated_at":"2024-03-17T21:52:22Z","closed_at":"2024-03-17T21:52:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version\r\n0.13\r\n\r\n## What you did\r\nIn my tests the app has two states(A and B), and an entity with a sprite. when switching states, this entity will be despawned in `OnExit(State::A)`, and spawn a new one entity is identical to the prior one in `OnEnter(State::B)`.\r\n\r\n## What went wrong\r\n\r\nWhen respawning it, the sprite will disappear(actually it is there, but the sprite is empty).\r\n\r\nThis didn't happen in 0.12 version.\r\n\r\n## Additional information\r\n\r\nHere is my test code(need a custom image as `test.png`):\r\n``` rust\r\nuse bevy::prelude::*;\r\nuse bevy::render::camera::ScalingMode;\r\n\r\n#[derive(Component)]\r\nstruct Marker;\r\n\r\n#[derive(States, Default, Debug, PartialEq, Eq, Hash, Clone, Copy)]\r\nenum State {\r\n    #[default]\r\n    A,\r\n    B,\r\n}\r\n\r\nfn main() {\r\n    App::new()\r\n        .add_plugins((DefaultPlugins.set(WindowPlugin {\r\n            primary_window: Some(Window {\r\n                resolution: (960.0, 540.0).into(),\r\n                resizable: false,\r\n                ..default()\r\n            }),\r\n            ..default()\r\n        }),))\r\n        .init_state::<State>()\r\n        .add_systems(Startup, setup)\r\n        .add_systems(OnExit(State::A), exit_a)\r\n        .add_systems(OnEnter(State::B), enter_b)\r\n        .add_systems(Update, switch)\r\n        //.add_plugin(EditorPlugin::default())\r\n        .run();\r\n}\r\n\r\nfn setup(mut cmd: Commands, asset_server: Res<AssetServer>) {\r\n    cmd.spawn(Camera2dBundle {\r\n        projection: OrthographicProjection {\r\n            scaling_mode: ScalingMode::AutoMin {\r\n                min_width: 960.,\r\n                min_height: 540.,\r\n            },\r\n            ..Camera2dBundle::default().projection\r\n        },\r\n        ..default()\r\n    });\r\n    cmd.spawn((\r\n        SpriteBundle {\r\n            texture: asset_server.load(\"sprites/test.png\"),\r\n            ..default()\r\n        },\r\n        Marker,\r\n    ));\r\n}\r\n\r\nfn switch(mouse: Res<ButtonInput<MouseButton>>, mut next_state: ResMut<NextState<State>>) {\r\n    if mouse.just_pressed(MouseButton::Left) {\r\n        next_state.set(State::B)\r\n    }\r\n}\r\n\r\nfn exit_a(mut cmd: Commands, q: Query<Entity, With<Marker>>) {\r\n    cmd.entity(q.single()).despawn();\r\n}\r\n\r\nfn enter_b(mut cmd: Commands, asset_server: Res<AssetServer>) {\r\n    cmd.spawn((SpriteBundle {\r\n        sprite: Sprite {\r\n            custom_size: Some((960., 540.).into()),\r\n            ..default()\r\n        },\r\n        texture: asset_server.load(\"sprites/test.png\"),\r\n        ..default()\r\n    },));\r\n}\r\n```\r\n\r\nAfter click state will switch, and the sprite entity will \"disappear\".\r\n\r\nMy assumption is that image asset unloaded the sprite in `OnExit(State::A)`, but it didn't load it again in `OnEnter(State::B)`.\r\n\r\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/12344/timeline","performed_via_github_app":null,"state_reason":"completed"}