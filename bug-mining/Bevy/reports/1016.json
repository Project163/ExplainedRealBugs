{"url":"https://api.github.com/repos/bevyengine/bevy/issues/21327","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/21327/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/21327/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/21327/events","html_url":"https://github.com/bevyengine/bevy/issues/21327","id":3474879050,"node_id":"I_kwDODf6-U87PHnJK","number":21327,"title":"Volumetric fog contribution of PointLight and SpotLight seems too strong","user":{"login":"JeroenHoogers","id":10060956,"node_id":"MDQ6VXNlcjEwMDYwOTU2","avatar_url":"https://avatars.githubusercontent.com/u/10060956?v=4","gravatar_id":"","url":"https://api.github.com/users/JeroenHoogers","html_url":"https://github.com/JeroenHoogers","followers_url":"https://api.github.com/users/JeroenHoogers/followers","following_url":"https://api.github.com/users/JeroenHoogers/following{/other_user}","gists_url":"https://api.github.com/users/JeroenHoogers/gists{/gist_id}","starred_url":"https://api.github.com/users/JeroenHoogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JeroenHoogers/subscriptions","organizations_url":"https://api.github.com/users/JeroenHoogers/orgs","repos_url":"https://api.github.com/users/JeroenHoogers/repos","events_url":"https://api.github.com/users/JeroenHoogers/events{/privacy}","received_events_url":"https://api.github.com/users/JeroenHoogers/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2488007862,"node_id":"MDU6TGFiZWwyNDg4MDA3ODYy","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Triage","name":"S-Needs-Triage","color":"D876e3","default":false,"description":"This issue needs to be labelled"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2025-10-01T19:41:26Z","updated_at":"2025-10-04T22:55:22Z","closed_at":"2025-10-04T22:55:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## Bevy version and features\n\n0.17.1\n\n## \\[Optional\\] Relevant system information\n\n```ignore\n`AdapterInfo { name: \"NVIDIA GeForce RTX 3090\", vendor: 4318, device: 8708, device_type: DiscreteGpu, driver: \"NVIDIA\", driver_info: \"580.88\", backend: Vulkan }`\n```\n\n## What you did\nRun default `volumetric_fog` example with volumetric lights on / off:\n \n<img width=\"1922\" height=\"1126\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/f59cb13b-def2-4d5b-bf02-1f53679d1b9f\" />\n\n<img width=\"1922\" height=\"1126\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/ab5fa496-c28f-4ae5-b29a-a6e74de5c313\" />\n\nNotice how the contribution of the Point and Spotlight is barely visible on the surfaces of the room despite having a strong volumetric effect. Now compare this to the directional light in terms of fog strength and light contribution to the room's surfaces.\n\nI increased the Spotlight and Pointlight intensity values by 10x in `volumetric_fog` like this:\n```\n    // Add the point light\n    commands.spawn((\n        Transform::from_xyz(-0.4, 1.9, 1.0),\n        PointLight {\n            shadows_enabled: true,\n            range: 150.0,\n            color: RED.into(),\n            intensity: 10000.0,  // was 1000\n            ..default()\n        },\n        VolumetricLight,\n        MoveBackAndForthHorizontally {\n            min_x: -1.93,\n            max_x: -0.4,\n            speed: -0.2,\n        },\n    ));\n\n    // Add the spot light\n    commands.spawn((\n        Transform::from_xyz(-1.8, 3.9, -2.7).looking_at(Vec3::ZERO, Vec3::Y),\n        SpotLight {\n            intensity: 50000.0, // lumens, was 5000\n            color: Color::WHITE,\n            shadows_enabled: true,\n            inner_angle: 0.76,\n            outer_angle: 0.94,\n            ..default()\n        },\n        VolumetricLight,\n    ));\n```\nThis gives the following results (on / off):\n\n<img width=\"1922\" height=\"1126\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/465096fc-3d88-4c1f-aa66-f5b5f067489d\" />\n\n<img width=\"1922\" height=\"1126\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/c0b8324e-8ba8-4dbb-abf7-44fcc072dd19\" />\n\nThe lights now clearly brighten the surfaces of the room but notice how the volumetric contribution of these lights is now much stronger than the directional light's contribution. This doesn't make sense, I expect the directional light to have a stronger volumetric effect since it has a higher intensity than the point and spotlight.\n\n## What went wrong\n\n- Volumetric fog contribution of point and spotlights is too strong for the intensity of light emitted.\n\n## Additional information\n\nI expect the problem lies in [volumetric_fog.wgsl#L383-L384](https://github.com/bevyengine/bevy/blob/release-0.17.1/crates/bevy_pbr/src/volumetric_fog/volumetric_fog.wgsl#L383-L384):\n```\n            let light_factors_per_step = fog_color * light_tint * light_attenuation *\n                scattering * density * step_size_world * light_intensity * 0.1;\n```\nThe directional light implementation [volumetric_fog.wgsl#L294-L295](https://github.com/bevyengine/bevy/blob/release-0.17.1/crates/bevy_pbr/src/volumetric_fog/volumetric_fog.wgsl#L294-L295) looks like this:\n```\n                let light_factors_per_step = fog_color * light_tint * light_attenuation *\n                    scattering * density * step_size_world * light_intensity * exposure;\n```\n\nI notice that he `exposure` factor is replaced by a constant `0.1`? The default `exposure` factor (based on blender's ev100 value of 9.7) is `1/(2^9.7 * 1.2) = ~0.00100191`, this accounts for the strong difference in contribution between the 2 light types (https://google.github.io/filament/Filament.md.html#imagingpipeline/physicallybasedcamera/exposure). After replacing the `0.1` constant with `exposure` for the spot / point light implementation, the results look a lot more realistic (10x again, on):\n<img width=\"1922\" height=\"1126\" alt=\"Image\" src=\"https://github.com/user-attachments/assets/cdd6c005-f3fd-46e2-9f89-24cbf4b380b3\" />\nThe contributions to the volumetric fog now seem much more in line with the light intensities shown on the surfaces.\n\n\n\n","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/21327/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/21327/timeline","performed_via_github_app":null,"state_reason":"completed"}