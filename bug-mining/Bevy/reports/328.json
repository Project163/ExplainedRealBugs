{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12381","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/12381/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/12381/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/12381/events","html_url":"https://github.com/bevyengine/bevy/issues/12381","id":2176779405,"node_id":"I_kwDODf6-U86BvwSN","number":12381,"title":"Opprotunistically use dense iteration when an archetype and its table are 1:1","user":{"login":"james7132","id":3137680,"node_id":"MDQ6VXNlcjMxMzc2ODA=","avatar_url":"https://avatars.githubusercontent.com/u/3137680?v=4","gravatar_id":"","url":"https://api.github.com/users/james7132","html_url":"https://github.com/james7132","followers_url":"https://api.github.com/users/james7132/followers","following_url":"https://api.github.com/users/james7132/following{/other_user}","gists_url":"https://api.github.com/users/james7132/gists{/gist_id}","starred_url":"https://api.github.com/users/james7132/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/james7132/subscriptions","organizations_url":"https://api.github.com/users/james7132/orgs","repos_url":"https://api.github.com/users/james7132/repos","events_url":"https://api.github.com/users/james7132/events{/privacy}","received_events_url":"https://api.github.com/users/james7132/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2197761682,"node_id":"MDU6TGFiZWwyMTk3NzYxNjgy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-ECS","name":"A-ECS","color":"c6a751","default":false,"description":"Entities, components, systems, and events"},{"id":2272098452,"node_id":"MDU6TGFiZWwyMjcyMDk4NDUy","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Performance","name":"C-Performance","color":"B8B8B8","default":false,"description":"A change motivated by improving speed, memory usage or compile times"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-03-08T21:13:58Z","updated_at":"2024-08-02T21:33:47Z","closed_at":"2024-08-02T21:33:47Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## What problem does this solve or what need does it fill?\r\nWe currently force sparse iteration if any of the target components in the data or filter part of a query is a sparse set component. This is suboptimal given the random access pattern forced by archetypal iteration.\r\n\r\nIf an archetype and its table have the same entity count, we should be able to assume that they target the same set of entities, which should make it safe to use dense iteration.\r\n\r\n## What solution would you like?\r\nExtend all iteration methods to opportunistically use dense iteration if the fetched archetype and table have the same length.\r\n\r\n## What alternative(s) have you considered?\r\nLeave it as is, this may notably complicate the safety story for query iteration.\r\n\r\n## Additional context\r\nRelated: #2144.","closed_by":{"login":"cart","id":2694663,"node_id":"MDQ6VXNlcjI2OTQ2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/2694663?v=4","gravatar_id":"","url":"https://api.github.com/users/cart","html_url":"https://github.com/cart","followers_url":"https://api.github.com/users/cart/followers","following_url":"https://api.github.com/users/cart/following{/other_user}","gists_url":"https://api.github.com/users/cart/gists{/gist_id}","starred_url":"https://api.github.com/users/cart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cart/subscriptions","organizations_url":"https://api.github.com/users/cart/orgs","repos_url":"https://api.github.com/users/cart/repos","events_url":"https://api.github.com/users/cart/events{/privacy}","received_events_url":"https://api.github.com/users/cart/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/12381/timeline","performed_via_github_app":null,"state_reason":"completed"}