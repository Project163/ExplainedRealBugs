{"url":"https://api.github.com/repos/bevyengine/bevy/issues/13832","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/13832/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/13832/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/13832/events","html_url":"https://github.com/bevyengine/bevy/issues/13832","id":2351736131,"node_id":"I_kwDODf6-U86MLKVD","number":13832,"title":"Additive blending of Quats looks suspect","user":{"login":"mweatherley","id":2975848,"node_id":"MDQ6VXNlcjI5NzU4NDg=","avatar_url":"https://avatars.githubusercontent.com/u/2975848?v=4","gravatar_id":"","url":"https://api.github.com/users/mweatherley","html_url":"https://github.com/mweatherley","followers_url":"https://api.github.com/users/mweatherley/followers","following_url":"https://api.github.com/users/mweatherley/following{/other_user}","gists_url":"https://api.github.com/users/mweatherley/gists{/gist_id}","starred_url":"https://api.github.com/users/mweatherley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mweatherley/subscriptions","organizations_url":"https://api.github.com/users/mweatherley/orgs","repos_url":"https://api.github.com/users/mweatherley/repos","events_url":"https://api.github.com/users/mweatherley/events{/privacy}","received_events_url":"https://api.github.com/users/mweatherley/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":2893263165,"node_id":"MDU6TGFiZWwyODkzMjYzMTY1","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Animation","name":"A-Animation","color":"c6A751","default":false,"description":"Make things move and change over time"},{"id":3166124969,"node_id":"MDU6TGFiZWwzMTY2MTI0OTY5","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Math","name":"A-Math","color":"c6a751","default":false,"description":"Fundamental domain-agnostic mathematical operations"},{"id":3166126807,"node_id":"MDU6TGFiZWwzMTY2MTI2ODA3","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Investigation","name":"S-Needs-Investigation","color":"D876E1","default":false,"description":"This issue requires detective work to figure out what's going wrong"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-06-13T17:49:47Z","updated_at":"2024-10-05T20:19:39Z","closed_at":"2024-10-05T20:19:39Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I believe this was previously noticed by @djeedai in the review of the `Animatable` trait rollout.\r\n\r\nI am not an expert in this subject, but here is my understanding.\r\n\r\n## Context\r\n\r\nIn additive animation blending, a sample from an animation clip represents a relative displacement rather than an absolute quantity; this is applied on top of other animations by combining the displacement with the absolute quantity \"underneath\". Like non-additive animation blending (which interpolates between two absolute quantities instead), this can be used in concert with a weight which indicates the strength of the sample's influence in the blend. For additive blending, this means that, as the weight tends to zero, the displacement also attenuates; with a weight of zero, the blend should have no effect on the existing quantity.\r\n\r\nFor example, additive blending of translational components works something like this:\r\n```rust\r\nlet (displacement, weight): (Vec3, f32) = incoming_sample;\r\ntranslation += displacement * weight\r\n```\r\n\r\nThe right-hand side of this is perhaps best conceptualized as:\r\n```rust\r\nVec3::lerp(Vec3::ZERO, displacement, weight)\r\n```\r\n\r\nIn other words, the additively blended sample is interpolated with zero and then composed with the existing value.\r\n\r\n## The mismatch\r\n\r\nNow, currently additive blending for Quat works like this:\r\n```rust\r\nlet (rot_displacement, weight): (Quat, f32) = incoming_sample;\r\nrotation = rotation.slerp(rot_displacement, weight);\r\n```\r\n\r\nWhat I would expect based on my understanding of additive blending is instead something like this:\r\n```rust\r\nlet (rot_displacement, weight): (Quat, f32) = incoming_sample;\r\nrotation = Quat::slerp(Quat::IDENTITY, rot_displacement, weight) * rotation;\r\n```\r\n\r\nNote that these are definitely not equivalent â€” when the incoming sample is `Quat::IDENTITY`, the latter never has any effect, while the former (with positive weight) will slerp the current rotation state towards the default orientation.\r\n\r\nOf course, it's possible this was an intentional decision and I'm missing something; this is just my understanding of things.","closed_by":{"login":"mockersf","id":8672791,"node_id":"MDQ6VXNlcjg2NzI3OTE=","avatar_url":"https://avatars.githubusercontent.com/u/8672791?v=4","gravatar_id":"","url":"https://api.github.com/users/mockersf","html_url":"https://github.com/mockersf","followers_url":"https://api.github.com/users/mockersf/followers","following_url":"https://api.github.com/users/mockersf/following{/other_user}","gists_url":"https://api.github.com/users/mockersf/gists{/gist_id}","starred_url":"https://api.github.com/users/mockersf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mockersf/subscriptions","organizations_url":"https://api.github.com/users/mockersf/orgs","repos_url":"https://api.github.com/users/mockersf/repos","events_url":"https://api.github.com/users/mockersf/events{/privacy}","received_events_url":"https://api.github.com/users/mockersf/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/13832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/13832/timeline","performed_via_github_app":null,"state_reason":"completed"}