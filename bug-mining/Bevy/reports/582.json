{"url":"https://api.github.com/repos/bevyengine/bevy/issues/15350","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/15350/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/15350/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/15350/events","html_url":"https://github.com/bevyengine/bevy/issues/15350","id":2540527831,"node_id":"I_kwDODf6-U86XbWDX","number":15350,"title":"Moving components from one entity to another","user":{"login":"urben1680","id":55257931,"node_id":"MDQ6VXNlcjU1MjU3OTMx","avatar_url":"https://avatars.githubusercontent.com/u/55257931?v=4","gravatar_id":"","url":"https://api.github.com/users/urben1680","html_url":"https://github.com/urben1680","followers_url":"https://api.github.com/users/urben1680/followers","following_url":"https://api.github.com/users/urben1680/following{/other_user}","gists_url":"https://api.github.com/users/urben1680/gists{/gist_id}","starred_url":"https://api.github.com/users/urben1680/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/urben1680/subscriptions","organizations_url":"https://api.github.com/users/urben1680/orgs","repos_url":"https://api.github.com/users/urben1680/repos","events_url":"https://api.github.com/users/urben1680/events{/privacy}","received_events_url":"https://api.github.com/users/urben1680/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619326,"node_id":"MDU6TGFiZWwxNzk1NjE5MzI2","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Feature","name":"C-Feature","color":"b8b8b8","default":false,"description":"A new feature, making something new possible"},{"id":2197761682,"node_id":"MDU6TGFiZWwyMTk3NzYxNjgy","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-ECS","name":"A-ECS","color":"c6a751","default":false,"description":"Entities, components, systems, and events"},{"id":2747857990,"node_id":"MDU6TGFiZWwyNzQ3ODU3OTkw","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Usability","name":"C-Usability","color":"b8b8b8","default":false,"description":"A targeted quality-of-life change that makes Bevy easier to use"},{"id":3166143717,"node_id":"MDU6TGFiZWwzMTY2MTQzNzE3","url":"https://api.github.com/repos/bevyengine/bevy/labels/D-Complex","name":"D-Complex","color":"008672","default":false,"description":"Quite challenging from either a design or technical perspective. Ask for help!"},{"id":3166152189,"node_id":"MDU6TGFiZWwzMTY2MTUyMTg5","url":"https://api.github.com/repos/bevyengine/bevy/labels/S-Needs-Design","name":"S-Needs-Design","color":"D876E3","default":false,"description":"This issue requires design work to think about how it would best be accomplished"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-09-21T21:59:01Z","updated_at":"2025-02-06T10:44:02Z","closed_at":"2024-12-16T19:54:59Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## What problem does this solve or what need does it fill?\n\nFor my reversible systems crate I want to support reversible entity commands that do structural changes.\n\nFor example, to create a reversible variant of `EntityCommands::insert`, that takes a `Bundle` as an argument, I first have to move the components that would be overwritten out of the entity so I can make this process undoable.\n\n`BundleInfo` has the methods I need to get the relevant ids including required components. However, there is no further API from here on.\n\n## What solution would you like?\n\nWhat would work is to move components from one entity to another by id(s). A typed variant should be added there too because it does not exist yet. This is an elegant solution because the data structure of storing untyped components is already there: The ECS storages. This might be useful for other use cases as well.\n\n```rs\n// in EntityWorldMut and EntityCommands impl\n\npub fn move<T: Bundle>(&mut self, to: Entity) -> &mut Self;\n\npub fn move_by_id(&mut self, to: Entity, component_id: ComponentId) -> &mut Self;\n\npub fn move_by_ids(\n    &mut self, \n    to: Entity,\n    component_ids: impl IntoIterator<Item = ComponentId>\n) -> &mut Self;\n```\nEach variant should also come with a `_with_requires` variant like https://github.com/bevyengine/bevy/pull/15026 that has the difference to not construct required components at the target entity but to move them from the source entity as well.\n\nHooks should be triggered by these operations.\n\nPanics should happen if either the source or target entity is missing or at least one `ComponentId` is invalid.\n\n### Open questions\n\n- Should this come with variants like `try_insert` that fail silently?\n\n## What alternative(s) have you considered?\n\nAn alternative is to move the components entirely out of the ECS storage as some kind of blob. However, no such type exists yet as far I can tell. It would require extra work to design this blob, also because it needs to support generating `OwningPtr` for reinsertion.\n\nI see no alternative in my untyped context. I could mirror the Bundle trait to create an associated function but that would not work with third-party Bundle implementors that do not implement my trait.\n\nUntil a feature like this comes out I consider to require only tuple bundles for my crate's API with further restrictions on the upcoming required components feature. This probably makes the API very panic-happy. ðŸ«¤ \n\nI see reflection not helping me here as not every component can be reflected.","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/15350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/15350/timeline","performed_via_github_app":null,"state_reason":"completed"}