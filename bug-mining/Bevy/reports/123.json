{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12570","repository_url":"https://api.github.com/repos/bevyengine/bevy","labels_url":"https://api.github.com/repos/bevyengine/bevy/issues/12570/labels{/name}","comments_url":"https://api.github.com/repos/bevyengine/bevy/issues/12570/comments","events_url":"https://api.github.com/repos/bevyengine/bevy/issues/12570/events","html_url":"https://github.com/bevyengine/bevy/issues/12570","id":2194730158,"node_id":"I_kwDODf6-U86C0Oyu","number":12570,"title":"Somethin' ain't right with cardinal splines","user":{"login":"mweatherley","id":2975848,"node_id":"MDQ6VXNlcjI5NzU4NDg=","avatar_url":"https://avatars.githubusercontent.com/u/2975848?v=4","gravatar_id":"","url":"https://api.github.com/users/mweatherley","html_url":"https://github.com/mweatherley","followers_url":"https://api.github.com/users/mweatherley/followers","following_url":"https://api.github.com/users/mweatherley/following{/other_user}","gists_url":"https://api.github.com/users/mweatherley/gists{/gist_id}","starred_url":"https://api.github.com/users/mweatherley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mweatherley/subscriptions","organizations_url":"https://api.github.com/users/mweatherley/orgs","repos_url":"https://api.github.com/users/mweatherley/repos","events_url":"https://api.github.com/users/mweatherley/events{/privacy}","received_events_url":"https://api.github.com/users/mweatherley/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1795619323,"node_id":"MDU6TGFiZWwxNzk1NjE5MzIz","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Bug","name":"C-Bug","color":"d73a4a","default":false,"description":"An unexpected or incorrect behavior"},{"id":1795619324,"node_id":"MDU6TGFiZWwxNzk1NjE5MzI0","url":"https://api.github.com/repos/bevyengine/bevy/labels/C-Docs","name":"C-Docs","color":"B8b8b8","default":false,"description":"An addition or correction to our documentation"},{"id":3166124969,"node_id":"MDU6TGFiZWwzMTY2MTI0OTY5","url":"https://api.github.com/repos/bevyengine/bevy/labels/A-Math","name":"A-Math","color":"c6a751","default":false,"description":"Fundamental domain-agnostic mathematical operations"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-03-19T11:38:27Z","updated_at":"2024-03-21T19:13:45Z","closed_at":"2024-03-21T19:13:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"## The issue\r\n\r\nThere is a mismatch between what the [documentation says](https://docs.rs/bevy/latest/bevy/math/cubic_splines/struct.CubicCardinalSpline.html) and how `CubicCardinalSpline` actually works. Namely, this:\r\n\r\n> ### Interpolation\r\n> \r\n> The curve passes through every control point.\r\n\r\nAs implemented, this is not true. Instead, the curve passes through only the interior control points — that is, it doesn't actually go through the points at the ends.\r\n\r\n## Example\r\n\r\nHere is a complete example (coutesy of @afonsolage):\r\n```rust\r\nuse bevy::math::prelude::*;\r\nuse bevy::math::vec2;\r\n\r\nfn main() {\r\n    let control_points = [\r\n        vec2(-1.0, 50.0),\r\n        vec2(0.3, 100.0),\r\n        vec2(0.4, 150.0),\r\n        vec2(1.0, 150.0),\r\n    ];\r\n\r\n    let curve = CubicCardinalSpline::new(0.1, control_points).to_curve();\r\n\r\n    for position in curve.iter_positions(10) {\r\n        println!(\"Position: {position:?}\");\r\n    }\r\n}\r\n```\r\n\r\nThis produces the following output:\r\n```\r\nPosition: Vec2(0.3, 100.0)\r\nPosition: Vec2(0.31351003, 102.165)\r\nPosition: Vec2(0.32608, 106.32)\r\nPosition: Vec2(0.33777002, 111.955)\r\nPosition: Vec2(0.34864, 118.56)\r\nPosition: Vec2(0.35875, 125.625)\r\nPosition: Vec2(0.36816, 132.64)\r\nPosition: Vec2(0.37693, 139.095)\r\nPosition: Vec2(0.38511997, 144.48)\r\nPosition: Vec2(0.39279, 148.28499)\r\nPosition: Vec2(0.39999998, 150.0)\r\n```\r\n\r\nAs one can see, the curve only extends between 0.3 and 0.4, where the interior control points are defined. If you want it to actually pass through all those points, you need to extend your control sequence to a length of six, so that your desired endpoints become interior.\r\n\r\n## Background\r\n\r\nCardinal splines connect a series of points `P_i` with a sequence of cubic segments between `P_i` and `P_{i+1}` so that:\r\n1. The curve segment `B_i` from `P_i` to `P_{i+1}` starts at `P_i` and ends at `P_{i+1}`\r\n2. The derivatives of `B_i` and `B_{i+1}` at `P_{i+1}` coincide\r\n\r\nProperty (1) happens by using `P_i` and `P_{i+1}` as the outermost control points of the Bézier curve `B_i`. Property (2) is ensured by making the third control point of `B_i`, the second control point of `B_{i+1}`, and `P_{i+1}` all collinear; the point of doing this is that it makes the union of cubic segments differentiable (i.e. it doesn't have \"kinks\"). \r\n\r\nThe general construction is such that the derivative at `P_i` is given by the difference between `P_{i-1}` and `P_{i+1}` — i.e., the tangent to the curve at `P_i` is parallel to the line between the points preceding and following it. I believe this part is implemented at present; however, this aspect of the construction leaves one thing open: what do we do at the endpoints (where `P_{i+1}` or  `P_{i-1}` doesn't exist)?\r\n\r\nA standard choice is to just use the line from `P_0` to `P_1` to determine the tangent at `P_0` (and analogously for the other endpoint). Of course, there are other choices that one could make as well (e.g. just requiring the tangents for those to be specified manually). \r\n\r\nPresently, either by accident or on purpose, we just exclude those points. Either way, we are currently misleading about it.\r\n\r\n## Which way, spline implementor?\r\n\r\n There are basically two paths forward here:\r\n 1. Update the documentation so that it is truthful about how the endpoints are only used to determined the tangents for the interior points.\r\n 2. Update the cardinal spline implementation so that it actually passes through all the control points.\r\n\r\nI think it's pretty clear that I would have not written such a long issue if I did not prefer (2) (which I believe does a good job of meeting expectations and providing ergonomics for curve interpolation between a number of points), but there is a downside: in principle, the current implementation allows the user to indirectly specify the tangent at the endpoints by choosing their control points carefully. (2) is also a breaking change. \r\n\r\nI am unsure if this is a bug or if the implementation is this way intentionally, so I have written it as a docs issue. ","closed_by":{"login":"alice-i-cecile","id":3579909,"node_id":"MDQ6VXNlcjM1Nzk5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/3579909?v=4","gravatar_id":"","url":"https://api.github.com/users/alice-i-cecile","html_url":"https://github.com/alice-i-cecile","followers_url":"https://api.github.com/users/alice-i-cecile/followers","following_url":"https://api.github.com/users/alice-i-cecile/following{/other_user}","gists_url":"https://api.github.com/users/alice-i-cecile/gists{/gist_id}","starred_url":"https://api.github.com/users/alice-i-cecile/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alice-i-cecile/subscriptions","organizations_url":"https://api.github.com/users/alice-i-cecile/orgs","repos_url":"https://api.github.com/users/alice-i-cecile/repos","events_url":"https://api.github.com/users/alice-i-cecile/events{/privacy}","received_events_url":"https://api.github.com/users/alice-i-cecile/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bevyengine/bevy/issues/12570/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bevyengine/bevy/issues/12570/timeline","performed_via_github_app":null,"state_reason":"completed"}