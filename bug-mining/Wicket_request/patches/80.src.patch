diff --git a/wicket-request/src/main/java/org/apache/wicket/request/UrlRenderer.java b/wicket-request/src/main/java/org/apache/wicket/request/UrlRenderer.java
index 2ab1a3128f..3bbe5d1a4c 100644
--- a/wicket-request/src/main/java/org/apache/wicket/request/UrlRenderer.java
+++ b/wicket-request/src/main/java/org/apache/wicket/request/UrlRenderer.java
@@ -24,6 +24,8 @@ import java.util.Map;
 import org.apache.wicket.util.lang.Args;
 import org.apache.wicket.util.string.PrependingStringBuffer;
 import org.apache.wicket.util.string.Strings;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
 
 /**
  * Takes care of rendering URLs.
@@ -37,6 +39,8 @@ import org.apache.wicket.util.string.Strings;
  */
 public class UrlRenderer
 {
+	private static final Logger LOG = LoggerFactory.getLogger(UrlRenderer.class);
+
 	private static final Map<String, Integer> PROTO_TO_PORT = new HashMap<String, Integer>();
 	static
 	{
@@ -211,6 +215,9 @@ public class UrlRenderer
 		List<String> baseUrlSegments = getBaseUrl().getSegments();
 		List<String> urlSegments = new ArrayList<String>(url.getSegments());
 
+		removeCommonPrefixes(request, baseUrlSegments);
+		removeCommonPrefixes(request, urlSegments);
+
 		List<String> newSegments = new ArrayList<String>();
 
 		int common = 0;
@@ -265,6 +272,51 @@ public class UrlRenderer
 		return renderedUrl;
 	}
 
+	/**
+	 * Removes common prefixes like empty first segment, context path and filter path
+	 *
+	 * @param request
+	 *      the current web request
+	 * @param segments
+	 *      the segments to clean
+	 */
+	private void removeCommonPrefixes(Request request, List<String> segments)
+	{
+		if (segments.isEmpty())
+		{
+			return;
+		}
+
+		if ("".equals(segments.get(0)))
+		{
+			LOG.debug("Removing an empty first segment from '{}'", segments);
+			segments.remove(0);
+		}
+
+		String contextPath = request.getContextPath();
+		if (contextPath != null)
+		{
+			if (segments.isEmpty() == false)
+			{
+				if (contextPath.equals(UrlUtils.normalizePath(segments.get(0))))
+				{
+					LOG.debug("Removing the context path '{}' from '{}'", contextPath, segments);
+					segments.remove(0);
+				}
+			}
+		}
+
+		String filterPath = request.getFilterPath();
+		if (filterPath != null && segments.isEmpty() == false)
+		{
+			if (filterPath.equals(UrlUtils.normalizePath(segments.get(0))))
+			{
+				LOG.debug("Removing the filter path '{}' from '{}'", filterPath, segments);
+				segments.remove(0);
+			}
+		}
+	}
+
 	/**
 	 * Determines whether a URL should be rendered in its full form
 	 * 
diff --git a/wicket-request/src/main/java/org/apache/wicket/request/UrlUtils.java b/wicket-request/src/main/java/org/apache/wicket/request/UrlUtils.java
new file mode 100644
index 0000000000..10f4bf8f1c
--- /dev/null
+++ b/wicket-request/src/main/java/org/apache/wicket/request/UrlUtils.java
@@ -0,0 +1,101 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.wicket.request;
+
+import org.apache.wicket.util.string.Strings;
+
+/**
+ * Various url utilities
+ *
+ * @author igor.vaynberg
+ */
+public class UrlUtils
+{
+	/**
+	 * Constructor
+	 */
+	// TODO make it private in Wicket 7.0
+	protected UrlUtils()
+	{
+
+	}
+
+	/**
+	 * Checks if the url is relative or absolute
+	 *
+	 * @param url
+	 * @return <code>true</code> if url is relative, <code>false</code> otherwise
+	 */
+	public static boolean isRelative(final String url)
+	{
+		// the regex means "doesn't start with 'scheme://'"
+		if ((url != null) && (url.startsWith("/") == false) && (!url.matches("^\\w+\\:\\/\\/.*")) &&
+			!(url.startsWith("#")))
+		{
+			return true;
+		}
+		else
+		{
+			return false;
+		}
+	}
+
+	/**
+	 * Rewrites a relative url to be context relative, leaves absolute urls same.
+	 *
+	 * @param url
+	 * @param requestCycle
+	 * @return rewritten url
+	 */
+	public static String rewriteToContextRelative(String url, IRequestCycle requestCycle)
+	{
+		if (isRelative(url))
+		{
+			return requestCycle.getUrlRenderer().renderContextRelativeUrl(url);
+		}
+		else
+		{
+			return url;
+		}
+	}
+
+	/**
+	 * Makes sure the path starts with a slash and does not end with a slash. Empty or null paths
+	 * are normalized into an empty string.
+	 *
+	 * @param path
+	 *            path to normalize
+	 * @return normalized path
+	 */
+	public static String normalizePath(String path)
+	{
+		if (Strings.isEmpty(path))
+		{
+			return "";
+		}
+		path = path.trim();
+		if (!path.startsWith("/"))
+		{
+			path = "/" + path;
+		}
+		if (path.endsWith("/"))
+		{
+			path = path.substring(0, path.length() - 1);
+		}
+		return path;
+	}
+}
\ No newline at end of file
diff --git a/wicket-request/src/test/java/org/apache/wicket/request/UrlUtilsTest.java b/wicket-request/src/test/java/org/apache/wicket/request/UrlUtilsTest.java
new file mode 100644
index 0000000000..fc1375328d
--- /dev/null
+++ b/wicket-request/src/test/java/org/apache/wicket/request/UrlUtilsTest.java
@@ -0,0 +1,61 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.wicket.request;
+
+import static org.junit.Assert.assertEquals;
+import static org.junit.Assert.assertFalse;
+import static org.junit.Assert.assertTrue;
+
+import org.junit.Test;
+
+/**
+ * Tests for {@link UrlUtils}
+ */
+public class UrlUtilsTest
+{
+
+	/**	 */
+	@Test
+	public void isRelative()
+	{
+		assertTrue(UrlUtils.isRelative("./mypage?return=http://example.com"));
+		assertTrue(UrlUtils.isRelative("./path/path2?param1=value1"));
+		assertFalse(UrlUtils.isRelative("http://example.com"));
+		assertFalse(UrlUtils.isRelative("https://example.com"));
+		assertFalse(UrlUtils.isRelative("ftp://example.com"));
+	}
+
+	/**	 */
+	@Test
+	public void normalizePath()
+	{
+		// test basic normalization
+		assertEquals("/foo/bar", UrlUtils.normalizePath("foo/bar"));
+		assertEquals("/foo/bar", UrlUtils.normalizePath("foo/bar/"));
+		assertEquals("/foo/bar", UrlUtils.normalizePath("/foo/bar"));
+		assertEquals("/foo/bar", UrlUtils.normalizePath("/foo/bar/"));
+
+		// test empty string normalization
+		assertEquals("", UrlUtils.normalizePath(null));
+		assertEquals("", UrlUtils.normalizePath(""));
+		assertEquals("", UrlUtils.normalizePath("/"));
+
+		// test trimming
+		assertEquals("", UrlUtils.normalizePath(" / "));
+		assertEquals("/foo/bar", UrlUtils.normalizePath("  foo/bar/  "));
+	}
+}
