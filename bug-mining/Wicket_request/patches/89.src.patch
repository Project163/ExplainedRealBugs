diff --git a/wicket-request/src/main/java/org/apache/wicket/request/UrlRenderer.java b/wicket-request/src/main/java/org/apache/wicket/request/UrlRenderer.java
index 028dd0170d..4217fbe264 100644
--- a/wicket-request/src/main/java/org/apache/wicket/request/UrlRenderer.java
+++ b/wicket-request/src/main/java/org/apache/wicket/request/UrlRenderer.java
@@ -275,46 +275,36 @@ public class UrlRenderer
 	}
 
 	/**
-	 * Removes common prefixes like empty first segment, context path and filter path
-	 *
+	 * Removes common prefixes like empty first segment, context path and filter path.
+	 * 
 	 * @param request
-	 *      the current web request
+	 *            the current web request
 	 * @param segments
-	 *      the segments to clean
+	 *            the segments to clean
 	 */
 	private void removeCommonPrefixes(Request request, List<String> segments)
 	{
-		if (segments.isEmpty())
+		// try to remove context/filter path only if the Url starts with '/',
+		// i.e. has an empty segment in the beginning
+		if (segments.isEmpty() || "".equals(segments.get(0)) == false)
 		{
 			return;
 		}
 
-		if ("".equals(segments.get(0)))
-		{
-			LOG.debug("Removing an empty first segment from '{}'", segments);
-			segments.remove(0);
+		Url commonPrefix = Url.parse(request.getContextPath() + request.getFilterPath());
 
-			// try to remove context/filter path only if the Url starts with '/',
-			//  i.e. has an empty segment in the beginning
-			String contextPath = request.getContextPath();
-			if (contextPath != null && segments.isEmpty() == false)
+		for (int i = 0; i < commonPrefix.getSegments().size() && i < segments.size(); i++)
+		{
+			if (commonPrefix.getSegments().get(i).equals(segments.get(i)) == false)
 			{
-				if (contextPath.equals(UrlUtils.normalizePath(segments.get(0))))
-				{
-					LOG.debug("Removing the context path '{}' from '{}'", contextPath, segments);
-					segments.remove(0);
-				}
+				LOG.debug("Segments '{}' do not start with common prefix '{}'", segments, commonPrefix);
+				return;
 			}
+		}
 
-			String filterPath = request.getFilterPath();
-			if (filterPath != null && segments.isEmpty() == false)
-			{
-				if (filterPath.equals(UrlUtils.normalizePath(segments.get(0))))
-				{
-					LOG.debug("Removing the filter path '{}' from '{}'", filterPath, segments);
-					segments.remove(0);
-				}
-			}
+		for (int i = 0; i < commonPrefix.getSegments().size(); i++)
+		{
+			segments.remove(0);
 		}
 	}
 
