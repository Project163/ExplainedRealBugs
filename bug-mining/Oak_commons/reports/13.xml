<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:46:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-2389] issues with JsopBuilder.encode and .escape</title>
                <link>https://issues.apache.org/jira/browse/OAK-2389</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;1) escape() escapes many characters that do not need to be escaped (&amp;gt;127)&lt;/p&gt;

&lt;p&gt;2) encode() does not encode many control characters that would need to be escaped when read through a JSON parser.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12766847">OAK-2389</key>
            <summary>issues with JsopBuilder.encode and .escape</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reschke">Julian Reschke</assignee>
                                    <reporter username="reschke">Julian Reschke</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 Jan 2015 13:43:25 +0000</created>
                <updated>Tue, 8 Oct 2019 15:21:36 +0000</updated>
                            <resolved>Tue, 27 Jan 2015 17:20:08 +0000</resolved>
                                    <version>1.0.9</version>
                    <version>1.1.5</version>
                                    <fixVersion>1.0.12</fixVersion>
                    <fixVersion>1.1.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14273684" author="reschke" created="Mon, 12 Jan 2015 15:18:11 +0000"  >&lt;p&gt;escape() wasn&apos;t used anywhere other than test case.&lt;/p&gt;

&lt;p&gt;encode() does seem to be JSOP-specific and probably just needs fixed documentation.&lt;/p&gt;</comment>
                            <comment id="14273685" author="reschke" created="Mon, 12 Jan 2015 15:19:36 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;adds signature without string length&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;removes escaping of characters that do not need to be escaped&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;changes control escaping logic to use a lookup table&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;updates test expectations&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14273686" author="reschke" created="Mon, 12 Jan 2015 15:20:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thomasm&quot; class=&quot;user-hover&quot; rel=&quot;thomasm&quot;&gt;thomasm&lt;/a&gt; can you review?&lt;/p&gt;</comment>
                            <comment id="14275201" author="tmueller" created="Tue, 13 Jan 2015 13:48:18 +0000"  >&lt;p&gt;Slightly different patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Faster JsopBuilder.encode(String s) if no escape is needed but there are characters &amp;gt;= 127&lt;/li&gt;
	&lt;li&gt;No need for constants 0000 - 001f&lt;/li&gt;
	&lt;li&gt;Use &quot;case&quot; instead of &quot;if / else if / else if&quot; should be a tiny bit faster&lt;/li&gt;
	&lt;li&gt;Slightly more tests for those cases&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14275224" author="reschke" created="Tue, 13 Jan 2015 14:06:37 +0000"  >&lt;p&gt;a) Can we please document what encode() is for? It&apos;s not for JSON, as far as can tell.&lt;/p&gt;

&lt;p&gt;b) I prefer the constants as they generate both more readable and more compact output for the common control characters&lt;/p&gt;

&lt;p&gt;c) I don&apos;t see &quot;case&quot; in the source&lt;/p&gt;</comment>
                            <comment id="14285705" author="reschke" created="Wed, 21 Jan 2015 14:53:58 +0000"  >&lt;p&gt;Left to do:&lt;/p&gt;

&lt;p&gt;a) a test case that checks for round-tripping of broken surrogate pairs&lt;/p&gt;

&lt;p&gt;b) potentially a fix for the encode() method&lt;/p&gt;</comment>
                            <comment id="14289517" author="reschke" created="Fri, 23 Jan 2015 16:59:23 +0000"  >&lt;p&gt;I&apos;d like to have a test case to check this.&lt;/p&gt;

&lt;p&gt;Questions:&lt;/p&gt;

&lt;p&gt;1) does our standard build cover the persistent cache?&lt;br/&gt;
2) if we did a test on the JCR level, do we have a way to disable a memory cache (which might make problems in the persisted value invisible?)&lt;/p&gt;</comment>
                            <comment id="14291517" author="tmueller" created="Mon, 26 Jan 2015 07:01:22 +0000"  >&lt;p&gt;&amp;gt;  Can we please document what encode() is for? It&apos;s not for JSON, as far as can tell.&lt;/p&gt;

&lt;p&gt;JsopBuilder.encode is documented (&quot;Convert a string to a quoted Json literal using the correct escape sequences...&quot;). It is for JSON, see usages of that method. I&apos;m not sure if you mean another encode?&lt;/p&gt;

&lt;p&gt;&amp;gt; I don&apos;t see &quot;case&quot; in the source&lt;/p&gt;

&lt;p&gt;JsopBuilder.escape, line 289.&lt;/p&gt;

&lt;p&gt;&amp;gt; I prefer the constants as they generate both more readable and more compact output&lt;/p&gt;

&lt;p&gt;I think the current &quot;switch / case&quot; actually generated more readable output than the array of substitution strings. But it is debatable, I understand.&lt;/p&gt;

&lt;p&gt;&amp;gt; a test case that checks for round-tripping of broken surrogate pairs&lt;/p&gt;

&lt;p&gt;OK, I will try that.&lt;/p&gt;

&lt;p&gt;&amp;gt; potentially a fix for the encode() method&lt;/p&gt;

&lt;p&gt;That&apos;s fixed now. It should be possible to write a test, I will try.&lt;/p&gt;

&lt;p&gt;&amp;gt; does our standard build cover the persistent cache?&lt;/p&gt;

&lt;p&gt;Not yet, I think. I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/OAK-2444&quot; title=&quot;Enable the persistent cache by default&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OAK-2444&quot;&gt;&lt;del&gt;OAK-2444&lt;/del&gt;&lt;/a&gt; for that.&lt;/p&gt;

&lt;p&gt;&amp;gt; if we did a test on the JCR level, do we have a way to disable a memory cache (which might make problems in the persisted value invisible?)&lt;/p&gt;

&lt;p&gt;Sorry I don&apos;t understand. Do you mean it prevents &quot;real&quot; tests for the persistent cache? Yes that&apos;s true. Probably testing with a small in-memory cache would help there.&lt;/p&gt;
</comment>
                            <comment id="14291530" author="reschke" created="Mon, 26 Jan 2015 07:27:28 +0000"  >&lt;p&gt;Yes, that&apos;s what I meant; it currently would be hard to test the persistent cache in black box tests, as the use of a local memory cache might hide problems in the persistent cache&apos;s persistence.&lt;/p&gt;</comment>
                            <comment id="14291595" author="tmueller" created="Mon, 26 Jan 2015 09:02:23 +0000"  >&lt;p&gt;Revision 1654743: fixed JsopBuilder.encode and added a test case. There was a test for broken surrogate pairs at JsopTest.testSurrogates, I extended that one.&lt;/p&gt;


</comment>
                            <comment id="14291597" author="tmueller" created="Mon, 26 Jan 2015 09:03:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reschke&quot; class=&quot;user-hover&quot; rel=&quot;reschke&quot;&gt;reschke&lt;/a&gt; anything left to do here? I will close if it not.&lt;/p&gt;</comment>
                            <comment id="14291666" author="reschke" created="Mon, 26 Jan 2015 10:38:04 +0000"  >&lt;p&gt;I did a tiny Javadoc improvement; I think this can be closed now.&lt;/p&gt;

&lt;p&gt;(We should backport to 1.0, right?)&lt;/p&gt;</comment>
                            <comment id="14291667" author="reschke" created="Mon, 26 Jan 2015 10:38:08 +0000"  >&lt;p&gt;I did a tiny Javadoc improvement; I think this can be closed now.&lt;/p&gt;

&lt;p&gt;(We should backport to 1.0, right?)&lt;/p&gt;</comment>
                            <comment id="14293639" author="tmueller" created="Tue, 27 Jan 2015 15:01:57 +0000"  >&lt;p&gt;Backport to 1.0: I think it is not needed right now, but I don&apos;t mind if you want to do it. If you think it is better to backport, then let&apos;s keep this bug open until it is backported (and we would need to add the respective &quot;fix version&quot;).&lt;/p&gt;</comment>
                            <comment id="14293676" author="reschke" created="Tue, 27 Jan 2015 15:20:10 +0000"  >&lt;p&gt;OK, I will backport.&lt;/p&gt;</comment>
                            <comment id="14354665" author="mreutegg" created="Tue, 10 Mar 2015 10:46:00 +0000"  >&lt;p&gt;Bulk close for Oak 1.0.12.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12764923">OAK-2376</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12691945" name="OAK-2389-b.diff" size="6356" author="thomasm" created="Tue, 13 Jan 2015 13:48:18 +0000"/>
                            <attachment id="12691658" name="OAK-2389.diff" size="5872" author="reschke" created="Mon, 12 Jan 2015 15:19:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i249ev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>