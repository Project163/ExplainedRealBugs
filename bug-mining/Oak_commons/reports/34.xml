<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:46:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OAK-6596] Blob store consistency check can show bogus errors about missing blobs</title>
                <link>https://issues.apache.org/jira/browse/OAK-6596</link>
                <project id="12313221" key="OAK">Jackrabbit Oak</project>
                    <description>&lt;p&gt;While running a blob store consistency check on an AEM 6.3 instance, I&apos;ve noticed a large amount of blobs reported missing. When I checked the list of the missing blobs, I couldn&apos;t find any that was actually missing. After investigating the Oak sources, I could narrow the issue down to the code that&apos;s sorting the marked blob references. It&apos;s supposed to remove duplicates while sorting, but it doesn&apos;t remove all of them in some circumstances. The duplicates then show up as bogus missing blobs since they aren&apos;t matched by an equal number of duplicate lines in the &quot;available blobs&quot; list.&lt;/p&gt;

&lt;p&gt;As far as I can tell, the bug only manifests on installations that use DocumentNodeStore (causing the marked blob IDs to also contain the referencing node) and only if the number of blobs in the blob store reaches a certain threshold (causing the sort code to sort in chunks and merge, instead of sorting everything in memory at once). This means it&apos;s not easy to reproduce in a development environment where you only have dummy content.&lt;/p&gt;

&lt;p&gt;I&apos;ll attach to this ticket a proposed patch that contains a fix and a test case that verifies the correct merge logic. Please let me know if you also need reproduction steps to work on this, but I&apos;d rather not do it because the only place I can reproduce this has a blobstore over 1TB in size.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13098321">OAK-6596</key>
            <summary>Blob store consistency check can show bogus errors about missing blobs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amitjain">Amit Jain</assignee>
                                    <reporter username="Csaba Varga">Csaba Varga</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Aug 2017 16:40:09 +0000</created>
                <updated>Fri, 8 Sep 2017 13:02:09 +0000</updated>
                            <resolved>Wed, 30 Aug 2017 07:07:39 +0000</resolved>
                                    <version>1.7.6</version>
                                    <fixVersion>1.7.7</fixVersion>
                    <fixVersion>1.6.5</fixVersion>
                    <fixVersion>1.8.0</fixVersion>
                                    <component>blob-plugins</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16145637" author="csaba varga" created="Tue, 29 Aug 2017 16:42:15 +0000"  >&lt;p&gt;Attached patch against the trunk, including a test case.&lt;/p&gt;

&lt;p&gt;If it&apos;s not a big effort, can we have this backported to the 1.6 branch as well?&lt;/p&gt;</comment>
                            <comment id="16146787" author="amitjain" created="Wed, 30 Aug 2017 07:07:39 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Csaba+Varga&quot; class=&quot;user-hover&quot; rel=&quot;Csaba Varga&quot;&gt;Csaba Varga&lt;/a&gt; for the fix.&lt;br/&gt;
Committed to trunk with &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1806668&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1806668&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
and 1.6 branch with &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1806669&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1806669&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16158594" author="edivad" created="Fri, 8 Sep 2017 13:02:09 +0000"  >&lt;p&gt;Bulk close 1.6.5&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12884292" name="sort_merge.patch" size="4454" author="Csaba Varga" created="Tue, 29 Aug 2017 16:40:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 10 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3jetj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>