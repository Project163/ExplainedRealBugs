diff --git a/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/FileIOUtils.java b/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/FileIOUtils.java
index 71c4d6fd4d..e5ed5be946 100644
--- a/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/FileIOUtils.java
+++ b/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/FileIOUtils.java
@@ -52,7 +52,6 @@ import static com.google.common.io.Files.asByteSink;
 import static com.google.common.io.Files.move;
 import static com.google.common.io.Files.newWriter;
 import static java.io.File.createTempFile;
-import static org.apache.commons.io.FileUtils.copyInputStreamToFile;
 import static org.apache.commons.io.FileUtils.forceDelete;
 import static org.apache.commons.io.IOUtils.closeQuietly;
 import static org.apache.commons.io.IOUtils.copyLarge;
@@ -316,6 +315,26 @@ public final class FileIOUtils {
         });
     }
 
+    /**
+     *
+     * Copy the input stream to the given file. Delete the file in case of exception.
+     *
+     * @param source the input stream source
+     * @param destination the file to write to
+     * @throws IOException
+     */
+    public static void copyInputStreamToFile(final InputStream source, final File destination) throws IOException {
+        boolean success = false;
+        try {
+            FileUtils.copyInputStreamToFile(source, destination);
+            success = true;
+        } finally {
+            if (!success) {
+                forceDelete(destination);
+            }
+        }
+    }
+
     /**
      * Decorates the given comparator and applies the function before delegating to the decorated
      * comparator.
diff --git a/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/package-info.java b/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/package-info.java
index 9f14a6a5d1..a0e74693ee 100644
--- a/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/package-info.java
+++ b/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/package-info.java
@@ -14,7 +14,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-@Version("1.0.0")
+@Version("1.1.0")
 package org.apache.jackrabbit.oak.commons;
 
-import org.osgi.annotation.versioning.Version;
\ No newline at end of file
+import org.osgi.annotation.versioning.Version;
diff --git a/oak-commons/src/test/java/org/apache/jackrabbit/oak/commons/FileIOUtilsTest.java b/oak-commons/src/test/java/org/apache/jackrabbit/oak/commons/FileIOUtilsTest.java
index a9fcbe5af9..b42c5cf3c9 100644
--- a/oak-commons/src/test/java/org/apache/jackrabbit/oak/commons/FileIOUtilsTest.java
+++ b/oak-commons/src/test/java/org/apache/jackrabbit/oak/commons/FileIOUtilsTest.java
@@ -22,6 +22,7 @@ import java.io.BufferedReader;
 import java.io.ByteArrayInputStream;
 import java.io.File;
 import java.io.FileInputStream;
+import java.io.FileNotFoundException;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.InputStreamReader;
@@ -49,7 +50,6 @@ import org.apache.jackrabbit.oak.commons.FileIOUtils.BurnOnCloseFileIterator;
 import org.junit.Assert;
 import org.junit.Rule;
 import org.junit.Test;
-import org.junit.rules.ExpectedException;
 import org.junit.rules.TemporaryFolder;
 
 import static com.google.common.base.Charsets.UTF_8;
@@ -398,6 +398,32 @@ public class FileIOUtilsTest {
         assertTrue(!f.exists());
     }
 
+    @Test
+    public void copyStreamToFile() throws Exception {
+        Set<String> added = newHashSet("a", "z", "e", "b");
+        File f = assertWrite(added.iterator(), false, added.size());
+
+        File f2 = folder.newFile();
+        FileIOUtils.copyInputStreamToFile(new FileInputStream(f), f2);
+        assertEquals(added, readStringsAsSet(new FileInputStream(f), false));
+        assertTrue(f.exists());
+    }
+
+    @Test
+    public void copyStreamToFileNoPartialCreation() throws Exception {
+        File f = folder.newFile();
+        FileIOUtils.copyInputStreamToFile(randomStream(12, 8192), f);
+
+        File f2 = folder.newFile();
+        try {
+            FileIOUtils.copyInputStreamToFile(new ErrorInputStream(f, 4096), f2);
+            Assert.fail("Should have failed with IOException");
+        } catch (Exception e) {}
+
+        assertTrue(f.exists());
+        assertTrue(!f2.exists());
+    }
+
     private static List<String> getLineBreakStrings() {
         return newArrayList("ab\nc\r", "ab\\z", "a\\\\z\nc",
             "/a", "/a/b\nc", "/a/b\rd", "/a/b\r\ne", "/a/c");
@@ -453,4 +479,26 @@ public class FileIOUtilsTest {
         r.nextBytes(data);
         return new ByteArrayInputStream(data);
     }
+
+    /**
+     * Throws error after reading partially defined by max
+     */
+    private static class ErrorInputStream extends FileInputStream {
+        private long bytesread;
+        private long max;
+
+        ErrorInputStream(File file, long max) throws FileNotFoundException {
+            super(file);
+            this.max = max;
+        }
+
+        @Override
+        public int read(byte b[]) throws IOException {
+            bytesread += b.length;
+            if (bytesread > max) {
+                throw new IOException("Disconnected");
+            }
+            return super.read(b);
+        }
+    }
 }
