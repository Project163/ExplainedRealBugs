diff --git a/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/IOUtils.java b/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/IOUtils.java
index 07b8b8075a..81f078a2c0 100644
--- a/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/IOUtils.java
+++ b/oak-commons/src/main/java/org/apache/jackrabbit/oak/commons/IOUtils.java
@@ -274,17 +274,20 @@ public final class IOUtils {
 
     /**
      * Get the value that is equal or higher than this value, and that is a
-     * power of two.
+     * power of two.  The returned value will be in the range [0, 2^31].
+     * If the input is less than zero, the result of 1 is returned (powers of
+     * negative numbers are not integer values).
      *
-     * @param x the original value
-     * @return the next power of two value
+     * @param x the original value.
+     * @return the next power of two value.  Results are always in the
+     * range [0, 2^31].
      */
-    public static int nextPowerOf2(int x) {
+    public static long nextPowerOf2(int x) {
         long i = 1;
-        while (i < x && i < (Integer.MAX_VALUE / 2)) {
+        while (i < x) {
             i += i;
         }
-        return (int) i;
+        return i;
     }
 
     /**
diff --git a/oak-commons/src/test/java/org/apache/jackrabbit/oak/commons/IOUtilsTest.java b/oak-commons/src/test/java/org/apache/jackrabbit/oak/commons/IOUtilsTest.java
index 19a27af45a..692131a435 100644
--- a/oak-commons/src/test/java/org/apache/jackrabbit/oak/commons/IOUtilsTest.java
+++ b/oak-commons/src/test/java/org/apache/jackrabbit/oak/commons/IOUtilsTest.java
@@ -250,6 +250,30 @@ public class IOUtilsTest extends TestCase {
         }
     }
 
+    public void testNextPowerOf2() {
+        assertEquals(1L, IOUtils.nextPowerOf2(0));
+        assertEquals(1L, IOUtils.nextPowerOf2(1));
+        assertEquals(2L, IOUtils.nextPowerOf2(2));
+        assertEquals(4L, IOUtils.nextPowerOf2(3));
+        assertEquals(4L, IOUtils.nextPowerOf2(4));
+        assertEquals(8L, IOUtils.nextPowerOf2(5));
+        assertEquals(8L, IOUtils.nextPowerOf2(7));
+        assertEquals(8L, IOUtils.nextPowerOf2(8));
+        assertEquals(16L, IOUtils.nextPowerOf2(12)); // it is powers of 2, not evens
+        assertEquals(32L, IOUtils.nextPowerOf2(21)); // random mid-range number
+
+        // Test values around the upper limit of powers of 2 in the signed int range
+        assertEquals(0x01L << (Integer.SIZE-2), IOUtils.nextPowerOf2(Integer.MAX_VALUE >> 1));
+        assertEquals(0x01L << (Integer.SIZE-2), IOUtils.nextPowerOf2((Integer.MAX_VALUE >> 1) + 1));
+        assertEquals( 0x01L << ((long)Integer.SIZE - 1L), IOUtils.nextPowerOf2((Integer.MAX_VALUE >> 1) + 2));
+        assertEquals(0x01L << ((long)Integer.SIZE - 1L), IOUtils.nextPowerOf2(Integer.MAX_VALUE));
+
+        // Negative values
+        assertEquals(1L, IOUtils.nextPowerOf2(-1));
+        assertEquals(1L, IOUtils.nextPowerOf2(-2));
+        assertEquals(1L, IOUtils.nextPowerOf2(Integer.MIN_VALUE));
+    }
+
     private static void testVarInt(int x, int expectedLen) throws IOException {
         ByteArrayOutputStream out = new ByteArrayOutputStream();
         IOUtils.writeVarInt(out, x);
