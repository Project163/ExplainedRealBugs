diff --git a/httpcore5-h2/src/main/java/org/apache/hc/core5/http2/hpack/HPackDecoder.java b/httpcore5-h2/src/main/java/org/apache/hc/core5/http2/hpack/HPackDecoder.java
index 1df29a258..3f35676b2 100644
--- a/httpcore5-h2/src/main/java/org/apache/hc/core5/http2/hpack/HPackDecoder.java
+++ b/httpcore5-h2/src/main/java/org/apache/hc/core5/http2/hpack/HPackDecoder.java
@@ -193,6 +193,9 @@ int decodeString(final ByteBuffer src, final StringBuilder buf) throws HPackExce
         clearState();
         decodeString(this.contentBuf, src);
         final int binaryLen = this.contentBuf.length();
+        if (binaryLen == 0) {
+            return 0;
+        }
         if (this.charsetDecoder == null) {
             buf.ensureCapacity(binaryLen);
             for (int i = 0; i < binaryLen; i++) {
diff --git a/httpcore5-h2/src/main/java/org/apache/hc/core5/http2/hpack/HPackEncoder.java b/httpcore5-h2/src/main/java/org/apache/hc/core5/http2/hpack/HPackEncoder.java
index 621bdf4cf..c58218792 100644
--- a/httpcore5-h2/src/main/java/org/apache/hc/core5/http2/hpack/HPackEncoder.java
+++ b/httpcore5-h2/src/main/java/org/apache/hc/core5/http2/hpack/HPackEncoder.java
@@ -166,19 +166,21 @@ int encodeString(
             }
             return len;
         }
-        final CharBuffer in = CharBuffer.wrap(charSequence, off, len);
-        while (in.hasRemaining()) {
-            ensureCapacity((int) (in.remaining() * this.charsetEncoder.averageBytesPerChar()) + 8);
-            final CoderResult result = this.charsetEncoder.encode(in, this.tmpBuf, true);
+        if (charSequence.length() > 0) {
+            final CharBuffer in = CharBuffer.wrap(charSequence, off, len);
+            while (in.hasRemaining()) {
+                ensureCapacity((int) (in.remaining() * this.charsetEncoder.averageBytesPerChar()) + 8);
+                final CoderResult result = this.charsetEncoder.encode(in, this.tmpBuf, true);
+                if (result.isError()) {
+                    result.throwException();
+                }
+            }
+            ensureCapacity(8);
+            final CoderResult result = this.charsetEncoder.flush(this.tmpBuf);
             if (result.isError()) {
                 result.throwException();
             }
         }
-        ensureCapacity(8);
-        final CoderResult result = this.charsetEncoder.flush(this.tmpBuf);
-        if (result.isError()) {
-            result.throwException();
-        }
         this.tmpBuf.flip();
         final int binaryLen = this.tmpBuf.remaining();
         encodeString(dst, this.tmpBuf, huffman);
diff --git a/httpcore5-h2/src/test/java/org/apache/hc/core5/http2/hpack/TestHPackCoding.java b/httpcore5-h2/src/test/java/org/apache/hc/core5/http2/hpack/TestHPackCoding.java
index 7674b533e..47dc1ce7f 100644
--- a/httpcore5-h2/src/test/java/org/apache/hc/core5/http2/hpack/TestHPackCoding.java
+++ b/httpcore5-h2/src/test/java/org/apache/hc/core5/http2/hpack/TestHPackCoding.java
@@ -1065,5 +1065,33 @@ public void testHeaderSizeLimit() throws Exception {
                 decoder.decodeHeaders(wrap(buf)));
     }
 
+    @Test
+    public void testHeaderEmptyASCII() throws Exception {
+
+        final HPackEncoder encoder = new HPackEncoder(StandardCharsets.US_ASCII);
+        final HPackDecoder decoder = new HPackDecoder(StandardCharsets.US_ASCII);
+
+        final ByteArrayBuffer buf = new ByteArrayBuffer(128);
+
+        final Header header = new BasicHeader("empty-header", "");
+        encoder.encodeHeader(buf, header);
+
+        assertHeaderEquals(header, decoder.decodeHeader(wrap(buf)));
+    }
+
+    @Test
+    public void testHeaderEmptyUTF8() throws Exception {
+
+        final HPackEncoder encoder = new HPackEncoder(StandardCharsets.UTF_8);
+        final HPackDecoder decoder = new HPackDecoder(StandardCharsets.UTF_8);
+
+        final ByteArrayBuffer buf = new ByteArrayBuffer(128);
+
+        final Header header = new BasicHeader("empty-header", "");
+        encoder.encodeHeader(buf, header);
+
+        assertHeaderEquals(header, decoder.decodeHeader(wrap(buf)));
+    }
+
 }
 
