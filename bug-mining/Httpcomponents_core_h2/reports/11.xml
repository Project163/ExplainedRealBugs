<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:23:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-704] CharsetDecoder exception</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-704</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;When trying to download a file from &lt;a href=&quot;https://lei.kdpw.pl/DownloadCFFull.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lei.kdpw.pl/DownloadCFFull.aspx&lt;/a&gt; using async client I get an exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalStateException: Current state = RESET, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; state = FLUSHED
	at java.base/java.nio.charset.CharsetDecoder.throwIllegalStateException(CharsetDecoder.java:989)
	at java.base/java.nio.charset.CharsetDecoder.flush(CharsetDecoder.java:672)
	at org.apache.hc.core5.http2.hpack.HPackDecoder.decodeString(HPackDecoder.java:211)
	at org.apache.hc.core5.http2.hpack.HPackDecoder.decodeLiteralHeader(HPackDecoder.java:242)
	at org.apache.hc.core5.http2.hpack.HPackDecoder.decodeHPackHeader(HPackDecoder.java:273)
	at org.apache.hc.core5.http2.hpack.HPackDecoder.decodeHeaders(HPackDecoder.java:297)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.decodeHeaders(AbstractH2StreamMultiplexer.java:1052)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.consumeHeaderFrame(AbstractH2StreamMultiplexer.java:1067)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.consumeFrame(AbstractH2StreamMultiplexer.java:770)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2StreamMultiplexer.onInput(AbstractH2StreamMultiplexer.java:444)
	at org.apache.hc.core5.http2.impl.nio.AbstractH2IOEventHandler.inputReady(AbstractH2IOEventHandler.java:65)
	at org.apache.hc.core5.http2.impl.nio.ClientH2IOEventHandler.inputReady(ClientH2IOEventHandler.java:39)
	at org.apache.hc.client5.http.impl.async.LoggingIOSession$1.inputReady(LoggingIOSession.java:238)
	at org.apache.hc.core5.reactor.ssl.SSLIOSession.decryptData(SSLIOSession.java:549)
	at org.apache.hc.core5.reactor.ssl.SSLIOSession.access$400(SSLIOSession.java:72)
	at org.apache.hc.core5.reactor.ssl.SSLIOSession$1.inputReady(SSLIOSession.java:172)
	at org.apache.hc.core5.reactor.InternalDataChannel.onIOEvent(InternalDataChannel.java:131)
	at org.apache.hc.core5.reactor.InternalChannel.handleIOEvent(InternalChannel.java:51)
	at org.apache.hc.core5.reactor.SingleCoreIOReactor.processEvents(SingleCoreIOReactor.java:178)
	at org.apache.hc.core5.reactor.SingleCoreIOReactor.doExecute(SingleCoreIOReactor.java:127)
	at org.apache.hc.core5.reactor.AbstractSingleCoreIOReactor.execute(AbstractSingleCoreIOReactor.java:85)
	at org.apache.hc.core5.reactor.IOReactorWorker.run(IOReactorWorker.java:44)
	at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This doesn&apos;t happen in blocking client, nor when I&apos;ll force async client to use HTTP 1.&lt;/p&gt;</description>
                <environment>OpenJDK 64-Bit Server VM Temurin-11.0.13+8</environment>
        <key id="13415796">HTTPCORE-704</key>
            <summary>CharsetDecoder exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="morvael">Dominik Derwi&#324;ski</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Dec 2021 10:56:37 +0000</created>
                <updated>Sun, 2 Oct 2022 14:41:19 +0000</updated>
                            <resolved>Tue, 7 Dec 2021 15:56:30 +0000</resolved>
                                    <version>5.1.2</version>
                    <version>5.2-alpha2</version>
                                    <fixVersion>5.1.3</fixVersion>
                    <fixVersion>5.2-beta1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17454584" author="morvael" created="Tue, 7 Dec 2021 11:11:55 +0000"  >&lt;p&gt;While preparing a reproducer I&apos;ve noticed this also no longer happens if I remove CharCodingConfig from client parameters:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;.setCharCodingConfig(CharCodingConfig.custom()
                    .setCharset(StandardCharsets.UTF_8)
                    .build())
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What&apos;s funny is that this is decribed as &quot;HTTP/1.1 char coding configuration.&quot; so shouldn&apos;t apply to HTTP/2? Also, blocking client had no trouble working with PoolingHttpClientConnectionManager using ManagedHttpClientConnectionFactory using such CharCodingConfig.&lt;/p&gt;</comment>
                            <comment id="17454588" author="morvael" created="Tue, 7 Dec 2021 11:15:29 +0000"  >&lt;p&gt;I have attached reproducer. It will not crash in current form, but will crash once setCharCodingConfig line will be uncommented, and again not crash when setVersionPolicy will be uncommented too (add missing import when doing that).&lt;/p&gt;</comment>
                            <comment id="17454689" author="jira-bot" created="Tue, 7 Dec 2021 14:46:40 +0000"  >&lt;p&gt;Commit 5f1b3600296b4ec7d7c806453d39a1a70082462b in httpcomponents-core&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-704&quot; title=&quot;CharsetDecoder exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-704&quot;&gt;&lt;del&gt;HTTPCORE-704&lt;/del&gt;&lt;/a&gt; from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5f1b360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=5f1b360&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-704&quot; title=&quot;CharsetDecoder exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-704&quot;&gt;&lt;del&gt;HTTPCORE-704&lt;/del&gt;&lt;/a&gt;: HPackDecoder fails to correctly decode an empty header if a non-ASCII charset is being used&lt;/p&gt;</comment>
                            <comment id="17454690" author="olegk" created="Tue, 7 Dec 2021 14:48:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=morvael&quot; class=&quot;user-hover&quot; rel=&quot;morvael&quot;&gt;morvael&lt;/a&gt; It looks like the defect is trggered by two conditions: HPack header being empty and non-ASCII charset being used. Please review / test the fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/commit/5f1b3600296b4ec7d7c806453d39a1a70082462b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/commit/5f1b3600296b4ec7d7c806453d39a1a70082462b&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17454696" author="morvael" created="Tue, 7 Dec 2021 14:54:42 +0000"  >&lt;p&gt;Oleg,&lt;/p&gt;

&lt;p&gt;Looks ok, indeed the problem was caused by calling flush on a &quot;clean/empty&quot; decoder, so early exit will help here.&lt;/p&gt;</comment>
                            <comment id="17454721" author="jira-bot" created="Tue, 7 Dec 2021 15:49:07 +0000"  >&lt;p&gt;Commit b6c573c86d041d591cf0ae7b1f39d025cb9e185b in httpcomponents-core&apos;s branch refs/heads/5.1.x from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=b6c573c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=b6c573c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-704&quot; title=&quot;CharsetDecoder exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-704&quot;&gt;&lt;del&gt;HTTPCORE-704&lt;/del&gt;&lt;/a&gt;: HPackDecoder fails to correctly encode / decode an empty header if a non-ASCII charset is being used&lt;/p&gt;</comment>
                            <comment id="17454727" author="jira-bot" created="Tue, 7 Dec 2021 15:55:28 +0000"  >&lt;p&gt;Commit b313afc611c16936e8c69c6bc533864014b70f4d in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=b313afc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=b313afc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-704&quot; title=&quot;CharsetDecoder exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-704&quot;&gt;&lt;del&gt;HTTPCORE-704&lt;/del&gt;&lt;/a&gt;: HPackDecoder fails to correctly encode / decode an empty header if a non-ASCII charset is being used&lt;/p&gt;</comment>
                            <comment id="17454728" author="olegk" created="Tue, 7 Dec 2021 15:56:30 +0000"  >&lt;p&gt;Fixed in 5.1.x and master.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="17612120" author="jira-bot" created="Sun, 2 Oct 2022 14:41:19 +0000"  >&lt;p&gt;Commit b6c573c86d041d591cf0ae7b1f39d025cb9e185b in httpcomponents-core&apos;s branch refs/heads/github_ci_on_win from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=b6c573c86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=b6c573c86&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-704&quot; title=&quot;CharsetDecoder exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-704&quot;&gt;&lt;del&gt;HTTPCORE-704&lt;/del&gt;&lt;/a&gt;: HPackDecoder fails to correctly encode / decode an empty header if a non-ASCII charset is being used&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13037076" name="MainHttp2BugReproducer.java" size="6175" author="morvael" created="Tue, 7 Dec 2021 11:13:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0xf8w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>