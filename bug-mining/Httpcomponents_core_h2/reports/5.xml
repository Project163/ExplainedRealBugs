<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:23:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HTTPCORE-606] HTTP2 framing layer error with HttpCore 5.0 server</title>
                <link>https://issues.apache.org/jira/browse/HTTPCORE-606</link>
                <project id="12310340" key="HTTPCORE">HttpComponents HttpCore</project>
                    <description>&lt;p&gt;The attached file implements a simple H2/TLS server that returns a roughly 64 KB response. Things work fine when HTTP1 is used but with HTTP2 a framing layer error is reported.&lt;/p&gt;

&lt;p&gt;Using curl:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;$ curl -k &lt;a href=&quot;https://localhost:8080/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://localhost:8080/&lt;/a&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;curl: (16) Error in the HTTP2 framing layer&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Using Chrome:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;GET &lt;a href=&quot;https://localhost:8080/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://localhost:8080/&lt;/a&gt; net::ERR_HTTP2_FRAME_SIZE_ERROR 200&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m using Conscrypt (org.conscrypt:conscrypt-openjdk-uber:2.2.1) because I currently have only Java 8 environments so that&apos;s how I enable H2. I don&apos;t know if the bug is related to the JSSE implementation or not. I did try to disable TLS on the server and connect with &lt;tt&gt;curl --http2&lt;/tt&gt; but that didn&apos;t work - curl offered to upgrade but the server returned HTTP1 and the error doesn&apos;t happen with HTTP1.&lt;/p&gt;

&lt;p&gt;The response is big enough that writing the response body data to the DataStreamChannel does not consume it all in one call. I believe this might be a factor because if I instead dribble the data out with small writes over time like this then no error occurs:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;private int counter = 0;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;@Override&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;public void produce(DataStreamChannel channel) throws IOException {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; if (counter &amp;lt; 4096) {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; ByteBuffer buffer = ByteBuffer.wrap(String.format(&quot;%4d:0123456789\n&quot;, counter).getBytes());&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; counter++;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; channel.write(buffer);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; new Thread(() -&amp;gt; {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; try {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; Thread.sleep(50);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; } catch (InterruptedException ignored) {&lt;/tt&gt;&lt;br/&gt;
{{&#160; &#160; &#160; }}}&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; channel.requestOutput();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; }).start();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; } else {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; channel.endStream();&lt;/tt&gt;&lt;br/&gt;
{{&#160; }}}&lt;br/&gt;
&lt;tt&gt;}&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;To run the test program you will need to modify the code at the beginning of &lt;tt&gt;main&lt;/tt&gt; to load your own X509 KeyStore. Connect to the server with an H2-capable client on port 8080.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13262037">HTTPCORE-606</key>
            <summary>HTTP2 framing layer error with HttpCore 5.0 server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rhashimoto">Roy Hashimoto</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Oct 2019 23:58:42 +0000</created>
                <updated>Sat, 19 Oct 2019 09:42:32 +0000</updated>
                            <resolved>Sat, 19 Oct 2019 09:42:32 +0000</resolved>
                                    <version>5.0-beta9</version>
                                    <fixVersion>5.0-beta10</fixVersion>
                                    <component>HttpCore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16950837" author="olegk" created="Mon, 14 Oct 2019 09:10:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt; I cannot reproduce the defect with latest HttpCore master. The only difference to 5.0-beta9 is upgrade to Conscrypt 2.2.1&lt;/p&gt;

&lt;p&gt;Client side&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;oleg@ok2c:~$ curl -v -k https://localhost:8080/
*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8080 (#0)
* ALPN, offering h2
* ALPN, offering http/1.1
* successfully set certificate verify locations:
*   CAfile: /etc/ssl/certs/ca-certificates.crt
  CApath: /etc/ssl/certs
* TLSv1.3 (OUT), TLS handshake, Client hello (1):
* TLSv1.3 (IN), TLS handshake, Server hello (2):
* TLSv1.2 (IN), TLS handshake, Certificate (11):
* TLSv1.2 (IN), TLS handshake, Server key exchange (12):
* TLSv1.2 (IN), TLS handshake, Server finished (14):
* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):
* TLSv1.2 (OUT), TLS change cipher, Client hello (1):
* TLSv1.2 (OUT), TLS handshake, Finished (20):
* TLSv1.2 (IN), TLS handshake, Finished (20):
* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256
* ALPN, server accepted to use h2
* Server certificate:
*  subject: O=Apache Software Foundation; OU=HttpComponents Project; CN=Test Server
*  start date: Oct 11 15:56:37 2019 GMT
*  expire date: Jul 26 15:56:37 2293 GMT
*  issuer: O=Apache Software Foundation; OU=HttpComponents Project; CN=Test CA; emailAddress=dev@hc.apache.org
*  SSL certificate verify result: self signed certificate in certificate chain (19), continuing anyway.
* Using HTTP2, server supports multi-use
* Connection state changed (HTTP/2 confirmed)
* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0
* Using Stream ID: 1 (easy handle 0x561a0bfdf580)
&amp;gt; GET / HTTP/2
&amp;gt; Host: localhost:8080
&amp;gt; User-Agent: curl/7.58.0
&amp;gt; Accept: */*
&amp;gt; 
* Connection state changed (MAX_CONCURRENT_STREAMS updated)!
&amp;lt; HTTP/2 200 
&amp;lt; content-type: text/plain
&amp;lt; date: Mon, 14 Oct 2019 08:59:28 GMT
&amp;lt; 
* Connection #0 to host localhost left intact
curl: (16) Error in the HTTP2 framing layer
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Server side&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;10:59:25,522 [main] Listening on /0:0:0:0:0:0:0:0:8080
10:59:28,470 [server-dispatch-1] i/o-00000000[ACTIVE][r:][ACTIVE][r][NOT_HANDSHAKING][0][0][0] TLS started
10:59:28,472 [server-dispatch-1] i/o-00000000[ACTIVE][r:] Protocol upgrade: class org.apache.hc.core5.http2.impl.nio.ServerHttpProtocolNegotiator
10:59:28,473 [server-dispatch-1] i/o-00000000[ACTIVE][r:] Set timeout 15 SECONDS
10:59:28,473 [server-dispatch-1] i/o-00000000[ACTIVE][r:r][ACTIVE][r][NOT_HANDSHAKING][0][0][0] input ready
10:59:28,481 [server-dispatch-1] i/o-00000000[ACTIVE][r:r] 517 bytes read
10:59:28,484 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r] Event mask set [rw]
10:59:28,484 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r][ACTIVE][r][NEED_UNWRAP][0][0][2404] output ready
10:59:28,484 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r] 2404 bytes written
10:59:28,484 [server-dispatch-1] i/o-00000000[ACTIVE][r:r] Event mask set [r]
10:59:28,485 [server-dispatch-1] i/o-00000000[ACTIVE][r:r][ACTIVE][r][NEED_UNWRAP][0][0][0] input ready
10:59:28,485 [server-dispatch-1] i/o-00000000[ACTIVE][r:r] 93 bytes read
10:59:28,489 [server-dispatch-1] i/o-00000000[ACTIVE][r:r] Set timeout 15 SECONDS
10:59:28,489 [server-dispatch-1] i/o-00000000[ACTIVE][r:r][ACTIVE][r][NOT_HANDSHAKING][0][0][51] connected
10:59:28,489 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r] Event mask set [rw]
10:59:28,490 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r][ACTIVE][r][NOT_HANDSHAKING][0][0][51] output ready
10:59:28,490 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r] 51 bytes written
10:59:28,490 [server-dispatch-1] i/o-00000000[ACTIVE][r:r] Event mask set [r]
10:59:28,490 [server-dispatch-1] i/o-00000000[ACTIVE][r:r][ACTIVE][r][NOT_HANDSHAKING][0][0][0] input ready
10:59:28,493 [server-dispatch-1] i/o-00000000[ACTIVE][r:r] 219 bytes read
10:59:28,505 [server-dispatch-1] i/o-00000000[ACTIVE][r:r] Protocol upgrade: class org.apache.hc.core5.http2.impl.nio.ServerH2IOEventHandler
10:59:28,507 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; stream 0 frame: SETTINGS (0x4); flags: (0x0); length: 36
10:59:28,507 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r] Event mask set [rw]
10:59:28,508 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; stream 0 frame: SETTINGS (0x4); flags: (0x0); length: 18
10:59:28,508 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; stream 0 flow control 1073676289 -&amp;gt; 1073741824
10:59:28,508 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; stream 0 frame: SETTINGS (0x4); flags: ACK (0x1); length: 0
10:59:28,509 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; stream 0 frame: WINDOW_UPDATE (0x8); flags: (0x0); length: 4
10:59:28,509 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; stream 0 flow control 1073676289 -&amp;gt; 2147418113
10:59:28,509 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; stream 1 frame: HEADERS (0x1); flags: END_STREAM END_HEADERS (0x5); length: 30
10:59:28,516 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; :method: GET
10:59:28,516 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; :path: /
10:59:28,516 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; :scheme: https
10:59:28,516 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; :authority: localhost:8080
10:59:28,516 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; user-agent: curl/7.58.0
10:59:28,516 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; accept: */*
10:59:28,555 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; :status: 200
10:59:28,555 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; content-type: text/plain
10:59:28,555 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; date: Mon, 14 Oct 2019 08:59:28 GMT
10:59:28,556 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; stream 1 frame: HEADERS (0x1); flags: END_HEADERS (0x4); length: 34
10:59:28,556 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; stream 1 frame: DATA (0x0); flags: (0x0); length: 65536
10:59:28,556 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; stream 0 flow control -65536 -&amp;gt; 2147352577
10:59:28,556 [server-dispatch-1] i/o-00000000 &amp;gt;&amp;gt; stream 1 flow control -65536 -&amp;gt; 1073676288
10:59:28,557 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r][ACTIVE][rw][NOT_HANDSHAKING][0][0][16597] output ready
10:59:28,557 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; stream 0 flow control 1073676289 -&amp;gt; 1073741824
10:59:28,557 [server-dispatch-1] i/o-00000000[ACTIVE][rw:r] 16597 bytes written
10:59:28,557 [server-dispatch-1] i/o-00000000[ACTIVE][rw:rw][ACTIVE][rw][NOT_HANDSHAKING][0][0][0] input ready
10:59:28,557 [server-dispatch-1] i/o-00000000[ACTIVE][rw:rw] 135 bytes read
10:59:28,558 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; stream 0 frame: SETTINGS (0x4); flags: ACK (0x1); length: 0
10:59:28,558 [server-dispatch-1] i/o-00000000 &amp;lt;&amp;lt; stream 0 frame: GOAWAY (0x7); flags: (0x0); length: 28
10:59:28,559 [server-dispatch-1] i/o-00000000[ACTIVE][w:rw] Event mask set [w]
10:59:28,559 [server-dispatch-1] i/o-00000000[ACTIVE][w:rw][CLOSING][w][NOT_HANDSHAKING][inbound done][][EOF][][0][0][0] output ready
10:59:28,559 [server-dispatch-1] i/o-00000000[ACTIVE][w:rw] 0 bytes written
10:59:28,560 [server-dispatch-1] i/o-00000000[ACTIVE][w:rw] Close
10:59:28,560 [server-dispatch-1] i/o-00000000[CLOSED][][CLOSED][w][NOT_HANDSHAKING][inbound done][][outbound done][][EOF][][0][0][31] disconnected
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16951035" author="rhashimoto" created="Mon, 14 Oct 2019 14:37:00 +0000"  >&lt;p&gt;Hmm. Did you remove all the response body data from your curl log for brevity? I just want to verify that you did see all that data come through. Your curl log does have:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;curl: (16) Error in the HTTP2 framing layer&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;at the end, which is the same error I&apos;m seeing.&lt;/p&gt;

&lt;p&gt;How do I enable the HttpCore logging?&lt;/p&gt;

&lt;p&gt;Here&apos;s my verbose curl output (I am not removing any response body for brevity; curl just isn&apos;t showing any):&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;$ curl -k -v &lt;a href=&quot;https://localhost:8080/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://localhost:8080/&lt;/a&gt;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* Trying ::1...&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TCP_NODELAY set&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* Connected to localhost (::1) port 8080 (#0)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* ALPN, offering h2&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* ALPN, offering http/1.1&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* Cipher selection: ALL:!EXPORT:!EXPORT40:!EXPORT56:!aNULL:!LOW:!RC4:@STRENGTH&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* successfully set certificate verify locations:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* CAfile: /etc/ssl/cert.pem&lt;/tt&gt;&lt;br/&gt;
{{ CApath: none}}&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (OUT), TLS handshake, Client hello (1):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (IN), TLS handshake, Server hello (2):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (IN), TLS handshake, Certificate (11):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (IN), TLS handshake, Server key exchange (12):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (IN), TLS handshake, Server finished (14):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (OUT), TLS change cipher, Client hello (1):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (OUT), TLS handshake, Finished (20):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (IN), TLS change cipher, Client hello (1):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (IN), TLS handshake, Finished (20):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* ALPN, server accepted to use h2&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* Server certificate:&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* subject: C=US; ST=California; L=San Bruno; CN=localhost&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* start date: Sep 11 18:06:05 2019 GMT&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* expire date: Sep 11 18:06:05 2023 GMT&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* issuer: C=US; ST=New Jersey; O=Yoyodyne Propulsion Systems; CN=Yoyodyne Propulsion Systems CA&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* SSL certificate verify ok.&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* Using HTTP2, server supports multi-use&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* Connection state changed (HTTP/2 confirmed)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* Using Stream ID: 1 (easy handle 0x7fcec5007200)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&amp;gt; GET / HTTP/2&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&amp;gt; Host: localhost:8080&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&amp;gt; User-Agent: curl/7.54.0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&amp;gt; Accept: &lt;b&gt;/&lt;/b&gt;&lt;/tt&gt;&lt;br/&gt;
{{&amp;gt; }}&lt;br/&gt;
&lt;tt&gt;* Connection state changed (MAX_CONCURRENT_STREAMS updated)!&lt;/tt&gt;&lt;br/&gt;
{{&amp;lt; HTTP/2 200 }}&lt;br/&gt;
&lt;tt&gt;&amp;lt; content-type: text/plain&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&amp;lt; date: Mon, 14 Oct 2019 14:09:05 GMT&lt;/tt&gt;&lt;br/&gt;
{{&amp;lt; }}&lt;br/&gt;
&lt;tt&gt;* Closing connection 0&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;* TLSv1.2 (OUT), TLS alert, Client hello (1):&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;curl: (16) Error in the HTTP2 framing layer&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;I can add server logging if I figure out how to activate it.&lt;/p&gt;</comment>
                            <comment id="16951167" author="olegk" created="Mon, 14 Oct 2019 17:12:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt;&#160;I am not sure I understand what it is exactly you are trying to do, given that your &lt;tt&gt;AsyncEntityProducer&lt;/tt&gt; looks intentionally broken by always returning zero from &lt;tt&gt;#available&lt;/tt&gt; method.&lt;/p&gt;

&lt;p&gt;One can use logging handlers from the testing module for i/o and protocol event logging with Log4j2 &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. One could also build something very similar with any logging framework of their choice.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/httpcomponents-core/tree/master/httpcore5-testing/src/main/java/org/apache/hc/core5/testing/nio&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/tree/master/httpcore5-testing/src/main/java/org/apache/hc/core5/testing/nio&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16951195" author="rhashimoto" created="Mon, 14 Oct 2019 17:49:33 +0000"  >&lt;p&gt;I&apos;m just trying to serve a largish response body over H2 successfully, large enough to overflow all the library and socket buffering. I&apos;ve updated the test program to use the standard &lt;tt&gt;AsyncEntityProducers.create()&lt;/tt&gt; convenience instead of making my own (attachment updated). I still get the same behavior with the updated test program with H2 requests - no response body and a HTTP2 framing error reported. Works fine with an HTTP1 request.&lt;/p&gt;</comment>
                            <comment id="16951204" author="olegk" created="Mon, 14 Oct 2019 18:01:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt; I found the cause of the problem in HttpCore using larger frame size prior to full completion of the SETTINGS handshake&lt;/p&gt;

&lt;p&gt;This change-set will fix the immediate problem with frame size mismatch. I am still working on a slightly more complex fix. Both curl and Chrome should be able to complete the message exchange with your original code.    &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/ok2c/httpcomponents-core/commit/b82e72ff6686e65adbd34ae667abbd19b9ec74e4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ok2c/httpcomponents-core/commit/b82e72ff6686e65adbd34ae667abbd19b9ec74e4&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="16951246" author="rhashimoto" created="Mon, 14 Oct 2019 18:51:34 +0000"  >&lt;p&gt;I applied your 1-line change locally and it indeed fixes H2 for me. Thanks!&lt;/p&gt;

&lt;p&gt;Also working nicely on Android (with Conscrypt provider), which is where I first encountered the problem.&lt;/p&gt;</comment>
                            <comment id="16952845" author="jira-bot" created="Wed, 16 Oct 2019 13:50:58 +0000"  >&lt;p&gt;Commit 0e45302462ecc66df738a294eee298b950e40ccc in httpcomponents-core&apos;s branch refs/heads/bug-fixes from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=0e45302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=0e45302&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-606&quot; title=&quot;HTTP2 framing layer error with HttpCore 5.0 server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-606&quot;&gt;&lt;del&gt;HTTPCORE-606&lt;/del&gt;&lt;/a&gt;: HTTP/2 protocol handler incorrectly uses larger frame size prior to SETTING handshake completion; revision of SETTINGS handshake implementation&lt;/p&gt;</comment>
                            <comment id="16952861" author="olegk" created="Wed, 16 Oct 2019 14:06:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rhashimoto&quot; class=&quot;user-hover&quot; rel=&quot;rhashimoto&quot;&gt;rhashimoto&lt;/a&gt; Could you please test a more comprehensive fix before I merge it into master?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/httpcomponents-core/tree/bug-fixes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/httpcomponents-core/tree/bug-fixes&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16952912" author="rhashimoto" created="Wed, 16 Oct 2019 15:16:06 +0000"  >&lt;p&gt;Away from computers now; can test Friday.&lt;/p&gt;</comment>
                            <comment id="16954836" author="rhashimoto" created="Fri, 18 Oct 2019 17:15:22 +0000"  >&lt;p&gt;The branch works for me with H2 requests. I checked on Intellij&apos;s Java 8 and Android 8.1, both with Conscrypt 2.2.1.&lt;/p&gt;</comment>
                            <comment id="16955123" author="jira-bot" created="Sat, 19 Oct 2019 09:37:48 +0000"  >&lt;p&gt;Commit 0e45302462ecc66df738a294eee298b950e40ccc in httpcomponents-core&apos;s branch refs/heads/master from Oleg Kalnichevski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=0e45302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=httpcomponents-core.git;h=0e45302&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HTTPCORE-606&quot; title=&quot;HTTP2 framing layer error with HttpCore 5.0 server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HTTPCORE-606&quot;&gt;&lt;del&gt;HTTPCORE-606&lt;/del&gt;&lt;/a&gt;: HTTP/2 protocol handler incorrectly uses larger frame size prior to SETTING handshake completion; revision of SETTINGS handshake implementation&lt;/p&gt;</comment>
                            <comment id="16955125" author="olegk" created="Sat, 19 Oct 2019 09:42:32 +0000"  >&lt;p&gt;Merged to master.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12982983" name="ConscryptTest.java" size="8442" author="rhashimoto" created="Mon, 14 Oct 2019 17:42:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07jsg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>