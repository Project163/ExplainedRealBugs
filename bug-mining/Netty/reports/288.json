{"url":"https://api.github.com/repos/netty/netty/issues/13788","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/13788/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/13788/comments","events_url":"https://api.github.com/repos/netty/netty/issues/13788/events","html_url":"https://github.com/netty/netty/issues/13788","id":2086958995,"node_id":"I_kwDOABA-c858ZHeT","number":13788,"title":"DefaultHttp2FrameReader does not reset after malformed request comes in","user":{"login":"isaacrivriv","id":31052283,"node_id":"MDQ6VXNlcjMxMDUyMjgz","avatar_url":"https://avatars.githubusercontent.com/u/31052283?v=4","gravatar_id":"","url":"https://api.github.com/users/isaacrivriv","html_url":"https://github.com/isaacrivriv","followers_url":"https://api.github.com/users/isaacrivriv/followers","following_url":"https://api.github.com/users/isaacrivriv/following{/other_user}","gists_url":"https://api.github.com/users/isaacrivriv/gists{/gist_id}","starred_url":"https://api.github.com/users/isaacrivriv/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/isaacrivriv/subscriptions","organizations_url":"https://api.github.com/users/isaacrivriv/orgs","repos_url":"https://api.github.com/users/isaacrivriv/repos","events_url":"https://api.github.com/users/isaacrivriv/events{/privacy}","received_events_url":"https://api.github.com/users/isaacrivriv/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-01-17T20:50:10Z","updated_at":"2024-02-15T07:23:15Z","closed_at":"2024-02-15T07:23:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Expected behavior\r\nAfter a request comes in which causes a stream error, (such as a priority frame with an invalid stream dependency or with an invalid payload length) the following frame must be treated as a new frame.\r\n\r\n### Actual behavior\r\nAfter such a malformed request comes in, the following frame after the malformed is parsed with leftover data from the previous request.\r\n\r\n### Steps to reproduce\r\n1. Start an HTTP2 request. \r\n2. Send a priority request on a stream with an invalid payload length\r\n3. After failed stream send a valid stream request to the HTTP2 session\r\n4. HTTP2 request should work but doesn't\r\n\r\nAs a side effect of this, I see a Go Away being sent by the server with the following message `Frame length: 16711680 exceeds maximum: 16384`\r\n\r\n### Minimal yet complete reproducer code (or URL to code)\r\nI expanded the HTTP2 client example code for a reproducer. Tested against the HTTP2 Server example https://github.com/netty/netty/compare/4.1...isaacrivriv:netty:test-bad-priority-frame\r\n\r\n### Netty version\r\n4.1.105\r\n\r\n### JVM version (e.g. `java -version`)\r\nopenjdk version \"17.0.7\" 2023-04-18\r\nIBM Semeru Runtime Open Edition 17.0.7.0 (build 17.0.7+7)\r\nEclipse OpenJ9 VM 17.0.7.0 (build openj9-0.38.0, JRE 17 Mac OS X amd64-64-Bit Compressed References 20230418_450 (JIT enabled, AOT enabled)\r\nOpenJ9   - d57d05932\r\nOMR      - 855813495\r\nJCL      - 9d7a231edbc based on jdk-17.0.7+7)\r\n\r\n### OS version (e.g. `uname -a`)\r\nDarwin Kernel Version 23.0.0","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/13788/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/13788/timeline","performed_via_github_app":null,"state_reason":"completed"}