{"url":"https://api.github.com/repos/netty/netty/issues/10616","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/10616/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/10616/comments","events_url":"https://api.github.com/repos/netty/netty/issues/10616/events","html_url":"https://github.com/netty/netty/issues/10616","id":709852124,"node_id":"MDU6SXNzdWU3MDk4NTIxMjQ=","number":10616,"title":"native-image compilation of epoll transport fails","user":{"login":"perezd","id":20598,"node_id":"MDQ6VXNlcjIwNTk4","avatar_url":"https://avatars.githubusercontent.com/u/20598?v=4","gravatar_id":"","url":"https://api.github.com/users/perezd","html_url":"https://github.com/perezd","followers_url":"https://api.github.com/users/perezd/followers","following_url":"https://api.github.com/users/perezd/following{/other_user}","gists_url":"https://api.github.com/users/perezd/gists{/gist_id}","starred_url":"https://api.github.com/users/perezd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/perezd/subscriptions","organizations_url":"https://api.github.com/users/perezd/orgs","repos_url":"https://api.github.com/users/perezd/repos","events_url":"https://api.github.com/users/perezd/events{/privacy}","received_events_url":"https://api.github.com/users/perezd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2907835512,"node_id":"MDU6TGFiZWwyOTA3ODM1NTEy","url":"https://api.github.com/repos/netty/netty/labels/graal","name":"graal","color":"989030","default":false,"description":"Issues related to running on GraalVM"}],"state":"closed","locked":false,"assignee":{"login":"chrisvest","id":7993,"node_id":"MDQ6VXNlcjc5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/7993?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisvest","html_url":"https://github.com/chrisvest","followers_url":"https://api.github.com/users/chrisvest/followers","following_url":"https://api.github.com/users/chrisvest/following{/other_user}","gists_url":"https://api.github.com/users/chrisvest/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisvest/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisvest/subscriptions","organizations_url":"https://api.github.com/users/chrisvest/orgs","repos_url":"https://api.github.com/users/chrisvest/repos","events_url":"https://api.github.com/users/chrisvest/events{/privacy}","received_events_url":"https://api.github.com/users/chrisvest/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"chrisvest","id":7993,"node_id":"MDQ6VXNlcjc5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/7993?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisvest","html_url":"https://github.com/chrisvest","followers_url":"https://api.github.com/users/chrisvest/followers","following_url":"https://api.github.com/users/chrisvest/following{/other_user}","gists_url":"https://api.github.com/users/chrisvest/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisvest/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisvest/subscriptions","organizations_url":"https://api.github.com/users/chrisvest/orgs","repos_url":"https://api.github.com/users/chrisvest/repos","events_url":"https://api.github.com/users/chrisvest/events{/privacy}","received_events_url":"https://api.github.com/users/chrisvest/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":19,"created_at":"2020-09-28T00:33:12Z","updated_at":"2023-01-31T14:07:54Z","closed_at":"2023-01-31T14:07:54Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Expected behavior\r\nMy small repro compiles as a native image and works as expected if I use Nio* family of transports. My expectation was that switching to epoll transport would similarly work.\r\n\r\n### Actual behavior\r\nIf I switch to epoll (linux-x86_64) I get a compilation error:\r\n\r\n```\r\nError: Classes that should be initialized at run time got initialized during image building:\r\n io.netty.util.AbstractReferenceCounted the class was requested to be initialized at build time (from the command line). io.netty.util.AbstractReferenceCounted has been initialized without the native-image initialization instrumentation and the stack trace can't be tracked. Try avoiding to initialize the class that caused initialization of io.netty.util.AbstractReferenceCounted\r\n\r\ncom.oracle.svm.core.util.UserError$UserException: Classes that should be initialized at run time got initialized during image building:\r\n io.netty.util.AbstractReferenceCounted the class was requested to be initialized at build time (from the command line). io.netty.util.AbstractReferenceCounted has been initialized without the native-image initialization instrumentation and the stack trace can't be tracked. Try avoiding to initialize the class that caused initialization of io.netty.util.AbstractReferenceCounted\r\n\r\n\tat com.oracle.svm.core.util.UserError.abort(UserError.java:65)\r\n\tat com.oracle.svm.hosted.classinitialization.ConfigurableClassInitialization.checkDelayedInitialization(ConfigurableClassInitialization.java:510)\r\n\tat com.oracle.svm.hosted.classinitialization.ClassInitializationFeature.duringAnalysis(ClassInitializationFeature.java:187)\r\n\tat com.oracle.svm.hosted.NativeImageGenerator.lambda$runPointsToAnalysis$8(NativeImageGenerator.java:710)\r\n\tat com.oracle.svm.hosted.FeatureHandler.forEachFeature(FeatureHandler.java:63)\r\n\tat com.oracle.svm.hosted.NativeImageGenerator.runPointsToAnalysis(NativeImageGenerator.java:710)\r\n\tat com.oracle.svm.hosted.NativeImageGenerator.doRun(NativeImageGenerator.java:530)\r\n\tat com.oracle.svm.hosted.NativeImageGenerator.lambda$run$0(NativeImageGenerator.java:445)\r\n\tat java.base/java.util.concurrent.ForkJoinTask$AdaptedRunnableAction.exec(ForkJoinTask.java:1407)\r\n\tat java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:290)\r\n\tat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1020)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1656)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1594)\r\n\tat java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:177)\r\n```\r\n\r\n### Minimal yet complete reproducer code (or URL to code)\r\n\r\nHere's a repro: https://github.com/perezd/netty-epoll-native-repro\r\n\r\nw/ Bazel 3.5.0 installed, run this command from the root of the project:\r\n\r\n```\r\nbazel run :main-native\r\n```\r\n\r\n### Netty version\r\n4.1.52.Final (linux-x86_64)\r\n\r\n### JVM version (e.g. `java -version`)\r\njava -version\r\nopenjdk version \"11.0.8\" 2020-07-14\r\nOpenJDK Runtime Environment (build 11.0.8+10-post-Ubuntu-0ubuntu120.04)\r\nOpenJDK 64-Bit Server VM (build 11.0.8+10-post-Ubuntu-0ubuntu120.04, mixed mode, sharing)\r\n\r\n### OS version (e.g. `uname -a`)\r\nLinux desktop 5.4.0-48-generic #52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\nI've searched around and attempted various workarounds but nothing seems to work.\r\n","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/10616/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/10616/timeline","performed_via_github_app":null,"state_reason":"completed"}