{"url":"https://api.github.com/repos/netty/netty/issues/7484","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/7484/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/7484/comments","events_url":"https://api.github.com/repos/netty/netty/issues/7484/events","html_url":"https://github.com/netty/netty/issues/7484","id":280236038,"node_id":"MDU6SXNzdWUyODAyMzYwMzg=","number":7484,"title":"Ability to define Head+Tail ChannelHandler","user":{"login":"rkapsi","id":191635,"node_id":"MDQ6VXNlcjE5MTYzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/191635?v=4","gravatar_id":"","url":"https://api.github.com/users/rkapsi","html_url":"https://github.com/rkapsi","followers_url":"https://api.github.com/users/rkapsi/followers","following_url":"https://api.github.com/users/rkapsi/following{/other_user}","gists_url":"https://api.github.com/users/rkapsi/gists{/gist_id}","starred_url":"https://api.github.com/users/rkapsi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rkapsi/subscriptions","organizations_url":"https://api.github.com/users/rkapsi/orgs","repos_url":"https://api.github.com/users/rkapsi/repos","events_url":"https://api.github.com/users/rkapsi/events{/privacy}","received_events_url":"https://api.github.com/users/rkapsi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":185729,"node_id":"MDU6TGFiZWwxODU3Mjk=","url":"https://api.github.com/repos/netty/netty/labels/improvement","name":"improvement","color":"0052cc","default":false,"description":null},{"id":185730,"node_id":"MDU6TGFiZWwxODU3MzA=","url":"https://api.github.com/repos/netty/netty/labels/feature","name":"feature","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/180","html_url":"https://github.com/netty/netty/milestone/180","labels_url":"https://api.github.com/repos/netty/netty/milestones/180/labels","id":2982976,"node_id":"MDk6TWlsZXN0b25lMjk4Mjk3Ng==","number":180,"title":"4.1.20.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":27,"state":"closed","created_at":"2017-12-15T19:27:14Z","updated_at":"2018-01-22T06:58:28Z","due_on":null,"closed_at":"2018-01-22T06:58:28Z"},"comments":2,"created_at":"2017-12-07T18:42:42Z","updated_at":"2017-12-15T20:20:41Z","closed_at":"2017-12-15T20:19:45Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I'm working on a new Channel type that extends AbstractChannel and is in some ways a hybrid version of a LocalChannel or EmbeddedChannel. Its purpose is to act as a proxy between two other Channels (say EpollChannel or NioChannel) and also provide a disposable section of a ChannelPipeline with a proper EventLoop.\r\n\r\nThis is pretty straight forward and just requires handlers that scoop up the various events at the ends of the pipeline and to some extent it'd be the Channel itself (more on that later).\r\n\r\nThe problem is that there's no elegant way of ensuring the position of a handler and `addLast(...)` is in particular a pain in the neck as it's the goto method for users to manipulate the pipeline. Kind of defeating the purpose of trying to give users (of our Netty based software) a section of pipeline they can safely manipulate without breaking everything to the left (head) or right (tail) of it.\r\n\r\nTechnically I wouldn't want to introduce any new API as it's all there. It just needs to be a bit more extensible.\r\n\r\nIdea 1: Change `AbstractChannel` to depend on `ChannelPipeline` instead of `DefaultChannelPipeline` (ditto `Unsafe` instead of `AbstractUnsafe`). This would allow me to use delegation/composition and override `addFirst/Last(...)` and ensure that users can't add their handlers before/after the required head/tail handlers. Not my favorite (final and concrete classes are IMHO overused in Netty ;)).\r\n\r\nIdea 2: Change `DefaultChannelPipeline` and add a bunch of protected methods alongside `onUnhandledInboundMessage(...)` for all the other events that are currently being swallowed (say `channelReadComplete(...)` on the `TailContext` that I'd like to translate into a `flush()`, or `channelWritabilityChanged(...)` for managing back pressure).\r\n\r\nIdea 3: Let ChannelPipeline fire a \"pipeline modified event\" every time a handler gets added or removed. My head and tail handlers could simply look for it in the `userEventTriggered(...)` method and move themselves if they're not head or tail. \r\n\r\nI think number 2 is my favorite as it's most aligned with the intent to scoop up the events that reach the ends of the pipeline. If I could I'd also break up AbstractChannel's dependency on concrete classes from number one but that is not needed in this context. Number 3 I'm not sure about. It's simple but has problems. For one I can create a loop if there are two competing handlers and I wouldn't want to introduce this new event for every Netty user out there if none of them cares about it.","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/7484/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/7484/timeline","performed_via_github_app":null,"state_reason":"completed"}