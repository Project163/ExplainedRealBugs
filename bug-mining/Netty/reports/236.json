{"url":"https://api.github.com/repos/netty/netty/issues/12269","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/12269/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/12269/comments","events_url":"https://api.github.com/repos/netty/netty/issues/12269/events","html_url":"https://github.com/netty/netty/issues/12269","id":1190778437,"node_id":"I_kwDOABA-c85G-dZF","number":12269,"title":"Allow explicitly choosing protocol family","user":{"login":"kvr000","id":13338957,"node_id":"MDQ6VXNlcjEzMzM4OTU3","avatar_url":"https://avatars.githubusercontent.com/u/13338957?v=4","gravatar_id":"","url":"https://api.github.com/users/kvr000","html_url":"https://github.com/kvr000","followers_url":"https://api.github.com/users/kvr000/followers","following_url":"https://api.github.com/users/kvr000/following{/other_user}","gists_url":"https://api.github.com/users/kvr000/gists{/gist_id}","starred_url":"https://api.github.com/users/kvr000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kvr000/subscriptions","organizations_url":"https://api.github.com/users/kvr000/orgs","repos_url":"https://api.github.com/users/kvr000/repos","events_url":"https://api.github.com/users/kvr000/events{/privacy}","received_events_url":"https://api.github.com/users/kvr000/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-04-03T01:03:59Z","updated_at":"2022-04-05T06:48:05Z","closed_at":"2022-04-05T06:48:05Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Expected behavior\r\n\r\nNetty should be able to bind to specific protocol family only (IPv4, IPv6) if requested by the caller.\r\n\r\n### Actual behavior\r\n\r\nNetty uses `java.net.preferIPv4Stack` JVM property to determine whether to bind to IPv4 or IPv6 (possibly IPv6+IPv4 given by settings of IPV6_V6ONLY socket option).\r\n\r\n### Steps to reproduce\r\n\r\n```\r\n\t\t\t\t\tServerBootstrap b = new ServerBootstrap();\r\n\t\t\t\t\tb.group(bossGroup, workerGroup)\r\n\t\t\t\t\t\t\t.channelFactory(configAdapter.getServerChannel(address))\r\n\t\t\t\t\t\t\t.childHandler(channelInitializer).option(ChannelOption.SO_BACKLOG, Integer.MAX_VALUE)\r\n\t\t\t\t\t\t\t.childOption(ChannelOption.SO_KEEPALIVE, true);\r\n\r\n\t\t\t\t\tbindFuture = b.bind(address);\r\n```\r\n\r\n### Minimal yet complete reproducer code (or URL to code)\r\n\r\nhttps://github.com/kvr000/netty-specific-family\r\n\r\n### Netty version\r\n\r\n4.1.75.Final\r\n\r\n### JVM version (e.g. `java -version`)\r\n\r\nopenjdk version \"18-ea\" 2022-03-15\r\nOpenJDK Runtime Environment (build 18-ea+15-Ubuntu-4)\r\nOpenJDK 64-Bit Server VM (build 18-ea+15-Ubuntu-4, mixed mode, sharing)\r\n\r\n### OS version (e.g. `uname -a`)\r\n\r\nLinux ratteburg 5.13.0-37-generic #42-Ubuntu SMP Tue Mar 15 14:34:06 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n### Solution\r\n\r\nAdd `InternetProtocolFamily` parameter to Netty `SocketChannel` classes, so it can construct appropriate socket handler with correct family.  JDK supports specifying family since JDK 15, for Epoll and Kqueue, those need to be added.  Suggestion provided in Pull Request and confirmed as working (so far without automated tests though).\r\n\r\nPull request: https://github.com/netty/netty/pull/12270\r\n","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/12269/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/12269/timeline","performed_via_github_app":null,"state_reason":"completed"}