{"url":"https://api.github.com/repos/netty/netty/issues/10257","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/10257/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/10257/comments","events_url":"https://api.github.com/repos/netty/netty/issues/10257/events","html_url":"https://github.com/netty/netty/issues/10257","id":614043965,"node_id":"MDU6SXNzdWU2MTQwNDM5NjU=","number":10257,"title":"Blockhound detects a blocking call inside GlobalEventExecutor#addTask","user":{"login":"pbetkier","id":1076252,"node_id":"MDQ6VXNlcjEwNzYyNTI=","avatar_url":"https://avatars.githubusercontent.com/u/1076252?v=4","gravatar_id":"","url":"https://api.github.com/users/pbetkier","html_url":"https://github.com/pbetkier","followers_url":"https://api.github.com/users/pbetkier/followers","following_url":"https://api.github.com/users/pbetkier/following{/other_user}","gists_url":"https://api.github.com/users/pbetkier/gists{/gist_id}","starred_url":"https://api.github.com/users/pbetkier/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pbetkier/subscriptions","organizations_url":"https://api.github.com/users/pbetkier/orgs","repos_url":"https://api.github.com/users/pbetkier/repos","events_url":"https://api.github.com/users/pbetkier/events{/privacy}","received_events_url":"https://api.github.com/users/pbetkier/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2020-05-07T13:07:42Z","updated_at":"2020-05-11T06:51:39Z","closed_at":"2020-05-11T06:51:39Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Expected behavior\r\nNo blocking calls detected by BlockHound.\r\n\r\n### Actual behavior\r\n\r\nI observe the same problem originally reported by @62mkv in https://github.com/reactor/reactor-netty/issues/1086:\r\n\r\nOccasionally, BlockHound-enabled Spring Boot (w/WebFlux) test suite fails to complete correctly because of such exception w/ the following trace:\r\n\r\n```\r\n18:03:03.327 [reactor-http-nio-2] ERROR io.netty.util.concurrent.DefaultPromise.rejectedExecution - Failed to submit a listener notification task. Event loop shut down?\r\nreactor.blockhound.BlockingOperationError: Blocking call! sun.misc.Unsafe#park\r\n        at sun.misc.Unsafe.park(Unsafe.java)\r\n        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:870)\r\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1199)\r\n        at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:209)\r\n        at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)\r\n        at java.util.concurrent.LinkedBlockingQueue.offer(LinkedBlockingQueue.java:418)\r\n        at java.util.AbstractQueue.add(AbstractQueue.java:95)\r\n        at io.netty.util.concurrent.GlobalEventExecutor.addTask(GlobalEventExecutor.java:141)\r\n        at io.netty.util.concurrent.GlobalEventExecutor.execute(GlobalEventExecutor.java:206)\r\n        at io.netty.util.concurrent.DefaultPromise.safeExecute(DefaultPromise.java:841)\r\n        at io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:498)\r\n        at io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:615)\r\n        at io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:604)\r\n        at io.netty.util.concurrent.DefaultPromise.setSuccess(DefaultPromise.java:96)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:1051)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.lang.Thread.run(Thread.java:748)\r\n```\r\n\r\nreactor-netty maintainer @violetagg suggested the issue should be moved to this project. I haven't found it here, so I'm opening it.\r\n\r\n### Workaround\r\nIt's possible to whitelist this directly in the application as a temporary solution:\r\n```\r\n  private static final class NettyWorkaroundBlockHoundIntegration implements BlockHoundIntegration {\r\n    @Override\r\n    void applyTo(BlockHound.Builder builder) {\r\n      builder.allowBlockingCallsInside(GlobalEventExecutor.class.name, 'addTask')\r\n    }\r\n  }\r\n```\r\n\r\n### Netty version\r\n4.1.48.Final\r\n### JVM version (e.g. `java -version`)\r\nopenjdk version \"11.0.4\" 2019-07-16\r\n### OS version (e.g. `uname -a`)\r\nMac OS X 10.15.2 x86_64, Win10","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/10257/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/10257/timeline","performed_via_github_app":null,"state_reason":"completed"}