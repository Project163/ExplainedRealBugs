[{"id":10897508137,"node_id":"RTE_lADOABA-c852Mx_izwAAAAKJiscp","url":"https://api.github.com/repos/netty/netty/issues/events/10897508137","actor":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2023-11-08T08:52:00Z","rename":{"from":"Performance Issue Report: Performance problem with UnsafeByteBufUtil#setZero() method when writing little data","to":"Performance Issue Report: Performance problem with PooledUnsafeDirectByteBuf#writeZero() method when writing little data"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801406650","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1801406650","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1801406650,"node_id":"IC_kwDOABA-c85rX0i6","user":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-08T09:29:28Z","updated_at":"2023-11-08T09:29:28Z","body":"There are a few issues in your benchmark that I think need to be fixed first to ensure the benchmark is meaningful:\r\n- Your methods should either use a `BlackHole` or return something so it might not get optimised away.\r\n- You should create a new ByteBufAllocator in a `@Setup` method to ensure that you not benefit from already cached buffers in one case.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801406650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801437406","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1801437406","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1801437406,"node_id":"IC_kwDOABA-c85rX8De","user":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-08T09:43:27Z","updated_at":"2023-11-08T09:43:27Z","body":"Even better would be to just allocate the buffer once and reuse it. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801437406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801726291","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1801726291","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1801726291,"node_id":"IC_kwDOABA-c85rZClT","user":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-08T11:46:09Z","updated_at":"2023-11-08T11:46:09Z","body":"It seems that despite making modifications based on the suggestions , the JMH test results remain consistent.\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801726291/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801743200","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1801743200","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1801743200,"node_id":"IC_kwDOABA-c85rZGtg","user":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-08T11:57:37Z","updated_at":"2023-11-08T11:57:37Z","body":"#5315 I don't think this pull request has enough evidence of improved performance.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801743200/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801824749","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1801824749","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1801824749,"node_id":"IC_kwDOABA-c85rZant","user":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-08T12:46:54Z","updated_at":"2023-11-08T12:49:34Z","body":"Please try with a more recent JDK version (which will use much better black holes) and...I see that the methods up there aren't (reported to be) inlined, which is weird. Please attach the perfasm data or the compiler logs to be sure of it OR just do not inline (there's a compiler control annotation for that) the benchmark method, to grant  inlining depth to be just enough to have the whole chain of methods fully inlined.\r\n\r\nSecondary, add a test which force a blackhole consume on each write op or we risk to measure how good autovectorization is, If kick in (which isn't likely not implemented for setMemory iirc).\r\nLast but not least, clarify yourself first what is what you want to measure and what the real code will look like (and if it can even be reproduced) ie are you using setZero for some reason like that? What is the context of it? Is it slowing down the surrounding code?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1801824749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1803108480","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1803108480","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1803108480,"node_id":"IC_kwDOABA-c85reUCA","user":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-09T03:31:02Z","updated_at":"2023-11-09T03:31:02Z","body":"I am a developer of Thrift's RPC framework, and the [THeader protocol](https://github.com/apache/thrift/blob/master/doc/specs/HeaderFormat.md) needs to add 0-4 bytes of padding. I used the writeZero method to add padding. But in the production environment, the flame graph shows that the padding accounts for a significant width. Compared with the serialization of the actual fields, the padding should be very small. This phenomenon aroused my suspicion, so I did the above JMH test.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1803108480/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1803158865","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1803158865","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1803158865,"node_id":"IC_kwDOABA-c85regVR","user":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-09T04:49:46Z","updated_at":"2023-11-09T09:04:56Z","body":"Thanks for the clarification, if you have a proper prod code, I stil believe is not what you would exactly would do for maximum speed\r\neg\r\nwriteManual is writing 8 zeros, while writeUnsafe is writing 1 + 2 + 3 + ... + 8 = n * (n + 1)/2  = 72 bytes according to https://netty.io/4.1/api/io/netty/buffer/ByteBuf.html#writeZero-int- API, where the parameter length determine how many zeros are placed.\r\nThis should be fixed by replacing the loop with a single writeZero call.\r\n\r\nAssuming the actual code in Thrift is instead using the buffer API correctly, there are still inherent inefficiencies of Unsafe's setMemory implementation for very small lengths (smaller than the word's size and more, given that the underlying JDK impl could rely on the platform one, which in turn has some bootstrap cost, if vectorized, see https://github.com/real-logic/agrona/blob/5acc4a8e0cbc3a740ac15b0421b900a03bb6565a/agrona/src/main/java/org/agrona/AbstractMutableDirectBuffer.java#L77 and https://github.com/real-logic/agrona/blob/5acc4a8e0cbc3a740ac15b0421b900a03bb6565a/agrona-benchmarks/src/main/java/org/agrona/concurrent/SetMemoryBenchmark.java#L38)  AND that writeXYZ has to move forward writers index each time too, which means performing one tiny more operation for each tiny operations, doubling the work (I suggest instead, for Thrift to use the setXYZ variants in Netty, and just move the writer index manually at the end, while done).\r\nI can both check to open a JDK issue and send a Netty change to do something similar to what Agrona does, but given that these things are usually done using \"magic\" thresholds which not always hold for every possible architecture and operating system, I strongly encourage you to consider my point related writer indexes AND try in your specific case yourself (replacing the variable single zero write with a mix of setByte/setShort/setInt based on length of the padding)\r\n\r\nJust for reference, this is the ` main` OpenJDk behaviour for it: https://github.com/openjdk/jdk/blob/a26f7c03c72e4efe6d3219d294294c554aebc631/src/hotspot/share/utilities/copy.cpp#L213\r\n\r\nwhere `Copy::fill_to_bytes` just piggyback to the platform specific `memset` (which can use AVX-like registers).\r\nWhat the flamegraph show is that `setMemory` isn't an intrinsic and will likely require some thread-state adjustement which can further increase its cost; let me send a patch on Netty to help there as well.\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1803158865/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1803945359","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1803945359","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1803945359,"node_id":"IC_kwDOABA-c85rhgWP","user":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-09T14:33:15Z","updated_at":"2023-11-09T14:33:53Z","body":"But before sending a PR, to improve it: @normanmaurer wdyt? \r\nIf you are against adding paths to improve it I see no point, but if I've to, I see 2 options:\r\n- *option 1*: trying to do better then the JDK (ie by making memset to happen more often) AND tiny writes to avoid the thread-state barriers due to `Unsafe::setMemory0`\r\n- *option 2*: just makes tiny writes to work better (adding a special code path for <= 8 bytes - or slightly more)\r\n\r\nlmk ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1803945359/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10914025327,"node_id":"MEE_lADOABA-c852Mx_izwAAAAKKhs9v","url":"https://api.github.com/repos/netty/netty/issues/events/10914025327","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-11-09T14:33:15Z","performed_via_github_app":null},{"id":10914025345,"node_id":"SE_lADOABA-c852Mx_izwAAAAKKhs-B","url":"https://api.github.com/repos/netty/netty/issues/events/10914025345","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-11-09T14:33:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1803985914","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1803985914","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1803985914,"node_id":"IC_kwDOABA-c85rhqP6","user":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-09T14:55:11Z","updated_at":"2023-11-09T14:55:11Z","body":"@franz1981 I think option 2 might be something we could consider. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1803985914/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10914302443,"node_id":"MEE_lADOABA-c852Mx_izwAAAAKKiwnr","url":"https://api.github.com/repos/netty/netty/issues/events/10914302443","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-11-09T14:55:11Z","performed_via_github_app":null},{"id":10914302460,"node_id":"SE_lADOABA-c852Mx_izwAAAAKKiwn8","url":"https://api.github.com/repos/netty/netty/issues/events/10914302460","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-11-09T14:55:12Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1804047930","html_url":"https://github.com/netty/netty/issues/13692#issuecomment-1804047930","issue_url":"https://api.github.com/repos/netty/netty/issues/13692","id":1804047930,"node_id":"IC_kwDOABA-c85rh5Y6","user":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-09T15:28:16Z","updated_at":"2023-11-09T15:28:16Z","body":"Sending a PR now, @imangry can give it a shot ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1804047930/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10914723335,"node_id":"MEE_lADOABA-c852Mx_izwAAAAKKkXYH","url":"https://api.github.com/repos/netty/netty/issues/events/10914723335","actor":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-11-09T15:28:16Z","performed_via_github_app":null},{"id":10914723345,"node_id":"SE_lADOABA-c852Mx_izwAAAAKKkXYR","url":"https://api.github.com/repos/netty/netty/issues/events/10914723345","actor":{"login":"imangry","id":17894679,"node_id":"MDQ6VXNlcjE3ODk0Njc5","avatar_url":"https://avatars.githubusercontent.com/u/17894679?v=4","gravatar_id":"","url":"https://api.github.com/users/imangry","html_url":"https://github.com/imangry","followers_url":"https://api.github.com/users/imangry/followers","following_url":"https://api.github.com/users/imangry/following{/other_user}","gists_url":"https://api.github.com/users/imangry/gists{/gist_id}","starred_url":"https://api.github.com/users/imangry/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/imangry/subscriptions","organizations_url":"https://api.github.com/users/imangry/orgs","repos_url":"https://api.github.com/users/imangry/repos","events_url":"https://api.github.com/users/imangry/events{/privacy}","received_events_url":"https://api.github.com/users/imangry/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-11-09T15:28:16Z","performed_via_github_app":null},{"id":10915287758,"node_id":"REFE_lADOABA-c852Mx_izwAAAAKKmhLO","url":"https://api.github.com/repos/netty/netty/issues/events/10915287758","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1d1cc2749924eb776016e1bdfad205c08f461fbf","commit_url":"https://api.github.com/repos/franz1981/netty/commits/1d1cc2749924eb776016e1bdfad205c08f461fbf","created_at":"2023-11-09T16:15:04Z","performed_via_github_app":null},{"id":10915289926,"node_id":"REFE_lADOABA-c852Mx_izwAAAAKKmhtG","url":"https://api.github.com/repos/netty/netty/issues/events/10915289926","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1dbef0309b3d8d1c97be44163faa6e2f200f173e","commit_url":"https://api.github.com/repos/franz1981/netty/commits/1dbef0309b3d8d1c97be44163faa6e2f200f173e","created_at":"2023-11-09T16:15:16Z","performed_via_github_app":null},{"id":10915537176,"node_id":"REFE_lADOABA-c852Mx_izwAAAAKKneEY","url":"https://api.github.com/repos/netty/netty/issues/events/10915537176","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4a143fc0b45c7ae87598ade233b5649317e26028","commit_url":"https://api.github.com/repos/franz1981/netty/commits/4a143fc0b45c7ae87598ade233b5649317e26028","created_at":"2023-11-09T16:36:47Z","performed_via_github_app":null},{"id":10923566276,"node_id":"REFE_lADOABA-c852Mx_izwAAAAKLGGTE","url":"https://api.github.com/repos/netty/netty/issues/events/10923566276","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"523f6c783e85816d531dd5f0f18ac3a21cc2043a","commit_url":"https://api.github.com/repos/franz1981/netty/commits/523f6c783e85816d531dd5f0f18ac3a21cc2043a","created_at":"2023-11-10T10:35:59Z","performed_via_github_app":null},{"id":10924366181,"node_id":"REFE_lADOABA-c852Mx_izwAAAAKLJJll","url":"https://api.github.com/repos/netty/netty/issues/events/10924366181","actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c09b4f2e9652a77ae08ed068ed605eebc64157d8","commit_url":"https://api.github.com/repos/franz1981/netty/commits/c09b4f2e9652a77ae08ed068ed605eebc64157d8","created_at":"2023-11-10T12:05:03Z","performed_via_github_app":null},{"id":10938295598,"node_id":"CE_lADOABA-c852Mx_izwAAAAKL-SUu","url":"https://api.github.com/repos/netty/netty/issues/events/10938295598","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"5a58f0431e286f2943de75738208b6403c22b722","commit_url":"https://api.github.com/repos/netty/netty/commits/5a58f0431e286f2943de75738208b6403c22b722","created_at":"2023-11-13T08:13:40Z","state_reason":null,"performed_via_github_app":null},{"id":10938520978,"node_id":"MIE_lADOABA-c852Mx_izwAAAAKL_JWS","url":"https://api.github.com/repos/netty/netty/issues/events/10938520978","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2023-11-13T08:33:29Z","milestone":{"title":"4.1.102.Final"},"performed_via_github_app":null},{"actor":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-21T11:09:21Z","updated_at":"2023-11-21T11:09:21Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/openjdk/jdk/issues/16760","repository_url":"https://api.github.com/repos/openjdk/jdk","labels_url":"https://api.github.com/repos/openjdk/jdk/issues/16760/labels{/name}","comments_url":"https://api.github.com/repos/openjdk/jdk/issues/16760/comments","events_url":"https://api.github.com/repos/openjdk/jdk/issues/16760/events","html_url":"https://github.com/openjdk/jdk/pull/16760","id":2004031197,"node_id":"PR_kwDOCONros5gAei0","number":16760,"title":"Draft: Improve Unsafe::setMemory for small writes","user":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2323511630,"node_id":"MDU6TGFiZWwyMzIzNTExNjMw","url":"https://api.github.com/repos/openjdk/jdk/labels/merge-conflict","name":"merge-conflict","color":"f29fa1","default":false,"description":"Pull request has merge conflict with target branch"},{"id":2326354338,"node_id":"MDU6TGFiZWwyMzI2MzU0MzM4","url":"https://api.github.com/repos/openjdk/jdk/labels/hotspot","name":"hotspot","color":"ededed","default":false,"description":"hotspot-dev@openjdk.org"},{"id":2326760305,"node_id":"MDU6TGFiZWwyMzI2NzYwMzA1","url":"https://api.github.com/repos/openjdk/jdk/labels/core-libs","name":"core-libs","color":"ededed","default":false,"description":"core-libs-dev@openjdk.org"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":37,"created_at":"2023-11-21T11:09:20Z","updated_at":"2024-05-03T16:51:37Z","closed_at":"2024-04-13T11:58:05Z","author_association":"NONE","type":null,"active_lock_reason":null,"draft":true,"repository":{"id":149121954,"node_id":"MDEwOlJlcG9zaXRvcnkxNDkxMjE5NTQ=","name":"jdk","full_name":"openjdk/jdk","private":false,"owner":{"login":"openjdk","id":41768318,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQxNzY4MzE4","avatar_url":"https://avatars.githubusercontent.com/u/41768318?v=4","gravatar_id":"","url":"https://api.github.com/users/openjdk","html_url":"https://github.com/openjdk","followers_url":"https://api.github.com/users/openjdk/followers","following_url":"https://api.github.com/users/openjdk/following{/other_user}","gists_url":"https://api.github.com/users/openjdk/gists{/gist_id}","starred_url":"https://api.github.com/users/openjdk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openjdk/subscriptions","organizations_url":"https://api.github.com/users/openjdk/orgs","repos_url":"https://api.github.com/users/openjdk/repos","events_url":"https://api.github.com/users/openjdk/events{/privacy}","received_events_url":"https://api.github.com/users/openjdk/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/openjdk/jdk","description":"JDK main-line development https://openjdk.org/projects/jdk","fork":false,"url":"https://api.github.com/repos/openjdk/jdk","forks_url":"https://api.github.com/repos/openjdk/jdk/forks","keys_url":"https://api.github.com/repos/openjdk/jdk/keys{/key_id}","collaborators_url":"https://api.github.com/repos/openjdk/jdk/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/openjdk/jdk/teams","hooks_url":"https://api.github.com/repos/openjdk/jdk/hooks","issue_events_url":"https://api.github.com/repos/openjdk/jdk/issues/events{/number}","events_url":"https://api.github.com/repos/openjdk/jdk/events","assignees_url":"https://api.github.com/repos/openjdk/jdk/assignees{/user}","branches_url":"https://api.github.com/repos/openjdk/jdk/branches{/branch}","tags_url":"https://api.github.com/repos/openjdk/jdk/tags","blobs_url":"https://api.github.com/repos/openjdk/jdk/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/openjdk/jdk/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/openjdk/jdk/git/refs{/sha}","trees_url":"https://api.github.com/repos/openjdk/jdk/git/trees{/sha}","statuses_url":"https://api.github.com/repos/openjdk/jdk/statuses/{sha}","languages_url":"https://api.github.com/repos/openjdk/jdk/languages","stargazers_url":"https://api.github.com/repos/openjdk/jdk/stargazers","contributors_url":"https://api.github.com/repos/openjdk/jdk/contributors","subscribers_url":"https://api.github.com/repos/openjdk/jdk/subscribers","subscription_url":"https://api.github.com/repos/openjdk/jdk/subscription","commits_url":"https://api.github.com/repos/openjdk/jdk/commits{/sha}","git_commits_url":"https://api.github.com/repos/openjdk/jdk/git/commits{/sha}","comments_url":"https://api.github.com/repos/openjdk/jdk/comments{/number}","issue_comment_url":"https://api.github.com/repos/openjdk/jdk/issues/comments{/number}","contents_url":"https://api.github.com/repos/openjdk/jdk/contents/{+path}","compare_url":"https://api.github.com/repos/openjdk/jdk/compare/{base}...{head}","merges_url":"https://api.github.com/repos/openjdk/jdk/merges","archive_url":"https://api.github.com/repos/openjdk/jdk/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/openjdk/jdk/downloads","issues_url":"https://api.github.com/repos/openjdk/jdk/issues{/number}","pulls_url":"https://api.github.com/repos/openjdk/jdk/pulls{/number}","milestones_url":"https://api.github.com/repos/openjdk/jdk/milestones{/number}","notifications_url":"https://api.github.com/repos/openjdk/jdk/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/openjdk/jdk/labels{/name}","releases_url":"https://api.github.com/repos/openjdk/jdk/releases{/id}","deployments_url":"https://api.github.com/repos/openjdk/jdk/deployments","created_at":"2018-09-17T12:29:20Z","updated_at":"2025-11-10T06:19:36Z","pushed_at":"2025-11-10T06:27:24Z","git_url":"git://github.com/openjdk/jdk.git","ssh_url":"git@github.com:openjdk/jdk.git","clone_url":"https://github.com/openjdk/jdk.git","svn_url":"https://github.com/openjdk/jdk","homepage":"","size":1389716,"stargazers_count":22016,"watchers_count":22016,"language":"Java","has_issues":false,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":6149,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":368,"license":{"key":"gpl-2.0","name":"GNU General Public License v2.0","spdx_id":"GPL-2.0","url":"https://api.github.com/licenses/gpl-2.0","node_id":"MDc6TGljZW5zZTg="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["java","jvm","openjdk"],"visibility":"public","forks":6149,"open_issues":368,"watchers":22016,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/openjdk/jdk/pulls/16760","html_url":"https://github.com/openjdk/jdk/pull/16760","diff_url":"https://github.com/openjdk/jdk/pull/16760.diff","patch_url":"https://github.com/openjdk/jdk/pull/16760.patch","merged_at":null},"body":"The motivation behind this PR is explained at https://github.com/netty/netty/issues/13692' and https://github.com/netty/netty/pull/13693 which, due to the limits of Netty to be  \"just\" a Java library, couldn't solve at its root the described performance issue  ie zeroing few bytes performance is cannibalized by JNI bridge cross and chain of method calls.\r\n\r\nObviously this issue is magnified by 2 facts: \r\n1. microbenchmark keep L1 cache hot, which makes even a `call` indirection too costy\r\n2. Netty was unsafely exposing users to a zeroing API\r\n\r\nI see that the original code (related Copy::fill_*) hasn't changed from long time, as none has noticed this performance issue, but looking at which code paths involve zeroing via memset clarify why:  previously, there was no \"hot path\" using it.\r\nIn recent JDK releases, things have changed due to the introduction of https://docs.oracle.com/en/java/javase/21/docs/api/java.base/java/lang/foreign/MemorySegment.html#fill(byte) , exposing OpenJDK users to the poor performance of this method for small writes.\r\n\r\nThere are other Java frameworks in the High-Frequency-Trading land which has exposed users to this API and tried to improve things from Java eg https://github.com/real-logic/agrona/blob/cfdda89a367f5543e13168ab55361afa1cbef4a5/agrona/src/main/java/org/agrona/AbstractMutableDirectBuffer.java#L77-L120\r\n\r\nI've prepared these changes to explore the different options I'm currently capable of (I'm not a OpenJDK developer) and I'm open to learn more interesting ways to solve it, which I'll explore few below.\r\n\r\nFirst, a summary of what I've tried here:\r\n- 5fc0e3c6e66b8046d26950368cd2a13ea4632c03: it is making `Copy::fill_to_memory_atomic` inlinable and it's replacing `UNSAFE_ENTRY` with `UNSAFE_LEAF` specializing it to save try resolving JNI handles (but I didn't perform some of the checks in https://github.com/openjdk/jdk/blob/e055fae104a887c436da9f2924e88029518d5d96/src/hotspot/share/prims/unsafe.cpp#L393-L396)\r\n- 7861d8df77d6879e80d1cd9857d3ab6d911837b9: this is the commit I don't like, because of my current inability to generate a proper fill via stub/macro and intrinsifying the Unsafe call.  \r\nI'm leveraging some existing Java/C2 code paths (eg `intrinsify_fill` - although still getting bound checks :\"( ) to avoid any JNI calls. And it's using an hardcoded cutoff value, which cannot survive in a real commit.\r\n\r\nNumbers below are just indicative of the type of performance improvement I would like to achieve and not including the heap use case (which I still have to implement in the JMH benchmark) nor trying to \"shuffle\" the JIT decisions with the additional compiled branches.\r\n\r\nbaseline (25f9af99be1c906fc85b8192df8fa50cced3474f):\r\n```\r\nBenchmark                           (aligned)  (size)  Mode  Cnt  Score   Error  Units\r\nMemorySegmentZeroUnsafe.panama           true       7  avgt   10  8.257 ? 0.006  ns/op\r\nMemorySegmentZeroUnsafe.unsafe           true       7  avgt   10  7.894 ? 0.012  ns/op\r\nMemorySegmentZeroUnsafe.panama           true      64  avgt   10  8.626 ? 0.073  ns/op\r\nMemorySegmentZeroUnsafe.unsafe           true      64  avgt   10  8.041 ? 0.026  ns/op\r\n```\r\n[Faster Unsafe::setMemory0](https://github.com/openjdk/jdk/commit/5fc0e3c6e66b8046d26950368cd2a13ea4632c03)\r\n```\r\nBenchmark                           (aligned)  (size)  Mode  Cnt  Score   Error  Units\r\nMemorySegmentZeroUnsafe.panama           true       7  avgt   10  6.245 ? 0.004  ns/op\r\nMemorySegmentZeroUnsafe.unsafe           true       7  avgt   10  5.837 ? 0.117  ns/op\r\nMemorySegmentZeroUnsafe.panama           true      64  avgt   10  6.246 ? 0.007  ns/op\r\nMemorySegmentZeroUnsafe.unsafe           true      64  avgt   10  5.798 ? 0.005  ns/op\r\n```\r\n[Improving Java side for fill pattern and save JNI leafs](https://github.com/openjdk/jdk/commit/7861d8df77d6879e80d1cd9857d3ab6d911837b9)\r\n```\r\nBenchmark                           (aligned)  (size)  Mode  Cnt  Score   Error  Units\r\nMemorySegmentZeroUnsafe.panama           true       7  avgt   10  4.348 ? 0.053  ns/op\r\nMemorySegmentZeroUnsafe.unsafe           true       7  avgt   10  3.546 ? 0.010  ns/op\r\nMemorySegmentZeroUnsafe.panama           true      64  avgt   10  4.017 ? 0.002  ns/op\r\nMemorySegmentZeroUnsafe.unsafe           true      64  avgt   10  2.757 ? 0.015  ns/op\r\n```\r\n\r\nGiven that relying on JIT to do its job means assuming C2 to always kick-in, I suppose we care about getting a figure of performance if just C1 is used, which led to set `-XX:+TieredCompilation -XX:TieredStopAtLevel=1` in the `jvmArgs` of the benchmark, and getting:\r\n\r\n[Improving Java side for fill pattern and save JNI leafs](https://github.com/openjdk/jdk/commit/7861d8df77d6879e80d1cd9857d3ab6d911837b9)\r\n```\r\nBenchmark                       (aligned)  (size)  Mode  Cnt   Score   Error  Units\r\nMemorySegmentZeroUnsafe.panama       true       7  avgt   10  13.231 ? 0.480  ns/op\r\nMemorySegmentZeroUnsafe.unsafe       true       7  avgt   10  11.118 ? 0.013  ns/op\r\n```\r\nwhile, with [Faster Unsafe::setMemory0](https://github.com/openjdk/jdk/commit/5fc0e3c6e66b8046d26950368cd2a13ea4632c03)\r\n\r\n```\r\nBenchmark                       (aligned)  (size)  Mode  Cnt   Score   Error  Units\r\nMemorySegmentZeroUnsafe.panama       true       7  avgt   10  20.093 ? 4.528  ns/op\r\nMemorySegmentZeroUnsafe.unsafe       true       7  avgt   10   9.575 ? 0.002  ns/op\r\n```\r\nAnd clearly, the `panama` version suffer from the `MemorySegment` abstraction around `Unsafe`, but the `unsafe` version is slightly regressed in the \"Java optimized\" version, a thing that will likely be more visible with smaller sizes.\n\n<!-- Anything below this marker will be automatically updated, please do not edit manually! -->\n---------\n### Progress\n- [ ] Change must be properly reviewed (1 review required, with at least 1 [Reviewer](https://openjdk.org/bylaws#reviewer))\n- [ ] Change must not contain extraneous whitespace\n- [ ] Commit message must refer to an issue\n\n### Integration blockers\n&nbsp; The commit message does not reference any issue. To add an issue reference to this PR, edit the title to be of the format `issue number`: `message`. (failed with updated jcheck configuration in pull request)\n&nbsp; Too few reviewers with at least role reviewer found (have 0, need at least 1) (failed with updated jcheck configuration in pull request)\n&nbsp; Whitespace errors (failed with updated jcheck configuration in pull request)\n\n### Reviewing\n<details><summary>Using <code>git</code></summary>\n\nCheckout this PR locally: \\\n`$ git fetch https://git.openjdk.org/jdk.git pull/16760/head:pull/16760` \\\n`$ git checkout pull/16760`\n\nUpdate a local copy of the PR: \\\n`$ git checkout pull/16760` \\\n`$ git pull https://git.openjdk.org/jdk.git pull/16760/head`\n\n</details>\n<details><summary>Using Skara CLI tools</summary>\n\nCheckout this PR locally: \\\n`$ git pr checkout 16760`\n\nView PR using the GUI difftool: \\\n`$ git pr show -t 16760`\n\n</details>\n<details><summary>Using diff file</summary>\n\nDownload this PR as a diff file: \\\n<a href=\"https://git.openjdk.org/jdk/pull/16760.diff\">https://git.openjdk.org/jdk/pull/16760.diff</a>\n\n</details>\n","reactions":{"url":"https://api.github.com/repos/openjdk/jdk/issues/16760/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":2},"timeline_url":"https://api.github.com/repos/openjdk/jdk/issues/16760/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":11234287392,"node_id":"DEME_lADOABA-c852Mx_izwAAAAKdnZ8g","url":"https://api.github.com/repos/netty/netty/issues/events/11234287392","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"demilestoned","commit_id":null,"commit_url":null,"created_at":"2023-12-13T10:49:14Z","milestone":{"title":"4.1.102.Final"},"performed_via_github_app":null},{"id":11234287398,"node_id":"MIE_lADOABA-c852Mx_izwAAAAKdnZ8m","url":"https://api.github.com/repos/netty/netty/issues/events/11234287398","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2023-12-13T10:49:14Z","milestone":{"title":"4.1.103.Final"},"performed_via_github_app":null},{"id":11608028827,"node_id":"REFE_lADOABA-c852Mx_izwAAAAKz5Hab","url":"https://api.github.com/repos/netty/netty/issues/events/11608028827","actor":{"login":"tsegismont","id":1500598,"node_id":"MDQ6VXNlcjE1MDA1OTg=","avatar_url":"https://avatars.githubusercontent.com/u/1500598?v=4","gravatar_id":"","url":"https://api.github.com/users/tsegismont","html_url":"https://github.com/tsegismont","followers_url":"https://api.github.com/users/tsegismont/followers","following_url":"https://api.github.com/users/tsegismont/following{/other_user}","gists_url":"https://api.github.com/users/tsegismont/gists{/gist_id}","starred_url":"https://api.github.com/users/tsegismont/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsegismont/subscriptions","organizations_url":"https://api.github.com/users/tsegismont/orgs","repos_url":"https://api.github.com/users/tsegismont/repos","events_url":"https://api.github.com/users/tsegismont/events{/privacy}","received_events_url":"https://api.github.com/users/tsegismont/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5a58f0431e286f2943de75738208b6403c22b722","commit_url":"https://api.github.com/repos/tsegismont/netty/commits/5a58f0431e286f2943de75738208b6403c22b722","created_at":"2024-01-26T11:40:12Z","performed_via_github_app":null}]