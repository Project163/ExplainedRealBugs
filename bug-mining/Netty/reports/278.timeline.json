[{"id":10043163611,"node_id":"RTE_lADOABA-c85t1DAlzwAAAAJWnoPb","url":"https://api.github.com/repos/netty/netty/issues/events/10043163611","actor":{"login":"Lincong","id":9780681,"node_id":"MDQ6VXNlcjk3ODA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9780681?v=4","gravatar_id":"","url":"https://api.github.com/users/Lincong","html_url":"https://github.com/Lincong","followers_url":"https://api.github.com/users/Lincong/followers","following_url":"https://api.github.com/users/Lincong/following{/other_user}","gists_url":"https://api.github.com/users/Lincong/gists{/gist_id}","starred_url":"https://api.github.com/users/Lincong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lincong/subscriptions","organizations_url":"https://api.github.com/users/Lincong/orgs","repos_url":"https://api.github.com/users/Lincong/repos","events_url":"https://api.github.com/users/Lincong/events{/privacy}","received_events_url":"https://api.github.com/users/Lincong/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"renamed","commit_id":null,"commit_url":null,"created_at":"2023-08-09T07:05:42Z","rename":{"from":"Unxpected character is synthesized by DefaultHttp2HeadersDecoder when Huffman encoding is enabled in HpackEncoder","to":"Unexpected characters are synthesized by DefaultHttp2HeadersDecoder when Huffman encoding is enabled in HpackEncoder"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1671799091","html_url":"https://github.com/netty/netty/issues/13540#issuecomment-1671799091","issue_url":"https://api.github.com/repos/netty/netty/issues/13540","id":1671799091,"node_id":"IC_kwDOABA-c85jpaEz","user":{"login":"tmyVvit","id":23135058,"node_id":"MDQ6VXNlcjIzMTM1MDU4","avatar_url":"https://avatars.githubusercontent.com/u/23135058?v=4","gravatar_id":"","url":"https://api.github.com/users/tmyVvit","html_url":"https://github.com/tmyVvit","followers_url":"https://api.github.com/users/tmyVvit/followers","following_url":"https://api.github.com/users/tmyVvit/following{/other_user}","gists_url":"https://api.github.com/users/tmyVvit/gists{/gist_id}","starred_url":"https://api.github.com/users/tmyVvit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmyVvit/subscriptions","organizations_url":"https://api.github.com/users/tmyVvit/orgs","repos_url":"https://api.github.com/users/tmyVvit/repos","events_url":"https://api.github.com/users/tmyVvit/events{/privacy}","received_events_url":"https://api.github.com/users/tmyVvit/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-09T16:53:46Z","updated_at":"2023-08-09T16:53:46Z","body":"I have reproduced it and found that the decoded value is **not equal** to the original value whenever the `enableHuffmanEncoding` is true or false. And I found a comment in `HpackEncoder.java`: Only **ASCII** is allowed in http2 headers(https://tools.ietf.org/html/rfc7540#section-8.1.2), so if there exists unexpected characters, unexpected errors may happen. \r\n1. support charset ISO-8859-1 \r\n<img width=\"804\" alt=\"image\" src=\"https://github.com/netty/netty/assets/23135058/56b43e66-f645-4a34-bf2b-9d64fab5c421\">\r\n2. support characters with one byte \r\n<img width=\"517\" alt=\"image\" src=\"https://github.com/netty/netty/assets/23135058/8b4f6d0d-6574-4804-bb31-345278cabf39\">\r\n\r\nIn your case, your headers contains invalid character, which is not in ISO-8859-1 charset or more than one byte.\r\n\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1671799091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tmyVvit","id":23135058,"node_id":"MDQ6VXNlcjIzMTM1MDU4","avatar_url":"https://avatars.githubusercontent.com/u/23135058?v=4","gravatar_id":"","url":"https://api.github.com/users/tmyVvit","html_url":"https://github.com/tmyVvit","followers_url":"https://api.github.com/users/tmyVvit/followers","following_url":"https://api.github.com/users/tmyVvit/following{/other_user}","gists_url":"https://api.github.com/users/tmyVvit/gists{/gist_id}","starred_url":"https://api.github.com/users/tmyVvit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmyVvit/subscriptions","organizations_url":"https://api.github.com/users/tmyVvit/orgs","repos_url":"https://api.github.com/users/tmyVvit/repos","events_url":"https://api.github.com/users/tmyVvit/events{/privacy}","received_events_url":"https://api.github.com/users/tmyVvit/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672038063","html_url":"https://github.com/netty/netty/issues/13540#issuecomment-1672038063","issue_url":"https://api.github.com/repos/netty/netty/issues/13540","id":1672038063,"node_id":"IC_kwDOABA-c85jqUav","user":{"login":"vkostyukov","id":1098539,"node_id":"MDQ6VXNlcjEwOTg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1098539?v=4","gravatar_id":"","url":"https://api.github.com/users/vkostyukov","html_url":"https://github.com/vkostyukov","followers_url":"https://api.github.com/users/vkostyukov/followers","following_url":"https://api.github.com/users/vkostyukov/following{/other_user}","gists_url":"https://api.github.com/users/vkostyukov/gists{/gist_id}","starred_url":"https://api.github.com/users/vkostyukov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkostyukov/subscriptions","organizations_url":"https://api.github.com/users/vkostyukov/orgs","repos_url":"https://api.github.com/users/vkostyukov/repos","events_url":"https://api.github.com/users/vkostyukov/events{/privacy}","received_events_url":"https://api.github.com/users/vkostyukov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-09T19:39:16Z","updated_at":"2023-08-09T19:39:43Z","body":"Thanks for looking into this @tmyVvit! You're totally right that you're not supposed to use non-US-ASCII chars in the the header values but the interesting bit is that, even if you do, something in the decoder/encoder chain normally does sanitization of the string and replaces characters that are outside of allowed range with `?`. Here is a quick REPL demo:\r\n\r\n```scala\r\n@ val buf = Unpooled.buffer(10000) \r\nbuf: io.netty.buffer.ByteBuf = UnpooledByteBufAllocator$InstrumentedUnpooledUnsafeHeapByteBuf(ridx: 0, widx: 0, cap: 10000)\r\n\r\n@ headers.set(\"some-key\", \"hello 우리는에서문제를발견했습니다world\") \r\nres14: io.netty.handler.codec.http2.Http2Headers = DefaultHttp2Headers[some-key: hello 우리는에서문제를발견했습니다world]\r\n\r\n@ encoder.encodeHeaders(1, headers, buf) \r\n\r\n\r\n@  val decodedHeader = decoder.decodeHeaders(1, buf) \r\ndecodedHeader: io.netty.handler.codec.http2.Http2Headers = DefaultHttp2Headers[some-key: hello ??????????????world, some-key: hello ??????????????world]\r\n\r\n@  val decodedHeaderValue = decodedHeader.get(\"some-key\") \r\ndecodedHeaderValue: CharSequence = hello ??????????????world\r\n```\r\n\r\nSomething in that chain is obviously not doing the sanitization right when a) Huffman encoding is ON and b) the string contains certain UTF-8 chars in the certain positions.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672038063/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vkostyukov","id":1098539,"node_id":"MDQ6VXNlcjEwOTg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1098539?v=4","gravatar_id":"","url":"https://api.github.com/users/vkostyukov","html_url":"https://github.com/vkostyukov","followers_url":"https://api.github.com/users/vkostyukov/followers","following_url":"https://api.github.com/users/vkostyukov/following{/other_user}","gists_url":"https://api.github.com/users/vkostyukov/gists{/gist_id}","starred_url":"https://api.github.com/users/vkostyukov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkostyukov/subscriptions","organizations_url":"https://api.github.com/users/vkostyukov/orgs","repos_url":"https://api.github.com/users/vkostyukov/repos","events_url":"https://api.github.com/users/vkostyukov/events{/privacy}","received_events_url":"https://api.github.com/users/vkostyukov/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10051496821,"node_id":"MEE_lADOABA-c85t1DAlzwAAAAJXHat1","url":"https://api.github.com/repos/netty/netty/issues/events/10051496821","actor":{"login":"tmyVvit","id":23135058,"node_id":"MDQ6VXNlcjIzMTM1MDU4","avatar_url":"https://avatars.githubusercontent.com/u/23135058?v=4","gravatar_id":"","url":"https://api.github.com/users/tmyVvit","html_url":"https://github.com/tmyVvit","followers_url":"https://api.github.com/users/tmyVvit/followers","following_url":"https://api.github.com/users/tmyVvit/following{/other_user}","gists_url":"https://api.github.com/users/tmyVvit/gists{/gist_id}","starred_url":"https://api.github.com/users/tmyVvit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmyVvit/subscriptions","organizations_url":"https://api.github.com/users/tmyVvit/orgs","repos_url":"https://api.github.com/users/tmyVvit/repos","events_url":"https://api.github.com/users/tmyVvit/events{/privacy}","received_events_url":"https://api.github.com/users/tmyVvit/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-08-09T19:39:16Z","performed_via_github_app":null},{"id":10051496830,"node_id":"SE_lADOABA-c85t1DAlzwAAAAJXHat-","url":"https://api.github.com/repos/netty/netty/issues/events/10051496830","actor":{"login":"tmyVvit","id":23135058,"node_id":"MDQ6VXNlcjIzMTM1MDU4","avatar_url":"https://avatars.githubusercontent.com/u/23135058?v=4","gravatar_id":"","url":"https://api.github.com/users/tmyVvit","html_url":"https://github.com/tmyVvit","followers_url":"https://api.github.com/users/tmyVvit/followers","following_url":"https://api.github.com/users/tmyVvit/following{/other_user}","gists_url":"https://api.github.com/users/tmyVvit/gists{/gist_id}","starred_url":"https://api.github.com/users/tmyVvit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmyVvit/subscriptions","organizations_url":"https://api.github.com/users/tmyVvit/orgs","repos_url":"https://api.github.com/users/tmyVvit/repos","events_url":"https://api.github.com/users/tmyVvit/events{/privacy}","received_events_url":"https://api.github.com/users/tmyVvit/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-08-09T19:39:16Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672303945","html_url":"https://github.com/netty/netty/issues/13540#issuecomment-1672303945","issue_url":"https://api.github.com/repos/netty/netty/issues/13540","id":1672303945,"node_id":"IC_kwDOABA-c85jrVVJ","user":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-09T23:19:12Z","updated_at":"2023-08-09T23:34:17Z","body":"@tmyVvit is right: it's the `一` char at index 195 that is turning onto a `0x0`. The only reason it doesn't turn into a `0x0` when not using huffman encoding is because of the `.getBytes(IO_8859_1)` call instead of doing what huffman encoding does and doing a simple truncation via `string.charAt(i) & 0xFF`. Despite not being a `0x0`, it's a certainty that the resulting value is still not what you wanted.\r\n\r\n@vkostyukov, can you provide a complete example? I'm not getting the same results as you. It may depend on how the `DefaultHttp2Headers` is instantiated. Specifically, when I run\r\n```\r\nHttp2Headers headers = new DefaultHttp2Headers(true, true, 16);\r\nheaders.set(\"some-key\", \"hello 우리는에서문제를발견했습니다world\");\r\n\r\nDefaultHttp2HeadersEncoder encoder = new DefaultHttp2HeadersEncoder();\r\nByteBuf buf = Unpooled.buffer(10000);\r\nencoder.encodeHeaders(1, headers, buf);\r\n\r\nHttp2HeadersDecoder decoder = new DefaultHttp2HeadersDecoder();\r\nHttp2Headers decodedHeader = decoder.decodeHeaders(1, buf);\r\nthrow new Exception(\"Value:\" + decodedHeader.get(\"some-key\"));\r\n// results in java.lang.Exception: Value:hello °¬Ð\u001C8\u001C|\u001C¬µÈäworld\r\n```\r\n\r\nWhat you all but certainly want is eager validation when the header is added. Unfortunately, and it doesn't seem to be what you're seeing with the '?'s, but it does look like the default validation is broken [here](https://github.com/netty/netty/blob/4.1/codec-http/src/main/java/io/netty/handler/codec/http/HttpHeaderValidationUtil.java#L143), specifically chars wider than 1 byte will all be considered 'ok' which is wrong.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672303945/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10053091193,"node_id":"MEE_lADOABA-c85t1DAlzwAAAAJXNf95","url":"https://api.github.com/repos/netty/netty/issues/events/10053091193","actor":{"login":"vkostyukov","id":1098539,"node_id":"MDQ6VXNlcjEwOTg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1098539?v=4","gravatar_id":"","url":"https://api.github.com/users/vkostyukov","html_url":"https://github.com/vkostyukov","followers_url":"https://api.github.com/users/vkostyukov/followers","following_url":"https://api.github.com/users/vkostyukov/following{/other_user}","gists_url":"https://api.github.com/users/vkostyukov/gists{/gist_id}","starred_url":"https://api.github.com/users/vkostyukov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkostyukov/subscriptions","organizations_url":"https://api.github.com/users/vkostyukov/orgs","repos_url":"https://api.github.com/users/vkostyukov/repos","events_url":"https://api.github.com/users/vkostyukov/events{/privacy}","received_events_url":"https://api.github.com/users/vkostyukov/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-08-09T23:19:13Z","performed_via_github_app":null},{"id":10053091198,"node_id":"SE_lADOABA-c85t1DAlzwAAAAJXNf9-","url":"https://api.github.com/repos/netty/netty/issues/events/10053091198","actor":{"login":"vkostyukov","id":1098539,"node_id":"MDQ6VXNlcjEwOTg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1098539?v=4","gravatar_id":"","url":"https://api.github.com/users/vkostyukov","html_url":"https://github.com/vkostyukov","followers_url":"https://api.github.com/users/vkostyukov/followers","following_url":"https://api.github.com/users/vkostyukov/following{/other_user}","gists_url":"https://api.github.com/users/vkostyukov/gists{/gist_id}","starred_url":"https://api.github.com/users/vkostyukov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkostyukov/subscriptions","organizations_url":"https://api.github.com/users/vkostyukov/orgs","repos_url":"https://api.github.com/users/vkostyukov/repos","events_url":"https://api.github.com/users/vkostyukov/events{/privacy}","received_events_url":"https://api.github.com/users/vkostyukov/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-08-09T23:19:13Z","performed_via_github_app":null},{"id":10053091203,"node_id":"MEE_lADOABA-c85t1DAlzwAAAAJXNf-D","url":"https://api.github.com/repos/netty/netty/issues/events/10053091203","actor":{"login":"tmyVvit","id":23135058,"node_id":"MDQ6VXNlcjIzMTM1MDU4","avatar_url":"https://avatars.githubusercontent.com/u/23135058?v=4","gravatar_id":"","url":"https://api.github.com/users/tmyVvit","html_url":"https://github.com/tmyVvit","followers_url":"https://api.github.com/users/tmyVvit/followers","following_url":"https://api.github.com/users/tmyVvit/following{/other_user}","gists_url":"https://api.github.com/users/tmyVvit/gists{/gist_id}","starred_url":"https://api.github.com/users/tmyVvit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmyVvit/subscriptions","organizations_url":"https://api.github.com/users/tmyVvit/orgs","repos_url":"https://api.github.com/users/tmyVvit/repos","events_url":"https://api.github.com/users/tmyVvit/events{/privacy}","received_events_url":"https://api.github.com/users/tmyVvit/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-08-09T23:19:13Z","performed_via_github_app":null},{"id":10053091206,"node_id":"SE_lADOABA-c85t1DAlzwAAAAJXNf-G","url":"https://api.github.com/repos/netty/netty/issues/events/10053091206","actor":{"login":"tmyVvit","id":23135058,"node_id":"MDQ6VXNlcjIzMTM1MDU4","avatar_url":"https://avatars.githubusercontent.com/u/23135058?v=4","gravatar_id":"","url":"https://api.github.com/users/tmyVvit","html_url":"https://github.com/tmyVvit","followers_url":"https://api.github.com/users/tmyVvit/followers","following_url":"https://api.github.com/users/tmyVvit/following{/other_user}","gists_url":"https://api.github.com/users/tmyVvit/gists{/gist_id}","starred_url":"https://api.github.com/users/tmyVvit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmyVvit/subscriptions","organizations_url":"https://api.github.com/users/tmyVvit/orgs","repos_url":"https://api.github.com/users/tmyVvit/repos","events_url":"https://api.github.com/users/tmyVvit/events{/privacy}","received_events_url":"https://api.github.com/users/tmyVvit/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-08-09T23:19:13Z","performed_via_github_app":null},{"actor":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-10T00:04:28Z","updated_at":"2023-08-10T00:04:28Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/netty/netty/issues/13541","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/13541/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/13541/comments","events_url":"https://api.github.com/repos/netty/netty/issues/13541/events","html_url":"https://github.com/netty/netty/pull/13541","id":1844201178,"node_id":"PR_kwDOABA-c85XllBD","number":13541,"title":"HttpHeaderValidationUtil should reject chars past the 1 byte range","user":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/277","html_url":"https://github.com/netty/netty/milestone/277","labels_url":"https://api.github.com/repos/netty/netty/milestones/277/labels","id":9703408,"node_id":"MI_kwDOABA-c84AlA_w","number":277,"title":"4.1.97.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":15,"state":"closed","created_at":"2023-07-27T11:00:34Z","updated_at":"2023-08-23T12:37:12Z","due_on":null,"closed_at":"2023-08-23T12:37:12Z"},"comments":0,"created_at":"2023-08-10T00:04:27Z","updated_at":"2023-08-10T17:48:46Z","closed_at":"2023-08-10T17:48:40Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":1064563,"node_id":"MDEwOlJlcG9zaXRvcnkxMDY0NTYz","name":"netty","full_name":"netty/netty","private":false,"owner":{"login":"netty","id":473791,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ3Mzc5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/473791?v=4","gravatar_id":"","url":"https://api.github.com/users/netty","html_url":"https://github.com/netty","followers_url":"https://api.github.com/users/netty/followers","following_url":"https://api.github.com/users/netty/following{/other_user}","gists_url":"https://api.github.com/users/netty/gists{/gist_id}","starred_url":"https://api.github.com/users/netty/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/netty/subscriptions","organizations_url":"https://api.github.com/users/netty/orgs","repos_url":"https://api.github.com/users/netty/repos","events_url":"https://api.github.com/users/netty/events{/privacy}","received_events_url":"https://api.github.com/users/netty/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/netty/netty","description":"Netty project - an event-driven asynchronous network application framework","fork":false,"url":"https://api.github.com/repos/netty/netty","forks_url":"https://api.github.com/repos/netty/netty/forks","keys_url":"https://api.github.com/repos/netty/netty/keys{/key_id}","collaborators_url":"https://api.github.com/repos/netty/netty/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/netty/netty/teams","hooks_url":"https://api.github.com/repos/netty/netty/hooks","issue_events_url":"https://api.github.com/repos/netty/netty/issues/events{/number}","events_url":"https://api.github.com/repos/netty/netty/events","assignees_url":"https://api.github.com/repos/netty/netty/assignees{/user}","branches_url":"https://api.github.com/repos/netty/netty/branches{/branch}","tags_url":"https://api.github.com/repos/netty/netty/tags","blobs_url":"https://api.github.com/repos/netty/netty/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/netty/netty/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/netty/netty/git/refs{/sha}","trees_url":"https://api.github.com/repos/netty/netty/git/trees{/sha}","statuses_url":"https://api.github.com/repos/netty/netty/statuses/{sha}","languages_url":"https://api.github.com/repos/netty/netty/languages","stargazers_url":"https://api.github.com/repos/netty/netty/stargazers","contributors_url":"https://api.github.com/repos/netty/netty/contributors","subscribers_url":"https://api.github.com/repos/netty/netty/subscribers","subscription_url":"https://api.github.com/repos/netty/netty/subscription","commits_url":"https://api.github.com/repos/netty/netty/commits{/sha}","git_commits_url":"https://api.github.com/repos/netty/netty/git/commits{/sha}","comments_url":"https://api.github.com/repos/netty/netty/comments{/number}","issue_comment_url":"https://api.github.com/repos/netty/netty/issues/comments{/number}","contents_url":"https://api.github.com/repos/netty/netty/contents/{+path}","compare_url":"https://api.github.com/repos/netty/netty/compare/{base}...{head}","merges_url":"https://api.github.com/repos/netty/netty/merges","archive_url":"https://api.github.com/repos/netty/netty/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/netty/netty/downloads","issues_url":"https://api.github.com/repos/netty/netty/issues{/number}","pulls_url":"https://api.github.com/repos/netty/netty/pulls{/number}","milestones_url":"https://api.github.com/repos/netty/netty/milestones{/number}","notifications_url":"https://api.github.com/repos/netty/netty/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/netty/netty/labels{/name}","releases_url":"https://api.github.com/repos/netty/netty/releases{/id}","deployments_url":"https://api.github.com/repos/netty/netty/deployments","created_at":"2010-11-09T09:22:21Z","updated_at":"2025-11-10T05:10:03Z","pushed_at":"2025-11-08T09:13:35Z","git_url":"git://github.com/netty/netty.git","ssh_url":"git@github.com:netty/netty.git","clone_url":"https://github.com/netty/netty.git","svn_url":"https://github.com/netty/netty","homepage":"http://netty.io","size":102527,"stargazers_count":34575,"watchers_count":34575,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":16233,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":670,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":16233,"open_issues":670,"watchers":34575,"default_branch":"4.2","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/netty/netty/pulls/13541","html_url":"https://github.com/netty/netty/pull/13541","diff_url":"https://github.com/netty/netty/pull/13541.diff","patch_url":"https://github.com/netty/netty/pull/13541.patch","merged_at":"2023-08-10T17:48:40Z"},"body":"Motivation:\r\n\r\nWhen we use HttpHeaderValidationUtil to validate a non-AsciiString CharSequence we check each byte but don't consider whether it is larger than the max value of 0xFF of obs-text.\r\n\r\nModification:\r\n\r\nCheck is the value is larger than 0xFF.\r\n\r\nResult:\r\n\r\nWe reject more illegal characters.\r\n\r\nRelates to #13540.","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/13541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/13541/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672485295","html_url":"https://github.com/netty/netty/issues/13540#issuecomment-1672485295","issue_url":"https://api.github.com/repos/netty/netty/issues/13540","id":1672485295,"node_id":"IC_kwDOABA-c85jsBmv","user":{"login":"alexc-db","id":86681657,"node_id":"MDQ6VXNlcjg2NjgxNjU3","avatar_url":"https://avatars.githubusercontent.com/u/86681657?v=4","gravatar_id":"","url":"https://api.github.com/users/alexc-db","html_url":"https://github.com/alexc-db","followers_url":"https://api.github.com/users/alexc-db/followers","following_url":"https://api.github.com/users/alexc-db/following{/other_user}","gists_url":"https://api.github.com/users/alexc-db/gists{/gist_id}","starred_url":"https://api.github.com/users/alexc-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexc-db/subscriptions","organizations_url":"https://api.github.com/users/alexc-db/orgs","repos_url":"https://api.github.com/users/alexc-db/repos","events_url":"https://api.github.com/users/alexc-db/events{/privacy}","received_events_url":"https://api.github.com/users/alexc-db/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-10T03:09:55Z","updated_at":"2023-08-10T03:12:22Z","body":"re: https://github.com/netty/netty/issues/13540#issuecomment-1671799091\r\n\r\n@tmyVvit @bryce-anderson what I find a bit confusing in the comment referenced above - https://datatracker.ietf.org/doc/html/rfc7540#section-8.1.2 says\r\n\r\n> header **field names** are strings of ASCII\r\n\r\nwhich covers header names, but it doesn't say anything about header **field values**, which sidetracked us into thinking that field values with non-US-ASCII chars are not illegal, and there's a bug in the `HpackEncoder.java`. would it make sense to update the comment in the `HpackEncoder.java` to clarify that and add more context? after re-reading the spec - think it's covered by https://datatracker.ietf.org/doc/html/rfc7540#section-10.3 which points to the \"field-content\" ABNF rule in https://datatracker.ietf.org/doc/html/rfc7230#section-3.2, and https://datatracker.ietf.org/doc/html/rfc7230#section-3.2.4 which says:\r\n\r\n> Newly defined header fields SHOULD limit their field values to\r\n   US-ASCII octets.  A recipient SHOULD treat other octets in field\r\n   content (obs-text) as opaque data\r\n\r\nI think some clarification would be helpful for posterity.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672485295/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexc-db","id":86681657,"node_id":"MDQ6VXNlcjg2NjgxNjU3","avatar_url":"https://avatars.githubusercontent.com/u/86681657?v=4","gravatar_id":"","url":"https://api.github.com/users/alexc-db","html_url":"https://github.com/alexc-db","followers_url":"https://api.github.com/users/alexc-db/followers","following_url":"https://api.github.com/users/alexc-db/following{/other_user}","gists_url":"https://api.github.com/users/alexc-db/gists{/gist_id}","starred_url":"https://api.github.com/users/alexc-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexc-db/subscriptions","organizations_url":"https://api.github.com/users/alexc-db/orgs","repos_url":"https://api.github.com/users/alexc-db/repos","events_url":"https://api.github.com/users/alexc-db/events{/privacy}","received_events_url":"https://api.github.com/users/alexc-db/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10054159644,"node_id":"MEE_lADOABA-c85t1DAlzwAAAAJXRk0c","url":"https://api.github.com/repos/netty/netty/issues/events/10054159644","actor":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-08-10T03:09:55Z","performed_via_github_app":null},{"id":10054159652,"node_id":"SE_lADOABA-c85t1DAlzwAAAAJXRk0k","url":"https://api.github.com/repos/netty/netty/issues/events/10054159652","actor":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-08-10T03:09:55Z","performed_via_github_app":null},{"id":10054159658,"node_id":"MEE_lADOABA-c85t1DAlzwAAAAJXRk0q","url":"https://api.github.com/repos/netty/netty/issues/events/10054159658","actor":{"login":"tmyVvit","id":23135058,"node_id":"MDQ6VXNlcjIzMTM1MDU4","avatar_url":"https://avatars.githubusercontent.com/u/23135058?v=4","gravatar_id":"","url":"https://api.github.com/users/tmyVvit","html_url":"https://github.com/tmyVvit","followers_url":"https://api.github.com/users/tmyVvit/followers","following_url":"https://api.github.com/users/tmyVvit/following{/other_user}","gists_url":"https://api.github.com/users/tmyVvit/gists{/gist_id}","starred_url":"https://api.github.com/users/tmyVvit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmyVvit/subscriptions","organizations_url":"https://api.github.com/users/tmyVvit/orgs","repos_url":"https://api.github.com/users/tmyVvit/repos","events_url":"https://api.github.com/users/tmyVvit/events{/privacy}","received_events_url":"https://api.github.com/users/tmyVvit/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-08-10T03:09:55Z","performed_via_github_app":null},{"id":10054159662,"node_id":"SE_lADOABA-c85t1DAlzwAAAAJXRk0u","url":"https://api.github.com/repos/netty/netty/issues/events/10054159662","actor":{"login":"tmyVvit","id":23135058,"node_id":"MDQ6VXNlcjIzMTM1MDU4","avatar_url":"https://avatars.githubusercontent.com/u/23135058?v=4","gravatar_id":"","url":"https://api.github.com/users/tmyVvit","html_url":"https://github.com/tmyVvit","followers_url":"https://api.github.com/users/tmyVvit/followers","following_url":"https://api.github.com/users/tmyVvit/following{/other_user}","gists_url":"https://api.github.com/users/tmyVvit/gists{/gist_id}","starred_url":"https://api.github.com/users/tmyVvit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmyVvit/subscriptions","organizations_url":"https://api.github.com/users/tmyVvit/orgs","repos_url":"https://api.github.com/users/tmyVvit/repos","events_url":"https://api.github.com/users/tmyVvit/events{/privacy}","received_events_url":"https://api.github.com/users/tmyVvit/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-08-10T03:09:55Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672520603","html_url":"https://github.com/netty/netty/issues/13540#issuecomment-1672520603","issue_url":"https://api.github.com/repos/netty/netty/issues/13540","id":1672520603,"node_id":"IC_kwDOABA-c85jsKOb","user":{"login":"vkostyukov","id":1098539,"node_id":"MDQ6VXNlcjEwOTg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1098539?v=4","gravatar_id":"","url":"https://api.github.com/users/vkostyukov","html_url":"https://github.com/vkostyukov","followers_url":"https://api.github.com/users/vkostyukov/followers","following_url":"https://api.github.com/users/vkostyukov/following{/other_user}","gists_url":"https://api.github.com/users/vkostyukov/gists{/gist_id}","starred_url":"https://api.github.com/users/vkostyukov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkostyukov/subscriptions","organizations_url":"https://api.github.com/users/vkostyukov/orgs","repos_url":"https://api.github.com/users/vkostyukov/repos","events_url":"https://api.github.com/users/vkostyukov/events{/privacy}","received_events_url":"https://api.github.com/users/vkostyukov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-10T04:04:26Z","updated_at":"2023-08-10T04:06:57Z","body":"It actually looks like [this code path](https://github.com/netty/netty/blob/4.1/codec-http2/src/main/java/io/netty/handler/codec/http2/HpackEncoder.java#L308C17-L310C71) (when Huffman encoding is bypassed) works in our favor, if you will.\r\n\r\n```java\r\n// Only ASCII is allowed in http2 headers, so its fine to use this.\r\n// https://tools.ietf.org/html/rfc7540#section-8.1.2\r\nout.writeCharSequence(string, CharsetUtil.ISO_8859_1);\r\n```\r\n\r\nThis end up calling into `ByteBufUtil.writeAscii` [here](https://github.com/netty/netty/blob/4.1/buffer/src/main/java/io/netty/buffer/AbstractByteBuf.java#L717), which performs sanitization with the `?` character [here](https://github.com/netty/netty/blob/4.1/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java#L1222-L1229). Relevant function is `AsciiString.c2b`\r\n\r\n```java\r\npublic static byte c2b(char c) {\r\n  return (byte) ((c > MAX_CHAR_VALUE) ? '?' : c);\r\n}\r\n```\r\n\r\nPerhaps we should re-use the same conversion function in `HpackHuffmanEncoder` [here](https://github.com/netty/netty/blob/4.1/codec-http2/src/main/java/io/netty/handler/codec/http2/HpackHuffmanEncoder.java#L90) (instead of `data.charAt(i) & 0xFF`) to make sanitization behavior consistent whether or not Huffman encoding is engaged. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672520603/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"vkostyukov","id":1098539,"node_id":"MDQ6VXNlcjEwOTg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1098539?v=4","gravatar_id":"","url":"https://api.github.com/users/vkostyukov","html_url":"https://github.com/vkostyukov","followers_url":"https://api.github.com/users/vkostyukov/followers","following_url":"https://api.github.com/users/vkostyukov/following{/other_user}","gists_url":"https://api.github.com/users/vkostyukov/gists{/gist_id}","starred_url":"https://api.github.com/users/vkostyukov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkostyukov/subscriptions","organizations_url":"https://api.github.com/users/vkostyukov/orgs","repos_url":"https://api.github.com/users/vkostyukov/repos","events_url":"https://api.github.com/users/vkostyukov/events{/privacy}","received_events_url":"https://api.github.com/users/vkostyukov/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672547769","html_url":"https://github.com/netty/netty/issues/13540#issuecomment-1672547769","issue_url":"https://api.github.com/repos/netty/netty/issues/13540","id":1672547769,"node_id":"IC_kwDOABA-c85jsQ25","user":{"login":"alexc-db","id":86681657,"node_id":"MDQ6VXNlcjg2NjgxNjU3","avatar_url":"https://avatars.githubusercontent.com/u/86681657?v=4","gravatar_id":"","url":"https://api.github.com/users/alexc-db","html_url":"https://github.com/alexc-db","followers_url":"https://api.github.com/users/alexc-db/followers","following_url":"https://api.github.com/users/alexc-db/following{/other_user}","gists_url":"https://api.github.com/users/alexc-db/gists{/gist_id}","starred_url":"https://api.github.com/users/alexc-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexc-db/subscriptions","organizations_url":"https://api.github.com/users/alexc-db/orgs","repos_url":"https://api.github.com/users/alexc-db/repos","events_url":"https://api.github.com/users/alexc-db/events{/privacy}","received_events_url":"https://api.github.com/users/alexc-db/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-10T04:47:40Z","updated_at":"2023-08-10T14:26:58Z","body":"> which performs sanitization with the ? character [here](https://github.com/netty/netty/blob/4.1/buffer/src/main/java/io/netty/buffer/ByteBufUtil.java#L1222-L1229)\r\n\r\n+1 to perform sanitization over making non-US-ASCII characters [prohibited](https://github.com/netty/netty/blob/7127e6074c2f4b965305738d7756d196729b493e/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java#L91-L92) - IMO that may break Netty users who happened to put non-US-ASCII chars in the header values without hitting this issue. if there's insufficient test coverage  - making chars prohibited will start failing their requests at runtime causing outages. sanitizing them seems less damaging. as a precedent - Jetty sanitizes non-US-ASCII chars by replacing them with spaces ([ref](https://github.com/eclipse/jetty.project/blob/ad0b5cfa1533e83814c74063b6c2e17b099e5796/jetty-http/src/main/java/org/eclipse/jetty/http/HttpGenerator.java#L894-L906)). given that spec uses \"SHOULD\" when suggesting to restricting chars in field values to US-ASCII octets - I think it may be a reasonable option to sanitize and limit prohibited chars validations to the chars which are prohibited for security reasons https://datatracker.ietf.org/doc/html/rfc7540#section-10.3.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1672547769/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexc-db","id":86681657,"node_id":"MDQ6VXNlcjg2NjgxNjU3","avatar_url":"https://avatars.githubusercontent.com/u/86681657?v=4","gravatar_id":"","url":"https://api.github.com/users/alexc-db","html_url":"https://github.com/alexc-db","followers_url":"https://api.github.com/users/alexc-db/followers","following_url":"https://api.github.com/users/alexc-db/following{/other_user}","gists_url":"https://api.github.com/users/alexc-db/gists{/gist_id}","starred_url":"https://api.github.com/users/alexc-db/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexc-db/subscriptions","organizations_url":"https://api.github.com/users/alexc-db/orgs","repos_url":"https://api.github.com/users/alexc-db/repos","events_url":"https://api.github.com/users/alexc-db/events{/privacy}","received_events_url":"https://api.github.com/users/alexc-db/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1673642218","html_url":"https://github.com/netty/netty/issues/13540#issuecomment-1673642218","issue_url":"https://api.github.com/repos/netty/netty/issues/13540","id":1673642218,"node_id":"IC_kwDOABA-c85jwcDq","user":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-10T17:42:31Z","updated_at":"2023-08-10T17:42:31Z","body":"> Perhaps we should re-use the same conversion function in HpackHuffmanEncoder [here](https://github.com/netty/netty/blob/4.1/codec-http2/src/main/java/io/netty/handler/codec/http2/HpackHuffmanEncoder.java#L90) (instead of data.charAt(i) & 0xFF) to make sanitization behavior consistent whether or not Huffman encoding is engaged.\r\n\r\nI think that makes sense, [here](https://github.com/netty/netty/blob/4.1/codec-http2/src/main/java/io/netty/handler/codec/http2/HpackHuffmanEncoder.java#L136) would also need to be fixed. Would one of you be interested in putting up a PR?\r\n\r\n> +1 to perform sanitization over making non-US-ASCII characters [prohibited](https://github.com/netty/netty/blob/7127e6074c2f4b965305738d7756d196729b493e/codec-http2/src/main/java/io/netty/handler/codec/http2/DefaultHttp2Headers.java#L91-L92) - IMO that may break Netty users who happened to put non-US-ASCII chars in the header values without hitting this issue.\r\n\r\nThese are not mutually exclusive: the validation is optional (and disabled by default) and happens on header insertion which is a nice feature since it lets you figure out what code is adding illegal headers so you can fix you app. If we don't fix the validation the feature will remain forever broken.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1673642218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10062248434,"node_id":"REFE_lADOABA-c85t1DAlzwAAAAJXwbny","url":"https://api.github.com/repos/netty/netty/issues/events/10062248434","actor":{"login":"chrisvest","id":7993,"node_id":"MDQ6VXNlcjc5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/7993?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisvest","html_url":"https://github.com/chrisvest","followers_url":"https://api.github.com/users/chrisvest/followers","following_url":"https://api.github.com/users/chrisvest/following{/other_user}","gists_url":"https://api.github.com/users/chrisvest/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisvest/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisvest/subscriptions","organizations_url":"https://api.github.com/users/chrisvest/orgs","repos_url":"https://api.github.com/users/chrisvest/repos","events_url":"https://api.github.com/users/chrisvest/events{/privacy}","received_events_url":"https://api.github.com/users/chrisvest/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"6f1646fe3aaa5c53f1f1376e049c71e69030dc40","commit_url":"https://api.github.com/repos/netty/netty/commits/6f1646fe3aaa5c53f1f1376e049c71e69030dc40","created_at":"2023-08-10T17:48:46Z","performed_via_github_app":null},{"id":10062285493,"node_id":"REFE_lADOABA-c85t1DAlzwAAAAJXwkq1","url":"https://api.github.com/repos/netty/netty/issues/events/10062285493","actor":{"login":"chrisvest","id":7993,"node_id":"MDQ6VXNlcjc5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/7993?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisvest","html_url":"https://github.com/chrisvest","followers_url":"https://api.github.com/users/chrisvest/followers","following_url":"https://api.github.com/users/chrisvest/following{/other_user}","gists_url":"https://api.github.com/users/chrisvest/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisvest/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisvest/subscriptions","organizations_url":"https://api.github.com/users/chrisvest/orgs","repos_url":"https://api.github.com/users/chrisvest/repos","events_url":"https://api.github.com/users/chrisvest/events{/privacy}","received_events_url":"https://api.github.com/users/chrisvest/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"650f6c766aac5aaaae1b89d9327f93fe6aaf5c37","commit_url":"https://api.github.com/repos/netty/netty/commits/650f6c766aac5aaaae1b89d9327f93fe6aaf5c37","created_at":"2023-08-10T17:52:34Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/netty/netty/issues/comments/1673694057","html_url":"https://github.com/netty/netty/issues/13540#issuecomment-1673694057","issue_url":"https://api.github.com/repos/netty/netty/issues/13540","id":1673694057,"node_id":"IC_kwDOABA-c85jwotp","user":{"login":"Lincong","id":9780681,"node_id":"MDQ6VXNlcjk3ODA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9780681?v=4","gravatar_id":"","url":"https://api.github.com/users/Lincong","html_url":"https://github.com/Lincong","followers_url":"https://api.github.com/users/Lincong/followers","following_url":"https://api.github.com/users/Lincong/following{/other_user}","gists_url":"https://api.github.com/users/Lincong/gists{/gist_id}","starred_url":"https://api.github.com/users/Lincong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lincong/subscriptions","organizations_url":"https://api.github.com/users/Lincong/orgs","repos_url":"https://api.github.com/users/Lincong/repos","events_url":"https://api.github.com/users/Lincong/events{/privacy}","received_events_url":"https://api.github.com/users/Lincong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-10T18:19:54Z","updated_at":"2023-08-10T18:20:18Z","body":">I think that makes sense, [here](https://github.com/netty/netty/blob/4.1/codec-http2/src/main/java/io/netty/handler/codec/http2/HpackHuffmanEncoder.java#L136) would also need to be fixed. Would one of you be interested in putting up a PR?\r\n\r\nI will give it a shot (putting up a PR)! @bryce-anderson @vkostyukov ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/comments/1673694057/reactions","total_count":5,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":5,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Lincong","id":9780681,"node_id":"MDQ6VXNlcjk3ODA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9780681?v=4","gravatar_id":"","url":"https://api.github.com/users/Lincong","html_url":"https://github.com/Lincong","followers_url":"https://api.github.com/users/Lincong/followers","following_url":"https://api.github.com/users/Lincong/following{/other_user}","gists_url":"https://api.github.com/users/Lincong/gists{/gist_id}","starred_url":"https://api.github.com/users/Lincong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lincong/subscriptions","organizations_url":"https://api.github.com/users/Lincong/orgs","repos_url":"https://api.github.com/users/Lincong/repos","events_url":"https://api.github.com/users/Lincong/events{/privacy}","received_events_url":"https://api.github.com/users/Lincong/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10062565406,"node_id":"MEE_lADOABA-c85t1DAlzwAAAAJXxpAe","url":"https://api.github.com/repos/netty/netty/issues/events/10062565406","actor":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-08-10T18:20:19Z","performed_via_github_app":null},{"id":10062565426,"node_id":"SE_lADOABA-c85t1DAlzwAAAAJXxpAy","url":"https://api.github.com/repos/netty/netty/issues/events/10062565426","actor":{"login":"bryce-anderson","id":2948506,"node_id":"MDQ6VXNlcjI5NDg1MDY=","avatar_url":"https://avatars.githubusercontent.com/u/2948506?v=4","gravatar_id":"","url":"https://api.github.com/users/bryce-anderson","html_url":"https://github.com/bryce-anderson","followers_url":"https://api.github.com/users/bryce-anderson/followers","following_url":"https://api.github.com/users/bryce-anderson/following{/other_user}","gists_url":"https://api.github.com/users/bryce-anderson/gists{/gist_id}","starred_url":"https://api.github.com/users/bryce-anderson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bryce-anderson/subscriptions","organizations_url":"https://api.github.com/users/bryce-anderson/orgs","repos_url":"https://api.github.com/users/bryce-anderson/repos","events_url":"https://api.github.com/users/bryce-anderson/events{/privacy}","received_events_url":"https://api.github.com/users/bryce-anderson/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-08-10T18:20:19Z","performed_via_github_app":null},{"id":10062565444,"node_id":"MEE_lADOABA-c85t1DAlzwAAAAJXxpBE","url":"https://api.github.com/repos/netty/netty/issues/events/10062565444","actor":{"login":"vkostyukov","id":1098539,"node_id":"MDQ6VXNlcjEwOTg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1098539?v=4","gravatar_id":"","url":"https://api.github.com/users/vkostyukov","html_url":"https://github.com/vkostyukov","followers_url":"https://api.github.com/users/vkostyukov/followers","following_url":"https://api.github.com/users/vkostyukov/following{/other_user}","gists_url":"https://api.github.com/users/vkostyukov/gists{/gist_id}","starred_url":"https://api.github.com/users/vkostyukov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkostyukov/subscriptions","organizations_url":"https://api.github.com/users/vkostyukov/orgs","repos_url":"https://api.github.com/users/vkostyukov/repos","events_url":"https://api.github.com/users/vkostyukov/events{/privacy}","received_events_url":"https://api.github.com/users/vkostyukov/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-08-10T18:20:19Z","performed_via_github_app":null},{"id":10062565463,"node_id":"SE_lADOABA-c85t1DAlzwAAAAJXxpBX","url":"https://api.github.com/repos/netty/netty/issues/events/10062565463","actor":{"login":"vkostyukov","id":1098539,"node_id":"MDQ6VXNlcjEwOTg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1098539?v=4","gravatar_id":"","url":"https://api.github.com/users/vkostyukov","html_url":"https://github.com/vkostyukov","followers_url":"https://api.github.com/users/vkostyukov/followers","following_url":"https://api.github.com/users/vkostyukov/following{/other_user}","gists_url":"https://api.github.com/users/vkostyukov/gists{/gist_id}","starred_url":"https://api.github.com/users/vkostyukov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkostyukov/subscriptions","organizations_url":"https://api.github.com/users/vkostyukov/orgs","repos_url":"https://api.github.com/users/vkostyukov/repos","events_url":"https://api.github.com/users/vkostyukov/events{/privacy}","received_events_url":"https://api.github.com/users/vkostyukov/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-08-10T18:20:19Z","performed_via_github_app":null},{"actor":{"login":"Lincong","id":9780681,"node_id":"MDQ6VXNlcjk3ODA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9780681?v=4","gravatar_id":"","url":"https://api.github.com/users/Lincong","html_url":"https://github.com/Lincong","followers_url":"https://api.github.com/users/Lincong/followers","following_url":"https://api.github.com/users/Lincong/following{/other_user}","gists_url":"https://api.github.com/users/Lincong/gists{/gist_id}","starred_url":"https://api.github.com/users/Lincong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lincong/subscriptions","organizations_url":"https://api.github.com/users/Lincong/orgs","repos_url":"https://api.github.com/users/Lincong/repos","events_url":"https://api.github.com/users/Lincong/events{/privacy}","received_events_url":"https://api.github.com/users/Lincong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-13T06:41:57Z","updated_at":"2023-08-13T06:41:57Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/netty/netty/issues/13546","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/13546/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/13546/comments","events_url":"https://api.github.com/repos/netty/netty/issues/13546/events","html_url":"https://github.com/netty/netty/pull/13546","id":1848444825,"node_id":"PR_kwDOABA-c85X0BFj","number":13546,"title":"Sanitize all multibyte chars in HpackHuffmanEncoder","user":{"login":"Lincong","id":9780681,"node_id":"MDQ6VXNlcjk3ODA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9780681?v=4","gravatar_id":"","url":"https://api.github.com/users/Lincong","html_url":"https://github.com/Lincong","followers_url":"https://api.github.com/users/Lincong/followers","following_url":"https://api.github.com/users/Lincong/following{/other_user}","gists_url":"https://api.github.com/users/Lincong/gists{/gist_id}","starred_url":"https://api.github.com/users/Lincong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lincong/subscriptions","organizations_url":"https://api.github.com/users/Lincong/orgs","repos_url":"https://api.github.com/users/Lincong/repos","events_url":"https://api.github.com/users/Lincong/events{/privacy}","received_events_url":"https://api.github.com/users/Lincong/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/277","html_url":"https://github.com/netty/netty/milestone/277","labels_url":"https://api.github.com/repos/netty/netty/milestones/277/labels","id":9703408,"node_id":"MI_kwDOABA-c84AlA_w","number":277,"title":"4.1.97.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":15,"state":"closed","created_at":"2023-07-27T11:00:34Z","updated_at":"2023-08-23T12:37:12Z","due_on":null,"closed_at":"2023-08-23T12:37:12Z"},"comments":5,"created_at":"2023-08-13T06:41:56Z","updated_at":"2023-08-17T22:35:45Z","closed_at":"2023-08-17T03:31:55Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":1064563,"node_id":"MDEwOlJlcG9zaXRvcnkxMDY0NTYz","name":"netty","full_name":"netty/netty","private":false,"owner":{"login":"netty","id":473791,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ3Mzc5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/473791?v=4","gravatar_id":"","url":"https://api.github.com/users/netty","html_url":"https://github.com/netty","followers_url":"https://api.github.com/users/netty/followers","following_url":"https://api.github.com/users/netty/following{/other_user}","gists_url":"https://api.github.com/users/netty/gists{/gist_id}","starred_url":"https://api.github.com/users/netty/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/netty/subscriptions","organizations_url":"https://api.github.com/users/netty/orgs","repos_url":"https://api.github.com/users/netty/repos","events_url":"https://api.github.com/users/netty/events{/privacy}","received_events_url":"https://api.github.com/users/netty/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/netty/netty","description":"Netty project - an event-driven asynchronous network application framework","fork":false,"url":"https://api.github.com/repos/netty/netty","forks_url":"https://api.github.com/repos/netty/netty/forks","keys_url":"https://api.github.com/repos/netty/netty/keys{/key_id}","collaborators_url":"https://api.github.com/repos/netty/netty/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/netty/netty/teams","hooks_url":"https://api.github.com/repos/netty/netty/hooks","issue_events_url":"https://api.github.com/repos/netty/netty/issues/events{/number}","events_url":"https://api.github.com/repos/netty/netty/events","assignees_url":"https://api.github.com/repos/netty/netty/assignees{/user}","branches_url":"https://api.github.com/repos/netty/netty/branches{/branch}","tags_url":"https://api.github.com/repos/netty/netty/tags","blobs_url":"https://api.github.com/repos/netty/netty/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/netty/netty/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/netty/netty/git/refs{/sha}","trees_url":"https://api.github.com/repos/netty/netty/git/trees{/sha}","statuses_url":"https://api.github.com/repos/netty/netty/statuses/{sha}","languages_url":"https://api.github.com/repos/netty/netty/languages","stargazers_url":"https://api.github.com/repos/netty/netty/stargazers","contributors_url":"https://api.github.com/repos/netty/netty/contributors","subscribers_url":"https://api.github.com/repos/netty/netty/subscribers","subscription_url":"https://api.github.com/repos/netty/netty/subscription","commits_url":"https://api.github.com/repos/netty/netty/commits{/sha}","git_commits_url":"https://api.github.com/repos/netty/netty/git/commits{/sha}","comments_url":"https://api.github.com/repos/netty/netty/comments{/number}","issue_comment_url":"https://api.github.com/repos/netty/netty/issues/comments{/number}","contents_url":"https://api.github.com/repos/netty/netty/contents/{+path}","compare_url":"https://api.github.com/repos/netty/netty/compare/{base}...{head}","merges_url":"https://api.github.com/repos/netty/netty/merges","archive_url":"https://api.github.com/repos/netty/netty/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/netty/netty/downloads","issues_url":"https://api.github.com/repos/netty/netty/issues{/number}","pulls_url":"https://api.github.com/repos/netty/netty/pulls{/number}","milestones_url":"https://api.github.com/repos/netty/netty/milestones{/number}","notifications_url":"https://api.github.com/repos/netty/netty/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/netty/netty/labels{/name}","releases_url":"https://api.github.com/repos/netty/netty/releases{/id}","deployments_url":"https://api.github.com/repos/netty/netty/deployments","created_at":"2010-11-09T09:22:21Z","updated_at":"2025-11-10T05:10:03Z","pushed_at":"2025-11-08T09:13:35Z","git_url":"git://github.com/netty/netty.git","ssh_url":"git@github.com:netty/netty.git","clone_url":"https://github.com/netty/netty.git","svn_url":"https://github.com/netty/netty","homepage":"http://netty.io","size":102527,"stargazers_count":34575,"watchers_count":34575,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":16233,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":670,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":16233,"open_issues":670,"watchers":34575,"default_branch":"4.2","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/netty/netty/pulls/13546","html_url":"https://github.com/netty/netty/pull/13546","diff_url":"https://github.com/netty/netty/pull/13546.diff","patch_url":"https://github.com/netty/netty/pull/13546.patch","merged_at":"2023-08-17T03:31:55Z"},"body":"Motivation:\r\n\r\nTo fix the following problem: during encoding, Huffman encoded headers are sanitized differently compared to non-Huffman encoded headers in `HpackEncoder`. As a result, characters with code point values higher than 0xFF which could be decoded to an unexpected control chars instead of `'?'`.\r\n\r\nModification:\r\n\r\nChange how each character is sanitized in `HpackHuffmanEncoder`. Specifically, use the new approach [1] to replace the old approach [2].\r\n\r\n[1] `AsciiString.c2b(aChar) & 0xFF`\r\n[2] `aChar & 0xFF`\r\n\r\nExpected output is `0` if `aChar > 0xFF`. But with the old approach, if `aChar == 0x4E01`, `0x4E01 & 0xFF == 1` which is incorrect.\r\n\r\nResult:\r\nAll characters with code point values higher than 0xFF are decoded to `?`s regardless of whether Huffman encoding was used during encoding.\r\n\r\nFixes #13540","reactions":{"url":"https://api.github.com/repos/netty/netty/issues/13546/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/13546/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"actor":{"login":"xlq20080808","id":33999699,"node_id":"MDQ6VXNlcjMzOTk5Njk5","avatar_url":"https://avatars.githubusercontent.com/u/33999699?v=4","gravatar_id":"","url":"https://api.github.com/users/xlq20080808","html_url":"https://github.com/xlq20080808","followers_url":"https://api.github.com/users/xlq20080808/followers","following_url":"https://api.github.com/users/xlq20080808/following{/other_user}","gists_url":"https://api.github.com/users/xlq20080808/gists{/gist_id}","starred_url":"https://api.github.com/users/xlq20080808/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xlq20080808/subscriptions","organizations_url":"https://api.github.com/users/xlq20080808/orgs","repos_url":"https://api.github.com/users/xlq20080808/repos","events_url":"https://api.github.com/users/xlq20080808/events{/privacy}","received_events_url":"https://api.github.com/users/xlq20080808/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-15T09:53:12Z","updated_at":"2023-08-15T09:53:12Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/apache/dubbo/issues/12904","repository_url":"https://api.github.com/repos/apache/dubbo","labels_url":"https://api.github.com/repos/apache/dubbo/issues/12904/labels{/name}","comments_url":"https://api.github.com/repos/apache/dubbo/issues/12904/comments","events_url":"https://api.github.com/repos/apache/dubbo/issues/12904/events","html_url":"https://github.com/apache/dubbo/issues/12904","id":1851181160,"node_id":"I_kwDOAEfiCM5uVsho","number":12904,"title":"Triple attachment does not support non-ASCII characters","user":{"login":"xlq20080808","id":33999699,"node_id":"MDQ6VXNlcjMzOTk5Njk5","avatar_url":"https://avatars.githubusercontent.com/u/33999699?v=4","gravatar_id":"","url":"https://api.github.com/users/xlq20080808","html_url":"https://github.com/xlq20080808","followers_url":"https://api.github.com/users/xlq20080808/followers","following_url":"https://api.github.com/users/xlq20080808/following{/other_user}","gists_url":"https://api.github.com/users/xlq20080808/gists{/gist_id}","starred_url":"https://api.github.com/users/xlq20080808/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xlq20080808/subscriptions","organizations_url":"https://api.github.com/users/xlq20080808/orgs","repos_url":"https://api.github.com/users/xlq20080808/repos","events_url":"https://api.github.com/users/xlq20080808/events{/privacy}","received_events_url":"https://api.github.com/users/xlq20080808/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":699750892,"node_id":"MDU6TGFiZWw2OTk3NTA4OTI=","url":"https://api.github.com/repos/apache/dubbo/labels/help%20wanted","name":"help wanted","color":"0e8a16","default":true,"description":"Everything needs help from contributors"},{"id":3964304073,"node_id":"LA_kwDOAEfiCM7sSnrJ","url":"https://api.github.com/repos/apache/dubbo/labels/type/enhancement","name":"type/enhancement","color":"C5DEF5","default":false,"description":"Everything related with code enhancement or performance"},{"id":6663511266,"node_id":"LA_kwDOAEfiCM8AAAABjS0c4g","url":"https://api.github.com/repos/apache/dubbo/labels/component/sdk","name":"component/sdk","color":"FEF2C0","default":false,"description":"Related with apache/dubbo"}],"state":"open","locked":false,"assignee":{"login":"oxsean","id":716461,"node_id":"MDQ6VXNlcjcxNjQ2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/716461?v=4","gravatar_id":"","url":"https://api.github.com/users/oxsean","html_url":"https://github.com/oxsean","followers_url":"https://api.github.com/users/oxsean/followers","following_url":"https://api.github.com/users/oxsean/following{/other_user}","gists_url":"https://api.github.com/users/oxsean/gists{/gist_id}","starred_url":"https://api.github.com/users/oxsean/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oxsean/subscriptions","organizations_url":"https://api.github.com/users/oxsean/orgs","repos_url":"https://api.github.com/users/oxsean/repos","events_url":"https://api.github.com/users/oxsean/events{/privacy}","received_events_url":"https://api.github.com/users/oxsean/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"oxsean","id":716461,"node_id":"MDQ6VXNlcjcxNjQ2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/716461?v=4","gravatar_id":"","url":"https://api.github.com/users/oxsean","html_url":"https://github.com/oxsean","followers_url":"https://api.github.com/users/oxsean/followers","following_url":"https://api.github.com/users/oxsean/following{/other_user}","gists_url":"https://api.github.com/users/oxsean/gists{/gist_id}","starred_url":"https://api.github.com/users/oxsean/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oxsean/subscriptions","organizations_url":"https://api.github.com/users/oxsean/orgs","repos_url":"https://api.github.com/users/oxsean/repos","events_url":"https://api.github.com/users/oxsean/events{/privacy}","received_events_url":"https://api.github.com/users/oxsean/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2023-08-15T09:50:50Z","updated_at":"2024-09-09T06:29:51Z","closed_at":null,"author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":4710920,"node_id":"MDEwOlJlcG9zaXRvcnk0NzEwOTIw","name":"dubbo","full_name":"apache/dubbo","private":false,"owner":{"login":"apache","id":47359,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ3MzU5","avatar_url":"https://avatars.githubusercontent.com/u/47359?v=4","gravatar_id":"","url":"https://api.github.com/users/apache","html_url":"https://github.com/apache","followers_url":"https://api.github.com/users/apache/followers","following_url":"https://api.github.com/users/apache/following{/other_user}","gists_url":"https://api.github.com/users/apache/gists{/gist_id}","starred_url":"https://api.github.com/users/apache/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apache/subscriptions","organizations_url":"https://api.github.com/users/apache/orgs","repos_url":"https://api.github.com/users/apache/repos","events_url":"https://api.github.com/users/apache/events{/privacy}","received_events_url":"https://api.github.com/users/apache/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/apache/dubbo","description":"The java implementation of Apache Dubbo. An RPC and microservice framework.","fork":false,"url":"https://api.github.com/repos/apache/dubbo","forks_url":"https://api.github.com/repos/apache/dubbo/forks","keys_url":"https://api.github.com/repos/apache/dubbo/keys{/key_id}","collaborators_url":"https://api.github.com/repos/apache/dubbo/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/apache/dubbo/teams","hooks_url":"https://api.github.com/repos/apache/dubbo/hooks","issue_events_url":"https://api.github.com/repos/apache/dubbo/issues/events{/number}","events_url":"https://api.github.com/repos/apache/dubbo/events","assignees_url":"https://api.github.com/repos/apache/dubbo/assignees{/user}","branches_url":"https://api.github.com/repos/apache/dubbo/branches{/branch}","tags_url":"https://api.github.com/repos/apache/dubbo/tags","blobs_url":"https://api.github.com/repos/apache/dubbo/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/apache/dubbo/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/apache/dubbo/git/refs{/sha}","trees_url":"https://api.github.com/repos/apache/dubbo/git/trees{/sha}","statuses_url":"https://api.github.com/repos/apache/dubbo/statuses/{sha}","languages_url":"https://api.github.com/repos/apache/dubbo/languages","stargazers_url":"https://api.github.com/repos/apache/dubbo/stargazers","contributors_url":"https://api.github.com/repos/apache/dubbo/contributors","subscribers_url":"https://api.github.com/repos/apache/dubbo/subscribers","subscription_url":"https://api.github.com/repos/apache/dubbo/subscription","commits_url":"https://api.github.com/repos/apache/dubbo/commits{/sha}","git_commits_url":"https://api.github.com/repos/apache/dubbo/git/commits{/sha}","comments_url":"https://api.github.com/repos/apache/dubbo/comments{/number}","issue_comment_url":"https://api.github.com/repos/apache/dubbo/issues/comments{/number}","contents_url":"https://api.github.com/repos/apache/dubbo/contents/{+path}","compare_url":"https://api.github.com/repos/apache/dubbo/compare/{base}...{head}","merges_url":"https://api.github.com/repos/apache/dubbo/merges","archive_url":"https://api.github.com/repos/apache/dubbo/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/apache/dubbo/downloads","issues_url":"https://api.github.com/repos/apache/dubbo/issues{/number}","pulls_url":"https://api.github.com/repos/apache/dubbo/pulls{/number}","milestones_url":"https://api.github.com/repos/apache/dubbo/milestones{/number}","notifications_url":"https://api.github.com/repos/apache/dubbo/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/apache/dubbo/labels{/name}","releases_url":"https://api.github.com/repos/apache/dubbo/releases{/id}","deployments_url":"https://api.github.com/repos/apache/dubbo/deployments","created_at":"2012-06-19T07:56:02Z","updated_at":"2025-11-10T05:09:05Z","pushed_at":"2025-11-10T02:12:08Z","git_url":"git://github.com/apache/dubbo.git","ssh_url":"git@github.com:apache/dubbo.git","clone_url":"https://github.com/apache/dubbo.git","svn_url":"https://github.com/apache/dubbo","homepage":"https://dubbo.apache.org/","size":60763,"stargazers_count":41569,"watchers_count":41569,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":26553,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":914,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["distributed-systems","dubbo","framework","grpc","http","java","microservices","restful","rpc","service-mesh","web"],"visibility":"public","forks":26553,"open_issues":914,"watchers":41569,"default_branch":"3.3","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"<!-- If you need to report a security issue please visit https://github.com/apache/dubbo/security/policy -->\r\n\r\n- [x] I have searched the [issues](https://github.com/apache/dubbo/issues) of this repository and believe that this is not a duplicate.\r\n\r\n### Environment\r\n\r\n* Dubbo version: 3.2.5\r\n* Java version: 1.8\r\n\r\n### Steps to reproduce this issue\r\n\r\n1. Insert a value containing non-ASCII characters in the attachment\r\n2. Get the attachment in the provider, where non-ascii characters are converted to \"?\"\r\n\r\nreproduce this issue.\r\n```\r\nimport org.apache.dubbo.rpc.Filter;\r\nimport org.apache.dubbo.rpc.Invocation;\r\nimport org.apache.dubbo.rpc.Invoker;\r\nimport org.apache.dubbo.rpc.Result;\r\nimport org.apache.dubbo.rpc.RpcContext;\r\nimport org.apache.dubbo.rpc.RpcException;\r\n\r\npublic class ClientContextAppender implements Filter {\r\n    public ClientContextAppender() {\r\n    }\r\n\r\n    public Result invoke(Invoker<?> invoker, Invocation invocation) throws RpcException {\r\n        RpcContext context = RpcContext.getClientAttachment();\r\n        context.setAttachment(\"non-Ascii\", \"zh这是中文zh\");\r\n        return invoker.invoke(invocation);\r\n    }\r\n}\r\n```\r\n<img width=\"250\" alt=\"image\" src=\"https://github.com/apache/dubbo/assets/33999699/a72ecc0c-c805-4024-b147-c392bda02ecf\">\r\n\r\n### Expected Behavior\r\n\r\n<!-- What do you expect from the above steps？-->\r\nConsistent with the attachment of the dubbo protocol, The triple protocol can also pass values containing non-ASCII characters\r\n\r\n### Actual Behavior\r\n\r\n<!-- What actually happens? -->\r\nNon-ASCII characters are converted to '?'\r\n\r\n### Problem Code\r\nThe netty's huffman encoding condition\r\n<img width=\"500\" alt=\"image\" src=\"https://github.com/apache/dubbo/assets/33999699/badde628-636a-45ea-b2a4-b4b7b5a2f48a\">\r\n#### Not hit netty's huffman encoding condition\r\n\r\nWhen netty does not hit the huffman encoding of the header, it will convert the non-ascii code to '?'\r\n\r\n```\r\nc2b:1857, AsciiString (io.netty.util)\r\nwriteAscii:1188, ByteBufUtil (io.netty.buffer)\r\nsetCharSequence0:717, AbstractByteBuf (io.netty.buffer)\r\nwriteCharSequence:1187, AbstractByteBuf (io.netty.buffer)\r\nencodeStringLiteral:279, HpackEncoder (io.netty.handler.codec.http2)\r\nencodeLiteral:306, HpackEncoder (io.netty.handler.codec.http2)\r\nencodeHeader:194, HpackEncoder (io.netty.handler.codec.http2)\r\nencodeHeadersIgnoreMaxHeaderListSize:145, HpackEncoder (io.netty.handler.codec.http2)\r\nencodeHeadersEnforceMaxHeaderListSize:137, HpackEncoder (io.netty.handler.codec.http2)\r\nencodeHeaders:118, HpackEncoder (io.netty.handler.codec.http2)\r\nencodeHeaders:74, DefaultHttp2HeadersEncoder (io.netty.handler.codec.http2)\r\n...\r\n```\r\n<img width=\"500\" alt=\"image\" src=\"https://github.com/apache/dubbo/assets/33999699/dc4a42c5-28b0-4fd2-887c-7652d5ffbfbb\">\r\n\r\n#### Hit netty's huffman encoding condition\r\n4.1.86.Final Netty has a [bug](https://github.com/netty/netty/issues/13540) in the conversion\r\n\r\nWhen netty hits the huffman encoding condition of the header, non-ASCII characters are cleaned to the ASCII range\r\n<img width=\"500\" alt=\"image\" src=\"https://github.com/apache/dubbo/assets/33999699/fbbfbadb-9282-4436-8578-c68e6ab490c3\">\r\nSuch a convert may cause unexpected errors\r\nNon-ASCII characters may be converted to characters less than 32\r\nFor example, envoy will check the value of the header, and if it finds characters less than 32, it will report an error\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/dubbo/issues/12904/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/apache/dubbo/issues/12904/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":10114483660,"node_id":"CE_lADOABA-c85t1DAlzwAAAAJa3sXM","url":"https://api.github.com/repos/netty/netty/issues/events/10114483660","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2023-08-17T03:31:56Z","state_reason":null,"performed_via_github_app":null},{"id":10114483767,"node_id":"REFE_lADOABA-c85t1DAlzwAAAAJa3sY3","url":"https://api.github.com/repos/netty/netty/issues/events/10114483767","actor":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"aa07be47d9d2bbb09b1ca9897575ebc4de6056c0","commit_url":"https://api.github.com/repos/netty/netty/commits/aa07be47d9d2bbb09b1ca9897575ebc4de6056c0","created_at":"2023-08-17T03:31:58Z","performed_via_github_app":null}]