{"url":"https://api.github.com/repos/netty/netty/issues/13273","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/13273/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/13273/comments","events_url":"https://api.github.com/repos/netty/netty/issues/13273/events","html_url":"https://github.com/netty/netty/issues/13273","id":1621725553,"node_id":"I_kwDOABA-c85gqZFx","number":13273,"title":"HttpObjectDecoder.getChunkedSize trips over whitespace","user":{"login":"lars-n","id":5624567,"node_id":"MDQ6VXNlcjU2MjQ1Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5624567?v=4","gravatar_id":"","url":"https://api.github.com/users/lars-n","html_url":"https://github.com/lars-n","followers_url":"https://api.github.com/users/lars-n/followers","following_url":"https://api.github.com/users/lars-n/following{/other_user}","gists_url":"https://api.github.com/users/lars-n/gists{/gist_id}","starred_url":"https://api.github.com/users/lars-n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lars-n/subscriptions","organizations_url":"https://api.github.com/users/lars-n/orgs","repos_url":"https://api.github.com/users/lars-n/repos","events_url":"https://api.github.com/users/lars-n/events{/privacy}","received_events_url":"https://api.github.com/users/lars-n/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":185727,"node_id":"MDU6TGFiZWwxODU3Mjc=","url":"https://api.github.com/repos/netty/netty/labels/defect","name":"defect","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"franz1981","id":13125299,"node_id":"MDQ6VXNlcjEzMTI1Mjk5","avatar_url":"https://avatars.githubusercontent.com/u/13125299?v=4","gravatar_id":"","url":"https://api.github.com/users/franz1981","html_url":"https://github.com/franz1981","followers_url":"https://api.github.com/users/franz1981/followers","following_url":"https://api.github.com/users/franz1981/following{/other_user}","gists_url":"https://api.github.com/users/franz1981/gists{/gist_id}","starred_url":"https://api.github.com/users/franz1981/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/franz1981/subscriptions","organizations_url":"https://api.github.com/users/franz1981/orgs","repos_url":"https://api.github.com/users/franz1981/repos","events_url":"https://api.github.com/users/franz1981/events{/privacy}","received_events_url":"https://api.github.com/users/franz1981/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/270","html_url":"https://github.com/netty/netty/milestone/270","labels_url":"https://api.github.com/repos/netty/netty/milestones/270/labels","id":9038781,"node_id":"MI_kwDOABA-c84Aieu9","number":270,"title":"4.1.90.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":27,"state":"closed","created_at":"2023-02-13T17:07:34Z","updated_at":"2023-03-15T08:51:22Z","due_on":null,"closed_at":"2023-03-15T08:51:22Z"},"comments":20,"created_at":"2023-03-13T15:26:06Z","updated_at":"2023-03-14T13:35:19Z","closed_at":"2023-03-14T13:34:55Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Expected behavior\r\nthe chunked size is calculated correctly\r\n\r\n### Actual behavior\r\njava.lang.NumberFormatException is thrown\r\n\r\n### Steps to reproduce\r\n\r\nSee code below.\r\n\r\nPlease be aware that I'm not at all familiar with the netty code. Added a few comments in the code below.\r\n\r\n### Minimal yet complete reproducer code (or URL to code)\r\n\r\n```\r\nimport io.netty.util.internal.StringUtil;\r\nimport java.nio.charset.StandardCharsets;\r\n\r\npublic class JavaTester {\r\n\r\n     private static int getChunkSizeNewFixed(byte[] hex, int start, int length) {\r\n        // byte[] is produced by LineParse::parseLine that already skip ISO CTRL and Whitespace chars\r\n        // COMMENT: ^ I could see handling for control chars but not whitespaces ^, but maybe I'm missing something.\r\n        int result = 0;\r\n        for (int i = 0; i < length; i++) {\r\n            final int digit = StringUtil.decodeHexNibble(hex[start + i]);\r\n            if (digit == -1) {\r\n                // COMMENT: Until version 4.1.87.final the whitespace and control char checks where in there\r\n                if (hex[start + i] == ';' || Character.isWhitespace(hex[start + i])) {\r\n                    return result;\r\n                }\r\n                throw new NumberFormatException();\r\n            }\r\n            result *= 16;\r\n            result += digit;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    private static int getChunkSizeNew(byte[] hex, int start, int length) {\r\n        // byte[] is produced by LineParse::parseLine that already skip ISO CTRL and Whitespace chars\r\n        int result = 0;\r\n        for (int i = 0; i < length; i++) {\r\n            final int digit = StringUtil.decodeHexNibble(hex[start + i]);\r\n            if (digit == -1) {\r\n                // uncommon path\r\n                if (hex[start + i] == ';') {\r\n                    return result;\r\n                }\r\n                throw new NumberFormatException();\r\n            }\r\n            result *= 16;\r\n            result += digit;\r\n        }\r\n        return result;\r\n    }\r\n\r\n    public static void main(String... args) {\r\n        String toTest = \"BDC Cookie: NSC_wTfswfs_c2cjoufhsbujpo=ffffffff099b5f1f45525d5f4f58455e445a4a42378b;expires=Mon, 13-Mar-2023 14:16:06 GMT;path=/;secure;httponly\";\r\n        System.out.println(getChunkSizeNewFixed(toTest.getBytes(StandardCharsets.UTF_8), 0, 4));\r\n        System.out.println(getChunkSizeNew(toTest.getBytes(StandardCharsets.UTF_8), 0, 4)); <-- throws NumberFormatException\r\n    }\r\n}\r\n```\r\n\r\n\r\n### Netty version\r\n\r\nfrom 4.1.88 onwards.\r\n\r\n### JVM version (e.g. `java -version`)\r\nopenjdk version \"1.8.0_292\"\r\nOpenJDK Runtime Environment (AdoptOpenJDK)(build 1.8.0_292-b10)\r\n\r\n\r\n### OS version (e.g. `uname -a`)\r\nMacOS and Ubuntu\r\n","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/13273/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/13273/timeline","performed_via_github_app":null,"state_reason":"completed"}