{"url":"https://api.github.com/repos/netty/netty/issues/13104","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/13104/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/13104/comments","events_url":"https://api.github.com/repos/netty/netty/issues/13104/events","html_url":"https://github.com/netty/netty/issues/13104","id":1525132358,"node_id":"I_kwDOABA-c85a56xG","number":13104,"title":"FlowControlHandler is passing read events when auto-reading is turned off","user":{"login":"ivanangelov","id":19289947,"node_id":"MDQ6VXNlcjE5Mjg5OTQ3","avatar_url":"https://avatars.githubusercontent.com/u/19289947?v=4","gravatar_id":"","url":"https://api.github.com/users/ivanangelov","html_url":"https://github.com/ivanangelov","followers_url":"https://api.github.com/users/ivanangelov/followers","following_url":"https://api.github.com/users/ivanangelov/following{/other_user}","gists_url":"https://api.github.com/users/ivanangelov/gists{/gist_id}","starred_url":"https://api.github.com/users/ivanangelov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivanangelov/subscriptions","organizations_url":"https://api.github.com/users/ivanangelov/orgs","repos_url":"https://api.github.com/users/ivanangelov/repos","events_url":"https://api.github.com/users/ivanangelov/events{/privacy}","received_events_url":"https://api.github.com/users/ivanangelov/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/268","html_url":"https://github.com/netty/netty/milestone/268","labels_url":"https://api.github.com/repos/netty/netty/milestones/268/labels","id":8848466,"node_id":"MI_kwDOABA-c84AhwRS","number":268,"title":"4.1.88.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":56,"state":"closed","created_at":"2023-01-12T15:22:47Z","updated_at":"2023-02-13T16:13:19Z","due_on":null,"closed_at":"2023-02-13T16:13:19Z"},"comments":1,"created_at":"2023-01-09T08:19:53Z","updated_at":"2023-01-27T07:20:09Z","closed_at":"2023-01-27T07:19:48Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Expected behavior\r\nNot passing read events onto the pipeline (calling ctx.read() which results in reading from the client socket) when the queue is not empty and auto-reading is turned off for the channel. I would suggest that the expected behavior should look something like the following piece of code:\r\n```\r\nif (dequeue(ctx, 1) == 0) {\r\n\tshouldConsume = true;\r\n\tctx.read();\r\n} else if (ctx.channel().config().isAutoRead()) {\r\n\tctx.read();\r\n}\r\n```\r\n\r\n### Actual behavior\r\nRead events are passed onto the pipeline in every case regardless of the auto-reading configuration of the channel.\r\n\r\n### Steps to reproduce\r\n1. Let's suppose we have a channel with a FlowControlHandler in its pipeline.\r\n2. Turn auto-reading off for the channel.\r\n3. Manually call ctx.read()\r\n4. For every ctx.read() call, the FlowControlHandler's read method will pass the read event onto the pipeline which will result in reading from the client socket.\r\n5. If the messages, which we read are not processed fast enough according to our custom logic, all of this can lead to a significant amount of data being stored in memory which leads to out-of-memory errors.\r\n\r\n### Minimal yet complete reproducer code (or URL to code)\r\nn/a\r\n\r\n### Netty version\r\n4.1.85.Final and above\r\n\r\n### JVM version (e.g. `java -version`)\r\nany\r\n\r\n### OS version (e.g. `uname -a`)\r\nany\r\n","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/13104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/13104/timeline","performed_via_github_app":null,"state_reason":"completed"}