{"url":"https://api.github.com/repos/netty/netty/issues/10447","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/10447/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/10447/comments","events_url":"https://api.github.com/repos/netty/netty/issues/10447/events","html_url":"https://github.com/netty/netty/issues/10447","id":671449445,"node_id":"MDU6SXNzdWU2NzE0NDk0NDU=","number":10447,"title":"DnsNameResolver may have LEAK ByteBuf after cancelling the returned future ","user":{"login":"kojilin","id":863983,"node_id":"MDQ6VXNlcjg2Mzk4Mw==","avatar_url":"https://avatars.githubusercontent.com/u/863983?v=4","gravatar_id":"","url":"https://api.github.com/users/kojilin","html_url":"https://github.com/kojilin","followers_url":"https://api.github.com/users/kojilin/followers","following_url":"https://api.github.com/users/kojilin/following{/other_user}","gists_url":"https://api.github.com/users/kojilin/gists{/gist_id}","starred_url":"https://api.github.com/users/kojilin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kojilin/subscriptions","organizations_url":"https://api.github.com/users/kojilin/orgs","repos_url":"https://api.github.com/users/kojilin/repos","events_url":"https://api.github.com/users/kojilin/events{/privacy}","received_events_url":"https://api.github.com/users/kojilin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/227","html_url":"https://github.com/netty/netty/milestone/227","labels_url":"https://api.github.com/repos/netty/netty/milestones/227/labels","id":5636818,"node_id":"MDk6TWlsZXN0b25lNTYzNjgxOA==","number":227,"title":"4.1.52.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":68,"state":"closed","created_at":"2020-07-09T12:30:30Z","updated_at":"2020-09-08T14:00:48Z","due_on":null,"closed_at":"2020-09-08T14:00:48Z"},"comments":1,"created_at":"2020-08-02T03:22:17Z","updated_at":"2020-08-03T07:32:56Z","closed_at":"2020-08-03T05:58:03Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Expected behavior\r\nWithout LEAK log.\r\n\r\n### Actual behavior\r\n\r\n```\r\n12:16:01.455 [nioEventLoopGroup-2-1] ERROR io.netty.util.ResourceLeakDetector - LEAK: ByteBuf.release() was not called before it's garbage-collected. See https://netty.io/wiki/reference-counted-objects.html for more information.\r\nRecent access records: \r\n#1:\r\n\tio.netty.buffer.AbstractPooledDerivedByteBuf.deallocate(AbstractPooledDerivedByteBuf.java:87)\r\n\tio.netty.buffer.AbstractReferenceCountedByteBuf.handleRelease(AbstractReferenceCountedByteBuf.java:110)\r\n\tio.netty.buffer.AbstractReferenceCountedByteBuf.release(AbstractReferenceCountedByteBuf.java:100)\r\n\tio.netty.buffer.WrappedByteBuf.release(WrappedByteBuf.java:1037)\r\n\tio.netty.buffer.SimpleLeakAwareByteBuf.release(SimpleLeakAwareByteBuf.java:102)\r\n\tio.netty.buffer.AdvancedLeakAwareByteBuf.release(AdvancedLeakAwareByteBuf.java:941)\r\n\tio.netty.handler.codec.dns.DefaultDnsRawRecord.release(DefaultDnsRawRecord.java:109)\r\n\tio.netty.util.ReferenceCountUtil.release(ReferenceCountUtil.java:88)\r\n\tio.netty.handler.codec.dns.AbstractDnsMessage.clear(AbstractDnsMessage.java:349)\r\n\tio.netty.handler.codec.dns.AbstractDnsMessage.clear(AbstractDnsMessage.java:334)\r\n\tio.netty.handler.codec.dns.DefaultDnsResponse.clear(DefaultDnsResponse.java:151)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponse.clear(DatagramDnsResponse.java:157)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponse.clear(DatagramDnsResponse.java:27)\r\n\tio.netty.handler.codec.dns.AbstractDnsMessage.deallocate(AbstractDnsMessage.java:380)\r\n\tio.netty.util.AbstractReferenceCounted.handleRelease(AbstractReferenceCounted.java:86)\r\n\tio.netty.util.AbstractReferenceCounted.release(AbstractReferenceCounted.java:76)\r\n\tio.netty.util.ReferenceCountUtil.release(ReferenceCountUtil.java:88)\r\n\tio.netty.util.ReferenceCountUtil.safeRelease(ReferenceCountUtil.java:113)\r\n\tio.netty.resolver.dns.DnsResolveContext.onResponse(DnsResolveContext.java:587)\r\n\tio.netty.resolver.dns.DnsResolveContext.access$400(DnsResolveContext.java:64)\r\n\tio.netty.resolver.dns.DnsResolveContext$2.operationComplete(DnsResolveContext.java:439)\r\n\tio.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:577)\r\n\tio.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:570)\r\n\tio.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:549)\r\n\tio.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:490)\r\n\tio.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:615)\r\n\tio.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:604)\r\n\tio.netty.util.concurrent.DefaultPromise.trySuccess(DefaultPromise.java:104)\r\n\tio.netty.resolver.dns.DnsQueryContext.trySuccess(DnsQueryContext.java:201)\r\n\tio.netty.resolver.dns.DnsQueryContext.finish(DnsQueryContext.java:193)\r\n\tio.netty.resolver.dns.DnsNameResolver$DnsResponseHandler.channelRead(DnsNameResolver.java:1226)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#2:\r\n\tio.netty.buffer.AdvancedLeakAwareByteBuf.retainedDuplicate(AdvancedLeakAwareByteBuf.java:100)\r\n\tio.netty.handler.codec.dns.DefaultDnsRecordDecoder.decodeRecord(DefaultDnsRecordDecoder.java:105)\r\n\tio.netty.handler.codec.dns.DefaultDnsRecordDecoder.decodeRecord(DefaultDnsRecordDecoder.java:69)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decodeRecords(DnsResponseDecoder.java:95)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decode(DnsResponseDecoder.java:73)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decodeResponse(DatagramDnsResponseDecoder.java:62)\r\n\tio.netty.resolver.dns.DnsNameResolver$1.decodeResponse(DnsNameResolver.java:198)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:58)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:30)\r\n\tio.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:88)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#3:\r\n\tio.netty.buffer.AdvancedLeakAwareByteBuf.readUnsignedByte(AdvancedLeakAwareByteBuf.java:406)\r\n\tio.netty.handler.codec.dns.DnsCodecUtil.decodeDomainName(DnsCodecUtil.java:73)\r\n\tio.netty.handler.codec.dns.DefaultDnsRecordDecoder.decodeName(DefaultDnsRecordDecoder.java:129)\r\n\tio.netty.handler.codec.dns.DefaultDnsRecordDecoder.decodeRecord(DefaultDnsRecordDecoder.java:47)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decodeRecords(DnsResponseDecoder.java:95)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decode(DnsResponseDecoder.java:68)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decodeResponse(DatagramDnsResponseDecoder.java:62)\r\n\tio.netty.resolver.dns.DnsNameResolver$1.decodeResponse(DnsNameResolver.java:198)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:58)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:30)\r\n\tio.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:88)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#4:\r\n\tio.netty.buffer.AdvancedLeakAwareByteBuf.duplicate(AdvancedLeakAwareByteBuf.java:112)\r\n\tio.netty.handler.codec.dns.DefaultDnsRecordDecoder.decodeRecord(DefaultDnsRecordDecoder.java:102)\r\n\tio.netty.handler.codec.dns.DefaultDnsRecordDecoder.decodeRecord(DefaultDnsRecordDecoder.java:69)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decodeRecords(DnsResponseDecoder.java:95)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decode(DnsResponseDecoder.java:68)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decodeResponse(DatagramDnsResponseDecoder.java:62)\r\n\tio.netty.resolver.dns.DnsNameResolver$1.decodeResponse(DnsNameResolver.java:198)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:58)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:30)\r\n\tio.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:88)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#5:\r\n\tio.netty.buffer.AdvancedLeakAwareByteBuf.readUnsignedByte(AdvancedLeakAwareByteBuf.java:406)\r\n\tio.netty.handler.codec.dns.DnsCodecUtil.decodeDomainName(DnsCodecUtil.java:84)\r\n\tio.netty.handler.codec.dns.DefaultDnsRecordDecoder.decodeName(DefaultDnsRecordDecoder.java:129)\r\n\tio.netty.handler.codec.dns.DefaultDnsRecordDecoder.decodeRecord(DefaultDnsRecordDecoder.java:47)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decodeRecords(DnsResponseDecoder.java:95)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decode(DnsResponseDecoder.java:64)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decodeResponse(DatagramDnsResponseDecoder.java:62)\r\n\tio.netty.resolver.dns.DnsNameResolver$1.decodeResponse(DnsNameResolver.java:198)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:58)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:30)\r\n\tio.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:88)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#6:\r\n\tio.netty.buffer.AdvancedLeakAwareByteBuf.readUnsignedShort(AdvancedLeakAwareByteBuf.java:418)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decode(DnsResponseDecoder.java:39)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decodeResponse(DatagramDnsResponseDecoder.java:62)\r\n\tio.netty.resolver.dns.DnsNameResolver$1.decodeResponse(DnsNameResolver.java:198)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:58)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:30)\r\n\tio.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:88)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#7:\r\n\tio.netty.buffer.AdvancedLeakAwareByteBuf.readUnsignedShort(AdvancedLeakAwareByteBuf.java:418)\r\n\tio.netty.handler.codec.dns.DnsResponseDecoder.decode(DnsResponseDecoder.java:37)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decodeResponse(DatagramDnsResponseDecoder.java:62)\r\n\tio.netty.resolver.dns.DnsNameResolver$1.decodeResponse(DnsNameResolver.java:198)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:58)\r\n\tio.netty.handler.codec.dns.DatagramDnsResponseDecoder.decode(DatagramDnsResponseDecoder.java:30)\r\n\tio.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:88)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#8:\r\n\tHint: 'DnsNameResolver$1#0' will handle the message from this point.\r\n\tio.netty.channel.DefaultAddressedEnvelope.touch(DefaultAddressedEnvelope.java:115)\r\n\tio.netty.channel.socket.DatagramPacket.touch(DatagramPacket.java:85)\r\n\tio.netty.channel.socket.DatagramPacket.touch(DatagramPacket.java:27)\r\n\tio.netty.channel.DefaultChannelPipeline.touch(DefaultChannelPipeline.java:116)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tio.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357)\r\n\tio.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#9:\r\n\tHint: 'DefaultChannelPipeline$HeadContext#0' will handle the message from this point.\r\n\tio.netty.channel.DefaultAddressedEnvelope.touch(DefaultAddressedEnvelope.java:115)\r\n\tio.netty.channel.socket.DatagramPacket.touch(DatagramPacket.java:85)\r\n\tio.netty.channel.socket.DatagramPacket.touch(DatagramPacket.java:27)\r\n\tio.netty.channel.DefaultChannelPipeline.touch(DefaultChannelPipeline.java:116)\r\n\tio.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:362)\r\n\tio.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:93)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n#10:\r\n\tio.netty.buffer.AdvancedLeakAwareByteBuf.internalNioBuffer(AdvancedLeakAwareByteBuf.java:736)\r\n\tio.netty.channel.socket.nio.NioDatagramChannel.doReadMessages(NioDatagramChannel.java:250)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:75)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\nCreated at:\r\n\tio.netty.buffer.PooledByteBufAllocator.newDirectBuffer(PooledByteBufAllocator.java:363)\r\n\tio.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:187)\r\n\tio.netty.buffer.AbstractByteBufAllocator.directBuffer(AbstractByteBufAllocator.java:178)\r\n\tio.netty.buffer.AbstractByteBufAllocator.ioBuffer(AbstractByteBufAllocator.java:139)\r\n\tio.netty.channel.DefaultMaxMessagesRecvByteBufAllocator$MaxMessageHandle.allocate(DefaultMaxMessagesRecvByteBufAllocator.java:114)\r\n\tio.netty.channel.socket.nio.NioDatagramChannel.doReadMessages(NioDatagramChannel.java:246)\r\n\tio.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:75)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:714)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:650)\r\n\tio.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:576)\r\n\tio.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493)\r\n\tio.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989)\r\n\tio.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n\tio.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tjava.base/java.lang.Thread.run(Thread.java:834)\r\n```\r\n\r\n### Steps to reproduce\r\n\r\n```\r\n\r\nimport java.io.IOException;\r\nimport java.net.IDN;\r\nimport java.util.List;\r\n\r\nimport javax.annotation.Nullable;\r\n\r\nimport io.netty.channel.EventLoop;\r\nimport io.netty.channel.nio.NioEventLoopGroup;\r\nimport io.netty.channel.socket.nio.NioDatagramChannel;\r\nimport io.netty.handler.codec.dns.DnsQuestion;\r\nimport io.netty.handler.codec.dns.DnsRecord;\r\nimport io.netty.handler.codec.dns.DnsRecordType;\r\nimport io.netty.resolver.dns.DnsNameResolver;\r\nimport io.netty.resolver.dns.DnsNameResolverBuilder;\r\nimport io.netty.util.concurrent.Future;\r\n\r\npublic class Main {\r\n    static final class DnsQuestionWithoutTrailingDot implements DnsQuestion {\r\n\r\n        private final String name;\r\n        private final DnsRecordType type;\r\n\r\n        public static DnsQuestionWithoutTrailingDot of(String name, DnsRecordType type) {\r\n            return new DnsQuestionWithoutTrailingDot(name, type);\r\n        }\r\n\r\n        private DnsQuestionWithoutTrailingDot(String name, DnsRecordType type) {\r\n            this.name = IDN.toASCII(requireNonNull(name, \"name\"));\r\n            this.type = requireNonNull(type, \"type\");\r\n        }\r\n\r\n        @Override\r\n        public String name() {\r\n            return name;\r\n        }\r\n\r\n        @Override\r\n        public DnsRecordType type() {\r\n            return type;\r\n        }\r\n\r\n        @Override\r\n        public int dnsClass() {\r\n            return CLASS_IN;\r\n        }\r\n\r\n        @Override\r\n        public long timeToLive() {\r\n            return 0;\r\n        }\r\n\r\n        @Override\r\n        public boolean equals(@Nullable Object o) {\r\n            if (this == o) {\r\n                return true;\r\n            }\r\n            if (!(o instanceof DnsQuestionWithoutTrailingDot)) {\r\n                return false;\r\n            }\r\n            final DnsQuestionWithoutTrailingDot\r\n                    that = (DnsQuestionWithoutTrailingDot) o;\r\n            return type.equals(that.type) && name.equals(that.name);\r\n        }\r\n\r\n        @Override\r\n        public int hashCode() {\r\n            return name.hashCode() * 31 + type.hashCode();\r\n        }\r\n\r\n        @Override\r\n        public String toString() {\r\n            final StringBuilder buf = new StringBuilder(64);\r\n            buf.append(\"DnsQuestion(\")\r\n               .append(name())\r\n               .append(\" IN \")\r\n               .append(type().name())\r\n               .append(')');\r\n            return buf.toString();\r\n        }\r\n    }\r\n\r\n    public static void main(String[] args) throws InterruptedException, IOException {\r\n        final EventLoop eventLoop = new NioEventLoopGroup().next();\r\n        final DnsNameResolver resolver =\r\n                new DnsNameResolverBuilder(eventLoop)\r\n                        .queryTimeoutMillis(3000)\r\n                        .channelType(NioDatagramChannel.class)\r\n                        .ttl(3, 10)\r\n                        .traceEnabled(true)\r\n                        .build();\r\n\r\n        while (true) {\r\n            final Future<List<DnsRecord>> future =\r\n                    resolver.resolveAll(DnsQuestionWithoutTrailingDot.of(\r\n                            \"example.com\",\r\n                            DnsRecordType.A));\r\n            future.cancel(true);\r\n            Thread.sleep(3000L);\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nWill have LEAK log after GC.run or wait a while.\r\n\r\n### Minimal yet complete reproducer code (or URL to code)\r\n\r\nAs Above.\r\n\r\n### Netty version\r\n\r\n`4.1.50.Final`\r\n\r\n### JVM version (e.g. `java -version`)\r\n\r\n```\r\nopenjdk version \"11.0.7\" 2020-04-14\r\nOpenJDK Runtime Environment AdoptOpenJDK (build 11.0.7+10)\r\nOpenJDK 64-Bit Server VM AdoptOpenJDK (build 11.0.7+10, mixed mode)\r\n```\r\n\r\n### OS version (e.g. `uname -a`)\r\n\r\n```\r\nDarwin Kernel Version 19.6.0\r\n```\r\nand a little different log but also have same result in\r\n```\r\n3.10.0-693.2.2.el7.x86_64 #1 SMP x86_64 x86_64 x86_64 GNU/Linux\r\n```","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/10447/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/10447/timeline","performed_via_github_app":null,"state_reason":"completed"}