{"url":"https://api.github.com/repos/netty/netty/issues/15654","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/15654/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/15654/comments","events_url":"https://api.github.com/repos/netty/netty/issues/15654/events","html_url":"https://github.com/netty/netty/issues/15654","id":3414025478,"node_id":"I_kwDOABA-c87LfeUG","number":15654,"title":"After upgrading Netty to 4.2.4+, application is throwing java.lang.VerifyError on Android platform 8/9/10/11/12","user":{"login":"ajith211","id":58826557,"node_id":"MDQ6VXNlcjU4ODI2NTU3","avatar_url":"https://avatars.githubusercontent.com/u/58826557?v=4","gravatar_id":"","url":"https://api.github.com/users/ajith211","html_url":"https://github.com/ajith211","followers_url":"https://api.github.com/users/ajith211/followers","following_url":"https://api.github.com/users/ajith211/following{/other_user}","gists_url":"https://api.github.com/users/ajith211/gists{/gist_id}","starred_url":"https://api.github.com/users/ajith211/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajith211/subscriptions","organizations_url":"https://api.github.com/users/ajith211/orgs","repos_url":"https://api.github.com/users/ajith211/repos","events_url":"https://api.github.com/users/ajith211/events{/privacy}","received_events_url":"https://api.github.com/users/ajith211/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/326","html_url":"https://github.com/netty/netty/milestone/326","labels_url":"https://api.github.com/repos/netty/netty/milestones/326/labels","id":13637056,"node_id":"MI_kwDOABA-c84A0BXA","number":326,"title":"4.2.7.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":64,"state":"closed","created_at":"2025-09-08T11:00:29Z","updated_at":"2025-10-16T13:25:37Z","due_on":null,"closed_at":"2025-10-16T13:25:37Z"},"comments":18,"created_at":"2025-09-13T19:21:09Z","updated_at":"2025-09-17T07:49:11Z","closed_at":"2025-09-16T06:27:07Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi Team,\nWe are using netty as part of Little proxy solution in our Android application. After upgrading netty to 4.2.4 and above, we see following exception in our application\nRejecting re-init on previously-failed class java.lang.Class<io.netty.handler.codec.http.HttpResponseEncoder>: **java.lang.VerifyError: Rejecting class io.netty.buffer.UnpooledByteBufAllocator$InstrumentedUnpooledDirectByteBuf that attempts to sub-type erroneous class io.netty.buffer.UnpooledDirectByteBuf** (declaration of 'io.netty.buffer.UnpooledByteBufAllocator$InstrumentedUnpooledDirectByteBuf' appears in /data/app/com.sample.app-HXtH4pA7WR7DkdY6DBm0Eg==/base.apk!classes34.dex)\nat io.netty.buffer.ByteBuf io.netty.buffer.UnpooledByteBufAllocator.newDirectBuffer(int, int) (UnpooledByteBufAllocator.java:95)\nat io.netty.buffer.ByteBuf io.netty.buffer.AbstractByteBufAllocator.directBuffer(int, int) (AbstractByteBufAllocator.java:188)\nat io.netty.buffer.ByteBuf io.netty.buffer.AbstractByteBufAllocator.directBuffer(int) (AbstractByteBufAllocator.java:179)\nat io.netty.buffer.ByteBuf io.netty.buffer.Unpooled.directBuffer(int) (Unpooled.java:128)\n**at void io.netty.handler.codec.http.HttpObjectEncoder.<clinit>() (HttpObjectEncoder.java:62)**\nat void org.littleshoot.proxy.impl.ClientToProxyConnection.initChannelPipeline(io.netty.channel.ChannelPipeline) (ClientToProxyConnection.java:796)\nat void org.littleshoot.proxy.impl.ClientToProxyConnection.<init>(org.littleshoot.proxy.impl.DefaultHttpProxyServer, org.littleshoot.proxy.SslEngineSource, boolean, io.netty.channel.ChannelPipeline, io.netty.handler.traffic.GlobalTrafficShapingHandler) (ClientToProxyConnection.java:152)\nat void org.littleshoot.proxy.impl.DefaultHttpProxyServer$2.initChannel(io.netty.channel.Channel) (DefaultHttpProxyServer.java:517)\nat boolean io.netty.channel.ChannelInitializer.initChannel(io.netty.channel.ChannelHandlerContext) (ChannelInitializer.java:128)\nat void io.netty.channel.ChannelInitializer.handlerAdded(io.netty.channel.ChannelHandlerContext) (ChannelInitializer.java:111)\nat void io.netty.channel.AbstractChannelHandlerContext.callHandlerAdded() (AbstractChannelHandlerContext.java:999)\nat void io.netty.channel.DefaultChannelPipeline.callHandlerAdded0(io.netty.channel.AbstractChannelHandlerContext) (DefaultChannelPipeline.java:558)\nat void io.netty.channel.DefaultChannelPipeline.access$100(io.netty.channel.DefaultChannelPipeline, io.netty.channel.AbstractChannelHandlerContext) (DefaultChannelPipeline.java:45)\nat void io.netty.channel.DefaultChannelPipeline$PendingHandlerAddedTask.execute() (DefaultChannelPipeline.java:1482)\nat void io.netty.channel.DefaultChannelPipeline.callHandlerAddedForAllHandlers() (DefaultChannelPipeline.java:1136)\nat void io.netty.channel.DefaultChannelPipeline.invokeHandlerAddedIfNeeded() (DefaultChannelPipeline.java:599)\n\\at void io.netty.channel.AbstractChannel$AbstractUnsafe$2.operationComplete(io.netty.channel.ChannelFuture) (AbstractChannel.java:383)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe$2.operationComplete(io.netty.util.concurrent.Future) (AbstractChannel.java:374)\nat void io.netty.util.concurrent.DefaultPromise.notifyListener0(io.netty.util.concurrent.Future, io.netty.util.concurrent.GenericFutureListener) (DefaultPromise.java:603)\nat void io.netty.util.concurrent.DefaultPromise.notifyListenersNow() (DefaultPromise.java:570)\nat void io.netty.util.concurrent.DefaultPromise.notifyListeners() (DefaultPromise.java:505)\nat boolean io.netty.util.concurrent.DefaultPromise.setValue0(java.lang.Object) (DefaultPromise.java:649)\nat boolean io.netty.util.concurrent.DefaultPromise.setSuccess0(java.lang.Object) (DefaultPromise.java:638)\nat io.netty.util.concurrent.Promise io.netty.util.concurrent.DefaultPromise.setSuccess(java.lang.Object) (DefaultPromise.java:110)\nat io.netty.channel.ChannelPromise io.netty.channel.DefaultChannelPromise.setSuccess(java.lang.Void) (DefaultChannelPromise.java:78)\nat io.netty.channel.ChannelPromise io.netty.channel.DefaultChannelPromise.setSuccess() (DefaultChannelPromise.java:73)\nat void io.netty.channel.nio.AbstractNioChannel.lambda$doRegister$0$io-netty-channel-nio-AbstractNioChannel(io.netty.channel.ChannelPromise, io.netty.util.concurrent.Future) (AbstractNioChannel.java:465)\nat void io.netty.channel.nio.AbstractNioChannel$$ExternalSyntheticLambda0.operationComplete(io.netty.util.concurrent.Future) (D8$$SyntheticClass:0)\nat void io.netty.util.concurrent.DefaultPromise.notifyListener0(io.netty.util.concurrent.Future, io.netty.util.concurrent.GenericFutureListener) (DefaultPromise.java:603)\nat void io.netty.util.concurrent.DefaultPromise.notifyListenersNow() (DefaultPromise.java:570)\nat void io.netty.util.concurrent.DefaultPromise.notifyListeners() (DefaultPromise.java:505)\nat io.netty.util.concurrent.Promise io.netty.util.concurrent.DefaultPromise.addListener(io.netty.util.concurrent.GenericFutureListener) (DefaultPromise.java:198)\nat io.netty.util.concurrent.Future io.netty.util.concurrent.DefaultPromise.addListener(io.netty.util.concurrent.GenericFutureListener) (DefaultPromise.java:36)\nat void io.netty.channel.nio.AbstractNioChannel.doRegister(io.netty.channel.ChannelPromise) (AbstractNioChannel.java:462)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe.register0(io.netty.channel.ChannelPromise) (AbstractChannel.java:408)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe.access$300(io.netty.channel.AbstractChannel$AbstractUnsafe, io.netty.channel.ChannelPromise) (AbstractChannel.java:288)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe$1.run() (AbstractChannel.java:352)\nat void io.netty.util.concurrent.AbstractEventExecutor.runTask(java.lang.Runnable) (AbstractEventExecutor.java:148)\nat void io.netty.util.concurrent.AbstractEventExecutor.safeExecute(java.lang.Runnable) (AbstractEventExecutor.java:141)\nat boolean io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(long) (SingleThreadEventExecutor.java:535)\nat void io.netty.channel.SingleThreadIoEventLoop.run() (SingleThreadIoEventLoop.java:201)\nat void io.netty.util.concurrent.SingleThreadEventExecutor$5.run() (SingleThreadEventExecutor.java:1193)\nat void io.netty.util.internal.ThreadExecutorMap$2.run() (ThreadExecutorMap.java:74)\nat void java.lang.Thread.run() (Thread.java:919)\n**Caused by: java.lang.VerifyError: Verifier rejected class io.netty.buffer.UnpooledDirectByteBuf: int io.netty.buffer.UnpooledDirectByteBuf._getInt(int) failed to verify: int io.netty.buffer.UnpooledDirectByteBuf._getInt(int): [0x11] int io.netty.buffer.UnpooledDirectByteBuf._getInt(int): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]**\nint io.netty.buffer.UnpooledDirectByteBuf._getIntLE(int) failed to verify: int io.netty.buffer.UnpooledDirectByteBuf._getIntLE(int): [0x11] int io.netty.buffer.UnpooledDirectByteBuf._getIntLE(int): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nlong io.netty.buffer.UnpooledDirectByteBuf._getLong(int) failed to verify: long io.netty.buffer.UnpooledDirectByteBuf._getLong(int): [0x11] long io.netty.buffer.UnpooledDirectByteBuf._getLong(int): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nlong io.netty.buffer.UnpooledDirectByteBuf._getLongLE(int) failed to verify: long io.netty.buffer.UnpooledDirectByteBuf._getLongLE(int): [0x11] long io.netty.buffer.UnpooledDirectByteBuf._getLongLE(int): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nshort io.netty.buffer.UnpooledDirectByteBuf._getShort(int) failed to verify: short io.netty.buffer.UnpooledDirectByteBuf._getShort(int): [0x11] short io.netty.buffer.UnpooledDirectByteBuf._getShort(int): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nshort io.netty.buffer.UnpooledDirectByteBuf._getShortLE(int) failed to verify: short io.netty.buffer.UnpooledDirectByteBuf._getShortLE(int): [0x11] short io.netty.buffer.UnpooledDirectByteBuf._getShortLE(int): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nvoid io.netty.buffer.UnpooledDirectByteBuf._setInt(int, int) failed to verify: void io.netty.buffer.UnpooledDirectByteBuf._setInt(int, int): [0x11] void io.netty.buffer.UnpooledDirectByteBuf._setInt(int, int): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nvoid io.netty.buffer.UnpooledDirectByteBuf._setIntLE(int, int) failed to verify: void io.netty.buffer.UnpooledDirectByteBuf._setIntLE(int, int): [0x11] void io.netty.buffer.UnpooledDirectByteBuf._setIntLE(int, int): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nvoid io.netty.buffer.UnpooledDirectByteBuf._setLong(int, long) failed to verify: void io.netty.buffer.UnpooledDirectByteBuf._setLong(int, long): [0x11] void io.netty.buffer.UnpooledDirectByteBuf._setLong(int, long): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nvoid io.netty.buffer.UnpooledDirectByteBuf._setLongLE(int, long) failed to verify: void io.netty.buffer.UnpooledDirectByteBuf._setLongLE(int, long): [0x11] void io.netty.buffer.UnpooledDirectByteBuf._setLongLE(int, long): [0x11] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nvoid io.netty.buffer.UnpooledDirectByteBuf._setShort(int, int) failed to verify: void io.netty.buffer.UnpooledDirectByteBuf._setShort(int, int): [0x12] void io.netty.buffer.UnpooledDirectByteBuf._setShort(int, int): [0x12] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[]\nvoid io.netty.buffer.UnpooledDirectByteBuf._setShortLE(int, int) failed to verify: void io.netty.buffer.UnpooledDirectByteBuf._setShortLE(int, int): [0x12] void io.netty.buffer.UnpooledDirectByteBuf._setShortLE(int, int): [0x12] register v3 has type Reference: java.nio.ByteBuffer but expected Reference: java.lang.Object[] (declaration of 'io.netty.buffer.UnpooledDirectByteBuf' appears in /data/app/com.sample.app-HXtH4pA7WR7DkdY6DBm0Eg==/base.apk!classes34.dex)\nat io.netty.buffer.ByteBuf io.netty.buffer.UnpooledByteBufAllocator.newDirectBuffer(int, int) (UnpooledByteBufAllocator.java:95)\nat io.netty.buffer.ByteBuf io.netty.buffer.AbstractByteBufAllocator.directBuffer(int, int) (AbstractByteBufAllocator.java:188)\nat io.netty.buffer.ByteBuf io.netty.buffer.AbstractByteBufAllocator.directBuffer(int) (AbstractByteBufAllocator.java:179)\nat io.netty.buffer.ByteBuf io.netty.buffer.Unpooled.directBuffer(int) (Unpooled.java:128)\n**at void io.netty.handler.codec.http.HttpObjectEncoder.<clinit>() (HttpObjectEncoder.java:62)**\nat void org.littleshoot.proxy.impl.ClientToProxyConnection.initChannelPipeline(io.netty.channel.ChannelPipeline) (ClientToProxyConnection.java:796)\nat void org.littleshoot.proxy.impl.ClientToProxyConnection.<init>(org.littleshoot.proxy.impl.DefaultHttpProxyServer, org.littleshoot.proxy.SslEngineSource, boolean, io.netty.channel.ChannelPipeline, io.netty.handler.traffic.GlobalTrafficShapingHandler) (ClientToProxyConnection.java:152)\nat void org.littleshoot.proxy.impl.DefaultHttpProxyServer$2.initChannel(io.netty.channel.Channel) (DefaultHttpProxyServer.java:517)\nat boolean io.netty.channel.ChannelInitializer.initChannel(io.netty.channel.ChannelHandlerContext) (ChannelInitializer.java:128)\nat void io.netty.channel.ChannelInitializer.handlerAdded(io.netty.channel.ChannelHandlerContext) (ChannelInitializer.java:111)\nat void io.netty.channel.AbstractChannelHandlerContext.callHandlerAdded() (AbstractChannelHandlerContext.java:999)\nat void io.netty.channel.DefaultChannelPipeline.callHandlerAdded0(io.netty.channel.AbstractChannelHandlerContext) (DefaultChannelPipeline.java:558)\nat void io.netty.channel.DefaultChannelPipeline.access$100(io.netty.channel.DefaultChannelPipeline, io.netty.channel.AbstractChannelHandlerContext) (DefaultChannelPipeline.java:45)\nat void io.netty.channel.DefaultChannelPipeline$PendingHandlerAddedTask.execute() (DefaultChannelPipeline.java:1482)\nat void io.netty.channel.DefaultChannelPipeline.callHandlerAddedForAllHandlers() (DefaultChannelPipeline.java:1136)\nat void io.netty.channel.DefaultChannelPipeline.invokeHandlerAddedIfNeeded() (DefaultChannelPipeline.java:599)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe$2.operationComplete(io.netty.channel.ChannelFuture) (AbstractChannel.java:383)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe$2.operationComplete(io.netty.util.concurrent.Future) (AbstractChannel.java:374)\nat void io.netty.util.concurrent.DefaultPromise.notifyListener0(io.netty.util.concurrent.Future, io.netty.util.concurrent.GenericFutureListener) (DefaultPromise.java:603)\nat void io.netty.util.concurrent.DefaultPromise.notifyListenersNow() (DefaultPromise.java:570)\nat void io.netty.util.concurrent.DefaultPromise.notifyListeners() (DefaultPromise.java:505)\nat boolean io.netty.util.concurrent.DefaultPromise.setValue0(java.lang.Object) (DefaultPromise.java:649)\nat boolean io.netty.util.concurrent.DefaultPromise.setSuccess0(java.lang.Object) (DefaultPromise.java:638)\nat io.netty.util.concurrent.Promise io.netty.util.concurrent.DefaultPromise.setSuccess(java.lang.Object) (DefaultPromise.java:110)\nat io.netty.channel.ChannelPromise io.netty.channel.DefaultChannelPromise.setSuccess(java.lang.Void) (DefaultChannelPromise.java:78)\nat io.netty.channel.ChannelPromise io.netty.channel.DefaultChannelPromise.setSuccess() (DefaultChannelPromise.java:73)\nat void io.netty.channel.nio.AbstractNioChannel.lambda$doRegister$0$io-netty-channel-nio-AbstractNioChannel(io.netty.channel.ChannelPromise, io.netty.util.concurrent.Future) (AbstractNioChannel.java:465)\nat void io.netty.channel.nio.AbstractNioChannel$$ExternalSyntheticLambda0.operationComplete(io.netty.util.concurrent.Future) (D8$$SyntheticClass:0)\nat void io.netty.util.concurrent.DefaultPromise.notifyListener0(io.netty.util.concurrent.Future, io.netty.util.concurrent.GenericFutureListener) (DefaultPromise.java:603)\nat void io.netty.util.concurrent.DefaultPromise.notifyListenersNow() (DefaultPromise.java:570)\nat void io.netty.util.concurrent.DefaultPromise.notifyListeners() (DefaultPromise.java:505)\nat io.netty.util.concurrent.Promise io.netty.util.concurrent.DefaultPromise.addListener(io.netty.util.concurrent.GenericFutureListener) (DefaultPromise.java:198)\nat io.netty.util.concurrent.Future io.netty.util.concurrent.DefaultPromise.addListener(io.netty.util.concurrent.GenericFutureListener) (DefaultPromise.java:36)\nat void io.netty.channel.nio.AbstractNioChannel.doRegister(io.netty.channel.ChannelPromise) (AbstractNioChannel.java:462)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe.register0(io.netty.channel.ChannelPromise) (AbstractChannel.java:408)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe.access$300(io.netty.channel.AbstractChannel$AbstractUnsafe, io.netty.channel.ChannelPromise) (AbstractChannel.java:288)\nat void io.netty.channel.AbstractChannel$AbstractUnsafe$1.run() (AbstractChannel.java:352)\nat void io.netty.util.concurrent.AbstractEventExecutor.runTask(java.lang.Runnable) (AbstractEventExecutor.java:148)\nat void io.netty.util.concurrent.AbstractEventExecutor.safeExecute(java.lang.Runnable) (AbstractEventExecutor.java:141)\nat boolean io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(long) (SingleThreadEventExecutor.java:535)\nat void io.netty.channel.SingleThreadIoEventLoop.run() (SingleThreadIoEventLoop.java:201)\nat void io.netty.util.concurrent.SingleThreadEventExecutor$5.run() (SingleThreadEventExecutor.java:1193)\nat void io.netty.util.internal.ThreadExecutorMap$2.run() (ThreadExecutorMap.java:74)\nat void java.lang.Thread.run() (Thread.java:919)\n\nThis issue is seen on Android 8/9/10/11/12 versions, but not seen on Android 13/14/15/16 versions.\nPlease check whether this is a known issue as part of netty 4.2.4 on specific android platforms.","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/15654/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/15654/timeline","performed_via_github_app":null,"state_reason":"completed"}