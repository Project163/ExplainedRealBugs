{"url":"https://api.github.com/repos/netty/netty/issues/10449","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/10449/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/10449/comments","events_url":"https://api.github.com/repos/netty/netty/issues/10449/events","html_url":"https://github.com/netty/netty/issues/10449","id":671523994,"node_id":"MDU6SXNzdWU2NzE1MjM5OTQ=","number":10449,"title":"FileUpload.get() created by a HttpPostMultipartRequestDecoder returns incomplete array on 4.1.51","user":{"login":"danielflower","id":1056441,"node_id":"MDQ6VXNlcjEwNTY0NDE=","avatar_url":"https://avatars.githubusercontent.com/u/1056441?v=4","gravatar_id":"","url":"https://api.github.com/users/danielflower","html_url":"https://github.com/danielflower","followers_url":"https://api.github.com/users/danielflower/followers","following_url":"https://api.github.com/users/danielflower/following{/other_user}","gists_url":"https://api.github.com/users/danielflower/gists{/gist_id}","starred_url":"https://api.github.com/users/danielflower/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielflower/subscriptions","organizations_url":"https://api.github.com/users/danielflower/orgs","repos_url":"https://api.github.com/users/danielflower/repos","events_url":"https://api.github.com/users/danielflower/events{/privacy}","received_events_url":"https://api.github.com/users/danielflower/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/227","html_url":"https://github.com/netty/netty/milestone/227","labels_url":"https://api.github.com/repos/netty/netty/milestones/227/labels","id":5636818,"node_id":"MDk6TWlsZXN0b25lNTYzNjgxOA==","number":227,"title":"4.1.52.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":68,"state":"closed","created_at":"2020-07-09T12:30:30Z","updated_at":"2020-09-08T14:00:48Z","due_on":null,"closed_at":"2020-09-08T14:00:48Z"},"comments":7,"created_at":"2020-08-02T05:15:51Z","updated_at":"2020-08-29T19:53:41Z","closed_at":"2020-08-07T11:53:16Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Expected behavior\r\n\r\nUploadFile.get() should return the full byte array uploaded.\r\n\r\n### Actual behavior\r\n\r\nIt appears that although `fileUpload.length()` returns the correct value, the byte array from `get()` returns only a partial array.\r\n\r\n### Steps to reproduce\r\n\r\nCreate a `HttpPostMultipartRequestDecoder` and call offer at least twice with some request form data. The test below passes on 4.1.50 but fails on 4.1.51.\r\n\r\n### Minimal yet complete reproducer code (or URL to code)\r\n\r\n````java\r\n@Test\r\npublic void fileUploadRegression() throws IOException {\r\n    byte[] file = new byte[32000];\r\n    Arrays.fill(file, (byte) 1);\r\n\r\n    String body = \"--861fbeab-cd20-470c-9609-d40a0f704466\\n\" +\r\n        \"Content-Disposition: form-data; name=\\\"image\\\"; filename=\\\"guangzhou.jpeg\\\"\\n\" +\r\n        \"Content-Type: image/jpeg\\n\" +\r\n        \"Content-Length: \" + file.length + \"\\n\" +\r\n        \"\\n\" + new String(file, UTF_8) + \"\\n\" +\r\n        \"--861fbeab-cd20-470c-9609-d40a0f704466--\\n\";\r\n    byte[] bodyBytes = body.getBytes(UTF_8);\r\n\r\n    HttpRequest request = new DefaultHttpRequest(HttpVersion.HTTP_1_1, HttpMethod.POST, \"/upload\");\r\n    request.headers().set(\"content-type\", \"multipart/form-data; boundary=861fbeab-cd20-470c-9609-d40a0f704466\");\r\n    request.headers().set(\"content-length\", bodyBytes.length);\r\n    HttpPostMultipartRequestDecoder decoder = new HttpPostMultipartRequestDecoder(request);\r\n    decoder.offer(new DefaultHttpContent(Unpooled.copiedBuffer(bodyBytes, 0, 8192)));\r\n    decoder.offer(new DefaultHttpContent(Unpooled.copiedBuffer(bodyBytes, 8192, bodyBytes.length - 8192)));\r\n    decoder.offer(new DefaultLastHttpContent());\r\n    FileUpload data = (FileUpload) decoder.getBodyHttpDatas().get(0);\r\n    assertThat(data.length(), is((long)file.length)); // passes\r\n    assertThat(data.get().length, is(file.length)); // fails on 4.1.51\r\n}\r\n````\r\n\r\n### Netty version\r\n\r\n4.1.51\r\n\r\n### JVM version (e.g. `java -version`)\r\n\r\nMultiple versions tested (8, 10, 11, 12). \r\n\r\n### OS version (e.g. `uname -a`)\r\n\r\nWindows, Linux.","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/10449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/10449/timeline","performed_via_github_app":null,"state_reason":"completed"}