{"url":"https://api.github.com/repos/netty/netty/issues/15214","repository_url":"https://api.github.com/repos/netty/netty","labels_url":"https://api.github.com/repos/netty/netty/issues/15214/labels{/name}","comments_url":"https://api.github.com/repos/netty/netty/issues/15214/comments","events_url":"https://api.github.com/repos/netty/netty/issues/15214/events","html_url":"https://github.com/netty/netty/issues/15214","id":3075755404,"node_id":"I_kwDOABA-c863VE2M","number":15214,"title":"OpenSsl.availableJavaCipherSuites contains null element","user":{"login":"daschl","id":29086,"node_id":"MDQ6VXNlcjI5MDg2","avatar_url":"https://avatars.githubusercontent.com/u/29086?v=4","gravatar_id":"","url":"https://api.github.com/users/daschl","html_url":"https://github.com/daschl","followers_url":"https://api.github.com/users/daschl/followers","following_url":"https://api.github.com/users/daschl/following{/other_user}","gists_url":"https://api.github.com/users/daschl/gists{/gist_id}","starred_url":"https://api.github.com/users/daschl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daschl/subscriptions","organizations_url":"https://api.github.com/users/daschl/orgs","repos_url":"https://api.github.com/users/daschl/repos","events_url":"https://api.github.com/users/daschl/events{/privacy}","received_events_url":"https://api.github.com/users/daschl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":185727,"node_id":"MDU6TGFiZWwxODU3Mjc=","url":"https://api.github.com/repos/netty/netty/labels/defect","name":"defect","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":{"login":"daschl","id":29086,"node_id":"MDQ6VXNlcjI5MDg2","avatar_url":"https://avatars.githubusercontent.com/u/29086?v=4","gravatar_id":"","url":"https://api.github.com/users/daschl","html_url":"https://github.com/daschl","followers_url":"https://api.github.com/users/daschl/followers","following_url":"https://api.github.com/users/daschl/following{/other_user}","gists_url":"https://api.github.com/users/daschl/gists{/gist_id}","starred_url":"https://api.github.com/users/daschl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daschl/subscriptions","organizations_url":"https://api.github.com/users/daschl/orgs","repos_url":"https://api.github.com/users/daschl/repos","events_url":"https://api.github.com/users/daschl/events{/privacy}","received_events_url":"https://api.github.com/users/daschl/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"daschl","id":29086,"node_id":"MDQ6VXNlcjI5MDg2","avatar_url":"https://avatars.githubusercontent.com/u/29086?v=4","gravatar_id":"","url":"https://api.github.com/users/daschl","html_url":"https://github.com/daschl","followers_url":"https://api.github.com/users/daschl/followers","following_url":"https://api.github.com/users/daschl/following{/other_user}","gists_url":"https://api.github.com/users/daschl/gists{/gist_id}","starred_url":"https://api.github.com/users/daschl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daschl/subscriptions","organizations_url":"https://api.github.com/users/daschl/orgs","repos_url":"https://api.github.com/users/daschl/repos","events_url":"https://api.github.com/users/daschl/events{/privacy}","received_events_url":"https://api.github.com/users/daschl/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":{"url":"https://api.github.com/repos/netty/netty/milestones/315","html_url":"https://github.com/netty/netty/milestone/315","labels_url":"https://api.github.com/repos/netty/netty/milestones/315/labels","id":12848270,"node_id":"MI_kwDOABA-c84AxAyO","number":315,"title":"4.2.2.Final","description":"","creator":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":109,"state":"closed","created_at":"2025-05-06T17:54:23Z","updated_at":"2025-06-05T09:31:21Z","due_on":null,"closed_at":"2025-06-05T09:31:21Z"},"comments":1,"created_at":"2025-05-20T05:58:59Z","updated_at":"2025-05-20T12:34:08Z","closed_at":"2025-05-20T12:24:32Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The following code reproduces an issue where the set returned by `OpenSsl.availableJavaCipherSuites` contains at one null element.\n\n```java\n@Test\nvoid testAvailableJavaCipherSuitesDoesNotContainNullElement() {\n    Set<String> suites = OpenSsl.availableJavaCipherSuites();\n    for (String suite : suites) {\n        assertNotNull(suite);\n    }\n}\n```\n\nWhy this happens is a bit intricate, the root cause (as I can see) is as follows:\n\n- in `OpenSsl`the following code is performed when boringssl is enabled:\n\n```java\nif (IS_BORINGSSL) {\n    // Currently BoringSSL does not include these when calling SSL.getCiphers() even when these\n    // are supported.\n    Collections.addAll(availableOpenSslCipherSuites, EXTRA_SUPPORTED_TLS_1_3_CIPHERS);\n    Collections.addAll(availableOpenSslCipherSuites,\n                       \"AEAD-AES128-GCM-SHA256\",\n                       \"AEAD-AES256-GCM-SHA384\",\n                       \"AEAD-CHACHA20-POLY1305-SHA256\");\n}\n```\n\nThe first line is fine I think, but the second addAll causes problems down the road.  When we are building the list of \"java\" ciphers from the openssl list, the code checks:\n\n```java\nif (!isTLSv13Cipher(cipher)) {\n    availableJavaCipherSuites.add(CipherSuiteConverter.toJava(cipher, \"TLS\"));\n    availableJavaCipherSuites.add(CipherSuiteConverter.toJava(cipher, \"SSL\"));\n} else {\n    // TLSv1.3 ciphers have the correct format.\n    availableJavaCipherSuites.add(cipher);\n}\n```\n\nBut `isTLSv13Cipher` only looks at the set of `TLSV13_CIPHERS` which only contains:\n\n```java\n  static final Set<String> TLSV13_CIPHERS = Collections.unmodifiableSet(new LinkedHashSet<String>(\n          asList(\"TLS_AES_256_GCM_SHA384\", \"TLS_CHACHA20_POLY1305_SHA256\",\n                        \"TLS_AES_128_GCM_SHA256\", \"TLS_AES_128_CCM_8_SHA256\",\n                        \"TLS_AES_128_CCM_SHA256\")));\n```\n\nso, the different format. TLS1.3 certs are only configured in the mapper with the `TLS_` prefix, so because the check is false, we end up invoking\n\n```java\navailableJavaCipherSuites.add(CipherSuiteConverter.toJava(cipher, \"SSL\"));\n```\n\nwhich returns null for `AEAD-AES128-GCM-SHA256` and since there is no null check here it ends up as a null entry in the set.\n\nI am happy to provide a fix, but I will need guidance if either the \"incorrect\" cipher suites need to be removed when BORING is enabled or if there simply should be an null check after the conversion to avoid adding a null entry.","closed_by":{"login":"normanmaurer","id":439362,"node_id":"MDQ6VXNlcjQzOTM2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/439362?v=4","gravatar_id":"","url":"https://api.github.com/users/normanmaurer","html_url":"https://github.com/normanmaurer","followers_url":"https://api.github.com/users/normanmaurer/followers","following_url":"https://api.github.com/users/normanmaurer/following{/other_user}","gists_url":"https://api.github.com/users/normanmaurer/gists{/gist_id}","starred_url":"https://api.github.com/users/normanmaurer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/normanmaurer/subscriptions","organizations_url":"https://api.github.com/users/normanmaurer/orgs","repos_url":"https://api.github.com/users/normanmaurer/repos","events_url":"https://api.github.com/users/normanmaurer/events{/privacy}","received_events_url":"https://api.github.com/users/normanmaurer/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/netty/netty/issues/15214/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/netty/netty/issues/15214/timeline","performed_via_github_app":null,"state_reason":"completed"}