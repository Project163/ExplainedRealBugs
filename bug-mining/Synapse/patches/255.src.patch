diff --git a/java/modules/extensions/pom.xml b/java/modules/extensions/pom.xml
index fc5e1a060..21eff6f19 100644
--- a/java/modules/extensions/pom.xml
+++ b/java/modules/extensions/pom.xml
@@ -121,6 +121,12 @@
             <artifactId>bsf-all</artifactId>
             <version>${bsf.version}</version>
         </dependency>
+	<dependency>
+	    <groupId>org.jruby</groupId>
+	    <artifactId>jruby-complete</artifactId>
+	    <version>${jruby.version}</version>
+	    <scope>test</scope>
+	</dependency>
         <dependency>
             <groupId>groovy</groupId>
             <artifactId>groovy-all</artifactId>
diff --git a/java/modules/extensions/src/test/java/org/apache/synapse/mediators/bsf/ScriptMediatorSerializationTest.java b/java/modules/extensions/src/test/java/org/apache/synapse/mediators/bsf/ScriptMediatorSerializationTest.java
index f307a869c..fa0e0d2b3 100644
--- a/java/modules/extensions/src/test/java/org/apache/synapse/mediators/bsf/ScriptMediatorSerializationTest.java
+++ b/java/modules/extensions/src/test/java/org/apache/synapse/mediators/bsf/ScriptMediatorSerializationTest.java
@@ -50,4 +50,17 @@ public class ScriptMediatorSerializationTest extends AbstractTestCase {
         assertTrue(serialization(inputXml, mediatorFactory, scriptMediatorSerializer));
         assertTrue(serialization(inputXml, scriptMediatorSerializer));
     }
+
+    public void testInlineScriptMediatorSerializationScenarioTwo() throws XMLComparisonException {
+        String inputXml = "<syn:script xmlns:syn=\"http://synapse.apache.org/ns/2010/04/configuration\" language='rb'>" +
+                "<![CDATA[" +
+                "require 'rexml/document'\n" +
+                "include REXML\n" +
+                "newRequest= Document.new '<m:getQuote xmlns:m=\"http://services.samples/xsd\"><m:request><m:symbol>...test...</m:symbol></m:request></m:getQuote>'\n" +
+                "newRequest.root.elements[1].elements[1].text = $mc.getPayloadXML().root.elements[1].get_text\n" +
+                "$mc.setPayloadXML(newRequest)" +
+                "]]></syn:script>";
+        assertTrue(serialization(inputXml, mediatorFactory, scriptMediatorSerializer));
+        assertTrue(serialization(inputXml, scriptMediatorSerializer));
+    }
 }
