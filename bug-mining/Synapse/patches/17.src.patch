diff --git a/java/modules/core/src/main/java/org/apache/synapse/core/axis2/Axis2FlexibleMEPClient.java b/java/modules/core/src/main/java/org/apache/synapse/core/axis2/Axis2FlexibleMEPClient.java
index 5c46ff305..b00677f0e 100644
--- a/java/modules/core/src/main/java/org/apache/synapse/core/axis2/Axis2FlexibleMEPClient.java
+++ b/java/modules/core/src/main/java/org/apache/synapse/core/axis2/Axis2FlexibleMEPClient.java
@@ -44,6 +44,7 @@ import org.apache.axis2.description.AxisService;
 import org.apache.axis2.description.AxisServiceGroup;
 import org.apache.axis2.engine.AxisConfiguration;
 import org.apache.axiom.om.util.UUIDGenerator;
+import org.apache.axiom.attachments.Attachments;
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.apache.neethi.Policy;
@@ -93,7 +94,18 @@ public class Axis2FlexibleMEPClient {
             wsAddressingEnabled = endpoint.isAddressingOn() || wsSecurityEnabled || wsRMEnabled;
         }
 
-        log.debug("sending [add = "+wsAddressingEnabled+"] [sec = "+wsSecurityEnabled + "] [ rm = "+wsRMEnabled+"] [ to "+synapseOutMessageContext.getTo()+"]");
+        if (log.isDebugEnabled()) {
+            log.debug(
+                "sending [add = " + wsAddressingEnabled +
+                "] [sec = " + wsSecurityEnabled +
+                "] [rm = " + wsRMEnabled +
+                (endpoint != null ?
+                    "] [ mtom = " + endpoint.isUseMTOM() +
+                    "] [ swa = " + endpoint.isUseSwa() +
+                    "] [ force soap=" + endpoint.isForceSOAP() +
+                    "; pox=" + endpoint.isForcePOX() : "") +
+                "] [ to " + synapseOutMessageContext.getTo() + "]");
+        }
 
         // save the original message context wihout altering it, so we can tie the response
         MessageContext originalInMsgCtx = ((Axis2MessageContext) synapseOutMessageContext).getAxis2MessageContext();
@@ -124,13 +136,15 @@ public class Axis2FlexibleMEPClient {
                 axisOutMsgCtx.setProperty(
                         org.apache.axis2.Constants.Configuration.ENABLE_MTOM,
                         org.apache.axis2.Constants.VALUE_TRUE);
+                axisOutMsgCtx.setDoingMTOM(true);
 
             } else if (endpoint.isUseSwa()) {
                 axisOutMsgCtx.setDoingSwA(true);
                 // fix / workaround for AXIS2-1798
                 axisOutMsgCtx.setProperty(
-                        org.apache.axis2.Constants.Configuration.ENABLE_MTOM,
+                        org.apache.axis2.Constants.Configuration.ENABLE_SWA,
                         org.apache.axis2.Constants.VALUE_TRUE);
+                axisOutMsgCtx.setDoingSwA(true);
             }
 
             if (endpoint.isUseSeparateListener()) {
@@ -233,6 +247,19 @@ public class Axis2FlexibleMEPClient {
 
         newMC.setDoingREST(ori.isDoingREST());
         newMC.setDoingMTOM(ori.isDoingMTOM());
+        newMC.setDoingSwA(ori.isDoingSwA());
+
+        // if the original request carries any attachments, copy them to the clone
+        // as well, except for the soap part if any
+        Attachments attachments = ori.getAttachmentMap();
+        String[] cIDs = attachments.getAllContentIDs();
+        String soapPart = attachments.getSOAPPartContentID();
+        for (int i=0; i<cIDs.length; i++) {
+            if (!cIDs[i].equals(soapPart)) {
+                newMC.addAttachment(cIDs[i], attachments.getDataHandler(cIDs[i]));
+            }
+        }
+
         newMC.setServerSide(false);
 
         // set SOAP envelope on the message context, removing WS-A headers
diff --git a/java/modules/core/src/main/java/org/apache/synapse/core/axis2/SynapseCallbackReceiver.java b/java/modules/core/src/main/java/org/apache/synapse/core/axis2/SynapseCallbackReceiver.java
index fafda8c2e..b50b12896 100644
--- a/java/modules/core/src/main/java/org/apache/synapse/core/axis2/SynapseCallbackReceiver.java
+++ b/java/modules/core/src/main/java/org/apache/synapse/core/axis2/SynapseCallbackReceiver.java
@@ -152,6 +152,19 @@ public class SynapseCallbackReceiver implements MessageReceiver {
 
             // If request is REST assume that the response is REST too
             response.setDoingREST(axisOutMsgCtx.isDoingREST());
+            if (axisOutMsgCtx.isDoingMTOM()) {
+                response.setDoingMTOM(true);
+                response.setProperty(
+                        org.apache.axis2.Constants.Configuration.ENABLE_MTOM,
+                        org.apache.axis2.Constants.VALUE_TRUE);
+            }
+            if (axisOutMsgCtx.isDoingSwA()) {
+                response.setDoingSwA(true);
+                response.setProperty(
+                        org.apache.axis2.Constants.Configuration.ENABLE_SWA,
+                        org.apache.axis2.Constants.VALUE_TRUE);
+            }
+
             if (axisOutMsgCtx.getMessageID() != null) {
                 response.setRelationships(
                         new RelatesTo[]{new RelatesTo(axisOutMsgCtx.getMessageID())});
diff --git a/java/modules/nhttp/src/org/apache/axis2/transport/nhttp/Axis2HttpRequest.java b/java/modules/nhttp/src/org/apache/axis2/transport/nhttp/Axis2HttpRequest.java
index f557a9c7b..62aa10b19 100644
--- a/java/modules/nhttp/src/org/apache/axis2/transport/nhttp/Axis2HttpRequest.java
+++ b/java/modules/nhttp/src/org/apache/axis2/transport/nhttp/Axis2HttpRequest.java
@@ -163,8 +163,16 @@ public class Axis2HttpRequest {
 
         log.debug("start streaming outgoing http request");
         OutputStream out = Channels.newOutputStream(pipe.sink());
-        messageFormatter.writeTo(msgContext, format, out, false);
-        try {
+
+        if (format == null) {
+            format = Util.getOMOutputFormat(msgContext);
+        }
+        if (messageFormatter == null) {
+            messageFormatter = TransportUtils.getMessageFormatter(msgContext);
+        }
+
+        messageFormatter.writeTo(msgContext, format, out, true);
+            try {
             out.flush();
             out.close();
         } catch (IOException e) {
diff --git a/java/modules/nhttp/src/org/apache/axis2/transport/nhttp/HttpCoreNIOSender.java b/java/modules/nhttp/src/org/apache/axis2/transport/nhttp/HttpCoreNIOSender.java
index 8ca929962..f94838059 100644
--- a/java/modules/nhttp/src/org/apache/axis2/transport/nhttp/HttpCoreNIOSender.java
+++ b/java/modules/nhttp/src/org/apache/axis2/transport/nhttp/HttpCoreNIOSender.java
@@ -235,6 +235,7 @@ public class HttpCoreNIOSender extends AbstractHandler implements TransportSende
             headers.remove(HTTP.SERVER_DIRECTIVE);
             headers.remove(HTTP.CONTENT_TYPE);
             headers.remove(HTTP.CONTENT_LEN);
+            headers.remove(HTTP.USER_AGENT);
         }
     }
 
@@ -312,7 +313,7 @@ public class HttpCoreNIOSender extends AbstractHandler implements TransportSende
 
         OutputStream out = worker.getOutputStream();
         try {
-            messageFormatter.writeTo(msgContext, format, out, false);
+            messageFormatter.writeTo(msgContext, format, out, true);
             out.close();
         } catch (IOException e) {
             handleException("IO Error sending response message", e);
