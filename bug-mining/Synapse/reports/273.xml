<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:08:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-659] MBeanRegistrar Is Not Thread Safe</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-659</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;The MBeanRegistrar implementation used to register various MBeans, is not thread safe. The register method can be invoked by multiple threads at the same time with the same arguments.With a sufficient level of contention, the registrar may attempt to register the same MBean multiple times. This results in an exception like this:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-06-09 11:28:56,840&amp;#93;&lt;/span&gt;  WARN - MBeanRegistrar Error registering a MBean with name &apos; StatisticsView &apos; and category name &apos; StatisticsView&apos; for JMX management&lt;br/&gt;
javax.management.InstanceAlreadyExistsException: org.apache.synapse:Type=StatisticsView,Name=StatisticsView&lt;br/&gt;
	at com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:453)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1484)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:963)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482)&lt;br/&gt;
	at org.apache.synapse.commons.jmx.MBeanRegistrar.registerMBean(MBeanRegistrar.java:51)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsCollector.&amp;lt;init&amp;gt;(StatisticsCollector.java:36)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsReporter.collectStatistics(StatisticsReporter.java:192)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsReporter.reportForComponent(StatisticsReporter.java:56)&lt;br/&gt;
	at org.apache.synapse.core.axis2.ProxyServiceMessageReceiver.receive(ProxyServiceMessageReceiver.java:75)&lt;br/&gt;
	at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:178)&lt;br/&gt;
	at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:167)&lt;br/&gt;
	at org.apache.synapse.transport.nhttp.ServerWorker.processEntityEnclosingMethod(ServerWorker.java:349)&lt;br/&gt;
	at org.apache.synapse.transport.nhttp.ServerWorker.run(ServerWorker.java:239)&lt;br/&gt;
	at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:58)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-06-09 11:28:56,840&amp;#93;&lt;/span&gt;  WARN - MBeanRegistrar Error registering a MBean with name &apos; StatisticsView &apos; and category name &apos; StatisticsView&apos; for JMX management&lt;br/&gt;
javax.management.InstanceAlreadyExistsException: org.apache.synapse:Type=StatisticsView,Name=StatisticsView&lt;br/&gt;
	at com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:453)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1484)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:963)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482)&lt;br/&gt;
	at org.apache.synapse.commons.jmx.MBeanRegistrar.registerMBean(MBeanRegistrar.java:51)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsCollector.&amp;lt;init&amp;gt;(StatisticsCollector.java:36)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsReporter.collectStatistics(StatisticsReporter.java:192)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsReporter.reportForComponent(StatisticsReporter.java:56)&lt;br/&gt;
	at org.apache.synapse.core.axis2.ProxyServiceMessageReceiver.receive(ProxyServiceMessageReceiver.java:75)&lt;br/&gt;
	at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:178)&lt;br/&gt;
	at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:167)&lt;br/&gt;
	at org.apache.synapse.transport.nhttp.ServerWorker.processEntityEnclosingMethod(ServerWorker.java:349)&lt;br/&gt;
	at org.apache.synapse.transport.nhttp.ServerWorker.run(ServerWorker.java:239)&lt;br/&gt;
	at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:58)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-06-09 11:28:56,840&amp;#93;&lt;/span&gt;  WARN - MBeanRegistrar Error registering a MBean with name &apos; StatisticsView &apos; and category name &apos; StatisticsView&apos; for JMX management&lt;br/&gt;
javax.management.InstanceAlreadyExistsException: org.apache.synapse:Type=StatisticsView,Name=StatisticsView&lt;br/&gt;
	at com.sun.jmx.mbeanserver.Repository.addMBean(Repository.java:453)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.internal_addObject(DefaultMBeanServerInterceptor.java:1484)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerDynamicMBean(DefaultMBeanServerInterceptor.java:963)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerObject(DefaultMBeanServerInterceptor.java:917)&lt;br/&gt;
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:312)&lt;br/&gt;
	at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:482)&lt;br/&gt;
	at org.apache.synapse.commons.jmx.MBeanRegistrar.registerMBean(MBeanRegistrar.java:51)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsCollector.&amp;lt;init&amp;gt;(StatisticsCollector.java:36)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsReporter.collectStatistics(StatisticsReporter.java:192)&lt;br/&gt;
	at org.apache.synapse.aspects.statistics.StatisticsReporter.reportForComponent(StatisticsReporter.java:56)&lt;br/&gt;
	at org.apache.synapse.core.axis2.ProxyServiceMessageReceiver.receive(ProxyServiceMessageReceiver.java:75)&lt;br/&gt;
	at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:178)&lt;br/&gt;
	at org.apache.axis2.transport.http.HTTPTransportUtils.processHTTPPostRequest(HTTPTransportUtils.java:167)&lt;br/&gt;
	at org.apache.synapse.transport.nhttp.ServerWorker.processEntityEnclosingMethod(ServerWorker.java:349)&lt;br/&gt;
	at org.apache.synapse.transport.nhttp.ServerWorker.run(ServerWorker.java:239)&lt;br/&gt;
	at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:58)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2010-06-09 11:28:56,840&amp;#93;&lt;/span&gt;  WARN - MBeanRegistrar Error registering a MBean with name &apos; StatisticsView &apos; and category name &apos; StatisticsView&apos; for JMX management&lt;/p&gt;

&lt;p&gt;In this case I engaged statistics on an endpoint and then loaded the ESB with Java bench using 30 concurrent threads.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466520">SYNAPSE-659</key>
            <summary>MBeanRegistrar Is Not Thread Safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hiranya">Hiranya Kasub Jayathilaka</assignee>
                                    <reporter username="hiranya">Hiranya Kasub Jayathilaka</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jun 2010 06:20:21 +0000</created>
                <updated>Wed, 9 Jun 2010 09:20:42 +0000</updated>
                            <resolved>Wed, 9 Jun 2010 09:20:42 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12876971" author="hiranya" created="Wed, 9 Jun 2010 06:25:11 +0000"  >&lt;p&gt;In order to fix this, I&apos;m going to synchronize the register and unregister methods in the registrar. Since the registrar is maintained as a singleton, it will ensure only one thread can invoke these methods at a time. Also since these methods are called only during the system initialization and shutdown, synchronizing them does not have an impact on the runtime performance.&lt;/p&gt;</comment>
                            <comment id="12876976" author="hiranya" created="Wed, 9 Jun 2010 06:34:44 +0000"  >&lt;p&gt;Just had another look at the design and it seems the race condition can occur only when registering the statistics MBean. All other MBeans (endpoints, server management, datasources etc) are registered by single thread instances. So we can just synchronize the invocation in the StatisticsCollector class.&lt;/p&gt;</comment>
                            <comment id="12877001" author="hiranya" created="Wed, 9 Jun 2010 09:20:42 +0000"  >&lt;p&gt;Fixed on the trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183879</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i11gdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216620</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>