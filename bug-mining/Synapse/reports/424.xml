<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:09:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-1003] Memory Leaks while using Anonymous Endpoints</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-1003</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;When using dynamic Load Balance endpoints in a send mediator and the endpoints have no name in the xml configuration, they get given a unique name from the EndpointFactory.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Every endpoint is registered over this name and an EndpointView as MBean is created. AdressEndpoints in a LoadbalanceEndpoint never gets deregistered, causing a memory leak.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Every EndpointView registers a statistic runnable in a ScheduledExecutorService, but if the endpoint gets destroyed, the runnable never gets canceled, causing another memory leak.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The first issue is reproducible by loading the following sequence: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;sequence xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ws.apache.org/ns/synapse&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;	&amp;lt;in&amp;gt;
		&amp;lt;send&amp;gt;
			&amp;lt;endpoint&amp;gt;
				&amp;lt;loadbalance&amp;gt;
					&amp;lt;endpoint&amp;gt;
						&amp;lt;loadbalance&amp;gt;
							&amp;lt;endpoint&amp;gt;
								&amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8280/ServiceResponseDummy1&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;							&amp;lt;/endpoint&amp;gt;
														&amp;lt;endpoint&amp;gt;
								&amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8280/ServiceResponseDummy2&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;							&amp;lt;/endpoint&amp;gt;

						&amp;lt;/loadbalance&amp;gt;
					&amp;lt;/endpoint&amp;gt;
					&amp;lt;endpoint&amp;gt;
						&amp;lt;loadbalance&amp;gt;
							&amp;lt;endpoint&amp;gt;
								&amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8280/ServiceResponseDummy3&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;							&amp;lt;/endpoint&amp;gt;
														&amp;lt;endpoint&amp;gt;
								&amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8280/ServiceResponseDummy4&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;							&amp;lt;/endpoint&amp;gt;

						&amp;lt;/loadbalance&amp;gt;
					&amp;lt;/endpoint&amp;gt;
				&amp;lt;/loadbalance&amp;gt;
			&amp;lt;/endpoint&amp;gt;
		&amp;lt;/send&amp;gt;
	&amp;lt;/in&amp;gt;
	&amp;lt;out&amp;gt;
		&amp;lt;log level=&lt;span class=&quot;code-quote&quot;&gt;&quot;custom&quot;&lt;/span&gt;&amp;gt;
			&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;simple out sequence: &quot;&lt;/span&gt; expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;From&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
		&amp;lt;/log&amp;gt;
		&amp;lt;send/&amp;gt;
	&amp;lt;/out&amp;gt;
&amp;lt;/sequence&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second is reproducible by dynamically loading sequence and engaging it (a case we&apos;ve seen where some people prefer to do this over statically configuring when they have over 1000&apos;s of services to manage): &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestCase &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; AbstractMediator &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ManagedLifecycle {
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Log log = LogFactory.getLog(ServiceConfigurationMediator.class);

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; mediate(MessageContext messageContext) {
		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			InputStream in = getClass().getResourceAsStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;/test/sequence.xml&quot;&lt;/span&gt;);

			XMLStreamReader reader = XMLInputFactory.newInstance().createXMLStreamReader(in);
			StAXOMBuilder builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StAXOMBuilder(reader);
			OMElement xmlSequence = builder.getDocument().getOMDocumentElement();

			SequenceMediator mediatorInstance = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SequenceMediatorFactory().createAnonymousSequence(xmlSequence, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mediatorInstance &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ManagedLifecycle)
				((ManagedLifecycle) mediatorInstance).init(messageContext.getEnvironment());
			&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; result = mediatorInstance.mediate(messageContext);
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mediatorInstance &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ManagedLifecycle)
				((ManagedLifecycle) mediatorInstance).destroy();

			&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result;
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
			log.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Fail: &quot;&lt;/span&gt; + e, e);
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SynapseException(e.getMessage(), e);
		}

	}

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I would like to contribute the attached diff that addresses the above issues for your consideration (it has been created over 2.1 branch). &lt;/p&gt;</description>
                <environment></environment>
        <key id="12971733">SYNAPSE-1003</key>
            <summary>Memory Leaks while using Anonymous Endpoints</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hiranya">Hiranya Kasub Jayathilaka</assignee>
                                    <reporter username="raviu">Ravi Undupitiya</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Sat, 21 May 2016 04:24:31 +0000</created>
                <updated>Sun, 5 Jun 2016 06:34:34 +0000</updated>
                            <resolved>Sun, 5 Jun 2016 05:50:25 +0000</resolved>
                                    <version>2.0</version>
                    <version>2.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15303188" author="hiranya" created="Thu, 26 May 2016 23:51:29 +0000"  >&lt;p&gt;Can you provide a patch for the latest trunk? There are some subtle but important differences in the EndpointView class, which needs to be taken into account.&lt;/p&gt;</comment>
                            <comment id="15315747" author="raviu" created="Sun, 5 Jun 2016 05:49:50 +0000"  >&lt;p&gt;Thanks Hiranya, trunk already seems to have a future in EndpointView and a shared scheduler. Future is cancelled when destroy is called, so the second issue above should already be fixed in trunk. I&apos;ve made slight adjustments and committed the fix. &lt;/p&gt;</comment>
                            <comment id="15315749" author="raviu" created="Sun, 5 Jun 2016 05:50:07 +0000"  >&lt;p&gt;Committed at revision 1746863. &lt;/p&gt;</comment>
                            <comment id="15315771" author="hudson" created="Sun, 5 Jun 2016 06:34:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in Synapse - Trunk #5262 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/5262/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/5262/&lt;/a&gt;)&lt;br/&gt;
Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1003&quot; title=&quot;Memory Leaks while using Anonymous Endpoints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1003&quot;&gt;&lt;del&gt;SYNAPSE-1003&lt;/del&gt;&lt;/a&gt; (ravi: rev 1746863)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;java/modules/core/src/main/java/org/apache/synapse/endpoints/AbstractEndpoint.java&lt;/li&gt;
	&lt;li&gt;java/modules/core/src/main/java/org/apache/synapse/endpoints/EndpointView.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12805373" name="memory-leak.diff" size="2171" author="raviu" created="Sat, 21 May 2016 04:26:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yb9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>