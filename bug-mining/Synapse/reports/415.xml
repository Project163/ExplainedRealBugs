<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:09:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-1014] NPE in DefaultNHttpClientConnection consumeInput, when invoking a proxy concurrently</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-1014</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;When invoking a content aware passthrough proxy at a concurrency of 100. the following exception occurs&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR TargetHandler Unexpected exception encountered in TargetHandler
java.lang.NullPointerException
	at org.apache.http.impl.nio.DefaultNHttpClientConnection.consumeInput(DefaultNHttpClientConnection.java:268)
	at org.apache.http.impl.nio.DefaultHttpClientIODispatch.onInputReady(DefaultHttpClientIODispatch.java:165)
	at org.apache.http.impl.nio.DefaultHttpClientIODispatch.onInputReady(DefaultHttpClientIODispatch.java:51)
	at org.apache.http.impl.nio.reactor.AbstractIODispatch.inputReady(AbstractIODispatch.java:113)
	at org.apache.http.impl.nio.reactor.BaseIOReactor.readable(BaseIOReactor.java:159)
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:338)
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:316)
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:277)
	at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:105)
	at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:584)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12972137">SYNAPSE-1014</key>
            <summary>NPE in DefaultNHttpClientConnection consumeInput, when invoking a proxy concurrently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="isudana">Isuru Udana</assignee>
                                    <reporter username="bsendruan">Senduran</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 May 2016 17:55:01 +0000</created>
                <updated>Tue, 27 Dec 2016 13:35:24 +0000</updated>
                            <resolved>Tue, 27 Dec 2016 13:35:24 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15296764" author="bsendruan" created="Mon, 23 May 2016 18:00:16 +0000"  >&lt;p&gt;Since the exception is thrown at http nio level, I tried upgrading the http core version to 4.3.3 and http client to 4.3.6. (current versions 4.3, 4.3.1)&lt;br/&gt;
This upgrade reduces the exception occurrence but didn&apos;t completely eliminates.&lt;br/&gt;
Couldn&apos;t upgrade to a higher version due to test case failures. &lt;/p&gt;</comment>
                            <comment id="15304595" author="hiranya" created="Fri, 27 May 2016 19:15:13 +0000"  >&lt;p&gt;I made the suggested changes. I&apos;ll keep the issue open until we figure out a more robust fix for the problem.&lt;/p&gt;</comment>
                            <comment id="15304648" author="hudson" created="Fri, 27 May 2016 19:39:59 +0000"  >&lt;p&gt;SUCCESS: Integrated in Synapse - Trunk #5241 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/5241/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/5241/&lt;/a&gt;)&lt;br/&gt;
Upgrading HTTP Core and HTTP Client versions; As suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1014&quot; title=&quot;NPE in DefaultNHttpClientConnection consumeInput, when invoking a proxy concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1014&quot;&gt;&lt;del&gt;SYNAPSE-1014&lt;/del&gt;&lt;/a&gt; (hiranya: rev 1745802)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;java/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15304704" author="hiranya" created="Fri, 27 May 2016 20:22:31 +0000"  >&lt;p&gt;The log file shows the errors that occur if we use HTTP Core 4.4. Perhaps Oleg can shed some light on the matter.&lt;/p&gt;</comment>
                            <comment id="15663773" author="isudana" created="Mon, 14 Nov 2016 12:16:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=olegk&quot; class=&quot;user-hover&quot; rel=&quot;olegk&quot;&gt;olegk&lt;/a&gt; Can you please shed some light on this ?&lt;/p&gt;</comment>
                            <comment id="15663850" author="olegk" created="Mon, 14 Nov 2016 12:57:55 +0000"  >&lt;p&gt;My guess would be concurrent modification of &lt;tt&gt;DefaultNHttpClientConnection&lt;/tt&gt; internal structures by concurrent threads. &lt;tt&gt;DefaultNHttpClientConnection&lt;/tt&gt; instances are NOT thread safe!&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="15664007" author="isudana" created="Mon, 14 Nov 2016 14:06:37 +0000"  >&lt;p&gt;Thanks Oleg. We will check along the lines of concurrent modifications.&lt;/p&gt;</comment>
                            <comment id="15777532" author="isudana" created="Mon, 26 Dec 2016 04:14:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bsendruan&quot; class=&quot;user-hover&quot; rel=&quot;bsendruan&quot;&gt;bsendruan&lt;/a&gt; Can you post the synapse config you have used to produce this error. &lt;br/&gt;
I tried with a message building scenario in out flow with a concurrency of 100, still couldn&apos;t reproduce this.&lt;/p&gt;</comment>
                            <comment id="15777688" author="bsendruan" created="Mon, 26 Dec 2016 06:28:32 +0000"  >&lt;p&gt;Hi Isuru&lt;/p&gt;

&lt;p&gt;Here I am attaching the proxy configuration I used&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12844656/12844656_HelloProxy.xml&quot; title=&quot;HelloProxy.xml attached to SYNAPSE-1014&quot;&gt;HelloProxy.xml&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;. When I get this NPE. But surprisingly I am not getting this exception with the latest trunk. So I did the followings.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In the latest trunk, reduced the http core and httpcore and http-client version to older version i.e 4.3, 4.3.1. But still couldn&apos;t reproduce the issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;So I reverted to an older synapse revision 1745801 (this is the revision just before the http core and http-clinet version upgrade). With this revision, I got the NPE as well as the build failure error which is reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1015&quot; title=&quot;Message building fails at high concurrency when the outsequence is content aware &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1015&quot;&gt;&lt;del&gt;SYNAPSE-1015&lt;/del&gt;&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;On top of revision 1745801, I applied the diff mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1015&quot; title=&quot;Message building fails at high concurrency when the outsequence is content aware &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1015&quot;&gt;&lt;del&gt;SYNAPSE-1015&lt;/del&gt;&lt;/a&gt; and eliminated the build error. And I got the NPE.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;According to above behavior I believe the NPE is been fixed by a recent fix. &lt;/p&gt;</comment>
                            <comment id="15780102" author="isudana" created="Tue, 27 Dec 2016 10:17:17 +0000"  >&lt;p&gt;Ported a fix from &lt;a href=&quot;https://github.com/wso2/wso2-synapse/commit/fbc829ae1e52c552aa348967db929fa21a8cf1f6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wso2/wso2-synapse/commit/fbc829ae1e52c552aa348967db929fa21a8cf1f6&lt;/a&gt; by Isuru Ranawaka and applied to trunk at r1776101.&lt;/p&gt;
</comment>
                            <comment id="15780110" author="isudana" created="Tue, 27 Dec 2016 10:21:53 +0000"  >&lt;p&gt;Created a separate ticket (&lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1067&quot; title=&quot;Upgrade to HTTP Core 4.4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1067&quot;&gt;SYNAPSE-1067&lt;/a&gt;) to keep track of HTTP Core upgrade.&lt;/p&gt;
</comment>
                            <comment id="15780113" author="isudana" created="Tue, 27 Dec 2016 10:22:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prabathariyarathna&quot; class=&quot;user-hover&quot; rel=&quot;prabathariyarathna&quot;&gt;prabathariyarathna&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chanakaudaya&quot; class=&quot;user-hover&quot; rel=&quot;chanakaudaya&quot;&gt;chanakaudaya&lt;/a&gt; Can you please check whether NPE is solved with the recent fix in trunk ?&lt;/p&gt;</comment>
                            <comment id="15780137" author="hudson" created="Tue, 27 Dec 2016 10:38:07 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build Synapse - Trunk #5297 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/5297/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/5297/&lt;/a&gt;)&lt;br/&gt;
Fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1014&quot; title=&quot;NPE in DefaultNHttpClientConnection consumeInput, when invoking a proxy concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1014&quot;&gt;&lt;del&gt;SYNAPSE-1014&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
-----------------------&lt;br/&gt;
Porting fix from &lt;a href=&quot;https://github.com/wso2/wso2-synapse/commit/fbc829ae1e52c552aa348967db929fa21a8cf1f6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wso2/wso2-synapse/commit/fbc829ae1e52c552aa348967db929fa21a8cf1f6&lt;/a&gt; by Isuru Ranawaka (isudana: rev 1776101)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) java/modules/transports/core/nhttp/src/main/java/org/apache/synapse/transport/passthru/TargetHandler.java&lt;/li&gt;
	&lt;li&gt;(edit) java/modules/transports/core/nhttp/src/main/java/org/apache/synapse/transport/passthru/util/PassThroughTransportUtils.java&lt;/li&gt;
	&lt;li&gt;(edit) java/modules/transports/core/nhttp/src/main/java/org/apache/synapse/transport/utils/conn/SynapseNHttpClientConnection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15780387" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:05 +0000"  >&lt;p&gt;Tested the latest build with different concurrency levels and didn&apos;t encounter this NPE. Looks like the fix suggested here has resolved this issue. I have attached the test results, test script and the test proxy.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Chanaka&lt;/p&gt;</comment>
                            <comment id="15780389" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:59 +0000"  >&lt;p&gt;Test artifacts.&lt;/p&gt;</comment>
                            <comment id="15780409" author="prabathariyarathna" created="Tue, 27 Dec 2016 13:32:46 +0000"  >&lt;p&gt;Tested the latest pack withe JMS listener scenario (Sample 250) with 100K messages but didn&apos;t encounter the NPE. &lt;br/&gt;
+1 for go with this fix.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;br/&gt;
Prabath.&lt;/p&gt;</comment>
                            <comment id="15780412" author="isudana" created="Tue, 27 Dec 2016 13:35:14 +0000"  >&lt;p&gt;Thanks Chanaka and Prabath, I&apos;ll close this issue. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12844783" name="EchoProxy.xml" size="461" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:59 +0000"/>
                            <attachment id="12844656" name="HelloProxy.xml" size="756" author="bsendruan" created="Mon, 26 Dec 2016 06:28:32 +0000"/>
                            <attachment id="12844777" name="PassthroughLoadtest.jmx" size="9773" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:59 +0000"/>
                            <attachment id="12806715" name="http_core_4_4.log" size="31606" author="hiranya" created="Fri, 27 May 2016 20:22:31 +0000"/>
                            <attachment id="12844782" name="ptt-100-1000.csv" size="355" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:59 +0000"/>
                            <attachment id="12844781" name="ptt-200-1000.csv" size="357" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:59 +0000"/>
                            <attachment id="12844780" name="ptt-300-1000.csv" size="357" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:59 +0000"/>
                            <attachment id="12844779" name="ptt-400-1000.csv" size="361" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:59 +0000"/>
                            <attachment id="12844778" name="ptt-500-1000.csv" size="365" author="chanakaudaya" created="Tue, 27 Dec 2016 13:22:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ydr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>