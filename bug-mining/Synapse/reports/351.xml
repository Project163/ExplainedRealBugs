<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:09:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-846] Few parts of the code that prevents normal Synapse termination when running as a web application</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-846</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;When using synapse as a web application, I noticed that it is unable to stop (stop web application) sucessfully. It leaves many threads running, which prevents web application and Tomcat itself from shutdown. I tracked those threads and found parts of code which &quot;creates them but do not stop them&quot;. I created my own patch for those code parts and now application stops correctly. I would be pleased if those changes appears in some future version so I will have no need to hold &quot;my own set of patches synapse and axis 2 classes&quot;. Changes to source codes of Synapse 2.1:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.synapse.core.axis2.SynapseStartUpServlet:80 (after serverManager.stop()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  serverManager.shutdown();    // this must be called also&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.synapse.transport.nhttp.HttpCoreNIOListener in method stop(), just before the end of try-catch block:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;            mbeanSupport.unregister();&lt;br/&gt;
            metrics.destroy();&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.synapse.endpoints.AbstractEndpoint in method destroy() before &quot;this.initialized = false&quot;:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        if (metricsMBean != null) &lt;/p&gt;
{
            metricsMBean.destroy();
            metricsMBean = null;
        }

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;org.apache.axis2.transport.jms.ServiceTaskManager (I know this belongs to Axis2, but it is the same problem):&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in the method stop() after the initial logging:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        if (workerPool != null) {&lt;br/&gt;
            try &lt;/p&gt;
{
                workerPool.shutdown(1000);
            }
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
                log.error(&quot;Stopping WorkerPool failed&quot;, e);
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;in the method stop() after &quot;sharedConnection.stop();&quot;:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;                sharedConnection.close();&lt;/p&gt;


&lt;p&gt;Thank you&lt;/p&gt;</description>
                <environment>Synapse is acting as a web application inside web container (Tomcat), not tested as stand alone (but may be affected also).</environment>
        <key id="12543450">SYNAPSE-846</key>
            <summary>Few parts of the code that prevents normal Synapse termination when running as a web application</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hiranya">Hiranya Kasub Jayathilaka</assignee>
                                    <reporter username="konzerva">Lukas Valenta</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Feb 2012 09:41:47 +0000</created>
                <updated>Sun, 18 Aug 2013 00:20:21 +0000</updated>
                            <resolved>Mon, 15 Jul 2013 21:03:48 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13216565" author="hiranya" created="Sat, 25 Feb 2012 22:40:41 +0000"  >&lt;p&gt;Thanks Lukas for pointing these issues out. Will review your fixes and do the necessary changes. The JMS transport fix should go to Axis2 Transports project.&lt;/p&gt;</comment>
                            <comment id="13708981" author="hiranya" created="Mon, 15 Jul 2013 21:03:48 +0000"  >&lt;p&gt;This should be fixed now. Thanks Lukas for the contribution.&lt;/p&gt;</comment>
                            <comment id="13709075" author="hudson" created="Mon, 15 Jul 2013 22:34:08 +0000"  >&lt;p&gt;SUCCESS: Integrated in Synapse - Trunk #4615 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/4615/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/4615/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-846&quot; title=&quot;Few parts of the code that prevents normal Synapse termination when running as a web application&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-846&quot;&gt;&lt;del&gt;SYNAPSE-846&lt;/del&gt;&lt;/a&gt; Made the suggested changes to the synapse servlet. Added the MBean unregistration code to the pass through transport. NHTTP transport seems to be already fixed. (hiranya: rev 1503474)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/core/axis2/SynapseStartUpServlet.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/transports/core/nhttp/src/main/java/org/apache/synapse/transport/passthru/PassThroughHttpListener.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228696</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 19 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17t3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>