<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:09:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-1023] DISABLE_CHUNKING property is not honored in the response path of PT</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-1023</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;proxy name=&lt;span class=&quot;code-quote&quot;&gt;&quot;StockQuoteProxy&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;target&amp;gt;
             &amp;lt;inSequence&amp;gt;
                &amp;lt;send&amp;gt;
                 &amp;lt;endpoint&amp;gt;
                        &amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8080/RESTfulExample/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/hello/data&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;                    &amp;lt;/endpoint&amp;gt;
                &amp;lt;/send&amp;gt;
             &amp;lt;/inSequence&amp;gt;
             &amp;lt;outSequence&amp;gt;
                &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;DISABLE_CHUNKING&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; scope=&lt;span class=&quot;code-quote&quot;&gt;&quot;axis2&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;send/&amp;gt;
            &amp;lt;/outSequence&amp;gt;
        &amp;lt;/target&amp;gt;
    &amp;lt;/proxy&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have mentioned the disable chunking in response path and it is not honored, please check the curl request.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;curl -v -XPOST -H &lt;span class=&quot;code-quote&quot;&gt;&quot;Content-type: application/json&quot;&lt;/span&gt; -d &lt;span class=&quot;code-quote&quot;&gt;&apos;{&lt;span class=&quot;code-quote&quot;&gt;&quot;Hello&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;World&quot;&lt;/span&gt;}&apos;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:8280/services/StockQuoteProxy&apos;&lt;/span&gt;
&lt;/span&gt;*   Trying ::1...
* Connected to localhost (::1) port 8280 (#0)
&amp;gt; POST /services/StockQuoteProxy HTTP/1.1
&amp;gt; Host: localhost:8280
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt; Content-type: application/json
&amp;gt; Content-Length: 18
&amp;gt; 
* upload completely sent off: 18 out of 18 bytes
&amp;lt; HTTP/1.1 201 Created
&amp;lt; Server: Apache-Coyote/1.1
&amp;lt; Date: Sat, 28 May 2016 22:54:29 GMT
&amp;lt; Transfer-Encoding: chunked
&amp;lt; 
* Connection #0 to host localhost left intact
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12973740">SYNAPSE-1023</key>
            <summary>DISABLE_CHUNKING property is not honored in the response path of PT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hiranya">Hiranya Kasub Jayathilaka</assignee>
                                    <reporter username="vanjikumaran@gmail.com">Vanjikumaran Sivajothy</reporter>
                        <labels>
                    </labels>
                <created>Sat, 28 May 2016 22:58:03 +0000</created>
                <updated>Thu, 9 Jun 2016 07:56:15 +0000</updated>
                            <resolved>Thu, 9 Jun 2016 07:00:43 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Core</component>
                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                                                            <comments>
                            <comment id="15305687" author="hiranya" created="Sat, 28 May 2016 23:28:12 +0000"  >&lt;p&gt;It looks like the property is only consulted in the request path. The response path does not. Can you provide a patch?&lt;/p&gt;</comment>
                            <comment id="15305688" author="vanji@wso2.com" created="Sat, 28 May 2016 23:29:00 +0000"  >&lt;p&gt;Working on the patch and tests, Will provide shortly.&lt;/p&gt;</comment>
                            <comment id="15305796" author="vanji@wso2.com" created="Sun, 29 May 2016 07:10:53 +0000"  >&lt;p&gt;I have create the patch and tested with the proxy given below,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;definitions xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ws.apache.org/ns/synapse&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;    &amp;lt;proxy name=&lt;span class=&quot;code-quote&quot;&gt;&quot;StockQuoteProxy&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;target&amp;gt;
            &amp;lt;endpoint&amp;gt;
                &amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:9000/services/SimpleStockQuoteService&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;            &amp;lt;/endpoint&amp;gt;
            &amp;lt;outSequence&amp;gt;
                &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;DISABLE_CHUNKING&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; scope=&lt;span class=&quot;code-quote&quot;&gt;&quot;axis2&quot;&lt;/span&gt;/&amp;gt;
                &amp;lt;send/&amp;gt;
            &amp;lt;/outSequence&amp;gt;
        &amp;lt;/target&amp;gt;
        &amp;lt;publishWSDL uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:repository/conf/sample/resources/proxy/sample_proxy_1.wsdl&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/proxy&amp;gt;
&amp;lt;/definitions&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Incvoked via curl and&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;curl -v --header &lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Type: text/xml;charset=UTF-8&quot;&lt;/span&gt; --header &lt;span class=&quot;code-quote&quot;&gt;&quot;SOAPAction:urn:getQuote&quot;&lt;/span&gt; -XPOST -d &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&amp;lt;soapenv:Envelope xmlns:soapenv=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;&amp;lt;soapenv:Header xmlns:wsa=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2005/08/addressing&quot;&lt;/span&gt;&amp;gt;&amp;lt;wsa:MessageID&amp;gt;urn:uuid:66cda4ab-7881-4eea-a3cc-61e277454a1f&amp;lt;/wsa:MessageID&amp;gt;&amp;lt;wsa:Action&amp;gt;urn:getQuote&amp;lt;/wsa:Action&amp;gt;&amp;lt;/soapenv:Header&amp;gt;&amp;lt;soapenv:Body&amp;gt;&amp;lt;m0:getQuote xmlns:m0=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://services.samples&quot;&lt;/span&gt;&amp;gt;&amp;lt;m0:request&amp;gt;&amp;lt;m0:symbol&amp;gt;IBM&amp;lt;/m0:symbol&amp;gt;&amp;lt;/m0:request&amp;gt;&amp;lt;/m0:getQuote&amp;gt;&amp;lt;/soapenv:Body&amp;gt;&amp;lt;/soapenv:Envelope&amp;gt;&apos;&lt;/span&gt;  http://localhost:8280/services/StockQuoteProxy&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Observer Transfer-Encoding: chunked is not in the reponse path&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;LM-SFA-00871979:axis2Client vsivajothy$ curl -v --header &lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Type: text/xml;charset=UTF-8&quot;&lt;/span&gt; --header &lt;span class=&quot;code-quote&quot;&gt;&quot;SOAPAction:urn:getQuote&quot;&lt;/span&gt; -XPOST -d &lt;span class=&quot;code-quote&quot;&gt;&apos;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&amp;lt;soapenv:Envelope xmlns:soapenv=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;&amp;lt;soapenv:Header xmlns:wsa=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2005/08/addressing&quot;&lt;/span&gt;&amp;gt;&amp;lt;wsa:MessageID&amp;gt;urn:uuid:66cda4ab-7881-4eea-a3cc-61e277454a1f&amp;lt;/wsa:MessageID&amp;gt;&amp;lt;wsa:Action&amp;gt;urn:getQuote&amp;lt;/wsa:Action&amp;gt;&amp;lt;/soapenv:Header&amp;gt;&amp;lt;soapenv:Body&amp;gt;&amp;lt;m0:getQuote xmlns:m0=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://services.samples&quot;&lt;/span&gt;&amp;gt;&amp;lt;m0:request&amp;gt;&amp;lt;m0:symbol&amp;gt;IBM&amp;lt;/m0:symbol&amp;gt;&amp;lt;/m0:request&amp;gt;&amp;lt;/m0:getQuote&amp;gt;&amp;lt;/soapenv:Body&amp;gt;&amp;lt;/soapenv:Envelope&amp;gt;&apos;&lt;/span&gt;  http://localhost:8281/services/StockQuoteProxy
&lt;/span&gt;*   Trying ::1...
* Connected to localhost (::1) port 8281 (#0)
&amp;gt; POST /services/StockQuoteProxy HTTP/1.1
&amp;gt; Host: localhost:8281
&amp;gt; User-Agent: curl/7.43.0
&amp;gt; Accept: */*
&amp;gt; Content-Type: text/xml;charset=UTF-8
&amp;gt; SOAPAction:urn:getQuote
&amp;gt; Content-Length: 470
&amp;gt; 
* upload completely sent off: 470 out of 470 bytes
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Content-Type: text/xml; charset=UTF-8
&amp;lt; Date: Sun, 29 May 2016 07:04:29 GMT
&amp;lt; Server: Synapse-PT-HttpComponents-NIO
&amp;lt; Content-Length: 1238
&amp;lt; 
* Connection #0 to host localhost left intact
&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&apos;1.0&apos;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&apos;UTF-8&apos;&lt;/span&gt;?&amp;gt;&amp;lt;soapenv:Envelope xmlns:soapenv=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;&amp;lt;soapenv:Header xmlns:wsa=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2005/08/addressing&quot;&lt;/span&gt;&amp;gt;&amp;lt;wsa:Action&amp;gt;urn:getQuoteResponse&amp;lt;/wsa:Action&amp;gt;&amp;lt;wsa:RelatesTo&amp;gt;urn:uuid:66cda4ab-7881-4eea-a3cc-61e277454a1f&amp;lt;/wsa:RelatesTo&amp;gt;&amp;lt;/soapenv:Header&amp;gt;&amp;lt;soapenv:Body&amp;gt;&amp;lt;ns:getQuoteResponse xmlns:ns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://services.samples&quot;&lt;/span&gt;&amp;gt;&amp;lt;ns:&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; xmlns:ax21=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://services.samples/xsd&quot;&lt;/span&gt; xmlns:xsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt; xsi:type=&lt;span class=&quot;code-quote&quot;&gt;&quot;ax21:GetQuoteResponse&quot;&lt;/span&gt;&amp;gt;&amp;lt;ax21:change&amp;gt;-2.6828974929642486&amp;lt;/ax21:change&amp;gt;&amp;lt;ax21:earnings&amp;gt;-8.753834648591738&amp;lt;/ax21:earnings&amp;gt;&amp;lt;ax21:high&amp;gt;178.058486970131&amp;lt;/ax21:high&amp;gt;&amp;lt;ax21:last&amp;gt;171.83930648253593&amp;lt;/ax21:last&amp;gt;&amp;lt;ax21:lastTradeTimestamp&amp;gt;Sun May 29 00:04:29 PDT 2016&amp;lt;/ax21:lastTradeTimestamp&amp;gt;&amp;lt;ax21:low&amp;gt;-171.17417221912933&amp;lt;/ax21:low&amp;gt;&amp;lt;ax21:marketCap&amp;gt;4.467990253866357E7&amp;lt;/ax21:marketCap&amp;gt;&amp;lt;ax21:name&amp;gt;IBM Company&amp;lt;/ax21:name&amp;gt;&amp;lt;ax21:open&amp;gt;179.12353489821118&amp;lt;/ax21:open&amp;gt;&amp;lt;ax21:peRatio&amp;gt;-17.18789161961029&amp;lt;/ax21:peRatio&amp;gt;&amp;lt;ax21:percentageChange&amp;gt;-1.362853752620967&amp;lt;/ax21:percentageChange&amp;gt;&amp;lt;ax21:prevClose&amp;gt;196.8587963165266&amp;lt;/ax21:prevClose&amp;gt;&amp;lt;ax21:symbol&amp;gt;IBM&amp;lt;/ax21:symbol&amp;gt;&amp;lt;ax21:volume&amp;gt;9217&amp;lt;/ax21:volume&amp;gt;&amp;lt;/ns:&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;&amp;gt;&amp;lt;/ns:getQuoteResponse&amp;gt;&amp;lt;/soapenv:Body&amp;gt;&amp;lt;/soapenv:Envelope&amp;gt;LM-SFA-00871979:axis2Client vsivajothy$ &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Without disabled chunked configuration, server worked in default manner.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;definitions xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ws.apache.org/ns/synapse&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;    &amp;lt;proxy name=&lt;span class=&quot;code-quote&quot;&gt;&quot;StockQuoteProxy&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;target&amp;gt;
            &amp;lt;endpoint&amp;gt;
                &amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:9000/services/SimpleStockQuoteService&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;            &amp;lt;/endpoint&amp;gt;
            &amp;lt;outSequence&amp;gt;
                &amp;lt;send/&amp;gt;
            &amp;lt;/outSequence&amp;gt;
        &amp;lt;/target&amp;gt;
        &amp;lt;publishWSDL uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:repository/conf/sample/resources/proxy/sample_proxy_1.wsdl&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/proxy&amp;gt;
&amp;lt;/definitions&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

 &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; * upload completely sent off: 470 out of 470 bytes
&amp;lt; HTTP/1.1 200 OK
&amp;lt; Content-Type: text/xml; charset=UTF-8
&amp;lt; Date: Sun, 29 May 2016 07:08:05 GMT
&amp;lt; Server: Synapse-PT-HttpComponents-NIO
&amp;lt; Transfer-Encoding: chunked
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Thanks,&lt;br/&gt;
vanji&lt;/p&gt;</comment>
                            <comment id="15306213" author="hiranya" created="Mon, 30 May 2016 04:24:04 +0000"  >&lt;p&gt;What is the constant HTTP_SC_DESC for? I don&apos;t see it being used anywhere.&lt;/p&gt;</comment>
                            <comment id="15306257" author="vanji@wso2.com" created="Mon, 30 May 2016 05:50:58 +0000"  >&lt;p&gt;I was working on another fix, It is 100% safe to remove HTTP_SC_DESC from patch.&lt;/p&gt;</comment>
                            <comment id="15306258" author="vanji@wso2.com" created="Mon, 30 May 2016 05:52:52 +0000"  >&lt;p&gt;Removed unwanted property setting in this patch.&lt;/p&gt;</comment>
                            <comment id="15306337" author="hiranya" created="Mon, 30 May 2016 07:34:43 +0000"  >&lt;p&gt;I&apos;m having issues with this patch. First I had to modify it a bit so that it can be applied to the latest trunk head. Once I got it applied I noticed that it doesn&apos;t work in some cases. The test case you have provided (with a proxy service) works fine. But if I try the same with an API, it fails. Try the following configuration.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;api name=&lt;span class=&quot;code-quote&quot;&gt;&quot;TestAPI&quot;&lt;/span&gt; context=&lt;span class=&quot;code-quote&quot;&gt;&quot;/test&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;resource methods=&lt;span class=&quot;code-quote&quot;&gt;&quot;POST&quot;&lt;/span&gt; url-mapping=&lt;span class=&quot;code-quote&quot;&gt;&quot;/content_length_out&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;inSequence&amp;gt;
            &amp;lt;send&amp;gt;
                &amp;lt;endpoint key=&lt;span class=&quot;code-quote&quot;&gt;&quot;echo&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;/send&amp;gt;
        &amp;lt;/inSequence&amp;gt;
        &amp;lt;outSequence&amp;gt;
            &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;DISABLE_CHUNKING&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; scope=&lt;span class=&quot;code-quote&quot;&gt;&quot;axis2&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;send/&amp;gt;
        &amp;lt;/outSequence&amp;gt;
    &amp;lt;/resource&amp;gt;
&amp;lt;/api&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This results in the following error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-05-30 00:28:57,499 [-] [PassThroughMessageProcessor-6] ERROR PassThroughHttpSender Failed to submit the response
org.apache.axis2.AxisFault: A header representing a Message Addressing Property is not valid and the message cannot be processed
	at org.apache.synapse.transport.passthru.SourceResponse.processChunkingOptions(SourceResponse.java:212)
	at org.apache.synapse.transport.passthru.PassThroughHttpSender.submitResponse(PassThroughHttpSender.java:513)
	at org.apache.synapse.transport.passthru.PassThroughHttpSender.invoke(PassThroughHttpSender.java:310)
	at org.apache.axis2.engine.AxisEngine.send(AxisEngine.java:431)
	at org.apache.synapse.core.axis2.Axis2Sender.sendBack(Axis2Sender.java:154)
	at org.apache.synapse.core.axis2.Axis2SynapseEnvironment.send(Axis2SynapseEnvironment.java:275)
	at org.apache.synapse.mediators.builtin.SendMediator.mediate(SendMediator.java:84)
	at org.apache.synapse.mediators.AbstractListMediator.mediate(AbstractListMediator.java:68)
	at org.apache.synapse.mediators.base.SequenceMediator.mediate(SequenceMediator.java:114)
	at org.apache.synapse.rest.Resource.process(Resource.java:298)
	at org.apache.synapse.rest.API.process(API.java:301)
	at org.apache.synapse.rest.RESTRequestHandler.dispatchToAPI(RESTRequestHandler.java:77)
	at org.apache.synapse.rest.RESTRequestHandler.process(RESTRequestHandler.java:51)
	at org.apache.synapse.core.axis2.Axis2SynapseEnvironment.injectMessage(Axis2SynapseEnvironment.java:182)
	at org.apache.synapse.core.axis2.SynapseCallbackReceiver.handleMessage(SynapseCallbackReceiver.java:444)
	at org.apache.synapse.core.axis2.SynapseCallbackReceiver.receive(SynapseCallbackReceiver.java:221)
	at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:169)
	at org.apache.synapse.transport.passthru.ClientWorker.run(ClientWorker.java:227)
	at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:173)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:895)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:918)
	at java.lang.Thread.run(Thread.java:695)
2016-05-30 00:28:57,503 [-] [PassThroughMessageProcessor-6] ERROR Axis2Sender Unexpected error sending message back
org.apache.axis2.AxisFault: Failed to submit the response
	at org.apache.synapse.transport.passthru.PassThroughHttpSender.handleException(PassThroughHttpSender.java:641)
	at org.apache.synapse.transport.passthru.PassThroughHttpSender.invoke(PassThroughHttpSender.java:312)
	at org.apache.axis2.engine.AxisEngine.send(AxisEngine.java:431)
	at org.apache.synapse.core.axis2.Axis2Sender.sendBack(Axis2Sender.java:154)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15306339" author="hiranya" created="Mon, 30 May 2016 07:36:03 +0000"  >&lt;p&gt;I&apos;m attaching the latest version of this patch.&lt;/p&gt;</comment>
                            <comment id="15306365" author="hiranya" created="Mon, 30 May 2016 07:53:32 +0000"  >&lt;p&gt;In yet another test case (also using APIs), I get the following error:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-05-30 00:46:01,707 [-] [PassThroughMessageProcessor-2] ERROR PassThroughHttpSender Failed to submit the response
org.apache.axiom.om.DeferredParsingException: javax.xml.stream.XMLStreamException: java.io.IOException: Stream closed
	at org.apache.axiom.om.impl.common.serializer.push.Serializer.serialize(Serializer.java:290)
	at org.apache.axiom.om.impl.common.AxiomSourcedElementSupport.ajc$interMethod$org_apache_axiom_om_impl_common_AxiomSourcedElementSupport$org_apache_axiom_om_impl_intf_AxiomSourcedElement$internalSerialize(AxiomSourcedElementSupport.aj:434)
	at org.apache.axiom.om.impl.llom.OMSourcedElementImpl.internalSerialize(OMSourcedElementImpl.java:1)
	at org.apache.axiom.om.impl.common.AxiomContainerSupport.ajc$interMethod$org_apache_axiom_om_impl_common_AxiomContainerSupport$org_apache_axiom_om_impl_intf_AxiomContainer$serializeAndConsume(AxiomContainerSupport.aj:319)
	at org.apache.axiom.om.impl.llom.OMElementImpl.serializeAndConsume(OMElementImpl.java:1)
	at org.apache.axis2.transport.http.ApplicationXMLFormatter.writeTo(ApplicationXMLFormatter.java:142)
	at org.apache.synapse.transport.passthru.PassThroughHttpSender.submitResponse(PassThroughHttpSender.java:553)
	at org.apache.synapse.transport.passthru.PassThroughHttpSender.invoke(PassThroughHttpSender.java:310)
	at org.apache.axis2.engine.AxisEngine.send(AxisEngine.java:431)
	at org.apache.synapse.core.axis2.Axis2Sender.sendBack(Axis2Sender.java:154)
	at org.apache.synapse.core.axis2.Axis2SynapseEnvironment.send(Axis2SynapseEnvironment.java:275)
	at org.apache.synapse.mediators.builtin.SendMediator.mediate(SendMediator.java:84)
	at org.apache.synapse.mediators.AbstractListMediator.mediate(AbstractListMediator.java:68)
	at org.apache.synapse.mediators.base.SequenceMediator.mediate(SequenceMediator.java:114)
	at org.apache.synapse.rest.Resource.process(Resource.java:298)
	at org.apache.synapse.rest.API.process(API.java:301)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is likely because trying to serialize the same envelope twice &amp;#8211; once for content length calculation, and once for actual response send.&lt;/p&gt;</comment>
                            <comment id="15306380" author="hiranya" created="Mon, 30 May 2016 08:06:30 +0000"  >&lt;p&gt;Ok, a couple of things:&lt;/p&gt;

&lt;p&gt;1. The first issue (with serializing addressing headers) seems to be an invalid case. The APIs don&apos;t have addressing support. If I send the request with no addressing headers, the scenario works fine.&lt;/p&gt;

&lt;p&gt;2. The second issue can be fixed by serializing the message with preserve=true the first time. However, I don&apos;t think this is a good way of calculating the message content length. What if the response message is very large? The right way to do this is serialize the message into an OverflowBlob (see how it&apos;s done in the request path in PassThroughHttpSender#sendRequestContent)&lt;/p&gt;

&lt;p&gt;Can you please revise this patch accordingly?&lt;/p&gt;</comment>
                            <comment id="15306411" author="hiranya" created="Mon, 30 May 2016 08:53:12 +0000"  >&lt;p&gt;Also take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1028&quot; title=&quot;Possible Bugs in Code for Handling Content Length Encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1028&quot;&gt;&lt;del&gt;SYNAPSE-1028&lt;/del&gt;&lt;/a&gt; and the patch provided there&lt;/p&gt;</comment>
                            <comment id="15306412" author="vanji@wso2.com" created="Mon, 30 May 2016 08:57:58 +0000"  >&lt;p&gt;1) Thought of using the OverflowBlob, but is deprecated&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;.  I will try with OverflowableBlob.&lt;br/&gt;
2) Did you mean formatter.writeTo(responseMsgContext, format, _out, true); marking the formatter write with preserved ?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;https://ws.apache.org/axiom/axiom-compat/apidocs/org/apache/axiom/util/blob/OverflowBlob.html&lt;/p&gt;</comment>
                            <comment id="15306413" author="vanji@wso2.com" created="Mon, 30 May 2016 08:59:52 +0000"  >&lt;p&gt;Okay, you have used OverflowableBlob. Great.&lt;/p&gt;</comment>
                            <comment id="15306415" author="hiranya" created="Mon, 30 May 2016 09:02:47 +0000"  >&lt;p&gt;Yes, setting that last boolean argument to true fixes the issue. But a better solution is to probably handle this using OverflowableBlob.&lt;/p&gt;</comment>
                            <comment id="15306847" author="veithen" created="Mon, 30 May 2016 17:51:14 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    private long getStreamLength(MessageContext msgContext) throws IOException {
+
+        OverflowableBlob serialized = Blobs.createOverflowableBlob(4096, &quot;http-nio_&quot;,
+                &quot;.dat&quot;, FileUtils.getTempDirectory());
+        OutputStream out = serialized.getOutputStream();
+        try {
+            MessageProcessorSelector.getMessageFormatter(msgContext).
+                    writeTo(msgContext, PassThroughTransportUtils.getOMOutputFormat(msgContext), out, true);
+        } finally {
+            out.close();
+        }
+        return serialized.getSize();
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That doesn&apos;t make sense. You don&apos;t need to create a Blob if you never read the content afterwards. Just write the content to a CountingOuputStream chained to a NullOutputStream. Or alternatively, follow Hiranya&apos;s suggestion, serialize the content with preserve=false, and then use the content of the blob later to write the message to the transport.&lt;/p&gt;</comment>
                            <comment id="15306960" author="vanji@wso2.com" created="Mon, 30 May 2016 21:25:52 +0000"  >&lt;p&gt;Thanks for the feedback, I will work on the suggestion you made to improve the patch.&lt;/p&gt;</comment>
                            <comment id="15307052" author="hiranya" created="Tue, 31 May 2016 00:59:42 +0000"  >&lt;p&gt;I think you can set the OverflowableBlob as a property on the message context, and use that in the PassThroughHttpSender to write the payload out. A similar method has been used in the old NHTTP transport to handle DISABLE_CHUNKING property in the request path.&lt;/p&gt;</comment>
                            <comment id="15307167" author="vanji@wso2.com" created="Tue, 31 May 2016 04:12:44 +0000"  >&lt;p&gt;I have incorporated the suggestion made by andreas, and created two sub-task that has the test cases for proxy and API. &lt;/p&gt;</comment>
                            <comment id="15309196" author="vanji@wso2.com" created="Wed, 1 Jun 2016 03:46:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hiranya&quot; class=&quot;user-hover&quot; rel=&quot;hiranya&quot;&gt;hiranya&lt;/a&gt;, I have tried with your suggestion and it worked well &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
I have attached the patch + test case on &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1029&quot; title=&quot;Test case for DISABLE_CHUNKING for proxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1029&quot;&gt;&lt;del&gt;SYNAPSE-1029&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1030&quot; title=&quot;Test case for DISABLE_CHUNKING for API&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1030&quot;&gt;&lt;del&gt;SYNAPSE-1030&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15322041" author="hiranya" created="Thu, 9 Jun 2016 06:59:45 +0000"  >&lt;p&gt;Patch applied with a minor modification.&lt;/p&gt;</comment>
                            <comment id="15322113" author="hudson" created="Thu, 9 Jun 2016 07:56:15 +0000"  >&lt;p&gt;SUCCESS: Integrated in Synapse - Trunk #5272 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/5272/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/5272/&lt;/a&gt;)&lt;br/&gt;
Supporting the DISABLE_CHUNKING property in the response path of HTTP message mediation; Applied patches from &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1023&quot; title=&quot;DISABLE_CHUNKING property is not honored in the response path of PT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1023&quot;&gt;&lt;del&gt;SYNAPSE-1023&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1029&quot; title=&quot;Test case for DISABLE_CHUNKING for proxy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1029&quot;&gt;&lt;del&gt;SYNAPSE-1029&lt;/del&gt;&lt;/a&gt; (hiranya: rev 1747502)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;java/modules/integration/src/test/java/org/apache/synapse/samples/framework/TestSamplesHandlerSuite.java&lt;/li&gt;
	&lt;li&gt;java/modules/integration/src/test/java/org/apache/synapse/samples/framework/tests/proxy/Sample160.java&lt;/li&gt;
	&lt;li&gt;java/modules/integration/src/test/java/org/apache/synapse/samples/framework/tests/proxy/Sample161.java&lt;/li&gt;
	&lt;li&gt;java/modules/integration/src/test/resources/extras/synapse_sample_160.xml&lt;/li&gt;
	&lt;li&gt;java/modules/integration/src/test/resources/sample160.xml&lt;/li&gt;
	&lt;li&gt;java/modules/transports/core/nhttp/src/main/java/org/apache/synapse/transport/passthru/PassThroughHttpSender.java&lt;/li&gt;
	&lt;li&gt;java/modules/transports/core/nhttp/src/main/java/org/apache/synapse/transport/passthru/SourceResponse.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12806937" name="SYNAPSE-1023-updated.diff" size="4363" author="hiranya" created="Mon, 30 May 2016 07:36:03 +0000"/>
                            <attachment id="12806920" name="SYNAPSE-1023.diff" size="4161" author="vanjikumaran@gmail.com" created="Mon, 30 May 2016 05:52:52 +0000"/>
                            <attachment id="12807034" name="SYNAPSE-1023_CountingOutputStream.diff" size="4797" author="vanjikumaran@gmail.com" created="Tue, 31 May 2016 04:12:44 +0000"/>
                            <attachment id="12807318" name="SYNAPSE-1023_Serialized_Bytes.diff" size="6584" author="vanjikumaran@gmail.com" created="Wed, 1 Jun 2016 03:46:03 +0000"/>
                            <attachment id="12806997" name="SYNAPSE-1023_withOverflowableBlob.diff" size="5290" author="vanjikumaran@gmail.com" created="Mon, 30 May 2016 17:34:04 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12974059">SYNAPSE-1029</subtask>
                            <subtask id="12974101">SYNAPSE-1030</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ynmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>