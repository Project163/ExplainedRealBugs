<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:08:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-662] ClientWorker overriding character encoding</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-662</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;The following code exists in the org.apache.synapse.transport.nhttp.ClientWorker class&apos; run() method:&lt;/p&gt;

&lt;p&gt;                responseMsgCtx.setProperty(&lt;br/&gt;
                    Constants.Configuration.CHARACTER_SET_ENCODING,&lt;br/&gt;
                    contentType.indexOf(HTTP.CHARSET_PARAM) &amp;gt; 0 ?&lt;br/&gt;
                        charSetEnc : MessageContext.DEFAULT_CHAR_SET_ENCODING);&lt;/p&gt;

&lt;p&gt;This fails however for the following Content-Type HTTP header:&lt;br/&gt;
  application/soap+xml; action=&quot;urn:echoResponse&quot;;charset=UTF-16&lt;/p&gt;

&lt;p&gt;BuilderUtil.getCharSetEncoding(contentType) is called a few lines up and correctly extracts the UTF-16 character set value, but then overrides this and sets it to UTF-8. It does this because the value of org.apache.http.protocol.HTTP.CHARSET_PARAM is &quot;; charset=&quot;. That is, it&apos;s failing because the response does not have a space between the charset parameter and the previous parameter.&lt;/p&gt;

&lt;p&gt;Reading through the HTTP specs, I haven&apos;t come across anything that says either that whitespace is permissible or not permissible here. In my view the code should therfore be flexible enough to handle either case. &lt;/p&gt;

&lt;p&gt;I would suggest simpifying the code to:&lt;/p&gt;

&lt;p&gt;     responseMsgCtx.setProperty(Constants.Configuration.CHARACTER_SET_ENCODING, charSetEnc);&lt;/p&gt;

&lt;p&gt;as the BuilderUtil.getCharSetEncoding() code above the offending code seems to be sufficient at first glance.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466594">SYNAPSE-662</key>
            <summary>ClientWorker overriding character encoding</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hiranya">Hiranya Kasub Jayathilaka</assignee>
                                    <reporter username="miielz">Myles Bunbury</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jun 2010 18:59:42 +0000</created>
                <updated>Mon, 20 Sep 2010 05:34:22 +0000</updated>
                            <resolved>Mon, 20 Sep 2010 05:34:22 +0000</resolved>
                                    <version>1.2</version>
                                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12877170" author="miielz" created="Wed, 9 Jun 2010 19:02:15 +0000"  >&lt;p&gt;It&apos;s worth noting that ServerWorker doesn&apos;t bother with any use of the HTTP.CHARSET_PARAM constant and isn&apos;t affected by this issue. ServerWorker relies exclusively on BuilderUtil.getCharSetEncoding(contentType). I don&apos;t see a reason why ServerWorker &amp;amp; ClientWorker should be different in this regard.&lt;/p&gt;</comment>
                            <comment id="12883414" author="heshan" created="Tue, 29 Jun 2010 05:28:48 +0000"  >&lt;p&gt;I am looking into this issue. &lt;/p&gt;

&lt;p&gt;Heshan.&lt;/p&gt;</comment>
                            <comment id="12883516" author="heshan" created="Tue, 29 Jun 2010 11:40:00 +0000"  >&lt;p&gt;Hi, &lt;br/&gt;
  I went through the HTTP 1.0&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; and HTTP 1.1&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; specifications. It does not say whether to have a space between &quot;;&quot; and &quot;charset&quot; or not. Therefore we should support both the cases (where there is a space or no-space). I could not think of a reason why the ClientWorker uses following condition to set the CHARACTER_SET_ENCODING property. &lt;/p&gt;

&lt;p&gt; responseMsgCtx.setProperty(Constants.Configuration.CHARACTER_SET_ENCODING, contentType.indexOf(HTTP.CHARSET_PARAM) &amp;gt; 0 ? charSetEnc : MessageContext.DEFAULT_CHAR_SET_ENCODING);&lt;/p&gt;

&lt;p&gt;Furthermore, the ServerWorker does not follow this approach and straight away retrieves the CharSetEncoding and sets is as a property in the MessageContext. &lt;/p&gt;

&lt;p&gt; String charSetEncoding = BuilderUtil.getCharSetEncoding(contentTypeStr);&lt;br/&gt;
 msgContext.setProperty(Constants.Configuration.CHARACTER_SET_ENCODING, charSetEncoding);&lt;/p&gt;

&lt;p&gt;Attaching the patch herewith. &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; - &lt;a href=&quot;http://www.w3.org/Protocols/HTTP/1.0/spec.html#Content-Type&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/Protocols/HTTP/1.0/spec.html#Content-Type&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; - &lt;a href=&quot;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.17&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/Protocols/rfc2616/rfc2616-sec14.html#sec14.17&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12888696" author="heshan" created="Thu, 15 Jul 2010 04:43:38 +0000"  >&lt;p&gt;Hi Myles,&lt;br/&gt;
             Do you use UTF-16 encoding with Synapse-1.2 or have you used UTF-16 message to prove your point?&lt;/p&gt;</comment>
                            <comment id="12888785" author="miielz" created="Thu, 15 Jul 2010 12:17:37 +0000"  >&lt;p&gt;UTF-16 is used with Synapse 1.2, though UTF-8 is more common at this point.&lt;/p&gt;</comment>
                            <comment id="12890226" author="heshan" created="Tue, 20 Jul 2010 09:58:08 +0000"  >&lt;p&gt;The reason for asking the above question was that when verifying this patch (for Synapse 1.2) with a UTF-16 message we came across another issue. It is reported here &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;. &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;  - &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-670&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/SYNAPSE-670&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12890228" author="heshan" created="Tue, 20 Jul 2010 10:08:05 +0000"  >&lt;p&gt;I checked the above mentioned issue &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-670&quot; title=&quot;Messages with UTF-16 encoding fails on Synapse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-670&quot;&gt;&lt;del&gt;SYNAPSE-670&lt;/del&gt;&lt;/a&gt;, against a build from the Synapse trunk and it seems that it is fixed in the trunk. Therefore, this issue can be closed after applying the attached patch. &lt;/p&gt;</comment>
                            <comment id="12912361" author="hiranya" created="Mon, 20 Sep 2010 05:34:22 +0000"  >&lt;p&gt;Checked in the patch to the trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12448305" name="SYNAPSE-662-patch.txt" size="924" author="heshan" created="Tue, 29 Jun 2010 11:40:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183882</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i11gbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216609</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>