<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:08:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-540] A race condition between Axis2HttpRequest and ClientHandler nhttp transport classes causes unreliable message delivery</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-540</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;Environment&lt;br/&gt;
1. Service &quot;Version&quot; from the axis2.war taken from the 1.4.1 release deployed in Tomcat 6.0.18.&lt;br/&gt;
2. Proxy service configured in the Synapse 1.2 release.&lt;br/&gt;
3. Client implemented using .NET 3.5 WCF.&lt;/p&gt;

&lt;p&gt;Symptoms&lt;br/&gt;
From time to time the client invoking a method of the &quot;Version&quot; service hangs until the timeout occurs.&lt;/p&gt;

&lt;p&gt;Analysis&lt;br/&gt;
When a request arriving at the proxy service in Synapse is transmitted over the nhttp transport a race condition occurs between a thread executing the Axis2HttpRequest.streamMessageContents method and a thread executing the ClientHandler.responseReceived method. After HTTP headers are transmitted to Tomcat the server replies with the &quot;100 Continue&quot; message. This response is handled by the ClientHandler.responseReceived method, which (regardless of the status code) sets the &quot;completed&quot; flag of the handled request to &quot;true&quot;. If this happens before the Axis2HttpRequest.streamMessageContents method in the sending thread&lt;br/&gt;
actually sends the request, the server never gets it. It waits until a timeout occurs and sends the &quot;500 Internal Server Error&quot; message. This causes the proxy in Synapse to wait until the keep-alive connection is closed and reply with a fault.&lt;/p&gt;

&lt;p&gt;I provide the .NET based client for testing purposes (calling the proxy service from an Axis2 based client causes the problem to appear much less frequently).&lt;/p&gt;

&lt;p&gt;I attach the trace log from Synapse 1.2 (built from the 662321 revision of the ClientHandler.java) and from WSO2 ESB 2.0.2 (which is based on a build of Synapse including the slightly modified 708800 revision of the ClientHandler.java).&lt;/p&gt;

&lt;p&gt;I also suggest patches for the 662321 revision and for the so far latest revision in the trunk - 761507.&lt;/p&gt;

&lt;p&gt;This problem applies to the 1.2 release and to the trunk version.&lt;/p&gt;</description>
                <environment>Seen on: Windows XP, Windows Vista, Sun Java 5 update 18, Sun Java 6 update 13, .NET framework 3.5, Tomcat 6.0.18</environment>
        <key id="12424286">SYNAPSE-540</key>
            <summary>A race condition between Axis2HttpRequest and ClientHandler nhttp transport classes causes unreliable message delivery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="asankha">Asankha Chamath Perera</assignee>
                                    <reporter username="j.balut">Jaros&#322;aw Ba&#322;ut</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Apr 2009 11:40:26 +0000</created>
                <updated>Mon, 4 May 2009 12:10:09 +0000</updated>
                            <resolved>Mon, 4 May 2009 12:10:09 +0000</resolved>
                                    <version>1.2</version>
                    <version>NIGHTLY</version>
                                    <fixVersion>2.0</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="14400">4h</timeoriginalestimate>
                            <timeestimate seconds="14400">4h</timeestimate>
                                        <comments>
                            <comment id="12704591" author="j.balut" created="Thu, 30 Apr 2009 11:42:07 +0000"  >&lt;p&gt;.NET based client of the Axis2 Version service&lt;/p&gt;</comment>
                            <comment id="12704592" author="j.balut" created="Thu, 30 Apr 2009 11:43:37 +0000"  >&lt;p&gt;Log files of Synapse versions based on marked revisions of ClientHandler.java file.&lt;/p&gt;</comment>
                            <comment id="12704595" author="j.balut" created="Thu, 30 Apr 2009 11:47:53 +0000"  >&lt;p&gt;Proposed patches for respective revisions of the ClientHandler.java file.&lt;/p&gt;</comment>
                            <comment id="12704601" author="j.balut" created="Thu, 30 Apr 2009 12:06:54 +0000"  >&lt;p&gt;Proxy service configuration&lt;/p&gt;</comment>
                            <comment id="12705572" author="asankha" created="Mon, 4 May 2009 12:10:09 +0000"  >&lt;p&gt;Thanks Jaros&#322;aw for the patch. I&apos;ve slightly updated it since the codebase has changed since you&apos;ve done the modifications, please check and let me know if the tests pass, as I do not have a .net environment around to test the common 100 continue.&lt;/p&gt;

&lt;p&gt;PS: There will be a nightly build (build # &amp;gt; 643) at &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/Synapse%20-%20Trunk/lastStableBuild/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://hudson.zones.apache.org/hudson/job/Synapse%20-%20Trunk/lastStableBuild/&lt;/a&gt; soon, along with this fix if you require&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12406909" name="client.zip" size="5238" author="j.balut" created="Thu, 30 Apr 2009 11:42:07 +0000"/>
                            <attachment id="12406913" name="patch-662321.txt" size="707" author="j.balut" created="Thu, 30 Apr 2009 11:47:53 +0000"/>
                            <attachment id="12406914" name="patch-761507.txt" size="1041" author="j.balut" created="Thu, 30 Apr 2009 11:47:53 +0000"/>
                            <attachment id="12406910" name="revision-662321.log" size="8409" author="j.balut" created="Thu, 30 Apr 2009 11:43:37 +0000"/>
                            <attachment id="12406911" name="revision-708800.log" size="7508" author="j.balut" created="Thu, 30 Apr 2009 11:43:37 +0000"/>
                            <attachment id="12406916" name="synapse.xml" size="1804" author="j.balut" created="Thu, 30 Apr 2009 12:06:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183762</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 30 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i11fmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216499</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>