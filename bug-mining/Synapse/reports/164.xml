<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:07:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-451] Selection Mediators don&apos;t carry initialization through all branches</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-451</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;See also: JIRAs &amp;lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-437&quot;&amp;gt;Apache &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-437&quot; title=&quot;Initialize Inline Fault Sequences for Proxy Targets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-437&quot;&gt;&lt;del&gt;SYNAPSE-437&lt;/del&gt;&lt;/a&gt;&amp;lt;/a&amp;gt;, &amp;lt;a href=&quot;https://wso2.org/jira/browse/ESBJAVA-422&quot;&amp;gt;WSO2 ESBJAVA-422&amp;lt;/a&amp;gt;&lt;/p&gt;

&lt;p&gt;Thus far, this mostly appears to be an issue with CalloutMediator, because it&apos;s mediate method depends upon init() having been run to setup the ServiceClient.&lt;/p&gt;

&lt;p&gt;A FilterMediator extends AbstractListMediator, but for the else branch, uses a ListMediator.&lt;/p&gt;

&lt;p&gt;When synapse initializes inline sequences as part of SynapseConfiguration, the init method of SequenceMediator is called.  This in turn calls init of its superclass, which is AbstractListMediator.  In that class, all child mediators that are instances of ManagedLifecycle are in turn initialized.&lt;/p&gt;

&lt;p&gt;For the FilterMediator, the &apos;then&apos; branch, as an AbstractListMediator being an instance of ManagedLifecycle is initialized at startup.  However, the &apos;else&apos; branch, being declared as a ListMediator, will not be.  Thus, it appears as though any mediator requiring initialization inside of the Filter else branch will fail (NullPointerException) when it is referenced.&lt;/p&gt;

&lt;p&gt;The workaround is to use named sequences wherever possible, and reference that instead, as the &apos;else&apos; branch of a FilterMediator can alternatively use an elseKey.&lt;/p&gt;

&lt;p&gt;However, this workaround appears to have limits when it comes to the SwitchMediator.  Inline sequences are handled inside of SwitchCase as an AnonymousListMediator and like the FilterMediator, aren&apos;t initialized by top level in/out inline target sequences.  Since SwitchMediators don&apos;t have the option of referencing a registry key for a named sequence initialized at startup, I believe this breaks the ability to run certain child mediators that require initialization of objects that only occur when init is called.&lt;/p&gt;

&lt;p&gt;For example, this cannot work because the inline sequence is not initialized&lt;br/&gt;
&amp;lt;switch&amp;gt;&lt;br/&gt;
  &amp;lt;case&amp;gt;&lt;br/&gt;
    &amp;lt;callout&amp;gt;...&amp;lt;/callout&amp;gt;&lt;br/&gt;
  &amp;lt;/case&amp;gt;&lt;br/&gt;
&amp;lt;/switch&amp;gt;&lt;/p&gt;

&lt;p&gt;For filters, this cannot work because inline sequences are not initialized&lt;br/&gt;
&amp;lt;filter&amp;gt;&lt;br/&gt;
  &amp;lt;then&amp;gt;..&amp;lt;/then&amp;gt;&lt;br/&gt;
  &amp;lt;else&amp;gt;&lt;br/&gt;
    &amp;lt;callout&amp;gt;&lt;br/&gt;
  &amp;lt;/else&amp;gt;&lt;br/&gt;
&amp;lt;/filter&amp;gt;&lt;/p&gt;

&lt;p&gt;But this can&lt;br/&gt;
&amp;lt;filter&amp;gt;&lt;br/&gt;
  &amp;lt;callout&amp;gt;&lt;br/&gt;
&amp;lt;/filter&amp;gt;&lt;/p&gt;

&lt;p&gt;as can this&lt;br/&gt;
&amp;lt;filter&amp;gt;&lt;br/&gt;
  &amp;lt;then&amp;gt;&lt;br/&gt;
    &amp;lt;callout&amp;gt;&lt;br/&gt;
  &amp;lt;/then&amp;gt;&lt;br/&gt;
&amp;lt;/filter&amp;gt;&lt;/p&gt;

&lt;p&gt;and this&lt;br/&gt;
&amp;lt;sequence name=&quot;namedsequence&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;callout&amp;gt;&lt;br/&gt;
&amp;lt;/sequence&amp;gt;&lt;br/&gt;
&amp;lt;filter&amp;gt;&lt;br/&gt;
  &amp;lt;then&amp;gt;..&amp;lt;/then&amp;gt;&lt;br/&gt;
  &amp;lt;else sequence=&quot;namedsequence&quot;&amp;gt;&lt;br/&gt;
&amp;lt;/filter&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12404544">SYNAPSE-451</key>
            <summary>Selection Mediators don&apos;t carry initialization through all branches</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="veithen">Andreas Veithen-Knowles</assignee>
                                    <reporter username="kreveksa">Lucas Moten</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Sep 2008 14:12:36 +0000</created>
                <updated>Sat, 20 Sep 2008 23:22:54 +0000</updated>
                            <resolved>Sat, 20 Sep 2008 23:22:54 +0000</resolved>
                                                    <fixVersion>2.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12631901" author="kreveksa" created="Wed, 17 Sep 2008 19:43:05 +0000"  >&lt;p&gt;The following mediators contain inline sequences that are not initialized:&lt;/p&gt;

&lt;p&gt;core/org.apache.synapse.config.mediators.builtin.CacheMediator&lt;br/&gt;
core/org.apache.synapse.config.mediators.ejp.aggregator.AggregateMediator&lt;br/&gt;
core/org.apache.synapse.config.mediators.filters.FilterMediator (only true branch is initialized)&lt;br/&gt;
core/org.apache.synapse.config.mediators.filters.SwitchMediator (does not support named sequences, no workaround)&lt;br/&gt;
extensions/org.apache.synapse.config.mediators.throttle.ThrottleMediator&lt;/p&gt;

&lt;p&gt;With exception to FilterMediator, each of these extends AbstractMediator.  Notes above explain what works and doesn&apos;t for mediators in the true/false branches of FilterMediator.&lt;/p&gt;

&lt;p&gt;Mediators that are nested within the sequences of these 5 mediators can fail if they require initialization.  This includes CalloutMediator, in some cases ClassMediator (if its ManagedLifeCycle), and presumably SpringMediator.&lt;/p&gt;

&lt;p&gt;If a mediator is not an instance of ManagedLifecycle, but allows for sequences, then each mediator of each sequence should be checked to determine whether it needs initialization.  The init logic in AbstractListMediator is essentially what needs to be replicated in the five classes above, and any others later on supporting sequences.&lt;/p&gt;</comment>
                            <comment id="12631903" author="veithen" created="Wed, 17 Sep 2008 20:03:02 +0000"  >&lt;p&gt;I fixed FilterMediator. I will to the others later.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183674</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i11as7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>