<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:09:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-1041] xml string set in the Script mediator is not honored as OM in Fault mediator </title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-1041</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;Sample 5 with with custom error message generated via Script mediator does not produce the proper xml as the fault response in fault mediator.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Synapse Configuration&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;definitions xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ws.apache.org/ns/synapse&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;
&amp;lt;localEntry key=&lt;span class=&quot;code-quote&quot;&gt;&quot;FaultMessageScript&quot;&lt;/span&gt;
                src=&lt;span class=&quot;code-quote&quot;&gt;&quot;file:repository/conf/sample/resources/script/CustomErrorMessageScript.js&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;sequence name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myFaultHandler&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;customErrorCode&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;2016&quot;&lt;/span&gt; scope=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;STRING&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;customErrorText&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;This is Bug&quot;&lt;/span&gt; scope=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;STRING&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;customTime&quot;&lt;/span&gt; expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;SYSTEM_DATE&apos;&lt;/span&gt;)&quot;&lt;/span&gt; scope=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;STRING&quot;&lt;/span&gt;/&amp;gt;   
       &amp;lt;script language=&lt;span class=&quot;code-quote&quot;&gt;&quot;js&quot;&lt;/span&gt; key=&lt;span class=&quot;code-quote&quot;&gt;&quot;FaultMessageScript&quot;&lt;/span&gt; function=&lt;span class=&quot;code-quote&quot;&gt;&quot;transformFault&quot;&lt;/span&gt;/&amp;gt;
       &amp;lt;log level=&lt;span class=&quot;code-quote&quot;&gt;&quot;custom&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;**************Custom Detail*****************&quot;&lt;/span&gt; expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;customErrorDetail&apos;&lt;/span&gt;)&quot;&lt;/span&gt; /&amp;gt;
       &amp;lt;/log&amp;gt;
       &amp;lt;makefault version=&lt;span class=&quot;code-quote&quot;&gt;&quot;soap11&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;code xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;tns:Receiver&quot;&lt;/span&gt; /&amp;gt;
&lt;/span&gt;            &amp;lt;reason expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR_MESSAGE&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;detail expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;customErrorDetail&apos;&lt;/span&gt;)&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;OM&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/makefault&amp;gt;
        &amp;lt;send/&amp;gt;
    &amp;lt;/sequence&amp;gt;
    &amp;lt;sequence name=&lt;span class=&quot;code-quote&quot;&gt;&quot;fault&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;log level=&lt;span class=&quot;code-quote&quot;&gt;&quot;full&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;MESSAGE&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Executing &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; fault sequence&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR_CODE&quot;&lt;/span&gt; expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR_CODE&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;ERROR_MESSAGE&quot;&lt;/span&gt; expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR_MESSAGE&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/log&amp;gt;
        &amp;lt;drop/&amp;gt;
    &amp;lt;/sequence&amp;gt;
    &amp;lt;sequence name=&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; onError=&lt;span class=&quot;code-quote&quot;&gt;&quot;myFaultHandler&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;in&amp;gt;
            &amp;lt;log level=&lt;span class=&quot;code-quote&quot;&gt;&quot;full&quot;&lt;/span&gt;/&amp;gt;
            &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; xmlns:m0=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//services.samples&quot;&lt;/span&gt; source=&lt;span class=&quot;code-quote&quot;&gt;&quot;//m0:getQuote/m0:request/m0:symbol&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;                &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;MSFT&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;send&amp;gt;
                        &amp;lt;endpoint name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testEndpoint1&quot;&lt;/span&gt;&amp;gt;
                            &amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//bogus:9000/services/NonExistentStockQuoteService&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;                        &amp;lt;/endpoint&amp;gt;
                    &amp;lt;/send&amp;gt;
                &amp;lt;/&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;&amp;gt;
                &amp;lt;&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; regex=&lt;span class=&quot;code-quote&quot;&gt;&quot;SUN&quot;&lt;/span&gt;&amp;gt;
                    &amp;lt;send&amp;gt;
                        &amp;lt;endpoint name=&lt;span class=&quot;code-quote&quot;&gt;&quot;testEndpoint2&quot;&lt;/span&gt;&amp;gt;
                            &amp;lt;address uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//localhost:9009/services/NonExistentStockQuoteService&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;                        &amp;lt;/endpoint&amp;gt;
                    &amp;lt;/send&amp;gt;
                &amp;lt;/&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;&amp;gt;
            &amp;lt;/&lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt;&amp;gt;
            &amp;lt;drop/&amp;gt;
        &amp;lt;/in&amp;gt;
        &amp;lt;out&amp;gt;
            &amp;lt;send/&amp;gt;
        &amp;lt;/out&amp;gt;
    &amp;lt;/sequence&amp;gt;
&amp;lt;/definitions&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Script&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;function transformFault(mc) {
     &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; symbol = mc.getPayloadXML()..*::Code.toString();
     &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; errorCode = mc.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;customErrorCode&quot;&lt;/span&gt;);
     &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; errorText = mc.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;customErrorText&quot;&lt;/span&gt;);
     &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; time = mc.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&apos;customTime&apos;&lt;/span&gt;);
     mc.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;customErrorDetail&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;CustomErrorDetails&amp;gt;&amp;lt;TimeStamp&amp;gt;&quot;&lt;/span&gt;+time+&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;/TimeStamp&amp;gt;&amp;lt;ErrorCode&amp;gt;&quot;&lt;/span&gt;+errorCode+&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;/ErrorCode&amp;gt;&amp;lt;ErrorText&amp;gt;&quot;&lt;/span&gt;+errorText+&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;/ErrorText&amp;gt;&amp;lt;/CustomErrorDetails&amp;gt;&quot;&lt;/span&gt;);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;&lt;b&gt;Client Request&lt;/b&gt; &lt;br/&gt;
Same request as in sample 5&lt;br/&gt;
&lt;tt&gt;ant stockquote -Daddurl=&lt;a href=&quot;http://localhost:9000/services/SimpleStockQuoteService&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:9000/services/SimpleStockQuoteService&lt;/a&gt; -Dtrpurl=&lt;a href=&quot;http://localhost:8281/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8281/&lt;/a&gt; -Dsymbol=SUN&lt;/tt&gt;&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Response resiveed and monitored via tcpmon&lt;/b&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &amp;lt;soapenv:Fault&amp;gt;
            &amp;lt;faultcode xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;tns:Receiver&amp;lt;/faultcode&amp;gt;
&lt;/span&gt;            &amp;lt;faultstring&amp;gt;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; connecting to the endpoint (Connection Failed)&amp;lt;/faultstring&amp;gt;
            &amp;lt;detail&amp;gt;&amp;amp;lt;CustomErrorDetails&amp;amp;gt;&amp;amp;lt;TimeStamp&amp;amp;gt;6/7/16 12:36 AM&amp;amp;lt;/TimeStamp&amp;amp;gt;&amp;amp;lt;ErrorCode&amp;amp;gt;2016&amp;amp;lt;/ErrorCode&amp;amp;gt;&amp;amp;lt;ErrorText&amp;amp;gt;This is Bug &amp;amp;lt;/ErrorText&amp;amp;gt;&amp;amp;lt;/CustomErrorDetails&amp;amp;gt;&amp;lt;/detail&amp;gt;
 &amp;lt;/soapenv:Fault&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;However,expected results is &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &amp;lt;soapenv:Fault&amp;gt;
            &amp;lt;faultcode xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;tns:Receiver&amp;lt;/faultcode&amp;gt;
&lt;/span&gt;            &amp;lt;faultstring&amp;gt;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; connecting to the endpoint (Connection Failed)&amp;lt;/faultstring&amp;gt;
            &amp;lt;detail&amp;gt;
                &amp;lt;CustomErrorDetails&amp;gt;
                    &amp;lt;TimeStamp&amp;gt;6/7/16 12:09 AM&amp;lt;/TimeStamp&amp;gt;
                    &amp;lt;ErrorCode&amp;gt;2016&amp;lt;/ErrorCode&amp;gt;
                    &amp;lt;ErrorText&amp;gt;This is Bug&amp;lt;/ErrorText&amp;gt;
                &amp;lt;/CustomErrorDetails&amp;gt;
            &amp;lt;/detail&amp;gt;
        &amp;lt;/soapenv:Fault&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12976508">SYNAPSE-1041</key>
            <summary>xml string set in the Script mediator is not honored as OM in Fault mediator </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hiranya">Hiranya Kasub Jayathilaka</assignee>
                                    <reporter username="vanjikumaran@gmail.com">Vanjikumaran Sivajothy</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jun 2016 16:28:01 +0000</created>
                <updated>Fri, 8 Jul 2016 20:56:43 +0000</updated>
                            <resolved>Fri, 8 Jul 2016 20:56:42 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                                                            <comments>
                            <comment id="15318829" author="vanji@wso2.com" created="Tue, 7 Jun 2016 16:37:33 +0000"  >&lt;p&gt;After applying the patch, result.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&apos;1.0&apos;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&apos;UTF-8&apos;&lt;/span&gt;?&amp;gt;
&amp;lt;soapenv:Envelope xmlns:soapenv=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;    &amp;lt;soapenv:Header xmlns:wsa=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2005/08/addressing&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;        &amp;lt;wsa:MessageID&amp;gt;urn:uuid:2eaa8697-e6d1-4bf5-9cfc-f855828313d9&amp;lt;/wsa:MessageID&amp;gt;
        &amp;lt;wsa:Action&amp;gt;urn:getQuote&amp;lt;/wsa:Action&amp;gt;
        &amp;lt;wsa:RelatesTo&amp;gt;urn:uuid:a924f5d2-4bd7-49ec-b63a-8349f3cbdbae&amp;lt;/wsa:RelatesTo&amp;gt;
    &amp;lt;/soapenv:Header&amp;gt;
    &amp;lt;soapenv:Body&amp;gt;
        &amp;lt;soapenv:Fault&amp;gt;
            &amp;lt;faultcode xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//schemas.xmlsoap.org/soap/envelope/&quot;&lt;/span&gt;&amp;gt;tns:Receiver&amp;lt;/faultcode&amp;gt;
&lt;/span&gt;            &amp;lt;faultstring&amp;gt;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; connecting to the endpoint (Connection Failed)&amp;lt;/faultstring&amp;gt;
            &amp;lt;detail&amp;gt;
                &amp;lt;CustomErrorDetails&amp;gt;
                    &amp;lt;TimeStamp&amp;gt;6/7/16 12:50 AM&amp;lt;/TimeStamp&amp;gt;
                    &amp;lt;ErrorCode&amp;gt;2016&amp;lt;/ErrorCode&amp;gt;
                    &amp;lt;ErrorText&amp;gt;This is Bug &amp;lt;/ErrorText&amp;gt;
                &amp;lt;/CustomErrorDetails&amp;gt;
            &amp;lt;/detail&amp;gt;
        &amp;lt;/soapenv:Fault&amp;gt;
    &amp;lt;/soapenv:Body&amp;gt;
&amp;lt;/soapenv:Envelope&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15319165" author="veithen" created="Tue, 7 Jun 2016 19:16:22 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    /**
+     * if string is xml, this method will convert it as a OMElement and return back.
+     * @param text
+     * @return OMElemen
+     */
+    public static OMElement getOMFromXML(String text) {
+        int escape = StringUtils.countMatches(text, &quot;&amp;lt;!&quot;) +
+                StringUtils.countMatches(text, &quot;&amp;lt;?&quot;);
+        int numOfLTWithS = StringUtils.countMatches(text, &quot;&amp;lt;/&quot;);
+        int numOfGTWithS = StringUtils.countMatches(text, &quot;/&amp;gt;&quot;);
+        int numOfLT = StringUtils.countMatches(text, &quot;&amp;lt;&quot;) - escape;
+        //Should satisfy the conditions if an XML
+        if (numOfLT == 0 || ((numOfLTWithS * 2 + numOfGTWithS) != numOfLT)) {
+            return null;
+        }
+        try {
+            OMElement om = AXIOMUtil.stringToOM(text);
+            return om;
+        } catch (XMLStreamException ignore) {
+            return null;
+        } catch (OMException ignore) {
+            return null;
+        }
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That code looks very fragile to me, especially because it has zero test coverage. SOAP fault details can only contain elements, not text. Why do we even allow the code to produce SOAP faults that don&apos;t conform to the specs?&lt;/p&gt;</comment>
                            <comment id="15319180" author="hiranya" created="Tue, 7 Jun 2016 19:26:31 +0000"  >&lt;p&gt;I agree. Looks like the right thing to do is not allow a text string to be set as a SOAP fault detail. Also I don&apos;t see the point of all the extra validation performed in the above code. Is it trying to check whether the input string is valid XML? Doesn&apos;t AXIOMUtil.stringToOM already take care of that?&lt;/p&gt;</comment>
                            <comment id="15319377" author="vanji@wso2.com" created="Tue, 7 Jun 2016 20:52:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=veithen&quot; class=&quot;user-hover&quot; rel=&quot;veithen&quot;&gt;veithen&lt;/a&gt;&lt;br/&gt;
Correct setting the text is violating the SPEC, However currently it is possible use the property mediator or script mediator &lt;br/&gt;
and inject a text into SOAP Fault details. Therefore, I  did not change that current functionality.&lt;/p&gt;

&lt;p&gt;Example&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Synapse config&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is text error&quot;&lt;/span&gt;/&amp;gt;
 &amp;lt;makefault response=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;code xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2003/05/soap-envelope&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;tns:Receiver&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;    &amp;lt;reason expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR_MESSAGE&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;detail expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/makefault&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Response&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;soapenv:Body&amp;gt;
        &amp;lt;soapenv:Fault&amp;gt;
            &amp;lt;faultcode xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2003/05/soap-envelope&quot;&lt;/span&gt;&amp;gt;tns:Receiver&amp;lt;/faultcode&amp;gt;
&lt;/span&gt;            &amp;lt;faultstring&amp;gt;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; connecting to the endpoint (Connection Failed)&amp;lt;/faultstring&amp;gt;
            &amp;lt;detail&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is text error&amp;lt;/detail&amp;gt;
        &amp;lt;/soapenv:Fault&amp;gt;
&amp;lt;/soapenv:Body&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However What i am trying here is creating the xml in script mediator and trying to use that in the Fault mediator.&lt;br/&gt;
In the fault mediator, the data in the property set in the script mediator is string and it encodes the text as setting &amp;lt; character with &amp;amp;lt. &lt;/p&gt;

&lt;p&gt;To avoid, we should do a fix. Isn&apos;t this a valid use case?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hiranya&quot; class=&quot;user-hover&quot; rel=&quot;hiranya&quot;&gt;hiranya&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Correct AXIOMUtil.#stringToOM will convert the string and in failure it throw exception, However before get into that position, i was checking the basic xml validation.&lt;br/&gt;
Yes, i can avoid the extra validation. &lt;/p&gt;</comment>
                            <comment id="15319638" author="hiranya" created="Tue, 7 Jun 2016 22:54:54 +0000"  >&lt;p&gt;I think the makefault mediator should enforce the fact that detail cannot have text strings. If the value of the expression is a string, it can parse it into an OMElement.&lt;/p&gt;</comment>
                            <comment id="15319640" author="vanji@wso2.com" created="Tue, 7 Jun 2016 22:58:25 +0000"  >&lt;p&gt;So what will happen for the users not honoring the spec? If we make the change like that they going to fail. &lt;br/&gt;
isnt it? Is it totally okay? If yes, i can make a change according to that and reissue the patch again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15319748" author="vanji@wso2.com" created="Wed, 8 Jun 2016 00:08:00 +0000"  >&lt;p&gt;Based on the recent discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hiranya&quot; class=&quot;user-hover&quot; rel=&quot;hiranya&quot;&gt;hiranya&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=veithen&quot; class=&quot;user-hover&quot; rel=&quot;veithen&quot;&gt;veithen&lt;/a&gt;. I have created a patch that does not allow text anymore in the SOAP fault detail. If the value of the expression is a string, it will be parsed it into an OMElement. &lt;/p&gt;

&lt;p&gt;property mediator with OM&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;sequence name=&lt;span class=&quot;code-quote&quot;&gt;&quot;myFaultHandler&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt; scope=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt; type=&lt;span class=&quot;code-quote&quot;&gt;&quot;OM&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;hello xmlns=&quot;&quot;&amp;gt;World&amp;lt;/hello&amp;gt;
    &amp;lt;/property&amp;gt;
    &amp;lt;makefault response=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;code xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2003/05/soap-envelope&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;tns:Receiver&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;        &amp;lt;reason expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR_MESSAGE&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;detail expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/makefault&amp;gt;
    &amp;lt;send/&amp;gt;
&amp;lt;/sequence&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;    

&lt;p&gt;Response&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;soapenv:Fault&amp;gt;
    &amp;lt;faultcode xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2003/05/soap-envelope&quot;&lt;/span&gt;&amp;gt;tns:Receiver&amp;lt;/faultcode&amp;gt;
&lt;/span&gt;    &amp;lt;faultstring&amp;gt;Currently , Address endpoint : [ Name : endpoint_87559fe848714da5194ee676669d16c107e8a00eb79a36cb ] [ State : SUSPENDED ]&amp;lt;/faultstring&amp;gt;
    &amp;lt;detail&amp;gt;
        &amp;lt;hello&amp;gt;World&amp;lt;/hello&amp;gt;
    &amp;lt;/detail&amp;gt;
&amp;lt;/soapenv:Fault&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  

&lt;p&gt;property with text&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is text error&quot;&lt;/span&gt;/&amp;gt;
 &amp;lt;makefault response=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;code xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2003/05/soap-envelope&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;tns:Receiver&quot;&lt;/span&gt;/&amp;gt;
&lt;/span&gt;    &amp;lt;reason expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;ERROR_MESSAGE&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;detail expression=&lt;span class=&quot;code-quote&quot;&gt;&quot;get-property(&lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;)&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;/makefault&amp;gt;
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Response&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;soapenv:Body&amp;gt;
        &amp;lt;soapenv:Fault&amp;gt;
            &amp;lt;faultcode xmlns:tns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2003/05/soap-envelope&quot;&lt;/span&gt;&amp;gt;tns:Receiver&amp;lt;/faultcode&amp;gt;
&lt;/span&gt;            &amp;lt;faultstring&amp;gt;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; connecting to the endpoint (Connection Failed)&amp;lt;/faultstring&amp;gt;
            &amp;lt;detail/&amp;gt;
        &amp;lt;/soapenv:Fault&amp;gt;
&amp;lt;/soapenv:Body&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  


</comment>
                            <comment id="15321715" author="hiranya" created="Thu, 9 Jun 2016 00:40:06 +0000"  >&lt;p&gt;I&apos;ve applied the patch with some minor changes and two unit tests (r1747473)&lt;/p&gt;

&lt;p&gt;FaultMediator still allows setting strings as the fault detail, by explicitly specifying a string. This patch only fixes the case where the detail is set via an expression. Consider patching the other case too in the future.&lt;/p&gt;</comment>
                            <comment id="15321755" author="hudson" created="Thu, 9 Jun 2016 01:37:30 +0000"  >&lt;p&gt;SUCCESS: Integrated in Synapse - Trunk #5271 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/5271/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/5271/&lt;/a&gt;)&lt;br/&gt;
Preventing Strings from being set as fault detail in the FaultMediator; Applied patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1041&quot; title=&quot;xml string set in the Script mediator is not honored as OM in Fault mediator &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1041&quot;&gt;&lt;del&gt;SYNAPSE-1041&lt;/del&gt;&lt;/a&gt; with a couple of unit tests (hiranya: rev 1747473)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;java/modules/core/src/main/java/org/apache/synapse/mediators/transform/FaultMediator.java&lt;/li&gt;
	&lt;li&gt;java/modules/core/src/main/java/org/apache/synapse/util/POXUtils.java&lt;/li&gt;
	&lt;li&gt;java/modules/core/src/test/java/org/apache/synapse/mediators/transform/FaultMediatorTest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12808709" name="SYNAPSE-1041.diff" size="3866" author="vanjikumaran@gmail.com" created="Tue, 7 Jun 2016 16:36:21 +0000"/>
                            <attachment id="12808789" name="SYNAPSE-1041_NoMoreText.diff" size="3009" author="vanjikumaran@gmail.com" created="Wed, 8 Jun 2016 00:08:00 +0000"/>
                            <attachment id="12808708" name="detailTransform.js" size="441" author="vanjikumaran@gmail.com" created="Tue, 7 Jun 2016 16:33:12 +0000"/>
                            <attachment id="12808706" name="synapse_sample_2000.xml" size="3389" author="vanjikumaran@gmail.com" created="Tue, 7 Jun 2016 16:31:03 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12976619">SYNAPSE-1043</subtask>
                            <subtask id="12976752">SYNAPSE-1044</subtask>
                            <subtask id="12976753">SYNAPSE-1045</subtask>
                            <subtask id="12977071">SYNAPSE-1046</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z3lj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>