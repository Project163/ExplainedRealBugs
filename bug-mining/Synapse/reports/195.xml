<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:08:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-503] get-property function is not recognized in xquery variable expression attribute</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-503</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>
&lt;p&gt;I&apos;m transforming response of the remote service in outSequence of a proxy.&lt;br/&gt;
I&apos;m using xquery mediator. I want to change the format of the payload of the response &lt;br/&gt;
and also I want to insert a payload of the request into a first element of the response.&lt;/p&gt;

&lt;p&gt;To do that, I&apos;m storing the request A payload in a variable in inSequence and in outSequence &lt;br/&gt;
I&apos;m want to use it in XQUERY mediator while transforming the response.&lt;/p&gt;

&lt;p&gt;1. proxy: gets request A,&lt;br/&gt;
2. inSequence: stores the payload A in a property named &quot;body&quot; (it will be used in outSeqence),&lt;br/&gt;
2. inSequence: transforms request A to request B,&lt;br/&gt;
3. endpoint: sends request B to remote service,&lt;br/&gt;
4. endpoint: receives response B,&lt;br/&gt;
5. outSequence: transforms response B to response A with request A included.&lt;/p&gt;


&lt;p&gt;Here&apos;s a fragments of the synapse.xml:&lt;/p&gt;

&lt;p&gt;Storing the payload contents in the &quot;body&quot; property:&lt;br/&gt;
&amp;lt;property name=&quot;body&quot; expression=&quot;$body/child::*&lt;span class=&quot;error&quot;&gt;&amp;#91;position()=1&amp;#93;&lt;/span&gt;&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;Transforming response to other format and passing request payload as a argument:&lt;br/&gt;
&amp;lt;xquery key=&quot;response.xq&quot; trace=&quot;enable&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;variable name=&quot;payload&quot; type=&quot;ELEMENT&quot;/&amp;gt; &lt;br/&gt;
    &amp;lt;variable name=&quot;request&quot; expression=&quot;synapse:get-property(&apos;body&apos;)&quot; type=&quot;ELEMENT&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/xquery&amp;gt;&lt;/p&gt;


&lt;p&gt;On the runtime I&apos;ve got following exception:&lt;/p&gt;

&lt;p&gt;2009-02-13 20:42:07,359 &lt;span class=&quot;error&quot;&gt;&amp;#91;192.168.168.6-5MBTB3J&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HttpClientWorker-2&amp;#93;&lt;/span&gt; ERROR XQueryMediator Unable to execute the query &lt;br/&gt;
org.apache.synapse.SynapseException: Error evaluating XPath synapse:get-property(&apos;body&apos;) on message&amp;lt;?xml version=&apos;1.0&apos; encoding=&apos;utf-8&apos;?&amp;gt;&amp;lt;soapenv:Envelope xmlns:soapenv=&quot;http://schemas.xmlsoap.org/soap/envelope/&quot; xmlns:wsa=&quot;http://schemas.xmlsoap.org/ws/2004/03/addressing&quot; xmlns:kom=&quot;http://www.eurobank.pl/serwisy/paybylink/1.0/komunikaty&quot;&amp;gt;&amp;lt;soapenv:Header&amp;gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...header contents...&amp;#93;&lt;/span&gt;&amp;lt;/soapenv:Header&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;... payload contents...&amp;#93;&lt;/span&gt;&lt;br/&gt;
   &amp;lt;/soapenv:Body&amp;gt;&amp;lt;/soapenv:Envelope&amp;gt;&lt;br/&gt;
	at org.apache.synapse.mediators.xquery.MediatorCustomVariable.handleException(MediatorCustomVariable.java:165)&lt;br/&gt;
	at org.apache.synapse.mediators.xquery.MediatorCustomVariable.evaluate(MediatorCustomVariable.java:153)&lt;br/&gt;
	at org.apache.synapse.mediators.xquery.MediatorCustomVariable.evaluateValue(MediatorCustomVariable.java:93)&lt;br/&gt;
	at org.apache.synapse.mediators.xquery.XQueryMediator.performQuery(XQueryMediator.java:312)&lt;br/&gt;
	at org.apache.synapse.mediators.xquery.XQueryMediator.mediate(XQueryMediator.java:160)&lt;br/&gt;
	at org.apache.synapse.mediators.AbstractListMediator.mediate(AbstractListMediator.java:61)&lt;br/&gt;
	at org.apache.synapse.config.xml.AnonymousListMediator.mediate(AnonymousListMediator.java:30)&lt;br/&gt;
	at org.apache.synapse.config.xml.SwitchCase.mediate(SwitchCase.java:65)&lt;br/&gt;
	at org.apache.synapse.mediators.filters.SwitchMediator.mediate(SwitchMediator.java:111)&lt;br/&gt;
	at org.apache.synapse.mediators.AbstractListMediator.mediate(AbstractListMediator.java:61)&lt;br/&gt;
	at org.apache.synapse.mediators.base.SequenceMediator.mediate(SequenceMediator.java:111)&lt;br/&gt;
	at org.apache.synapse.core.axis2.Axis2SynapseEnvironment.injectMessage(Axis2SynapseEnvironment.java:140)&lt;br/&gt;
	at org.apache.synapse.core.axis2.SynapseCallbackReceiver.handleMessage(SynapseCallbackReceiver.java:312)&lt;br/&gt;
	at org.apache.synapse.core.axis2.SynapseCallbackReceiver.receive(SynapseCallbackReceiver.java:133)&lt;br/&gt;
	at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:173)&lt;br/&gt;
	at org.apache.synapse.transport.nhttp.ClientWorker.run(ClientWorker.java:210)&lt;br/&gt;
	at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:58)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
2009-02-13 20:42:07,359 &lt;span class=&quot;error&quot;&gt;&amp;#91;192.168.168.6-5MBTB3J&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HttpClientWorker-2&amp;#93;&lt;/span&gt; ERROR SynapseCallbackReceiver Synapse encountered an exception, No error handlers found - &lt;span class=&quot;error&quot;&gt;&amp;#91;Message Dropped&amp;#93;&lt;/span&gt;&lt;br/&gt;
Unable to execute the query &lt;/p&gt;

&lt;p&gt;After looking a bit at XQueryMediator code it seems it uses AXIOMXPath class instead of SynapseXPath class.&lt;br/&gt;
This seems to be a reason of the exception. &lt;/p&gt;

&lt;p&gt;I also tried to used XSLT mediator with similar parameters (see below) and the property is set correctly,&lt;br/&gt;
( XSLTMediator uses SynapseXPath class for evaluating values of properties).&lt;/p&gt;

&lt;p&gt;&amp;lt;xslt key=&quot;response.xsl&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;property name=&quot;requestBody&quot; expression=&quot;get-property(&apos;body&apos;)&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/xslt&amp;gt;&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12414774">SYNAPSE-503</key>
            <summary>get-property function is not recognized in xquery variable expression attribute</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="indika">Indika Kumara</assignee>
                                    <reporter username="michal.stochmialek">Michal Stochmialek</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Feb 2009 20:02:04 +0000</created>
                <updated>Wed, 25 Mar 2009 10:17:00 +0000</updated>
                            <resolved>Wed, 25 Mar 2009 10:17:00 +0000</resolved>
                                    <version>2.0</version>
                                    <fixVersion>2.0</fixVersion>
                                    <component>Extension Mediators</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12673469" author="asankha" created="Sat, 14 Feb 2009 05:45:38 +0000"  >&lt;p&gt;There is no implementation of a get-property(&apos;body&apos;)&lt;/p&gt;

&lt;p&gt;Did you look at Sample#390? That should show you how to achieve what you need&lt;br/&gt;
&lt;a href=&quot;http://synapse.apache.org/Synapse_Samples.html#Sample390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://synapse.apache.org/Synapse_Samples.html#Sample390&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12673475" author="michal.stochmialek" created="Sat, 14 Feb 2009 07:37:55 +0000"  >&lt;p&gt;I set &quot;body&quot; property myself in inSeqence. I&apos;ve updated description. See above.&lt;/p&gt;</comment>
                            <comment id="12673606" author="veithen" created="Sun, 15 Feb 2009 12:36:19 +0000"  >&lt;p&gt;Please note that properties can only be strings!&lt;/p&gt;</comment>
                            <comment id="12673821" author="michal.stochmialek" created="Mon, 16 Feb 2009 08:39:21 +0000"  >&lt;p&gt;Andreas,&lt;/p&gt;

&lt;p&gt;Ok. I understand. Synapse transformed the payload to a string while setting &quot;body&quot; property.&lt;/p&gt;

&lt;p&gt;I wanted to transform it to an element in a xquery script. I tried that in XSLT script without a success.&lt;br/&gt;
Therefore I wanted to try XQuery. Are you aware of other way to implement my use case?&lt;/p&gt;


&lt;p&gt;This of course doesn&apos;t change the fact, that you cannot use &quot;get-property&quot; function in a xquery&apos;s variable.&lt;br/&gt;
And you cannot pass even simple string properties to the xquery engine. &lt;/p&gt;</comment>
                            <comment id="12673825" author="indika" created="Mon, 16 Feb 2009 08:56:06 +0000"  >&lt;p&gt;I have updated the XQuery mediator to use SynapseXPath. &lt;/p&gt;

&lt;p&gt;But , I didn&apos;t check your scenario .. I will check &lt;/p&gt;</comment>
                            <comment id="12673854" author="indika" created="Mon, 16 Feb 2009 11:26:35 +0000"  >&lt;p&gt;I have tried the following&lt;/p&gt;

&lt;p&gt;&amp;lt;property name=&quot;body&quot; expression=&quot;$body/child::*&lt;span class=&quot;error&quot;&gt;&amp;#91;position()=1&amp;#93;&lt;/span&gt;&quot; /&amp;gt;&lt;br/&gt;
&amp;lt;xquery key=&quot;response.xq&quot; trace=&quot;enable&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;variable name=&quot;payload&quot; type=&quot;ELEMENT&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;variable name=&quot;request&quot; expression=&quot;synapse:get-property(&apos;body&apos;)&quot; type=&quot;ELEMENT&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/xquery&amp;gt;&lt;/p&gt;

&lt;p&gt;and for XLST mediator too , I have tried . It is now working.&lt;/p&gt;

&lt;p&gt;Take svn up &lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Indika &lt;/p&gt;</comment>
                            <comment id="12674267" author="michal.stochmialek" created="Tue, 17 Feb 2009 17:03:34 +0000"  >&lt;p&gt;Indika, &lt;/p&gt;

&lt;p&gt;Thanks very much for the fix. I&apos;ve tried the newest SVN version and it works like a charm.&lt;br/&gt;
It looks like I will be able to implement my use case. Thanks again.&lt;/p&gt;</comment>
                            <comment id="12674392" author="veithen" created="Tue, 17 Feb 2009 23:26:31 +0000"  >&lt;p&gt;Since Indika fixed the XQuery mediator to use SynapseXPath, it should be possible now to rewrite the mediation as follows:&lt;/p&gt;

&lt;p&gt;&amp;lt;xquery key=&quot;response.xq&quot; trace=&quot;enable&quot;&amp;gt; &lt;br/&gt;
    &amp;lt;variable name=&quot;payload&quot; type=&quot;ELEMENT&quot;/&amp;gt; &lt;br/&gt;
    &amp;lt;variable name=&quot;request&quot; expression=&quot;$body/child::*&lt;span class=&quot;error&quot;&gt;&amp;#91;position()=1&amp;#93;&lt;/span&gt;&quot; type=&quot;ELEMENT&quot;/&amp;gt; &lt;br/&gt;
&amp;lt;/xquery&amp;gt; &lt;/p&gt;

&lt;p&gt;That would avoid the conversion XML -&amp;gt; String -&amp;gt; XML. Can you try this out?&lt;/p&gt;</comment>
                            <comment id="12674510" author="michal.stochmialek" created="Wed, 18 Feb 2009 08:06:29 +0000"  >&lt;p&gt;The $body xpath variable contains Body element of CURRENT message (am I right?).&lt;br/&gt;
In outSeqence CURRENT message is the RESPONSE of remote service, but I need the original REQUEST.&lt;/p&gt;</comment>
                            <comment id="12674556" author="veithen" created="Wed, 18 Feb 2009 10:04:00 +0000"  >&lt;p&gt;You are right. I didn&apos;t read your description carefully and I was misled by the fact that in one of the above comments, the &amp;lt;xquery&amp;gt; mediator immediately followed &amp;lt;property&amp;gt;. This is an interesting use case and I think we should at some point introduce the capability of storing properties that are not strings.&lt;/p&gt;</comment>
                            <comment id="12674560" author="michal.stochmialek" created="Wed, 18 Feb 2009 10:15:53 +0000"  >&lt;p&gt;I agree. I&apos;m looking forward to see this capability in synapse.&lt;/p&gt;</comment>
                            <comment id="12689067" author="indika" created="Wed, 25 Mar 2009 10:16:59 +0000"  >&lt;p&gt;Mark as resolve as reported issue has been fixed and there is a separate JIRA for suggestions come from Andreas &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183726</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i11ddb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216132</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>