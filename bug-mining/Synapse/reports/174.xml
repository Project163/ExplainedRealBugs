<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:07:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-341] System unstable when HTTP response returned before request fully written</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-341</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;When using a proxy service and HTTP-NIO the following error is repeatedly generated when a remote WS returns its response before the request is fully written (i.e. when AXIOM is being used by the target service to parse the request XML and the request includes unprocessed attachment(s) or a fault occurs before fully reading the request):&lt;/p&gt;

&lt;p&gt;I/O dispatcher 12: System may be unstable: IOReactor encountered a runtime exception : null&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.synapse.transport.nhttp.ClientHandler.outputReady(ClientHandler.java:353)&lt;br/&gt;
	at org.apache.http.impl.nio.DefaultNHttpClientConnection.produceOutput(DefaultNHttpClientConnection.java:170)&lt;br/&gt;
	at org.apache.http.impl.nio.DefaultClientIOEventDispatch.outputReady(DefaultClientIOEventDispatch.java:105)&lt;br/&gt;
	at org.apache.http.impl.nio.reactor.BaseIOReactor.writable(BaseIOReactor.java:114)&lt;br/&gt;
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvent(AbstractIOReactor.java:198)&lt;br/&gt;
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.processEvents(AbstractIOReactor.java:180)&lt;br/&gt;
	at org.apache.http.impl.nio.reactor.AbstractIOReactor.execute(AbstractIOReactor.java:142)&lt;br/&gt;
	at org.apache.http.impl.nio.reactor.BaseIOReactor.execute(BaseIOReactor.java:70)&lt;br/&gt;
	at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor$Worker.run(AbstractMultiworkerIOReactor.java:318)&lt;br/&gt;
	at java.lang.Thread.run(Unknown Source)&lt;/p&gt;

&lt;p&gt;The actual cause is the ConnectionPool &apos;cleanConnectionReferences()&apos; method, which clears the REQUEST_SOURCE_BUFFER upon completion of the response HTTP decoding, rather than on completion of both the request AND response processing.&lt;/p&gt;</description>
                <environment>All environments</environment>
        <key id="12397414">SYNAPSE-341</key>
            <summary>System unstable when HTTP response returned before request fully written</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="asankha">Asankha Chamath Perera</assignee>
                                    <reporter username="jakelambert">Jake Lambert</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Jun 2008 20:15:49 +0000</created>
                <updated>Wed, 29 Oct 2008 06:10:17 +0000</updated>
                            <resolved>Wed, 29 Oct 2008 06:10:17 +0000</resolved>
                                    <version>1.2-beta1</version>
                                    <fixVersion>2.0</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12602155" author="asankha" created="Wed, 4 Jun 2008 04:11:29 +0000"  >&lt;p&gt;Does the remote service send a &quot;Connection: close&quot; header? Can you post a trace of the response received as well&lt;/p&gt;</comment>
                            <comment id="12602276" author="jakelambert" created="Wed, 4 Jun 2008 13:06:18 +0000"  >&lt;p&gt;No: see attached file for proxy service&apos;s client-side request and response.&lt;/p&gt;</comment>
                            <comment id="12602374" author="asankha" created="Wed, 4 Jun 2008 17:33:03 +0000"  >&lt;p&gt;Maybe Oleg can comment on whether an origin server can prematurely respond to an http request, before the full request was read. &lt;/p&gt;

&lt;p&gt;I found the following from the RFC 2616 Section 8.2.3&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If an origin server receives a request that does not include an&lt;br/&gt;
        Expect request-header field with the &quot;100-continue&quot; expectation,&lt;br/&gt;
        the request includes a request body, and the server responds&lt;br/&gt;
        with a final status code before reading the entire request body&lt;br/&gt;
        from the transport connection, then the server SHOULD NOT close&lt;br/&gt;
        the transport connection until it has read the entire request,&lt;br/&gt;
        or until the client closes the connection. Otherwise, the client&lt;br/&gt;
        might not reliably receive the response message. However, this&lt;br/&gt;
        requirement is not be construed as preventing a server from&lt;br/&gt;
        defending itself against denial-of-service attacks, or from&lt;br/&gt;
        badly broken client implementations.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Same section also mentions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Upon receiving a request which includes an Expect request-header&lt;br/&gt;
        field with the &quot;100-continue&quot; expectation, an origin server MUST&lt;br/&gt;
        either respond with 100 (Continue) status and continue to read&lt;br/&gt;
        from the input stream, or respond with a final status code. The&lt;br/&gt;
        origin server MUST NOT wait for the request body before sending&lt;br/&gt;
        the 100 (Continue) response. If it responds with a final status&lt;br/&gt;
        code, it MAY close the transport connection or it MAY continue&lt;br/&gt;
        to read and discard the rest of the request.  It MUST NOT&lt;br/&gt;
        perform the requested method if it returns a final status code.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12602411" author="olegk" created="Wed, 4 Jun 2008 18:55:34 +0000"  >&lt;p&gt;Asankha,&lt;/p&gt;

&lt;p&gt;This is a bit of a grey area in the HTTP spec. It is not quite clear if the origin server really MUST read the entire request body before sending a response. &lt;/p&gt;

&lt;p&gt;Anyways, lots of HTTP servers out there in the wild do send a response and immediately drop the connection before the request body is fully read. HttpClient, for instance, can&apos;t handle such cases gracefully, but Synapse due to the asynchronous nature of its HTTP transport implementation should be able to.&lt;/p&gt;

&lt;p&gt;Oleg&lt;/p&gt;</comment>
                            <comment id="12643418" author="asankha" created="Wed, 29 Oct 2008 06:10:17 +0000"  >&lt;p&gt;Fixed with send abort detection&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12397471">SYNAPSE-344</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12383374" name="ClientSideReqResp.txt" size="166092" author="jakelambert" created="Wed, 4 Jun 2008 13:05:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183569</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1167r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>214973</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>