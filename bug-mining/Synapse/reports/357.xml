<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:09:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-847] VFS transport throws exception, when try to pull large (&gt;150kb) file from FTP location </title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-847</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;When try to pull larger file from an ftp location , i face the following issue&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;..I used following proxy configuration&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;The  issue is here,  vfs transport listener closes the stream before the vfs transport sender reads it.. As a workaround, i added a Stringbuffer @ listener with a limited buffer size to read the soap envelope..&lt;br/&gt;
Attached the patch with this workaround..&lt;br/&gt;
Please review and commit&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;br/&gt;
r the specified or optional timeout&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-02-29 15:39:19,321&amp;#93;&lt;/span&gt; ERROR - VFSTransportListener Error closing stream&lt;br/&gt;
org.apache.commons.vfs2.FileSystemException: Could not close the input stream for file &quot;ftp://anonymous@localhost/in/textfile.txt?vfs.passive=true&quot;.&lt;br/&gt;
        at org.apache.commons.vfs2.provider.DefaultFileContent$FileContentInputStream.close(DefaultFileContent.java:612)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.processFile(VFSTransportListener.java:566)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.scanFileOrDirectory(VFSTransportListener.java:306)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.poll(VFSTransportListener.java:157)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.poll(VFSTransportListener.java:106)&lt;br/&gt;
        at org.apache.axis2.transport.base.AbstractPollingTransportListener$1$1.run(AbstractPollingTransportListener.java:67)&lt;br/&gt;
        at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:173)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: org.apache.commons.vfs2.FileSystemException: Could not get FTP file &quot;ftp://anonymous@localhost/in/textfile.txt?vfs.passive=true&quot;.&lt;br/&gt;
        at org.apache.commons.vfs2.provider.ftp.FtpFileObject$FtpInputStream.onClose(FtpFileObject.java:731)&lt;br/&gt;
        at org.apache.commons.vfs2.util.MonitorInputStream.close(MonitorInputStream.java:140)&lt;br/&gt;
        at java.io.BufferedInputStream.close(BufferedInputStream.java:451)&lt;br/&gt;
        at org.apache.commons.vfs2.util.MonitorInputStream.close(MonitorInputStream.java:130)&lt;br/&gt;
        at org.apache.commons.vfs2.provider.DefaultFileContent$FileContentInputStream.close(DefaultFileContent.java:608)&lt;br/&gt;
        ... 9 more&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2012-02-29 15:39:19,324&amp;#93;&lt;/span&gt; ERROR - VFSTransportListener Error processing File URI : &lt;a href=&quot;ftp://anonymous@localhost/in/textfile.txt?vfs.passive=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://anonymous@localhost/in/textfile.txt?vfs.passive=true&lt;/a&gt;&lt;br/&gt;
org.apache.axis2.AxisFault: Error closing stream&lt;br/&gt;
        at org.apache.axis2.transport.base.AbstractTransportListener.handleException(AbstractTransportListener.java:343)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.processFile(VFSTransportListener.java:568)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.scanFileOrDirectory(VFSTransportListener.java:306)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.poll(VFSTransportListener.java:157)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.poll(VFSTransportListener.java:106)&lt;br/&gt;
        at org.apache.axis2.transport.base.AbstractPollingTransportListener$1$1.run(AbstractPollingTransportListener.java:67)&lt;br/&gt;
        at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:173)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: org.apache.commons.vfs2.FileSystemException: Could not close the input stream for file &quot;ftp://anonymous@localhost/in/textfile.txt?vfs.passi&lt;br/&gt;
ve=true&quot;.&lt;br/&gt;
        at org.apache.commons.vfs2.provider.DefaultFileContent$FileContentInputStream.close(DefaultFileContent.java:612)&lt;br/&gt;
        at org.apache.synapse.transport.vfs.VFSTransportListener.processFile(VFSTransportListener.java:566)&lt;br/&gt;
        ... 8 more&lt;br/&gt;
Caused by: org.apache.commons.vfs2.FileSystemException: Could not get FTP file &quot;ftp://anonymous@localhost/in/textfile.txt?vfs.passive=true&quot;.&lt;br/&gt;
        at org.apache.commons.vfs2.provider.ftp.FtpFileObject$FtpInputStream.onClose(FtpFileObject.java:731)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12544583">SYNAPSE-847</key>
            <summary>VFS transport throws exception, when try to pull large (&gt;150kb) file from FTP location </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="udayangaw@wso2.com">Udayanga Wickramasinghe</assignee>
                                    <reporter username="ratha">Vijayaratha Vijayasingam</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Feb 2012 09:55:58 +0000</created>
                <updated>Sat, 17 Aug 2013 19:03:45 +0000</updated>
                            <resolved>Thu, 18 Jul 2013 21:40:52 +0000</resolved>
                                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13219055" author="ratha" created="Wed, 29 Feb 2012 10:04:11 +0000"  >&lt;p&gt;Sample proxy;&lt;br/&gt;
&amp;lt;proxy name=&quot;StockQuoteProxy&quot; transports=&quot;vfs&quot; startOnLoad=&quot;true&quot; trace=&quot;disable&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;target faultSequence=&quot;fault&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;inSequence&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;OUT_ONLY&quot; value=&quot;true&quot;/&amp;gt;&lt;br/&gt;
                &amp;lt;send&amp;gt;&lt;br/&gt;
                    &amp;lt;endpoint&amp;gt;&lt;br/&gt;
                        &amp;lt;address uri=&quot;vfs:&lt;a href=&quot;file:C:UsersTOSHIBADesktopout1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:C:\Users\TOSHIBA\Desktop\out1&lt;/a&gt;&quot;/&amp;gt;&lt;br/&gt;
                    &amp;lt;/endpoint&amp;gt;&lt;br/&gt;
                &amp;lt;/send&amp;gt;&lt;br/&gt;
            &amp;lt;/inSequence&amp;gt;&lt;br/&gt;
        &amp;lt;/target&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;transport.vfs.ActionAfterProcess&quot;&amp;gt;MOVE&amp;lt;/parameter&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;transport.PollInterval&quot;&amp;gt;15&amp;lt;/parameter&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;transport.vfs.MoveAfterProcess&quot;&amp;gt;&lt;a href=&quot;file:C:UsersTOSHIBADesktoporiginal&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:C:\Users\TOSHIBA\Desktop\original&lt;/a&gt;&amp;lt;/parameter&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;transport.vfs.FileURI&quot;&amp;gt;vfs:&lt;a href=&quot;ftp://anonymous@localhost/in?vfs.passive=true&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ftp://anonymous@localhost/in?vfs.passive=true&lt;/a&gt;&amp;lt;/parameter&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;transport.vfs.MoveAfterFailure&quot;&amp;gt;&lt;a href=&quot;file:C:UsersTOSHIBADesktoperror&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:C:\Users\TOSHIBA\Desktop\error&lt;/a&gt;&amp;lt;/parameter&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;transport.vfs.FileNamePattern&quot;&amp;gt;.*&amp;lt;/parameter&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;transport.vfs.ContentType&quot;&amp;gt;text/plain&amp;lt;/parameter&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;transport.vfs.ActionAfterFailure&quot;&amp;gt;MOVE&amp;lt;/parameter&amp;gt;&lt;br/&gt;
        &amp;lt;parameter name=&quot;serviceType&quot;&amp;gt;proxy&amp;lt;/parameter&amp;gt;&lt;br/&gt;
    &amp;lt;/proxy&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13222213" author="sadeep" created="Mon, 5 Mar 2012 08:17:00 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;This issue has been around for long time (see &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;). It&apos;s good to see that the root cause of the issue has been found.&lt;/p&gt;

&lt;p&gt;However, I&apos;m not quite sure whether the attached patch should be checked in. With this patch, each message is forced to build within the memory, defeating the streaming nature of Syanpse. With this patch VFS transport can drive Synpase out of memory, if large files are picked and/or a large number of files are picked concurrently.&lt;/p&gt;

&lt;p&gt;There should be another method to prevent the transport listener from closing the stream before it&apos;s completely read. Maybe we can wrap the input stream we get from Commons VFS to add auto closing functionality (IIRC a similar concept is implemented in Axis2 Servlet Transport). &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://markmail.org/message/zphmtx3bi7mzbwzq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/zphmtx3bi7mzbwzq&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Sadeep&lt;/p&gt;</comment>
                            <comment id="13227430" author="ratha" created="Mon, 12 Mar 2012 11:04:18 +0000"  >&lt;p&gt;Thanks sadeep for the input..I have updated the patch...&lt;br/&gt;
We can use the AutoCloseInputstream implementation, which is available in commons.io library to close all the input streams...Anyway at transport listener, we need to close the file object..&lt;br/&gt;
Where, commons-vfs lib tries to close inputstream and detach the file..So, there is a warning comes to synapse end when vfs lib tries to close the stream..&lt;/p&gt;

&lt;p&gt;Since we handover the inputstream closing job to another process at synapse end , I think we can avoid this warning coming from commons-vfs library..&lt;/p&gt;</comment>
                            <comment id="13227431" author="ratha" created="Mon, 12 Mar 2012 11:05:38 +0000"  >&lt;p&gt;Attaching updated one&lt;/p&gt;</comment>
                            <comment id="13712904" author="hiranya" created="Thu, 18 Jul 2013 21:40:52 +0000"  >&lt;p&gt;Patch applied. Thanks Ratha for the contribution.&lt;/p&gt;</comment>
                            <comment id="13713002" author="hudson" created="Thu, 18 Jul 2013 22:31:57 +0000"  >&lt;p&gt;SUCCESS: Integrated in Synapse - Trunk #4621 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/4621/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/4621/&lt;/a&gt;)&lt;br/&gt;
Applying the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-847&quot; title=&quot;VFS transport throws exception, when try to pull large (&amp;gt;150kb) file from FTP location &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-847&quot;&gt;&lt;del&gt;SYNAPSE-847&lt;/del&gt;&lt;/a&gt;; Getting rid of redundant code to close the file input stream. This is taken care of by the FileObject.close() method. Also using an AutoCloseInputStream so that the input stream will be closed early if Synapse consumes it entirely. (hiranya: rev 1504674)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/synapse/trunk/java/modules/transports/core/vfs/pom.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/transports/core/vfs/src/main/java/org/apache/synapse/transport/vfs/VFSTransportListener.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12518010" name="vfsTransport.patch" size="2604" author="ratha" created="Mon, 12 Mar 2012 11:05:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229769</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17t3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253683</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>