<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:09:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-867] SwA responses are processed incorrectly</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-867</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;When Synapse forwards a SwA response, the SOAP part is duplicated in the forwarded response. This can be verified with Sample 51. The attached capture (produced with the last successful Synapse build from the trunk) shows that the response sent by Synapse to the client contains two SOAP parts. Note that a capture of the traffic between Synapse and the server shows that the response received by Synapse is correct. Sample 51 also allows to check that the issue only occurs with SwA responses, but not with SwA requests.&lt;/p&gt;

&lt;p&gt;The probable root cause is that the message builder for SwA sets up the message context with an Attachments object that contains all MIME parts including the root part, while the message formatter for SwA expects that the Attachments object in the message context only contains the attachment parts. For SwA requests, this issue is handled by the following code in MessageHelper#clonePartially:&lt;/p&gt;

&lt;p&gt;        Attachments attachments = ori.getAttachmentMap();&lt;br/&gt;
        if (attachments != null &amp;amp;&amp;amp; attachments.getAllContentIDs().length &amp;gt; 0) {&lt;br/&gt;
            String[] cIDs = attachments.getAllContentIDs();&lt;br/&gt;
            String soapPart = attachments.getSOAPPartContentID();&lt;br/&gt;
            for (String cID : cIDs) {&lt;br/&gt;
                if (!cID.equals(soapPart)) &lt;/p&gt;
{
                    newMC.addAttachment(cID, attachments.getDataHandler(cID));
                }
&lt;p&gt;            }&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;Apparently that code is not executed for SwA responses, probably because a response doesn&apos;t need to be cloned.&lt;/p&gt;

&lt;p&gt;In conjunction with the change in &lt;a href=&quot;https://issues.apache.org/jira/browse/AXIS2-5302&quot; title=&quot;Enable streaming of the root part of a SwA/MTOM message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AXIS2-5302&quot;&gt;&lt;del&gt;AXIS2-5302&lt;/del&gt;&lt;/a&gt;, the issue now causes the following failure because the original SOAP part has been consumed:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: The content of the MIME part has already been consumed&lt;br/&gt;
       at org.apache.axiom.attachments.PartImpl.getContent(PartImpl.java:154)&lt;br/&gt;
       at org.apache.axiom.attachments.PartImpl.writeTo(PartImpl.java:238)&lt;br/&gt;
       at org.apache.axiom.attachments.PartDataHandler.writeTo(PartDataHandler.java:65)&lt;br/&gt;
       at org.apache.axiom.mime.impl.axiom.MultipartWriterImpl.writePart(MultipartWriterImpl.java:133)&lt;br/&gt;
       at org.apache.axiom.om.impl.OMMultipartWriter.writePart(OMMultipartWriter.java:159)&lt;br/&gt;
       at org.apache.axiom.om.impl.OMMultipartWriter.writePart(OMMultipartWriter.java:175)&lt;br/&gt;
       at org.apache.axis2.transport.http.SOAPMessageFormatter.writeSwAMessage(SOAPMessageFormatter.java:237)&lt;br/&gt;
       at org.apache.axis2.transport.http.SOAPMessageFormatter.writeTo(SOAPMessageFormatter.java:68)&lt;br/&gt;
       at org.apache.synapse.transport.nhttp.HttpCoreNIOSender.sendAsyncResponse(HttpCoreNIOSender.java:537)&lt;br/&gt;
       at org.apache.synapse.transport.nhttp.HttpCoreNIOSender.invoke(HttpCoreNIOSender.java:310)&lt;br/&gt;
       at org.apache.axis2.engine.AxisEngine.send(AxisEngine.java:443)&lt;br/&gt;
       at org.apache.synapse.core.axis2.Axis2Sender.sendBack(Axis2Sender.java:159)&lt;br/&gt;
       at org.apache.synapse.core.axis2.Axis2SynapseEnvironment.send(Axis2SynapseEnvironment.java:265)&lt;br/&gt;
       at org.apache.synapse.mediators.builtin.SendMediator.mediate(SendMediator.java:84)&lt;br/&gt;
       at org.apache.synapse.mediators.AbstractListMediator.mediate(AbstractListMediator.java:60)&lt;br/&gt;
       at org.apache.synapse.mediators.filters.OutMediator.mediate(OutMediator.java:55)&lt;br/&gt;
       at org.apache.synapse.mediators.AbstractListMediator.mediate(AbstractListMediator.java:60)&lt;br/&gt;
       at org.apache.synapse.mediators.base.SequenceMediator.mediate(SequenceMediator.java:114)&lt;br/&gt;
       at org.apache.synapse.core.axis2.Axis2SynapseEnvironment.injectMessage(Axis2SynapseEnvironment.java:188)&lt;br/&gt;
       at org.apache.synapse.core.axis2.SynapseCallbackReceiver.handleMessage(SynapseCallbackReceiver.java:370)&lt;br/&gt;
       at org.apache.synapse.core.axis2.SynapseCallbackReceiver.receive(SynapseCallbackReceiver.java:160)&lt;br/&gt;
       at org.apache.axis2.engine.AxisEngine.receive(AxisEngine.java:181)&lt;br/&gt;
       at org.apache.synapse.transport.nhttp.ClientWorker.run(ClientWorker.java:276)&lt;br/&gt;
       at org.apache.axis2.transport.base.threads.NativeWorkerPool$1.run(NativeWorkerPool.java:173)&lt;br/&gt;
       at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
       at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
       at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12553276">SYNAPSE-867</key>
            <summary>SwA responses are processed incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="veithen">Andreas Veithen-Knowles</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Apr 2012 11:01:54 +0000</created>
                <updated>Tue, 1 May 2012 13:10:16 +0000</updated>
                            <resolved>Tue, 1 May 2012 13:10:16 +0000</resolved>
                                                    <fixVersion>FUTURE</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13264550" author="veithen" created="Sun, 29 Apr 2012 14:09:10 +0000"  >&lt;p&gt;One possible (clean) solution for this type of issue is outlined in &lt;a href=&quot;https://issues.apache.org/jira/browse/AXIS2-5308&quot; title=&quot;Attachments semantics are different for incoming and outgoing messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AXIS2-5308&quot;&gt;AXIS2-5308&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13265791" author="veithen" created="Tue, 1 May 2012 13:10:16 +0000"  >&lt;p&gt;Fixed for 2.2 (BTW, why is there no 2.2 or 3.0 in the version list???)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12553282">AXIS2-5308</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12525014" name="capture.txt" size="19896" author="veithen" created="Sun, 29 Apr 2012 11:05:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237387</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 30 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i117yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215255</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>