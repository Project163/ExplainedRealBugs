<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:09:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-901] Concurrency issue at Clone Mediator</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-901</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;This issue is very much identical to the issue &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-897&quot; title=&quot;Concurrency issue at Iterate Mediator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-897&quot;&gt;&lt;del&gt;SYNAPSE-897&lt;/del&gt;&lt;/a&gt;. Clone mediator gives following exception when messages are processed in parallel, &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;SynapseWorker-2&amp;#93;&lt;/span&gt; ERROR MediatorWorker Unexpected error executing task/async inject&lt;br/&gt;
java.util.EmptyStackException&lt;br/&gt;
	at java.util.Stack.peek(Stack.java:85)&lt;br/&gt;
	at org.apache.synapse.util.xpath.SynapseXPathVariableContext.getVariableValue(SynapseXPathVariableContext.java:157)&lt;br/&gt;
	at org.jaxen.ContextSupport.getVariableValue(ContextSupport.java:215)&lt;br/&gt;
	at org.jaxen.Context.getVariableValue(Context.java:196)&lt;br/&gt;
	at org.jaxen.expr.DefaultVariableReferenceExpr.evaluate(DefaultVariableReferenceExpr.java:103)&lt;br/&gt;
	at org.jaxen.expr.DefaultXPathExpr.asList(DefaultXPathExpr.java:102)&lt;br/&gt;
	at org.jaxen.BaseXPath.selectNodesForContext(BaseXPath.java:677)&lt;br/&gt;
	at org.jaxen.BaseXPath.selectNodes(BaseXPath.java:216)&lt;br/&gt;
	at org.jaxen.BaseXPath.evaluate(BaseXPath.java:175)&lt;br/&gt;
	at org.apache.synapse.util.xpath.SynapseXPath.stringValueOf(SynapseXPath.java:172)&lt;br/&gt;
	at org.apache.synapse.mediators.transform.HeaderMediator.mediate(HeaderMediator.java:79)&lt;br/&gt;
	at org.apache.synapse.mediators.AbstractListMediator.mediate(AbstractListMediator.java:60)&lt;br/&gt;
	at org.apache.synapse.mediators.base.SequenceMediator.mediate(SequenceMediator.java:114)&lt;br/&gt;
	at org.apache.synapse.mediators.MediatorWorker.run(MediatorWorker.java:69)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Exception in thread &quot;SynapseWorker-2&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.synapse.FaultHandler.handleFault(FaultHandler.java:78)&lt;br/&gt;
	at org.apache.synapse.mediators.MediatorWorker.run(MediatorWorker.java:90)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;
</description>
                <environment>Any</environment>
        <key id="12601229">SYNAPSE-901</key>
            <summary>Concurrency issue at Clone Mediator</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="isudana">Isuru Udana</assignee>
                                    <reporter username="malith">Malith Dhanushka</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Aug 2012 15:06:18 +0000</created>
                <updated>Sun, 2 Oct 2016 14:24:28 +0000</updated>
                            <resolved>Sun, 2 Oct 2016 14:24:27 +0000</resolved>
                                    <version>2.1</version>
                                    <fixVersion>3.0.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13427375" author="malith" created="Thu, 2 Aug 2012 15:11:03 +0000"  >&lt;p&gt;Attaching patch.Please review &amp;amp; commit. &lt;/p&gt;

&lt;p&gt;Thanks, &lt;br/&gt;
Malith&lt;/p&gt;</comment>
                            <comment id="13434930" author="udayangaw@wso2.com" created="Wed, 15 Aug 2012 10:05:48 +0000"  >&lt;p&gt;committed in rev 1373302.Thanx Malith for your contribution..&lt;/p&gt;</comment>
                            <comment id="13434982" author="hudson" created="Wed, 15 Aug 2012 11:32:08 +0000"  >&lt;p&gt;Integrated in Synapse - Trunk #4385 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/4385/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/4385/&lt;/a&gt;)&lt;br/&gt;
    commiting patches &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-898&quot; title=&quot;Integration tests fail when template libraries are available &quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-898&quot;&gt;&lt;del&gt;SYNAPSE-898&lt;/del&gt;&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-884&quot; title=&quot;Enable optional/default values in call-template mediator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-884&quot;&gt;&lt;del&gt;SYNAPSE-884&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-897&quot; title=&quot;Concurrency issue at Iterate Mediator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-897&quot;&gt;&lt;del&gt;SYNAPSE-897&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-899&quot; title=&quot;Test Case for invoking Synapse Library functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-899&quot;&gt;&lt;del&gt;SYNAPSE-899&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-901&quot; title=&quot;Concurrency issue at Clone Mediator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-901&quot;&gt;&lt;del&gt;SYNAPSE-901&lt;/del&gt;&lt;/a&gt; (Revision 1373302)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
uswick : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/pom.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/config/xml/CloneMediatorFactory.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/config/xml/IterateMediatorFactory.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/config/xml/IterateMediatorSerializer.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/config/xml/TemplateMediatorFactory.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/config/xml/TemplateMediatorSerializer.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/config/xml/TemplateParameterFactory.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/config/xml/TemplateParameterSerializer.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/libraries/util/LibDeployerUtils.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/mediators/TemplateParameter.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/mediators/template/TemplateContext.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/mediators/template/TemplateMediator.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/java/org/apache/synapse/libraries/eip&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/java/org/apache/synapse/libraries/eip/AbstractEipLibTestCase.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/java/org/apache/synapse/libraries/eip/EipLibTest.java&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/resources/synapse-libraries/assembly/assemble-eip-lib.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/resources/synapse-libraries/synapse-eip-lib&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/resources/synapse-libraries/synapse-eip-lib/artifacts.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/resources/synapse-libraries/synapse-eip-lib/eip_systemManagement&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/resources/synapse-libraries/synapse-eip-lib/eip_systemManagement/artifact.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/test/resources/synapse-libraries/synapse-eip-lib/eip_systemManagement/template_splitter.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/repository/conf/sample/synapse_sample_850.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/repository/conf/sample/synapse_sample_851.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/repository/conf/sample/synapse_sample_852.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/repository/conf/sample/synapse_sample_853.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/repository/conf/sample/synapse_sample_854.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/repository/conf/sample/synapse_sample_855.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/repository/conf/sample/synapse_sample_856.xml&lt;/li&gt;
	&lt;li&gt;/synapse/trunk/java/repository/conf/sample/synapse_sample_857.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14059817" author="isudana" created="Sat, 12 Jul 2014 15:05:02 +0000"  >&lt;p&gt;Hi Udayanga, &lt;/p&gt;

&lt;p&gt;This fix is incorrect. This has made clone mediator to work in sequential manner all the time regardless of sequential config parameter. &lt;br/&gt;
Please revert this fix.&lt;/p&gt;
</comment>
                            <comment id="14059963" author="uswick" created="Sun, 13 Jul 2014 00:10:51 +0000"  >&lt;p&gt;Yes there seems to be an issue with the patch, I reverted it. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=malith&quot; class=&quot;user-hover&quot; rel=&quot;malith&quot;&gt;malith&lt;/a&gt; Can you please point to us how to reproduce the issue you were having. was it intermittent ?. your fix does not resolve that issue it seems.&lt;/p&gt;</comment>
                            <comment id="14059966" author="hudson" created="Sun, 13 Jul 2014 00:36:40 +0000"  >&lt;p&gt;SUCCESS: Integrated in Synapse - Trunk #4860 (See &lt;a href=&quot;https://builds.apache.org/job/Synapse%20-%20Trunk/4860/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/Synapse%20-%20Trunk/4860/&lt;/a&gt;)&lt;br/&gt;
fixing the issue with the patch submitted on &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-901&quot; title=&quot;Concurrency issue at Clone Mediator&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-901&quot;&gt;&lt;del&gt;SYNAPSE-901&lt;/del&gt;&lt;/a&gt; (uswick: rev 1610091)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/synapse/trunk/java/modules/core/src/main/java/org/apache/synapse/config/xml/CloneMediatorFactory.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14063223" author="malith" created="Wed, 16 Jul 2014 06:56:22 +0000"  >&lt;p&gt;Hi Udayanga, &lt;/p&gt;

&lt;p&gt;I will take a look.&lt;/p&gt;</comment>
                            <comment id="15540441" author="isudana" created="Sun, 2 Oct 2016 14:24:05 +0000"  >&lt;p&gt;As per the exception trace this looks same as &lt;br/&gt;
&lt;a href=&quot;https://wso2.org/jira/browse/ESBJAVA-3218&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://wso2.org/jira/browse/ESBJAVA-3218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We have already fix this through &lt;a href=&quot;https://issues.apache.org/jira/browse/SYNAPSE-1040&quot; title=&quot;cloneMessageContext  in MessageHelper does not deep clone all synapse properties&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SYNAPSE-1040&quot;&gt;&lt;del&gt;SYNAPSE-1040&lt;/del&gt;&lt;/a&gt; in r1747563.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12538916" name="SYNAPSE-901.patch" size="1011" author="malith" created="Thu, 2 Aug 2012 15:11:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>295424</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i116p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>215051</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>