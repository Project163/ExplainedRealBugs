<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 20:07:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SYNAPSE-434] Concurrency level provided by the mail and VFS transports listeners is insufficient</title>
                <link>https://issues.apache.org/jira/browse/SYNAPSE-434</link>
                <project id="12310201" key="SYNAPSE">Synapse</project>
                    <description>&lt;p&gt;Scenario:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Two services are configured to use the (mail or VFS) transport.&lt;/li&gt;
	&lt;li&gt;Two messages are sent two each of these services.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In this case, one would expect that the transport listener will be able to process at least 2 (better 4) messages concurrently. However the listener currently only processes one message at a time, i.e. the listener behaves as if it was single-threaded.&lt;/p&gt;

&lt;p&gt;There are two reasons for this:&lt;/p&gt;

&lt;p&gt;1. AbstractPollingTransportListener contains the following code:&lt;/p&gt;

&lt;p&gt;workerPool.execute(new Runnable() {&lt;br/&gt;
    public void run() {&lt;br/&gt;
        synchronized (pollLock) {&lt;br/&gt;
            pollInProgress = true;&lt;br/&gt;
            try &lt;/p&gt;
{
                onPoll();
            }
&lt;p&gt; finally &lt;/p&gt;
{
                pollInProgress = false;
            }
&lt;p&gt;        }&lt;br/&gt;
    }&lt;br/&gt;
});&lt;/p&gt;

&lt;p&gt;Since pollLock is a member of AbstractPollingTransportListener, there can only be one poll in progress at a time, even if several services are configured to use the transport (in which case nothing would prevent the transport from executing the polls for the different services in parallel).&lt;/p&gt;

&lt;p&gt;2. Both MailTransportListener and VFSTransportListener process incoming messages sequentially. Here again, the transport could process several messages in parallel during the execution of the onPoll method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12402926">SYNAPSE-434</key>
            <summary>Concurrency level provided by the mail and VFS transports listeners is insufficient</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="veithen">Andreas Veithen-Knowles</assignee>
                                    <reporter username="veithen">Andreas Veithen-Knowles</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Aug 2008 16:28:46 +0000</created>
                <updated>Mon, 16 Dec 2013 10:40:37 +0000</updated>
                                            <version>1.2</version>
                                                    <component>Transports</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12685418" author="asankha" created="Sat, 21 Mar 2009 05:08:45 +0000"  >&lt;p&gt;The reason I did this was to actually prevent concurrent processing by Mail, VFS etc., where we do not want to say process the same file/email by two threads concurrently.. Do you have a proposed solution to prevent that?&lt;/p&gt;</comment>
                            <comment id="12688011" author="veithen" created="Sat, 21 Mar 2009 10:26:05 +0000"  >&lt;p&gt;Of course we need to avoid to process the same message twice. This can be achieved if me make sure that for a given service, a new poll is only scheduled when the current poll is completed. For the moment the mail and VFS transports work as follows:&lt;/p&gt;

&lt;p&gt;1. Start poll (open mail folder and read message list; read directory).&lt;br/&gt;
2. Sequentially process each message.&lt;br/&gt;
3. Schedule the next poll.&lt;/p&gt;

&lt;p&gt;The idea is to change that (as an option) to:&lt;/p&gt;

&lt;p&gt;1. Start poll&lt;br/&gt;
2. Process the messages in parallel (with a configurable level of concurrency)&lt;br/&gt;
3. Wait until all messages have been processed and schedule the next poll.&lt;/p&gt;

&lt;p&gt;Note that this solution probably doesn&apos;t provide enough concurrency for what is requested in the linked issue &lt;a href=&quot;https://issues.apache.org/jira/browse/WSCOMMONS-454&quot; title=&quot;SMTP transport can receive more than one message at same time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WSCOMMONS-454&quot;&gt;&lt;del&gt;WSCOMMONS-454&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12688103" author="amilachinthaka" created="Sun, 22 Mar 2009 06:30:21 +0000"  >&lt;p&gt;I have also seen this same issue and it is a serious problem for RM synchronize invocations.&lt;/p&gt;

&lt;p&gt;In the earlier Axis2 SMTP transport it also polls the SMTP server using one thread. But after creating the message context it starts a new thread to send it through the Axis Engine.&lt;/p&gt;

&lt;p&gt;synchronized (receiver) {&lt;br/&gt;
                    receiver.connect();&lt;/p&gt;

&lt;p&gt;                    Message[] msgs = receiver.receiveMessages();&lt;/p&gt;

&lt;p&gt;                    if ((msgs != null) &amp;amp;&amp;amp; (msgs.length &amp;gt; 0)) {&lt;br/&gt;
                        log.info(msgs.length + &quot; Message(s) Found&quot;);&lt;/p&gt;

&lt;p&gt;                        for (int i = 0; i &amp;lt; msgs.length; i++) {&lt;br/&gt;
                            MimeMessage msg = (MimeMessage) msgs&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;;&lt;br/&gt;
                            try {&lt;br/&gt;
                                MessageContext mc = createMessageContextToMailWorker(msg);&lt;br/&gt;
                                msg.setFlag(Flags.Flag.DELETED, true);&lt;br/&gt;
                                if(mc==null)&lt;/p&gt;
{
                                    continue;
                                }
&lt;p&gt;                                MailWorker worker = new MailWorker(configurationContext,mc);&lt;br/&gt;
                                this.configurationContext.getThreadPool().execute(worker);&lt;br/&gt;
                            } catch (Exception e) &lt;/p&gt;
{
                                log.error(&quot;Error in SimpleMailListener - processing mail&quot;, e);
                            }
&lt;p&gt; finally &lt;/p&gt;
{
                                // delete mail in any case
                            }
&lt;p&gt;                        }&lt;br/&gt;
                    }&lt;/p&gt;

&lt;p&gt;                    receiver.disconnect();&lt;br/&gt;
                }&lt;/p&gt;

&lt;p&gt;Can&apos;t we do the same thing here as well.&lt;/p&gt;

&lt;p&gt;thanks,&lt;br/&gt;
Amila.&lt;/p&gt;</comment>
                            <comment id="12689880" author="asankha" created="Fri, 27 Mar 2009 11:44:02 +0000"  >&lt;p&gt;I&apos;ve fixed &lt;a href=&quot;https://issues.apache.org/jira/browse/WSCOMMONS-454&quot; title=&quot;SMTP transport can receive more than one message at same time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WSCOMMONS-454&quot;&gt;&lt;del&gt;WSCOMMONS-454&lt;/del&gt;&lt;/a&gt; for the Mail transport. We could use the same concept and make sure that one file is processed only once (i.e. using the file path) for VFS. Of course, one would need to pin VFS services to an Active/Passive configuration to ensure that multiple nodes on a cluster would not conflict&lt;/p&gt;</comment>
                            <comment id="13721804" author="hiranya" created="Sun, 28 Jul 2013 00:04:22 +0000"  >&lt;p&gt;I assume this is fixed now? Andreas, can we resolve this?&lt;/p&gt;</comment>
                            <comment id="13849012" author="veithen" created="Mon, 16 Dec 2013 10:40:37 +0000"  >&lt;p&gt;Yes, I think that this is resolved.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12417386">WSCOMMONS-454</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>183658</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 49 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17tif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>253750</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>