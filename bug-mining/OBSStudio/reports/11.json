{"url":"https://api.github.com/repos/obsproject/obs-studio/issues/3561","repository_url":"https://api.github.com/repos/obsproject/obs-studio","labels_url":"https://api.github.com/repos/obsproject/obs-studio/issues/3561/labels{/name}","comments_url":"https://api.github.com/repos/obsproject/obs-studio/issues/3561/comments","events_url":"https://api.github.com/repos/obsproject/obs-studio/issues/3561/events","html_url":"https://github.com/obsproject/obs-studio/issues/3561","id":714932007,"node_id":"MDU6SXNzdWU3MTQ5MzIwMDc=","number":3561,"title":"Linux: RNNoise segfault (symbol clashing)","user":{"login":"fzwoch","id":439605,"node_id":"MDQ6VXNlcjQzOTYwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/439605?v=4","gravatar_id":"","url":"https://api.github.com/users/fzwoch","html_url":"https://github.com/fzwoch","followers_url":"https://api.github.com/users/fzwoch/followers","following_url":"https://api.github.com/users/fzwoch/following{/other_user}","gists_url":"https://api.github.com/users/fzwoch/gists{/gist_id}","starred_url":"https://api.github.com/users/fzwoch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fzwoch/subscriptions","organizations_url":"https://api.github.com/users/fzwoch/orgs","repos_url":"https://api.github.com/users/fzwoch/repos","events_url":"https://api.github.com/users/fzwoch/events{/privacy}","received_events_url":"https://api.github.com/users/fzwoch/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2020-10-05T15:15:52Z","updated_at":"2020-10-16T12:26:26Z","closed_at":"2020-10-16T12:26:26Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!-- READ THIS FIRST -->\r\n<!-- The OBS Studio GitHub issue tracker is **ONLY** to be -->\r\n<!-- used for reporting Bugs that have replication steps. -->\r\n\r\n<!-- You can post Feature Requests here: https://ideas.obsproject.com/ -->\r\n<!-- Get help for Support Issues here: https://obsproject.com/help -->\r\n\r\n<!--- Provide a general summary of the issue in the Title above -->\r\n\r\n## Platform\r\n<!-- Please fill out the following information about your bug report. -->\r\n<!-- If you are on Linux and installed using a package, please list the package type. -->\r\nOperating system and version: Linux Debian Sid\r\nOBS Studio version: 26.0.0\r\n\r\n## Expected Behavior\r\n<!--- Tell us what should happen -->\r\nShould be able to use RNNoise noise suppression filter for any audio source.\r\n\r\n## Current Behavior\r\n<!--- Tell us what happens instead of the expected behavior. -->\r\n<!--- Please include a log file here if possible. -->\r\nUsing RNNoise noise suppression filter results in a segmentation fault.\r\n\r\n## Steps to Reproduce\r\n<!--- Provide a link to a live example, or an unambiguous set of steps to -->\r\n<!--- reproduce this bug. Include code to reproduce, if relevant. -->\r\n<!--- Screenshots and video are encouraged if applicable. -->\r\n1. Manually build OBS Studio\r\n2. Start OBS Studio\r\n3. Go to any audio source -> Filters -> Add (+) -> Noise Suppresion -> OK\r\n\r\n## Additional information\r\n<!--- Not obligatory, but provide any additional details or information -->\r\n<!--- that you feel might be relevant to the issue -->\r\n```\r\n0x00007ffff27c4a25 in _celt_autocorr () from /lib/x86_64-linux-gnu/libcodec2.so.0.9\r\n(gdb) bt\r\n#0  0x00007ffff27c4a25 in _celt_autocorr () at /lib/x86_64-linux-gnu/libcodec2.so.0.9\r\n#1  0x00007ffff27c4d2a in pitch_downsample () at /lib/x86_64-linux-gnu/libcodec2.so.0.9\r\n#2  0x00007fff475e13b5 in compute_frame_features (in=0x7fff46ac3520, features=0x7fff46ac3470, Exp=0x7fff46ac33b0, Ep=0x7fff46ac3350, Ex=0x7fff46ac32f0, P=0x7fff46ac6240, X=0x7fff46ac5330, st=0x555556fa7160)\r\n    at ../plugins/obs-filters/rnnoise/src/denoise.c:326\r\n#3  rnnoise_process_frame (st=0x555556fa7160, out=0x555556f7cc60, in=<optimized out>) at ../plugins/obs-filters/rnnoise/src/denoise.c:471\r\n#4  0x00007fff475eff6c in process_rnnoise (ng=0x555556fa1da0) at ../plugins/obs-filters/noise-suppress-filter.c:343\r\n#5  process (ng=<optimized out>) at ../plugins/obs-filters/noise-suppress-filter.c:392\r\n#6  noise_suppress_filter_audio (data=0x555556fa1da0, audio=<optimized out>) at ../plugins/obs-filters/noise-suppress-filter.c:468\r\n#7  0x00007ffff5c85b13 in filter_async_audio (in=<optimized out>, source=0x555556ad18a0) at ../libobs/obs-source.c:3068\r\n#8  obs_source_output_audio (source=0x555556ad18a0, audio=audio@entry=0x7fff46acbea0) at ../libobs/obs-source.c:3246\r\n#9  0x00007fffd8149da5 in pulse_stream_read (p=<optimized out>, nbytes=<optimized out>, userdata=0x555556acb280) at ../plugins/linux-pulseaudio/pulse-input.c:217\r\n#10 0x00007ffff02f1b2d in  () at /lib/x86_64-linux-gnu/libpulse.so.0\r\n#11 0x00007fffee129bf5 in  () at /usr/lib/x86_64-linux-gnu/pulseaudio/libpulsecommon-13.0.so\r\n#12 0x00007fffee12c5ab in  () at /usr/lib/x86_64-linux-gnu/pulseaudio/libpulsecommon-13.0.so\r\n#13 0x00007fffee12c966 in  () at /usr/lib/x86_64-linux-gnu/pulseaudio/libpulsecommon-13.0.so\r\n#14 0x00007fffee12d1ba in  () at /usr/lib/x86_64-linux-gnu/pulseaudio/libpulsecommon-13.0.so\r\n#15 0x00007ffff03071a3 in pa_mainloop_dispatch () at /lib/x86_64-linux-gnu/libpulse.so.0\r\n#16 0x00007ffff03074ce in pa_mainloop_iterate () at /lib/x86_64-linux-gnu/libpulse.so.0\r\n#17 0x00007ffff0307570 in pa_mainloop_run () at /lib/x86_64-linux-gnu/libpulse.so.0\r\n#18 0x00007ffff0315439 in  () at /lib/x86_64-linux-gnu/libpulse.so.0\r\n#19 0x00007fffee13c268 in  () at /usr/lib/x86_64-linux-gnu/pulseaudio/libpulsecommon-13.0.so\r\n#20 0x00007ffff4cfbea7 in start_thread (arg=<optimized out>) at pthread_create.c:477\r\n#21 0x00007ffff4c2beaf in clone () at ../sysdeps/unix/sysv/linux/x86_64/clone.S:95\r\n\r\n```\r\nNotice that in the callstack `pitch_downsample()` symbol is called from `/lib/x86_64-linux-gnu/libcodec2.so.0.9`. That library is probably pulled in by FFMPEG. The intention probably was to use the symbol from `plugins/obs-filters/rnnoise/src/pitch.c`.\r\n\r\nSo it seems like `libcodec2.so` and OBS Studio share portions of code and there are duplicate symbol names in `libcodec2.so` and OBS Studio executable. I'm unsure about the symbol loading strategy of the dynamic loader on Linux - but it seems like the symbol from the loaded shared library gets precedence over the internal symbol in OBS Studio.\r\n\r\nSince the symbols can be incompatible to each and OBS Studio was compiled with a different expectation than `libcodec2.so`\r\n delivers a segmentation fault is likely..","closed_by":{"login":"jp9000","id":2084112,"node_id":"MDQ6VXNlcjIwODQxMTI=","avatar_url":"https://avatars.githubusercontent.com/u/2084112?v=4","gravatar_id":"","url":"https://api.github.com/users/jp9000","html_url":"https://github.com/jp9000","followers_url":"https://api.github.com/users/jp9000/followers","following_url":"https://api.github.com/users/jp9000/following{/other_user}","gists_url":"https://api.github.com/users/jp9000/gists{/gist_id}","starred_url":"https://api.github.com/users/jp9000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jp9000/subscriptions","organizations_url":"https://api.github.com/users/jp9000/orgs","repos_url":"https://api.github.com/users/jp9000/repos","events_url":"https://api.github.com/users/jp9000/events{/privacy}","received_events_url":"https://api.github.com/users/jp9000/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/obsproject/obs-studio/issues/3561/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/obsproject/obs-studio/issues/3561/timeline","performed_via_github_app":null,"state_reason":"completed"}