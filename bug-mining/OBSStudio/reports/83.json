{"url":"https://api.github.com/repos/obsproject/obs-studio/issues/11221","repository_url":"https://api.github.com/repos/obsproject/obs-studio","labels_url":"https://api.github.com/repos/obsproject/obs-studio/issues/11221/labels{/name}","comments_url":"https://api.github.com/repos/obsproject/obs-studio/issues/11221/comments","events_url":"https://api.github.com/repos/obsproject/obs-studio/issues/11221/events","html_url":"https://github.com/obsproject/obs-studio/issues/11221","id":2495750522,"node_id":"I_kwDOAMnsBs6UwiF6","number":11221,"title":"SIGSEGV on MFX_ERR_UNSUPPORTED (libva, intel), in simple_free, response->mids invalid (0xc1)","user":{"login":"alefminus","id":103570620,"node_id":"U_kgDOBixcvA","avatar_url":"https://avatars.githubusercontent.com/u/103570620?v=4","gravatar_id":"","url":"https://api.github.com/users/alefminus","html_url":"https://github.com/alefminus","followers_url":"https://api.github.com/users/alefminus/followers","following_url":"https://api.github.com/users/alefminus/following{/other_user}","gists_url":"https://api.github.com/users/alefminus/gists{/gist_id}","starred_url":"https://api.github.com/users/alefminus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alefminus/subscriptions","organizations_url":"https://api.github.com/users/alefminus/orgs","repos_url":"https://api.github.com/users/alefminus/repos","events_url":"https://api.github.com/users/alefminus/events{/privacy}","received_events_url":"https://api.github.com/users/alefminus/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-08-29T22:59:54Z","updated_at":"2024-09-13T20:27:03Z","closed_at":"2024-09-13T20:27:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Operating System Info\n\nOther\n\n### Other OS\n\nfedora 40\n\n### OBS Studio Version\n\n30.2.2\n\n### OBS Studio Version (Other)\n\n_No response_\n\n### OBS Studio Log URL\n\nhttps://obsproject.com/logs/dINNx5qpKFWUnkSi\n\n### OBS Studio Crash Log URL\n\n_No response_\n\n### Expected Behavior\n\nRecords stream.\n\n### Current Behavior\n\nCrashes with a segmentation violation.\n\n### Steps to Reproduce\n\n1. (probably unrelated) create one video source, capture of whole screen via pipewire\r\n2. Set output to hardware accelerated QSV H.264 codec\r\n3. start recording\r\n...\r\n\n\n### Anything else we should know?\n\nThe log fails to show the actual segmentation violation, here it is when running under gdb, including a stack trace and faulted relevant variables:\r\n\r\n```\r\nlibva info: VA-API version 1.21.0\r\nlibva info: Trying to open /usr/lib64/dri-nonfree/iHD_drv_video.so\r\nlibva info: Trying to open /usr/lib64/dri-freeworld/iHD_drv_video.so\r\nlibva info: Trying to open /usr/lib64/dri/iHD_drv_video.so\r\nlibva info: Found init function __vaDriverInit_1_21\r\nlibva info: va_openDriver() returns 0\r\n\r\n Unsupported feature/library load error. /builddir/build/BUILD/obs-studio-30.2.2/plugins/obs-qsv11/QSV_Encoder_Internal.cpp 160\r\nwarning: [qsv encoder: 'msdk_impl'] Unsupported configurations, parameters, or features (MFX_ERR_UNSUPPORTED)\r\n\r\nThread 1 \"obs\" received signal SIGSEGV, Segmentation fault.\r\nDownloading source file /usr/src/debug/obs-studio-30.2.2-1.fc40.x86_64/plugins/obs-qsv11/common_utils_linux.cpp\r\n0x00007fffd201a856 in simple_free (pthis=<optimized out>, response=0x5555573fd208) at /usr/src/debug/obs-studio-30.2.2-1.fc40.x86_64/plugins/obs-qsv11/common_utils_linux.cpp:222                                                             \r\n222\t\tstruct surface_info *surfs =\r\n(gdb) l\r\n217\t\tVADisplay display;\r\n218\t\tmfxStatus sts =\r\n219\t\t\tMFXVideoCORE_GetHandle(*session, DEVICE_MGR_TYPE, &display);\r\n220\t\tMSDK_CHECK_RESULT(sts, MFX_ERR_NONE, sts);\r\n221\t\r\n222\t\tstruct surface_info *surfs =\r\n223\t\t\t(struct surface_info *)response->mids[response->NumFrameActual];\r\n224\t\tVASurfaceID temp_surfaces[MAX_ALLOCABLE_SURFACES] = {0};\r\n225\t\tobs_enter_graphics();\r\n226\t\tfor (int i = 0; i < response->NumFrameActual; i++) {\r\n(gdb) p response\r\n$1 = (mfxFrameAllocResponse *) 0x5555573fd208\r\n(gdb) p response->NumFrameActual\r\n$2 = 61984\r\n(gdb) p response->mids\r\n$3 = (mfxMemId *) 0xc1\r\n(gdb) disassemble\r\n```\r\n\r\nSo it seems as I wrote in the title that response is valid but response->mids is getting an invalid address, perhaps some offset from a NULL that was unchecked.","closed_by":{"login":"RytoEX","id":624931,"node_id":"MDQ6VXNlcjYyNDkzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/624931?v=4","gravatar_id":"","url":"https://api.github.com/users/RytoEX","html_url":"https://github.com/RytoEX","followers_url":"https://api.github.com/users/RytoEX/followers","following_url":"https://api.github.com/users/RytoEX/following{/other_user}","gists_url":"https://api.github.com/users/RytoEX/gists{/gist_id}","starred_url":"https://api.github.com/users/RytoEX/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RytoEX/subscriptions","organizations_url":"https://api.github.com/users/RytoEX/orgs","repos_url":"https://api.github.com/users/RytoEX/repos","events_url":"https://api.github.com/users/RytoEX/events{/privacy}","received_events_url":"https://api.github.com/users/RytoEX/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/obsproject/obs-studio/issues/11221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/obsproject/obs-studio/issues/11221/timeline","performed_via_github_app":null,"state_reason":"completed"}