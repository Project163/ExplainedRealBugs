diff --git a/plugins/obs-ffmpeg/obs-ffmpeg-mpegts.c b/plugins/obs-ffmpeg/obs-ffmpeg-mpegts.c
index 69ec8a7c2..5139acc83 100644
--- a/plugins/obs-ffmpeg/obs-ffmpeg-mpegts.c
+++ b/plugins/obs-ffmpeg/obs-ffmpeg-mpegts.c
@@ -63,16 +63,14 @@ void ffmpeg_mpegts_log_error(int log_level, struct ffmpeg_data *data,
 	blog(log_level, "%s", out);
 }
 
-static bool is_rist(struct ffmpeg_output *stream)
+static bool is_rist(const char *url)
 {
-	return !strncmp(stream->ff_data.config.url, RIST_PROTO,
-			sizeof(RIST_PROTO) - 1);
+	return !strncmp(url, RIST_PROTO, sizeof(RIST_PROTO) - 1);
 }
 
-static bool is_srt(struct ffmpeg_output *stream)
+static bool is_srt(const char *url)
 {
-	return !strncmp(stream->ff_data.config.url, SRT_PROTO,
-			sizeof(SRT_PROTO) - 1);
+	return !strncmp(url, SRT_PROTO, sizeof(SRT_PROTO) - 1);
 }
 
 static bool proto_is_allowed(struct ffmpeg_output *stream)
@@ -467,8 +465,8 @@ static inline int open_output_file(struct ffmpeg_output *stream,
 				   struct ffmpeg_data *data)
 {
 	int ret;
-	bool rist = is_rist(stream);
-	bool srt = is_srt(stream);
+	bool rist = data->config.is_rist;
+	bool srt = data->config.is_srt;
 	bool allowed_proto = proto_is_allowed(stream);
 	AVDictionary *dict = NULL;
 
@@ -591,10 +589,7 @@ static void close_audio(struct ffmpeg_data *data)
 static void close_mpegts_url(struct ffmpeg_output *stream, bool is_rist)
 {
 	int err = 0;
-	AVIOContext *s = stream->s;
-	if (!s)
-		return;
-	URLContext *h = s->opaque;
+	URLContext *h = stream->h;
 	if (!h)
 		return; /* can happen when opening the url fails */
 
@@ -608,10 +603,14 @@ static void close_mpegts_url(struct ffmpeg_output *stream, bool is_rist)
 	av_freep(h);
 
 	/* close custom avio_context for srt or rist */
-	avio_flush(stream->s);
-	stream->s->opaque = NULL;
-	av_freep(&stream->s->buffer);
-	avio_context_free(&stream->s);
+	AVIOContext *s = stream->s;
+	if (!s)
+		return;
+
+	avio_flush(s);
+	s->opaque = NULL;
+	av_freep(&s->buffer);
+	avio_context_free(&s);
 
 	if (err)
 		info("[ffmpeg mpegts muxer]: Error closing URL %s",
@@ -632,8 +631,8 @@ void ffmpeg_mpegts_data_free(struct ffmpeg_output *stream,
 	}
 
 	if (data->output) {
-		if (is_rist(stream) || is_srt(stream)) {
-			close_mpegts_url(stream, is_rist(stream));
+		if (data->config.is_rist || data->config.is_srt) {
+			close_mpegts_url(stream, data->config.is_rist);
 		} else {
 			avio_close(data->output->pb);
 		}
@@ -757,11 +756,10 @@ static void ffmpeg_mpegts_destroy(void *data)
 	struct ffmpeg_output *output = data;
 
 	if (output) {
+		ffmpeg_mpegts_full_stop(output);
 		if (output->connecting)
 			pthread_join(output->start_thread, NULL);
 
-		ffmpeg_mpegts_full_stop(output);
-
 		pthread_mutex_destroy(&output->write_mutex);
 		os_sem_destroy(output->write_sem);
 		os_event_destroy(output->stop_event);
@@ -910,7 +908,8 @@ static bool set_config(struct ffmpeg_output *stream)
 		service, OBS_SERVICE_CONNECT_INFO_ENCRYPT_PASSPHRASE);
 	config.format_name = "mpegts";
 	config.format_mime_type = "video/M2PT";
-
+	config.is_rist = is_rist(config.url);
+	config.is_srt = is_srt(config.url);
 	/* 2. video settings */
 
 	// 2.a) set width & height
@@ -1110,6 +1109,7 @@ static void ffmpeg_mpegts_full_stop(void *data)
 		obs_output_end_data_capture(output->output);
 		ffmpeg_mpegts_deactivate(output);
 	}
+	ffmpeg_mpegts_data_free(output, &output->ff_data);
 }
 
 static void ffmpeg_mpegts_stop(void *data, uint64_t ts)
@@ -1144,8 +1144,6 @@ static void ffmpeg_mpegts_deactivate(struct ffmpeg_output *output)
 	da_free(output->packets);
 
 	pthread_mutex_unlock(&output->write_mutex);
-
-	ffmpeg_mpegts_data_free(output, &output->ff_data);
 }
 
 static uint64_t ffmpeg_mpegts_total_bytes(void *data)
diff --git a/plugins/obs-ffmpeg/obs-ffmpeg-output.h b/plugins/obs-ffmpeg/obs-ffmpeg-output.h
index 7b898f9a2..04715d53c 100644
--- a/plugins/obs-ffmpeg/obs-ffmpeg-output.h
+++ b/plugins/obs-ffmpeg/obs-ffmpeg-output.h
@@ -43,6 +43,8 @@ struct ffmpeg_cfg {
 	const char *password;
 	const char *stream_id;
 	const char *encrypt_passphrase;
+	bool is_srt;
+	bool is_rist;
 };
 
 struct ffmpeg_audio_info {
diff --git a/plugins/obs-ffmpeg/obs-ffmpeg-srt.h b/plugins/obs-ffmpeg/obs-ffmpeg-srt.h
index 274ec1795..d6d6c9cd4 100644
--- a/plugins/obs-ffmpeg/obs-ffmpeg-srt.h
+++ b/plugins/obs-ffmpeg/obs-ffmpeg-srt.h
@@ -150,7 +150,7 @@ static int libsrt_network_wait_fd(URLContext *h, int eid, int write)
 	int ret, len = 1, errlen = 1;
 	SRTSOCKET ready[1];
 	SRTSOCKET error[1];
-
+	SRTContext *s = (SRTContext *)h->priv_data;
 	if (write) {
 		ret = srt_epoll_wait(eid, error, &errlen, ready, &len,
 				     POLLING_TIME, 0, 0, 0, 0);
@@ -158,7 +158,7 @@ static int libsrt_network_wait_fd(URLContext *h, int eid, int write)
 		ret = srt_epoll_wait(eid, ready, &len, error, &errlen,
 				     POLLING_TIME, 0, 0, 0, 0);
 	}
-	if (len == 1 && errlen == 1) {
+	if (len == 1 && errlen == 1 && s->mode == SRT_MODE_CALLER) {
 		/* Socket reported in wsock AND rsock signifies an error. */
 		int reason = srt_getrejectreason(*ready);
 
@@ -232,7 +232,7 @@ static int libsrt_listen(int eid, SRTSOCKET fd, const struct sockaddr *addr,
 	if (srt_listen(fd, 1))
 		return libsrt_neterrno(h);
 
-	ret = libsrt_network_wait_fd_timeout(h, eid, 1, timeout,
+	ret = libsrt_network_wait_fd_timeout(h, eid, 0, timeout,
 					     &h->interrupt_callback);
 	if (ret < 0)
 		return ret;
@@ -462,7 +462,7 @@ static int libsrt_setup(URLContext *h, const char *uri)
 	char hostname[1024], proto[1024], path[1024];
 	char portstr[10];
 	int64_t open_timeout = 0;
-	int eid, write_eid;
+	int eid;
 	struct sockaddr_in la;
 
 	av_url_split(proto, sizeof(proto), NULL, 0, hostname, sizeof(hostname),
@@ -552,20 +552,23 @@ restart:
 		blog(LOG_DEBUG,
 		     "[obs-ffmpeg mpegts muxer / libsrt]: libsrt_socket_nonblock failed");
 
-	ret = write_eid = libsrt_epoll_create(h, fd, 1);
-	if (ret < 0)
-		goto fail1;
 	if (s->mode == SRT_MODE_LISTENER) {
+		int read_eid = ret = libsrt_epoll_create(h, fd, 0);
+		if (ret < 0)
+			goto fail1;
 		// multi-client
-		ret = libsrt_listen(write_eid, fd, cur_ai->ai_addr,
+		ret = libsrt_listen(read_eid, fd, cur_ai->ai_addr,
 				    (socklen_t)cur_ai->ai_addrlen, h,
 				    s->listen_timeout);
-		srt_epoll_release(write_eid);
+		srt_epoll_release(read_eid);
 		if (ret < 0)
 			goto fail1;
 		srt_close(fd);
 		fd = ret;
 	} else {
+		int write_eid = ret = libsrt_epoll_create(h, fd, 1);
+		if (ret < 0)
+			goto fail1;
 		if (s->mode == SRT_MODE_RENDEZVOUS) {
 			if (srt_bind(fd, (struct sockaddr *)&la,
 				     sizeof(struct sockaddr_in))) {
@@ -878,6 +881,8 @@ static int libsrt_write(URLContext *h, const uint8_t *buf, int size)
 static int libsrt_close(URLContext *h)
 {
 	SRTContext *s = (SRTContext *)h->priv_data;
+	if (!s)
+		return 0;
 	if (s->streamid)
 		av_freep(&s->streamid);
 	if (s->passphrase)
