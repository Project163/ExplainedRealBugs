[{"url":"https://api.github.com/repos/reduxjs/redux/issues/comments/129877569","html_url":"https://github.com/reduxjs/redux/issues/461#issuecomment-129877569","issue_url":"https://api.github.com/repos/reduxjs/redux/issues/461","id":129877569,"node_id":"MDEyOklzc3VlQ29tbWVudDEyOTg3NzU2OQ==","user":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-11T13:43:03Z","updated_at":"2015-08-11T13:43:03Z","body":"Thanks! Would you please add a failing test? (And maybe you'd like to contribute a fix too? ;-)\nThe branch for development is `breaking-changes-1.0`.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/reduxjs/redux/issues/comments/129877569/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":379156663,"node_id":"MDEyOkxhYmVsZWRFdmVudDM3OTE1NjY2Mw==","url":"https://api.github.com/repos/reduxjs/redux/issues/events/379156663","actor":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2015-08-11T13:43:07Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"id":379199291,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM3OTE5OTI5MQ==","url":"https://api.github.com/repos/reduxjs/redux/issues/events/379199291","actor":{"login":"arian","id":109243,"node_id":"MDQ6VXNlcjEwOTI0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/109243?v=4","gravatar_id":"","url":"https://api.github.com/users/arian","html_url":"https://github.com/arian","followers_url":"https://api.github.com/users/arian/followers","following_url":"https://api.github.com/users/arian/following{/other_user}","gists_url":"https://api.github.com/users/arian/gists{/gist_id}","starred_url":"https://api.github.com/users/arian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arian/subscriptions","organizations_url":"https://api.github.com/users/arian/orgs","repos_url":"https://api.github.com/users/arian/repos","events_url":"https://api.github.com/users/arian/events{/privacy}","received_events_url":"https://api.github.com/users/arian/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2ddfd715c8313967db82ef2c957b69b7ff143bb8","commit_url":"https://api.github.com/repos/arian/redux/commits/2ddfd715c8313967db82ef2c957b69b7ff143bb8","created_at":"2015-08-11T14:17:10Z","performed_via_github_app":null},{"actor":{"login":"arian","id":109243,"node_id":"MDQ6VXNlcjEwOTI0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/109243?v=4","gravatar_id":"","url":"https://api.github.com/users/arian","html_url":"https://github.com/arian","followers_url":"https://api.github.com/users/arian/followers","following_url":"https://api.github.com/users/arian/following{/other_user}","gists_url":"https://api.github.com/users/arian/gists{/gist_id}","starred_url":"https://api.github.com/users/arian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arian/subscriptions","organizations_url":"https://api.github.com/users/arian/orgs","repos_url":"https://api.github.com/users/arian/repos","events_url":"https://api.github.com/users/arian/events{/privacy}","received_events_url":"https://api.github.com/users/arian/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-11T14:17:56Z","updated_at":"2015-08-11T14:17:56Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/reduxjs/redux/issues/462","repository_url":"https://api.github.com/repos/reduxjs/redux","labels_url":"https://api.github.com/repos/reduxjs/redux/issues/462/labels{/name}","comments_url":"https://api.github.com/repos/reduxjs/redux/issues/462/comments","events_url":"https://api.github.com/repos/reduxjs/redux/issues/462/events","html_url":"https://github.com/reduxjs/redux/pull/462","id":100322621,"node_id":"MDExOlB1bGxSZXF1ZXN0NDIxMzM3Mjc=","number":462,"title":"Fixes #461 - Copy listeners array, so subscribes can't affect the loop.","user":{"login":"arian","id":109243,"node_id":"MDQ6VXNlcjEwOTI0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/109243?v=4","gravatar_id":"","url":"https://api.github.com/users/arian","html_url":"https://github.com/arian","followers_url":"https://api.github.com/users/arian/followers","following_url":"https://api.github.com/users/arian/following{/other_user}","gists_url":"https://api.github.com/users/arian/gists{/gist_id}","starred_url":"https://api.github.com/users/arian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arian/subscriptions","organizations_url":"https://api.github.com/users/arian/orgs","repos_url":"https://api.github.com/users/arian/repos","events_url":"https://api.github.com/users/arian/events{/privacy}","received_events_url":"https://api.github.com/users/arian/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2015-08-11T14:17:41Z","updated_at":"2018-05-12T19:49:55Z","closed_at":"2015-08-11T14:25:28Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":36535156,"node_id":"MDEwOlJlcG9zaXRvcnkzNjUzNTE1Ng==","name":"redux","full_name":"reduxjs/redux","private":false,"owner":{"login":"reduxjs","id":13142323,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEzMTQyMzIz","avatar_url":"https://avatars.githubusercontent.com/u/13142323?v=4","gravatar_id":"","url":"https://api.github.com/users/reduxjs","html_url":"https://github.com/reduxjs","followers_url":"https://api.github.com/users/reduxjs/followers","following_url":"https://api.github.com/users/reduxjs/following{/other_user}","gists_url":"https://api.github.com/users/reduxjs/gists{/gist_id}","starred_url":"https://api.github.com/users/reduxjs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/reduxjs/subscriptions","organizations_url":"https://api.github.com/users/reduxjs/orgs","repos_url":"https://api.github.com/users/reduxjs/repos","events_url":"https://api.github.com/users/reduxjs/events{/privacy}","received_events_url":"https://api.github.com/users/reduxjs/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/reduxjs/redux","description":"A JS library for predictable global state management","fork":false,"url":"https://api.github.com/repos/reduxjs/redux","forks_url":"https://api.github.com/repos/reduxjs/redux/forks","keys_url":"https://api.github.com/repos/reduxjs/redux/keys{/key_id}","collaborators_url":"https://api.github.com/repos/reduxjs/redux/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/reduxjs/redux/teams","hooks_url":"https://api.github.com/repos/reduxjs/redux/hooks","issue_events_url":"https://api.github.com/repos/reduxjs/redux/issues/events{/number}","events_url":"https://api.github.com/repos/reduxjs/redux/events","assignees_url":"https://api.github.com/repos/reduxjs/redux/assignees{/user}","branches_url":"https://api.github.com/repos/reduxjs/redux/branches{/branch}","tags_url":"https://api.github.com/repos/reduxjs/redux/tags","blobs_url":"https://api.github.com/repos/reduxjs/redux/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/reduxjs/redux/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/reduxjs/redux/git/refs{/sha}","trees_url":"https://api.github.com/repos/reduxjs/redux/git/trees{/sha}","statuses_url":"https://api.github.com/repos/reduxjs/redux/statuses/{sha}","languages_url":"https://api.github.com/repos/reduxjs/redux/languages","stargazers_url":"https://api.github.com/repos/reduxjs/redux/stargazers","contributors_url":"https://api.github.com/repos/reduxjs/redux/contributors","subscribers_url":"https://api.github.com/repos/reduxjs/redux/subscribers","subscription_url":"https://api.github.com/repos/reduxjs/redux/subscription","commits_url":"https://api.github.com/repos/reduxjs/redux/commits{/sha}","git_commits_url":"https://api.github.com/repos/reduxjs/redux/git/commits{/sha}","comments_url":"https://api.github.com/repos/reduxjs/redux/comments{/number}","issue_comment_url":"https://api.github.com/repos/reduxjs/redux/issues/comments{/number}","contents_url":"https://api.github.com/repos/reduxjs/redux/contents/{+path}","compare_url":"https://api.github.com/repos/reduxjs/redux/compare/{base}...{head}","merges_url":"https://api.github.com/repos/reduxjs/redux/merges","archive_url":"https://api.github.com/repos/reduxjs/redux/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/reduxjs/redux/downloads","issues_url":"https://api.github.com/repos/reduxjs/redux/issues{/number}","pulls_url":"https://api.github.com/repos/reduxjs/redux/pulls{/number}","milestones_url":"https://api.github.com/repos/reduxjs/redux/milestones{/number}","notifications_url":"https://api.github.com/repos/reduxjs/redux/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/reduxjs/redux/labels{/name}","releases_url":"https://api.github.com/repos/reduxjs/redux/releases{/id}","deployments_url":"https://api.github.com/repos/reduxjs/redux/deployments","created_at":"2015-05-29T23:53:15Z","updated_at":"2025-11-09T19:40:57Z","pushed_at":"2025-10-30T02:18:33Z","git_url":"git://github.com/reduxjs/redux.git","ssh_url":"git@github.com:reduxjs/redux.git","clone_url":"https://github.com/reduxjs/redux.git","svn_url":"https://github.com/reduxjs/redux","homepage":"https://redux.js.org","size":34278,"stargazers_count":61392,"watchers_count":61392,"language":"TypeScript","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":true,"has_discussions":true,"forks_count":15190,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":46,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["redux"],"visibility":"public","forks":15190,"open_issues":46,"watchers":61392,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/reduxjs/redux/pulls/462","html_url":"https://github.com/reduxjs/redux/pull/462","diff_url":"https://github.com/reduxjs/redux/pull/462.diff","patch_url":"https://github.com/reduxjs/redux/pull/462.patch","merged_at":"2015-08-11T14:25:28Z"},"body":"Unsubscribing during a dispatch would change the listeners array.\nHowever that causes the next listener not to fire.\n\nFixes #461 \n","reactions":{"url":"https://api.github.com/repos/reduxjs/redux/issues/462/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/reduxjs/redux/issues/462/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":379209985,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM3OTIwOTk4NQ==","url":"https://api.github.com/repos/reduxjs/redux/issues/events/379209985","actor":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"d5942323048c08e544fd09969aec6678f3443274","commit_url":"https://api.github.com/repos/reduxjs/redux/commits/d5942323048c08e544fd09969aec6678f3443274","created_at":"2015-08-11T14:25:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/reduxjs/redux/issues/comments/130000562","html_url":"https://github.com/reduxjs/redux/issues/461#issuecomment-130000562","issue_url":"https://api.github.com/repos/reduxjs/redux/issues/461","id":130000562,"node_id":"MDEyOklzc3VlQ29tbWVudDEzMDAwMDU2Mg==","user":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-08-11T18:14:22Z","updated_at":"2015-08-11T18:14:22Z","body":"Fixed by #462.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/reduxjs/redux/issues/comments/130000562/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":379473366,"node_id":"MDExOkNsb3NlZEV2ZW50Mzc5NDczMzY2","url":"https://api.github.com/repos/reduxjs/redux/issues/events/379473366","actor":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2015-08-11T18:14:22Z","state_reason":null,"performed_via_github_app":null},{"id":388662832,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM4ODY2MjgzMg==","url":"https://api.github.com/repos/reduxjs/redux/issues/events/388662832","actor":{"login":"acstll","id":851105,"node_id":"MDQ6VXNlcjg1MTEwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/851105?v=4","gravatar_id":"","url":"https://api.github.com/users/acstll","html_url":"https://github.com/acstll","followers_url":"https://api.github.com/users/acstll/followers","following_url":"https://api.github.com/users/acstll/following{/other_user}","gists_url":"https://api.github.com/users/acstll/gists{/gist_id}","starred_url":"https://api.github.com/users/acstll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/acstll/subscriptions","organizations_url":"https://api.github.com/users/acstll/orgs","repos_url":"https://api.github.com/users/acstll/repos","events_url":"https://api.github.com/users/acstll/events{/privacy}","received_events_url":"https://api.github.com/users/acstll/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"30bcfe4f45f2917facc93c4c335cb6d361962631","commit_url":"https://api.github.com/repos/acstll/chopped-redux/commits/30bcfe4f45f2917facc93c4c335cb6d361962631","created_at":"2015-08-21T10:32:10Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/reduxjs/redux/issues/comments/161822662","html_url":"https://github.com/reduxjs/redux/issues/461#issuecomment-161822662","issue_url":"https://api.github.com/repos/reduxjs/redux/issues/461","id":161822662,"node_id":"MDEyOklzc3VlQ29tbWVudDE2MTgyMjY2Mg==","user":{"login":"xogeny","id":1498808,"node_id":"MDQ6VXNlcjE0OTg4MDg=","avatar_url":"https://avatars.githubusercontent.com/u/1498808?v=4","gravatar_id":"","url":"https://api.github.com/users/xogeny","html_url":"https://github.com/xogeny","followers_url":"https://api.github.com/users/xogeny/followers","following_url":"https://api.github.com/users/xogeny/following{/other_user}","gists_url":"https://api.github.com/users/xogeny/gists{/gist_id}","starred_url":"https://api.github.com/users/xogeny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xogeny/subscriptions","organizations_url":"https://api.github.com/users/xogeny/orgs","repos_url":"https://api.github.com/users/xogeny/repos","events_url":"https://api.github.com/users/xogeny/events{/privacy}","received_events_url":"https://api.github.com/users/xogeny/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-03T23:28:05Z","updated_at":"2015-12-03T23:28:05Z","body":"I have a question about this.  The idea is the copy the array so subscribes can't affect the loop.  But if the first listener unsubscribes a later listener, that won't be handled correctly.  The unsubscribed listener will be called one more time _after_ it was unsubscribed.\n\nIs that really the desired behavior?  I agree it is a tricky issue and I'm not 100% certain how to address that.  But before even trying to create a PR I wanted to take a step back and ask the \"big picture\" question of \"When do we expect an unsubscribe to be applied?\".  Specifically, how should this case where one listener unsubscribes a later listener? (one of many potential corner cases worth considering)\n\nAlthough not strictly relevant, I think it might be worth nothing that this is an issue with React because you can get into a situation (this is how I got here, in fact) where a component gets unsubscribed when it is unmounted.  But the listener is invoke on more time after the unsubscribe/unmounting and the listener calls `setState` which leads to a nasty message on the console.  I'm trying to avoid that situation.  In my case, I want the unsubscribe to be effective immediately because otherwise the listener will be called after the component is unmounted.\n\nThoughts?\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/reduxjs/redux/issues/comments/161822662/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"xogeny","id":1498808,"node_id":"MDQ6VXNlcjE0OTg4MDg=","avatar_url":"https://avatars.githubusercontent.com/u/1498808?v=4","gravatar_id":"","url":"https://api.github.com/users/xogeny","html_url":"https://github.com/xogeny","followers_url":"https://api.github.com/users/xogeny/followers","following_url":"https://api.github.com/users/xogeny/following{/other_user}","gists_url":"https://api.github.com/users/xogeny/gists{/gist_id}","starred_url":"https://api.github.com/users/xogeny/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xogeny/subscriptions","organizations_url":"https://api.github.com/users/xogeny/orgs","repos_url":"https://api.github.com/users/xogeny/repos","events_url":"https://api.github.com/users/xogeny/events{/privacy}","received_events_url":"https://api.github.com/users/xogeny/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":482096446,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ4MjA5NjQ0Ng==","url":"https://api.github.com/repos/reduxjs/redux/issues/events/482096446","actor":{"login":"mtiller","id":144876,"node_id":"MDQ6VXNlcjE0NDg3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/144876?v=4","gravatar_id":"","url":"https://api.github.com/users/mtiller","html_url":"https://github.com/mtiller","followers_url":"https://api.github.com/users/mtiller/followers","following_url":"https://api.github.com/users/mtiller/following{/other_user}","gists_url":"https://api.github.com/users/mtiller/gists{/gist_id}","starred_url":"https://api.github.com/users/mtiller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtiller/subscriptions","organizations_url":"https://api.github.com/users/mtiller/orgs","repos_url":"https://api.github.com/users/mtiller/repos","events_url":"https://api.github.com/users/mtiller/events{/privacy}","received_events_url":"https://api.github.com/users/mtiller/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"3a8d87985fd80bf34828556b2a439e033c4976a5","commit_url":"https://api.github.com/repos/xogeny/vada/commits/3a8d87985fd80bf34828556b2a439e033c4976a5","created_at":"2015-12-03T23:32:07Z","performed_via_github_app":null},{"actor":{"login":"fi3ework","id":12322740,"node_id":"MDQ6VXNlcjEyMzIyNzQw","avatar_url":"https://avatars.githubusercontent.com/u/12322740?v=4","gravatar_id":"","url":"https://api.github.com/users/fi3ework","html_url":"https://github.com/fi3ework","followers_url":"https://api.github.com/users/fi3ework/followers","following_url":"https://api.github.com/users/fi3ework/following{/other_user}","gists_url":"https://api.github.com/users/fi3ework/gists{/gist_id}","starred_url":"https://api.github.com/users/fi3ework/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fi3ework/subscriptions","organizations_url":"https://api.github.com/users/fi3ework/orgs","repos_url":"https://api.github.com/users/fi3ework/repos","events_url":"https://api.github.com/users/fi3ework/events{/privacy}","received_events_url":"https://api.github.com/users/fi3ework/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-31T08:59:25Z","updated_at":"2018-08-31T08:59:25Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/fi3ework/blog/issues/7","repository_url":"https://api.github.com/repos/fi3ework/blog","labels_url":"https://api.github.com/repos/fi3ework/blog/issues/7/labels{/name}","comments_url":"https://api.github.com/repos/fi3ework/blog/issues/7/comments","events_url":"https://api.github.com/repos/fi3ework/blog/issues/7/events","html_url":"https://github.com/fi3ework/blog/issues/7","id":294207197,"node_id":"MDU6SXNzdWUyOTQyMDcxOTc=","number":7,"title":"é€šè¿‡Github Blameæ·±å…¥åˆ†æReduxæºç ","user":{"login":"fi3ework","id":12322740,"node_id":"MDQ6VXNlcjEyMzIyNzQw","avatar_url":"https://avatars.githubusercontent.com/u/12322740?v=4","gravatar_id":"","url":"https://api.github.com/users/fi3ework","html_url":"https://github.com/fi3ework","followers_url":"https://api.github.com/users/fi3ework/followers","following_url":"https://api.github.com/users/fi3ework/following{/other_user}","gists_url":"https://api.github.com/users/fi3ework/gists{/gist_id}","starred_url":"https://api.github.com/users/fi3ework/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fi3ework/subscriptions","organizations_url":"https://api.github.com/users/fi3ework/orgs","repos_url":"https://api.github.com/users/fi3ework/repos","events_url":"https://api.github.com/users/fi3ework/events{/privacy}","received_events_url":"https://api.github.com/users/fi3ework/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":826636840,"node_id":"MDU6TGFiZWw4MjY2MzY4NDA=","url":"https://api.github.com/repos/fi3ework/blog/labels/Redux","name":"Redux","color":"7648ba","default":false,"description":null}],"state":"open","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-02-04T15:53:51Z","updated_at":"2019-07-30T01:55:04Z","closed_at":null,"author_association":"OWNER","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":119626166,"node_id":"MDEwOlJlcG9zaXRvcnkxMTk2MjYxNjY=","name":"blog","full_name":"fi3ework/blog","private":false,"owner":{"login":"fi3ework","id":12322740,"node_id":"MDQ6VXNlcjEyMzIyNzQw","avatar_url":"https://avatars.githubusercontent.com/u/12322740?v=4","gravatar_id":"","url":"https://api.github.com/users/fi3ework","html_url":"https://github.com/fi3ework","followers_url":"https://api.github.com/users/fi3ework/followers","following_url":"https://api.github.com/users/fi3ework/following{/other_user}","gists_url":"https://api.github.com/users/fi3ework/gists{/gist_id}","starred_url":"https://api.github.com/users/fi3ework/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fi3ework/subscriptions","organizations_url":"https://api.github.com/users/fi3ework/orgs","repos_url":"https://api.github.com/users/fi3ework/repos","events_url":"https://api.github.com/users/fi3ework/events{/privacy}","received_events_url":"https://api.github.com/users/fi3ework/received_events","type":"User","user_view_type":"public","site_admin":false},"html_url":"https://github.com/fi3ework/blog","description":"ğŸ“","fork":false,"url":"https://api.github.com/repos/fi3ework/blog","forks_url":"https://api.github.com/repos/fi3ework/blog/forks","keys_url":"https://api.github.com/repos/fi3ework/blog/keys{/key_id}","collaborators_url":"https://api.github.com/repos/fi3ework/blog/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/fi3ework/blog/teams","hooks_url":"https://api.github.com/repos/fi3ework/blog/hooks","issue_events_url":"https://api.github.com/repos/fi3ework/blog/issues/events{/number}","events_url":"https://api.github.com/repos/fi3ework/blog/events","assignees_url":"https://api.github.com/repos/fi3ework/blog/assignees{/user}","branches_url":"https://api.github.com/repos/fi3ework/blog/branches{/branch}","tags_url":"https://api.github.com/repos/fi3ework/blog/tags","blobs_url":"https://api.github.com/repos/fi3ework/blog/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/fi3ework/blog/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/fi3ework/blog/git/refs{/sha}","trees_url":"https://api.github.com/repos/fi3ework/blog/git/trees{/sha}","statuses_url":"https://api.github.com/repos/fi3ework/blog/statuses/{sha}","languages_url":"https://api.github.com/repos/fi3ework/blog/languages","stargazers_url":"https://api.github.com/repos/fi3ework/blog/stargazers","contributors_url":"https://api.github.com/repos/fi3ework/blog/contributors","subscribers_url":"https://api.github.com/repos/fi3ework/blog/subscribers","subscription_url":"https://api.github.com/repos/fi3ework/blog/subscription","commits_url":"https://api.github.com/repos/fi3ework/blog/commits{/sha}","git_commits_url":"https://api.github.com/repos/fi3ework/blog/git/commits{/sha}","comments_url":"https://api.github.com/repos/fi3ework/blog/comments{/number}","issue_comment_url":"https://api.github.com/repos/fi3ework/blog/issues/comments{/number}","contents_url":"https://api.github.com/repos/fi3ework/blog/contents/{+path}","compare_url":"https://api.github.com/repos/fi3ework/blog/compare/{base}...{head}","merges_url":"https://api.github.com/repos/fi3ework/blog/merges","archive_url":"https://api.github.com/repos/fi3ework/blog/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/fi3ework/blog/downloads","issues_url":"https://api.github.com/repos/fi3ework/blog/issues{/number}","pulls_url":"https://api.github.com/repos/fi3ework/blog/pulls{/number}","milestones_url":"https://api.github.com/repos/fi3ework/blog/milestones{/number}","notifications_url":"https://api.github.com/repos/fi3ework/blog/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/fi3ework/blog/labels{/name}","releases_url":"https://api.github.com/repos/fi3ework/blog/releases{/id}","deployments_url":"https://api.github.com/repos/fi3ework/blog/deployments","created_at":"2018-01-31T02:55:59Z","updated_at":"2025-10-24T09:16:06Z","pushed_at":"2019-07-07T06:43:02Z","git_url":"git://github.com/fi3ework/blog.git","ssh_url":"git@github.com:fi3ework/blog.git","clone_url":"https://github.com/fi3ework/blog.git","svn_url":"https://github.com/fi3ework/blog","homepage":"","size":21,"stargazers_count":854,"watchers_count":854,"language":null,"has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":50,"mirror_url":null,"archived":true,"disabled":false,"open_issues_count":40,"license":null,"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":50,"open_issues":40,"watchers":854,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"## è¯´æ˜\r\n\r\n**æœ¬æ–‡æ‰€åˆ†æçš„Reduxç‰ˆæœ¬ä¸º3.7.2**\r\n\r\nåˆ†æç›´æ¥å†™åœ¨äº†æ³¨é‡Šé‡Œï¼Œæ”¾åœ¨äº†GitHubä¸Š â€”> [ä»“åº“åœ°å€](https://github.com/fi3ework/redux-analysis)\r\n\r\nåˆ†æä»£ç æ—¶é€šè¿‡æŸ¥çœ‹Github blameï¼Œå‚è€ƒäº†Reduxçš„issueåŠPRæ¥åˆ†æå„ä¸ªå‡½æ•°çš„æ„å›¾è€Œä¸ä»…æ˜¯ä»ä»£ç å±‚é¢åˆ†æå‡½æ•°çš„ä½œç”¨ï¼Œå¹¶ä¸”åˆ†æäº†å¾ˆå¤šç»†èŠ‚å±‚é¢ä¸Šå†™æ³•çš„åŸå› ï¼Œæ¯”å¦‚ï¼š\r\n\r\n1. `dispatch: (...args) => dispatch(â€¦args)` ä¸ºä»€ä¹ˆä¸åªä¼ é€’ä¸€ä¸ª `action` ?\r\n\r\n2. `listener` çš„è°ƒç”¨ä¸ºä»€ä¹ˆä» `forEach` æ”¹æˆäº† `for` ?\r\n\r\n3. ä¸ºä»€ä¹ˆåœ¨ `reducer` çš„è°ƒç”¨è¿‡ç¨‹ä¸­ä¸å…è®¸ `dispatch(action)` ?\r\n\r\n   ...\r\n\r\næ°´å¹³æœ‰é™ï¼Œæœ‰å†™çš„ä¸å¥½æˆ–ä¸å¯¹çš„åœ°æ–¹è¯·æŒ‡å‡ºï¼Œæ¬¢è¿ç•™[issue](https://github.com/fi3ework/redux-analysis/issues)äº¤æµğŸ˜†\r\n\r\n## æ–‡ä»¶ç»“æ„\r\n\r\nReduxçš„æ–‡ä»¶ç»“æ„å¹¶ä¸å¤æ‚ï¼Œæ¯ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªå¯¹å¤–å¯¼å‡ºçš„å‡½æ•°ï¼Œä¾èµ–å¾ˆå°‘ï¼Œåˆ†æèµ·æ¥ä¹Ÿæ¯”è¾ƒå®¹æ˜“ï¼Œåªè¦ä¼šç”¨ReduxåŸºæœ¬ä¸Šéƒ½èƒ½çœ‹æ‡‚æœ¬æ–‡ã€‚\r\nè¿™æ˜¯Reduxçš„ç›®å½•ç»“æ„ï¼š\r\n```\r\n.\r\nâ”œâ”€â”€ applyMiddleware.js       å°†middlewareä¸²è”èµ·æ¥ç”Ÿæˆä¸€ä¸ªæ›´å¼ºå¤§çš„dispatchå‡½æ•°ï¼Œå°±æ˜¯ä¸­é—´ä»¶çš„æœ¬è´¨ä½œç”¨\r\nâ”œâ”€â”€ bindActionCreators.js    æŠŠaction creatorsè½¬æˆæ‹¥æœ‰åŒåkeysçš„å¯¹è±¡\r\nâ”œâ”€â”€ combineReducers.js       å°†å¤šä¸ªreducerç»„åˆèµ·æ¥ï¼Œæ¯ä¸€ä¸ªreducerç‹¬ç«‹ç®¡ç†è‡ªå·±å¯¹åº”çš„state\r\nâ”œâ”€â”€ compose.js               å°†middlewareä»å³å‘å·¦ä¾æ¬¡è°ƒç”¨ï¼Œå‡½æ•°å¼ç¼–ç¨‹ä¸­çš„å¸¸ç”¨æ–¹æ³•ï¼Œè¢«applyMiddlewareè°ƒç”¨\r\nâ”œâ”€â”€ createStore.js           æœ€æ ¸å¿ƒåŠŸèƒ½ï¼Œåˆ›å»ºä¸€ä¸ªstoreï¼ŒåŒ…æ‹¬å®ç°äº†subscribe, unsubscribe, dispatchåŠstateçš„å‚¨å­˜\r\nâ”œâ”€â”€ index.js                 å¯¹å¤–export\r\nâ””â”€â”€ utils                    ä¸€äº›å°çš„è¾…åŠ©å‡½æ•°ä¾›å…¶ä»–çš„å‡½æ•°è°ƒç”¨\r\nÂ Â  â”œâ”€â”€ actionTypes.js        reduxå†…ç½®çš„actionï¼Œç”¨æ¥åˆå§‹åŒ–initialState\r\n Â Â â”œâ”€â”€ isPlainObject.js      ç”¨æ¥åˆ¤æ–­æ˜¯å¦ä¸ºå•çº¯å¯¹è±¡\r\n Â Â â””â”€â”€ warning.js            æŠ¥é”™æç¤º\r\n\r\n```\r\n## æºç åˆ†æ\r\n\r\næºç åˆ†æçš„é¡ºåºæ¨èå¦‚ä¸‹ï¼Œå°±æ˜¯è·Ÿç€pipelineçš„é¡ºåºæ¥\r\n\r\n>  index.js -> createStore.js -> applyMiddleware.js (compose.js) -> combineReducers.js -> bindActionCreators.js\r\n\r\nä¸»é¢˜æ€è·¯æˆ‘ä¼šå†™å‡ºæ¥ï¼Œå¾ˆç»†èŠ‚çš„éƒ¨åˆ†å°±ç›´æ¥å†™åœ¨ä»£ç æ³¨é‡Šé‡Œäº†ã€‚\r\n\r\n### index\r\n\r\n```js\r\nfunction isCrushed () {}\r\n\r\n// å¦‚æœä½¿ç”¨minifiedçš„reduxä»£ç ä¼šé™ä½æ€§èƒ½ã€‚\r\n// è¿™é‡Œçš„isCrushedå‡½æ•°ä¸»è¦æ˜¯ä¸ºäº†éªŒè¯åœ¨éç”Ÿäº§ç¯å¢ƒä¸‹çš„reduxä»£ç æ˜¯å¦è¢«minified\r\n// å¦‚æœè¢«å‹ç¼©äº†é‚£ä¹ˆisCrushed.name !== 'isCrushed'\r\nif (\r\n  process.env.NODE_ENV !== 'production' &&\r\n  typeof isCrushed.name === 'string' && // æœ‰çš„æµè§ˆå™¨ï¼ˆIEï¼‰å¹¶ä¸æ”¯æŒFunction.nameï¼Œå¿…é¡»åˆ¤æ–­å…ˆåˆ¤æ–­æ˜¯å¦æ”¯æŒFunction.name,æ‰èƒ½åˆ¤æ–­æ˜¯å¦minified\r\n  isCrushed.name !== 'isCrushed'\r\n) {\r\n  warning(\r\n    \"...'\r\n  )\r\n}\r\n\r\nexport {\r\n  createStore,\r\n  combineReducers,\r\n  bindActionCreators,\r\n  applyMiddleware,\r\n  compose,\r\n  __DO_NOT_USE__ActionTypes\r\n}\r\n```\r\n\r\nåªæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š\r\n\r\n1. åŒºåˆ†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒ\r\n2. å¯¹å¤–æš´éœ²APIï¼Œç›¸å½“ç®€æ´ï¼Œå¸¸ç”¨çš„APIåªæœ‰äº”ä¸ª\r\n\r\n## createStore\r\n\r\ncreateStore ç”±äºæœ‰ä¸¤ç§ç”Ÿæˆ store çš„æ–¹æ³•ï¼Œæ‰€ä»¥èµ·æ‰‹å…ˆç¡®å®šå„ä¸ªå‚æ•°\r\n\r\n```js\r\n  // ä¼ é€’ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œå®é™…ä¼ é€’çš„æ˜¯ reducer å’Œ enhancerï¼ŒpreloadedState ä¸º undefined\r\n  if (typeof preloadedState === 'function' && typeof enhancer === 'undefined') {\r\n    enhancer = preloadedState\r\n    preloadedState = undefined\r\n  }\r\n\r\n  // ä¼ é€’ä¸‰ä¸ªå‚æ•°æ—¶ï¼Œä¼ é€’çš„æ˜¯ reducer preloadedState enhancerï¼ˆenhancerå¿…é¡»ä¸ºå‡½æ•°ï¼‰\r\n  if (typeof enhancer !== 'undefined') {\r\n    if (typeof enhancer !== 'function') {\r\n      throw new Error('Expected the enhancer to be a function.')\r\n    }\r\n    // å¦‚æœä¼ å…¥äº† enhancerï¼ˆä¸€ä¸ªç»„åˆ store creator çš„é«˜é˜¶å‡½æ•°ï¼‰åˆ™æ§åˆ¶åè½¬ï¼Œäº¤ç”±enhanceræ¥åŠ å¼ºè¦ç”Ÿæˆçš„store\r\n    // å†å¯¹è¿™ä¸ªåŠ å¼ºåçš„ store ä¼ é€’ reducer å’Œ preloadedState\r\n    return enhancer(createStore)(reducer, preloadedState)\r\n  }\r\n\r\n  // ä¼ å…¥çš„reducerå¿…é¡»æ˜¯ä¸€ä¸ªçº¯å‡½æ•°ï¼Œä¸”æ˜¯å¿…å¡«å‚æ•°\r\n  if (typeof reducer !== 'function') {\r\n    throw new Error('Expected the reducer to be a function.')\r\n  }\r\n```\r\n\r\nç„¶åå£°æ˜ä¸­é—´å˜é‡ï¼Œåé¢ä¼šè®²åˆ°è¿™äº›ä¸­é—´å˜é‡çš„ä½œç”¨\r\n\r\n```js\r\n  let currentReducer = reducer\r\n  let currentState = preloadedState\r\n  let currentListeners = []\r\n  let nextListeners = currentListeners\r\n  let isDispatching = false\r\n```\r\n\r\nç„¶åçœ‹æ€ä¹ˆè®¢é˜…ä¸€ä¸ªäº‹ä»¶ï¼Œå…¶å®è¿™å°±æ˜¯ä¸€ä¸ªå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œä½†æ˜¯å’Œæ™®é€šçš„å‘å¸ƒè®¢é˜…æ¨¡å¼ä¸åŒçš„æ˜¯ï¼Œ å¤šäº†ä¸€ä¸ª`ensureCanMutateNextListeners` å‡½æ•°ã€‚ æˆ‘å»ç¿»äº†ä¸€ä¸‹reduxçš„commit messageï¼Œæ‰¾åˆ°äº†å¯¹listeneråšæ·±æ‹·è´çš„åŸå› ï¼šhttps://github.com/reactjs/redux/issues/461ï¼Œç®€å•æ¥è¯´å°±æ˜¯åœ¨listenerä¸­å¯èƒ½æœ‰unsubscribeæ“ä½œï¼Œæ¯”å¦‚æœ‰3ä¸ªlistener(ä¸‹æ ‡0,1,2)ï¼Œåœ¨ç¬¬2ä¸ªlisteneræ‰§è¡Œæ—¶unsubscribeäº†è‡ªå·±ï¼Œé‚£ä¹ˆç¬¬3ä¸ªlistenerçš„ä¸‹æ ‡å°±å˜æˆäº†1ï¼Œä½†æ˜¯forå¾ªç¯ä¸‹ä¸€è½®çš„ä¸‹æ ‡æ˜¯2ï¼Œç¬¬3ä¸ªlistenerå°±è¢«è·³è¿‡äº†ï¼Œæ‰€ä»¥æ‰§è¡Œä¸€æ¬¡æ·±æ‹·è´ï¼Œå³ä½¿åœ¨listenerè¿‡ç¨‹ä¸­unsubscribeäº†ä¹Ÿæ˜¯æ›´æ”¹çš„nextListenersï¼ˆnextListenersä¼šå»æ·±æ‹·è´currentListenersï¼‰ã€‚å½“å‰æ‰§è¡Œçš„currentListenersä¸ä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„å¿«ç…§ã€‚\r\n\r\nreduxåœ¨æ‰§è¡Œsubscribeå’Œunsubscribeçš„æ—¶å€™éƒ½è¦æ‰§è¡ŒensureCanMutateNextListenersæ¥ç¡®å®šæ˜¯å¦è¦è¿›è¡Œä¸€æ¬¡æ·±æ‹·è´ï¼Œåªè¦æ‰§è¡Œdispatchï¼Œé‚£ä¹ˆå°±ä¼šè¢«`const listeners = (currentListeners = nextListeners)`ï¼Œæ‰€ä»¥currentListeners === nextListenersï¼Œä¹‹åçš„subscribeå’Œunsubscribeå°±å¿…é¡»æ·±æ‹·è´ä¸€æ¬¡ï¼Œ å¦åˆ™å¯ä»¥ä¸€ç›´å¯¹nextListenersæ“ä½œè€Œä¸éœ€è¦ä¸ºcurrentListenersæ‹·è´èµ‹å€¼ï¼Œå³åªåœ¨å¿…è¦æ—¶æ‹·è´ã€‚\r\n\r\n```js\r\n  function subscribe (listener) {\r\n    // ä¼ å…¥çš„listenerå¿…é¡»æ˜¯ä¸€ä¸ªå¯ä»¥è°ƒç”¨çš„å‡½æ•°ï¼Œå¦åˆ™æŠ¥é”™\r\n    if (typeof listener !== 'function') {\r\n      throw new Error('Expected listener to be a function.')\r\n    }\r\n    // åŒä¸Šï¼Œä¿è¯çº¯å‡½æ•°ä¸å¸¦æ¥å‰¯ä½œç”¨\r\n    if (isDispatching) {\r\n      throw new Error(\r\n        '...'\r\n      )\r\n    }\r\n\r\n    let isSubscribed = true\r\n\r\n    // åœ¨æ¯æ¬¡subscribeçš„æ—¶å€™ï¼ŒnextListenerxå…ˆæ‹·è´currentListenersï¼Œå†pushæ–°çš„listener\r\n    ensureCanMutateNextListeners()\r\n    nextListeners.push(listener)\r\n\r\n    return function unsubscribe () {\r\n      if (!isSubscribed) {\r\n        return\r\n      }\r\n\r\n      // åŒä¸Šï¼Œä¿è¯çº¯å‡½æ•°ä¸å¸¦æ¥å‰¯ä½œç”¨\r\n      if (isDispatching) {\r\n        throw new Error(\r\n          '...'\r\n        )\r\n      }\r\n\r\n      isSubscribed = false\r\n\r\n      // åœ¨æ¯æ¬¡unsubscribeçš„æ—¶å€™ï¼Œæ·±æ‹·è´ä¸€æ¬¡currentListenersï¼Œå†å¯¹nextListenerså–æ¶ˆè®¢é˜…å½“å‰listener\r\n      ensureCanMutateNextListeners()\r\n      // ä»nextListenersä¸­å»æ‰unsubscribeçš„listener\r\n      const index = nextListeners.indexOf(listener)\r\n      nextListeners.splice(index, 1)\r\n    }\r\n  }\r\n```\r\n\r\næ¥ä¸‹æ¥çœ‹ dispatch è¿™ä¸ªå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æ¯æ¬¡dispatchæ—¶ä¼š`const listeners = (currentListeners = nextListeners)`ï¼Œä¸ºå¯èƒ½åˆ°æ¥çš„mutateNextListeneråšå¥½å‡†å¤‡ã€‚\r\n\r\n```js\r\n  function dispatch (action) {\r\n    // actionå¿…é¡»æ˜¯ä¸€ä¸ªplain objectï¼Œå¦‚æœæƒ³è¦èƒ½å¤„ç†ä¼ è¿›æ¥çš„å‡½æ•°çš„è¯å¿…é¡»ä½¿ç”¨ä¸­é—´ä»¶ï¼ˆredux-thunkç­‰ï¼‰\r\n    if (!isPlainObject(action)) {\r\n      throw new Error(\r\n        'Actions must be plain objects. ' +\r\n          'Use custom middleware for async actions.'\r\n      )\r\n    }\r\n    // actionå¿…é¡»å®šä¹‰typeå±æ€§\r\n    if (typeof action.type === 'undefined') {\r\n      throw new Error(\r\n        'Actions may not have an undefined \"type\" property. ' +\r\n          'Have you misspelled a constant?'\r\n      )\r\n    }\r\n    // åŒä¸Šï¼Œä¿è¯çº¯å‡½æ•°ä¸å¸¦æ¥å‰¯ä½œç”¨\r\n    if (isDispatching) {\r\n      throw new Error('Reducers may not dispatch actions.')\r\n    }\r\n    // currentReducerä¸å¯é¢„æ–™æ˜¯å¦ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥tryï¼Œä½†ä¸catch\r\n    try {\r\n      isDispatching = true\r\n      currentState = currentReducer(currentState, action)\r\n    } finally {\r\n      // å¿…é¡»åœ¨ç»“æŸçš„æ—¶å€™å°†isDispatchingå½’ä½\r\n      isDispatching = false\r\n    }\r\n\r\n    // åœ¨è¿™é‡Œä½“ç°äº†currentListenerså’ŒnextListenersçš„ä½œç”¨\r\n    const listeners = (currentListeners = nextListeners)\r\n    // è¿™é‡Œä½¿ç”¨forè€Œä¸æ˜¯forEachï¼Œæ˜¯å› ä¸ºlistenersæ˜¯æˆ‘ä»¬è‡ªå·±åˆ›é€ çš„ï¼Œä¸å­˜åœ¨ç¨€ç–ç»„çš„æƒ…å†µï¼Œæ‰€æœ‰ç›´æ¥ç”¨foræ€§èƒ½æ¥å¾—æ›´å¥½\r\n    // è§ https://github.com/reactjs/redux/commit/5b586080b43ca233f78d56cbadf706c933fefd19\r\n    // é™„ä¸ŠDançš„åŸè¯ï¼šThis is an optimization because forEach() has more complicated logic per spec to deal with sparse arrays. Also it's better to not allocate a function when we can easily avoid that.\r\n    // è¿™é‡Œæ²¡æœ‰ç¼“å­˜listeners.lengthï¼ŒDanç›¸ä¿¡V8è¶³å¤Ÿæ™ºèƒ½ä¼šè‡ªåŠ¨ç¼“å­˜ï¼Œç›¸æ¯”æ‰‹å·¥ç¼“å­˜æ€§èƒ½æ›´å¥½\r\n    for (let i = 0; i < listeners.length; i++) {\r\n      // è¿™é‡Œå°†listenerå•ç‹¬æ–°å»ºä¸€ä¸ªå˜é‡è€Œä¸æ˜¯listener[i]()\r\n      // æ˜¯å› ä¸ºç›´æ¥listeners[i]()ä¼šæŠŠlistenersä½œä¸ºthisæ³„æ¼ï¼Œè€Œèµ‹å€¼ä¸ºlistener()åthisæŒ‡å‘å…¨å±€å˜é‡\r\n      // https://github.com/reactjs/redux/commit/8e82c15f1288a0a5c5c886ffd87e7e73dc0103e1\r\n      const listener = listeners[i]\r\n      listener()\r\n    }\r\n\r\n    return action\r\n  }\r\n```\r\n\r\næ¥ä¸‹æ¥çœ‹`getState`ï¼Œå°±æ˜¯ä¸€ä¸ªreturn\r\n\r\n```js\r\n  function getState () {\r\n    // å‚è€ƒï¼šhttps://github.com/reactjs/redux/issues/1568\r\n    // ä¸ºäº†ä¿æŒreducerçš„pureï¼Œç¦æ­¢åœ¨reducerä¸­è°ƒç”¨getState\r\n    // çº¯å‡½æ•°reducerè¦æ±‚æ ¹æ®ä¸€å®šçš„è¾“å…¥å³èƒ½å¾—åˆ°ç¡®å®šçš„è¾“å‡ºï¼Œæ‰€ä»¥ç¦æ­¢äº†getState,subscribe,unsubscribeå’Œdispatchç­‰ä¼šå¸¦æ¥å‰¯ä½œç”¨çš„è¡Œä¸º\r\n    if (isDispatching) {\r\n      throw new Error(\r\n        'You may not call store.getState() while the reducer is executing. ' +\r\n          'The reducer has already received the state as an argument. ' +\r\n          'Pass it down from the top reducer instead of reading it from the store.'\r\n      )\r\n    }\r\n\r\n    return currentState\r\n  }\r\n```\r\n\r\nobservableå‡½æ•°ï¼Œè¿™ä¸ªæ˜¯ä¸ºäº†é…åˆRxJSä½¿ç”¨ï¼Œå¦‚æœä¸ä½¿ç”¨RxJSå¯ä»¥å¿½ç•¥ï¼Œåœ¨è¿™é‡Œç•¥è¿‡ã€‚\r\n\r\nreplaceReducerå‡½æ•°æ˜¯æ›¿æ¢æ•´ä¸ªstoreçš„reducerï¼Œä¸€èˆ¬ä¸ç»å¸¸ç”¨åˆ°ï¼Œä»£ç ä¹Ÿå«ç®€å•ï¼Œæ¢ä¸ªreduceré‡æ–°initä¸€ä¸‹\r\n\r\n```js\r\n  function replaceReducer (nextReducer) {\r\n    if (typeof nextReducer !== 'function') {\r\n      throw new Error('Expected the nextReducer to be a function.')\r\n    }\r\n\r\n    currentReducer = nextReducer\r\n    // ActionTypes.REPLACEå…¶å®å°±æ˜¯ActionTypes.INIT\r\n    // é‡æ–°INITä¾æ¬¡æ˜¯ä¸ºäº†è·å–æ–°çš„reducerä¸­çš„é»˜è®¤å‚æ•°\r\n    dispatch({ type: ActionTypes.REPLACE })\r\n  }\r\n```\r\n\r\næœ€åï¼Œæš´éœ²çš„æ¥å£çš„åŠŸèƒ½éƒ½å·²ç»å…·å¤‡äº†ï¼Œè¿˜éœ€è¦å–ä¸€ä¸‹é»˜è®¤å€¼ï¼Œä½ å¯èƒ½ä¼šè¯´ä¸æ˜¯å·²ç»æœ‰preloadedStateäº†å—ä½†æ˜¯é»˜è®¤å€¼ä¸æ˜¯åªæœ‰ä¸€ä¸ªçš„ï¼Œæ¯ä¸ªreduceréƒ½å¯ä»¥æŒ‡å®šå¯¹åº”éƒ¨åˆ†çš„stateçš„é»˜è®¤å€¼ï¼Œé‚£äº›é»˜è®¤å€¼éœ€è¦å…ˆç»è¿‡ä¸€ä¸ªactionçš„æ´—ç¤¼æ‰å¯ä»¥è¢«èµ‹å€¼ï¼Œè¿˜è®°å¾—reducerè¦æ±‚æ¯ä¸ªä¸å¯è¯†åˆ«çš„action.typeè¿”å›åŸå§‹stateå—ï¼Ÿå°±æ˜¯ä¸ºäº†å–å¾—é»˜è®¤å€¼ã€‚\r\n\r\n```js\r\n  // reducerè¦æ±‚å¯¹æ— æ³•è¯†åˆ«çš„actionè¿”å›stateï¼Œå°±æ˜¯å› ä¸ºéœ€è¦é€šè¿‡ActionTypes.INITè·å–é»˜è®¤å‚æ•°å€¼å¹¶è¿”å›\r\n  // å½“initailStateå’Œreducerçš„å‚æ•°é»˜è®¤å€¼éƒ½å­˜åœ¨çš„æ—¶å€™ï¼Œå‚æ•°é»˜è®¤å€¼å°†ä¸èµ·ä½œç”¨\r\n  // å› ä¸ºåœ¨è°ƒç”¨åˆå§‹åŒ–çš„actionå‰currStateå°±å·²ç»è¢«èµ‹å€¼äº†initialState\r\n  // åŒæ—¶è¿™ä¸ªinitialStateä¹Ÿæ˜¯æœåŠ¡ç«¯æ¸²æŸ“çš„åˆå§‹çŠ¶æ€å…¥å£\r\n  dispatch({ type: ActionTypes.INIT })\r\n```\r\n\r\nä¸ºäº†ä¿è¯è¿™ä¸ªtypeæ˜¯æ— æ³•è¯†åˆ«çš„ï¼Œè¢«å®šä¹‰æˆäº†ä¸€ä¸ªéšæœºå€¼\r\n\r\n```js\r\nconst ActionTypes = {\r\n  // INITå’ŒREPLACEä¸€æ¨¡ä¸€æ ·ï¼Œåªæ˜¯å«ä¹‰ä¸åŒï¼ŒREPLACEå…¶å®å°±æ˜¯INIT\r\n  INIT:\r\n    '@@redux/INIT' +\r\n    Math.random()\r\n      .toString(36)\r\n      .substring(7)\r\n      .split('')\r\n      .join('.'),\r\n  REPLACE:\r\n    '@@redux/REPLACE' +\r\n    Math.random()\r\n      .toString(36)\r\n      .substring(7)\r\n      .split('')\r\n      .join('.')\r\n}\r\n```\r\n\r\nè‡³æ­¤ï¼Œæˆ‘ä»¬çš„å·²ç»èƒ½å¤ŸcreateStoreï¼ŒgetStateï¼Œsubscribeï¼Œunsubscribeï¼Œdispatchäº†\r\n\r\n### combineReducer\r\n\r\ncombineReducerçš„ä»£ç æŒºé•¿çš„ï¼Œä½†æ˜¯ä¸»è¦éƒ½æ˜¯ç”¨æ¥æ£€æŸ¥é”™è¯¯äº†ï¼Œæ ¸å¿ƒä»£ç å°±æ˜¯å°†è¦åˆå¹¶çš„ä»£ç ç»„ç»‡ç»„ç»‡æˆä¸€ä¸ªæ ‘ç»“æ„ï¼Œç„¶åå°†ä¼ å…¥çš„reduceæŒ¨ä¸ªè·‘actionï¼Œè·‘å‡ºçš„æ–°çš„stateæ›¿æ¢æ‰åŸæ¥çš„stateï¼Œå› ä¸ºæ— æ³•è¯†åˆ«çš„actionä¼šè¿”å›åŸæ¥çš„stateï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ— å…³çš„reducerä¼šè¿”å›ç›¸åŒå¼•ç”¨çš„stateï¼Œåªæœ‰çœŸæ­£æ•è·actionçš„reducerä¼šè¿”å›æ–°çš„stateï¼Œè¿™æ ·åšåˆ°äº†å±€éƒ¨æ›´æ–°ï¼Œå¦åˆ™æ¯æ¬¡stateçš„ä¸€éƒ¨åˆ†æ›´æ–°å¯¼è‡´æ‰€æœ‰çš„stateéƒ½åŸåœ°æ·±æ‹·è´ä¸€æ¬¡å°±éº»çƒ¦äº†ã€‚\r\n\r\n```js\r\nexport default function combineReducers (reducers) {\r\n  // ç¬¬ä¸€æ¬¡ç­›é€‰ï¼šå°†reducersä¸­ä¸ºfunctionçš„å±æ€§èµ‹å€¼ç»™finalReducers\r\n  const reducerKeys = Object.keys(reducers)\r\n  const finalReducers = {}\r\n  for (let i = 0; i < reducerKeys.length; i++) {\r\n    const key = reducerKeys[i]\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      if (typeof reducers[key] === 'undefined') {\r\n        warning(`No reducer provided for key \"${key}\"`)\r\n      }\r\n    }\r\n\r\n    if (typeof reducers[key] === 'function') {\r\n      finalReducers[key] = reducers[key]\r\n    }\r\n  }\r\n  const finalReducerKeys = Object.keys(finalReducers)\r\n\r\n  let unexpectedKeyCache\r\n  if (process.env.NODE_ENV !== 'production') {\r\n    unexpectedKeyCache = {}\r\n  }\r\n\r\n  // ç”¨æ¥æ£€æŸ¥reduceræ˜¯å¦ä¼šè¿”å›undefined\r\n  // å› ä¸ºcombineReducersæœ‰å¯èƒ½ä¼šåµŒå¥—å¤šå±‚ï¼Œå½“åµŒå¥—çš„æŸä¸€å±‚å¦‚æœè¿”å›undefined\r\n  // é‚£ä¹ˆå½“è®¿é—®è¿™ä¸€å±‚çš„å­reducerçš„æ—¶å€™å°±ä¼šå‘ç”ŸTypeErrorçš„é”™è¯¯\r\n  let shapeAssertionError\r\n  try {\r\n    assertReducerShape(finalReducers)\r\n  } catch (e) {\r\n    shapeAssertionError = e\r\n  }\r\n\r\n  // combinationï¼šç»„åˆèµ·æ¥çš„reducer\r\n  return function combination (state = {}, action) {\r\n    // å¦‚æœä¹‹å‰çš„reduceræ£€æŸ¥ä¸åˆæ³•ï¼Œåˆ™throwé”™è¯¯\r\n    if (shapeAssertionError) {\r\n      throw shapeAssertionError\r\n    }\r\n\r\n    // æ£€æŸ¥excepted stateå¹¶æ‰“å°é”™è¯¯\r\n    if (process.env.NODE_ENV !== 'production') {\r\n      const warningMessage = getUnexpectedStateShapeWarningMessage(\r\n        state,\r\n        finalReducers,\r\n        action,\r\n        unexpectedKeyCache\r\n      )\r\n      if (warningMessage) {\r\n        warning(warningMessage)\r\n      }\r\n    }\r\n\r\n    //\r\n    let hasChanged = false\r\n    const nextState = {}\r\n    for (let i = 0; i < finalReducerKeys.length; i++) {\r\n      const key = finalReducerKeys[i]\r\n      const reducer = finalReducers[key]\r\n      const previousStateForKey = state[key]\r\n      const nextStateForKey = reducer(previousStateForKey, action)\r\n      // ä¸å…è®¸ä»»ä½•actionè¿”å›undefined\r\n      if (typeof nextStateForKey === 'undefined') {\r\n        const errorMessage = getUndefinedStateErrorMessage(key, action)\r\n        throw new Error(errorMessage)\r\n      }\r\n      nextState[key] = nextStateForKey\r\n      hasChanged = hasChanged || nextStateForKey !== previousStateForKey\r\n    }\r\n    return hasChanged ? nextState : state\r\n  }\r\n\r\n```\r\n\r\n### bindActionCreators\r\n\r\nè¿™ä¸ªç”¨çš„ä¸å¤šï¼Œä¸€èˆ¬æ˜¯ä¸ºäº†æ–¹ä¾¿ï¼Œç›´æ¥`import *`æ¥å¼•å…¥å¤šä¸ªactionCreatorsï¼ŒåŸç†å¾ˆç®€å•ï¼šå®é™…ä¸Šå°±æ˜¯è¿”å›ä¸€ä¸ªé«˜é˜¶å‡½æ•°ï¼Œé€šè¿‡é—­åŒ…å¼•ç”¨ï¼Œå°† dispatch ç»™éšè—äº†èµ·æ¥ï¼Œæ­£å¸¸æ“ä½œæ˜¯å‘èµ·ä¸€ä¸ª dispatch(action)ï¼Œä½†bindActionCreators å°† dispatch éšè—ï¼Œå½“æ‰§è¡ŒbindActionCreatorsè¿”å›çš„å‡½æ•°æ—¶ï¼Œå°±ä¼šdispatch(actionCreators(...arguments))ã€‚æ‰€ä»¥å‚æ•°å«åš actionCreatorsï¼Œä½œç”¨æ˜¯è¿”å›ä¸€ä¸ª action\r\nå¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡é‡Œæœ‰å¤šä¸ª actionCreators çš„è¯ï¼Œå°±ä¼šç±»ä¼¼ map å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹åº”çš„å¯¹è±¡ï¼Œæ¯ä¸ª key å¯¹åº”çš„ value å°±æ˜¯ä¸Šé¢æ‰€è¯´çš„è¢«ç»‘å®šäº†çš„å‡½æ•°ã€‚\r\n\r\n```js\r\n// çœŸæ­£éœ€è¦è·å–å‚æ•°çš„å‡½æ•°è¢«æŸ¯é‡ŒåŒ–äº†èµ·æ¥\r\nfunction bindActionCreator (actionCreator, dispatch) {\r\n  // é«˜é˜¶å‡½æ•°ï¼Œé—­åŒ…å¼•ç”¨ dispatch\r\n  return function () {\r\n    return dispatch(actionCreator.apply(this, arguments))\r\n  }\r\n}\r\n\r\n\r\n\r\nexport default function bindActionCreators (actionCreators, dispatch) {\r\n  // å¦‚æœæ˜¯actionCreatorsæ˜¯å‡½æ•°ï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨ï¼Œæ¯”å¦‚æ˜¯ä¸ªéœ€è¦è¢«thunkçš„å‡½æ•°\b\r\n  if (typeof actionCreators === 'function') {\r\n    return bindActionCreator(actionCreators, dispatch)\r\n  }\r\n\r\n  if (typeof actionCreators !== 'object' || actionCreators === null) {\r\n    throw new Error(\r\n      `...`\r\n    )\r\n  }\r\n\r\n  const keys = Object.keys(actionCreators)\r\n  const boundActionCreators = {}\r\n  for (let i = 0; i < keys.length; i++) {\r\n    const key = keys[i]\r\n    const actionCreator = actionCreators[key]\r\n    if (typeof actionCreator === 'function') {\r\n      // æ¯ä¸ª key å†æ¬¡è°ƒç”¨ä¸€æ¬¡ bindActionCreator\r\n      boundActionCreators[key] = bindActionCreator(actionCreator, dispatch)\r\n    }\r\n  }\r\n  // map åçš„å¯¹è±¡\r\n  return boundActionCreators\r\n}\r\n```\r\n\r\n## applyMiddleware \r\n\r\nç²¾é«“æ¥äº†ï¼Œè¿™ä¸ªå‡½æ•°æœ€çŸ­ä½†æ˜¯æœ€ç²¾é«“ï¼Œè¿™ä¸ª middleware çš„æ´‹è‘±æ¨¡å‹çš„æ€æƒ³æ˜¯ä»koaçš„ä¸­é—´ä»¶æ‹¿è¿‡æ¥çš„ï¼Œæˆ‘æ²¡çœ‹è¿‡koaçš„ä¸­é—´ä»¶ï¼ˆå› ä¸ºæˆ‘è¿koaéƒ½æ²¡ç”¨è¿‡...ï¼‰ï¼Œä½†æ˜¯é‡è¦çš„æ˜¯æ€æƒ³ã€‚\r\n\r\næ”¾ä¸Šreduxçš„æ´‹è‘±æ¨¡å‹çš„ç¤ºæ„å›¾ï¼ˆvia [ä¸­é—´ä»¶çš„æ´‹è‘±æ¨¡å‹](https://github.com/kenberkeley/redux-simple-tutorial/blob/master/middleware-onion-model.md?1524474265778)ï¼‰\r\n\r\n```\r\n            --------------------------------------\r\n            |            middleware1              |\r\n            |    ----------------------------     |\r\n            |    |       middleware2         |    |\r\n            |    |    -------------------    |    |\r\n            |    |    |  middleware3    |    |    |\r\n            |    |    |                 |    |    |\r\n          next next next  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”   |    |    |\r\ndispatch  â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”> |  reducer  | â€” æ”¶å°¾å·¥ä½œ->|\r\nnextState <â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” |     G     |  |    |    |\r\n            | A  | C  | E â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” F |  D |  B |\r\n            |    |    |                 |    |    |\r\n            |    |    -------------------    |    |\r\n            |    ----------------------------     |\r\n            --------------------------------------\r\n\r\n\r\né¡ºåº A -> C -> E -> G -> F -> D -> B\r\n    \\---------------/   \\----------/\r\n            â†“                â†“\r\n      æ›´æ–° state å®Œæ¯•      æ”¶å°¾å·¥ä½œ\r\n```\r\n\r\nå•ç‹¬ç†è§£å¤ªæ™¦æ¶©ï¼Œæ”¾ä¸€ä¸ªæœ€ç®€å•çš„`redux-thunk`å¸®åŠ©ç†è§£ã€‚\r\n\r\nredux-thunk:\r\n\r\n```js\r\nfunction createThunkMiddleware(extraArgument) {\r\n  return ({ dispatch, getState }) => next => action => {\r\n    if (typeof action === 'function') {\r\n      return action(dispatch, getState, extraArgument);\r\n    }\r\n      \r\n    return next(action);\r\n  };\r\n}\r\n\r\nconst thunk = createThunkMiddleware();\r\nthunk.withExtraArgument = createThunkMiddleware;\r\n\r\nexport default thunk;\r\n```\r\n\r\næœ€éš¾ç†è§£çš„å°±æ˜¯é‚£ä¸‰ä¸ªæŸ¯é‡ŒåŒ–ç®­å¤´ï¼Œè¿™ä¸‰ä¸ªç®­å¤´ç›¸å½“äºæ¬ äº†çœŸæ­£çš„middlewareå®ä½“ä¸‰ä¸ªå‚æ•°`{dispatch, getState}`ï¼Œ `next`ï¼Œ `action`ï¼Œä½œä¸ºä¸€ä¸ªä¸­é—´ä»¶ï¼Œå°±æ˜¯å°†è¿™å‡ ä¸ªåƒç®¡é“ä¸€æ ·åœ¨å„ä¸ªä¸­é—´ä»¶ä¸­ä¼ é€’ï¼Œä¸æ­¤åŒæ—¶åŠ ä¸Šä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚åç»­ç®¡é“çš„èµ°å‘æˆ–è€…å‘èµ·å¼‚æ­¥è¯·æ±‚ç­‰ç­‰ã€‚\r\n\r\né‚£ä¹ˆå¼€å§‹çœ‹æ¬ çš„è¿™ä¸‰ä¸ªå‚æ•°æ˜¯æ€ä¹ˆè¿˜ç»™ä¸­é—´ä»¶çš„ï¼Œä»£ç ä¸é•¿ï¼Œæ‰€ä»¥ç›´æ¥å†™åœ¨æ³¨é‡Šé‡Œäº†ï¼Œä¸€è¡Œä¸€è¡Œçœ‹å°±å¯ä»¥ã€‚\r\n\r\napplyMiddlewareï¼š\r\n\r\n```js\r\nexport default function applyMiddleware (...middlewares) {\r\n  // ä¼ å…¥createStore\r\n  return createStore => (...args) => {\r\n    // å…ˆç”¨ä¼ å…¥çš„createStoreæ¥åˆ›å»ºä¸€ä¸ªæœ€æ™®é€šçš„store\r\n    const store = createStore(...args)\r\n    // åˆå§‹åŒ–dispatchï¼Œè®°ä½è¿™ä¸ªdispatchæ˜¯æœ€ç»ˆæˆ‘ä»¬è¦å°†å„ä¸ªä¸­é—´ä»¶ä¸²è”èµ·æ¥çš„dispatch\r\n    let dispatch = () => {\r\n      throw new Error(\r\n        `Dispatching while constructing your middleware is not allowed. ` +\r\n          `Other middleware would not be applied to this dispatch.`\r\n      )\r\n    }\r\n    // å‚¨å­˜å°†è¦è¢«ä¸²è”èµ·æ¥çš„ä¸­é—´ä»¶ï¼Œå‡½æ•°ç­¾åä¸ºnext => action => {...}\r\n    // ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ä½œä¸ºnextä¼ è¿›å»ï¼Œè¢«å½“å‰ä¸­é—´ä»¶è°ƒç”¨\r\n    let chain = []\r\n\r\n    const middlewareAPI = {\r\n      getState: store.getState,\r\n        \r\n      // åœ¨è¿™é‡Œdispatchä½¿ç”¨åŒ¿åå‡½æ•°æ˜¯ä¸ºäº†èƒ½åœ¨middlewareä¸­è°ƒç”¨æœ€æ–°çš„dispatchï¼ˆé—­åŒ…ï¼‰ï¼š\r\n      // å¿…é¡»æ˜¯åŒ¿åå‡½æ•°è€Œä¸æ˜¯ç›´æ¥å†™æˆdispatch: store.dispatch\r\n      // è¿™æ ·èƒ½ä¿è¯åœ¨middlewareä¸­ä¼ å…¥çš„dispatchéƒ½é€šè¿‡é—­åŒ…å¼•ç”¨ç€æœ€ç»ˆcomposeå‡ºæ¥çš„dispatch\r\n      // å¦‚æœç›´æ¥å†™æˆstore.dispatchï¼Œåœ¨`dispatch = compose(...chain)(store.dispatch)`ä¸­\r\n      // middlewareAPI.dispatchå¹¶æ²¡æœ‰å¾—åˆ°æ›´æ–°ï¼Œä¾æ—§æ˜¯æœ€è€çš„ï¼Œåªæœ‰åœ¨æœ€åæ‰å¾—åˆ°äº†æ›´æ–°\r\n      // ä½†æ˜¯æˆ‘ä»¬è¦ä¿è¯åœ¨æ•´ä¸ªä¸­é—´ä»¶çš„è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œä»»ä½•ä¸­é—´ä»¶è°ƒç”¨çš„éƒ½æ˜¯æœ€ç»ˆçš„dispatch\r\n      // æˆ‘å†™äº†ä¸ªæ¨¡æ‹Ÿçš„è°ƒç”¨ï¼Œå¯ä»¥åœ¨ http://jsbin.com/fezitiwike/edit?js,console ä¸Šæ„Ÿå—ä¸€ä¸‹\r\n\r\n      // è¿˜æœ‰ï¼Œè¿™é‡Œä½¿ç”¨äº†...argsè€Œä¸æ˜¯actionï¼Œæ˜¯å› ä¸ºæœ‰ä¸ªPR https://github.com/reactjs/redux/pull/2560\r\n      // è¿™ä¸ªPRçš„ä½œè€…è®¤ä¸ºåœ¨dispatchæ—¶éœ€è¦æä¾›å¤šä¸ªå‚æ•°ï¼Œåƒè¿™æ ·`dispatch(action, option)`\r\n      // è¿™ç§æƒ…å†µç¡®å®å­˜åœ¨ï¼Œä½†æ˜¯åªæœ‰å½“è¿™ä¸ªéœ€æä¾›å¤šå‚æ•°çš„ä¸­é—´ä»¶æ˜¯ç¬¬ä¸€ä¸ªè¢«è°ƒç”¨çš„ä¸­é—´ä»¶æ—¶ï¼ˆå³åœ¨middlewaresæ•°ç»„ä¸­æ’æœ€åï¼‰æ‰æœ‰æ•ˆ\r\n      // å› ä¸ºæ— æ³•ä¿è¯ä¸Šä¸€ä¸ªè°ƒç”¨è¿™ä¸ªå¤šå‚æ•°ä¸­é—´ä»¶çš„ä¸­é—´ä»¶æ˜¯ä½¿ç”¨çš„next(action)æˆ–æ˜¯next(...args)æ¥è°ƒç”¨\r\n      // åœ¨è¿™ä¸ªPRçš„è®¨è®ºä¸­å¯ä»¥çœ‹åˆ°Danå¯¹è¿™ä¸ªæ”¹åŠ¨æŒä¿ç•™æ„è§\r\n      dispatch: (...args) => dispatch(...args)\r\n    }\r\n    // è¿˜äº† {dispatch, getState}\r\n    chain = middlewares.map(middleware => middleware(middlewareAPI))\r\n    // è¿˜äº† next\r\n    // æœ€å¼€å§‹çš„ next å°±æ˜¯ store.dispatch\r\n    // ç›¸å½“äºå°±æ˜¯æ¯ä¸ªä¸­é—´ä»¶åœ¨è‡ªå·±çš„è¿‡ç¨‹ä¸­åšä¸€äº›æ“ä½œï¼Œåšå®Œä¹‹åè°ƒç”¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶(next(action))\r\n    dispatch = compose(...chain)(store.dispatch)\r\n\r\n    // æœ€ç»ˆè¿”å›ä¸€ä¸ªdispatchè¢«ä¿®æ”¹äº†çš„storeï¼Œè¿™ä¸ªdispatchä¸²è”èµ·äº†ä¸­é—´ä»¶\r\n    // æ¬ çš„é‚£ä¸ªactionä¼šåœ¨dispatchçš„æ—¶å€™ä¼ å…¥\r\n    return {\r\n      ...store,\r\n      dispatch\r\n    }\r\n  }\r\n}\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/fi3ework/blog/issues/7/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fi3ework/blog/issues/7/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]