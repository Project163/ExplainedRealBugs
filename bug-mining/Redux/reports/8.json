{"url":"https://api.github.com/repos/reduxjs/redux/issues/461","repository_url":"https://api.github.com/repos/reduxjs/redux","labels_url":"https://api.github.com/repos/reduxjs/redux/issues/461/labels{/name}","comments_url":"https://api.github.com/repos/reduxjs/redux/issues/461/comments","events_url":"https://api.github.com/repos/reduxjs/redux/issues/461/events","html_url":"https://github.com/reduxjs/redux/issues/461","id":100298057,"node_id":"MDU6SXNzdWUxMDAyOTgwNTc=","number":461,"title":"Unsubscribe a listener inside a listener has side-effects on other listeners","user":{"login":"arian","id":109243,"node_id":"MDQ6VXNlcjEwOTI0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/109243?v=4","gravatar_id":"","url":"https://api.github.com/users/arian","html_url":"https://github.com/arian","followers_url":"https://api.github.com/users/arian/followers","following_url":"https://api.github.com/users/arian/following{/other_user}","gists_url":"https://api.github.com/users/arian/gists{/gist_id}","starred_url":"https://api.github.com/users/arian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arian/subscriptions","organizations_url":"https://api.github.com/users/arian/orgs","repos_url":"https://api.github.com/users/arian/repos","events_url":"https://api.github.com/users/arian/events{/privacy}","received_events_url":"https://api.github.com/users/arian/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":218057855,"node_id":"MDU6TGFiZWwyMTgwNTc4NTU=","url":"https://api.github.com/repos/reduxjs/redux/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2015-08-11T12:10:13Z","updated_at":"2018-05-12T19:49:55Z","closed_at":"2015-08-11T18:14:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Unsubscribing a listener inside a listener, will splice the `listeners` array in the store of `createStore`, while looping over that array using `forEach` in `dispatch`.\n\nFor example the following program fails:\n\n``` js\nimport assert from 'assert';\nimport {createStore} from 'redux';\n\nvar store = createStore(() => []);\n\nvar countA = 0;\nvar countB = 0;\nvar countC = 0;\n\nvar unsubA = store.subscribe(() => {\n    countA++;\n});\n\nvar unsubB = store.subscribe(() => {\n    countB++;\n    unsubB();\n});\n\nvar unsubC = store.subscribe(() => {\n    countC++;\n});\n\nstore.dispatch({type: 'X'});\nstore.dispatch({type: 'Y'});\n\nconsole.log(countA, countB, countC);\n\nassert.equal(countA, 2, 'countA');\nassert.equal(countB, 1, 'countB');\nassert.equal(countC, 2, 'countC');\n```\n\n`countC` is **1**, but it should be **2**.\n\nA fix for this problem would be to copy the array before doing the `forEach` in the `dispatch` function, for example:\n\n``` js\nlisteners.slice().forEach(listener => listener());\n```\n","closed_by":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/reduxjs/redux/issues/461/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/reduxjs/redux/issues/461/timeline","performed_via_github_app":null,"state_reason":"completed"}