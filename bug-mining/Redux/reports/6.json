{"url":"https://api.github.com/repos/reduxjs/redux/issues/186","repository_url":"https://api.github.com/repos/reduxjs/redux","labels_url":"https://api.github.com/repos/reduxjs/redux/issues/186/labels{/name}","comments_url":"https://api.github.com/repos/reduxjs/redux/issues/186/comments","events_url":"https://api.github.com/repos/reduxjs/redux/issues/186/events","html_url":"https://github.com/reduxjs/redux/issues/186","id":91614454,"node_id":"MDU6SXNzdWU5MTYxNDQ1NA==","number":186,"title":"Anti-pattern: reacting to @@INIT action","user":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":225483610,"node_id":"MDU6TGFiZWwyMjU0ODM2MTA=","url":"https://api.github.com/repos/reduxjs/redux/labels/docs","name":"docs","color":"316cbf","default":false,"description":""}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":18,"created_at":"2015-06-28T16:35:15Z","updated_at":"2019-04-29T02:59:36Z","closed_at":"2015-07-13T17:58:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"In the new docs (#140) we should clarify that any actions prefixed with `@@` are _not_ meant to be handled. For example, you should never try to handle `@@INIT`. We might enforce that by slightly randomizing names (e.g. `@@INIT_2hj3jh34`).\n\nHandling `@@INIT` manually will break hot reloading. It is invoked at every hot reload, so if you do your initial data transformation there, it won't work the second time.\n\nI've seen people using `@@INIT` to hydrate the plain objects received from the server into the Immutable state. Instead of handling `@@INIT`, you need to consider one of two options:\n- convert your whole plain object state to Immutable right away before passing it to Redux;\n- check if the `state` is a plain object and use `fromJS` before handling the action.\n\n``` js\nfunction myReducer(state = {}, action) {\n  if (!isImmutable(state)) { // some kind of typeof check here?\n    state = Immutable.fromJS(state);\n  }\n\n  ...\n}\n```\n\nIt is easy to abstract this away with a `createImmutableReducer` function like this:\n\n``` js\nexport default function createImmutableReducer(initialState, handlers) {\n  return (state = initialState, action) => {\n    if (!isImmutable(state)) {\n      // Hydrate server plain object state\n      state = Immutable.fromJS(state);\n    }\n\n    const handler = handlers[action.type];\n    if (handler) {\n      state = handler(state, action);\n    }\n\n    if (!isImmutable(state)) {\n      throw new Error('Reducers must return Immutable objects.');\n    }\n\n    return state;\n  };\n}\n```\n\nIt can then be used for creating reducers from `action constant -> handler` map.\n","closed_by":{"login":"gaearon","id":810438,"node_id":"MDQ6VXNlcjgxMDQzOA==","avatar_url":"https://avatars.githubusercontent.com/u/810438?v=4","gravatar_id":"","url":"https://api.github.com/users/gaearon","html_url":"https://github.com/gaearon","followers_url":"https://api.github.com/users/gaearon/followers","following_url":"https://api.github.com/users/gaearon/following{/other_user}","gists_url":"https://api.github.com/users/gaearon/gists{/gist_id}","starred_url":"https://api.github.com/users/gaearon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaearon/subscriptions","organizations_url":"https://api.github.com/users/gaearon/orgs","repos_url":"https://api.github.com/users/gaearon/repos","events_url":"https://api.github.com/users/gaearon/events{/privacy}","received_events_url":"https://api.github.com/users/gaearon/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/reduxjs/redux/issues/186/reactions","total_count":16,"+1":14,"-1":0,"laugh":1,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/reduxjs/redux/issues/186/timeline","performed_via_github_app":null,"state_reason":"completed"}