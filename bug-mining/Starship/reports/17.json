{"url":"https://api.github.com/repos/starship/starship/issues/2241","repository_url":"https://api.github.com/repos/starship/starship","labels_url":"https://api.github.com/repos/starship/starship/issues/2241/labels{/name}","comments_url":"https://api.github.com/repos/starship/starship/issues/2241/comments","events_url":"https://api.github.com/repos/starship/starship/issues/2241/events","html_url":"https://github.com/starship/starship/issues/2241","id":797296764,"node_id":"MDU6SXNzdWU3OTcyOTY3NjQ=","number":2241,"title":"Jobs module in bash always returns 1","user":{"login":"wlonkly","id":1545955,"node_id":"MDQ6VXNlcjE1NDU5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1545955?v=4","gravatar_id":"","url":"https://api.github.com/users/wlonkly","html_url":"https://github.com/wlonkly","followers_url":"https://api.github.com/users/wlonkly/followers","following_url":"https://api.github.com/users/wlonkly/following{/other_user}","gists_url":"https://api.github.com/users/wlonkly/gists{/gist_id}","starred_url":"https://api.github.com/users/wlonkly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wlonkly/subscriptions","organizations_url":"https://api.github.com/users/wlonkly/orgs","repos_url":"https://api.github.com/users/wlonkly/repos","events_url":"https://api.github.com/users/wlonkly/events{/privacy}","received_events_url":"https://api.github.com/users/wlonkly/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1300028463,"node_id":"MDU6TGFiZWwxMzAwMDI4NDYz","url":"https://api.github.com/repos/starship/starship/labels/%F0%9F%90%9B%20bug","name":"üêõ bug","color":"d73a4a","default":false,"description":"Something isn't working as expected."}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-01-30T01:02:36Z","updated_at":"2021-01-31T21:56:07Z","closed_at":"2021-01-31T21:56:07Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"#### Current Behavior\r\n\r\nJobs module always returns nothing or `1`:\r\n\r\n```\r\n:) ~$ sleep 1000 &\r\n[1] 15998\r\n:) ~[1]$ sleep 1000 &\r\n[2] 16022\r\n:) ~[1]$\r\n```\r\n<!-- A clear and concise description of the behavior. -->\r\n\r\n#### Expected Behavior\r\n\r\nJobs module returns the number of jobs. (In the above example, \"2\" in the last line.)\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\n#### Possible Solution\r\n\r\nI think this broke in #1897, but I'm not sure how that PR worked for anyone else -- when I run the code that's in that PR, the output of `jobs -p` is folded onto a single line:\r\n\r\n```\r\n$ n=0; while read line; do echo $line; n=$((n+1)); done <<< $(jobs -p)\r\n15308 15354\r\n\r\n# or for that matter...\r\n$ cat <<< $(jobs -p)\r\n15308 15354\r\n```\r\n\r\nAlternatively, I think this will sort it:\r\n\r\n```\r\n$ n=0; for job in $(jobs -p); do [[ $job ]] && n=$((n+1)); done; echo $n\r\n2\r\n$ kill %1\r\n[1]-  Terminated: 15          sleep 1000\r\n$ kill %2\r\n[2]+  Terminated: 15          sleep 1000\r\n$ n=0; for job in $(jobs -p); do [[ $job ]] && n=$((n+1)); done; echo $n\r\n0\r\n```\r\n\r\nHappy to open a PR if I'm not missing something here -- presumably what's in #1897 worked _somewhere_ and I'm not sure why it's not working for me!\r\n\r\n<!--- Only if you have suggestions on a fix for the bug -->\r\n\r\n#### Environment\r\n- Starship version: 0.49.0\r\n- bash version: 5.1.0(1)-release\r\n- Operating system: Mac OS 10.14.6\r\n- Terminal emulator: iTerm.app 3.4.2beta3\r\n- Git Commit Hash: \r\n- Branch/Tag: \r\n- Rust Version: rustc 1.49.0\r\n- Rust channel:  release\r\n- Build Time: 2021-01-29 17:51:59\r\n#### Relevant Shell Configuration\r\n\r\n```bash\r\n<unknown config>\r\n```\r\n\r\n#### Starship Configuration\r\n\r\n<details><summary>clicky to see, it's pretty long</summary>\r\n\r\n```toml\r\n#\r\n# List of features:\r\n#\r\n# ^:) user@hostname master[‚úö 1](prod@usw2) pwd [1]$\r\n# ^ ^   ^     ^       ^           ^    ^    ^   ^\r\n# 1 2   3     4       5           6    7    8   9\r\n#\r\n# 1. Every subshell gets an additional ^ based on SHLVL\r\n# 2. Happy and sad face for command success/failure\r\n# 3. Username when it's not the login user\r\n# 4. Hostname if on an SSH connection\r\n# 5. Git status\r\n# 6. AWS profile\r\n# 7. AWS region, abbreviated if possible\r\n# 8. Current directory, truncated if too long\r\n# 9. Number of background jobs\r\n#\r\n\r\nadd_newline = false\r\n\r\nformat = \"\"\"[\\\r\n$shlvl\\\r\n$character\\\r\n$python\\\r\n$username\\\r\n$hostname\\\r\n$git_branch$git_commit$git_state$git_status\\\r\n$aws\\\r\n$directory\\\r\n$jobs\\\r\n](cyan)\\\\$ \"\"\"\r\n\r\n[character]\r\nsuccess_symbol = \"[:\\\\)](cyan)\"\r\nerror_symbol = \"[:\\\\(](red)\"\r\nformat = \"$symbol\"\r\n\r\n[shlvl]\r\nthreshold = 2\r\nsymbol = \"^\"\r\nformat = \"[$symbol](red)\"\r\nrepeat = true\r\ndisabled = false\r\n\r\n[jobs]\r\nformat = \"\\\\[[$number](red)\\\\]\"\r\nthreshold = 0\r\n\r\n[hostname]\r\nssh_only = true\r\nformat = \"[@$hostname:](cyan)\"\r\n\r\n[username]\r\nstyle_user = \"cyan\"\r\nstyle_root = \"red bold\"\r\nformat = \" [$user]($style)\"\r\nshow_always = false\r\n\r\n[directory]\r\ntruncation_length = 3\r\ntruncate_to_repo = true\r\nformat = \" [$path](cyan)\"\r\ntruncation_symbol = \"‚Ä¶/\"\r\n\r\n# git: [master|‚úö 1]\r\n[git_branch]\r\nformat = \" [$branch](purple)\"\r\nonly_attached = true\r\n\r\n[git_commit]\r\nformat = \" [$hash](purple)\"\r\nonly_detached = true\r\n\r\n[git_state]\r\nformat = \"[|$state:$progress_current/$progress_total](purple)\"\r\n\r\n# this is meant to work as closely as possible like\r\n# github.com:magicmonty/bash-git-prompt\r\n[git_status]\r\nformat = \"[(\\\\[$conflicted$staged$modified$deleted$renamed$untracked$stashed$ahead_behind\\\\])]($white)\"\r\n\r\nahead    = \"‚Üë${count}\"\r\ndiverged = \"‚Üë${ahead_count}‚Üì${behind_count}\"\r\nbehind   = \"‚Üì${count}\"\r\n\r\nconflicted = \"[ ‚úñ$count‚úñ ](bold red)\"\r\nstaged     = \"[‚úö $count](green)\"\r\nmodified   = \"[‚úö $count](bold blue)\"\r\ndeleted    = \"[-$count](red)\"\r\nrenamed    = \"[¬ª$count](green)\"\r\nuntracked  = \"[‚Ä¶$count](cyan)\"\r\nstashed    = \"[‚öë $count](bold blue)\"\r\n\r\n# only care about virtualenv\r\n[python]\r\nformat = '[( \\($virtualenv\\))](yellow)'\r\n\r\n[aws]\r\nformat = \"[( \\\\($profile(@$region)\\\\))](yellow)\"\r\n\r\n[aws.region_aliases]\r\nus-west-2    = \"usw2\"\r\nus-west-1    = \"usw1\"\r\nus-east-2    = \"use2\"\r\nus-east-1    = \"üî•use1üî•\"\r\nca-central-1 = \"ca\"\r\neu-west-1    = \"euw1\"\r\neu-central-1 = \"euc1\"\r\n\r\n\r\n```\r\n\r\n</details>","closed_by":{"login":"andytom","id":108836,"node_id":"MDQ6VXNlcjEwODgzNg==","avatar_url":"https://avatars.githubusercontent.com/u/108836?v=4","gravatar_id":"","url":"https://api.github.com/users/andytom","html_url":"https://github.com/andytom","followers_url":"https://api.github.com/users/andytom/followers","following_url":"https://api.github.com/users/andytom/following{/other_user}","gists_url":"https://api.github.com/users/andytom/gists{/gist_id}","starred_url":"https://api.github.com/users/andytom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andytom/subscriptions","organizations_url":"https://api.github.com/users/andytom/orgs","repos_url":"https://api.github.com/users/andytom/repos","events_url":"https://api.github.com/users/andytom/events{/privacy}","received_events_url":"https://api.github.com/users/andytom/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/starship/starship/issues/2241/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/starship/starship/issues/2241/timeline","performed_via_github_app":null,"state_reason":"completed"}