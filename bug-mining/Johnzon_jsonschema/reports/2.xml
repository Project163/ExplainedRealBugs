<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:03:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JOHNZON-191] [Schema] &quot;patternProperties&quot; does not correctly handle related property type</title>
                <link>https://issues.apache.org/jira/browse/JOHNZON-191</link>
                <project id="12315523" key="JOHNZON">Johnzon</project>
                    <description>&lt;p&gt;In Apache Sling we have been developing a draft-07 compliant schema to define &lt;em&gt;Sling Feature files&lt;/em&gt;, which are in JSON format, and of course Johnzon is the de-facto standard choice to work with JSON structures.&lt;/p&gt;

&lt;p&gt;If you want to have a look at the initial draft, have a look at &lt;a href=&quot;https://gist.github.com/simonetripodi/c69d2ffebdbd2c4b1355df60568f1ab5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/simonetripodi/c69d2ffebdbd2c4b1355df60568f1ab5&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So, in our &lt;em&gt;Feature&lt;/em&gt; we have so called &lt;em&gt;extensions&lt;/em&gt; where users can define a custom data set, &lt;em&gt;extensions&lt;/em&gt; keys are defined by &lt;tt&gt;patternProperties&lt;/tt&gt; which related type, I noticed, are not correctly handled by the &lt;tt&gt;JsonSchemaValidator&lt;/tt&gt;: the expected behaviour is that for an input like the one below:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{
  &quot;id&quot;:&quot;test/artifacts-extension/1.0.0&quot;,
  &quot;my-extension1:TEXT|false&quot;:{}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;an error is detected since type is invalid, &lt;em&gt;string&lt;/em&gt; or &lt;em&gt;array&lt;/em&gt; is expected but  but got &lt;em&gt;object&lt;/em&gt;, tested on &lt;a href=&quot;https://www.jsonschemavalidator.net/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.jsonschemavalidator.net/&lt;/a&gt;, but &lt;tt&gt;JsonSchemaValidator&lt;/tt&gt; passes all verifications.&lt;/p&gt;

&lt;p&gt;I noticed that this behaviour is even present in Johnzon tests , i.e.&lt;a href=&quot;https://github.com/apache/johnzon/blob/master/johnzon-jsonschema/src/test/java/org/apache/johnzon/jsonschema/JsonSchemaValidatorTest.java#L572&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;JsonSchemaValidatorTest.java#L572&lt;/a&gt; where &lt;em&gt;number&lt;/em&gt; type is expected for keys identified by &lt;em&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;+&lt;/em&gt;, but it succeeds for &lt;em&gt;string&lt;/em&gt; type as well.&lt;/p&gt;

&lt;p&gt;I think it is a bug, unless I misconfigured something, follows below a snippet of code where the validator is created:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    private final JsonSchemaValidator validator;

    private FeatureSchemaValidatorProvider() {
        JsonReader reader = null;
        JsonSchemaValidatorFactory factory = null;
        try (InputStream schemaInput = FeatureJSONReader.class.getResourceAsStream(&quot;/META-INF/feature/Feature-1.0.0.schema.json&quot;)) {
            reader = Json.createReader(schemaInput);
            JsonObject schema = reader.readObject();
            factory = new JsonSchemaValidatorFactory();
            factory.setRegexFactory(JavaRegex::new);
            validator = factory.newInstance(schema);
        } catch (IOException ioe) {
            // should not happen, /META-INF/feature/Feature-1.0.0.schema.json is in the classpath
            throw new UncheckedIOException(ioe);
        } finally {
            if (reader != null) {
                reader.close();
            }
            if (factory != null) {
                factory.close();
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could you kindly help us? Many thanks in advance!&lt;/p&gt;</description>
                <environment></environment>
        <key id="13189808">JOHNZON-191</key>
            <summary>[Schema] &quot;patternProperties&quot; does not correctly handle related property type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="simone.tripodi">Simone Tripodi</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Oct 2018 20:02:20 +0000</created>
                <updated>Sat, 30 Apr 2022 11:55:50 +0000</updated>
                                            <version>1.1.10</version>
                                    <fixVersion>1.2.19</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16640337" author="romain.manni-bucau" created="Fri, 5 Oct 2018 20:58:35 +0000"  >&lt;p&gt;Hi Simone&lt;/p&gt;

&lt;p&gt;The type is fully ignored (see &lt;a href=&quot;https://github.com/apache/johnzon/blob/master/johnzon-jsonschema/src/main/java/org/apache/johnzon/jsonschema/JsonSchemaValidatorFactory.java#L178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/johnzon/blob/master/johnzon-jsonschema/src/main/java/org/apache/johnzon/jsonschema/JsonSchemaValidatorFactory.java#L178&lt;/a&gt;). Do you want to propose a patch? I can help next week probably if needed.&lt;/p&gt;

&lt;p&gt;Side note: your regex are likely not portable since jsonschema dont support js regex (^ or $) - at least in the last version i checked, if it changed we can need to rework our impl too. In our impl we have it pluggable cause it is most of the time required to have such a feature.&lt;/p&gt;</comment>
                            <comment id="16640381" author="simone.tripodi" created="Fri, 5 Oct 2018 21:46:19 +0000"  >&lt;p&gt;Thank you so much &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romain.manni-bucau&quot; class=&quot;user-hover&quot; rel=&quot;romain.manni-bucau&quot;&gt;romain.manni-bucau&lt;/a&gt; for the prompt reply, very appreciated! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I forked the repo already and started having a look at the source code to see if I am able to provide any patch, I&apos;ll try to have a deeper look at it during the weekend.&lt;/p&gt;

&lt;p&gt;IIUC, jsonschema Regex &lt;em&gt;should&lt;/em&gt; support begin/end of input, at least according to &lt;a href=&quot;https://json-schema.org/latest/json-schema-validation.html#rfc.section.4.3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://json-schema.org/latest/json-schema-validation.html#rfc.section.4.3&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;schema authors SHOULD limit themselves to the following regular expression tokens:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;..&amp;#93;&lt;/span&gt;&lt;br/&gt;
the beginning-of-input (&quot;^&quot;) and end-of-input (&quot;$&quot;) anchors;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;this shouldn&apos;t be a problema anyway, the more interesting part is we are able to validate input data against the schema &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;many thanks in advance for your help and keep up the good work!&lt;/p&gt;</comment>
                            <comment id="16640783" author="romain.manni-bucau" created="Sat, 6 Oct 2018 17:06:13 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simone.tripodi&quot; class=&quot;user-hover&quot; rel=&quot;simone.tripodi&quot;&gt;simone.tripodi&lt;/a&gt;, I just pushed an enhancement about it - mainly realized meta-validation were not using the right object, can you have a look please?&lt;/p&gt;</comment>
                            <comment id="16641605" author="simone.tripodi" created="Mon, 8 Oct 2018 10:00:42 +0000"  >&lt;p&gt;Thanks a lot for the update &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=romain.manni-bucau&quot; class=&quot;user-hover&quot; rel=&quot;romain.manni-bucau&quot;&gt;romain.manni-bucau&lt;/a&gt; and apologise the late reaction, unfortunately I didn&apos;t have enough cycles during the WE to give a try.&lt;/p&gt;

&lt;p&gt;I updated and the re-built the Json Schema and updated the new SNAPSHOT version in my project, re-launched the unit tests and got the stack-trace below on a valid input:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.ClassCastException: Cannot cast org.apache.johnzon.core.JsonArrayImpl to javax.json.JsonString
	at java.lang.Class.cast(Class.java:3369)
	at org.apache.johnzon.core.JsonObjectImpl.value(JsonObjectImpl.java:41)
	at org.apache.johnzon.core.JsonObjectImpl.getJsonString(JsonObjectImpl.java:77)
	at org.apache.johnzon.jsonschema.spi.builtin.TypeValidation.create(TypeValidation.java:39)
	at org.apache.johnzon.jsonschema.JsonSchemaValidatorFactory.lambda$buildDirectValidations$0(JsonSchemaValidatorFactory.java:155)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
	at org.apache.johnzon.jsonschema.JsonSchemaValidatorFactory.buildValidator(JsonSchemaValidatorFactory.java:139)
	at org.apache.johnzon.jsonschema.JsonSchemaValidatorFactory.lambda$null$10(JsonSchemaValidatorFactory.java:198)
	at java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:267)
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
	at java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet.lambda$entryConsumer$0(Collections.java:1575)
	at java.util.Iterator.forEachRemaining(Iterator.java:116)
	at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)
	at java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntrySetSpliterator.forEachRemaining(Collections.java:1600)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:270)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
	at org.apache.johnzon.jsonschema.JsonSchemaValidator.apply(JsonSchemaValidator.java:41)
	at org.apache.sling.feature.io.json.FeatureJSONReader.readFeature(FeatureJSONReader.java:105)
	at org.apache.sling.feature.io.json.FeatureJSONReader.read(FeatureJSONReader.java:75)
	at org.apache.sling.feature.io.json.U.readFeature(U.java:42)
	at org.apache.sling.feature.io.json.FeatureJSONReaderTest.testValidatingFeature(FeatureJSONReaderTest.java:80)
	[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;same thing on an invalid input:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.ClassCastException: Cannot cast org.apache.johnzon.core.JsonArrayImpl to javax.json.JsonString
	at java.lang.Class.cast(Class.java:3369)
	at org.apache.johnzon.core.JsonObjectImpl.value(JsonObjectImpl.java:41)
	at org.apache.johnzon.core.JsonObjectImpl.getJsonString(JsonObjectImpl.java:77)
	at org.apache.johnzon.jsonschema.spi.builtin.TypeValidation.create(TypeValidation.java:39)
	at org.apache.johnzon.jsonschema.JsonSchemaValidatorFactory.lambda$buildDirectValidations$0(JsonSchemaValidatorFactory.java:155)
	at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
	at org.apache.johnzon.jsonschema.JsonSchemaValidatorFactory.buildValidator(JsonSchemaValidatorFactory.java:139)
	at org.apache.johnzon.jsonschema.JsonSchemaValidatorFactory.lambda$null$10(JsonSchemaValidatorFactory.java:198)
	at java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:267)
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)
	at java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet.lambda$entryConsumer$0(Collections.java:1575)
	at java.util.Iterator.forEachRemaining(Iterator.java:116)
	at java.util.Spliterators$IteratorSpliterator.forEachRemaining(Spliterators.java:1801)
	at java.util.Collections$UnmodifiableMap$UnmodifiableEntrySet$UnmodifiableEntrySetSpliterator.forEachRemaining(Collections.java:1600)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:151)
	at java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:174)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:418)
	at java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:270)
	at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:481)
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)
	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)
	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)
	at org.apache.johnzon.jsonschema.JsonSchemaValidator.apply(JsonSchemaValidator.java:41)
	at org.apache.sling.feature.io.json.FeatureJSONReader.readFeature(FeatureJSONReader.java:105)
	at org.apache.sling.feature.io.json.FeatureJSONReader.read(FeatureJSONReader.java:75)
	at org.apache.sling.feature.io.json.U.readFeature(U.java:42)
	at org.apache.sling.feature.io.json.FeatureJSONReaderTest.testInvalidTextInArtifacts(FeatureJSONReaderTest.java:84)
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ve tried to understand what&apos;s the root cause of that error, but still got no idea ATM.&lt;/p&gt;

&lt;p&gt;Many thanks in advance for any hint!&lt;/p&gt;</comment>
                            <comment id="16642020" author="romain.manni-bucau" created="Mon, 8 Oct 2018 15:33:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simone.tripodi&quot; class=&quot;user-hover&quot; rel=&quot;simone.tripodi&quot;&gt;simone.tripodi&lt;/a&gt; if type is not a string value current code fails, i&apos;ll ensure it does not fail but i wonder if you have a model/schema where it is something else? You can debug in TypeValidation class, it should be faily easy to check the array value you have for type and enrich the support.&lt;/p&gt;

&lt;p&gt;edit: added the support for arrays of string as the spec mentions. Our implementation always considers NULL as valid (compared to the spec) and relies on required to validate the presence (means type=STRING is equivalent to type=STRING or NULL). Not sure it is an issue, we can introduce a flag to prevent it if so.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3yw9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>