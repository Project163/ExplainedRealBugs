diff --git a/hbase-common/pom.xml b/hbase-common/pom.xml
index afcb350783..c0fada3695 100644
--- a/hbase-common/pom.xml
+++ b/hbase-common/pom.xml
@@ -38,7 +38,6 @@
           <includes>
               <include>hbase-default.xml</include>
           </includes>
-          <filtering>true</filtering>
       </resource>
     </resources>
     <plugins>
@@ -60,6 +59,23 @@
         <plugin>
             <artifactId>maven-antrun-plugin</artifactId>
             <executions>
+          <execution>
+            <phase>process-resources</phase>
+            <configuration>
+              <target>
+                <replace file="${project.build.outputDirectory}/hbase-default.xml"
+                  token="@@@VERSION@@@" value="${project.version}" />
+                <mkdir dir="${project.build.directory}/nativelib"/>
+                <exec executable="tar" dir="${project.build.directory}/nativelib" failonerror="false">
+                  <arg value="xf"/>
+                  <arg value="hadoop-snappy-nativelibs.tar"/>
+                </exec>
+              </target>
+            </configuration>
+            <goals>
+              <goal>run</goal>
+            </goals>
+          </execution>
                 <!-- Generate web app sources -->
                 <execution>
                     <id>generate</id>
diff --git a/hbase-common/src/main/resources/hbase-default.xml b/hbase-common/src/main/resources/hbase-default.xml
index 542852492b..e1aaf60d91 100644
--- a/hbase-common/src/main/resources/hbase-default.xml
+++ b/hbase-common/src/main/resources/hbase-default.xml
@@ -795,7 +795,7 @@
 
   <property skipInDoc="true">
     <name>hbase.defaults.for.version</name>
-    <value>${pom.version}</value>
+    <value>@@@VERSION@@@</value>
     <description>
     This defaults file was compiled for version ${pom.version}. This variable is used
     to make sure that a user doesn't have an old version of hbase-default.xml on the
