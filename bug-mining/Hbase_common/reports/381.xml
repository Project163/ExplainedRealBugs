<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:11:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[HBASE-17869] UnsafeAvailChecker wrongly returns false on ppc</title>
                <link>https://issues.apache.org/jira/browse/HBASE-17869</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;On ppc64 arch,  java.nio.Bits.unaligned() wrongly returns false due to a JDK bug.&lt;br/&gt;
&lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8165231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-8165231&lt;/a&gt;&lt;br/&gt;
This causes some problem for HBase. i.e. FuzzyRowFilter test fails.&lt;br/&gt;
Fix it by providing a hard-code workaround for the JDK bug.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13061208">HBASE-17869</key>
            <summary>UnsafeAvailChecker wrongly returns false on ppc</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jinghe">Jerry He</assignee>
                                    <reporter username="jinghe">Jerry He</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Apr 2017 18:26:14 +0000</created>
                <updated>Wed, 1 Aug 2018 06:22:41 +0000</updated>
                            <resolved>Thu, 6 Apr 2017 23:28:01 +0000</resolved>
                                    <version>1.2.4</version>
                                    <fixVersion>1.4.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15954054" author="yuzhihong@gmail.com" created="Mon, 3 Apr 2017 19:41:39 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;

&lt;p&gt;nit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;58	      }
59	      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Put else on the same line as right curly when committing.&lt;/p&gt;</comment>
                            <comment id="15954659" author="anoop.hbase" created="Tue, 4 Apr 2017 06:49:04 +0000"  >&lt;p&gt;It looks ok as ppc64 and ppc64le supports unaligned.&lt;br/&gt;
But my doubt is this?  Why we have a problem with it? Things should work with out using Unsafe ways. We may miss some possible optimization but no issues/failures any where.  That means some thing is wrong in FuzzyRowFilter and/or its tests?  We should address that also?&lt;/p&gt;</comment>
                            <comment id="15954660" author="ram_krish" created="Tue, 4 Apr 2017 06:51:24 +0000"  >&lt;p&gt;I think the issue is that Unsafe is there but one of the impl in it is wrong and so we get wrong result?&lt;br/&gt;
If totally Unsafe is not used then may be they won&apos;t get this?&lt;/p&gt;</comment>
                            <comment id="15955986" author="jinghe" created="Tue, 4 Apr 2017 22:34:43 +0000"  >&lt;p&gt;Yeah, I had the same question. Two code paths (true or false) should yield the same results.&lt;br/&gt;
Since the &apos;true&apos; route is more commonly used, can we assume it has the correct results?&lt;br/&gt;
Then there could be a bug somewhere in the &apos;false&apos; route. In the FuzzyRowFilter?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.AssertionError: expected:&amp;lt;YES&amp;gt; but was:&amp;lt;NO_NEXT&amp;gt;
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failNotEquals(Assert.java:834)
	at org.junit.Assert.assertEquals(Assert.java:118)
	at org.junit.Assert.assertEquals(Assert.java:144)
	at org.apache.hadoop.hbase.filter.TestFuzzyRowFilter.testSatisfiesForward(TestFuzzyRowFilter.java:80)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.AssertionError: expected:&amp;lt;YES&amp;gt; but was:&amp;lt;NEXT_EXISTS&amp;gt;
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failNotEquals(Assert.java:834)
	at org.junit.Assert.assertEquals(Assert.java:118)
	at org.junit.Assert.assertEquals(Assert.java:144)
	at org.apache.hadoop.hbase.filter.TestFuzzyRowFilter.testSatisfiesReverse(TestFuzzyRowFilter.java:120)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15956062" author="jinghe" created="Tue, 4 Apr 2017 23:41:37 +0000"  >&lt;p&gt;On a x86_64 box, if I hard-code UnsafeAvailChecker.unaligned() to false, the same tests fail.&lt;/p&gt;</comment>
                            <comment id="15956253" author="anoop.hbase" created="Wed, 5 Apr 2017 03:40:51 +0000"  >&lt;p&gt;Ya the false path might be problematic. Need to look into the test and then code deeply.. I do not know FuzzyRowFilter code path in deep.&lt;/p&gt;</comment>
                            <comment id="15956310" author="jinghe" created="Wed, 5 Apr 2017 05:10:48 +0000"  >&lt;p&gt;Thanks for chiming in. Do you agree I can commit this one and open another issue to look into the false path with FuzzyRowFilter?&lt;/p&gt;</comment>
                            <comment id="15956312" author="jinghe" created="Wed, 5 Apr 2017 05:11:44 +0000"  >&lt;p&gt;I found out &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-19999&quot; title=&quot;Test failures in Spark Core due to java.nio.Bits.unaligned()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-19999&quot;&gt;&lt;del&gt;SPARK-19999&lt;/del&gt;&lt;/a&gt; does something similar.&lt;/p&gt;</comment>
                            <comment id="15956327" author="ram_krish" created="Wed, 5 Apr 2017 05:32:12 +0000"  >&lt;p&gt;I think +1 to commit this and raise another issue to solve the Fuzzy row bug. I think we have some similar instances where ever our code path goes into UNSAFE &apos;true&apos; case only. &lt;/p&gt;</comment>
                            <comment id="15956341" author="anoop.hbase" created="Wed, 5 Apr 2017 05:48:35 +0000"  >&lt;p&gt;Pls raise another issue to track the FuzzyRowFilter..  As such +1 for this issue commit.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;if (&quot;ppc64&quot;.equals(arch) || &quot;ppc64le&quot;.equals(arch))&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We need a Spark issue kind of matching check than the exact string match?  If u are confident this is enough (After ur test in actual env) then go ahead.. Ur call.&lt;/p&gt;

&lt;p&gt;Thanks for digging into it.&lt;/p&gt;</comment>
                            <comment id="15958287" author="jinghe" created="Thu, 6 Apr 2017 04:58:29 +0000"  >&lt;p&gt;The spark fix does the same exact string match. But it covers more platforms with an extra pattern matching and for fall-back checking.&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/spark/pull/17472/files&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/spark/pull/17472/files&lt;/a&gt;&lt;br/&gt;
It is probably ok that we don&apos;t have the extra checking.&lt;/p&gt;</comment>
                            <comment id="15958291" author="anoop.hbase" created="Thu, 6 Apr 2017 05:02:26 +0000"  >&lt;p&gt;Yes I mean the generic pattern match rather than stricter string match.  If u feel this is fine enough after ur test go ahead pls.  Ur call Jerry.  Good on you. Good find.&lt;/p&gt;</comment>
                            <comment id="15959964" author="jinghe" created="Thu, 6 Apr 2017 23:27:47 +0000"  >&lt;p&gt;Pushed to master and branch-1. (Fixed Ted&apos;s nit.)&lt;br/&gt;
Tested on ppc64le: &lt;br/&gt;
Without the patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Failed tests:
  TestFuzzyRowAndColumnRangeFilter.Test:134-&amp;gt;runTest:157-&amp;gt;runScanner:186 expected:&amp;lt;10&amp;gt; but was:&amp;lt;0&amp;gt;
  TestFuzzyRowFilter.testSatisfiesForward:81 expected:&amp;lt;YES&amp;gt; but was:&amp;lt;NO_NEXT&amp;gt;
  TestFuzzyRowFilter.testSatisfiesReverse:121 expected:&amp;lt;YES&amp;gt; but was:&amp;lt;NEXT_EXISTS&amp;gt;
  TestFuzzyRowFilterEndToEnd.testEndToEnd:247-&amp;gt;runTest1:278-&amp;gt;runScanner:343 expected:&amp;lt;6250&amp;gt; but was:&amp;lt;0&amp;gt;
  TestFuzzyRowFilterEndToEnd.testFilterList:385-&amp;gt;runTest:417-&amp;gt;runScanner:445 expected:&amp;lt;5&amp;gt; but was:&amp;lt;0&amp;gt;
  TestFuzzyRowFilterEndToEnd.testHBASE14782:204 expected:&amp;lt;6&amp;gt; but was:&amp;lt;0&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With the patch,  the full &apos;mvn clean test&apos; is clean on master &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks for the review.&lt;/p&gt;</comment>
                            <comment id="15959980" author="jinghe" created="Thu, 6 Apr 2017 23:44:17 +0000"  >&lt;p&gt;Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-17890&quot; title=&quot;FuzzyRowFilter fail if unaligned support is false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-17890&quot;&gt;HBASE-17890&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15960171" author="hudson" created="Fri, 7 Apr 2017 02:11:35 +0000"  >&lt;p&gt;FAILURE: Integrated in Jenkins build HBase-1.4 #690 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.4/690/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/HBase-1.4/690/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-17869&quot; title=&quot;UnsafeAvailChecker wrongly returns false on ppc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-17869&quot;&gt;&lt;del&gt;HBASE-17869&lt;/del&gt;&lt;/a&gt; UnsafeAvailChecker wrongly returns false on ppc (jerryjch: rev b6a2c02b935ab22ec4c86accc3b1015fe715c675)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hbase-common/src/main/java/org/apache/hadoop/hbase/util/UnsafeAvailChecker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15960238" author="hudson" created="Fri, 7 Apr 2017 04:00:09 +0000"  >&lt;p&gt;SUCCESS: Integrated in Jenkins build HBase-Trunk_matrix #2813 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/2813/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/2813/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-17869&quot; title=&quot;UnsafeAvailChecker wrongly returns false on ppc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-17869&quot;&gt;&lt;del&gt;HBASE-17869&lt;/del&gt;&lt;/a&gt; UnsafeAvailChecker wrongly returns false on ppc (jerryjch: rev af604f0c0cf3c40c56746150ffa860aad07f128a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hbase-common/src/main/java/org/apache/hadoop/hbase/util/UnsafeAvailChecker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15990418" author="hudson" created="Sun, 30 Apr 2017 22:22:38 +0000"  >&lt;p&gt;ABORTED: Integrated in Jenkins build HBase-&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14614&quot; title=&quot;Procedure v2: Core Assignment Manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14614&quot;&gt;&lt;del&gt;HBASE-14614&lt;/del&gt;&lt;/a&gt; #190 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-HBASE-14614/190/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/HBase-HBASE-14614/190/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-17869&quot; title=&quot;UnsafeAvailChecker wrongly returns false on ppc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-17869&quot;&gt;&lt;del&gt;HBASE-17869&lt;/del&gt;&lt;/a&gt; UnsafeAvailChecker wrongly returns false on ppc (jerryjch: rev af604f0c0cf3c40c56746150ffa860aad07f128a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;(edit) hbase-common/src/main/java/org/apache/hadoop/hbase/util/UnsafeAvailChecker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13062300">HBASE-17890</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12861748" name="HBASE-17869.patch" size="1763" author="jinghe" created="Mon, 3 Apr 2017 18:41:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3d5af:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>