{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3516","repository_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3516/labels{/name}","comments_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3516/comments","events_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3516/events","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/3516","id":722090598,"node_id":"MDU6SXNzdWU3MjIwOTA1OTg=","number":3516,"title":"Static field requires null instance, non-static field requires non-null instance","user":{"login":"KuraiAndras","id":19240945,"node_id":"MDQ6VXNlcjE5MjQwOTQ1","avatar_url":"https://avatars.githubusercontent.com/u/19240945?v=4","gravatar_id":"","url":"https://api.github.com/users/KuraiAndras","html_url":"https://github.com/KuraiAndras","followers_url":"https://api.github.com/users/KuraiAndras/followers","following_url":"https://api.github.com/users/KuraiAndras/following{/other_user}","gists_url":"https://api.github.com/users/KuraiAndras/gists{/gist_id}","starred_url":"https://api.github.com/users/KuraiAndras/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/KuraiAndras/subscriptions","organizations_url":"https://api.github.com/users/KuraiAndras/orgs","repos_url":"https://api.github.com/users/KuraiAndras/repos","events_url":"https://api.github.com/users/KuraiAndras/events{/privacy}","received_events_url":"https://api.github.com/users/KuraiAndras/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":92629237,"node_id":"MDU6TGFiZWw5MjYyOTIzNw==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/labels/Bug","name":"Bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/milestones/39","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/milestone/39","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/milestones/39/labels","id":5908278,"node_id":"MDk6TWlsZXN0b25lNTkwODI3OA==","number":39,"title":"11.0.0","description":"","creator":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":17,"state":"closed","created_at":"2020-09-23T06:22:12Z","updated_at":"2022-01-07T16:53:59Z","due_on":null,"closed_at":"2022-01-07T16:53:59Z"},"comments":10,"created_at":"2020-10-15T07:50:31Z","updated_at":"2020-11-29T00:20:09Z","closed_at":"2020-10-15T11:28:14Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We just upgraded AutoMapper from 10.0.0 to 10.1.0 and the Microsoft DI extension from 8.0.1 to 8.1.0. It broke during automated testing with XUnit, in a .net core 3.1 environment, with c#8 and nullable reference types enabled.\r\n\r\nIn the test we scan the same assemblies for profiles as in the main application, and then do IMapper.ConfigurationProvider.AssertConfigurationIsValid().\r\n\r\nWhen updateing from 10.0.0 to 10.1.0 the tests break when trying to resolve IMapper through an IServiceProvider, with this stack trace:\r\n```\r\nSystem.ArgumentException\r\nStatic field requires null instance, non-static field requires non-null instance. (Parameter 'expression')\r\n   at System.Linq.Expressions.Expression.Field(Expression expression, FieldInfo field)\r\n   at System.Linq.Expressions.Expression.MakeMemberAccess(Expression expression, MemberInfo member)\r\n   at AutoMapper.Execution.TypeMapPlanBuilder.CreatePropertyMapFunc(IMemberMap memberMap, Expression destination, MemberInfo destinationMember)\r\n   at AutoMapper.Execution.TypeMapPlanBuilder.CreateAssignmentFunc(Expression destinationFunc)\r\n   at AutoMapper.Execution.TypeMapPlanBuilder.CreateMapperLambda(HashSet`1 typeMapsPath)\r\n   at AutoMapper.TypeMap.CreateMapperLambda(IConfigurationProvider configurationProvider, HashSet`1 typeMapsPath)\r\n   at AutoMapper.TypeMap.Seal(IConfigurationProvider configurationProvider)\r\n   at AutoMapper.MapperConfiguration.Seal()\r\n   at AutoMapper.MapperConfiguration..ctor(MapperConfigurationExpression configurationExpression)\r\n   at AutoMapper.ServiceCollectionExtensions.<>c.<AddAutoMapperClasses>b__12_2(IServiceProvider sp)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitFactory(FactoryCallSite factoryCallSite, RuntimeResolverContext context)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitCache(ServiceCallSite callSite, RuntimeResolverContext context, ServiceProviderEngineScope serviceProviderEngine, RuntimeResolverLock lockType)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitRootCache(ServiceCallSite singletonCallSite, RuntimeResolverContext context)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.DynamicServiceProviderEngine.<>c__DisplayClass1_0.<RealizeService>b__0(ServiceProviderEngineScope scope)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngine.GetService(Type serviceType, ServiceProviderEngineScope serviceProviderEngineScope)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.GetService(Type serviceType)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)\r\n   at AutoMapper.ServiceCollectionExtensions.<>c.<AddAutoMapperClasses>b__12_3(IServiceProvider sp)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitFactory(FactoryCallSite factoryCallSite, RuntimeResolverContext context)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSiteMain(ServiceCallSite callSite, TArgument argument)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.VisitDisposeCache(ServiceCallSite transientCallSite, RuntimeResolverContext context)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteVisitor`2.VisitCallSite(ServiceCallSite callSite, TArgument argument)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.CallSiteRuntimeResolver.Resolve(ServiceCallSite callSite, ServiceProviderEngineScope scope)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.DynamicServiceProviderEngine.<>c__DisplayClass1_0.<RealizeService>b__0(ServiceProviderEngineScope scope)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngine.GetService(Type serviceType, ServiceProviderEngineScope serviceProviderEngineScope)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngine.GetService(Type serviceType)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceProvider.GetService(Type serviceType)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService(IServiceProvider provider, Type serviceType)\r\n   at Microsoft.Extensions.DependencyInjection.ServiceProviderServiceExtensions.GetRequiredService[T](IServiceProvider provider)\r\n   at ApplicationName.Application.Tests.MappingTests..ctor(IServiceCollection services) in C:\\***\\ApplicationName.Application.Tests\\MappingTests.cs:line 12\r\n```\r\n\r\nI read the release notes for [10.1.0](https://github.com/AutoMapper/AutoMapper/releases/tag/v10.1.0) but I did not see any breaking change there that might cause this. Do you have any idea what would cause an exception like this?","closed_by":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3516/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3516/timeline","performed_via_github_app":null,"state_reason":"completed"}