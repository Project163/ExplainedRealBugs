{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1257","repository_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1257/labels{/name}","comments_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1257/comments","events_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1257/events","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1257","id":152947824,"node_id":"MDU6SXNzdWUxNTI5NDc4MjQ=","number":1257,"title":"Dynamic mapping with nested dynamic objects","user":{"login":"barriestewart","id":5237045,"node_id":"MDQ6VXNlcjUyMzcwNDU=","avatar_url":"https://avatars.githubusercontent.com/u/5237045?v=4","gravatar_id":"","url":"https://api.github.com/users/barriestewart","html_url":"https://github.com/barriestewart","followers_url":"https://api.github.com/users/barriestewart/followers","following_url":"https://api.github.com/users/barriestewart/following{/other_user}","gists_url":"https://api.github.com/users/barriestewart/gists{/gist_id}","starred_url":"https://api.github.com/users/barriestewart/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/barriestewart/subscriptions","organizations_url":"https://api.github.com/users/barriestewart/orgs","repos_url":"https://api.github.com/users/barriestewart/repos","events_url":"https://api.github.com/users/barriestewart/events{/privacy}","received_events_url":"https://api.github.com/users/barriestewart/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2016-05-04T07:42:00Z","updated_at":"2019-05-07T18:05:17Z","closed_at":"2016-05-12T14:59:32Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"With AutoMapper 4.2.1, when mapping from a dynamic to an instance of an object, AutoMapper preserves top-level destination object properties with null/default values which do not have a corresponding property in the source object. For any nested properties which are dynamic objects, the same does not hold true. This is probably easiest to explain with an example:\n\n``` C#\n    class SubSetting\n    {\n        public int SubTimeout { get; set; }\n        public string SubColour { get; set; }\n    }\n\n    class Settings\n    {\n        public int Timeout { get; set; }\n        public string Colour { get; set; }\n        public SubSetting SubSettings { get; set; }\n    }\n\n    class Program\n    {\n        static void Main(string[] args)\n        {\n            // The SubSettings property is another ExpandoObject.\n            dynamic baseSettings = new ExpandoObject();\n            baseSettings.Timeout = 1;\n            baseSettings.Colour = \"Red\";\n            baseSettings.SubSettings = new ExpandoObject();\n            baseSettings.SubSettings.SubTimeout = 11;\n            baseSettings.SubSettings.SubColour = \"Green\";\n\n            // Create another object we will map onto the one above. \n            // Notice that we do not set a Colour or SubColour property.\n            dynamic overrideSettings = new ExpandoObject();\n            overrideSettings.Timeout = 2;\n            overrideSettings.SubSettings = new ExpandoObject();\n            overrideSettings.SubSettings.SubTimeout = 22;\n\n            var config = new MapperConfiguration(cfg => { });\n            var mapper = config.CreateMapper();\n\n            var settings = mapper.Map<Settings>(baseSettings);\n\n            // After this next mapping, settings.Colour == \"Red\" but settings.SubSettings.SubColour == null.\n            mapper.Map(overrideSettings, settings);\n        }\n    }\n```\n\nSo as mentioned in the code comments, after the second mapping `settings.SubSettings.SubColour` is null. Is this the intended behaviour for dynamic mapping? I also tried upgrading to the latest MyGet build `5.0.0-ci-1057` to see if it made a difference but that throws the following exception when making the second call to `Map()`:\n\n```\nSystem.InvalidCastException\n\nUnable to cast object of type 'System.Func`4[System.Object,System.Object,AutoMapper.ResolutionContext,System.Object]' to type 'System.Func`4[System.Dynamic.ExpandoObject,TestConsoleApp.Settings,AutoMapper.ResolutionContext,TestConsoleApp.Settings]'.\n```\n","closed_by":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1257/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1257/timeline","performed_via_github_app":null,"state_reason":"completed"}