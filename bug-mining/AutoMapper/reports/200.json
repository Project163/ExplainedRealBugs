{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3612","repository_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3612/labels{/name}","comments_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3612/comments","events_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3612/events","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/3612","id":841219384,"node_id":"MDU6SXNzdWU4NDEyMTkzODQ=","number":3612,"title":"map_closed_to_ienumerable_generic_destination Closes #3611","user":{"login":"ace210","id":38096252,"node_id":"MDQ6VXNlcjM4MDk2MjUy","avatar_url":"https://avatars.githubusercontent.com/u/38096252?v=4","gravatar_id":"","url":"https://api.github.com/users/ace210","html_url":"https://github.com/ace210","followers_url":"https://api.github.com/users/ace210/followers","following_url":"https://api.github.com/users/ace210/following{/other_user}","gists_url":"https://api.github.com/users/ace210/gists{/gist_id}","starred_url":"https://api.github.com/users/ace210/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ace210/subscriptions","organizations_url":"https://api.github.com/users/ace210/orgs","repos_url":"https://api.github.com/users/ace210/repos","events_url":"https://api.github.com/users/ace210/events{/privacy}","received_events_url":"https://api.github.com/users/ace210/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2021-03-25T18:56:29Z","updated_at":"2021-05-02T00:06:22Z","closed_at":"2021-03-25T19:43:52Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Source/destination types\r\n\r\n```csharp\r\n        class Source\r\n        {\r\n            public IEnumerable<int> MyValues;\r\n        }\r\n\r\n        class Destination<T>\r\n        {\r\n            public IEnumerable<T> MyValues;\r\n        }\r\n\r\n        protected override MapperConfiguration Configuration => new MapperConfiguration(cfg =>\r\n        {\r\n            cfg.CreateMap(typeof(Source), typeof(Destination<>))\r\n                .ForMember(\"MyValues\", o => o.MapFrom(typeof(ValuesResolver<>)));\r\n        });\r\n \r\n        private class ValuesResolver<TDestination>\r\n            : IValueResolver<Source, Destination<TDestination>, IEnumerable<TDestination>>\r\n        {\r\n            public IEnumerable<TDestination> Resolve(Source source, Destination<TDestination> destination, IEnumerable<TDestination> destMember, ResolutionContext context)\r\n            {\r\n                foreach (var item in source.MyValues)\r\n                {\r\n                    yield return (TDestination)((object)item);\r\n                }\r\n            }\r\n        }\r\n\r\n        [Fact]\r\n        public void Should_map_closed_to_ienumerable_generic_destination()\r\n        {\r\n            var source = new Source { MyValues = new int[] { 1, 2 } };\r\n            var destination = Map<Destination<int>>(source);\r\n            destination.MyValues.ShouldBe(source.MyValues);\r\n        }\r\n```\r\n\r\n\r\n### Steps to reproduce\r\n\r\n```csharp\r\n AutoMapper.UnitTests.GenericValueResolver.Should_map_closed_to_ienumerable_generic_destination\r\n   Source: OpenGenerics.cs line 210\r\n   Duration: 16 ms\r\n\r\n  Message: \r\n    System.ArgumentException : Type AutoMapper.UnitTests.GenericValueResolver+Destination`1[TDestination] contains generic parameters\r\n  Stack Trace: \r\n    TypeUtils.ValidateType(Type type)\r\n    Expression.Convert(Expression expression, Type type, MethodInfo method)\r\n    Expression.Convert(Expression expression, Type type)\r\n    ExpressionBuilder.ToType(Expression expression, Type type) line 310\r\n    <ZipIterator>d__61`3.MoveNext()\r\n    <ConcatIterator>d__59`1.MoveNext()\r\n    Buffer`1.ctor(IEnumerable`1 source)\r\n    Enumerable.ToArray[TSource](IEnumerable`1 source)\r\n    TypeMapPlanBuilder.BuildResolveCall(Expression source, Expression destValueExpr, MemberMap memberMap) line 442\r\n    TypeMapPlanBuilder.BuildValueResolverFunc(MemberMap memberMap, Expression destValueExpr) line 391\r\n    TypeMapPlanBuilder.CreatePropertyMapFunc(MemberMap memberMap, Expression destination, MemberInfo destinationMember) line 312\r\n    TypeMapPlanBuilder.TryPropertyMap(PropertyMap propertyMap) line 287\r\n    TypeMapPlanBuilder.CreateAssignmentFunc(Expression createDestination) line 175\r\n    TypeMapPlanBuilder.CreateMapperLambda(HashSet`1 typeMapsPath) line 54\r\n    TypeMap.CreateMapperLambda(IGlobalConfiguration configurationProvider, HashSet`1 typeMapsPath) line 325\r\n    TypeMap.Seal(IGlobalConfiguration configurationProvider, HashSet`1 typeMapsPath) line 302\r\n    MapperConfiguration.ResolveTypeMap(TypePair& typePair) line 258\r\n    IGlobalConfiguration.BuildExecutionPlan(MapRequest& mapRequest) line 135\r\n    MapperConfiguration.CompileExecutionPlan(MapRequest mapRequest) line 167\r\n    <.ctor>b__1() line 10\r\n    Lazy`1.CreateValue()\r\n    Lazy`1.LazyInitValue()\r\n    Lazy`1.get_Value()\r\n    LockingConcurrentDictionary`2.GetOrAdd(TKey& key) line 11\r\n    MapperConfiguration.GetExecutionPlan(MapRequest& mapRequest) line 163\r\n    IGlobalConfiguration.GetExecutionPlan[TSource,TDestination](MapRequest& mapRequest) line 161\r\n    Mapper.MapCore[TSource,TDestination](TSource source, TDestination destination, ResolutionContext context, Type sourceType, Type destinationType, MemberMap memberMap) line 197\r\n    Mapper.Map[TSource,TDestination](TSource source, TDestination destination) line 162\r\n    Mapper.Map[TDestination](Object source) line 156\r\n    NonValidatingSpecBase.Map[TDestination](Object source) line 60\r\n    GenericValueResolver.Should_map_closed_to_ienumerable_generic_destination() line 213\r\n\r\n```\r\nCloses #3611 ","closed_by":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3612/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3612/timeline","performed_via_github_app":null,"state_reason":"completed"}