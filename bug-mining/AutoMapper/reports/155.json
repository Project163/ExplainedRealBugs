{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1529","repository_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1529/labels{/name}","comments_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1529/comments","events_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1529/events","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1529","id":165741834,"node_id":"MDU6SXNzdWUxNjU3NDE4MzQ=","number":1529,"title":"Possible regression: AutoMapper 5.0.2 calls ToString() where 4.x didn't","user":{"login":"thedmi","id":1295139,"node_id":"MDQ6VXNlcjEyOTUxMzk=","avatar_url":"https://avatars.githubusercontent.com/u/1295139?v=4","gravatar_id":"","url":"https://api.github.com/users/thedmi","html_url":"https://github.com/thedmi","followers_url":"https://api.github.com/users/thedmi/followers","following_url":"https://api.github.com/users/thedmi/following{/other_user}","gists_url":"https://api.github.com/users/thedmi/gists{/gist_id}","starred_url":"https://api.github.com/users/thedmi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thedmi/subscriptions","organizations_url":"https://api.github.com/users/thedmi/orgs","repos_url":"https://api.github.com/users/thedmi/repos","events_url":"https://api.github.com/users/thedmi/events{/privacy}","received_events_url":"https://api.github.com/users/thedmi/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":92629237,"node_id":"MDU6TGFiZWw5MjYyOTIzNw==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/labels/Bug","name":"Bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/milestones/21","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/milestone/21","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/milestones/21/labels","id":1851937,"node_id":"MDk6TWlsZXN0b25lMTg1MTkzNw==","number":21,"title":"5.1.0","description":"","creator":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":57,"state":"closed","created_at":"2016-06-28T03:41:49Z","updated_at":"2016-08-12T16:22:05Z","due_on":null,"closed_at":"2016-08-12T16:22:05Z"},"comments":16,"created_at":"2016-07-15T09:03:14Z","updated_at":"2019-05-07T11:15:17Z","closed_at":"2016-07-18T15:36:26Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"During my attempt to update to 5.0.2 I came across what may be a regression. \n\nA combination of `cfg.CreateMap<T, string>().ProjectUsing(...)` and `T` being a base type of the member that is actually mapped causes the problem: AutoMapper 5 calls `ToString()` instead of the configured projection. AutoMapper 4, on the other hand, uses the projection.\n\nThe following test illustrates the problem:\n\n```\n[Fact]\npublic void Custom_string_mapping_is_used()\n{\n    var config = new MapperConfiguration(\n        cfg =>\n        {\n            cfg.CreateMap<Source, Destination>();\n            cfg.CreateMap<IId, string>().ProjectUsing(id => id.Serialize());\n        });\n\n    var mapper = config.CreateMapper();\n\n    var output = mapper.Map<Destination>(new Source { TheId = new Id { Prefix = \"p\", Value = \"v\" } });\n\n    Assert.Equal(\"p_v\", output.TheId);\n}\n\nclass Source\n{\n    public Id TheId { get; set; }\n}\n\nclass Destination\n{\n    public string TheId { get; set; }\n}\n\ninterface IId\n{\n    string Serialize();\n}\n\nclass Id : IId\n{\n    public string Prefix { get; set; }\n\n    public string Value { get; set; }\n\n    public string Serialize()\n    {\n        return Prefix + \"_\" + Value;\n    }\n}\n```\n### Observations\n- With AutoMapper 5, `output.TheId` is the FQN of the `Id` class, indicating that AutoMapper calls `ToString()`.\n- When the interface `IId` is removed and the class `Id` is used directly, the mapping behaves as expected. This is however not flexible enough for my case, because I have many implementations of that interface.\n- It doesn't matter whether `ProjectUsing` or `ConvertUsing` is used.\n","closed_by":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1529/timeline","performed_via_github_app":null,"state_reason":"completed"}