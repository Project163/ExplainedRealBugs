[{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/248571713","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-248571713","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":248571713,"node_id":"MDEyOklzc3VlQ29tbWVudDI0ODU3MTcxMw==","user":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-09-21T10:25:22Z","updated_at":"2016-09-21T11:05:32Z","body":"Did you profile it? If you have a repro, I can do it myself.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/248571713/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/248591768","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-248591768","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":248591768,"node_id":"MDEyOklzc3VlQ29tbWVudDI0ODU5MTc2OA==","user":{"login":"sambauwens","id":1354090,"node_id":"MDQ6VXNlcjEzNTQwOTA=","avatar_url":"https://avatars.githubusercontent.com/u/1354090?v=4","gravatar_id":"","url":"https://api.github.com/users/sambauwens","html_url":"https://github.com/sambauwens","followers_url":"https://api.github.com/users/sambauwens/followers","following_url":"https://api.github.com/users/sambauwens/following{/other_user}","gists_url":"https://api.github.com/users/sambauwens/gists{/gist_id}","starred_url":"https://api.github.com/users/sambauwens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sambauwens/subscriptions","organizations_url":"https://api.github.com/users/sambauwens/orgs","repos_url":"https://api.github.com/users/sambauwens/repos","events_url":"https://api.github.com/users/sambauwens/events{/privacy}","received_events_url":"https://api.github.com/users/sambauwens/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-09-21T12:06:11Z","updated_at":"2016-09-21T12:07:18Z","body":"Oh I just assumed Automapper was now slow at startup because of the compilation thing, I didn't think it had something to do with our mappings. I'll see if I can nail it down to a repro project.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/248591768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sambauwens","id":1354090,"node_id":"MDQ6VXNlcjEzNTQwOTA=","avatar_url":"https://avatars.githubusercontent.com/u/1354090?v=4","gravatar_id":"","url":"https://api.github.com/users/sambauwens","html_url":"https://github.com/sambauwens","followers_url":"https://api.github.com/users/sambauwens/followers","following_url":"https://api.github.com/users/sambauwens/following{/other_user}","gists_url":"https://api.github.com/users/sambauwens/gists{/gist_id}","starred_url":"https://api.github.com/users/sambauwens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sambauwens/subscriptions","organizations_url":"https://api.github.com/users/sambauwens/orgs","repos_url":"https://api.github.com/users/sambauwens/repos","events_url":"https://api.github.com/users/sambauwens/events{/privacy}","received_events_url":"https://api.github.com/users/sambauwens/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/248592121","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-248592121","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":248592121,"node_id":"MDEyOklzc3VlQ29tbWVudDI0ODU5MjEyMQ==","user":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-09-21T12:07:58Z","updated_at":"2016-09-21T12:07:58Z","body":"5-10s is practically forever :) First we need to know why and take it from there.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/248592121/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/251580875","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-251580875","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":251580875,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTU4MDg3NQ==","user":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-05T04:47:02Z","updated_at":"2016-10-05T04:47:02Z","body":"One quick way would be to call AssertConfigurationIsValid? I believe that executes all the maps. I think.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/251580875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/251985911","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-251985911","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":251985911,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTk4NTkxMQ==","user":{"login":"sambauwens","id":1354090,"node_id":"MDQ6VXNlcjEzNTQwOTA=","avatar_url":"https://avatars.githubusercontent.com/u/1354090?v=4","gravatar_id":"","url":"https://api.github.com/users/sambauwens","html_url":"https://github.com/sambauwens","followers_url":"https://api.github.com/users/sambauwens/followers","following_url":"https://api.github.com/users/sambauwens/following{/other_user}","gists_url":"https://api.github.com/users/sambauwens/gists{/gist_id}","starred_url":"https://api.github.com/users/sambauwens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sambauwens/subscriptions","organizations_url":"https://api.github.com/users/sambauwens/orgs","repos_url":"https://api.github.com/users/sambauwens/repos","events_url":"https://api.github.com/users/sambauwens/events{/privacy}","received_events_url":"https://api.github.com/users/sambauwens/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-06T14:49:13Z","updated_at":"2016-10-06T14:49:13Z","body":"`AssertConfigurationIsValid()` throws an `AutoMapperConfigurationException` almost instantly due to many unmapped properties, there's a whole bunch of them in our project. These are fields we didn't put in our ValueObjects (mapping target) because we didn't want to map them. Automapper doesn't complain about them when we call `Map`.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/251985911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sambauwens","id":1354090,"node_id":"MDQ6VXNlcjEzNTQwOTA=","avatar_url":"https://avatars.githubusercontent.com/u/1354090?v=4","gravatar_id":"","url":"https://api.github.com/users/sambauwens","html_url":"https://github.com/sambauwens","followers_url":"https://api.github.com/users/sambauwens/followers","following_url":"https://api.github.com/users/sambauwens/following{/other_user}","gists_url":"https://api.github.com/users/sambauwens/gists{/gist_id}","starred_url":"https://api.github.com/users/sambauwens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sambauwens/subscriptions","organizations_url":"https://api.github.com/users/sambauwens/orgs","repos_url":"https://api.github.com/users/sambauwens/repos","events_url":"https://api.github.com/users/sambauwens/events{/privacy}","received_events_url":"https://api.github.com/users/sambauwens/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/251987145","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-251987145","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":251987145,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MTk4NzE0NQ==","user":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-06T14:53:10Z","updated_at":"2016-10-06T14:53:10Z","body":"Wait, you don't call AssertConfigurationIsValid at any point? Not in a test or anything? That's dangerous, I wouldn't use AutoMapper at all without configuration validation. That was the #1 reason why I built AutoMapper.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/251987145/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253525004","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253525004","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253525004,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzUyNTAwNA==","user":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-13T14:13:10Z","updated_at":"2016-10-13T14:13:10Z","body":"Struggling with the same issue I think.\nUsing AutoMapper with some complex and deep mappings on our web-api. The first request takes 5-10 seconds and makes memory temporarily jump ~2 GB. If we hit the newly rebooted web-api with a concurrency test with 50 concurrent requests, the memory crawls up to ~30GB and everything just stops.\nTried invoking the `AssertConfigurationIsValid()` but that did not seem to do anything. However, performing a single map in the bootstrapper seemed to \"get things ready\" for the 50 request test.\nAnother set of weird observations is that all that consumed memory is marked as unmanaged, and if we switch the IIS over to 32-bit everything regarding memory seems fine...\n\nWhat does AutoMapper exactly do when it maps for the first time? And is a concurrent/parallell \"first-time-map\" scenario supported/thought of?\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253525004/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253526496","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253526496","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253526496,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzUyNjQ5Ng==","user":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-13T14:18:09Z","updated_at":"2016-10-13T14:18:09Z","body":"You need to profile it. Guessing won't do.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253526496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253531809","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253531809","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253531809,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzUzMTgwOQ==","user":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-13T14:35:51Z","updated_at":"2016-10-13T14:35:51Z","body":"@jbogard I have no idea whether that's an issue in real life, but maybe lock when compiling? Because now there's a race and compiling could happen more than once, depending on how long it takes.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253531809/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":822581901,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODIyNTgxOTAx","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822581901","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-10-13T14:35:51Z","performed_via_github_app":null},{"id":822581902,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDgyMjU4MTkwMg==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822581902","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-10-13T14:35:51Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253544011","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253544011","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253544011,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzU0NDAxMQ==","user":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-13T15:15:56Z","updated_at":"2016-10-13T15:15:56Z","body":"A race on what though? We only compile each expression once.\n\n@kopfsick does that concurrency match what you do at runtime? You have 50 hitting it at once after startup? What does that mapping look like?\n\nAutoMapper just compiles a lambda expression. The expression is already built, we're just calling \"Compile\". But without seeing your mapping I can't really reproduce it.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253544011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":822647809,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODIyNjQ3ODA5","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822647809","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-10-13T15:15:56Z","performed_via_github_app":null},{"id":822647810,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDgyMjY0NzgxMA==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822647810","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-10-13T15:15:56Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253565282","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253565282","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253565282,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzU2NTI4Mg==","user":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-13T16:28:22Z","updated_at":"2016-10-13T16:28:22Z","body":"We've profiled it with ANTS, but since it just shows up as unmanaged memory we hit a dead end. Maybe I'm just not skilled enough with ANTS, is there some way to see what's actually going on?\n\nThat concurrency test is potentially a scenario we could face in production yes, we're still a couple of months away from first release to the customer. We could of course make sure to invoke every map once right after boot, but that creates some rather uncomfortable code imho.\n\nThe mappings are, as mentioned, quite deep and complex and parts of it involves a great deal of Condition(), ConvertUsing() and ResolveUsing() with varying degree of complexion. I'm not allowed to post any of it here, but it's roughly 1-2k lines of mapping code in our profiles combined.\n\nI can see that there probably ends up being a race on the expression compilation. But a race that doesn't end in deadlocks, just enormous amounts of duplicated compiled expressions in memory. Which of the duplicates that ends up being persisted in the configuration is anyones guess.\n\nDoes the `AssertConfigurationIsValid()` actually compile the expressions? Away from code right now, I'll investigate more tomorrow.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253565282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253575509","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253575509","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253575509,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzU3NTUwOQ==","user":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-13T17:06:15Z","updated_at":"2016-10-13T17:06:15Z","body":"@jbogard No, we don't :) If 10 threads happen to try the first map, some of them will compile concurrently, because they might be inside the GetAdd factory at the same time.\n@kopfsick What I'm talking about applies to one given map. That doesn't seem like a realistic scenario. It seems more likely that different maps are compiled concurrently and to prevent that you should compile them before time.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253575509/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":822814789,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODIyODE0Nzg5","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822814789","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-10-13T17:06:15Z","performed_via_github_app":null},{"id":822814790,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDgyMjgxNDc5MA==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822814790","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-10-13T17:06:15Z","performed_via_github_app":null},{"id":822814791,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODIyODE0Nzkx","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822814791","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-10-13T17:06:15Z","performed_via_github_app":null},{"id":822814793,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDgyMjgxNDc5Mw==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822814793","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-10-13T17:06:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253575533","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253575533","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253575533,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzU3NTUzMw==","user":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-13T17:06:23Z","updated_at":"2016-10-13T17:06:23Z","body":"No it looks like AssertConfigurationIsValid does not compile expressions.\n\nIf the mapping config is as complex as you say, I doubt compiling all at once would make things better. MVC for example only compiles expressions in Razor the first time that page is hit. That's why when we do profiling we warm up the pages with a request before testing with load.\n\nWhat is it like for just one request hitting the page for the first time? Rather than ANTS have you looked at JetBrains DotTrace? That's what I use.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253575533/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253600128","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253600128","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253600128,"node_id":"MDEyOklzc3VlQ29tbWVudDI1MzYwMDEyOA==","user":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-13T18:37:20Z","updated_at":"2016-10-13T18:37:20Z","body":"@kopfsick It's easier to profile for CPU, probably that's where the allocations come from. If most of the time is in Compile, then you need to determine what maps get compiled and if they overlap.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253600128/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":822938839,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODIyOTM4ODM5","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822938839","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-10-13T18:37:20Z","performed_via_github_app":null},{"id":822938840,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDgyMjkzODg0MA==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/822938840","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-10-13T18:37:20Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253740111","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253740111","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253740111,"node_id":"MDEyOklzc3VlQ29tbWVudDI1Mzc0MDExMQ==","user":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-14T08:29:28Z","updated_at":"2016-10-14T08:29:28Z","body":"Thanks for all feedback, I think I'm getting a clearer picture now.\n\nI think its definitely a \"race\" in creating and compiling the mapper funcs into the `_mapPlanCache` dictionary in `MapperConfiguration` when we're hitting the api concurrently for the first map. Compiling all expressions multiple times concurrently combined with the fact that our expressions are complex is just heavy and requires a lot of memory and CPU. \nSimplifying our custom expressions and maybe using `IValueResolver` and `ITypeConverter` more instead of complex funcs in `ResolveUsing()`s could probably help. That would make the expressions smaller and easier to compile, right?\n\n@jbogard The first request, which hits an endpoint that requires one of the complex mappings, takes approx 5-10 seconds with a memory usage of approx 2GB. Subsequent requests is, except DB operations, almost insignificant in both time, CPU and memory.\n\nAnd regarding DotTrace/DotMemory, I haven't tried it even though i have the complete R# Ultimate license. Will try it soon now though :)\n\nWe did try to initiate compilation of all typemaps in our bootstrapper, but it didn't seem to work, altough I don't understand why:\n\n`var typeMaps = config.GetAllTypeMaps();`\n`foreach (var typeMap in typeMaps)`\n`{`\n`var func = config.GetUntypedMapperFunc(new MapRequest(typeMap.Types, typeMap.Types));`\n`}`\n\nThat code should, as I see it, perform the same operations that would be performed when we invoke\n`_mapper.Map<TDestination>(sourceObject);`\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253740111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":823649548,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODIzNjQ5NTQ4","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/823649548","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-10-14T08:29:28Z","performed_via_github_app":null},{"id":823649550,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDgyMzY0OTU1MA==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/events/823649550","actor":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-10-14T08:29:28Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253742258","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253742258","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253742258,"node_id":"MDEyOklzc3VlQ29tbWVudDI1Mzc0MjI1OA==","user":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-14T08:40:23Z","updated_at":"2016-10-14T08:40:23Z","body":"You shouldn't have to change your code. Compiling expressions should be faster than compiling C#. The concurrency issue, we can fix, If after this, compiling still takes more than a few hundred milliseconds, then there is a problem. And if we can't help, MS should be able to.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253742258/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253747274","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253747274","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253747274,"node_id":"MDEyOklzc3VlQ29tbWVudDI1Mzc0NzI3NA==","user":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-14T09:04:33Z","updated_at":"2016-10-14T09:04:33Z","body":"#1734 solves the concurrency issue.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253747274/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lbargaoanu","id":4517428,"node_id":"MDQ6VXNlcjQ1MTc0Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4517428?v=4","gravatar_id":"","url":"https://api.github.com/users/lbargaoanu","html_url":"https://github.com/lbargaoanu","followers_url":"https://api.github.com/users/lbargaoanu/followers","following_url":"https://api.github.com/users/lbargaoanu/following{/other_user}","gists_url":"https://api.github.com/users/lbargaoanu/gists{/gist_id}","starred_url":"https://api.github.com/users/lbargaoanu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lbargaoanu/subscriptions","organizations_url":"https://api.github.com/users/lbargaoanu/orgs","repos_url":"https://api.github.com/users/lbargaoanu/repos","events_url":"https://api.github.com/users/lbargaoanu/events{/privacy}","received_events_url":"https://api.github.com/users/lbargaoanu/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253762774","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/1693#issuecomment-253762774","issue_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/1693","id":253762774,"node_id":"MDEyOklzc3VlQ29tbWVudDI1Mzc2Mjc3NA==","user":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-10-14T10:18:59Z","updated_at":"2016-10-14T10:18:59Z","body":"That should force a single compilation yes :)\nI think we'll have to perform some warmup-mappings in our bootstrapper and/or manually warm it up after a reboot until we can get this fix in.\n\nStill, our first non-concurrent map takes several seconds for the most complex mappings we have. Another mapping configuration part which is similar in depth as the most complex one, but much more straight-forward with very little custom resolving seems to compile quite fast. So I can't help thinking that the size and complexity of our mappings affect the compilation time, and that I should consider having a refactoring done. But, so much to do and so little time...\n\nThanks anyway for helping me understand the behavior and making that PR :)\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/comments/253762774/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kopfsick","id":15138323,"node_id":"MDQ6VXNlcjE1MTM4MzIz","avatar_url":"https://avatars.githubusercontent.com/u/15138323?v=4","gravatar_id":"","url":"https://api.github.com/users/kopfsick","html_url":"https://github.com/kopfsick","followers_url":"https://api.github.com/users/kopfsick/followers","following_url":"https://api.github.com/users/kopfsick/following{/other_user}","gists_url":"https://api.github.com/users/kopfsick/gists{/gist_id}","starred_url":"https://api.github.com/users/kopfsick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kopfsick/subscriptions","organizations_url":"https://api.github.com/users/kopfsick/orgs","repos_url":"https://api.github.com/users/kopfsick/repos","events_url":"https://api.github.com/users/kopfsick/events{/privacy}","received_events_url":"https://api.github.com/users/kopfsick/received_events","type":"User","user_view_type":"public","site_admin":false}}]