{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/2706","repository_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/2706/labels{/name}","comments_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/2706/comments","events_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/2706/events","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/2706","id":336598803,"node_id":"MDU6SXNzdWUzMzY1OTg4MDM=","number":2706,"title":"Extremely bad Performance with .NET Native","user":{"login":"sebastianfilke","id":10894484,"node_id":"MDQ6VXNlcjEwODk0NDg0","avatar_url":"https://avatars.githubusercontent.com/u/10894484?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianfilke","html_url":"https://github.com/sebastianfilke","followers_url":"https://api.github.com/users/sebastianfilke/followers","following_url":"https://api.github.com/users/sebastianfilke/following{/other_user}","gists_url":"https://api.github.com/users/sebastianfilke/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianfilke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianfilke/subscriptions","organizations_url":"https://api.github.com/users/sebastianfilke/orgs","repos_url":"https://api.github.com/users/sebastianfilke/repos","events_url":"https://api.github.com/users/sebastianfilke/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianfilke/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2018-06-28T12:24:19Z","updated_at":"2019-05-06T02:30:10Z","closed_at":"2018-07-04T21:23:38Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We have a really big problem with Automapper and when the application is compiled in release mode with .NET Native and optimize for UWP Apps, Xamarin Forms 3.1.\r\n\r\nWe have a big application with three Profiles. Each Profile has a relatively big profile description.\r\nIn UWP with Debug mode the mapping takes about 21ms. \r\nIn .NET Native the mapping takes about **9625ms**! That's 458 times worse! That's crazy.\r\nNo lines of code were changed!\r\n\r\nThe funny thing about it is, that this is always the same for some elements which have a Manual (the only thing i recognize in the moment). But for elements which doesn't have a Manual everything works okay.\r\n\r\nBut also in General. Automapper is much slower in .NET Native.\r\n\r\n### Source/destination types\r\n\r\nSource\r\n```csharp\r\n internal class DeviceEntity : IAppEntity, IDisabledEntity {\r\n\r\n        static DeviceEntity() {\r\n            Triggers<DeviceEntity>.Inserting += entry => { entry.Entity.Modified = true; };\r\n            Triggers<DeviceEntity>.Updating += entry => { entry.Entity.Modified = true; };\r\n        }\r\n\r\n        public string GuidDevice { get; set; }\r\n        public int? IdDevice { get; set; }\r\n        public int IdDeviceType { get; set; }\r\n        public string GuidFunctionalArea { get; set; }\r\n        public int? IdFunctionalArea { get; set; }\r\n        public string Name { get; set; }\r\n        public string Description { get; set; }\r\n        public string Manufacturer { get; set; }\r\n        public bool Disabled { get; set; }\r\n        public DateTimeOffset? DisabledSince { get; set; }\r\n        public byte[] Image { get; set; }\r\n        public byte[] Manual { get; set; }\r\n        public string ManualName { get; set; }\r\n        public string InventoryNumber { get; set; }\r\n        public double? DefinedSetpoint { get; set; }\r\n        public bool TemperatureIndicator { get; set; }\r\n        public bool Modified { get; set; }\r\n        public DateTimeOffset? ModificationDate { get; set; }\r\n\r\n        public DeviceTypeEntity DeviceType { get; set; }\r\n        public FunctionalAreaEntity FunctionalArea { get; set; }\r\n        public HashSet<QuestionAssignmentEntity> QuestionAssignments { get; set; } = new HashSet<QuestionAssignmentEntity>();\r\n        public HashSet<ProductForDeviceEntity> ProductForDevices { get; set; } = new HashSet<ProductForDeviceEntity>();\r\n        public HashSet<TaskEntity> Tasks { get; set; } = new HashSet<TaskEntity>();\r\n        public HashSet<TaskMeasurementEntity> TaskMeasurements { get; set; } = new HashSet<TaskMeasurementEntity>();\r\n\r\n        protected bool Equals(DeviceEntity other) {\r\n            return string.Equals(GuidDevice, other.GuidDevice) && IdDevice == other.IdDevice;\r\n        }\r\n\r\n        public override bool Equals(object obj) {\r\n            if (ReferenceEquals(null, obj)) {\r\n                return false;\r\n            }\r\n\r\n            if (ReferenceEquals(this, obj)) {\r\n                return true;\r\n            }\r\n\r\n            if (obj.GetType() != GetType()) {\r\n                return false;\r\n            }\r\n\r\n            return Equals((DeviceEntity) obj);\r\n        }\r\n\r\n        public override int GetHashCode() {\r\n            unchecked {\r\n                return ((GuidDevice != null ? GuidDevice.GetHashCode() : 0) * 397) ^ IdDevice.GetHashCode();\r\n            }\r\n        }\r\n\r\n    }\r\n```\r\nDestination\r\n```csharp\r\n  internal class DeviceModel : IDeviceModel {\r\n\r\n        public string GuidDevice { get; set; }\r\n        public int? IdDevice { get; set; }\r\n        public int IdDeviceType { get; set; }\r\n        public string GuidFunctionalArea { get; set; }\r\n        public int? IdFunctionalArea { get; set; }\r\n        public string Name { get; set; }\r\n        public string Description { get; set; }\r\n        public string Manufacturer { get; set; }\r\n        public byte[] Image { get; set; }\r\n        public byte[] Manual { get; set; }\r\n        public string ManualName { get; set; }\r\n        public string InventoryNumber { get; set; }\r\n        public double? DefinedSetpoint { get; set; }\r\n        public bool TemperatureIndicator { get; set; }\r\n        public bool Disabled { get; set; }\r\n        public DateTimeOffset? DisabledSince { get; set; }\r\n        public bool Modified { get; set; }\r\n        public DateTimeOffset? ModificationDate { get; set; }\r\n\r\n        public int AnsweredQuestionCount { get; set; }\r\n        public int TotalQuestionCount { get; set; }\r\n\r\n        public IDeviceTypeModel DeviceType { get; set; }\r\n        public IFunctionalAreaModel FunctionalArea { get; set; }\r\n        public HashSet<IProductForDeviceModel> ProductForDevices { get; set; } = new HashSet<IProductForDeviceModel>();\r\n        public HashSet<ITaskMeasurementModel> TaskMeasurements { get; set; } = new HashSet<ITaskMeasurementModel>();\r\n\r\n    }\r\n```\r\n### Mapping configuration\r\n\r\n```csharp\r\nCreateMap<DeviceEntity, DeviceModel>().ForMember(x => x.AnsweredQuestionCount, opt => opt.Ignore())\r\n                .ForMember(x => x.FunctionalArea, opt => opt.Ignore()).ForMember(x => x.TotalQuestionCount, opt => opt.Ignore())\r\n                .ForMember(x => x.TaskMeasurements, opt => opt.Ignore()).ForMember(x => x.DeviceType, opt => opt.Ignore()).ReverseMap()\r\n                .ForMember(x => x.DeviceType, opt => opt.Ignore()).ForMember(x => x.FunctionalArea, opt => opt.Ignore())\r\n                .ForMember(x => x.ProductForDevices, opt => opt.Ignore()).ForMember(x => x.Tasks, opt => opt.Ignore())\r\n                .ForMember(x => x.TaskMeasurements, opt => opt.Ignore()).ForMember(x => x.QuestionAssignments, opt => opt.Ignore());\r\n            CreateMap<DeviceEntity, IDeviceModel>().As<DeviceModel>();\r\n```\r\nInitilization\r\n```csharp\r\n\r\n            Mapper.Initialize(cfg => {\r\n                cfg.AllowNullCollections = true;\r\n                cfg.CreateMissingTypeMaps = false;\r\n                cfg.AddProfile<BusinessLogicMapperProfile>();\r\n                cfg.AddProfile<DataMapperProfile>();\r\n                cfg.AddProfile<UiMapperProfile>();\r\n            });\r\n\r\n            Mapper.Configuration.CompileMappings();\r\n```\r\n### Version: 7.0.1\r\n\r\n### Expected behavior\r\n\r\nI would excpect that performance is nearly the same like in debug for release and .NET Native.\r\n\r\n### Actual behavior\r\n\r\nReally bad performance for release and .NET Native\r\n","closed_by":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/2706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/2706/timeline","performed_via_github_app":null,"state_reason":"completed"}