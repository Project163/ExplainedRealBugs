{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/144","repository_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/144/labels{/name}","comments_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/144/comments","events_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/144/events","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/144","id":2165877,"node_id":"MDU6SXNzdWUyMTY1ODc3","number":144,"title":"Use the Mapping Engine to create instances of ctor arguments","user":{"login":"pedroreys","id":130238,"node_id":"MDQ6VXNlcjEzMDIzOA==","avatar_url":"https://avatars.githubusercontent.com/u/130238?v=4","gravatar_id":"","url":"https://api.github.com/users/pedroreys","html_url":"https://github.com/pedroreys","followers_url":"https://api.github.com/users/pedroreys/followers","following_url":"https://api.github.com/users/pedroreys/following{/other_user}","gists_url":"https://api.github.com/users/pedroreys/gists{/gist_id}","starred_url":"https://api.github.com/users/pedroreys/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pedroreys/subscriptions","organizations_url":"https://api.github.com/users/pedroreys/orgs","repos_url":"https://api.github.com/users/pedroreys/repos","events_url":"https://api.github.com/users/pedroreys/events{/privacy}","received_events_url":"https://api.github.com/users/pedroreys/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2011-11-07T18:47:46Z","updated_at":"2019-05-08T21:32:42Z","closed_at":"2011-12-11T21:03:14Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Here is a test to reproduce the issue\n\n```\n[TestFixture]\npublic class UsingMappingEngineToResolveConstructorArguments\n{\n    [Test]\n    public void Should_resolve_constructor_arguments_using_mapping_engine()\n    {\n        Mapper.CreateMap<SourceBar, DestinationBar>();\n\n        Mapper.CreateMap<SourceFoo, DestinationFoo>();\n\n        var sourceBar = new SourceBar(\"fooBar\");\n        var sourceFoo = new SourceFoo(sourceBar);\n\n        var destinationFoo = Mapper.Map<DestinationFoo>(sourceFoo);\n\n        destinationFoo.Bar.FooBar.ShouldEqual(sourceBar.FooBar);\n    }\n\n\n    public class DestinationFoo\n    {\n        public DestinationBar Bar { get; private set; }\n\n        public DestinationFoo(DestinationBar bar)\n        {\n            Bar = bar;\n        }\n    }\n\n    public class DestinationBar\n    {\n        public string FooBar { get; private set; }\n\n        public DestinationBar(string fooBar)\n        {\n            FooBar = fooBar;\n        }\n    }\n\n    public class SourceFoo\n    {\n        public SourceBar Bar { get; private set; }\n\n        public SourceFoo(SourceBar bar)\n        {\n            Bar = bar;\n        }\n    }\n\n    public class SourceBar\n    {\n        public string FooBar { get; private set; }\n\n        public SourceBar(string fooBar)\n        {\n            FooBar = fooBar;\n        }\n    }\n}\n```\n\nExecuting this test results in an Exception with the following stack trace:\n\n```\nAutoMapper.UnitTests.Bug.UsingMappingEngineToResolveConstructorArguments.Should_resolve_constructor_arguments_using_mapping_engine' failed:\n    AutoMapper.AutoMapperMappingException : Trying to map AutoMapper.UnitTests.Bug.UsingMappingEngineToResolveConstructorArguments+SourceFoo to AutoMapper.UnitTests.Bug.UsingMappingEngineToResolveConstructorArguments+DestinationFoo.\nUsing mapping configuration for AutoMapper.UnitTests.Bug.UsingMappingEngineToResolveConstructorArguments+SourceFoo to AutoMapper.UnitTests.Bug.UsingMappingEngineToResolveConstructorArguments+DestinationFoo\nException of type 'AutoMapper.AutoMapperMappingException' was thrown.\n  ----> System.InvalidCastException : Unable to cast object of type 'SourceBar' to type 'DestinationBar'.\n    MappingEngine.cs(312,0): at AutoMapper.MappingEngine.AutoMapper.IMappingEngineRunner.Map(ResolutionContext context)\n    MappingEngine.cs(98,0): at AutoMapper.MappingEngine.Map(Object source, Type sourceType, Type destinationType, Action`1 opts)\n    MappingEngine.cs(49,0): at AutoMapper.MappingEngine.Map[TDestination](Object source, Action`1 opts)\n    MappingEngine.cs(38,0): at AutoMapper.MappingEngine.Map[TDestination](Object source)\n    Mapper.cs(27,0): at AutoMapper.Mapper.Map[TDestination](Object source)\n    Bug\\UsingMappingEngineToResolveConstructorArguments.cs(20,0): at AutoMapper.UnitTests.Bug.UsingMappingEngineToResolveConstructorArguments.Should_resolve_constructor_arguments_using_mapping_engine()\n    --InvalidCastException\n    at lambda_method(Closure , Object[] )\n    ConstructorMap.cs(29,0): at AutoMapper.ConstructorMap.ResolveValue(ResolutionContext context)\n    MappingEngine.cs(354,0): at AutoMapper.MappingEngine.AutoMapper.IMappingEngineRunner.CreateObject(ResolutionContext context)\n    Mappers\\TypeMapObjectMapperRegistry.cs(167,0): at AutoMapper.Mappers.TypeMapObjectMapperRegistry.NewObjectPropertyMapMappingStrategy.GetMappedObject(ResolutionContext context, IMappingEngineRunner mapper)\n    Mappers\\TypeMapObjectMapperRegistry.cs(62,0): at AutoMapper.Mappers.TypeMapObjectMapperRegistry.PropertyMapMappingStrategy.Map(ResolutionContext context, IMappingEngineRunner mapper)\n    Mappers\\TypeMapMapper.cs(22,0): at AutoMapper.Mappers.TypeMapMapper.Map(ResolutionContext context, IMappingEngineRunner mapper)\n    MappingEngine.cs(308,0): at AutoMapper.MappingEngine.AutoMapper.IMappingEngineRunner.Map(ResolutionContext context)\n```\n","closed_by":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/144/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/144/timeline","performed_via_github_app":null,"state_reason":"completed"}