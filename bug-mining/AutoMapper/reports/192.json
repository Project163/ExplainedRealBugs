{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3519","repository_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3519/labels{/name}","comments_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3519/comments","events_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3519/events","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/issues/3519","id":723134045,"node_id":"MDU6SXNzdWU3MjMxMzQwNDU=","number":3519,"title":"InvalidProgramException with ProjectTo and nullable ints","user":{"login":"davidkarlsson","id":1732214,"node_id":"MDQ6VXNlcjE3MzIyMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/1732214?v=4","gravatar_id":"","url":"https://api.github.com/users/davidkarlsson","html_url":"https://github.com/davidkarlsson","followers_url":"https://api.github.com/users/davidkarlsson/followers","following_url":"https://api.github.com/users/davidkarlsson/following{/other_user}","gists_url":"https://api.github.com/users/davidkarlsson/gists{/gist_id}","starred_url":"https://api.github.com/users/davidkarlsson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidkarlsson/subscriptions","organizations_url":"https://api.github.com/users/davidkarlsson/orgs","repos_url":"https://api.github.com/users/davidkarlsson/repos","events_url":"https://api.github.com/users/davidkarlsson/events{/privacy}","received_events_url":"https://api.github.com/users/davidkarlsson/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":92629237,"node_id":"MDU6TGFiZWw5MjYyOTIzNw==","url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/labels/Bug","name":"Bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/milestones/40","html_url":"https://github.com/LuckyPennySoftware/AutoMapper/milestone/40","labels_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/milestones/40/labels","id":5999304,"node_id":"MDk6TWlsZXN0b25lNTk5OTMwNA==","number":40,"title":"10.1.1","description":null,"creator":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":3,"state":"closed","created_at":"2020-10-16T15:38:46Z","updated_at":"2020-10-17T04:42:42Z","due_on":null,"closed_at":"2020-10-17T04:42:42Z"},"comments":8,"created_at":"2020-10-16T11:22:44Z","updated_at":"2020-11-22T00:18:49Z","closed_at":"2020-10-16T15:33:54Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Source/destination types\r\n\r\n```csharp\r\npublic class SourceParentTest {\r\n    public SourceChildTest? Child { get; set; }\r\n}\r\n\r\npublic class SourceChildTest {\r\n   public int TestInt { get; set; }\r\n}\r\n\r\npublic class DestinationTest\r\n{\r\n    public int? TestNullableInt { get; set; }\r\n}\r\n```\r\n\r\n### Mapping configuration\r\n\r\n```csharp\r\nCreateMap<SourceParentTest, DestinationTest>()\r\n    .ForMember(\r\n        a => a.TestNullableInt,\r\n        opt => opt.MapFrom(b => b.Child!.TestInt)\r\n    );\r\n```\r\n\r\n### Version: x.y.z\r\nAutoMapper 10.1.0\r\nMicrosoft.EntityFrameworkCore.SqlServer 5.0.0-rc.2.*\r\n\r\n### Expected behavior\r\n\r\nWith AutoMapper 10.0.0 and using ProjectTo the mapping is successful with TestNullableInt being null when the Child navigation property is null and otherwise being set to the value of TestInt property from the child entity.\r\n\r\n### Actual behavior\r\n\r\nA \"InvalidProgramException: Common Language Runtime detected an invalid program.\" is thrown when calling ToListAsync() on the ProjectTo query like this:\r\n\r\n```csharp\r\nvar test = await _autoMapper.ProjectTo<DestTest>(sourceQuery).ToListAsync();\r\n```\r\n\r\nHere's the stack trace:\r\n```\r\nSystem.InvalidProgramException: Common Language Runtime detected an invalid program.\r\n   at System.Runtime.CompilerServices.RuntimeHelpers._CompileMethod(RuntimeMethodHandleInternal method)\r\n   at System.Reflection.Emit.DynamicMethod.CreateDelegate(Type delegateType, Object target)\r\n   at System.Linq.Expressions.Compiler.LambdaCompiler.CreateDelegate()\r\n   at System.Linq.Expressions.Compiler.LambdaCompiler.Compile(LambdaExpression lambda)\r\n   at System.Linq.Expressions.LambdaExpression.Compile()\r\n   at Microsoft.EntityFrameworkCore.Query.RelationalShapedQueryCompilingExpressionVisitor.VisitShapedQuery(ShapedQueryExpression shapedQueryExpression)\r\n   at Microsoft.EntityFrameworkCore.Query.ShapedQueryCompilingExpressionVisitor.VisitExtension(Expression extensionExpression)\r\n   at System.Linq.Expressions.Expression.Accept(ExpressionVisitor visitor)\r\n   at System.Linq.Expressions.ExpressionVisitor.Visit(Expression node)\r\n   at Microsoft.EntityFrameworkCore.Query.QueryCompilationContext.CreateQueryExecutor[TResult](Expression query)\r\n   at Microsoft.EntityFrameworkCore.Storage.Database.CompileQuery[TResult](Expression query, Boolean async)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.CompileQueryCore[TResult](IDatabase database, Expression query, IModel model, Boolean async)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.<>c__DisplayClass12_0`1.<ExecuteAsync>b__0()\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.CompiledQueryCache.GetOrAddQuery[TResult](Object cacheKey, Func`1 compiler)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.QueryCompiler.ExecuteAsync[TResult](Expression query, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryProvider.ExecuteAsync[TResult](Expression expression, CancellationToken cancellationToken)\r\n   at Microsoft.EntityFrameworkCore.Query.Internal.EntityQueryable`1.GetAsyncEnumerator(CancellationToken cancellationToken)\r\n   at System.Runtime.CompilerServices.ConfiguredCancelableAsyncEnumerable`1.GetAsyncEnumerator()\r\n   at Microsoft.EntityFrameworkCore.EntityFrameworkQueryableExtensions.ToListAsync[TSource](IQueryable`1 source, CancellationToken cancellationToken)\r\n   at Test.Web.Areas.Admin.Controllers.TestController.Index(TestIndex model) in F:\\DotNet\\Test\\Test.Web\\Areas\\Admin\\Controllers\\TestController.cs:line 70\r\n\r\n```\r\n","closed_by":{"login":"jbogard","id":104498,"node_id":"MDQ6VXNlcjEwNDQ5OA==","avatar_url":"https://avatars.githubusercontent.com/u/104498?v=4","gravatar_id":"","url":"https://api.github.com/users/jbogard","html_url":"https://github.com/jbogard","followers_url":"https://api.github.com/users/jbogard/followers","following_url":"https://api.github.com/users/jbogard/following{/other_user}","gists_url":"https://api.github.com/users/jbogard/gists{/gist_id}","starred_url":"https://api.github.com/users/jbogard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbogard/subscriptions","organizations_url":"https://api.github.com/users/jbogard/orgs","repos_url":"https://api.github.com/users/jbogard/repos","events_url":"https://api.github.com/users/jbogard/events{/privacy}","received_events_url":"https://api.github.com/users/jbogard/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3519/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/LuckyPennySoftware/AutoMapper/issues/3519/timeline","performed_via_github_app":null,"state_reason":"completed"}