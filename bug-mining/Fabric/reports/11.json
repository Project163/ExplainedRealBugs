{"url":"https://api.github.com/repos/fabric/fabric/issues/1981","repository_url":"https://api.github.com/repos/fabric/fabric","labels_url":"https://api.github.com/repos/fabric/fabric/issues/1981/labels{/name}","comments_url":"https://api.github.com/repos/fabric/fabric/issues/1981/comments","events_url":"https://api.github.com/repos/fabric/fabric/issues/1981/events","html_url":"https://github.com/fabric/fabric/issues/1981","id":451568773,"node_id":"MDU6SXNzdWU0NTE1Njg3NzM=","number":1981,"title":"Socket is closed raised on Connection.put() after Connection.close() Connection.open() called","user":{"login":"AlexanderBodnya","id":24426983,"node_id":"MDQ6VXNlcjI0NDI2OTgz","avatar_url":"https://avatars.githubusercontent.com/u/24426983?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexanderBodnya","html_url":"https://github.com/AlexanderBodnya","followers_url":"https://api.github.com/users/AlexanderBodnya/followers","following_url":"https://api.github.com/users/AlexanderBodnya/following{/other_user}","gists_url":"https://api.github.com/users/AlexanderBodnya/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexanderBodnya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexanderBodnya/subscriptions","organizations_url":"https://api.github.com/users/AlexanderBodnya/orgs","repos_url":"https://api.github.com/users/AlexanderBodnya/repos","events_url":"https://api.github.com/users/AlexanderBodnya/events{/privacy}","received_events_url":"https://api.github.com/users/AlexanderBodnya/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2019-06-03T16:09:39Z","updated_at":"2023-01-17T21:40:49Z","closed_at":"2023-01-17T21:40:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Might be related to `Connection.sftp()`:\r\n\r\n> If called more than one time, memorizes the first result;\r\n\r\nCode to reproduce\r\n```\r\nimport fabric\r\n\r\n\r\nconn = fabric.Connection(host=\"{}@{}\".format('root', ''), connect_kwargs={\"password\": ''})\r\nconn.put('./1.txt')\r\nconn.close()\r\nconn.open()\r\nconn.put('./1.txt')\r\n\r\n```\r\n\r\nTraceback:\r\n\r\n```\r\n---------------------------------------------------------------------------\r\nOSError                                   Traceback (most recent call last)\r\n<ipython-input-6-64e29c4aa4e9> in <module>\r\n----> 1 conn.put('./1.txt')\r\n\r\n~/venv36/lib/python3.6/site-packages/fabric/connection.py in put(self, *args, **kwargs)\r\n    765         .. versionadded:: 2.0\r\n    766         \"\"\"\r\n--> 767         return Transfer(self).put(*args, **kwargs)\r\n    768\r\n    769     # TODO: yield the socket for advanced users? Other advanced use cases\r\n\r\n~/venv36/lib/python3.6/site-packages/fabric/transfer.py in put(self, local, remote, preserve_mode)\r\n    231         prejoined_remote = remote\r\n    232         remote = posixpath.join(\r\n--> 233             self.sftp.getcwd() or self.sftp.normalize(\".\"), remote\r\n    234         )\r\n    235         if remote != prejoined_remote:\r\n\r\n~/venv36/lib/python3.6/site-packages/paramiko/sftp_client.py in normalize(self, path)\r\n    630         path = self._adjust_cwd(path)\r\n    631         self._log(DEBUG, \"normalize({!r})\".format(path))\r\n--> 632         t, msg = self._request(CMD_REALPATH, path)\r\n    633         if t != CMD_NAME:\r\n    634             raise SFTPError(\"Expected name response\")\r\n\r\n~/venv36/lib/python3.6/site-packages/paramiko/sftp_client.py in _request(self, t, *arg)\r\n    810\r\n    811     def _request(self, t, *arg):\r\n--> 812         num = self._async_request(type(None), t, *arg)\r\n    813         return self._read_response(num)\r\n    814\r\n\r\n~/venv36/lib/python3.6/site-packages/paramiko/sftp_client.py in _async_request(self, fileobj, t, *arg)\r\n    835         finally:\r\n    836             self._lock.release()\r\n--> 837         self._send_packet(t, msg)\r\n    838         return num\r\n    839\r\n\r\n~/venv36/lib/python3.6/site-packages/paramiko/sftp.py in _send_packet(self, t, packet)\r\n    196         if self.ultra_debug:\r\n    197             self._log(DEBUG, util.format_binary(out, \"OUT: \"))\r\n--> 198         self._write_all(out)\r\n    199\r\n    200     def _read_packet(self):\r\n\r\n~/venv36/lib/python3.6/site-packages/paramiko/sftp.py in _write_all(self, out)\r\n    160     def _write_all(self, out):\r\n    161         while len(out) > 0:\r\n--> 162             n = self.sock.send(out)\r\n    163             if n <= 0:\r\n    164                 raise EOFError()\r\n\r\n~/venv36/lib/python3.6/site-packages/paramiko/channel.py in send(self, s)\r\n    799         m.add_byte(cMSG_CHANNEL_DATA)\r\n    800         m.add_int(self.remote_chanid)\r\n--> 801         return self._send(s, m)\r\n    802\r\n    803     def send_stderr(self, s):\r\n\r\n~/venv36/lib/python3.6/site-packages/paramiko/channel.py in _send(self, s, m)\r\n   1178                 # this doesn't seem useful, but it is the documented behavior\r\n   1179                 # of Socket\r\n-> 1180                 raise socket.error(\"Socket is closed\")\r\n   1181             size = self._wait_for_send_window(size)\r\n   1182             if size == 0:\r\n\r\nOSError: Socket is closed\r\n```","closed_by":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/1981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fabric/fabric/issues/1981/timeline","performed_via_github_app":null,"state_reason":"completed"}