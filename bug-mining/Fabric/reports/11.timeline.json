[{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/498335207","html_url":"https://github.com/fabric/fabric/issues/1981#issuecomment-498335207","issue_url":"https://api.github.com/repos/fabric/fabric/issues/1981","id":498335207,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODMzNTIwNw==","user":{"login":"AlexanderBodnya","id":24426983,"node_id":"MDQ6VXNlcjI0NDI2OTgz","avatar_url":"https://avatars.githubusercontent.com/u/24426983?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexanderBodnya","html_url":"https://github.com/AlexanderBodnya","followers_url":"https://api.github.com/users/AlexanderBodnya/followers","following_url":"https://api.github.com/users/AlexanderBodnya/following{/other_user}","gists_url":"https://api.github.com/users/AlexanderBodnya/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexanderBodnya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexanderBodnya/subscriptions","organizations_url":"https://api.github.com/users/AlexanderBodnya/orgs","repos_url":"https://api.github.com/users/AlexanderBodnya/repos","events_url":"https://api.github.com/users/AlexanderBodnya/events{/privacy}","received_events_url":"https://api.github.com/users/AlexanderBodnya/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-03T16:44:28Z","updated_at":"2019-06-03T16:47:52Z","body":"Definitely is related to the `Connection.sftp()`\r\n\r\nadding following code fixes the issue:\r\n\r\n```\r\nimport fabric\r\n\r\n\r\nconn = fabric.Connection(host=\"{}@{}\".format('root', ''), connect_kwargs={\"password\": ''})\r\nconn.put('./1.txt')\r\nconn.close()\r\nconn._sftp = None\r\nconn.open()\r\nconn.put('./1.txt')\r\n```\r\n\r\nI understand the reason in current implementation, but I think it should have at least an explicit method for sftp client connection closing.\r\n\r\nEDIT: Or `Connection.close() `should do `_sftp = None`","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/498335207/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"AlexanderBodnya","id":24426983,"node_id":"MDQ6VXNlcjI0NDI2OTgz","avatar_url":"https://avatars.githubusercontent.com/u/24426983?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexanderBodnya","html_url":"https://github.com/AlexanderBodnya","followers_url":"https://api.github.com/users/AlexanderBodnya/followers","following_url":"https://api.github.com/users/AlexanderBodnya/following{/other_user}","gists_url":"https://api.github.com/users/AlexanderBodnya/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexanderBodnya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexanderBodnya/subscriptions","organizations_url":"https://api.github.com/users/AlexanderBodnya/orgs","repos_url":"https://api.github.com/users/AlexanderBodnya/repos","events_url":"https://api.github.com/users/AlexanderBodnya/events{/privacy}","received_events_url":"https://api.github.com/users/AlexanderBodnya/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/971652927","html_url":"https://github.com/fabric/fabric/issues/1981#issuecomment-971652927","issue_url":"https://api.github.com/repos/fabric/fabric/issues/1981","id":971652927,"node_id":"IC_kwDOAALlkM456j8_","user":{"login":"GMaxera","id":3726196,"node_id":"MDQ6VXNlcjM3MjYxOTY=","avatar_url":"https://avatars.githubusercontent.com/u/3726196?v=4","gravatar_id":"","url":"https://api.github.com/users/GMaxera","html_url":"https://github.com/GMaxera","followers_url":"https://api.github.com/users/GMaxera/followers","following_url":"https://api.github.com/users/GMaxera/following{/other_user}","gists_url":"https://api.github.com/users/GMaxera/gists{/gist_id}","starred_url":"https://api.github.com/users/GMaxera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GMaxera/subscriptions","organizations_url":"https://api.github.com/users/GMaxera/orgs","repos_url":"https://api.github.com/users/GMaxera/repos","events_url":"https://api.github.com/users/GMaxera/events{/privacy}","received_events_url":"https://api.github.com/users/GMaxera/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-17T14:48:16Z","updated_at":"2021-11-17T14:48:16Z","body":"I'm being hit by this bug.\r\nIs there any chance that will be fixed soon?\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/971652927/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GMaxera","id":3726196,"node_id":"MDQ6VXNlcjM3MjYxOTY=","avatar_url":"https://avatars.githubusercontent.com/u/3726196?v=4","gravatar_id":"","url":"https://api.github.com/users/GMaxera","html_url":"https://github.com/GMaxera","followers_url":"https://api.github.com/users/GMaxera/followers","following_url":"https://api.github.com/users/GMaxera/following{/other_user}","gists_url":"https://api.github.com/users/GMaxera/gists{/gist_id}","starred_url":"https://api.github.com/users/GMaxera/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GMaxera/subscriptions","organizations_url":"https://api.github.com/users/GMaxera/orgs","repos_url":"https://api.github.com/users/GMaxera/repos","events_url":"https://api.github.com/users/GMaxera/events{/privacy}","received_events_url":"https://api.github.com/users/GMaxera/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"graingert","id":413772,"node_id":"MDQ6VXNlcjQxMzc3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/413772?v=4","gravatar_id":"","url":"https://api.github.com/users/graingert","html_url":"https://github.com/graingert","followers_url":"https://api.github.com/users/graingert/followers","following_url":"https://api.github.com/users/graingert/following{/other_user}","gists_url":"https://api.github.com/users/graingert/gists{/gist_id}","starred_url":"https://api.github.com/users/graingert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/graingert/subscriptions","organizations_url":"https://api.github.com/users/graingert/orgs","repos_url":"https://api.github.com/users/graingert/repos","events_url":"https://api.github.com/users/graingert/events{/privacy}","received_events_url":"https://api.github.com/users/graingert/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-11-17T16:26:33Z","updated_at":"2021-11-17T16:26:33Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/fabric/fabric/issues/1931","repository_url":"https://api.github.com/repos/fabric/fabric","labels_url":"https://api.github.com/repos/fabric/fabric/issues/1931/labels{/name}","comments_url":"https://api.github.com/repos/fabric/fabric/issues/1931/comments","events_url":"https://api.github.com/repos/fabric/fabric/issues/1931/events","html_url":"https://github.com/fabric/fabric/pull/1931","id":400026015,"node_id":"MDExOlB1bGxSZXF1ZXN0MjQ1MzEzNjM1","number":1931,"title":"Fixed \"Socket is closed\" error when transferring files with new connection","user":{"login":"thomasantony","id":1804570,"node_id":"MDQ6VXNlcjE4MDQ1NzA=","avatar_url":"https://avatars.githubusercontent.com/u/1804570?v=4","gravatar_id":"","url":"https://api.github.com/users/thomasantony","html_url":"https://github.com/thomasantony","followers_url":"https://api.github.com/users/thomasantony/followers","following_url":"https://api.github.com/users/thomasantony/following{/other_user}","gists_url":"https://api.github.com/users/thomasantony/gists{/gist_id}","starred_url":"https://api.github.com/users/thomasantony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thomasantony/subscriptions","organizations_url":"https://api.github.com/users/thomasantony/orgs","repos_url":"https://api.github.com/users/thomasantony/repos","events_url":"https://api.github.com/users/thomasantony/events{/privacy}","received_events_url":"https://api.github.com/users/thomasantony/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-01-16T22:26:46Z","updated_at":"2023-08-31T01:11:33Z","closed_at":null,"author_association":"NONE","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":189840,"node_id":"MDEwOlJlcG9zaXRvcnkxODk4NDA=","name":"fabric","full_name":"fabric/fabric","private":false,"owner":{"login":"fabric","id":400481,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwMDQ4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/400481?v=4","gravatar_id":"","url":"https://api.github.com/users/fabric","html_url":"https://github.com/fabric","followers_url":"https://api.github.com/users/fabric/followers","following_url":"https://api.github.com/users/fabric/following{/other_user}","gists_url":"https://api.github.com/users/fabric/gists{/gist_id}","starred_url":"https://api.github.com/users/fabric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fabric/subscriptions","organizations_url":"https://api.github.com/users/fabric/orgs","repos_url":"https://api.github.com/users/fabric/repos","events_url":"https://api.github.com/users/fabric/events{/privacy}","received_events_url":"https://api.github.com/users/fabric/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/fabric/fabric","description":"Simple, Pythonic remote execution and deployment.","fork":false,"url":"https://api.github.com/repos/fabric/fabric","forks_url":"https://api.github.com/repos/fabric/fabric/forks","keys_url":"https://api.github.com/repos/fabric/fabric/keys{/key_id}","collaborators_url":"https://api.github.com/repos/fabric/fabric/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/fabric/fabric/teams","hooks_url":"https://api.github.com/repos/fabric/fabric/hooks","issue_events_url":"https://api.github.com/repos/fabric/fabric/issues/events{/number}","events_url":"https://api.github.com/repos/fabric/fabric/events","assignees_url":"https://api.github.com/repos/fabric/fabric/assignees{/user}","branches_url":"https://api.github.com/repos/fabric/fabric/branches{/branch}","tags_url":"https://api.github.com/repos/fabric/fabric/tags","blobs_url":"https://api.github.com/repos/fabric/fabric/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/fabric/fabric/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/fabric/fabric/git/refs{/sha}","trees_url":"https://api.github.com/repos/fabric/fabric/git/trees{/sha}","statuses_url":"https://api.github.com/repos/fabric/fabric/statuses/{sha}","languages_url":"https://api.github.com/repos/fabric/fabric/languages","stargazers_url":"https://api.github.com/repos/fabric/fabric/stargazers","contributors_url":"https://api.github.com/repos/fabric/fabric/contributors","subscribers_url":"https://api.github.com/repos/fabric/fabric/subscribers","subscription_url":"https://api.github.com/repos/fabric/fabric/subscription","commits_url":"https://api.github.com/repos/fabric/fabric/commits{/sha}","git_commits_url":"https://api.github.com/repos/fabric/fabric/git/commits{/sha}","comments_url":"https://api.github.com/repos/fabric/fabric/comments{/number}","issue_comment_url":"https://api.github.com/repos/fabric/fabric/issues/comments{/number}","contents_url":"https://api.github.com/repos/fabric/fabric/contents/{+path}","compare_url":"https://api.github.com/repos/fabric/fabric/compare/{base}...{head}","merges_url":"https://api.github.com/repos/fabric/fabric/merges","archive_url":"https://api.github.com/repos/fabric/fabric/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/fabric/fabric/downloads","issues_url":"https://api.github.com/repos/fabric/fabric/issues{/number}","pulls_url":"https://api.github.com/repos/fabric/fabric/pulls{/number}","milestones_url":"https://api.github.com/repos/fabric/fabric/milestones{/number}","notifications_url":"https://api.github.com/repos/fabric/fabric/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/fabric/fabric/labels{/name}","releases_url":"https://api.github.com/repos/fabric/fabric/releases{/id}","deployments_url":"https://api.github.com/repos/fabric/fabric/deployments","created_at":"2009-05-01T01:14:24Z","updated_at":"2025-11-10T03:41:27Z","pushed_at":"2025-07-20T17:33:07Z","git_url":"git://github.com/fabric/fabric.git","ssh_url":"git@github.com:fabric/fabric.git","clone_url":"https://github.com/fabric/fabric.git","svn_url":"https://github.com/fabric/fabric","homepage":"http://fabfile.org","size":19288,"stargazers_count":15296,"watchers_count":15296,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":1959,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":492,"license":{"key":"bsd-2-clause","name":"BSD 2-Clause \"Simplified\" License","spdx_id":"BSD-2-Clause","url":"https://api.github.com/licenses/bsd-2-clause","node_id":"MDc6TGljZW5zZTQ="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":1959,"open_issues":492,"watchers":15296,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/fabric/fabric/pulls/1931","html_url":"https://github.com/fabric/fabric/pull/1931","diff_url":"https://github.com/fabric/fabric/pull/1931.diff","patch_url":"https://github.com/fabric/fabric/pull/1931.patch","merged_at":null},"body":"`_sftp` being a class variable does not get reset if I create a new Connection after closing an existing connection. The memoisation causes the old `_sftp` to be used which results in an error when transferring files on the new connection. \r\n\r\nThis change ensures that the variable is cleared when the connection is closed.","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/1931/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fabric/fabric/issues/1931/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/1035267659","html_url":"https://github.com/fabric/fabric/issues/1981#issuecomment-1035267659","issue_url":"https://api.github.com/repos/fabric/fabric/issues/1981","id":1035267659,"node_id":"IC_kwDOAALlkM49tO5L","user":{"login":"andrew-lee-1089","id":23656001,"node_id":"MDQ6VXNlcjIzNjU2MDAx","avatar_url":"https://avatars.githubusercontent.com/u/23656001?v=4","gravatar_id":"","url":"https://api.github.com/users/andrew-lee-1089","html_url":"https://github.com/andrew-lee-1089","followers_url":"https://api.github.com/users/andrew-lee-1089/followers","following_url":"https://api.github.com/users/andrew-lee-1089/following{/other_user}","gists_url":"https://api.github.com/users/andrew-lee-1089/gists{/gist_id}","starred_url":"https://api.github.com/users/andrew-lee-1089/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrew-lee-1089/subscriptions","organizations_url":"https://api.github.com/users/andrew-lee-1089/orgs","repos_url":"https://api.github.com/users/andrew-lee-1089/repos","events_url":"https://api.github.com/users/andrew-lee-1089/events{/privacy}","received_events_url":"https://api.github.com/users/andrew-lee-1089/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-10T18:14:33Z","updated_at":"2022-02-10T18:14:33Z","body":"I'm hitting this too - on a box with OpenSSHD V8.8. ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/1035267659/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"andrew-lee-1089","id":23656001,"node_id":"MDQ6VXNlcjIzNjU2MDAx","avatar_url":"https://avatars.githubusercontent.com/u/23656001?v=4","gravatar_id":"","url":"https://api.github.com/users/andrew-lee-1089","html_url":"https://github.com/andrew-lee-1089","followers_url":"https://api.github.com/users/andrew-lee-1089/followers","following_url":"https://api.github.com/users/andrew-lee-1089/following{/other_user}","gists_url":"https://api.github.com/users/andrew-lee-1089/gists{/gist_id}","starred_url":"https://api.github.com/users/andrew-lee-1089/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrew-lee-1089/subscriptions","organizations_url":"https://api.github.com/users/andrew-lee-1089/orgs","repos_url":"https://api.github.com/users/andrew-lee-1089/repos","events_url":"https://api.github.com/users/andrew-lee-1089/events{/privacy}","received_events_url":"https://api.github.com/users/andrew-lee-1089/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6078651520,"node_id":"REFE_lADOAALlkM4a6mSFzwAAAAFqUNyA","url":"https://api.github.com/repos/fabric/fabric/issues/events/6078651520","actor":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"eaa7ef8f4c67225ebefc665142d22fde7041f411","commit_url":"https://api.github.com/repos/davidjmemmett/fabric/commits/eaa7ef8f4c67225ebefc665142d22fde7041f411","created_at":"2022-02-15T22:28:21Z","performed_via_github_app":null},{"actor":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-15T22:30:26Z","updated_at":"2022-02-15T22:30:26Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/fabric/fabric/issues/2194","repository_url":"https://api.github.com/repos/fabric/fabric","labels_url":"https://api.github.com/repos/fabric/fabric/issues/2194/labels{/name}","comments_url":"https://api.github.com/repos/fabric/fabric/issues/2194/comments","events_url":"https://api.github.com/repos/fabric/fabric/issues/2194/events","html_url":"https://github.com/fabric/fabric/pull/2194","id":1139280805,"node_id":"PR_kwDOAALlkM4y41B7","number":2194,"title":"Close SFTP session when Connection is closed","user":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-02-15T22:30:26Z","updated_at":"2022-02-15T22:32:38Z","closed_at":"2022-02-15T22:32:31Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":189840,"node_id":"MDEwOlJlcG9zaXRvcnkxODk4NDA=","name":"fabric","full_name":"fabric/fabric","private":false,"owner":{"login":"fabric","id":400481,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwMDQ4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/400481?v=4","gravatar_id":"","url":"https://api.github.com/users/fabric","html_url":"https://github.com/fabric","followers_url":"https://api.github.com/users/fabric/followers","following_url":"https://api.github.com/users/fabric/following{/other_user}","gists_url":"https://api.github.com/users/fabric/gists{/gist_id}","starred_url":"https://api.github.com/users/fabric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fabric/subscriptions","organizations_url":"https://api.github.com/users/fabric/orgs","repos_url":"https://api.github.com/users/fabric/repos","events_url":"https://api.github.com/users/fabric/events{/privacy}","received_events_url":"https://api.github.com/users/fabric/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/fabric/fabric","description":"Simple, Pythonic remote execution and deployment.","fork":false,"url":"https://api.github.com/repos/fabric/fabric","forks_url":"https://api.github.com/repos/fabric/fabric/forks","keys_url":"https://api.github.com/repos/fabric/fabric/keys{/key_id}","collaborators_url":"https://api.github.com/repos/fabric/fabric/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/fabric/fabric/teams","hooks_url":"https://api.github.com/repos/fabric/fabric/hooks","issue_events_url":"https://api.github.com/repos/fabric/fabric/issues/events{/number}","events_url":"https://api.github.com/repos/fabric/fabric/events","assignees_url":"https://api.github.com/repos/fabric/fabric/assignees{/user}","branches_url":"https://api.github.com/repos/fabric/fabric/branches{/branch}","tags_url":"https://api.github.com/repos/fabric/fabric/tags","blobs_url":"https://api.github.com/repos/fabric/fabric/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/fabric/fabric/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/fabric/fabric/git/refs{/sha}","trees_url":"https://api.github.com/repos/fabric/fabric/git/trees{/sha}","statuses_url":"https://api.github.com/repos/fabric/fabric/statuses/{sha}","languages_url":"https://api.github.com/repos/fabric/fabric/languages","stargazers_url":"https://api.github.com/repos/fabric/fabric/stargazers","contributors_url":"https://api.github.com/repos/fabric/fabric/contributors","subscribers_url":"https://api.github.com/repos/fabric/fabric/subscribers","subscription_url":"https://api.github.com/repos/fabric/fabric/subscription","commits_url":"https://api.github.com/repos/fabric/fabric/commits{/sha}","git_commits_url":"https://api.github.com/repos/fabric/fabric/git/commits{/sha}","comments_url":"https://api.github.com/repos/fabric/fabric/comments{/number}","issue_comment_url":"https://api.github.com/repos/fabric/fabric/issues/comments{/number}","contents_url":"https://api.github.com/repos/fabric/fabric/contents/{+path}","compare_url":"https://api.github.com/repos/fabric/fabric/compare/{base}...{head}","merges_url":"https://api.github.com/repos/fabric/fabric/merges","archive_url":"https://api.github.com/repos/fabric/fabric/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/fabric/fabric/downloads","issues_url":"https://api.github.com/repos/fabric/fabric/issues{/number}","pulls_url":"https://api.github.com/repos/fabric/fabric/pulls{/number}","milestones_url":"https://api.github.com/repos/fabric/fabric/milestones{/number}","notifications_url":"https://api.github.com/repos/fabric/fabric/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/fabric/fabric/labels{/name}","releases_url":"https://api.github.com/repos/fabric/fabric/releases{/id}","deployments_url":"https://api.github.com/repos/fabric/fabric/deployments","created_at":"2009-05-01T01:14:24Z","updated_at":"2025-11-10T03:41:27Z","pushed_at":"2025-07-20T17:33:07Z","git_url":"git://github.com/fabric/fabric.git","ssh_url":"git@github.com:fabric/fabric.git","clone_url":"https://github.com/fabric/fabric.git","svn_url":"https://github.com/fabric/fabric","homepage":"http://fabfile.org","size":19288,"stargazers_count":15296,"watchers_count":15296,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":1959,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":492,"license":{"key":"bsd-2-clause","name":"BSD 2-Clause \"Simplified\" License","spdx_id":"BSD-2-Clause","url":"https://api.github.com/licenses/bsd-2-clause","node_id":"MDc6TGljZW5zZTQ="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":1959,"open_issues":492,"watchers":15296,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/fabric/fabric/pulls/2194","html_url":"https://github.com/fabric/fabric/pull/2194","diff_url":"https://github.com/fabric/fabric/pull/2194.diff","patch_url":"https://github.com/fabric/fabric/pull/2194.patch","merged_at":null},"body":"If an SFTP session has been opened, ensure it is called and set to `None` when the Connection has been closed.\r\n\r\nFixes #1981 ","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/2194/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fabric/fabric/issues/2194/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":6078665613,"node_id":"REFE_lADOAALlkM4a6mSFzwAAAAFqURON","url":"https://api.github.com/repos/fabric/fabric/issues/events/6078665613","actor":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a56cb506fe37a41d93e2f0ac1af04b7cf0b5b7b4","commit_url":"https://api.github.com/repos/davidjmemmett/fabric/commits/a56cb506fe37a41d93e2f0ac1af04b7cf0b5b7b4","created_at":"2022-02-15T22:31:29Z","performed_via_github_app":null},{"id":6078679290,"node_id":"REFE_lADOAALlkM4a6mSFzwAAAAFqUUj6","url":"https://api.github.com/repos/fabric/fabric/issues/events/6078679290","actor":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b677c1f7a7742e3e2aeb6c4110155ded1faa96d4","commit_url":"https://api.github.com/repos/davidjmemmett/fabric/commits/b677c1f7a7742e3e2aeb6c4110155ded1faa96d4","created_at":"2022-02-15T22:34:37Z","performed_via_github_app":null},{"actor":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-15T22:34:58Z","updated_at":"2022-02-15T22:34:58Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/fabric/fabric/issues/2195","repository_url":"https://api.github.com/repos/fabric/fabric","labels_url":"https://api.github.com/repos/fabric/fabric/issues/2195/labels{/name}","comments_url":"https://api.github.com/repos/fabric/fabric/issues/2195/comments","events_url":"https://api.github.com/repos/fabric/fabric/issues/2195/events","html_url":"https://github.com/fabric/fabric/pull/2195","id":1139284094,"node_id":"PR_kwDOAALlkM4y41uU","number":2195,"title":"Close SFTP session when Connection is closed","user":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2022-02-15T22:34:57Z","updated_at":"2023-01-17T21:40:23Z","closed_at":"2023-01-17T21:40:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":189840,"node_id":"MDEwOlJlcG9zaXRvcnkxODk4NDA=","name":"fabric","full_name":"fabric/fabric","private":false,"owner":{"login":"fabric","id":400481,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwMDQ4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/400481?v=4","gravatar_id":"","url":"https://api.github.com/users/fabric","html_url":"https://github.com/fabric","followers_url":"https://api.github.com/users/fabric/followers","following_url":"https://api.github.com/users/fabric/following{/other_user}","gists_url":"https://api.github.com/users/fabric/gists{/gist_id}","starred_url":"https://api.github.com/users/fabric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fabric/subscriptions","organizations_url":"https://api.github.com/users/fabric/orgs","repos_url":"https://api.github.com/users/fabric/repos","events_url":"https://api.github.com/users/fabric/events{/privacy}","received_events_url":"https://api.github.com/users/fabric/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/fabric/fabric","description":"Simple, Pythonic remote execution and deployment.","fork":false,"url":"https://api.github.com/repos/fabric/fabric","forks_url":"https://api.github.com/repos/fabric/fabric/forks","keys_url":"https://api.github.com/repos/fabric/fabric/keys{/key_id}","collaborators_url":"https://api.github.com/repos/fabric/fabric/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/fabric/fabric/teams","hooks_url":"https://api.github.com/repos/fabric/fabric/hooks","issue_events_url":"https://api.github.com/repos/fabric/fabric/issues/events{/number}","events_url":"https://api.github.com/repos/fabric/fabric/events","assignees_url":"https://api.github.com/repos/fabric/fabric/assignees{/user}","branches_url":"https://api.github.com/repos/fabric/fabric/branches{/branch}","tags_url":"https://api.github.com/repos/fabric/fabric/tags","blobs_url":"https://api.github.com/repos/fabric/fabric/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/fabric/fabric/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/fabric/fabric/git/refs{/sha}","trees_url":"https://api.github.com/repos/fabric/fabric/git/trees{/sha}","statuses_url":"https://api.github.com/repos/fabric/fabric/statuses/{sha}","languages_url":"https://api.github.com/repos/fabric/fabric/languages","stargazers_url":"https://api.github.com/repos/fabric/fabric/stargazers","contributors_url":"https://api.github.com/repos/fabric/fabric/contributors","subscribers_url":"https://api.github.com/repos/fabric/fabric/subscribers","subscription_url":"https://api.github.com/repos/fabric/fabric/subscription","commits_url":"https://api.github.com/repos/fabric/fabric/commits{/sha}","git_commits_url":"https://api.github.com/repos/fabric/fabric/git/commits{/sha}","comments_url":"https://api.github.com/repos/fabric/fabric/comments{/number}","issue_comment_url":"https://api.github.com/repos/fabric/fabric/issues/comments{/number}","contents_url":"https://api.github.com/repos/fabric/fabric/contents/{+path}","compare_url":"https://api.github.com/repos/fabric/fabric/compare/{base}...{head}","merges_url":"https://api.github.com/repos/fabric/fabric/merges","archive_url":"https://api.github.com/repos/fabric/fabric/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/fabric/fabric/downloads","issues_url":"https://api.github.com/repos/fabric/fabric/issues{/number}","pulls_url":"https://api.github.com/repos/fabric/fabric/pulls{/number}","milestones_url":"https://api.github.com/repos/fabric/fabric/milestones{/number}","notifications_url":"https://api.github.com/repos/fabric/fabric/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/fabric/fabric/labels{/name}","releases_url":"https://api.github.com/repos/fabric/fabric/releases{/id}","deployments_url":"https://api.github.com/repos/fabric/fabric/deployments","created_at":"2009-05-01T01:14:24Z","updated_at":"2025-11-10T03:41:27Z","pushed_at":"2025-07-20T17:33:07Z","git_url":"git://github.com/fabric/fabric.git","ssh_url":"git@github.com:fabric/fabric.git","clone_url":"https://github.com/fabric/fabric.git","svn_url":"https://github.com/fabric/fabric","homepage":"http://fabfile.org","size":19288,"stargazers_count":15296,"watchers_count":15296,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":1959,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":492,"license":{"key":"bsd-2-clause","name":"BSD 2-Clause \"Simplified\" License","spdx_id":"BSD-2-Clause","url":"https://api.github.com/licenses/bsd-2-clause","node_id":"MDc6TGljZW5zZTQ="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":1959,"open_issues":492,"watchers":15296,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/fabric/fabric/pulls/2195","html_url":"https://github.com/fabric/fabric/pull/2195","diff_url":"https://github.com/fabric/fabric/pull/2195.diff","patch_url":"https://github.com/fabric/fabric/pull/2195.patch","merged_at":null},"body":"If an SFTP session has been opened, ensure it is called and set to None when the Connection has been closed.\r\n\r\nFixes #1981","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/2195/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fabric/fabric/issues/2195/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/1066179329","html_url":"https://github.com/fabric/fabric/issues/1981#issuecomment-1066179329","issue_url":"https://api.github.com/repos/fabric/fabric/issues/1981","id":1066179329,"node_id":"IC_kwDOAALlkM4_jJsB","user":{"login":"albundy83","id":1215213,"node_id":"MDQ6VXNlcjEyMTUyMTM=","avatar_url":"https://avatars.githubusercontent.com/u/1215213?v=4","gravatar_id":"","url":"https://api.github.com/users/albundy83","html_url":"https://github.com/albundy83","followers_url":"https://api.github.com/users/albundy83/followers","following_url":"https://api.github.com/users/albundy83/following{/other_user}","gists_url":"https://api.github.com/users/albundy83/gists{/gist_id}","starred_url":"https://api.github.com/users/albundy83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albundy83/subscriptions","organizations_url":"https://api.github.com/users/albundy83/orgs","repos_url":"https://api.github.com/users/albundy83/repos","events_url":"https://api.github.com/users/albundy83/events{/privacy}","received_events_url":"https://api.github.com/users/albundy83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-13T20:47:35Z","updated_at":"2022-03-13T20:47:35Z","body":"Hello,\r\n\r\nany chance to have the fix merge ?\r\nHere my way when using groups:\r\n```python\r\nwith ThreadingGroup.from_connections(cclfabric_list) as g:\r\n    try:\r\n        # This one to fix\r\n        # https://github.com/fabric/fabric/issues/1981\r\n        for conn in g:\r\n            conn._sftp = None\r\n            conn.open()\r\n        results = g.put(file_to_send, file_to_send)\r\n        for r in results:\r\n            print(f'Succeeded {r.host}: send file')\r\n        g.close()\r\n        os.remove(file_to_send)\r\n        return True\r\n    except GroupException as e:\r\n        results = e.result\r\n        # Print results\r\n        for rf in results.failed:\r\n            conn = results.failed[rf]\r\n            print(f'Some failed {rf.host}: {conn}')\r\n        for rs in results.succeeded:\r\n            print(f'Some succeeded {rs.host}: send file')\r\n        g.close()\r\n        os.remove(file_to_send)\r\n        return False\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/1066179329/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"albundy83","id":1215213,"node_id":"MDQ6VXNlcjEyMTUyMTM=","avatar_url":"https://avatars.githubusercontent.com/u/1215213?v=4","gravatar_id":"","url":"https://api.github.com/users/albundy83","html_url":"https://github.com/albundy83","followers_url":"https://api.github.com/users/albundy83/followers","following_url":"https://api.github.com/users/albundy83/following{/other_user}","gists_url":"https://api.github.com/users/albundy83/gists{/gist_id}","starred_url":"https://api.github.com/users/albundy83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/albundy83/subscriptions","organizations_url":"https://api.github.com/users/albundy83/orgs","repos_url":"https://api.github.com/users/albundy83/repos","events_url":"https://api.github.com/users/albundy83/events{/privacy}","received_events_url":"https://api.github.com/users/albundy83/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/1066569237","html_url":"https://github.com/fabric/fabric/issues/1981#issuecomment-1066569237","issue_url":"https://api.github.com/repos/fabric/fabric/issues/1981","id":1066569237,"node_id":"IC_kwDOAALlkM4_ko4V","user":{"login":"andrew-lee-1089","id":23656001,"node_id":"MDQ6VXNlcjIzNjU2MDAx","avatar_url":"https://avatars.githubusercontent.com/u/23656001?v=4","gravatar_id":"","url":"https://api.github.com/users/andrew-lee-1089","html_url":"https://github.com/andrew-lee-1089","followers_url":"https://api.github.com/users/andrew-lee-1089/followers","following_url":"https://api.github.com/users/andrew-lee-1089/following{/other_user}","gists_url":"https://api.github.com/users/andrew-lee-1089/gists{/gist_id}","starred_url":"https://api.github.com/users/andrew-lee-1089/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrew-lee-1089/subscriptions","organizations_url":"https://api.github.com/users/andrew-lee-1089/orgs","repos_url":"https://api.github.com/users/andrew-lee-1089/repos","events_url":"https://api.github.com/users/andrew-lee-1089/events{/privacy}","received_events_url":"https://api.github.com/users/andrew-lee-1089/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-14T09:39:12Z","updated_at":"2022-03-14T09:39:12Z","body":"I've manually  tested @davidjmemmett's method and it fixes the issue for me. ","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/1066569237/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"andrew-lee-1089","id":23656001,"node_id":"MDQ6VXNlcjIzNjU2MDAx","avatar_url":"https://avatars.githubusercontent.com/u/23656001?v=4","gravatar_id":"","url":"https://api.github.com/users/andrew-lee-1089","html_url":"https://github.com/andrew-lee-1089","followers_url":"https://api.github.com/users/andrew-lee-1089/followers","following_url":"https://api.github.com/users/andrew-lee-1089/following{/other_user}","gists_url":"https://api.github.com/users/andrew-lee-1089/gists{/gist_id}","starred_url":"https://api.github.com/users/andrew-lee-1089/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrew-lee-1089/subscriptions","organizations_url":"https://api.github.com/users/andrew-lee-1089/orgs","repos_url":"https://api.github.com/users/andrew-lee-1089/repos","events_url":"https://api.github.com/users/andrew-lee-1089/events{/privacy}","received_events_url":"https://api.github.com/users/andrew-lee-1089/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6233921184,"node_id":"MEE_lADOAALlkM4a6mSFzwAAAAFzkhag","url":"https://api.github.com/repos/fabric/fabric/issues/events/6233921184","actor":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-03-14T09:39:13Z","performed_via_github_app":null},{"id":6233921185,"node_id":"SE_lADOAALlkM4a6mSFzwAAAAFzkhah","url":"https://api.github.com/repos/fabric/fabric/issues/events/6233921185","actor":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-03-14T09:39:13Z","performed_via_github_app":null},{"actor":{"login":"davidjmemmett","id":213197,"node_id":"MDQ6VXNlcjIxMzE5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/213197?v=4","gravatar_id":"","url":"https://api.github.com/users/davidjmemmett","html_url":"https://github.com/davidjmemmett","followers_url":"https://api.github.com/users/davidjmemmett/followers","following_url":"https://api.github.com/users/davidjmemmett/following{/other_user}","gists_url":"https://api.github.com/users/davidjmemmett/gists{/gist_id}","starred_url":"https://api.github.com/users/davidjmemmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidjmemmett/subscriptions","organizations_url":"https://api.github.com/users/davidjmemmett/orgs","repos_url":"https://api.github.com/users/davidjmemmett/repos","events_url":"https://api.github.com/users/davidjmemmett/events{/privacy}","received_events_url":"https://api.github.com/users/davidjmemmett/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-18T19:57:29Z","updated_at":"2022-07-18T19:57:29Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/fabric/fabric/issues/2219","repository_url":"https://api.github.com/repos/fabric/fabric","labels_url":"https://api.github.com/repos/fabric/fabric/issues/2219/labels{/name}","comments_url":"https://api.github.com/repos/fabric/fabric/issues/2219/comments","events_url":"https://api.github.com/repos/fabric/fabric/issues/2219/events","html_url":"https://github.com/fabric/fabric/issues/2219","id":1308477867,"node_id":"I_kwDOAALlkM5N_cmr","number":2219,"title":"SFTP client on connection not closed after disconnect","user":{"login":"Roguelazer","id":263424,"node_id":"MDQ6VXNlcjI2MzQyNA==","avatar_url":"https://avatars.githubusercontent.com/u/263424?v=4","gravatar_id":"","url":"https://api.github.com/users/Roguelazer","html_url":"https://github.com/Roguelazer","followers_url":"https://api.github.com/users/Roguelazer/followers","following_url":"https://api.github.com/users/Roguelazer/following{/other_user}","gists_url":"https://api.github.com/users/Roguelazer/gists{/gist_id}","starred_url":"https://api.github.com/users/Roguelazer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Roguelazer/subscriptions","organizations_url":"https://api.github.com/users/Roguelazer/orgs","repos_url":"https://api.github.com/users/Roguelazer/repos","events_url":"https://api.github.com/users/Roguelazer/events{/privacy}","received_events_url":"https://api.github.com/users/Roguelazer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2022-07-18T19:50:22Z","updated_at":"2022-07-18T20:11:22Z","closed_at":"2022-07-18T20:11:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":189840,"node_id":"MDEwOlJlcG9zaXRvcnkxODk4NDA=","name":"fabric","full_name":"fabric/fabric","private":false,"owner":{"login":"fabric","id":400481,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQwMDQ4MQ==","avatar_url":"https://avatars.githubusercontent.com/u/400481?v=4","gravatar_id":"","url":"https://api.github.com/users/fabric","html_url":"https://github.com/fabric","followers_url":"https://api.github.com/users/fabric/followers","following_url":"https://api.github.com/users/fabric/following{/other_user}","gists_url":"https://api.github.com/users/fabric/gists{/gist_id}","starred_url":"https://api.github.com/users/fabric/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fabric/subscriptions","organizations_url":"https://api.github.com/users/fabric/orgs","repos_url":"https://api.github.com/users/fabric/repos","events_url":"https://api.github.com/users/fabric/events{/privacy}","received_events_url":"https://api.github.com/users/fabric/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/fabric/fabric","description":"Simple, Pythonic remote execution and deployment.","fork":false,"url":"https://api.github.com/repos/fabric/fabric","forks_url":"https://api.github.com/repos/fabric/fabric/forks","keys_url":"https://api.github.com/repos/fabric/fabric/keys{/key_id}","collaborators_url":"https://api.github.com/repos/fabric/fabric/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/fabric/fabric/teams","hooks_url":"https://api.github.com/repos/fabric/fabric/hooks","issue_events_url":"https://api.github.com/repos/fabric/fabric/issues/events{/number}","events_url":"https://api.github.com/repos/fabric/fabric/events","assignees_url":"https://api.github.com/repos/fabric/fabric/assignees{/user}","branches_url":"https://api.github.com/repos/fabric/fabric/branches{/branch}","tags_url":"https://api.github.com/repos/fabric/fabric/tags","blobs_url":"https://api.github.com/repos/fabric/fabric/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/fabric/fabric/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/fabric/fabric/git/refs{/sha}","trees_url":"https://api.github.com/repos/fabric/fabric/git/trees{/sha}","statuses_url":"https://api.github.com/repos/fabric/fabric/statuses/{sha}","languages_url":"https://api.github.com/repos/fabric/fabric/languages","stargazers_url":"https://api.github.com/repos/fabric/fabric/stargazers","contributors_url":"https://api.github.com/repos/fabric/fabric/contributors","subscribers_url":"https://api.github.com/repos/fabric/fabric/subscribers","subscription_url":"https://api.github.com/repos/fabric/fabric/subscription","commits_url":"https://api.github.com/repos/fabric/fabric/commits{/sha}","git_commits_url":"https://api.github.com/repos/fabric/fabric/git/commits{/sha}","comments_url":"https://api.github.com/repos/fabric/fabric/comments{/number}","issue_comment_url":"https://api.github.com/repos/fabric/fabric/issues/comments{/number}","contents_url":"https://api.github.com/repos/fabric/fabric/contents/{+path}","compare_url":"https://api.github.com/repos/fabric/fabric/compare/{base}...{head}","merges_url":"https://api.github.com/repos/fabric/fabric/merges","archive_url":"https://api.github.com/repos/fabric/fabric/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/fabric/fabric/downloads","issues_url":"https://api.github.com/repos/fabric/fabric/issues{/number}","pulls_url":"https://api.github.com/repos/fabric/fabric/pulls{/number}","milestones_url":"https://api.github.com/repos/fabric/fabric/milestones{/number}","notifications_url":"https://api.github.com/repos/fabric/fabric/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/fabric/fabric/labels{/name}","releases_url":"https://api.github.com/repos/fabric/fabric/releases{/id}","deployments_url":"https://api.github.com/repos/fabric/fabric/deployments","created_at":"2009-05-01T01:14:24Z","updated_at":"2025-11-10T03:41:27Z","pushed_at":"2025-07-20T17:33:07Z","git_url":"git://github.com/fabric/fabric.git","ssh_url":"git@github.com:fabric/fabric.git","clone_url":"https://github.com/fabric/fabric.git","svn_url":"https://github.com/fabric/fabric","homepage":"http://fabfile.org","size":19288,"stargazers_count":15296,"watchers_count":15296,"language":"Python","has_issues":true,"has_projects":false,"has_downloads":false,"has_wiki":false,"has_pages":false,"has_discussions":false,"forks_count":1959,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":492,"license":{"key":"bsd-2-clause","name":"BSD 2-Clause \"Simplified\" License","spdx_id":"BSD-2-Clause","url":"https://api.github.com/licenses/bsd-2-clause","node_id":"MDc6TGljZW5zZTQ="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":1959,"open_issues":492,"watchers":15296,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"**Describe the bug**\r\nIf using `fabric` to reboot a host, it's expected that the connection will be closed and recycled. This works, but if you perform `sftp` operations (including basic things like `.get()` on the connection) both before and after rebooting, you will find that they always fail with an OSError after reboot.\r\n\r\nI believe this is because the memoized SFTP client has become invalid.\r\n\r\nI can't quite figure out where the logic to reconnect on error is (is it in fabric? invoke? paramiko), so feel free to tell me to re-file this against Invoke if that's where this belongs.\r\n\r\n**To Reproduce**\r\n```python\r\nimport time\r\nfrom io import BytesIO\r\nfrom fabric import task\r\n\r\ndef reboot(c, wait=600):\r\n    c.sudo('reboot', warn=True)\r\n    time.sleep(5)\r\n\r\n    deadline = time.monotonic() + wait\r\n\r\n    while True:\r\n        try:\r\n            c.run('whoami', echo=False, hide=True)\r\n            time.sleep(5)\r\n            return\r\n        except (paramiko.ssh_exception.NoValidConnectionsError, TimeoutError, OSError):\r\n            if time.monotonic() >= deadline:\r\n                raise\r\n            time.sleep(5)\r\n\r\n@task\r\ndef repro(c):\r\n    i = BytesIO()\r\n    c.get(\"/etc/issue\", i)\r\n    reboot(c)\r\n    c.get(\"/etc/issue\", i)\r\n```\r\n\r\n**Expected behaviour**\r\nThe SFTP channel should be reset after an error just like the regular command channel.\r\n\r\nAdding the following to the beginning of my `reboot` function works around this:\r\n\r\n```python\r\nif c._sftp is not None:\r\n    c._sftp.close()\r\n    c._sftp = None\r\n```\r\n\r\nOne option would be to expose a public method with a name like `close_sftp()` which simply does the above without making users resort to poking at private instance variables.\r\n\r\n**Environment**\r\nI've reproduced this on the latest Python 3.8 and 3.9 and with Fabric 2.7.0 and 2.7.1. It obviously has no relation to the remote server, but it occurs against several versions of OpenSSH 8.x.","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/2219/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fabric/fabric/issues/2219/timeline","performed_via_github_app":null,"state_reason":"not_planned"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/1386093892","html_url":"https://github.com/fabric/fabric/issues/1981#issuecomment-1386093892","issue_url":"https://api.github.com/repos/fabric/fabric/issues/1981","id":1386093892,"node_id":"IC_kwDOAALlkM5Snh1E","user":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-17T21:40:49Z","updated_at":"2023-01-17T21:40:49Z","body":"Merging the related PR for 3.0.x line (out soon!)","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/fabric/fabric/issues/comments/1386093892/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8250008350,"node_id":"CE_lADOAALlkM4a6mSFzwAAAAHrvSMe","url":"https://api.github.com/repos/fabric/fabric/issues/events/8250008350","actor":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2023-01-17T21:40:49Z","state_reason":null,"performed_via_github_app":null},{"id":8250035323,"node_id":"REFE_lADOAALlkM4a6mSFzwAAAAHrvYx7","url":"https://api.github.com/repos/fabric/fabric/issues/events/8250035323","actor":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"5e650f87848da75b6ea5070d0e6c07260594984d","commit_url":"https://api.github.com/repos/fabric/fabric/commits/5e650f87848da75b6ea5070d0e6c07260594984d","created_at":"2023-01-17T21:44:53Z","performed_via_github_app":null},{"id":8250035350,"node_id":"REFE_lADOAALlkM4a6mSFzwAAAAHrvYyW","url":"https://api.github.com/repos/fabric/fabric/issues/events/8250035350","actor":{"login":"bitprophet","id":6088,"node_id":"MDQ6VXNlcjYwODg=","avatar_url":"https://avatars.githubusercontent.com/u/6088?v=4","gravatar_id":"","url":"https://api.github.com/users/bitprophet","html_url":"https://github.com/bitprophet","followers_url":"https://api.github.com/users/bitprophet/followers","following_url":"https://api.github.com/users/bitprophet/following{/other_user}","gists_url":"https://api.github.com/users/bitprophet/gists{/gist_id}","starred_url":"https://api.github.com/users/bitprophet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bitprophet/subscriptions","organizations_url":"https://api.github.com/users/bitprophet/orgs","repos_url":"https://api.github.com/users/bitprophet/repos","events_url":"https://api.github.com/users/bitprophet/events{/privacy}","received_events_url":"https://api.github.com/users/bitprophet/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"bdbdbc8ea1b7173cfea37da6a2b6cc842937270f","commit_url":"https://api.github.com/repos/fabric/fabric/commits/bdbdbc8ea1b7173cfea37da6a2b6cc842937270f","created_at":"2023-01-17T21:44:53Z","performed_via_github_app":null}]