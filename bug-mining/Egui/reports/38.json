{"url":"https://api.github.com/repos/emilk/egui/issues/3109","repository_url":"https://api.github.com/repos/emilk/egui","labels_url":"https://api.github.com/repos/emilk/egui/issues/3109/labels{/name}","comments_url":"https://api.github.com/repos/emilk/egui/issues/3109/comments","events_url":"https://api.github.com/repos/emilk/egui/issues/3109/events","html_url":"https://github.com/emilk/egui/issues/3109","id":1773188889,"node_id":"I_kwDOCd2s285psLcZ","number":3109,"title":"Duration passed to `request_repaint_after` is ignored if called each frame","user":{"login":"Sedeniono","id":39583823,"node_id":"MDQ6VXNlcjM5NTgzODIz","avatar_url":"https://avatars.githubusercontent.com/u/39583823?v=4","gravatar_id":"","url":"https://api.github.com/users/Sedeniono","html_url":"https://github.com/Sedeniono","followers_url":"https://api.github.com/users/Sedeniono/followers","following_url":"https://api.github.com/users/Sedeniono/following{/other_user}","gists_url":"https://api.github.com/users/Sedeniono/gists{/gist_id}","starred_url":"https://api.github.com/users/Sedeniono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sedeniono/subscriptions","organizations_url":"https://api.github.com/users/Sedeniono/orgs","repos_url":"https://api.github.com/users/Sedeniono/repos","events_url":"https://api.github.com/users/Sedeniono/events{/privacy}","received_events_url":"https://api.github.com/users/Sedeniono/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1191600517,"node_id":"MDU6TGFiZWwxMTkxNjAwNTE3","url":"https://api.github.com/repos/emilk/egui/labels/bug","name":"bug","color":"FBCA04","default":true,"description":"Something is broken"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/emilk/egui/milestones/3","html_url":"https://github.com/emilk/egui/milestone/3","labels_url":"https://api.github.com/repos/emilk/egui/milestones/3/labels","id":10214453,"node_id":"MI_kwDOCd2s284Am9w1","number":3,"title":"Next Major Release","description":"Issues to consider before then next major release","creator":{"login":"emilk","id":1148717,"node_id":"MDQ6VXNlcjExNDg3MTc=","avatar_url":"https://avatars.githubusercontent.com/u/1148717?v=4","gravatar_id":"","url":"https://api.github.com/users/emilk","html_url":"https://github.com/emilk","followers_url":"https://api.github.com/users/emilk/followers","following_url":"https://api.github.com/users/emilk/following{/other_user}","gists_url":"https://api.github.com/users/emilk/gists{/gist_id}","starred_url":"https://api.github.com/users/emilk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emilk/subscriptions","organizations_url":"https://api.github.com/users/emilk/orgs","repos_url":"https://api.github.com/users/emilk/repos","events_url":"https://api.github.com/users/emilk/events{/privacy}","received_events_url":"https://api.github.com/users/emilk/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":1,"closed_issues":88,"state":"closed","created_at":"2023-11-21T09:33:31Z","updated_at":"2025-01-06T18:29:55Z","due_on":null,"closed_at":"2024-12-11T15:45:02Z"},"comments":20,"created_at":"2023-06-25T10:04:06Z","updated_at":"2024-02-05T13:45:51Z","closed_at":"2024-02-05T13:45:50Z","author_association":"NONE","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Describe the bug**\r\nUsing egui 0.22.0, calling `request_repaint_after()` causes the application to redraw the UI with a high refresh rate, regardless of the duration passed into `request_repaint_after()`. It behaves (mostly) as if calling `request_repaint()`.\r\nThe bug was not there in version 0.21.0.\r\n\r\n**Steps to reproduce the behavior:**\r\nThe following code was adapted from the hello world example. I replaced the controls with a fps (frames per second) and counter label. Rust file:\r\n```rs\r\nuse eframe::egui;\r\nuse std::time::{Duration, Instant};\r\n\r\nfn main() -> Result<(), eframe::Error> {\r\n    let options = eframe::NativeOptions {\r\n        initial_window_size: Some(egui::vec2(320.0, 240.0)),\r\n        ..Default::default()\r\n    };\r\n    eframe::run_native(\r\n        \"My egui App\",\r\n        options,\r\n        Box::new(|_cc| Box::<MyApp>::default()),\r\n    )\r\n}\r\n\r\nstruct MyApp {\r\n    previous_instant: Instant,\r\n    previous_count: u64,\r\n}\r\n\r\nimpl Default for MyApp {\r\n    fn default() -> Self {\r\n        Self {\r\n            previous_instant: Instant::now(),\r\n            previous_count: 0,\r\n        }\r\n    }\r\n}\r\n\r\nimpl eframe::App for MyApp {\r\n    fn update(&mut self, ctx: &egui::Context, _frame: &mut eframe::Frame) {\r\n        egui::CentralPanel::default().show(ctx, |ui| {\r\n            ui.heading(\"My egui Application\");\r\n            let fps = 1.0 / self.previous_instant.elapsed().as_secs_f64();\r\n            self.previous_instant = Instant::now();\r\n            self.previous_count += 1;\r\n            ui.label(format!(\"fps: {:.2}, counter: {}\", fps, self.previous_count));\r\n        });\r\n        ctx.request_repaint_after(Duration::from_secs(1));\r\n    }\r\n}\r\n```\r\ntoml:\r\n```toml\r\n[package]\r\nname = \"egui_request_repaint_bug\"\r\nversion = \"0.1.0\"\r\nedition = \"2021\"\r\n\r\n[dependencies]\r\negui = \"0.22.0\"\r\neframe = { version = \"0.22.0\", default-features = false, features = [\r\n    \"default_fonts\", # Embed the default egui fonts.\r\n    \"glow\",          # Use the glow rendering backend. Alternative: \"wgpu\".\r\n] }\r\n\r\n[patch.crates-io]\r\negui = { git = \"https://github.com/emilk/egui\", branch = \"master\" }\r\neframe = { git = \"https://github.com/emilk/egui\", branch = \"master\" }\r\n```\r\n\r\nBuild and run on Windows 10.\r\n\r\nWhen the application has focus, the \"fps\" labels shows approximately a value of 144 on my monitor (which has a refresh rate of 144 Hz), regardless of where the mouse is. When the application does not have focus, the \"fps\" label continues updating with a high frequency and shows approximately 90. (I have no idea where the 90 is coming from.)\r\n\r\nIf I remove the call to `request_repaint_after()`, the application no longer updates with a high rate. \r\nKeeping the `request_repaint_after()` call and going back to egui 0.21.0, I get the expected behavior. Considering the [release notes](https://github.com/emilk/egui/blob/master/crates/eframe/CHANGELOG.md#0220---2023-05-23), I guess this is related to #2939.\r\n\r\n**Expected behavior**\r\nWhen the application does NOT have focus, the \"fps\" label should show a value of approximately 1. In other words, the GUI should update only once a second because I passed 1s as duration to `request_repaint_after()`.\r\nWhen the application does have focus, the \"fps\" label should show a value of 144 only while moving around the mouse.\r\n\r\n**Desktop:**\r\n - OS:  Windows 10\r\n - Browser: Not applicable; running on native\r\n - Version of egui: 0.22.0 (version 0.21.0 is not affected)","closed_by":{"login":"emilk","id":1148717,"node_id":"MDQ6VXNlcjExNDg3MTc=","avatar_url":"https://avatars.githubusercontent.com/u/1148717?v=4","gravatar_id":"","url":"https://api.github.com/users/emilk","html_url":"https://github.com/emilk","followers_url":"https://api.github.com/users/emilk/followers","following_url":"https://api.github.com/users/emilk/following{/other_user}","gists_url":"https://api.github.com/users/emilk/gists{/gist_id}","starred_url":"https://api.github.com/users/emilk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emilk/subscriptions","organizations_url":"https://api.github.com/users/emilk/orgs","repos_url":"https://api.github.com/users/emilk/repos","events_url":"https://api.github.com/users/emilk/events{/privacy}","received_events_url":"https://api.github.com/users/emilk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/emilk/egui/issues/3109/reactions","total_count":3,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"timeline_url":"https://api.github.com/repos/emilk/egui/issues/3109/timeline","performed_via_github_app":null,"state_reason":"completed"}