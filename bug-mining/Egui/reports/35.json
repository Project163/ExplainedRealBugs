{"url":"https://api.github.com/repos/emilk/egui/issues/3321","repository_url":"https://api.github.com/repos/emilk/egui","labels_url":"https://api.github.com/repos/emilk/egui/issues/3321/labels{/name}","comments_url":"https://api.github.com/repos/emilk/egui/issues/3321/comments","events_url":"https://api.github.com/repos/emilk/egui/issues/3321/events","html_url":"https://github.com/emilk/egui/issues/3321","id":1887050097,"node_id":"I_kwDOCd2s285wehlx","number":3321,"title":"eframe: Graphical glitches when window has been minimized","user":{"login":"rustbasic","id":127506429,"node_id":"U_kgDOB5mX_Q","avatar_url":"https://avatars.githubusercontent.com/u/127506429?v=4","gravatar_id":"","url":"https://api.github.com/users/rustbasic","html_url":"https://github.com/rustbasic","followers_url":"https://api.github.com/users/rustbasic/followers","following_url":"https://api.github.com/users/rustbasic/following{/other_user}","gists_url":"https://api.github.com/users/rustbasic/gists{/gist_id}","starred_url":"https://api.github.com/users/rustbasic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rustbasic/subscriptions","organizations_url":"https://api.github.com/users/rustbasic/orgs","repos_url":"https://api.github.com/users/rustbasic/repos","events_url":"https://api.github.com/users/rustbasic/events{/privacy}","received_events_url":"https://api.github.com/users/rustbasic/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1191600517,"node_id":"MDU6TGFiZWwxMTkxNjAwNTE3","url":"https://api.github.com/repos/emilk/egui/labels/bug","name":"bug","color":"FBCA04","default":true,"description":"Something is broken"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2023-09-08T06:46:45Z","updated_at":"2024-03-17T05:09:57Z","closed_at":"2024-01-25T09:15:39Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Title: Regarding severe graphical glitches with egui\r\n\r\nDear emilk,\r\n\r\nWhen continuously running a program that uses the egui library on windows, there is a bug causing severe graphic glitches after about 1 to 6 hours.\r\n\r\nBefore I explain the circumstances leading to this glitch, I want to highlight another bug.\r\n\r\n            frame.set_minimized(true);\r\n\r\nWhen using the above function or the native windows minimize button and then restoring the program to its original size, the frame.info().window_info.minimized remains constantly set to true. Therefore, it's impossible to determine whether the program is in a minimized state. In the minimized state, ui.available_width() slightly decreases, and ui.available_height() becomes 0.0. After restoring from the minimized state, while ui.available_width() returns to normal, sometimes ui.available_height() remains at 0.0.\r\n\r\nI've tried to determine the exact conditions that lead to the graphic glitches. The frequency of glitches appears to be higher when restoring the program to its original size after minimizing it for over an hour. The graphical glitches also occur every few hours even without minimizing the program. When these glitches happen, it seems ui.available_height() is at 0.0. It's presumed that the glitches might be linked to the instances when, upon restoring from minimized state, ui.available_height() occasionally remains at 0.0.\r\n\r\nPlease note that this behavior isn't consistent, as it happens only every few hours. However, these are my observations so far while trying to reproduce and prevent this glitch.\r\n\r\nThanks.\r\n\r\n---------------------------------------------------------\r\negui Version\r\negui 0.22.0\r\negui 0.21.0\r\n\r\n[ BUG Capture ]\r\n\r\n![bug-capture-1](https://github.com/emilk/egui/assets/127506429/31486ec5-3091-4107-9c9d-9d094d93c3c8)\r\n\r\n[ No Bug Capture ]\r\n\r\n![no-bug-capture-1](https://github.com/emilk/egui/assets/127506429/558db7e3-e636-4bdf-abb9-487bafd2bb0a)\r\n\r\n\r\n---------------------------------------------------------------------\r\n\r\nDear emilk,\r\n\r\nI've been working for over 6 months to reproduce the issue of graphics breaking every few hours in a Windows program using the egui library. Through these efforts, I've roughly identified the reason and found a temporary way to prevent it.\r\n\r\nWhen the program is minimized, the value of ui.available_height() decreases.\r\n\r\nIn the minimized state, the value of ui.available_height() seems to range between 0.0 to 20.0, depending on where the program was launched.\r\n\r\nI tried using the method if ui.available_height() < 100.0 { return; }, but graphics still broke every few hours when restoring from a minimized state.\r\n\r\nSo,\r\n```\r\nlet mut ui_available_height = ui.available_height();\r\nif ui_available_height < 100.0 {\r\n    ui_available_height = ui_available_height.at_least(100.0);\r\n}\r\n```\r\nI created the ui_available_height value using the above method and used it, but still, the graphics broke every few hours after restoring from a minimized state.\r\n\r\nLastly, I found a method where graphics didn't break for 2-3 days upon testing.\r\n```rust\r\nfn update(&mut self, ctx: &egui::Context, frame: &mut eframe::Frame) {\r\n    ...\r\n    let mut minimized_stop_work = false;\r\n    ...\r\n    egui::CentralPanel::default().frame(panel_frame).show(ctx, |ui| {\r\n        let ui_available_height = ui.available_height();\r\n        if ui_available_height < 100.0 {\r\n            minimized_stop_work = true;\r\n        }\r\n        ...\r\n    });     // CentralPanel()\r\n    ...\r\n    if !minimized_stop_work {\r\n        ctx.request_repaint();\r\n    }\r\n}    // fn update()\r\n```\r\nBy assuming that it's in a minimized state when ui.available_height() is below 100.0, and by not executing ctx.request_repaint(); (RunMode::Continuous mode in egui_demo_app.exe), the screen doesn't break even when restoring from a minimized state in Windows for a prolonged period. I've successfully tested this for 2-3 days.\r\n\r\nThis method might temporarily prevent the screen from breaking. However, I'm looking forward to a fundamental solution provided by the egui library.\r\n\r\nThanks, emilk.\r\n\r\n","closed_by":{"login":"emilk","id":1148717,"node_id":"MDQ6VXNlcjExNDg3MTc=","avatar_url":"https://avatars.githubusercontent.com/u/1148717?v=4","gravatar_id":"","url":"https://api.github.com/users/emilk","html_url":"https://github.com/emilk","followers_url":"https://api.github.com/users/emilk/followers","following_url":"https://api.github.com/users/emilk/following{/other_user}","gists_url":"https://api.github.com/users/emilk/gists{/gist_id}","starred_url":"https://api.github.com/users/emilk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emilk/subscriptions","organizations_url":"https://api.github.com/users/emilk/orgs","repos_url":"https://api.github.com/users/emilk/repos","events_url":"https://api.github.com/users/emilk/events{/privacy}","received_events_url":"https://api.github.com/users/emilk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/emilk/egui/issues/3321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/emilk/egui/issues/3321/timeline","performed_via_github_app":null,"state_reason":"completed"}