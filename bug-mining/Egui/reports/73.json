{"url":"https://api.github.com/repos/emilk/egui/issues/3959","repository_url":"https://api.github.com/repos/emilk/egui","labels_url":"https://api.github.com/repos/emilk/egui/issues/3959/labels{/name}","comments_url":"https://api.github.com/repos/emilk/egui/issues/3959/comments","events_url":"https://api.github.com/repos/emilk/egui/issues/3959/events","html_url":"https://github.com/emilk/egui/issues/3959","id":2116554244,"node_id":"I_kwDOCd2s285-KA4E","number":3959,"title":"Crash when changing a viewport aspect, that requires window recreation","user":{"login":"AnotherNathan","id":85432173,"node_id":"MDQ6VXNlcjg1NDMyMTcz","avatar_url":"https://avatars.githubusercontent.com/u/85432173?v=4","gravatar_id":"","url":"https://api.github.com/users/AnotherNathan","html_url":"https://github.com/AnotherNathan","followers_url":"https://api.github.com/users/AnotherNathan/followers","following_url":"https://api.github.com/users/AnotherNathan/following{/other_user}","gists_url":"https://api.github.com/users/AnotherNathan/gists{/gist_id}","starred_url":"https://api.github.com/users/AnotherNathan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AnotherNathan/subscriptions","organizations_url":"https://api.github.com/users/AnotherNathan/orgs","repos_url":"https://api.github.com/users/AnotherNathan/repos","events_url":"https://api.github.com/users/AnotherNathan/events{/privacy}","received_events_url":"https://api.github.com/users/AnotherNathan/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":3702439575,"node_id":"LA_kwDOCd2s287crr6X","url":"https://api.github.com/repos/emilk/egui/labels/egui_glow","name":"egui_glow","color":"c5def5","default":false,"description":"Relates to running egui_glow on native"},{"id":4099120365,"node_id":"LA_kwDOCd2s2870U5zt","url":"https://api.github.com/repos/emilk/egui/labels/native-windows","name":"native-windows","color":"c2e0c6","default":false,"description":"Running on native Windows OS"},{"id":6256243898,"node_id":"LA_kwDOCd2s288AAAABdOa0ug","url":"https://api.github.com/repos/emilk/egui/labels/viewports","name":"viewports","color":"d93f0b","default":false,"description":"multiple viewports, viewports API"},{"id":6518501073,"node_id":"LA_kwDOCd2s288AAAABhIhu0Q","url":"https://api.github.com/repos/emilk/egui/labels/crash","name":"crash","color":"D93F0B","default":false,"description":"crash, panic, segfault, freeze, …"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-02-03T15:56:51Z","updated_at":"2024-08-26T06:55:35Z","closed_at":"2024-08-26T06:55:35Z","author_association":"CONTRIBUTOR","active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Description**\r\nWhen changing something on a viewport, that requires the recreation of the viewport window in order to apply the change, the application crashes.\r\n\r\nI have only observed it on the glow backend, since the wgpu crashes immediately for me.\r\n\r\nSometimes I am getting a stack trace with a handle error and other times the application simply closes without any additional output.\r\n\r\nThe provided example changes, whether the viewport should show the close button or not (which internally requires the recreation of the viewport window).\r\n\r\n<details><summary>Stacktrace</summary>\r\n<br>\r\n\r\n```\r\nthread 'main' panicked at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\glow_integration.rs:815:69: \r\ncalled `Result::unwrap()` on an `Err` value: Error { raw_code: Some(6), raw_os_message: Some(\"Das Handle ist ungültig. (os error 6)\"), kind: Misc }\r\nstack backtrace:\r\n   0: std::panicking::begin_panic_handler\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library\\std\\src\\panicking.rs:645\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library\\core\\src\\panicking.rs:72\r\n   2: core::result::unwrap_failed\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112/library\\core\\src\\result.rs:1653\r\n   3: enum2$<core::result::Result<enum2$<glutin::context::PossiblyCurrentContext>,glutin::error::Error> >::unwrap<enum2$<glutin::context::PossiblyCurrentContext>,glutin::error::Error>\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\core\\src\\result.rs:1077\r\n   4: eframe::native::glow_integration::change_gl_context\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\glow_integration.rs:815\r\n   5: eframe::native::glow_integration::GlowWinitRunning::run_ui_and_paint\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\glow_integration.rs:621\r\n   6: eframe::native::glow_integration::impl$1::run_ui_and_paint\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\glow_integration.rs:402\r\n   7: eframe::native::run::run_and_return::closure$0<eframe::native::glow_integration::GlowWinitApp>\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\run.rs:99\r\n   8: winit::platform_impl::platform::event_loop::impl$3::run_on_demand::closure$0<enum2$<eframe::native::winit_integration::UserEvent>,eframe::native::run::run_and_return::closure_env$0<eframe::native::glow_integration::GlowWinitApp> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop.rs:236\r\n   9: alloc::boxed::impl$48::call_mut<tuple$<enum2$<winit::event::Event<enum2$<eframe::native::winit_integration::UserEvent> > > >,dyn$<core::ops::function::FnMut<tuple$<enum2$<winit::event::Event<enum2$<eframe::native::winit_integration::UserEvent> > > >,assoc\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\alloc\\src\\boxed.rs:2014\r\n  10: winit::platform_impl::platform::event_loop::runner::impl$3::call_event_handler::closure$0<enum2$<eframe::native::winit_integration::UserEvent> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop\\runner.rs:250\r\n  11: core::panic::unwind_safe::impl$23::call_once<tuple$<>,winit::platform_impl::platform::event_loop::runner::impl$3::call_event_handler::closure_env$0<enum2$<eframe::native::winit_integration::UserEvent> > >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\core\\src\\panic\\unwind_safe.rs:272\r\n  12: std::panicking::try::do_call<core::panic::unwind_safe::AssertUnwindSafe<winit::platform_impl::platform::event_loop::runner::impl$3::call_event_handler::closure_env$0<enum2$<eframe::native::winit_integration::UserEvent> > >,tuple$<> >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\std\\src\\panicking.rs:552\r\n  13: glutin::api::wgl::surface::impl$2::resize<glutin::surface::WindowSurface>\r\n  14: std::panicking::try<tuple$<>,core::panic::unwind_safe::AssertUnwindSafe<winit::platform_impl::platform::event_loop::runner::impl$3::call_event_handler::closure_env$0<enum2$<eframe::native::winit_integration::UserEvent> > > >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\std\\src\\panicking.rs:516\r\n  15: std::panic::catch_unwind<core::panic::unwind_safe::AssertUnwindSafe<winit::platform_impl::platform::event_loop::runner::impl$3::call_event_handler::closure_env$0<enum2$<eframe::native::winit_integration::UserEvent> > >,tuple$<> >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\std\\src\\panic.rs:142\r\n  16: winit::platform_impl::platform::event_loop::runner::EventLoopRunner<enum2$<eframe::native::winit_integration::UserEvent> >::catch_unwind<enum2$<eframe::native::winit_integration::UserEvent>,tuple$<>,winit::platform_impl::platform::event_loop::runner::impl\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop\\runner.rs:183\r\n  17: winit::platform_impl::platform::event_loop::runner::EventLoopRunner<enum2$<eframe::native::winit_integration::UserEvent> >::call_event_handler<enum2$<eframe::native::winit_integration::UserEvent> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop\\runner.rs:246\r\n  18: winit::platform_impl::platform::event_loop::runner::EventLoopRunner<enum2$<eframe::native::winit_integration::UserEvent> >::send_event<enum2$<eframe::native::winit_integration::UserEvent> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop\\runner.rs:224\r\n  19: winit::platform_impl::platform::event_loop::WindowData<enum2$<eframe::native::winit_integration::UserEvent> >::send_event<enum2$<eframe::native::winit_integration::UserEvent> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop.rs:112\r\n  20: winit::platform_impl::platform::event_loop::public_window_callback_inner::closure$4<enum2$<eframe::native::winit_integration::UserEvent> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop.rs:1145\r\n  21: core::ops::function::FnOnce::call_once<winit::platform_impl::platform::event_loop::public_window_callback_inner::closure_env$4<enum2$<eframe::native::winit_integration::UserEvent> >,tuple$<> >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\core\\src\\ops\\function.rs:250\r\n  22: core::panic::unwind_safe::impl$23::call_once<tuple$<>,winit::platform_impl::platform::event_loop::public_window_callback_inner::closure_env$4<enum2$<eframe::native::winit_integration::UserEvent> > >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\core\\src\\panic\\unwind_safe.rs:272\r\n  23: std::panicking::try::do_call<core::panic::unwind_safe::AssertUnwindSafe<winit::platform_impl::platform::event_loop::public_window_callback_inner::closure_env$4<enum2$<eframe::native::winit_integration::UserEvent> > >,tuple$<> >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\std\\src\\panicking.rs:552\r\n  24: glutin::api::wgl::surface::impl$2::resize<glutin::surface::WindowSurface>\r\n  25: std::panicking::try<tuple$<>,core::panic::unwind_safe::AssertUnwindSafe<winit::platform_impl::platform::event_loop::public_window_callback_inner::closure_env$4<enum2$<eframe::native::winit_integration::UserEvent> > > >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\std\\src\\panicking.rs:516\r\n  26: std::panic::catch_unwind<core::panic::unwind_safe::AssertUnwindSafe<winit::platform_impl::platform::event_loop::public_window_callback_inner::closure_env$4<enum2$<eframe::native::winit_integration::UserEvent> > >,tuple$<> >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\std\\src\\panic.rs:142\r\n  27: winit::platform_impl::platform::event_loop::runner::EventLoopRunner<enum2$<eframe::native::winit_integration::UserEvent> >::catch_unwind<enum2$<eframe::native::winit_integration::UserEvent>,tuple$<>,winit::platform_impl::platform::event_loop::public_windo\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop\\runner.rs:183\r\n  28: winit::platform_impl::platform::event_loop::public_window_callback_inner<enum2$<eframe::native::winit_integration::UserEvent> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop.rs:2286\r\n  29: winit::platform_impl::platform::event_loop::public_window_callback<enum2$<eframe::native::winit_integration::UserEvent> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop.rs:984\r\n  30: CallWindowProcW\r\n  31: DispatchMessageW\r\n  32: SendMessageTimeoutW\r\n  33: KiUserCallbackDispatcher\r\n  34: NtUserDispatchMessage\r\n  35: DispatchMessageW\r\n  36: winit::platform_impl::platform::event_loop::EventLoop<enum2$<eframe::native::winit_integration::UserEvent> >::dispatch_peeked_messages<enum2$<eframe::native::winit_integration::UserEvent> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop.rs:449\r\n  37: winit::platform_impl::platform::event_loop::EventLoop<enum2$<eframe::native::winit_integration::UserEvent> >::run_on_demand<enum2$<eframe::native::winit_integration::UserEvent>,eframe::native::run::run_and_return::closure_env$0<eframe::native::glow_integr\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform_impl\\windows\\event_loop.rs:247\r\n  38: winit::platform::run_on_demand::impl$0::run_on_demand<enum2$<eframe::native::winit_integration::UserEvent>,eframe::native::run::run_and_return::closure_env$0<eframe::native::glow_integration::GlowWinitApp> >\r\n             at C:\\Users\\Nathan\\.cargo\\registry\\src\\index.crates.io-6f17d22bba15001f\\winit-0.29.10\\src\\platform\\run_on_demand.rs:80\r\n  39: eframe::native::run::run_and_return<eframe::native::glow_integration::GlowWinitApp>\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\run.rs:76\r\n  40: eframe::native::run::run_glow::closure$0\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\run.rs:394\r\n  41: eframe::native::run::with_event_loop::closure$0<enum2$<core::result::Result<tuple$<>,enum2$<eframe::Error> > >,eframe::native::run::run_glow::closure_env$0>\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\run.rs:58\r\n  42: std::thread::local::LocalKey<core::cell::RefCell<enum2$<core::option::Option<winit::event_loop::EventLoop<enum2$<eframe::native::winit_integration::UserEvent> > > > > >::try_with<core::cell::RefCell<enum2$<core::option::Option<winit::event_loop::EventLoop      \r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\std\\src\\thread\\local.rs:270\r\n  43: std::thread::local::LocalKey<core::cell::RefCell<enum2$<core::option::Option<winit::event_loop::EventLoop<enum2$<eframe::native::winit_integration::UserEvent> > > > > >::with<core::cell::RefCell<enum2$<core::option::Option<winit::event_loop::EventLoop<enu      \r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\std\\src\\thread\\local.rs:246\r\n  44: eframe::native::run::with_event_loop<enum2$<core::result::Result<tuple$<>,enum2$<eframe::Error> > >,eframe::native::run::run_glow::closure_env$0>\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\run.rs:48\r\n  45: eframe::native::run::run_glow\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\native\\run.rs:392\r\n  46: eframe::run_native\r\n             at C:\\Users\\Nathan\\.cargo\\git\\checkouts\\egui-5e4507fa4153be06\\114f820\\crates\\eframe\\src\\lib.rs:262\r\n  47: egui_window_recreate_bug::main\r\n             at .\\src\\main.rs:11\r\n  48: core::ops::function::FnOnce::call_once<void (*)(),tuple$<> >\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\core\\src\\ops\\function.rs:250\r\n  49: core::hint::black_box\r\n             at /rustc/82e1608dfa6e0b5569232559e3d385fea5a93112\\library\\core\\src\\hint.rs:286\r\n```\r\n</details>\r\n\r\n**Steps to reproduce the behaviour**\r\n* run the provided example\r\n* click the checkbox on the main window\r\n* observe the crash\r\n\r\n**Platform**\r\n* Windows 10\r\n* RX7600 driver version 23.12.1\r\n\r\n**Example**\r\n[egui_window_recreate_bug.zip](https://github.com/emilk/egui/files/14152060/egui_window_recreate_bug.zip)\r\n","closed_by":{"login":"emilk","id":1148717,"node_id":"MDQ6VXNlcjExNDg3MTc=","avatar_url":"https://avatars.githubusercontent.com/u/1148717?v=4","gravatar_id":"","url":"https://api.github.com/users/emilk","html_url":"https://github.com/emilk","followers_url":"https://api.github.com/users/emilk/followers","following_url":"https://api.github.com/users/emilk/following{/other_user}","gists_url":"https://api.github.com/users/emilk/gists{/gist_id}","starred_url":"https://api.github.com/users/emilk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emilk/subscriptions","organizations_url":"https://api.github.com/users/emilk/orgs","repos_url":"https://api.github.com/users/emilk/repos","events_url":"https://api.github.com/users/emilk/events{/privacy}","received_events_url":"https://api.github.com/users/emilk/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/emilk/egui/issues/3959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/emilk/egui/issues/3959/timeline","performed_via_github_app":null,"state_reason":"completed"}