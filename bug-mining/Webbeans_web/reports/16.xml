<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:15:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OWB-466] Ensure removal of all ThreadLocal values</title>
                <link>https://issues.apache.org/jira/browse/OWB-466</link>
                <project id="12310844" key="OWB">OpenWebBeans</project>
                    <description>&lt;p&gt;While running our automated webapp tests with MyFaces CODI and OWB, I always got the following log entries:&lt;/p&gt;

&lt;p&gt;30.09.2010 16:14:14 org.apache.catalina.loader.WebappClassLoader clearThreadLocalMap&lt;br/&gt;
SCHWERWIEGEND: A web application created a ThreadLocal with key of type &lt;span class=&quot;error&quot;&gt;&amp;#91;java.lang.ThreadLocal&amp;#93;&lt;/span&gt; (value &lt;span class=&quot;error&quot;&gt;&amp;#91;java.lang.ThreadLocal@543c944f&amp;#93;&lt;/span&gt;) and a value of type &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.webbeans.inject.impl.InjectionPointImpl&amp;#93;&lt;/span&gt; (value [Field Injection Point, field name :  postConstructApplicationEvent, Bean Owner : [Name:systemEventBroadcaster,WebBeans Type:MANAGED,API Types:&lt;span class=&quot;error&quot;&gt;&amp;#91;java.lang.Object,org.apache.myfaces.extensions.cdi.jsf2.impl.listener.system.SystemEventBroadcaster&amp;#93;&lt;/span&gt;,Qualifiers:&lt;span class=&quot;error&quot;&gt;&amp;#91;javax.enterprise.inject.Any,javax.enterprise.inject.Default,javax.inject.Named&amp;#93;&lt;/span&gt;]]) but failed to remove it when the web application was stopped. To prevent a memory leak, the ThreadLocal has been forcibly removed.&lt;br/&gt;
30.09.2010 16:14:14 org.apache.catalina.loader.WebappClassLoader clearThreadLocalMap&lt;br/&gt;
SCHWERWIEGEND: A web application created a ThreadLocal with key of type &lt;span class=&quot;error&quot;&gt;&amp;#91;java.lang.ThreadLocal&amp;#93;&lt;/span&gt; (value &lt;span class=&quot;error&quot;&gt;&amp;#91;java.lang.ThreadLocal@552cf9bd&amp;#93;&lt;/span&gt;) and a value of type &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.webbeans.context.SessionContext&amp;#93;&lt;/span&gt; (value &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.webbeans.context.SessionContext@7bc012fa&amp;#93;&lt;/span&gt;) but failed to remove it when the web application was stopped. To prevent a memory leak, the ThreadLocal has been forcibly removed.&lt;br/&gt;
30.09.2010 16:14:14 org.apache.catalina.loader.WebappClassLoader clearThreadLocalMap&lt;br/&gt;
SCHWERWIEGEND: A web application created a ThreadLocal with key of type &lt;span class=&quot;error&quot;&gt;&amp;#91;java.lang.ThreadLocal&amp;#93;&lt;/span&gt; (value &lt;span class=&quot;error&quot;&gt;&amp;#91;java.lang.ThreadLocal@552cf9bd&amp;#93;&lt;/span&gt;) and a value of type &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.webbeans.context.SessionContext&amp;#93;&lt;/span&gt; (value &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.webbeans.context.SessionContext@7f1e1a8e&amp;#93;&lt;/span&gt;) but failed to remove it when the web application was stopped. To prevent a memory leak, the ThreadLocal has been forcibly removed.&lt;br/&gt;
30.09.2010 16:14:14 org.apache.coyote.http11.Http11Protocol destroy&lt;/p&gt;

&lt;p&gt;..saying that Tomcat&apos;s webappclassloader had to remove some ThreadLocal values from the ThreadMap.&lt;/p&gt;

&lt;p&gt;I was able to track the affected ThreadLocal instances down: InstanceBean.local and WebContextsService.sessionContext.&lt;/p&gt;

&lt;p&gt;After digging into the code, I found out that there are many remove() operations on various ThreadLocal instances, but it was not thought that remove() only works for the current Thread. Thus when a ThreadLocal is set during a request it won&apos;t be removed when the container stops, because the shutdown-thread is clearly not the same as the request-thread.&lt;/p&gt;

&lt;p&gt;This means the request-ThreadLocal instances have to be removed after every request has ended - in requestDestroyed(ServletRequestEvent event).&lt;/p&gt;

&lt;p&gt;The provided patch adds some remove() calls in requestDestroyed() and also in afterStopApplication(). With this patch none of the above error-logs are shown in any of my test cases. However there might be some other ThreadLocals which should be cleaned up at every request, but this solution currently works for me!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475506">OWB-466</key>
            <summary>Ensure removal of all ThreadLocal values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="jakobkorherr">Jakob Korherr</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Sep 2010 14:27:25 +0000</created>
                <updated>Wed, 20 Oct 2010 20:38:15 +0000</updated>
                            <resolved>Thu, 30 Sep 2010 17:51:02 +0000</resolved>
                                    <version>1.0.0-alpha-2</version>
                                    <fixVersion>1.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12916577" author="struberg" created="Thu, 30 Sep 2010 17:51:02 +0000"  >&lt;p&gt;patch applied, thanks Jakob!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456012" name="OWB-466.patch" size="9198" author="jakobkorherr" created="Thu, 30 Sep 2010 14:34:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>162836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 8 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i087jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>45820</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>