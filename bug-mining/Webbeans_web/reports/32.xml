<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:15:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OWB-595] Use case &quot;Faces Request Generates Non-Faces Response&quot; locks conversation forever (-&gt; BusyConversationException)</title>
                <link>https://issues.apache.org/jira/browse/OWB-595</link>
                <project id="12310844" key="OWB">OpenWebBeans</project>
                    <description>&lt;p&gt;how to reproduce this issue:&lt;br/&gt;
jsf2sample from OWB samples/conversation.jsf&lt;br/&gt;
1) modify ConversationData.getNumber to:         &lt;/p&gt;

&lt;p&gt;if (i == 11) &lt;/p&gt;
{ throw new NullPointerException(); }
&lt;p&gt; &lt;br/&gt;
 return i++;&lt;/p&gt;

&lt;p&gt;2) click &quot;Start conversation&quot; (remember cid of newly created conversation, for example cid=2)&lt;/p&gt;

&lt;p&gt;3) click &quot;Show number&quot; -&amp;gt; error page appears&lt;/p&gt;

&lt;p&gt;4) create GET  request to new conversation = put in browser &lt;a href=&quot;http://localhost:8080/jsf2sample/conversation.jsf?cid=2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/jsf2sample/conversation.jsf?cid=2&lt;/a&gt; where 2 is id of the new conversation -&amp;gt; BusyConversationException appears but conversation is not user by any thread!&lt;/p&gt;

&lt;p&gt;Reason: &lt;br/&gt;
OWB uses WebBeansPhaseListener fo managing conversation and set owbConversation.setInUsed(false) in after render response Phase. But render response phase is not mandatory:&lt;/p&gt;

&lt;p&gt;JSF 2.1 specification ,  2.1.3 Faces Request Generates Non-Faces Response:&lt;/p&gt;

&lt;p&gt;Normally, a JSF-based application will utilize the Render Response phase of the request processing lifecycle to actually&lt;br/&gt;
create the response that is sent back to the client. In some circumstances, however, this behavior might not be desirable.&lt;br/&gt;
For example:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;A Faces Request needs to be redirected to a different web application resource (via a call to HttpServletResponse.sendRedirect).&lt;/li&gt;
	&lt;li&gt;A Faces Request causes the generation of a response using some other technology (such as a servlet, or a JSP page not containing JSF components).&lt;/li&gt;
	&lt;li&gt;Faces Request causes the generation of a response simply by serving up the bytes of a resource, such as an image, a JavaScript file, a CSS file, or an applet&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;... &quot; It is then necessary to tell the JSF implementation that the response has already been created, so that the Render Response phase of the request processing lifecycle should **&lt;b&gt;BE SKIPPED&lt;/b&gt;**&quot; ...&lt;/p&gt;



&lt;p&gt;Practical example from real world programming: file download - JSF library (trindiad, primefaces ,...) calls facesContext.responseComplete(); and therefore there will be no render response. If OWB conversationScoped bean is used here, then every next request to same conversation will obtain BusyConversationException.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12515053">OWB-595</key>
            <summary>Use case &quot;Faces Request Generates Non-Faces Response&quot; locks conversation forever (-&gt; BusyConversationException)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="markoc50">Martin Ko&#269;&#237;</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jul 2011 18:55:23 +0000</created>
                <updated>Tue, 30 Aug 2011 09:27:59 +0000</updated>
                            <resolved>Sun, 28 Aug 2011 17:28:55 +0000</resolved>
                                                    <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13069682" author="markoc50" created="Fri, 22 Jul 2011 19:06:48 +0000"  >&lt;p&gt;I already reported it once: &lt;a href=&quot;https://issues.apache.org/jira/browse/OWB-467&quot; title=&quot;Move init/destroy of conversation from phase listener to servlet filter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;OWB-467&quot;&gt;&lt;del&gt;OWB-467&lt;/del&gt;&lt;/a&gt; but proposed solution used servlet filter. &lt;/p&gt;

&lt;p&gt;Is org.apache.webbeans.servlet.WebBeansConfigurationListener more suitable place to unlock conversation?&lt;/p&gt;</comment>
                            <comment id="13069799" author="bergmark" created="Fri, 22 Jul 2011 21:54:01 +0000"  >&lt;p&gt;As you pointed out, may be simple to just unlock the conversation at the end of the request via our existing RequestListener.  The only spec restriction appears to be 2 requests operating on the same conversation.  The key conversation classes are visible from openwebbeans-impl, but maybe the risk is creating a transient conversation just to immediately mark it as inactive if the current request did not already have an active conversation.&lt;/p&gt;</comment>
                            <comment id="13069817" author="struberg" created="Fri, 22 Jul 2011 22:29:11 +0000"  >&lt;p&gt;Hi!&lt;br/&gt;
I think we can do it in our ServletRequestListener. The spec prohibits that the Conversation gets touched by 2 Requests in parallel anyway.&lt;/p&gt;</comment>
                            <comment id="13092439" author="struberg" created="Sun, 28 Aug 2011 10:05:13 +0000"  >&lt;p&gt;Martin, even in case of a redirect to a non-faces request, we should get the afterPhase(any) and the following condition should be met:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        if (phaseEvent.getPhaseId().equals(PhaseId.RENDER_RESPONSE) ||
                phaseEvent.getFacesContext().getResponseComplete())

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13092451" author="markoc50" created="Sun, 28 Aug 2011 10:43:19 +0000"  >&lt;p&gt;That should work, because after phase events are delivered. It seems that this can solve this partikular problem for OWB 1.1.1.&lt;/p&gt;

&lt;p&gt;But I&apos;m not sure if there are any others conditions that can break JSF lifecycle (  for example bug in mojarra &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) causing immediate lifecycle exit and without afterPhase event delivery.&lt;/p&gt;

&lt;p&gt;And: is conversation scope JSF-only? CDI spec 6.7.4. Conversation context lifecycle &quot;Conversation scope is active during all standard lifecycle phases of any JSF faces OR NON-FACES REQUEST&quot;.&lt;/p&gt;
</comment>
                            <comment id="13092456" author="struberg" created="Sun, 28 Aug 2011 11:05:59 +0000"  >&lt;p&gt;oki, the &quot;or non-faces-request&quot; phrase is of course an argument &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13092475" author="struberg" created="Sun, 28 Aug 2011 12:41:43 +0000"  >&lt;p&gt;please note that currently the CDI-1.0 ConversationScope is indeed only bound to JSF requests!&lt;/p&gt;

&lt;p&gt;This will get fixed in CDI-1.1: &lt;a href=&quot;https://issues.jboss.org/browse/CDI-148&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.jboss.org/browse/CDI-148&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13092486" author="struberg" created="Sun, 28 Aug 2011 14:01:40 +0000"  >&lt;p&gt;Oki, I found the problem: it seems that FacesContext#getResponseComplete() returns false even if the underlying phase execution threw an Exception.&lt;/p&gt;

&lt;p&gt;I&apos;ll move all the conversation closing stuff to our WebContextsService.&lt;/p&gt;</comment>
                            <comment id="13092519" author="struberg" created="Sun, 28 Aug 2011 17:28:56 +0000"  >&lt;p&gt;fixed by closing/un-using the Conversation at the end of the Request if it exists&lt;/p&gt;</comment>
                            <comment id="13093614" author="struberg" created="Tue, 30 Aug 2011 09:27:59 +0000"  >&lt;p&gt;closing, as issues are fixed in OpenWebBeans-1.1.1&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63164</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i088dj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>45956</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>