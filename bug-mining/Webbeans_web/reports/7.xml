<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:15:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[OWB-369] Static ContextsService in ContextFactory causes wrong webContextService used for multiple applications</title>
                <link>https://issues.apache.org/jira/browse/OWB-369</link>
                <project id="12310844" key="OWB">OpenWebBeans</project>
                    <description>&lt;p&gt;To reproduce,&lt;/p&gt;

&lt;p&gt;Application A, which does not support conversation, installed and tested without any issue. then stop and uninstalled.&lt;br/&gt;
Application B, which support conversation, get installed and started.&lt;br/&gt;
When test Application B, ApplicationA&apos;s contextService is used and causes conversation scope is not found since it does not support conversation.&lt;br/&gt;
The problem is because of static variable used for contextsService in ContextFactory which is JVM-wide and only init once. While supportConversation flag is application-wide property.&lt;/p&gt;

&lt;p&gt;Probably we need contextService  variable to be  classloader based instead of static variable. or need some change to supportsConversation flag.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12463943">OWB-369</key>
            <summary>Static ContextsService in ContextFactory causes wrong webContextService used for multiple applications</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="struberg">Mark Struberg</assignee>
                                    <reporter username="yingwang">Ying Wang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 May 2010 03:03:24 +0000</created>
                <updated>Sat, 3 Jul 2010 08:43:00 +0000</updated>
                            <resolved>Sat, 3 Jul 2010 08:43:00 +0000</resolved>
                                    <version>M4</version>
                                    <fixVersion>1.0.0-alpha-1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12865039" author="gerdogdu" created="Fri, 7 May 2010 06:13:40 +0000"  >&lt;p&gt;ContextFactory must be loaded by web application class loader, i.e each application must own their own ContextFactory class, so there must not be any problem&lt;/p&gt;</comment>
                            <comment id="12865043" author="gerdogdu" created="Fri, 7 May 2010 06:16:39 +0000"  >&lt;p&gt;OpenWebBeans libraries must not be on the global class loaders (global class path), it has not written to work like this. Only spi and api modules could be on the global class path of the container.&lt;/p&gt;
</comment>
                            <comment id="12865138" author="bergmark" created="Fri, 7 May 2010 13:09:25 +0000"  >&lt;p&gt;Gurkan, I believe this comes down to another case of tiered classloading environments.&lt;/p&gt;

&lt;p&gt;Given the way that WebBeansFinder load the ContextService, you are going to have a unique instance of the ContextService per Web App (assuming each web app has a unique classloader).  However, I think the concern is the static variables are going to be shared across instances.  Similar to the problem we have had earlier with setting static variables to null leading to NPEs in other applications.&lt;/p&gt;

&lt;p&gt;In this case the ConversationManager is static and therefore shared between all instances of ContextService.  If there is any initialization done in that Manager that could be different for different apps then we likely have a problem.&lt;/p&gt;</comment>
                            <comment id="12865142" author="struberg" created="Fri, 7 May 2010 13:16:47 +0000"  >&lt;p&gt;Imo ConversationManager should also get refactored to be picked up with WebBeansFinder rather than using static methods on it.&lt;/p&gt;</comment>
                            <comment id="12865159" author="gerdogdu" created="Fri, 7 May 2010 14:01:15 +0000"  >&lt;p&gt;Joe,&lt;/p&gt;

&lt;p&gt;As I said OWB not written for tiered-class loaders. So all of the loaded classes must be loaded by each web application classloaders therefore does not collide with each other.&lt;/p&gt;

&lt;p&gt;For example: Each web application has its own webbeans-finder class and different ConversationManager.&lt;/p&gt;</comment>
                            <comment id="12865307" author="gerdogdu" created="Fri, 7 May 2010 21:00:56 +0000"  >&lt;p&gt;I have changed WebBeansFinder Map&amp;lt;String,Map&amp;lt;ClassLoader,Object&amp;gt;&amp;gt; to Map&amp;lt;ClassLoader,Map&amp;lt;String,Object&amp;gt;&amp;gt;. Also remove statics.&lt;/p&gt;</comment>
                            <comment id="12865993" author="yingwang" created="Tue, 11 May 2010 00:17:24 +0000"  >&lt;p&gt;Thanks Gurkan, Joe.  With Gurkan&apos;s recent changes, my second app still fails. How are we going to handle static ContextService in ContextFactory? I have uploaded this patch to replace it with local variables in the class. It might not be optimized, but requires minimum code changes. Please help review. Thanks in advance.&lt;/p&gt;</comment>
                            <comment id="12866201" author="gerdogdu" created="Tue, 11 May 2010 16:36:56 +0000"  >&lt;p&gt;Thanks YING, I did commit.&lt;/p&gt;</comment>
                            <comment id="12866953" author="yingwang" created="Thu, 13 May 2010 04:04:34 +0000"  >&lt;p&gt;Still randomly see different conversationManagers invoked for same session. Add 2 more changes.&lt;/p&gt;</comment>
                            <comment id="12884241" author="struberg" created="Thu, 1 Jul 2010 10:43:52 +0000"  >&lt;p&gt;Due to this change, the cost of getting the ContextsService each time is pretty high.&lt;br/&gt;
I will further improve this by maintaining a Map to cache the ContextsService depending on the ClassLoader which is being used.&lt;/p&gt;</comment>
                            <comment id="12884265" author="struberg" created="Thu, 1 Jul 2010 12:42:21 +0000"  >&lt;p&gt;hint from Gurkan; &lt;br/&gt;
&amp;gt; When the application is removed, you have to remove also from &lt;br/&gt;
&amp;gt; ContextFactory cache othewise create a leak&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12444165" name="ContextFactory.patch" size="4315" author="yingwang" created="Tue, 11 May 2010 00:17:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>162746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 21 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i086xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>45724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>