<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:54:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[EXEC-65] Watchdog can&apos;t destroy &apos;sudo&apos; and &apos;sleep&apos;</title>
                <link>https://issues.apache.org/jira/browse/EXEC-65</link>
                <project id="12310814" key="EXEC">Commons Exec</project>
                    <description>&lt;p&gt;I want to run a command from a shell script with make sure the process will be destroyed after a timeout, especially if it asks for user input or contains sleep commands.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DefaultExecutor executor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultExecutor();
executor.setStreamHandler(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PumpStreamHandler(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out, &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err));
ExecuteWatchdog watchDog = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecuteWatchdog(3000);
executor.setWatchdog(watchDog);
CommandLine command = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CommandLine(&lt;span class=&quot;code-quote&quot;&gt;&quot;./client.sh&quot;&lt;/span&gt;);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; exitValue = executor.execute(command);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(exitValue);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I run this code on the server like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java -cp .:commons-exec-1.1.jar App
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Problem 1.&lt;/b&gt; I want to run &lt;tt&gt;sudo&lt;/tt&gt; in order to execute a script as a different user:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;client.sh&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#!/bin/bash
sudo -u occ02 /apps/occ02/catalina_base/bin/restart-occ.sh
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In case of a misconfiguration of &lt;tt&gt;/etc/sudoers&lt;/tt&gt; this prompts me for a password.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Password:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And terminates only after about 5 minutes, not 3 seconds:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.commons.exec.ExecuteException: &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; exited with an error: 143 (Exit value: 143)
        at org.apache.commons.exec.DefaultExecutor.executeInternal(DefaultExecutor.java:377)
        at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:160)
        at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:147)
        at App.destroy2(App.java:51)
        at App.main(App.java:21)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Only if I use the &lt;tt&gt;sudo -S ...&lt;/tt&gt; the process is killed after about 4 seconds:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Password:
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.commons.exec.ExecuteException: &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; exited with an error: 1 (Exit value: 1)
        at org.apache.commons.exec.DefaultExecutor.executeInternal(DefaultExecutor.java:377)
        at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:160)
        at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:147)
        at App.destroy2(App.java:51)
        at App.main(App.java:21)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;Problem 2.&lt;/b&gt; I want to prevent a too long &lt;tt&gt;sleep&lt;/tt&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;client.sh&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;#!/bin/bash
sleep 900
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The Process just hangs! After 15 minutes the process terminates with this error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.commons.exec.ExecuteException: &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; exited with an error: 143 (Exit value: 143)
        at org.apache.commons.exec.DefaultExecutor.executeInternal(DefaultExecutor.java:377)
        at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:160)
        at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:147)
        at App.destroy2(App.java:51)
        at App.main(App.java:21)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I run the &lt;tt&gt;sleep&lt;/tt&gt; command directly from within Java without the shell-script, the process is destroyed on time:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;DefaultExecutor executor = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultExecutor();
executor.setStreamHandler(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PumpStreamHandler(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out, &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err));
ExecuteWatchdog watchDog = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ExecuteWatchdog(3000);
executor.setWatchdog(watchDog);
CommandLine command = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CommandLine(&lt;span class=&quot;code-quote&quot;&gt;&quot;sleep&quot;&lt;/span&gt;);
command.addArgument(&lt;span class=&quot;code-quote&quot;&gt;&quot;900&quot;&lt;/span&gt;);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; exitValue = executor.execute(command);
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(exitValue);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.commons.exec.ExecuteException: &lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; exited with an error: 143 (Exit value: 143)
        at org.apache.commons.exec.DefaultExecutor.executeInternal(DefaultExecutor.java:377)
        at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:160)
        at org.apache.commons.exec.DefaultExecutor.execute(DefaultExecutor.java:147)
        at App.destroy4(App.java:67)
        at App.main(App.java:23)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problems were not visible when I tested on my development machine with Windows 7 64bit and JDK 1.6.0_25, 64bit. But now these issues are a serious barrier for using commons-exec in production.&lt;/p&gt;

&lt;p&gt;Btw, with the &lt;tt&gt;ProcessBuilder&lt;/tt&gt; from the JDK the process is destroyed in both cases:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ProcessBuilder builder = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ProcessBuilder(&lt;span class=&quot;code-quote&quot;&gt;&quot;./client.sh&quot;&lt;/span&gt;);
&lt;span class=&quot;code-object&quot;&gt;Process&lt;/span&gt; process = builder.start();
&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(3000);
process.destroy();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Best regards,&lt;br/&gt;
Rusi&lt;/p&gt;</description>
                <environment>&lt;p&gt;RedHat Enterprise Linux 64bit, JDK 1.6.0_25 64bit.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ uname -a
Linux demo-vrs1-happdb1.lts.stgt.vrs.cust.disy.net 2.6.9-42.ELsmp #1 SMP Wed Jul 12 23:27:17 EDT 2006 i686 i686 i386 GNU/Linux
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ java -version
java version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.6.0_25&quot;&lt;/span&gt;
Java(TM) SE &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment (build 1.6.0_25-b06)
Java HotSpot(TM) Server VM (build 20.0-b11, mixed mode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</environment>
        <key id="12548024">EXEC-65</key>
            <summary>Watchdog can&apos;t destroy &apos;sudo&apos; and &apos;sleep&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="sgoeschl">Siegfried Goeschl</assignee>
                                    <reporter username="rfilipov">Rusi Filipov</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Mar 2012 18:28:56 +0000</created>
                <updated>Tue, 29 May 2018 12:58:34 +0000</updated>
                                            <version>1.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15081389" author="sgoeschl" created="Mon, 4 Jan 2016 17:11:07 +0000"  >&lt;p&gt;Wrote a few tests but I&apos;m unable to reproduce the problem &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15085379" author="sgoeschl" created="Wed, 6 Jan 2016 10:31:05 +0000"  >&lt;p&gt;The joy of different OS - works nicely on Mac OS X but fails on Ubuntu&lt;/p&gt;</comment>
                            <comment id="16387560" author="owaeld" created="Tue, 6 Mar 2018 10:08:16 +0000"  >&lt;p&gt;I experienced same problem on Ubuntu. However, it seems that using a noop ExecuteStreamHandler at least allows one to terminate the process. In my case, it took about 45 seconds until the process was terminated. When using the PumpStreamHandler, the process was not terminated at all.&lt;/p&gt;

&lt;p&gt;The underlying problems seems to be the StreamPumper, which continously reads from process stdout, without checking if bytes are available. This seems to prevent termination of the process, which in turn might also be a bug in the jdk. However, to fix this issue, StreamPumper should check if bytes are available before reading.&lt;/p&gt;</comment>
                            <comment id="16493300" author="ghilainm@gmail.com" created="Tue, 29 May 2018 09:35:17 +0000"  >&lt;p&gt;Same problem here.&#160;Do you have any idea on how to fix such issue?&lt;br/&gt;
&lt;b&gt;Version&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;dependency&amp;gt;&lt;br/&gt;
 &amp;lt;groupId&amp;gt;org.zeroturnaround&amp;lt;/groupId&amp;gt;&lt;br/&gt;
 &amp;lt;artifactId&amp;gt;zt-exec&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
 &amp;lt;version&amp;gt;1.10&amp;lt;/version&amp;gt;&lt;br/&gt;
 &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;&lt;br/&gt;
&amp;lt;/dependency&amp;gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16493331" author="owaeld" created="Tue, 29 May 2018 10:15:00 +0000"  >&lt;p&gt;Further investigation has shown, that the following approaches can be treated as stable:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Run the target executable with s-bit set&lt;/li&gt;
	&lt;li&gt;Run the java program with root user (don&#8217;t use sudo)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In both approaches the executable can be terminated in a stable way. Using sudo execution doesn&#8217;t always produce expected results (depending on the executable the processes keep running).&lt;/p&gt;</comment>
                            <comment id="16493506" author="ghilainm@gmail.com" created="Tue, 29 May 2018 12:58:34 +0000"  >&lt;p&gt;I am not executing with sudo neither root user.&lt;/p&gt;

&lt;p&gt;I am just running a script which does: sleep 10d.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12780347" name="EXEC_65.patch" size="7382" author="sgoeschl" created="Mon, 4 Jan 2016 17:11:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233121</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i19xzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>266139</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>