<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:54:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[EXEC-33] PumpStreamHandler hangs if System.in is redirect to process input stream</title>
                <link>https://issues.apache.org/jira/browse/EXEC-33</link>
                <project id="12310814" key="EXEC">Commons Exec</project>
                    <description>&lt;p&gt;When process input is redirected using a PumpStreamHandler, e.g.&lt;/p&gt;


&lt;p&gt;      PumpStreamHandler streamHanlder = new PumpStreamHandler(out, err, System.in); &lt;br/&gt;
      exec.setStreamHandler(streamHanlder);&lt;br/&gt;
      MockExecuteResultHandler handler = new MockExecuteResultHandler();&lt;br/&gt;
      exec.execute(cl, handler);&lt;/p&gt;

&lt;p&gt;the process hangs and never exit.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows Vista&lt;/p&gt;</environment>
        <key id="12411528">EXEC-33</key>
            <summary>PumpStreamHandler hangs if System.in is redirect to process input stream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sgoeschl">Siegfried Goeschl</assignee>
                                    <reporter username="mferrante">Marco Ferrante</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Dec 2008 14:16:03 +0000</created>
                <updated>Sun, 24 Oct 2010 19:58:33 +0000</updated>
                            <resolved>Mon, 28 Sep 2009 20:58:58 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.0.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="12663498" author="sgoeschl" created="Tue, 13 Jan 2009 22:17:25 +0000"  >&lt;p&gt;Confirmed so far ...&lt;/p&gt;

&lt;p&gt;+) the following test script hangs&lt;br/&gt;
+) one worker thread stll hang in  StreamPumper.java&lt;br/&gt;
+) Having said this I have a working test case for redirecting a FileInputStream instead of System.in so I&apos;m a bit pussled&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
    /**
     * Start a process and connect stdin, stdout and stderr. This 
     * test currenty hang ....
     */
    public void testExecuteWithStdin() throws Exception
    {
        CommandLine cl = new CommandLine(testScript);
        PumpStreamHandler pumpStreamHandler = new PumpStreamHandler( System.out, System.err, System.in );
        DefaultExecutor executor = new DefaultExecutor();
        executor.setStreamHandler( pumpStreamHandler );
        int exitValue = executor.execute(cl);
        assertFalse(exec.isFailure(exitValue));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="12663915" author="bentmann" created="Wed, 14 Jan 2009 22:42:44 +0000"  >&lt;p&gt;The problematic code can be reduced to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;InputStream is = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.in;
OutputStream os = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out;

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[4096];
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length;
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((length = is.read(buf)) &amp;gt; 0) {
    os.write(buf, 0, length);
}
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;DONE&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;i.e. this hangs, too. It appears that&apos;s a basic Java issue, cf. Sun bugs &lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4514257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#4514257&lt;/a&gt;, &lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4385444&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;#4385444&lt;/a&gt; and related. Basically &lt;tt&gt;System.in&lt;/tt&gt; is an open but empty stream, so the call &lt;tt&gt;InputStream.read()&lt;/tt&gt; will block infinitely. As the mentioned Sun issues point out, &lt;tt&gt;Thread.interrupt()&lt;/tt&gt; doesn&apos;t help either once the blocking call to &lt;tt&gt;read()&lt;/tt&gt; has been made.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;InputStream.available()&lt;/tt&gt; seems the only non-blocking way to detect the empty state of the stream but unfortunately it doesn&apos;t detect whether the stream is closed.&lt;/p&gt;

&lt;p&gt;Maybe one needs a special &lt;tt&gt;StreamPumper&lt;/tt&gt; (e.g. subclass) for the &lt;tt&gt;inputThread&lt;/tt&gt; that pumps the streams via polling, i.e. &lt;tt&gt;available()&lt;/tt&gt; + &lt;tt&gt;read()&lt;/tt&gt; + &lt;tt&gt;Thread.sleep()&lt;/tt&gt;, and gets terminated when interrupted from outside, i.e. by &lt;tt&gt;PumpStreamHandler.stop()&lt;/tt&gt;, instead of stream closing. When the subprocess has exited, there is no need to pump further input into it, so terminating the &lt;tt&gt;inputThread&lt;/tt&gt; in &lt;tt&gt;PumpStreamHandler.stop()&lt;/tt&gt; without consuming all of the input shouldn&apos;t be a problem. Surely, beauty is something else.&lt;/p&gt;</comment>
                            <comment id="12664028" author="joehni" created="Thu, 15 Jan 2009 07:43:44 +0000"  >&lt;blockquote&gt;
&lt;p&gt;As the mentioned Sun issues point out, Thread.interrupt() doesn&apos;t help either once the blocking call to read() has been made.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is actually not completely true. It depends on the implementation of the JVM and the underlaying platform. On Solaris read() will be interrupted and throwing an InterruptedIOException. So be prepared to deal with both situations.&lt;/p&gt;</comment>
                            <comment id="12664043" author="bentmann" created="Thu, 15 Jan 2009 08:38:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;It depends on the implementation of the JVM and the underlaying platform. On Solaris read() will be interrupted &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Correct, additionally depends on the JVM flags passed in (UseVMInterruptibleIO).&lt;/p&gt;

&lt;p&gt;My intention was merely to point out that we have no reliable/general/platform-independent way of interrupting &lt;tt&gt;read()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="12664061" author="sgoeschl" created="Thu, 15 Jan 2009 09:40:39 +0000"  >&lt;p&gt;I think the checking System.in might solve the problem since it would be a bug to close stdin anyway - so having a smarter StreamPumper might be worth the effort. Many thanks for Benjamin and Joerg for helping me on this issue .....&lt;/p&gt;</comment>
                            <comment id="12664261" author="mferrante" created="Thu, 15 Jan 2009 20:55:14 +0000"  >&lt;p&gt;If I understand your suggestion correctly, this patch should be enough to work around the problem; at least, it passes the test case.&lt;/p&gt;</comment>
                            <comment id="12664498" author="sgoeschl" created="Fri, 16 Jan 2009 11:37:35 +0000"  >&lt;p&gt;Well, you are dodging the bullet - the question is can you do something meaningful with the redirected System.in in your application?&lt;/p&gt;</comment>
                            <comment id="12674395" author="sgoeschl" created="Tue, 17 Feb 2009 23:35:05 +0000"  >&lt;p&gt;Fixing this correctly on all platforms does not look easy so I will look at it after the first release.&lt;/p&gt;</comment>
                            <comment id="12674398" author="sgoeschl" created="Tue, 17 Feb 2009 23:46:05 +0000"  >&lt;p&gt;Throwing an IllegalArgumentException when System.in is used to notify the user ....&lt;/p&gt;</comment>
                            <comment id="12698695" author="mkleint" created="Tue, 14 Apr 2009 08:06:48 +0000"  >&lt;p&gt;attached is a suggested patch that was tested with a modified exec-maven-plugin (modified to use commons-exec instead of plexus-utils for execution)&lt;/p&gt;
</comment>
                            <comment id="12698833" author="bentmann" created="Tue, 14 Apr 2009 17:04:59 +0000"  >&lt;p&gt;Milos, shouldn&apos;t the inner &lt;tt&gt;while&lt;/tt&gt; loop of &lt;tt&gt;InputStreamPumper.run()} also check the {{stop&lt;/tt&gt; flag to make sure processing stops when requested and not when the input is exhausted?&lt;/p&gt;</comment>
                            <comment id="12699060" author="mkleint" created="Wed, 15 Apr 2009 05:21:50 +0000"  >&lt;p&gt;Benjamin, that would be an improvement for sure. Typically you wouldn&apos;t type as fast as 10 characters per second, but you can surely copy&amp;amp;paste a large amount of text and then it would be more than useful to the the inner loop to stop as well.&lt;/p&gt;</comment>
                            <comment id="12700560" author="sgoeschl" created="Sun, 19 Apr 2009 07:48:39 +0000"  >&lt;p&gt;Milos, I&apos;m completely busy the next few days so it looks like next weekend for the patch .... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12704816" author="sgoeschl" created="Thu, 30 Apr 2009 22:21:55 +0000"  >&lt;p&gt;Milos, I applied the patch - can you make a quick retest so I can plan a release ... &lt;/p&gt;</comment>
                            <comment id="12706413" author="mkleint" created="Wed, 6 May 2009 13:09:16 +0000"  >&lt;p&gt;yes, it works.&lt;br/&gt;
I have updated svn, rebuilt commons-exec. Used the snapshot in exec-mojo-plugin (wit simplified patch from &lt;a href=&quot;http://jira.codehaus.org/browse/MEXEC-25&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/MEXEC-25&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;used that exec plugin in netbeans for an app that processes output. Seems to work as expected.&lt;/p&gt;
</comment>
                            <comment id="12717601" author="mkleint" created="Tue, 9 Jun 2009 08:15:41 +0000"  >&lt;p&gt;is the new release still in the pipeline?&lt;/p&gt;</comment>
                            <comment id="12717610" author="sgoeschl" created="Tue, 9 Jun 2009 08:33:52 +0000"  >&lt;p&gt;Yes - I was sucked up in a customer project for the last two months but workload becomes normal. So I will cut an RC next week&lt;/p&gt;</comment>
                            <comment id="12728561" author="mkleint" created="Wed, 8 Jul 2009 08:35:17 +0000"  >&lt;p&gt;ping? &lt;/p&gt;

&lt;p&gt;I need the commons-exec released to have exec-maven-plugin released to be included in the next netbeans release. Quite a long chain, that&apos;s why I keep on pushing..&lt;/p&gt;</comment>
                            <comment id="12730914" author="sgoeschl" created="Tue, 14 Jul 2009 15:18:07 +0000"  >&lt;p&gt;I&apos;m starting to cut an RC for commons-exec-1.0.1 ...&lt;/p&gt;</comment>
                            <comment id="12742801" author="mkleint" created="Thu, 13 Aug 2009 11:25:56 +0000"  >&lt;p&gt;any updates?&lt;/p&gt;

&lt;p&gt;The bug is still open, does it mean the patch hasn&apos;t been applied yet?&lt;/p&gt;</comment>
                            <comment id="12756404" author="aheritier" created="Thu, 17 Sep 2009 07:51:24 +0000"  >&lt;p&gt;Hi, do you know when you&apos;ll fix this issue and when you&apos;l release the 1.0.1 ?&lt;br/&gt;
It&apos;s really annoying to not being able to fix the issue we have in the Exec Mojo.&lt;br/&gt;
If it&apos;s too long, we&apos;ll have to see if we can use another library or if we fork yours.&lt;/p&gt;</comment>
                            <comment id="12758458" author="sgoeschl" created="Tue, 22 Sep 2009 21:48:29 +0000"  >&lt;p&gt;The patch is long applied but my release candidate got stuck due to M2 and SVN problems many moons ago ... I give it another go now&lt;/p&gt;</comment>
                            <comment id="12758629" author="aheritier" created="Wed, 23 Sep 2009 08:06:10 +0000"  >&lt;p&gt;ok, let us know if we can help you.&lt;/p&gt;</comment>
                            <comment id="12760195" author="henrib" created="Mon, 28 Sep 2009 09:14:38 +0000"  >&lt;p&gt;Btw, the same pb occured on Mac OSX with unit tests hanging, even with the fix.&lt;/p&gt;

&lt;p&gt;Committed a modification:&lt;br/&gt;
URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=818863&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=818863&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log: &lt;br/&gt;
On a Mac, the unit tests never finish. Culprit is InputStreamPumper which sets its stop member in the run method; however, run might really be executed after the stopProcessing method is called if the process thread completes before the InputStreamPumper starts. &lt;/p&gt;

&lt;p&gt;Modified: &lt;br/&gt;
    commons/proper/exec/trunk/src/main/java/org/apache/commons/exec/InputStreamPumper.java &lt;/p&gt;</comment>
                            <comment id="12760380" author="sgoeschl" created="Mon, 28 Sep 2009 20:58:57 +0000"  >&lt;p&gt;Added a line in changes.xml to document the modification&lt;/p&gt;</comment>
                            <comment id="12760398" author="sgoeschl" created="Mon, 28 Sep 2009 21:41:58 +0000"  >&lt;p&gt;Hi Arnaud and Milos,&lt;/p&gt;

&lt;p&gt;I&apos;m simply unable to bring the RC out of the door - I have now SSH issues after solving my SVN problems. Either you have some more patience while I&apos;m sorting out the infrastructure or you make a private fork&lt;/p&gt;

&lt;p&gt;Sorry for the inconvinience&lt;/p&gt;</comment>
                            <comment id="12760399" author="aheritier" created="Mon, 28 Sep 2009 21:47:18 +0000"  >&lt;p&gt;I prefer to wait some days/weeks before to create a private fork. Thx for your help. I hope your ssh issue will be fixed soon.&lt;/p&gt;</comment>
                            <comment id="12762087" author="brettporter" created="Mon, 5 Oct 2009 04:56:22 +0000"  >&lt;p&gt;Siegfried - did you sort them out? I think Phil&apos;s comment on commons-dev will help - if there&apos;s anything you need then please let me know.&lt;/p&gt;</comment>
                            <comment id="12762873" author="sgoeschl" created="Wed, 7 Oct 2009 05:22:22 +0000"  >&lt;p&gt;One more task for late night action hero - upgrade to Maven 2.2.1 to get the release candidate going ... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12405400" name="EXEC33.patch" size="4960" author="mkleint" created="Tue, 14 Apr 2009 08:06:47 +0000"/>
                            <attachment id="12398009" name="PumpStreamHandler.patch" size="609" author="mferrante" created="Thu, 15 Jan 2009 20:55:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>117737</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 7 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tp2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>171370</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>