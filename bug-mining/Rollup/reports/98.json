{"url":"https://api.github.com/repos/rollup/rollup/issues/1462","repository_url":"https://api.github.com/repos/rollup/rollup","labels_url":"https://api.github.com/repos/rollup/rollup/issues/1462/labels{/name}","comments_url":"https://api.github.com/repos/rollup/rollup/issues/1462/comments","events_url":"https://api.github.com/repos/rollup/rollup/issues/1462/events","html_url":"https://github.com/rollup/rollup/issues/1462","id":237622007,"node_id":"MDU6SXNzdWUyMzc2MjIwMDc=","number":1462,"title":"bug: `catch (symbol)` changed","user":{"login":"kzc","id":11593452,"node_id":"MDQ6VXNlcjExNTkzNDUy","avatar_url":"https://avatars.githubusercontent.com/u/11593452?v=4","gravatar_id":"","url":"https://api.github.com/users/kzc","html_url":"https://github.com/kzc","followers_url":"https://api.github.com/users/kzc/followers","following_url":"https://api.github.com/users/kzc/following{/other_user}","gists_url":"https://api.github.com/users/kzc/gists{/gist_id}","starred_url":"https://api.github.com/users/kzc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzc/subscriptions","organizations_url":"https://api.github.com/users/kzc/orgs","repos_url":"https://api.github.com/users/kzc/repos","events_url":"https://api.github.com/users/kzc/events{/privacy}","received_events_url":"https://api.github.com/users/kzc/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":211689302,"node_id":"MDU6TGFiZWwyMTE2ODkzMDI=","url":"https://api.github.com/repos/rollup/rollup/labels/t%C2%B9%20%F0%9F%90%9E%20bug","name":"t¬π üêû bug","color":"F44336","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-06-21T18:19:24Z","updated_at":"2017-07-10T01:31:56Z","closed_at":"2017-07-10T01:31:48Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"While using Rollup's sources as a test case for `uglify-es` I stumbled across a Rollup `catch` symbol replacement bug. I was unable to make a simple standalone test case, but if you apply the following patch to Rollup's source tree itself then the bug can easily be reproduced with `npm test`:\r\n```patch\r\n--- a/rollup.config.js\r\n+++ b/rollup.config.js\r\n@@ -24,7 +24,7 @@ export default {\r\n                buble({\r\n                        include: [ 'src/**', 'node_modules/acorn/**' ],\r\n                        target: {\r\n-                               node: '0.12'\r\n+                               node: 6\r\n                        }\r\n                }),\r\n \r\ndiff --git a/src/utils/fs.js b/src/utils/fs.js\r\nindex db790a9..b2230da 100644\r\n--- a/src/utils/fs.js\r\n+++ b/src/utils/fs.js\r\n@@ -1,13 +1,13 @@\r\n import * as fs from 'fs';\r\n-import { dirname } from './path.js';\r\n+import { dirname as i } from './path.js';\r\n \r\n export * from 'fs';\r\n \r\n function mkdirpath ( path ) {\r\n-       const dir = dirname( path );\r\n+       const dir = i( path );\r\n        try {\r\n                fs.readdirSync( dir );\r\n-       } catch ( err ) {\r\n+       } catch ( i ) {\r\n                mkdirpath( dir );\r\n                fs.mkdirSync( dir );\r\n        }\r\n```\r\n```\r\n$ npm test\r\n...\r\nError compiling dist/rollup.js:\r\n---\r\n89 : function mkdirpath ( path$$1 ) {\r\n90 :   const dir = path.dirname( path$$1 );\r\n91 :   try {\r\n92 :     fs.readdirSync( dir );\r\n93 :   } catch ( path.dirname ) {\r\n                     ^\r\nUnexpected token (93:15)\r\n```\r\nThe `catch` symbol should never be replaced as it is essentially a scoped variable declaration in the `catch` block.\r\n\r\nNote: a yet to be released fix for `acorn` may have to be applied prior to running `npm test` due to an ES6 bug: https://github.com/ternjs/acorn/issues/561","closed_by":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/1462/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rollup/rollup/issues/1462/timeline","performed_via_github_app":null,"state_reason":"completed"}