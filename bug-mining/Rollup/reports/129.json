{"url":"https://api.github.com/repos/rollup/rollup/issues/2005","repository_url":"https://api.github.com/repos/rollup/rollup","labels_url":"https://api.github.com/repos/rollup/rollup/issues/2005/labels{/name}","comments_url":"https://api.github.com/repos/rollup/rollup/issues/2005/comments","events_url":"https://api.github.com/repos/rollup/rollup/issues/2005/events","html_url":"https://github.com/rollup/rollup/issues/2005","id":299205428,"node_id":"MDU6SXNzdWUyOTkyMDU0Mjg=","number":2005,"title":"specifying `dest` triggers error in `output.format` even if it is specified","user":{"login":"SheetJSDev","id":6070939,"node_id":"MDQ6VXNlcjYwNzA5Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/6070939?v=4","gravatar_id":"","url":"https://api.github.com/users/SheetJSDev","html_url":"https://github.com/SheetJSDev","followers_url":"https://api.github.com/users/SheetJSDev/followers","following_url":"https://api.github.com/users/SheetJSDev/following{/other_user}","gists_url":"https://api.github.com/users/SheetJSDev/gists{/gist_id}","starred_url":"https://api.github.com/users/SheetJSDev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SheetJSDev/subscriptions","organizations_url":"https://api.github.com/users/SheetJSDev/orgs","repos_url":"https://api.github.com/users/SheetJSDev/repos","events_url":"https://api.github.com/users/SheetJSDev/events{/privacy}","received_events_url":"https://api.github.com/users/SheetJSDev/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":211689302,"node_id":"MDU6TGFiZWwyMTE2ODkzMDI=","url":"https://api.github.com/repos/rollup/rollup/labels/t%C2%B9%20%F0%9F%90%9E%20bug","name":"t¬π üêû bug","color":"F44336","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2018-02-22T02:57:31Z","updated_at":"2018-03-24T21:51:22Z","closed_at":"2018-03-24T21:51:22Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"version rollup@0.56.2.  Trying to migrate from the old to the new options style by adding both set of options:\r\n\r\n```js\r\nimport resolve from 'rollup-plugin-node-resolve';\r\nimport commonjs from 'rollup-plugin-commonjs';\r\nexport default {\r\n\tinput: 'main.js',\r\n\toutput: {\r\n\t\tfile: 'rollup.node.js',\r\n\t\tformat: 'cjs'\r\n\t},\r\n\tentry: 'main.js',\r\n\tdest: 'rollup.node.js', // <-- build fails if this line is uncommented, succeeds if line is commented\r\n\tplugins: [\r\n\t\tresolve({\r\n\t\t\tmodule: false,\r\n\t\t\tbrowser: true,\r\n\t\t}),\r\n\t\tcommonjs()\r\n\t],\r\n\tformat: 'cjs'\r\n};\r\n```\r\n\r\nThis triggers the error:\r\n\r\n```\r\n[!] Error: You must specify options.format, which can be one of 'amd', 'cjs', 'system', 'es', 'iife' or 'umd'\r\n```\r\n\r\nCommenting out the marked line seems to work.\r\n\r\n<details><summary>Repro (click to show)</summary>\r\n\r\n**package.json:**\r\n\r\n```js\r\n{\r\n\t\"dependencies\": {\r\n\t\t\"rollup-plugin-node-resolve\":\"\",\r\n\t\t\"rollup\": \"\",\r\n\t\t\"rollup-plugin-commonjs\": \"\",\r\n\t\t\"xlsx\": \"\"\r\n\t},\r\n\t\"scripts\": {\r\n\t\t\"good\": \"rollup -c rollup.config.good.js\",\r\n\t\t\"bad\": \"rollup -c rollup.config.bad.js\"\r\n\t}\r\n}\r\n```\r\n\r\n**main.js**\r\n\r\n```js\r\nimport XLSX from 'xlsx';\r\nexport default XLSX;\r\n```\r\n\r\n**rollup.config.bad.js**\r\n\r\n```js\r\nimport resolve from 'rollup-plugin-node-resolve';\r\nimport commonjs from 'rollup-plugin-commonjs';\r\nexport default {\r\n\tinput: 'main.js',\r\n\toutput: {\r\n\t\tfile: 'rollup.node.js',\r\n\t\tformat: 'cjs'\r\n\t},\r\n\tentry: 'main.js',\r\n\tdest: 'rollup.node.js',\r\n\tplugins: [\r\n\t\tresolve({\r\n\t\t\tmodule: false,\r\n\t\t\tbrowser: true,\r\n\t\t}),\r\n\t\tcommonjs()\r\n\t],\r\n\tformat: 'cjs'\r\n};\r\n```\r\n\r\n**rollup.config.good.js**\r\n\r\n```js\r\nimport resolve from 'rollup-plugin-node-resolve';\r\nimport commonjs from 'rollup-plugin-commonjs';\r\nexport default {\r\n\tinput: 'main.js',\r\n\toutput: {\r\n\t\tfile: 'rollup.node.js',\r\n\t\tformat: 'cjs'\r\n\t},\r\n\tentry: 'main.js',\r\n\t//dest: 'rollup.node.js',\r\n\tplugins: [\r\n\t\tresolve({\r\n\t\t\tmodule: false,\r\n\t\t\tbrowser: true,\r\n\t\t}),\r\n\t\tcommonjs()\r\n\t],\r\n\tformat: 'cjs'\r\n};\r\n```\r\n\r\nTest:\r\n\r\n```\r\n$ npm install\r\n$ npm run good\r\n\r\n> @ good /private/tmp\r\n> rollup -c rollup.config.good.js\r\n\r\n(!) Some options have been renamed\r\nhttps://gist.github.com/Rich-Harris/d472c50732dab03efeb37472b08a3f32\r\nformat is now output.format\r\n\r\nmain.js ‚Üí rollup.node.js...\r\ncreated rollup.node.js in 3.4s\r\n\r\n$ npm run bad\r\n\r\n> @ bad /private/tmp\r\n> rollup -c rollup.config.bad.js\r\n\r\n(!) Some options have been renamed\r\nhttps://gist.github.com/Rich-Harris/d472c50732dab03efeb37472b08a3f32\r\nformat is now output.format\r\ndest is now output.file\r\n\r\nmain.js ‚Üí rollup.node.js...\r\n[!] Error: You must specify options.format, which can be one of 'amd', 'cjs', 'system', 'es', 'iife' or 'umd'\r\n\r\n```\r\n\r\n</details>","closed_by":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/2005/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rollup/rollup/issues/2005/timeline","performed_via_github_app":null,"state_reason":"completed"}