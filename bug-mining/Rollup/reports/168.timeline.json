[{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/788107185","html_url":"https://github.com/rollup/rollup/issues/3979#issuecomment-788107185","issue_url":"https://api.github.com/repos/rollup/rollup/issues/3979","id":788107185,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODEwNzE4NQ==","user":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-01T16:59:07Z","updated_at":"2021-03-01T16:59:07Z","body":"Good catch. As we are actually adding this information as non-standard properties to the AST nodes, we should actually be able to do this in `this.parse` as well. Hope to find some time soon to look into this.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/788107185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/788124136","html_url":"https://github.com/rollup/rollup/issues/3979#issuecomment-788124136","issue_url":"https://api.github.com/repos/rollup/rollup/issues/3979","id":788124136,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODEyNDEzNg==","user":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-01T17:22:01Z","updated_at":"2021-03-01T17:22:01Z","body":"I started working on it, hope to submit a PR soon","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/788124136/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4396548249,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQzOTY1NDgyNDk=","url":"https://api.github.com/repos/rollup/rollup/issues/events/4396548249","actor":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b899701612983adb629f24a088f4d8108cef616c","commit_url":"https://api.github.com/repos/yannayl/rollup/commits/b899701612983adb629f24a088f4d8108cef616c","created_at":"2021-03-02T15:35:33Z","performed_via_github_app":null},{"actor":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T15:37:42Z","updated_at":"2021-03-02T15:37:42Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rollup/rollup/issues/3981","repository_url":"https://api.github.com/repos/rollup/rollup","labels_url":"https://api.github.com/repos/rollup/rollup/issues/3981/labels{/name}","comments_url":"https://api.github.com/repos/rollup/rollup/issues/3981/comments","events_url":"https://api.github.com/repos/rollup/rollup/issues/3981/events","html_url":"https://github.com/rollup/rollup/pull/3981","id":820133953,"node_id":"MDExOlB1bGxSZXF1ZXN0NTgzMTI4OTky","number":3981,"title":"Move pure comment annotation to Graph.contextParse","user":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2021-03-02T15:37:42Z","updated_at":"2021-03-09T11:26:11Z","closed_at":"2021-03-09T06:14:24Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":35640229,"node_id":"MDEwOlJlcG9zaXRvcnkzNTY0MDIyOQ==","name":"rollup","full_name":"rollup/rollup","private":false,"owner":{"login":"rollup","id":12554859,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEyNTU0ODU5","avatar_url":"https://avatars.githubusercontent.com/u/12554859?v=4","gravatar_id":"","url":"https://api.github.com/users/rollup","html_url":"https://github.com/rollup","followers_url":"https://api.github.com/users/rollup/followers","following_url":"https://api.github.com/users/rollup/following{/other_user}","gists_url":"https://api.github.com/users/rollup/gists{/gist_id}","starred_url":"https://api.github.com/users/rollup/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rollup/subscriptions","organizations_url":"https://api.github.com/users/rollup/orgs","repos_url":"https://api.github.com/users/rollup/repos","events_url":"https://api.github.com/users/rollup/events{/privacy}","received_events_url":"https://api.github.com/users/rollup/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rollup/rollup","description":"Next-generation ES module bundler","fork":false,"url":"https://api.github.com/repos/rollup/rollup","forks_url":"https://api.github.com/repos/rollup/rollup/forks","keys_url":"https://api.github.com/repos/rollup/rollup/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rollup/rollup/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rollup/rollup/teams","hooks_url":"https://api.github.com/repos/rollup/rollup/hooks","issue_events_url":"https://api.github.com/repos/rollup/rollup/issues/events{/number}","events_url":"https://api.github.com/repos/rollup/rollup/events","assignees_url":"https://api.github.com/repos/rollup/rollup/assignees{/user}","branches_url":"https://api.github.com/repos/rollup/rollup/branches{/branch}","tags_url":"https://api.github.com/repos/rollup/rollup/tags","blobs_url":"https://api.github.com/repos/rollup/rollup/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rollup/rollup/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rollup/rollup/git/refs{/sha}","trees_url":"https://api.github.com/repos/rollup/rollup/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rollup/rollup/statuses/{sha}","languages_url":"https://api.github.com/repos/rollup/rollup/languages","stargazers_url":"https://api.github.com/repos/rollup/rollup/stargazers","contributors_url":"https://api.github.com/repos/rollup/rollup/contributors","subscribers_url":"https://api.github.com/repos/rollup/rollup/subscribers","subscription_url":"https://api.github.com/repos/rollup/rollup/subscription","commits_url":"https://api.github.com/repos/rollup/rollup/commits{/sha}","git_commits_url":"https://api.github.com/repos/rollup/rollup/git/commits{/sha}","comments_url":"https://api.github.com/repos/rollup/rollup/comments{/number}","issue_comment_url":"https://api.github.com/repos/rollup/rollup/issues/comments{/number}","contents_url":"https://api.github.com/repos/rollup/rollup/contents/{+path}","compare_url":"https://api.github.com/repos/rollup/rollup/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rollup/rollup/merges","archive_url":"https://api.github.com/repos/rollup/rollup/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rollup/rollup/downloads","issues_url":"https://api.github.com/repos/rollup/rollup/issues{/number}","pulls_url":"https://api.github.com/repos/rollup/rollup/pulls{/number}","milestones_url":"https://api.github.com/repos/rollup/rollup/milestones{/number}","notifications_url":"https://api.github.com/repos/rollup/rollup/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rollup/rollup/labels{/name}","releases_url":"https://api.github.com/repos/rollup/rollup/releases{/id}","deployments_url":"https://api.github.com/repos/rollup/rollup/deployments","created_at":"2015-05-14T22:26:28Z","updated_at":"2025-11-09T07:58:19Z","pushed_at":"2025-11-08T17:11:17Z","git_url":"git://github.com/rollup/rollup.git","ssh_url":"git@github.com:rollup/rollup.git","clone_url":"https://github.com/rollup/rollup.git","svn_url":"https://github.com/rollup/rollup","homepage":"https://rollupjs.org","size":32539,"stargazers_count":26104,"watchers_count":26104,"language":"JavaScript","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1649,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":602,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":1649,"open_issues":602,"watchers":26104,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/rollup/rollup/pulls/3981","html_url":"https://github.com/rollup/rollup/pull/3981","diff_url":"https://github.com/rollup/rollup/pull/3981.diff","patch_url":"https://github.com/rollup/rollup/pull/3981.patch","merged_at":"2021-03-09T06:14:23Z"},"body":"If a plugin calls `PluginContext.parse` method to parse the AST of the module\r\nrollup ignored the `PURE` annotations. This commit fixes the issue by moving\r\nthe annotation functionality to a central location - the `contextParse` method.\r\n\r\nResolves #3979\r\n\r\n<!--\r\n  âš¡ï¸ katchow! We â¤ï¸ Pull Requests!\r\n\r\n  If you remove or skip this template, you'll make the ðŸ¼ sad and the mighty god\r\n  of Github will appear and pile-drive the close button from a great height\r\n  while making animal noises.\r\n\r\n  Pull Request Requirements:\r\n  * Please include tests to illustrate the problem this PR resolves.\r\n  * Please lint your changes by running `npm run lint` before creating a PR.\r\n  * Please update the documentation in `/docs` where necessary\r\n\r\n  Please place an x (no spaces - [x]) in all [ ] that apply.\r\n-->\r\n\r\nThis PR contains:\r\n- [x] bugfix\r\n- [ ] feature\r\n- [ ] refactor\r\n- [ ] documentation\r\n- [ ] other\r\n\r\nAre tests included?\r\n- [x] yes (*bugfixes and features will not be merged without tests*)\r\n- [ ] no\r\n\r\nBreaking Changes?\r\n- [ ] yes (*breaking changes will not be merged unless absolutely necessary*)\r\n- [x] no\r\n\r\nList any relevant issue numbers:\r\n\r\nResolve #3979 \r\n\r\n### Description\r\n\r\nMove pure comment annotation to Graph.contextParse\r\n\r\nIf a plugin calls `PluginContext.parse` method to parse the AST of the module\r\nrollup ignored the `PURE` annotations. This commit fixes the issue by moving\r\nthe annotation functionality to a central location - the `contextParse` method.\r\n\r\n<!--\r\n  Please be thorough and clearly explain the problem being solved.\r\n  * If this PR adds a feature, look for previous discussion on the feature by searching the issues first.\r\n  * Is this PR related to an issue?\r\n-->\r\n","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/3981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rollup/rollup/issues/3981/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789000928","html_url":"https://github.com/rollup/rollup/issues/3979#issuecomment-789000928","issue_url":"https://api.github.com/repos/rollup/rollup/issues/3979","id":789000928,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTAwMDkyOA==","user":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T15:40:59Z","updated_at":"2021-03-02T16:02:34Z","body":"I have submitted a PR, ~~currently without tests~~ with tests. However, I think the fix is incomplete.\r\n\r\n(1) There is a second problem related to the same root cause - the removal of sourceMapping comment is also done only in `Module.setSource` if the ast is not provided. Should we open a different issue for this? I am not sure how to solve it.\r\n\r\n(2) How can we know the user call to `this.parse(someCode)` is actually parsing the __current module__'s code and not just random code? Currently the [documentation states](https://rollupjs.org/guide/en/#thisparsecode-string-acornoptions-acornoptions--estreeprogram):\r\n```\r\nthis.parse(code: string, acornOptions?: AcornOptions) => ESTree.Program\r\n\r\nUse Rollup's internal acorn instance to parse code to an AST.\r\n```\r\nand in the hooks documentation it says:\r\n```\r\nTo prevent additional parsing overhead in case e.g. this hook already used this.parse to generate an AST for some reason, this hook can optionally return a { code, ast, map } object.\r\n```\r\n\r\nBut nothing guarantees `this.parse` is used exclusively for the modules code. It can be used multiple times or not to be used at all (some other third-party parser for that matter).\r\n\r\nI have a few possible solutions to this problem, ordered from best to worst IMHO:\r\n1. Expose some kind of _Node Annotations function_ in the _PluginContext_ - `this.annotateNode(ast: acorn.Node, node: acorn.Node, annotation: enum {pure})` which would add `pure` annotation to this specific node.\r\nThis has the huge benefit that we may add more possible annotations (e.g. `keep`, `noTreeShake`) and support features like #3870 \r\n2. Add a new PluginContext_ method named `parseModule(code: string, options: any): acorn.Node` which should be used **only** for parsing the module's code and MUST be used. Should the users call this method, they must return the `code` passed to it and the `ast` returned from it (possibly after manipulation) from the hook. We could change the documentation for `this.parse` to honor this requirement, but it's incompatible change to the API.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789000928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789032605","html_url":"https://github.com/rollup/rollup/issues/3979#issuecomment-789032605","issue_url":"https://api.github.com/repos/rollup/rollup/issues/3979","id":789032605,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTAzMjYwNQ==","user":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T16:25:35Z","updated_at":"2021-03-02T16:25:35Z","body":"> There is a second problem related to the same root cause - the removal of sourceMapping comment is also done only in Module.setSource if the ast is not provided. Should we open a different issue for this? I am not sure how to solve it.\r\n\r\nYes, separate\r\n\r\n> How can we know the user call to this.parse(someCode) is actually parsing the current module's code\r\n\r\nWe don't, so it should be done in a way that this does not matter. Will try to have a look tomorrow.\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789032605/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789033742","html_url":"https://github.com/rollup/rollup/issues/3979#issuecomment-789033742","issue_url":"https://api.github.com/repos/rollup/rollup/issues/3979","id":789033742,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTAzMzc0Mg==","user":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T16:27:14Z","updated_at":"2021-03-02T16:27:14Z","body":"What is the problem if the non-standard fields \"pure\" and \"annotations\" are added to other code?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789033742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789045873","html_url":"https://github.com/rollup/rollup/issues/3979#issuecomment-789045873","issue_url":"https://api.github.com/repos/rollup/rollup/issues/3979","id":789045873,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTA0NTg3Mw==","user":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T16:43:06Z","updated_at":"2021-03-02T18:58:42Z","body":"> What is the problem if the non-standard fields \"pure\" and \"annotations\" are added to other code?\r\n\r\n1. It's not documented anywhere and if we document it it will pose a very restrictive design for future changes (the annotation must be carried inside the ast nodes)\r\n2. [`markPureNode`](https://github.com/rollup/rollup/blob/a12ec5b1125020c6509fb38a8b9218eea1301cc4/src/utils/pureComments.ts#L36) also annotates the `expression` of an `ExpressionStatement` - i.e. it's not trivial for a user to implement.\r\n\r\nIf we use a well-defined `annotateNode` function we can overcome these problems.\r\nOf course this method will initially just add `pure` and `annotations` as currently implemented. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789045873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T16:52:23Z","updated_at":"2021-03-02T16:52:23Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rollup/rollup/issues/3982","repository_url":"https://api.github.com/repos/rollup/rollup","labels_url":"https://api.github.com/repos/rollup/rollup/issues/3982/labels{/name}","comments_url":"https://api.github.com/repos/rollup/rollup/issues/3982/comments","events_url":"https://api.github.com/repos/rollup/rollup/issues/3982/events","html_url":"https://github.com/rollup/rollup/issues/3982","id":820199689,"node_id":"MDU6SXNzdWU4MjAxOTk2ODk=","number":3982,"title":"sourceMapping comments are not stripped if plugin parses the ast","user":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2021-03-02T16:52:23Z","updated_at":"2021-03-13T09:26:09Z","closed_at":"2021-03-13T09:26:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":35640229,"node_id":"MDEwOlJlcG9zaXRvcnkzNTY0MDIyOQ==","name":"rollup","full_name":"rollup/rollup","private":false,"owner":{"login":"rollup","id":12554859,"node_id":"MDEyOk9yZ2FuaXphdGlvbjEyNTU0ODU5","avatar_url":"https://avatars.githubusercontent.com/u/12554859?v=4","gravatar_id":"","url":"https://api.github.com/users/rollup","html_url":"https://github.com/rollup","followers_url":"https://api.github.com/users/rollup/followers","following_url":"https://api.github.com/users/rollup/following{/other_user}","gists_url":"https://api.github.com/users/rollup/gists{/gist_id}","starred_url":"https://api.github.com/users/rollup/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rollup/subscriptions","organizations_url":"https://api.github.com/users/rollup/orgs","repos_url":"https://api.github.com/users/rollup/repos","events_url":"https://api.github.com/users/rollup/events{/privacy}","received_events_url":"https://api.github.com/users/rollup/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rollup/rollup","description":"Next-generation ES module bundler","fork":false,"url":"https://api.github.com/repos/rollup/rollup","forks_url":"https://api.github.com/repos/rollup/rollup/forks","keys_url":"https://api.github.com/repos/rollup/rollup/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rollup/rollup/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rollup/rollup/teams","hooks_url":"https://api.github.com/repos/rollup/rollup/hooks","issue_events_url":"https://api.github.com/repos/rollup/rollup/issues/events{/number}","events_url":"https://api.github.com/repos/rollup/rollup/events","assignees_url":"https://api.github.com/repos/rollup/rollup/assignees{/user}","branches_url":"https://api.github.com/repos/rollup/rollup/branches{/branch}","tags_url":"https://api.github.com/repos/rollup/rollup/tags","blobs_url":"https://api.github.com/repos/rollup/rollup/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rollup/rollup/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rollup/rollup/git/refs{/sha}","trees_url":"https://api.github.com/repos/rollup/rollup/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rollup/rollup/statuses/{sha}","languages_url":"https://api.github.com/repos/rollup/rollup/languages","stargazers_url":"https://api.github.com/repos/rollup/rollup/stargazers","contributors_url":"https://api.github.com/repos/rollup/rollup/contributors","subscribers_url":"https://api.github.com/repos/rollup/rollup/subscribers","subscription_url":"https://api.github.com/repos/rollup/rollup/subscription","commits_url":"https://api.github.com/repos/rollup/rollup/commits{/sha}","git_commits_url":"https://api.github.com/repos/rollup/rollup/git/commits{/sha}","comments_url":"https://api.github.com/repos/rollup/rollup/comments{/number}","issue_comment_url":"https://api.github.com/repos/rollup/rollup/issues/comments{/number}","contents_url":"https://api.github.com/repos/rollup/rollup/contents/{+path}","compare_url":"https://api.github.com/repos/rollup/rollup/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rollup/rollup/merges","archive_url":"https://api.github.com/repos/rollup/rollup/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rollup/rollup/downloads","issues_url":"https://api.github.com/repos/rollup/rollup/issues{/number}","pulls_url":"https://api.github.com/repos/rollup/rollup/pulls{/number}","milestones_url":"https://api.github.com/repos/rollup/rollup/milestones{/number}","notifications_url":"https://api.github.com/repos/rollup/rollup/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rollup/rollup/labels{/name}","releases_url":"https://api.github.com/repos/rollup/rollup/releases{/id}","deployments_url":"https://api.github.com/repos/rollup/rollup/deployments","created_at":"2015-05-14T22:26:28Z","updated_at":"2025-11-09T07:58:19Z","pushed_at":"2025-11-08T17:11:17Z","git_url":"git://github.com/rollup/rollup.git","ssh_url":"git@github.com:rollup/rollup.git","clone_url":"https://github.com/rollup/rollup.git","svn_url":"https://github.com/rollup/rollup","homepage":"https://rollupjs.org","size":32539,"stargazers_count":26104,"watchers_count":26104,"language":"JavaScript","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":1649,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":602,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":1649,"open_issues":602,"watchers":26104,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"<!--\r\n  âš¡ï¸ katchow! We ðŸ’› issues.\r\n\r\n  Please - do not - remove this template.\r\n  Please - do not - skip or remove parts of this template.\r\n  Or your issue may be closed.\r\n\r\n  ðŸ‘‰ðŸ½ Need help or tech support? Please don't open an issue!\r\n  Head to https://is.gd/rollup_chat or https://stackoverflow.com/questions/tagged/rollupjs\r\n  \r\n  ðŸ‘‰ðŸ½ Is this issue related to an official plugin? Please do not open an issue here, go to the plugins repository instead: https://github.com/rollup/plugins/issues\r\n\r\n  â¤ï¸ Rollup? Please consider supporting our collective:\r\n  ðŸ‘‰ https://opencollective.com/rollup/donate\r\n-->\r\n\r\n- Rollup Version: 2.40.0\r\n- Operating System (or Browser): any\r\n- Node Version (if applicable):\r\n- Link to reproduction (IMPORTANT, read below): https://repl.it/@yannayl/rollup-repro-plugin-parse-ast-not-remove-sourcemapping\r\n\r\n<!--\r\n  Issues without minimal reproductions will be closed! Please provide a link to one by:\r\n  1. Using the REPL at https://rollupjs.org/repl/, or\r\n  2. Using the REPL.it reproduction template at https://repl.it/@rollup/rollup-repro\r\n     (allows full use of all rollup options and plugins), or\r\n  3. Provide a minimal repository link (Read https://git.io/fNzHA for instructions).\r\n     These may take more time to triage than the other options.\r\n     \r\n  For some bugs it this may seem like overkill but believe us, very often what seems like a\r\n  \"clear issue\" is actually specific to some details of your setup. Having a runnable\r\n  reproduction not only \"proves\" your bug to us but also allows us to spend all our effort\r\n  fixing the bug instead of struggling to understand your issue.\r\n-->\r\n\r\n\r\n### Expected Behavior\r\nA plugin which calls `this.parse` (i.e. hooking `load` or `transform`) and doesn't modify anything should not affect the output.\r\n\r\n### Actual Behavior\r\nIf a plugin calls `this.parse` rollup does not remove the sourceMappping comment from the module.\r\n\r\n### Root Cause\r\nAccounting for sourceMappingURL comments happens in the [`Module.setSource` function](https://github.com/rollup/rollup/blob/a12ec5b1125020c6509fb38a8b9218eea1301cc4/src/Module.ts#L728) in conjunction with the `tryParse` function in the same file. However, this function is not called if `ast` already exists.\r\n\r\nThis issue is related to  #3979\r\n","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/3982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rollup/rollup/issues/3982/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789052727","html_url":"https://github.com/rollup/rollup/issues/3979#issuecomment-789052727","issue_url":"https://api.github.com/repos/rollup/rollup/issues/3979","id":789052727,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTA1MjcyNw==","user":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T16:52:53Z","updated_at":"2021-03-02T16:52:53Z","body":"> > There is a second problem related to the same root cause - the removal of sourceMapping comment is also done only in Module.setSource if the ast is not provided. Should we open a different issue for this? I am not sure how to solve it.\r\n> \r\n> Yes, separate\r\n\r\nDone:  #3982","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/789052727/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4425615150,"node_id":"MDExOkNsb3NlZEV2ZW50NDQyNTYxNTE1MA==","url":"https://api.github.com/repos/rollup/rollup/issues/events/4425615150","actor":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-03-09T06:14:24Z","state_reason":null,"performed_via_github_app":null},{"id":4425615279,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ0MjU2MTUyNzk=","url":"https://api.github.com/repos/rollup/rollup/issues/events/4425615279","actor":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"992a28595e28ac07ac170ee5a096bdfdd4f8cd74","commit_url":"https://api.github.com/repos/rollup/rollup/commits/992a28595e28ac07ac170ee5a096bdfdd4f8cd74","created_at":"2021-03-09T06:14:26Z","performed_via_github_app":null}]