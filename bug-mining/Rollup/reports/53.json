{"url":"https://api.github.com/repos/rollup/rollup/issues/565","repository_url":"https://api.github.com/repos/rollup/rollup","labels_url":"https://api.github.com/repos/rollup/rollup/issues/565/labels{/name}","comments_url":"https://api.github.com/repos/rollup/rollup/issues/565/comments","events_url":"https://api.github.com/repos/rollup/rollup/issues/565/events","html_url":"https://github.com/rollup/rollup/issues/565","id":142464538,"node_id":"MDU6SXNzdWUxNDI0NjQ1Mzg=","number":565,"title":"Whitespace messes with renaming","user":{"login":"Zirak","id":1144615,"node_id":"MDQ6VXNlcjExNDQ2MTU=","avatar_url":"https://avatars.githubusercontent.com/u/1144615?v=4","gravatar_id":"","url":"https://api.github.com/users/Zirak","html_url":"https://github.com/Zirak","followers_url":"https://api.github.com/users/Zirak/followers","following_url":"https://api.github.com/users/Zirak/following{/other_user}","gists_url":"https://api.github.com/users/Zirak/gists{/gist_id}","starred_url":"https://api.github.com/users/Zirak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Zirak/subscriptions","organizations_url":"https://api.github.com/users/Zirak/orgs","repos_url":"https://api.github.com/users/Zirak/repos","events_url":"https://api.github.com/users/Zirak/events{/privacy}","received_events_url":"https://api.github.com/users/Zirak/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":8,"created_at":"2016-03-21T20:42:59Z","updated_at":"2016-03-23T22:24:04Z","closed_at":"2016-03-21T22:15:20Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hello!\n\nIt seems like renaming and inlining has a bit of a whitespace issue. Minimal example:\n\n``` js\n// entry.js\nimport * as foo from './foo';\nfoo .yar();\n\n// foo.js\nexport function yar() {\n    console.log('yar?');\n}\n\n// build: rollup entry.js\n```\n\nAnd the result is\n\n``` js\nfunction yar() {\n    console.log('yar?');\n}\n\nyarr(); // notice the extra r\n```\n\nOr for a more noticeable difference:\n\n``` js\n// entry.js\n// ...\nfoo\n    .yar();\n\n// output\n// ...\nyar .yar();\n```\n\nPlay with the whitespace count for more amusing results.\n\nDigging a bit got me to [`Module.js`](https://github.com/rollup/rollup/blob/b50167646efe19297b40de49f19caebe2eb77018/src/Module.js#L516). Debugging shows that  `magicString.original.slice(start, end)` doesn't capture the entire statement, the whitespace is ignored in calculating the `end` offset.\n\nSince the `start` and `end` values come from the AST, I believe this is an acorn issue and may have to be fixed upstream.\n\nThoughts? Maybe this could somehow be patched in rollup without waiting for upstream?\n","closed_by":{"login":"eventualbuddha","id":1938,"node_id":"MDQ6VXNlcjE5Mzg=","avatar_url":"https://avatars.githubusercontent.com/u/1938?v=4","gravatar_id":"","url":"https://api.github.com/users/eventualbuddha","html_url":"https://github.com/eventualbuddha","followers_url":"https://api.github.com/users/eventualbuddha/followers","following_url":"https://api.github.com/users/eventualbuddha/following{/other_user}","gists_url":"https://api.github.com/users/eventualbuddha/gists{/gist_id}","starred_url":"https://api.github.com/users/eventualbuddha/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eventualbuddha/subscriptions","organizations_url":"https://api.github.com/users/eventualbuddha/orgs","repos_url":"https://api.github.com/users/eventualbuddha/repos","events_url":"https://api.github.com/users/eventualbuddha/events{/privacy}","received_events_url":"https://api.github.com/users/eventualbuddha/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/565/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rollup/rollup/issues/565/timeline","performed_via_github_app":null,"state_reason":"completed"}