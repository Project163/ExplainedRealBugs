{"url":"https://api.github.com/repos/rollup/rollup/issues/3979","repository_url":"https://api.github.com/repos/rollup/rollup","labels_url":"https://api.github.com/repos/rollup/rollup/issues/3979/labels{/name}","comments_url":"https://api.github.com/repos/rollup/rollup/issues/3979/comments","events_url":"https://api.github.com/repos/rollup/rollup/issues/3979/events","html_url":"https://github.com/rollup/rollup/issues/3979","id":818860738,"node_id":"MDU6SXNzdWU4MTg4NjA3Mzg=","number":3979,"title":"PURE annotations ignored if plugin parses the ast","user":{"login":"yannayl","id":7497681,"node_id":"MDQ6VXNlcjc0OTc2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/7497681?v=4","gravatar_id":"","url":"https://api.github.com/users/yannayl","html_url":"https://github.com/yannayl","followers_url":"https://api.github.com/users/yannayl/followers","following_url":"https://api.github.com/users/yannayl/following{/other_user}","gists_url":"https://api.github.com/users/yannayl/gists{/gist_id}","starred_url":"https://api.github.com/users/yannayl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yannayl/subscriptions","organizations_url":"https://api.github.com/users/yannayl/orgs","repos_url":"https://api.github.com/users/yannayl/repos","events_url":"https://api.github.com/users/yannayl/events{/privacy}","received_events_url":"https://api.github.com/users/yannayl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2021-03-01T13:20:56Z","updated_at":"2021-03-09T06:14:24Z","closed_at":"2021-03-09T06:14:24Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\n  âš¡ï¸ katchow! We ðŸ’› issues.\r\n\r\n  Please - do not - remove this template.\r\n  Please - do not - skip or remove parts of this template.\r\n  Or your issue may be closed.\r\n\r\n  ðŸ‘‰ðŸ½ Need help or tech support? Please don't open an issue!\r\n  Head to https://is.gd/rollup_chat or https://stackoverflow.com/questions/tagged/rollupjs\r\n  \r\n  ðŸ‘‰ðŸ½ Is this issue related to an official plugin? Please do not open an issue here, go to the plugins repository instead: https://github.com/rollup/plugins/issues\r\n\r\n  â¤ï¸ Rollup? Please consider supporting our collective:\r\n  ðŸ‘‰ https://opencollective.com/rollup/donate\r\n-->\r\n\r\n- Rollup Version: 2.40.0\r\n- Operating System (or Browser): any\r\n- Node Version (if applicable):\r\n- Link to reproduction (IMPORTANT, read below): https://repl.it/@yannayl/rollup-repro-plugin-ignore-pure-annotation\r\n\r\n<!--\r\n  Issues without minimal reproductions will be closed! Please provide a link to one by:\r\n  1. Using the REPL at https://rollupjs.org/repl/, or\r\n  2. Using the REPL.it reproduction template at https://repl.it/@rollup/rollup-repro\r\n     (allows full use of all rollup options and plugins), or\r\n  3. Provide a minimal repository link (Read https://git.io/fNzHA for instructions).\r\n     These may take more time to triage than the other options.\r\n     \r\n  For some bugs it this may seem like overkill but believe us, very often what seems like a\r\n  \"clear issue\" is actually specific to some details of your setup. Having a runnable\r\n  reproduction not only \"proves\" your bug to us but also allows us to spend all our effort\r\n  fixing the bug instead of struggling to understand your issue.\r\n-->\r\n\r\n\r\n### Expected Behavior\r\nA plugin which calls `this.parse` (i.e. hooking `load` or `transform`) and doesn't modify anything should not affect the tree-shaking.\r\n\r\n### Actual Behavior\r\nIf a plugin calls `this.parse` rollup ignores the `/*@__PURE__*/` annotation.\r\n\r\n### Root Cause\r\nAccounting for `/*@__PURE__*/` annotation happens in the [`Module.setSource` function](https://github.com/rollup/rollup/blob/a12ec5b1125020c6509fb38a8b9218eea1301cc4/src/Module.ts#L728) in conjunction with the `tryParse` function in the same file. However, this function is not called if `ast` already exists.\r\n","closed_by":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/3979/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rollup/rollup/issues/3979/timeline","performed_via_github_app":null,"state_reason":"completed"}