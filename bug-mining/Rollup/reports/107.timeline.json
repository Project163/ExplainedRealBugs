[{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/323543913","html_url":"https://github.com/rollup/rollup/issues/1564#issuecomment-323543913","issue_url":"https://api.github.com/repos/rollup/rollup/issues/1564","id":323543913,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzU0MzkxMw==","user":{"login":"kzc","id":11593452,"node_id":"MDQ6VXNlcjExNTkzNDUy","avatar_url":"https://avatars.githubusercontent.com/u/11593452?v=4","gravatar_id":"","url":"https://api.github.com/users/kzc","html_url":"https://github.com/kzc","followers_url":"https://api.github.com/users/kzc/followers","following_url":"https://api.github.com/users/kzc/following{/other_user}","gists_url":"https://api.github.com/users/kzc/gists{/gist_id}","starred_url":"https://api.github.com/users/kzc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzc/subscriptions","organizations_url":"https://api.github.com/users/kzc/orgs","repos_url":"https://api.github.com/users/kzc/repos","events_url":"https://api.github.com/users/kzc/events{/privacy}","received_events_url":"https://api.github.com/users/kzc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-08-19T19:45:42Z","updated_at":"2017-08-19T19:45:42Z","body":"Apparently the `i += 1` [AssignmentExpression](https://github.com/rollup/rollup/blob/master/src/ast/nodes/AssignmentExpression.js) is behaving differently than the `++i` [UpdateExpression](https://github.com/rollup/rollup/blob/master/src/ast/nodes/UpdateExpression.js). Should be easy enough to experimentally find the differences. Pull request is welcome.\r\n\r\nAlthough Rollup ought to handle it, any rollup minifier plugin can drop unused functions:\r\n```\r\n$ bin/uglifyjs -V\r\nuglify-es 3.0.28\r\n\r\n$ echo 'function first(){++i; second} function second(){}' | bin/uglifyjs --toplevel -mc\r\n\r\n$ \r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/323543913/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kzc","id":11593452,"node_id":"MDQ6VXNlcjExNTkzNDUy","avatar_url":"https://avatars.githubusercontent.com/u/11593452?v=4","gravatar_id":"","url":"https://api.github.com/users/kzc","html_url":"https://github.com/kzc","followers_url":"https://api.github.com/users/kzc/followers","following_url":"https://api.github.com/users/kzc/following{/other_user}","gists_url":"https://api.github.com/users/kzc/gists{/gist_id}","starred_url":"https://api.github.com/users/kzc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzc/subscriptions","organizations_url":"https://api.github.com/users/kzc/orgs","repos_url":"https://api.github.com/users/kzc/repos","events_url":"https://api.github.com/users/kzc/events{/privacy}","received_events_url":"https://api.github.com/users/kzc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/323544473","html_url":"https://github.com/rollup/rollup/issues/1564#issuecomment-323544473","issue_url":"https://api.github.com/repos/rollup/rollup/issues/1564","id":323544473,"node_id":"MDEyOklzc3VlQ29tbWVudDMyMzU0NDQ3Mw==","user":{"login":"kzc","id":11593452,"node_id":"MDQ6VXNlcjExNTkzNDUy","avatar_url":"https://avatars.githubusercontent.com/u/11593452?v=4","gravatar_id":"","url":"https://api.github.com/users/kzc","html_url":"https://github.com/kzc","followers_url":"https://api.github.com/users/kzc/followers","following_url":"https://api.github.com/users/kzc/following{/other_user}","gists_url":"https://api.github.com/users/kzc/gists{/gist_id}","starred_url":"https://api.github.com/users/kzc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzc/subscriptions","organizations_url":"https://api.github.com/users/kzc/orgs","repos_url":"https://api.github.com/users/kzc/repos","events_url":"https://api.github.com/users/kzc/events{/privacy}","received_events_url":"https://api.github.com/users/kzc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-08-19T19:57:25Z","updated_at":"2017-08-21T13:21:39Z","body":"Fix:\r\n```patch\r\ndiff --git a/src/ast/nodes/UpdateExpression.js b/src/ast/nodes/UpdateExpression.js\r\nindex 2b77db9..f061d59 100644\r\n--- a/src/ast/nodes/UpdateExpression.js\r\n+++ b/src/ast/nodes/UpdateExpression.js\r\n@@ -1,6 +1,7 @@\r\n import Node from '../Node.js';\r\n import disallowIllegalReassignment from './shared/disallowIllegalReassignment.js';\r\n import isUsedByBundle from './shared/isUsedByBundle.js';\r\n+import isProgramLevel from '../utils/isProgramLevel.js';\r\n import { NUMBER } from '../values.js';\r\n \r\n export default class UpdateExpression extends Node {\r\n@@ -23,11 +24,13 @@ export default class UpdateExpression extends Node {\r\n        }\r\n \r\n        hasEffects () {\r\n-               return isUsedByBundle( this.scope, this.subject );\r\n+               return this.isUsedByBundle();\r\n        }\r\n \r\n        initialiseNode () {\r\n-               this.module.bundle.dependentExpressions.push( this );\r\n+               if ( isProgramLevel( this ) ) {\r\n+                       this.module.bundle.dependentExpressions.push( this );\r\n+               }\r\n        }\r\n \r\n        isUsedByBundle () {\r\n```\r\n```\r\n$ bin/rollup lib.js -f es\r\n\r\nlib.js â†’ stdout...\r\n(!) Generated an empty bundle\r\n\r\ncreated stdout in 26ms\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/323544473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kzc","id":11593452,"node_id":"MDQ6VXNlcjExNTkzNDUy","avatar_url":"https://avatars.githubusercontent.com/u/11593452?v=4","gravatar_id":"","url":"https://api.github.com/users/kzc","html_url":"https://github.com/kzc","followers_url":"https://api.github.com/users/kzc/followers","following_url":"https://api.github.com/users/kzc/following{/other_user}","gists_url":"https://api.github.com/users/kzc/gists{/gist_id}","starred_url":"https://api.github.com/users/kzc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzc/subscriptions","organizations_url":"https://api.github.com/users/kzc/orgs","repos_url":"https://api.github.com/users/kzc/repos","events_url":"https://api.github.com/users/kzc/events{/privacy}","received_events_url":"https://api.github.com/users/kzc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1213321172,"node_id":"MDEyOkxhYmVsZWRFdmVudDEyMTMzMjExNzI=","url":"https://api.github.com/repos/rollup/rollup/issues/events/1213321172","actor":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2017-08-20T21:54:25Z","label":{"name":"bug","color":"fc2929"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/324967715","html_url":"https://github.com/rollup/rollup/issues/1564#issuecomment-324967715","issue_url":"https://api.github.com/repos/rollup/rollup/issues/1564","id":324967715,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDk2NzcxNQ==","user":{"login":"kzc","id":11593452,"node_id":"MDQ6VXNlcjExNTkzNDUy","avatar_url":"https://avatars.githubusercontent.com/u/11593452?v=4","gravatar_id":"","url":"https://api.github.com/users/kzc","html_url":"https://github.com/kzc","followers_url":"https://api.github.com/users/kzc/followers","following_url":"https://api.github.com/users/kzc/following{/other_user}","gists_url":"https://api.github.com/users/kzc/gists{/gist_id}","starred_url":"https://api.github.com/users/kzc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzc/subscriptions","organizations_url":"https://api.github.com/users/kzc/orgs","repos_url":"https://api.github.com/users/kzc/repos","events_url":"https://api.github.com/users/kzc/events{/privacy}","received_events_url":"https://api.github.com/users/kzc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-08-25T16:16:51Z","updated_at":"2017-08-25T16:16:51Z","body":"Fixed by PR:\r\n\r\nRework treeshaking algorithm #1582\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/324967715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kzc","id":11593452,"node_id":"MDQ6VXNlcjExNTkzNDUy","avatar_url":"https://avatars.githubusercontent.com/u/11593452?v=4","gravatar_id":"","url":"https://api.github.com/users/kzc","html_url":"https://github.com/kzc","followers_url":"https://api.github.com/users/kzc/followers","following_url":"https://api.github.com/users/kzc/following{/other_user}","gists_url":"https://api.github.com/users/kzc/gists{/gist_id}","starred_url":"https://api.github.com/users/kzc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kzc/subscriptions","organizations_url":"https://api.github.com/users/kzc/orgs","repos_url":"https://api.github.com/users/kzc/repos","events_url":"https://api.github.com/users/kzc/events{/privacy}","received_events_url":"https://api.github.com/users/kzc/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1221827193,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDEyMjE4MjcxOTM=","url":"https://api.github.com/repos/rollup/rollup/issues/events/1221827193","actor":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"8bc8b0892df09e541b163215c3da75c7d5b3a0c5","commit_url":"https://api.github.com/repos/lukastaegert/rollup/commits/8bc8b0892df09e541b163215c3da75c7d5b3a0c5","created_at":"2017-08-25T17:05:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/324980401","html_url":"https://github.com/rollup/rollup/issues/1564#issuecomment-324980401","issue_url":"https://api.github.com/repos/rollup/rollup/issues/1564","id":324980401,"node_id":"MDEyOklzc3VlQ29tbWVudDMyNDk4MDQwMQ==","user":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-08-25T17:06:32Z","updated_at":"2017-08-25T17:06:57Z","body":"Just added it to #1582 as a test","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/rollup/rollup/issues/comments/324980401/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"lukastaegert","id":12949268,"node_id":"MDQ6VXNlcjEyOTQ5MjY4","avatar_url":"https://avatars.githubusercontent.com/u/12949268?v=4","gravatar_id":"","url":"https://api.github.com/users/lukastaegert","html_url":"https://github.com/lukastaegert","followers_url":"https://api.github.com/users/lukastaegert/followers","following_url":"https://api.github.com/users/lukastaegert/following{/other_user}","gists_url":"https://api.github.com/users/lukastaegert/gists{/gist_id}","starred_url":"https://api.github.com/users/lukastaegert/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lukastaegert/subscriptions","organizations_url":"https://api.github.com/users/lukastaegert/orgs","repos_url":"https://api.github.com/users/lukastaegert/repos","events_url":"https://api.github.com/users/lukastaegert/events{/privacy}","received_events_url":"https://api.github.com/users/lukastaegert/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1222914259,"node_id":"MDExOkNsb3NlZEV2ZW50MTIyMjkxNDI1OQ==","url":"https://api.github.com/repos/rollup/rollup/issues/events/1222914259","actor":{"login":"Rich-Harris","id":1162160,"node_id":"MDQ6VXNlcjExNjIxNjA=","avatar_url":"https://avatars.githubusercontent.com/u/1162160?v=4","gravatar_id":"","url":"https://api.github.com/users/Rich-Harris","html_url":"https://github.com/Rich-Harris","followers_url":"https://api.github.com/users/Rich-Harris/followers","following_url":"https://api.github.com/users/Rich-Harris/following{/other_user}","gists_url":"https://api.github.com/users/Rich-Harris/gists{/gist_id}","starred_url":"https://api.github.com/users/Rich-Harris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Rich-Harris/subscriptions","organizations_url":"https://api.github.com/users/Rich-Harris/orgs","repos_url":"https://api.github.com/users/Rich-Harris/repos","events_url":"https://api.github.com/users/Rich-Harris/events{/privacy}","received_events_url":"https://api.github.com/users/Rich-Harris/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"8bc8b0892df09e541b163215c3da75c7d5b3a0c5","commit_url":"https://api.github.com/repos/rollup/rollup/commits/8bc8b0892df09e541b163215c3da75c7d5b3a0c5","created_at":"2017-08-27T21:24:25Z","state_reason":null,"performed_via_github_app":null}]