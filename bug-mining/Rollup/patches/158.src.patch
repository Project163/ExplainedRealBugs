diff --git a/cli/run/index.ts b/cli/run/index.ts
index ced44e4db..d44a32a10 100644
--- a/cli/run/index.ts
+++ b/cli/run/index.ts
@@ -3,14 +3,14 @@ import relative from 'require-relative';
 import { WarningHandler } from '../../src/rollup/types';
 import mergeOptions, { GenericConfigObject } from '../../src/utils/mergeOptions';
 import { getAliasName } from '../../src/utils/relativeId';
-import { stdinName } from '../../src/utils/stdin';
 import { handleError } from '../logging';
 import batchWarnings from './batchWarnings';
 import build from './build';
 import loadConfigFile from './loadConfigFile';
+import { stdinName, stdinPlugin } from './stdin';
 import watch from './watch';
 
-export default function runRollup (command: any) {
+export default function runRollup(command: any) {
 	let inputSource;
 	if (command._.length > 0) {
 		if (command.input) {
@@ -86,40 +86,39 @@ export default function runRollup (command: any) {
 
 		if (command.watch) process.env.ROLLUP_WATCH = 'true';
 
-		loadConfigFile(configFile, command)
+		return loadConfigFile(configFile, command)
 			.then(configs => execute(configFile, configs, command))
 			.catch(handleError);
 	} else {
-		return execute(configFile, [{ input: null }] as any, command);
+		if (!command.input && (command.stdin || !process.stdin.isTTY)) {
+			command.input = stdinName;
+		}
+		return execute(configFile, [{ input: [] }], command);
 	}
 }
 
-function execute (configFile: string, configs: GenericConfigObject[], command: any) {
+async function execute(
+	configFile: string,
+	configs: GenericConfigObject[],
+	command: any
+): Promise<void> {
 	if (command.watch) {
 		watch(configFile, configs, command, command.silent);
 	} else {
-		let promise = Promise.resolve();
 		for (const config of configs) {
-			promise = promise.then(() => {
-				const warnings = batchWarnings();
-				handleMissingInput(command, config);
-				const { inputOptions, outputOptions, optionError } = mergeOptions({
-					command,
-					config,
-					defaultOnWarnHandler: warnings.add
-				});
-
-				if (optionError)
-					(inputOptions.onwarn as WarningHandler)({ code: 'UNKNOWN_OPTION', message: optionError });
-				return build(inputOptions, outputOptions, warnings, command.silent);
+			const warnings = batchWarnings();
+			const { inputOptions, outputOptions, optionError } = mergeOptions({
+				command,
+				config,
+				defaultOnWarnHandler: warnings.add
 			});
+			if (optionError) {
+				(inputOptions.onwarn as WarningHandler)({ code: 'UNKNOWN_OPTION', message: optionError });
+			}
+			if (command.stdin !== false) {
+				inputOptions.plugins!.push(stdinPlugin());
+			}
+			await build(inputOptions, outputOptions, warnings, command.silent);
 		}
-		return promise;
-	}
-}
-
-function handleMissingInput(command: any, config: GenericConfigObject) {
-	if (!(command.input || config.input || config.input === '' || process.stdin.isTTY)) {
-		command.input = stdinName;
 	}
 }
diff --git a/cli/run/stdin.ts b/cli/run/stdin.ts
new file mode 100644
index 000000000..731e79a30
--- /dev/null
+++ b/cli/run/stdin.ts
@@ -0,0 +1,37 @@
+import { Plugin } from '../../src/rollup/types';
+
+export const stdinName = '-';
+
+let stdinResult: Promise<string> | null = null;
+
+export function stdinPlugin(): Plugin {
+	return {
+		name: 'stdin',
+		resolveId(id) {
+			if (id === stdinName) {
+				return id;
+			}
+		},
+		load(id) {
+			if (id === stdinName) {
+				return stdinResult || (stdinResult = readStdin());
+			}
+		}
+	};
+}
+
+function readStdin(): Promise<string> {
+	return new Promise((resolve, reject) => {
+		const chunks: Buffer[] = [];
+		process.stdin.setEncoding('utf8');
+		process.stdin
+			.on('data', chunk => chunks.push(chunk))
+			.on('end', () => {
+				const result = chunks.join('');
+				resolve(result);
+			})
+			.on('error', err => {
+				reject(err);
+			});
+	});
+}
diff --git a/docs/01-command-line-reference.md b/docs/01-command-line-reference.md
index 3d67e9b49..1bc68cd62 100755
--- a/docs/01-command-line-reference.md
+++ b/docs/01-command-line-reference.md
@@ -253,6 +253,7 @@ Many options have command line equivalents. In those cases, any arguments passed
 --silent                    Don't print warnings
 --sourcemapExcludeSources   Do not include source code in source maps
 --sourcemapFile <file>      Specify bundle position for source maps
+--no-stdin                  do not read "-" from stdin
 --strictDeprecations        Throw errors for deprecated features
 --no-treeshake              Disable tree-shaking optimisations
 --no-treeshake.annotations  Ignore pure call annotations
@@ -306,3 +307,25 @@ npm run build -- --environment BUILD:development
 ```
 
 then the config file will receive `process.env.INCLUDE_DEPS === 'true'` and `process.env.BUILD === 'development'`.
+
+#### `--no-stdin`
+
+Do not read files from `stdin`. Setting this flag will prevent piping content to Rollup and make sure Rollup interprets `-` as a regular file name instead of interpreting this as the name of `stdin`. See also [Reading a file from stdin](guide/en/#reading-a-file-from-stdin).
+
+### Reading a file from stdin
+
+When using the command line interface, Rollup can also read content from stdin:
+
+```
+echo "export const foo = 42;" | rollup --format cjs --file out.js
+```
+
+When this file contains imports, Rollup will try to resolve them relative to the current working directory. When a config file is used, Rollup will only use `stdin` as an entry point if the file name of the entry point is `-`. To read a non-entry-point file from stdin, just call it `-`, which is the file name that is used internally to reference `stdin`. I.e.
+
+```js
+import foo from "-";
+```
+
+in any file will prompt Rollup to try to read the imported file from `stdin` and assign the default export to `foo`. You can pass the [`--no-stdin`](guide/en/#--no-stdin) CLI flag to Rollup to treat `-` as a regular file name instead.
+
+The JavaScript API will always treat `-` as a regular file name.
diff --git a/src/rollup/index.ts b/src/rollup/index.ts
index 07221af6f..69e32e99d 100644
--- a/src/rollup/index.ts
+++ b/src/rollup/index.ts
@@ -13,7 +13,7 @@ import {
 } from '../utils/error';
 import { writeFile } from '../utils/fs';
 import getExportMode from '../utils/getExportMode';
-import mergeOptions, { GenericConfigObject } from '../utils/mergeOptions';
+import mergeOptions, { ensureArray, GenericConfigObject } from '../utils/mergeOptions';
 import { basename, dirname, isAbsolute, resolve } from '../utils/path';
 import { PluginDriver } from '../utils/PluginDriver';
 import { ANONYMOUS_OUTPUT_PLUGIN_PREFIX, ANONYMOUS_PLUGIN_PREFIX } from '../utils/pluginUtils';
@@ -80,16 +80,6 @@ function applyOptionHook(inputOptions: InputOptions, plugin: Plugin) {
 	return inputOptions;
 }
 
-function ensureArray<T>(items: (T | null | undefined)[] | T | null | undefined): T[] {
-	if (Array.isArray(items)) {
-		return items.filter(Boolean) as T[];
-	}
-	if (items) {
-		return [items];
-	}
-	return [];
-}
-
 function normalizePlugins(rawPlugins: any, anonymousPrefix: string): Plugin[] {
 	const plugins = ensureArray(rawPlugins);
 	for (let pluginIndex = 0; pluginIndex < plugins.length; pluginIndex++) {
@@ -112,8 +102,8 @@ function getInputOptions(rawInputOptions: GenericConfigObject): InputOptions {
 	if (optionError)
 		(inputOptions.onwarn as WarningHandler)({ message: optionError, code: 'UNKNOWN_OPTION' });
 
-	inputOptions = ensureArray(inputOptions.plugins).reduce(applyOptionHook, inputOptions);
-	inputOptions.plugins = normalizePlugins(inputOptions.plugins, ANONYMOUS_PLUGIN_PREFIX);
+	inputOptions = inputOptions.plugins!.reduce(applyOptionHook, inputOptions);
+	inputOptions.plugins = normalizePlugins(inputOptions.plugins!, ANONYMOUS_PLUGIN_PREFIX);
 
 	if (inputOptions.inlineDynamicImports) {
 		if (inputOptions.preserveModules)
diff --git a/src/rollup/types.d.ts b/src/rollup/types.d.ts
index 3e5b7859e..0bcab00e7 100644
--- a/src/rollup/types.d.ts
+++ b/src/rollup/types.d.ts
@@ -233,10 +233,9 @@ export type IsPureModule = (id: string) => boolean | null | undefined;
 
 export type HasModuleSideEffects = (id: string, external: boolean) => boolean;
 
-export type LoadHook = (
-	this: PluginContext,
-	id: string
-) => Promise<SourceDescription | string | null> | SourceDescription | string | null;
+type LoadResult = SourceDescription | string | null | undefined;
+
+export type LoadHook = (this: PluginContext, id: string) => Promise<LoadResult> | LoadResult;
 
 export type TransformResult = string | null | undefined | TransformSourceDescription;
 
diff --git a/src/utils/defaultPlugin.ts b/src/utils/defaultPlugin.ts
index e0ed25fec..7c93d36c9 100644
--- a/src/utils/defaultPlugin.ts
+++ b/src/utils/defaultPlugin.ts
@@ -2,14 +2,13 @@ import { Plugin, ResolveIdHook } from '../rollup/types';
 import { error } from './error';
 import { lstatSync, readdirSync, readFile, realpathSync } from './fs';
 import { basename, dirname, isAbsolute, resolve } from './path';
-import { readStdin, stdinName } from './stdin';
 
 export function getRollupDefaultPlugin(preserveSymlinks: boolean): Plugin {
 	return {
 		name: 'Rollup Core',
 		resolveId: createResolveId(preserveSymlinks) as ResolveIdHook,
 		load(id) {
-			return id === stdinName ? readStdin() : readFile(id);
+			return readFile(id);
 		},
 		resolveFileUrl({ relativePath, format }) {
 			return relativeUrlMechanisms[format](relativePath);
@@ -59,8 +58,6 @@ function createResolveId(preserveSymlinks: boolean) {
 			});
 		}
 
-		if (source === stdinName) return source;
-
 		// external modules (non-entry modules that start with neither '.' or '/')
 		// are skipped at this stage.
 		if (importer !== undefined && !isAbsolute(source) && source[0] !== '.') return null;
diff --git a/src/utils/mergeOptions.ts b/src/utils/mergeOptions.ts
index 943c4eedb..064a68517 100644
--- a/src/utils/mergeOptions.ts
+++ b/src/utils/mergeOptions.ts
@@ -5,8 +5,6 @@ import {
 	WarningHandlerWithDefault
 } from '../rollup/types';
 
-import { stdinName } from './stdin';
-
 export interface GenericConfigObject {
 	[key: string]: unknown;
 }
@@ -50,6 +48,16 @@ const getObjectOption = (
 	return configOption;
 };
 
+export function ensureArray<T>(items: (T | null | undefined)[] | T | null | undefined): T[] {
+	if (Array.isArray(items)) {
+		return items.filter(Boolean) as T[];
+	}
+	if (items) {
+		return [items];
+	}
+	return [];
+}
+
 const defaultOnWarn: WarningHandler = warning => {
 	if (typeof warning === 'string') {
 		console.warn(warning);
@@ -150,7 +158,8 @@ export default function mergeOptions({
 			Object.keys(commandAliases),
 			'config',
 			'environment',
-			'silent'
+			'silent',
+			'stdin'
 		),
 		'CLI flag',
 		/^_|output|(config.*)$/
@@ -210,8 +219,6 @@ function getInputOptions(
 	defaultOnWarnHandler: WarningHandler
 ): InputOptions {
 	const getOption = createGetOption(config, command);
-	const input = getOption('input', []);
-
 	const inputOptions: InputOptions = {
 		acorn: config.acorn,
 		acornInjectPlugins: config.acornInjectPlugins as any,
@@ -223,12 +230,12 @@ function getInputOptions(
 		experimentalTopLevelAwait: getOption('experimentalTopLevelAwait'),
 		external: getExternal(config, command) as any,
 		inlineDynamicImports: getOption('inlineDynamicImports', false),
-		input,
+		input: getOption('input', []),
 		manualChunks: getOption('manualChunks'),
 		moduleContext: config.moduleContext as any,
 		onwarn: getOnWarn(config, defaultOnWarnHandler),
 		perf: getOption('perf', false),
-		plugins: config.plugins as any,
+		plugins: ensureArray(config.plugins as any),
 		preserveModules: getOption('preserveModules'),
 		preserveSymlinks: getOption('preserveSymlinks'),
 		shimMissingExports: getOption('shimMissingExports'),
@@ -237,13 +244,6 @@ function getInputOptions(
 		watch: config.watch as any
 	};
 
-	if (
-		config.watch &&
-		(input === stdinName || (Array.isArray(input) && input.indexOf(stdinName) >= 0))
-	) {
-		throw new Error('watch mode is incompatible with stdin input');
-	}
-
 	// support rollup({ cache: prevBuildObject })
 	if (inputOptions.cache && (inputOptions.cache as any).cache)
 		inputOptions.cache = (inputOptions.cache as any).cache;
@@ -295,7 +295,7 @@ function getOutputOptions(
 		noConflict: getOption('noConflict'),
 		outro: getOption('outro'),
 		paths: getOption('paths'),
-		plugins: config.plugins as any,
+		plugins: ensureArray(config.plugins as any),
 		preferConst: getOption('preferConst'),
 		sourcemap: getOption('sourcemap'),
 		sourcemapExcludeSources: getOption('sourcemapExcludeSources'),
diff --git a/src/utils/stdin.ts b/src/utils/stdin.ts
deleted file mode 100644
index d2aa4d730..000000000
--- a/src/utils/stdin.ts
+++ /dev/null
@@ -1,54 +0,0 @@
-export const stdinName = '-';
-
-let stdinResult: string | Error | null = null;
-const pending: { reject: Function; resolve: Function }[] = [];
-
-export function readStdin() {
-	return new Promise<string>((resolve, reject) => {
-		if (typeof process == 'undefined' || typeof process.stdin == 'undefined') {
-			reject(new Error('stdin input is invalid in browser'));
-			return;
-		}
-		pending.push({ resolve, reject });
-		processPending();
-		if (pending.length === 1) {
-			// stdin is read once - all callers will get the same result
-
-			const chunks: Buffer[] = [];
-			process.stdin.setEncoding('utf8');
-			process.stdin
-				.on('data', chunk => {
-					if (stdinResult === null) {
-						chunks.push(chunk);
-					}
-				})
-				.on('end', () => {
-					if (stdinResult === null) {
-						stdinResult = chunks.join('');
-						chunks.length = 0;
-					}
-					processPending();
-				})
-				.on('error', err => {
-					if (stdinResult === null) {
-						stdinResult = err instanceof Error ? err : new Error(err);
-						chunks.length = 0;
-					}
-					processPending();
-				});
-			process.stdin.resume();
-		}
-	});
-
-	function processPending() {
-		if (stdinResult !== null) {
-			for (let it; (it = pending.shift()); ) {
-				if (typeof stdinResult == 'string') {
-					it.resolve(stdinResult);
-				} else {
-					it.reject(stdinResult);
-				}
-			}
-		}
-	}
-}
diff --git a/test/chunking-form/samples/mixed-synthetic-named-exports-2/_config.js b/test/chunking-form/samples/mixed-synthetic-named-exports-2/_config.js
index 2bc10bd7b..d076570b3 100644
--- a/test/chunking-form/samples/mixed-synthetic-named-exports-2/_config.js
+++ b/test/chunking-form/samples/mixed-synthetic-named-exports-2/_config.js
@@ -5,8 +5,7 @@ module.exports = {
 		plugins: [
 			{
 				transform(code, id) {
-					console.log(id);
-					if (id.endsWith('/dep1.js') || id.endsWith('/dep2.js')) {
+					if (id.endsWith('dep1.js') || id.endsWith('dep2.js')) {
 						return {
 							code,
 							syntheticNamedExports: true
diff --git a/test/chunking-form/samples/mixed-synthetic-named-exports/_config.js b/test/chunking-form/samples/mixed-synthetic-named-exports/_config.js
index eb2739602..b13731d1b 100644
--- a/test/chunking-form/samples/mixed-synthetic-named-exports/_config.js
+++ b/test/chunking-form/samples/mixed-synthetic-named-exports/_config.js
@@ -5,7 +5,7 @@ module.exports = {
 		plugins: [
 			{
 				resolveId(id) {
-					if (id === './dep1.js') {
+					if (id.endsWith('dep1.js')) {
 						return {
 							id,
 							syntheticNamedExports: true
diff --git a/test/chunking-form/samples/synthetic-named-exports/_config.js b/test/chunking-form/samples/synthetic-named-exports/_config.js
index 9327ae3aa..5c2ea3f35 100644
--- a/test/chunking-form/samples/synthetic-named-exports/_config.js
+++ b/test/chunking-form/samples/synthetic-named-exports/_config.js
@@ -5,13 +5,13 @@ module.exports = {
 		plugins: [
 			{
 				resolveId(id) {
-					if (id === './dep1.js') {
+					if (id.endsWith('dep1.js')) {
 						return id;
 					}
 					return null;
 				},
 				load(id) {
-					if (id === './dep1.js') {
+					if (id.endsWith('dep1.js')) {
 						return {
 							code: `
 const d = {
diff --git a/test/cli/index.js b/test/cli/index.js
index 10277dbc2..b89492bd6 100644
--- a/test/cli/index.js
+++ b/test/cli/index.js
@@ -23,19 +23,17 @@ runTestSuiteWithSamples(
 			done => {
 				process.chdir(config.cwd || dir);
 
-				const command = config.command
-					.replace(
-						/(^| )rollup /g,
-						`node ${path.resolve(__dirname, '../../dist/bin')}${path.sep}rollup `
-					)
-					.replace(
-						/(^| )shx /g,
-						`node ${path.resolve(__dirname, '../../node_modules/.bin')}${path.sep}shx `
-					);
+				const command = config.command.replace(
+					/(^| )rollup($| )/g,
+					`node ${path.resolve(__dirname, '../../dist/bin')}${path.sep}rollup `
+				);
 
 				const childProcess = exec(
 					command,
-					{ timeout: 40000, env: Object.assign({}, process.env, { FORCE_COLOR: '0' }, config.env) },
+					{
+						timeout: 40000,
+						env: Object.assign({}, process.env, { FORCE_COLOR: '0' }, config.env)
+					},
 					(err, code, stderr) => {
 						if (err && !err.killed) {
 							if (config.error) {
diff --git a/test/cli/samples/stdin-multiple-targets/_config.js b/test/cli/samples/stdin-multiple-targets/_config.js
deleted file mode 100644
index 4e4132f28..000000000
--- a/test/cli/samples/stdin-multiple-targets/_config.js
+++ /dev/null
@@ -1,4 +0,0 @@
-module.exports = {
-	description: 'uses stdin in multiple targets',
-	command: `shx echo "import {PRINT as p} from './a'; import C from  './b'; 0 && fail() || p(C); export {C as value, p as print}" | rollup -c`
-};
diff --git a/test/cli/samples/stdin-no-dash/_config.js b/test/cli/samples/stdin-no-dash/_config.js
deleted file mode 100644
index 33705242f..000000000
--- a/test/cli/samples/stdin-no-dash/_config.js
+++ /dev/null
@@ -1,4 +0,0 @@
-module.exports = {
-	description: 'stdin input with no dash on CLI',
-	command: `shx mkdir -p _actual && shx echo "0 && fail() || console.log('PASS');" | rollup > _actual/out.js`
-};
diff --git a/test/cli/samples/stdin-self-import/_config.js b/test/cli/samples/stdin-self-import/_config.js
deleted file mode 100644
index 691426d2b..000000000
--- a/test/cli/samples/stdin-self-import/_config.js
+++ /dev/null
@@ -1,4 +0,0 @@
-module.exports = {
-	description: 'stdin input of code that imports a copy of itself',
-	command: `shx mkdir -p _actual && shx cat input.txt | rollup -f cjs --silent > _actual/out.js`
-};
diff --git a/test/cli/samples/stdin-with-dash/_config.js b/test/cli/samples/stdin-with-dash/_config.js
deleted file mode 100644
index 140aa43e5..000000000
--- a/test/cli/samples/stdin-with-dash/_config.js
+++ /dev/null
@@ -1,4 +0,0 @@
-module.exports = {
-	description: 'stdin input with dash on CLI',
-	command: `shx mkdir -p _actual && shx echo "0 && fail() || console.log('PASS');" | rollup - > _actual/out.js`
-};
diff --git a/test/cli/samples/stdin/config-file/_config.js b/test/cli/samples/stdin/config-file/_config.js
new file mode 100644
index 000000000..09d1acef0
--- /dev/null
+++ b/test/cli/samples/stdin/config-file/_config.js
@@ -0,0 +1,6 @@
+module.exports = {
+	description:
+		'does not replace input with stdin but allows referencing it when using a config file',
+	skipIfWindows: true,
+	command: `echo "import {PRINT as p} from './a'; import C from  './b'; 0 && fail() || p(C); export {C as value, p as print}" | rollup -c`
+};
diff --git a/test/cli/samples/stdin-multiple-targets/_expected/cjs.js b/test/cli/samples/stdin/config-file/_expected/cjs.js
similarity index 100%
rename from test/cli/samples/stdin-multiple-targets/_expected/cjs.js
rename to test/cli/samples/stdin/config-file/_expected/cjs.js
diff --git a/test/cli/samples/stdin-multiple-targets/_expected/es.js b/test/cli/samples/stdin/config-file/_expected/es.js
similarity index 100%
rename from test/cli/samples/stdin-multiple-targets/_expected/es.js
rename to test/cli/samples/stdin/config-file/_expected/es.js
diff --git a/test/cli/samples/stdin/config-file/_expected/no-stdin.js b/test/cli/samples/stdin/config-file/_expected/no-stdin.js
new file mode 100644
index 000000000..cc5517597
--- /dev/null
+++ b/test/cli/samples/stdin/config-file/_expected/no-stdin.js
@@ -0,0 +1,3 @@
+const PRINT = x => console.log(x);
+
+export { PRINT };
diff --git a/test/cli/samples/stdin-multiple-targets/a.mjs b/test/cli/samples/stdin/config-file/a.mjs
similarity index 100%
rename from test/cli/samples/stdin-multiple-targets/a.mjs
rename to test/cli/samples/stdin/config-file/a.mjs
diff --git a/test/cli/samples/stdin-multiple-targets/b.mjs b/test/cli/samples/stdin/config-file/b.mjs
similarity index 100%
rename from test/cli/samples/stdin-multiple-targets/b.mjs
rename to test/cli/samples/stdin/config-file/b.mjs
diff --git a/test/cli/samples/stdin/config-file/rollup.config.js b/test/cli/samples/stdin/config-file/rollup.config.js
new file mode 100644
index 000000000..4590feac0
--- /dev/null
+++ b/test/cli/samples/stdin/config-file/rollup.config.js
@@ -0,0 +1,23 @@
+export default [
+	{
+		input: '-',
+		output: {
+			file: '_actual/cjs.js',
+			format: 'cjs'
+		}
+	},
+	{
+		input: '-',
+		output: {
+			file: '_actual/es.js',
+			format: 'esm'
+		}
+	},
+	{
+		input: 'a.mjs',
+		output: {
+			file: '_actual/no-stdin.js',
+			format: 'esm'
+		}
+	}
+];
diff --git a/test/cli/samples/stdin/force-stdin-tty/_config.js b/test/cli/samples/stdin/force-stdin-tty/_config.js
new file mode 100644
index 000000000..754e74be3
--- /dev/null
+++ b/test/cli/samples/stdin/force-stdin-tty/_config.js
@@ -0,0 +1,5 @@
+module.exports = {
+	description: 'allows forcing stdin input on TTY interfaces via option',
+	skipIfWindows: true,
+	command: `echo "console.log('PASS');" | ./wrapper.js -f es --stdin`
+};
diff --git a/test/cli/samples/stdin-no-dash/_expected/out.js b/test/cli/samples/stdin/force-stdin-tty/_expected.js
old mode 100644
new mode 100755
similarity index 100%
rename from test/cli/samples/stdin-no-dash/_expected/out.js
rename to test/cli/samples/stdin/force-stdin-tty/_expected.js
diff --git a/test/cli/samples/stdin/force-stdin-tty/wrapper.js b/test/cli/samples/stdin/force-stdin-tty/wrapper.js
new file mode 100755
index 000000000..e2ecc1dad
--- /dev/null
+++ b/test/cli/samples/stdin/force-stdin-tty/wrapper.js
@@ -0,0 +1,4 @@
+#!/usr/bin/env node
+
+process.stdin.isTTY = true;
+require('../../../../../dist/bin/rollup');
diff --git a/test/cli/samples/stdin/no-dash/_config.js b/test/cli/samples/stdin/no-dash/_config.js
new file mode 100644
index 000000000..bc97f7e72
--- /dev/null
+++ b/test/cli/samples/stdin/no-dash/_config.js
@@ -0,0 +1,5 @@
+module.exports = {
+	description: 'uses stdin input when piping into Rollup without an input',
+	skipIfWindows: true,
+	command: `echo "0 && fail() || console.log('PASS');" | rollup`
+};
diff --git a/test/cli/samples/stdin-with-dash/_expected/out.js b/test/cli/samples/stdin/no-dash/_expected.js
similarity index 100%
rename from test/cli/samples/stdin-with-dash/_expected/out.js
rename to test/cli/samples/stdin/no-dash/_expected.js
diff --git a/test/cli/samples/stdin/no-stdin-config-file/-.mjs b/test/cli/samples/stdin/no-stdin-config-file/-.mjs
new file mode 100644
index 000000000..f98de3b69
--- /dev/null
+++ b/test/cli/samples/stdin/no-stdin-config-file/-.mjs
@@ -0,0 +1 @@
+export const PRINT = x => console.log(x);
diff --git a/test/cli/samples/stdin/no-stdin-config-file/_config.js b/test/cli/samples/stdin/no-stdin-config-file/_config.js
new file mode 100644
index 000000000..069b2eca2
--- /dev/null
+++ b/test/cli/samples/stdin/no-stdin-config-file/_config.js
@@ -0,0 +1,5 @@
+module.exports = {
+	description: 'allows using "-" as a regular file name via flag',
+	skipIfWindows: true,
+	command: `echo "console.log('IGNORED');" | rollup -c --no-stdin`
+};
diff --git a/test/cli/samples/stdin/no-stdin-config-file/_expected/cjs.js b/test/cli/samples/stdin/no-stdin-config-file/_expected/cjs.js
new file mode 100644
index 000000000..ad2b476f9
--- /dev/null
+++ b/test/cli/samples/stdin/no-stdin-config-file/_expected/cjs.js
@@ -0,0 +1,7 @@
+'use strict';
+
+Object.defineProperty(exports, '__esModule', { value: true });
+
+const PRINT = x => console.log(x);
+
+exports.PRINT = PRINT;
diff --git a/test/cli/samples/stdin/no-stdin-config-file/_expected/esm.js b/test/cli/samples/stdin/no-stdin-config-file/_expected/esm.js
new file mode 100644
index 000000000..b60f5d94b
--- /dev/null
+++ b/test/cli/samples/stdin/no-stdin-config-file/_expected/esm.js
@@ -0,0 +1,3 @@
+const PRINT = x => console.log(x);
+
+PRINT('a');
diff --git a/test/cli/samples/stdin/no-stdin-config-file/a.mjs b/test/cli/samples/stdin/no-stdin-config-file/a.mjs
new file mode 100644
index 000000000..f16fe7135
--- /dev/null
+++ b/test/cli/samples/stdin/no-stdin-config-file/a.mjs
@@ -0,0 +1,3 @@
+import { PRINT } from './-.mjs';
+
+PRINT('a');
diff --git a/test/cli/samples/stdin-multiple-targets/rollup.config.js b/test/cli/samples/stdin/no-stdin-config-file/rollup.config.js
similarity index 66%
rename from test/cli/samples/stdin-multiple-targets/rollup.config.js
rename to test/cli/samples/stdin/no-stdin-config-file/rollup.config.js
index 5cc78cddb..ead39f6ea 100644
--- a/test/cli/samples/stdin-multiple-targets/rollup.config.js
+++ b/test/cli/samples/stdin/no-stdin-config-file/rollup.config.js
@@ -7,10 +7,10 @@ export default [
 		}
 	},
 	{
-		input: '-',
+		input: 'a.mjs',
 		output: {
-			file: '_actual/es.js',
-			format: 'es'
+			file: '_actual/esm.js',
+			format: 'esm'
 		}
 	}
 ];
diff --git a/test/cli/samples/stdin/no-stdin-tty/_config.js b/test/cli/samples/stdin/no-stdin-tty/_config.js
new file mode 100644
index 000000000..307da8e9b
--- /dev/null
+++ b/test/cli/samples/stdin/no-stdin-tty/_config.js
@@ -0,0 +1,10 @@
+const { assertStderrIncludes } = require('../../../../utils.js');
+
+module.exports = {
+	description: 'does not use input as stdin on TTY interfaces',
+	skipIfWindows: true,
+	command: `echo "console.log('PASS');" | ./wrapper.js -f es`,
+	error(err) {
+		assertStderrIncludes(err.message, 'You must supply options.input to rollup');
+	}
+};
diff --git a/test/cli/samples/stdin/no-stdin-tty/wrapper.js b/test/cli/samples/stdin/no-stdin-tty/wrapper.js
new file mode 100755
index 000000000..e2ecc1dad
--- /dev/null
+++ b/test/cli/samples/stdin/no-stdin-tty/wrapper.js
@@ -0,0 +1,4 @@
+#!/usr/bin/env node
+
+process.stdin.isTTY = true;
+require('../../../../../dist/bin/rollup');
diff --git a/test/cli/samples/stdin/self-import/_config.js b/test/cli/samples/stdin/self-import/_config.js
new file mode 100644
index 000000000..0d03f5350
--- /dev/null
+++ b/test/cli/samples/stdin/self-import/_config.js
@@ -0,0 +1,5 @@
+module.exports = {
+	description: 'stdin input of code that imports a copy of itself',
+	skipIfWindows: true,
+	command: `cat input.txt | rollup -f cjs --silent`
+};
diff --git a/test/cli/samples/stdin-self-import/_expected/out.js b/test/cli/samples/stdin/self-import/_expected.js
similarity index 100%
rename from test/cli/samples/stdin-self-import/_expected/out.js
rename to test/cli/samples/stdin/self-import/_expected.js
diff --git a/test/cli/samples/stdin-self-import/input.txt b/test/cli/samples/stdin/self-import/input.txt
similarity index 100%
rename from test/cli/samples/stdin-self-import/input.txt
rename to test/cli/samples/stdin/self-import/input.txt
diff --git a/test/cli/samples/stdin/stdin-error/_config.js b/test/cli/samples/stdin/stdin-error/_config.js
new file mode 100644
index 000000000..27f9e6c7a
--- /dev/null
+++ b/test/cli/samples/stdin/stdin-error/_config.js
@@ -0,0 +1,10 @@
+const { assertStderrIncludes } = require('../../../../utils.js');
+
+module.exports = {
+	description: 'handles stdin errors',
+	skipIfWindows: true,
+	command: `./wrapper.js`,
+	error(err) {
+		assertStderrIncludes(err.message, 'Could not load -: Stream is broken.');
+	}
+};
diff --git a/test/cli/samples/stdin/stdin-error/wrapper.js b/test/cli/samples/stdin/stdin-error/wrapper.js
new file mode 100755
index 000000000..3e06f3130
--- /dev/null
+++ b/test/cli/samples/stdin/stdin-error/wrapper.js
@@ -0,0 +1,13 @@
+#!/usr/bin/env node
+
+const { Readable } = require('stream');
+delete process.stdin;
+process.stdin = new Readable({
+	encoding: 'utf8',
+	read() {
+		const error = new Error('Stream is broken.');
+		return this.destroy ? this.destroy(error) : this.emit('error', error);
+	}
+});
+
+require('../../../../../dist/bin/rollup');
diff --git a/test/cli/samples/stdin/with-dash/_config.js b/test/cli/samples/stdin/with-dash/_config.js
new file mode 100644
index 000000000..332119cd6
--- /dev/null
+++ b/test/cli/samples/stdin/with-dash/_config.js
@@ -0,0 +1,5 @@
+module.exports = {
+	description: 'stdin input with dash on CLI',
+	skipIfWindows: true,
+	command: `echo "0 && fail() || console.log('PASS');" | rollup -`
+};
diff --git a/test/cli/samples/stdin/with-dash/_expected.js b/test/cli/samples/stdin/with-dash/_expected.js
new file mode 100644
index 000000000..80d7f8cb4
--- /dev/null
+++ b/test/cli/samples/stdin/with-dash/_expected.js
@@ -0,0 +1 @@
+console.log('PASS');
diff --git a/test/function/samples/stdin-not-present/_config.js b/test/function/samples/stdin-not-present/_config.js
deleted file mode 100644
index 9223e5c89..000000000
--- a/test/function/samples/stdin-not-present/_config.js
+++ /dev/null
@@ -1,23 +0,0 @@
-const savedStdin = process.stdin;
-
-module.exports = {
-	description: 'stdin reads should fail if process.stdin not present (as in a browser)',
-	options: {
-		input: '-'
-	},
-	before() {
-		delete process.stdin;
-	},
-	after() {
-		process.stdin = savedStdin;
-	},
-	error: {
-		// TODO we probably want a better error code here as this one is confusing
-		code: 'PLUGIN_ERROR',
-		hook: 'load',
-		// TODO the error message does not need to refer to browsers as there are other possible scenarios
-		message: 'Could not load -: stdin input is invalid in browser',
-		plugin: 'Rollup Core',
-		watchFiles: ['-']
-	}
-};
diff --git a/test/function/samples/stdin-not-present/main.js b/test/function/samples/stdin-not-present/main.js
deleted file mode 100644
index 65804ade9..000000000
--- a/test/function/samples/stdin-not-present/main.js
+++ /dev/null
@@ -1 +0,0 @@
-assert.equal( 1, 1 );
diff --git a/test/function/samples/stdin-read-error/_config.js b/test/function/samples/stdin-read-error/_config.js
deleted file mode 100644
index 0ad331458..000000000
--- a/test/function/samples/stdin-read-error/_config.js
+++ /dev/null
@@ -1,29 +0,0 @@
-const { Readable } = require('stream');
-const savedStdin = process.stdin;
-
-module.exports = {
-	description: 'stdin reads should fail if process.stdin not present (as in a browser)',
-	options: {
-		input: '-'
-	},
-	before() {
-		delete process.stdin;
-		process.stdin = new Readable({
-			encoding: 'utf8',
-			read() {
-				const error = new Error('Stream is broken.');
-				return this.destroy ? this.destroy(error) : this.emit('error', error);
-			}
-		});
-	},
-	after() {
-		process.stdin = savedStdin;
-	},
-	error: {
-		code: 'PLUGIN_ERROR',
-		hook: 'load',
-		message: 'Could not load -: Stream is broken.',
-		plugin: 'Rollup Core',
-		watchFiles: ['-']
-	}
-};
diff --git a/test/function/samples/stdin-read-error/main.js b/test/function/samples/stdin-read-error/main.js
deleted file mode 100644
index 65804ade9..000000000
--- a/test/function/samples/stdin-read-error/main.js
+++ /dev/null
@@ -1 +0,0 @@
-assert.equal( 1, 1 );
diff --git a/test/function/samples/stdin-watch/_config.js b/test/function/samples/stdin-watch/_config.js
deleted file mode 100644
index 0eaf68e5f..000000000
--- a/test/function/samples/stdin-watch/_config.js
+++ /dev/null
@@ -1,11 +0,0 @@
-module.exports = {
-	description: 'throws when using the "watch" option with stdin "-"',
-	options: {
-		input: '-',
-		watch: true
-	},
-	error: {
-		// TODO add an error code
-		message: 'watch mode is incompatible with stdin input'
-	}
-};
diff --git a/test/function/samples/stdin-watch/main.js b/test/function/samples/stdin-watch/main.js
deleted file mode 100644
index 65804ade9..000000000
--- a/test/function/samples/stdin-watch/main.js
+++ /dev/null
@@ -1 +0,0 @@
-assert.equal( 1, 1 );
diff --git a/test/misc/optionList.js b/test/misc/optionList.js
index 17211adb8..4ce0b814f 100644
--- a/test/misc/optionList.js
+++ b/test/misc/optionList.js
@@ -1,3 +1,3 @@
 exports.input = 'acorn, acornInjectPlugins, cache, chunkGroupingSize, context, experimentalCacheExpiry, experimentalOptimizeChunks, experimentalTopLevelAwait, external, inlineDynamicImports, input, manualChunks, moduleContext, onwarn, perf, plugins, preserveModules, preserveSymlinks, shimMissingExports, strictDeprecations, treeshake, watch';
-exports.flags = 'acorn, acornInjectPlugins, amd, assetFileNames, banner, c, cache, chunkFileNames, chunkGroupingSize, compact, config, context, d, dir, dynamicImportFunction, e, entryFileNames, environment, esModule, experimentalCacheExpiry, experimentalOptimizeChunks, experimentalTopLevelAwait, exports, extend, external, externalLiveBindings, f, file, footer, format, freeze, g, globals, h, i, indent, inlineDynamicImports, input, interop, intro, m, manualChunks, moduleContext, n, name, namespaceToStringTag, noConflict, o, onwarn, outro, paths, perf, plugins, preferConst, preserveModules, preserveSymlinks, shimMissingExports, silent, sourcemap, sourcemapExcludeSources, sourcemapFile, strict, strictDeprecations, treeshake, v, w, watch';
+exports.flags = 'acorn, acornInjectPlugins, amd, assetFileNames, banner, c, cache, chunkFileNames, chunkGroupingSize, compact, config, context, d, dir, dynamicImportFunction, e, entryFileNames, environment, esModule, experimentalCacheExpiry, experimentalOptimizeChunks, experimentalTopLevelAwait, exports, extend, external, externalLiveBindings, f, file, footer, format, freeze, g, globals, h, i, indent, inlineDynamicImports, input, interop, intro, m, manualChunks, moduleContext, n, name, namespaceToStringTag, noConflict, o, onwarn, outro, paths, perf, plugins, preferConst, preserveModules, preserveSymlinks, shimMissingExports, silent, sourcemap, sourcemapExcludeSources, sourcemapFile, stdin, strict, strictDeprecations, treeshake, v, w, watch';
 exports.output = 'amd, assetFileNames, banner, chunkFileNames, compact, dir, dynamicImportFunction, entryFileNames, esModule, exports, extend, externalLiveBindings, file, footer, format, freeze, globals, indent, interop, intro, name, namespaceToStringTag, noConflict, outro, paths, plugins, preferConst, sourcemap, sourcemapExcludeSources, sourcemapFile, sourcemapPathTransform, strict';
