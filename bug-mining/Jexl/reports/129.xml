<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:58:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-291] Using sandbox prevents array-syntax lookup by number in Map</title>
                <link>https://issues.apache.org/jira/browse/JEXL-291</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;p&gt;Using a JexlSandbox, even if it&apos;s a whitebox sandbox that allows everything, makes all array-syntax lookup by integer in a Map fail.&#160; The array lookup syntax for a String key still works.&lt;/p&gt;

&lt;p&gt;For example&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{&lt;span class=&quot;code-quote&quot;&gt;&apos;key&apos;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&apos;value&apos;&lt;/span&gt;}.[&lt;span class=&quot;code-quote&quot;&gt;&apos;key&apos;&lt;/span&gt;]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;can find &apos;value&apos;, but&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{1 : &lt;span class=&quot;code-quote&quot;&gt;&apos;value&apos;&lt;/span&gt;}[1]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;evaluates to null, instead of &apos;value&apos;.&lt;/p&gt;

&lt;p&gt;The problem seems to be that SandboxUberspect converts the property 1 to a String &quot;1&quot; when determining the name of the property and then, when it attempts to look up the value, it uses the String.&#160; The problem exists for getting and setting by array syntax.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Steps to Reproduce:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;This can be seen with a simple program:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Main {
&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] arguments) {
&#160;&#160;&#160;&#160;&#160;&#160;&#160; JexlEngine simpleJexlEngine = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().create();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; JexlExpression simpleExpression = simpleJexlEngine.createExpression(
           &lt;span class=&quot;code-quote&quot;&gt;&quot;{1:&lt;span class=&quot;code-quote&quot;&gt;&apos;one&apos;&lt;/span&gt;}[1]&quot;&lt;/span&gt;);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value = simpleExpression.evaluate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MapContext());
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;one&quot;&lt;/span&gt;.equals(value);

&#160;&#160;&#160;&#160;&#160;&#160;&#160; JexlEngine sandboxedJexlEngine = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().
           sandbox(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlSandbox(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)). &lt;span class=&quot;code-comment&quot;&gt;// add a whitebox sandbox
&lt;/span&gt;           create();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; JexlExpression sandboxedExpression =
           sandboxedJexlEngine.createExpression(
              &lt;span class=&quot;code-quote&quot;&gt;&quot;{1:&lt;span class=&quot;code-quote&quot;&gt;&apos;one&apos;&lt;/span&gt;}[1]&quot;&lt;/span&gt;);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; sandboxedValue = sandboxedExpression.evaluate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MapContext());
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;one&quot;&lt;/span&gt;.equals(sandboxedValue); &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;--- fails
&lt;/span&gt;&#160;&#160;&#160; }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Work-around&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;As the Java developer, I was able to work around this problem by creating a custom Uberspect that&apos;s a copy of SandboxUberspect, but has a different implementation for getPropertySet() and getPropertyGet().&#160; Instead of passing in &quot;actual&quot; to uberspect.getPropertySet() and uberspect.getPropertyGet() (which has been converted to a String), it passes in &quot;identifier&quot;, which is the original object.&#160; I don&apos;t understand the JEXL internals well enough to know if this is correct, though.&lt;/p&gt;

&lt;p&gt;As a JEXL programmer, I could only work around this by calling &quot;get&quot; and &quot;put&quot; on the Map object, instead of using the array syntax.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13215330">JEXL-291</key>
            <summary>Using sandbox prevents array-syntax lookup by number in Map</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrib">Henri Biestro</assignee>
                                    <reporter username="david_costanzo">David Costanzo</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Feb 2019 20:54:39 +0000</created>
                <updated>Mon, 7 Jun 2021 13:15:00 +0000</updated>
                            <resolved>Fri, 22 Mar 2019 17:21:46 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="16799202" author="henrib" created="Fri, 22 Mar 2019 17:21:46 +0000"  >&lt;p&gt;Changeset: c39f4cf674000f45c23597fa945a0421aac79cbf&lt;br/&gt;
Author:    henrib &amp;lt;henrib@apache.org&amp;gt;&lt;br/&gt;
Date:      2019-03-22 18:20&lt;br/&gt;
Message:   &lt;a href=&quot;https://issues.apache.org/jira/browse/JEXL-291&quot; title=&quot;Using sandbox prevents array-syntax lookup by number in Map&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JEXL-291&quot;&gt;&lt;del&gt;JEXL-291&lt;/del&gt;&lt;/a&gt;: use user-provided property object if sandbox does not change input&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0wv4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>