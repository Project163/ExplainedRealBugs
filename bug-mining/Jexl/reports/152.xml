<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:59:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-318] Annotation processing may fail in lexical mode</title>
                <link>https://issues.apache.org/jira/browse/JEXL-318</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;p&gt;I fave found that the annotation processing under certain conditions may lead to NPE&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;OptAnnotationContext &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; JexlEvalContext &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; JexlContext.AnnotationProcessor {
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; processAnnotation(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] args, Callable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; statement) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
            JexlOptions options = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getEngineOptions();
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; side effect &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; strict
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;scale&quot;&lt;/span&gt;.equals(name)) {
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; scale = options.getMathScale();
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; newScale = (&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;) args[0];
                options.setMathScale(newScale);
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; statement.call();
                } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                    options.setMathScale(scale);
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; statement.call();
        }
    }
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testAnnotation() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        JexlFeatures f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlFeatures();
        f.lexical(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        JexlEngine jexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().strict(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).features(f).create();
        JexlScript script = jexl.createScript(&lt;span class=&quot;code-quote&quot;&gt;&quot;@scale(13) @test &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; i = 42&quot;&lt;/span&gt;);
        JexlContext jc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OptAnnotationContext();
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; result = script.execute(jc);
        Assert.assertEquals(result, 42);
    }
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is because new instance of Interpeter is created to process annotation under certain conditions, and this new instance does not inherit the current lexical block. Furthermore, the constructor of InterperterBase &lt;tt&gt;InterpreterBase(InterpreterBase ii, JexlArithmetic jexla)&lt;/tt&gt; now silently ignores JexlArithmetic passed to it, which is possibly another bug.&lt;/p&gt;

&lt;p&gt;As a suggestion, can we refactor the code to simply make JexlArithmetic non final in InterpreterBase? There would be no need to create new instance of Interpeter and complicate code with sync-state code?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13279009">JEXL-318</key>
            <summary>Annotation processing may fail in lexical mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dmitri_blinov">Dmitri Blinov</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jan 2020 08:26:05 +0000</created>
                <updated>Mon, 7 Jun 2021 13:14:55 +0000</updated>
                            <resolved>Thu, 16 Jan 2020 13:39:38 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17016931" author="henrib" created="Thu, 16 Jan 2020 13:39:38 +0000"  >&lt;p&gt;Changeset: 12146f65fca5c24ac276c82e08b2ee52b3209225&lt;br/&gt;
Author:    henrib &amp;lt;henrib@apache.org&amp;gt;&lt;br/&gt;
Date:      2020-01-16 14:38&lt;br/&gt;
Message:   &lt;a href=&quot;https://issues.apache.org/jira/browse/JEXL-318&quot; title=&quot;Annotation processing may fail in lexical mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JEXL-318&quot;&gt;&lt;del&gt;JEXL-318&lt;/del&gt;&lt;/a&gt;: release notes and changes&lt;/p&gt;</comment>
                            <comment id="17016932" author="henrib" created="Thu, 16 Jan 2020 13:39:44 +0000"  >&lt;p&gt;Changeset: 1eefeb59e3f0d52aa011c29b1e18eee18e841049&lt;br/&gt;
Author:    henrib &amp;lt;henrib@apache.org&amp;gt;&lt;br/&gt;
Date:      2020-01-16 14:36&lt;br/&gt;
Message:   &lt;a href=&quot;https://issues.apache.org/jira/browse/JEXL-318&quot; title=&quot;Annotation processing may fail in lexical mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JEXL-318&quot;&gt;&lt;del&gt;JEXL-318&lt;/del&gt;&lt;/a&gt;: test&lt;/p&gt;</comment>
                            <comment id="17016935" author="henrib" created="Thu, 16 Jan 2020 13:39:56 +0000"  >&lt;p&gt;Changeset: bff5feb4e5680d8932155634e3adf989c8f17d8e&lt;br/&gt;
Author:    henrib &amp;lt;henrib@apache.org&amp;gt;&lt;br/&gt;
Date:      2020-01-16 14:34&lt;br/&gt;
Message:   &lt;a href=&quot;https://issues.apache.org/jira/browse/JEXL-318&quot; title=&quot;Annotation processing may fail in lexical mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JEXL-318&quot;&gt;&lt;del&gt;JEXL-318&lt;/del&gt;&lt;/a&gt;: added copy constructor&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 43 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0afq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>