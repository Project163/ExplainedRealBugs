<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:57:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-186] Performance regression in arithmetic operations compared to JEXL 2.1</title>
                <link>https://issues.apache.org/jira/browse/JEXL-186</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;p&gt;Compared to JEXL 2.1.1, arithmetic operations are slower in 3.0.&lt;/p&gt;

&lt;p&gt;The culprit is the logic around operators overloading; when the JexlArithmetic does not overload any operator, discovering whether it overloads one is repeated each time an interpreter is created (which is a costly introspection operation).&lt;/p&gt;

&lt;p&gt;As a workaround, one ca use an arithmetic that does overload an operator (for instance size) as in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JMeterArithmetic &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; JexlArithmetic {
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; JMeterArithmetic(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; astrict) {
            &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(astrict);
        }

        /**
         * A workaround to create an &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; overload
         * @param jma an improbable parameter class
         * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1
         */
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; size(JMeterArithmetic jma) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1;
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And use an instance of that class at engine creation time as in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        JexlEngine jexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder()
                    .cache(512)
                    .silent(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
                    .strict(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
                    .arithmetic(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JMeterArithmetic(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
                    .create();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12933387">JEXL-186</key>
            <summary>Performance regression in arithmetic operations compared to JEXL 2.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrib">Henri Biestro</assignee>
                                    <reporter username="p.mouawad@ubik-ingenierie.com">Philippe Mouawad</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jan 2016 16:27:52 +0000</created>
                <updated>Tue, 29 Jun 2021 06:59:18 +0000</updated>
                            <resolved>Sun, 31 Jan 2016 21:50:11 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15112694" author="henrib" created="Fri, 22 Jan 2016 17:06:35 +0000"  >&lt;p&gt;Correcting arithmetic operator overloading caching / discovery&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/internal/introspection/Uberspect.java&lt;br/&gt;
Committed revision 1726257.&lt;/p&gt;</comment>
                            <comment id="15112990" author="pmouawad" created="Fri, 22 Jan 2016 20:24:05 +0000"  >&lt;p&gt;Hello,&lt;br/&gt;
As per mailing list discussion, find the test case.&lt;br/&gt;
When I run the bench with JVM options:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;-XX:+PrintCompilation -XX:CICompilerCount=1 -Xbatch
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;JEXL2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;     60    1    b        java.lang.String::hashCode (55 bytes)
     67    2    b        java.lang.String::indexOf (70 bytes)
     83    3    b        sun.nio.cs.UTF_8$Encoder::encode (361 bytes)
     96    4    b        java.lang.String::charAt (29 bytes)
    101    5    b        java.lang.String::lastIndexOf (52 bytes)
    103    6    b        java.lang.String::indexOf (166 bytes)
    127    7    b        java.lang.String::lastIndexOf (151 bytes)
    134    8    b        java.lang.String::replace (127 bytes)
    150    9    b        sun.net.www.ParseUtil::encodePath (336 bytes)
    164   10    b        java.lang.String::equals (81 bytes)
    170   11    b        java.lang.Object::&amp;lt;init&amp;gt; (1 bytes)
    171   12    b        java.io.UnixFileSystem::normalize (75 bytes)
    176   13     n       java.lang.System::arraycopy (native)   (static)
    184   14    b        java.lang.String::startsWith (72 bytes)
    224   15    b        java.lang.String::length (6 bytes)
    229   16    b        java.lang.Math::min (11 bytes)
    260   17    b        java.util.HashMap::indexFor (6 bytes)
    261   18    b        java.util.HashMap::hash (55 bytes)
    263   19    b        java.lang.CharacterData::of (120 bytes)
    263   20    b        java.lang.CharacterDataLatin1::getProperties (11 bytes)
    277   21    b        java.lang.String::lastIndexOf (13 bytes)
    287   22    b        java.lang.Character::digit (6 bytes)
    287   23    b        java.lang.Character::digit (10 bytes)
    288   24    b        java.lang.CharacterDataLatin1::digit (91 bytes)
    289   25    b        java.lang.String::substring (79 bytes)
    290   26    b        org.apache.commons.jexl2.parser.SimpleNode::jjtGetChild (7 bytes)
    291   27    b        java.lang.Integer::parseInt (261 bytes)
    314   28    b        java.lang.String::&amp;lt;init&amp;gt; (15 bytes)
    315   29    b        java.util.HashMap::put (142 bytes)
    321   30    b        java.lang.Number::&amp;lt;init&amp;gt; (5 bytes)
    324   31    b        java.lang.Integer::stringSize (21 bytes)
    325   32    b        java.lang.Integer::getChars (131 bytes)
    331   33    b        org.apache.commons.jexl2.MapContext::set (13 bytes)
    331   34    b        org.apache.commons.jexl2.parser.SimpleNode::jjtGetNumChildren (17 bytes)
    331   35    b        java.lang.Integer::toString (8 bytes)
    335   36    b        java.lang.Integer::toString (48 bytes)
    337   37    b        java.math.BigInteger::longValue (32 bytes)
    352   38     n       java.lang.Thread::currentThread (native)   (static)
    358   39    b        java.lang.ref.Reference::get (5 bytes)
    358   40    b        java.lang.Float::isNaN (12 bytes)
    370   41    b        sun.misc.VM::isBooted (4 bytes)
    371   42    b        java.lang.Math::min (46 bytes)
    372   43    b        org.apache.commons.jexl2.parser.ASTNumberLiteral::jjtAccept (9 bytes)
    373   44    b        org.apache.commons.jexl2.Interpreter::visit (27 bytes)
    373   45    b        org.apache.commons.jexl2.parser.ASTNumberLiteral::getLiteral (5 bytes)
    373   46    b        org.apache.commons.jexl2.JexlArithmetic::isFloatingPointNumber (66 bytes)
    375   47    b        java.math.BigInteger::trustedStripLeadingZeroInts (37 bytes)
    376   48    b        org.apache.commons.jexl2.JexlArithmetic::toBigInteger (184 bytes)
    380   49    b        java.math.BigInteger::&amp;lt;init&amp;gt; (8 bytes)
    381   50    b        java.math.BigInteger::&amp;lt;init&amp;gt; (360 bytes)
    396   51    b        java.math.BigInteger::compareTo (71 bytes)
    400   52   !b        org.apache.commons.jexl2.Interpreter::visit (205 bytes)
    414   53    b        java.math.BigInteger::add (178 bytes)
    430   54    b        java.util.HashMap::getEntry (86 bytes)
    454   55    b        java.util.Arrays::copyOf (19 bytes)
    466   56    b        java.util.AbstractMap::&amp;lt;init&amp;gt; (15 bytes)
    467   57    b        java.util.HashMap::&amp;lt;init&amp;gt; (119 bytes)
    469   58    b        java.util.HashMap::&amp;lt;init&amp;gt; (9 bytes)
    475   59    b        java.lang.ref.SoftReference::get (29 bytes)
    476   60    b        java.lang.ThreadLocal::getMap (5 bytes)
    477   61    b        java.lang.ThreadLocal::access$400 (5 bytes)
    477   62    b        java.lang.ThreadLocal::get (34 bytes)
    481   63    b        java.util.LinkedHashMap::get (25 bytes)
    485   64    b        java.util.HashMap::initHashSeedAsNeeded (61 bytes)
    486   65    b        java.lang.Integer::highestOneBit (38 bytes)
    486   66    b        java.math.BigInteger::&amp;lt;init&amp;gt; (24 bytes)
    486   67    b        java.util.Hashtable::initHashSeedAsNeeded (61 bytes)
    487   68    b        java.lang.Integer::valueOf (54 bytes)
    488   69    b        java.util.Hashtable::&amp;lt;init&amp;gt; (135 bytes)
    490   70    b        java.util.Dictionary::&amp;lt;init&amp;gt; (5 bytes)
    490   71    b        java.util.Hashtable::&amp;lt;init&amp;gt; (9 bytes)
    491   72    b        java.lang.String::&amp;lt;init&amp;gt; (20 bytes)
    492   73    b        java.util.Properties::&amp;lt;init&amp;gt; (6 bytes)
    493   74    b        java.util.Properties::&amp;lt;init&amp;gt; (10 bytes)
    494   75    b        PerfJexl2::test (96 bytes)
    515   76    b        org.apache.commons.jexl2.MapContext::&amp;lt;init&amp;gt; (6 bytes)
    516   77    b        org.apache.commons.jexl2.MapContext::&amp;lt;init&amp;gt; (24 bytes)
    518   78    b        java.lang.Thread::getName (8 bytes)
    519   79    b        java.lang.String::valueOf (9 bytes)
    521   80    b        PerfJexl2::getJexlEngine (48 bytes)
    522   81    b        org.apache.commons.jexl2.JexlEngine::createExpression (7 bytes)
    525   82    b        org.apache.commons.jexl2.JexlEngine::createExpression (56 bytes)
    528   83   !b        org.apache.commons.jexl2.JexlEngine::parse (242 bytes)
    544   84    b        org.apache.commons.jexl2.JexlEngine::cleanExpression (81 bytes)
    548   85    b        java.lang.String::subSequence (7 bytes)
    550   86    b        java.lang.String::toString (2 bytes)
    550   87    b        org.apache.commons.jexl2.JexlEngine$SoftCache::get (38 bytes)
    554   88    b        org.apache.commons.jexl2.JexlEngine::createExpression (11 bytes)
    555   89    b        org.apache.commons.jexl2.ExpressionImpl::&amp;lt;init&amp;gt; (20 bytes)
    555   90    b        org.apache.commons.jexl2.ExpressionImpl::evaluate (50 bytes)
    558   91    b        org.apache.commons.jexl2.JexlEngine::createInterpreter (14 bytes)
    560   92    b        org.apache.commons.jexl2.JexlEngine::isStrict (13 bytes)
    561   93    b        org.apache.commons.jexl2.JexlEngine::isLenient (8 bytes)
    561   94    b        org.apache.commons.jexl2.JexlArithmetic::isLenient (13 bytes)
    561   95    b        org.apache.commons.jexl2.JexlEngine::isSilent (5 bytes)
    561   96    b        org.apache.commons.jexl2.JexlEngine::createInterpreter (22 bytes)
    562   97    b        org.apache.commons.jexl2.Interpreter::&amp;lt;init&amp;gt; (99 bytes)
    564   98    b        org.apache.commons.jexl2.parser.ASTJexlScript::createFrame (20 bytes)
    564   99    b        org.apache.commons.jexl2.Interpreter::setFrame (34 bytes)
    564  100   !b        org.apache.commons.jexl2.Interpreter::interpret (117 bytes)
    565  101    b        org.apache.commons.jexl2.parser.ASTAdditiveNode::jjtAccept (9 bytes)
    566  102    b        java.math.BigInteger::add (123 bytes)
    568  103    b        org.apache.commons.jexl2.JexlArithmetic::narrowBigInteger (87 bytes)
    582  104 %  b        PerfJexl2::bench @ 9 (54 bytes)
    587   29             java.util.HashMap::put (142 bytes)   made not entrant
    587  104 %           PerfJexl2::bench @ -2 (54 bytes)   made not entrant
Time:505ms
    587  105    b        PerfJexl2::bench (54 bytes)
    591  106    b        java.util.HashMap$Entry::&amp;lt;init&amp;gt; (26 bytes)
    591  107    b        java.util.HashMap::addEntry (69 bytes)
    597  108 %  b        PerfJexl2::bench @ 9 (54 bytes)
    605  109    b        java.util.HashMap::put (142 bytes)
Time:34ms
Time:15ms
Time:15ms
Time:8ms
Time:7ms
Time:7ms
Time:7ms
Time:9ms
Time:7ms
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;JEXL3:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-none&quot;&gt;     65    1    b        java.lang.String::hashCode (55 bytes)
     72    2    b        java.lang.String::indexOf (70 bytes)
     88    3    b        sun.nio.cs.UTF_8$Encoder::encode (361 bytes)
     98    4    b        java.lang.String::charAt (29 bytes)
    106    5    b        java.lang.String::lastIndexOf (52 bytes)
    110    6    b        java.lang.String::indexOf (166 bytes)
    134    7    b        java.lang.String::lastIndexOf (151 bytes)
    142    8    b        java.lang.String::replace (127 bytes)
    153    9    b        sun.net.www.ParseUtil::encodePath (336 bytes)
    170   10    b        java.lang.String::equals (81 bytes)
    175   11    b        java.io.UnixFileSystem::normalize (75 bytes)
    178   12    b        java.lang.Object::&amp;lt;init&amp;gt; (1 bytes)
    180   13     n       java.lang.System::arraycopy (native)   (static)
    186   14    b        java.lang.String::startsWith (72 bytes)
    216   15    b        java.lang.Math::min (11 bytes)
    243   16    b        java.lang.String::length (6 bytes)
    268   17    b        java.util.HashMap::getEntry (86 bytes)
    276   18    b        java.util.HashMap::get (29 bytes)
    285   19    b        org.apache.commons.jexl3.internal.introspection.Uberspect::getArithmetic (219 bytes)
    298   20     n       java.lang.Thread::currentThread (native)   (static)
    300   21    b        java.util.concurrent.locks.AbstractQueuedSynchronizer::getState (5 bytes)
    301   22     n       sun.misc.Unsafe::compareAndSwapInt (native)   
    301   23    b        java.util.concurrent.locks.AbstractQueuedSynchronizer::compareAndSetState (13 bytes)
    303   24    b        java.util.concurrent.locks.ReentrantReadWriteLock::readLock (5 bytes)
    303   25    b        java.util.concurrent.locks.ReentrantReadWriteLock::readLock (5 bytes)
    311   26    b        java.util.HashMap::indexFor (6 bytes)
    313   27    b        java.lang.ref.Reference::get (5 bytes)
    316   28    b        java.lang.ref.SoftReference::get (29 bytes)
    319   29    b        java.util.concurrent.locks.ReentrantReadWriteLock$Sync::exclusiveCount (5 bytes)
    319   30   !b        org.apache.commons.jexl3.internal.introspection.Uberspect::base (103 bytes)
    320   31   !b        org.apache.commons.jexl3.internal.introspection.Introspector::getMap (161 bytes)
    328   32    b        java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock::lock (9 bytes)
    330   33    b        java.util.concurrent.locks.AbstractQueuedSynchronizer::acquireShared (14 bytes)
    332   34    b        java.util.concurrent.locks.ReentrantReadWriteLock$Sync::tryAcquireShared (177 bytes)
    333   35    b        java.util.concurrent.locks.ReentrantReadWriteLock$Sync::sharedCount (5 bytes)
    334   36    b        java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync::readerShouldBlock (5 bytes)
    334   37    b        java.util.concurrent.locks.AbstractQueuedSynchronizer::apparentlyFirstQueuedIsExclusive (38 bytes)
    334   38    b        java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock::unlock (10 bytes)
    336   39    b        java.util.concurrent.locks.AbstractQueuedSynchronizer::releaseShared (16 bytes)
    337   40    b        java.util.concurrent.locks.ReentrantReadWriteLock$Sync::tryReleaseShared (147 bytes)
    338   41    b        java.util.concurrent.locks.AbstractQueuedSynchronizer::doReleaseShared (79 bytes)
    344   42    b        java.util.HashMap::hash (55 bytes)
    382   43  s b        java.lang.Throwable::getOurStackTrace (80 bytes)
    392   44     n       java.lang.Throwable::getStackTraceElement (native)   
    393   45    b        java.lang.String::startsWith (7 bytes)
    410   46    b        java.lang.AbstractStringBuilder::ensureCapacityInternal (16 bytes)
    424   47    b        java.lang.StackTraceElement::getClassName (5 bytes)
    424   48    b        java.lang.String::getChars (62 bytes)
    425   49    b        java.lang.AbstractStringBuilder::append (48 bytes)
    438   50    b        java.lang.StringBuilder::append (8 bytes)
    453   51    b        org.apache.commons.jexl3.JexlEngine::createInfo (144 bytes)
    477   52     n       java.lang.Object::clone (native)   
    484   53    b        java.lang.CharacterData::of (120 bytes)
    484   54    b        java.lang.CharacterDataLatin1::getProperties (11 bytes)
    486   55    b        java.util.HashMap::put (142 bytes)
    505   56    b        org.apache.commons.jexl3.parser.SimpleNode::jjtGetChild (7 bytes)
    506   57    b        org.apache.commons.jexl3.MapContext::set (13 bytes)
    507   58    b        java.math.BigInteger::longValue (32 bytes)
    539   59    b        java.lang.Float::isNaN (12 bytes)
    560   60     n       java.lang.Throwable::fillInStackTrace (native)   
    564   61    b        sun.misc.VM::isBooted (4 bytes)
    566   62    b        java.lang.Math::min (46 bytes)
    568   63    b        java.math.BigInteger::valueOf (62 bytes)
    571   64    b        java.util.concurrent.atomic.AtomicInteger::get (5 bytes)
    571   65    b        java.lang.Character::getType (9 bytes)
    572   66    b        java.lang.CharacterDataLatin1::getType (11 bytes)
    573   67    b        java.lang.Character::isSpaceChar (5 bytes)
    573   68    b        java.lang.Character::isSpaceChar (19 bytes)
    574   69    b        org.apache.commons.jexl3.internal.Engine::getUberspect (5 bytes)
    574   70    b        org.apache.commons.jexl3.internal.introspection.Uberspect::getVersion (8 bytes)
    575   71    b        java.util.concurrent.atomic.AtomicInteger::intValue (5 bytes)
    575   72    b        org.apache.commons.jexl3.parser.ASTNumberLiteral::jjtAccept (7 bytes)
    575   73    b        org.apache.commons.jexl3.internal.Interpreter::visit (27 bytes)
    576   74    b        org.apache.commons.jexl3.parser.ASTNumberLiteral::getLiteral (8 bytes)
    576   75    b        org.apache.commons.jexl3.parser.NumberParser::getLiteralValue (5 bytes)
    576   76    b        org.apache.commons.jexl3.JexlArithmetic::isFloatingPointNumber (116 bytes)
    577   77    b        org.apache.commons.jexl3.JexlArithmetic::toBigInteger (219 bytes)
    579   78    b        java.lang.Integer::longValue (6 bytes)
    579   79    b        java.math.BigInteger::compareTo (71 bytes)
    582   80    b        java.math.BigInteger::add (178 bytes)
    638   81    b        java.lang.String::substring (79 bytes)
    652   82    b        java.util.Arrays::copyOf (19 bytes)
    655   83  s b        java.lang.Throwable::fillInStackTrace (29 bytes)
    667   84     n       java.lang.Object::hashCode (native)   
    692   85    b        java.util.AbstractCollection::&amp;lt;init&amp;gt; (5 bytes)
    698   86    b        java.util.AbstractMap::&amp;lt;init&amp;gt; (15 bytes)
    699   87    b        java.util.HashMap::&amp;lt;init&amp;gt; (119 bytes)
    701   88    b        java.util.HashMap::&amp;lt;init&amp;gt; (9 bytes)
    704   89    b        java.util.AbstractSet::&amp;lt;init&amp;gt; (5 bytes)
    711   90     n       sun.misc.Unsafe::getObjectVolatile (native)   
    724   91    b        java.util.concurrent.ConcurrentHashMap::hash (81 bytes)
    728   92    b        java.lang.String::&amp;lt;init&amp;gt; (15 bytes)
    733   93    b        java.lang.Number::&amp;lt;init&amp;gt; (5 bytes)
    736   94    b        java.lang.ThreadLocal::getMap (5 bytes)
    737   95    b        java.lang.ThreadLocal::access$400 (5 bytes)
    737   96    b        java.lang.ThreadLocal::get (34 bytes)
    748   97    b        java.util.LinkedHashMap::get (25 bytes)
    753   98    b        java.util.HashMap::initHashSeedAsNeeded (61 bytes)
    754   99    b        java.lang.Integer::highestOneBit (38 bytes)
    754  100    b        java.lang.Integer::stringSize (21 bytes)
    756  101    b        sun.misc.SharedSecrets::getJavaLangAccess (4 bytes)
    756  102    b        java.lang.Integer::getChars (131 bytes)
    763  103    b        java.util.concurrent.ConcurrentHashMap::get (141 bytes)
    766  104    b        java.math.BigInteger::&amp;lt;init&amp;gt; (24 bytes)
    766  105    b        java.util.Hashtable::initHashSeedAsNeeded (61 bytes)
    767  106    b        java.lang.Integer::valueOf (54 bytes)
    768  107    b        java.util.Hashtable::&amp;lt;init&amp;gt; (135 bytes)
    770  108    b        java.util.Dictionary::&amp;lt;init&amp;gt; (5 bytes)
    770  109    b        java.util.Hashtable::&amp;lt;init&amp;gt; (9 bytes)
    771  110    b        java.lang.String::&amp;lt;init&amp;gt; (20 bytes)
    773  111    b        java.util.Properties::&amp;lt;init&amp;gt; (6 bytes)
    774  112    b        java.util.Properties::&amp;lt;init&amp;gt; (10 bytes)
    775  113    b        org.apache.commons.jexl3.parser.SimpleNode::jjtGetNumChildren (17 bytes)
    775  114   !b        java.lang.Class::getEnumConstantsShared (76 bytes)
    776  115    b        org.apache.commons.jexl3.JexlOperator::values (10 bytes)
    776  116    b        PerfJexl3::test (96 bytes)
    806  117    b        org.apache.commons.jexl3.MapContext::&amp;lt;init&amp;gt; (6 bytes)
    807  118    b        org.apache.commons.jexl3.MapContext::&amp;lt;init&amp;gt; (24 bytes)
    808  119    b        java.lang.Thread::getName (8 bytes)
    811  120    b        java.lang.String::valueOf (9 bytes)
    812  121    b        PerfJexl3::getJexlEngine (48 bytes)
    814  122    b        org.apache.commons.jexl3.JexlEngine::createExpression (7 bytes)
    827  123    b        org.apache.commons.jexl3.internal.Engine::createExpression (7 bytes)
    837  124    b        org.apache.commons.jexl3.internal.Engine::createExpression (59 bytes)
    847  125     n       java.lang.Throwable::getStackTraceDepth (native)   
    847  126    b        org.apache.commons.jexl3.internal.Engine::trimSource (85 bytes)
    855  127    b        java.lang.String::subSequence (7 bytes)
    858  128    b        java.lang.String::toString (2 bytes)
    859  129   !b        org.apache.commons.jexl3.internal.Engine::parse (140 bytes)
    872  130    b        org.apache.commons.jexl3.internal.Engine$SoftCache::get (38 bytes)
    877  131    b        org.apache.commons.jexl3.parser.ASTJexlScript::getScope (5 bytes)
    877  132    b        org.apache.commons.jexl3.internal.Script::&amp;lt;init&amp;gt; (36 bytes)
    878  133    b        org.apache.commons.jexl3.internal.Script::evaluate (46 bytes)
    880  134    b        org.apache.commons.jexl3.internal.Script::checkCacheVersion (34 bytes)
    881  135    b        org.apache.commons.jexl3.internal.Script::createFrame (9 bytes)
    882  136    b        org.apache.commons.jexl3.parser.ASTJexlScript::createFrame (28 bytes)
    882  137    b        org.apache.commons.jexl3.internal.Script::createInterpreter (10 bytes)
    889  138    b        org.apache.commons.jexl3.internal.Engine::createInterpreter (11 bytes)
    893  139    b        org.apache.commons.jexl3.internal.Interpreter::&amp;lt;init&amp;gt; (283 bytes)
    898  140    b        org.apache.commons.jexl3.parser.ParserVisitor::&amp;lt;init&amp;gt; (5 bytes)
    898  141    b        org.apache.commons.jexl3.internal.Engine::isStrict (5 bytes)
    898  142    b        org.apache.commons.jexl3.internal.Engine::isSilent (5 bytes)
    898  143    b        org.apache.commons.jexl3.JexlArithmetic::isStrict (5 bytes)
    898  144    b        org.apache.commons.jexl3.internal.Operators::&amp;lt;init&amp;gt; (31 bytes)
    899  145    b        java.util.EnumSet::noneOf (63 bytes)
    901  146    b        java.util.EnumSet::getUniverse (10 bytes)
    901  147    b        java.lang.System$2::getEnumConstantsShared (8 bytes)
    902  148    b        java.util.RegularEnumSet::&amp;lt;init&amp;gt; (12 bytes)
    902  149    b        java.util.EnumSet::&amp;lt;init&amp;gt; (15 bytes)
    903  150    b        java.util.HashMap::getForNullKey (42 bytes)
    903  151    b        java.util.RegularEnumSet::isEmpty (15 bytes)
    903  152   !b        org.apache.commons.jexl3.internal.Interpreter::interpret (623 bytes)
    944  153    b        org.apache.commons.jexl3.parser.ASTAddNode::jjtAccept (7 bytes)
    978  154   !b        org.apache.commons.jexl3.internal.Interpreter::visit (88 bytes)
   1009  155   !b        org.apache.commons.jexl3.internal.Operators::tryOverload (159 bytes)
   1010  156   !b        org.apache.commons.jexl3.JexlArithmetic::add (215 bytes)
   1034  157    b        java.math.BigInteger::add (123 bytes)
   1037  158    b        org.apache.commons.jexl3.JexlArithmetic::narrowBigInteger (87 bytes)
   1047  159    b        java.lang.Integer::toString (8 bytes)
   1050  160    b        java.lang.Integer::toString (48 bytes)
   1106  161 %  b        PerfJexl3::bench @ 9 (54 bytes)
   1165   55             java.util.HashMap::put (142 bytes)   made not entrant
   1165  161 %           PerfJexl3::bench @ -2 (54 bytes)   made not entrant
Time:1077ms
   1165  162    b        PerfJexl3::bench (54 bytes)
   1172  163    b        java.util.HashMap$Entry::&amp;lt;init&amp;gt; (26 bytes)
   1172  164    b        java.util.HashMap::addEntry (69 bytes)
   1186  165 %  b        PerfJexl3::bench @ 9 (54 bytes)
   1218  166    b        java.util.HashMap::put (142 bytes)
Time:199ms
Time:169ms
Time:172ms
Time:171ms
Time:168ms
Time:167ms
Time:176ms
Time:175ms
Time:171ms

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15113103" author="henrib" created="Fri, 22 Jan 2016 21:22:00 +0000"  >&lt;p&gt;Big slowdown comes from &apos;debug&apos; mode which creates exceptions to capture stack trace.&lt;br/&gt;
Try this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;JexlEngine jexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder()
                    .cache(512)
                    .debug(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
                    .silent(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
                    .strict(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
                    .arithmetic(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JMeterArithmetic(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;))
                    .create();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15113142" author="henrib" created="Fri, 22 Jan 2016 21:40:46 +0000"  >&lt;p&gt;Reduced benchmarks to their gist; creating the script in the loop or out does not radically change the performance profile. &lt;/p&gt;</comment>
                            <comment id="15113164" author="pmouawad" created="Fri, 22 Jan 2016 21:45:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=henrib&quot; class=&quot;user-hover&quot; rel=&quot;henrib&quot;&gt;henrib&lt;/a&gt;,&lt;br/&gt;
It&apos;s now ok with JMeterArithmetic and debug(false)&lt;br/&gt;
Bug shouldn&apos;t debug be false by default ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;
</comment>
                            <comment id="15113188" author="henrib" created="Fri, 22 Jan 2016 21:59:56 +0000"  >&lt;p&gt;Better yet - than debug(false) - is to create expressions / scripts with a JexlInfo that can then be used to track locations of errors.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; e = engine.createExpression(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlInfo(&lt;span class=&quot;code-quote&quot;&gt;&quot;JEXL-186&quot;&lt;/span&gt;, 1, 1), &lt;span class=&quot;code-quote&quot;&gt;&quot;1+2&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15125529" author="henrib" created="Sun, 31 Jan 2016 21:50:11 +0000"  >&lt;p&gt;The code is corrected in the trunk; there is a workaround in the worst (immediate) case using a customized JexlArithmetic.&lt;br/&gt;
About changing the default creation flags, my experience with integrating JEXL means tailoring the startup engine sequence anyway. The current default generates some useful information in case of errors...&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12783929" name="PerfJexl2.java" size="948" author="henrib" created="Fri, 22 Jan 2016 21:40:46 +0000"/>
                            <attachment id="12783905" name="PerfJexl2.java" size="1806" author="pmouawad" created="Fri, 22 Jan 2016 20:24:05 +0000"/>
                            <attachment id="12783931" name="PerfJexl3.java" size="1454" author="henrib" created="Fri, 22 Jan 2016 21:43:25 +0000"/>
                            <attachment id="12783904" name="PerfJexl3.java" size="1880" author="pmouawad" created="Fri, 22 Jan 2016 20:24:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rup3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>