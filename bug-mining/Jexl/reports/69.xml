<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:57:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-193] InterruptedException is swallowed in function call in silent and non-strict mode</title>
                <link>https://issues.apache.org/jira/browse/JEXL-193</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;p&gt;The following test case fails with &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.AssertionError: Values should be different. Actual: 42
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failEquals(Assert.java:185)
	at org.junit.Assert.assertNotEquals(Assert.java:161)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestContext &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; MapContext &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; JexlContext.NamespaceResolver {

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; interrupt() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InterruptedException();
        }
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testInterrupt() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        JexlEngine jexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().arithmetic(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlArithmetic(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)).strict(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).silent(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).create();
        JexlScript e = jexl.createScript(&lt;span class=&quot;code-quote&quot;&gt;&quot;interrupt(); &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 42&quot;&lt;/span&gt;);
        Callable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; c = e.callable(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestContext());

        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; t = c.call();
        Assert.assertNotEquals(42, t);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expected behaviour is to cancel script execution&lt;/p&gt;</description>
                <environment></environment>
        <key id="12959371">JEXL-193</key>
            <summary>InterruptedException is swallowed in function call in silent and non-strict mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrib">Henri Biestro</assignee>
                                    <reporter username="dmitri_blinov">Dmitri Blinov</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Apr 2016 09:55:28 +0000</created>
                <updated>Tue, 29 Jun 2021 06:59:22 +0000</updated>
                            <resolved>Tue, 10 May 2016 19:06:39 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15245913" author="dmitri_blinov" created="Mon, 18 Apr 2016 16:11:39 +0000"  >&lt;p&gt;I&apos;ve been able to fix it locally by patching Interpreter.java &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; interpret(JexlNode node) {
    ....
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (JexlException xjexl) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (xjexl &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; JexlException.Cancel) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; xjexl;
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (silent) {
                logger.warn(xjexl.getMessage(), xjexl.getCause());
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; xjexl.clean();
        ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and adding additional catch &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; call(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JexlNode node, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; target, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; functor, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ASTArguments argNode) {
        ...
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InvocationTargetException ite) {

            Throwable targetException = ite.getTargetException();

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (targetException &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; InterruptedException) {
               &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlException.Cancel(node);
            }

            xjexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlException(node, methodName, ite);
      ....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Hope this&apos;ll help to fix it...&lt;/p&gt;</comment>
                            <comment id="15262181" author="henrib" created="Thu, 28 Apr 2016 14:03:10 +0000"  >&lt;p&gt;Refined handling of interruption (InterruptedException handling &amp;amp; interrupted()), more checks around cancellation (blocks,set/map/array literals), refactored internal Callable, more tests&lt;/p&gt;

&lt;p&gt;Revision: 1741426&lt;/p&gt;

&lt;p&gt;RELEASE-NOTES.txt&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/internal/Closure.java&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/internal/Interpreter.java&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/internal/Script.java&lt;br/&gt;
src/site/xdoc/changes.xml&lt;br/&gt;
src/test/java/org/apache/commons/jexl3/IssuesTest.java&lt;br/&gt;
src/test/java/org/apache/commons/jexl3/ScriptCallableTest.java&lt;/p&gt;

</comment>
                            <comment id="15271930" author="dmitri_blinov" created="Thu, 5 May 2016 06:00:05 +0000"  >&lt;p&gt;I wonder should we also check for thread cancellation just before returning a value from script, so as to guarantee that if thread have been cancelled no value is returned by JEXL&lt;/p&gt;</comment>
                            <comment id="15271997" author="dmitri_blinov" created="Thu, 5 May 2016 07:10:53 +0000"  >&lt;p&gt;BTW, I just have noticed that cancellation exception is still not thrown in Interpreter.interpret() in silent or non-strict mode. While I understand the conception&lt;br/&gt;
of silent execution I think exceptions like InterruptedException or OutOfMemoryError are kind of special (exceptional exceptions, he-he), and the invoking code should be informed no matter what mode jexl is configured with if such an exception was taken place &lt;/p&gt;</comment>
                            <comment id="15273990" author="henrib" created="Fri, 6 May 2016 12:53:35 +0000"  >&lt;p&gt;On checking cancellation when handling &apos;return&apos;;  if the return argument evaluation did not throw a cancel exception, we have a result and we were not interrupted. Not sure what we&apos;d functionally gain by an extra check.&lt;br/&gt;
On the exception throwing when cancellation/interruption occur, do you have a use-case that suffers from the current behavior? Asynchronous/cancellable execution is best handled through Future&amp;lt;&amp;gt; which seemingly shield this detail.&lt;br/&gt;
OOM is an error you can (at least, will) not recover from, InterruptedException are (should be, at least in many useful scenarios) recoverable . &lt;/p&gt;</comment>
                            <comment id="15274264" author="dmitri_blinov" created="Fri, 6 May 2016 15:58:39 +0000"  >&lt;p&gt;Suppose we have a multi-threaded system where each request is processed by some thread from the pool, and we have a policy for each request not to take longer then specified amount of time, and for requests that are not able to complete within the specified period we want those requests to be interrupted. That may be implemented by invoking Thread.interrupt() which by design should cancel all outstanding processing. If by chance the request is using jexl scripting when thread was interrupted, I expect jexl not only to break current script execution but somehow to notify me that the script processing has been ended unexpectedly, so I could decide how this should be handled, possibly rolling back pending transaction etc. As I see now from the code that exception is only thrown by in non-silent mode. If I chose to use silent mode to suit some other purposes, I&apos;ll never know that the thread was interrupted.&lt;/p&gt;</comment>
                            <comment id="15274284" author="henrib" created="Fri, 6 May 2016 16:10:54 +0000"  >&lt;p&gt;Use a Future and a call get with a timeout to implement this behavior and everything is taken care of; you receive a TimeoutException if it took too long. Look at tests in ScriptCallableTest for some examples.&lt;/p&gt;</comment>
                            <comment id="15274295" author="dmitri_blinov" created="Fri, 6 May 2016 16:17:22 +0000"  >&lt;p&gt;As I understand that will be only one part of the solution. From the point of monitoring thread I will know the executing thread has timed out, the problem is that will just not prevent the executing thread from continuing. The solution still needs the other part, to allow the executing thread to know it was interrupted and need not to continue. In silent mode jexl will break script execution but will clear thread&apos;s interrupted state and return null instead of throwing exception. From the point of executing thread the returned null may be a valid result, not a signal about something went wrong. So the executing thread will never know it is timed out and continue its transaction as normal.&lt;/p&gt;</comment>
                            <comment id="15274308" author="henrib" created="Fri, 6 May 2016 16:29:28 +0000"  >&lt;p&gt;Call future.cance(true) in the TimeoutException handling.&lt;/p&gt;</comment>
                            <comment id="15274354" author="dmitri_blinov" created="Fri, 6 May 2016 17:05:25 +0000"  >&lt;p&gt;Future.cancel(true) will &lt;b&gt;attempt&lt;/b&gt; to stop the task by invoking Thread.interrupt() for executing thread. Whether the executing thread will stop or not depends on how it is implemented. Jexl will check that thread is interrupted, break current script execution, but if in silent mode, will clear thread&apos;s interrupted state and return null. So the thread &lt;b&gt;will not&lt;/b&gt; stop. If jexl is in non-silent mode, it will clear thread&apos;s interrupted state but throw Cancel exception. I can catch Cancel exception and re-throw InterruptedException instead and the thread eventually &lt;b&gt;will&lt;/b&gt; stop. What I&apos;m trying to propose is that jexl should throw Cancel exception regardless of its mode, silent or non-silent, to let me know it was interrupted during execution.&lt;/p&gt;</comment>
                            <comment id="15274434" author="henrib" created="Fri, 6 May 2016 17:46:40 +0000"  >&lt;p&gt;Jexl will break current script execution, the callable call method will return null, the thread returned to the executor pool in the examples or ready to be joined (i.e. thread has stopped).&lt;/p&gt;</comment>
                            <comment id="15274488" author="dmitri_blinov" created="Fri, 6 May 2016 18:11:16 +0000"  >&lt;p&gt;I think correct test case should be this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestContext &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; MapContext &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; JexlContext.NamespaceResolver {

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; interrupt() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InterruptedException();
        }
    }

@Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testInterrupt() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        JexlEngine jexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().arithmetic(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlArithmetic(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)).strict(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).silent(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).create();
        JexlScript e = jexl.createScript(&lt;span class=&quot;code-quote&quot;&gt;&quot;interrupt(); &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 42&quot;&lt;/span&gt;);
        Callable&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; c = e.callable(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestContext());
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
           &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; t = c.call();
           Assert.fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Should have thrown JexlException.Cancel&quot;&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (JexlException.Cancel je) {
           &lt;span class=&quot;code-comment&quot;&gt;// Fine
&lt;/span&gt;        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15278586" author="henrib" created="Tue, 10 May 2016 18:03:09 +0000"  >&lt;p&gt;Conclusion is that we need another flag to control how &apos;cancellation&apos; is handled. The specification is the following:&lt;/p&gt;

&lt;p&gt;The &apos;cancellable&apos; option - accessible through the JexlBuilder &amp;amp; JexlEngine.Options - determines what happens when a script/expression/callable/closure is interrupted or cancelled during evaluation. When cancellable is true, a JexlException.Cancel is thrown; when false, the script execution stops and returns null.&lt;br/&gt;
Default behavior is to be cancellable when verbose (i.e. not silent, throw exceptions on errors)  and strict (considering interrupt as an error).&lt;/p&gt;</comment>
                            <comment id="15278692" author="henrib" created="Tue, 10 May 2016 19:06:39 +0000"  >
&lt;p&gt;Fixing &lt;a href=&quot;https://issues.apache.org/jira/browse/JEXL-193&quot; title=&quot;InterruptedException is swallowed in function call in silent and non-strict mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JEXL-193&quot;&gt;&lt;del&gt;JEXL-193&lt;/del&gt;&lt;/a&gt; take 2; added a cancellable flag that controls whether JexlException.Cancel are throw when evaluation is interrupted/cancelled.&lt;/p&gt;

&lt;p&gt;src/main/java/org/apache/commons/jexl3/JexlBuilder.java&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/JexlEngine.java&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/internal/Engine.java&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/internal/Interpreter.java&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/internal/Script.java&lt;br/&gt;
src/test/java/org/apache/commons/jexl3/JexlEvalContext.java&lt;br/&gt;
src/test/java/org/apache/commons/jexl3/ReadonlyContext.java&lt;br/&gt;
src/test/java/org/apache/commons/jexl3/ScriptCallableTest.java&lt;/p&gt;

&lt;p&gt;Committed revision 1743249.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2w7p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>