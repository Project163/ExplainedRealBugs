<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:59:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-330] JexlException.Parsing.getMessage() throws StringIndexOutOfBoundsException when parse error is in long expression</title>
                <link>https://issues.apache.org/jira/browse/JEXL-330</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;p&gt;JEXL makes some nice diagnostic messages available from &lt;tt&gt;Exception.getMessage()&lt;/tt&gt;. However, in the case where a &lt;tt&gt;JexlException.Parsing&lt;/tt&gt; is thrown in the middle of a long expression,&#160; &lt;tt&gt;getMessage()&lt;/tt&gt; throws a &lt;tt&gt;StringIndexOutOfBoundsException&lt;/tt&gt; instead of returning a nice diagnostic message.&lt;/p&gt;

&lt;p&gt;I encountered this in JEXL 3.1, but have confirmed that it is reproducible using a recent clone of the GitHub repository.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Impact:&lt;/b&gt;&lt;br/&gt;
In the case where the JEXL programmer includes the badly-formed expression, my program, which uses JEXL, throws an unhanded exception, instead of printing out a clear message to the JEXL programmer.&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Steps to Reproduce:&lt;/b&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testLongParseError() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    JexlEngine jexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().create();

    &lt;span class=&quot;code-comment&quot;&gt;// Extended form of: &lt;span class=&quot;code-quote&quot;&gt;&apos;literal&apos;&lt;/span&gt; + VARIABLE   &lt;span class=&quot;code-quote&quot;&gt;&apos;literal&apos;&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// missing + &lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt; here ---------------^
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; longExpression = &quot;&quot; + &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;        &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;THIS IS A VERY VERY VERY VERY VERY VERY VERY &quot;&lt;/span&gt; + &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;        &lt;span class=&quot;code-quote&quot;&gt;&quot;VERY VERY LONG STRING CONCATENATION &lt;span class=&quot;code-quote&quot;&gt;&apos; + VARIABLE &apos;&lt;/span&gt; &amp;lt;--- &quot;&lt;/span&gt; + &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;        &lt;span class=&quot;code-quote&quot;&gt;&quot;error: missing + between VARIABLE and literal&apos;&quot;&lt;/span&gt;;

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        jexl.createExpression(longExpression);
        Assert.fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;parsing malformed expression did not &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; exception&quot;&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (JexlException.Parsing exception) {
        Assert.assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;???&quot;&lt;/span&gt;, exception.getMessage());
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;What Happens:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;createExpression()&lt;/tt&gt; throws a &lt;tt&gt;JexlException.Parsing&lt;/tt&gt;, as expected.&lt;br/&gt;
Calling &lt;tt&gt;getMessage()&lt;/tt&gt; on the resulting &lt;tt&gt;JexlException.Parsing&lt;/tt&gt;, in turn, throws &lt;tt&gt;StringIndexOutOfBoundsException&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Expected Result:&lt;/b&gt;&lt;br/&gt;
&lt;tt&gt;getMessage()&lt;/tt&gt; returns a brief description of the syntax error.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Technical Details:&lt;/b&gt;&lt;br/&gt;
The problem might be in &lt;tt&gt;JexlException.parseError&lt;/tt&gt;. In the case where the expression is long (in this case, the part after the VARIABLE), it tries to extract a snippet of the error.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; parserError(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; prefix, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; expr) {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length = expr.length();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (length &amp;lt; MAX_EXCHARLOC) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; prefix + &lt;span class=&quot;code-quote&quot;&gt;&quot; error in &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + expr + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;&quot;&lt;/span&gt;;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; begin = info.getColumn(); &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;---- column in original expression, not within expr
&lt;/span&gt;                                      &lt;span class=&quot;code-comment&quot;&gt;//        In &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;, begin &amp;gt; length
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; end = begin + (MAX_EXCHARLOC / 2);
        begin -= (MAX_EXCHARLOC / 2);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (begin &amp;lt; 0) {
            end -= begin;
            begin = 0;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; prefix + &lt;span class=&quot;code-quote&quot;&gt;&quot; error near &apos;... &quot;&lt;/span&gt;
                + expr.substring(begin, end &amp;gt; length ? length : end) + &lt;span class=&quot;code-quote&quot;&gt;&quot; ...&apos;&quot;&lt;/span&gt;;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, the expression that it&apos;s given is already an extract, not the entire line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&apos; &amp;lt;--- error: missing + between VARIABLE and literal&apos;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;info.getColumn()&lt;/tt&gt; returns an index in the &lt;em&gt;original&lt;/em&gt; expression, which is already already past the end of the &lt;tt&gt;expr&lt;/tt&gt;.&#160; So when &lt;tt&gt;JexlException.parseError&lt;/tt&gt; invokes &lt;tt&gt;expr.substring()&lt;/tt&gt;, it throws &lt;tt&gt;StringIndexOutOfBoundsException&lt;/tt&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13296542">JEXL-330</key>
            <summary>JexlException.Parsing.getMessage() throws StringIndexOutOfBoundsException when parse error is in long expression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrib">Henri Biestro</assignee>
                                    <reporter username="david_costanzo">David Costanzo</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Apr 2020 15:24:09 +0000</created>
                <updated>Mon, 7 Jun 2021 13:14:34 +0000</updated>
                            <resolved>Wed, 8 Apr 2020 11:02:17 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17077983" author="henrib" created="Wed, 8 Apr 2020 09:20:06 +0000"  >&lt;p&gt;Thanks for reporting this issue with such precision.&lt;/p&gt;</comment>
                            <comment id="17078069" author="henrib" created="Wed, 8 Apr 2020 11:02:17 +0000"  >&lt;p&gt;Changeset: 1c2bdb466698e7dd7173c8ac52432188401f8296&lt;br/&gt;
Author:    henrib &amp;lt;henrib@apache.org&amp;gt;&lt;br/&gt;
Date:      2020-04-08 13:01&lt;br/&gt;
Message:   &lt;a href=&quot;https://issues.apache.org/jira/browse/JEXL-330&quot; title=&quot;JexlException.Parsing.getMessage() throws StringIndexOutOfBoundsException when parse error is in long expression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JEXL-330&quot;&gt;&lt;del&gt;JEXL-330&lt;/del&gt;&lt;/a&gt;: use source in parsing error reporting&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dbp4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>