<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:58:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-257] Function throwing IllegalArgumentException may be called twice</title>
                <link>https://issues.apache.org/jira/browse/JEXL-257</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;p&gt;With regard to &lt;a href=&quot;https://issues.apache.org/jira/browse/JEXL-256&quot; title=&quot;Jexl should not try to resolve a variable from Context when Context.has() returns false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JEXL-256&quot;&gt;&lt;del&gt;JEXL-256&lt;/del&gt;&lt;/a&gt; I have noticed that a function which once had throw IllegalArgumentException may be called immediately once again in script. The problem is not always reproducible so I think it is somehow related to caching and &lt;tt&gt;tryInvoke()&lt;/tt&gt; being called first and &lt;tt&gt;invoke()&lt;/tt&gt; called afterwards.&lt;/p&gt;

&lt;p&gt;I can&apos;t produce test case at the moment but try to describe on the example. I ommited some irrelevant details for the sake of simplicity...&lt;/p&gt;

&lt;p&gt;First I have a function that evaluates Jexl script within script.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
eval(&lt;span class=&quot;code-quote&quot;&gt;&quot;java = 1&quot;&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then I have a &lt;tt&gt;Context.set()&lt;/tt&gt; that works like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void set(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) {
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (name.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;java&quot;&lt;/span&gt;))
   &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;java&quot;&lt;/span&gt;);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As I stated in &lt;a href=&quot;https://issues.apache.org/jira/browse/JEXL-256&quot; title=&quot;Jexl should not try to resolve a variable from Context when Context.has() returns false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JEXL-256&quot;&gt;&lt;del&gt;JEXL-256&lt;/del&gt;&lt;/a&gt;, when &lt;tt&gt;Context.set()&lt;/tt&gt; throws IllegalArgumentException then script execution immediately terminates with this exception, and not with JexlException. So, the function &lt;tt&gt;eval()&lt;/tt&gt; im my case terminates with IllegalArgumentException also.&lt;/p&gt;

&lt;p&gt;Then I have two stack traces in the log, one for the first invocation&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;java.lang.IllegalArgumentException: java&lt;br/&gt;
 at MyDefaultContext.set(MyDefaultContext.java:279) &lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.executeAssign(Interpreter.java:1189) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1094) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTAssignment.jjtAccept(ASTAssignment.java:18) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:890) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTJexlScript.jjtAccept(ASTJexlScript.java:58) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.interpret(Interpreter.java:190) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Script.execute(Script.java:185) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at EvaluationContext.evalScript(EvaluationContext.java:1078) &lt;br/&gt;
 at EvaluationContext.evaluateScript(EvaluationContext.java:1043) &lt;br/&gt;
 at MyDefaultContext.eval(MyDefaultContext.java:736)&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_162&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_162&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_162&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.lang.reflect.Method.invoke(Method.java:498) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_162&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.introspection.MethodExecutor.invoke(MethodExecutor.java:93) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.introspection.MethodExecutor.tryInvoke(MethodExecutor.java:104) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter$Funcall.tryInvoke(Interpreter.java:1436) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.call(Interpreter.java:1545) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1357) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTFunctionNode.jjtAccept(ASTFunctionNode.java:18) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.executeAssign(Interpreter.java:1149) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1094) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTAssignment.jjtAccept(ASTAssignment.java:18) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.processAnnotation(Interpreter.java:1907) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter$1.call(Interpreter.java:1917) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.msy.einie.f1.jexl.MsyDefaultContext.processAnnotation(MsyDefaultContext.java:531) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;msy-1.0.jar:1.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.processAnnotation(Interpreter.java:1963) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.processAnnotation(Interpreter.java:1936) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1877) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTAnnotatedStatement.jjtAccept(ASTAnnotatedStatement.java:18) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:890) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTJexlScript.jjtAccept(ASTJexlScript.java:58) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.interpret(Interpreter.java:190) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Script.execute(Script.java:185) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;and the one for the second&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;java.lang.IllegalArgumentException: java&lt;br/&gt;
 at MyDefaultContext.set(MyDefaultContext.java:279)&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.executeAssign(Interpreter.java:1189) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1094) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTAssignment.jjtAccept(ASTAssignment.java:18) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:890) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTJexlScript.jjtAccept(ASTJexlScript.java:58) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.interpret(Interpreter.java:190) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Script.execute(Script.java:185) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at EvaluationContext.evalScript(EvaluationContext.java:1078)&lt;br/&gt;
 at EvaluationContext.evaluateScript(EvaluationContext.java:1043)&lt;br/&gt;
 at MyDefaultContext.eval(MyDefaultContext.java:736)&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_162&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_162&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_162&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at java.lang.reflect.Method.invoke(Method.java:498) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;?:1.8.0_162&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.introspection.MethodExecutor.invoke(MethodExecutor.java:93) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.call(Interpreter.java:1642) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1357) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTFunctionNode.jjtAccept(ASTFunctionNode.java:18) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.executeAssign(Interpreter.java:1149) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1094) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTAssignment.jjtAccept(ASTAssignment.java:18) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.processAnnotation(Interpreter.java:1907) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter$1.call(Interpreter.java:1917) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at com.msy.einie.f1.jexl.MsyDefaultContext.processAnnotation(MsyDefaultContext.java:531) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;msy-1.0.jar:1.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.processAnnotation(Interpreter.java:1963) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.processAnnotation(Interpreter.java:1936) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1877) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTAnnotatedStatement.jjtAccept(ASTAnnotatedStatement.java:18) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:890) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.parser.ASTJexlScript.jjtAccept(ASTJexlScript.java:58) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Interpreter.interpret(Interpreter.java:190) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
 at org.apache.commons.jexl3.internal.Script.execute(Script.java:185) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;commons-jexl-3.2.jar:3.2-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this is a bug and we should not call a function twice if it returned &lt;tt&gt;IllegalArgumentException&lt;/tt&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13151640">JEXL-257</key>
            <summary>Function throwing IllegalArgumentException may be called twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrib">Henri Biestro</assignee>
                                    <reporter username="dmitri_blinov">Dmitri Blinov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Apr 2018 12:56:00 +0000</created>
                <updated>Mon, 7 Jun 2021 13:15:01 +0000</updated>
                            <resolved>Mon, 13 May 2019 14:51:25 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16582538" author="henrib" created="Thu, 16 Aug 2018 13:47:14 +0000"  >&lt;p&gt;Without a better test case that is reproducible somehow, I&apos;m afraid there is nothing that can be &apos;fixed&apos;.&lt;/p&gt;</comment>
                            <comment id="16638095" author="dmitri_blinov" created="Thu, 4 Oct 2018 11:30:10 +0000"  >&lt;p&gt;I think the problem lies in the code of &lt;tt&gt;MethodExecutor.tryInvoke()&lt;/tt&gt;, as it catches &lt;tt&gt;InvocationTargetException&lt;/tt&gt; and returns &lt;tt&gt;TRY_FAILED&lt;/tt&gt;, which is a signal to retry method execution later. So the cached method will be called twice. I think &lt;tt&gt;InvocationTargetException&lt;/tt&gt; should not be catched by &lt;tt&gt;tryInvoke&lt;/tt&gt;, as &lt;tt&gt;InvocationTargetException&lt;/tt&gt; means that we have successfully resolved the method, but for some reason it throwed an exception. The original problem seem not to be necessarily related to the method throwing &lt;tt&gt;IllegalArgumentException&lt;/tt&gt; per se, any exception thrown by the cached method will lead to this, which is clearly should not be the case.&lt;/p&gt;</comment>
                            <comment id="16659070" author="henrib" created="Mon, 22 Oct 2018 15:15:30 +0000"  >&lt;p&gt;Notes and implications of the proposed tryInvoke behaviour change. &lt;br/&gt;
The proposed modifications breaks the API contract by suddenly potentially throwing an exception, tryInvoke working on the premise that a previously resolved method can be called again successfully with the same type of arguments. Most if not all executors would be impacted by the change (not only MethodExecutor but all *Executor).&lt;br/&gt;
Reviewing the code, there does not seem to be a case where the code caches a method that has (hard) failed. &lt;br/&gt;
The issue described occurs when the 1st invocation is successful but the 2nd (tryInvoke) and 3rd (invoke) fail... If we want to avoid the 3rd (failing) invocation, we need the 2nd to keep around its cause implying the TRY_FAIL can not be a singleton anymore.&lt;br/&gt;
Being only used for caching purpose for *internal, the probability that the API contract actually breaks user code seems very (very) unlikely...&lt;/p&gt;</comment>
                            <comment id="16660280" author="dmitri_blinov" created="Tue, 23 Oct 2018 08:43:43 +0000"  >&lt;p&gt;I think the main point is that the cached method invokation (2nd &lt;tt&gt;tryInvoke&lt;/tt&gt;) should work exactly just like not cached version (1st &lt;tt&gt;invoke&lt;/tt&gt;). That means that if underlying method have thrown exception, we must either directly (by assuming &lt;tt&gt;tryInvoke&lt;/tt&gt; may throw an exception just like &lt;tt&gt;invoke&lt;/tt&gt; does) or by wrapping it into some kind of &lt;tt&gt;TryFail&lt;/tt&gt; class, nevertheless rethrow it to the calling code. It should not be silently swallowed, and instead the 3rd &lt;tt&gt;invoke&lt;/tt&gt; being called.&lt;/p&gt;

&lt;p&gt;BTW I have created a commit for this in side branch &lt;a href=&quot;https://github.com/dmitri-blinov/commons-jexl/commit/907ee345c66628b7f31d9cbee5927fc8811638ec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dmitri-blinov/commons-jexl/commit/907ee345c66628b7f31d9cbee5927fc8811638ec&lt;/a&gt;, the change works by only impacting &lt;tt&gt;MethodExecutor&lt;/tt&gt;, changes to other executors are not required. Please have a look and tell what you think?&lt;/p&gt;</comment>
                            <comment id="16732141" author="henrib" created="Wed, 2 Jan 2019 15:00:49 +0000"  >&lt;p&gt;Made sure that tryInvoke only reuses a &apos;set&apos; method if the value class is also preserved.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-jexl/commit/3d648dbc3537eff3330ecf70677f22097ff68a9f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-jexl/commit/3d648dbc3537eff3330ecf70677f22097ff68a9f&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16838409" author="henrib" created="Mon, 13 May 2019 09:34:09 +0000"  >&lt;p&gt;After much debate, the semantic of &apos;tryInvoke&apos; will be changed and precised.&lt;/p&gt;

&lt;p&gt;When a &apos;Jexl{Method, Setter, Getter}&apos; is called through tryInvoke(...), the invocation will happen if the underlying method signature and actual arguments are compatible. If the call compatibility can not be ensured, the TRY_FAIL object is returned. As of 3.2, if the invocation occurs but the underlying method throws an Exception - which is carried through an InvocationTargetException - , tryInvoke will throw a JexlException.TryFailed wrapping the exception cause.&lt;/p&gt;

&lt;p&gt;This is a change in behaviour that is not expected to impact user code since exception occurring through invocation is expected to be very rate and tryInvoke is likely to only be used internally by JEXL. &lt;/p&gt;</comment>
                            <comment id="16838530" author="henrib" created="Mon, 13 May 2019 13:12:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-jexl/commit/f9cd296856ec1373cf7b7492e231eb0208636aa0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-jexl/commit/f9cd296856ec1373cf7b7492e231eb0208636aa0&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/commons-jexl/commit/2b271068c873c3bb9b08b7ee885a5fa6768a70b9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-jexl/commit/2b271068c873c3bb9b08b7ee885a5fa6768a70b9&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16838593" author="henrib" created="Mon, 13 May 2019 14:51:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-jexl/commit/414f3d7f2899ae1e7f896aa55a821303e30bfd57&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-jexl/commit/414f3d7f2899ae1e7f896aa55a821303e30bfd57&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3seyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>