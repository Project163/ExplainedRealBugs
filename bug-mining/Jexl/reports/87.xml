<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:58:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-241] NPE when script containing string interpolation executed in multiple threads</title>
                <link>https://issues.apache.org/jira/browse/JEXL-241</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;p&gt;When a script containing string interpolation is executed in multiple threads, a &quot;NullPointerException&quot; is sometimes thrown (other times it may hang or it may run successfully).&lt;/p&gt;

&lt;p&gt;The following is a sample program that can produce the bug (you may need to run it for a few times to encounter the bug).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; jexldemo2;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.jexl3.JexlBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.jexl3.JexlScript;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.jexl3.MapContext;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.HashMap;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Map;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.ExecutorService;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.concurrent.Executors;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DemoApplication {

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; ExecutorService pool;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; JexlScript script = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().create().createScript(&lt;span class=&quot;code-quote&quot;&gt;&quot;`${item}`&quot;&lt;/span&gt;);

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
        pool = Executors.newFixedThreadPool(4);

        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; m1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
        m1.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;item&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;);
        Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; m2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
        m2.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;item&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;);

        handle(m1);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(script.execute(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MapContext(m2)));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Reached the end&quot;&lt;/span&gt;);
        pool.shutdown();
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void handle(Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; payload) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;START: %s\n&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread());
        pool.submit(() -&amp;gt; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(script.execute(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MapContext(payload))));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;STOP: %s\n&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread());
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the bug output is as follows:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;START: Thread[main,5,main]
STOP: Thread[main,5,main]
Exception in thread &quot;main&quot; java.lang.NullPointerException
	at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1818)
	at org.apache.commons.jexl3.parser.ASTJxltLiteral.jjtAccept(ASTJxltLiteral.java:50)
	at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:892)
	at org.apache.commons.jexl3.parser.ASTJexlScript.jjtAccept(ASTJexlScript.java:55)
	at org.apache.commons.jexl3.internal.Interpreter.interpret(Interpreter.java:186)
	at org.apache.commons.jexl3.internal.Script.execute(Script.java:178)
	at jexldemo2.DemoApplication.main(DemoApplication.java:26)
A
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment>&lt;p&gt;Centos Linux 7.2.1511&lt;/p&gt;

&lt;p&gt;openjdk version &quot;1.8.0_101&quot;&lt;br/&gt;
OpenJDK Runtime Environment (build 1.8.0_101-b13)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 25.101-b13, mixed mode)&lt;/p&gt;

&lt;p&gt;Gradle dependency for JEXL is org.apache.commons:commons-jexl3:3.1&lt;/p&gt;</environment>
        <key id="13109564">JEXL-241</key>
            <summary>NPE when script containing string interpolation executed in multiple threads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrib">Henri Biestro</assignee>
                                    <reporter username="ywangd">Yang Wang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Oct 2017 00:28:41 +0000</created>
                <updated>Mon, 7 Jun 2021 13:14:35 +0000</updated>
                            <resolved>Thu, 19 Oct 2017 12:03:31 +0000</resolved>
                                    <version>3.1</version>
                                    <fixVersion>3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16210915" author="henrib" created="Thu, 19 Oct 2017 12:03:31 +0000"  >&lt;p&gt;Good catch, thanks for the issue!&lt;br/&gt;
Bad implementation of a double-check lazy initialization, aka item 71.&lt;br/&gt;
src/main/java/org/apache/commons/jexl3/internal/Engine.java&lt;br/&gt;
Revision: 1812625&lt;/p&gt;</comment>
                            <comment id="16281978" author="krm1312" created="Thu, 7 Dec 2017 15:11:06 +0000"  >&lt;p&gt;Any plan to release 3.2 soon?  This is pretty fatal under reasonable concurrency.&lt;/p&gt;</comment>
                            <comment id="16282019" author="krm1312" created="Thu, 7 Dec 2017 15:42:13 +0000"  >&lt;p&gt;Take your time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.  Workaround is not difficult.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

    &lt;span class=&quot;code-comment&quot;&gt;// workaround https://issues.apache.org/jira/browse/JEXL-241.  Remove when 3.2 is released.
&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Jexl241Builder &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; JexlBuilder {
        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; JexlEngine create() {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Jexl241Engine(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Jexl241Engine &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Engine {
        Jexl241Engine(JexlBuilder conf) {
            &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(conf);
        }

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; TemplateEngine jxlt() {
            TemplateEngine e = jxlt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) {
                    e = jxlt;
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                        e = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TemplateEngine(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, 0, &lt;span class=&quot;code-quote&quot;&gt;&apos;$&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;#&apos;&lt;/span&gt;);
                        jxlt = e;
                    }
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; e;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 49 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3labb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>