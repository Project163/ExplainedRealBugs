<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:57:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-190] local function within context is not resolved if function resolver class without namespace is specified</title>
                <link>https://issues.apache.org/jira/browse/JEXL-190</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;z = function(x) { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; x + 1}; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; z(1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; returns error unsolvable function/method &apos;z&apos; while &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; z = function(x) { &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; x + 1}; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; z(1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; returns 2&lt;/p&gt;</description>
                <environment></environment>
        <key id="12944474">JEXL-190</key>
            <summary>local function within context is not resolved if function resolver class without namespace is specified</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrib">Henri Biestro</assignee>
                                    <reporter username="dmitri_blinov">Dmitri Blinov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Feb 2016 12:56:23 +0000</created>
                <updated>Tue, 29 Jun 2021 06:59:03 +0000</updated>
                            <resolved>Fri, 18 Mar 2016 14:03:14 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15168769" author="henrib" created="Fri, 26 Feb 2016 10:13:11 +0000"  >&lt;p&gt;Hi Dimitri;&lt;br/&gt;
I&apos;m not able to reproduce the issue. May be something in your context implementation ?&lt;br/&gt;
My test code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void test180() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sglobal = &lt;span class=&quot;code-quote&quot;&gt;&quot;z = (x)-&amp;gt;{ &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; x + 1}; z(41)&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; slocal = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; t = (x)-&amp;gt;{ &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; x + 41}; t(1)&quot;&lt;/span&gt;;
        JexlContext jc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MapContext();
        JexlEngine jexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().create();
        JexlScript jglobal = jexl.createScript(sglobal);
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; oglobal = jglobal.execute(jc);
        Assert.assertEquals(42, oglobal);
        JexlScript jlocal = jexl.createScript(slocal);
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; olocal = jlocal.execute(jc);
        Assert.assertEquals(42, olocal);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15168884" author="dmitri_blinov" created="Fri, 26 Feb 2016 12:17:39 +0000"  >&lt;p&gt;It has turned out that the problem is reproduced if I try to initialize JEXLEngine with functions without a namespace in a way like this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    functions = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;();
    &lt;span class=&quot;code-comment&quot;&gt;// Register &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; function namespaces
&lt;/span&gt;    functions.put(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultFunctions(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;));
...

    &lt;span class=&quot;code-comment&quot;&gt;// Jexl Setup
&lt;/span&gt;
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; verboseScripting = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; strict = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;

    JexlBuilder jb = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder();
    jb.silent(!verboseScripting);
    jb.strict(strict);
    jb.namespaces(functions);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To be sure, the class DefaultFunctions does not contain method z. If I comment out the line  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-comment&quot;&gt;// functions.put(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultFunctions(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;)); &lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; everything works as expected. Now I wonder if it&apos;s correct to register functions with null namespace ?&lt;/p&gt;</comment>
                            <comment id="15169223" author="henrib" created="Fri, 26 Feb 2016 15:51:08 +0000"  >&lt;p&gt;I usually put &apos;default&apos; functions in the context (i.e extend JexlContext and implement functions as methods of that class) and only use &apos;named&apos; namespaces. But nothing in the code precludes using a &apos;null&apos; namespace.&lt;br/&gt;
Your use-case fix is thus; when solving a function call (without a namespace), if a variable in the context exists with that name, it will be evaluated and used. The code expects this variable value to be a &apos;function&apos; object  (i.e. something that can be called like a function; a method, a closure, etc) and will fail at runtime if not.&lt;br/&gt;
This only restates the fact that a variable - local or global - can mask a (default) method.&lt;/p&gt;</comment>
                            <comment id="15170395" author="dmitri_blinov" created="Sat, 27 Feb 2016 06:33:32 +0000"  >&lt;p&gt;Well, if null namespaces are not prohibited, then we have a bug in the current implementation, which prevents any functions from global context from being resolved (incorrect) while allowing functions from local context to be used (correct), if JEXLEngine was built with namespace resolver map containing &apos;null&apos; key.&lt;/p&gt;</comment>
                            <comment id="15197073" author="dmitri_blinov" created="Wed, 16 Mar 2016 09:14:46 +0000"  >&lt;p&gt;As far as I can understand the logic the problem lies in Interpreter.java &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; visit(ASTFunctionNode node, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; data) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; argc = node.jjtGetNumChildren();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (argc == 2) {
            &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; namespace = resolveNamespace(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, node);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (namespace == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                namespace = context;
            }
            ASTIdentifier functionNode = (ASTIdentifier) node.jjtGetChild(0);
            ASTArguments argNode = (ASTArguments) node.jjtGetChild(1);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; call(node, namespace, functionNode, argNode);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;if we initialized JexlEngine with namespace resolver map containing &apos;null&apos; key, then JexlContext is never checked as it is only checked if there is nothing returned by resolveNamespace. So even if a variable in the context exists with that name, it will never be evaluated.&lt;/p&gt;</comment>
                            <comment id="15198835" author="henrib" created="Thu, 17 Mar 2016 06:34:11 +0000"  >&lt;p&gt;I&apos;ve been working on a fix but stumbled on a potential issue wrt to caching and variables (local or global) holding &apos;functors&apos;. I should commit something momentarily; thanks for your patience.&lt;/p&gt;</comment>
                            <comment id="15201499" author="henrib" created="Fri, 18 Mar 2016 14:03:14 +0000"  >&lt;p&gt;src/main/java/org/apache/commons/jexl3/internal/Interpreter.java&lt;br/&gt;
src/test/java/org/apache/commons/jexl3/MethodTest.java&lt;br/&gt;
src/site/xdoc/changes.xml&lt;/p&gt;

&lt;p&gt;Committed revision 1735607.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tqrz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>