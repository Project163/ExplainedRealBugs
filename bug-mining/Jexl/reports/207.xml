<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sun Nov 09 05:59:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JEXL-403] Exception while evaluating template literal used in array assignment in loop.</title>
                <link>https://issues.apache.org/jira/browse/JEXL-403</link>
                <project id="12310479" key="JEXL">Commons JEXL</project>
                    <description>&lt;p&gt;code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; a = {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;: 1};
&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; list = [a, a];
let map1 = {:};
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; item : list) {
&#160; map1[`${item.a}`] = 1;
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The fist iteration is ok, but failed at the second time.&lt;/p&gt;

&lt;p&gt;error stack&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.ClassCastException: &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.commons.jexl3.internal.introspection.MapSetExecutor cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.commons.jexl3.internal.TemplateEngine$TemplateExpression (org.apache.commons.jexl3.internal.introspection.MapSetExecutor and org.apache.commons.jexl3.internal.TemplateEngine$TemplateExpression are in unnamed module of loader &lt;span class=&quot;code-quote&quot;&gt;&apos;app&apos;&lt;/span&gt;)
&#160; &#160; at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1909)
&#160; &#160; at org.apache.commons.jexl3.parser.ASTJxltLiteral.jjtAccept(ASTJxltLiteral.java:54)
&#160; &#160; at org.apache.commons.jexl3.internal.Interpreter.executeAssign(Interpreter.java:1558)
&#160; &#160; at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:1319)
&#160; &#160; at org.apache.commons.jexl3.parser.ASTAssignment.jjtAccept(ASTAssignment.java:19)
&#160; &#160; at org.apache.commons.jexl3.internal.Interpreter.visitBlock(Interpreter.java:615)
&#160; &#160; at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:594)
&#160; &#160; at org.apache.commons.jexl3.parser.ASTBlock.jjtAccept(ASTBlock.java:35)
&#160; &#160; at org.apache.commons.jexl3.internal.Interpreter.forIterator(Interpreter.java:700)
&#160; &#160; at org.apache.commons.jexl3.internal.Interpreter.visit(Interpreter.java:639) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13548812">JEXL-403</key>
            <summary>Exception while evaluating template literal used in array assignment in loop.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="henrib">Henri Biestro</assignee>
                                    <reporter username="xupengcheng">Xu Pengcheng</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Aug 2023 09:39:43 +0000</created>
                <updated>Wed, 30 Aug 2023 00:57:34 +0000</updated>
                            <resolved>Tue, 29 Aug 2023 19:14:55 +0000</resolved>
                                    <version>3.3</version>
                                    <fixVersion>3.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17759945" author="henrib" created="Tue, 29 Aug 2023 12:22:58 +0000"  >&lt;p&gt;I must be missing something, so far I&apos;m not reproducing the pb. The following code works correctly on JEXL 3.3 trunk.&lt;br/&gt;
Commit &lt;a href=&quot;https://github.com/apache/commons-jexl/commit/cd3db936723ca8e5c7bf68a62f23f15642ce992a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;cd3db9&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void test403() {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JexlContext ctxt = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MapContext();
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; src = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; a = {&lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;: 1};\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; list = [a, a];\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;let map1 = {:};\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; item : list) {\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;  map1[`${item.a}`] = 1;\n&quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;}\n &quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;map1&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; JexlEngine jexl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().create();
    JexlScript script = jexl.createScript(src);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 2; ++ i) {
      &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; result = script.execute(ctxt);
      Assert.assertTrue(result &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Map);
      Map&amp;lt;?, ?&amp;gt; map = (Map&amp;lt;?, ?&amp;gt;) result;
      Assert.assertEquals(1, map.size());
      Assert.assertTrue(map.containsKey(1));
      Assert.assertTrue(map.containsValue(1));
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17759998" author="JIRAUSER294041" created="Tue, 29 Aug 2023 15:20:52 +0000"  >&lt;p&gt;I tried at my side and found the problem is caused by setting cache size &amp;gt; 0.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Engine(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JexlBuilder().cache(100)); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;BTW, I read the comment of this method but not quite understand what is in cache, can you please provide more explanation?&lt;/p&gt;

&lt;p&gt;Thanks a lot!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17760051" author="henrib" created="Tue, 29 Aug 2023 17:25:19 +0000"  >&lt;p&gt;Reproduced the problem with caching enabled.&lt;/p&gt;

&lt;p&gt;The cache is a cache of expressions/scripts keyed by source and valued by the DAG (direct acyclic graph) of AST (abstract syntactic tree) nodes used for interpretation. A lot of those nodes further cache costly interpretation operations in particular solving methods and property accessors, those requiring Java reflection (introspection).&lt;br/&gt;
Calling cache(...) on a JexlBuilder will set the number of entries (scripts, expressions) kept in the engine cache.&lt;/p&gt;

&lt;p&gt;The issue seem to stem from caching a property setter in the wrong node.&lt;/p&gt;</comment>
                            <comment id="17760116" author="henrib" created="Tue, 29 Aug 2023 19:14:55 +0000"  >&lt;p&gt;Commit &lt;a href=&quot;https://github.com/apache/commons-jexl/commit/c64ee0df87677b82d062fc4096ed1cb6c5e858a0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;c64ee0d&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17760176" author="JIRAUSER294041" created="Wed, 30 Aug 2023 00:57:34 +0000"  >&lt;p&gt;great, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1k1fc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>